<!doctype html><html lang="en">
 <head>
  <meta charset="utf-8">
  <title>requestStorageAccessForOrigin API</title>
  <meta content="width=device-width" name="viewport">
  <link href="https://www.w3.org/StyleSheets/TR/2021/cg-draft" rel="stylesheet">
  <link href="https://github.com/privacycg/requestStorageAccessForOrigin" rel="canonical">
<style>/* style-autolinks */

.css.css, .property.property, .descriptor.descriptor {
    color: var(--a-normal-text);
    font-size: inherit;
    font-family: inherit;
}
.css::before, .property::before, .descriptor::before {
    content: "‘";
}
.css::after, .property::after, .descriptor::after {
    content: "’";
}
.property, .descriptor {
    /* Don't wrap property and descriptor names */
    white-space: nowrap;
}
.type { /* CSS value <type> */
    font-style: italic;
}
pre .property::before, pre .property::after {
    content: "";
}
[data-link-type="property"]::before,
[data-link-type="propdesc"]::before,
[data-link-type="descriptor"]::before,
[data-link-type="value"]::before,
[data-link-type="function"]::before,
[data-link-type="at-rule"]::before,
[data-link-type="selector"]::before,
[data-link-type="maybe"]::before {
    content: "‘";
}
[data-link-type="property"]::after,
[data-link-type="propdesc"]::after,
[data-link-type="descriptor"]::after,
[data-link-type="value"]::after,
[data-link-type="function"]::after,
[data-link-type="at-rule"]::after,
[data-link-type="selector"]::after,
[data-link-type="maybe"]::after {
    content: "’";
}

[data-link-type].production::before,
[data-link-type].production::after,
.prod [data-link-type]::before,
.prod [data-link-type]::after {
    content: "";
}

[data-link-type=element],
[data-link-type=element-attr] {
    font-family: Menlo, Consolas, "DejaVu Sans Mono", monospace;
    font-size: .9em;
}
[data-link-type=element]::before { content: "<" }
[data-link-type=element]::after  { content: ">" }

[data-link-type=biblio] {
    white-space: pre;
}</style>
<style>/* style-colors */

/* Any --*-text not paired with a --*-bg is assumed to have a transparent bg */
:root {
    color-scheme: light dark;

    --text: black;
    --bg: white;

    --unofficial-watermark: url(https://www.w3.org/StyleSheets/TR/2016/logos/UD-watermark);

    --logo-bg: #1a5e9a;
    --logo-active-bg: #c00;
    --logo-text: white;

    --tocnav-normal-text: #707070;
    --tocnav-normal-bg: var(--bg);
    --tocnav-hover-text: var(--tocnav-normal-text);
    --tocnav-hover-bg: #f8f8f8;
    --tocnav-active-text: #c00;
    --tocnav-active-bg: var(--tocnav-normal-bg);

    --tocsidebar-text: var(--text);
    --tocsidebar-bg: #f7f8f9;
    --tocsidebar-shadow: rgba(0,0,0,.1);
    --tocsidebar-heading-text: hsla(203,20%,40%,.7);

    --toclink-text: var(--text);
    --toclink-underline: #3980b5;
    --toclink-visited-text: var(--toclink-text);
    --toclink-visited-underline: #054572;

    --heading-text: #005a9c;

    --hr-text: var(--text);

    --algo-border: #def;

    --del-text: red;
    --del-bg: transparent;
    --ins-text: #080;
    --ins-bg: transparent;

    --a-normal-text: #034575;
    --a-normal-underline: #bbb;
    --a-visited-text: var(--a-normal-text);
    --a-visited-underline: #707070;
    --a-hover-bg: rgba(75%, 75%, 75%, .25);
    --a-active-text: #c00;
    --a-active-underline: #c00;

    --blockquote-border: silver;
    --blockquote-bg: transparent;
    --blockquote-text: currentcolor;

    --issue-border: #e05252;
    --issue-bg: #fbe9e9;
    --issue-text: var(--text);
    --issueheading-text: #831616;

    --example-border: #e0cb52;
    --example-bg: #fcfaee;
    --example-text: var(--text);
    --exampleheading-text: #574b0f;

    --note-border: #52e052;
    --note-bg: #e9fbe9;
    --note-text: var(--text);
    --noteheading-text: hsl(120, 70%, 30%);
    --notesummary-underline: silver;

    --assertion-border: #aaa;
    --assertion-bg: #eee;
    --assertion-text: black;

    --advisement-border: orange;
    --advisement-bg: #fec;
    --advisement-text: var(--text);
    --advisementheading-text: #b35f00;

    --warning-border: red;
    --warning-bg: hsla(40,100%,50%,0.95);
    --warning-text: var(--text);

    --amendment-border: #330099;
    --amendment-bg: #F5F0FF;
    --amendment-text: var(--text);
    --amendmentheading-text: #220066;

    --def-border: #8ccbf2;
    --def-bg: #def;
    --def-text: var(--text);
    --defrow-border: #bbd7e9;

    --datacell-border: silver;

    --indexinfo-text: #707070;

    --indextable-hover-text: black;
    --indextable-hover-bg: #f7f8f9;

    --outdatedspec-bg: rgba(0, 0, 0, .5);
    --outdatedspec-text: black;
    --outdated-bg: maroon;
    --outdated-text: white;
    --outdated-shadow: red;

    --editedrec-bg: darkorange;
}</style>
<style>/* style-counters */

body {
    counter-reset: example figure issue;
}
.issue {
    counter-increment: issue;
}
.issue:not(.no-marker)::before {
    content: "Issue " counter(issue);
}

.example {
    counter-increment: example;
}
.example:not(.no-marker)::before {
    content: "Example " counter(example);
}
.invalid.example:not(.no-marker)::before,
.illegal.example:not(.no-marker)::before {
    content: "Invalid Example" counter(example);
}

figcaption {
    counter-increment: figure;
}
figcaption:not(.no-marker)::before {
    content: "Figure " counter(figure) " ";
}</style>
<style>/* style-dfn-panel */

:root {
    --dfnpanel-bg: #ddd;
    --dfnpanel-text: var(--text);
}
.dfn-panel {
    position: absolute;
    z-index: 35;
    height: auto;
    width: -webkit-fit-content;
    width: fit-content;
    max-width: 300px;
    max-height: 500px;
    overflow: auto;
    padding: 0.5em 0.75em;
    font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
    background: var(--dfnpanel-bg);
    color: var(--dfnpanel-text);
    border: outset 0.2em;
}
.dfn-panel:not(.on) { display: none; }
.dfn-panel * { margin: 0; padding: 0; text-indent: 0; }
.dfn-panel > b { display: block; }
.dfn-panel a { color: var(--dfnpanel-text); }
.dfn-panel a:not(:hover) { text-decoration: none !important; border-bottom: none !important; }
.dfn-panel > b + b { margin-top: 0.25em; }
.dfn-panel ul { padding: 0; }
.dfn-panel li { list-style: inside; }
.dfn-panel.activated {
    display: inline-block;
    position: fixed;
    left: .5em;
    bottom: 2em;
    margin: 0 auto;
    max-width: calc(100vw - 1.5em - .4em - .5em);
    max-height: 30vh;
}

.dfn-paneled { cursor: pointer; }
</style>
<style>/* style-issues */

a[href].issue-return {
    float: right;
    float: inline-end;
    color: var(--issueheading-text);
    font-weight: bold;
    text-decoration: none;
}
</style>
<style>/* style-md-lists */

/* This is a weird hack for me not yet following the commonmark spec
   regarding paragraph and lists. */
[data-md] > :first-child {
    margin-top: 0;
}
[data-md] > :last-child {
    margin-bottom: 0;
}</style>
<style>/* style-selflinks */

:root {
    --selflink-text: white;
    --selflink-bg: gray;
    --selflink-hover-text: black;
}
.heading, .issue, .note, .example, li, dt {
    position: relative;
}
a.self-link {
    position: absolute;
    top: 0;
    left: calc(-1 * (3.5rem - 26px));
    width: calc(3.5rem - 26px);
    height: 2em;
    text-align: center;
    border: none;
    transition: opacity .2s;
    opacity: .5;
}
a.self-link:hover {
    opacity: 1;
}
.heading > a.self-link {
    font-size: 83%;
}
.example > a.self-link,
.note > a.self-link,
.issue > a.self-link {
    /* These blocks are overflow:auto, so positioning outside
       doesn't work. */
    left: auto;
    right: 0;
}
li > a.self-link {
    left: calc(-1 * (3.5rem - 26px) - 2em);
}
dfn > a.self-link {
    top: auto;
    left: auto;
    opacity: 0;
    width: 1.5em;
    height: 1.5em;
    background: var(--selflink-bg);
    color: var(--selflink-text);
    font-style: normal;
    transition: opacity .2s, background-color .2s, color .2s;
}
dfn:hover > a.self-link {
    opacity: 1;
}
dfn > a.self-link:hover {
    color: var(--selflink-hover-text);
}

a.self-link::before            { content: "¶"; }
.heading > a.self-link::before { content: "§"; }
dfn > a.self-link::before      { content: "#"; }
</style>
<style>/* style-syntax-highlighting */

            pre.idl.highlight {
                background: var(--borderedblock-bg, var(--def-bg));
            }
            
code.highlight { padding: .1em; border-radius: .3em; }
pre.highlight, pre > code.highlight { display: block; padding: 1em; margin: .5em 0; overflow: auto; border-radius: 0; }

.highlight:not(.idl) { background: rgba(0, 0, 0, .03); }
c-[a] { color: #990055 } /* Keyword.Declaration */
c-[b] { color: #990055 } /* Keyword.Type */
c-[c] { color: #708090 } /* Comment */
c-[d] { color: #708090 } /* Comment.Multiline */
c-[e] { color: #0077aa } /* Name.Attribute */
c-[f] { color: #669900 } /* Name.Tag */
c-[g] { color: #222222 } /* Name.Variable */
c-[k] { color: #990055 } /* Keyword */
c-[l] { color: #000000 } /* Literal */
c-[m] { color: #000000 } /* Literal.Number */
c-[n] { color: #0077aa } /* Name */
c-[o] { color: #999999 } /* Operator */
c-[p] { color: #999999 } /* Punctuation */
c-[s] { color: #a67f59 } /* Literal.String */
c-[t] { color: #a67f59 } /* Literal.String.Single */
c-[u] { color: #a67f59 } /* Literal.String.Double */
c-[cp] { color: #708090 } /* Comment.Preproc */
c-[c1] { color: #708090 } /* Comment.Single */
c-[cs] { color: #708090 } /* Comment.Special */
c-[kc] { color: #990055 } /* Keyword.Constant */
c-[kn] { color: #990055 } /* Keyword.Namespace */
c-[kp] { color: #990055 } /* Keyword.Pseudo */
c-[kr] { color: #990055 } /* Keyword.Reserved */
c-[ld] { color: #000000 } /* Literal.Date */
c-[nc] { color: #0077aa } /* Name.Class */
c-[no] { color: #0077aa } /* Name.Constant */
c-[nd] { color: #0077aa } /* Name.Decorator */
c-[ni] { color: #0077aa } /* Name.Entity */
c-[ne] { color: #0077aa } /* Name.Exception */
c-[nf] { color: #0077aa } /* Name.Function */
c-[nl] { color: #0077aa } /* Name.Label */
c-[nn] { color: #0077aa } /* Name.Namespace */
c-[py] { color: #0077aa } /* Name.Property */
c-[ow] { color: #999999 } /* Operator.Word */
c-[mb] { color: #000000 } /* Literal.Number.Bin */
c-[mf] { color: #000000 } /* Literal.Number.Float */
c-[mh] { color: #000000 } /* Literal.Number.Hex */
c-[mi] { color: #000000 } /* Literal.Number.Integer */
c-[mo] { color: #000000 } /* Literal.Number.Oct */
c-[sb] { color: #a67f59 } /* Literal.String.Backtick */
c-[sc] { color: #a67f59 } /* Literal.String.Char */
c-[sd] { color: #a67f59 } /* Literal.String.Doc */
c-[se] { color: #a67f59 } /* Literal.String.Escape */
c-[sh] { color: #a67f59 } /* Literal.String.Heredoc */
c-[si] { color: #a67f59 } /* Literal.String.Interpol */
c-[sx] { color: #a67f59 } /* Literal.String.Other */
c-[sr] { color: #a67f59 } /* Literal.String.Regex */
c-[ss] { color: #a67f59 } /* Literal.String.Symbol */
c-[vc] { color: #0077aa } /* Name.Variable.Class */
c-[vg] { color: #0077aa } /* Name.Variable.Global */
c-[vi] { color: #0077aa } /* Name.Variable.Instance */
c-[il] { color: #000000 } /* Literal.Number.Integer.Long */
</style>
<style>/* style-var-click-highlighting */

    var { cursor: pointer; }
    var.selected0 { background-color: #F4D200; box-shadow: 0 0 0 2px #F4D200; }
    var.selected1 { background-color: #FF87A2; box-shadow: 0 0 0 2px #FF87A2; }
    var.selected2 { background-color: #96E885; box-shadow: 0 0 0 2px #96E885; }
    var.selected3 { background-color: #3EEED2; box-shadow: 0 0 0 2px #3EEED2; }
    var.selected4 { background-color: #EACFB6; box-shadow: 0 0 0 2px #EACFB6; }
    var.selected5 { background-color: #82DDFF; box-shadow: 0 0 0 2px #82DDFF; }
    var.selected6 { background-color: #FFBCF2; box-shadow: 0 0 0 2px #FFBCF2; }
    </style>
<style>/* style-darkmode */

@media (prefers-color-scheme: dark) {
    :root {
        --text: #ddd;
        --bg: black;

        --unofficial-watermark: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='400'%3E%3Cg fill='%23100808' transform='translate(200 200) rotate(-45) translate(-200 -200)' stroke='%23100808' stroke-width='3'%3E%3Ctext x='50%25' y='220' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EUNOFFICIAL%3C/text%3E%3Ctext x='50%25' y='305' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EDRAFT%3C/text%3E%3C/g%3E%3C/svg%3E");

        --logo-bg: #1a5e9a;
        --logo-active-bg: #c00;
        --logo-text: white;

        --tocnav-normal-text: #999;
        --tocnav-normal-bg: var(--bg);
        --tocnav-hover-text: var(--tocnav-normal-text);
        --tocnav-hover-bg: #080808;
        --tocnav-active-text: #f44;
        --tocnav-active-bg: var(--tocnav-normal-bg);

        --tocsidebar-text: var(--text);
        --tocsidebar-bg: #080808;
        --tocsidebar-shadow: rgba(255,255,255,.1);
        --tocsidebar-heading-text: hsla(203,20%,40%,.7);

        --toclink-text: var(--text);
        --toclink-underline: #6af;
        --toclink-visited-text: var(--toclink-text);
        --toclink-visited-underline: #054572;

        --heading-text: #8af;

        --hr-text: var(--text);

        --algo-border: #456;

        --del-text: #f44;
        --del-bg: transparent;
        --ins-text: #4a4;
        --ins-bg: transparent;

        --a-normal-text: #6af;
        --a-normal-underline: #555;
        --a-visited-text: var(--a-normal-text);
        --a-visited-underline: var(--a-normal-underline);
        --a-hover-bg: rgba(25%, 25%, 25%, .2);
        --a-active-text: #f44;
        --a-active-underline: var(--a-active-text);

        --borderedblock-bg: rgba(255, 255, 255, .05);

        --blockquote-border: silver;
        --blockquote-bg: var(--borderedblock-bg);
        --blockquote-text: currentcolor;

        --issue-border: #e05252;
        --issue-bg: var(--borderedblock-bg);
        --issue-text: var(--text);
        --issueheading-text: hsl(0deg, 70%, 70%);

        --example-border: hsl(50deg, 90%, 60%);
        --example-bg: var(--borderedblock-bg);
        --example-text: var(--text);
        --exampleheading-text: hsl(50deg, 70%, 70%);

        --note-border: hsl(120deg, 100%, 35%);
        --note-bg: var(--borderedblock-bg);
        --note-text: var(--text);
        --noteheading-text: hsl(120, 70%, 70%);
        --notesummary-underline: silver;

        --assertion-border: #444;
        --assertion-bg: var(--borderedblock-bg);
        --assertion-text: var(--text);

        --advisement-border: orange;
        --advisement-bg: #222218;
        --advisement-text: var(--text);
        --advisementheading-text: #f84;

        --warning-border: red;
        --warning-bg: hsla(40,100%,20%,0.95);
        --warning-text: var(--text);

        --amendment-border: #330099;
        --amendment-bg: #080010;
        --amendment-text: var(--text);
        --amendmentheading-text: #cc00ff;

        --def-border: #8ccbf2;
        --def-bg: #080818;
        --def-text: var(--text);
        --defrow-border: #136;

        --datacell-border: silver;

        --indexinfo-text: #aaa;

        --indextable-hover-text: var(--text);
        --indextable-hover-bg: #181818;

        --outdatedspec-bg: rgba(255, 255, 255, .5);
        --outdatedspec-text: black;
        --outdated-bg: maroon;
        --outdated-text: white;
        --outdated-shadow: red;

        --editedrec-bg: darkorange;
    }
    /* In case a transparent-bg image doesn't expect to be on a dark bg,
       which is quite common in practice... */
    img { background: white; }
}
@media (prefers-color-scheme: dark) {
    :root {
        --selflink-text: black;
        --selflink-bg: silver;
        --selflink-hover-text: white;
    }
}

@media (prefers-color-scheme: dark) {
    :root {
        --dfnpanel-bg: #222;
        --dfnpanel-text: var(--text);
    }
}
@media (prefers-color-scheme: dark) {
    .highlight:not(.idl) { background: rgba(255, 255, 255, .05); }

    c-[a] { color: #d33682 } /* Keyword.Declaration */
    c-[b] { color: #d33682 } /* Keyword.Type */
    c-[c] { color: #2aa198 } /* Comment */
    c-[d] { color: #2aa198 } /* Comment.Multiline */
    c-[e] { color: #268bd2 } /* Name.Attribute */
    c-[f] { color: #b58900 } /* Name.Tag */
    c-[g] { color: #cb4b16 } /* Name.Variable */
    c-[k] { color: #d33682 } /* Keyword */
    c-[l] { color: #657b83 } /* Literal */
    c-[m] { color: #657b83 } /* Literal.Number */
    c-[n] { color: #268bd2 } /* Name */
    c-[o] { color: #657b83 } /* Operator */
    c-[p] { color: #657b83 } /* Punctuation */
    c-[s] { color: #6c71c4 } /* Literal.String */
    c-[t] { color: #6c71c4 } /* Literal.String.Single */
    c-[u] { color: #6c71c4 } /* Literal.String.Double */
    c-[ch] { color: #2aa198 } /* Comment.Hashbang */
    c-[cp] { color: #2aa198 } /* Comment.Preproc */
    c-[cpf] { color: #2aa198 } /* Comment.PreprocFile */
    c-[c1] { color: #2aa198 } /* Comment.Single */
    c-[cs] { color: #2aa198 } /* Comment.Special */
    c-[kc] { color: #d33682 } /* Keyword.Constant */
    c-[kn] { color: #d33682 } /* Keyword.Namespace */
    c-[kp] { color: #d33682 } /* Keyword.Pseudo */
    c-[kr] { color: #d33682 } /* Keyword.Reserved */
    c-[ld] { color: #657b83 } /* Literal.Date */
    c-[nc] { color: #268bd2 } /* Name.Class */
    c-[no] { color: #268bd2 } /* Name.Constant */
    c-[nd] { color: #268bd2 } /* Name.Decorator */
    c-[ni] { color: #268bd2 } /* Name.Entity */
    c-[ne] { color: #268bd2 } /* Name.Exception */
    c-[nf] { color: #268bd2 } /* Name.Function */
    c-[nl] { color: #268bd2 } /* Name.Label */
    c-[nn] { color: #268bd2 } /* Name.Namespace */
    c-[py] { color: #268bd2 } /* Name.Property */
    c-[ow] { color: #657b83 } /* Operator.Word */
    c-[mb] { color: #657b83 } /* Literal.Number.Bin */
    c-[mf] { color: #657b83 } /* Literal.Number.Float */
    c-[mh] { color: #657b83 } /* Literal.Number.Hex */
    c-[mi] { color: #657b83 } /* Literal.Number.Integer */
    c-[mo] { color: #657b83 } /* Literal.Number.Oct */
    c-[sa] { color: #6c71c4 } /* Literal.String.Affix */
    c-[sb] { color: #6c71c4 } /* Literal.String.Backtick */
    c-[sc] { color: #6c71c4 } /* Literal.String.Char */
    c-[dl] { color: #6c71c4 } /* Literal.String.Delimiter */
    c-[sd] { color: #6c71c4 } /* Literal.String.Doc */
    c-[se] { color: #6c71c4 } /* Literal.String.Escape */
    c-[sh] { color: #6c71c4 } /* Literal.String.Heredoc */
    c-[si] { color: #6c71c4 } /* Literal.String.Interpol */
    c-[sx] { color: #6c71c4 } /* Literal.String.Other */
    c-[sr] { color: #6c71c4 } /* Literal.String.Regex */
    c-[ss] { color: #6c71c4 } /* Literal.String.Symbol */
    c-[fm] { color: #268bd2 } /* Name.Function.Magic */
    c-[vc] { color: #cb4b16 } /* Name.Variable.Class */
    c-[vg] { color: #cb4b16 } /* Name.Variable.Global */
    c-[vi] { color: #cb4b16 } /* Name.Variable.Instance */
    c-[vm] { color: #cb4b16 } /* Name.Variable.Magic */
    c-[il] { color: #657b83 } /* Literal.Number.Integer.Long */
}
</style>
 <body>
  <header>
   <p data-fill-with="logo"><a class="logo" href="https://www.w3.org/"> <img alt="W3C" height="48" src="https://www.w3.org/StyleSheets/TR/2021/logos/W3C" width="72"> </a> </p>
   <h1 class="no-ref" id="title">requestStorageAccessForOrigin API</h1>
   <h2 class="no-num no-toc no-ref heading settled" id="subtitle"><span class="content">Draft Community Group Report, <time datetime="1970-01-01">1 January 1970</time></span></h2>
   <div data-fill-with="spec-metadata">
    <dl>
     <dt>This version:
     <dd><a class="u-url" href="https://github.com/privacycg/requestStorageAccessForOrigin">https://github.com/privacycg/requestStorageAccessForOrigin</a>
     <dt class="editor">Editors:
     <dd class="editor p-author h-card vcard" data-editor-id="138889"><a class="p-name fn u-email email" href="mailto:mreichhoff@google.com">Matt Reichhoff</a> (<a class="p-org org" href="https://google.com">Google</a>)
     <dd class="editor p-author h-card vcard" data-editor-id="120436"><a class="p-name fn u-email email" href="mailto:johannhof@google.com">Johann Hofmann</a> (<a class="p-org org" href="https://google.com">Google</a>)
    </dl>
   </div>
   <div data-fill-with="warning"></div>
   <p class="copyright" data-fill-with="copyright"><a href="http://www.w3.org/Consortium/Legal/ipr-notice#Copyright">Copyright</a> © 1970 the Contributors to “requestStorageAccessForOrigin API”, published by the <a href="http://www.w3.org/community/privacycg/">Privacy Community Group</a>.

This document is licensed under the <a href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.

Contributions to this document are made under the <a href="https://www.w3.org/community/about/agreements/cla/">W3C Community Contributor License Agreement (CLA)</a>. </p>
   <hr title="Separator for header">
  </header>
  <div data-fill-with="abstract">
   <h2 class="no-num no-toc no-ref heading settled" id="abstract"><span class="content">Abstract</span></h2>
   <p>The requestStorageAccessForOrigin API allows top-level sites to request access to cross-site cookies on behalf of embedded origins.</p>
  </div>
  <h2 class="no-num no-toc no-ref heading settled" id="status"><span class="content">Status of this document</span></h2>
  <div data-fill-with="status">
   <p>This specification is intended to be merged into the HTML Living Standard. It is neither a WHATWG Living Standard nor is it on the standards track at W3C.</p>
   <p>It was published by the <a href="http://www.w3.org/community/privacycg/">Privacy Community Group</a>.
Please note that under the <a href="http://www.w3.org/community/about/agreements/cla/">W3C Community Contributor License Agreement (CLA)</a> there is a limited opt-out and other conditions apply.
Learn more about <a href="http://www.w3.org/community/">W3C Community and Business Groups</a>.</p>
  </div>
  <div data-fill-with="at-risk"></div>
  <nav data-fill-with="table-of-contents" id="toc">
   <h2 class="no-num no-toc no-ref" id="contents">Table of Contents</h2>
   <ol class="toc" role="directory">
    <li><a href="#intro"><span class="secno">1</span> <span class="content">Introduction</span></a>
    <li><a href="#infra"><span class="secno">2</span> <span class="content">Infrastructure</span></a>
    <li>
     <a href="#the-rsa-for-api"><span class="secno">3</span> <span class="content">The requestStorageAccessForOrigin API</span></a>
     <ol class="toc">
      <li><a href="#the-document-object"><span class="secno">3.1</span> <span class="content">Changes to <code class="idl"><span>Document</span></code></span></a>
      <li><a href="#ua-policies"><span class="secno">3.2</span> <span class="content">User Agent top-level storage access policies</span></a>
     </ol>
    <li><a href="#permissions-integration"><span class="secno">4</span> <span class="content">Permissions Integration</span></a>
    <li><a href="#fetch-integration"><span class="secno">5</span> <span class="content">Fetch Integration</span></a>
    <li><a href="#storage-access-api-integration"><span class="secno">6</span> <span class="content">Storage Access API Integration</span></a>
    <li><a href="#privacy"><span class="secno">7</span> <span class="content">Privacy considerations</span></a>
    <li>
     <a href="#security"><span class="secno">8</span> <span class="content">Security considerations</span></a>
     <ol class="toc">
      <li><a href="#subresources"><span class="secno">8.1</span> <span class="content">Subresource Requests</span></a>
      <li><a href="#notification-abuse"><span class="secno">8.2</span> <span class="content">Notification Abuse</span></a>
     </ol>
    <li>
     <a href="#w3c-conformance"><span class="secno"></span> <span class="content">Conformance</span></a>
     <ol class="toc">
      <li><a href="#w3c-conventions"><span class="secno"></span> <span class="content">Document conventions</span></a>
      <li><a href="#w3c-conformant-algorithms"><span class="secno"></span> <span class="content">Conformant Algorithms</span></a>
     </ol>
    <li>
     <a href="#index"><span class="secno"></span> <span class="content">Index</span></a>
     <ol class="toc">
      <li><a href="#index-defined-here"><span class="secno"></span> <span class="content">Terms defined by this specification</span></a>
      <li><a href="#index-defined-elsewhere"><span class="secno"></span> <span class="content">Terms defined by reference</span></a>
     </ol>
    <li>
     <a href="#references"><span class="secno"></span> <span class="content">References</span></a>
     <ol class="toc">
      <li><a href="#normative"><span class="secno"></span> <span class="content">Normative References</span></a>
     </ol>
    <li><a href="#idl-index"><span class="secno"></span> <span class="content">IDL Index</span></a>
    <li><a href="#issues-index"><span class="secno"></span> <span class="content">Issues Index</span></a>
   </ol>
  </nav>
  <main>
   <section class="non-normative">
    <h2 class="heading settled" data-level="1" id="intro"><span class="secno">1. </span><span class="content">Introduction</span><a class="self-link" href="#intro"></a></h2>
    <p><em>This section is non-normative.</em></p>
    <p>Many User Agents prevent content from accessing non-<a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-site-same-site" id="ref-for-concept-site-same-site">same site</a> data stored in cookies.
This can break embedded content which relies on having access to non-<a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-site-same-site" id="ref-for-concept-site-same-site①">same site</a> cookies.</p>
    <p>The requestStorageAccessForOrigin API enables developers to request access to non-<a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-site-same-site" id="ref-for-concept-site-same-site②">same site</a> cookies for embedded resources such as iframes, scripts, or images.
It accomplishes this by specifying <code class="idl"><a data-link-type="idl" href="#dom-document-requeststorageaccessfororigin" id="ref-for-dom-document-requeststorageaccessfororigin">requestStorageAccessForOrigin(origin)</a></code>, which allows <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#traversable-navigable" id="ref-for-traversable-navigable">traversable navigable</a>s to request access
to unpartitioned cookies on behalf of another <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin" id="ref-for-concept-origin">origin</a>.</p>
   </section>
   <h2 class="heading settled" data-level="2" id="infra"><span class="secno">2. </span><span class="content">Infrastructure</span><a class="self-link" href="#infra"></a></h2>
   <p>This specification depends on the Infra standard. <a data-link-type="biblio" href="#biblio-infra" title="Infra Standard">[INFRA]</a></p>
   <h2 class="heading settled" data-level="3" id="the-rsa-for-api"><span class="secno">3. </span><span class="content">The requestStorageAccessForOrigin API</span><a class="self-link" href="#the-rsa-for-api"></a></h2>
   <p>This specification defines a method that can be used to request access to <a data-link-type="dfn" href="#unpartitioned-data" id="ref-for-unpartitioned-data">unpartitioned data</a> on behalf of another <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin" id="ref-for-concept-origin①">origin</a> (<code class="idl"><a data-link-type="idl" href="#dom-document-requeststorageaccessfororigin" id="ref-for-dom-document-requeststorageaccessfororigin①">requestStorageAccessForOrigin(origin)</a></code>).</p>
   <div class="example" id="example-3dae0f9a">
    <a class="self-link" href="#example-3dae0f9a"></a> 
    <p>Alex visits <code>https://social.example/</code>. The page sets a cookie. This cookie has been set in a <a data-link-type="dfn" href="#first-party-site-context" id="ref-for-first-party-site-context">first-party-site context</a>.</p>
    <p>Later on, Alex visits <code>https://video.example/</code>, which has an <code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/embedded-content.html#the-img-element" id="ref-for-the-img-element">img</a></code> in it which loads <code>https://social.example/profile-image</code>. In this case, the <code>social.example</code> <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#document" id="ref-for-document">Document</a></code> <var>doc</var> is in a <a data-link-type="dfn" href="#third-party-context" id="ref-for-third-party-context">third party context</a>, and the cookie set previously might or might not be visible from <var>doc</var><code>.</code><code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/dom.html#dom-document-cookie" id="ref-for-dom-document-cookie">cookie</a></code>, depending on User Agent storage access policies.</p>
    <p>A script on <code>https://video.example/</code> could request access on behalf of <code>https://social.example</code> by calling <var>doc</var><code>.</code><code class="idl"><a data-link-type="idl" href="#dom-document-requeststorageaccessfororigin" id="ref-for-dom-document-requeststorageaccessfororigin②">requestStorageAccessForOrigin(origin)</a></code> with <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-USVString" id="ref-for-idl-USVString">USVString</a></code> <var>origin</var> as <code>https://social.example</code>.</p>
    <p class="note" role="note"><span class="marker">Note:</span> the circumstances for use of the access have to be limited to those cases where the requested origin opts into sharing. More information is available in <a href="#privacy">§ 7 Privacy considerations</a> and <a href="#security">§ 8 Security considerations</a>.</p>
   </div>
   <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="unpartitioned-data">Unpartitioned data</dfn> is client-side storage that would be available to a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#site" id="ref-for-site">site</a> were it loaded in a <a data-link-type="dfn" href="#first-party-site-context" id="ref-for-first-party-site-context①">first-party-site context</a>.</p>
   <p>A <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#document" id="ref-for-document①">Document</a></code> is in a <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="first-party-site-context">first-party-site context</dfn> if it is the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#nav-document" id="ref-for-nav-document">active document</a> of a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#traversable-navigable" id="ref-for-traversable-navigable①">traversable navigable</a>. Otherwise, it is in a <a data-link-type="dfn" href="#first-party-site-context" id="ref-for-first-party-site-context②">first-party-site context</a> if it is an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#nav-document" id="ref-for-nav-document①">active document</a> and the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin" id="ref-for-concept-settings-object-origin">origin</a> and <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-top-level-origin" id="ref-for-concept-environment-top-level-origin">top-level origin</a> of its <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object" id="ref-for-relevant-settings-object">relevant settings object</a> are <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-site-same-site" id="ref-for-concept-site-same-site③">same site</a> with one another.</p>
   <p>A <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#document" id="ref-for-document②">Document</a></code> is in a <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="third-party-context">third party context</dfn> if it is not in a <a data-link-type="dfn" href="#first-party-site-context" id="ref-for-first-party-site-context③">first-party-site context</a>.</p>
   <h3 class="heading settled" data-level="3.1" id="the-document-object"><span class="secno">3.1. </span><span class="content">Changes to <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#document" id="ref-for-document③">Document</a></code></span><a class="self-link" href="#the-document-object"></a></h3>
<pre class="idl highlight def"><c- b>partial</c-> <c- b>interface</c-> <a class="idl-code" data-link-type="interface" href="https://dom.spec.whatwg.org/#document" id="ref-for-document④"><c- g>Document</c-></a> {
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise" id="ref-for-idl-promise"><c- b>Promise</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-undefined" id="ref-for-idl-undefined"><c- b>undefined</c-></a>> <dfn class="dfn-paneled idl-code" data-dfn-for="Document" data-dfn-type="method" data-export data-lt="requestStorageAccessForOrigin(origin)" id="dom-document-requeststorageaccessfororigin"><code><c- g>requestStorageAccessForOrigin</c-></code></dfn>(<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-USVString" id="ref-for-idl-USVString①"><c- b>USVString</c-></a> <dfn class="idl-code" data-dfn-for="Document/requestStorageAccessForOrigin(origin)" data-dfn-type="argument" data-export id="dom-document-requeststorageaccessfororigin-origin-origin"><code><c- g>origin</c-></code><a class="self-link" href="#dom-document-requeststorageaccessfororigin-origin-origin"></a></dfn>);
};
</pre>
   <div class="algorithm" data-algorithm="requestStorageAccessForOrigin(requestedOrigin)" data-algorithm-for="Document">
     When invoked on <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#document" id="ref-for-document⑤">Document</a></code> <var>doc</var> with <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-USVString" id="ref-for-idl-USVString②">USVString</a></code> <var>requestedOrigin</var>, the <dfn class="idl-code" data-dfn-for="Document" data-dfn-type="method" data-export id="dom-document-requeststorageaccessfororigin-requestedorigin"><code>requestStorageAccessForOrigin(requestedOrigin)</code><a class="self-link" href="#dom-document-requeststorageaccessfororigin-requestedorigin"></a></dfn> method must run these steps: 
    <ol>
     <li data-md>
      <p>Let <var>p</var> be <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#a-new-promise" id="ref-for-a-new-promise">a new promise</a>.</p>
     <li data-md>
      <p>If <var>doc</var> is not <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#fully-active" id="ref-for-fully-active">fully active</a>, then <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#reject" id="ref-for-reject">reject</a> <var>p</var> with an "<code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#invalidstateerror" id="ref-for-invalidstateerror">InvalidStateError</a></code>" <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException">DOMException</a></code> and return <var>p</var>.</p>
     <li data-md>
      <p>If <var>doc</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#node-navigable" id="ref-for-node-navigable">node navigable</a> is not a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#traversable-navigable" id="ref-for-traversable-navigable②">traversable navigable</a>, <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#reject" id="ref-for-reject①">reject</a> <var>p</var> with an "<code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#invalidstateerror" id="ref-for-invalidstateerror①">InvalidStateError</a></code>" <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException①">DOMException</a></code> and return <var>p</var>.</p>
     <li data-md>
      <p>If <var>doc</var>’s <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-document-origin" id="ref-for-concept-document-origin">origin</a> is an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-opaque" id="ref-for-concept-origin-opaque">opaque origin</a>, <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#reject" id="ref-for-reject②">reject</a> <var>p</var> with an "<code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#invalidstateerror" id="ref-for-invalidstateerror②">InvalidStateError</a></code>" <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException②">DOMException</a></code> and return <var>p</var>.</p>
     <li data-md>
      <p>If <var>doc</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global" id="ref-for-concept-relevant-global">relevant global object</a> is not a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#secure-context" id="ref-for-secure-context">secure context</a>, then <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#reject" id="ref-for-reject③">reject</a> <var>p</var> with a "<code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#notallowederror" id="ref-for-notallowederror">NotAllowedError</a></code>" <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException③">DOMException</a></code> and return <var>p</var>.</p>
     <li data-md>
      <p>Let <var>parsedURL</var> be the the result of running the <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-parser" id="ref-for-concept-url-parser">URL parser</a> on <var>requestedOrigin</var>.</p>
     <li data-md>
      <p>If <var>parsedURL</var> is failure, <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#reject" id="ref-for-reject④">reject</a> <var>p</var> with a "<code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#exceptiondef-typeerror" id="ref-for-exceptiondef-typeerror">TypeError</a></code>" <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException④">DOMException</a></code> and return <var>p</var>.</p>
     <li data-md>
      <p>Let <var>origin</var> be <var>parsedURL</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin" id="ref-for-concept-origin②">origin</a>.</p>
     <li data-md>
      <p>If <var>origin</var> is an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-opaque" id="ref-for-concept-origin-opaque①">opaque origin</a>, <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#reject" id="ref-for-reject⑤">reject</a> <var>p</var> with an "<code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#invalidstateerror" id="ref-for-invalidstateerror③">InvalidStateError</a></code>" <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException⑤">DOMException</a></code> and return <var>p</var>.</p>
     <li data-md>
      <p>If <var>doc</var>’s <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-document-origin" id="ref-for-concept-document-origin①">origin</a> is <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#same-origin" id="ref-for-same-origin">same origin</a> with <var>origin</var>, <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#resolve" id="ref-for-resolve">resolve</a> and return <var>p</var>.</p>
     <li data-md>
      <p>Let <var>descriptor</var> be a newly created <code class="idl"><a data-link-type="idl" href="#dictdef-toplevelstorageaccesspermissiondescriptor" id="ref-for-dictdef-toplevelstorageaccesspermissiondescriptor">TopLevelStorageAccessPermissionDescriptor</a></code> with <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/permissions/#dom-permissiondescriptor-name" id="ref-for-dom-permissiondescriptor-name">name</a></code> set to "<a class="idl-code" data-link-type="permission" href="#permissiondef-top-level-storage-access" id="ref-for-permissiondef-top-level-storage-access"><code>top-level-storage-access</code></a>" and with <code class="idl"><a data-link-type="idl" href="#dom-toplevelstorageaccesspermissiondescriptor-requestedorigin" id="ref-for-dom-toplevelstorageaccesspermissiondescriptor-requestedorigin">requestedOrigin</a></code> set to <var>origin</var>.</p>
     <li data-md>
      <p>Let <var>has activation</var> be true if <var>doc</var>’s <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#window" id="ref-for-window">Window</a></code> object has <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/interaction.html#transient-activation" id="ref-for-transient-activation">transient activation</a>, and false otherwise.</p>
     <li data-md>
      <p>Run these steps <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel" id="ref-for-in-parallel">in parallel</a>:</p>
      <ol>
       <li data-md>
        <p>Let <var>top-level site</var> be the result of <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#obtain-a-site" id="ref-for-obtain-a-site">obtaining a site</a> from <var>doc</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object" id="ref-for-relevant-settings-object①">relevant settings object</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin" id="ref-for-concept-settings-object-origin①">origin</a>.</p>
       <li data-md>
        <p><a data-link-type="dfn" href="#determine-the-top-level-storage-access-policy" id="ref-for-determine-the-top-level-storage-access-policy">Determine the top-level storage access policy</a> with <var>descriptor</var>, <var>doc</var>, <var>top-level site</var>, <var>has activation</var>, and <var>p</var>.</p>
      </ol>
     <li data-md>
      <p>Return <var>p</var>.</p>
    </ol>
   </div>
   <h3 class="heading settled" data-level="3.2" id="ua-policies"><span class="secno">3.2. </span><span class="content">User Agent top-level storage access policies</span><a class="self-link" href="#ua-policies"></a></h3>
   <div class="algorithm" data-algorithm="determine if a request has top-level storage access">
     To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="determine-if-a-request-has-top-level-storage-access">determine if a request has top-level storage access</dfn> with <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request" id="ref-for-concept-request">request</a> <var>request</var>, run these steps: 
    <ol>
     <li data-md>
      <p>Let <var>settings</var> be <var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-client" id="ref-for-concept-request-client">client</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global" id="ref-for-concept-relevant-global①">relevant global object</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object" id="ref-for-relevant-settings-object②">relevant settings object</a>.</p>
     <li data-md>
      <p>Let <var>embedded origin</var> be <var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-url" id="ref-for-concept-request-url">url</a>'s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-origin" id="ref-for-concept-url-origin">origin</a>.</p>
     <li data-md>
      <p>Let <var>descriptor</var> be a newly created <code class="idl"><a data-link-type="idl" href="#dictdef-toplevelstorageaccesspermissiondescriptor" id="ref-for-dictdef-toplevelstorageaccesspermissiondescriptor①">TopLevelStorageAccessPermissionDescriptor</a></code> with <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/permissions/#dom-permissiondescriptor-name" id="ref-for-dom-permissiondescriptor-name①">name</a></code> set to "<a class="idl-code" data-link-type="permission" href="#permissiondef-top-level-storage-access" id="ref-for-permissiondef-top-level-storage-access①"><code>top-level-storage-access</code></a>" and with <code class="idl"><a data-link-type="idl" href="#dom-toplevelstorageaccesspermissiondescriptor-requestedorigin" id="ref-for-dom-toplevelstorageaccesspermissiondescriptor-requestedorigin①">requestedOrigin</a></code> set to <var>embedded origin</var>.</p>
     <li data-md>
      <p>Let <var>existing state</var> be <var>descriptor</var>’s <a data-link-type="dfn" href="https://w3c.github.io/permissions/#dfn-permission-state" id="ref-for-dfn-permission-state">permission state</a> with <var>settings</var>.</p>
     <li data-md>
      <p>If <var>existing state</var> is <a data-link-type="dfn" href="https://w3c.github.io/permissions/#dfn-granted" id="ref-for-dfn-granted">granted</a>, return true.</p>
     <li data-md>
      <p>Return false.</p>
    </ol>
   </div>
   <p class="issue" id="issue-9521f17b"><a class="self-link" href="#issue-9521f17b"></a> The permissions task source shouldn’t be used directly. <a href="https://github.com/privacycg/requestStorageAccessForOrigin/issues/15">[Issue #privacycg/requestStorageAccessForOrigin#15]</a></p>
   <div class="algorithm" data-algorithm="determine the top-level storage access policy">
     To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="determine-the-top-level-storage-access-policy">determine the top-level storage access policy</dfn> for <code class="idl"><a data-link-type="idl" href="#dictdef-toplevelstorageaccesspermissiondescriptor" id="ref-for-dictdef-toplevelstorageaccesspermissiondescriptor②">TopLevelStorageAccessPermissionDescriptor</a></code> <var>descriptor</var>, with <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#document" id="ref-for-document⑥">Document</a></code> <var>doc</var>, <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#site" id="ref-for-site①">site</a> <var>top-level site</var>, <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#boolean" id="ref-for-boolean">boolean</a> <var>has activation</var>, and <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-promise" id="ref-for-idl-promise①">Promise</a></code> <var>p</var>, run these steps: 
    <ol>
     <li data-md>
      <p>Let <var>settings</var> be <var>doc</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object" id="ref-for-relevant-settings-object③">relevant settings object</a>.</p>
     <li data-md>
      <p>Let <var>global</var> be <var>doc</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global" id="ref-for-concept-relevant-global②">relevant global object</a>.</p>
     <li data-md>
      <p>Let <var>existing state</var> be <var>descriptor</var>’s <a data-link-type="dfn" href="https://w3c.github.io/permissions/#dfn-permission-state" id="ref-for-dfn-permission-state①">permission state</a> with <var>settings</var>.</p>
     <li data-md>
      <p>If <var>existing state</var> is <a data-link-type="dfn" href="https://w3c.github.io/permissions/#dfn-granted" id="ref-for-dfn-granted①">granted</a>:</p>
      <ol>
       <li data-md>
        <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task" id="ref-for-queue-a-global-task">Queue a global task</a> on the <a data-link-type="dfn" href="https://w3c.github.io/permissions/#permissions-task-source" id="ref-for-permissions-task-source">permissions task source</a> given <var>global</var> to <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#resolve" id="ref-for-resolve①">resolve</a> <var>p</var>.</p>
       <li data-md>
        <p>Return.</p>
      </ol>
     <li data-md>
      <p>If <var>existing state</var> is <a data-link-type="dfn" href="https://w3c.github.io/permissions/#dfn-denied" id="ref-for-dfn-denied">denied</a>:</p>
      <ol>
       <li data-md>
        <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task" id="ref-for-queue-a-global-task①">Queue a global task</a> on the <a data-link-type="dfn" href="https://w3c.github.io/permissions/#permissions-task-source" id="ref-for-permissions-task-source①">permissions task source</a> given <var>global</var> to <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#reject" id="ref-for-reject⑥">reject</a> <var>p</var> with a "<code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#notallowederror" id="ref-for-notallowederror①">NotAllowedError</a></code>" <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException⑥">DOMException</a></code>.</p>
       <li data-md>
        <p>Return.</p>
      </ol>
     <li data-md>
      <p>Assert that <var>doc</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#node-navigable" id="ref-for-node-navigable①">node navigable</a> is a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#traversable-navigable" id="ref-for-traversable-navigable③">traversable navigable</a>.</p>
     <li data-md>
      <p>If <var>has activation</var> is false:</p>
      <ol>
       <li data-md>
        <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task" id="ref-for-queue-a-global-task②">Queue a global task</a> on the <a data-link-type="dfn" href="https://w3c.github.io/permissions/#permissions-task-source" id="ref-for-permissions-task-source②">permissions task source</a> given <var>global</var> to <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#reject" id="ref-for-reject⑦">reject</a> <var>p</var> with a n "<code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#invalidstateerror" id="ref-for-invalidstateerror④">InvalidStateError</a></code>" <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException⑦">DOMException</a></code>.</p>
       <li data-md>
        <p>Return.</p>
      </ol>
     <li data-md>
      <p>Let <var>implicitly granted</var> and <var>implicitly denied</var> (each a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#boolean" id="ref-for-boolean①">boolean</a>) be the result of running an <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#implementation-defined" id="ref-for-implementation-defined">implementation-defined</a> set of steps to determine if <var>top-level site</var>’s request for <var>descriptor</var>’s <code class="idl"><a data-link-type="idl" href="#dom-toplevelstorageaccesspermissiondescriptor-requestedorigin" id="ref-for-dom-toplevelstorageaccesspermissiondescriptor-requestedorigin②">requestedOrigin</a></code> should be granted or denied without prompting the user.</p>
     <li data-md>
      <p>If <var>implicitly granted</var> is true:</p>
      <ol>
       <li data-md>
        <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task" id="ref-for-queue-a-global-task③">Queue a global task</a> on the <a data-link-type="dfn" href="https://w3c.github.io/permissions/#permissions-task-source" id="ref-for-permissions-task-source③">permissions task source</a> given <var>global</var> to <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#resolve" id="ref-for-resolve②">resolve</a> <var>p</var>.</p>
       <li data-md>
        <p>Return.</p>
      </ol>
     <li data-md>
      <p>If <var>implicitly denied</var> is true:</p>
      <ol>
       <li data-md>
        <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task" id="ref-for-queue-a-global-task④">Queue a global task</a> on the <a data-link-type="dfn" href="https://w3c.github.io/permissions/#permissions-task-source" id="ref-for-permissions-task-source④">permissions task source</a> given <var>global</var> to <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#reject" id="ref-for-reject⑧">reject</a> <var>p</var> with a "<code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#notallowederror" id="ref-for-notallowederror②">NotAllowedError</a></code>" <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException⑧">DOMException</a></code>.</p>
       <li data-md>
        <p>Return.</p>
      </ol>
     <li data-md>
      <p>Let <var>permissionState</var> be the result of <a data-link-type="dfn" href="https://w3c.github.io/permissions/#dfn-request-permission-to-use" id="ref-for-dfn-request-permission-to-use">requesting permission to use</a> "<a class="idl-code" data-link-type="permission" href="#permissiondef-top-level-storage-access" id="ref-for-permissiondef-top-level-storage-access②"><code>top-level-storage-access</code></a>" with <var>descriptor</var>.</p>
     <li data-md>
      <p>If <var>permissionState</var> is <a data-link-type="dfn" href="https://w3c.github.io/permissions/#dfn-granted" id="ref-for-dfn-granted②">granted</a>:</p>
      <ol>
       <li data-md>
        <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task" id="ref-for-queue-a-global-task⑤">Queue a global task</a> on the <a data-link-type="dfn" href="https://w3c.github.io/permissions/#permissions-task-source" id="ref-for-permissions-task-source⑤">permissions task source</a> given <var>global</var> to <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#resolve" id="ref-for-resolve③">resolve</a> <var>p</var>.</p>
       <li data-md>
        <p>Return.</p>
      </ol>
     <li data-md>
      <p>If <var>doc</var>’s <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#window" id="ref-for-window①">Window</a></code> object has <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/interaction.html#transient-activation" id="ref-for-transient-activation①">transient activation</a>, <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/interaction.html#consume-user-activation" id="ref-for-consume-user-activation">consume user activation</a> with it.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task" id="ref-for-queue-a-global-task⑥">Queue a global task</a> on the <a data-link-type="dfn" href="https://w3c.github.io/permissions/#permissions-task-source" id="ref-for-permissions-task-source⑥">permissions task source</a> given <var>global</var> to <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#reject" id="ref-for-reject⑨">reject</a> <var>p</var> with a "<code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#notallowederror" id="ref-for-notallowederror③">NotAllowedError</a></code>" <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException⑨">DOMException</a></code>.</p>
    </ol>
   </div>
   <h2 class="heading settled" data-level="4" id="permissions-integration"><span class="secno">4. </span><span class="content">Permissions Integration</span><a class="self-link" href="#permissions-integration"></a></h2>
   <p>The requestStorageAccessForOrigin API defines a <a data-link-type="dfn" href="https://w3c.github.io/permissions/#dfn-powerful-feature" id="ref-for-dfn-powerful-feature">powerful feature</a> identified by the <a data-link-type="dfn" href="https://w3c.github.io/permissions/#dfn-name" id="ref-for-dfn-name">name</a> "<dfn class="dfn-paneled idl-code" data-dfn-type="permission" data-export id="permissiondef-top-level-storage-access"><code>top-level-storage-access</code></dfn>". It defines the following permission-related algorithms:</p>
   <dl>
    <dt><code class="idl"><a data-link-type="idl" href="https://w3c.github.io/permissions/#dom-permissiondescriptor" id="ref-for-dom-permissiondescriptor">PermissionDescriptor</a></code>
    <dd>
      The "<a class="idl-code" data-link-type="permission" href="#permissiondef-top-level-storage-access" id="ref-for-permissiondef-top-level-storage-access③"><code>top-level-storage-access</code></a>" <a data-link-type="dfn" href="https://w3c.github.io/permissions/#dfn-powerful-feature" id="ref-for-dfn-powerful-feature①">powerful feature</a> defines a <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/permissions/#dom-permissiondescriptor" id="ref-for-dom-permissiondescriptor①">PermissionDescriptor</a></code> as follows: 
<pre class="idl highlight def"><c- b>dictionary</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="dictionary" data-export id="dictdef-toplevelstorageaccesspermissiondescriptor"><code><c- g>TopLevelStorageAccessPermissionDescriptor</c-></code></dfn> : <a data-link-type="idl-name" href="https://w3c.github.io/permissions/#dom-permissiondescriptor" id="ref-for-dom-permissiondescriptor②"><c- n>PermissionDescriptor</c-></a> {
    <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-USVString" id="ref-for-idl-USVString③"><c- b>USVString</c-></a> <dfn class="dfn-paneled idl-code" data-default="&quot;&quot;" data-dfn-for="TopLevelStorageAccessPermissionDescriptor" data-dfn-type="dict-member" data-export data-type="USVString " id="dom-toplevelstorageaccesspermissiondescriptor-requestedorigin"><code><c- g>requestedOrigin</c-></code></dfn> = "";
};
</pre>
    <dt><a data-link-type="dfn" href="https://w3c.github.io/permissions/#dfn-permission-query-algorithm" id="ref-for-dfn-permission-query-algorithm">permission query algorithm</a>
    <dd>
     <div class="algorithm" data-algorithm="top-level-storage-access-query">
       To query the "<a class="idl-code" data-link-type="permission" href="#permissiondef-top-level-storage-access" id="ref-for-permissiondef-top-level-storage-access④"><code>top-level-storage-access</code></a>" permission, given a <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/permissions/#dom-permissiondescriptor" id="ref-for-dom-permissiondescriptor③">PermissionDescriptor</a></code> <var>permissionDesc</var> and a <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/permissions/#dom-permissionstatus" id="ref-for-dom-permissionstatus">PermissionStatus</a></code> <var>status</var>, run the following steps: 
      <ol>
       <li data-md>
        <p>Set <var>status</var>’s <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/permissions/#dom-permissionstatus-state" id="ref-for-dom-permissionstatus-state">state</a></code> to <var>permissionDesc</var>’s <a data-link-type="dfn" href="https://w3c.github.io/permissions/#dfn-permission-state" id="ref-for-dfn-permission-state②">permission state</a>.</p>
       <li data-md>
        <p>If <var>status</var>’s <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/permissions/#dom-permissionstatus-state" id="ref-for-dom-permissionstatus-state①">state</a></code> is <a data-link-type="dfn" href="https://w3c.github.io/permissions/#dfn-denied" id="ref-for-dfn-denied①">denied</a>, set <var>status</var>’s <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/permissions/#dom-permissionstatus-state" id="ref-for-dom-permissionstatus-state②">state</a></code> to <a data-link-type="dfn" href="https://w3c.github.io/permissions/#dfn-prompt" id="ref-for-dfn-prompt">prompt</a>.</p>
        <p class="note" role="note"><span class="marker">Note:</span> The <a data-link-type="dfn" href="https://w3c.github.io/permissions/#dfn-denied" id="ref-for-dfn-denied②">denied</a> permission state is not revealed to avoid exposing the user’s decision to developers. This is done to prevent retaliation against the user and repeated prompting to the detriment of the user experience.</p>
      </ol>
     </div>
    <dt><a data-link-type="dfn" href="https://w3c.github.io/permissions/#dfn-permission-key-type" id="ref-for-dfn-permission-key-type">permission key type</a>
    <dd> A <a data-link-type="dfn" href="https://w3c.github.io/permissions/#dfn-permission-key" id="ref-for-dfn-permission-key">permission key</a> of the "<a class="idl-code" data-link-type="permission" href="#permissiondef-top-level-storage-access" id="ref-for-permissiondef-top-level-storage-access⑤"><code>top-level-storage-access</code></a>" feature has the type <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#site" id="ref-for-site②">site</a>. 
    <dt><a data-link-type="dfn" href="https://w3c.github.io/permissions/#dfn-permission-key-generation-algorithm" id="ref-for-dfn-permission-key-generation-algorithm">permission key generation algorithm</a>
    <dd>
     <div class="algorithm" data-algorithm="top-level-storage-access-key-generation">
       To generate a new <a data-link-type="dfn" href="https://w3c.github.io/permissions/#dfn-permission-key" id="ref-for-dfn-permission-key①">permission key</a> for the "<a class="idl-code" data-link-type="permission" href="#permissiondef-top-level-storage-access" id="ref-for-permissiondef-top-level-storage-access⑥"><code>top-level-storage-access</code></a>" feature, given an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object" id="ref-for-environment-settings-object">environment settings object</a> <var>settings</var>, run the following steps: 
      <ol>
       <li data-md>
        <p>Return the result of <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#obtain-a-site" id="ref-for-obtain-a-site①">obtaining a site</a> from <var>settings</var>’ <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-top-level-origin" id="ref-for-concept-environment-top-level-origin①">top-level origin</a>.</p>
      </ol>
     </div>
   </dl>
   <h2 class="heading settled" data-level="5" id="fetch-integration"><span class="secno">5. </span><span class="content">Fetch Integration</span><a class="self-link" href="#fetch-integration"></a></h2>
   <p>The <code class="idl"><a data-link-type="idl" href="#dom-document-requeststorageaccessfororigin" id="ref-for-dom-document-requeststorageaccessfororigin③">requestStorageAccessForOrigin(origin)</a></code> only directly affects cookie behavior on subresource requests made from top-level documents to the requested <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin" id="ref-for-concept-origin③">origin</a>.</p>
   <div class="algorithm" data-algorithm="cookie-blocking-modification">
     In <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#http-network-or-cache-fetch" id="ref-for-http-network-or-cache-fetch">http network or cache fetch</a>, when determining whether to block cookies, run the following algorithm. A true result means cookies can be unblocked: 
    <ol>
     <li data-md>
      <p>Let <var>has top-level access</var> be the result of running <a data-link-type="dfn" href="#determine-if-a-request-has-top-level-storage-access" id="ref-for-determine-if-a-request-has-top-level-storage-access">determine if a request has top-level storage access</a> on <var>request</var>.</p>
     <li data-md>
      <p>If <var>has top-level access</var> is false, return false.</p>
     <li data-md>
      <p>Let <var>is subresource</var> be true if <var>request</var> is a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#subresource-request" id="ref-for-subresource-request">subresource request</a> and false otherwise.</p>
     <li data-md>
      <p>Let <var>allowed subresource mode</var> be true if <var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-mode" id="ref-for-concept-request-mode">mode</a> is "cors" and <var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-credentials-mode" id="ref-for-concept-request-credentials-mode">credentials mode</a> is "include", and false otherwise.</p>
     <li data-md>
      <p>If <var>is subresource</var> is true and <var>allowed subresource mode</var> is false, return false.</p>
     <li data-md>
      <p>If <var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-client" id="ref-for-concept-request-client①">client</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global" id="ref-for-concept-relevant-global③">relevant global object</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window" id="ref-for-concept-document-window">associated document</a> is not a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#traversable-navigable" id="ref-for-traversable-navigable④">traversable navigable</a>, return false.</p>
     <li data-md>
      <p>Return true.</p>
    </ol>
   </div>
   <h2 class="heading settled" data-level="6" id="storage-access-api-integration"><span class="secno">6. </span><span class="content">Storage Access API Integration</span><a class="self-link" href="#storage-access-api-integration"></a></h2>
   <p class="note" role="note"><span class="marker">Note:</span> even after a successful <code class="idl"><a data-link-type="idl" href="#dom-document-requeststorageaccessfororigin" id="ref-for-dom-document-requeststorageaccessfororigin④">requestStorageAccessForOrigin(origin)</a></code> call, frames have to explicitly invoke <a data-link-type="dfn" href="https://privacycg.github.io/storage-access/#dom-document-requeststorageaccess" id="ref-for-dom-document-requeststorageaccess">requestStorageAccess</a> for cookie access.
This modification allows <code class="idl"><a data-link-type="idl" href="#dom-document-requeststorageaccessfororigin" id="ref-for-dom-document-requeststorageaccessfororigin⑤">requestStorageAccessForOrigin(origin)</a></code> to allow resolution of <a data-link-type="dfn" href="https://privacycg.github.io/storage-access/#dom-document-requeststorageaccess" id="ref-for-dom-document-requeststorageaccess①">requestStorageAccess</a> calls similarly to a prior successful <a data-link-type="dfn" href="https://privacycg.github.io/storage-access/#dom-document-requeststorageaccess" id="ref-for-dom-document-requeststorageaccess②">requestStorageAccess</a> grant.</p>
   <p class="issue" id="issue-0f252753"><a class="self-link" href="#issue-0f252753"></a> This algorithm may need adjustments based on outcome of https://github.com/privacycg/storage-access/pull/141</p>
   <div class="algorithm" data-algorithm="storage-access-policy-modification">
     Modify the <a data-link-type="dfn" href="https://privacycg.github.io/storage-access/#determine-the-storage-access-policy" id="ref-for-determine-the-storage-access-policy">determine the storage access policy</a> algorithm by prepending the following steps: 
    <ol>
     <li data-md>
      <p>Let <var>settings</var> be <var>doc</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object" id="ref-for-relevant-settings-object④">relevant settings object</a>.</p>
     <li data-md>
      <p>Let <var>origin</var> be <var>settings</var>’ <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin" id="ref-for-concept-settings-object-origin②">origin</a>.</p>
     <li data-md>
      <p>Let <var>descriptor</var> be a newly created <code class="idl"><a data-link-type="idl" href="#dictdef-toplevelstorageaccesspermissiondescriptor" id="ref-for-dictdef-toplevelstorageaccesspermissiondescriptor③">TopLevelStorageAccessPermissionDescriptor</a></code> with <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/permissions/#dom-permissiondescriptor-name" id="ref-for-dom-permissiondescriptor-name②">name</a></code> set to "<a class="idl-code" data-link-type="permission" href="#permissiondef-top-level-storage-access" id="ref-for-permissiondef-top-level-storage-access⑦"><code>top-level-storage-access</code></a>" and with <code class="idl"><a data-link-type="idl" href="#dom-toplevelstorageaccesspermissiondescriptor-requestedorigin" id="ref-for-dom-toplevelstorageaccesspermissiondescriptor-requestedorigin③">requestedOrigin</a></code> set to <var>origin</var>.</p>
     <li data-md>
      <p>If <var>descriptor</var>’s <a data-link-type="dfn" href="https://w3c.github.io/permissions/#dfn-permission-state" id="ref-for-dfn-permission-state③">permission state</a> is <a data-link-type="dfn" href="https://w3c.github.io/permissions/#dfn-granted" id="ref-for-dfn-granted③">granted</a>, <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task" id="ref-for-queue-a-global-task⑦">queue a global task</a> on the <a data-link-type="dfn" href="https://w3c.github.io/permissions/#permissions-task-source" id="ref-for-permissions-task-source⑦">permissions task source</a> given <var>global</var> to <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#resolve" id="ref-for-resolve④">resolve</a> <var>p</var>, and return.</p>
     <li data-md>
      <p>If <var>descriptor</var>’s <a data-link-type="dfn" href="https://w3c.github.io/permissions/#dfn-permission-state" id="ref-for-dfn-permission-state④">permission state</a> is <a data-link-type="dfn" href="https://w3c.github.io/permissions/#dfn-denied" id="ref-for-dfn-denied③">denied</a>, <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task" id="ref-for-queue-a-global-task⑧">queue a global task</a> on the <a data-link-type="dfn" href="https://w3c.github.io/permissions/#permissions-task-source" id="ref-for-permissions-task-source⑧">permissions task source</a> given <var>global</var> to <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#reject" id="ref-for-reject①⓪">reject</a> <var>p</var> with a "<code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#notallowederror" id="ref-for-notallowederror④">NotAllowedError</a></code>" <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException①⓪">DOMException</a></code>, and return.</p>
    </ol>
   </div>
   <h2 class="heading settled" data-level="7" id="privacy"><span class="secno">7. </span><span class="content">Privacy considerations</span><a class="self-link" href="#privacy"></a></h2>
   <p>Like the <a data-link-type="biblio" href="#biblio-storage-access" title="Storage Access API">[STORAGE-ACCESS]</a>, <code class="idl"><a data-link-type="idl" href="#dom-document-requeststorageaccessfororigin" id="ref-for-dom-document-requeststorageaccessfororigin⑥">requestStorageAccessForOrigin(origin)</a></code> is intended to enable removal of cross-site cookies. It enables developers to re-gain cross-site cookies with additional constraints.</p>
   <p class="note" role="note"><span class="marker">Note:</span> many of the same considerations as in <a href="https://privacycg.github.io/storage-access/#privacy"><cite>The Storage Access API</cite> § 6 Privacy considerations</a> apply. This section primarily covers the differences.</p>
   <p><a data-link-type="dfn" href="https://privacycg.github.io/storage-access/#dom-document-requeststorageaccess" id="ref-for-dom-document-requeststorageaccess③">requestStorageAccess</a> requires interaction with an embedded document. By requiring interaction only with the top-level document, <code class="idl"><a data-link-type="idl" href="#dom-document-requeststorageaccessfororigin" id="ref-for-dom-document-requeststorageaccessfororigin⑦">requestStorageAccessForOrigin(origin)</a></code> lowers the bar for a potential prompt, though embedded documents can also be quite prominent (or use other techniques to get user interaction). <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#implementation-defined" id="ref-for-implementation-defined①">Implementation-defined</a> acceptance and rejection steps are intended to allow user agents to reject abusive requests based on logic they see fit.
The prompts used have to be careful to indicate the direction of the request, such that the user is able to understand who is requesting access.</p>
   <p>As with <a data-link-type="dfn" href="https://privacycg.github.io/storage-access/#dom-document-requeststorageaccess" id="ref-for-dom-document-requeststorageaccess④">requestStorageAccess</a>, the same tension between user consent and prompt fatigue exists with <code class="idl"><a data-link-type="idl" href="#dom-document-requeststorageaccessfororigin" id="ref-for-dom-document-requeststorageaccessfororigin⑧">requestStorageAccessForOrigin(origin)</a></code>; much like the Storage Access API, <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#implementation-defined" id="ref-for-implementation-defined②">implementation-defined</a> acceptance and rejection steps are intended to enable implementers with differing stances on this question to make compromises as they see fit.</p>
   <h2 class="heading settled" data-level="8" id="security"><span class="secno">8. </span><span class="content">Security considerations</span><a class="self-link" href="#security"></a></h2>
   <p>It is important that <code class="idl"><a data-link-type="idl" href="#dom-document-requeststorageaccessfororigin" id="ref-for-dom-document-requeststorageaccessfororigin⑨">requestStorageAccessForOrigin(origin)</a></code> not degrade security properties of the web platform, even when compared to post-removal of cross-site cookies.
Third-party cookie removal <a href="https://docs.google.com/document/d/1AsrETl-7XvnZNbG81Zy9BcZfKbqACQYBSrjM3VsIpjY/edit">has potential benefits for security</a>, specifically in mitigating attacks that rely upon authenticated requests, e.g. CSRF.
We do not wish <code class="idl"><a data-link-type="idl" href="#dom-document-requeststorageaccessfororigin" id="ref-for-dom-document-requeststorageaccessfororigin①⓪">requestStorageAccessForOrigin(origin)</a></code> to be a foothold for such attacks to leverage.</p>
   <p class="note" role="note"><span class="marker">Note:</span> <a href="https://privacycg.github.io/storage-access/#security"><cite>The Storage Access API</cite> § 7 Security considerations</a> properties hold for much of this proposal. Specifically, frame-level access is only granted once <a data-link-type="dfn" href="https://privacycg.github.io/storage-access/#dom-document-requeststorageaccess" id="ref-for-dom-document-requeststorageaccess⑤">requestStorageAccess</a> is successfully invoked.
For frame access, <code class="idl"><a data-link-type="idl" href="#dom-document-requeststorageaccessfororigin" id="ref-for-dom-document-requeststorageaccessfororigin①①">requestStorageAccessForOrigin(origin)</a></code> merely simplifies the activation and prompting requirements.</p>
   <p><code class="idl"><a data-link-type="idl" href="#dom-document-requeststorageaccessfororigin" id="ref-for-dom-document-requeststorageaccessfororigin①②">requestStorageAccessForOrigin(origin)</a></code> does expand the scope of concerns in two areas: subresource requests made by the top-level document and potential notification abuse.</p>
   <h3 class="heading settled" data-level="8.1" id="subresources"><span class="secno">8.1. </span><span class="content">Subresource Requests</span><a class="self-link" href="#subresources"></a></h3>
   <p>The specific security controls proposed by the API are:</p>
   <ul>
    <li data-md>
     <p>Any cookies included with the subresource request have to be explicitly marked <code>SameSite=None</code>, indicating intent for use in <a data-link-type="dfn" href="#third-party-context" id="ref-for-third-party-context①">third party contexts</a>.</p>
    <li data-md>
     <p>For any <code>SameSite=None</code> cookies to be included, the request’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-mode" id="ref-for-concept-request-mode①">mode</a> has to be "cors", where reading of the response is blocked unless the embeddee opts-in via sending the appropriate <span>`<code><a data-link-type="http-header" href="https://fetch.spec.whatwg.org/#http-access-control-allow-credentials" id="ref-for-http-access-control-allow-credentials">access-control-allow-credentials</a></code>`</span> header. The sending of the <span>`<code><a data-link-type="http-header" href="https://fetch.spec.whatwg.org/#http-origin" id="ref-for-http-origin">origin</a></code>`</span> header ensures the embeddee is aware of the embedder’s identity.</p>
   </ul>
   <p>Additionally, only requests initiated from the top-level document will be eligible for inclusion of <code>SameSite=None</code> cookies. This ensures that other embedded frames do not receive escalated privileges.</p>
   <h3 class="heading settled" data-level="8.2" id="notification-abuse"><span class="secno">8.2. </span><span class="content">Notification Abuse</span><a class="self-link" href="#notification-abuse"></a></h3>
   <p>Unlike the <a data-link-type="biblio" href="#biblio-storage-access" title="Storage Access API">[STORAGE-ACCESS]</a>, interaction is only required with the top-level document, rather than an embedded document. This does increase the likelihood of prompting.</p>
   <p>Like the Storage Access API, user activation is consumed on denial, which prevents repeated requests.</p>
   <p>The <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#implementation-defined" id="ref-for-implementation-defined③">implementation-defined</a> rejection steps also allow for imposition of numeric limits or denylists for abusive actors.</p>
   <p>As mentioned in <a href="#privacy">§ 7 Privacy considerations</a>, because of the direction of the request, the language in user agents' prompts should indicate which site initiated the storage access request.</p>
  </main>
  <div data-fill-with="conformance">
   <h2 class="no-ref no-num heading settled" id="w3c-conformance"><span class="content">Conformance</span><a class="self-link" href="#w3c-conformance"></a></h2>
   <h3 class="no-ref no-num heading settled" id="w3c-conventions"><span class="content">Document conventions</span><a class="self-link" href="#w3c-conventions"></a></h3>
   <p>Conformance requirements are expressed
    with a combination of descriptive assertions
    and RFC 2119 terminology.
    The key words “MUST”, “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”, “RECOMMENDED”, “MAY”, and “OPTIONAL”
    in the normative parts of this document
    are to be interpreted as described in RFC 2119.
    However, for readability,
    these words do not appear in all uppercase letters in this specification. </p>
   <p>All of the text of this specification is normative
    except sections explicitly marked as non-normative, examples, and notes. <a data-link-type="biblio" href="#biblio-rfc2119" title="Key words for use in RFCs to Indicate Requirement Levels">[RFC2119]</a> </p>
   <p>Examples in this specification are introduced with the words “for example”
    or are set apart from the normative text
    with <code>class="example"</code>,
    like this: </p>
   <div class="example" id="w3c-example">
    <a class="self-link" href="#w3c-example"></a> 
    <p>This is an example of an informative example. </p>
   </div>
   <p>Informative notes begin with the word “Note”
    and are set apart from the normative text
    with <code>class="note"</code>,
    like this: </p>
   <p class="note" role="note">Note, this is an informative note.</p>
   <h3 class="no-ref no-num heading settled" id="w3c-conformant-algorithms"><span class="content">Conformant Algorithms</span><a class="self-link" href="#w3c-conformant-algorithms"></a></h3>
   <p>Requirements phrased in the imperative as part of algorithms
    (such as "strip any leading space characters"
    or "return false and abort these steps")
    are to be interpreted with the meaning of the key word
    ("must", "should", "may", etc)
    used in introducing the algorithm. </p>
   <p>Conformance requirements phrased as algorithms or specific steps
    can be implemented in any manner,
    so long as the end result is equivalent.
    In particular, the algorithms defined in this specification
    are intended to be easy to understand
    and are not intended to be performant.
    Implementers are encouraged to optimize. </p>
  </div>
<script src="https://www.w3.org/scripts/TR/2021/fixup.js"></script>
  <h2 class="no-num no-ref heading settled" id="index"><span class="content">Index</span><a class="self-link" href="#index"></a></h2>
  <h3 class="no-num no-ref heading settled" id="index-defined-here"><span class="content">Terms defined by this specification</span><a class="self-link" href="#index-defined-here"></a></h3>
  <ul class="index">
   <li><a href="#determine-if-a-request-has-top-level-storage-access">determine if a request has top-level storage access</a><span>, in § 3.2</span>
   <li><a href="#determine-the-top-level-storage-access-policy">determine the top-level storage access policy</a><span>, in § 3.2</span>
   <li><a href="#first-party-site-context">first-party-site context</a><span>, in § 3</span>
   <li><a href="#dom-toplevelstorageaccesspermissiondescriptor-requestedorigin">requestedOrigin</a><span>, in § 4</span>
   <li><a href="#dom-document-requeststorageaccessfororigin">requestStorageAccessForOrigin(origin)</a><span>, in § 3.1</span>
   <li><a href="#dom-document-requeststorageaccessfororigin-requestedorigin">requestStorageAccessForOrigin(requestedOrigin)</a><span>, in § 3.1</span>
   <li><a href="#third-party-context">third party context</a><span>, in § 3</span>
   <li><a href="#permissiondef-top-level-storage-access">top-level-storage-access</a><span>, in § 4</span>
   <li><a href="#dictdef-toplevelstorageaccesspermissiondescriptor">TopLevelStorageAccessPermissionDescriptor</a><span>, in § 4</span>
   <li><a href="#unpartitioned-data">Unpartitioned data</a><span>, in § 3</span>
  </ul>
  <aside class="dfn-panel" data-for="term-for-document">
   <a href="https://dom.spec.whatwg.org/#document">https://dom.spec.whatwg.org/#document</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-document">3. The requestStorageAccessForOrigin API</a> <a href="#ref-for-document①">(2)</a> <a href="#ref-for-document②">(3)</a>
    <li><a href="#ref-for-document③">3.1. Changes to Document</a> <a href="#ref-for-document④">(2)</a> <a href="#ref-for-document⑤">(3)</a>
    <li><a href="#ref-for-document⑥">3.2. User Agent top-level storage access policies</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-document-origin">
   <a href="https://dom.spec.whatwg.org/#concept-document-origin">https://dom.spec.whatwg.org/#concept-document-origin</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-document-origin">3.1. Changes to Document</a> <a href="#ref-for-concept-document-origin①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-http-access-control-allow-credentials">
   <a href="https://fetch.spec.whatwg.org/#http-access-control-allow-credentials">https://fetch.spec.whatwg.org/#http-access-control-allow-credentials</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-http-access-control-allow-credentials">8.1. Subresource Requests</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-request-client">
   <a href="https://fetch.spec.whatwg.org/#concept-request-client">https://fetch.spec.whatwg.org/#concept-request-client</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-request-client">3.2. User Agent top-level storage access policies</a>
    <li><a href="#ref-for-concept-request-client①">5. Fetch Integration</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-request-credentials-mode">
   <a href="https://fetch.spec.whatwg.org/#concept-request-credentials-mode">https://fetch.spec.whatwg.org/#concept-request-credentials-mode</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-request-credentials-mode">5. Fetch Integration</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-http-network-or-cache-fetch">
   <a href="https://fetch.spec.whatwg.org/#http-network-or-cache-fetch">https://fetch.spec.whatwg.org/#http-network-or-cache-fetch</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-http-network-or-cache-fetch">5. Fetch Integration</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-request-mode">
   <a href="https://fetch.spec.whatwg.org/#concept-request-mode">https://fetch.spec.whatwg.org/#concept-request-mode</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-request-mode">5. Fetch Integration</a>
    <li><a href="#ref-for-concept-request-mode①">8.1. Subresource Requests</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-http-origin">
   <a href="https://fetch.spec.whatwg.org/#http-origin">https://fetch.spec.whatwg.org/#http-origin</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-http-origin">8.1. Subresource Requests</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-request">
   <a href="https://fetch.spec.whatwg.org/#concept-request">https://fetch.spec.whatwg.org/#concept-request</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-request">3.2. User Agent top-level storage access policies</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-subresource-request">
   <a href="https://fetch.spec.whatwg.org/#subresource-request">https://fetch.spec.whatwg.org/#subresource-request</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-subresource-request">5. Fetch Integration</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-request-url">
   <a href="https://fetch.spec.whatwg.org/#concept-request-url">https://fetch.spec.whatwg.org/#concept-request-url</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-request-url">3.2. User Agent top-level storage access policies</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-window">
   <a href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#window">https://html.spec.whatwg.org/multipage/nav-history-apis.html#window</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-window">3.1. Changes to Document</a>
    <li><a href="#ref-for-window①">3.2. User Agent top-level storage access policies</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-nav-document">
   <a href="https://html.spec.whatwg.org/multipage/document-sequences.html#nav-document">https://html.spec.whatwg.org/multipage/document-sequences.html#nav-document</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-nav-document">3. The requestStorageAccessForOrigin API</a> <a href="#ref-for-nav-document①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-document-window">
   <a href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window">https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-document-window">5. Fetch Integration</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-consume-user-activation">
   <a href="https://html.spec.whatwg.org/multipage/interaction.html#consume-user-activation">https://html.spec.whatwg.org/multipage/interaction.html#consume-user-activation</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-consume-user-activation">3.2. User Agent top-level storage access policies</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dom-document-cookie">
   <a href="https://html.spec.whatwg.org/multipage/dom.html#dom-document-cookie">https://html.spec.whatwg.org/multipage/dom.html#dom-document-cookie</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-document-cookie">3. The requestStorageAccessForOrigin API</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-environment-settings-object">
   <a href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object">https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-environment-settings-object">4. Permissions Integration</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-fully-active">
   <a href="https://html.spec.whatwg.org/multipage/document-sequences.html#fully-active">https://html.spec.whatwg.org/multipage/document-sequences.html#fully-active</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-fully-active">3.1. Changes to Document</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-the-img-element">
   <a href="https://html.spec.whatwg.org/multipage/embedded-content.html#the-img-element">https://html.spec.whatwg.org/multipage/embedded-content.html#the-img-element</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-the-img-element">3. The requestStorageAccessForOrigin API</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-in-parallel">
   <a href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel">https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-in-parallel">3.1. Changes to Document</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-node-navigable">
   <a href="https://html.spec.whatwg.org/multipage/document-sequences.html#node-navigable">https://html.spec.whatwg.org/multipage/document-sequences.html#node-navigable</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-node-navigable">3.1. Changes to Document</a>
    <li><a href="#ref-for-node-navigable①">3.2. User Agent top-level storage access policies</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-obtain-a-site">
   <a href="https://html.spec.whatwg.org/multipage/browsers.html#obtain-a-site">https://html.spec.whatwg.org/multipage/browsers.html#obtain-a-site</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-obtain-a-site">3.1. Changes to Document</a>
    <li><a href="#ref-for-obtain-a-site①">4. Permissions Integration</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-origin-opaque">
   <a href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-opaque">https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-opaque</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-origin-opaque">3.1. Changes to Document</a> <a href="#ref-for-concept-origin-opaque①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-origin">
   <a href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin">https://html.spec.whatwg.org/multipage/browsers.html#concept-origin</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-origin">1. Introduction</a>
    <li><a href="#ref-for-concept-origin①">3. The requestStorageAccessForOrigin API</a>
    <li><a href="#ref-for-concept-origin②">3.1. Changes to Document</a>
    <li><a href="#ref-for-concept-origin③">5. Fetch Integration</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-settings-object-origin">
   <a href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin">https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-settings-object-origin">3. The requestStorageAccessForOrigin API</a>
    <li><a href="#ref-for-concept-settings-object-origin①">3.1. Changes to Document</a>
    <li><a href="#ref-for-concept-settings-object-origin②">6. Storage Access API Integration</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-queue-a-global-task">
   <a href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task">https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-queue-a-global-task">3.2. User Agent top-level storage access policies</a> <a href="#ref-for-queue-a-global-task①">(2)</a> <a href="#ref-for-queue-a-global-task②">(3)</a> <a href="#ref-for-queue-a-global-task③">(4)</a> <a href="#ref-for-queue-a-global-task④">(5)</a> <a href="#ref-for-queue-a-global-task⑤">(6)</a> <a href="#ref-for-queue-a-global-task⑥">(7)</a>
    <li><a href="#ref-for-queue-a-global-task⑦">6. Storage Access API Integration</a> <a href="#ref-for-queue-a-global-task⑧">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-relevant-global">
   <a href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global">https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-relevant-global">3.1. Changes to Document</a>
    <li><a href="#ref-for-concept-relevant-global①">3.2. User Agent top-level storage access policies</a> <a href="#ref-for-concept-relevant-global②">(2)</a>
    <li><a href="#ref-for-concept-relevant-global③">5. Fetch Integration</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-relevant-settings-object">
   <a href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object">https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-relevant-settings-object">3. The requestStorageAccessForOrigin API</a>
    <li><a href="#ref-for-relevant-settings-object①">3.1. Changes to Document</a>
    <li><a href="#ref-for-relevant-settings-object②">3.2. User Agent top-level storage access policies</a> <a href="#ref-for-relevant-settings-object③">(2)</a>
    <li><a href="#ref-for-relevant-settings-object④">6. Storage Access API Integration</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-same-origin">
   <a href="https://html.spec.whatwg.org/multipage/browsers.html#same-origin">https://html.spec.whatwg.org/multipage/browsers.html#same-origin</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-same-origin">3.1. Changes to Document</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-site-same-site">
   <a href="https://html.spec.whatwg.org/multipage/browsers.html#concept-site-same-site">https://html.spec.whatwg.org/multipage/browsers.html#concept-site-same-site</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-site-same-site">1. Introduction</a> <a href="#ref-for-concept-site-same-site①">(2)</a> <a href="#ref-for-concept-site-same-site②">(3)</a>
    <li><a href="#ref-for-concept-site-same-site③">3. The requestStorageAccessForOrigin API</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-secure-context">
   <a href="https://html.spec.whatwg.org/multipage/webappapis.html#secure-context">https://html.spec.whatwg.org/multipage/webappapis.html#secure-context</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-secure-context">3.1. Changes to Document</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-site">
   <a href="https://html.spec.whatwg.org/multipage/browsers.html#site">https://html.spec.whatwg.org/multipage/browsers.html#site</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-site">3. The requestStorageAccessForOrigin API</a>
    <li><a href="#ref-for-site①">3.2. User Agent top-level storage access policies</a>
    <li><a href="#ref-for-site②">4. Permissions Integration</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-environment-top-level-origin">
   <a href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-top-level-origin">https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-top-level-origin</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-environment-top-level-origin">3. The requestStorageAccessForOrigin API</a>
    <li><a href="#ref-for-concept-environment-top-level-origin①">4. Permissions Integration</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-transient-activation">
   <a href="https://html.spec.whatwg.org/multipage/interaction.html#transient-activation">https://html.spec.whatwg.org/multipage/interaction.html#transient-activation</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-transient-activation">3.1. Changes to Document</a>
    <li><a href="#ref-for-transient-activation①">3.2. User Agent top-level storage access policies</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-traversable-navigable">
   <a href="https://html.spec.whatwg.org/multipage/document-sequences.html#traversable-navigable">https://html.spec.whatwg.org/multipage/document-sequences.html#traversable-navigable</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-traversable-navigable">1. Introduction</a>
    <li><a href="#ref-for-traversable-navigable①">3. The requestStorageAccessForOrigin API</a>
    <li><a href="#ref-for-traversable-navigable②">3.1. Changes to Document</a>
    <li><a href="#ref-for-traversable-navigable③">3.2. User Agent top-level storage access policies</a>
    <li><a href="#ref-for-traversable-navigable④">5. Fetch Integration</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-boolean">
   <a href="https://infra.spec.whatwg.org/#boolean">https://infra.spec.whatwg.org/#boolean</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-boolean">3.2. User Agent top-level storage access policies</a> <a href="#ref-for-boolean①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-implementation-defined">
   <a href="https://infra.spec.whatwg.org/#implementation-defined">https://infra.spec.whatwg.org/#implementation-defined</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-implementation-defined">3.2. User Agent top-level storage access policies</a>
    <li><a href="#ref-for-implementation-defined①">7. Privacy considerations</a> <a href="#ref-for-implementation-defined②">(2)</a>
    <li><a href="#ref-for-implementation-defined③">8.2. Notification Abuse</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dom-permissiondescriptor">
   <a href="https://w3c.github.io/permissions/#dom-permissiondescriptor">https://w3c.github.io/permissions/#dom-permissiondescriptor</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-permissiondescriptor">4. Permissions Integration</a> <a href="#ref-for-dom-permissiondescriptor①">(2)</a> <a href="#ref-for-dom-permissiondescriptor②">(3)</a> <a href="#ref-for-dom-permissiondescriptor③">(4)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dom-permissionstatus">
   <a href="https://w3c.github.io/permissions/#dom-permissionstatus">https://w3c.github.io/permissions/#dom-permissionstatus</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-permissionstatus">4. Permissions Integration</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dfn-denied">
   <a href="https://w3c.github.io/permissions/#dfn-denied">https://w3c.github.io/permissions/#dfn-denied</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dfn-denied">3.2. User Agent top-level storage access policies</a>
    <li><a href="#ref-for-dfn-denied①">4. Permissions Integration</a> <a href="#ref-for-dfn-denied②">(2)</a>
    <li><a href="#ref-for-dfn-denied③">6. Storage Access API Integration</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dfn-granted">
   <a href="https://w3c.github.io/permissions/#dfn-granted">https://w3c.github.io/permissions/#dfn-granted</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dfn-granted">3.2. User Agent top-level storage access policies</a> <a href="#ref-for-dfn-granted①">(2)</a> <a href="#ref-for-dfn-granted②">(3)</a>
    <li><a href="#ref-for-dfn-granted③">6. Storage Access API Integration</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dom-permissiondescriptor-name">
   <a href="https://w3c.github.io/permissions/#dom-permissiondescriptor-name">https://w3c.github.io/permissions/#dom-permissiondescriptor-name</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-permissiondescriptor-name">3.1. Changes to Document</a>
    <li><a href="#ref-for-dom-permissiondescriptor-name①">3.2. User Agent top-level storage access policies</a>
    <li><a href="#ref-for-dom-permissiondescriptor-name②">6. Storage Access API Integration</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dfn-name">
   <a href="https://w3c.github.io/permissions/#dfn-name">https://w3c.github.io/permissions/#dfn-name</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dfn-name">4. Permissions Integration</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dfn-permission-key">
   <a href="https://w3c.github.io/permissions/#dfn-permission-key">https://w3c.github.io/permissions/#dfn-permission-key</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dfn-permission-key">4. Permissions Integration</a> <a href="#ref-for-dfn-permission-key①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dfn-permission-key-generation-algorithm">
   <a href="https://w3c.github.io/permissions/#dfn-permission-key-generation-algorithm">https://w3c.github.io/permissions/#dfn-permission-key-generation-algorithm</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dfn-permission-key-generation-algorithm">4. Permissions Integration</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dfn-permission-key-type">
   <a href="https://w3c.github.io/permissions/#dfn-permission-key-type">https://w3c.github.io/permissions/#dfn-permission-key-type</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dfn-permission-key-type">4. Permissions Integration</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dfn-permission-query-algorithm">
   <a href="https://w3c.github.io/permissions/#dfn-permission-query-algorithm">https://w3c.github.io/permissions/#dfn-permission-query-algorithm</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dfn-permission-query-algorithm">4. Permissions Integration</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dfn-permission-state">
   <a href="https://w3c.github.io/permissions/#dfn-permission-state">https://w3c.github.io/permissions/#dfn-permission-state</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dfn-permission-state">3.2. User Agent top-level storage access policies</a> <a href="#ref-for-dfn-permission-state①">(2)</a>
    <li><a href="#ref-for-dfn-permission-state②">4. Permissions Integration</a>
    <li><a href="#ref-for-dfn-permission-state③">6. Storage Access API Integration</a> <a href="#ref-for-dfn-permission-state④">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-permissions-task-source">
   <a href="https://w3c.github.io/permissions/#permissions-task-source">https://w3c.github.io/permissions/#permissions-task-source</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-permissions-task-source">3.2. User Agent top-level storage access policies</a> <a href="#ref-for-permissions-task-source①">(2)</a> <a href="#ref-for-permissions-task-source②">(3)</a> <a href="#ref-for-permissions-task-source③">(4)</a> <a href="#ref-for-permissions-task-source④">(5)</a> <a href="#ref-for-permissions-task-source⑤">(6)</a> <a href="#ref-for-permissions-task-source⑥">(7)</a>
    <li><a href="#ref-for-permissions-task-source⑦">6. Storage Access API Integration</a> <a href="#ref-for-permissions-task-source⑧">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dfn-powerful-feature">
   <a href="https://w3c.github.io/permissions/#dfn-powerful-feature">https://w3c.github.io/permissions/#dfn-powerful-feature</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dfn-powerful-feature">4. Permissions Integration</a> <a href="#ref-for-dfn-powerful-feature①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dfn-prompt">
   <a href="https://w3c.github.io/permissions/#dfn-prompt">https://w3c.github.io/permissions/#dfn-prompt</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dfn-prompt">4. Permissions Integration</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dfn-request-permission-to-use">
   <a href="https://w3c.github.io/permissions/#dfn-request-permission-to-use">https://w3c.github.io/permissions/#dfn-request-permission-to-use</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dfn-request-permission-to-use">3.2. User Agent top-level storage access policies</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dom-permissionstatus-state">
   <a href="https://w3c.github.io/permissions/#dom-permissionstatus-state">https://w3c.github.io/permissions/#dom-permissionstatus-state</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-permissionstatus-state">4. Permissions Integration</a> <a href="#ref-for-dom-permissionstatus-state①">(2)</a> <a href="#ref-for-dom-permissionstatus-state②">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-determine-the-storage-access-policy">
   <a href="https://privacycg.github.io/storage-access/#determine-the-storage-access-policy">https://privacycg.github.io/storage-access/#determine-the-storage-access-policy</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-determine-the-storage-access-policy">6. Storage Access API Integration</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dom-document-requeststorageaccess">
   <a href="https://privacycg.github.io/storage-access/#dom-document-requeststorageaccess">https://privacycg.github.io/storage-access/#dom-document-requeststorageaccess</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-document-requeststorageaccess">6. Storage Access API Integration</a> <a href="#ref-for-dom-document-requeststorageaccess①">(2)</a> <a href="#ref-for-dom-document-requeststorageaccess②">(3)</a>
    <li><a href="#ref-for-dom-document-requeststorageaccess③">7. Privacy considerations</a> <a href="#ref-for-dom-document-requeststorageaccess④">(2)</a>
    <li><a href="#ref-for-dom-document-requeststorageaccess⑤">8. Security considerations</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-url-origin">
   <a href="https://url.spec.whatwg.org/#concept-url-origin">https://url.spec.whatwg.org/#concept-url-origin</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-url-origin">3.2. User Agent top-level storage access policies</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-url-parser">
   <a href="https://url.spec.whatwg.org/#concept-url-parser">https://url.spec.whatwg.org/#concept-url-parser</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-url-parser">3.1. Changes to Document</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-idl-DOMException">
   <a href="https://webidl.spec.whatwg.org/#idl-DOMException">https://webidl.spec.whatwg.org/#idl-DOMException</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-idl-DOMException">3.1. Changes to Document</a> <a href="#ref-for-idl-DOMException①">(2)</a> <a href="#ref-for-idl-DOMException②">(3)</a> <a href="#ref-for-idl-DOMException③">(4)</a> <a href="#ref-for-idl-DOMException④">(5)</a> <a href="#ref-for-idl-DOMException⑤">(6)</a>
    <li><a href="#ref-for-idl-DOMException⑥">3.2. User Agent top-level storage access policies</a> <a href="#ref-for-idl-DOMException⑦">(2)</a> <a href="#ref-for-idl-DOMException⑧">(3)</a> <a href="#ref-for-idl-DOMException⑨">(4)</a>
    <li><a href="#ref-for-idl-DOMException①⓪">6. Storage Access API Integration</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-invalidstateerror">
   <a href="https://webidl.spec.whatwg.org/#invalidstateerror">https://webidl.spec.whatwg.org/#invalidstateerror</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-invalidstateerror">3.1. Changes to Document</a> <a href="#ref-for-invalidstateerror①">(2)</a> <a href="#ref-for-invalidstateerror②">(3)</a> <a href="#ref-for-invalidstateerror③">(4)</a>
    <li><a href="#ref-for-invalidstateerror④">3.2. User Agent top-level storage access policies</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-notallowederror">
   <a href="https://webidl.spec.whatwg.org/#notallowederror">https://webidl.spec.whatwg.org/#notallowederror</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-notallowederror">3.1. Changes to Document</a>
    <li><a href="#ref-for-notallowederror①">3.2. User Agent top-level storage access policies</a> <a href="#ref-for-notallowederror②">(2)</a> <a href="#ref-for-notallowederror③">(3)</a>
    <li><a href="#ref-for-notallowederror④">6. Storage Access API Integration</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-idl-promise">
   <a href="https://webidl.spec.whatwg.org/#idl-promise">https://webidl.spec.whatwg.org/#idl-promise</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-idl-promise">3.1. Changes to Document</a>
    <li><a href="#ref-for-idl-promise①">3.2. User Agent top-level storage access policies</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-exceptiondef-typeerror">
   <a href="https://webidl.spec.whatwg.org/#exceptiondef-typeerror">https://webidl.spec.whatwg.org/#exceptiondef-typeerror</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-exceptiondef-typeerror">3.1. Changes to Document</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-idl-USVString">
   <a href="https://webidl.spec.whatwg.org/#idl-USVString">https://webidl.spec.whatwg.org/#idl-USVString</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-idl-USVString">3. The requestStorageAccessForOrigin API</a>
    <li><a href="#ref-for-idl-USVString①">3.1. Changes to Document</a> <a href="#ref-for-idl-USVString②">(2)</a>
    <li><a href="#ref-for-idl-USVString③">4. Permissions Integration</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-a-new-promise">
   <a href="https://webidl.spec.whatwg.org/#a-new-promise">https://webidl.spec.whatwg.org/#a-new-promise</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-a-new-promise">3.1. Changes to Document</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-reject">
   <a href="https://webidl.spec.whatwg.org/#reject">https://webidl.spec.whatwg.org/#reject</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-reject">3.1. Changes to Document</a> <a href="#ref-for-reject①">(2)</a> <a href="#ref-for-reject②">(3)</a> <a href="#ref-for-reject③">(4)</a> <a href="#ref-for-reject④">(5)</a> <a href="#ref-for-reject⑤">(6)</a>
    <li><a href="#ref-for-reject⑥">3.2. User Agent top-level storage access policies</a> <a href="#ref-for-reject⑦">(2)</a> <a href="#ref-for-reject⑧">(3)</a> <a href="#ref-for-reject⑨">(4)</a>
    <li><a href="#ref-for-reject①⓪">6. Storage Access API Integration</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-resolve">
   <a href="https://webidl.spec.whatwg.org/#resolve">https://webidl.spec.whatwg.org/#resolve</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-resolve">3.1. Changes to Document</a>
    <li><a href="#ref-for-resolve①">3.2. User Agent top-level storage access policies</a> <a href="#ref-for-resolve②">(2)</a> <a href="#ref-for-resolve③">(3)</a>
    <li><a href="#ref-for-resolve④">6. Storage Access API Integration</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-idl-undefined">
   <a href="https://webidl.spec.whatwg.org/#idl-undefined">https://webidl.spec.whatwg.org/#idl-undefined</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-idl-undefined">3.1. Changes to Document</a>
   </ul>
  </aside>
  <h3 class="no-num no-ref heading settled" id="index-defined-elsewhere"><span class="content">Terms defined by reference</span><a class="self-link" href="#index-defined-elsewhere"></a></h3>
  <ul class="index">
   <li>
    <a data-link-type="biblio">[DOM]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-document">Document</span>
     <li><span class="dfn-paneled" id="term-for-concept-document-origin">origin</span>
    </ul>
   <li>
    <a data-link-type="biblio">[FETCH]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-http-access-control-allow-credentials">access-control-allow-credentials</span>
     <li><span class="dfn-paneled" id="term-for-concept-request-client">client</span>
     <li><span class="dfn-paneled" id="term-for-concept-request-credentials-mode">credentials mode</span>
     <li><span class="dfn-paneled" id="term-for-http-network-or-cache-fetch">http network or cache fetch</span>
     <li><span class="dfn-paneled" id="term-for-concept-request-mode">mode</span>
     <li><span class="dfn-paneled" id="term-for-http-origin">origin</span>
     <li><span class="dfn-paneled" id="term-for-concept-request">request</span>
     <li><span class="dfn-paneled" id="term-for-subresource-request">subresource request</span>
     <li><span class="dfn-paneled" id="term-for-concept-request-url">url</span>
    </ul>
   <li>
    <a data-link-type="biblio">[HTML]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-window">Window</span>
     <li><span class="dfn-paneled" id="term-for-nav-document">active document</span>
     <li><span class="dfn-paneled" id="term-for-concept-document-window">associated document</span>
     <li><span class="dfn-paneled" id="term-for-consume-user-activation">consume user activation</span>
     <li><span class="dfn-paneled" id="term-for-dom-document-cookie">cookie</span>
     <li><span class="dfn-paneled" id="term-for-environment-settings-object">environment settings object</span>
     <li><span class="dfn-paneled" id="term-for-fully-active">fully active</span>
     <li><span class="dfn-paneled" id="term-for-the-img-element">img</span>
     <li><span class="dfn-paneled" id="term-for-in-parallel">in parallel</span>
     <li><span class="dfn-paneled" id="term-for-node-navigable">node navigable</span>
     <li><span class="dfn-paneled" id="term-for-obtain-a-site">obtain a site</span>
     <li><span class="dfn-paneled" id="term-for-concept-origin-opaque">opaque origin</span>
     <li><span class="dfn-paneled" id="term-for-concept-origin">origin</span>
     <li><span class="dfn-paneled" id="term-for-concept-settings-object-origin">origin <small>(for environment settings object)</small></span>
     <li><span class="dfn-paneled" id="term-for-queue-a-global-task">queue a global task</span>
     <li><span class="dfn-paneled" id="term-for-concept-relevant-global">relevant global object</span>
     <li><span class="dfn-paneled" id="term-for-relevant-settings-object">relevant settings object</span>
     <li><span class="dfn-paneled" id="term-for-same-origin">same origin</span>
     <li><span class="dfn-paneled" id="term-for-concept-site-same-site">same site</span>
     <li><span class="dfn-paneled" id="term-for-secure-context">secure context</span>
     <li><span class="dfn-paneled" id="term-for-site">site</span>
     <li><span class="dfn-paneled" id="term-for-concept-environment-top-level-origin">top-level origin</span>
     <li><span class="dfn-paneled" id="term-for-transient-activation">transient activation</span>
     <li><span class="dfn-paneled" id="term-for-traversable-navigable">traversable navigable</span>
    </ul>
   <li>
    <a data-link-type="biblio">[INFRA]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-boolean">boolean</span>
     <li><span class="dfn-paneled" id="term-for-implementation-defined">implementation-defined</span>
    </ul>
   <li>
    <a data-link-type="biblio">[PERMISSIONS]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-dom-permissiondescriptor">PermissionDescriptor</span>
     <li><span class="dfn-paneled" id="term-for-dom-permissionstatus">PermissionStatus</span>
     <li><span class="dfn-paneled" id="term-for-dfn-denied">denied</span>
     <li><span class="dfn-paneled" id="term-for-dfn-granted">granted</span>
     <li><span class="dfn-paneled" id="term-for-dom-permissiondescriptor-name">name <small>(for PermissionDescriptor)</small></span>
     <li><span class="dfn-paneled" id="term-for-dfn-name">name <small>(for powerful feature)</small></span>
     <li><span class="dfn-paneled" id="term-for-dfn-permission-key">permission key</span>
     <li><span class="dfn-paneled" id="term-for-dfn-permission-key-generation-algorithm">permission key generation algorithm</span>
     <li><span class="dfn-paneled" id="term-for-dfn-permission-key-type">permission key type</span>
     <li><span class="dfn-paneled" id="term-for-dfn-permission-query-algorithm">permission query algorithm</span>
     <li><span class="dfn-paneled" id="term-for-dfn-permission-state">permission state</span>
     <li><span class="dfn-paneled" id="term-for-permissions-task-source">permissions task source</span>
     <li><span class="dfn-paneled" id="term-for-dfn-powerful-feature">powerful feature</span>
     <li><span class="dfn-paneled" id="term-for-dfn-prompt">prompt</span>
     <li><span class="dfn-paneled" id="term-for-dfn-request-permission-to-use">requesting permission to use</span>
     <li><span class="dfn-paneled" id="term-for-dom-permissionstatus-state">state</span>
    </ul>
   <li>
    <a data-link-type="biblio">[STORAGE-ACCESS]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-determine-the-storage-access-policy">determine the storage access policy</span>
     <li><span class="dfn-paneled" id="term-for-dom-document-requeststorageaccess">requeststorageaccess</span>
    </ul>
   <li>
    <a data-link-type="biblio">[URL]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-concept-url-origin">origin</span>
     <li><span class="dfn-paneled" id="term-for-concept-url-parser">url parser</span>
    </ul>
   <li>
    <a data-link-type="biblio">[WEBIDL]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-idl-DOMException">DOMException</span>
     <li><span class="dfn-paneled" id="term-for-invalidstateerror">InvalidStateError</span>
     <li><span class="dfn-paneled" id="term-for-notallowederror">NotAllowedError</span>
     <li><span class="dfn-paneled" id="term-for-idl-promise">Promise</span>
     <li><span class="dfn-paneled" id="term-for-exceptiondef-typeerror">TypeError</span>
     <li><span class="dfn-paneled" id="term-for-idl-USVString">USVString</span>
     <li><span class="dfn-paneled" id="term-for-a-new-promise">a new promise</span>
     <li><span class="dfn-paneled" id="term-for-reject">reject</span>
     <li><span class="dfn-paneled" id="term-for-resolve">resolve</span>
     <li><span class="dfn-paneled" id="term-for-idl-undefined">undefined</span>
    </ul>
  </ul>
  <h2 class="no-num no-ref heading settled" id="references"><span class="content">References</span><a class="self-link" href="#references"></a></h2>
  <h3 class="no-num no-ref heading settled" id="normative"><span class="content">Normative References</span><a class="self-link" href="#normative"></a></h3>
  <dl>
   <dt id="biblio-dom">[DOM]
   <dd>Anne van Kesteren. <a href="https://dom.spec.whatwg.org/"><cite>DOM Standard</cite></a>. Living Standard. URL: <a href="https://dom.spec.whatwg.org/">https://dom.spec.whatwg.org/</a>
   <dt id="biblio-fetch">[FETCH]
   <dd>Anne van Kesteren. <a href="https://fetch.spec.whatwg.org/"><cite>Fetch Standard</cite></a>. Living Standard. URL: <a href="https://fetch.spec.whatwg.org/">https://fetch.spec.whatwg.org/</a>
   <dt id="biblio-html">[HTML]
   <dd>Anne van Kesteren; et al. <a href="https://html.spec.whatwg.org/multipage/"><cite>HTML Standard</cite></a>. Living Standard. URL: <a href="https://html.spec.whatwg.org/multipage/">https://html.spec.whatwg.org/multipage/</a>
   <dt id="biblio-infra">[INFRA]
   <dd>Anne van Kesteren; Domenic Denicola. <a href="https://infra.spec.whatwg.org/"><cite>Infra Standard</cite></a>. Living Standard. URL: <a href="https://infra.spec.whatwg.org/">https://infra.spec.whatwg.org/</a>
   <dt id="biblio-permissions">[PERMISSIONS]
   <dd>Marcos Caceres; Mike Taylor. <a href="https://w3c.github.io/permissions/"><cite>Permissions</cite></a>. URL: <a href="https://w3c.github.io/permissions/">https://w3c.github.io/permissions/</a>
   <dt id="biblio-rfc2119">[RFC2119]
   <dd>S. Bradner. <a href="https://datatracker.ietf.org/doc/html/rfc2119"><cite>Key words for use in RFCs to Indicate Requirement Levels</cite></a>. March 1997. Best Current Practice. URL: <a href="https://datatracker.ietf.org/doc/html/rfc2119">https://datatracker.ietf.org/doc/html/rfc2119</a>
   <dt id="biblio-storage-access">[STORAGE-ACCESS]
   <dd><a href="https://privacycg.github.io/storage-access/"><cite>Storage Access API</cite></a>. CG Draft. URL: <a href="https://privacycg.github.io/storage-access/">https://privacycg.github.io/storage-access/</a>
   <dt id="biblio-url">[URL]
   <dd>Anne van Kesteren. <a href="https://url.spec.whatwg.org/"><cite>URL Standard</cite></a>. Living Standard. URL: <a href="https://url.spec.whatwg.org/">https://url.spec.whatwg.org/</a>
   <dt id="biblio-webidl">[WEBIDL]
   <dd>Edgar Chen; Timothy Gu. <a href="https://webidl.spec.whatwg.org/"><cite>Web IDL Standard</cite></a>. Living Standard. URL: <a href="https://webidl.spec.whatwg.org/">https://webidl.spec.whatwg.org/</a>
  </dl>
  <h2 class="no-num no-ref heading settled" id="idl-index"><span class="content">IDL Index</span><a class="self-link" href="#idl-index"></a></h2>
<pre class="idl highlight def"><c- b>partial</c-> <c- b>interface</c-> <a class="idl-code" data-link-type="interface" href="https://dom.spec.whatwg.org/#document"><c- g>Document</c-></a> {
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise"><c- b>Promise</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-undefined"><c- b>undefined</c-></a>> <a href="#dom-document-requeststorageaccessfororigin"><code><c- g>requestStorageAccessForOrigin</c-></code></a>(<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-USVString"><c- b>USVString</c-></a> <a href="#dom-document-requeststorageaccessfororigin-origin-origin"><code><c- g>origin</c-></code></a>);
};

<c- b>dictionary</c-> <a href="#dictdef-toplevelstorageaccesspermissiondescriptor"><code><c- g>TopLevelStorageAccessPermissionDescriptor</c-></code></a> : <a data-link-type="idl-name" href="https://w3c.github.io/permissions/#dom-permissiondescriptor"><c- n>PermissionDescriptor</c-></a> {
    <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-USVString"><c- b>USVString</c-></a> <a data-default="&quot;&quot;" data-type="USVString " href="#dom-toplevelstorageaccesspermissiondescriptor-requestedorigin"><code><c- g>requestedOrigin</c-></code></a> = "";
};

</pre>
  <h2 class="no-num no-ref heading settled" id="issues-index"><span class="content">Issues Index</span><a class="self-link" href="#issues-index"></a></h2>
  <div style="counter-reset:issue">
   <div class="issue"> The permissions task source shouldn’t be used directly. <a href="https://github.com/privacycg/requestStorageAccessForOrigin/issues/15">[Issue #privacycg/requestStorageAccessForOrigin#15]</a> <a class="issue-return" href="#issue-9521f17b" title="Jump to section">↵</a></div>
   <div class="issue"> This algorithm may need adjustments based on outcome of https://github.com/privacycg/storage-access/pull/141 <a class="issue-return" href="#issue-0f252753" title="Jump to section">↵</a></div>
  </div>
  <aside class="dfn-panel" data-for="unpartitioned-data">
   <b><a href="#unpartitioned-data">#unpartitioned-data</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-unpartitioned-data">3. The requestStorageAccessForOrigin API</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="first-party-site-context">
   <b><a href="#first-party-site-context">#first-party-site-context</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-first-party-site-context">3. The requestStorageAccessForOrigin API</a> <a href="#ref-for-first-party-site-context①">(2)</a> <a href="#ref-for-first-party-site-context②">(3)</a> <a href="#ref-for-first-party-site-context③">(4)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="third-party-context">
   <b><a href="#third-party-context">#third-party-context</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-third-party-context">3. The requestStorageAccessForOrigin API</a>
    <li><a href="#ref-for-third-party-context①">8.1. Subresource Requests</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-document-requeststorageaccessfororigin">
   <b><a href="#dom-document-requeststorageaccessfororigin">#dom-document-requeststorageaccessfororigin</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-document-requeststorageaccessfororigin">1. Introduction</a>
    <li><a href="#ref-for-dom-document-requeststorageaccessfororigin①">3. The requestStorageAccessForOrigin API</a> <a href="#ref-for-dom-document-requeststorageaccessfororigin②">(2)</a>
    <li><a href="#ref-for-dom-document-requeststorageaccessfororigin③">5. Fetch Integration</a>
    <li><a href="#ref-for-dom-document-requeststorageaccessfororigin④">6. Storage Access API Integration</a> <a href="#ref-for-dom-document-requeststorageaccessfororigin⑤">(2)</a>
    <li><a href="#ref-for-dom-document-requeststorageaccessfororigin⑥">7. Privacy considerations</a> <a href="#ref-for-dom-document-requeststorageaccessfororigin⑦">(2)</a> <a href="#ref-for-dom-document-requeststorageaccessfororigin⑧">(3)</a>
    <li><a href="#ref-for-dom-document-requeststorageaccessfororigin⑨">8. Security considerations</a> <a href="#ref-for-dom-document-requeststorageaccessfororigin①⓪">(2)</a> <a href="#ref-for-dom-document-requeststorageaccessfororigin①①">(3)</a> <a href="#ref-for-dom-document-requeststorageaccessfororigin①②">(4)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="determine-if-a-request-has-top-level-storage-access">
   <b><a href="#determine-if-a-request-has-top-level-storage-access">#determine-if-a-request-has-top-level-storage-access</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-determine-if-a-request-has-top-level-storage-access">5. Fetch Integration</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="determine-the-top-level-storage-access-policy">
   <b><a href="#determine-the-top-level-storage-access-policy">#determine-the-top-level-storage-access-policy</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-determine-the-top-level-storage-access-policy">3.1. Changes to Document</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="permissiondef-top-level-storage-access">
   <b><a href="#permissiondef-top-level-storage-access">#permissiondef-top-level-storage-access</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-permissiondef-top-level-storage-access">3.1. Changes to Document</a>
    <li><a href="#ref-for-permissiondef-top-level-storage-access①">3.2. User Agent top-level storage access policies</a> <a href="#ref-for-permissiondef-top-level-storage-access②">(2)</a>
    <li><a href="#ref-for-permissiondef-top-level-storage-access③">4. Permissions Integration</a> <a href="#ref-for-permissiondef-top-level-storage-access④">(2)</a> <a href="#ref-for-permissiondef-top-level-storage-access⑤">(3)</a> <a href="#ref-for-permissiondef-top-level-storage-access⑥">(4)</a>
    <li><a href="#ref-for-permissiondef-top-level-storage-access⑦">6. Storage Access API Integration</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dictdef-toplevelstorageaccesspermissiondescriptor">
   <b><a href="#dictdef-toplevelstorageaccesspermissiondescriptor">#dictdef-toplevelstorageaccesspermissiondescriptor</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dictdef-toplevelstorageaccesspermissiondescriptor">3.1. Changes to Document</a>
    <li><a href="#ref-for-dictdef-toplevelstorageaccesspermissiondescriptor①">3.2. User Agent top-level storage access policies</a> <a href="#ref-for-dictdef-toplevelstorageaccesspermissiondescriptor②">(2)</a>
    <li><a href="#ref-for-dictdef-toplevelstorageaccesspermissiondescriptor③">6. Storage Access API Integration</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-toplevelstorageaccesspermissiondescriptor-requestedorigin">
   <b><a href="#dom-toplevelstorageaccesspermissiondescriptor-requestedorigin">#dom-toplevelstorageaccesspermissiondescriptor-requestedorigin</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-toplevelstorageaccesspermissiondescriptor-requestedorigin">3.1. Changes to Document</a>
    <li><a href="#ref-for-dom-toplevelstorageaccesspermissiondescriptor-requestedorigin①">3.2. User Agent top-level storage access policies</a> <a href="#ref-for-dom-toplevelstorageaccesspermissiondescriptor-requestedorigin②">(2)</a>
    <li><a href="#ref-for-dom-toplevelstorageaccesspermissiondescriptor-requestedorigin③">6. Storage Access API Integration</a>
   </ul>
  </aside>
<script>/* script-dfn-panel */

document.body.addEventListener("click", function(e) {
    var queryAll = function(sel) { return [].slice.call(document.querySelectorAll(sel)); }
    // Find the dfn element or panel, if any, that was clicked on.
    var el = e.target;
    var target;
    var hitALink = false;
    while(el.parentElement) {
        if(el.tagName == "A") {
            // Clicking on a link in a <dfn> shouldn't summon the panel
            hitALink = true;
        }
        if(el.classList.contains("dfn-paneled")) {
            target = "dfn";
            break;
        }
        if(el.classList.contains("dfn-panel")) {
            target = "dfn-panel";
            break;
        }
        el = el.parentElement;
    }
    if(target != "dfn-panel") {
        // Turn off any currently "on" or "activated" panels.
        queryAll(".dfn-panel.on, .dfn-panel.activated").forEach(function(el){
            el.classList.remove("on");
            el.classList.remove("activated");
        });
    }
    if(target == "dfn" && !hitALink) {
        // open the panel
        var dfnPanel = document.querySelector(".dfn-panel[data-for='" + el.id + "']");
        if(dfnPanel) {
            dfnPanel.classList.add("on");
            var rect = el.getBoundingClientRect();
            dfnPanel.style.left = window.scrollX + rect.right + 5 + "px";
            dfnPanel.style.top = window.scrollY + rect.top + "px";
            var panelRect = dfnPanel.getBoundingClientRect();
            var panelWidth = panelRect.right - panelRect.left;
            if(panelRect.right > document.body.scrollWidth && (rect.left - (panelWidth + 5)) > 0) {
                // Reposition, because the panel is overflowing
                dfnPanel.style.left = window.scrollX + rect.left - (panelWidth + 5) + "px";
            }
        } else {
            console.log("Couldn't find .dfn-panel[data-for='" + el.id + "']");
        }
    } else if(target == "dfn-panel") {
        // Switch it to "activated" state, which pins it.
        el.classList.add("activated");
        el.style.left = null;
        el.style.top = null;
    }

});
</script>
<script>/* script-var-click-highlighting */

    "use strict";
    {
        document.addEventListener("click", e=>{
            if(e.target.nodeName == "VAR") {
                highlightSameAlgoVars(e.target);
            }
        });
        const indexCounts = new Map();
        const indexNames = new Map();
        function highlightSameAlgoVars(v) {
            // Find the algorithm container.
            let algoContainer = null;
            let searchEl = v;
            while(algoContainer == null && searchEl != document.body) {
                searchEl = searchEl.parentNode;
                if(searchEl.hasAttribute("data-algorithm")) {
                    algoContainer = searchEl;
                }
            }

            // Not highlighting document-global vars,
            // too likely to be unrelated.
            if(algoContainer == null) return;

            const algoName = algoContainer.getAttribute("data-algorithm");
            const varName = getVarName(v);
            const addClass = !v.classList.contains("selected");
            let highlightClass = null;
            if(addClass) {
                const index = chooseHighlightIndex(algoName, varName);
                indexCounts.get(algoName)[index] += 1;
                indexNames.set(algoName+"///"+varName, index);
                highlightClass = nameFromIndex(index);
            } else {
                const index = previousHighlightIndex(algoName, varName);
                indexCounts.get(algoName)[index] -= 1;
                highlightClass = nameFromIndex(index);
            }

            // Find all same-name vars, and toggle their class appropriately.
            for(const el of algoContainer.querySelectorAll("var")) {
                if(getVarName(el) == varName) {
                    el.classList.toggle("selected", addClass);
                    el.classList.toggle(highlightClass, addClass);
                }
            }
        }
        function getVarName(el) {
            return el.textContent.replace(/(\s|\xa0)+/, " ").trim();
        }
        function chooseHighlightIndex(algoName, varName) {
            let indexes = null;
            if(indexCounts.has(algoName)) {
                indexes = indexCounts.get(algoName);
            } else {
                // 7 classes right now
                indexes = [0,0,0,0,0,0,0];
                indexCounts.set(algoName, indexes);
            }

            // If the element was recently unclicked,
            // *and* that color is still unclaimed,
            // give it back the same color.
            const lastIndex = previousHighlightIndex(algoName, varName);
            if(indexes[lastIndex] === 0) return lastIndex;

            // Find the earliest index with the lowest count.
            const minCount = Math.min.apply(null, indexes);
            let index = null;
            for(var i = 0; i < indexes.length; i++) {
                if(indexes[i] == minCount) {
                    return i;
                }
            }
        }
        function previousHighlightIndex(algoName, varName) {
            return indexNames.get(algoName+"///"+varName);
        }
        function nameFromIndex(index) {
            return "selected" + index;
        }
    }
    </script>