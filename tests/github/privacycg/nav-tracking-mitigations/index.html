<!doctype html><html lang="en">
 <head>
  <meta charset="utf-8">
  <title>Navigational-Tracking Mitigations</title>
  <meta content="width=device-width" name="viewport">
  <link href="https://www.w3.org/StyleSheets/TR/2021/cg-draft" rel="stylesheet">
  <link href="https://privacycg.github.io/nav-tracking-mitigations/" rel="canonical">
<style>
#example-link-decoration-tracking code em {background-color: cyan}
</style>
<style>/* style-autolinks */

.css.css, .property.property, .descriptor.descriptor {
    color: var(--a-normal-text);
    font-size: inherit;
    font-family: inherit;
}
.css::before, .property::before, .descriptor::before {
    content: "‘";
}
.css::after, .property::after, .descriptor::after {
    content: "’";
}
.property, .descriptor {
    /* Don't wrap property and descriptor names */
    white-space: nowrap;
}
.type { /* CSS value <type> */
    font-style: italic;
}
pre .property::before, pre .property::after {
    content: "";
}
[data-link-type="property"]::before,
[data-link-type="propdesc"]::before,
[data-link-type="descriptor"]::before,
[data-link-type="value"]::before,
[data-link-type="function"]::before,
[data-link-type="at-rule"]::before,
[data-link-type="selector"]::before,
[data-link-type="maybe"]::before {
    content: "‘";
}
[data-link-type="property"]::after,
[data-link-type="propdesc"]::after,
[data-link-type="descriptor"]::after,
[data-link-type="value"]::after,
[data-link-type="function"]::after,
[data-link-type="at-rule"]::after,
[data-link-type="selector"]::after,
[data-link-type="maybe"]::after {
    content: "’";
}

[data-link-type].production::before,
[data-link-type].production::after,
.prod [data-link-type]::before,
.prod [data-link-type]::after {
    content: "";
}

[data-link-type=element],
[data-link-type=element-attr] {
    font-family: Menlo, Consolas, "DejaVu Sans Mono", monospace;
    font-size: .9em;
}
[data-link-type=element]::before { content: "<" }
[data-link-type=element]::after  { content: ">" }

[data-link-type=biblio] {
    white-space: pre;
}</style>
<style>/* style-colors */

/* Any --*-text not paired with a --*-bg is assumed to have a transparent bg */
:root {
    color-scheme: light dark;

    --text: black;
    --bg: white;

    --unofficial-watermark: url(https://www.w3.org/StyleSheets/TR/2016/logos/UD-watermark);

    --logo-bg: #1a5e9a;
    --logo-active-bg: #c00;
    --logo-text: white;

    --tocnav-normal-text: #707070;
    --tocnav-normal-bg: var(--bg);
    --tocnav-hover-text: var(--tocnav-normal-text);
    --tocnav-hover-bg: #f8f8f8;
    --tocnav-active-text: #c00;
    --tocnav-active-bg: var(--tocnav-normal-bg);

    --tocsidebar-text: var(--text);
    --tocsidebar-bg: #f7f8f9;
    --tocsidebar-shadow: rgba(0,0,0,.1);
    --tocsidebar-heading-text: hsla(203,20%,40%,.7);

    --toclink-text: var(--text);
    --toclink-underline: #3980b5;
    --toclink-visited-text: var(--toclink-text);
    --toclink-visited-underline: #054572;

    --heading-text: #005a9c;

    --hr-text: var(--text);

    --algo-border: #def;

    --del-text: red;
    --del-bg: transparent;
    --ins-text: #080;
    --ins-bg: transparent;

    --a-normal-text: #034575;
    --a-normal-underline: #bbb;
    --a-visited-text: var(--a-normal-text);
    --a-visited-underline: #707070;
    --a-hover-bg: rgba(75%, 75%, 75%, .25);
    --a-active-text: #c00;
    --a-active-underline: #c00;

    --blockquote-border: silver;
    --blockquote-bg: transparent;
    --blockquote-text: currentcolor;

    --issue-border: #e05252;
    --issue-bg: #fbe9e9;
    --issue-text: var(--text);
    --issueheading-text: #831616;

    --example-border: #e0cb52;
    --example-bg: #fcfaee;
    --example-text: var(--text);
    --exampleheading-text: #574b0f;

    --note-border: #52e052;
    --note-bg: #e9fbe9;
    --note-text: var(--text);
    --noteheading-text: hsl(120, 70%, 30%);
    --notesummary-underline: silver;

    --assertion-border: #aaa;
    --assertion-bg: #eee;
    --assertion-text: black;

    --advisement-border: orange;
    --advisement-bg: #fec;
    --advisement-text: var(--text);
    --advisementheading-text: #b35f00;

    --warning-border: red;
    --warning-bg: hsla(40,100%,50%,0.95);
    --warning-text: var(--text);

    --amendment-border: #330099;
    --amendment-bg: #F5F0FF;
    --amendment-text: var(--text);
    --amendmentheading-text: #220066;

    --def-border: #8ccbf2;
    --def-bg: #def;
    --def-text: var(--text);
    --defrow-border: #bbd7e9;

    --datacell-border: silver;

    --indexinfo-text: #707070;

    --indextable-hover-text: black;
    --indextable-hover-bg: #f7f8f9;

    --outdatedspec-bg: rgba(0, 0, 0, .5);
    --outdatedspec-text: black;
    --outdated-bg: maroon;
    --outdated-text: white;
    --outdated-shadow: red;

    --editedrec-bg: darkorange;
}</style>
<style>/* style-counters */

body {
    counter-reset: example figure issue;
}
.issue {
    counter-increment: issue;
}
.issue:not(.no-marker)::before {
    content: "Issue " counter(issue);
}

.example {
    counter-increment: example;
}
.example:not(.no-marker)::before {
    content: "Example " counter(example);
}
.invalid.example:not(.no-marker)::before,
.illegal.example:not(.no-marker)::before {
    content: "Invalid Example" counter(example);
}

figcaption {
    counter-increment: figure;
}
figcaption:not(.no-marker)::before {
    content: "Figure " counter(figure) " ";
}</style>
<style>/* style-dfn-panel */

:root {
    --dfnpanel-bg: #ddd;
    --dfnpanel-text: var(--text);
}
.dfn-panel {
    position: absolute;
    z-index: 35;
    height: auto;
    width: -webkit-fit-content;
    width: fit-content;
    max-width: 300px;
    max-height: 500px;
    overflow: auto;
    padding: 0.5em 0.75em;
    font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
    background: var(--dfnpanel-bg);
    color: var(--dfnpanel-text);
    border: outset 0.2em;
}
.dfn-panel:not(.on) { display: none; }
.dfn-panel * { margin: 0; padding: 0; text-indent: 0; }
.dfn-panel > b { display: block; }
.dfn-panel a { color: var(--dfnpanel-text); }
.dfn-panel a:not(:hover) { text-decoration: none !important; border-bottom: none !important; }
.dfn-panel > b + b { margin-top: 0.25em; }
.dfn-panel ul { padding: 0; }
.dfn-panel li { list-style: inside; }
.dfn-panel.activated {
    display: inline-block;
    position: fixed;
    left: .5em;
    bottom: 2em;
    margin: 0 auto;
    max-width: calc(100vw - 1.5em - .4em - .5em);
    max-height: 30vh;
}

.dfn-paneled { cursor: pointer; }
</style>
<style>/* style-issues */

a[href].issue-return {
    float: right;
    float: inline-end;
    color: var(--issueheading-text);
    font-weight: bold;
    text-decoration: none;
}
</style>
<style>/* style-md-lists */

/* This is a weird hack for me not yet following the commonmark spec
   regarding paragraph and lists. */
[data-md] > :first-child {
    margin-top: 0;
}
[data-md] > :last-child {
    margin-bottom: 0;
}</style>
<style>/* style-selflinks */

:root {
    --selflink-text: white;
    --selflink-bg: gray;
    --selflink-hover-text: black;
}
.heading, .issue, .note, .example, li, dt {
    position: relative;
}
a.self-link {
    position: absolute;
    top: 0;
    left: calc(-1 * (3.5rem - 26px));
    width: calc(3.5rem - 26px);
    height: 2em;
    text-align: center;
    border: none;
    transition: opacity .2s;
    opacity: .5;
}
a.self-link:hover {
    opacity: 1;
}
.heading > a.self-link {
    font-size: 83%;
}
.example > a.self-link,
.note > a.self-link,
.issue > a.self-link {
    /* These blocks are overflow:auto, so positioning outside
       doesn't work. */
    left: auto;
    right: 0;
}
li > a.self-link {
    left: calc(-1 * (3.5rem - 26px) - 2em);
}
dfn > a.self-link {
    top: auto;
    left: auto;
    opacity: 0;
    width: 1.5em;
    height: 1.5em;
    background: var(--selflink-bg);
    color: var(--selflink-text);
    font-style: normal;
    transition: opacity .2s, background-color .2s, color .2s;
}
dfn:hover > a.self-link {
    opacity: 1;
}
dfn > a.self-link:hover {
    color: var(--selflink-hover-text);
}

a.self-link::before            { content: "¶"; }
.heading > a.self-link::before { content: "§"; }
dfn > a.self-link::before      { content: "#"; }
</style>
<style>/* style-darkmode */

@media (prefers-color-scheme: dark) {
    :root {
        --text: #ddd;
        --bg: black;

        --unofficial-watermark: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='400'%3E%3Cg fill='%23100808' transform='translate(200 200) rotate(-45) translate(-200 -200)' stroke='%23100808' stroke-width='3'%3E%3Ctext x='50%25' y='220' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EUNOFFICIAL%3C/text%3E%3Ctext x='50%25' y='305' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EDRAFT%3C/text%3E%3C/g%3E%3C/svg%3E");

        --logo-bg: #1a5e9a;
        --logo-active-bg: #c00;
        --logo-text: white;

        --tocnav-normal-text: #999;
        --tocnav-normal-bg: var(--bg);
        --tocnav-hover-text: var(--tocnav-normal-text);
        --tocnav-hover-bg: #080808;
        --tocnav-active-text: #f44;
        --tocnav-active-bg: var(--tocnav-normal-bg);

        --tocsidebar-text: var(--text);
        --tocsidebar-bg: #080808;
        --tocsidebar-shadow: rgba(255,255,255,.1);
        --tocsidebar-heading-text: hsla(203,20%,40%,.7);

        --toclink-text: var(--text);
        --toclink-underline: #6af;
        --toclink-visited-text: var(--toclink-text);
        --toclink-visited-underline: #054572;

        --heading-text: #8af;

        --hr-text: var(--text);

        --algo-border: #456;

        --del-text: #f44;
        --del-bg: transparent;
        --ins-text: #4a4;
        --ins-bg: transparent;

        --a-normal-text: #6af;
        --a-normal-underline: #555;
        --a-visited-text: var(--a-normal-text);
        --a-visited-underline: var(--a-normal-underline);
        --a-hover-bg: rgba(25%, 25%, 25%, .2);
        --a-active-text: #f44;
        --a-active-underline: var(--a-active-text);

        --borderedblock-bg: rgba(255, 255, 255, .05);

        --blockquote-border: silver;
        --blockquote-bg: var(--borderedblock-bg);
        --blockquote-text: currentcolor;

        --issue-border: #e05252;
        --issue-bg: var(--borderedblock-bg);
        --issue-text: var(--text);
        --issueheading-text: hsl(0deg, 70%, 70%);

        --example-border: hsl(50deg, 90%, 60%);
        --example-bg: var(--borderedblock-bg);
        --example-text: var(--text);
        --exampleheading-text: hsl(50deg, 70%, 70%);

        --note-border: hsl(120deg, 100%, 35%);
        --note-bg: var(--borderedblock-bg);
        --note-text: var(--text);
        --noteheading-text: hsl(120, 70%, 70%);
        --notesummary-underline: silver;

        --assertion-border: #444;
        --assertion-bg: var(--borderedblock-bg);
        --assertion-text: var(--text);

        --advisement-border: orange;
        --advisement-bg: #222218;
        --advisement-text: var(--text);
        --advisementheading-text: #f84;

        --warning-border: red;
        --warning-bg: hsla(40,100%,20%,0.95);
        --warning-text: var(--text);

        --amendment-border: #330099;
        --amendment-bg: #080010;
        --amendment-text: var(--text);
        --amendmentheading-text: #cc00ff;

        --def-border: #8ccbf2;
        --def-bg: #080818;
        --def-text: var(--text);
        --defrow-border: #136;

        --datacell-border: silver;

        --indexinfo-text: #aaa;

        --indextable-hover-text: var(--text);
        --indextable-hover-bg: #181818;

        --outdatedspec-bg: rgba(255, 255, 255, .5);
        --outdatedspec-text: black;
        --outdated-bg: maroon;
        --outdated-text: white;
        --outdated-shadow: red;

        --editedrec-bg: darkorange;
    }
    /* In case a transparent-bg image doesn't expect to be on a dark bg,
       which is quite common in practice... */
    img { background: white; }
}
@media (prefers-color-scheme: dark) {
    :root {
        --selflink-text: black;
        --selflink-bg: silver;
        --selflink-hover-text: white;
    }
}

@media (prefers-color-scheme: dark) {
    :root {
        --dfnpanel-bg: #222;
        --dfnpanel-text: var(--text);
    }
}</style>
 <body>
  <header>
   <p data-fill-with="logo"><a class="logo" href="https://www.w3.org/"> <img alt="W3C" height="48" src="https://www.w3.org/StyleSheets/TR/2021/logos/W3C" width="72"> </a> </p>
   <h1 class="no-ref" id="title">Navigational-Tracking Mitigations</h1>
   <h2 class="no-num no-toc no-ref heading settled" id="subtitle"><span class="content">Draft Community Group Report, <time datetime="1970-01-01">1 January 1970</time></span></h2>
   <div data-fill-with="spec-metadata">
    <dl>
     <dt>Participate:
     <dd><a href="https://github.com/privacycg/nav-tracking-mitigations">Github Repository</a>
     <dd><a href="https://github.com/privacycg/meetings/">Privacy CG Meetings</a>
     <dt class="editor">Editors:
     <dd class="editor p-author h-card vcard" data-editor-id="109401"><a class="p-name fn u-email email" href="mailto:psnyder@brave.com">Pete Snyder</a> (<a class="p-org org" href="https://brave.com/">Brave</a>)
     <dd class="editor p-author h-card vcard" data-editor-id="72192"><a class="p-name fn u-email email" href="mailto:jyasskin@google.com">Jeffrey Yasskin</a> (<a class="p-org org" href="https://google.com/">Google</a>)
     <dt>This version:
     <dd><a class="u-url" href="https://privacycg.github.io/nav-tracking-mitigations/">https://privacycg.github.io/nav-tracking-mitigations/</a>
    </dl>
   </div>
   <div data-fill-with="warning"></div>
   <p class="copyright" data-fill-with="copyright"><a href="http://www.w3.org/Consortium/Legal/ipr-notice#Copyright">Copyright</a> © 1970 the Contributors to “Navigational-Tracking Mitigations”, published by the <a href="http://www.w3.org/community/privacycg/">Privacy Community Group</a>.

This document is licensed under the <a href="http://www.w3.org/Consortium/Legal/2015/copyright-software-and-document">W3C Software and Document License</a>.

Contributions to this document are made under the <a href="https://www.w3.org/community/about/agreements/cla/">W3C Community Contributor License Agreement (CLA)</a>. </p>
   <hr title="Separator for header">
  </header>
  <div data-fill-with="abstract">
   <h2 class="no-num no-toc no-ref heading settled" id="abstract"><span class="content">Abstract</span></h2>
   <p>This specification defines navigational tracking and when and how browsers are required to prevent it from happening.</p>
  </div>
  <h2 class="no-num no-toc no-ref heading settled" id="status"><span class="content">Status of this document</span></h2>
  <div data-fill-with="status">
   <p>This specification is intended to be migrated to the W3C standards track. It is not a W3C standard.</p>
   <p>It was published by the <a href="http://www.w3.org/community/privacycg/">Privacy Community Group</a>.
Please note that under the <a href="http://www.w3.org/community/about/agreements/cla/">W3C Community Contributor License Agreement (CLA)</a> there is a limited opt-out and other conditions apply.
Learn more about <a href="http://www.w3.org/community/">W3C Community and Business Groups</a>.</p>
  </div>
  <div data-fill-with="at-risk"></div>
  <nav data-fill-with="table-of-contents" id="toc">
   <h2 class="no-num no-toc no-ref" id="contents">Table of Contents</h2>
   <ol class="toc" role="directory">
    <li><a href="#intro"><span class="secno">1</span> <span class="content">Introduction</span></a>
    <li><a href="#infra"><span class="secno">2</span> <span class="content">Infrastructure</span></a>
    <li><a href="#terminology"><span class="secno">3</span> <span class="content">Terminology</span></a>
    <li>
     <a href="#threat-model"><span class="secno">4</span> <span class="content">Threat model</span></a>
     <ol class="toc">
      <li><a href="#threat-actors"><span class="secno">4.1</span> <span class="content">Threat actors</span></a>
     </ol>
    <li>
     <a href="#alternatives"><span class="secno">5</span> <span class="content">Considered Alternatives</span></a>
     <ol class="toc">
      <li>
       <a href="#deployed-mitigations"><span class="secno">5.1</span> <span class="content">Deployed Mitigations</span></a>
       <ol class="toc">
        <li><a href="#mitigations-safari"><span class="secno">5.1.1</span> <span class="content">Safari</span></a>
        <li><a href="#mitigations-firefox"><span class="secno">5.1.2</span> <span class="content">Firefox</span></a>
        <li><a href="#mitigations-brave"><span class="secno">5.1.3</span> <span class="content">Brave</span></a>
       </ol>
     </ol>
    <li><a href="#acknowledgements"><span class="secno"></span> <span class="content">Acknowledgements</span></a>
    <li>
     <a href="#w3c-conformance"><span class="secno"></span> <span class="content">Conformance</span></a>
     <ol class="toc">
      <li><a href="#w3c-conventions"><span class="secno"></span> <span class="content">Document conventions</span></a>
      <li><a href="#w3c-conformant-algorithms"><span class="secno"></span> <span class="content">Conformant Algorithms</span></a>
     </ol>
    <li>
     <a href="#index"><span class="secno"></span> <span class="content">Index</span></a>
     <ol class="toc">
      <li><a href="#index-defined-here"><span class="secno"></span> <span class="content">Terms defined by this specification</span></a>
      <li><a href="#index-defined-elsewhere"><span class="secno"></span> <span class="content">Terms defined by reference</span></a>
     </ol>
    <li>
     <a href="#references"><span class="secno"></span> <span class="content">References</span></a>
     <ol class="toc">
      <li><a href="#normative"><span class="secno"></span> <span class="content">Normative References</span></a>
      <li><a href="#informative"><span class="secno"></span> <span class="content">Informative References</span></a>
     </ol>
    <li><a href="#issues-index"><span class="secno"></span> <span class="content">Issues Index</span></a>
   </ol>
  </nav>
  <main>
   <section class="non-normative">
    <h2 class="heading settled" data-level="1" id="intro"><span class="secno">1. </span><span class="content">Introduction</span><a class="self-link" href="#intro"></a></h2>
    <p><em>This section is non-normative.</em></p>
    <p>Browsers are working to prevent cross-site <a data-link-type="dfn" href="https://www.w3.org/TR/tracking-dnt/#dfn-tracking" id="ref-for-dfn-tracking">tracking</a>, which threatens user
privacy. In addition to third-party cookies and storage, other client-side
methods exist that enable cross-site tracking. <a data-link-type="dfn" href="#navigational-tracking" id="ref-for-navigational-tracking">Navigational tracking</a> correlates user identities across sites during navigations between those sites. <a data-link-type="dfn" href="#navigational-tracking" id="ref-for-navigational-tracking①">Navigational tracking</a> uses <a data-link-type="dfn" href="#link-decoration" id="ref-for-link-decoration">link decoration</a> to convey information, but
not all <a data-link-type="dfn" href="#link-decoration" id="ref-for-link-decoration①">link decoration</a> is tracking. This project attempts to distinguish
tracking from non-tracking navigation and to prevent the tracking without
damaging similar but benign navigations.</p>
   </section>
   <h2 class="heading settled" data-level="2" id="infra"><span class="secno">2. </span><span class="content">Infrastructure</span><a class="self-link" href="#infra"></a></h2>
   <p>This specification depends on the Infra standard. <a data-link-type="biblio" href="#biblio-infra" title="Infra Standard">[INFRA]</a></p>
   <h2 class="heading settled" data-level="3" id="terminology"><span class="secno">3. </span><span class="content">Terminology</span><a class="self-link" href="#terminology"></a></h2>
   <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="link-decoration">Link decoration</dfn> is when the source of a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/links.html#hyperlink" id="ref-for-hyperlink">hyperlink</a> "decorates" its <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url" id="ref-for-concept-url">URL</a> with extra information beyond what’s necessary to identify the page a user wants
to navigate to. This information can be placed almost anywhere inside the URL.</p>
   <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="navigational-tracking">Navigational tracking</dfn> refers to the general use of one or more <span spec-section="#browsing-the-web">navigations</span> to identify that a user on one site is the
same person as a user on another site. Navigations transmit information
cross-site in a few different ways, including in the target URL, which might be <a data-link-type="dfn" href="#link-decoration" id="ref-for-link-decoration②">decorated</a>, and in the timing of the request.</p>
   <div class="example" id="example-link-decoration-tracking">
    <a class="self-link" href="#example-link-decoration-tracking"></a> 
    <p>Examples and non-examples of <a data-link-type="dfn" href="#link-decoration" id="ref-for-link-decoration③">link decoration</a> and <a data-link-type="dfn" href="#navigational-tracking" id="ref-for-navigational-tracking②">navigational tracking</a>,
with the potential decoration or tracking element emphasized:</p>
    <dl>
     <dt data-md><code>https://publisher.example/page?userId=<em>5789rhkdsaf8urfnsd</em></code>
     <dd data-md>
      <p><a data-link-type="dfn" href="#link-decoration" id="ref-for-link-decoration④">Link decoration</a>, and also <a data-link-type="dfn" href="#navigational-tracking" id="ref-for-navigational-tracking③">navigational tracking</a>.</p>
     <dt data-md><code>https://bookshop.org/a/<em>1122</em>/9780062252074</code>
     <dd data-md>
      <p><a data-link-type="dfn" href="#link-decoration" id="ref-for-link-decoration⑤">Link decoration</a> but <strong>not</strong> <a data-link-type="dfn" href="#navigational-tracking" id="ref-for-navigational-tracking④">navigational tracking</a>: This number
identifies an affiliate to credit with a book sale. Replacing this with
another number gets to the same target page.</p>
     <dt data-md><code>https://bookshop.org/a/1122/<em>9780062252074</em></code>
     <dd data-md>
      <p><strong>Not</strong> decoration: This number identifies a particular book. Changing it
yields a different target page.</p>
     <dt data-md><code>https://bugzilla.mozilla.org/show_bug.cgi?id=<em>1460058</em></code>
     <dd data-md>
      <p><strong>Not</strong> decoration: changing the number changes which bug the user sees.</p>
     <dt data-md><code>https://www.google.com/maps/@<em>37.4220328,-122.0847584,17.12z</em></code>
     <dd data-md>
      <p class="issue" id="issue-9458c4e5"><a class="self-link" href="#issue-9458c4e5"></a> Changing the numbers changes what map the user sees, and embedding
a user ID would not successfully transfer that user ID to the target site,
but it’s hard for an automated system inside a browser to prove
that, and even hard for humans reading the URL to be confident of it. <a href="https://github.com/privacycg/nav-tracking-mitigations/issues/4">[Issue #4]</a></p>
     <dt data-md><code>https://publisher.example/unsubscribe?userId=<em>5789rhkdsaf8urfnsd</em></code>
     <dd data-md>
      <p class="issue" id="issue-fc2127e1"><a class="self-link" href="#issue-fc2127e1"></a> The URL identifies an action rather than a page, and the user ID
might be essential for that action to happen. However, this is also clearly
a user ID and sufficient to track a user if the source and target
collaborate. <a href="https://github.com/privacycg/nav-tracking-mitigations/issues/5">[Issue #5]</a></p>
     <dt data-md><code>https://example.com/auth/callback?token=<em>1234567</em></code>
     <dd data-md>
      <p class="issue" id="issue-0c501704"><a class="self-link" href="#issue-0c501704"></a> This is probably the same case as the unsubscribe link. <a href="https://github.com/privacycg/nav-tracking-mitigations/issues/5">[Issue #5]</a></p>
     <dt data-md><code>https://example.com/login?returnto=<em>item/12345</em></code>
     <dd data-md>
      <p>Assuming a request for this URL shows a login page instead of immediately
redirecting to <code>item/12345</code>, this is a <a data-link-type="dfn" href="#link-decoration" id="ref-for-link-decoration⑥">link decoration</a> but not <a data-link-type="dfn" href="#navigational-tracking" id="ref-for-navigational-tracking⑤">navigational tracking</a>.</p>
    </dl>
   </div>
   <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="bounce-tracking">Bounce tracking</dfn> refers to the use of redirects in a top-level context
(including <a data-link-type="dfn" href="https://httpwg.org/specs/rfc7231.html#status.3xx" id="ref-for-status.3xx">HTTP 3xx statuses</a>, <code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/semantics.html#meta" id="ref-for-meta">meta</a></code> elements with <code><a data-link-type="element-sub" href="https://html.spec.whatwg.org/multipage/semantics.html#attr-meta-http-equiv" id="ref-for-attr-meta-http-equiv">http-equiv</a></code>=<code><a data-link-type="attr-value" href="https://html.spec.whatwg.org/multipage/semantics.html#attr-meta-http-equiv-keyword-refresh" id="ref-for-attr-meta-http-equiv-keyword-refresh">refresh</a></code> attributes, and script-directed
navigation that doesn’t wait for user input) along with <a data-link-type="dfn" href="#link-decoration" id="ref-for-link-decoration⑦">link decoration</a> to
join user identities between sites. <a data-link-type="dfn" href="#bounce-tracking" id="ref-for-bounce-tracking">Bounce tracking</a> is a subset of <a data-link-type="dfn" href="#navigational-tracking" id="ref-for-navigational-tracking⑥">navigational tracking</a> and can include automated navigation through the same
or different sites from the source or ultimate destination of a link.</p>
   <div class="example" id="example-bounce-tracking-to-self">
    <a class="self-link" href="#example-bounce-tracking-to-self"></a> 
    <p>Tracking via a bounce through an aggregation domain:</p>
    <ol>
     <li data-md>
      <p>The content publisher’s page (on <code>publisher.example</code>) embeds a third-party
script from <code>tracker.example</code>.</p>
     <li data-md>
      <p>The third-party script tries to read an already-stored identifier, for
example one it has set into <code>publisher.example</code>'s storage or one read from a
third-party <code>tracker.example</code> <code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/iframe-embed-object.html#the-iframe-element" id="ref-for-the-iframe-element">iframe</a></code>.</p>
     <li data-md>
      <p>If it can’t, it redirects the top level page to <code>tracker.example</code> using <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#dom-location" id="ref-for-dom-location">window.location</a></code>.</p>
     <li data-md>
      <p>During this load <code>tracker.example</code> is the first party and can read and write
its cookie jar.</p>
     <li data-md>
      <p><code>tracker.example</code> redirects back to the original page URL, with that URL <a data-link-type="dfn" href="#link-decoration" id="ref-for-link-decoration⑧">decorated</a> with its user ID in a query parameter.</p>
     <li data-md>
      <p>The <code>tracker.example</code> user ID is now available on <code>publisher.example</code> and can
be saved into its first-party storage so that future visits don’t need to
bounce.</p>
    </ol>
   </div>
   <h2 class="heading settled" data-level="4" id="threat-model"><span class="secno">4. </span><span class="content">Threat model</span><a class="self-link" href="#threat-model"></a></h2>
   <p>This section will precisely define the goals and non-goals of this
specification’s mitigations. It will define a few classes of actors with the
ability to modify websites in particular ways. Then it will define what
cross-site information each of these actors can or cannot learn.</p>
   <h3 class="heading settled" data-level="4.1" id="threat-actors"><span class="secno">4.1. </span><span class="content">Threat actors</span><a class="self-link" href="#threat-actors"></a></h3>
   <p>TODO</p>
   <section class="informative">
    <h2 class="heading settled" data-level="5" id="alternatives"><span class="secno">5. </span><span class="content">Considered Alternatives</span><a class="self-link" href="#alternatives"></a></h2>
    <p><em>This section is non-normative.</em></p>
    <p>So far, the alternative designs consist of mitigations that various browsers
have already deployed.</p>
    <h3 class="heading settled" data-level="5.1" id="deployed-mitigations"><span class="secno">5.1. </span><span class="content">Deployed Mitigations</span><a class="self-link" href="#deployed-mitigations"></a></h3>
    <p>Some browsers have deployed and announced protections against <a data-link-type="dfn" href="#navigational-tracking" id="ref-for-navigational-tracking⑦">navigational tracking</a>. This section is a work in progress to detail what
protections have been shipped and / or are planned. This section is not
comprehensive.</p>
    <h4 class="heading settled" data-level="5.1.1" id="mitigations-safari"><span class="secno">5.1.1. </span><span class="content">Safari</span><a class="self-link" href="#mitigations-safari"></a></h4>
    <p>Safari uses an algorithmic approach to combat <a data-link-type="dfn" href="#navigational-tracking" id="ref-for-navigational-tracking⑧">navigational tracking</a>. Safari
classifies a site as having cross-site tracking capabilities if the <a href="https://webkit.org/tracking-prevention/#classification-as-having-cross-site-tracking-capabilities">following
criteria</a> are met within a particular client:</p>
    <ul>
     <li data-md>
      <p>The site appears as a third-party resource under enough different <a data-link-type="dfn" href="https://url.spec.whatwg.org/#host-registrable-domain" id="ref-for-host-registrable-domain">registrable domains</a>.</p>
     <li data-md>
      <p>The site automatically redirects the user to enough other sites, immediately
or after a short delay.</p>
     <li data-md>
      <p>The site redirects to sites that are classified as trackers, recursively.</p>
      <div class="example" id="example-safari-recursive-trackers">
       <a class="self-link" href="#example-safari-recursive-trackers"></a> 
       <p>For example, consider the case of a user clicking on a link on <code>start.example</code>, which redirects to <code>second.example</code>, which redirects to <code>third.example</code>, which redirects to <code>end.example</code>. If Safari has classified <code>third.example</code> as having tracking capabilities, the above behavior can
result in Safari classifying <code>second.example</code> as having cross-site tracking
capabilities.</p>
      </div>
    </ul>
    <p>If a user navigates or is redirected from a classified tracker with a URL that
includes either query parameters or a URL fragment, the lifetime of client-side
set cookies on the <em>destination</em> page is capped at <a href="https://webkit.org/tracking-prevention/#detection-of-cross-site-tracking-via-link-decoration">24
hours</a>.</p>
    <h4 class="heading settled" data-level="5.1.2" id="mitigations-firefox"><span class="secno">5.1.2. </span><span class="content">Firefox</span><a class="self-link" href="#mitigations-firefox"></a></h4>
    <p>Firefox uses a list-based approach to combat <a data-link-type="dfn" href="#navigational-tracking" id="ref-for-navigational-tracking⑨">navigational tracking</a>. Sites on the
Disconnect list are considered tracking sites. All storage
for tracking sites is cleared after 24 hours, unless the user has interacted
with the site in the first-party context in the last 45 days.</p>
    <p>Firefox is also starting to remove query parameters known to be used for
cross-site tracking. (<a data-link-type="biblio" href="#biblio-fsn-2021-q4" title="Firefox Security Newsletter 2021 Q4">[FSN-2021-Q4]</a>) The affected query parameters are chosen
using the criteria on the <a data-biblio-display="inline" data-link-type="biblio" href="https://wiki.mozilla.org/Security/Anti_tracking_policy"><cite>Mozilla Anti Tracking Policy</cite></a>, which includes:</p>
    <ul>
     <li data-md>
      <p>High-entropy parameters that might identify a user or encode user data,
except:</p>
      <ul>
       <li data-md>
        <p>Parameters exclusively identifying specific elements or actions on the
navigating page (per-click or per-element identifiers), as long as those
parameters assign a different value to each click or element they are
identifying.</p>
       <li data-md>
        <p>Identifiers necessary to complete a user-initiated task such as logging in
or submitting a form.</p>
      </ul>
     <li data-md>
      <p>High-entropy parameters that are broadly included in nearly all outgoing
navigations from a site, even if the parameters don’t uniquely identify a
user.</p>
    </ul>
    <p>As of May 2022, this query-parameter stripping is applied by default in the
Firefox Nightly build, and planned to be enabled in strict <abbr title="Enhanced Tracking Protection">ETP</abbr> mode and in private browsing.</p>
    <h4 class="heading settled" data-level="5.1.3" id="mitigations-brave"><span class="secno">5.1.3. </span><span class="content">Brave</span><a class="self-link" href="#mitigations-brave"></a></h4>
     Brave uses four list-based approaches to combat <a data-link-type="dfn" href="#navigational-tracking" id="ref-for-navigational-tracking①⓪">navigational tracking</a>. 
    <p>First, Brave strips query parameters commonly used for <a data-link-type="dfn" href="#navigational-tracking" id="ref-for-navigational-tracking①①">navigational tracking</a> from URLs on navigation. This list is maintained by Brave.</p>
    <p>Second, by default, when i) the user is about to visit a list-identified
bounce-tracking URL, and ii) the current profile does not contain any cookies
or <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/webstorage.html#dom-localstorage" id="ref-for-dom-localstorage">localStorage</a></code> for that site, Brave will create a new, "ephemeral", empty storage
area for the site. This storage area persists as long as the user has
any top-level frames open for the site. As soon as the user has no
top-level frames for the labeled bounce-tracking site, the ephemeral storage
area is deleted.</p>
    <p>Third, in the non-default, "aggressive blocking" configuration, Brave uses
popular crowd-sourced filter lists (e.g., EasyList, EasyPrivacy, uBlock Origin)
to identify URLs that are used for bounce tracking, and will preempt the
navigation with an interstitial (similar to Google SafeBrowsing), giving
the user the option to continue the navigation or cancel it.</p>
    <p>Fourth, Brave uses a list-based approach for identifying bounce tracking
URLs where the destination URL is present in the URL of the intermediate
tracking URL. In such cases, Brave will skip the intermediate navigation
and request the destination URL instead. For example, if Brave
Browser observes the user about to navigate to the URL <code>https://tracker.example/bounce?dest=https://destination.example/</code>,
the browser might replace the navigation to <code>tracker.example/bounce</code>,
with a navigation to <code>https://destination.example/</code>. This list
is maintained by Brave, and is drawn from a mix of crowd-sourcing and
existing open-source projects.</p>
   </section>
   <h2 class="no-num heading settled" id="acknowledgements"><span class="content">Acknowledgements</span><a class="self-link" href="#acknowledgements"></a></h2>
   <p>Many thanks to the Privacy Community Group for many good discussions about this proposal.</p>
  </main>
  <div data-fill-with="conformance">
   <h2 class="no-ref no-num heading settled" id="w3c-conformance"><span class="content">Conformance</span><a class="self-link" href="#w3c-conformance"></a></h2>
   <h3 class="no-ref no-num heading settled" id="w3c-conventions"><span class="content">Document conventions</span><a class="self-link" href="#w3c-conventions"></a></h3>
   <p>Conformance requirements are expressed
    with a combination of descriptive assertions
    and RFC 2119 terminology.
    The key words “MUST”, “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”, “RECOMMENDED”, “MAY”, and “OPTIONAL”
    in the normative parts of this document
    are to be interpreted as described in RFC 2119.
    However, for readability,
    these words do not appear in all uppercase letters in this specification. </p>
   <p>All of the text of this specification is normative
    except sections explicitly marked as non-normative, examples, and notes. <a data-link-type="biblio" href="#biblio-rfc2119" title="Key words for use in RFCs to Indicate Requirement Levels">[RFC2119]</a> </p>
   <p>Examples in this specification are introduced with the words “for example”
    or are set apart from the normative text
    with <code>class="example"</code>,
    like this: </p>
   <div class="example" id="w3c-example">
    <a class="self-link" href="#w3c-example"></a> 
    <p>This is an example of an informative example. </p>
   </div>
   <p>Informative notes begin with the word “Note”
    and are set apart from the normative text
    with <code>class="note"</code>,
    like this: </p>
   <p class="note" role="note">Note, this is an informative note.</p>
   <h3 class="no-ref no-num heading settled" id="w3c-conformant-algorithms"><span class="content">Conformant Algorithms</span><a class="self-link" href="#w3c-conformant-algorithms"></a></h3>
   <p>Requirements phrased in the imperative as part of algorithms
    (such as "strip any leading space characters"
    or "return false and abort these steps")
    are to be interpreted with the meaning of the key word
    ("must", "should", "may", etc)
    used in introducing the algorithm. </p>
   <p>Conformance requirements phrased as algorithms or specific steps
    can be implemented in any manner,
    so long as the end result is equivalent.
    In particular, the algorithms defined in this specification
    are intended to be easy to understand
    and are not intended to be performant.
    Implementers are encouraged to optimize. </p>
  </div>
<script src="https://www.w3.org/scripts/TR/2021/fixup.js"></script>
  <h2 class="no-num no-ref heading settled" id="index"><span class="content">Index</span><a class="self-link" href="#index"></a></h2>
  <h3 class="no-num no-ref heading settled" id="index-defined-here"><span class="content">Terms defined by this specification</span><a class="self-link" href="#index-defined-here"></a></h3>
  <ul class="index">
   <li><a href="#bounce-tracking">Bounce tracking</a><span>, in § 3</span>
   <li><a href="#link-decoration">Link decoration</a><span>, in § 3</span>
   <li><a href="#navigational-tracking">Navigational tracking</a><span>, in § 3</span>
  </ul>
  <aside class="dfn-panel" data-for="term-for-attr-meta-http-equiv">
   <a href="https://html.spec.whatwg.org/multipage/semantics.html#attr-meta-http-equiv">https://html.spec.whatwg.org/multipage/semantics.html#attr-meta-http-equiv</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-attr-meta-http-equiv">3. Terminology</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-hyperlink">
   <a href="https://html.spec.whatwg.org/multipage/links.html#hyperlink">https://html.spec.whatwg.org/multipage/links.html#hyperlink</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-hyperlink">3. Terminology</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-the-iframe-element">
   <a href="https://html.spec.whatwg.org/multipage/iframe-embed-object.html#the-iframe-element">https://html.spec.whatwg.org/multipage/iframe-embed-object.html#the-iframe-element</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-the-iframe-element">3. Terminology</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dom-localstorage">
   <a href="https://html.spec.whatwg.org/multipage/webstorage.html#dom-localstorage">https://html.spec.whatwg.org/multipage/webstorage.html#dom-localstorage</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-localstorage">5.1.3. Brave</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dom-location">
   <a href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#dom-location">https://html.spec.whatwg.org/multipage/nav-history-apis.html#dom-location</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-location">3. Terminology</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-meta">
   <a href="https://html.spec.whatwg.org/multipage/semantics.html#meta">https://html.spec.whatwg.org/multipage/semantics.html#meta</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-meta">3. Terminology</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-attr-meta-http-equiv-keyword-refresh">
   <a href="https://html.spec.whatwg.org/multipage/semantics.html#attr-meta-http-equiv-keyword-refresh">https://html.spec.whatwg.org/multipage/semantics.html#attr-meta-http-equiv-keyword-refresh</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-attr-meta-http-equiv-keyword-refresh">3. Terminology</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-status.3xx">
   <a href="https://httpwg.org/specs/rfc7231.html#status.3xx">https://httpwg.org/specs/rfc7231.html#status.3xx</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-status.3xx">3. Terminology</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dfn-tracking">
   <a href="https://www.w3.org/TR/tracking-dnt/#dfn-tracking">https://www.w3.org/TR/tracking-dnt/#dfn-tracking</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dfn-tracking">1. Introduction</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-host-registrable-domain">
   <a href="https://url.spec.whatwg.org/#host-registrable-domain">https://url.spec.whatwg.org/#host-registrable-domain</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-host-registrable-domain">5.1.1. Safari</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-url">
   <a href="https://url.spec.whatwg.org/#concept-url">https://url.spec.whatwg.org/#concept-url</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-url">3. Terminology</a>
   </ul>
  </aside>
  <h3 class="no-num no-ref heading settled" id="index-defined-elsewhere"><span class="content">Terms defined by reference</span><a class="self-link" href="#index-defined-elsewhere"></a></h3>
  <ul class="index">
   <li>
    <a data-link-type="biblio">[HTML]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-attr-meta-http-equiv">http-equiv</span>
     <li><span class="dfn-paneled" id="term-for-hyperlink">hyperlink</span>
     <li><span class="dfn-paneled" id="term-for-the-iframe-element">iframe</span>
     <li><span class="dfn-paneled" id="term-for-dom-localstorage">localStorage</span>
     <li><span class="dfn-paneled" id="term-for-dom-location">location</span>
     <li><span class="dfn-paneled" id="term-for-meta">meta</span>
     <li><span class="dfn-paneled" id="term-for-attr-meta-http-equiv-keyword-refresh">refresh</span>
    </ul>
   <li>
    <a data-link-type="biblio">[HTTP]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-status.3xx">http 3xx statuses</span>
    </ul>
   <li>
    <a data-link-type="biblio">[TRACKING-DNT]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-dfn-tracking">tracking</span>
    </ul>
   <li>
    <a data-link-type="biblio">[URL]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-host-registrable-domain">registrable domain</span>
     <li><span class="dfn-paneled" id="term-for-concept-url">url</span>
    </ul>
  </ul>
  <h2 class="no-num no-ref heading settled" id="references"><span class="content">References</span><a class="self-link" href="#references"></a></h2>
  <h3 class="no-num no-ref heading settled" id="normative"><span class="content">Normative References</span><a class="self-link" href="#normative"></a></h3>
  <dl>
   <dt id="biblio-html">[HTML]
   <dd>Anne van Kesteren; et al. <a href="https://html.spec.whatwg.org/multipage/"><cite>HTML Standard</cite></a>. Living Standard. URL: <a href="https://html.spec.whatwg.org/multipage/">https://html.spec.whatwg.org/multipage/</a>
   <dt id="biblio-infra">[INFRA]
   <dd>Anne van Kesteren; Domenic Denicola. <a href="https://infra.spec.whatwg.org/"><cite>Infra Standard</cite></a>. Living Standard. URL: <a href="https://infra.spec.whatwg.org/">https://infra.spec.whatwg.org/</a>
   <dt id="biblio-rfc2119">[RFC2119]
   <dd>S. Bradner. <a href="https://datatracker.ietf.org/doc/html/rfc2119"><cite>Key words for use in RFCs to Indicate Requirement Levels</cite></a>. March 1997. Best Current Practice. URL: <a href="https://datatracker.ietf.org/doc/html/rfc2119">https://datatracker.ietf.org/doc/html/rfc2119</a>
   <dt id="biblio-url">[URL]
   <dd>Anne van Kesteren. <a href="https://url.spec.whatwg.org/"><cite>URL Standard</cite></a>. Living Standard. URL: <a href="https://url.spec.whatwg.org/">https://url.spec.whatwg.org/</a>
  </dl>
  <h3 class="no-num no-ref heading settled" id="informative"><span class="content">Informative References</span><a class="self-link" href="#informative"></a></h3>
  <dl>
   <dt id="biblio-fsn-2021-q4">[FSN-2021-Q4]
   <dd><a href="https://wiki.mozilla.org/Firefox_Security_Newsletter/FSN-2021-Q4"><cite>Firefox Security Newsletter 2021 Q4</cite></a>. 2022-03-09. URL: <a href="https://wiki.mozilla.org/Firefox_Security_Newsletter/FSN-2021-Q4">https://wiki.mozilla.org/Firefox_Security_Newsletter/FSN-2021-Q4</a>
   <dt id="biblio-mozilla-tracking-policy">[MOZILLA-TRACKING-POLICY]
   <dd><a href="https://wiki.mozilla.org/Security/Anti_tracking_policy"><cite>Mozilla Anti Tracking Policy</cite></a>. URL: <a href="https://wiki.mozilla.org/Security/Anti_tracking_policy">https://wiki.mozilla.org/Security/Anti_tracking_policy</a>
   <dt id="biblio-tracking-dnt">[TRACKING-DNT]
   <dd>Roy Fielding; David Singer. <a href="https://w3c.github.io/dnt/drafts/tracking-dnt.html"><cite>Tracking Preference Expression (DNT)</cite></a>. URL: <a href="https://w3c.github.io/dnt/drafts/tracking-dnt.html">https://w3c.github.io/dnt/drafts/tracking-dnt.html</a>
   <dt id="biblio-webkit-tracking-prevention">[WEBKIT-TRACKING-PREVENTION]
   <dd><a href="https://webkit.org/tracking-prevention/"><cite>Tracking Prevention in WebKit</cite></a>. URL: <a href="https://webkit.org/tracking-prevention/">https://webkit.org/tracking-prevention/</a>
  </dl>
  <h2 class="no-num no-ref heading settled" id="issues-index"><span class="content">Issues Index</span><a class="self-link" href="#issues-index"></a></h2>
  <div style="counter-reset:issue">
   <div class="issue"> Changing the numbers changes what map the user sees, and embedding
a user ID would not successfully transfer that user ID to the target site,
but it’s hard for an automated system inside a browser to prove
that, and even hard for humans reading the URL to be confident of it. <a href="https://github.com/privacycg/nav-tracking-mitigations/issues/4">[Issue #4]</a> <a class="issue-return" href="#issue-9458c4e5" title="Jump to section">↵</a></div>
   <div class="issue"> The URL identifies an action rather than a page, and the user ID
might be essential for that action to happen. However, this is also clearly
a user ID and sufficient to track a user if the source and target
collaborate. <a href="https://github.com/privacycg/nav-tracking-mitigations/issues/5">[Issue #5]</a> <a class="issue-return" href="#issue-fc2127e1" title="Jump to section">↵</a></div>
   <div class="issue"> This is probably the same case as the unsubscribe link. <a href="https://github.com/privacycg/nav-tracking-mitigations/issues/5">[Issue #5]</a> <a class="issue-return" href="#issue-0c501704" title="Jump to section">↵</a></div>
  </div>
  <aside class="dfn-panel" data-for="link-decoration">
   <b><a href="#link-decoration">#link-decoration</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-link-decoration">1. Introduction</a> <a href="#ref-for-link-decoration①">(2)</a>
    <li><a href="#ref-for-link-decoration②">3. Terminology</a> <a href="#ref-for-link-decoration③">(2)</a> <a href="#ref-for-link-decoration④">(3)</a> <a href="#ref-for-link-decoration⑤">(4)</a> <a href="#ref-for-link-decoration⑥">(5)</a> <a href="#ref-for-link-decoration⑦">(6)</a> <a href="#ref-for-link-decoration⑧">(7)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="navigational-tracking">
   <b><a href="#navigational-tracking">#navigational-tracking</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-navigational-tracking">1. Introduction</a> <a href="#ref-for-navigational-tracking①">(2)</a>
    <li><a href="#ref-for-navigational-tracking②">3. Terminology</a> <a href="#ref-for-navigational-tracking③">(2)</a> <a href="#ref-for-navigational-tracking④">(3)</a> <a href="#ref-for-navigational-tracking⑤">(4)</a> <a href="#ref-for-navigational-tracking⑥">(5)</a>
    <li><a href="#ref-for-navigational-tracking⑦">5.1. Deployed Mitigations</a>
    <li><a href="#ref-for-navigational-tracking⑧">5.1.1. Safari</a>
    <li><a href="#ref-for-navigational-tracking⑨">5.1.2. Firefox</a>
    <li><a href="#ref-for-navigational-tracking①⓪">5.1.3. Brave</a> <a href="#ref-for-navigational-tracking①①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="bounce-tracking">
   <b><a href="#bounce-tracking">#bounce-tracking</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-bounce-tracking">3. Terminology</a>
   </ul>
  </aside>
<script>/* script-dfn-panel */

document.body.addEventListener("click", function(e) {
    var queryAll = function(sel) { return [].slice.call(document.querySelectorAll(sel)); }
    // Find the dfn element or panel, if any, that was clicked on.
    var el = e.target;
    var target;
    var hitALink = false;
    while(el.parentElement) {
        if(el.tagName == "A") {
            // Clicking on a link in a <dfn> shouldn't summon the panel
            hitALink = true;
        }
        if(el.classList.contains("dfn-paneled")) {
            target = "dfn";
            break;
        }
        if(el.classList.contains("dfn-panel")) {
            target = "dfn-panel";
            break;
        }
        el = el.parentElement;
    }
    if(target != "dfn-panel") {
        // Turn off any currently "on" or "activated" panels.
        queryAll(".dfn-panel.on, .dfn-panel.activated").forEach(function(el){
            el.classList.remove("on");
            el.classList.remove("activated");
        });
    }
    if(target == "dfn" && !hitALink) {
        // open the panel
        var dfnPanel = document.querySelector(".dfn-panel[data-for='" + el.id + "']");
        if(dfnPanel) {
            dfnPanel.classList.add("on");
            var rect = el.getBoundingClientRect();
            dfnPanel.style.left = window.scrollX + rect.right + 5 + "px";
            dfnPanel.style.top = window.scrollY + rect.top + "px";
            var panelRect = dfnPanel.getBoundingClientRect();
            var panelWidth = panelRect.right - panelRect.left;
            if(panelRect.right > document.body.scrollWidth && (rect.left - (panelWidth + 5)) > 0) {
                // Reposition, because the panel is overflowing
                dfnPanel.style.left = window.scrollX + rect.left - (panelWidth + 5) + "px";
            }
        } else {
            console.log("Couldn't find .dfn-panel[data-for='" + el.id + "']");
        }
    } else if(target == "dfn-panel") {
        // Switch it to "activated" state, which pins it.
        el.classList.add("activated");
        el.style.left = null;
        el.style.top = null;
    }

});
</script>