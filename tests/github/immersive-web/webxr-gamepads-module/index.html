<!doctype html><html lang="en">
 <head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
  <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
  <title>WebXR Gamepads Module - Level 1</title>
  <meta content="ED" name="w3c-status">
  <link href="https://www.w3.org/StyleSheets/TR/2021/W3C-ED" rel="stylesheet">
  <link href="https://www.w3.org/TR/webxr-gamepads-module-1/" rel="canonical">
  <meta content="dark light" name="color-scheme">
  <link href="https://www.w3.org/StyleSheets/TR/2021/dark.css" media="(prefers-color-scheme: dark)" rel="stylesheet" type="text/css">
  <link href="favicon-32x32.png" rel="icon" sizes="32x32" type="image/png">
  <link href="favicon-96x96.png" rel="icon" sizes="96x96" type="image/png">
<style>
  .unstable::before {
    content: "This section is not stable";
    display: block;
    font-weight: bold;
    text-align: right;
    color: red;
  }
  .unstable {
    border: thin solid pink;
    border-radius: .5em;
    padding: .5em;
    margin: .5em calc(-0.5em - 1px);
    background-image: url("data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' width='300' height='290'><text transform='rotate(-45)' text-anchor='middle' font-family='sans-serif' font-weight='bold' font-size='70' y='210' opacity='.1'>Unstable</text></svg>");
    background-repeat: repeat;
    background-color: #FFF4F4;
  }
  .unstable h3:first-of-type {
    margin-top: 0.5rem;
  }

  .unstable.example:not(.no-marker)::before {
    content: "Example " counter(example) " (Unstable)";
    float: none;
  }

  .non-normative::before {
    content: "This section is non-normative.";
    font-style: italic;
  }
  .tg {
    border-collapse: collapse;
    border-spacing: 0;
  }
  .tg th {
    border-style: solid;
    border-width: 1px;
    background: #90b8de;
    color: #fff;
    font-family: sans-serif;
    font-weight: bold;
    border-color: grey;
  }
  .tg td {
    padding: 4px 5px;
    background-color: rgb(221, 238, 255);
    font-family: monospace;
    border-style: solid;
    border-width: 1px;
    border-color: grey;
    overflow: hidden;
    word-break: normal;
  }
</style>
<style>/* Boilerplate: style-autolinks */
.css.css, .property.property, .descriptor.descriptor {
    color: var(--a-normal-text);
    font-size: inherit;
    font-family: inherit;
}
.css::before, .property::before, .descriptor::before {
    content: "‘";
}
.css::after, .property::after, .descriptor::after {
    content: "’";
}
.property, .descriptor {
    /* Don't wrap property and descriptor names */
    white-space: nowrap;
}
.type { /* CSS value <type> */
    font-style: italic;
}
pre .property::before, pre .property::after {
    content: "";
}
[data-link-type="property"]::before,
[data-link-type="propdesc"]::before,
[data-link-type="descriptor"]::before,
[data-link-type="value"]::before,
[data-link-type="function"]::before,
[data-link-type="at-rule"]::before,
[data-link-type="selector"]::before,
[data-link-type="maybe"]::before {
    content: "‘";
}
[data-link-type="property"]::after,
[data-link-type="propdesc"]::after,
[data-link-type="descriptor"]::after,
[data-link-type="value"]::after,
[data-link-type="function"]::after,
[data-link-type="at-rule"]::after,
[data-link-type="selector"]::after,
[data-link-type="maybe"]::after {
    content: "’";
}

[data-link-type].production::before,
[data-link-type].production::after,
.prod [data-link-type]::before,
.prod [data-link-type]::after {
    content: "";
}

[data-link-type=element],
[data-link-type=element-attr] {
    font-family: Menlo, Consolas, "DejaVu Sans Mono", monospace;
    font-size: .9em;
}
[data-link-type=element]::before { content: "<" }
[data-link-type=element]::after  { content: ">" }

[data-link-type=biblio] {
    white-space: pre;
}

@media (prefers-color-scheme: dark) {
    :root {
        --selflink-text: black;
        --selflink-bg: silver;
        --selflink-hover-text: white;
    }
}
</style>
<style>/* Boilerplate: style-colors */
/* Any --*-text not paired with a --*-bg is assumed to have a transparent bg */
:root {
    color-scheme: light dark;

    --text: black;
    --bg: white;

    --unofficial-watermark: url(https://www.w3.org/StyleSheets/TR/2016/logos/UD-watermark);

    --logo-bg: #1a5e9a;
    --logo-active-bg: #c00;
    --logo-text: white;

    --tocnav-normal-text: #707070;
    --tocnav-normal-bg: var(--bg);
    --tocnav-hover-text: var(--tocnav-normal-text);
    --tocnav-hover-bg: #f8f8f8;
    --tocnav-active-text: #c00;
    --tocnav-active-bg: var(--tocnav-normal-bg);

    --tocsidebar-text: var(--text);
    --tocsidebar-bg: #f7f8f9;
    --tocsidebar-shadow: rgba(0,0,0,.1);
    --tocsidebar-heading-text: hsla(203,20%,40%,.7);

    --toclink-text: var(--text);
    --toclink-underline: #3980b5;
    --toclink-visited-text: var(--toclink-text);
    --toclink-visited-underline: #054572;

    --heading-text: #005a9c;

    --hr-text: var(--text);

    --algo-border: #def;

    --del-text: red;
    --del-bg: transparent;
    --ins-text: #080;
    --ins-bg: transparent;

    --a-normal-text: #034575;
    --a-normal-underline: #bbb;
    --a-visited-text: var(--a-normal-text);
    --a-visited-underline: #707070;
    --a-hover-bg: rgba(75%, 75%, 75%, .25);
    --a-active-text: #c00;
    --a-active-underline: #c00;

    --blockquote-border: silver;
    --blockquote-bg: transparent;
    --blockquote-text: currentcolor;

    --issue-border: #e05252;
    --issue-bg: #fbe9e9;
    --issue-text: var(--text);
    --issueheading-text: #831616;

    --example-border: #e0cb52;
    --example-bg: #fcfaee;
    --example-text: var(--text);
    --exampleheading-text: #574b0f;

    --note-border: #52e052;
    --note-bg: #e9fbe9;
    --note-text: var(--text);
    --noteheading-text: hsl(120, 70%, 30%);
    --notesummary-underline: silver;

    --assertion-border: #aaa;
    --assertion-bg: #eee;
    --assertion-text: black;

    --advisement-border: orange;
    --advisement-bg: #fec;
    --advisement-text: var(--text);
    --advisementheading-text: #b35f00;

    --warning-border: red;
    --warning-bg: hsla(40,100%,50%,0.95);
    --warning-text: var(--text);

    --amendment-border: #330099;
    --amendment-bg: #F5F0FF;
    --amendment-text: var(--text);
    --amendmentheading-text: #220066;

    --def-border: #8ccbf2;
    --def-bg: #def;
    --def-text: var(--text);
    --defrow-border: #bbd7e9;

    --datacell-border: silver;

    --indexinfo-text: #707070;

    --indextable-hover-text: black;
    --indextable-hover-bg: #f7f8f9;

    --outdatedspec-bg: rgba(0, 0, 0, .5);
    --outdatedspec-text: black;
    --outdated-bg: maroon;
    --outdated-text: white;
    --outdated-shadow: red;

    --editedrec-bg: darkorange;
}

@media (prefers-color-scheme: dark) {
    :root {
        --text: #ddd;
        --bg: black;

        --unofficial-watermark: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='400'%3E%3Cg fill='%23100808' transform='translate(200 200) rotate(-45) translate(-200 -200)' stroke='%23100808' stroke-width='3'%3E%3Ctext x='50%25' y='220' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EUNOFFICIAL%3C/text%3E%3Ctext x='50%25' y='305' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EDRAFT%3C/text%3E%3C/g%3E%3C/svg%3E");

        --logo-bg: #1a5e9a;
        --logo-active-bg: #c00;
        --logo-text: white;

        --tocnav-normal-text: #999;
        --tocnav-normal-bg: var(--bg);
        --tocnav-hover-text: var(--tocnav-normal-text);
        --tocnav-hover-bg: #080808;
        --tocnav-active-text: #f44;
        --tocnav-active-bg: var(--tocnav-normal-bg);

        --tocsidebar-text: var(--text);
        --tocsidebar-bg: #080808;
        --tocsidebar-shadow: rgba(255,255,255,.1);
        --tocsidebar-heading-text: hsla(203,20%,40%,.7);

        --toclink-text: var(--text);
        --toclink-underline: #6af;
        --toclink-visited-text: var(--toclink-text);
        --toclink-visited-underline: #054572;

        --heading-text: #8af;

        --hr-text: var(--text);

        --algo-border: #456;

        --del-text: #f44;
        --del-bg: transparent;
        --ins-text: #4a4;
        --ins-bg: transparent;

        --a-normal-text: #6af;
        --a-normal-underline: #555;
        --a-visited-text: var(--a-normal-text);
        --a-visited-underline: var(--a-normal-underline);
        --a-hover-bg: rgba(25%, 25%, 25%, .2);
        --a-active-text: #f44;
        --a-active-underline: var(--a-active-text);

        --borderedblock-bg: rgba(255, 255, 255, .05);

        --blockquote-border: silver;
        --blockquote-bg: var(--borderedblock-bg);
        --blockquote-text: currentcolor;

        --issue-border: #e05252;
        --issue-bg: var(--borderedblock-bg);
        --issue-text: var(--text);
        --issueheading-text: hsl(0deg, 70%, 70%);

        --example-border: hsl(50deg, 90%, 60%);
        --example-bg: var(--borderedblock-bg);
        --example-text: var(--text);
        --exampleheading-text: hsl(50deg, 70%, 70%);

        --note-border: hsl(120deg, 100%, 35%);
        --note-bg: var(--borderedblock-bg);
        --note-text: var(--text);
        --noteheading-text: hsl(120, 70%, 70%);
        --notesummary-underline: silver;

        --assertion-border: #444;
        --assertion-bg: var(--borderedblock-bg);
        --assertion-text: var(--text);

        --advisement-border: orange;
        --advisement-bg: #222218;
        --advisement-text: var(--text);
        --advisementheading-text: #f84;

        --warning-border: red;
        --warning-bg: hsla(40,100%,20%,0.95);
        --warning-text: var(--text);

        --amendment-border: #330099;
        --amendment-bg: #080010;
        --amendment-text: var(--text);
        --amendmentheading-text: #cc00ff;

        --def-border: #8ccbf2;
        --def-bg: #080818;
        --def-text: var(--text);
        --defrow-border: #136;

        --datacell-border: silver;

        --indexinfo-text: #aaa;

        --indextable-hover-text: var(--text);
        --indextable-hover-bg: #181818;

        --outdatedspec-bg: rgba(255, 255, 255, .5);
        --outdatedspec-text: black;
        --outdated-bg: maroon;
        --outdated-text: white;
        --outdated-shadow: red;

        --editedrec-bg: darkorange;
    }
    /* In case a transparent-bg image doesn't expect to be on a dark bg,
       which is quite common in practice... */
    img { background: white; }
}
</style>
<style>/* Boilerplate: style-counters */
body {
    counter-reset: example figure issue;
}
.issue {
    counter-increment: issue;
}
.issue:not(.no-marker)::before {
    content: "Issue " counter(issue);
}

.example {
    counter-increment: example;
}
.example:not(.no-marker)::before {
    content: "Example " counter(example);
}
.invalid.example:not(.no-marker)::before,
.illegal.example:not(.no-marker)::before {
    content: "Invalid Example" counter(example);
}

figcaption {
    counter-increment: figure;
}
figcaption:not(.no-marker)::before {
    content: "Figure " counter(figure) " ";
}
</style>
<style>/* Boilerplate: style-dfn-panel */
:root {
    --dfnpanel-bg: #ddd;
    --dfnpanel-text: var(--text);
    --dfnpanel-target-bg: #ffc;
    --dfnpanel-target-outline: orange;
}
@media (prefers-color-scheme: dark) {
    :root {
        --dfnpanel-bg: #222;
        --dfnpanel-text: var(--text);
        --dfnpanel-target-bg: #333;
        --dfnpanel-target-outline: silver;
    }
}
.dfn-panel {
    position: absolute;
    z-index: 35;
    width: 20em;
    width: 300px;
    height: auto;
    max-height: 500px;
    overflow: auto;
    padding: 0.5em 0.75em;
    font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
    background: var(--dfnpanel-bg);
    color: var(--dfnpanel-text);
    border: outset 0.2em;
    white-space: normal; /* in case it's moved into a pre */
}
.dfn-panel:not(.on) { display: none; }
.dfn-panel * { margin: 0; padding: 0; text-indent: 0; }
.dfn-panel > b { display: block; }
.dfn-panel a { color: var(--dfnpanel-text); }
.dfn-panel a:not(:hover) { text-decoration: none !important; border-bottom: none !important; }
.dfn-panel a:focus {
    outline: 5px auto Highlight;
    outline: 5px auto -webkit-focus-ring-color;
}
.dfn-panel > b + b { margin-top: 0.25em; }
.dfn-panel ul { padding: 0 0 0 1em; list-style: none; }
.dfn-panel li a {
    max-width: calc(300px - 1.5em - 1em);
    overflow: hidden;
    text-overflow: ellipsis;
}

.dfn-panel.activated {
    display: inline-block;
    position: fixed;
    left: 8px;
    bottom: 2em;
    margin: 0 auto;
    max-width: calc(100vw - 1.5em - .4em - .5em);
    max-height: 30vh;
    transition: left 1s ease-out, bottom 1s ease-out;
}

.dfn-panel .link-item:hover {
    text-decoration: underline;
}
.dfn-panel .link-item .copy-icon {
    opacity: 0;
}
.dfn-panel .link-item:hover .copy-icon,
.dfn-panel .link-item .copy-icon:focus {
    opacity: 1;
}

.dfn-panel .copy-icon {
    display: inline-block;
    margin-right: 0.5em;
    width: 0.85em;
    height: 1em;
    border-radius: 3px;
    background-color: #ccc;
    cursor: pointer;
}

.dfn-panel .copy-icon .icon {
    width: 100%;
    height: 100%;
    background-color: #fff;
    display: flex;
    justify-content: center;
    align-items: center;
    position: relative;
}

.dfn-panel .copy-icon .icon::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    border: 1px solid black;
    background-color: #ccc;
    opacity: 0.25;
    transform: translate(3px, -3px);
}

.dfn-panel .copy-icon:active .icon::before {
    opacity: 1;
}

.dfn-paneled[role="button"] { cursor: help; }

.highlighted {
    animation: target-fade 3s;
}

@keyframes target-fade {
    from {
        background-color: var(--dfnpanel-target-bg);
        outline: 5px solid var(--dfnpanel-target-outline);
    }
    to {
        color: var(--a-normal-text);
        background-color: transparent;
        outline: transparent;
    }
}
</style>
<style>/* Boilerplate: style-idl-highlighting */
pre.idl.highlight {
    background: var(--borderedblock-bg, var(--def-bg));
}
</style>
<style>/* Boilerplate: style-issues */
a[href].issue-return {
    float: right;
    float: inline-end;
    color: var(--issueheading-text);
    font-weight: bold;
    text-decoration: none;
}
</style>
<style>/* Boilerplate: style-md-lists */
/* This is a weird hack for me not yet following the commonmark spec
   regarding paragraph and lists. */
[data-md] > :first-child {
    margin-top: 0;
}
[data-md] > :last-child {
    margin-bottom: 0;
}
</style>
<style>/* Boilerplate: style-ref-hints */
:root {
    --ref-hint-bg: #ddd;
    --ref-hint-text: var(--text);
}
@media (prefers-color-scheme: dark) {
    :root {
        --ref-hint-bg: #222;
        --ref-hint-text: var(--text);
    }
}

.ref-hint {
    display: inline-block;
    position: absolute;
    z-index: 35;
    width: 20em;
    width: 300px;
    height: auto;
    max-height: 500px;
    overflow: auto;
    padding: 0.5em 0.5em;
    font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
    background: var(--ref-hint-bg);
    color: var(--ref-hint-text);
    border: outset 0.2em;
    white-space: normal; /* in case it's moved into a pre */
}

.ref-hint * { margin: 0; padding: 0; text-indent: 0; }

.ref-hint ul { padding: 0 0 0 1em; list-style: none; }
</style>
<style>/* Boilerplate: style-selflinks */
:root {
    --selflink-text: white;
    --selflink-bg: gray;
    --selflink-hover-text: black;
}
.heading, .issue, .note, .example, li, dt {
    position: relative;
}
a.self-link {
    position: absolute;
    top: 0;
    left: calc(-1 * (3.5rem - 26px));
    width: calc(3.5rem - 26px);
    height: 2em;
    text-align: center;
    border: none;
    transition: opacity .2s;
    opacity: .5;
}
a.self-link:hover {
    opacity: 1;
}
.heading > a.self-link {
    font-size: 83%;
}
.example > a.self-link,
.note > a.self-link,
.issue > a.self-link {
    /* These blocks are overflow:auto, so positioning outside
       doesn't work. */
    left: auto;
    right: 0;
}
li > a.self-link {
    left: calc(-1 * (3.5rem - 26px) - 2em);
}
dfn > a.self-link {
    top: auto;
    left: auto;
    opacity: 0;
    width: 1.5em;
    height: 1.5em;
    background: var(--selflink-bg);
    color: var(--selflink-text);
    font-style: normal;
    transition: opacity .2s, background-color .2s, color .2s;
}
dfn:hover > a.self-link {
    opacity: 1;
}
dfn > a.self-link:hover {
    color: var(--selflink-hover-text);
}

a.self-link::before            { content: "¶"; }
.heading > a.self-link::before { content: "§"; }
dfn > a.self-link::before      { content: "#"; }
</style>
<style>/* Boilerplate: style-syntax-highlighting */
code.highlight { padding: .1em; border-radius: .3em; }
pre.highlight, pre > code.highlight { display: block; padding: 1em; margin: .5em 0; overflow: auto; border-radius: 0; }

.highlight:not(.idl) { background: rgba(0, 0, 0, .03); }
c-[a] { color: #990055 } /* Keyword.Declaration */
c-[b] { color: #990055 } /* Keyword.Type */
c-[c] { color: #708090 } /* Comment */
c-[d] { color: #708090 } /* Comment.Multiline */
c-[e] { color: #0077aa } /* Name.Attribute */
c-[f] { color: #669900 } /* Name.Tag */
c-[g] { color: #222222 } /* Name.Variable */
c-[k] { color: #990055 } /* Keyword */
c-[l] { color: #000000 } /* Literal */
c-[m] { color: #000000 } /* Literal.Number */
c-[n] { color: #0077aa } /* Name */
c-[o] { color: #999999 } /* Operator */
c-[p] { color: #999999 } /* Punctuation */
c-[s] { color: #a67f59 } /* Literal.String */
c-[t] { color: #a67f59 } /* Literal.String.Single */
c-[u] { color: #a67f59 } /* Literal.String.Double */
c-[cp] { color: #708090 } /* Comment.Preproc */
c-[c1] { color: #708090 } /* Comment.Single */
c-[cs] { color: #708090 } /* Comment.Special */
c-[kc] { color: #990055 } /* Keyword.Constant */
c-[kn] { color: #990055 } /* Keyword.Namespace */
c-[kp] { color: #990055 } /* Keyword.Pseudo */
c-[kr] { color: #990055 } /* Keyword.Reserved */
c-[ld] { color: #000000 } /* Literal.Date */
c-[nc] { color: #0077aa } /* Name.Class */
c-[no] { color: #0077aa } /* Name.Constant */
c-[nd] { color: #0077aa } /* Name.Decorator */
c-[ni] { color: #0077aa } /* Name.Entity */
c-[ne] { color: #0077aa } /* Name.Exception */
c-[nf] { color: #0077aa } /* Name.Function */
c-[nl] { color: #0077aa } /* Name.Label */
c-[nn] { color: #0077aa } /* Name.Namespace */
c-[py] { color: #0077aa } /* Name.Property */
c-[ow] { color: #999999 } /* Operator.Word */
c-[mb] { color: #000000 } /* Literal.Number.Bin */
c-[mf] { color: #000000 } /* Literal.Number.Float */
c-[mh] { color: #000000 } /* Literal.Number.Hex */
c-[mi] { color: #000000 } /* Literal.Number.Integer */
c-[mo] { color: #000000 } /* Literal.Number.Oct */
c-[sb] { color: #a67f59 } /* Literal.String.Backtick */
c-[sc] { color: #a67f59 } /* Literal.String.Char */
c-[sd] { color: #a67f59 } /* Literal.String.Doc */
c-[se] { color: #a67f59 } /* Literal.String.Escape */
c-[sh] { color: #a67f59 } /* Literal.String.Heredoc */
c-[si] { color: #a67f59 } /* Literal.String.Interpol */
c-[sx] { color: #a67f59 } /* Literal.String.Other */
c-[sr] { color: #a67f59 } /* Literal.String.Regex */
c-[ss] { color: #a67f59 } /* Literal.String.Symbol */
c-[vc] { color: #0077aa } /* Name.Variable.Class */
c-[vg] { color: #0077aa } /* Name.Variable.Global */
c-[vi] { color: #0077aa } /* Name.Variable.Instance */
c-[il] { color: #000000 } /* Literal.Number.Integer.Long */

@media (prefers-color-scheme: dark) {
    .highlight:not(.idl) { background: rgba(255, 255, 255, .05); }

    c-[a] { color: #d33682 } /* Keyword.Declaration */
    c-[b] { color: #d33682 } /* Keyword.Type */
    c-[c] { color: #2aa198 } /* Comment */
    c-[d] { color: #2aa198 } /* Comment.Multiline */
    c-[e] { color: #268bd2 } /* Name.Attribute */
    c-[f] { color: #b58900 } /* Name.Tag */
    c-[g] { color: #cb4b16 } /* Name.Variable */
    c-[k] { color: #d33682 } /* Keyword */
    c-[l] { color: #657b83 } /* Literal */
    c-[m] { color: #657b83 } /* Literal.Number */
    c-[n] { color: #268bd2 } /* Name */
    c-[o] { color: #657b83 } /* Operator */
    c-[p] { color: #657b83 } /* Punctuation */
    c-[s] { color: #6c71c4 } /* Literal.String */
    c-[t] { color: #6c71c4 } /* Literal.String.Single */
    c-[u] { color: #6c71c4 } /* Literal.String.Double */
    c-[ch] { color: #2aa198 } /* Comment.Hashbang */
    c-[cp] { color: #2aa198 } /* Comment.Preproc */
    c-[cpf] { color: #2aa198 } /* Comment.PreprocFile */
    c-[c1] { color: #2aa198 } /* Comment.Single */
    c-[cs] { color: #2aa198 } /* Comment.Special */
    c-[kc] { color: #d33682 } /* Keyword.Constant */
    c-[kn] { color: #d33682 } /* Keyword.Namespace */
    c-[kp] { color: #d33682 } /* Keyword.Pseudo */
    c-[kr] { color: #d33682 } /* Keyword.Reserved */
    c-[ld] { color: #657b83 } /* Literal.Date */
    c-[nc] { color: #268bd2 } /* Name.Class */
    c-[no] { color: #268bd2 } /* Name.Constant */
    c-[nd] { color: #268bd2 } /* Name.Decorator */
    c-[ni] { color: #268bd2 } /* Name.Entity */
    c-[ne] { color: #268bd2 } /* Name.Exception */
    c-[nf] { color: #268bd2 } /* Name.Function */
    c-[nl] { color: #268bd2 } /* Name.Label */
    c-[nn] { color: #268bd2 } /* Name.Namespace */
    c-[py] { color: #268bd2 } /* Name.Property */
    c-[ow] { color: #657b83 } /* Operator.Word */
    c-[mb] { color: #657b83 } /* Literal.Number.Bin */
    c-[mf] { color: #657b83 } /* Literal.Number.Float */
    c-[mh] { color: #657b83 } /* Literal.Number.Hex */
    c-[mi] { color: #657b83 } /* Literal.Number.Integer */
    c-[mo] { color: #657b83 } /* Literal.Number.Oct */
    c-[sa] { color: #6c71c4 } /* Literal.String.Affix */
    c-[sb] { color: #6c71c4 } /* Literal.String.Backtick */
    c-[sc] { color: #6c71c4 } /* Literal.String.Char */
    c-[dl] { color: #6c71c4 } /* Literal.String.Delimiter */
    c-[sd] { color: #6c71c4 } /* Literal.String.Doc */
    c-[se] { color: #6c71c4 } /* Literal.String.Escape */
    c-[sh] { color: #6c71c4 } /* Literal.String.Heredoc */
    c-[si] { color: #6c71c4 } /* Literal.String.Interpol */
    c-[sx] { color: #6c71c4 } /* Literal.String.Other */
    c-[sr] { color: #6c71c4 } /* Literal.String.Regex */
    c-[ss] { color: #6c71c4 } /* Literal.String.Symbol */
    c-[fm] { color: #268bd2 } /* Name.Function.Magic */
    c-[vc] { color: #cb4b16 } /* Name.Variable.Class */
    c-[vg] { color: #cb4b16 } /* Name.Variable.Global */
    c-[vi] { color: #cb4b16 } /* Name.Variable.Instance */
    c-[vm] { color: #cb4b16 } /* Name.Variable.Magic */
    c-[il] { color: #657b83 } /* Literal.Number.Integer.Long */
}
</style>
 <body class="h-entry">
  <div class="head">
   <p data-fill-with="logo"><a class="logo" href="https://www.w3.org/"> <img alt="W3C" height="48" src="https://www.w3.org/StyleSheets/TR/2021/logos/W3C" width="72"> </a> </p>
   <h1 class="p-name no-ref" id="title">WebXR Gamepads Module - Level 1</h1>
   <p id="w3c-state"><a href="https://www.w3.org/standards/types/#ED">Editor’s Draft</a>, <time class="dt-updated" datetime="1970-01-01">1 January 1970</time></p>
   <details open>
    <summary>More details about this document</summary>
    <div data-fill-with="spec-metadata">
     <dl>
      <dt>This version:
      <dd><a class="u-url" href="https://immersive-web.github.io/webxr-gamepads-module/">https://immersive-web.github.io/webxr-gamepads-module/</a>
      <dt>Latest published version:
      <dd><a href="https://www.w3.org/TR/webxr-gamepads-module-1/">https://www.w3.org/TR/webxr-gamepads-module-1/</a>
      <dt>Previous Versions:
      <dd><a href="https://www.w3.org/TR/2019/WD-webxr-gamepads-module-1-20191010/" rel="prev">https://www.w3.org/TR/2019/WD-webxr-gamepads-module-1-20191010/</a>
      <dt class="editor">Editors:
      <dd class="editor p-author h-card vcard" data-editor-id="87824"><a class="p-name fn u-email email" href="mailto:bajones@google.com">Brandon Jones</a> (<a class="p-org org" href="http://google.com/">Google</a>)
      <dd class="editor p-author h-card vcard" data-editor-id="93109"><a class="p-name fn u-email email" href="mailto:nhw@amazon.com">Nell Waliczek</a> (<a class="p-org org" href="https://amazon.com/">Amazon [Microsoft until 2018]</a>)
      <dt>Participate:
      <dd><a href="https://github.com/immersive-web/webxr-gamepads/issues/new">File an issue</a> (<a href="https://github.com/immersive-web/webxr-gamepads-module/issues">open issues</a>)
      <dd><a href="https://lists.w3.org/Archives/Public/public-immersive-web/">Mailing list archive</a>
      <dd><a href="irc://irc.w3.org:6665/">W3C’s #immersive-web IRC</a>
     </dl>
    </div>
   </details>
   <div data-fill-with="warning"></div>
   <p class="copyright" data-fill-with="copyright"><a href="https://www.w3.org/policies/#copyright">Copyright</a> © 1970 <a href="https://www.w3.org/">World Wide Web Consortium</a>. <abbr title="World Wide Web Consortium">W3C</abbr><sup>®</sup> <a href="https://www.w3.org/policies/#Legal_Disclaimer">liability</a>, <a href="https://www.w3.org/policies/#W3C_Trademarks">trademark</a> and <a href="https://www.w3.org/copyright/software-license/" rel="license" title="W3C Software and Document License">permissive document license</a> rules apply. </p>
   <hr title="Separator for header">
  </div>
  <div class="p-summary" data-fill-with="abstract">
   <h2 class="no-num no-toc no-ref heading settled" id="abstract"><span class="content">Abstract</span></h2>
   <p>This specification module describes support for accessing button, trigger, thumbstick, and touchpad data associated with virtual reality (VR) and augmented reality (AR) devices on the Web.</p>
  </div>
  <h2 class="no-num no-toc no-ref heading settled" id="sotd"><span class="content">Status of this document</span></h2>
  <div data-fill-with="status">
   <p> <em>This section describes the status of this document at the time of its publication. A list of current <abbr title="World Wide Web Consortium">W3C</abbr> publications and the latest revision of this
    technical report can be found in the <a href="http://www.w3.org/TR/"><abbr title="World Wide Web Consortium">W3C</abbr> technical
    reports index</a> at http://www.w3.org/TR/.</em> </p>
   <p> This document was published by the <a href="https://www.w3.org/groups/wg/immersive-web">Immersive Web Working Group</a> as an Editors' Draft. This document is intended to become a W3C Recommendation.

    Feedback and comments on this specification are welcome. Please use <a href="https://github.com/immersive-web/webxr-gamepads-module/issues">Github issues</a>.
    Discussions may also be found in the <a href="http://lists.w3.org/Archives/Public/public-immersive-web-wg/">public-immersive-web-wg@w3.org archives</a>. </p>
   <p> Publication as an Editors' Draft does not imply endorsement by <abbr title="World Wide Web Consortium">W3C</abbr> and its Members. This is a draft document and may
    be updated, replaced or obsoleted by other documents at any time. It is inappropriate to cite
    this document as other than work in progress. </p>
   <p> This document was produced by a group operating under the <a href="https://www.w3.org/policies/patent-policy/">W3C Patent Policy</a>.
    W3C maintains a <a href="https://www.w3.org/groups/wg/immersive-web/ipr" rel="disclosure">public list of any patent
    disclosures</a> made in connection with the deliverables of the group; that page also includes instructions for disclosing a patent. An individual who has actual knowledge of a patent which the individual believes contains <a href="https://www.w3.org/policies/patent-policy/#def-essential">Essential
    Claim(s)</a> must disclose the information in accordance with <a href="https://www.w3.org/policies/patent-policy/#sec-Disclosure">section
    6 of the W3C Patent Policy</a>. </p>
   <p> This document is governed by the <a href="https://www.w3.org/policies/process/20231103/" id="w3c_process_revision">03 November 2023 W3C Process Document</a>. </p>
   <p></p>
   <p>This WebXR Gamepads Module is designed as a module to be implemented in addition to <a href="https://www.w3.org/TR/webxr/">WebXR Device API</a>, and was originally included in WebXR Device API which was divided into core and modules.</p>
  </div>
  <div data-fill-with="at-risk"></div>
  <nav data-fill-with="table-of-contents" id="toc">
   <h2 class="no-num no-toc no-ref" id="contents">Table of Contents</h2>
   <ol class="toc" role="directory">
    <li>
     <a href="#intro"><span class="secno">1</span> <span class="content">Introduction</span></a>
     <ol class="toc">
      <li><a href="#terminology"><span class="secno">1.1</span> <span class="content">Terminology</span></a>
     </ol>
    <li>
     <a href="#webxr-device-api-integration"><span class="secno">2</span> <span class="content">WebXR Device API Integration</span></a>
     <ol class="toc">
      <li><a href="#xrinputsource-interface"><span class="secno">2.1</span> <span class="content">XRInputSource</span></a>
      <li><a href="#xrsession-interface"><span class="secno">2.2</span> <span class="content">XRSession</span></a>
     </ol>
    <li>
     <a href="#gamepad-api-integration"><span class="secno">3</span> <span class="content">Gamepad API Integration</span></a>
     <ol class="toc">
      <li><a href="#navigator-differences"><span class="secno">3.1</span> <span class="content">Navigator</span></a>
      <li><a href="#gamepad-differences"><span class="secno">3.2</span> <span class="content">Gamepad</span></a>
      <li><a href="#xr-standard-heading"><span class="secno">3.3</span> <span class="content"><span>"xr-standard" Gamepad Mapping</span></span></a>
     </ol>
    <li>
     <a href="#security"><span class="secno">4</span> <span class="content">Security and Privacy</span></a>
     <ol class="toc">
      <li><a href="#fingerprinting-security"><span class="secno">4.1</span> <span class="content">Fingerprinting</span></a>
     </ol>
    <li><a href="#ack"><span class="secno">5</span> <span class="content">Acknowledgements</span></a>
    <li>
     <a href="#w3c-conformance"><span class="secno"></span> <span class="content">Conformance</span></a>
     <ol class="toc">
      <li><a href="#w3c-conventions"><span class="secno"></span> <span class="content">Document conventions</span></a>
      <li><a href="#w3c-conformant-algorithms"><span class="secno"></span> <span class="content">Conformant Algorithms</span></a>
     </ol>
    <li>
     <a href="#index"><span class="secno"></span> <span class="content">Index</span></a>
     <ol class="toc">
      <li><a href="#index-defined-here"><span class="secno"></span> <span class="content">Terms defined by this specification</span></a>
      <li><a href="#index-defined-elsewhere"><span class="secno"></span> <span class="content">Terms defined by reference</span></a>
     </ol>
    <li>
     <a href="#references"><span class="secno"></span> <span class="content">References</span></a>
     <ol class="toc">
      <li><a href="#normative"><span class="secno"></span> <span class="content">Normative References</span></a>
     </ol>
    <li><a href="#idl-index"><span class="secno"></span> <span class="content">IDL Index</span></a>
   </ol>
  </nav>
  <main>
   <h2 class="heading settled" data-level="1" id="intro"><span class="secno">1. </span><span class="content">Introduction</span><a class="self-link" href="#intro"></a></h2>
   <section class="non-normative">
    <p>Hardware that enables Virtual Reality (VR) and Augmented Reality (AR) applications are now broadly available to consumers, offering an immersive computing platform with both new opportunities and challenges. The ability to interact directly with immersive hardware is critical to ensuring that the web is well equipped to operate as a first-class citizen in this environment. The WebXR Gamepads module adds interfaces and behaviors to the WebXR Device API and the Gamepads API to allow for querying the state of buttons, triggers, thumbsticks, and touchpads available as input sources on many WebXR compatible devices.</p>
   </section>
   <p>This module is an addition to the <a href="https://www.w3.org/TR/webxr/">WebXR Device API</a>.</p>
   <h3 class="heading settled" data-level="1.1" id="terminology"><span class="secno">1.1. </span><span class="content">Terminology</span><a class="self-link" href="#terminology"></a></h3>
   <p>This document uses the acronym <b>XR</b> throughout to refer to the spectrum of hardware, applications, and techniques used for Virtual Reality, Augmented Reality, and other related technologies. Examples include, but are not limited to:</p>
   <ul>
    <li data-md>
     <p>Head mounted displays, whether they are opaque, transparent, or utilize video passthrough</p>
    <li data-md>
     <p>Mobile devices with positional tracking</p>
    <li data-md>
     <p>Fixed displays with head tracking capabilities</p>
   </ul>
   <p>The important commonality between them being that they offer some degree of spatial tracking with which to simulate a view of virtual content.</p>
   <p>Terms like "XR Device", "XR Application", etc. are generally understood to apply to any of the above. Portions of this document that only apply to a subset of these devices will indicate so as appropriate.</p>
   <p>XR Devices often have additional controller hardware that allows users to interact with immersive experiences with button, trigger, thumbstick, or touchpad inputs. Frequently these devices are spatially tracked as well, and referred to as "motion controllers", "handheld controllers", or "tracked controllers".</p>
   <h2 class="heading settled" data-level="2" id="webxr-device-api-integration"><span class="secno">2. </span><span class="content">WebXR Device API Integration</span><a class="self-link" href="#webxr-device-api-integration"></a></h2>
    As defined in the <a href="https://www.w3.org/TR/webxr/">WebXR Device API API</a>, an <code class="idl"><a data-link-type="idl" href="https://immersive-web.github.io/webxr/#xrinputsource" id="ref-for-xrinputsource">XRInputSource</a></code> represents an <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="xr-input-source">XR input source</dfn>, which is any input mechanism which allows the user to perform targeted actions in the same virtual space as the <a data-link-type="dfn">viewer</a>. Example <a data-link-type="dfn" href="#xr-input-source" id="ref-for-xr-input-source">XR input source</a>s include, but are not limited to, handheld controllers, optically tracked hands, and gaze-based input methods that operate on the <a data-link-type="dfn">viewer</a>'s pose. 
   <p>This document outlines the behavior of an <code class="idl"><a data-link-type="idl" href="https://immersive-web.github.io/webxr/#xrinputsource" id="ref-for-xrinputsource①">XRInputSource</a></code> when it has button, trigger, thumbstick, or touchpad data to report. This is commonly a motion controller, but may also be headset with buttons, triggers, thumbsticks, or touchpads on the <a data-link-type="dfn">XR device</a>.  As stated in the WebXR device API, input mechanisms which are not explicitly associated with the <a data-link-type="dfn">XR Device</a>, such as traditional gamepads, MUST NOT be considered <a data-link-type="dfn" href="#xr-input-source" id="ref-for-xr-input-source①">XR input source</a>s.</p>
   <h3 class="heading settled" data-level="2.1" id="xrinputsource-interface"><span class="secno">2.1. </span><span class="content">XRInputSource</span><a class="self-link" href="#xrinputsource-interface"></a></h3>
   <p>Button, trigger, thumbstick, and touchpad data is reported though a <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/gamepad/#dom-gamepad" id="ref-for-dom-gamepad">Gamepad</a></code> object exposed on the <code class="idl"><a data-link-type="idl" href="https://immersive-web.github.io/webxr/#xrinputsource" id="ref-for-xrinputsource②">XRInputSource</a></code> it is associated with.</p>
<pre class="idl highlight def"><c- b>partial</c-> <c- b>interface</c-> <a class="idl-code" data-link-type="interface" href="https://immersive-web.github.io/webxr/#xrinputsource" id="ref-for-xrinputsource③"><c- g>XRInputSource</c-></a> {
  [<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#SameObject" id="ref-for-SameObject"><c- g>SameObject</c-></a>] <c- b>readonly</c-> <c- b>attribute</c-> <a data-link-type="idl-name" href="https://w3c.github.io/gamepad/#dom-gamepad" id="ref-for-dom-gamepad①"><c- n>Gamepad</c-></a>? <a class="idl-code" data-link-type="attribute" data-readonly data-type="Gamepad?" href="#dom-xrinputsource-gamepad" id="ref-for-dom-xrinputsource-gamepad"><c- g>gamepad</c-></a>;
};
</pre>
   <p>The <dfn class="dfn-paneled idl-code" data-dfn-for="XRInputSource" data-dfn-type="attribute" data-export id="dom-xrinputsource-gamepad"><code>gamepad</code></dfn> attribute is a <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/gamepad/#dom-gamepad" id="ref-for-dom-gamepad②">Gamepad</a></code> that describes the state of any buttons and axes on the <a data-link-type="dfn" href="#xr-input-source" id="ref-for-xr-input-source②">XR input source</a>. If the <a data-link-type="dfn" href="#xr-input-source" id="ref-for-xr-input-source③">XR input source</a> does not have at least one of the following properties, the <code class="idl"><a data-link-type="idl">gamepad</a></code> attribute MUST be <code>null</code>:</p>
   <ul>
    <li data-md>
     <p>A single button and a gripSpace</p>
    <li data-md>
     <p>More than one button</p>
    <li data-md>
     <p>One or more axes</p>
   </ul>
   <h3 class="heading settled" data-level="2.2" id="xrsession-interface"><span class="secno">2.2. </span><span class="content">XRSession</span><a class="self-link" href="#xrsession-interface"></a></h3>
   <p><code class="idl"><a data-link-type="idl" href="https://immersive-web.github.io/webxr/#xrinputsource" id="ref-for-xrinputsource④">XRInputSource</a></code>s are reported in the <code class="idl"><a data-link-type="idl" href="https://immersive-web.github.io/webxr/#dom-xrsession-inputsources" id="ref-for-dom-xrsession-inputsources">inputSources</a></code> array as they are connected and disconnected. When the presence of a <code class="idl"><a data-link-type="idl" href="#dom-xrinputsource-gamepad" id="ref-for-dom-xrinputsource-gamepad①">gamepad</a></code> changes for any entry in the <code class="idl"><a data-link-type="idl" href="https://immersive-web.github.io/webxr/#dom-xrsession-inputsources" id="ref-for-dom-xrsession-inputsources①">inputSources</a></code> array, the user agent MUST invoke the WebXR Device API’s algorithm for <a data-link-type="dfn">responding to input source attribute changes</a>.</p>
   <p>The <a data-link-type="dfn" href="https://www.w3.org/TR/webxr/#xrsession-list-of-frame-updates" id="ref-for-xrsession-list-of-frame-updates">list of frame updates</a> is updated to include <a data-link-type="dfn" href="#xrframe-apply-gamepad-frame-updates" id="ref-for-xrframe-apply-gamepad-frame-updates">apply gamepad frame updates</a>.</p>
   <p>To <dfn class="dfn-paneled" data-dfn-for="XRFrame" data-dfn-type="dfn" data-noexport id="xrframe-apply-gamepad-frame-updates">apply gamepad frame updates</dfn> for an <code class="idl"><a data-link-type="idl" href="https://immersive-web.github.io/webxr/#xrframe" id="ref-for-xrframe">XRFrame</a></code> <var>frame</var>, the user agent MUST run the following steps:</p>
   <ol>
    <li data-md>
     <p>For each <code class="idl"><a data-link-type="idl" href="https://immersive-web.github.io/webxr/#xrinputsource" id="ref-for-xrinputsource⑤">XRInputSource</a></code> with a <code class="idl"><a data-link-type="idl" href="#dom-xrinputsource-gamepad" id="ref-for-dom-xrinputsource-gamepad②">gamepad</a></code> <var>gamepad</var> associated with <var>frame</var>’s <code class="idl"><a data-link-type="idl" href="https://immersive-web.github.io/webxr/#dom-xrframe-session" id="ref-for-dom-xrframe-session">session</a></code>, perform the following steps:</p>
     <ol>
      <li data-md>
       <p>Update <var>gamepad</var> to reflect the gamepad data at <var>frame</var>’s <a data-link-type="dfn" href="https://www.w3.org/TR/webxr/#xrframe-time" id="ref-for-xrframe-time">time</a>.</p>
     </ol>
   </ol>
   <p class="note" role="note"><span class="marker">NOTE:</span> This means that the <code class="idl"><a data-link-type="idl" href="#dom-xrinputsource-gamepad" id="ref-for-dom-xrinputsource-gamepad③">gamepad</a></code> object is "live", and any internal state is to be updated in-place every frame. Furthermore, it doesn’t work to save a reference to an <code class="idl"><a data-link-type="idl" href="https://immersive-web.github.io/webxr/#xrinputsource" id="ref-for-xrinputsource⑥">XRInputSource</a></code>'s <code class="idl"><a data-link-type="idl">gamepad</a></code> on one frame and compare it to the same <code class="idl"><a data-link-type="idl" href="https://immersive-web.github.io/webxr/#xrinputsource" id="ref-for-xrinputsource⑦">XRInputSource</a></code>'s <code class="idl"><a data-link-type="idl">gamepad</a></code> from a subsequent frame to test for state changes, because they will be the same object. Therefore developers that wish to compare input state from frame to frame should cache the state in question.</p>
   <h2 class="heading settled" data-level="3" id="gamepad-api-integration"><span class="secno">3. </span><span class="content">Gamepad API Integration</span><a class="self-link" href="#gamepad-api-integration"></a></h2>
   <p><code class="idl"><a data-link-type="idl" href="https://w3c.github.io/gamepad/#dom-gamepad" id="ref-for-dom-gamepad③">Gamepad</a></code> instances returned by an <code class="idl"><a data-link-type="idl" href="https://immersive-web.github.io/webxr/#xrinputsource" id="ref-for-xrinputsource⑧">XRInputSource</a></code>'s <code class="idl"><a data-link-type="idl" href="#dom-xrinputsource-gamepad" id="ref-for-dom-xrinputsource-gamepad④">gamepad</a></code> attribute behave as described by the <a href="https://www.w3.org/TR/gamepad/">Gamepad API</a>, with several additional behavioral restrictions.</p>
   <h3 class="heading settled" data-level="3.1" id="navigator-differences"><span class="secno">3.1. </span><span class="content">Navigator</span><a class="self-link" href="#navigator-differences"></a></h3>
   <p>The <a href="https://www.w3.org/TR/gamepad/">Gamepad API</a> states a snapshot of <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/gamepad/#dom-gamepad" id="ref-for-dom-gamepad④">Gamepad</a></code> data can be retrieved by calling the <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/gamepad/#dom-navigator-getgamepads" id="ref-for-dom-navigator-getgamepads">navigator.getGamepads()</a></code> function. However, <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/gamepad/#dom-gamepad" id="ref-for-dom-gamepad⑤">Gamepad</a></code> instances returned by an <code class="idl"><a data-link-type="idl" href="https://immersive-web.github.io/webxr/#xrinputsource" id="ref-for-xrinputsource⑨">XRInputSource</a></code>'s <code class="idl"><a data-link-type="idl" href="#dom-xrinputsource-gamepad" id="ref-for-dom-xrinputsource-gamepad⑤">gamepad</a></code> attribute MUST NOT be included in the array returned by <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/gamepad/#dom-navigator-getgamepads" id="ref-for-dom-navigator-getgamepads①">navigator.getGamepads()</a></code>.</p>
   <h3 class="heading settled" data-level="3.2" id="gamepad-differences"><span class="secno">3.2. </span><span class="content">Gamepad</span><a class="self-link" href="#gamepad-differences"></a></h3>
   <p>The following <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/gamepad/#dom-gamepad" id="ref-for-dom-gamepad⑥">Gamepad</a></code> attributes MUST exhibit the following behavioral restrictions when the <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/gamepad/#dom-gamepad" id="ref-for-dom-gamepad⑦">Gamepad</a></code> has been returned by an <code class="idl"><a data-link-type="idl" href="https://immersive-web.github.io/webxr/#xrinputsource" id="ref-for-xrinputsource①⓪">XRInputSource</a></code>'s <code class="idl"><a data-link-type="idl" href="#dom-xrinputsource-gamepad" id="ref-for-dom-xrinputsource-gamepad⑥">gamepad</a></code> attribute.</p>
   <ul>
    <li data-md>
     <p><code class="idl"><a data-link-type="idl" href="#dom-xrinputsource-gamepad" id="ref-for-dom-xrinputsource-gamepad⑦">gamepad</a></code>'s <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/gamepad/#dom-gamepad-id" id="ref-for-dom-gamepad-id">id</a></code> attribute MUST be an empty string (<code>""</code>).</p>
    <li data-md>
     <p><code class="idl"><a data-link-type="idl" href="#dom-xrinputsource-gamepad" id="ref-for-dom-xrinputsource-gamepad⑧">gamepad</a></code>'s <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/gamepad/#dom-gamepad-index" id="ref-for-dom-gamepad-index">index</a></code> attribute MUST be <code>-1</code>.</p>
    <li data-md>
     <p><code class="idl"><a data-link-type="idl" href="#dom-xrinputsource-gamepad" id="ref-for-dom-xrinputsource-gamepad⑨">gamepad</a></code>'s <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/gamepad/#dom-gamepad-connected" id="ref-for-dom-gamepad-connected">connected</a></code> attribute MUST be <code>true</code> until the <code class="idl"><a data-link-type="idl" href="https://immersive-web.github.io/webxr/#xrinputsource" id="ref-for-xrinputsource①①">XRInputSource</a></code> is removed from the <a data-link-type="dfn">list of active XR input sources</a> or the <code class="idl"><a data-link-type="idl" href="https://immersive-web.github.io/webxr/#xrsession" id="ref-for-xrsession">XRSession</a></code> is ended.</p>
    <li data-md>
     <p>If an axis reported by the <code class="idl"><a data-link-type="idl" href="#dom-xrinputsource-gamepad" id="ref-for-dom-xrinputsource-gamepad①⓪">gamepad</a></code>'s <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/gamepad/#dom-gamepad-axes" id="ref-for-dom-gamepad-axes">axes</a></code> array represents an axis of a touchpad, the value MUST be <code>0</code> when the associated <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/gamepad/#dom-gamepadbutton" id="ref-for-dom-gamepadbutton">GamepadButton</a></code>'s <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/gamepad/#dom-gamepadbutton-touched" id="ref-for-dom-gamepadbutton-touched">touched</a></code> is <code>false</code>.</p>
   </ul>
   <h3 class="heading settled" data-level="3.3" id="xr-standard-heading"><span class="secno">3.3. </span><span class="content"><dfn class="dfn-paneled" data-dfn-type="dfn" data-export id="xr-standard-gamepad-mapping">"xr-standard" Gamepad Mapping</dfn></span><a class="self-link" href="#xr-standard-heading"></a></h3>
   <p>The <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/gamepad/#dom-gamepadmappingtype-xr-standard" id="ref-for-dom-gamepadmappingtype-xr-standard">"xr-standard"</a></code> mapping is defined in the <a href="https://www.w3.org/TR/gamepad/#dom-gamepadmappingtype">Gamepad API</a> and reserved for use by this spec. It indicates that the layout of the buttons and axes of the <code class="idl"><a data-link-type="idl" href="#dom-xrinputsource-gamepad" id="ref-for-dom-xrinputsource-gamepad①①">gamepad</a></code> corresponds as closely as possible to the tables below.</p>
   <p>In order to report a <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/gamepad/#dom-gamepad-mapping" id="ref-for-dom-gamepad-mapping">mapping</a></code> of <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/gamepad/#dom-gamepadmappingtype-xr-standard" id="ref-for-dom-gamepadmappingtype-xr-standard①">"xr-standard"</a></code> the device MUST report a <code class="idl"><a data-link-type="idl" href="https://immersive-web.github.io/webxr/#dom-xrinputsource-targetraymode" id="ref-for-dom-xrinputsource-targetraymode">targetRayMode</a></code> of <code class="idl"><a data-link-type="idl" href="https://immersive-web.github.io/webxr/#dom-xrtargetraymode-tracked-pointer" id="ref-for-dom-xrtargetraymode-tracked-pointer">"tracked-pointer"</a></code> and MUST have a non-<code>null</code> <code class="idl"><a data-link-type="idl" href="https://immersive-web.github.io/webxr/#dom-xrinputsource-gripspace" id="ref-for-dom-xrinputsource-gripspace">gripSpace</a></code>. It MUST have at least one <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="primary-trigger">primary trigger</dfn>, separate from any touchpads or thumbsticks. The <a data-link-type="dfn" href="#primary-trigger" id="ref-for-primary-trigger">primary trigger</a> MUST trigger the <a data-link-type="dfn">primary action</a> for the input source. The device MAY have a <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="primary-squeeze-button">primary squeeze button</dfn>, which, if present, MUST trigger the <a data-link-type="dfn">primary squeeze action</a> for the input source. If a device does not meet the requirements for the <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/gamepad/#dom-gamepadmappingtype-xr-standard" id="ref-for-dom-gamepadmappingtype-xr-standard②">"xr-standard"</a></code> mapping it may still expose a <code class="idl"><a data-link-type="idl" href="#dom-xrinputsource-gamepad" id="ref-for-dom-xrinputsource-gamepad①②">gamepad</a></code> with a <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/gamepad/#dom-gamepad-mapping" id="ref-for-dom-gamepad-mapping①">mapping</a></code> of <code>""</code> (empty string). The <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/gamepad/#dom-gamepadmappingtype-xr-standard" id="ref-for-dom-gamepadmappingtype-xr-standard③">"xr-standard"</a></code> mapping MUST only be used by <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/gamepad/#dom-gamepad" id="ref-for-dom-gamepad⑧">Gamepad</a></code> instances reported by an <code class="idl"><a data-link-type="idl" href="https://immersive-web.github.io/webxr/#xrinputsource" id="ref-for-xrinputsource①②">XRInputSource</a></code>.</p>
   <table class="tg">
    <thead>
     <tr>
      <th>Buttons
      <th><code>xr-standard</code> Mapping
      <th>Required
    <tbody>
     <tr>
      <td>buttons[0]
      <td><a data-link-type="dfn" href="#primary-trigger" id="ref-for-primary-trigger①">Primary trigger</a>
      <td>Yes
     <tr>
      <td>buttons[1]
      <td><a data-link-type="dfn" href="#primary-squeeze-button" id="ref-for-primary-squeeze-button">Primary squeeze button</a>
      <td>No
     <tr>
      <td>buttons[2]
      <td>Primary touchpad
      <td>No
     <tr>
      <td>buttons[3]
      <td>Primary thumbstick
      <td>No
   </table>
    <br> 
   <table class="tg">
    <thead>
     <tr>
      <th>Axes
      <th><code>xr-standard</code> Mapping
      <th>Required
    <tbody>
     <tr>
      <td>axes[0]
      <td>Primary touchpad X
      <td>No
     <tr>
      <td>axes[1]
      <td>Primary touchpad Y
      <td>No
     <tr>
      <td>axes[2]
      <td>Primary thumbstick X
      <td>No
     <tr>
      <td>axes[3]
      <td>Primary thumbstick Y
      <td>No
   </table>
   <p>Devices that lack one of the optional inputs listed in the tables above MUST preserve their place in the <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/gamepad/#dom-gamepad-buttons" id="ref-for-dom-gamepad-buttons">buttons</a></code> or <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/gamepad/#dom-gamepad-axes" id="ref-for-dom-gamepad-axes①">axes</a></code> array, reporting a <a data-link-type="dfn" href="#placeholder-button" id="ref-for-placeholder-button">placeholder button</a> or <a data-link-type="dfn" href="#placeholder-axis" id="ref-for-placeholder-axis">placeholder axis</a>, respectively. A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="placeholder-button">placeholder button</dfn> MUST report <code>0</code> for <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/gamepad/#dom-gamepadbutton-value" id="ref-for-dom-gamepadbutton-value">value</a></code>, <code>false</code> for <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/gamepad/#dom-gamepadbutton-pressed" id="ref-for-dom-gamepadbutton-pressed">pressed</a></code>, and <code>false</code> for <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/gamepad/#dom-gamepadbutton-touched" id="ref-for-dom-gamepadbutton-touched①">touched</a></code>. A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="placeholder-axis">placeholder axis</dfn> MUST report <code>0</code>. <a data-link-type="dfn" href="#placeholder-button" id="ref-for-placeholder-button①">Placeholder buttons</a> and <a data-link-type="dfn" href="#placeholder-axis" id="ref-for-placeholder-axis①">axes</a> MUST be omitted if they are the last element in the array or all following elements are also <a data-link-type="dfn" href="#placeholder-button" id="ref-for-placeholder-button②">placeholder buttons</a> or <a data-link-type="dfn" href="#placeholder-axis" id="ref-for-placeholder-axis②">axes</a>.</p>
   <p>Additional buttons or axes may be exposed after these reserved indices, and SHOULD appear in order of decreasing importance. Related axes (such as both axes of a thumbstick) MUST be grouped and, if applicable, MUST appear in X, Y, Z order. Buttons reserved by the UA or platform MUST NOT be exposed.</p>
   <section class="note"> This diagram demonstrates how two example controllers would be exposed with the <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/gamepad/#dom-gamepadmappingtype-xr-standard" id="ref-for-dom-gamepadmappingtype-xr-standard④">"xr-standard"</a></code> mapping. Images are not intended to represent any particular device and are used for reference purposes only. <img alt="Simple &apos;xr-standard&apos; controller and Advanced &apos;xr-standard&apos; controller" src="images/xr-standard-mapping.svg"> </section>
   <h2 class="heading settled" data-level="4" id="security"><span class="secno">4. </span><span class="content">Security and Privacy</span><a class="self-link" href="#security"></a></h2>
   <p>The WebXR Device API provides powerful new features which bring with them several unique privacy, security, and comfort risks that user agents must take steps to mitigate. This topic is covered in detail as part of the <a href="https://www.w3.org/TR/webxr/">WebXR Device API</a>. This module adds additional considerations, but does not change the fundamental <a href="https://immersive-web.github.io/webxr/#security">WebXR security and privacy</a> principles.</p>
   <h3 class="heading settled" data-level="4.1" id="fingerprinting-security"><span class="secno">4.1. </span><span class="content">Fingerprinting</span><a class="self-link" href="#fingerprinting-security"></a></h3>
   <p>Given that the API describes hardware available to the user and its capabilities it will inevitably provide additional surface area for fingerprinting. While it’s impossible to completely avoid this, user agents should take steps to mitigate the issue. As defined in the WebXR Device API, <code class="idl"><a data-link-type="idl" href="https://immersive-web.github.io/webxr/#xrinputsource" id="ref-for-xrinputsource①③">XRInputSource</a></code>s are only reported after an <code class="idl"><a data-link-type="idl" href="https://immersive-web.github.io/webxr/#xrsession" id="ref-for-xrsession①">XRSession</a></code> has been created, which requires additional protections when <a data-link-type="dfn">sensitive information</a> will be exposed. In addition, this module requires <code class="idl"><a data-link-type="idl" href="https://immersive-web.github.io/webxr/#xrinputsource" id="ref-for-xrinputsource①④">XRInputSource</a></code>'s <code class="idl"><a data-link-type="idl" href="#dom-xrinputsource-gamepad" id="ref-for-dom-xrinputsource-gamepad①③">gamepad</a></code>.<code class="idl"><a data-link-type="idl" href="https://w3c.github.io/gamepad/#dom-gamepad-id" id="ref-for-dom-gamepad-id①">id</a></code> to not report a string identifiers.</p>
   <h2 class="heading settled" data-level="5" id="ack"><span class="secno">5. </span><span class="content">Acknowledgements</span><a class="self-link" href="#ack"></a></h2>
   <p>The following individuals have contributed to the design of the WebXR Device API specification:</p>
   <ul>
    <li data-md>
     <p><a href="mailto:cvan@mozilla.com">Chris Van Wiemeersch</a> (<a href="https://mozilla.org/">Mozilla</a>)</p>
    <li data-md>
     <p><a href="mailto:kgilbert@mozilla.com">Kearwood Gilbert</a> (<a href="https://mozilla.org/">Mozilla</a>)</p>
    <li data-md>
     <p><a href="mailto:rafael.cintron@microsoft.com">Rafael Cintron</a> (<a href="https://microsoft.com/">Microsoft</a>)</p>
    <li data-md>
     <p><a href="mailto:sebastian.sylvan@gmail.com">Sebastian Sylvan</a> (Formerly <a href="https://microsoft.com/">Microsoft</a>)</p>
   </ul>
   <p>And a special thanks to <a href="mailto:vladv@unity3d.com">Vladimir Vukicevic</a> (<a href="https://unity3d.com/">Unity</a>) for kick-starting this whole adventure!</p>
  </main>
  <div data-fill-with="conformance">
   <h2 class="no-ref no-num heading settled" id="w3c-conformance"><span class="content">Conformance</span><a class="self-link" href="#w3c-conformance"></a></h2>
   <h3 class="no-ref no-num heading settled" id="w3c-conventions"><span class="content">Document conventions</span><a class="self-link" href="#w3c-conventions"></a></h3>
   <p>Conformance requirements are expressed
    with a combination of descriptive assertions
    and RFC 2119 terminology.
    The key words “MUST”, “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”, “RECOMMENDED”, “MAY”, and “OPTIONAL”
    in the normative parts of this document
    are to be interpreted as described in RFC 2119.
    However, for readability,
    these words do not appear in all uppercase letters in this specification. </p>
   <p>All of the text of this specification is normative
    except sections explicitly marked as non-normative, examples, and notes. <a data-link-type="biblio" href="#biblio-rfc2119" title="Key words for use in RFCs to Indicate Requirement Levels">[RFC2119]</a> </p>
   <p>Examples in this specification are introduced with the words “for example”
    or are set apart from the normative text
    with <code>class="example"</code>,
    like this: </p>
   <div class="example" id="w3c-example">
    <a class="self-link" href="#w3c-example"></a> 
    <p>This is an example of an informative example. </p>
   </div>
   <p>Informative notes begin with the word “Note”
    and are set apart from the normative text
    with <code>class="note"</code>,
    like this: </p>
   <p class="note" role="note">Note, this is an informative note.</p>
   <section>
    <h3 class="no-ref no-num heading settled" id="w3c-conformant-algorithms"><span class="content">Conformant Algorithms</span><a class="self-link" href="#w3c-conformant-algorithms"></a></h3>
    <p>Requirements phrased in the imperative as part of algorithms
    (such as "strip any leading space characters"
    or "return false and abort these steps")
    are to be interpreted with the meaning of the key word
    ("must", "should", "may", etc)
    used in introducing the algorithm. </p>
    <p>Conformance requirements phrased as algorithms or specific steps
    can be implemented in any manner,
    so long as the end result is equivalent.
    In particular, the algorithms defined in this specification
    are intended to be easy to understand
    and are not intended to be performant.
    Implementers are encouraged to optimize. </p>
   </section>
  </div>
  <script src="https://www.w3.org/scripts/TR/2021/fixup.js"></script>
  <h2 class="no-num no-ref heading settled" id="index"><span class="content">Index</span><a class="self-link" href="#index"></a></h2>
  <h3 class="no-num no-ref heading settled" id="index-defined-here"><span class="content">Terms defined by this specification</span><a class="self-link" href="#index-defined-here"></a></h3>
  <ul class="index">
   <li><a href="#xrframe-apply-gamepad-frame-updates">apply gamepad frame updates</a><span>, in § 2.2</span>
   <li><a href="#dom-xrinputsource-gamepad">gamepad</a><span>, in § 2.1</span>
   <li><a href="#placeholder-axis">placeholder axis</a><span>, in § 3.3</span>
   <li><a href="#placeholder-button">placeholder button</a><span>, in § 3.3</span>
   <li><a href="#primary-squeeze-button">primary squeeze button</a><span>, in § 3.3</span>
   <li><a href="#primary-trigger">primary trigger</a><span>, in § 3.3</span>
   <li><a href="#xr-input-source">XR input source</a><span>, in § 2</span>
   <li><a href="#xr-standard-gamepad-mapping">"xr-standard" Gamepad Mapping</a><span>, in § 3.3</span>
  </ul>
  <h3 class="no-num no-ref heading settled" id="index-defined-elsewhere"><span class="content">Terms defined by reference</span><a class="self-link" href="#index-defined-elsewhere"></a></h3>
  <ul class="index">
   <li>
    <a data-link-type="biblio">[GAMEPAD]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="112278c6">Gamepad</span>
     <li><span class="dfn-paneled" id="593ef156">GamepadButton</span>
     <li><span class="dfn-paneled" id="7cdbd791">axes</span>
     <li><span class="dfn-paneled" id="cab3b275">buttons</span>
     <li><span class="dfn-paneled" id="e91335ef">connected</span>
     <li><span class="dfn-paneled" id="4381f0e3">id</span>
     <li><span class="dfn-paneled" id="deacb1f5">index</span>
     <li><span class="dfn-paneled" id="a244f44c">mapping</span>
     <li><span class="dfn-paneled" id="38177d96">navigator.getGamepads()</span>
     <li><span class="dfn-paneled" id="c0cd2ef8">pressed</span>
     <li><span class="dfn-paneled" id="a9c8773c">touched</span>
     <li><span class="dfn-paneled" id="31f7debc">value</span>
     <li><span class="dfn-paneled" id="0c3a8579">xr-standard</span>
    </ul>
   <li>
    <a data-link-type="biblio">[WEBIDL]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="a5c91173">SameObject</span>
    </ul>
   <li>
    <a data-link-type="biblio">[WEBXR]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="42c26937">"tracked-pointer"</span>
     <li><span class="dfn-paneled" id="7a030114">XRFrame</span>
     <li><span class="dfn-paneled" id="ea90e02f">XRInputSource</span>
     <li><span class="dfn-paneled" id="b23556e5">XRSession</span>
     <li><span class="dfn-paneled" id="de78be73">gripSpace</span>
     <li><span class="dfn-paneled" id="4bb10651">inputSources</span>
     <li><span class="dfn-paneled" id="7c7eccf9">session</span>
     <li><span class="dfn-paneled" id="fb050ffc">targetRayMode</span>
    </ul>
   <li>
    <a data-link-type="biblio">[WEBXR DEVICE API - LEVEL 1]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="c5fba419">list of frame updates</span>
     <li><span class="dfn-paneled" id="a1afb5ed">time</span>
    </ul>
  </ul>
  <h2 class="no-num no-ref heading settled" id="references"><span class="content">References</span><a class="self-link" href="#references"></a></h2>
  <h3 class="no-num no-ref heading settled" id="normative"><span class="content">Normative References</span><a class="self-link" href="#normative"></a></h3>
  <dl>
   <dt id="biblio-gamepad">[GAMEPAD]
   <dd>Steve Agoston; Matthew Reynolds. <a href="https://w3c.github.io/gamepad/"><cite>Gamepad</cite></a>. URL: <a href="https://w3c.github.io/gamepad/">https://w3c.github.io/gamepad/</a>
   <dt id="biblio-rfc2119">[RFC2119]
   <dd>S. Bradner. <a href="https://datatracker.ietf.org/doc/html/rfc2119"><cite>Key words for use in RFCs to Indicate Requirement Levels</cite></a>. March 1997. Best Current Practice. URL: <a href="https://datatracker.ietf.org/doc/html/rfc2119">https://datatracker.ietf.org/doc/html/rfc2119</a>
   <dt id="biblio-webidl">[WEBIDL]
   <dd>Edgar Chen; Timothy Gu. <a href="https://webidl.spec.whatwg.org/"><cite>Web IDL Standard</cite></a>. Living Standard. URL: <a href="https://webidl.spec.whatwg.org/">https://webidl.spec.whatwg.org/</a>
   <dt id="biblio-webxr">[WEBXR]
   <dd>Brandon Jones; Manish Goregaokar; Rik Cabanier. <a href="https://immersive-web.github.io/webxr/"><cite>WebXR Device API</cite></a>. URL: <a href="https://immersive-web.github.io/webxr/">https://immersive-web.github.io/webxr/</a>
  </dl>
  <h2 class="no-num no-ref heading settled" id="idl-index"><span class="content">IDL Index</span><a class="self-link" href="#idl-index"></a></h2>
<pre class="idl highlight def"><c- b>partial</c-> <c- b>interface</c-> <a class="idl-code" data-link-type="interface" href="https://immersive-web.github.io/webxr/#xrinputsource"><c- g>XRInputSource</c-></a> {
  [<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#SameObject"><c- g>SameObject</c-></a>] <c- b>readonly</c-> <c- b>attribute</c-> <a data-link-type="idl-name" href="https://w3c.github.io/gamepad/#dom-gamepad"><c- n>Gamepad</c-></a>? <a class="idl-code" data-link-type="attribute" data-readonly data-type="Gamepad?" href="#dom-xrinputsource-gamepad"><c- g>gamepad</c-></a>;
};

</pre>
<script>/* Boilerplate: script-dom-helper */
"use strict";
function query(sel) { return document.querySelector(sel); }

function queryAll(sel) { return [...document.querySelectorAll(sel)]; }

function iter(obj) {
	if(!obj) return [];
	var it = obj[Symbol.iterator];
	if(it) return it;
	return Object.entries(obj);
}

function mk(tagname, attrs, ...children) {
	const el = document.createElement(tagname);
	for(const [k,v] of iter(attrs)) {
		if(k.slice(0,3) == "_on") {
			const eventName = k.slice(3);
			el.addEventListener(eventName, v);
		} else if(k[0] == "_") {
			// property, not attribute
			el[k.slice(1)] = v;
		} else {
			if(v === false || v == null) {
        continue;
      } else if(v === true) {
        el.setAttribute(k, "");
        continue;
      } else {
  			el.setAttribute(k, v);
      }
		}
	}
	append(el, children);
	return el;
}

/* Create shortcuts for every known HTML element */
[
  "a",
  "abbr",
  "acronym",
  "address",
  "applet",
  "area",
  "article",
  "aside",
  "audio",
  "b",
  "base",
  "basefont",
  "bdo",
  "big",
  "blockquote",
  "body",
  "br",
  "button",
  "canvas",
  "caption",
  "center",
  "cite",
  "code",
  "col",
  "colgroup",
  "datalist",
  "dd",
  "del",
  "details",
  "dfn",
  "dialog",
  "div",
  "dl",
  "dt",
  "em",
  "embed",
  "fieldset",
  "figcaption",
  "figure",
  "font",
  "footer",
  "form",
  "frame",
  "frameset",
  "head",
  "header",
  "h1",
  "h2",
  "h3",
  "h4",
  "h5",
  "h6",
  "hr",
  "html",
  "i",
  "iframe",
  "img",
  "input",
  "ins",
  "kbd",
  "label",
  "legend",
  "li",
  "link",
  "main",
  "map",
  "mark",
  "meta",
  "meter",
  "nav",
  "nobr",
  "noscript",
  "object",
  "ol",
  "optgroup",
  "option",
  "output",
  "p",
  "param",
  "pre",
  "progress",
  "q",
  "s",
  "samp",
  "script",
  "section",
  "select",
  "small",
  "source",
  "span",
  "strike",
  "strong",
  "style",
  "sub",
  "summary",
  "sup",
  "table",
  "tbody",
  "td",
  "template",
  "textarea",
  "tfoot",
  "th",
  "thead",
  "time",
  "title",
  "tr",
  "u",
  "ul",
  "var",
  "video",
  "wbr",
  "xmp",
].forEach(tagname=>{
	mk[tagname] = (...args) => mk(tagname, ...args);
});

function* nodesFromChildList(children) {
	for(const child of children.flat(Infinity)) {
		if(child instanceof Node) {
			yield child;
		} else {
			yield new Text(child);
		}
	}
}
function append(el, ...children) {
	for(const child of nodesFromChildList(children)) {
		if(el instanceof Node) el.appendChild(child);
		else el.push(child);
	}
	return el;
}

function insertAfter(el, ...children) {
	for(const child of nodesFromChildList(children)) {
		el.parentNode.insertBefore(child, el.nextSibling);
	}
	return el;
}

function clearContents(el) {
	el.innerHTML = "";
	return el;
}

function parseHTML(markup) {
	if(markup.toLowerCase().trim().indexOf('<!doctype') === 0) {
		const doc = document.implementation.createHTMLDocument("");
		doc.documentElement.innerHTML = markup;
		return doc;
	} else {
		const el = mk.template({});
		el.innerHTML = markup;
		return el.content;
	}
}</script>
<script>/* Boilerplate: script-dfn-panel */
"use strict";
{
let dfnPanelData = {
"0c3a8579": {"dfnID":"0c3a8579","dfnText":"xr-standard","external":true,"refSections":[{"refs":[{"id":"ref-for-dom-gamepadmappingtype-xr-standard"},{"id":"ref-for-dom-gamepadmappingtype-xr-standard\u2460"},{"id":"ref-for-dom-gamepadmappingtype-xr-standard\u2461"},{"id":"ref-for-dom-gamepadmappingtype-xr-standard\u2462"},{"id":"ref-for-dom-gamepadmappingtype-xr-standard\u2463"}],"title":"3.3. \"xr-standard\" Gamepad Mapping"}],"url":"https://w3c.github.io/gamepad/#dom-gamepadmappingtype-xr-standard"},
"112278c6": {"dfnID":"112278c6","dfnText":"Gamepad","external":true,"refSections":[{"refs":[{"id":"ref-for-dom-gamepad"},{"id":"ref-for-dom-gamepad\u2460"},{"id":"ref-for-dom-gamepad\u2461"}],"title":"2.1. XRInputSource"},{"refs":[{"id":"ref-for-dom-gamepad\u2462"}],"title":"3. Gamepad API Integration"},{"refs":[{"id":"ref-for-dom-gamepad\u2463"},{"id":"ref-for-dom-gamepad\u2464"}],"title":"3.1. Navigator"},{"refs":[{"id":"ref-for-dom-gamepad\u2465"},{"id":"ref-for-dom-gamepad\u2466"}],"title":"3.2. Gamepad"},{"refs":[{"id":"ref-for-dom-gamepad\u2467"}],"title":"3.3. \"xr-standard\" Gamepad Mapping"}],"url":"https://w3c.github.io/gamepad/#dom-gamepad"},
"31f7debc": {"dfnID":"31f7debc","dfnText":"value","external":true,"refSections":[{"refs":[{"id":"ref-for-dom-gamepadbutton-value"}],"title":"3.3. \"xr-standard\" Gamepad Mapping"}],"url":"https://w3c.github.io/gamepad/#dom-gamepadbutton-value"},
"38177d96": {"dfnID":"38177d96","dfnText":"navigator.getGamepads()","external":true,"refSections":[{"refs":[{"id":"ref-for-dom-navigator-getgamepads"},{"id":"ref-for-dom-navigator-getgamepads\u2460"}],"title":"3.1. Navigator"}],"url":"https://w3c.github.io/gamepad/#dom-navigator-getgamepads"},
"42c26937": {"dfnID":"42c26937","dfnText":"\"tracked-pointer\"","external":true,"refSections":[{"refs":[{"id":"ref-for-dom-xrtargetraymode-tracked-pointer"}],"title":"3.3. \"xr-standard\" Gamepad Mapping"}],"url":"https://immersive-web.github.io/webxr/#dom-xrtargetraymode-tracked-pointer"},
"4381f0e3": {"dfnID":"4381f0e3","dfnText":"id","external":true,"refSections":[{"refs":[{"id":"ref-for-dom-gamepad-id"}],"title":"3.2. Gamepad"},{"refs":[{"id":"ref-for-dom-gamepad-id\u2460"}],"title":"4.1. Fingerprinting"}],"url":"https://w3c.github.io/gamepad/#dom-gamepad-id"},
"4bb10651": {"dfnID":"4bb10651","dfnText":"inputSources","external":true,"refSections":[{"refs":[{"id":"ref-for-dom-xrsession-inputsources"},{"id":"ref-for-dom-xrsession-inputsources\u2460"}],"title":"2.2. XRSession"}],"url":"https://immersive-web.github.io/webxr/#dom-xrsession-inputsources"},
"593ef156": {"dfnID":"593ef156","dfnText":"GamepadButton","external":true,"refSections":[{"refs":[{"id":"ref-for-dom-gamepadbutton"}],"title":"3.2. Gamepad"}],"url":"https://w3c.github.io/gamepad/#dom-gamepadbutton"},
"7a030114": {"dfnID":"7a030114","dfnText":"XRFrame","external":true,"refSections":[{"refs":[{"id":"ref-for-xrframe"}],"title":"2.2. XRSession"}],"url":"https://immersive-web.github.io/webxr/#xrframe"},
"7c7eccf9": {"dfnID":"7c7eccf9","dfnText":"session","external":true,"refSections":[{"refs":[{"id":"ref-for-dom-xrframe-session"}],"title":"2.2. XRSession"}],"url":"https://immersive-web.github.io/webxr/#dom-xrframe-session"},
"7cdbd791": {"dfnID":"7cdbd791","dfnText":"axes","external":true,"refSections":[{"refs":[{"id":"ref-for-dom-gamepad-axes"}],"title":"3.2. Gamepad"},{"refs":[{"id":"ref-for-dom-gamepad-axes\u2460"}],"title":"3.3. \"xr-standard\" Gamepad Mapping"}],"url":"https://w3c.github.io/gamepad/#dom-gamepad-axes"},
"a1afb5ed": {"dfnID":"a1afb5ed","dfnText":"time","external":true,"refSections":[{"refs":[{"id":"ref-for-xrframe-time"}],"title":"2.2. XRSession"}],"url":"https://www.w3.org/TR/webxr/#xrframe-time"},
"a244f44c": {"dfnID":"a244f44c","dfnText":"mapping","external":true,"refSections":[{"refs":[{"id":"ref-for-dom-gamepad-mapping"},{"id":"ref-for-dom-gamepad-mapping\u2460"}],"title":"3.3. \"xr-standard\" Gamepad Mapping"}],"url":"https://w3c.github.io/gamepad/#dom-gamepad-mapping"},
"a5c91173": {"dfnID":"a5c91173","dfnText":"SameObject","external":true,"refSections":[{"refs":[{"id":"ref-for-SameObject"}],"title":"2.1. XRInputSource"}],"url":"https://webidl.spec.whatwg.org/#SameObject"},
"a9c8773c": {"dfnID":"a9c8773c","dfnText":"touched","external":true,"refSections":[{"refs":[{"id":"ref-for-dom-gamepadbutton-touched"}],"title":"3.2. Gamepad"},{"refs":[{"id":"ref-for-dom-gamepadbutton-touched\u2460"}],"title":"3.3. \"xr-standard\" Gamepad Mapping"}],"url":"https://w3c.github.io/gamepad/#dom-gamepadbutton-touched"},
"b23556e5": {"dfnID":"b23556e5","dfnText":"XRSession","external":true,"refSections":[{"refs":[{"id":"ref-for-xrsession"}],"title":"3.2. Gamepad"},{"refs":[{"id":"ref-for-xrsession\u2460"}],"title":"4.1. Fingerprinting"}],"url":"https://immersive-web.github.io/webxr/#xrsession"},
"c0cd2ef8": {"dfnID":"c0cd2ef8","dfnText":"pressed","external":true,"refSections":[{"refs":[{"id":"ref-for-dom-gamepadbutton-pressed"}],"title":"3.3. \"xr-standard\" Gamepad Mapping"}],"url":"https://w3c.github.io/gamepad/#dom-gamepadbutton-pressed"},
"c5fba419": {"dfnID":"c5fba419","dfnText":"list of frame updates","external":true,"refSections":[{"refs":[{"id":"ref-for-xrsession-list-of-frame-updates"}],"title":"2.2. XRSession"}],"url":"https://www.w3.org/TR/webxr/#xrsession-list-of-frame-updates"},
"cab3b275": {"dfnID":"cab3b275","dfnText":"buttons","external":true,"refSections":[{"refs":[{"id":"ref-for-dom-gamepad-buttons"}],"title":"3.3. \"xr-standard\" Gamepad Mapping"}],"url":"https://w3c.github.io/gamepad/#dom-gamepad-buttons"},
"de78be73": {"dfnID":"de78be73","dfnText":"gripSpace","external":true,"refSections":[{"refs":[{"id":"ref-for-dom-xrinputsource-gripspace"}],"title":"3.3. \"xr-standard\" Gamepad Mapping"}],"url":"https://immersive-web.github.io/webxr/#dom-xrinputsource-gripspace"},
"deacb1f5": {"dfnID":"deacb1f5","dfnText":"index","external":true,"refSections":[{"refs":[{"id":"ref-for-dom-gamepad-index"}],"title":"3.2. Gamepad"}],"url":"https://w3c.github.io/gamepad/#dom-gamepad-index"},
"dom-xrinputsource-gamepad": {"dfnID":"dom-xrinputsource-gamepad","dfnText":"gamepad","external":false,"refSections":[{"refs":[{"id":"ref-for-dom-xrinputsource-gamepad"}],"title":"2.1. XRInputSource"},{"refs":[{"id":"ref-for-dom-xrinputsource-gamepad\u2460"},{"id":"ref-for-dom-xrinputsource-gamepad\u2461"},{"id":"ref-for-dom-xrinputsource-gamepad\u2462"}],"title":"2.2. XRSession"},{"refs":[{"id":"ref-for-dom-xrinputsource-gamepad\u2463"}],"title":"3. Gamepad API Integration"},{"refs":[{"id":"ref-for-dom-xrinputsource-gamepad\u2464"}],"title":"3.1. Navigator"},{"refs":[{"id":"ref-for-dom-xrinputsource-gamepad\u2465"},{"id":"ref-for-dom-xrinputsource-gamepad\u2466"},{"id":"ref-for-dom-xrinputsource-gamepad\u2467"},{"id":"ref-for-dom-xrinputsource-gamepad\u2468"},{"id":"ref-for-dom-xrinputsource-gamepad\u2460\u24ea"}],"title":"3.2. Gamepad"},{"refs":[{"id":"ref-for-dom-xrinputsource-gamepad\u2460\u2460"},{"id":"ref-for-dom-xrinputsource-gamepad\u2460\u2461"}],"title":"3.3. \"xr-standard\" Gamepad Mapping"},{"refs":[{"id":"ref-for-dom-xrinputsource-gamepad\u2460\u2462"}],"title":"4.1. Fingerprinting"}],"url":"#dom-xrinputsource-gamepad"},
"e91335ef": {"dfnID":"e91335ef","dfnText":"connected","external":true,"refSections":[{"refs":[{"id":"ref-for-dom-gamepad-connected"}],"title":"3.2. Gamepad"}],"url":"https://w3c.github.io/gamepad/#dom-gamepad-connected"},
"ea90e02f": {"dfnID":"ea90e02f","dfnText":"XRInputSource","external":true,"refSections":[{"refs":[{"id":"ref-for-xrinputsource"},{"id":"ref-for-xrinputsource\u2460"}],"title":"2. WebXR Device API Integration"},{"refs":[{"id":"ref-for-xrinputsource\u2461"},{"id":"ref-for-xrinputsource\u2462"}],"title":"2.1. XRInputSource"},{"refs":[{"id":"ref-for-xrinputsource\u2463"},{"id":"ref-for-xrinputsource\u2464"},{"id":"ref-for-xrinputsource\u2465"},{"id":"ref-for-xrinputsource\u2466"}],"title":"2.2. XRSession"},{"refs":[{"id":"ref-for-xrinputsource\u2467"}],"title":"3. Gamepad API Integration"},{"refs":[{"id":"ref-for-xrinputsource\u2468"}],"title":"3.1. Navigator"},{"refs":[{"id":"ref-for-xrinputsource\u2460\u24ea"},{"id":"ref-for-xrinputsource\u2460\u2460"}],"title":"3.2. Gamepad"},{"refs":[{"id":"ref-for-xrinputsource\u2460\u2461"}],"title":"3.3. \"xr-standard\" Gamepad Mapping"},{"refs":[{"id":"ref-for-xrinputsource\u2460\u2462"},{"id":"ref-for-xrinputsource\u2460\u2463"}],"title":"4.1. Fingerprinting"}],"url":"https://immersive-web.github.io/webxr/#xrinputsource"},
"fb050ffc": {"dfnID":"fb050ffc","dfnText":"targetRayMode","external":true,"refSections":[{"refs":[{"id":"ref-for-dom-xrinputsource-targetraymode"}],"title":"3.3. \"xr-standard\" Gamepad Mapping"}],"url":"https://immersive-web.github.io/webxr/#dom-xrinputsource-targetraymode"},
"placeholder-axis": {"dfnID":"placeholder-axis","dfnText":"placeholder axis","external":false,"refSections":[{"refs":[{"id":"ref-for-placeholder-axis"},{"id":"ref-for-placeholder-axis\u2460"},{"id":"ref-for-placeholder-axis\u2461"}],"title":"3.3. \"xr-standard\" Gamepad Mapping"}],"url":"#placeholder-axis"},
"placeholder-button": {"dfnID":"placeholder-button","dfnText":"placeholder button","external":false,"refSections":[{"refs":[{"id":"ref-for-placeholder-button"},{"id":"ref-for-placeholder-button\u2460"},{"id":"ref-for-placeholder-button\u2461"}],"title":"3.3. \"xr-standard\" Gamepad Mapping"}],"url":"#placeholder-button"},
"primary-squeeze-button": {"dfnID":"primary-squeeze-button","dfnText":"primary squeeze button","external":false,"refSections":[{"refs":[{"id":"ref-for-primary-squeeze-button"}],"title":"3.3. \"xr-standard\" Gamepad Mapping"}],"url":"#primary-squeeze-button"},
"primary-trigger": {"dfnID":"primary-trigger","dfnText":"primary trigger","external":false,"refSections":[{"refs":[{"id":"ref-for-primary-trigger"},{"id":"ref-for-primary-trigger\u2460"}],"title":"3.3. \"xr-standard\" Gamepad Mapping"}],"url":"#primary-trigger"},
"xr-input-source": {"dfnID":"xr-input-source","dfnText":"XR input source","external":false,"refSections":[{"refs":[{"id":"ref-for-xr-input-source"},{"id":"ref-for-xr-input-source\u2460"}],"title":"2. WebXR Device API Integration"},{"refs":[{"id":"ref-for-xr-input-source\u2461"},{"id":"ref-for-xr-input-source\u2462"}],"title":"2.1. XRInputSource"}],"url":"#xr-input-source"},
"xr-standard-gamepad-mapping": {"dfnID":"xr-standard-gamepad-mapping","dfnText":"\"xr-standard\" Gamepad Mapping","external":false,"refSections":[],"url":"#xr-standard-gamepad-mapping"},
"xrframe-apply-gamepad-frame-updates": {"dfnID":"xrframe-apply-gamepad-frame-updates","dfnText":"apply gamepad frame updates","external":false,"refSections":[{"refs":[{"id":"ref-for-xrframe-apply-gamepad-frame-updates"}],"title":"2.2. XRSession"}],"url":"#xrframe-apply-gamepad-frame-updates"},
};

document.addEventListener("DOMContentLoaded", ()=>{
    genAllDfnPanels();

    document.body.addEventListener("click", (e) => {
        // If not handled already, just hide all dfn panels.
        hideAllDfnPanels();
    });
});

window.addEventListener("resize", () => {
    // Pin any visible dfn panel
    queryAll(".dfn-panel.on, .dfn-panel.activated").forEach(el=>positionDfnPanel(el));
});

function genAllDfnPanels() {
    for(const panelData of Object.values(dfnPanelData)) {
        const dfnID = panelData.dfnID;
        const dfn = document.getElementById(dfnID);
        if(!dfn) {
            console.log(`Can't find dfn#${dfnID}.`, panelData);
            continue;
        }
        dfn.panelData = panelData;
        insertDfnPopupAction(dfn);
    }
}

function genDfnPanel(dfn, { dfnID, url, dfnText, refSections, external }) {
    const dfnPanel = mk.aside({
        class: "dfn-panel on",
        id: `infopanel-for-${dfnID}`,
        "data-for": dfnID,
        "aria-labelled-by":`infopaneltitle-for-${dfnID}`,
        },
        mk.span({id:`infopaneltitle-for-${dfnID}`, style:"display:none"},
            `Info about the '${dfnText}' ${external?"external":""} reference.`),
        mk.a({href:url, class:"dfn-link"}, url),
        refSections.length == 0 ? [] :
            mk.b({}, "Referenced in:"),
            mk.ul({},
                ...refSections.map(section=>
                    mk.li({},
                        ...section.refs.map((ref, refI)=>
                            [
                                mk.a({ href: `#${ref.id}` },
                                    (refI == 0) ? section.title : `(${refI + 1})`
                                ),
                                " ",
                            ]
                        ),
                    ),
                ),
            ),
        genLinkingSyntaxes(dfn),
    );

    dfnPanel.addEventListener('click', (event) => {
        if (event.target.nodeName == 'A') {
            scrollToTargetAndHighlight(event);
            pinDfnPanel(dfnPanel);
        }
        event.stopPropagation();
        refocusOnTarget(event);
    });
    dfnPanel.addEventListener('keydown', (event) => {
        if(event.keyCode == 27) { // Escape key
            hideDfnPanel({dfnPanel});
            event.stopPropagation();
            event.preventDefault();
        }
    });

    dfnPanel.dfn = dfn;
    dfn.dfnPanel = dfnPanel;
    return dfnPanel;
}



function hideAllDfnPanels() {
    // Delete the currently-active dfn panel.
    queryAll(".dfn-panel").forEach(dfnPanel=>hideDfnPanel({dfnPanel}));
}

function showDfnPanel(dfn) {
    hideAllDfnPanels(); // Only display one at a time.

    dfn.setAttribute("aria-expanded", "true");

    const dfnPanel = genDfnPanel(dfn, dfn.panelData);

    // Give the dfn a unique tabindex, and then
    // give all the tabbable panel bits successive indexes.
    let tabIndex = 100;
    dfn.tabIndex = tabIndex++;
    const tabbable = dfnPanel.querySelectorAll(":is(a, button)");
    for (const el of tabbable) {
        el.tabIndex = tabIndex++;
    }

    append(document.body, dfnPanel);
    positionDfnPanel(dfnPanel);
}

function positionDfnPanel(dfnPanel) {
    const dfn = dfnPanel.dfn;
    const dfnPos = getBounds(dfn);
    dfnPanel.style.top = dfnPos.bottom + "px";
    dfnPanel.style.left = dfnPos.left + "px";

    const panelPos = dfnPanel.getBoundingClientRect();
    const panelMargin = 8;
    const maxRight = document.body.parentNode.clientWidth - panelMargin;
    if (panelPos.right > maxRight) {
        const overflowAmount = panelPos.right - maxRight;
        const newLeft = Math.max(panelMargin, dfnPos.left - overflowAmount);
        dfnPanel.style.left = newLeft + "px";
    }
}

function pinDfnPanel(dfnPanel) {
    // Switch it to "activated" state, which pins it.
    dfnPanel.classList.add("activated");
    dfnPanel.style.position = "fixed";
    dfnPanel.style.left = null;
    dfnPanel.style.top = null;
}

function hideDfnPanel({dfn, dfnPanel}) {
    if(!dfnPanel) dfnPanel = dfn.dfnPanel;
    if(!dfn) dfn = dfnPanel.dfn;
    dfn.dfnPanel = undefined;
    dfnPanel.dfn = undefined;
    dfn.setAttribute("aria-expanded", "false");
    dfn.tabIndex = undefined;
    dfnPanel.remove()
}

function toggleDfnPanel(dfn) {
    if(dfn.dfnPanel) {
        hideDfnPanel(dfn);
    } else {
        showDfnPanel(dfn);
    }
}

function insertDfnPopupAction(dfn) {
    dfn.setAttribute('role', 'button');
    dfn.setAttribute('aria-expanded', 'false')
    dfn.tabIndex = 0;
    dfn.classList.add('has-dfn-panel');
    dfn.addEventListener('click', (event) => {
        toggleDfnPanel(dfn);
        event.stopPropagation();
    });
    dfn.addEventListener('keypress', (event) => {
        const kc = event.keyCode;
        // 32->Space, 13->Enter
        if(kc == 32 || kc == 13) {
            toggleDfnPanel(dfn);
            event.stopPropagation();
            event.preventDefault();
        }
    });
}

function refocusOnTarget(event) {
    const target = event.target;
    setTimeout(() => {
        // Refocus on the event.target element.
        // This is needed after browser scrolls to the destination.
        target.focus();
    });
}

// TODO: shared util
// Returns the root-level absolute position {left and top} of element.
function getBounds(el, relativeTo=document.body) {
    const relativeRect = relativeTo.getBoundingClientRect();
    const elRect = el.getBoundingClientRect();
    const top = elRect.top - relativeRect.top;
    const left = elRect.left - relativeRect.left;
    return {
        top,
        left,
        bottom: top + elRect.height,
        right: left + elRect.width,
    }
}

function scrollToTargetAndHighlight(event) {
    let hash = event.target.hash;
    if (hash) {
        hash = decodeURIComponent(hash.substring(1));
        const dest = document.getElementById(hash);
        if (dest) {
            dest.classList.add('highlighted');
            setTimeout(() => dest.classList.remove('highlighted'), 1000);
        }
    }
}

// Functions, divided by link type, that wrap an autolink's
// contents with the appropriate outer syntax.
// Alternately, a string naming another type they format
// the same as.
function needsFor(type) {
    switch(type) {
        case "descriptor":
        case "value":
        case "element-attr":
        case "attr-value":
        case "element-state":
        case "method":
        case "constructor":
        case "argument":
        case "attribute":
        case "const":
        case "dict-member":
        case "event":
        case "enum-value":
        case "stringifier":
        case "serializer":
        case "iterator":
        case "maplike":
        case "setlike":
        case "state":
        case "mode":
        case "context":
        case "facet": return true;

        default: return false;
    }
}
function refusesFor(type) {
    switch(type) {
        case "property":
        case "element":
        case "interface":
        case "namespace":
        case "callback":
        case "dictionary":
        case "enum":
        case "exception":
        case "typedef":
        case "http-header":
        case "permission": return true;

        default: return false;
    }
}
function linkFormatterFromType(type) {
    switch(type) {
        case 'scheme':
        case 'permission':
        case 'dfn': return (text) => `[=${text}=]`;

        case 'abstract-op': return (text) => `[\$${text}\$]`;

        case 'function':
        case 'at-rule':
        case 'selector':
        case 'value': return (text) => `''${text}''`;

        case 'http-header': return (text) => `[:${text}:]`;

        case 'interface':
        case 'constructor':
        case 'method':
        case 'argument':
        case 'attribute':
        case 'callback':
        case 'dictionary':
        case 'dict-member':
        case 'enum':
        case 'enum-value':
        case 'exception':
        case 'const':
        case 'typedef':
        case 'stringifier':
        case 'serializer':
        case 'iterator':
        case 'maplike':
        case 'setlike':
        case 'extended-attribute':
        case 'event':
        case 'idl': return (text) => `{{${text}}}`;

        case 'element-state':
        case 'element-attr':
        case 'attr-value':
        case 'element': return (element) => `<{${element}}>`;

        case 'grammar': return (text) => `${text} (within a <pre class=prod>)`;

        case 'type': return (text)=> `<<${text}>>`;

        case 'descriptor':
        case 'property': return (text) => `'${text}'`;

        default: return;
    };
};

function genLinkingSyntaxes(dfn) {
    if(dfn.tagName != "DFN") return;

    const type = dfn.getAttribute('data-dfn-type');
    if(!type) {
        console.log(`<dfn> doesn't have a data-dfn-type:`, dfn);
        return [];
    }

    // Return a function that wraps link text based on the type
    const linkFormatter = linkFormatterFromType(type);
    if(!linkFormatter) {
        console.log(`<dfn> has an unknown data-dfn-type:`, dfn);
        return [];
    }

    let ltAlts;
    if(dfn.hasAttribute('data-lt')) {
        ltAlts = dfn.getAttribute('data-lt')
            .split("|")
            .map(x=>x.trim());
    } else {
        ltAlts = [dfn.textContent.trim()];
    }
    if(type == "type") {
        // lt of "<foo>", but "foo" is the interior;
        // <<foo/bar>> is how you write it with a for,
        // not <foo/<bar>> or whatever.
        for(var i = 0; i < ltAlts.length; i++) {
            const lt = ltAlts[i];
            const match = /<(.*)>/.exec(lt);
            if(match) { ltAlts[i] = match[1]; }
        }
    }

    let forAlts;
    if(dfn.hasAttribute('data-dfn-for')) {
        forAlts = dfn.getAttribute('data-dfn-for')
            .split(",")
            .map(x=>x.trim());
    } else {
        forAlts = [''];
    }

    let linkingSyntaxes = [];
    if(!needsFor(type)) {
        for(const lt of ltAlts) {
            linkingSyntaxes.push(linkFormatter(lt));
        }
    }
    if(!refusesFor(type)) {
        for(const f of forAlts) {
            linkingSyntaxes.push(linkFormatter(`${f}/${ltAlts[0]}`))
        }
    }
    return [
        mk.b({}, 'Possible linking syntaxes:'),
        mk.ul({},
            ...linkingSyntaxes.map(link => {
                const copyLink = async () =>
                    await navigator.clipboard.writeText(link);
                return mk.li({},
                    mk.div({ class: 'link-item' },
                        mk.button({
                            class: 'copy-icon', title: 'Copy',
                            type: 'button',
                            _onclick: copyLink,
                            tabindex: 0,
                        }, mk.span({ class: 'icon' }) ),
                        mk.span({}, link)
                    )
                );
            })
        )
    ];
}
}
</script>
<script>/* Boilerplate: script-ref-hints */
"use strict";
{
let refsData = {
"#dom-xrinputsource-gamepad": {"displayText":"gamepad","export":true,"for_":["XRInputSource"],"level":"1","normative":true,"shortname":"webxr-gamepads-module","spec":"webxr-gamepads-module-1","status":"local","text":"gamepad","type":"attribute","url":"#dom-xrinputsource-gamepad"},
"#placeholder-axis": {"displayText":"placeholder axis","export":true,"for_":[],"level":"1","normative":true,"shortname":"webxr-gamepads-module","spec":"webxr-gamepads-module-1","status":"local","text":"placeholder axis","type":"dfn","url":"#placeholder-axis"},
"#placeholder-button": {"displayText":"placeholder button","export":true,"for_":[],"level":"1","normative":true,"shortname":"webxr-gamepads-module","spec":"webxr-gamepads-module-1","status":"local","text":"placeholder button","type":"dfn","url":"#placeholder-button"},
"#primary-squeeze-button": {"displayText":"primary squeeze button","export":true,"for_":[],"level":"1","normative":true,"shortname":"webxr-gamepads-module","spec":"webxr-gamepads-module-1","status":"local","text":"primary squeeze button","type":"dfn","url":"#primary-squeeze-button"},
"#primary-trigger": {"displayText":"primary trigger","export":true,"for_":[],"level":"1","normative":true,"shortname":"webxr-gamepads-module","spec":"webxr-gamepads-module-1","status":"local","text":"primary trigger","type":"dfn","url":"#primary-trigger"},
"#xr-input-source": {"displayText":"xr input source","export":true,"for_":[],"level":"1","normative":true,"shortname":"webxr-gamepads-module","spec":"webxr-gamepads-module-1","status":"local","text":"xr input source","type":"dfn","url":"#xr-input-source"},
"#xrframe-apply-gamepad-frame-updates": {"displayText":"apply gamepad frame updates","export":true,"for_":["XRFrame"],"level":"1","normative":true,"shortname":"webxr-gamepads-module","spec":"webxr-gamepads-module-1","status":"local","text":"apply gamepad frame updates","type":"dfn","url":"#xrframe-apply-gamepad-frame-updates"},
"https://immersive-web.github.io/webxr/#dom-xrframe-session": {"displayText":"session","export":true,"for_":["XRFrame"],"level":"1","normative":true,"shortname":"webxr","spec":"webxr","status":"current","text":"session","type":"attribute","url":"https://immersive-web.github.io/webxr/#dom-xrframe-session"},
"https://immersive-web.github.io/webxr/#dom-xrinputsource-gripspace": {"displayText":"gripSpace","export":true,"for_":["XRInputSource"],"level":"1","normative":true,"shortname":"webxr","spec":"webxr","status":"current","text":"gripSpace","type":"attribute","url":"https://immersive-web.github.io/webxr/#dom-xrinputsource-gripspace"},
"https://immersive-web.github.io/webxr/#dom-xrinputsource-targetraymode": {"displayText":"targetRayMode","export":true,"for_":["XRInputSource"],"level":"1","normative":true,"shortname":"webxr","spec":"webxr","status":"current","text":"targetRayMode","type":"attribute","url":"https://immersive-web.github.io/webxr/#dom-xrinputsource-targetraymode"},
"https://immersive-web.github.io/webxr/#dom-xrsession-inputsources": {"displayText":"inputSources","export":true,"for_":["XRSession"],"level":"1","normative":true,"shortname":"webxr","spec":"webxr","status":"current","text":"inputSources","type":"attribute","url":"https://immersive-web.github.io/webxr/#dom-xrsession-inputsources"},
"https://immersive-web.github.io/webxr/#dom-xrtargetraymode-tracked-pointer": {"displayText":"\"tracked-pointer\"","export":true,"for_":["XRTargetRayMode"],"level":"1","normative":true,"shortname":"webxr","spec":"webxr","status":"current","text":"\"tracked-pointer\"","type":"enum-value","url":"https://immersive-web.github.io/webxr/#dom-xrtargetraymode-tracked-pointer"},
"https://immersive-web.github.io/webxr/#xrframe": {"displayText":"XRFrame","export":true,"for_":[],"level":"1","normative":true,"shortname":"webxr","spec":"webxr","status":"current","text":"XRFrame","type":"interface","url":"https://immersive-web.github.io/webxr/#xrframe"},
"https://immersive-web.github.io/webxr/#xrinputsource": {"displayText":"XRInputSource","export":true,"for_":[],"level":"1","normative":true,"shortname":"webxr","spec":"webxr","status":"current","text":"XRInputSource","type":"interface","url":"https://immersive-web.github.io/webxr/#xrinputsource"},
"https://immersive-web.github.io/webxr/#xrsession": {"displayText":"XRSession","export":true,"for_":[],"level":"1","normative":true,"shortname":"webxr","spec":"webxr","status":"current","text":"XRSession","type":"interface","url":"https://immersive-web.github.io/webxr/#xrsession"},
"https://w3c.github.io/gamepad/#dom-gamepad": {"displayText":"Gamepad","export":true,"for_":[],"level":"","normative":true,"shortname":"gamepad","spec":"gamepad","status":"anchor-block","text":"Gamepad","type":"interface","url":"https://w3c.github.io/gamepad/#dom-gamepad"},
"https://w3c.github.io/gamepad/#dom-gamepad-axes": {"displayText":"axes","export":true,"for_":["Gamepad"],"level":"","normative":true,"shortname":"gamepad","spec":"gamepad","status":"anchor-block","text":"axes","type":"attribute","url":"https://w3c.github.io/gamepad/#dom-gamepad-axes"},
"https://w3c.github.io/gamepad/#dom-gamepad-buttons": {"displayText":"buttons","export":true,"for_":["Gamepad"],"level":"","normative":true,"shortname":"gamepad","spec":"gamepad","status":"anchor-block","text":"buttons","type":"attribute","url":"https://w3c.github.io/gamepad/#dom-gamepad-buttons"},
"https://w3c.github.io/gamepad/#dom-gamepad-connected": {"displayText":"connected","export":true,"for_":["Gamepad"],"level":"","normative":true,"shortname":"gamepad","spec":"gamepad","status":"anchor-block","text":"connected","type":"attribute","url":"https://w3c.github.io/gamepad/#dom-gamepad-connected"},
"https://w3c.github.io/gamepad/#dom-gamepad-id": {"displayText":"id","export":true,"for_":["Gamepad"],"level":"","normative":true,"shortname":"gamepad","spec":"gamepad","status":"anchor-block","text":"id","type":"attribute","url":"https://w3c.github.io/gamepad/#dom-gamepad-id"},
"https://w3c.github.io/gamepad/#dom-gamepad-index": {"displayText":"index","export":true,"for_":["Gamepad"],"level":"","normative":true,"shortname":"gamepad","spec":"gamepad","status":"anchor-block","text":"index","type":"attribute","url":"https://w3c.github.io/gamepad/#dom-gamepad-index"},
"https://w3c.github.io/gamepad/#dom-gamepad-mapping": {"displayText":"mapping","export":true,"for_":["Gamepad"],"level":"","normative":true,"shortname":"gamepad","spec":"gamepad","status":"anchor-block","text":"mapping","type":"attribute","url":"https://w3c.github.io/gamepad/#dom-gamepad-mapping"},
"https://w3c.github.io/gamepad/#dom-gamepadbutton": {"displayText":"GamepadButton","export":true,"for_":[],"level":"","normative":true,"shortname":"gamepad","spec":"gamepad","status":"anchor-block","text":"GamepadButton","type":"interface","url":"https://w3c.github.io/gamepad/#dom-gamepadbutton"},
"https://w3c.github.io/gamepad/#dom-gamepadbutton-pressed": {"displayText":"pressed","export":true,"for_":["GamepadButton"],"level":"","normative":true,"shortname":"gamepad","spec":"gamepad","status":"anchor-block","text":"pressed","type":"attribute","url":"https://w3c.github.io/gamepad/#dom-gamepadbutton-pressed"},
"https://w3c.github.io/gamepad/#dom-gamepadbutton-touched": {"displayText":"touched","export":true,"for_":["GamepadButton"],"level":"","normative":true,"shortname":"gamepad","spec":"gamepad","status":"anchor-block","text":"touched","type":"attribute","url":"https://w3c.github.io/gamepad/#dom-gamepadbutton-touched"},
"https://w3c.github.io/gamepad/#dom-gamepadbutton-value": {"displayText":"value","export":true,"for_":["GamepadButton"],"level":"","normative":true,"shortname":"gamepad","spec":"gamepad","status":"anchor-block","text":"value","type":"attribute","url":"https://w3c.github.io/gamepad/#dom-gamepadbutton-value"},
"https://w3c.github.io/gamepad/#dom-gamepadmappingtype-xr-standard": {"displayText":"xr-standard","export":true,"for_":["GamepadMappingType"],"level":"1","normative":true,"shortname":"gamepad","spec":"gamepad","status":"current","text":"xr-standard","type":"enum-value","url":"https://w3c.github.io/gamepad/#dom-gamepadmappingtype-xr-standard"},
"https://w3c.github.io/gamepad/#dom-navigator-getgamepads": {"displayText":"navigator.getGamepads()","export":true,"for_":[],"level":"","normative":true,"shortname":"gamepad","spec":"gamepad","status":"anchor-block","text":"navigator.getGamepads()","type":"method","url":"https://w3c.github.io/gamepad/#dom-navigator-getgamepads"},
"https://webidl.spec.whatwg.org/#SameObject": {"displayText":"SameObject","export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"SameObject","type":"extended-attribute","url":"https://webidl.spec.whatwg.org/#SameObject"},
"https://www.w3.org/TR/webxr/#xrframe-time": {"displayText":"time","export":true,"for_":["XRFrame"],"level":"","normative":true,"shortname":"webxr device api - level 1","spec":"webxr device api - level 1","status":"anchor-block","text":"time","type":"dfn","url":"https://www.w3.org/TR/webxr/#xrframe-time"},
"https://www.w3.org/TR/webxr/#xrsession-list-of-frame-updates": {"displayText":"list of frame updates","export":true,"for_":["XRSession"],"level":"","normative":true,"shortname":"webxr device api - level 1","spec":"webxr device api - level 1","status":"anchor-block","text":"list of frame updates","type":"dfn","url":"https://www.w3.org/TR/webxr/#xrsession-list-of-frame-updates"},
};

function mkRefHint(link, ref) {
    const linkText = link.textContent;
    let dfnTextElements = '';
    if (ref.displayText.toLowerCase() != linkText.toLowerCase()) {
        // Give the original term if it's being displayed in a different way.
        // But allow casing differences, they're insignificant.
        dfnTextElements =
            mk.li({},
                mk.b({}, "Term: "),
                mk.span({}, ref.displayText)
            );
    }
    const forList = ref.for_;
    let forListElements;
    if(forList.length == 0) {
        forListElements = [];
    } else if(forList.length == 1) {
        forListElements = mk.li({},
            mk.b({}, "For: "),
            mk.span({}, forList[0]),
        );
    } else {
        forListElements = mk.li({},
            mk.b({}, "For: "),
            mk.ul({},
                ...forList.map(forItem =>
                    mk.li({},
                        mk.span({}, forItem)
                    ),
                ),
            ),
        );
    }
    const url = ref.url;
    const safeUrl = encodeURIComponent(url);
    const hintPanel = mk.aside({
        class: "ref-hint",
        id: `ref-hint-for-${safeUrl}`,
        "data-for": url,
        "aria-labelled-by": `ref-hint-for-${safeUrl}`,
    },
        mk.ul({},
            dfnTextElements,
            mk.li({},
                mk.b({}, "URL: "),
                mk.a({ href: url, class: "ref" }, url),
            ),
            mk.li({},
                mk.b({}, "Type: "),
                mk.span({}, `${ref.type}`),
            ),
            mk.li({},
                mk.b({}, "Spec: "),
                mk.span({}, `${ref.spec ? ref.spec : ''}`),
            ),
            forListElements
        ),
    );
    hintPanel.forLink = link;
    setupRefHintEventListeners(link, hintPanel);
    return hintPanel;
}

function hideAllRefHints() {
    queryAll(".ref-hint").forEach(el=>hideRefHint(el));
}

function hideRefHint(refHint) {
    const link = refHint.forLink;
    link.setAttribute("aria-expanded", "false");
    if(refHint.teardownEventListeners) {
        refHint.teardownEventListeners();
    }
    refHint.remove();
}

function showRefHint(link) {
    if(link.classList.contains("dfn-link")) return;
    const url = link.getAttribute("href");
    const ref = refsData[url];
    if(!ref) return;

    hideAllRefHints(); // Only display one at this time.

    const refHint = mkRefHint(link, ref);
    append(document.body, refHint);
    link.setAttribute("aria-expanded", "true");
    positionRefHint(refHint);
}

function setupRefHintEventListeners(link, refHint) {
    if (refHint.teardownEventListeners) return;
    // Add event handlers to hide the refHint after the user moves away
    // from both the link and refHint, if not hovering either within one second.
    let timeout = null;
    const startHidingRefHint = (event) => {
        if (timeout) {
            clearTimeout(timeout);
        }
        timeout = setTimeout(() => {
            hideRefHint(refHint);
        }, 1000);
    }
    const resetHidingRefHint = (event) => {
        if (timeout) clearTimeout(timeout);
        timeout = null;
    };
    link.addEventListener("mouseleave", startHidingRefHint);
    link.addEventListener("mouseenter", resetHidingRefHint);
    link.addEventListener("blur", startHidingRefHint);
    link.addEventListener("focus", resetHidingRefHint);
    refHint.addEventListener("mouseleave", startHidingRefHint);
    refHint.addEventListener("mouseenter", resetHidingRefHint);
    refHint.addEventListener("blur", startHidingRefHint);
    refHint.addEventListener("focus", resetHidingRefHint);

    refHint.teardownEventListeners = () => {
        // remove event listeners
        resetHidingRefHint();
        link.removeEventListener("mouseleave", startHidingRefHint);
        link.removeEventListener("mouseenter", resetHidingRefHint);
        link.removeEventListener("blur", startHidingRefHint);
        link.removeEventListener("focus", resetHidingRefHint);
        refHint.removeEventListener("mouseleave", startHidingRefHint);
        refHint.removeEventListener("mouseenter", resetHidingRefHint);
        refHint.removeEventListener("blur", startHidingRefHint);
        refHint.removeEventListener("focus", resetHidingRefHint);
    };
}

function positionRefHint(refHint) {
    const link = refHint.forLink;
    const linkPos = getBounds(link);
    refHint.style.top = linkPos.bottom + "px";
    refHint.style.left = linkPos.left + "px";

    const panelPos = refHint.getBoundingClientRect();
    const panelMargin = 8;
    const maxRight = document.body.parentNode.clientWidth - panelMargin;
    if (panelPos.right > maxRight) {
        const overflowAmount = panelPos.right - maxRight;
        const newLeft = Math.max(panelMargin, linkPos.left - overflowAmount);
        refHint.style.left = newLeft + "px";
    }
}

// TODO: shared util
// Returns the root-level absolute position {left and top} of element.
function getBounds(el, relativeTo=document.body) {
    const relativeRect = relativeTo.getBoundingClientRect();
    const elRect = el.getBoundingClientRect();
    const top = elRect.top - relativeRect.top;
    const left = elRect.left - relativeRect.left;
    return {
        top,
        left,
        bottom: top + elRect.height,
        right: left + elRect.width,
    }
}

function showRefHintListener(e) {
    // If the target isn't in a link (or is a link),
    // just ignore it.
    let link = e.target.closest("a");
    if(!link) return;

    // If the target is in a ref-hint panel
    // (aka a link in the already-open one),
    // also just ignore it.
    if(link.closest(".ref-hint")) return;

    // Otherwise, show the panel for the link.
    showRefHint(link);
}

function hideAllHintsListener(e) {
    // If the click is inside a ref-hint panel, ignore it.
    if(e.target.closest(".ref-hint")) return;
    // Otherwise, close all the current panels.
    hideAllRefHints();
}

document.addEventListener("DOMContentLoaded", () => {
    document.body.addEventListener("mousedown", showRefHintListener);
    document.body.addEventListener("focus", showRefHintListener);

    document.body.addEventListener("click", hideAllHintsListener);
});

window.addEventListener("resize", () => {
    // Hide any open ref hint.
    hideAllRefHints();
});
}
</script>