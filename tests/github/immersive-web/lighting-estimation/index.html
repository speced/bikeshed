<!doctype html><html lang="en">
 <head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
  <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
  <title>WebXR Lighting Estimation API Level 1</title>
  <meta content="ED" name="w3c-status">
  <link href="https://www.w3.org/StyleSheets/TR/2021/W3C-ED" rel="stylesheet">
  <meta content="dark light" name="color-scheme">
  <link href="https://www.w3.org/StyleSheets/TR/2021/dark.css" media="(prefers-color-scheme: dark)" rel="stylesheet" type="text/css">
  <link href="favicon-32x32.png" rel="icon" sizes="32x32" type="image/png">
  <link href="favicon-96x96.png" rel="icon" sizes="96x96" type="image/png">
<style>
  .unstable::before {
    content: "This section is not stable";
    display: block;
    font-weight: bold;
    text-align: right;
    color: red;
  }
  .unstable {
    border: thin solid pink;
    border-radius: .5em;
    padding: .5em;
    margin: .5em calc(-0.5em - 1px);
    background-image: url("data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' width='300' height='290'><text transform='rotate(-45)' text-anchor='middle' font-family='sans-serif' font-weight='bold' font-size='70' y='210' opacity='.1'>Unstable</text></svg>");
    background-repeat: repeat;
    background-color: #FFF4F4;
  }
  .unstable h3:first-of-type {
    margin-top: 0.5rem;
  }

  .unstable.example:not(.no-marker)::before {
    content: "Example " counter(example) " (Unstable)";
    float: none;
  }

  .non-normative::before {
    content: "This section is non-normative.";
    font-style: italic;
  }
  .tg {
    border-collapse: collapse;
    border-spacing: 0;
  }
  .tg th {
    border-style: solid;
    border-width: 1px;
    background: #90b8de;
    color: #fff;
    font-family: sans-serif;
    font-weight: bold;
    border-color: grey;
  }
  .tg td {
    padding: 4px 5px;
    background-color: rgb(221, 238, 255);
    font-family: monospace;
    border-style: solid;
    border-width: 1px;
    border-color: grey;
    overflow: hidden;
    word-break: normal;
  }
</style>
<style>/* Boilerplate: style-autolinks */
.css.css, .property.property, .descriptor.descriptor {
    color: var(--a-normal-text);
    font-size: inherit;
    font-family: inherit;
}
.css::before, .property::before, .descriptor::before {
    content: "‘";
}
.css::after, .property::after, .descriptor::after {
    content: "’";
}
.property, .descriptor {
    /* Don't wrap property and descriptor names */
    white-space: nowrap;
}
.type { /* CSS value <type> */
    font-style: italic;
}
pre .property::before, pre .property::after {
    content: "";
}
[data-link-type="property"]::before,
[data-link-type="propdesc"]::before,
[data-link-type="descriptor"]::before,
[data-link-type="value"]::before,
[data-link-type="function"]::before,
[data-link-type="at-rule"]::before,
[data-link-type="selector"]::before,
[data-link-type="maybe"]::before {
    content: "‘";
}
[data-link-type="property"]::after,
[data-link-type="propdesc"]::after,
[data-link-type="descriptor"]::after,
[data-link-type="value"]::after,
[data-link-type="function"]::after,
[data-link-type="at-rule"]::after,
[data-link-type="selector"]::after,
[data-link-type="maybe"]::after {
    content: "’";
}

[data-link-type].production::before,
[data-link-type].production::after,
.prod [data-link-type]::before,
.prod [data-link-type]::after {
    content: "";
}

[data-link-type=element],
[data-link-type=element-attr] {
    font-family: Menlo, Consolas, "DejaVu Sans Mono", monospace;
    font-size: .9em;
}
[data-link-type=element]::before { content: "<" }
[data-link-type=element]::after  { content: ">" }

[data-link-type=biblio] {
    white-space: pre;
}

@media (prefers-color-scheme: dark) {
    :root {
        --selflink-text: black;
        --selflink-bg: silver;
        --selflink-hover-text: white;
    }
}
</style>
<style>/* Boilerplate: style-colors */
/* Any --*-text not paired with a --*-bg is assumed to have a transparent bg */
:root {
    color-scheme: light dark;

    --text: black;
    --bg: white;

    --unofficial-watermark: url(https://www.w3.org/StyleSheets/TR/2016/logos/UD-watermark);

    --logo-bg: #1a5e9a;
    --logo-active-bg: #c00;
    --logo-text: white;

    --tocnav-normal-text: #707070;
    --tocnav-normal-bg: var(--bg);
    --tocnav-hover-text: var(--tocnav-normal-text);
    --tocnav-hover-bg: #f8f8f8;
    --tocnav-active-text: #c00;
    --tocnav-active-bg: var(--tocnav-normal-bg);

    --tocsidebar-text: var(--text);
    --tocsidebar-bg: #f7f8f9;
    --tocsidebar-shadow: rgba(0,0,0,.1);
    --tocsidebar-heading-text: hsla(203,20%,40%,.7);

    --toclink-text: var(--text);
    --toclink-underline: #3980b5;
    --toclink-visited-text: var(--toclink-text);
    --toclink-visited-underline: #054572;

    --heading-text: #005a9c;

    --hr-text: var(--text);

    --algo-border: #def;

    --del-text: red;
    --del-bg: transparent;
    --ins-text: #080;
    --ins-bg: transparent;

    --a-normal-text: #034575;
    --a-normal-underline: #bbb;
    --a-visited-text: var(--a-normal-text);
    --a-visited-underline: #707070;
    --a-hover-bg: rgba(75%, 75%, 75%, .25);
    --a-active-text: #c00;
    --a-active-underline: #c00;

    --blockquote-border: silver;
    --blockquote-bg: transparent;
    --blockquote-text: currentcolor;

    --issue-border: #e05252;
    --issue-bg: #fbe9e9;
    --issue-text: var(--text);
    --issueheading-text: #831616;

    --example-border: #e0cb52;
    --example-bg: #fcfaee;
    --example-text: var(--text);
    --exampleheading-text: #574b0f;

    --note-border: #52e052;
    --note-bg: #e9fbe9;
    --note-text: var(--text);
    --noteheading-text: hsl(120, 70%, 30%);
    --notesummary-underline: silver;

    --assertion-border: #aaa;
    --assertion-bg: #eee;
    --assertion-text: black;

    --advisement-border: orange;
    --advisement-bg: #fec;
    --advisement-text: var(--text);
    --advisementheading-text: #b35f00;

    --warning-border: red;
    --warning-bg: hsla(40,100%,50%,0.95);
    --warning-text: var(--text);

    --amendment-border: #330099;
    --amendment-bg: #F5F0FF;
    --amendment-text: var(--text);
    --amendmentheading-text: #220066;

    --def-border: #8ccbf2;
    --def-bg: #def;
    --def-text: var(--text);
    --defrow-border: #bbd7e9;

    --datacell-border: silver;

    --indexinfo-text: #707070;

    --indextable-hover-text: black;
    --indextable-hover-bg: #f7f8f9;

    --outdatedspec-bg: rgba(0, 0, 0, .5);
    --outdatedspec-text: black;
    --outdated-bg: maroon;
    --outdated-text: white;
    --outdated-shadow: red;

    --editedrec-bg: darkorange;
}

@media (prefers-color-scheme: dark) {
    :root {
        --text: #ddd;
        --bg: black;

        --unofficial-watermark: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='400'%3E%3Cg fill='%23100808' transform='translate(200 200) rotate(-45) translate(-200 -200)' stroke='%23100808' stroke-width='3'%3E%3Ctext x='50%25' y='220' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EUNOFFICIAL%3C/text%3E%3Ctext x='50%25' y='305' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EDRAFT%3C/text%3E%3C/g%3E%3C/svg%3E");

        --logo-bg: #1a5e9a;
        --logo-active-bg: #c00;
        --logo-text: white;

        --tocnav-normal-text: #999;
        --tocnav-normal-bg: var(--bg);
        --tocnav-hover-text: var(--tocnav-normal-text);
        --tocnav-hover-bg: #080808;
        --tocnav-active-text: #f44;
        --tocnav-active-bg: var(--tocnav-normal-bg);

        --tocsidebar-text: var(--text);
        --tocsidebar-bg: #080808;
        --tocsidebar-shadow: rgba(255,255,255,.1);
        --tocsidebar-heading-text: hsla(203,20%,40%,.7);

        --toclink-text: var(--text);
        --toclink-underline: #6af;
        --toclink-visited-text: var(--toclink-text);
        --toclink-visited-underline: #054572;

        --heading-text: #8af;

        --hr-text: var(--text);

        --algo-border: #456;

        --del-text: #f44;
        --del-bg: transparent;
        --ins-text: #4a4;
        --ins-bg: transparent;

        --a-normal-text: #6af;
        --a-normal-underline: #555;
        --a-visited-text: var(--a-normal-text);
        --a-visited-underline: var(--a-normal-underline);
        --a-hover-bg: rgba(25%, 25%, 25%, .2);
        --a-active-text: #f44;
        --a-active-underline: var(--a-active-text);

        --borderedblock-bg: rgba(255, 255, 255, .05);

        --blockquote-border: silver;
        --blockquote-bg: var(--borderedblock-bg);
        --blockquote-text: currentcolor;

        --issue-border: #e05252;
        --issue-bg: var(--borderedblock-bg);
        --issue-text: var(--text);
        --issueheading-text: hsl(0deg, 70%, 70%);

        --example-border: hsl(50deg, 90%, 60%);
        --example-bg: var(--borderedblock-bg);
        --example-text: var(--text);
        --exampleheading-text: hsl(50deg, 70%, 70%);

        --note-border: hsl(120deg, 100%, 35%);
        --note-bg: var(--borderedblock-bg);
        --note-text: var(--text);
        --noteheading-text: hsl(120, 70%, 70%);
        --notesummary-underline: silver;

        --assertion-border: #444;
        --assertion-bg: var(--borderedblock-bg);
        --assertion-text: var(--text);

        --advisement-border: orange;
        --advisement-bg: #222218;
        --advisement-text: var(--text);
        --advisementheading-text: #f84;

        --warning-border: red;
        --warning-bg: hsla(40,100%,20%,0.95);
        --warning-text: var(--text);

        --amendment-border: #330099;
        --amendment-bg: #080010;
        --amendment-text: var(--text);
        --amendmentheading-text: #cc00ff;

        --def-border: #8ccbf2;
        --def-bg: #080818;
        --def-text: var(--text);
        --defrow-border: #136;

        --datacell-border: silver;

        --indexinfo-text: #aaa;

        --indextable-hover-text: var(--text);
        --indextable-hover-bg: #181818;

        --outdatedspec-bg: rgba(255, 255, 255, .5);
        --outdatedspec-text: black;
        --outdated-bg: maroon;
        --outdated-text: white;
        --outdated-shadow: red;

        --editedrec-bg: darkorange;
    }
    /* In case a transparent-bg image doesn't expect to be on a dark bg,
       which is quite common in practice... */
    img { background: white; }
}
</style>
<style>/* Boilerplate: style-counters */
body {
    counter-reset: example figure issue;
}
.issue {
    counter-increment: issue;
}
.issue:not(.no-marker)::before {
    content: "Issue " counter(issue);
}

.example {
    counter-increment: example;
}
.example:not(.no-marker)::before {
    content: "Example " counter(example);
}
.invalid.example:not(.no-marker)::before,
.illegal.example:not(.no-marker)::before {
    content: "Invalid Example" counter(example);
}

figcaption {
    counter-increment: figure;
}
figcaption:not(.no-marker)::before {
    content: "Figure " counter(figure) " ";
}
</style>
<style>/* Boilerplate: style-dfn-panel */
:root {
    --dfnpanel-bg: #ddd;
    --dfnpanel-text: var(--text);
    --dfnpanel-target-bg: #ffc;
    --dfnpanel-target-outline: orange;
}
@media (prefers-color-scheme: dark) {
    :root {
        --dfnpanel-bg: #222;
        --dfnpanel-text: var(--text);
        --dfnpanel-target-bg: #333;
        --dfnpanel-target-outline: silver;
    }
}
.dfn-panel {
    position: absolute;
    z-index: 35;
    width: 20em;
    width: 300px;
    height: auto;
    max-height: 500px;
    overflow: auto;
    padding: 0.5em 0.75em;
    font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
    background: var(--dfnpanel-bg);
    color: var(--dfnpanel-text);
    border: outset 0.2em;
    white-space: normal; /* in case it's moved into a pre */
}
.dfn-panel:not(.on) { display: none; }
.dfn-panel * { margin: 0; padding: 0; text-indent: 0; }
.dfn-panel > b { display: block; }
.dfn-panel a { color: var(--dfnpanel-text); }
.dfn-panel a:not(:hover) { text-decoration: none !important; border-bottom: none !important; }
.dfn-panel a:focus {
    outline: 5px auto Highlight;
    outline: 5px auto -webkit-focus-ring-color;
}
.dfn-panel > b + b { margin-top: 0.25em; }
.dfn-panel ul { padding: 0 0 0 1em; list-style: none; }
.dfn-panel li a {
    max-width: calc(300px - 1.5em - 1em);
    overflow: hidden;
    text-overflow: ellipsis;
}

.dfn-panel.activated {
    display: inline-block;
    position: fixed;
    left: 8px;
    bottom: 2em;
    margin: 0 auto;
    max-width: calc(100vw - 1.5em - .4em - .5em);
    max-height: 30vh;
    transition: left 1s ease-out, bottom 1s ease-out;
}

.dfn-panel .link-item:hover {
    text-decoration: underline;
}
.dfn-panel .link-item .copy-icon {
    opacity: 0;
}
.dfn-panel .link-item:hover .copy-icon,
.dfn-panel .link-item .copy-icon:focus {
    opacity: 1;
}

.dfn-panel .copy-icon {
    display: inline-block;
    margin-right: 0.5em;
    width: 0.85em;
    height: 1em;
    border-radius: 3px;
    background-color: #ccc;
    cursor: pointer;
}

.dfn-panel .copy-icon .icon {
    width: 100%;
    height: 100%;
    background-color: #fff;
    display: flex;
    justify-content: center;
    align-items: center;
    position: relative;
}

.dfn-panel .copy-icon .icon::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    border: 1px solid black;
    background-color: #ccc;
    opacity: 0.25;
    transform: translate(3px, -3px);
}

.dfn-panel .copy-icon:active .icon::before {
    opacity: 1;
}

.dfn-paneled[role="button"] { cursor: help; }

.highlighted {
    animation: target-fade 3s;
}

@keyframes target-fade {
    from {
        background-color: var(--dfnpanel-target-bg);
        outline: 5px solid var(--dfnpanel-target-outline);
    }
    to {
        color: var(--a-normal-text);
        background-color: transparent;
        outline: transparent;
    }
}
</style>
<style>/* Boilerplate: style-idl-highlighting */
pre.idl.highlight {
    background: var(--borderedblock-bg, var(--def-bg));
}
</style>
<style>/* Boilerplate: style-issues */
a[href].issue-return {
    float: right;
    float: inline-end;
    color: var(--issueheading-text);
    font-weight: bold;
    text-decoration: none;
}
</style>
<style>/* Boilerplate: style-md-lists */
/* This is a weird hack for me not yet following the commonmark spec
   regarding paragraph and lists. */
[data-md] > :first-child {
    margin-top: 0;
}
[data-md] > :last-child {
    margin-bottom: 0;
}
</style>
<style>/* Boilerplate: style-ref-hints */
:root {
    --ref-hint-bg: #ddd;
    --ref-hint-text: var(--text);
}
@media (prefers-color-scheme: dark) {
    :root {
        --ref-hint-bg: #222;
        --ref-hint-text: var(--text);
    }
}

.ref-hint {
    display: inline-block;
    position: absolute;
    z-index: 35;
    width: 20em;
    width: 300px;
    height: auto;
    max-height: 500px;
    overflow: auto;
    padding: 0.5em 0.5em;
    font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
    background: var(--ref-hint-bg);
    color: var(--ref-hint-text);
    border: outset 0.2em;
    white-space: normal; /* in case it's moved into a pre */
}

.ref-hint * { margin: 0; padding: 0; text-indent: 0; }

.ref-hint ul { padding: 0 0 0 1em; list-style: none; }
</style>
<style>/* Boilerplate: style-selflinks */
:root {
    --selflink-text: white;
    --selflink-bg: gray;
    --selflink-hover-text: black;
}
.heading, .issue, .note, .example, li, dt {
    position: relative;
}
a.self-link {
    position: absolute;
    top: 0;
    left: calc(-1 * (3.5rem - 26px));
    width: calc(3.5rem - 26px);
    height: 2em;
    text-align: center;
    border: none;
    transition: opacity .2s;
    opacity: .5;
}
a.self-link:hover {
    opacity: 1;
}
.heading > a.self-link {
    font-size: 83%;
}
.example > a.self-link,
.note > a.self-link,
.issue > a.self-link {
    /* These blocks are overflow:auto, so positioning outside
       doesn't work. */
    left: auto;
    right: 0;
}
li > a.self-link {
    left: calc(-1 * (3.5rem - 26px) - 2em);
}
dfn > a.self-link {
    top: auto;
    left: auto;
    opacity: 0;
    width: 1.5em;
    height: 1.5em;
    background: var(--selflink-bg);
    color: var(--selflink-text);
    font-style: normal;
    transition: opacity .2s, background-color .2s, color .2s;
}
dfn:hover > a.self-link {
    opacity: 1;
}
dfn > a.self-link:hover {
    color: var(--selflink-hover-text);
}

a.self-link::before            { content: "¶"; }
.heading > a.self-link::before { content: "§"; }
dfn > a.self-link::before      { content: "#"; }
</style>
<style>/* Boilerplate: style-syntax-highlighting */
code.highlight { padding: .1em; border-radius: .3em; }
pre.highlight, pre > code.highlight { display: block; padding: 1em; margin: .5em 0; overflow: auto; border-radius: 0; }

.highlight:not(.idl) { background: rgba(0, 0, 0, .03); }
c-[a] { color: #990055 } /* Keyword.Declaration */
c-[b] { color: #990055 } /* Keyword.Type */
c-[c] { color: #708090 } /* Comment */
c-[d] { color: #708090 } /* Comment.Multiline */
c-[e] { color: #0077aa } /* Name.Attribute */
c-[f] { color: #669900 } /* Name.Tag */
c-[g] { color: #222222 } /* Name.Variable */
c-[k] { color: #990055 } /* Keyword */
c-[l] { color: #000000 } /* Literal */
c-[m] { color: #000000 } /* Literal.Number */
c-[n] { color: #0077aa } /* Name */
c-[o] { color: #999999 } /* Operator */
c-[p] { color: #999999 } /* Punctuation */
c-[s] { color: #a67f59 } /* Literal.String */
c-[t] { color: #a67f59 } /* Literal.String.Single */
c-[u] { color: #a67f59 } /* Literal.String.Double */
c-[cp] { color: #708090 } /* Comment.Preproc */
c-[c1] { color: #708090 } /* Comment.Single */
c-[cs] { color: #708090 } /* Comment.Special */
c-[kc] { color: #990055 } /* Keyword.Constant */
c-[kn] { color: #990055 } /* Keyword.Namespace */
c-[kp] { color: #990055 } /* Keyword.Pseudo */
c-[kr] { color: #990055 } /* Keyword.Reserved */
c-[ld] { color: #000000 } /* Literal.Date */
c-[nc] { color: #0077aa } /* Name.Class */
c-[no] { color: #0077aa } /* Name.Constant */
c-[nd] { color: #0077aa } /* Name.Decorator */
c-[ni] { color: #0077aa } /* Name.Entity */
c-[ne] { color: #0077aa } /* Name.Exception */
c-[nf] { color: #0077aa } /* Name.Function */
c-[nl] { color: #0077aa } /* Name.Label */
c-[nn] { color: #0077aa } /* Name.Namespace */
c-[py] { color: #0077aa } /* Name.Property */
c-[ow] { color: #999999 } /* Operator.Word */
c-[mb] { color: #000000 } /* Literal.Number.Bin */
c-[mf] { color: #000000 } /* Literal.Number.Float */
c-[mh] { color: #000000 } /* Literal.Number.Hex */
c-[mi] { color: #000000 } /* Literal.Number.Integer */
c-[mo] { color: #000000 } /* Literal.Number.Oct */
c-[sb] { color: #a67f59 } /* Literal.String.Backtick */
c-[sc] { color: #a67f59 } /* Literal.String.Char */
c-[sd] { color: #a67f59 } /* Literal.String.Doc */
c-[se] { color: #a67f59 } /* Literal.String.Escape */
c-[sh] { color: #a67f59 } /* Literal.String.Heredoc */
c-[si] { color: #a67f59 } /* Literal.String.Interpol */
c-[sx] { color: #a67f59 } /* Literal.String.Other */
c-[sr] { color: #a67f59 } /* Literal.String.Regex */
c-[ss] { color: #a67f59 } /* Literal.String.Symbol */
c-[vc] { color: #0077aa } /* Name.Variable.Class */
c-[vg] { color: #0077aa } /* Name.Variable.Global */
c-[vi] { color: #0077aa } /* Name.Variable.Instance */
c-[il] { color: #000000 } /* Literal.Number.Integer.Long */

@media (prefers-color-scheme: dark) {
    .highlight:not(.idl) { background: rgba(255, 255, 255, .05); }

    c-[a] { color: #d33682 } /* Keyword.Declaration */
    c-[b] { color: #d33682 } /* Keyword.Type */
    c-[c] { color: #2aa198 } /* Comment */
    c-[d] { color: #2aa198 } /* Comment.Multiline */
    c-[e] { color: #268bd2 } /* Name.Attribute */
    c-[f] { color: #b58900 } /* Name.Tag */
    c-[g] { color: #cb4b16 } /* Name.Variable */
    c-[k] { color: #d33682 } /* Keyword */
    c-[l] { color: #657b83 } /* Literal */
    c-[m] { color: #657b83 } /* Literal.Number */
    c-[n] { color: #268bd2 } /* Name */
    c-[o] { color: #657b83 } /* Operator */
    c-[p] { color: #657b83 } /* Punctuation */
    c-[s] { color: #6c71c4 } /* Literal.String */
    c-[t] { color: #6c71c4 } /* Literal.String.Single */
    c-[u] { color: #6c71c4 } /* Literal.String.Double */
    c-[ch] { color: #2aa198 } /* Comment.Hashbang */
    c-[cp] { color: #2aa198 } /* Comment.Preproc */
    c-[cpf] { color: #2aa198 } /* Comment.PreprocFile */
    c-[c1] { color: #2aa198 } /* Comment.Single */
    c-[cs] { color: #2aa198 } /* Comment.Special */
    c-[kc] { color: #d33682 } /* Keyword.Constant */
    c-[kn] { color: #d33682 } /* Keyword.Namespace */
    c-[kp] { color: #d33682 } /* Keyword.Pseudo */
    c-[kr] { color: #d33682 } /* Keyword.Reserved */
    c-[ld] { color: #657b83 } /* Literal.Date */
    c-[nc] { color: #268bd2 } /* Name.Class */
    c-[no] { color: #268bd2 } /* Name.Constant */
    c-[nd] { color: #268bd2 } /* Name.Decorator */
    c-[ni] { color: #268bd2 } /* Name.Entity */
    c-[ne] { color: #268bd2 } /* Name.Exception */
    c-[nf] { color: #268bd2 } /* Name.Function */
    c-[nl] { color: #268bd2 } /* Name.Label */
    c-[nn] { color: #268bd2 } /* Name.Namespace */
    c-[py] { color: #268bd2 } /* Name.Property */
    c-[ow] { color: #657b83 } /* Operator.Word */
    c-[mb] { color: #657b83 } /* Literal.Number.Bin */
    c-[mf] { color: #657b83 } /* Literal.Number.Float */
    c-[mh] { color: #657b83 } /* Literal.Number.Hex */
    c-[mi] { color: #657b83 } /* Literal.Number.Integer */
    c-[mo] { color: #657b83 } /* Literal.Number.Oct */
    c-[sa] { color: #6c71c4 } /* Literal.String.Affix */
    c-[sb] { color: #6c71c4 } /* Literal.String.Backtick */
    c-[sc] { color: #6c71c4 } /* Literal.String.Char */
    c-[dl] { color: #6c71c4 } /* Literal.String.Delimiter */
    c-[sd] { color: #6c71c4 } /* Literal.String.Doc */
    c-[se] { color: #6c71c4 } /* Literal.String.Escape */
    c-[sh] { color: #6c71c4 } /* Literal.String.Heredoc */
    c-[si] { color: #6c71c4 } /* Literal.String.Interpol */
    c-[sx] { color: #6c71c4 } /* Literal.String.Other */
    c-[sr] { color: #6c71c4 } /* Literal.String.Regex */
    c-[ss] { color: #6c71c4 } /* Literal.String.Symbol */
    c-[fm] { color: #268bd2 } /* Name.Function.Magic */
    c-[vc] { color: #cb4b16 } /* Name.Variable.Class */
    c-[vg] { color: #cb4b16 } /* Name.Variable.Global */
    c-[vi] { color: #cb4b16 } /* Name.Variable.Instance */
    c-[vm] { color: #cb4b16 } /* Name.Variable.Magic */
    c-[il] { color: #657b83 } /* Literal.Number.Integer.Long */
}
</style>
<style>/* Boilerplate: style-var-click-highlighting */
/*
Colors were chosen in Lab using https://nixsensor.com/free-color-converter/
D50 2deg illuminant, L in [0,100], a and b in [-128, 128]
0 = lab(85,0,85)
1 = lab(85,80,30)
2 = lab(85,-40,40)
3 = lab(85,-50,0)
4 = lab(85,5,15)
5 = lab(85,-10,-50)
6 = lab(85,35,-15)

For darkmode:
0 = oklab(50%   0%  108%)
1 = oklab(50% -51%   51%)
2 = oklab(50% -64%  -20%)
3 = oklab(50%   6%   19%)
4 = oklab(50% -12%  -64%)
5 = oklab(50%  44%  -19%)  
6 = oklab(50% 102%   38%)
*/

[data-algorithm] var { cursor: pointer; }
var[data-var-color] { background-color: var(--var-bg); box-shadow: 0 0 0 2px var(--var-bg); }

var[data-var-color] { --var-bg: #F4D200; }
var[data-var-color="1"] { --var-bg: #FF87A2; }
var[data-var-color="2"] { --var-bg: #96E885; }
var[data-var-color="3"] { --var-bg: #3EEED2; }
var[data-var-color="4"] { --var-bg: #EACFB6; }
var[data-var-color="5"] { --var-bg: #82DDFF; }
var[data-var-color="6"] { --var-vg: #FFBCF2; }

@media (prefers-color-scheme: dark) {
	var[data-var-color] { --var-bg: #bc1a00; }
	var[data-var-color="1"] { --var-bg: #007f00; }
	var[data-var-color="2"] { --var-bg: #008698; }
	var[data-var-color="3"] { --var-bg: #7f5b2b; }
	var[data-var-color="4"] { --var-bg: #004df3; }
	var[data-var-color="5"] { --var-bg: #a1248a; }
	var[data-var-color="6"] { --var-vg: #ff0000; }
}
</style>
 <body class="h-entry">
  <div class="head">
   <p data-fill-with="logo"><a class="logo" href="https://www.w3.org/"> <img alt="W3C" height="48" src="https://www.w3.org/StyleSheets/TR/2021/logos/W3C" width="72"> </a> </p>
   <h1 class="p-name no-ref" id="title">WebXR Lighting Estimation API Level 1</h1>
   <p id="w3c-state"><a href="https://www.w3.org/standards/types#ED">Editor’s Draft</a>, <time class="dt-updated" datetime="1970-01-01">1 January 1970</time></p>
   <details open>
    <summary>More details about this document</summary>
    <div data-fill-with="spec-metadata">
     <dl>
      <dt>Previous Versions:
      <dd><a href rel="prev"></a>
      <dt class="editor">Editors:
      <dd class="editor p-author h-card vcard"><a class="p-name fn u-email email" href="mailto:bajones@google.com">Brandon Jones</a> (<a class="p-org org" href="https://google.com">Google</a>)
      <dd class="editor p-author h-card vcard"><a class="p-name fn u-email email" href="mailto:kgilbert@mozilla.com">Kearwood Gilbert</a> (<a class="p-org org" href="https://mozilla.org/">Mozilla</a>)
     </dl>
    </div>
   </details>
   <div data-fill-with="warning"></div>
   <p class="copyright" data-fill-with="copyright"><a href="https://www.w3.org/policies/#copyright">Copyright</a> © 1970 <a href="https://www.w3.org/">World Wide Web Consortium</a>. <abbr title="World Wide Web Consortium">W3C</abbr><sup>®</sup> <a href="https://www.w3.org/policies/#Legal_Disclaimer">liability</a>, <a href="https://www.w3.org/policies/#W3C_Trademarks">trademark</a> and <a href="https://www.w3.org/copyright/software-license/" rel="license" title="W3C Software and Document License">permissive document license</a> rules apply. </p>
   <hr title="Separator for header">
  </div>
  <div class="p-summary" data-fill-with="abstract">
   <h2 class="no-num no-toc no-ref heading settled" id="abstract"><span class="content">Abstract</span></h2>
   <p>This specification describes support for exposing estimates of environmental lighting conditions to WebXR sessions.</p>
  </div>
  <h2 class="no-num no-toc no-ref heading settled" id="sotd"><span class="content">Status of this document</span></h2>
  <div data-fill-with="status">
   <p> <em>This section describes the status of this document at the time of its publication. A list of current <abbr title="World Wide Web Consortium">W3C</abbr> publications and the latest revision of this
    technical report can be found in the <a href="http://www.w3.org/TR/"><abbr title="World Wide Web Consortium">W3C</abbr> technical
    reports index</a> at http://www.w3.org/TR/.</em> </p>
   <p> This document was published by the <a href="https://www.w3.org/groups/wg/immersive-web">Immersive Web Working Group</a> as an Editors' Draft. This document is intended to become a W3C Recommendation.

    Feedback and comments on this specification are welcome. Please use <a href="https://github.com/immersive-web/lighting-estimation/issues">Github issues</a>.
    Discussions may also be found in the <a href="http://lists.w3.org/Archives/Public/public-immersive-web-wg/">public-immersive-web-wg@w3.org archives</a>. </p>
   <p> Publication as an Editors' Draft does not imply endorsement by <abbr title="World Wide Web Consortium">W3C</abbr> and its Members. This is a draft document and may
    be updated, replaced or obsoleted by other documents at any time. It is inappropriate to cite
    this document as other than work in progress. </p>
   <p> This document was produced by a group operating under the <a href="https://www.w3.org/policies/patent-policy/">W3C Patent Policy</a>.
    W3C maintains a <a href="https://www.w3.org/groups/wg/immersive-web/ipr" rel="disclosure">public list of any patent
    disclosures</a> made in connection with the deliverables of the group; that page also includes instructions for disclosing a patent. An individual who has actual knowledge of a patent which the individual believes contains <a href="https://www.w3.org/policies/patent-policy/#def-essential">Essential
    Claim(s)</a> must disclose the information in accordance with <a href="https://www.w3.org/policies/patent-policy/#sec-Disclosure">section
    6 of the W3C Patent Policy</a>. </p>
   <p> This document is governed by the <a href="https://www.w3.org/policies/process/20231103/" id="w3c_process_revision">03 November 2023 W3C Process Document</a>. </p>
   <p></p>
  </div>
  <div data-fill-with="at-risk"></div>
  <nav data-fill-with="table-of-contents" id="toc">
   <h2 class="no-num no-toc no-ref" id="contents">Table of Contents</h2>
   <ol class="toc" role="directory">
    <li><a href="#intro"><span class="secno">1</span> <span class="content">Introduction</span></a>
    <li>
     <a href="#light-primitives"><span class="secno">2</span> <span class="content">Light Primitives</span></a>
     <ol class="toc">
      <li><a href="#xrlightprobe-interface"><span class="secno">2.1</span> <span class="content">XRLightProbe</span></a>
      <li><a href="#xrreflectionformat-interface"><span class="secno">2.2</span> <span class="content">XRReflectionFormat</span></a>
      <li><a href="#xrlightestimate-interface"><span class="secno">2.3</span> <span class="content">XRLightEstimate</span></a>
     </ol>
    <li>
     <a href="#webxr-device-api-integration"><span class="secno">3</span> <span class="content">WebXR Device API Integration</span></a>
     <ol class="toc">
      <li><a href="#session-initialization"><span class="secno">3.1</span> <span class="content">Session Initialization</span></a>
      <li><a href="#xrsession-interface"><span class="secno">3.2</span> <span class="content">XRSession</span></a>
      <li><a href="#xrframe-interface"><span class="secno">3.3</span> <span class="content">XRFrame</span></a>
     </ol>
    <li>
     <a href="#webxr-layers-integration"><span class="secno">4</span> <span class="content">WebXR Layers Integration</span></a>
     <ol class="toc">
      <li><a href="#xrwebglbinding-interface"><span class="secno">4.1</span> <span class="content">XRWebGLBinding</span></a>
     </ol>
    <li>
     <a href="#events"><span class="secno">5</span> <span class="content">Events</span></a>
     <ol class="toc">
      <li><a href="#event-types"><span class="secno">5.1</span> <span class="content">Event Types</span></a>
     </ol>
    <li><a href="#privacy-security"><span class="secno">6</span> <span class="content">Privacy &amp; Security Considerations</span></a>
    <li>
     <a href="#w3c-conformance"><span class="secno"></span> <span class="content">Conformance</span></a>
     <ol class="toc">
      <li><a href="#w3c-conventions"><span class="secno"></span> <span class="content">Document conventions</span></a>
      <li><a href="#w3c-conformant-algorithms"><span class="secno"></span> <span class="content">Conformant Algorithms</span></a>
     </ol>
    <li>
     <a href="#index"><span class="secno"></span> <span class="content">Index</span></a>
     <ol class="toc">
      <li><a href="#index-defined-here"><span class="secno"></span> <span class="content">Terms defined by this specification</span></a>
      <li><a href="#index-defined-elsewhere"><span class="secno"></span> <span class="content">Terms defined by reference</span></a>
     </ol>
    <li>
     <a href="#references"><span class="secno"></span> <span class="content">References</span></a>
     <ol class="toc">
      <li><a href="#normative"><span class="secno"></span> <span class="content">Normative References</span></a>
     </ol>
    <li><a href="#idl-index"><span class="secno"></span> <span class="content">IDL Index</span></a>
   </ol>
  </nav>
  <main>
   <h2 class="heading settled" data-level="1" id="intro"><span class="secno">1. </span><span class="content">Introduction</span><a class="self-link" href="#intro"></a></h2>
   <p>The WebXR Lighting Estimation module expands the <a href="https://www.w3.org/TR/webxr/">WebXR Device API</a>, the <a href="https://immersive-web.github.io/webxr-ar-module/">WebXR Augmented Reality Module</a>, and the <a href="https://immersive-web.github.io/layers/">WebXR Layers module</a> with the ability to expose estimates of the lighting conditions of the user’s environment.</p>
   <h2 class="heading settled" data-level="2" id="light-primitives"><span class="secno">2. </span><span class="content">Light Primitives</span><a class="self-link" href="#light-primitives"></a></h2>
   <h3 class="heading settled" data-level="2.1" id="xrlightprobe-interface"><span class="secno">2.1. </span><span class="content">XRLightProbe</span><a class="self-link" href="#xrlightprobe-interface"></a></h3>
   <p>An <code class="idl"><a data-link-type="idl" href="#xrlightprobe" id="ref-for-xrlightprobe">XRLightProbe</a></code> collects estimated lighting information at a given point in the user’s environment.</p>
<pre class="idl highlight def">[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#SecureContext" id="ref-for-SecureContext"><c- g>SecureContext</c-></a>, <a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed" id="ref-for-Exposed"><c- g>Exposed</c-></a>=<c- n>Window</c->]
<c- b>interface</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="interface" data-export id="xrlightprobe"><code><c- g>XRLightProbe</c-></code></dfn> : <a data-link-type="idl-name" href="https://dom.spec.whatwg.org/#eventtarget" id="ref-for-eventtarget"><c- n>EventTarget</c-></a> {
  <c- b>readonly</c-> <c- b>attribute</c-> <a data-link-type="idl-name" href="https://immersive-web.github.io/webxr/#xrspace" id="ref-for-xrspace"><c- n>XRSpace</c-></a> <a class="idl-code" data-link-type="attribute" data-readonly data-type="XRSpace" href="#dom-xrlightprobe-probespace" id="ref-for-dom-xrlightprobe-probespace"><c- g>probeSpace</c-></a>;
  <c- b>attribute</c-> <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler" id="ref-for-eventhandler"><c- n>EventHandler</c-></a> <a class="idl-code" data-link-type="attribute" data-type="EventHandler" href="#dom-xrlightprobe-onreflectionchange" id="ref-for-dom-xrlightprobe-onreflectionchange"><c- g>onreflectionchange</c-></a>;
};
</pre>
   <p>The <dfn class="dfn-paneled idl-code" data-dfn-for="XRLightProbe" data-dfn-type="attribute" data-export id="dom-xrlightprobe-probespace"><code>probeSpace</code></dfn> attribute is an <code class="idl"><a data-link-type="idl" href="https://immersive-web.github.io/webxr/#xrspace" id="ref-for-xrspace①">XRSpace</a></code> that has a <a data-link-type="dfn" href="https://www.w3.org/TR/webxr/#xrspace-native-origin" id="ref-for-xrspace-native-origin">native origin</a> tracking the position and orientation that the <code class="idl"><a data-link-type="idl" href="#xrlightprobe" id="ref-for-xrlightprobe①">XRLightProbe</a></code>'s lighting estimations are being generated relative to.</p>
   <p>The <dfn class="dfn-paneled idl-code" data-dfn-for="XRLightProbe" data-dfn-type="attribute" data-export id="dom-xrlightprobe-onreflectionchange"><code>onreflectionchange</code></dfn> attribute is an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#event-handler-idl-attributes" id="ref-for-event-handler-idl-attributes">Event handler IDL attribute</a> for the <code class="idl"><a data-link-type="idl" href="#eventdef-xrlightprobe-reflectionchange" id="ref-for-eventdef-xrlightprobe-reflectionchange">reflectionchange</a></code> event type.</p>
   <h3 class="heading settled" data-level="2.2" id="xrreflectionformat-interface"><span class="secno">2.2. </span><span class="content">XRReflectionFormat</span><a class="self-link" href="#xrreflectionformat-interface"></a></h3>
<pre class="idl highlight def"><c- b>enum</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="enum" data-export id="enumdef-xrreflectionformat"><code><c- g>XRReflectionFormat</c-></code></dfn> {
  <dfn class="dfn-paneled idl-code" data-dfn-for="XRReflectionFormat" data-dfn-type="enum-value" data-export id="dom-xrreflectionformat-srgba8"><code><c- s>"srgba8"</c-></code></dfn>,
  <dfn class="dfn-paneled idl-code" data-dfn-for="XRReflectionFormat" data-dfn-type="enum-value" data-export id="dom-xrreflectionformat-rgba16f"><code><c- s>"rgba16f"</c-></code></dfn>,
};
</pre>
   <p>Reflection cube maps have an internal reflection format that indicates how the texture data is represented, and may change how applications choose to use the texture. Cube maps MAY be requested with the <code class="idl"><a data-link-type="idl" href="#dom-xrreflectionformat-srgba8" id="ref-for-dom-xrreflectionformat-srgba8">"srgba8"</a></code> format or the <code class="idl"><a data-link-type="idl" href="#dom-xrsession-preferredreflectionformat" id="ref-for-dom-xrsession-preferredreflectionformat">preferredReflectionFormat</a></code> of the light probe.</p>
   <table class="data">
    <thead>
     <tr>
      <th><code class="idl"><a data-link-type="idl" href="#enumdef-xrreflectionformat" id="ref-for-enumdef-xrreflectionformat">XRReflectionFormat</a></code> 
      <th>WebGL Format 
      <th>WebGL Internal Format 
      <th>WebGPU Format 
      <th>HDR 
    <tbody>
     <tr>
      <td><code class="idl"><a data-link-type="idl" href="#dom-xrreflectionformat-srgba8" id="ref-for-dom-xrreflectionformat-srgba8①">"srgba8"</a></code> 
      <td>RGBA 
      <td>SRGB8_ALPHA8 
      <td>"rgba8unorm-srgb" 
      <td>
     <tr>
      <td><code class="idl"><a data-link-type="idl" href="#dom-xrreflectionformat-rgba16f" id="ref-for-dom-xrreflectionformat-rgba16f">"rgba16f"</a></code> 
      <td>RGBA 
      <td>RGBA16F 
      <td>"rgba16float" 
      <td>✓ 
   </table>
   <h3 class="heading settled" data-level="2.3" id="xrlightestimate-interface"><span class="secno">2.3. </span><span class="content">XRLightEstimate</span><a class="self-link" href="#xrlightestimate-interface"></a></h3>
   <p>An <code class="idl"><a data-link-type="idl" href="#xrlightestimate" id="ref-for-xrlightestimate">XRLightEstimate</a></code> provides the estimated lighting values for an <code class="idl"><a data-link-type="idl" href="#xrlightprobe" id="ref-for-xrlightprobe②">XRLightProbe</a></code> at the time represented by an <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/webxr/#xrframe-interface" id="ref-for-xrframe-interface">XRFrame</a></code>. <code class="idl"><a data-link-type="idl" href="#xrlightestimate" id="ref-for-xrlightestimate①">XRLightEstimate</a></code>s are queried by passing an <code class="idl"><a data-link-type="idl" href="#xrlightprobe" id="ref-for-xrlightprobe③">XRLightProbe</a></code> to the <code class="idl"><a data-link-type="idl" href="#dom-xrframe-getlightestimate" id="ref-for-dom-xrframe-getlightestimate">getLightEstimate()</a></code> method of an <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/webxr/#xrframe-interface" id="ref-for-xrframe-interface①">XRFrame</a></code>.</p>
<pre class="idl highlight def">[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#SecureContext" id="ref-for-SecureContext①"><c- g>SecureContext</c-></a>, <a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed" id="ref-for-Exposed①"><c- g>Exposed</c-></a>=<c- n>Window</c->]
<c- b>interface</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="interface" data-export id="xrlightestimate"><code><c- g>XRLightEstimate</c-></code></dfn> {
  <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-Float32Array" id="ref-for-idl-Float32Array"><c- b>Float32Array</c-></a> <a class="idl-code" data-link-type="attribute" data-readonly data-type="Float32Array" href="#dom-xrlightestimate-sphericalharmonicscoefficients" id="ref-for-dom-xrlightestimate-sphericalharmonicscoefficients"><c- g>sphericalHarmonicsCoefficients</c-></a>;
  <c- b>readonly</c-> <c- b>attribute</c-> <a data-link-type="idl-name" href="https://drafts.fxtf.org/geometry-1/#dompointreadonly" id="ref-for-dompointreadonly"><c- n>DOMPointReadOnly</c-></a> <a class="idl-code" data-link-type="attribute" data-readonly data-type="DOMPointReadOnly" href="#dom-xrlightestimate-primarylightdirection" id="ref-for-dom-xrlightestimate-primarylightdirection"><c- g>primaryLightDirection</c-></a>;
  <c- b>readonly</c-> <c- b>attribute</c-> <a data-link-type="idl-name" href="https://drafts.fxtf.org/geometry-1/#dompointreadonly" id="ref-for-dompointreadonly①"><c- n>DOMPointReadOnly</c-></a> <a class="idl-code" data-link-type="attribute" data-readonly data-type="DOMPointReadOnly" href="#dom-xrlightestimate-primarylightintensity" id="ref-for-dom-xrlightestimate-primarylightintensity"><c- g>primaryLightIntensity</c-></a>;
};
</pre>
   <p>The <dfn class="dfn-paneled idl-code" data-dfn-for="XRLightEstimate" data-dfn-type="attribute" data-export id="dom-xrlightestimate-sphericalharmonicscoefficients"><code>sphericalHarmonicsCoefficients</code></dfn> attribute returns a <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-Float32Array" id="ref-for-idl-Float32Array①">Float32Array</a></code> containing 9 spherical harmonics coefficients. The array MUST be 27 elements in length, with every 3 elements defining the red, green, and blue components respectively of a single coefficient. The first term of the <code class="idl"><a data-link-type="idl" href="#dom-xrlightestimate-sphericalharmonicscoefficients" id="ref-for-dom-xrlightestimate-sphericalharmonicscoefficients①">sphericalHarmonicsCoefficients</a></code>, meaning the first 3 elements of the array, MUST be representative of a valid lighting estimate. All other terms are optional, and MAY be 0 if a corresponding lighting estimate is not available due to either user privacy settings or the capabilities of the platform.</p>
   <p>The order of coefficients in <code class="idl"><a data-link-type="idl" href="#dom-xrlightestimate-sphericalharmonicscoefficients" id="ref-for-dom-xrlightestimate-sphericalharmonicscoefficients②">sphericalHarmonicsCoefficients</a></code>, is  [<var>C</var><sub>0</sub><sup>0</sup>, <var>C</var><sub>1</sub><sup>-1</sup>, <var>C</var><sub>1</sub><sup>0</sup>, <var>C</var><sub>1</sub><sup>1</sup>, <var>C</var><sub>2</sub><sup>-2</sup>, <var>C</var><sub>2</sub><sup>-1</sup>, <var>C</var><sub>2</sub><sup>0</sup>, <var>C</var><sub>2</sub><sup>1</sup>, <var>C</var><sub>2</sub><sup>2</sup>], where <var>C</var><sub><var>l</var></sub><sup><var>m</var></sup> is the coefficient of spherical harmonic <var>Y</var><sub><var>l</var></sub><sup><var>m</var></sup>.</p>
   <p>The <dfn class="dfn-paneled idl-code" data-dfn-for="XRLightEstimate" data-dfn-type="attribute" data-export id="dom-xrlightestimate-primarylightdirection"><code>primaryLightDirection</code></dfn> represents the direction to the primary light source from the <a data-link-type="dfn" href="https://www.w3.org/TR/webxr/#xrspace-native-origin" id="ref-for-xrspace-native-origin①">native origin</a> of the <code class="idl"><a data-link-type="idl" href="#dom-xrlightprobe-probespace" id="ref-for-dom-xrlightprobe-probespace①">probeSpace</a></code> of the <code class="idl"><a data-link-type="idl" href="#xrlightprobe" id="ref-for-xrlightprobe④">XRLightProbe</a></code> that produced the <code class="idl"><a data-link-type="idl" href="#xrlightestimate" id="ref-for-xrlightestimate②">XRLightEstimate</a></code>. The value MUST be a unit length 3D vector and the <code class="idl"><a data-link-type="idl" href="https://drafts.fxtf.org/geometry-1/#dom-dompointreadonly-w" id="ref-for-dom-dompointreadonly-w">w</a></code> value MUST be <code>0.0</code>. If estimated values from the users’s environment are not available the <code class="idl"><a data-link-type="idl" href="#dom-xrlightestimate-primarylightdirection" id="ref-for-dom-xrlightestimate-primarylightdirection①">primaryLightDirection</a></code> MUST be <code>{ x: 0.0, y: 1.0, z: 0.0, w: 0.0 }</code>, representing a light shining straight down from above.</p>
   <p>The <dfn class="dfn-paneled idl-code" data-dfn-for="XRLightEstimate" data-dfn-type="attribute" data-export id="dom-xrlightestimate-primarylightintensity"><code>primaryLightIntensity</code></dfn> represents the direction to the primary light source from the origin of the <code class="idl"><a data-link-type="idl" href="#dom-xrlightprobe-probespace" id="ref-for-dom-xrlightprobe-probespace②">probeSpace</a></code> of the <code class="idl"><a data-link-type="idl" href="#xrlightprobe" id="ref-for-xrlightprobe⑤">XRLightProbe</a></code> that produced the <code class="idl"><a data-link-type="idl" href="#xrlightestimate" id="ref-for-xrlightestimate③">XRLightEstimate</a></code>. The value MUST represent an RGB value mapped to the <code class="idl"><a data-link-type="idl" href="https://drafts.fxtf.org/geometry-1/#dom-dompointreadonly-x" id="ref-for-dom-dompointreadonly-x">x</a></code>, <code class="idl"><a data-link-type="idl" href="https://drafts.fxtf.org/geometry-1/#dom-dompointreadonly-y" id="ref-for-dom-dompointreadonly-y">y</a></code>, and <code class="idl"><a data-link-type="idl" href="https://drafts.fxtf.org/geometry-1/#dom-dompointreadonly-z" id="ref-for-dom-dompointreadonly-z">z</a></code> values respectively where each component is greater than or equal to <code>0.0</code> and the <code class="idl"><a data-link-type="idl" href="https://drafts.fxtf.org/geometry-1/#dom-dompointreadonly-w" id="ref-for-dom-dompointreadonly-w①">w</a></code> value MUST be <code>1.0</code>. If estimated values from the users’s environment are not available the <code class="idl"><a data-link-type="idl" href="#dom-xrlightestimate-primarylightintensity" id="ref-for-dom-xrlightestimate-primarylightintensity①">primaryLightIntensity</a></code> MUST be <code>{x: 0.0, y: 0.0, z: 0.0, w: 1.0}</code>, representing no illumination.</p>
   <h2 class="heading settled" data-level="3" id="webxr-device-api-integration"><span class="secno">3. </span><span class="content">WebXR Device API Integration</span><a class="self-link" href="#webxr-device-api-integration"></a></h2>
   <p>Both the <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/webxr/#xrsession-interface" id="ref-for-xrsession-interface">XRSession</a></code> and <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/webxr/#xrframe-interface" id="ref-for-xrframe-interface②">XRFrame</a></code> interfaces from the <a href="https://www.w3.org/TR/webxr/">WebXR Device API</a> are expanded by this module.</p>
   <h3 class="heading settled" data-level="3.1" id="session-initialization"><span class="secno">3.1. </span><span class="content">Session Initialization</span><a class="self-link" href="#session-initialization"></a></h3>
   <p>The string "<dfn class="dfn-paneled" data-dfn-for="feature descriptor" data-dfn-type="dfn" data-noexport id="feature-descriptor-light-estimation">light-estimation</dfn>" is introduced by this module as a new valid <a data-link-type="dfn">feature descriptor</a>. Applications that wish to use light estimation features MUST be requested with an the "<a data-link-type="dfn" href="#feature-descriptor-light-estimation" id="ref-for-feature-descriptor-light-estimation">light-estimation</a>" <a data-link-type="dfn">feature descriptor</a>.</p>
   <h3 class="heading settled" data-level="3.2" id="xrsession-interface"><span class="secno">3.2. </span><span class="content">XRSession</span><a class="self-link" href="#xrsession-interface"></a></h3>
   <p>The <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/webxr/#xrsession-interface" id="ref-for-xrsession-interface①">XRSession</a></code> interface is extended with the ability to create new <code class="idl"><a data-link-type="idl" href="#xrlightprobe" id="ref-for-xrlightprobe⑥">XRLightProbe</a></code> instances. <code class="idl"><a data-link-type="idl" href="#xrlightprobe" id="ref-for-xrlightprobe⑦">XRLightProbe</a></code> instances have a <dfn class="dfn-paneled" data-dfn-for="XRLightProbe" data-dfn-type="dfn" data-noexport id="xrlightprobe-session">session</dfn> object, which is the <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/webxr/#xrsession-interface" id="ref-for-xrsession-interface②">XRSession</a></code> that created this <code class="idl"><a data-link-type="idl" href="#xrlightprobe" id="ref-for-xrlightprobe⑧">XRLightProbe</a></code>. And an <dfn class="dfn-paneled" data-dfn-for="XRLightProbe" data-dfn-type="dfn" data-noexport id="xrlightprobe-reflection-format">reflection format</dfn> object, which is the <code class="idl"><a data-link-type="idl" href="#enumdef-xrreflectionformat" id="ref-for-enumdef-xrreflectionformat①">XRReflectionFormat</a></code> that the light probe may retrieve.</p>
   <p>The <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/webxr/#xrsession-interface" id="ref-for-xrsession-interface③">XRSession</a></code> interface is further extended with an attribute <code class="idl"><a data-link-type="idl" href="#dom-xrsession-preferredreflectionformat" id="ref-for-dom-xrsession-preferredreflectionformat①">preferredReflectionFormat</a></code>, indicating the <code class="idl"><a data-link-type="idl" href="#enumdef-xrreflectionformat" id="ref-for-enumdef-xrreflectionformat②">XRReflectionFormat</a></code> most closely supported by the underlying <a data-link-type="dfn" href="https://www.w3.org/TR/webxr/#xrsession-xr-device" id="ref-for-xrsession-xr-device">XR device</a></p>
<pre class="idl highlight def"><c- b>dictionary</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="dictionary" data-export id="dictdef-xrlightprobeinit"><code><c- g>XRLightProbeInit</c-></code></dfn> {
  <a data-link-type="idl-name" href="#enumdef-xrreflectionformat" id="ref-for-enumdef-xrreflectionformat③"><c- n>XRReflectionFormat</c-></a> <dfn class="dfn-paneled idl-code" data-default="&quot;srgba8&quot;" data-dfn-for="XRLightProbeInit" data-dfn-type="dict-member" data-export data-type="XRReflectionFormat" id="dom-xrlightprobeinit-reflectionformat"><code><c- g>reflectionFormat</c-></code></dfn> = "srgba8";
};

<c- b>partial</c-> <c- b>interface</c-> <a class="idl-code" data-link-type="interface" href="https://www.w3.org/TR/webxr/#xrsession-interface" id="ref-for-xrsession-interface④"><c- g>XRSession</c-></a> {
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise" id="ref-for-idl-promise"><c- b>Promise</c-></a>&lt;<a data-link-type="idl-name" href="#xrlightprobe" id="ref-for-xrlightprobe⑨"><c- n>XRLightProbe</c-></a>> <a class="idl-code" data-link-type="method" href="#dom-xrsession-requestlightprobe" id="ref-for-dom-xrsession-requestlightprobe"><c- g>requestLightProbe</c-></a>(<c- b>optional</c-> <a data-link-type="idl-name" href="#dictdef-xrlightprobeinit" id="ref-for-dictdef-xrlightprobeinit"><c- n>XRLightProbeInit</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="XRSession/requestLightProbe(options), XRSession/requestLightProbe()" data-dfn-type="argument" data-export id="dom-xrsession-requestlightprobe-options-options"><code><c- g>options</c-></code></dfn> = {});
  <c- b>readonly</c-> <c- b>attribute</c-> <a data-link-type="idl-name" href="#enumdef-xrreflectionformat" id="ref-for-enumdef-xrreflectionformat④"><c- n>XRReflectionFormat</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="XRSession" data-dfn-type="attribute" data-export data-readonly data-type="XRReflectionFormat" id="dom-xrsession-preferredreflectionformat"><code><c- g>preferredReflectionFormat</c-></code></dfn>;
};
</pre>
   <div class="algorithm" data-algorithm="request-light-probe">
     When the <dfn class="dfn-paneled idl-code" data-dfn-for="XRSession" data-dfn-type="method" data-export data-lt="requestLightProbe(options)|requestLightProbe()" id="dom-xrsession-requestlightprobe"><code>requestLightProbe(<var>options</var>)</code></dfn> method is invoked on <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/webxr/#xrsession-interface" id="ref-for-xrsession-interface⑤">XRSession</a></code> <var>session</var>, the user agent MUST run the following steps: 
    <ol>
     <li data-md>
      <p>Let <var>promise</var> be <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#a-new-promise" id="ref-for-a-new-promise">a new Promise</a>.</p>
     <li data-md>
      <p>If the <a data-link-type="dfn" href="#feature-descriptor-light-estimation" id="ref-for-feature-descriptor-light-estimation①">light-estimation</a> feature descriptor is not <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-contain" id="ref-for-list-contain">contained</a> in the <var>session</var>’s <a data-link-type="dfn" href="https://www.w3.org/TR/webxr/#xrsession-list-of-enabled-features" id="ref-for-xrsession-list-of-enabled-features">list of enabled features</a>, <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#reject" id="ref-for-reject">reject</a> <var>promise</var> with <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#notsupportederror" id="ref-for-notsupportederror">NotSupportedError</a></code> and abort these steps.</p>
     <li data-md>
      <p>If <var>session</var>’s <a data-link-type="dfn">ended</a> value is <code>true</code>, throw an <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#invalidstateerror" id="ref-for-invalidstateerror">InvalidStateError</a></code> and abort these steps.</p>
      <dl class="switch">
       <dt>If <var>options</var>’s <code class="idl"><a data-link-type="idl" href="#dom-xrlightprobeinit-reflectionformat" id="ref-for-dom-xrlightprobeinit-reflectionformat">reflectionFormat</a></code> is <code class="idl"><a data-link-type="idl" href="#dom-xrreflectionformat-srgba8" id="ref-for-dom-xrreflectionformat-srgba8②">"srgba8"</a></code> or matches <var>session</var>’s <code class="idl"><a data-link-type="idl" href="#dom-xrsession-preferredreflectionformat" id="ref-for-dom-xrsession-preferredreflectionformat②">preferredReflectionFormat</a></code>:
       <dd>
        <ol>
         <li data-md>
          <p>Let <var>probe</var> be a new <code class="idl"><a data-link-type="idl" href="#xrlightprobe" id="ref-for-xrlightprobe①⓪">XRLightProbe</a></code>.</p>
         <li data-md>
          <p>Set <var>probe</var>’s <a data-link-type="dfn" href="#xrlightprobe-session" id="ref-for-xrlightprobe-session">session</a> to <var>session</var>.</p>
         <li data-md>
          <p>Set <var>probe</var>’s <a data-link-type="dfn" href="#xrlightprobe-reflection-format" id="ref-for-xrlightprobe-reflection-format">reflection format</a> to <var>options</var>’s <code class="idl"><a data-link-type="idl" href="#dom-xrlightprobeinit-reflectionformat" id="ref-for-dom-xrlightprobeinit-reflectionformat①">reflectionFormat</a></code></p>
         <li data-md>
          <p><a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#resolve" id="ref-for-resolve">Resolve</a> <var>promise</var> with <var>probe</var>.</p>
        </ol>
       <dt>else
       <dd>
        <ol>
         <li data-md>
          <p><a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#reject" id="ref-for-reject①">Reject</a> <var>promise</var> with a "<code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#notsupportederror" id="ref-for-notsupportederror①">NotSupportedError</a></code>" <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException">DOMException</a></code></p>
        </ol>
      </dl>
    </ol>
   </div>
   <h3 class="heading settled" data-level="3.3" id="xrframe-interface"><span class="secno">3.3. </span><span class="content">XRFrame</span><a class="self-link" href="#xrframe-interface"></a></h3>
   <p>The <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/webxr/#xrframe-interface" id="ref-for-xrframe-interface③">XRFrame</a></code> interface is extended with the ability to query the <code class="idl"><a data-link-type="idl" href="#xrlightestimate" id="ref-for-xrlightestimate④">XRLightEstimate</a></code> for a given <code class="idl"><a data-link-type="idl" href="#xrlightprobe" id="ref-for-xrlightprobe①①">XRLightProbe</a></code>.</p>
<pre class="idl highlight def"><c- b>partial</c-> <c- b>interface</c-> <a class="idl-code" data-link-type="interface" href="https://www.w3.org/TR/webxr/#xrframe-interface" id="ref-for-xrframe-interface④"><c- g>XRFrame</c-></a> {
  <a data-link-type="idl-name" href="#xrlightestimate" id="ref-for-xrlightestimate⑤"><c- n>XRLightEstimate</c-></a>? <a class="idl-code" data-link-type="method" href="#dom-xrframe-getlightestimate" id="ref-for-dom-xrframe-getlightestimate①"><c- g>getLightEstimate</c-></a>(<a data-link-type="idl-name" href="#xrlightprobe" id="ref-for-xrlightprobe①②"><c- n>XRLightProbe</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="XRFrame/getLightEstimate(lightProbe)" data-dfn-type="argument" data-export id="dom-xrframe-getlightestimate-lightprobe-lightprobe"><code><c- g>lightProbe</c-></code></dfn>);
};
</pre>
   <div class="algorithm" data-algorithm="get-light-estimate">
     When the <dfn class="dfn-paneled idl-code" data-dfn-for="XRFrame" data-dfn-type="method" data-export id="dom-xrframe-getlightestimate"><code>getLightEstimate(<var>lightProbe</var>)</code></dfn> method is invoked on <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/webxr/#xrframe-interface" id="ref-for-xrframe-interface⑤">XRFrame</a></code> <var>frame</var>, the user agent MUST run the following steps: 
    <ol>
     <li data-md>
      <p>If <var>frame</var>’s <a data-link-type="dfn" href="https://www.w3.org/TR/webxr/#xrframe-active" id="ref-for-xrframe-active">active</a> boolean is `false`, throw an <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#invalidstateerror" id="ref-for-invalidstateerror①">InvalidStateError</a></code> and abort these steps.</p>
     <li data-md>
      <p>Let <var>session</var> be <var>frame</var>’s <code class="idl"><a data-link-type="idl" href="https://immersive-web.github.io/webxr/#dom-xrframe-session" id="ref-for-dom-xrframe-session">session</a></code> object.</p>
     <li data-md>
      <p>If <var>lightProbe</var>’s <a data-link-type="dfn" href="#xrlightprobe-session" id="ref-for-xrlightprobe-session①">session</a> does not equal <var>session</var>, throw an <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#invalidstateerror" id="ref-for-invalidstateerror②">InvalidStateError</a></code> and abort these steps.</p>
     <li data-md>
      <p>Let <var>device</var> be <var>session</var>’s <a data-link-type="dfn" href="https://www.w3.org/TR/webxr/#xrsession-xr-device" id="ref-for-xrsession-xr-device①">XR device</a>.</p>
     <li data-md>
      <p>If <var>device</var> cannot estimate the lighting for this frame, return null.</p>
     <li data-md>
      <p>Let <var>estimate</var> be a new <code class="idl"><a data-link-type="idl" href="#xrlightestimate" id="ref-for-xrlightestimate⑥">XRLightEstimate</a></code>.</p>
     <li data-md>
      <p>Populate estimate|'s <code class="idl"><a data-link-type="idl" href="#dom-xrlightestimate-sphericalharmonicscoefficients" id="ref-for-dom-xrlightestimate-sphericalharmonicscoefficients③">sphericalHarmonicsCoefficients</a></code>, with the coefficients provided by <var>device</var>.</p>
      <dl class="switch">
       <dt>If <var>device</var> has an estimated direction for the light source
       <dd>
        <ol>
         <li data-md>
          <p>Set <var>estimate</var>’s <code class="idl"><a data-link-type="idl" href="#dom-xrlightestimate-primarylightdirection" id="ref-for-dom-xrlightestimate-primarylightdirection②">primaryLightDirection</a></code> to the estimated direction of the light source.</p>
        </ol>
       <dt>else
       <dd>
        <ol>
         <li data-md>
          <p>Set <var>estimate</var>’s <code class="idl"><a data-link-type="idl" href="#dom-xrlightestimate-primarylightdirection" id="ref-for-dom-xrlightestimate-primarylightdirection③">primaryLightDirection</a></code> to <code>{ x: 0.0, y: 1.0, z: 0.0, w: 0.0 }</code></p>
        </ol>
      </dl>
      <dl class="switch">
       <dt>If <var>device</var> has an estimated intensity for the light source
       <dd>
        <ol>
         <li data-md>
          <p>Set <var>estimate</var>’s <code class="idl"><a data-link-type="idl" href="#dom-xrlightestimate-primarylightintensity" id="ref-for-dom-xrlightestimate-primarylightintensity②">primaryLightIntensity</a></code> to the estimated intensity of the light source.</p>
        </ol>
       <dt>else
       <dd>
        <ol>
         <li data-md>
          <p>Set <var>estimate</var>’s <code class="idl"><a data-link-type="idl" href="#dom-xrlightestimate-primarylightintensity" id="ref-for-dom-xrlightestimate-primarylightintensity③">primaryLightIntensity</a></code> to <code>{x: 0.0, y: 0.0, z: 0.0, w: 1.0}</code></p>
        </ol>
      </dl>
     <li data-md>
      <p>Return <var>estimate</var>.</p>
    </ol>
   </div>
   <h2 class="heading settled" data-level="4" id="webxr-layers-integration"><span class="secno">4. </span><span class="content">WebXR Layers Integration</span><a class="self-link" href="#webxr-layers-integration"></a></h2>
   <p>The <code class="idl"><a data-link-type="idl" href="https://immersive-web.github.io/layers/#xrwebglbinding" id="ref-for-xrwebglbinding">XRWebGLBinding</a></code> interface from the <a href="https://immersive-web.github.io/layers/">WebXR Layers module</a> is expanded by this module.</p>
   <h3 class="heading settled" data-level="4.1" id="xrwebglbinding-interface"><span class="secno">4.1. </span><span class="content">XRWebGLBinding</span><a class="self-link" href="#xrwebglbinding-interface"></a></h3>
   <p>The <code class="idl"><a data-link-type="idl" href="https://immersive-web.github.io/layers/#xrwebglbinding" id="ref-for-xrwebglbinding①">XRWebGLBinding</a></code> interface is extended with the ability to query a reflection cube map for a given <code class="idl"><a data-link-type="idl" href="#xrlightprobe" id="ref-for-xrlightprobe①③">XRLightProbe</a></code>.</p>
<pre class="idl highlight def"><c- b>partial</c-> <c- b>interface</c-> <a class="idl-code" data-link-type="interface" href="https://immersive-web.github.io/layers/#xrwebglbinding" id="ref-for-xrwebglbinding②"><c- g>XRWebGLBinding</c-></a> {
  <a data-link-type="idl-name" href="https://www.khronos.org/registry/webgl/specs/latest/1.0/#WebGLTexture" id="ref-for-WebGLTexture"><c- n>WebGLTexture</c-></a>? <a class="idl-code" data-link-type="method" href="#dom-xrwebglbinding-getreflectioncubemap" id="ref-for-dom-xrwebglbinding-getreflectioncubemap"><c- g>getReflectionCubeMap</c-></a>(<a data-link-type="idl-name" href="#xrlightprobe" id="ref-for-xrlightprobe①④"><c- n>XRLightProbe</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="XRWebGLBinding/getReflectionCubeMap(lightProbe)" data-dfn-type="argument" data-export id="dom-xrwebglbinding-getreflectioncubemap-lightprobe-lightprobe"><code><c- g>lightProbe</c-></code></dfn>);
};
</pre>
   <div class="algorithm" data-algorithm="get-reflection-cubemap">
     When the <dfn class="dfn-paneled idl-code" data-dfn-for="XRWebGLBinding" data-dfn-type="method" data-export id="dom-xrwebglbinding-getreflectioncubemap"><code>getReflectionCubeMap(<var>lightProbe</var>)</code></dfn> method is invoked on <code class="idl"><a data-link-type="idl" href="https://immersive-web.github.io/layers/#xrwebglbinding" id="ref-for-xrwebglbinding③">XRWebGLBinding</a></code> <var>binding</var>, the user agent MUST run the following steps: 
    <ol>
     <li data-md>
      <p>If <var>binding</var>’s <a data-link-type="dfn" href="https://immersive-web.github.io/layers/#xrwebglbinding-context" id="ref-for-xrwebglbinding-context">context</a> is lost, throw an <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#invalidstateerror" id="ref-for-invalidstateerror③">InvalidStateError</a></code> and abort these steps.</p>
     <li data-md>
      <p>Let <var>session</var> be <var>binding</var>’s <a data-link-type="dfn" href="https://immersive-web.github.io/layers/#session" id="ref-for-session">session</a>.</p>
     <li data-md>
      <p>If <var>session</var> is ended, throw an <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#invalidstateerror" id="ref-for-invalidstateerror④">InvalidStateError</a></code> and abort these steps.</p>
     <li data-md>
      <p>If <var>session</var> does not match <var>lightProbe</var>’s <a data-link-type="dfn" href="#xrlightprobe-session" id="ref-for-xrlightprobe-session②">session</a>, throw an <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#invalidstateerror" id="ref-for-invalidstateerror⑤">InvalidStateError</a></code> and abort these steps.</p>
     <li data-md>
      <p>Let <var>device</var> be <var>session</var>’s <a data-link-type="dfn" href="https://www.w3.org/TR/webxr/#xrsession-xr-device" id="ref-for-xrsession-xr-device②">XR Device</a>.</p>
     <li data-md>
      <p>If no reflection cube map is available from <var>device</var>, return <code>null</code>.</p>
     <li data-md>
      <p>Return a new <code class="idl"><a data-link-type="idl" href="https://www.khronos.org/registry/webgl/specs/latest/1.0/#WebGLTexture" id="ref-for-WebGLTexture①">WebGLTexture</a></code> cubemap in the format specified by <var>lightProbe</var>’s <a data-link-type="dfn" href="#xrlightprobe-reflection-format" id="ref-for-xrlightprobe-reflection-format①">reflection format</a> and populated with the data from <var>device</var>.</p>
    </ol>
   </div>
   <h2 class="heading settled" data-level="5" id="events"><span class="secno">5. </span><span class="content">Events</span><a class="self-link" href="#events"></a></h2>
   <p>The <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#task-source" id="ref-for-task-source">task source</a> for all <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task" id="ref-for-queue-a-task">tasks queued</a> in this specification is the <a data-link-type="dfn" href="https://www.w3.org/TR/webxr/#xr-task-source" id="ref-for-xr-task-source">XR task source</a>, unless otherwise specified.</p>
   <h3 class="heading settled" data-level="5.1" id="event-types"><span class="secno">5.1. </span><span class="content">Event Types</span><a class="self-link" href="#event-types"></a></h3>
   <p>The user agent MUST fire a <dfn class="dfn-paneled idl-code" data-dfn-for="XRLightProbe" data-dfn-type="event" data-export id="eventdef-xrlightprobe-reflectionchange"><code>reflectionchange</code></dfn> event on an <code class="idl"><a data-link-type="idl" href="#xrlightprobe" id="ref-for-xrlightprobe①⑤">XRLightProbe</a></code> object each time the contents of the cube map returned by calling <code class="idl"><a data-link-type="idl" href="#dom-xrwebglbinding-getreflectioncubemap" id="ref-for-dom-xrwebglbinding-getreflectioncubemap①">getReflectionCubeMap()</a></code> have changed. The event MUST be of type <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#event" id="ref-for-event">Event</a></code>.</p>
   <h2 class="heading settled" data-level="6" id="privacy-security"><span class="secno">6. </span><span class="content">Privacy &amp; Security Considerations</span><a class="self-link" href="#privacy-security"></a></h2>
   <section class="non-normative">
    <p>The lighting estimation API shares many potential <a data-link-type="dfn" href="https://www.w3.org/TR/ambient-light/#security-and-privacy" id="ref-for-security-and-privacy">privacy and security risks</a> with the Ambient Light Sensor API <a data-link-type="biblio" href="#biblio-ambient-light" title="Ambient Light Sensor">[AMBIENT-LIGHT]</a>, including:</p>
    <ul>
     <li data-md>
      <p>Profiling: Lighting Estimation can leak information about user’s use patterns and surroundings. This information can be used to enhance user profiling and behavioral analysis.</p>
     <li data-md>
      <p>Cross-device Linking: Two devices can access web sites that include the same third-party script that correlates lighting levels over time.</p>
     <li data-md>
      <p>Cross Device Communication: A simple broadcast communication method can use device screen or camera LED flashes to broadcast messages read out with lighting estimation on a nearby device.</p>
    </ul>
    <p>In addition to these, there are a few vectors unique to lighting estimation to
consider.</p>
    <ul>
     <li data-md>
      <p>The lighting estimation returned by the WebXR API explicitly describes the real world environment in close proximity to the user.</p>
     <li data-md>
      <p>Reflection cube maps of a high enough resolution approach the same level as camera access.</p>
    </ul>
    <p>Lighting estimation must be declared when creating an XR Session as a <a data-link-type="dfn">feature descriptor</a>, which will allow the user agent to notify the user of the potential privacy implications of allowing the lighting estimation API to be used by the website. The user agent is encouraged to NOT provide real-time updates to any portion of the lighting estimation API, especially the reflection cube map. By default, only low spaital frequency and low temporal frequency information should be returned by the WebXR API. Reflection cube maps should be kept low resolution, unless the user has also consented to camera permissions for a particular origin.  As further mitigation, the Spherical Harmonics and primary light direction MAY be quantized.</p>
   </section>
  </main>
  <div data-fill-with="conformance">
   <h2 class="no-ref no-num heading settled" id="w3c-conformance"><span class="content">Conformance</span><a class="self-link" href="#w3c-conformance"></a></h2>
   <h3 class="no-ref no-num heading settled" id="w3c-conventions"><span class="content">Document conventions</span><a class="self-link" href="#w3c-conventions"></a></h3>
   <p>Conformance requirements are expressed
    with a combination of descriptive assertions
    and RFC 2119 terminology.
    The key words “MUST”, “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”, “RECOMMENDED”, “MAY”, and “OPTIONAL”
    in the normative parts of this document
    are to be interpreted as described in RFC 2119.
    However, for readability,
    these words do not appear in all uppercase letters in this specification. </p>
   <p>All of the text of this specification is normative
    except sections explicitly marked as non-normative, examples, and notes. <a data-link-type="biblio" href="#biblio-rfc2119" title="Key words for use in RFCs to Indicate Requirement Levels">[RFC2119]</a> </p>
   <p>Examples in this specification are introduced with the words “for example”
    or are set apart from the normative text
    with <code>class="example"</code>,
    like this: </p>
   <div class="example" id="w3c-example">
    <a class="self-link" href="#w3c-example"></a> 
    <p>This is an example of an informative example. </p>
   </div>
   <p>Informative notes begin with the word “Note”
    and are set apart from the normative text
    with <code>class="note"</code>,
    like this: </p>
   <p class="note" role="note">Note, this is an informative note.</p>
   <section>
    <h3 class="no-ref no-num heading settled" id="w3c-conformant-algorithms"><span class="content">Conformant Algorithms</span><a class="self-link" href="#w3c-conformant-algorithms"></a></h3>
    <p>Requirements phrased in the imperative as part of algorithms
    (such as "strip any leading space characters"
    or "return false and abort these steps")
    are to be interpreted with the meaning of the key word
    ("must", "should", "may", etc)
    used in introducing the algorithm. </p>
    <p>Conformance requirements phrased as algorithms or specific steps
    can be implemented in any manner,
    so long as the end result is equivalent.
    In particular, the algorithms defined in this specification
    are intended to be easy to understand
    and are not intended to be performant.
    Implementers are encouraged to optimize. </p>
   </section>
  </div>
  <script src="https://www.w3.org/scripts/TR/2021/fixup.js"></script>
  <h2 class="no-num no-ref heading settled" id="index"><span class="content">Index</span><a class="self-link" href="#index"></a></h2>
  <h3 class="no-num no-ref heading settled" id="index-defined-here"><span class="content">Terms defined by this specification</span><a class="self-link" href="#index-defined-here"></a></h3>
  <ul class="index">
   <li><a href="#dom-xrframe-getlightestimate">getLightEstimate(lightProbe)</a><span>, in § 3.3</span>
   <li><a href="#dom-xrwebglbinding-getreflectioncubemap">getReflectionCubeMap(lightProbe)</a><span>, in § 4.1</span>
   <li><a href="#feature-descriptor-light-estimation">light-estimation</a><span>, in § 3.1</span>
   <li><a href="#dom-xrlightprobe-onreflectionchange">onreflectionchange</a><span>, in § 2.1</span>
   <li><a href="#dom-xrsession-preferredreflectionformat">preferredReflectionFormat</a><span>, in § 3.2</span>
   <li><a href="#dom-xrlightestimate-primarylightdirection">primaryLightDirection</a><span>, in § 2.3</span>
   <li><a href="#dom-xrlightestimate-primarylightintensity">primaryLightIntensity</a><span>, in § 2.3</span>
   <li><a href="#dom-xrlightprobe-probespace">probeSpace</a><span>, in § 2.1</span>
   <li><a href="#eventdef-xrlightprobe-reflectionchange">reflectionchange</a><span>, in § 5.1</span>
   <li><a href="#xrlightprobe-reflection-format">reflection format</a><span>, in § 3.2</span>
   <li><a href="#dom-xrlightprobeinit-reflectionformat">reflectionFormat</a><span>, in § 3.2</span>
   <li><a href="#dom-xrsession-requestlightprobe">requestLightProbe()</a><span>, in § 3.2</span>
   <li><a href="#dom-xrsession-requestlightprobe">requestLightProbe(options)</a><span>, in § 3.2</span>
   <li><a href="#dom-xrreflectionformat-rgba16f">"rgba16f"</a><span>, in § 2.2</span>
   <li><a href="#xrlightprobe-session">session</a><span>, in § 3.2</span>
   <li><a href="#dom-xrlightestimate-sphericalharmonicscoefficients">sphericalHarmonicsCoefficients</a><span>, in § 2.3</span>
   <li><a href="#dom-xrreflectionformat-srgba8">"srgba8"</a><span>, in § 2.2</span>
   <li><a href="#xrlightestimate">XRLightEstimate</a><span>, in § 2.3</span>
   <li><a href="#xrlightprobe">XRLightProbe</a><span>, in § 2.1</span>
   <li><a href="#dictdef-xrlightprobeinit">XRLightProbeInit</a><span>, in § 3.2</span>
   <li><a href="#enumdef-xrreflectionformat">XRReflectionFormat</a><span>, in § 2.2</span>
  </ul>
  <h3 class="no-num no-ref heading settled" id="index-defined-elsewhere"><span class="content">Terms defined by reference</span><a class="self-link" href="#index-defined-elsewhere"></a></h3>
  <ul class="index">
   <li>
    <a data-link-type="biblio">[AMBIENT-LIGHT]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="ff278a83">privacy and security risks</span>
    </ul>
   <li>
    <a data-link-type="biblio">[DOM]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="129bdae8">Event</span>
     <li><span class="dfn-paneled" id="2bc0cdf4">EventTarget</span>
    </ul>
   <li>
    <a data-link-type="biblio">[GEOMETRY-1]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="5cce610d">DOMPointReadOnly</span>
     <li><span class="dfn-paneled" id="b904c747">w</span>
     <li><span class="dfn-paneled" id="85de675f">x</span>
     <li><span class="dfn-paneled" id="06d1a8bf">y</span>
     <li><span class="dfn-paneled" id="b97bccea">z</span>
    </ul>
   <li>
    <a data-link-type="biblio">[HTML]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="f0951476">EventHandler</span>
     <li><span class="dfn-paneled" id="03675365">event handler idl attribute</span>
     <li><span class="dfn-paneled" id="9a517a7d">queue a task</span>
     <li><span class="dfn-paneled" id="c3b2d08c">task source</span>
    </ul>
   <li>
    <a data-link-type="biblio">[INFRA]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="ae8def21">contain</span>
    </ul>
   <li>
    <a data-link-type="biblio">[WEBGL-2]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="0e5170dd">WebGLTexture</span>
    </ul>
   <li>
    <a data-link-type="biblio">[WEBIDL]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="dca2de17">DOMException</span>
     <li><span class="dfn-paneled" id="889e932f">Exposed</span>
     <li><span class="dfn-paneled" id="0a296dfe">Float32Array</span>
     <li><span class="dfn-paneled" id="797018a7">InvalidStateError</span>
     <li><span class="dfn-paneled" id="3182eb71">NotSupportedError</span>
     <li><span class="dfn-paneled" id="bdbd19d1">Promise</span>
     <li><span class="dfn-paneled" id="b75bb3bd">SecureContext</span>
     <li><span class="dfn-paneled" id="dacde8b5">a new promise</span>
     <li><span class="dfn-paneled" id="b262501e">reject</span>
     <li><span class="dfn-paneled" id="3b90bdcd">resolve</span>
    </ul>
   <li>
    <a data-link-type="biblio">[WEBXR]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="0b566548">XRSpace</span>
     <li><span class="dfn-paneled" id="7c7eccf9">session</span>
    </ul>
   <li>
    <a data-link-type="biblio">[WEBXR DEVICE API - LEVEL 1]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="cbf14c82">XRFrame</span>
     <li><span class="dfn-paneled" id="92c48225">XRSession</span>
     <li><span class="dfn-paneled" id="9db6ca78">active</span>
     <li><span class="dfn-paneled" id="7595b4f3">list of enabled features</span>
     <li><span class="dfn-paneled" id="93c7a14d">native origin</span>
     <li><span class="dfn-paneled" id="0b7e2439">xr device</span>
     <li><span class="dfn-paneled" id="1f00bc99">xr task source</span>
    </ul>
   <li>
    <a data-link-type="biblio">[WEBXR LAYERS API]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="9901f776">XRWebGLBinding</span>
     <li><span class="dfn-paneled" id="3c7fe8e0">context</span>
     <li><span class="dfn-paneled" id="41ed4441">session</span>
    </ul>
  </ul>
  <h2 class="no-num no-ref heading settled" id="references"><span class="content">References</span><a class="self-link" href="#references"></a></h2>
  <h3 class="no-num no-ref heading settled" id="normative"><span class="content">Normative References</span><a class="self-link" href="#normative"></a></h3>
  <dl>
   <dt id="biblio-ambient-light">[AMBIENT-LIGHT]
   <dd>Anssi Kostiainen; Rijubrata Bhaumik. <a href="https://w3c.github.io/ambient-light/"><cite>Ambient Light Sensor</cite></a>. URL: <a href="https://w3c.github.io/ambient-light/">https://w3c.github.io/ambient-light/</a>
   <dt id="biblio-dom">[DOM]
   <dd>Anne van Kesteren. <a href="https://dom.spec.whatwg.org/"><cite>DOM Standard</cite></a>. Living Standard. URL: <a href="https://dom.spec.whatwg.org/">https://dom.spec.whatwg.org/</a>
   <dt id="biblio-geometry-1">[GEOMETRY-1]
   <dd>Simon Pieters; Chris Harrelson. <a href="https://drafts.fxtf.org/geometry/"><cite>Geometry Interfaces Module Level 1</cite></a>. URL: <a href="https://drafts.fxtf.org/geometry/">https://drafts.fxtf.org/geometry/</a>
   <dt id="biblio-html">[HTML]
   <dd>Anne van Kesteren; et al. <a href="https://html.spec.whatwg.org/multipage/"><cite>HTML Standard</cite></a>. Living Standard. URL: <a href="https://html.spec.whatwg.org/multipage/">https://html.spec.whatwg.org/multipage/</a>
   <dt id="biblio-infra">[INFRA]
   <dd>Anne van Kesteren; Domenic Denicola. <a href="https://infra.spec.whatwg.org/"><cite>Infra Standard</cite></a>. Living Standard. URL: <a href="https://infra.spec.whatwg.org/">https://infra.spec.whatwg.org/</a>
   <dt id="biblio-rfc2119">[RFC2119]
   <dd>S. Bradner. <a href="https://datatracker.ietf.org/doc/html/rfc2119"><cite>Key words for use in RFCs to Indicate Requirement Levels</cite></a>. March 1997. Best Current Practice. URL: <a href="https://datatracker.ietf.org/doc/html/rfc2119">https://datatracker.ietf.org/doc/html/rfc2119</a>
   <dt id="biblio-webgl-2">[WEBGL-2]
   <dd>Dean Jackson; Jeff Gilbert. <a href="https://www.khronos.org/registry/webgl/specs/latest/2.0/"><cite>WebGL 2.0 Specification</cite></a>. 12 August 2017. URL: <a href="https://www.khronos.org/registry/webgl/specs/latest/2.0/">https://www.khronos.org/registry/webgl/specs/latest/2.0/</a>
   <dt id="biblio-webidl">[WEBIDL]
   <dd>Edgar Chen; Timothy Gu. <a href="https://webidl.spec.whatwg.org/"><cite>Web IDL Standard</cite></a>. Living Standard. URL: <a href="https://webidl.spec.whatwg.org/">https://webidl.spec.whatwg.org/</a>
   <dt id="biblio-webxr">[WEBXR]
   <dd>Brandon Jones; Manish Goregaokar; Rik Cabanier. <a href="https://immersive-web.github.io/webxr/"><cite>WebXR Device API</cite></a>. URL: <a href="https://immersive-web.github.io/webxr/">https://immersive-web.github.io/webxr/</a>
  </dl>
  <h2 class="no-num no-ref heading settled" id="idl-index"><span class="content">IDL Index</span><a class="self-link" href="#idl-index"></a></h2>
<pre class="idl highlight def">[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#SecureContext"><c- g>SecureContext</c-></a>, <a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed"><c- g>Exposed</c-></a>=<c- n>Window</c->]
<c- b>interface</c-> <a href="#xrlightprobe"><code><c- g>XRLightProbe</c-></code></a> : <a data-link-type="idl-name" href="https://dom.spec.whatwg.org/#eventtarget"><c- n>EventTarget</c-></a> {
  <c- b>readonly</c-> <c- b>attribute</c-> <a data-link-type="idl-name" href="https://immersive-web.github.io/webxr/#xrspace"><c- n>XRSpace</c-></a> <a class="idl-code" data-link-type="attribute" data-readonly data-type="XRSpace" href="#dom-xrlightprobe-probespace"><c- g>probeSpace</c-></a>;
  <c- b>attribute</c-> <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler"><c- n>EventHandler</c-></a> <a class="idl-code" data-link-type="attribute" data-type="EventHandler" href="#dom-xrlightprobe-onreflectionchange"><c- g>onreflectionchange</c-></a>;
};

<c- b>enum</c-> <a href="#enumdef-xrreflectionformat"><code><c- g>XRReflectionFormat</c-></code></a> {
  <a href="#dom-xrreflectionformat-srgba8"><code><c- s>"srgba8"</c-></code></a>,
  <a href="#dom-xrreflectionformat-rgba16f"><code><c- s>"rgba16f"</c-></code></a>,
};

[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#SecureContext"><c- g>SecureContext</c-></a>, <a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed"><c- g>Exposed</c-></a>=<c- n>Window</c->]
<c- b>interface</c-> <a href="#xrlightestimate"><code><c- g>XRLightEstimate</c-></code></a> {
  <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-Float32Array"><c- b>Float32Array</c-></a> <a class="idl-code" data-link-type="attribute" data-readonly data-type="Float32Array" href="#dom-xrlightestimate-sphericalharmonicscoefficients"><c- g>sphericalHarmonicsCoefficients</c-></a>;
  <c- b>readonly</c-> <c- b>attribute</c-> <a data-link-type="idl-name" href="https://drafts.fxtf.org/geometry-1/#dompointreadonly"><c- n>DOMPointReadOnly</c-></a> <a class="idl-code" data-link-type="attribute" data-readonly data-type="DOMPointReadOnly" href="#dom-xrlightestimate-primarylightdirection"><c- g>primaryLightDirection</c-></a>;
  <c- b>readonly</c-> <c- b>attribute</c-> <a data-link-type="idl-name" href="https://drafts.fxtf.org/geometry-1/#dompointreadonly"><c- n>DOMPointReadOnly</c-></a> <a class="idl-code" data-link-type="attribute" data-readonly data-type="DOMPointReadOnly" href="#dom-xrlightestimate-primarylightintensity"><c- g>primaryLightIntensity</c-></a>;
};

<c- b>dictionary</c-> <a href="#dictdef-xrlightprobeinit"><code><c- g>XRLightProbeInit</c-></code></a> {
  <a data-link-type="idl-name" href="#enumdef-xrreflectionformat"><c- n>XRReflectionFormat</c-></a> <a data-default="&quot;srgba8&quot;" data-type="XRReflectionFormat" href="#dom-xrlightprobeinit-reflectionformat"><code><c- g>reflectionFormat</c-></code></a> = "srgba8";
};

<c- b>partial</c-> <c- b>interface</c-> <a class="idl-code" data-link-type="interface" href="https://www.w3.org/TR/webxr/#xrsession-interface"><c- g>XRSession</c-></a> {
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise"><c- b>Promise</c-></a>&lt;<a data-link-type="idl-name" href="#xrlightprobe"><c- n>XRLightProbe</c-></a>> <a class="idl-code" data-link-type="method" href="#dom-xrsession-requestlightprobe"><c- g>requestLightProbe</c-></a>(<c- b>optional</c-> <a data-link-type="idl-name" href="#dictdef-xrlightprobeinit"><c- n>XRLightProbeInit</c-></a> <a href="#dom-xrsession-requestlightprobe-options-options"><code><c- g>options</c-></code></a> = {});
  <c- b>readonly</c-> <c- b>attribute</c-> <a data-link-type="idl-name" href="#enumdef-xrreflectionformat"><c- n>XRReflectionFormat</c-></a> <a data-readonly data-type="XRReflectionFormat" href="#dom-xrsession-preferredreflectionformat"><code><c- g>preferredReflectionFormat</c-></code></a>;
};

<c- b>partial</c-> <c- b>interface</c-> <a class="idl-code" data-link-type="interface" href="https://www.w3.org/TR/webxr/#xrframe-interface"><c- g>XRFrame</c-></a> {
  <a data-link-type="idl-name" href="#xrlightestimate"><c- n>XRLightEstimate</c-></a>? <a class="idl-code" data-link-type="method" href="#dom-xrframe-getlightestimate"><c- g>getLightEstimate</c-></a>(<a data-link-type="idl-name" href="#xrlightprobe"><c- n>XRLightProbe</c-></a> <a href="#dom-xrframe-getlightestimate-lightprobe-lightprobe"><code><c- g>lightProbe</c-></code></a>);
};

<c- b>partial</c-> <c- b>interface</c-> <a class="idl-code" data-link-type="interface" href="https://immersive-web.github.io/layers/#xrwebglbinding"><c- g>XRWebGLBinding</c-></a> {
  <a data-link-type="idl-name" href="https://www.khronos.org/registry/webgl/specs/latest/1.0/#WebGLTexture"><c- n>WebGLTexture</c-></a>? <a class="idl-code" data-link-type="method" href="#dom-xrwebglbinding-getreflectioncubemap"><c- g>getReflectionCubeMap</c-></a>(<a data-link-type="idl-name" href="#xrlightprobe"><c- n>XRLightProbe</c-></a> <a href="#dom-xrwebglbinding-getreflectioncubemap-lightprobe-lightprobe"><code><c- g>lightProbe</c-></code></a>);
};

</pre>
<script>/* Boilerplate: script-dom-helper */
"use strict";
function query(sel) { return document.querySelector(sel); }

function queryAll(sel) { return [...document.querySelectorAll(sel)]; }

function iter(obj) {
	if(!obj) return [];
	var it = obj[Symbol.iterator];
	if(it) return it;
	return Object.entries(obj);
}

function mk(tagname, attrs, ...children) {
	const el = document.createElement(tagname);
	for(const [k,v] of iter(attrs)) {
		if(k.slice(0,3) == "_on") {
			const eventName = k.slice(3);
			el.addEventListener(eventName, v);
		} else if(k[0] == "_") {
			// property, not attribute
			el[k.slice(1)] = v;
		} else {
			if(v === false || v == null) {
        continue;
      } else if(v === true) {
        el.setAttribute(k, "");
        continue;
      } else {
  			el.setAttribute(k, v);
      }
		}
	}
	append(el, children);
	return el;
}

/* Create shortcuts for every known HTML element */
[
  "a",
  "abbr",
  "acronym",
  "address",
  "applet",
  "area",
  "article",
  "aside",
  "audio",
  "b",
  "base",
  "basefont",
  "bdo",
  "big",
  "blockquote",
  "body",
  "br",
  "button",
  "canvas",
  "caption",
  "center",
  "cite",
  "code",
  "col",
  "colgroup",
  "datalist",
  "dd",
  "del",
  "details",
  "dfn",
  "dialog",
  "div",
  "dl",
  "dt",
  "em",
  "embed",
  "fieldset",
  "figcaption",
  "figure",
  "font",
  "footer",
  "form",
  "frame",
  "frameset",
  "head",
  "header",
  "h1",
  "h2",
  "h3",
  "h4",
  "h5",
  "h6",
  "hr",
  "html",
  "i",
  "iframe",
  "img",
  "input",
  "ins",
  "kbd",
  "label",
  "legend",
  "li",
  "link",
  "main",
  "map",
  "mark",
  "meta",
  "meter",
  "nav",
  "nobr",
  "noscript",
  "object",
  "ol",
  "optgroup",
  "option",
  "output",
  "p",
  "param",
  "pre",
  "progress",
  "q",
  "s",
  "samp",
  "script",
  "section",
  "select",
  "small",
  "source",
  "span",
  "strike",
  "strong",
  "style",
  "sub",
  "summary",
  "sup",
  "table",
  "tbody",
  "td",
  "template",
  "textarea",
  "tfoot",
  "th",
  "thead",
  "time",
  "title",
  "tr",
  "u",
  "ul",
  "var",
  "video",
  "wbr",
  "xmp",
].forEach(tagname=>{
	mk[tagname] = (...args) => mk(tagname, ...args);
});

function* nodesFromChildList(children) {
	for(const child of children.flat(Infinity)) {
		if(child instanceof Node) {
			yield child;
		} else {
			yield new Text(child);
		}
	}
}
function append(el, ...children) {
	for(const child of nodesFromChildList(children)) {
		if(el instanceof Node) el.appendChild(child);
		else el.push(child);
	}
	return el;
}

function insertAfter(el, ...children) {
	for(const child of nodesFromChildList(children)) {
		el.parentNode.insertBefore(child, el.nextSibling);
	}
	return el;
}

function clearContents(el) {
	el.innerHTML = "";
	return el;
}

function parseHTML(markup) {
	if(markup.toLowerCase().trim().indexOf('<!doctype') === 0) {
		const doc = document.implementation.createHTMLDocument("");
		doc.documentElement.innerHTML = markup;
		return doc;
	} else {
		const el = mk.template({});
		el.innerHTML = markup;
		return el.content;
	}
}</script>
<script>/* Boilerplate: script-dfn-panel */
"use strict";
{
let dfnPanelData = {
"03675365": {"dfnID":"03675365","dfnText":"event handler idl attribute","external":true,"refSections":[{"refs":[{"id":"ref-for-event-handler-idl-attributes"}],"title":"2.1. XRLightProbe"}],"url":"https://html.spec.whatwg.org/multipage/webappapis.html#event-handler-idl-attributes"},
"06d1a8bf": {"dfnID":"06d1a8bf","dfnText":"y","external":true,"refSections":[{"refs":[{"id":"ref-for-dom-dompointreadonly-y"}],"title":"2.3. XRLightEstimate"}],"url":"https://drafts.fxtf.org/geometry-1/#dom-dompointreadonly-y"},
"0a296dfe": {"dfnID":"0a296dfe","dfnText":"Float32Array","external":true,"refSections":[{"refs":[{"id":"ref-for-idl-Float32Array"},{"id":"ref-for-idl-Float32Array\u2460"}],"title":"2.3. XRLightEstimate"}],"url":"https://webidl.spec.whatwg.org/#idl-Float32Array"},
"0b566548": {"dfnID":"0b566548","dfnText":"XRSpace","external":true,"refSections":[{"refs":[{"id":"ref-for-xrspace"},{"id":"ref-for-xrspace\u2460"}],"title":"2.1. XRLightProbe"}],"url":"https://immersive-web.github.io/webxr/#xrspace"},
"0b7e2439": {"dfnID":"0b7e2439","dfnText":"xr device","external":true,"refSections":[{"refs":[{"id":"ref-for-xrsession-xr-device"}],"title":"3.2. XRSession"},{"refs":[{"id":"ref-for-xrsession-xr-device\u2460"}],"title":"3.3. XRFrame"},{"refs":[{"id":"ref-for-xrsession-xr-device\u2461"}],"title":"4.1. XRWebGLBinding"}],"url":"https://www.w3.org/TR/webxr/#xrsession-xr-device"},
"0e5170dd": {"dfnID":"0e5170dd","dfnText":"WebGLTexture","external":true,"refSections":[{"refs":[{"id":"ref-for-WebGLTexture"},{"id":"ref-for-WebGLTexture\u2460"}],"title":"4.1. XRWebGLBinding"}],"url":"https://www.khronos.org/registry/webgl/specs/latest/1.0/#WebGLTexture"},
"129bdae8": {"dfnID":"129bdae8","dfnText":"Event","external":true,"refSections":[{"refs":[{"id":"ref-for-event"}],"title":"5.1. Event Types"}],"url":"https://dom.spec.whatwg.org/#event"},
"1f00bc99": {"dfnID":"1f00bc99","dfnText":"xr task source","external":true,"refSections":[{"refs":[{"id":"ref-for-xr-task-source"}],"title":"5. Events"}],"url":"https://www.w3.org/TR/webxr/#xr-task-source"},
"2bc0cdf4": {"dfnID":"2bc0cdf4","dfnText":"EventTarget","external":true,"refSections":[{"refs":[{"id":"ref-for-eventtarget"}],"title":"2.1. XRLightProbe"}],"url":"https://dom.spec.whatwg.org/#eventtarget"},
"3182eb71": {"dfnID":"3182eb71","dfnText":"NotSupportedError","external":true,"refSections":[{"refs":[{"id":"ref-for-notsupportederror"},{"id":"ref-for-notsupportederror\u2460"}],"title":"3.2. XRSession"}],"url":"https://webidl.spec.whatwg.org/#notsupportederror"},
"3b90bdcd": {"dfnID":"3b90bdcd","dfnText":"resolve","external":true,"refSections":[{"refs":[{"id":"ref-for-resolve"}],"title":"3.2. XRSession"}],"url":"https://webidl.spec.whatwg.org/#resolve"},
"3c7fe8e0": {"dfnID":"3c7fe8e0","dfnText":"context","external":true,"refSections":[{"refs":[{"id":"ref-for-xrwebglbinding-context"}],"title":"4.1. XRWebGLBinding"}],"url":"https://immersive-web.github.io/layers/#xrwebglbinding-context"},
"41ed4441": {"dfnID":"41ed4441","dfnText":"session","external":true,"refSections":[{"refs":[{"id":"ref-for-session"}],"title":"4.1. XRWebGLBinding"}],"url":"https://immersive-web.github.io/layers/#session"},
"5cce610d": {"dfnID":"5cce610d","dfnText":"DOMPointReadOnly","external":true,"refSections":[{"refs":[{"id":"ref-for-dompointreadonly"},{"id":"ref-for-dompointreadonly\u2460"}],"title":"2.3. XRLightEstimate"}],"url":"https://drafts.fxtf.org/geometry-1/#dompointreadonly"},
"7595b4f3": {"dfnID":"7595b4f3","dfnText":"list of enabled features","external":true,"refSections":[{"refs":[{"id":"ref-for-xrsession-list-of-enabled-features"}],"title":"3.2. XRSession"}],"url":"https://www.w3.org/TR/webxr/#xrsession-list-of-enabled-features"},
"797018a7": {"dfnID":"797018a7","dfnText":"InvalidStateError","external":true,"refSections":[{"refs":[{"id":"ref-for-invalidstateerror"}],"title":"3.2. XRSession"},{"refs":[{"id":"ref-for-invalidstateerror\u2460"},{"id":"ref-for-invalidstateerror\u2461"}],"title":"3.3. XRFrame"},{"refs":[{"id":"ref-for-invalidstateerror\u2462"},{"id":"ref-for-invalidstateerror\u2463"},{"id":"ref-for-invalidstateerror\u2464"}],"title":"4.1. XRWebGLBinding"}],"url":"https://webidl.spec.whatwg.org/#invalidstateerror"},
"7c7eccf9": {"dfnID":"7c7eccf9","dfnText":"session","external":true,"refSections":[{"refs":[{"id":"ref-for-dom-xrframe-session"}],"title":"3.3. XRFrame"}],"url":"https://immersive-web.github.io/webxr/#dom-xrframe-session"},
"85de675f": {"dfnID":"85de675f","dfnText":"x","external":true,"refSections":[{"refs":[{"id":"ref-for-dom-dompointreadonly-x"}],"title":"2.3. XRLightEstimate"}],"url":"https://drafts.fxtf.org/geometry-1/#dom-dompointreadonly-x"},
"889e932f": {"dfnID":"889e932f","dfnText":"Exposed","external":true,"refSections":[{"refs":[{"id":"ref-for-Exposed"}],"title":"2.1. XRLightProbe"},{"refs":[{"id":"ref-for-Exposed\u2460"}],"title":"2.3. XRLightEstimate"}],"url":"https://webidl.spec.whatwg.org/#Exposed"},
"92c48225": {"dfnID":"92c48225","dfnText":"XRSession","external":true,"refSections":[{"refs":[{"id":"ref-for-xrsession-interface"}],"title":"3. WebXR Device API Integration"},{"refs":[{"id":"ref-for-xrsession-interface\u2460"},{"id":"ref-for-xrsession-interface\u2461"},{"id":"ref-for-xrsession-interface\u2462"},{"id":"ref-for-xrsession-interface\u2463"},{"id":"ref-for-xrsession-interface\u2464"}],"title":"3.2. XRSession"}],"url":"https://www.w3.org/TR/webxr/#xrsession-interface"},
"93c7a14d": {"dfnID":"93c7a14d","dfnText":"native origin","external":true,"refSections":[{"refs":[{"id":"ref-for-xrspace-native-origin"}],"title":"2.1. XRLightProbe"},{"refs":[{"id":"ref-for-xrspace-native-origin\u2460"}],"title":"2.3. XRLightEstimate"}],"url":"https://www.w3.org/TR/webxr/#xrspace-native-origin"},
"9901f776": {"dfnID":"9901f776","dfnText":"XRWebGLBinding","external":true,"refSections":[{"refs":[{"id":"ref-for-xrwebglbinding"}],"title":"4. WebXR Layers Integration"},{"refs":[{"id":"ref-for-xrwebglbinding\u2460"},{"id":"ref-for-xrwebglbinding\u2461"},{"id":"ref-for-xrwebglbinding\u2462"}],"title":"4.1. XRWebGLBinding"}],"url":"https://immersive-web.github.io/layers/#xrwebglbinding"},
"9a517a7d": {"dfnID":"9a517a7d","dfnText":"queue a task","external":true,"refSections":[{"refs":[{"id":"ref-for-queue-a-task"}],"title":"5. Events"}],"url":"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task"},
"9db6ca78": {"dfnID":"9db6ca78","dfnText":"active","external":true,"refSections":[{"refs":[{"id":"ref-for-xrframe-active"}],"title":"3.3. XRFrame"}],"url":"https://www.w3.org/TR/webxr/#xrframe-active"},
"ae8def21": {"dfnID":"ae8def21","dfnText":"contain","external":true,"refSections":[{"refs":[{"id":"ref-for-list-contain"}],"title":"3.2. XRSession"}],"url":"https://infra.spec.whatwg.org/#list-contain"},
"b262501e": {"dfnID":"b262501e","dfnText":"reject","external":true,"refSections":[{"refs":[{"id":"ref-for-reject"},{"id":"ref-for-reject\u2460"}],"title":"3.2. XRSession"}],"url":"https://webidl.spec.whatwg.org/#reject"},
"b75bb3bd": {"dfnID":"b75bb3bd","dfnText":"SecureContext","external":true,"refSections":[{"refs":[{"id":"ref-for-SecureContext"}],"title":"2.1. XRLightProbe"},{"refs":[{"id":"ref-for-SecureContext\u2460"}],"title":"2.3. XRLightEstimate"}],"url":"https://webidl.spec.whatwg.org/#SecureContext"},
"b904c747": {"dfnID":"b904c747","dfnText":"w","external":true,"refSections":[{"refs":[{"id":"ref-for-dom-dompointreadonly-w"},{"id":"ref-for-dom-dompointreadonly-w\u2460"}],"title":"2.3. XRLightEstimate"}],"url":"https://drafts.fxtf.org/geometry-1/#dom-dompointreadonly-w"},
"b97bccea": {"dfnID":"b97bccea","dfnText":"z","external":true,"refSections":[{"refs":[{"id":"ref-for-dom-dompointreadonly-z"}],"title":"2.3. XRLightEstimate"}],"url":"https://drafts.fxtf.org/geometry-1/#dom-dompointreadonly-z"},
"bdbd19d1": {"dfnID":"bdbd19d1","dfnText":"Promise","external":true,"refSections":[{"refs":[{"id":"ref-for-idl-promise"}],"title":"3.2. XRSession"}],"url":"https://webidl.spec.whatwg.org/#idl-promise"},
"c3b2d08c": {"dfnID":"c3b2d08c","dfnText":"task source","external":true,"refSections":[{"refs":[{"id":"ref-for-task-source"}],"title":"5. Events"}],"url":"https://html.spec.whatwg.org/multipage/webappapis.html#task-source"},
"cbf14c82": {"dfnID":"cbf14c82","dfnText":"XRFrame","external":true,"refSections":[{"refs":[{"id":"ref-for-xrframe-interface"},{"id":"ref-for-xrframe-interface\u2460"}],"title":"2.3. XRLightEstimate"},{"refs":[{"id":"ref-for-xrframe-interface\u2461"}],"title":"3. WebXR Device API Integration"},{"refs":[{"id":"ref-for-xrframe-interface\u2462"},{"id":"ref-for-xrframe-interface\u2463"},{"id":"ref-for-xrframe-interface\u2464"}],"title":"3.3. XRFrame"}],"url":"https://www.w3.org/TR/webxr/#xrframe-interface"},
"dacde8b5": {"dfnID":"dacde8b5","dfnText":"a new promise","external":true,"refSections":[{"refs":[{"id":"ref-for-a-new-promise"}],"title":"3.2. XRSession"}],"url":"https://webidl.spec.whatwg.org/#a-new-promise"},
"dca2de17": {"dfnID":"dca2de17","dfnText":"DOMException","external":true,"refSections":[{"refs":[{"id":"ref-for-idl-DOMException"}],"title":"3.2. XRSession"}],"url":"https://webidl.spec.whatwg.org/#idl-DOMException"},
"dictdef-xrlightprobeinit": {"dfnID":"dictdef-xrlightprobeinit","dfnText":"XRLightProbeInit","external":false,"refSections":[{"refs":[{"id":"ref-for-dictdef-xrlightprobeinit"}],"title":"3.2. XRSession"}],"url":"#dictdef-xrlightprobeinit"},
"dom-xrframe-getlightestimate": {"dfnID":"dom-xrframe-getlightestimate","dfnText":"getLightEstimate(lightProbe)","external":false,"refSections":[{"refs":[{"id":"ref-for-dom-xrframe-getlightestimate"}],"title":"2.3. XRLightEstimate"},{"refs":[{"id":"ref-for-dom-xrframe-getlightestimate\u2460"}],"title":"3.3. XRFrame"}],"url":"#dom-xrframe-getlightestimate"},
"dom-xrframe-getlightestimate-lightprobe-lightprobe": {"dfnID":"dom-xrframe-getlightestimate-lightprobe-lightprobe","dfnText":"lightProbe","external":false,"refSections":[],"url":"#dom-xrframe-getlightestimate-lightprobe-lightprobe"},
"dom-xrlightestimate-primarylightdirection": {"dfnID":"dom-xrlightestimate-primarylightdirection","dfnText":"primaryLightDirection","external":false,"refSections":[{"refs":[{"id":"ref-for-dom-xrlightestimate-primarylightdirection"},{"id":"ref-for-dom-xrlightestimate-primarylightdirection\u2460"}],"title":"2.3. XRLightEstimate"},{"refs":[{"id":"ref-for-dom-xrlightestimate-primarylightdirection\u2461"},{"id":"ref-for-dom-xrlightestimate-primarylightdirection\u2462"}],"title":"3.3. XRFrame"}],"url":"#dom-xrlightestimate-primarylightdirection"},
"dom-xrlightestimate-primarylightintensity": {"dfnID":"dom-xrlightestimate-primarylightintensity","dfnText":"primaryLightIntensity","external":false,"refSections":[{"refs":[{"id":"ref-for-dom-xrlightestimate-primarylightintensity"},{"id":"ref-for-dom-xrlightestimate-primarylightintensity\u2460"}],"title":"2.3. XRLightEstimate"},{"refs":[{"id":"ref-for-dom-xrlightestimate-primarylightintensity\u2461"},{"id":"ref-for-dom-xrlightestimate-primarylightintensity\u2462"}],"title":"3.3. XRFrame"}],"url":"#dom-xrlightestimate-primarylightintensity"},
"dom-xrlightestimate-sphericalharmonicscoefficients": {"dfnID":"dom-xrlightestimate-sphericalharmonicscoefficients","dfnText":"sphericalHarmonicsCoefficients","external":false,"refSections":[{"refs":[{"id":"ref-for-dom-xrlightestimate-sphericalharmonicscoefficients"},{"id":"ref-for-dom-xrlightestimate-sphericalharmonicscoefficients\u2460"},{"id":"ref-for-dom-xrlightestimate-sphericalharmonicscoefficients\u2461"}],"title":"2.3. XRLightEstimate"},{"refs":[{"id":"ref-for-dom-xrlightestimate-sphericalharmonicscoefficients\u2462"}],"title":"3.3. XRFrame"}],"url":"#dom-xrlightestimate-sphericalharmonicscoefficients"},
"dom-xrlightprobe-onreflectionchange": {"dfnID":"dom-xrlightprobe-onreflectionchange","dfnText":"onreflectionchange","external":false,"refSections":[{"refs":[{"id":"ref-for-dom-xrlightprobe-onreflectionchange"}],"title":"2.1. XRLightProbe"}],"url":"#dom-xrlightprobe-onreflectionchange"},
"dom-xrlightprobe-probespace": {"dfnID":"dom-xrlightprobe-probespace","dfnText":"probeSpace","external":false,"refSections":[{"refs":[{"id":"ref-for-dom-xrlightprobe-probespace"}],"title":"2.1. XRLightProbe"},{"refs":[{"id":"ref-for-dom-xrlightprobe-probespace\u2460"},{"id":"ref-for-dom-xrlightprobe-probespace\u2461"}],"title":"2.3. XRLightEstimate"}],"url":"#dom-xrlightprobe-probespace"},
"dom-xrlightprobeinit-reflectionformat": {"dfnID":"dom-xrlightprobeinit-reflectionformat","dfnText":"reflectionFormat","external":false,"refSections":[{"refs":[{"id":"ref-for-dom-xrlightprobeinit-reflectionformat"},{"id":"ref-for-dom-xrlightprobeinit-reflectionformat\u2460"}],"title":"3.2. XRSession"}],"url":"#dom-xrlightprobeinit-reflectionformat"},
"dom-xrreflectionformat-rgba16f": {"dfnID":"dom-xrreflectionformat-rgba16f","dfnText":"\"rgba16f\"","external":false,"refSections":[{"refs":[{"id":"ref-for-dom-xrreflectionformat-rgba16f"}],"title":"2.2. XRReflectionFormat"}],"url":"#dom-xrreflectionformat-rgba16f"},
"dom-xrreflectionformat-srgba8": {"dfnID":"dom-xrreflectionformat-srgba8","dfnText":"\"srgba8\"","external":false,"refSections":[{"refs":[{"id":"ref-for-dom-xrreflectionformat-srgba8"},{"id":"ref-for-dom-xrreflectionformat-srgba8\u2460"}],"title":"2.2. XRReflectionFormat"},{"refs":[{"id":"ref-for-dom-xrreflectionformat-srgba8\u2461"}],"title":"3.2. XRSession"}],"url":"#dom-xrreflectionformat-srgba8"},
"dom-xrsession-preferredreflectionformat": {"dfnID":"dom-xrsession-preferredreflectionformat","dfnText":"preferredReflectionFormat","external":false,"refSections":[{"refs":[{"id":"ref-for-dom-xrsession-preferredreflectionformat"}],"title":"2.2. XRReflectionFormat"},{"refs":[{"id":"ref-for-dom-xrsession-preferredreflectionformat\u2460"},{"id":"ref-for-dom-xrsession-preferredreflectionformat\u2461"}],"title":"3.2. XRSession"}],"url":"#dom-xrsession-preferredreflectionformat"},
"dom-xrsession-requestlightprobe": {"dfnID":"dom-xrsession-requestlightprobe","dfnText":"requestLightProbe(options)","external":false,"refSections":[{"refs":[{"id":"ref-for-dom-xrsession-requestlightprobe"}],"title":"3.2. XRSession"}],"url":"#dom-xrsession-requestlightprobe"},
"dom-xrsession-requestlightprobe-options-options": {"dfnID":"dom-xrsession-requestlightprobe-options-options","dfnText":"options","external":false,"refSections":[],"url":"#dom-xrsession-requestlightprobe-options-options"},
"dom-xrwebglbinding-getreflectioncubemap": {"dfnID":"dom-xrwebglbinding-getreflectioncubemap","dfnText":"getReflectionCubeMap(lightProbe)","external":false,"refSections":[{"refs":[{"id":"ref-for-dom-xrwebglbinding-getreflectioncubemap"}],"title":"4.1. XRWebGLBinding"},{"refs":[{"id":"ref-for-dom-xrwebglbinding-getreflectioncubemap\u2460"}],"title":"5.1. Event Types"}],"url":"#dom-xrwebglbinding-getreflectioncubemap"},
"dom-xrwebglbinding-getreflectioncubemap-lightprobe-lightprobe": {"dfnID":"dom-xrwebglbinding-getreflectioncubemap-lightprobe-lightprobe","dfnText":"lightProbe","external":false,"refSections":[],"url":"#dom-xrwebglbinding-getreflectioncubemap-lightprobe-lightprobe"},
"enumdef-xrreflectionformat": {"dfnID":"enumdef-xrreflectionformat","dfnText":"XRReflectionFormat","external":false,"refSections":[{"refs":[{"id":"ref-for-enumdef-xrreflectionformat"}],"title":"2.2. XRReflectionFormat"},{"refs":[{"id":"ref-for-enumdef-xrreflectionformat\u2460"},{"id":"ref-for-enumdef-xrreflectionformat\u2461"},{"id":"ref-for-enumdef-xrreflectionformat\u2462"},{"id":"ref-for-enumdef-xrreflectionformat\u2463"}],"title":"3.2. XRSession"}],"url":"#enumdef-xrreflectionformat"},
"eventdef-xrlightprobe-reflectionchange": {"dfnID":"eventdef-xrlightprobe-reflectionchange","dfnText":"reflectionchange","external":false,"refSections":[{"refs":[{"id":"ref-for-eventdef-xrlightprobe-reflectionchange"}],"title":"2.1. XRLightProbe"}],"url":"#eventdef-xrlightprobe-reflectionchange"},
"f0951476": {"dfnID":"f0951476","dfnText":"EventHandler","external":true,"refSections":[{"refs":[{"id":"ref-for-eventhandler"}],"title":"2.1. XRLightProbe"}],"url":"https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler"},
"feature-descriptor-light-estimation": {"dfnID":"feature-descriptor-light-estimation","dfnText":"light-estimation","external":false,"refSections":[{"refs":[{"id":"ref-for-feature-descriptor-light-estimation"}],"title":"3.1. Session Initialization"},{"refs":[{"id":"ref-for-feature-descriptor-light-estimation\u2460"}],"title":"3.2. XRSession"}],"url":"#feature-descriptor-light-estimation"},
"ff278a83": {"dfnID":"ff278a83","dfnText":"privacy and security risks","external":true,"refSections":[{"refs":[{"id":"ref-for-security-and-privacy"}],"title":"6. Privacy & Security Considerations"}],"url":"https://www.w3.org/TR/ambient-light/#security-and-privacy"},
"xrlightestimate": {"dfnID":"xrlightestimate","dfnText":"XRLightEstimate","external":false,"refSections":[{"refs":[{"id":"ref-for-xrlightestimate"},{"id":"ref-for-xrlightestimate\u2460"},{"id":"ref-for-xrlightestimate\u2461"},{"id":"ref-for-xrlightestimate\u2462"}],"title":"2.3. XRLightEstimate"},{"refs":[{"id":"ref-for-xrlightestimate\u2463"},{"id":"ref-for-xrlightestimate\u2464"},{"id":"ref-for-xrlightestimate\u2465"}],"title":"3.3. XRFrame"}],"url":"#xrlightestimate"},
"xrlightprobe": {"dfnID":"xrlightprobe","dfnText":"XRLightProbe","external":false,"refSections":[{"refs":[{"id":"ref-for-xrlightprobe"},{"id":"ref-for-xrlightprobe\u2460"}],"title":"2.1. XRLightProbe"},{"refs":[{"id":"ref-for-xrlightprobe\u2461"},{"id":"ref-for-xrlightprobe\u2462"},{"id":"ref-for-xrlightprobe\u2463"},{"id":"ref-for-xrlightprobe\u2464"}],"title":"2.3. XRLightEstimate"},{"refs":[{"id":"ref-for-xrlightprobe\u2465"},{"id":"ref-for-xrlightprobe\u2466"},{"id":"ref-for-xrlightprobe\u2467"},{"id":"ref-for-xrlightprobe\u2468"},{"id":"ref-for-xrlightprobe\u2460\u24ea"}],"title":"3.2. XRSession"},{"refs":[{"id":"ref-for-xrlightprobe\u2460\u2460"},{"id":"ref-for-xrlightprobe\u2460\u2461"}],"title":"3.3. XRFrame"},{"refs":[{"id":"ref-for-xrlightprobe\u2460\u2462"},{"id":"ref-for-xrlightprobe\u2460\u2463"}],"title":"4.1. XRWebGLBinding"},{"refs":[{"id":"ref-for-xrlightprobe\u2460\u2464"}],"title":"5.1. Event Types"}],"url":"#xrlightprobe"},
"xrlightprobe-reflection-format": {"dfnID":"xrlightprobe-reflection-format","dfnText":"reflection format","external":false,"refSections":[{"refs":[{"id":"ref-for-xrlightprobe-reflection-format"}],"title":"3.2. XRSession"},{"refs":[{"id":"ref-for-xrlightprobe-reflection-format\u2460"}],"title":"4.1. XRWebGLBinding"}],"url":"#xrlightprobe-reflection-format"},
"xrlightprobe-session": {"dfnID":"xrlightprobe-session","dfnText":"session","external":false,"refSections":[{"refs":[{"id":"ref-for-xrlightprobe-session"}],"title":"3.2. XRSession"},{"refs":[{"id":"ref-for-xrlightprobe-session\u2460"}],"title":"3.3. XRFrame"},{"refs":[{"id":"ref-for-xrlightprobe-session\u2461"}],"title":"4.1. XRWebGLBinding"}],"url":"#xrlightprobe-session"},
};

document.addEventListener("DOMContentLoaded", ()=>{
    genAllDfnPanels();

    document.body.addEventListener("click", (e) => {
        // If not handled already, just hide all dfn panels.
        hideAllDfnPanels();
    });
});

window.addEventListener("resize", () => {
    // Pin any visible dfn panel
    queryAll(".dfn-panel.on, .dfn-panel.activated").forEach(el=>positionDfnPanel(el));
});

function genAllDfnPanels() {
    for(const panelData of Object.values(dfnPanelData)) {
        const dfnID = panelData.dfnID;
        const dfn = document.getElementById(dfnID);
        if(!dfn) {
            console.log(`Can't find dfn#${dfnID}.`, panelData);
            continue;
        }
        dfn.panelData = panelData;
        insertDfnPopupAction(dfn);
    }
}

function genDfnPanel(dfn, { dfnID, url, dfnText, refSections, external }) {
    const dfnPanel = mk.aside({
        class: "dfn-panel on",
        id: `infopanel-for-${dfnID}`,
        "data-for": dfnID,
        "aria-labelled-by":`infopaneltitle-for-${dfnID}`,
        },
        mk.span({id:`infopaneltitle-for-${dfnID}`, style:"display:none"},
            `Info about the '${dfnText}' ${external?"external":""} reference.`),
        mk.a({href:url, class:"dfn-link"}, url),
        refSections.length == 0 ? [] :
            mk.b({}, "Referenced in:"),
            mk.ul({},
                ...refSections.map(section=>
                    mk.li({},
                        ...section.refs.map((ref, refI)=>
                            [
                                mk.a({ href: `#${ref.id}` },
                                    (refI == 0) ? section.title : `(${refI + 1})`
                                ),
                                " ",
                            ]
                        ),
                    ),
                ),
            ),
        genLinkingSyntaxes(dfn),
    );

    dfnPanel.addEventListener('click', (event) => {
        if (event.target.nodeName == 'A') {
            scrollToTargetAndHighlight(event);
            pinDfnPanel(dfnPanel);
        }
        event.stopPropagation();
        refocusOnTarget(event);
    });
    dfnPanel.addEventListener('keydown', (event) => {
        if(event.keyCode == 27) { // Escape key
            hideDfnPanel({dfnPanel});
            event.stopPropagation();
            event.preventDefault();
        }
    });

    dfnPanel.dfn = dfn;
    dfn.dfnPanel = dfnPanel;
    return dfnPanel;
}



function hideAllDfnPanels() {
    // Delete the currently-active dfn panel.
    queryAll(".dfn-panel").forEach(dfnPanel=>hideDfnPanel({dfnPanel}));
}

function showDfnPanel(dfn) {
    hideAllDfnPanels(); // Only display one at a time.

    dfn.setAttribute("aria-expanded", "true");

    const dfnPanel = genDfnPanel(dfn, dfn.panelData);

    // Give the dfn a unique tabindex, and then
    // give all the tabbable panel bits successive indexes.
    let tabIndex = 100;
    dfn.tabIndex = tabIndex++;
    const tabbable = dfnPanel.querySelectorAll(":is(a, button)");
    for (const el of tabbable) {
        el.tabIndex = tabIndex++;
    }

    append(document.body, dfnPanel);
    positionDfnPanel(dfnPanel);
}

function positionDfnPanel(dfnPanel) {
    const dfn = dfnPanel.dfn;
    const dfnPos = getBounds(dfn);
    dfnPanel.style.top = dfnPos.bottom + "px";
    dfnPanel.style.left = dfnPos.left + "px";

    const panelPos = dfnPanel.getBoundingClientRect();
    const panelMargin = 8;
    const maxRight = document.body.parentNode.clientWidth - panelMargin;
    if (panelPos.right > maxRight) {
        const overflowAmount = panelPos.right - maxRight;
        const newLeft = Math.max(panelMargin, dfnPos.left - overflowAmount);
        dfnPanel.style.left = newLeft + "px";
    }
}

function pinDfnPanel(dfnPanel) {
    // Switch it to "activated" state, which pins it.
    dfnPanel.classList.add("activated");
    dfnPanel.style.position = "fixed";
    dfnPanel.style.left = null;
    dfnPanel.style.top = null;
}

function hideDfnPanel({dfn, dfnPanel}) {
    if(!dfnPanel) dfnPanel = dfn.dfnPanel;
    if(!dfn) dfn = dfnPanel.dfn;
    dfn.dfnPanel = undefined;
    dfnPanel.dfn = undefined;
    dfn.setAttribute("aria-expanded", "false");
    dfn.tabIndex = undefined;
    dfnPanel.remove()
}

function toggleDfnPanel(dfn) {
    if(dfn.dfnPanel) {
        hideDfnPanel(dfn);
    } else {
        showDfnPanel(dfn);
    }
}

function insertDfnPopupAction(dfn) {
    dfn.setAttribute('role', 'button');
    dfn.setAttribute('aria-expanded', 'false')
    dfn.tabIndex = 0;
    dfn.classList.add('has-dfn-panel');
    dfn.addEventListener('click', (event) => {
        toggleDfnPanel(dfn);
        event.stopPropagation();
    });
    dfn.addEventListener('keypress', (event) => {
        const kc = event.keyCode;
        // 32->Space, 13->Enter
        if(kc == 32 || kc == 13) {
            toggleDfnPanel(dfn);
            event.stopPropagation();
            event.preventDefault();
        }
    });
}

function refocusOnTarget(event) {
    const target = event.target;
    setTimeout(() => {
        // Refocus on the event.target element.
        // This is needed after browser scrolls to the destination.
        target.focus();
    });
}

// TODO: shared util
// Returns the root-level absolute position {left and top} of element.
function getBounds(el, relativeTo=document.body) {
    const relativeRect = relativeTo.getBoundingClientRect();
    const elRect = el.getBoundingClientRect();
    const top = elRect.top - relativeRect.top;
    const left = elRect.left - relativeRect.left;
    return {
        top,
        left,
        bottom: top + elRect.height,
        right: left + elRect.width,
    }
}

function scrollToTargetAndHighlight(event) {
    let hash = event.target.hash;
    if (hash) {
        hash = decodeURIComponent(hash.substring(1));
        const dest = document.getElementById(hash);
        if (dest) {
            dest.classList.add('highlighted');
            setTimeout(() => dest.classList.remove('highlighted'), 1000);
        }
    }
}

// Functions, divided by link type, that wrap an autolink's
// contents with the appropriate outer syntax.
// Alternately, a string naming another type they format
// the same as.
function needsFor(type) {
    switch(type) {
        case "descriptor":
        case "value":
        case "element-attr":
        case "attr-value":
        case "element-state":
        case "method":
        case "constructor":
        case "argument":
        case "attribute":
        case "const":
        case "dict-member":
        case "event":
        case "enum-value":
        case "stringifier":
        case "serializer":
        case "iterator":
        case "maplike":
        case "setlike":
        case "state":
        case "mode":
        case "context":
        case "facet": return true;

        default: return false;
    }
}
function refusesFor(type) {
    switch(type) {
        case "property":
        case "element":
        case "interface":
        case "namespace":
        case "callback":
        case "dictionary":
        case "enum":
        case "exception":
        case "typedef":
        case "http-header":
        case "permission": return true;

        default: return false;
    }
}
function linkFormatterFromType(type) {
    switch(type) {
        case 'scheme':
        case 'permission':
        case 'dfn': return (text) => `[=${text}=]`;

        case 'abstract-op': return (text) => `[\$${text}\$]`;

        case 'function':
        case 'at-rule':
        case 'selector':
        case 'value': return (text) => `''${text}''`;

        case 'http-header': return (text) => `[:${text}:]`;

        case 'interface':
        case 'constructor':
        case 'method':
        case 'argument':
        case 'attribute':
        case 'callback':
        case 'dictionary':
        case 'dict-member':
        case 'enum':
        case 'enum-value':
        case 'exception':
        case 'const':
        case 'typedef':
        case 'stringifier':
        case 'serializer':
        case 'iterator':
        case 'maplike':
        case 'setlike':
        case 'extended-attribute':
        case 'event':
        case 'idl': return (text) => `{{${text}}}`;

        case 'element-state':
        case 'element-attr':
        case 'attr-value':
        case 'element': return (element) => `<{${element}}>`;

        case 'grammar': return (text) => `${text} (within a <pre class=prod>)`;

        case 'type': return (text)=> `<<${text}>>`;

        case 'descriptor':
        case 'property': return (text) => `'${text}'`;

        default: return;
    };
};

function genLinkingSyntaxes(dfn) {
    if(dfn.tagName != "DFN") return;

    const type = dfn.getAttribute('data-dfn-type');
    if(!type) {
        console.log(`<dfn> doesn't have a data-dfn-type:`, dfn);
        return [];
    }

    // Return a function that wraps link text based on the type
    const linkFormatter = linkFormatterFromType(type);
    if(!linkFormatter) {
        console.log(`<dfn> has an unknown data-dfn-type:`, dfn);
        return [];
    }

    let ltAlts;
    if(dfn.hasAttribute('data-lt')) {
        ltAlts = dfn.getAttribute('data-lt')
            .split("|")
            .map(x=>x.trim());
    } else {
        ltAlts = [dfn.textContent.trim()];
    }
    if(type == "type") {
        // lt of "<foo>", but "foo" is the interior;
        // <<foo/bar>> is how you write it with a for,
        // not <foo/<bar>> or whatever.
        for(var i = 0; i < ltAlts.length; i++) {
            const lt = ltAlts[i];
            const match = /<(.*)>/.exec(lt);
            if(match) { ltAlts[i] = match[1]; }
        }
    }

    let forAlts;
    if(dfn.hasAttribute('data-dfn-for')) {
        forAlts = dfn.getAttribute('data-dfn-for')
            .split(",")
            .map(x=>x.trim());
    } else {
        forAlts = [''];
    }

    let linkingSyntaxes = [];
    if(!needsFor(type)) {
        for(const lt of ltAlts) {
            linkingSyntaxes.push(linkFormatter(lt));
        }
    }
    if(!refusesFor(type)) {
        for(const f of forAlts) {
            linkingSyntaxes.push(linkFormatter(`${f}/${ltAlts[0]}`))
        }
    }
    return [
        mk.b({}, 'Possible linking syntaxes:'),
        mk.ul({},
            ...linkingSyntaxes.map(link => {
                const copyLink = async () =>
                    await navigator.clipboard.writeText(link);
                return mk.li({},
                    mk.div({ class: 'link-item' },
                        mk.button({
                            class: 'copy-icon', title: 'Copy',
                            type: 'button',
                            _onclick: copyLink,
                            tabindex: 0,
                        }, mk.span({ class: 'icon' }) ),
                        mk.span({}, link)
                    )
                );
            })
        )
    ];
}
}
</script>
<script>/* Boilerplate: script-ref-hints */
"use strict";
{
let refsData = {
"#dictdef-xrlightprobeinit": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webxrlightingestimation-1","spec":"webxrlightingestimation-1-1","status":"local","text":"XRLightProbeInit","type":"dictionary","url":"#dictdef-xrlightprobeinit"},
"#dom-xrframe-getlightestimate": {"export":true,"for_":["XRFrame"],"level":"1","normative":true,"shortname":"webxrlightingestimation-1","spec":"webxrlightingestimation-1-1","status":"local","text":"getLightEstimate(lightProbe)","type":"method","url":"#dom-xrframe-getlightestimate"},
"#dom-xrlightestimate-primarylightdirection": {"export":true,"for_":["XRLightEstimate"],"level":"1","normative":true,"shortname":"webxrlightingestimation-1","spec":"webxrlightingestimation-1-1","status":"local","text":"primaryLightDirection","type":"attribute","url":"#dom-xrlightestimate-primarylightdirection"},
"#dom-xrlightestimate-primarylightintensity": {"export":true,"for_":["XRLightEstimate"],"level":"1","normative":true,"shortname":"webxrlightingestimation-1","spec":"webxrlightingestimation-1-1","status":"local","text":"primaryLightIntensity","type":"attribute","url":"#dom-xrlightestimate-primarylightintensity"},
"#dom-xrlightestimate-sphericalharmonicscoefficients": {"export":true,"for_":["XRLightEstimate"],"level":"1","normative":true,"shortname":"webxrlightingestimation-1","spec":"webxrlightingestimation-1-1","status":"local","text":"sphericalHarmonicsCoefficients","type":"attribute","url":"#dom-xrlightestimate-sphericalharmonicscoefficients"},
"#dom-xrlightprobe-onreflectionchange": {"export":true,"for_":["XRLightProbe"],"level":"1","normative":true,"shortname":"webxrlightingestimation-1","spec":"webxrlightingestimation-1-1","status":"local","text":"onreflectionchange","type":"attribute","url":"#dom-xrlightprobe-onreflectionchange"},
"#dom-xrlightprobe-probespace": {"export":true,"for_":["XRLightProbe"],"level":"1","normative":true,"shortname":"webxrlightingestimation-1","spec":"webxrlightingestimation-1-1","status":"local","text":"probeSpace","type":"attribute","url":"#dom-xrlightprobe-probespace"},
"#dom-xrlightprobeinit-reflectionformat": {"export":true,"for_":["XRLightProbeInit"],"level":"1","normative":true,"shortname":"webxrlightingestimation-1","spec":"webxrlightingestimation-1-1","status":"local","text":"reflectionFormat","type":"dict-member","url":"#dom-xrlightprobeinit-reflectionformat"},
"#dom-xrreflectionformat-rgba16f": {"export":true,"for_":["XRReflectionFormat"],"level":"1","normative":true,"shortname":"webxrlightingestimation-1","spec":"webxrlightingestimation-1-1","status":"local","text":"\"rgba16f\"","type":"enum-value","url":"#dom-xrreflectionformat-rgba16f"},
"#dom-xrreflectionformat-srgba8": {"export":true,"for_":["XRReflectionFormat"],"level":"1","normative":true,"shortname":"webxrlightingestimation-1","spec":"webxrlightingestimation-1-1","status":"local","text":"\"srgba8\"","type":"enum-value","url":"#dom-xrreflectionformat-srgba8"},
"#dom-xrsession-preferredreflectionformat": {"export":true,"for_":["XRSession"],"level":"1","normative":true,"shortname":"webxrlightingestimation-1","spec":"webxrlightingestimation-1-1","status":"local","text":"preferredReflectionFormat","type":"attribute","url":"#dom-xrsession-preferredreflectionformat"},
"#dom-xrsession-requestlightprobe": {"export":true,"for_":["XRSession"],"level":"1","normative":true,"shortname":"webxrlightingestimation-1","spec":"webxrlightingestimation-1-1","status":"local","text":"requestLightProbe(options)","type":"method","url":"#dom-xrsession-requestlightprobe"},
"#dom-xrwebglbinding-getreflectioncubemap": {"export":true,"for_":["XRWebGLBinding"],"level":"1","normative":true,"shortname":"webxrlightingestimation-1","spec":"webxrlightingestimation-1-1","status":"local","text":"getReflectionCubeMap(lightProbe)","type":"method","url":"#dom-xrwebglbinding-getreflectioncubemap"},
"#enumdef-xrreflectionformat": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webxrlightingestimation-1","spec":"webxrlightingestimation-1-1","status":"local","text":"XRReflectionFormat","type":"enum","url":"#enumdef-xrreflectionformat"},
"#eventdef-xrlightprobe-reflectionchange": {"export":true,"for_":["XRLightProbe"],"level":"1","normative":true,"shortname":"webxrlightingestimation-1","spec":"webxrlightingestimation-1-1","status":"local","text":"reflectionchange","type":"event","url":"#eventdef-xrlightprobe-reflectionchange"},
"#feature-descriptor-light-estimation": {"export":true,"for_":["feature descriptor"],"level":"1","normative":true,"shortname":"webxrlightingestimation-1","spec":"webxrlightingestimation-1-1","status":"local","text":"light-estimation","type":"dfn","url":"#feature-descriptor-light-estimation"},
"#xrlightestimate": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webxrlightingestimation-1","spec":"webxrlightingestimation-1-1","status":"local","text":"XRLightEstimate","type":"interface","url":"#xrlightestimate"},
"#xrlightprobe": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webxrlightingestimation-1","spec":"webxrlightingestimation-1-1","status":"local","text":"XRLightProbe","type":"interface","url":"#xrlightprobe"},
"#xrlightprobe-reflection-format": {"export":true,"for_":["XRLightProbe"],"level":"1","normative":true,"shortname":"webxrlightingestimation-1","spec":"webxrlightingestimation-1-1","status":"local","text":"reflection format","type":"dfn","url":"#xrlightprobe-reflection-format"},
"#xrlightprobe-session": {"export":true,"for_":["XRLightProbe"],"level":"1","normative":true,"shortname":"webxrlightingestimation-1","spec":"webxrlightingestimation-1-1","status":"local","text":"session","type":"dfn","url":"#xrlightprobe-session"},
"https://dom.spec.whatwg.org/#event": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"dom","spec":"dom","status":"current","text":"Event","type":"interface","url":"https://dom.spec.whatwg.org/#event"},
"https://dom.spec.whatwg.org/#eventtarget": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"dom","spec":"dom","status":"current","text":"EventTarget","type":"interface","url":"https://dom.spec.whatwg.org/#eventtarget"},
"https://drafts.fxtf.org/geometry-1/#dom-dompointreadonly-w": {"export":true,"for_":["DOMPointReadOnly","DOMPoint"],"level":"1","normative":true,"shortname":"geometry","spec":"geometry-1","status":"current","text":"w","type":"attribute","url":"https://drafts.fxtf.org/geometry-1/#dom-dompointreadonly-w"},
"https://drafts.fxtf.org/geometry-1/#dom-dompointreadonly-x": {"export":true,"for_":["DOMPointReadOnly","DOMPoint"],"level":"1","normative":true,"shortname":"geometry","spec":"geometry-1","status":"current","text":"x","type":"attribute","url":"https://drafts.fxtf.org/geometry-1/#dom-dompointreadonly-x"},
"https://drafts.fxtf.org/geometry-1/#dom-dompointreadonly-y": {"export":true,"for_":["DOMPointReadOnly","DOMPoint"],"level":"1","normative":true,"shortname":"geometry","spec":"geometry-1","status":"current","text":"y","type":"attribute","url":"https://drafts.fxtf.org/geometry-1/#dom-dompointreadonly-y"},
"https://drafts.fxtf.org/geometry-1/#dom-dompointreadonly-z": {"export":true,"for_":["DOMPointReadOnly","DOMPoint"],"level":"1","normative":true,"shortname":"geometry","spec":"geometry-1","status":"current","text":"z","type":"attribute","url":"https://drafts.fxtf.org/geometry-1/#dom-dompointreadonly-z"},
"https://drafts.fxtf.org/geometry-1/#dompointreadonly": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"geometry","spec":"geometry-1","status":"current","text":"DOMPointReadOnly","type":"interface","url":"https://drafts.fxtf.org/geometry-1/#dompointreadonly"},
"https://html.spec.whatwg.org/multipage/webappapis.html#event-handler-idl-attributes": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"event handler idl attribute","type":"dfn","url":"https://html.spec.whatwg.org/multipage/webappapis.html#event-handler-idl-attributes"},
"https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"EventHandler","type":"typedef","url":"https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler"},
"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"queue a task","type":"dfn","url":"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task"},
"https://html.spec.whatwg.org/multipage/webappapis.html#task-source": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"task source","type":"dfn","url":"https://html.spec.whatwg.org/multipage/webappapis.html#task-source"},
"https://immersive-web.github.io/layers/#session": {"export":true,"for_":["XRWebGLBinding"],"level":"","normative":true,"shortname":"webxr layers api","spec":"webxr layers api","status":"anchor-block","text":"session","type":"dfn","url":"https://immersive-web.github.io/layers/#session"},
"https://immersive-web.github.io/layers/#xrwebglbinding": {"export":true,"for_":[],"level":"","normative":true,"shortname":"webxr layers api","spec":"webxr layers api","status":"anchor-block","text":"XRWebGLBinding","type":"interface","url":"https://immersive-web.github.io/layers/#xrwebglbinding"},
"https://immersive-web.github.io/layers/#xrwebglbinding-context": {"export":true,"for_":["XRWebGLBinding"],"level":"","normative":true,"shortname":"webxr layers api","spec":"webxr layers api","status":"anchor-block","text":"context","type":"dfn","url":"https://immersive-web.github.io/layers/#xrwebglbinding-context"},
"https://immersive-web.github.io/webxr/#dom-xrframe-session": {"export":true,"for_":["XRFrame"],"level":"1","normative":true,"shortname":"webxr","spec":"webxr","status":"current","text":"session","type":"attribute","url":"https://immersive-web.github.io/webxr/#dom-xrframe-session"},
"https://immersive-web.github.io/webxr/#xrspace": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webxr","spec":"webxr","status":"current","text":"XRSpace","type":"interface","url":"https://immersive-web.github.io/webxr/#xrspace"},
"https://infra.spec.whatwg.org/#list-contain": {"export":true,"for_":["list","stack","queue","set"],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"contain","type":"dfn","url":"https://infra.spec.whatwg.org/#list-contain"},
"https://webidl.spec.whatwg.org/#Exposed": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"Exposed","type":"extended-attribute","url":"https://webidl.spec.whatwg.org/#Exposed"},
"https://webidl.spec.whatwg.org/#SecureContext": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"SecureContext","type":"extended-attribute","url":"https://webidl.spec.whatwg.org/#SecureContext"},
"https://webidl.spec.whatwg.org/#a-new-promise": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"a new promise","type":"dfn","url":"https://webidl.spec.whatwg.org/#a-new-promise"},
"https://webidl.spec.whatwg.org/#idl-DOMException": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"DOMException","type":"interface","url":"https://webidl.spec.whatwg.org/#idl-DOMException"},
"https://webidl.spec.whatwg.org/#idl-Float32Array": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"Float32Array","type":"interface","url":"https://webidl.spec.whatwg.org/#idl-Float32Array"},
"https://webidl.spec.whatwg.org/#idl-promise": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"Promise","type":"interface","url":"https://webidl.spec.whatwg.org/#idl-promise"},
"https://webidl.spec.whatwg.org/#invalidstateerror": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"InvalidStateError","type":"exception","url":"https://webidl.spec.whatwg.org/#invalidstateerror"},
"https://webidl.spec.whatwg.org/#notsupportederror": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"NotSupportedError","type":"exception","url":"https://webidl.spec.whatwg.org/#notsupportederror"},
"https://webidl.spec.whatwg.org/#reject": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"reject","type":"dfn","url":"https://webidl.spec.whatwg.org/#reject"},
"https://webidl.spec.whatwg.org/#resolve": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"resolve","type":"dfn","url":"https://webidl.spec.whatwg.org/#resolve"},
"https://www.khronos.org/registry/webgl/specs/latest/1.0/#WebGLTexture": {"export":true,"for_":[],"level":"","normative":true,"shortname":"webgl","spec":"webgl","status":"anchor-block","text":"WebGLTexture","type":"interface","url":"https://www.khronos.org/registry/webgl/specs/latest/1.0/#WebGLTexture"},
"https://www.w3.org/TR/ambient-light/#security-and-privacy": {"export":true,"for_":[],"level":"","normative":true,"shortname":"ambient-light","spec":"ambient-light","status":"anchor-block","text":"privacy and security risks","type":"dfn","url":"https://www.w3.org/TR/ambient-light/#security-and-privacy"},
"https://www.w3.org/TR/webxr/#xr-task-source": {"export":true,"for_":[],"level":"","normative":true,"shortname":"webxr device api - level 1","spec":"webxr device api - level 1","status":"anchor-block","text":"xr task source","type":"dfn","url":"https://www.w3.org/TR/webxr/#xr-task-source"},
"https://www.w3.org/TR/webxr/#xrframe-active": {"export":true,"for_":["XRFrame"],"level":"","normative":true,"shortname":"webxr device api - level 1","spec":"webxr device api - level 1","status":"anchor-block","text":"active","type":"dfn","url":"https://www.w3.org/TR/webxr/#xrframe-active"},
"https://www.w3.org/TR/webxr/#xrframe-interface": {"export":true,"for_":[],"level":"","normative":true,"shortname":"webxr device api - level 1","spec":"webxr device api - level 1","status":"anchor-block","text":"XRFrame","type":"interface","url":"https://www.w3.org/TR/webxr/#xrframe-interface"},
"https://www.w3.org/TR/webxr/#xrsession-interface": {"export":true,"for_":[],"level":"","normative":true,"shortname":"webxr device api - level 1","spec":"webxr device api - level 1","status":"anchor-block","text":"XRSession","type":"interface","url":"https://www.w3.org/TR/webxr/#xrsession-interface"},
"https://www.w3.org/TR/webxr/#xrsession-list-of-enabled-features": {"export":true,"for_":["XRSession"],"level":"","normative":true,"shortname":"webxr device api - level 1","spec":"webxr device api - level 1","status":"anchor-block","text":"list of enabled features","type":"dfn","url":"https://www.w3.org/TR/webxr/#xrsession-list-of-enabled-features"},
"https://www.w3.org/TR/webxr/#xrsession-xr-device": {"export":true,"for_":["XRSession"],"level":"","normative":true,"shortname":"webxr device api - level 1","spec":"webxr device api - level 1","status":"anchor-block","text":"xr device","type":"dfn","url":"https://www.w3.org/TR/webxr/#xrsession-xr-device"},
"https://www.w3.org/TR/webxr/#xrspace-native-origin": {"export":true,"for_":["XRSpace"],"level":"","normative":true,"shortname":"webxr device api - level 1","spec":"webxr device api - level 1","status":"anchor-block","text":"native origin","type":"dfn","url":"https://www.w3.org/TR/webxr/#xrspace-native-origin"},
};

function mkRefHint(link, ref) {
    const linkText = link.textContent;
    let dfnTextElements = '';
    if (ref.text != linkText) {
        dfnTextElements =
            mk.li({},
                mk.b({}, "Term: "),
                mk.span({}, ref.text)
            );
    }
    const forList = ref.for_;
    let forListElements;
    if(forList.length == 0) {
        forListElements = [];
    } else if(forList.length == 1) {
        forListElements = mk.li({},
            mk.b({}, "For: "),
            mk.span({}, forList[0]),
        );
    } else {
        forListElements = mk.li({},
            mk.b({}, "For: "),
            mk.ul({},
                ...forList.map(forItem =>
                    mk.li({},
                        mk.span({}, forItem)
                    ),
                ),
            ),
        );
    }
    const url = ref.url;
    const safeUrl = encodeURIComponent(url);
    const hintPanel = mk.aside({
        class: "ref-hint",
        id: `ref-hint-for-${safeUrl}`,
        "data-for": url,
        "aria-labelled-by": `ref-hint-for-${safeUrl}`,
    },
        mk.ul({},
            dfnTextElements,
            mk.li({},
                mk.b({}, "URL: "),
                mk.a({ href: url, class: "ref" }, url),
            ),
            mk.li({},
                mk.b({}, "Type: "),
                mk.span({}, `${ref.type}`),
            ),
            mk.li({},
                mk.b({}, "Spec: "),
                mk.span({}, `${ref.spec ? ref.spec : ''}`),
            ),
            forListElements
        ),
    );
    hintPanel.forLink = link;
    setupRefHintEventListeners(link, hintPanel);
    return hintPanel;
}

function hideAllRefHints() {
    queryAll(".ref-hint").forEach(el=>hideRefHint(el));
}

function hideRefHint(refHint) {
    const link = refHint.forLink;
    link.setAttribute("aria-expanded", "false");
    if(refHint.teardownEventListeners) {
        refHint.teardownEventListeners();
    }
    refHint.remove();
}

function showRefHint(link) {
    if(link.classList.contains("dfn-link")) return;
    const url = link.getAttribute("href");
    const ref = refsData[url];
    if(!ref) return;

    hideAllRefHints(); // Only display one at this time.

    const refHint = mkRefHint(link, ref);
    append(document.body, refHint);
    link.setAttribute("aria-expanded", "true");
    positionRefHint(refHint);
}

function setupRefHintEventListeners(link, refHint) {
    if (refHint.teardownEventListeners) return;
    // Add event handlers to hide the refHint after the user moves away
    // from both the link and refHint, if not hovering either within one second.
    let timeout = null;
    const startHidingRefHint = (event) => {
        if (timeout) {
            clearTimeout(timeout);
        }
        timeout = setTimeout(() => {
            hideRefHint(refHint);
        }, 1000);
    }
    const resetHidingRefHint = (event) => {
        if (timeout) clearTimeout(timeout);
        timeout = null;
    };
    link.addEventListener("mouseleave", startHidingRefHint);
    link.addEventListener("mouseenter", resetHidingRefHint);
    link.addEventListener("blur", startHidingRefHint);
    link.addEventListener("focus", resetHidingRefHint);
    refHint.addEventListener("mouseleave", startHidingRefHint);
    refHint.addEventListener("mouseenter", resetHidingRefHint);
    refHint.addEventListener("blur", startHidingRefHint);
    refHint.addEventListener("focus", resetHidingRefHint);

    refHint.teardownEventListeners = () => {
        // remove event listeners
        resetHidingRefHint();
        link.removeEventListener("mouseleave", startHidingRefHint);
        link.removeEventListener("mouseenter", resetHidingRefHint);
        link.removeEventListener("blur", startHidingRefHint);
        link.removeEventListener("focus", resetHidingRefHint);
        refHint.removeEventListener("mouseleave", startHidingRefHint);
        refHint.removeEventListener("mouseenter", resetHidingRefHint);
        refHint.removeEventListener("blur", startHidingRefHint);
        refHint.removeEventListener("focus", resetHidingRefHint);
    };
}

function positionRefHint(refHint) {
    const link = refHint.forLink;
    const linkPos = getBounds(link);
    refHint.style.top = linkPos.bottom + "px";
    refHint.style.left = linkPos.left + "px";

    const panelPos = refHint.getBoundingClientRect();
    const panelMargin = 8;
    const maxRight = document.body.parentNode.clientWidth - panelMargin;
    if (panelPos.right > maxRight) {
        const overflowAmount = panelPos.right - maxRight;
        const newLeft = Math.max(panelMargin, linkPos.left - overflowAmount);
        refHint.style.left = newLeft + "px";
    }
}

// TODO: shared util
// Returns the root-level absolute position {left and top} of element.
function getBounds(el, relativeTo=document.body) {
    const relativeRect = relativeTo.getBoundingClientRect();
    const elRect = el.getBoundingClientRect();
    const top = elRect.top - relativeRect.top;
    const left = elRect.left - relativeRect.left;
    return {
        top,
        left,
        bottom: top + elRect.height,
        right: left + elRect.width,
    }
}

function showRefHintListener(e) {
    // If the target isn't in a link (or is a link),
    // just ignore it.
    let link = e.target.closest("a");
    if(!link) return;

    // If the target is in a ref-hint panel
    // (aka a link in the already-open one),
    // also just ignore it.
    if(link.closest(".ref-hint")) return;

    // Otherwise, show the panel for the link.
    showRefHint(link);
}

function hideAllHintsListener(e) {
    // If the click is inside a ref-hint panel, ignore it.
    if(e.target.closest(".ref-hint")) return;
    // Otherwise, close all the current panels.
    hideAllRefHints();
}

document.addEventListener("DOMContentLoaded", () => {
    document.body.addEventListener("mousedown", showRefHintListener);
    document.body.addEventListener("focus", showRefHintListener);

    document.body.addEventListener("click", hideAllHintsListener);
});

window.addEventListener("resize", () => {
    // Hide any open ref hint.
    hideAllRefHints();
});
}
</script>
<script>/* Boilerplate: script-var-click-highlighting */
"use strict";
{
/*
Color-choosing design:

* Colors are ordered by goodness.
* On clicking a var, give it the earliest color
    with the lowest usage in the algorithm.
* On re-clicking, re-use the var's most recent color
    if that's not currently being used elsewhere.
*/

const COLOR_COUNT = 7;

document.addEventListener("click", e=>{
    if(e.target.nodeName == "VAR") {
        highlightSameAlgoVars(e.target);
    }
});

function highlightSameAlgoVars(v) {
    // Find the algorithm container.
    let algoContainer = findAlgoContainer(v);

    // Not highlighting document-global vars,
    // too likely to be unrelated.
    if(algoContainer == null) return;

    const varName = nameFromVar(v);
    if(!v.hasAttribute("data-var-color")) {
        const newColor = chooseHighlightColor(algoContainer, v);
        for(const el of algoContainer.querySelectorAll("var")) {
            if(nameFromVar(el) == varName) {
                el.setAttribute("data-var-color", newColor);
                el.setAttribute("data-var-last-color", newColor);
            }
        }
    } else {
        for(const el of algoContainer.querySelectorAll("var")) {
            if(nameFromVar(el) == varName) {
                el.removeAttribute("data-var-color");
            }
        }
    }
}
function findAlgoContainer(el) {
    while(el != document.body) {
        if(el.hasAttribute("data-algorithm")) return el;
        el = el.parentNode;
    }
    return null;
}
function nameFromVar(el) {
    return el.textContent.replace(/(\s|\xa0)+/g, " ").trim();
}
function colorCountsFromContainer(container) {
    const namesFromColor = Array.from({length:COLOR_COUNT}, x=>new Set());
    for(let v of container.querySelectorAll("var[data-var-color]")) {
        let color = +v.getAttribute("data-var-color");
        namesFromColor[color].add(nameFromVar(v));
    }

    return namesFromColor.map(x=>x.size);
}
function leastUsedColor(colors) {
    // Find the earliest color with the lowest count.
    let minCount = Infinity;
    let minColor = null;
    for(var i = 0; i < colors.length; i++) {
        if(colors[i] < minCount) {
            minColor = i;
            minCount = colors[i];
        }
    }
    return minColor;
}
function chooseHighlightColor(container, v) {
    const colorCounts = colorCountsFromContainer(container);
    if(v.hasAttribute("data-var-last-color")) {
        let color = +v.getAttribute("data-var-last-color");
        if(colorCounts[color] == 0) return color;
    }
    return leastUsedColor(colorCounts);
}
}
</script>