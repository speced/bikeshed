<!doctype html><html lang="en">
 <head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
  <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
  <title>CSS Animation Worklet API</title>
  <meta content="ED" name="w3c-status">
  <link href="https://www.w3.org/StyleSheets/TR/2021/W3C-ED" rel="stylesheet">
  <link href="https://www.w3.org/TR/css-animation-worklet-1/" rel="canonical">
  <meta content="dark light" name="color-scheme">
  <link href="https://www.w3.org/StyleSheets/TR/2021/dark.css" media="(prefers-color-scheme: dark)" rel="stylesheet" type="text/css">
<style>/* Boilerplate: style-autolinks */
.css.css, .property.property, .descriptor.descriptor {
    color: var(--a-normal-text);
    font-size: inherit;
    font-family: inherit;
}
.css::before, .property::before, .descriptor::before {
    content: "‘";
}
.css::after, .property::after, .descriptor::after {
    content: "’";
}
.property, .descriptor {
    /* Don't wrap property and descriptor names */
    white-space: nowrap;
}
.type { /* CSS value <type> */
    font-style: italic;
}
pre .property::before, pre .property::after {
    content: "";
}
[data-link-type="property"]::before,
[data-link-type="propdesc"]::before,
[data-link-type="descriptor"]::before,
[data-link-type="value"]::before,
[data-link-type="function"]::before,
[data-link-type="at-rule"]::before,
[data-link-type="selector"]::before,
[data-link-type="maybe"]::before {
    content: "‘";
}
[data-link-type="property"]::after,
[data-link-type="propdesc"]::after,
[data-link-type="descriptor"]::after,
[data-link-type="value"]::after,
[data-link-type="function"]::after,
[data-link-type="at-rule"]::after,
[data-link-type="selector"]::after,
[data-link-type="maybe"]::after {
    content: "’";
}

[data-link-type].production::before,
[data-link-type].production::after,
.prod [data-link-type]::before,
.prod [data-link-type]::after {
    content: "";
}

[data-link-type=element],
[data-link-type=element-attr] {
    font-family: Menlo, Consolas, "DejaVu Sans Mono", monospace;
    font-size: .9em;
}
[data-link-type=element]::before { content: "<" }
[data-link-type=element]::after  { content: ">" }

[data-link-type=biblio] {
    white-space: pre;
}

@media (prefers-color-scheme: dark) {
    :root {
        --selflink-text: black;
        --selflink-bg: silver;
        --selflink-hover-text: white;
    }
}
</style>
<style>/* Boilerplate: style-colors */
/* Any --*-text not paired with a --*-bg is assumed to have a transparent bg */
:root {
    color-scheme: light dark;

    --text: black;
    --bg: white;

    --unofficial-watermark: url(https://www.w3.org/StyleSheets/TR/2016/logos/UD-watermark);

    --logo-bg: #1a5e9a;
    --logo-active-bg: #c00;
    --logo-text: white;

    --tocnav-normal-text: #707070;
    --tocnav-normal-bg: var(--bg);
    --tocnav-hover-text: var(--tocnav-normal-text);
    --tocnav-hover-bg: #f8f8f8;
    --tocnav-active-text: #c00;
    --tocnav-active-bg: var(--tocnav-normal-bg);

    --tocsidebar-text: var(--text);
    --tocsidebar-bg: #f7f8f9;
    --tocsidebar-shadow: rgba(0,0,0,.1);
    --tocsidebar-heading-text: hsla(203,20%,40%,.7);

    --toclink-text: var(--text);
    --toclink-underline: #3980b5;
    --toclink-visited-text: var(--toclink-text);
    --toclink-visited-underline: #054572;

    --heading-text: #005a9c;

    --hr-text: var(--text);

    --algo-border: #def;

    --del-text: red;
    --del-bg: transparent;
    --ins-text: #080;
    --ins-bg: transparent;

    --a-normal-text: #034575;
    --a-normal-underline: #bbb;
    --a-visited-text: var(--a-normal-text);
    --a-visited-underline: #707070;
    --a-hover-bg: rgba(75%, 75%, 75%, .25);
    --a-active-text: #c00;
    --a-active-underline: #c00;

    --blockquote-border: silver;
    --blockquote-bg: transparent;
    --blockquote-text: currentcolor;

    --issue-border: #e05252;
    --issue-bg: #fbe9e9;
    --issue-text: var(--text);
    --issueheading-text: #831616;

    --example-border: #e0cb52;
    --example-bg: #fcfaee;
    --example-text: var(--text);
    --exampleheading-text: #574b0f;

    --note-border: #52e052;
    --note-bg: #e9fbe9;
    --note-text: var(--text);
    --noteheading-text: hsl(120, 70%, 30%);
    --notesummary-underline: silver;

    --assertion-border: #aaa;
    --assertion-bg: #eee;
    --assertion-text: black;

    --advisement-border: orange;
    --advisement-bg: #fec;
    --advisement-text: var(--text);
    --advisementheading-text: #b35f00;

    --warning-border: red;
    --warning-bg: hsla(40,100%,50%,0.95);
    --warning-text: var(--text);

    --amendment-border: #330099;
    --amendment-bg: #F5F0FF;
    --amendment-text: var(--text);
    --amendmentheading-text: #220066;

    --def-border: #8ccbf2;
    --def-bg: #def;
    --def-text: var(--text);
    --defrow-border: #bbd7e9;

    --datacell-border: silver;

    --indexinfo-text: #707070;

    --indextable-hover-text: black;
    --indextable-hover-bg: #f7f8f9;

    --outdatedspec-bg: rgba(0, 0, 0, .5);
    --outdatedspec-text: black;
    --outdated-bg: maroon;
    --outdated-text: white;
    --outdated-shadow: red;

    --editedrec-bg: darkorange;
}

@media (prefers-color-scheme: dark) {
    :root {
        --text: #ddd;
        --bg: black;

        --unofficial-watermark: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='400'%3E%3Cg fill='%23100808' transform='translate(200 200) rotate(-45) translate(-200 -200)' stroke='%23100808' stroke-width='3'%3E%3Ctext x='50%25' y='220' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EUNOFFICIAL%3C/text%3E%3Ctext x='50%25' y='305' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EDRAFT%3C/text%3E%3C/g%3E%3C/svg%3E");

        --logo-bg: #1a5e9a;
        --logo-active-bg: #c00;
        --logo-text: white;

        --tocnav-normal-text: #999;
        --tocnav-normal-bg: var(--bg);
        --tocnav-hover-text: var(--tocnav-normal-text);
        --tocnav-hover-bg: #080808;
        --tocnav-active-text: #f44;
        --tocnav-active-bg: var(--tocnav-normal-bg);

        --tocsidebar-text: var(--text);
        --tocsidebar-bg: #080808;
        --tocsidebar-shadow: rgba(255,255,255,.1);
        --tocsidebar-heading-text: hsla(203,20%,40%,.7);

        --toclink-text: var(--text);
        --toclink-underline: #6af;
        --toclink-visited-text: var(--toclink-text);
        --toclink-visited-underline: #054572;

        --heading-text: #8af;

        --hr-text: var(--text);

        --algo-border: #456;

        --del-text: #f44;
        --del-bg: transparent;
        --ins-text: #4a4;
        --ins-bg: transparent;

        --a-normal-text: #6af;
        --a-normal-underline: #555;
        --a-visited-text: var(--a-normal-text);
        --a-visited-underline: var(--a-normal-underline);
        --a-hover-bg: rgba(25%, 25%, 25%, .2);
        --a-active-text: #f44;
        --a-active-underline: var(--a-active-text);

        --borderedblock-bg: rgba(255, 255, 255, .05);

        --blockquote-border: silver;
        --blockquote-bg: var(--borderedblock-bg);
        --blockquote-text: currentcolor;

        --issue-border: #e05252;
        --issue-bg: var(--borderedblock-bg);
        --issue-text: var(--text);
        --issueheading-text: hsl(0deg, 70%, 70%);

        --example-border: hsl(50deg, 90%, 60%);
        --example-bg: var(--borderedblock-bg);
        --example-text: var(--text);
        --exampleheading-text: hsl(50deg, 70%, 70%);

        --note-border: hsl(120deg, 100%, 35%);
        --note-bg: var(--borderedblock-bg);
        --note-text: var(--text);
        --noteheading-text: hsl(120, 70%, 70%);
        --notesummary-underline: silver;

        --assertion-border: #444;
        --assertion-bg: var(--borderedblock-bg);
        --assertion-text: var(--text);

        --advisement-border: orange;
        --advisement-bg: #222218;
        --advisement-text: var(--text);
        --advisementheading-text: #f84;

        --warning-border: red;
        --warning-bg: hsla(40,100%,20%,0.95);
        --warning-text: var(--text);

        --amendment-border: #330099;
        --amendment-bg: #080010;
        --amendment-text: var(--text);
        --amendmentheading-text: #cc00ff;

        --def-border: #8ccbf2;
        --def-bg: #080818;
        --def-text: var(--text);
        --defrow-border: #136;

        --datacell-border: silver;

        --indexinfo-text: #aaa;

        --indextable-hover-text: var(--text);
        --indextable-hover-bg: #181818;

        --outdatedspec-bg: rgba(255, 255, 255, .5);
        --outdatedspec-text: black;
        --outdated-bg: maroon;
        --outdated-text: white;
        --outdated-shadow: red;

        --editedrec-bg: darkorange;
    }
    /* In case a transparent-bg image doesn't expect to be on a dark bg,
       which is quite common in practice... */
    img { background: white; }
}
</style>
<style>/* Boilerplate: style-counters */
body {
    counter-reset: example figure issue;
}
.issue {
    counter-increment: issue;
}
.issue:not(.no-marker)::before {
    content: "Issue " counter(issue);
}

.example {
    counter-increment: example;
}
.example:not(.no-marker)::before {
    content: "Example " counter(example);
}
.invalid.example:not(.no-marker)::before,
.illegal.example:not(.no-marker)::before {
    content: "Invalid Example" counter(example);
}

figcaption {
    counter-increment: figure;
}
figcaption:not(.no-marker)::before {
    content: "Figure " counter(figure) " ";
}
</style>
<style>/* Boilerplate: style-dfn-panel */
:root {
    --dfnpanel-bg: #ddd;
    --dfnpanel-text: var(--text);
    --dfnpanel-target-bg: #ffc;
    --dfnpanel-target-outline: orange;
}
@media (prefers-color-scheme: dark) {
    :root {
        --dfnpanel-bg: #222;
        --dfnpanel-text: var(--text);
        --dfnpanel-target-bg: #333;
        --dfnpanel-target-outline: silver;
    }
}
.dfn-panel {
    position: absolute;
    z-index: 35;
    width: 20em;
    width: 300px;
    height: auto;
    max-height: 500px;
    overflow: auto;
    padding: 0.5em 0.75em;
    font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
    background: var(--dfnpanel-bg);
    color: var(--dfnpanel-text);
    border: outset 0.2em;
    white-space: normal; /* in case it's moved into a pre */
}
.dfn-panel:not(.on) { display: none; }
.dfn-panel * { margin: 0; padding: 0; text-indent: 0; }
.dfn-panel > b { display: block; }
.dfn-panel a { color: var(--dfnpanel-text); }
.dfn-panel a:not(:hover) { text-decoration: none !important; border-bottom: none !important; }
.dfn-panel a:focus {
    outline: 5px auto Highlight;
    outline: 5px auto -webkit-focus-ring-color;
}
.dfn-panel > b + b { margin-top: 0.25em; }
.dfn-panel ul { padding: 0 0 0 1em; list-style: none; }
.dfn-panel li a {
    max-width: calc(300px - 1.5em - 1em);
    overflow: hidden;
    text-overflow: ellipsis;
}

.dfn-panel.activated {
    display: inline-block;
    position: fixed;
    left: 8px;
    bottom: 2em;
    margin: 0 auto;
    max-width: calc(100vw - 1.5em - .4em - .5em);
    max-height: 30vh;
    transition: left 1s ease-out, bottom 1s ease-out;
}

.dfn-panel .link-item:hover {
    text-decoration: underline;
}
.dfn-panel .link-item .copy-icon {
    opacity: 0;
}
.dfn-panel .link-item:hover .copy-icon,
.dfn-panel .link-item .copy-icon:focus {
    opacity: 1;
}

.dfn-panel .copy-icon {
    display: inline-block;
    margin-right: 0.5em;
    width: 0.85em;
    height: 1em;
    border-radius: 3px;
    background-color: #ccc;
    cursor: pointer;
}

.dfn-panel .copy-icon .icon {
    width: 100%;
    height: 100%;
    background-color: #fff;
    display: flex;
    justify-content: center;
    align-items: center;
    position: relative;
}

.dfn-panel .copy-icon .icon::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    border: 1px solid black;
    background-color: #ccc;
    opacity: 0.25;
    transform: translate(3px, -3px);
}

.dfn-panel .copy-icon:active .icon::before {
    opacity: 1;
}

.dfn-paneled[role="button"] { cursor: help; }

.highlighted {
    animation: target-fade 3s;
}

@keyframes target-fade {
    from {
        background-color: var(--dfnpanel-target-bg);
        outline: 5px solid var(--dfnpanel-target-outline);
    }
    to {
        color: var(--a-normal-text);
        background-color: transparent;
        outline: transparent;
    }
}
</style>
<style>/* Boilerplate: style-idl-highlighting */
pre.idl.highlight {
    background: var(--borderedblock-bg, var(--def-bg));
}
</style>
<style>/* Boilerplate: style-issues */
a[href].issue-return {
    float: right;
    float: inline-end;
    color: var(--issueheading-text);
    font-weight: bold;
    text-decoration: none;
}
</style>
<style>/* Boilerplate: style-md-lists */
/* This is a weird hack for me not yet following the commonmark spec
   regarding paragraph and lists. */
[data-md] > :first-child {
    margin-top: 0;
}
[data-md] > :last-child {
    margin-bottom: 0;
}
</style>
<style>/* Boilerplate: style-ref-hints */
:root {
    --ref-hint-bg: #ddd;
    --ref-hint-text: var(--text);
}
@media (prefers-color-scheme: dark) {
    :root {
        --ref-hint-bg: #222;
        --ref-hint-text: var(--text);
    }
}

.ref-hint {
    display: inline-block;
    position: absolute;
    z-index: 35;
    width: 20em;
    width: 300px;
    height: auto;
    max-height: 500px;
    overflow: auto;
    padding: 0.5em 0.5em;
    font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
    background: var(--ref-hint-bg);
    color: var(--ref-hint-text);
    border: outset 0.2em;
    white-space: normal; /* in case it's moved into a pre */
}

.ref-hint * { margin: 0; padding: 0; text-indent: 0; }

.ref-hint ul { padding: 0 0 0 1em; list-style: none; }
</style>
<style>/* Boilerplate: style-selflinks */
:root {
    --selflink-text: white;
    --selflink-bg: gray;
    --selflink-hover-text: black;
}
.heading, .issue, .note, .example, li, dt {
    position: relative;
}
a.self-link {
    position: absolute;
    top: 0;
    left: calc(-1 * (3.5rem - 26px));
    width: calc(3.5rem - 26px);
    height: 2em;
    text-align: center;
    border: none;
    transition: opacity .2s;
    opacity: .5;
}
a.self-link:hover {
    opacity: 1;
}
.heading > a.self-link {
    font-size: 83%;
}
.example > a.self-link,
.note > a.self-link,
.issue > a.self-link {
    /* These blocks are overflow:auto, so positioning outside
       doesn't work. */
    left: auto;
    right: 0;
}
li > a.self-link {
    left: calc(-1 * (3.5rem - 26px) - 2em);
}
dfn > a.self-link {
    top: auto;
    left: auto;
    opacity: 0;
    width: 1.5em;
    height: 1.5em;
    background: var(--selflink-bg);
    color: var(--selflink-text);
    font-style: normal;
    transition: opacity .2s, background-color .2s, color .2s;
}
dfn:hover > a.self-link {
    opacity: 1;
}
dfn > a.self-link:hover {
    color: var(--selflink-hover-text);
}

a.self-link::before            { content: "¶"; }
.heading > a.self-link::before { content: "§"; }
dfn > a.self-link::before      { content: "#"; }
</style>
<style>/* Boilerplate: style-syntax-highlighting */
code.highlight { padding: .1em; border-radius: .3em; }
pre.highlight, pre > code.highlight { display: block; padding: 1em; margin: .5em 0; overflow: auto; border-radius: 0; }

.highlight:not(.idl) { background: rgba(0, 0, 0, .03); }
c-[a] { color: #990055 } /* Keyword.Declaration */
c-[b] { color: #990055 } /* Keyword.Type */
c-[c] { color: #708090 } /* Comment */
c-[d] { color: #708090 } /* Comment.Multiline */
c-[e] { color: #0077aa } /* Name.Attribute */
c-[f] { color: #669900 } /* Name.Tag */
c-[g] { color: #222222 } /* Name.Variable */
c-[k] { color: #990055 } /* Keyword */
c-[l] { color: #000000 } /* Literal */
c-[m] { color: #000000 } /* Literal.Number */
c-[n] { color: #0077aa } /* Name */
c-[o] { color: #999999 } /* Operator */
c-[p] { color: #999999 } /* Punctuation */
c-[s] { color: #a67f59 } /* Literal.String */
c-[t] { color: #a67f59 } /* Literal.String.Single */
c-[u] { color: #a67f59 } /* Literal.String.Double */
c-[cp] { color: #708090 } /* Comment.Preproc */
c-[c1] { color: #708090 } /* Comment.Single */
c-[cs] { color: #708090 } /* Comment.Special */
c-[kc] { color: #990055 } /* Keyword.Constant */
c-[kn] { color: #990055 } /* Keyword.Namespace */
c-[kp] { color: #990055 } /* Keyword.Pseudo */
c-[kr] { color: #990055 } /* Keyword.Reserved */
c-[ld] { color: #000000 } /* Literal.Date */
c-[nc] { color: #0077aa } /* Name.Class */
c-[no] { color: #0077aa } /* Name.Constant */
c-[nd] { color: #0077aa } /* Name.Decorator */
c-[ni] { color: #0077aa } /* Name.Entity */
c-[ne] { color: #0077aa } /* Name.Exception */
c-[nf] { color: #0077aa } /* Name.Function */
c-[nl] { color: #0077aa } /* Name.Label */
c-[nn] { color: #0077aa } /* Name.Namespace */
c-[py] { color: #0077aa } /* Name.Property */
c-[ow] { color: #999999 } /* Operator.Word */
c-[mb] { color: #000000 } /* Literal.Number.Bin */
c-[mf] { color: #000000 } /* Literal.Number.Float */
c-[mh] { color: #000000 } /* Literal.Number.Hex */
c-[mi] { color: #000000 } /* Literal.Number.Integer */
c-[mo] { color: #000000 } /* Literal.Number.Oct */
c-[sb] { color: #a67f59 } /* Literal.String.Backtick */
c-[sc] { color: #a67f59 } /* Literal.String.Char */
c-[sd] { color: #a67f59 } /* Literal.String.Doc */
c-[se] { color: #a67f59 } /* Literal.String.Escape */
c-[sh] { color: #a67f59 } /* Literal.String.Heredoc */
c-[si] { color: #a67f59 } /* Literal.String.Interpol */
c-[sx] { color: #a67f59 } /* Literal.String.Other */
c-[sr] { color: #a67f59 } /* Literal.String.Regex */
c-[ss] { color: #a67f59 } /* Literal.String.Symbol */
c-[vc] { color: #0077aa } /* Name.Variable.Class */
c-[vg] { color: #0077aa } /* Name.Variable.Global */
c-[vi] { color: #0077aa } /* Name.Variable.Instance */
c-[il] { color: #000000 } /* Literal.Number.Integer.Long */

@media (prefers-color-scheme: dark) {
    .highlight:not(.idl) { background: rgba(255, 255, 255, .05); }

    c-[a] { color: #d33682 } /* Keyword.Declaration */
    c-[b] { color: #d33682 } /* Keyword.Type */
    c-[c] { color: #2aa198 } /* Comment */
    c-[d] { color: #2aa198 } /* Comment.Multiline */
    c-[e] { color: #268bd2 } /* Name.Attribute */
    c-[f] { color: #b58900 } /* Name.Tag */
    c-[g] { color: #cb4b16 } /* Name.Variable */
    c-[k] { color: #d33682 } /* Keyword */
    c-[l] { color: #657b83 } /* Literal */
    c-[m] { color: #657b83 } /* Literal.Number */
    c-[n] { color: #268bd2 } /* Name */
    c-[o] { color: #657b83 } /* Operator */
    c-[p] { color: #657b83 } /* Punctuation */
    c-[s] { color: #6c71c4 } /* Literal.String */
    c-[t] { color: #6c71c4 } /* Literal.String.Single */
    c-[u] { color: #6c71c4 } /* Literal.String.Double */
    c-[ch] { color: #2aa198 } /* Comment.Hashbang */
    c-[cp] { color: #2aa198 } /* Comment.Preproc */
    c-[cpf] { color: #2aa198 } /* Comment.PreprocFile */
    c-[c1] { color: #2aa198 } /* Comment.Single */
    c-[cs] { color: #2aa198 } /* Comment.Special */
    c-[kc] { color: #d33682 } /* Keyword.Constant */
    c-[kn] { color: #d33682 } /* Keyword.Namespace */
    c-[kp] { color: #d33682 } /* Keyword.Pseudo */
    c-[kr] { color: #d33682 } /* Keyword.Reserved */
    c-[ld] { color: #657b83 } /* Literal.Date */
    c-[nc] { color: #268bd2 } /* Name.Class */
    c-[no] { color: #268bd2 } /* Name.Constant */
    c-[nd] { color: #268bd2 } /* Name.Decorator */
    c-[ni] { color: #268bd2 } /* Name.Entity */
    c-[ne] { color: #268bd2 } /* Name.Exception */
    c-[nf] { color: #268bd2 } /* Name.Function */
    c-[nl] { color: #268bd2 } /* Name.Label */
    c-[nn] { color: #268bd2 } /* Name.Namespace */
    c-[py] { color: #268bd2 } /* Name.Property */
    c-[ow] { color: #657b83 } /* Operator.Word */
    c-[mb] { color: #657b83 } /* Literal.Number.Bin */
    c-[mf] { color: #657b83 } /* Literal.Number.Float */
    c-[mh] { color: #657b83 } /* Literal.Number.Hex */
    c-[mi] { color: #657b83 } /* Literal.Number.Integer */
    c-[mo] { color: #657b83 } /* Literal.Number.Oct */
    c-[sa] { color: #6c71c4 } /* Literal.String.Affix */
    c-[sb] { color: #6c71c4 } /* Literal.String.Backtick */
    c-[sc] { color: #6c71c4 } /* Literal.String.Char */
    c-[dl] { color: #6c71c4 } /* Literal.String.Delimiter */
    c-[sd] { color: #6c71c4 } /* Literal.String.Doc */
    c-[se] { color: #6c71c4 } /* Literal.String.Escape */
    c-[sh] { color: #6c71c4 } /* Literal.String.Heredoc */
    c-[si] { color: #6c71c4 } /* Literal.String.Interpol */
    c-[sx] { color: #6c71c4 } /* Literal.String.Other */
    c-[sr] { color: #6c71c4 } /* Literal.String.Regex */
    c-[ss] { color: #6c71c4 } /* Literal.String.Symbol */
    c-[fm] { color: #268bd2 } /* Name.Function.Magic */
    c-[vc] { color: #cb4b16 } /* Name.Variable.Class */
    c-[vg] { color: #cb4b16 } /* Name.Variable.Global */
    c-[vi] { color: #cb4b16 } /* Name.Variable.Instance */
    c-[vm] { color: #cb4b16 } /* Name.Variable.Magic */
    c-[il] { color: #657b83 } /* Literal.Number.Integer.Long */
}
</style>
<style>/* Boilerplate: style-var-click-highlighting */
/*
Colors were chosen in Lab using https://nixsensor.com/free-color-converter/
D50 2deg illuminant, L in [0,100], a and b in [-128, 128]
0 = lab(85,0,85)
1 = lab(85,80,30)
2 = lab(85,-40,40)
3 = lab(85,-50,0)
4 = lab(85,5,15)
5 = lab(85,-10,-50)
6 = lab(85,35,-15)

For darkmode:
0 = oklab(50%   0%  108%)
1 = oklab(50% -51%   51%)
2 = oklab(50% -64%  -20%)
3 = oklab(50%   6%   19%)
4 = oklab(50% -12%  -64%)
5 = oklab(50%  44%  -19%)  
6 = oklab(50% 102%   38%)
*/

[data-algorithm] var { cursor: pointer; }
var[data-var-color] { background-color: var(--var-bg); box-shadow: 0 0 0 2px var(--var-bg); }

var[data-var-color] { --var-bg: #F4D200; }
var[data-var-color="1"] { --var-bg: #FF87A2; }
var[data-var-color="2"] { --var-bg: #96E885; }
var[data-var-color="3"] { --var-bg: #3EEED2; }
var[data-var-color="4"] { --var-bg: #EACFB6; }
var[data-var-color="5"] { --var-bg: #82DDFF; }
var[data-var-color="6"] { --var-vg: #FFBCF2; }

@media (prefers-color-scheme: dark) {
	var[data-var-color] { --var-bg: #bc1a00; }
	var[data-var-color="1"] { --var-bg: #007f00; }
	var[data-var-color="2"] { --var-bg: #008698; }
	var[data-var-color="3"] { --var-bg: #7f5b2b; }
	var[data-var-color="4"] { --var-bg: #004df3; }
	var[data-var-color="5"] { --var-bg: #a1248a; }
	var[data-var-color="6"] { --var-vg: #ff0000; }
}
</style>
 <body class="h-entry">
  <div class="head">
   <p data-fill-with="logo"><a class="logo" href="https://www.w3.org/"> <img alt="W3C" height="48" src="https://www.w3.org/StyleSheets/TR/2021/logos/W3C" width="72"> </a> </p>
   <h1 class="p-name no-ref" id="title">CSS Animation Worklet API</h1>
   <p id="w3c-state"><a href="https://www.w3.org/standards/types/#ED">Editor’s Draft</a>, <time class="dt-updated" datetime="1970-01-01">1 January 1970</time></p>
   <details open>
    <summary>More details about this document</summary>
    <div data-fill-with="spec-metadata">
     <dl>
      <dt>This version:
      <dd><a class="u-url" href="https://drafts.css-houdini.org/css-animation-worklet-1/">https://drafts.css-houdini.org/css-animation-worklet-1/</a>
      <dt>Latest published version:
      <dd><a href="https://www.w3.org/TR/css-animation-worklet-1/">https://www.w3.org/TR/css-animation-worklet-1/</a>
      <dt>Feedback:
      <dd><span><a href="mailto:public-houdini@w3.org?subject=%5Bcss-animation-worklet%5D%20YOUR%20TOPIC%20HERE">public-houdini@w3.org</a> with subject line “<kbd>[css-animation-worklet] <i data-lt>… message topic …</i></kbd>” (<a href="http://lists.w3.org/Archives/Public/public-houdini/" rel="discussion">archives</a>)</span>
      <dt class="editor">Editors:
      <dd class="editor p-author h-card vcard" data-editor-id="81464"><a class="p-name fn u-email email" href="mailto:majidvp@google.com">Majid Valipour</a>
      <dd class="editor p-author h-card vcard" data-editor-id="98451"><a class="p-name fn u-email email" href="mailto:flackr@chromium.org">Robert Flack</a>
      <dd class="editor p-author h-card vcard" data-editor-id="96463"><a class="p-name fn u-email email" href="mailto:smcgruer@chromium.org">Stephen McGruer</a>
     </dl>
    </div>
   </details>
   <div data-fill-with="warning"></div>
   <p class="copyright" data-fill-with="copyright"><a href="https://www.w3.org/policies/#copyright">Copyright</a> © 1970 <a href="https://www.w3.org/">World Wide Web Consortium</a>. <abbr title="World Wide Web Consortium">W3C</abbr><sup>®</sup> <a href="https://www.w3.org/policies/#Legal_Disclaimer">liability</a>, <a href="https://www.w3.org/policies/#W3C_Trademarks">trademark</a> and <a href="https://www.w3.org/copyright/software-license/" rel="license" title="W3C Software and Document License">permissive document license</a> rules apply. </p>
   <hr title="Separator for header">
  </div>
  <div class="p-summary" data-fill-with="abstract">
   <h2 class="no-num no-toc no-ref heading settled" id="abstract"><span class="content">Abstract</span></h2>
  </div>
  <h2 class="no-num no-toc no-ref heading settled" id="sotd"><span class="content">Status of this document</span></h2>
  <div data-fill-with="status">
   <p> This is a public copy of the editors’ draft.
	It is provided for discussion only and may change at any moment.
	Its publication here does not imply endorsement of its contents by W3C.
	Don’t cite this document other than as work in progress. </p>
   <p>Please send feedback
	by <a href="https://github.com/w3c/css-houdini-drafts/issues">filing issues in GitHub</a> (preferred),
	including the spec code “css-animation-worklet” in the title, like this:
	“[css-animation-worklet] <i>…summary of comment…</i>”.
	All issues and comments are <a href="https://lists.w3.org/Archives/Public/public-houdini-archive/">archived</a>.
	Alternately, feedback can be sent to the (<a href="https://lists.w3.org/Archives/Public/www-style/">archived</a>) public mailing list <a href="mailto:www-style@w3.org?Subject=%5Bcss-animation-worklet%5D%20PUT%20SUBJECT%20HERE">www-style@w3.org</a>. </p>
   <p>This document is governed by the <a href="https://www.w3.org/policies/process/20231103/" id="w3c_process_revision">03 November 2023 W3C Process Document</a>. </p>
   <p></p>
  </div>
  <div data-fill-with="at-risk"></div>
  <nav data-fill-with="table-of-contents" id="toc">
   <h2 class="no-num no-toc no-ref" id="contents">Table of Contents</h2>
   <ol class="toc" role="directory">
    <li>
     <a href="#intro"><span class="secno">1</span> <span class="content">Introduction</span></a>
     <ol class="toc">
      <li><a href="#relationship-to-web-animations"><span class="secno">1.1</span> <span class="content">Relationship to the Web Animations API</span></a>
     </ol>
    <li><a href="#animation-worklet-desc"><span class="secno">2</span> <span class="content">Animation Worklet</span></a>
    <li>
     <a href="#animator-desc"><span class="secno">3</span> <span class="content">Animator</span></a>
     <ol class="toc">
      <li><a href="#stateless-animator-desc"><span class="secno">3.1</span> <span class="content">Stateless Animator</span></a>
      <li><a href="#stateful-animator-desc"><span class="secno">3.2</span> <span class="content">Stateful Animator</span></a>
      <li><a href="#animator-definition-desc"><span class="secno">3.3</span> <span class="content">Animator Definition</span></a>
      <li><a href="#registering-animator-definition"><span class="secno">3.4</span> <span class="content">Registering an Animator Definition</span></a>
      <li><a href="#animator-effect-desc"><span class="secno">3.5</span> <span class="content">Animator Effect</span></a>
     </ol>
    <li>
     <a href="#animator-instance-section"><span class="secno">4</span> <span class="content">Animator Instance</span></a>
     <ol class="toc">
      <li><a href="#creating-animator-instance"><span class="secno">4.1</span> <span class="content">Creating an Animator Instance</span></a>
      <li><a href="#running-animators"><span class="secno">4.2</span> <span class="content">Running Animators</span></a>
      <li><a href="#removing-animator"><span class="secno">4.3</span> <span class="content">Removing an Animator Instance</span></a>
      <li><a href="#migrating-animator"><span class="secno">4.4</span> <span class="content">Migrating an Animator Instance</span></a>
      <li><a href="#requesting-animation-frames"><span class="secno">4.5</span> <span class="content">Requesting Animation Frames</span></a>
     </ol>
    <li>
     <a href="#web-animation-integration"><span class="secno">5</span> <span class="content">Web Animations Integration</span></a>
     <ol class="toc">
      <li><a href="#worklet-animation-desc"><span class="secno">5.1</span> <span class="content">Worklet Animation</span></a>
      <li><a href="#creating-worklet-animation"><span class="secno">5.2</span> <span class="content">Creating a Worklet Animation</span></a>
      <li><a href="#timing-and-sync-model"><span class="secno">5.3</span> <span class="content">Worklet Animation Timing and Sync Model</span></a>
      <li><a href="#web-animation-overrides"><span class="secno">5.4</span> <span class="content">Web Animations Overrides</span></a>
      <li><a href="#effect-stack-composite-order"><span class="secno">5.5</span> <span class="content">Effect Stack and Composite Order</span></a>
     </ol>
    <li>
     <a href="#related-concepts"><span class="secno">6</span> <span class="content">Additional Related Concepts</span></a>
     <ol class="toc">
      <li><a href="#worklet-group-effect"><span class="secno">6.1</span> <span class="content">Worklet Group Effect</span></a>
      <li><a href="#scroll-timeline"><span class="secno">6.2</span> <span class="content">ScrollTimeline</span></a>
     </ol>
    <li><a href="#security-considerations"><span class="secno">7</span> <span class="content">Security Considerations</span></a>
    <li><a href="#privacy-considerations"><span class="secno">8</span> <span class="content">Privacy Considerations</span></a>
    <li>
     <a href="#examples"><span class="secno">9</span> <span class="content">Examples</span></a>
     <ol class="toc">
      <li><a href="#example-1"><span class="secno">9.1</span> <span class="content">Example 1: Spring timing.</span></a>
      <li><a href="#example-2"><span class="secno">9.2</span> <span class="content">Example 2: Twitter header.</span></a>
      <li><a href="#example-3"><span class="secno">9.3</span> <span class="content">Example 3: Parallax backgrounds.</span></a>
     </ol>
    <li>
     <a href="#w3c-conformance"><span class="secno"></span> <span class="content"> Conformance</span></a>
     <ol class="toc">
      <li><a href="#w3c-conventions"><span class="secno"></span> <span class="content"> Document conventions</span></a>
      <li><a href="#w3c-conformance-classes"><span class="secno"></span> <span class="content"> Conformance classes</span></a>
      <li>
       <a href="#w3c-partial"><span class="secno"></span> <span class="content"> Partial implementations</span></a>
       <ol class="toc">
        <li><a href="#w3c-conform-future-proofing"><span class="secno"></span> <span class="content"> Implementations of Unstable and Proprietary Features</span></a>
       </ol>
      <li><a href="#w3c-testing"><span class="secno"></span> <span class="content"> Non-experimental implementations</span></a>
     </ol>
    <li>
     <a href="#index"><span class="secno"></span> <span class="content">Index</span></a>
     <ol class="toc">
      <li><a href="#index-defined-here"><span class="secno"></span> <span class="content">Terms defined by this specification</span></a>
      <li><a href="#index-defined-elsewhere"><span class="secno"></span> <span class="content">Terms defined by reference</span></a>
     </ol>
    <li>
     <a href="#references"><span class="secno"></span> <span class="content">References</span></a>
     <ol class="toc">
      <li><a href="#normative"><span class="secno"></span> <span class="content">Normative References</span></a>
      <li><a href="#informative"><span class="secno"></span> <span class="content">Informative References</span></a>
     </ol>
    <li><a href="#idl-index"><span class="secno"></span> <span class="content">IDL Index</span></a>
    <li><a href="#issues-index"><span class="secno"></span> <span class="content">Issues Index</span></a>
   </ol>
  </nav>
  <main>
   <h2 class="heading settled" data-level="1" id="intro"><span class="secno">1. </span><span class="content">Introduction</span><a class="self-link" href="#intro"></a></h2>
    <em>This section is not normative.</em> 
   <p>This document introduces a new primitive that provides extensibility in web animations and enables
high performance interactive procedural animations on the web. For details on the rationale and
motivation see both <a data-link-type="biblio" href="#biblio-explainer" title="Animation Worklet Explainer">[explainer]</a> and <a data-link-type="biblio" href="#biblio-principles" title="Animation Worklet Design Principles and Goals">[principles]</a>.</p>
   <p>The <a data-link-type="dfn" href="#animation-worklet" id="ref-for-animation-worklet">Animation Worklet</a> API provides a method to create scripted animations that control a set
of <a data-link-type="dfn" href="https://drafts.csswg.org/web-animations#animation-effect" id="ref-for-animation-effect">animation effects</a>. The API is designed to make it possible for user agents to run such
animations in their own dedicated thread to provide a degree of performance isolation from main
thread.</p>
   <h3 class="heading settled" data-level="1.1" id="relationship-to-web-animations"><span class="secno">1.1. </span><span class="content">Relationship to the Web Animations API</span><a class="self-link" href="#relationship-to-web-animations"></a></h3>
    <em>This section is not normative.</em> 
   <p>Animations running inside an <a data-link-type="dfn" href="#animation-worklet" id="ref-for-animation-worklet①">Animation Worklet</a> execution context expose the <code class="idl"><a data-link-type="idl" href="https://drafts.csswg.org/web-animations-1/#animation" id="ref-for-animation">Animation</a></code> interface from the Web Animations specification on the main javascript execution context. This means
they can be controlled and inspected from main thread using the same Web Animation APIs.</p>
   <h2 class="heading settled" data-level="2" id="animation-worklet-desc"><span class="secno">2. </span><span class="content">Animation Worklet</span><a class="self-link" href="#animation-worklet-desc"></a></h2>
    <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="animation-worklet">Animation Worklet</dfn> is a <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/worklets.html#worklet" id="ref-for-worklet">Worklet</a></code> responsible for all classes related to custom
animations. The worklet can be accessed via <code class="idl"><a data-link-type="idl" href="#dom-css-animationworklet" id="ref-for-dom-css-animationworklet">animationWorklet</a></code> attribute. 
<pre class="idl highlight def">[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed" id="ref-for-Exposed"><c- g>Exposed</c-></a>=<c- n>Window</c->]
<c- b>partial</c-> <c- b>namespace</c-> <a class="idl-code" data-link-type="namespace" href="https://drafts.csswg.org/cssom-1/#namespacedef-css" id="ref-for-namespacedef-css"><c- g>CSS</c-></a> {
    [<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#SameObject" id="ref-for-SameObject"><c- g>SameObject</c-></a>] <c- b>readonly</c-> <c- b>attribute</c-> <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/worklets.html#worklet" id="ref-for-worklet①"><c- n>Worklet</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="CSS" data-dfn-type="attribute" data-export data-readonly data-type="Worklet" id="dom-css-animationworklet"><code><c- g>animationWorklet</c-></code></dfn>;
};
</pre>
   <p>The <code class="idl"><a data-link-type="idl" href="#dom-css-animationworklet" id="ref-for-dom-css-animationworklet①">animationWorklet</a></code>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/worklets.html#worklet-global-scope-type" id="ref-for-worklet-global-scope-type">worklet global scope type</a> is <code class="idl"><a data-link-type="idl" href="#animationworkletglobalscope" id="ref-for-animationworkletglobalscope">AnimationWorkletGlobalScope</a></code>.</p>
   <p><code class="idl"><a data-link-type="idl" href="#animationworkletglobalscope" id="ref-for-animationworkletglobalscope①">AnimationWorkletGlobalScope</a></code> represents the global execution context of <code class="idl"><a data-link-type="idl" href="#dom-css-animationworklet" id="ref-for-dom-css-animationworklet②">animationWorklet</a></code>.</p>
<pre class="idl highlight def">[ <a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Global" id="ref-for-Global"><c- g>Global</c-></a>=(<a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/worklets.html#worklet" id="ref-for-worklet②"><c- n>Worklet</c-></a>,<a data-link-type="idl-name"><c- n>AnimationWorklet</c-></a>), <a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed" id="ref-for-Exposed①"><c- g>Exposed</c-></a>=<c- n>AnimationWorklet</c-> ]
<c- b>interface</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="interface" data-export id="animationworkletglobalscope"><code><c- g>AnimationWorkletGlobalScope</c-></code></dfn> : <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/worklets.html#workletglobalscope" id="ref-for-workletglobalscope"><c- n>WorkletGlobalScope</c-></a> {
    <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-undefined" id="ref-for-idl-undefined"><c- b>undefined</c-></a> <a class="idl-code" data-link-type="method" href="#dom-animationworkletglobalscope-registeranimator" id="ref-for-dom-animationworkletglobalscope-registeranimator"><c- g>registerAnimator</c-></a>(<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString" id="ref-for-idl-DOMString"><c- b>DOMString</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="AnimationWorkletGlobalScope/registerAnimator(name, animatorCtor)" data-dfn-type="argument" data-export id="dom-animationworkletglobalscope-registeranimator-name-animatorctor-name"><code><c- g>name</c-></code></dfn>, <a data-link-type="idl-name" href="#callbackdef-animatorinstanceconstructor" id="ref-for-callbackdef-animatorinstanceconstructor"><c- n>AnimatorInstanceConstructor</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="AnimationWorkletGlobalScope/registerAnimator(name, animatorCtor)" data-dfn-type="argument" data-export id="dom-animationworkletglobalscope-registeranimator-name-animatorctor-animatorctor"><code><c- g>animatorCtor</c-></code></dfn>);
};

<c- b>callback</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="callback" data-export id="callbackdef-animatorinstanceconstructor"><code><c- g>AnimatorInstanceConstructor</c-></code></dfn> = <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-any" id="ref-for-idl-any"><c- b>any</c-></a> (<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-any" id="ref-for-idl-any①"><c- b>any</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="AnimatorInstanceConstructor" data-dfn-type="argument" data-export id="dom-animatorinstanceconstructor-options"><code><c- g>options</c-></code></dfn>, <c- b>optional</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-any" id="ref-for-idl-any②"><c- b>any</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="AnimatorInstanceConstructor" data-dfn-type="argument" data-export id="dom-animatorinstanceconstructor-state"><code><c- g>state</c-></code></dfn>);
</pre>
   <h2 class="heading settled" data-level="3" id="animator-desc"><span class="secno">3. </span><span class="content">Animator</span><a class="self-link" href="#animator-desc"></a></h2>
   <p>An <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="animator">Animator</dfn> represents a custom animation that is running inside <code class="idl"><a data-link-type="idl" href="#animationworkletglobalscope" id="ref-for-animationworkletglobalscope②">AnimationWorkletGlobalScope</a></code>. Each Animator is associated with an <a data-link-type="dfn" href="https://drafts.csswg.org/web-animations#concept-animation" id="ref-for-concept-animation">animation</a> instance (of
type <code class="idl"><a data-link-type="idl" href="#workletanimation" id="ref-for-workletanimation">WorkletAnimation</a></code>) in the document and determines how that animation progresses its <a data-link-type="dfn" href="https://drafts.csswg.org/web-animations#animation-effect" id="ref-for-animation-effect①">animation effect</a>. The <code>animate</code> function contains the logic responsible for
translating the animation current time into appropriate progress of the animation effect. An
animator can only be instantiated by construction of a <code class="idl"><a data-link-type="idl" href="#workletanimation" id="ref-for-workletanimation①">WorkletAnimation</a></code> in the document.</p>
   <p>Two animators types are supported: <a data-link-type="dfn" href="#stateless-animator" id="ref-for-stateless-animator">Stateless Animator</a> and <a data-link-type="dfn" href="#stateful-animator" id="ref-for-stateful-animator">Stateful Animator</a> each
providing a different state management strategy.</p>
   <h3 class="heading settled" data-level="3.1" id="stateless-animator-desc"><span class="secno">3.1. </span><span class="content">Stateless Animator</span><a class="self-link" href="#stateless-animator-desc"></a></h3>
   <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="stateless-animator">Stateless Animator</dfn> is a type of animator does not depend on any local state either
stored on the instance or global scope. Effectively, the animate function of an <a data-link-type="dfn" href="#stateless-animator" id="ref-for-stateless-animator①">Stateless Animator</a> can be treated as a pure function with the expectation that given the same
input, it produces the same output.</p>
   <div class="note" role="note">
     This is how an stateless animator class should look. 
<pre class="lang-javascript highlight"><c- a>class</c-> FooAnimator <c- p>{</c->
    <c- kr>constructor</c-><c- p>(</c->options<c- p>)</c-> <c- p>{</c->
        <c- c1>// Called when a new animator is instantiated.</c->
    <c- p>}</c->
    animate<c- p>(</c->currentTime<c- p>,</c-> effect<c- p>)</c-> <c- p>{</c->
        <c- c1>// Animation frame logic goes here.</c->
    <c- p>}</c->
<c- p>}</c->
</pre>
   </div>
   <p class="note" role="note"><span class="marker">Note:</span> The statelessness allows animation worklet to perform optimization such as producing multiple
animation frames in parallel, sharing a single animator instance for multiple animations, and
performing very cheap teardown and setup. Using <a data-link-type="dfn" href="#stateless-animator" id="ref-for-stateless-animator②">Stateless Animator</a> is highly recommended to
enable such optimizations.</p>
   <h3 class="heading settled" data-level="3.2" id="stateful-animator-desc"><span class="secno">3.2. </span><span class="content">Stateful Animator</span><a class="self-link" href="#stateful-animator-desc"></a></h3>
   <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="stateful-animator">Stateful Animator</dfn> is a type of animator that can have local state and animation worklet
guarantees that it maintains this state as long as the stateful animator fulfills the contract
required by its interface and as described following.</p>
   <p><a data-link-type="dfn" href="#animation-worklet" id="ref-for-animation-worklet②">Animation worklet</a> maintains a set of <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/worklets.html#workletglobalscope" id="ref-for-workletglobalscope①">WorkletGlobalScope</a></code>s which may exist across different
threads or processes. Animation worklet may temporarily terminate a global scope (e.g., to preserve
resources) or move a running <a data-link-type="dfn" href="#animator-instance" id="ref-for-animator-instance">animator instance</a> across different global scopes (e.g., if its
effect is mutable only in a certain thread). Animation worklet guarantees that a stateful animator
instance’s state is maintained even if the instance is respawned in a different global scope.</p>
   <p>The basic mechanism for maintaining the state is that the animation worklet snapshots the local
state that is exposed via the <a data-link-type="dfn" href="#state-function" id="ref-for-state-function">state function</a> and then reifies it so that it can be passed into
the constructor when the animator instance is respawned at a later time in a potentially different
global scope. The <a data-link-type="dfn" href="#migrate-an-animator-instance" id="ref-for-migrate-an-animator-instance">migrate an animator instance</a> algorithm specifies this process in details.</p>
   <p>A user-defined stateful animator is expected to fulfill the required contract which is that its
state function returns an object representing its state that can be serialized using structured
serialized algorithm and that it can also recreate its state given that same object passed to its
constructor.</p>
   <div class="note" role="note">
     This is how a stateful animator class should look. 
<pre class="lang-javascript highlight"><c- a>class</c-> BarAnimator <c- p>{</c->
    <c- kr>constructor</c-><c- p>(</c->options<c- p>,</c-> state<c- p>)</c-> <c- p>{</c->
      <c- c1>// Called when a new animator is instantiated (either first time or after being respawned).</c->
      <c- k>this</c-><c- p>.</c->currentVelocity  <c- o>=</c-> state <c- o>?</c-> state<c- p>.</c->velocity <c- o>:</c-> <c- mf>0</c-><c- p>;</c->
    <c- p>}</c->
    animate<c- p>(</c->currentTime<c- p>,</c-> effect<c- p>)</c-> <c- p>{</c->
        <c- c1>// Animation frame logic goes here and can rely on this.currentVelocity.</c->
        <c- k>this</c-><c- p>.</c->currentVelocity <c- o>+=</c-> <c- mf>0.1</c-><c- p>;</c->
    <c- p>}</c->
    state<c- p>()</c-> <c- p>{</c->
      <c- c1>// The returned object should be serializable using structured clonable algorithm.</c->
      <c- k>return</c-> <c- p>{</c->
        velocity<c- o>:</c-> <c- k>this</c-><c- p>.</c->currentVelocity<c- p>;</c->
      <c- p>}</c->
    <c- p>}</c->
<c- p>}</c->
</pre>
   </div>
   <h3 class="heading settled" data-level="3.3" id="animator-definition-desc"><span class="secno">3.3. </span><span class="content">Animator Definition</span><a class="self-link" href="#animator-definition-desc"></a></h3>
   <p>An <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="animator-definition">animator definition</dfn> is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#struct" id="ref-for-struct">struct</a> which describes the author defined custom
animation logic. It consists of:</p>
   <ul>
    <li data-md>
     <dl>
      <dt data-md><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="animator-name">animator name</dfn>
      <dd data-md>
       <p>A <a class="production css" data-link-type="type" href="https://drafts.csswg.org/css-values-4/#typedef-ident" id="ref-for-typedef-ident">&lt;ident></a>#.</p>
     </dl>
    <li data-md>
     <dl>
      <dt data-md><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="class-constructor">class constructor</dfn>
      <dd data-md>
       <p>A <code class="idl"><a data-link-type="idl" href="#callbackdef-animatorinstanceconstructor" id="ref-for-callbackdef-animatorinstanceconstructor①">AnimatorInstanceConstructor</a></code> <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#dfn-callback-function" id="ref-for-dfn-callback-function">callback function</a> type.</p>
     </dl>
    <li data-md>
     <dl>
      <dt data-md><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="animate-function">animate function</dfn>
      <dd data-md>
       <p>A <a data-link-type="dfn" href="https://heycam.github.io/webidl/#Function" id="ref-for-Function">Function</a> <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#dfn-callback-function" id="ref-for-dfn-callback-function①">callback function</a> type.</p>
     </dl>
    <li data-md>
     <dl>
      <dt data-md><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="state-function">state function</dfn>
      <dd data-md>
       <p>A <a data-link-type="dfn" href="https://heycam.github.io/webidl/#Function" id="ref-for-Function①">Function</a> <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#dfn-callback-function" id="ref-for-dfn-callback-function②">callback function</a> type.</p>
     </dl>
    <li data-md>
     <dl>
      <dt data-md><dfn class="dfn-paneled" data-dfn-for="animator definition" data-dfn-type="dfn" data-noexport id="animator-definition-stateful-flag">stateful flag</dfn>
      <dd data-md>
       <p>A boolean flag</p>
     </dl>
   </ul>
   <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="stateful-animator-definition">stateful animator definition</dfn> is an <a data-link-type="dfn" href="#animator-definition" id="ref-for-animator-definition">animator definition</a> whose <a data-link-type="dfn" href="#animator-definition-stateful-flag" id="ref-for-animator-definition-stateful-flag">stateful flag</a> is <b>true</b>.</p>
   <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="document-animator-definition">document animator definition</dfn> is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#struct" id="ref-for-struct①">struct</a> which describes the information needed by
the <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-document" id="ref-for-concept-document">document</a> about the author defined custom animation. It consists of:</p>
   <ul>
    <li data-md>
     <dl>
      <dt data-md><dfn class="dfn-paneled" data-dfn-for="document animator definition" data-dfn-type="dfn" data-noexport id="document-animator-definition-stateful-flag">stateful flag</dfn>
      <dd data-md>
       <p>A boolean flag</p>
     </dl>
   </ul>
   <h3 class="heading settled" data-level="3.4" id="registering-animator-definition"><span class="secno">3.4. </span><span class="content">Registering an Animator Definition</span><a class="self-link" href="#registering-animator-definition"></a></h3>
    The <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-document" id="ref-for-concept-document①">document</a> has a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map" id="ref-for-ordered-map">map</a> of <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="document-animator-definitions">document animator definitions</dfn>. The map gets populated
when <code class="idl"><a data-link-type="idl" href="#dom-animationworkletglobalscope-registeranimator" id="ref-for-dom-animationworkletglobalscope-registeranimator①">registerAnimator(name, animatorCtor)</a></code> is called. 
   <p>An <code class="idl"><a data-link-type="idl" href="#animationworkletglobalscope" id="ref-for-animationworkletglobalscope③">AnimationWorkletGlobalScope</a></code> has a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map" id="ref-for-ordered-map①">map</a> of <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="animator-definitions">animator definitions</dfn>. The map gets
populated when <code class="idl"><a data-link-type="idl" href="#dom-animationworkletglobalscope-registeranimator" id="ref-for-dom-animationworkletglobalscope-registeranimator②">registerAnimator(name, animatorCtor)</a></code> is called.</p>
   <p>Note that to register a <a data-link-type="dfn" href="#stateful-animator-definition" id="ref-for-stateful-animator-definition">stateful animator definition</a> it is simply enough for the registered
class to have a <code>state</code> function.</p>
   <div class="algorithm" data-algorithm="register-animator">
    <p>When the <dfn class="dfn-paneled idl-code" data-dfn-for="AnimationWorkletGlobalScope" data-dfn-type="method" data-export id="dom-animationworkletglobalscope-registeranimator"><code>registerAnimator(<var>name</var>, <var>animatorCtor</var>)</code></dfn> method is called in a <code class="idl"><a data-link-type="idl" href="#animationworkletglobalscope" id="ref-for-animationworkletglobalscope④">AnimationWorkletGlobalScope</a></code>, the user agent <em>must</em> run the
following steps:</p>
    <ol>
     <li data-md>
      <p>If <var>name</var> is not a valid <a class="production css" data-link-type="type" href="https://drafts.csswg.org/css-values-4/#typedef-ident" id="ref-for-typedef-ident①">&lt;ident></a>, <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-throw" id="ref-for-dfn-throw">throw</a> a <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#sec-native-error-types-used-in-this-standard-typeerror" id="ref-for-sec-native-error-types-used-in-this-standard-typeerror">TypeError</a> and abort all these
steps.</p>
     <li data-md>
      <p>Let <var>animatorDefinitions</var> be the <code class="idl"><a data-link-type="idl" href="#animationworkletglobalscope" id="ref-for-animationworkletglobalscope⑤">AnimationWorkletGlobalScope</a></code>'s <a data-link-type="dfn" href="#animator-definitions" id="ref-for-animator-definitions">animator definitions</a> <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map" id="ref-for-ordered-map②">map</a>.</p>
     <li data-md>
      <p>If <var>animatorDefinitions</var>[<var>name</var>] <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-exists" id="ref-for-map-exists">exists</a>, <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-throw" id="ref-for-dfn-throw①">throw</a> a <a data-link-type="dfn" href="https://heycam.github.io/webidl/#notsupportederror" id="ref-for-notsupportederror">NotSupportedError</a> and abort all these steps.</p>
     <li data-md>
      <p>If the result of <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#sec-isconstructor" id="ref-for-sec-isconstructor">IsConstructor</a>(<var>animatorCtor</var>) is <b>false</b>, <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-throw" id="ref-for-dfn-throw②">throw</a> a <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#sec-native-error-types-used-in-this-standard-typeerror" id="ref-for-sec-native-error-types-used-in-this-standard-typeerror①">TypeError</a> and abort all these steps.</p>
     <li data-md>
      <p>Let <var>prototype</var> be the result of <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#sec-get-o-p" id="ref-for-sec-get-o-p">Get</a>(<var>animatorCtor</var>, "prototype").</p>
     <li data-md>
      <p>Let <var>animateFuncValue</var> be the result of <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#sec-get-o-p" id="ref-for-sec-get-o-p①">Get</a>(<var>prototype</var>, "animate").</p>
     <li data-md>
      <p>Let <var>animateFunc</var> be the result of <a data-link-type="dfn" href="https://heycam.github.io/webidl/#es-type-mapping" id="ref-for-es-type-mapping">converting</a> <var>animateFuncValue</var> to the <a data-link-type="dfn" href="https://heycam.github.io/webidl/#Function" id="ref-for-Function②">Function</a> <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#dfn-callback-function" id="ref-for-dfn-callback-function③">callback function</a> type. If an exception is thrown, rethrow the exception and abort
all these steps.</p>
     <li data-md>
      <p>Let <var>stateFuncValue</var> be the result of <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#sec-get-o-p" id="ref-for-sec-get-o-p②">Get</a>(<var>prototype</var>, "state").</p>
     <li data-md>
      <p>Let <var>stateFunc</var> be the result of <a data-link-type="dfn" href="https://heycam.github.io/webidl/#es-type-mapping" id="ref-for-es-type-mapping①">converting</a> <var>stateFuncValue</var> to the <a data-link-type="dfn" href="https://heycam.github.io/webidl/#Function" id="ref-for-Function③">Function</a> <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#dfn-callback-function" id="ref-for-dfn-callback-function④">callback function</a> type, If an exception is thrown, set <var>stateful</var> to be <b>false</b>,
otherwise set <var>stateful</var> to be <b>true</b> and <var>stateFunc</var> to be undefined.</p>
     <li data-md>
      <p>Let <var>definition</var> be a new <a data-link-type="dfn" href="#animator-definition" id="ref-for-animator-definition①">animator definition</a> with:</p>
      <ul>
       <li data-md>
        <p><a data-link-type="dfn" href="#animator-name" id="ref-for-animator-name">animator name</a> being <var>name</var></p>
       <li data-md>
        <p><a data-link-type="dfn" href="#class-constructor" id="ref-for-class-constructor">class constructor</a> being <var>animatorCtor</var></p>
       <li data-md>
        <p><a data-link-type="dfn" href="#animate-function" id="ref-for-animate-function">animate function</a> being <var>animateFunc</var></p>
       <li data-md>
        <p><a data-link-type="dfn" href="#state-function" id="ref-for-state-function①">state function</a> being <var>stateFunc</var></p>
       <li data-md>
        <p><a data-link-type="dfn" href="#animator-definition-stateful-flag" id="ref-for-animator-definition-stateful-flag①">stateful flag</a> being <var>stateful</var></p>
      </ul>
     <li data-md>
      <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-set" id="ref-for-map-set">set</a> the <var>animatorDefinitions</var>[<var>name</var>] to <var>definition</var>.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task" id="ref-for-queue-a-task">Queue a task</a> to run the following steps:</p>
      <ol>
       <li data-md>
        <p>Let <var>documentAnimatorDefinitions</var> be the associated <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-document" id="ref-for-concept-document②">document’s</a> <a data-link-type="dfn" href="#document-animator-definitions" id="ref-for-document-animator-definitions">document animator definitions</a> <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map" id="ref-for-ordered-map③">map</a>.</p>
       <li data-md>
        <p>Let <var>documentDefinition</var> be a new <a data-link-type="dfn" href="#document-animator-definition" id="ref-for-document-animator-definition">document animator definition</a> with:</p>
        <ul>
         <li data-md>
          <p><a data-link-type="dfn" href="#animator-definition-stateful-flag" id="ref-for-animator-definition-stateful-flag②">stateful flag</a> being <var>stateful</var></p>
        </ul>
       <li data-md>
        <p>If <var>documentAnimatorDefinitions</var>[<var>name</var>] <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-exists" id="ref-for-map-exists①">exists</a>, run the following steps:</p>
        <ol>
         <li data-md>
          <p>Let <var>existingDocumentDefinition</var> be the result of <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-get" id="ref-for-map-get">get</a> <var>documentAnimatorDefinitions</var>[<var>name</var>].</p>
         <li data-md>
          <p>If <var>existingDocumentDefinition</var> is <code>"invalid"</code>, abort all these steps.</p>
         <li data-md>
          <p>If <var>existingDocumentDefinition</var> and <var>documentDefinition</var> are not equivalent, (that is
their <a data-link-type="dfn" href="#document-animator-definition-stateful-flag" id="ref-for-document-animator-definition-stateful-flag">stateful flag</a>s are
different), then:</p>
          <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-set" id="ref-for-map-set①">set</a> <var>documentAnimatorDefinitions</var>[<var>name</var>] to <code>"invalid"</code>.</p>
          <p>Log an error to the debugging console stating that the same class was registered
with different <code>stateful flag</code>.</p>
        </ol>
       <li data-md>
        <p>Otherwise, <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-set" id="ref-for-map-set②">set</a> <var>documentAnimatorDefinitions</var>[<var>name</var>] to <var>documentDefinition</var>.</p>
      </ol>
    </ol>
   </div>
   <h3 class="heading settled" data-level="3.5" id="animator-effect-desc"><span class="secno">3.5. </span><span class="content">Animator Effect</span><a class="self-link" href="#animator-effect-desc"></a></h3>
   <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="animator-effect">Animator Effect</dfn> represents the underlying <a data-link-type="dfn" href="https://drafts.csswg.org/web-animations#animation-effect" id="ref-for-animation-effect②">animation effect</a> inside animation
worklet.</p>
   <p>It has a <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="corresponding-effect">corresponding effect</dfn> property which is a reference to the underlying <a data-link-type="dfn" href="https://drafts.csswg.org/web-animations#animation-effect" id="ref-for-animation-effect③">animation effect</a>. It also has corresponding properties for the following <a data-link-type="dfn" href="https://drafts.csswg.org/web-animations#animation-effect" id="ref-for-animation-effect④">animation effect</a>'s properties:</p>
   <ul>
    <li data-md>
     <p><a data-link-type="dfn" href="https://drafts.csswg.org/web-animations#local-time" id="ref-for-local-time">local time</a>,</p>
    <li data-md>
     <p><a data-link-type="dfn" href="https://drafts.csswg.org/web-animations#start-delay" id="ref-for-start-delay">start delay</a>,</p>
    <li data-md>
     <p><a data-link-type="dfn" href="https://drafts.csswg.org/web-animations#end-delay" id="ref-for-end-delay">end delay</a>,</p>
    <li data-md>
     <p><a data-link-type="dfn" href="https://drafts.csswg.org/web-animations#fill-mode" id="ref-for-fill-mode">fill mode</a>,</p>
    <li data-md>
     <p><a data-link-type="dfn" href="https://drafts.csswg.org/web-animations#iteration-start" id="ref-for-iteration-start">iteration start</a>,</p>
    <li data-md>
     <p><a data-link-type="dfn" href="https://drafts.csswg.org/web-animations#iteration-count" id="ref-for-iteration-count">iteration count</a>,</p>
    <li data-md>
     <p><a data-link-type="dfn" href="https://drafts.csswg.org/web-animations#iteration-duration" id="ref-for-iteration-duration">iteration duration</a>,</p>
    <li data-md>
     <p><a data-link-type="dfn" href="https://drafts.csswg.org/web-animations#playback-direction" id="ref-for-playback-direction">playback direction</a>, and</p>
    <li data-md>
     <p><a data-link-type="dfn" href="https://drafts.csswg.org/web-animations#timing-function" id="ref-for-timing-function">timing function</a>.</p>
   </ul>
   <p><a data-link-type="dfn" href="#animator-effect" id="ref-for-animator-effect">Animator Effect</a> is represented by the <code class="idl"><a data-link-type="idl" href="#workletanimationeffect" id="ref-for-workletanimationeffect">WorkletAnimationEffect</a></code> interface
inside <code class="idl"><a data-link-type="idl" href="#animationworkletglobalscope" id="ref-for-animationworkletglobalscope⑥">AnimationWorkletGlobalScope</a></code>.</p>
<pre class="idl highlight def">[ <a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed" id="ref-for-Exposed②"><c- g>Exposed</c-></a>=<c- n>AnimationWorklet</c-> ]
<c- b>interface</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="interface" data-export id="workletanimationeffect"><code><c- g>WorkletAnimationEffect</c-></code></dfn> {
    <a data-link-type="idl-name" href="https://drafts.csswg.org/web-animations-1/#dictdef-effecttiming" id="ref-for-dictdef-effecttiming"><c- n>EffectTiming</c-></a>         <a class="idl-code" data-link-type="method" href="#dom-workletanimationeffect-gettiming" id="ref-for-dom-workletanimationeffect-gettiming"><c- g>getTiming</c-></a>();
    <a data-link-type="idl-name" href="https://drafts.csswg.org/web-animations-1/#dictdef-computedeffecttiming" id="ref-for-dictdef-computedeffecttiming"><c- n>ComputedEffectTiming</c-></a> <a class="idl-code" data-link-type="method" href="#dom-workletanimationeffect-getcomputedtiming" id="ref-for-dom-workletanimationeffect-getcomputedtiming"><c- g>getComputedTiming</c-></a>();
    <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-double" id="ref-for-idl-double"><c- b>double</c-></a>? <a class="idl-code" data-link-type="attribute" data-type="double?" href="#dom-workletanimationeffect-localtime" id="ref-for-dom-workletanimationeffect-localtime"><c- g>localTime</c-></a>;
};

</pre>
   <p class="note" role="note"><span class="marker">Note:</span> <code class="idl"><a data-link-type="idl" href="#workletanimationeffect" id="ref-for-workletanimationeffect①">WorkletAnimationEffect</a></code> is basically a restricted version of <code class="idl"><a data-link-type="idl" href="https://drafts.csswg.org/web-animations-1/#animationeffect" id="ref-for-animationeffect">AnimationEffect</a></code> interface
  which does not have <code class="idl"><a data-link-type="idl" href="https://drafts.csswg.org/web-animations-1/#dom-animationeffect-updatetiming" id="ref-for-dom-animationeffect-updatetiming">updateTiming</a></code> but additionally allows local time to be set.</p>
   <div class="methods">
    <dl>
     <dt data-md><dfn class="dfn-paneled idl-code" data-dfn-for="WorkletAnimationEffect" data-dfn-type="method" data-export id="dom-workletanimationeffect-gettiming"><code>getTiming()</code></dfn>
     <dd data-md>
      <p>Returns the specified timing properties using the corresponding properties.</p>
     <dt data-md><dfn class="dfn-paneled idl-code" data-dfn-for="WorkletAnimationEffect" data-dfn-type="method" data-export id="dom-workletanimationeffect-getcomputedtiming"><code>getComputedTiming()</code></dfn>
     <dd data-md>
      <p>Returns the calculated timing properties using the corresponding properties.</p>
     <dt data-md><dfn class="dfn-paneled idl-code" data-dfn-for="WorkletAnimationEffect" data-dfn-type="attribute" data-export id="dom-workletanimationeffect-localtime"><code>localTime</code></dfn>, <span> of type <a data-link-type="idl-name" href="https://webidl.spec.whatwg.org/#idl-double" id="ref-for-idl-double①">double</a>, nullable</span>
     <dd data-md>
      <p>Getting the attribute returns the corresponding <a data-link-type="dfn" href="https://drafts.csswg.org/web-animations#local-time" id="ref-for-local-time①">local time</a>.
Setting the attribute updates the local time given this effect as <var>effect</var> and the attribute value as <var>time</var>:</p>
      <ol>
       <li data-md>
        <p>If the <var>time</var> is the same as <var>effect</var>’s <a data-link-type="dfn" href="https://drafts.csswg.org/web-animations#local-time" id="ref-for-local-time②">local time</a> then skip following steps.</p>
       <li data-md>
        <p>Set the <var>effect</var>’s <a data-link-type="dfn" href="https://drafts.csswg.org/web-animations#local-time" id="ref-for-local-time③">local time</a> to <var>time</var>.</p>
       <li data-md>
        <p>Set the <var>effect</var>’s animator instance’s <a data-link-type="dfn" href="#sync-requested-flag" id="ref-for-sync-requested-flag">sync requested flag</a> to <b>true</b>.</p>
      </ol>
    </dl>
   </div>
   <h2 class="heading settled" data-level="4" id="animator-instance-section"><span class="secno">4. </span><span class="content">Animator Instance</span><a class="self-link" href="#animator-instance-section"></a></h2>
   <p>An <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="animator-instance">animator instance</dfn> is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#struct" id="ref-for-struct②">struct</a> which describes a fully realized custom <a data-link-type="dfn" href="#animator" id="ref-for-animator">animator</a> in an <code class="idl"><a data-link-type="idl" href="#animationworkletglobalscope" id="ref-for-animationworkletglobalscope⑦">AnimationWorkletGlobalScope</a></code>. It has a reference to an <a data-link-type="dfn" href="#animator-definition" id="ref-for-animator-definition②">animator definition</a> and owns the instance specific state such as animation effect and
timeline. It consists of:</p>
   <ul>
    <li data-md>
     <dl>
      <dt data-md><a data-link-type="dfn" href="#animator-name" id="ref-for-animator-name①">animator name</a>
      <dd data-md>
       <p>A string used to identify the animator definition.</p>
     </dl>
    <li data-md>
     <dl>
      <dt data-md><a data-link-type="dfn" href="#frame-requested-flag" id="ref-for-frame-requested-flag">frame requested flag</a>
      <dd data-md>
       <p>A boolean flag that indicates if the animator needs to animate.</p>
     </dl>
    <li data-md>
     <dl>
      <dt data-md><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="sync-requested-flag">sync requested flag</dfn>
      <dd data-md>
       <p>A flag that indicates if the animator needs to sync its output.</p>
     </dl>
    <li data-md>
     <dl>
      <dt data-md><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="effect">effect</dfn>
      <dd data-md>
       <p>An <a data-link-type="dfn" href="#animator-effect" id="ref-for-animator-effect①">Animator Effect</a>.</p>
     </dl>
    <li data-md>
     <dl>
      <dt data-md><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="animator-current-time">animator current time</dfn>
      <dd data-md>
       <p>A time value equivalent to the corresponding <a data-link-type="dfn" href="#worklet-animation" id="ref-for-worklet-animation">worklet animation</a>'s current time.</p>
     </dl>
    <li data-md>
     <dl>
      <dt data-md><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="animator-timeline">animator timeline</dfn>
      <dd data-md>
       <p>The <a data-link-type="dfn" href="https://drafts.csswg.org/web-animations#timeline" id="ref-for-timeline">timeline</a> of the corresponding <a data-link-type="dfn" href="#worklet-animation" id="ref-for-worklet-animation①">worklet animation</a>.</p>
     </dl>
    <li data-md>
     <dl>
      <dt data-md><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="animator-serialized-options">animator serialized options</dfn>
      <dd data-md>
       <p>The serializable object representing the options to be used when constructing the animator
instance.</p>
     </dl>
   </ul>
   <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="stateful-animator-instance">stateful animator instance</dfn> is an <a data-link-type="dfn" href="#animator-instance" id="ref-for-animator-instance①">animator instance</a> whose corresponding
definition is a <a data-link-type="dfn" href="#stateful-animator-definition" id="ref-for-stateful-animator-definition①">stateful animator definition</a>.</p>
   <h3 class="heading settled" data-level="4.1" id="creating-animator-instance"><span class="secno">4.1. </span><span class="content">Creating an Animator Instance</span><a class="self-link" href="#creating-animator-instance"></a></h3>
   <p>Each <a data-link-type="dfn" href="#animator-instance" id="ref-for-animator-instance②">animator instance</a> lives in an <code class="idl"><a data-link-type="idl" href="#animationworkletglobalscope" id="ref-for-animationworkletglobalscope⑧">AnimationWorkletGlobalScope</a></code>.</p>
   <p>Each <code class="idl"><a data-link-type="idl" href="#animationworkletglobalscope" id="ref-for-animationworkletglobalscope⑨">AnimationWorkletGlobalScope</a></code> has an <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="animator-instance-set">animator instance set</dfn>. The set is populated
when the user agent constructs a new <a data-link-type="dfn" href="#animator-instance" id="ref-for-animator-instance③">animator instance</a> in the <code class="idl"><a data-link-type="idl" href="#animationworkletglobalscope" id="ref-for-animationworkletglobalscope①⓪">AnimationWorkletGlobalScope</a></code> scope. Each <a data-link-type="dfn" href="#animator-instance" id="ref-for-animator-instance④">animator instance</a> corresponds to a worklet animation in the document scope.</p>
   <div class="algorithm" data-algorithm="create-animator">
    <p>To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="create-a-new-animator-instance">create a new animator instance</dfn> given a <var>name</var>, <var>timeline</var>, <var>effect</var>, <var>serializedOptions</var>, <var>serializedState</var>, and <var>workletGlobalScope</var>, the user agent <em>must</em> run
the following steps:</p>
    <ol>
     <li data-md>
      <p>Let the <var>definition</var> be the result of looking up <var>name</var> on the <var>workletGlobalScope</var>’s <a data-link-type="dfn" href="#animator-definitions" id="ref-for-animator-definitions①">animator definitions</a>.</p>
      <p>If <var>definition</var> does not exist abort the following steps.</p>
     <li data-md>
      <p>Let <var>animatorCtor</var> be the <a data-link-type="dfn" href="#class-constructor" id="ref-for-class-constructor①">class constructor</a> of <var>definition</var>.</p>
     <li data-md>
      <p>Let <var>options</var> be <a data-link-type="dfn" href="http://w3c.github.io/html/infrastructure.html#structureddeserialize" id="ref-for-structureddeserialize">StructuredDeserialize</a>(<var>serializedOptions</var>).</p>
     <li data-md>
      <p>Let <var>state</var> be <a data-link-type="dfn" href="http://w3c.github.io/html/infrastructure.html#structureddeserialize" id="ref-for-structureddeserialize①">StructuredDeserialize</a>(<var>serializedState</var>).</p>
     <li data-md>
      <p>Let <var>animatorInstance</var> be the result of <a data-link-type="dfn" href="https://heycam.github.io/webidl/#construct-a-callback-function" id="ref-for-construct-a-callback-function">constructing</a> <var>animatorCtor</var> with
«<var>options</var>, <var>state</var>» as arguments. If an exception is thrown, rethrow the exception and
abort all these steps.</p>
     <li data-md>
      <p>Let <var>animatorEffect</var> be the result of <a data-link-type="dfn" href="https://heycam.github.io/webidl/#construct-a-callback-function" id="ref-for-construct-a-callback-function①">constructing</a> a <code class="idl"><a data-link-type="idl" href="#workletanimationeffect" id="ref-for-workletanimationeffect②">WorkletAnimationEffect</a></code> with its <a data-link-type="dfn" href="#corresponding-effect" id="ref-for-corresponding-effect">corresponding effect</a> being <var>effect</var>.</p>
     <li data-md>
      <p>Set the following on <var>animatorInstance</var> with:</p>
      <ul>
       <li data-md>
        <p><a data-link-type="dfn" href="#animator-name" id="ref-for-animator-name②">animator name</a> being <var>name</var></p>
       <li data-md>
        <p><a data-link-type="dfn" href="#frame-requested-flag" id="ref-for-frame-requested-flag①">frame requested flag</a> being <b>false</b></p>
       <li data-md>
        <p><a data-link-type="dfn" href="#sync-requested-flag" id="ref-for-sync-requested-flag①">sync requested flag</a> being <b>false</b></p>
       <li data-md>
        <p><a data-link-type="dfn" href="#animator-current-time" id="ref-for-animator-current-time">animator current time</a> being unresolved</p>
       <li data-md>
        <p><a data-link-type="dfn" href="#effect" id="ref-for-effect">effect</a> being <var>animatorEffect</var></p>
       <li data-md>
        <p><a data-link-type="dfn" href="#animator-timeline" id="ref-for-animator-timeline">animator timeline</a> being <var>timeline</var></p>
       <li data-md>
        <p><a data-link-type="dfn" href="#animator-serialized-options" id="ref-for-animator-serialized-options">animator serialized options</a> being <var>options</var></p>
      </ul>
     <li data-md>
      <p>Add <var>animatorInstance</var> to <var>workletGlobalScope</var>’s <a data-link-type="dfn" href="#animator-instance-set" id="ref-for-animator-instance-set">animator instance set</a>.</p>
    </ol>
   </div>
   <h3 class="heading settled" data-level="4.2" id="running-animators"><span class="secno">4.2. </span><span class="content">Running Animators</span><a class="self-link" href="#running-animators"></a></h3>
   <p>When the user agent wants to produce a new animation frame, if for any <a data-link-type="dfn" href="#animator-instance" id="ref-for-animator-instance⑤">animator instance</a> the
associated <a data-link-type="dfn" href="#frame-requested-flag" id="ref-for-frame-requested-flag②">frame requested flag</a> is <b>true</b> then the the user agent <em>must</em> <a data-link-type="dfn" href="#run-animators" id="ref-for-run-animators">run animators</a> for the current frame in all its associated global scopes.</p>
   <p class="note" role="note"><span class="marker">Note:</span> The user agent is not required to run animations on every visual frame. It is legal to defer
      generating an animation frame until a later frame. This allow the user agent to
      provide a different service level according to their policy.</p>
   <div class="algorithm" data-algorithm="run-animators">
    <p>When the user agent wants to <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="run-animators">run animators</dfn> in a given <var>workletGlobalScope</var>, it <em>must</em> run the following steps:</p>
    <ol>
     <li data-md>
      <p>Iterate over all <a data-link-type="dfn" href="#animator-instance" id="ref-for-animator-instance⑥">animator instance</a>s in the <var>workletGlobalScope</var>’s <a data-link-type="dfn" href="#animator-instance-set" id="ref-for-animator-instance-set①">animator instance
set</a>. For each such <var>animator</var> the user agent <em>must</em> perform the following steps:</p>
      <ol>
       <li data-md>
        <p>Let <var>animatorName</var> be <var>animator</var>’s <a data-link-type="dfn" href="#animator-name" id="ref-for-animator-name③">animator name</a></p>
       <li data-md>
        <p>Let the <var>definition</var> be the result of looking up <var>animatorName</var> on the <var>workletGlobalScope</var>’s <a data-link-type="dfn" href="#animator-definitions" id="ref-for-animator-definitions②">animator definitions</a>.</p>
      </ol>
      <p>If <var>definition</var> does not exist then abort the following steps.</p>
      <ol start="3">
       <li data-md>
        <p>If the <a data-link-type="dfn" href="#frame-requested-flag" id="ref-for-frame-requested-flag③">frame requested flag</a> for <var>animator</var> is <b>false</b> or the effect belonging
to the <var>animator</var> will not be visible within the visual viewport of the current frame
the user agent <em>may</em> abort all the following steps.</p>
        <p class="issue" id="issue-68dc788e"><a class="self-link" href="#issue-68dc788e"></a> Consider giving user agents permission to skip running individual animator
instances to throttle slow animators.</p>
       <li data-md>
        <p>Let <var>animateFunction</var> be <var>definition</var>’s <a data-link-type="dfn" href="#animate-function" id="ref-for-animate-function①">animate function</a>.</p>
       <li data-md>
        <p>Let <var>currentTime</var> be <a data-link-type="dfn" href="#animator-current-time" id="ref-for-animator-current-time①">animator current time</a> of <var>animator</var>.</p>
       <li data-md>
        <p>Let <var>effect</var> be <a data-link-type="dfn" href="#effect" id="ref-for-effect①">effect</a> of <var>animator</var>.</p>
       <li data-md>
        <p><a data-link-type="dfn" href="https://heycam.github.io/webidl/#invoke-a-callback-function" id="ref-for-invoke-a-callback-function">Invoke</a> <var>animateFunction</var> with arguments «<var>currentTime</var>, <var>effect</var>»,
and with <var>animator</var> as the <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-callback-this-value" id="ref-for-dfn-callback-this-value">callback this value</a>.</p>
      </ol>
     <li data-md>
      <p>If any <a data-link-type="dfn" href="#animator-instance" id="ref-for-animator-instance⑦">animator instance</a>s in the <var>workletGlobalScope</var>’s <a data-link-type="dfn" href="#animator-instance-set" id="ref-for-animator-instance-set②">animator instance set</a> has its <a data-link-type="dfn" href="#sync-requested-flag" id="ref-for-sync-requested-flag②">sync requested flag</a> set to <b>true</b> then <a data-link-type="dfn" href="#sync-local-times-to-document" id="ref-for-sync-local-times-to-document">sync local times to document</a> given <var>workletGlobalScope</var>.</p>
    </ol>
   </div>
   <p class="note" role="note"><span class="marker">Note:</span> Although inefficient, it is legal for the user agent to <a data-link-type="dfn" href="#run-animators" id="ref-for-run-animators①">run animators</a> multiple times
in the same frame.</p>
   <p class="issue" id="issue-9dc01310"><a class="self-link" href="#issue-9dc01310"></a> should be explicit as to what happens if the animateFunction throws an exception. At least
we should have wording that the localTime values of the effects are ignored to avoid incorrect
partial updates.</p>
   <h3 class="heading settled" data-level="4.3" id="removing-animator"><span class="secno">4.3. </span><span class="content">Removing an Animator Instance</span><a class="self-link" href="#removing-animator"></a></h3>
   <div class="algorithm" data-algorithm="remove-animator">
    <p>To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="remove-an-animator-instance">remove an animator instance</dfn> given <var>animator</var> and <var>workletGlobalScope</var> the user agent <em>must</em> run the following steps:</p>
    <ol>
     <li data-md>
      <p>Remove <var>animator</var> from <var>workletGlobalScope</var>’s <a data-link-type="dfn" href="#animator-instance-set" id="ref-for-animator-instance-set③">animator instance set</a>.</p>
    </ol>
   </div>
   <h3 class="heading settled" data-level="4.4" id="migrating-animator"><span class="secno">4.4. </span><span class="content">Migrating an Animator Instance</span><a class="self-link" href="#migrating-animator"></a></h3>
   <p>The migration process allows <a data-link-type="dfn" href="#stateful-animator-instance" id="ref-for-stateful-animator-instance">stateful animator instance</a> to be migrated to a different <code class="idl"><a data-link-type="idl" href="#animationworkletglobalscope" id="ref-for-animationworkletglobalscope①①">AnimationWorkletGlobalScope</a></code> without losing their local state.</p>
   <div class="algorithm" data-algorithm="migrate-animator">
    <p>To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="migrate-an-animator-instance">migrate an animator instance</dfn> from one <code class="idl"><a data-link-type="idl" href="#animationworkletglobalscope" id="ref-for-animationworkletglobalscope①②">AnimationWorkletGlobalScope</a></code> to another,
given <var>animator</var>, <var>sourceWorkletGlobalScope</var>, <var>destinationWorkletGlobalScope</var>, the user agent <em>must</em> run the following steps :</p>
    <ol>
     <li data-md>
      <p>Let <var>serializedState</var> be undefined.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task" id="ref-for-queue-a-task①">Queue a task</a> on <var>sourceWorkletGlobalScope</var> to run the following steps:</p>
      <ol>
       <li data-md>
        <p>Let <var>animatorName</var> be <var>animator</var>’s <a data-link-type="dfn" href="#animator-name" id="ref-for-animator-name④">animator name</a></p>
       <li data-md>
        <p>Let <var>definition</var> be the result of looking up <var>animatorName</var> on <var>sourceWorkletGlobalScope</var>’s <a data-link-type="dfn" href="#animator-definitions" id="ref-for-animator-definitions③">animator definitions</a>.</p>
        <p>If <var>definition</var> does not exist then abort the following steps.</p>
       <li data-md>
        <p>Let <var>stateful</var> be the <a data-link-type="dfn" href="#animator-definition-stateful-flag" id="ref-for-animator-definition-stateful-flag③">stateful flag</a> of <var>definition</var>.</p>
       <li data-md>
        <p>If <var>stateful</var> is <b>false</b> then abort the following steps.</p>
       <li data-md>
        <p>Let <var>stateFunction</var> be <var>definition</var>’s <a data-link-type="dfn" href="#state-function" id="ref-for-state-function②">state function</a>.</p>
       <li data-md>
        <p>Let <var>state</var> be the result of <a data-link-type="dfn" href="https://heycam.github.io/webidl/#invoke-a-callback-function" id="ref-for-invoke-a-callback-function①">Invoke</a> <var>stateFunction</var> with <var>animator</var> as the <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-callback-this-value" id="ref-for-dfn-callback-this-value①">callback this value</a>.  If any exception is thrown, rethrow the exception and abort
the following steps.</p>
       <li data-md>
        <p>Set <var>serializedState</var> to be the result of <a data-link-type="dfn" href="http://w3c.github.io/html/infrastructure.html#structuredserialize" id="ref-for-structuredserialize">StructuredSerialize</a>(<var>state</var>).
If any exception is thrown, then abort the following steps.</p>
       <li data-md>
        <p>Run the procedure to <a data-link-type="dfn" href="#remove-an-animator-instance" id="ref-for-remove-an-animator-instance">remove an animator instance</a> given <var>animator</var>, and <var>sourceWorkletGlobalScope</var>.</p>
      </ol>
     <li data-md>
      <p>Wait for the above task to complete. If the task is aborted, abort the following steps.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task" id="ref-for-queue-a-task②">Queue a task</a> on <var>destinationWorkletGlobalScope</var> to run the following steps:</p>
      <ol>
       <li data-md>
        <p>Run the procedure to <a data-link-type="dfn" href="#create-a-new-animator-instance" id="ref-for-create-a-new-animator-instance">create a new animator instance</a> given:</p>
        <ul>
         <li data-md>
          <p>The <var>animator</var>’s <a data-link-type="dfn" href="#animator-name" id="ref-for-animator-name⑤">animator name</a> as name.</p>
         <li data-md>
          <p>The <var>animator</var>’s <a data-link-type="dfn" href="#animator-timeline" id="ref-for-animator-timeline①">animator timeline</a> as timeline.</p>
         <li data-md>
          <p>The <var>animator</var>’s <a data-link-type="dfn" href="#effect" id="ref-for-effect②">effect</a> as effect.</p>
         <li data-md>
          <p>The <var>animator</var>’s <a data-link-type="dfn" href="#animator-serialized-options" id="ref-for-animator-serialized-options①">animator serialized options</a> as options.</p>
         <li data-md>
          <p>The <var>serializedState</var> as state.</p>
         <li data-md>
          <p>The <var>destinationWorkletGlobalScope</var> as workletGlobalScope.</p>
        </ul>
      </ol>
    </ol>
   </div>
   <p>If an animator state getter throws the user agent will remove the animator but does not recreate it.
This effectively removes the animator instance.</p>
   <h3 class="heading settled" data-level="4.5" id="requesting-animation-frames"><span class="secno">4.5. </span><span class="content">Requesting Animation Frames</span><a class="self-link" href="#requesting-animation-frames"></a></h3>
   <p>Each <a data-link-type="dfn" href="#animator-instance" id="ref-for-animator-instance⑧">animator instance</a> has an associated <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="frame-requested-flag">frame requested flag</dfn>. It is initially set
to <b>false</b>. Different circumstances can cause the <a data-link-type="dfn" href="#frame-requested-flag" id="ref-for-frame-requested-flag④">frame requested flag</a> to be set to <b>true</b>. These include the following:</p>
   <ul>
    <li data-md>
     <p>Changes in the <a data-link-type="dfn" href="https://drafts.csswg.org/web-animations#current-time" id="ref-for-current-time">current time</a> of the animator’s <a data-link-type="dfn" href="https://drafts.csswg.org/web-animations#timeline" id="ref-for-timeline①">timeline</a></p>
    <li data-md>
     <p>Changes in the <a data-link-type="dfn" href="https://drafts.csswg.org/web-animations#current-time" id="ref-for-current-time①">current time</a> of the animator’s corresponding <a data-link-type="dfn" href="#worklet-animation" id="ref-for-worklet-animation②">worklet animation</a></p>
   </ul>
   <p>Performing <a data-link-type="dfn" href="#run-animators" id="ref-for-run-animators②">run animators</a> resets the <a data-link-type="dfn" href="#frame-requested-flag" id="ref-for-frame-requested-flag⑤">frame requested flag</a> on animators to <b>false</b>.</p>
   <h2 class="heading settled" data-level="5" id="web-animation-integration"><span class="secno">5. </span><span class="content">Web Animations Integration</span><a class="self-link" href="#web-animation-integration"></a></h2>
   <h3 class="heading settled" data-level="5.1" id="worklet-animation-desc"><span class="secno">5.1. </span><span class="content">Worklet Animation</span><a class="self-link" href="#worklet-animation-desc"></a></h3>
    <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="worklet-animation">Worklet animation</dfn> is a kind of <a data-link-type="dfn" href="https://drafts.csswg.org/web-animations#concept-animation" id="ref-for-concept-animation①">animation</a> that delegates animating its animation
effect to an <a data-link-type="dfn" href="#animator-instance" id="ref-for-animator-instance⑨">animator instance</a>. It controls the lifetime and playback state of its <a data-link-type="dfn" href="#corresponding-animator-instance" id="ref-for-corresponding-animator-instance">corresponding animator instance</a>. 
   <p>Being an <a data-link-type="dfn" href="https://drafts.csswg.org/web-animations#concept-animation" id="ref-for-concept-animation②">animation</a>, <a data-link-type="dfn" href="#worklet-animation" id="ref-for-worklet-animation③">worklet animation</a> has an <a data-link-type="dfn" href="https://drafts.csswg.org/web-animations#animation-effect" id="ref-for-animation-effect⑤">animation effect</a> and a <a data-link-type="dfn" href="https://drafts.csswg.org/web-animations#timeline" id="ref-for-timeline②">timeline</a>. However unlike other animations the worklet animation’s <a data-link-type="dfn" href="https://drafts.csswg.org/web-animations#current-time" id="ref-for-current-time②">current time</a> does
not directly determine the animation effect’s <a data-link-type="dfn" href="https://drafts.csswg.org/web-animations#local-time" id="ref-for-local-time④">local time</a> (via its <a data-link-type="dfn" href="https://drafts.csswg.org/web-animations#inherited-time" id="ref-for-inherited-time">inherited time</a>).
Instead the associated <a data-link-type="dfn" href="#animator-instance" id="ref-for-animator-instance①⓪">animator instance</a> controls the animation effect’s <a data-link-type="dfn" href="https://drafts.csswg.org/web-animations#local-time" id="ref-for-local-time⑤">local time</a> directly. Note that this means that the <a data-link-type="dfn" href="https://drafts.csswg.org/web-animations#timeline" id="ref-for-timeline③">timeline’s</a> current time does not fully determine the
animation’s output.</p>
   <p><a data-link-type="dfn" href="#worklet-animation" id="ref-for-worklet-animation④">Worklet animation</a> has the following properties in addition to the <code class="idl"><a data-link-type="idl" href="https://drafts.csswg.org/web-animations-1/#animation" id="ref-for-animation①">Animation</a></code> interface:</p>
   <ul>
    <li data-md>
     <dl>
      <dt data-md><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="animation-animator-name">animation animator name</dfn>
      <dd data-md>
       <p>A string that identifies its <a data-link-type="dfn" href="#animator-definition" id="ref-for-animator-definition③">animator definition</a>.</p>
     </dl>
    <li data-md>
     <dl>
      <dt data-md><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="serialized-options">serialized options</dfn>
      <dd data-md>
       <p>A serializable options object that is used whe constructing a new animator instance.</p>
     </dl>
    <li data-md>
     <dl>
      <dt data-md><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="corresponding-animator-instance">corresponding animator instance</dfn>
      <dd data-md>
       <p>A <a data-link-type="dfn" href="#animator-instance" id="ref-for-animator-instance①①">Animator Instance</a>.</p>
     </dl>
   </ul>
   <p>The existence of <a data-link-type="dfn" href="#corresponding-animator-instance" id="ref-for-corresponding-animator-instance①">corresponding animator instance</a> for a <a data-link-type="dfn" href="#worklet-animation" id="ref-for-worklet-animation⑤">worklet animation</a> depends on
the animation <a data-link-type="dfn" href="https://drafts.csswg.org/web-animations#play-state" id="ref-for-play-state">play state</a>. See <a href="#web-animation-overrides">§ 5.4 Web Animations Overrides</a> for details on when and this
correspondence changes.</p>
<pre class="idl highlight def">[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed" id="ref-for-Exposed③"><c- g>Exposed</c-></a>=<c- n>Window</c->]
<c- b>interface</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="interface" data-export id="workletanimation"><code><c- g>WorkletAnimation</c-></code></dfn> : <a data-link-type="idl-name" href="https://drafts.csswg.org/web-animations-1/#animation" id="ref-for-animation②"><c- n>Animation</c-></a> {
        <a class="idl-code" data-link-type="constructor" href="#dom-workletanimation-workletanimation" id="ref-for-dom-workletanimation-workletanimation"><c- g>constructor</c-></a>(<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString" id="ref-for-idl-DOMString①"><c- b>DOMString</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="WorkletAnimation/WorkletAnimation(animatorName, effects, timeline, options), WorkletAnimation/constructor(animatorName, effects, timeline, options), WorkletAnimation/WorkletAnimation(animatorName, effects, timeline), WorkletAnimation/constructor(animatorName, effects, timeline), WorkletAnimation/WorkletAnimation(animatorName, effects), WorkletAnimation/constructor(animatorName, effects), WorkletAnimation/WorkletAnimation(animatorName), WorkletAnimation/constructor(animatorName)" data-dfn-type="argument" data-export id="dom-workletanimation-workletanimation-animatorname-effects-timeline-options-animatorname"><code><c- g>animatorName</c-></code></dfn>,
              <c- b>optional</c-> (<a data-link-type="idl-name" href="https://drafts.csswg.org/web-animations-1/#animationeffect" id="ref-for-animationeffect①"><c- n>AnimationEffect</c-></a> <c- b>or</c-> <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#idl-sequence" id="ref-for-idl-sequence"><c- b>sequence</c-></a>&lt;<a data-link-type="idl-name" href="https://drafts.csswg.org/web-animations-1/#animationeffect" id="ref-for-animationeffect②"><c- n>AnimationEffect</c-></a>>)? <dfn class="dfn-paneled idl-code" data-dfn-for="WorkletAnimation/WorkletAnimation(animatorName, effects, timeline, options), WorkletAnimation/constructor(animatorName, effects, timeline, options), WorkletAnimation/WorkletAnimation(animatorName, effects, timeline), WorkletAnimation/constructor(animatorName, effects, timeline), WorkletAnimation/WorkletAnimation(animatorName, effects), WorkletAnimation/constructor(animatorName, effects), WorkletAnimation/WorkletAnimation(animatorName), WorkletAnimation/constructor(animatorName)" data-dfn-type="argument" data-export id="dom-workletanimation-workletanimation-animatorname-effects-timeline-options-effects"><code><c- g>effects</c-></code></dfn> = <c- b>null</c->,
              <c- b>optional</c-> <a data-link-type="idl-name" href="https://drafts.csswg.org/web-animations-1/#animationtimeline" id="ref-for-animationtimeline"><c- n>AnimationTimeline</c-></a>? <dfn class="dfn-paneled idl-code" data-dfn-for="WorkletAnimation/WorkletAnimation(animatorName, effects, timeline, options), WorkletAnimation/constructor(animatorName, effects, timeline, options), WorkletAnimation/WorkletAnimation(animatorName, effects, timeline), WorkletAnimation/constructor(animatorName, effects, timeline), WorkletAnimation/WorkletAnimation(animatorName, effects), WorkletAnimation/constructor(animatorName, effects), WorkletAnimation/WorkletAnimation(animatorName), WorkletAnimation/constructor(animatorName)" data-dfn-type="argument" data-export id="dom-workletanimation-workletanimation-animatorname-effects-timeline-options-timeline"><code><c- g>timeline</c-></code></dfn>,
              <c- b>optional</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-any" id="ref-for-idl-any③"><c- b>any</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="WorkletAnimation/WorkletAnimation(animatorName, effects, timeline, options), WorkletAnimation/constructor(animatorName, effects, timeline, options), WorkletAnimation/WorkletAnimation(animatorName, effects, timeline), WorkletAnimation/constructor(animatorName, effects, timeline), WorkletAnimation/WorkletAnimation(animatorName, effects), WorkletAnimation/constructor(animatorName, effects), WorkletAnimation/WorkletAnimation(animatorName), WorkletAnimation/constructor(animatorName)" data-dfn-type="argument" data-export id="dom-workletanimation-workletanimation-animatorname-effects-timeline-options-options"><code><c- g>options</c-></code></dfn>);
        <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString" id="ref-for-idl-DOMString②"><c- b>DOMString</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="WorkletAnimation" data-dfn-type="attribute" data-export data-readonly data-type="DOMString" id="dom-workletanimation-animatorname"><code><c- g>animatorName</c-></code></dfn>;
};
</pre>
   <figure>
     <img alt="Overview of the WorkletAnimation timing model." src="img/WorkletAnimation-timing-model.svg" width="600"> 
    <figcaption> Overview of the worklet animation timing model. <br> The animation current time is input to the animator instance, which produces a local time value
    for the animation effect. If the animator instance is running in a parallel global scope the
    implementation may also choose to use the local time value to produce the animation output and
    update the visuals in parallel. </figcaption>
   </figure>
   <h3 class="heading settled" data-level="5.2" id="creating-worklet-animation"><span class="secno">5.2. </span><span class="content">Creating a Worklet Animation</span><a class="self-link" href="#creating-worklet-animation"></a></h3>
   <div class="algorithm" data-algorithm="create-worklet-animation">
     <dfn class="dfn-paneled idl-code" data-dfn-for="WorkletAnimation" data-dfn-type="constructor" data-export data-lt="WorkletAnimation(animatorName, effects, timeline, options)|constructor(animatorName, effects, timeline, options)|WorkletAnimation(animatorName, effects, timeline)|constructor(animatorName, effects, timeline)|WorkletAnimation(animatorName, effects)|constructor(animatorName, effects)|WorkletAnimation(animatorName)|constructor(animatorName)" id="dom-workletanimation-workletanimation"><code>WorkletAnimation(<var>animatorName</var>, <var>effects</var>, <var>timeline</var>, <var>options</var>)</code></dfn> 
    <p>Creates a new <code class="idl"><a data-link-type="idl" href="#workletanimation" id="ref-for-workletanimation②">WorkletAnimation</a></code> object using the following procedure:</p>
    <ol>
     <li data-md>
      <p>Let <var>documentAnimatorDefinitions</var> be the associated <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-document" id="ref-for-concept-document③">document’s</a> <a data-link-type="dfn" href="#document-animator-definitions" id="ref-for-document-animator-definitions①">document animator
definitions</a> <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map" id="ref-for-ordered-map④">map</a>.</p>
     <li data-md>
      <p>If <var>documentAnimatorDefinitions</var>[<var>animatorName</var>] does not <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-exists" id="ref-for-map-exists②">exists</a>, <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-throw" id="ref-for-dfn-throw③">throw</a> an <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#sec-native-error-types-used-in-this-standard-typeerror" id="ref-for-sec-native-error-types-used-in-this-standard-typeerror②">TypeError</a> and abort the following steps.</p>
     <li data-md>
      <p>If <var>documentAnimatorDefinitions</var>[<var>animatorName</var>] is <code>"invalid"</code>, <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-throw" id="ref-for-dfn-throw④">throw</a> an <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#sec-native-error-types-used-in-this-standard-typeerror" id="ref-for-sec-native-error-types-used-in-this-standard-typeerror③">TypeError</a> and abort the following steps.</p>
     <li data-md>
      <p>Let <var>workletAnimation</var> be a new <code class="idl"><a data-link-type="idl" href="#workletanimation" id="ref-for-workletanimation③">WorkletAnimation</a></code> object.</p>
     <li data-md>
      <p>Run the procedure to <a data-link-type="dfn" href="https://drafts.csswg.org/web-animations#set-the-timeline-of-an-animation" id="ref-for-set-the-timeline-of-an-animation">set the timeline of an animation</a> on <var>workletAnimation</var> passing <var>timeline</var> as the new timeline or, if a <var>timeline</var> argument is not provided,
passing the <a data-link-type="dfn" href="https://drafts.csswg.org/web-animations#the-documents-default-timeline" id="ref-for-the-documents-default-timeline">default document timeline</a> of the <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#document" id="ref-for-document">Document</a></code> associated with the <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#window" id="ref-for-window">Window</a></code> that is the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#current-global-object" id="ref-for-current-global-object">current global object</a>.</p>
     <li data-md>
      <p>Let <var>effect</var> be the result corresponding to the first matching condition from below.</p>
      <dl>
       <dt data-md>If <var>effects</var> is a <code class="idl"><a data-link-type="idl" href="https://drafts.csswg.org/web-animations-1/#animationeffect" id="ref-for-animationeffect③">AnimationEffect</a></code> object,
       <dd data-md>
        <p>Let effect be <var>effects</var>.</p>
       <dt data-md>If <var>effects</var> is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list">list</a> of <code class="idl"><a data-link-type="idl" href="https://drafts.csswg.org/web-animations-1/#animationeffect" id="ref-for-animationeffect④">AnimationEffect</a></code> objects,
       <dd data-md>
        <p>Let <var>effect</var> be a new <code class="idl"><a data-link-type="idl" href="#workletgroupeffect" id="ref-for-workletgroupeffect">WorkletGroupEffect</a></code> with its children set to <var>effects</var>.</p>
       <dt data-md>Otherwise,
       <dd data-md>
        <p>Let <var>effect</var> be undefined.</p>
      </dl>
     <li data-md>
      <p>Let <var>serializedOptions</var> be the result of <a data-link-type="dfn" href="http://w3c.github.io/html/infrastructure.html#structuredserialize" id="ref-for-structuredserialize①">StructuredSerialize</a>(<var>options</var>).
Rethrow any exceptions.</p>
     <li data-md>
      <p>Set the <a data-link-type="dfn" href="#serialized-options" id="ref-for-serialized-options">serialized options</a> of <var>workletAnimation</var> to <var>serializedOptions</var>.</p>
     <li data-md>
      <p>Set the <a data-link-type="dfn" href="#animation-animator-name" id="ref-for-animation-animator-name">animation animator name</a> of <var>workletAnimation</var> to <var>animatorName</var>.</p>
     <li data-md>
      <p>Run the procedure to <a data-link-type="dfn" href="https://drafts.csswg.org/web-animations#set-the-target-effect-of-an-animation" id="ref-for-set-the-target-effect-of-an-animation">set the target effect of an animation</a> on <var>workletAnimation</var> passing <var>effect</var> as the new effect. Note that this may trigger action to <a data-link-type="dfn" href="#set-animator-instance-of-worklet-animation" id="ref-for-set-animator-instance-of-worklet-animation">set animator instance of worklet animation</a>. See <a href="#web-animation-overrides">§ 5.4 Web Animations Overrides</a> for more
details.</p>
    </ol>
   </div>
   <h3 class="heading settled" data-level="5.3" id="timing-and-sync-model"><span class="secno">5.3. </span><span class="content">Worklet Animation Timing and Sync Model</span><a class="self-link" href="#timing-and-sync-model"></a></h3>
   <p>This section describes how <a data-link-type="dfn" href="#worklet-animation" id="ref-for-worklet-animation⑥">worklet animation’s</a> timing model differs from other <a data-link-type="dfn" href="https://drafts.csswg.org/web-animations#concept-animation" id="ref-for-concept-animation③">animations</a>.</p>
   <p>As described in <a href="#worklet-animation-desc">§ 5.1 Worklet Animation</a>, the <a data-link-type="dfn" href="#worklet-animation" id="ref-for-worklet-animation⑦">worklet animation’s</a> <a data-link-type="dfn" href="https://drafts.csswg.org/web-animations#current-time" id="ref-for-current-time③">current time</a> does
not determine its <a data-link-type="dfn" href="https://drafts.csswg.org/web-animations#animation-effect" id="ref-for-animation-effect⑥">animation effect’s</a> <a data-link-type="dfn" href="https://drafts.csswg.org/web-animations#local-time" id="ref-for-local-time⑥">local time</a>. Instead the associated <a data-link-type="dfn" href="#animator-instance" id="ref-for-animator-instance①②">animator instance</a> controls the animation effect’s <a data-link-type="dfn" href="https://drafts.csswg.org/web-animations#local-time" id="ref-for-local-time⑦">local time</a> directly. This means that the
animation effect’s local time is controlled from a <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/worklets.html#workletglobalscope" id="ref-for-workletglobalscope②">WorkletGlobalScope</a></code> which may be in a parallel
execution context.</p>
   <p>Here are a few implications of the above semantics:</p>
   <ul>
    <li data-md>
     <p>Setting the <a data-link-type="dfn" href="https://drafts.csswg.org/web-animations#current-time" id="ref-for-current-time④">current time</a> or <a data-link-type="dfn" href="https://drafts.csswg.org/css-transitions-1/#transition-start-time" id="ref-for-transition-start-time">start time</a> of a <a data-link-type="dfn" href="#worklet-animation" id="ref-for-worklet-animation⑧">worklet animation</a> does not
necessarily change its output, but may change the animation <a data-link-type="dfn" href="https://drafts.csswg.org/web-animations#play-state" id="ref-for-play-state①">play state</a>.</p>
    <li data-md>
     <p>Similarly, invoking <code class="idl"><a data-link-type="idl" href="https://drafts.csswg.org/web-animations-1/#dom-animation-finish" id="ref-for-dom-animation-finish">finish()</a></code> or updating a <a data-link-type="dfn" href="#worklet-animation" id="ref-for-worklet-animation⑨">worklet animation’s</a> <a data-link-type="dfn" href="https://drafts.csswg.org/web-animations#playback-rate" id="ref-for-playback-rate">playback
rate</a> does not necessarily change its output, but may change the animation <a data-link-type="dfn" href="https://drafts.csswg.org/web-animations#play-state" id="ref-for-play-state②">play state</a></p>
    <li data-md>
     <p>Querying the animation effect’s local time using <code class="idl"><a data-link-type="idl" href="https://drafts.csswg.org/web-animations-2/#dom-animationeffect-getcomputedtiming" id="ref-for-dom-animationeffect-getcomputedtiming">getComputedTiming()</a></code> may return stale information, in the case where the <a data-link-type="dfn" href="#animator-instance" id="ref-for-animator-instance①③">animator instance</a> is running in a
parallel execution context.</p>
   </ul>
   <p>If a Worklet Animation animation is executing in a parallel worklet execution context, the last
known state of its Animator Effects should be periodically synced back to the main javascript
execution context. The synchronization of <a data-link-type="dfn" href="https://drafts.csswg.org/web-animations#effect-value" id="ref-for-effect-value">effect values</a> from the parallel worklet execution
context to the main javascript execution context <em>must</em> occur before <a data-link-type="dfn" href="https://html.spec.whatwg.org/#run-the-animation-frame-callbacks" id="ref-for-run-the-animation-frame-callbacks">running the animation frame callbacks</a> as part of the document lifecycle.</p>
   <p>Note that due to the asynchronous nature of this animation model a script running in the main
javascript execution context may see a stale value when reading a <a data-link-type="dfn" href="https://drafts.csswg.org/web-animations#target-property" id="ref-for-target-property">target property</a> that is
being animated by a Worklet Animation, compared to the value currently being used to produce the
visual frame that is visible to the user. This is similar to the effect of asynchronous scrolling
when reading scroll offsets in the main javascript execution context.</p>
   <div class="algorithm" data-algorithm="sync-local-times">
    <p>To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="sync-local-times-to-document">sync local times to document</dfn> for a given <var>workletGlobalScope</var> the user agent <em>must</em> perform the action that corresponds to the first matching condition from the
following:</p>
    <dl>
     <dt data-md>If the <var>workletGlobalScope</var> is not running in a parallel execution context
     <dd data-md>
      <p>perform the following steps immediately:</p>
     <dt data-md>If the <var>workletGlobalScope</var> is running in a parallel execution context
     <dd data-md>
      <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task" id="ref-for-queue-a-task③">queue a task</a> to run the following steps before <a data-link-type="dfn" href="https://html.spec.whatwg.org/#run-the-animation-frame-callbacks" id="ref-for-run-the-animation-frame-callbacks①">running the animation frame
 callbacks</a> as part of the document lifecycle:</p>
    </dl>
    <ol>
     <li data-md>
      <p>Iterate over all <a data-link-type="dfn" href="#animator-instance" id="ref-for-animator-instance①④">animator instance</a>s in the animation worklet’s global scope <a data-link-type="dfn" href="#animator-instance-set" id="ref-for-animator-instance-set④">animator instance set</a>. For each such <var>animator</var> perform the following steps:</p>
      <ol>
       <li data-md>
        <p>If <var>animator</var>’s <a data-link-type="dfn" href="#sync-requested-flag" id="ref-for-sync-requested-flag③">sync requested flag</a> is <b>false</b> skip the rest of the steps.</p>
       <li data-md>
        <p>Let <var>animatorEffect</var> be <var>animator</var>’s <a data-link-type="dfn" href="#effect" id="ref-for-effect③">effect</a>.</p>
       <li data-md>
        <p>Let <var>effect</var> be <var>animatorEffect</var>’s <a data-link-type="dfn" href="#corresponding-effect" id="ref-for-corresponding-effect①">corresponding effect</a>.</p>
       <li data-md>
        <p>Set <var>effect</var>’s local time to <var>animatorEffect</var>’s local time.</p>
       <li data-md>
        <p>Set <var>animator</var>’s <a data-link-type="dfn" href="#sync-requested-flag" id="ref-for-sync-requested-flag④">sync requested flag</a> to <b>false</b>.</p>
      </ol>
    </ol>
   </div>
   <div class="algorithm" data-algorithm="sync-animation-timings">
    <p>To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="sync-animation-timings-to-worklet">sync animation timings to worklet</dfn> for a given <var>workletAnimation</var> the user agent <em>must</em> perform the following steps:</p>
    <ol>
     <li data-md>
      <p>If <var>workletAnimation</var> does not have a <a data-link-type="dfn" href="#corresponding-animator-instance" id="ref-for-corresponding-animator-instance②">corresponding animator instance</a>, abort the
 following steps.</p>
     <li data-md>
      <p>Let <var>animator</var> be <var>workletAnimation</var>’s <a data-link-type="dfn" href="#corresponding-animator-instance" id="ref-for-corresponding-animator-instance③">corresponding animator instance</a>.</p>
     <li data-md>
      <p>Let <var>workletGlobalScope</var> be the <code class="idl"><a data-link-type="idl" href="#animationworkletglobalscope" id="ref-for-animationworkletglobalscope①③">AnimationWorkletGlobalScope</a></code> associated with <var>workletAnimation</var>.</p>
     <li data-md>
      <dl>
       <dt data-md>If the <var>workletGlobalScope</var> is not running in a parallel execution context
       <dd data-md>
        <p>perform the following steps immediately.</p>
       <dt data-md>If the <var>workletGlobalScope</var> is running in a parallel execution context
       <dd data-md>
        <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task" id="ref-for-queue-a-task④">queue a task</a> to run the following steps:</p>
        <ol>
         <li data-md>
          <p>Set <var>animator</var>’s <a data-link-type="dfn" href="#animator-current-time" id="ref-for-animator-current-time②">animator current time</a> to <var>workletAnimation</var>’s <a data-link-type="dfn" href="https://drafts.csswg.org/web-animations#current-time" id="ref-for-current-time⑤">current time</a></p>
         <li data-md>
          <p>Let <var>animatorEffect</var> be <var>animator</var>’s <a data-link-type="dfn" href="#effect" id="ref-for-effect④">effect</a>.</p>
         <li data-md>
          <p>Let <var>effect</var> be <var>animatorEffect</var>’s <a data-link-type="dfn" href="#corresponding-effect" id="ref-for-corresponding-effect②">corresponding effect</a>.</p>
         <li data-md>
          <p>Set the following properties on <var>animatorEffect</var> to be the same as <var>effect</var>:</p>
          <ul>
           <li data-md>
            <p><a data-link-type="dfn" href="https://drafts.csswg.org/web-animations#start-delay" id="ref-for-start-delay①">start delay</a>,</p>
           <li data-md>
            <p><a data-link-type="dfn" href="https://drafts.csswg.org/web-animations#end-delay" id="ref-for-end-delay①">end delay</a>,</p>
           <li data-md>
            <p><a data-link-type="dfn" href="https://drafts.csswg.org/web-animations#fill-mode" id="ref-for-fill-mode①">fill mode</a>,</p>
           <li data-md>
            <p><a data-link-type="dfn" href="https://drafts.csswg.org/web-animations#iteration-start" id="ref-for-iteration-start①">iteration start</a>,</p>
           <li data-md>
            <p><a data-link-type="dfn" href="https://drafts.csswg.org/web-animations#iteration-count" id="ref-for-iteration-count①">iteration count</a>,</p>
           <li data-md>
            <p><a data-link-type="dfn" href="https://drafts.csswg.org/web-animations#iteration-duration" id="ref-for-iteration-duration①">iteration duration</a>,</p>
           <li data-md>
            <p><a data-link-type="dfn" href="https://drafts.csswg.org/web-animations#playback-direction" id="ref-for-playback-direction①">playback direction</a>, and</p>
           <li data-md>
            <p><a data-link-type="dfn" href="https://drafts.csswg.org/web-animations#timing-function" id="ref-for-timing-function①">timing function</a>.</p>
          </ul>
        </ol>
      </dl>
    </ol>
   </div>
   <p class="note" role="note"><span class="marker">Note:</span> Notice that the local time is <b>not</b> synced from the document to animation worklet.</p>
   <p class="issue" id="issue-61e3a71a"><a class="self-link" href="#issue-61e3a71a"></a> Come with appropriate mechanism’s for <a data-link-type="dfn" href="#animator-instance" id="ref-for-animator-instance①⑤">animator instance</a> to get notified when its
   animation currentTime is changing e.g., via reverse(), finish() or playbackRate change. So that
   it can react appropriately. <a href="https://github.com/w3c/css-houdini-drafts/issues/811">[Issue #811]</a></p>
   <h3 class="heading settled" data-level="5.4" id="web-animation-overrides"><span class="secno">5.4. </span><span class="content">Web Animations Overrides</span><a class="self-link" href="#web-animation-overrides"></a></h3>
   <p>In addition to the existing conditions on when the <a data-link-type="dfn" href="https://drafts.csswg.org/web-animations#concept-animation" id="ref-for-concept-animation④">animation</a> is considered <a data-link-type="dfn" href="https://drafts.csswg.org/web-animations#ready" id="ref-for-ready">ready</a>, a <a data-link-type="dfn" href="#worklet-animation" id="ref-for-worklet-animation①⓪">worklet animation</a> is only considered <a data-link-type="dfn" href="https://drafts.csswg.org/web-animations#ready" id="ref-for-ready①">ready</a> when the following condition is also true:</p>
   <ul>
    <li data-md>
     <p>the user agent has completed any setup required to create the <a data-link-type="dfn" href="#worklet-animation" id="ref-for-worklet-animation①①">worklet animation’s</a> <a data-link-type="dfn" href="#corresponding-animator-instance" id="ref-for-corresponding-animator-instance④">corresponding animator instance</a>.</p>
   </ul>
   <p>When a given worklet animation’s <a data-link-type="dfn" href="https://drafts.csswg.org/web-animations#play-state" id="ref-for-play-state③">play state</a> changes from <a data-link-type="dfn" href="https://drafts.csswg.org/web-animations#idle" id="ref-for-idle">idle</a> to <a data-link-type="dfn" href="https://drafts.csswg.org/web-animations#finished" id="ref-for-finished">finished</a>, <a data-link-type="dfn" href="https://drafts.csswg.org/web-animations#running" id="ref-for-running">running</a>, or <a data-link-type="dfn" href="https://drafts.csswg.org/web-animations#paused" id="ref-for-paused">paused</a>, run the procedure to <a data-link-type="dfn" href="#associate-animator-instance-of-worklet-animation" id="ref-for-associate-animator-instance-of-worklet-animation">associate animator instance of worklet animation</a> given the worket animation as <var>workletAnimation</var>.</p>
   <p>When a given worklet animation’s <a data-link-type="dfn" href="https://drafts.csswg.org/web-animations#play-state" id="ref-for-play-state④">play state</a> changes from <a data-link-type="dfn" href="https://drafts.csswg.org/web-animations#finished" id="ref-for-finished①">finished</a>, <a data-link-type="dfn" href="https://drafts.csswg.org/web-animations#running" id="ref-for-running①">running</a> or <a data-link-type="dfn" href="https://drafts.csswg.org/web-animations#paused" id="ref-for-paused①">paused</a> to <a data-link-type="dfn" href="https://drafts.csswg.org/web-animations#idle" id="ref-for-idle①">idle</a>, run the procedure to <a data-link-type="dfn" href="#disassociate-animator-instance-of-worklet-animation" id="ref-for-disassociate-animator-instance-of-worklet-animation">disassociate animator instance of worklet animation</a>given the worklet animation as <var>workletAnimation</var>.</p>
   <p>When a given worklet animation’s <a data-link-type="dfn" href="https://drafts.csswg.org/web-animations#replace-state" id="ref-for-replace-state">replace state</a> changes from <a data-link-type="dfn" href="https://drafts.csswg.org/web-animations#active" id="ref-for-active">active</a> to either <a data-link-type="dfn" href="https://drafts.csswg.org/web-animations#persisted" id="ref-for-persisted">persisted</a> or <a data-link-type="dfn" href="https://drafts.csswg.org/web-animations#removed" id="ref-for-removed">removed</a> run the procedure to
[=disassociate animator instance of worklet animation]= given the worklet animation as <var>workletAnimation</var>.</p>
   <p class="issue" id="issue-e070ee55"><a class="self-link" href="#issue-e070ee55"></a> In web-animation play state is updated before the actual change in particular some operations
such as play() are asynchronous. We should really invoke these Animator related operation after the
appropriate animation operation is complete instead of when play state has changed. This will
require either finding (or introducing) q new hook in web animation or having override for each such
async operation.</p>
   <p>When the procedure to <a data-link-type="dfn" href="https://drafts.csswg.org/web-animations#set-the-target-effect-of-an-animation" id="ref-for-set-the-target-effect-of-an-animation①">set the target effect of an animation</a> for a given worklet animation
is called, then <a data-link-type="dfn" href="#set-animator-instance-of-worklet-animation" id="ref-for-set-animator-instance-of-worklet-animation①">set animator instance of worklet animation</a> given the worklet animation as <var>workletAnimation</var>.</p>
   <p>When the procedure to <a data-link-type="dfn" href="https://drafts.csswg.org/web-animations#set-the-timeline-of-an-animation" id="ref-for-set-the-timeline-of-an-animation①">set the timeline of an animation</a> for a given <var>workletAnimation</var> is called, then <a data-link-type="dfn" href="#set-animator-instance-of-worklet-animation" id="ref-for-set-animator-instance-of-worklet-animation②">set animator instance of worklet animation</a> given the worklet animation as <var>workletAnimation</var>.</p>
   <p>When the procedure to <a data-link-type="dfn" href="https://drafts.csswg.org/web-animations#set-the-current-time" id="ref-for-set-the-current-time">set the current time</a> or <a data-link-type="dfn" href="https://drafts.csswg.org/web-animations#set-the-start-time" id="ref-for-set-the-start-time">set the start time</a> for a given worklet
animation is called, then <a data-link-type="dfn" href="#sync-animation-timings-to-worklet" id="ref-for-sync-animation-timings-to-worklet">sync animation timings to worklet</a> given the worklet animation as <var>workletAnimation</var>.</p>
   <p>When the procedure to <a data-link-type="dfn" href="https://drafts.csswg.org/web-animations#update-the-timing-properties-of-an-animation-effect" id="ref-for-update-the-timing-properties-of-an-animation-effect">update the timing properties of an animation effect</a> for a given effect is
called and that effect is owned be a worklet animation, then <a data-link-type="dfn" href="#sync-animation-timings-to-worklet" id="ref-for-sync-animation-timings-to-worklet①">sync animation timings to worklet</a> given that worklet animation as <var>workletAnimation</var>.</p>
   <div class="algorithm" data-algorithm="associate-animator-instance">
    <p>To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="associate-animator-instance-of-worklet-animation">associate animator instance of worklet animation</dfn> given <var>workletAnimation</var>,
the user agent <em>must</em> run the following steps:</p>
    <ol>
     <li data-md>
      <p>If <var>workletAnimation</var> has a <a data-link-type="dfn" href="#corresponding-animator-instance" id="ref-for-corresponding-animator-instance⑤">corresponding animator instance</a>, abort the following steps.</p>
     <li data-md>
      <p>Let <var>workletGlobalScope</var> be the <code class="idl"><a data-link-type="idl" href="#animationworkletglobalscope" id="ref-for-animationworkletglobalscope①④">AnimationWorkletGlobalScope</a></code> associated with <var>workletAnimation</var>.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task" id="ref-for-queue-a-task⑤">Queue a task</a> on <var>workletGlobalScope</var> to run the procedure to <a data-link-type="dfn" href="#create-a-new-animator-instance" id="ref-for-create-a-new-animator-instance①">create a new animator
   instance</a>, passing:</p>
      <ul>
       <li data-md>
        <p>The <var>workletAnimation</var>’s <a data-link-type="dfn" href="#animation-animator-name" id="ref-for-animation-animator-name①">animation animator name</a> as name.</p>
       <li data-md>
        <p>The <var>workletAnimation</var>’s <a data-link-type="dfn" href="https://drafts.csswg.org/web-animations#timeline" id="ref-for-timeline④">timeline</a> as timeline.</p>
       <li data-md>
        <p>The <var>workletAnimation</var>’s <a data-link-type="dfn" href="https://drafts.csswg.org/web-animations#animation-effect" id="ref-for-animation-effect⑦">animation effect</a> as effect.</p>
       <li data-md>
        <p>The <var>workletAnimation</var>’s <a data-link-type="dfn" href="#serialized-options" id="ref-for-serialized-options①">serialized options</a> as options.</p>
       <li data-md>
        <p>The <var>workletGlobalScope</var> as workletGlobalScope.</p>
      </ul>
     <li data-md>
      <p>If the procedure was successful, set the resulting <a data-link-type="dfn" href="#animator-instance" id="ref-for-animator-instance①⑥">animator instance</a> to be the <a data-link-type="dfn" href="#corresponding-animator-instance" id="ref-for-corresponding-animator-instance⑥">corresponding animator instance</a> of <var>workletAnimation</var>.</p>
    </ol>
   </div>
   <div class="algorithm" data-algorithm="disassociate-animator-instance">
    <p>To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="disassociate-animator-instance-of-worklet-animation">disassociate animator instance of worklet animation</dfn> given <var>workletAnimation</var>, the user age <em>must</em> run the following steps:</p>
    <ol>
     <li data-md>
      <p>If <var>workletAnimation</var> does not have a <a data-link-type="dfn" href="#corresponding-animator-instance" id="ref-for-corresponding-animator-instance⑦">corresponding animator instance</a>, abort the
following steps.</p>
     <li data-md>
      <p>Let <var>workletGlobalScope</var> be the <code class="idl"><a data-link-type="idl" href="#animationworkletglobalscope" id="ref-for-animationworkletglobalscope①⑤">AnimationWorkletGlobalScope</a></code> associated with <var>workletAnimation</var>.</p>
     <li data-md>
      <p>Let <var>animatorInstance</var> be <var>workletAnimation</var>’s <a data-link-type="dfn" href="#corresponding-animator-instance" id="ref-for-corresponding-animator-instance⑧">corresponding animator instance</a>.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task" id="ref-for-queue-a-task⑥">Queue a task</a> on the <var>workletGlobalScope</var> to run the procedure to <a data-link-type="dfn" href="#remove-an-animator-instance" id="ref-for-remove-an-animator-instance①">remove an animator
 instance</a>, passing <var>animatorInstance</var> as instance and <var>workletGlobalScope</var> as
 workletGlobalScope.</p>
     <li data-md>
      <p>Set <var>workletAnimation</var>’s <a data-link-type="dfn" href="#corresponding-animator-instance" id="ref-for-corresponding-animator-instance⑨">corresponding animator instance</a> as undefined.</p>
    </ol>
   </div>
   <div class="algorithm" data-algorithm="set-animator-instance">
    <p>To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="set-animator-instance-of-worklet-animation">set animator instance of worklet animation</dfn> given <var>workletAnimation</var>, the user agent <em>must</em> run the following steps:</p>
    <ol>
     <li data-md>
      <p><a data-link-type="dfn" href="#disassociate-animator-instance-of-worklet-animation" id="ref-for-disassociate-animator-instance-of-worklet-animation①">disassociate animator instance of worklet animation</a> given <var>workletAnimation</var>.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="#associate-animator-instance-of-worklet-animation" id="ref-for-associate-animator-instance-of-worklet-animation①">associate animator instance of worklet animation</a> given <var>workletAnimation</var>.</p>
    </ol>
   </div>
   <h3 class="heading settled" data-level="5.5" id="effect-stack-composite-order"><span class="secno">5.5. </span><span class="content">Effect Stack and Composite Order</span><a class="self-link" href="#effect-stack-composite-order"></a></h3>
   <p>As with other animations, <a data-link-type="dfn" href="#worklet-animation" id="ref-for-worklet-animation①②">worklet animations</a> participate in the <a data-link-type="dfn" href="https://drafts.csswg.org/web-animations#effect-stack" id="ref-for-effect-stack">effect stack</a>.  A worklet
animation does not have a specific <a data-link-type="dfn" href="https://drafts.csswg.org/web-animations#animation-class" id="ref-for-animation-class">animation class</a> which means it has the same composite order
as other Javascript created web animations.</p>
   <h2 class="heading settled" data-level="6" id="related-concepts"><span class="secno">6. </span><span class="content">Additional Related Concepts</span><a class="self-link" href="#related-concepts"></a></h2>
   <h3 class="heading settled" data-level="6.1" id="worklet-group-effect"><span class="secno">6.1. </span><span class="content">Worklet Group Effect</span><a class="self-link" href="#worklet-group-effect"></a></h3>
    <em>This section is not normative.</em> 
   <p><a data-link-type="dfn" href="https://w3c.github.io/web-animations/level-2/#group-effect" id="ref-for-group-effect">Group effect</a> is a type of <a data-link-type="dfn" href="https://drafts.csswg.org/web-animations#animation-effect" id="ref-for-animation-effect⑧">animation effect</a> that enbales multiple child animation
effects to be animated together as a group.</p>
   <p><code class="idl"><a data-link-type="idl" href="#workletgroupeffect" id="ref-for-workletgroupeffect①">WorkletGroupEffect</a></code> is a type of <a data-link-type="dfn" href="https://w3c.github.io/web-animations/level-2/#group-effect" id="ref-for-group-effect①">group effect</a> that allows its <a data-link-type="dfn" href="https://w3c.github.io/web-animations/level-2/#child-effect" id="ref-for-child-effect">child effect’s</a> <a data-link-type="dfn" href="https://drafts.csswg.org/web-animations#local-time" id="ref-for-local-time⑧">local times</a> to be mutated individually.</p>
   <p>When a <code class="idl"><a data-link-type="idl" href="#workletgroupeffect" id="ref-for-workletgroupeffect②">WorkletGroupEffect</a></code> is set as the <a data-link-type="dfn" href="https://drafts.csswg.org/web-animations#animation-effect" id="ref-for-animation-effect⑨">animation effect</a> of a <a data-link-type="dfn" href="#worklet-animation" id="ref-for-worklet-animation①③">worklet animation</a>,
its <a data-link-type="dfn" href="#corresponding-animator-instance" id="ref-for-corresponding-animator-instance①⓪">corresponding animator instance</a> can directly control the <a data-link-type="dfn" href="https://w3c.github.io/web-animations/level-2/#child-effect" id="ref-for-child-effect①">child effects</a>' <a data-link-type="dfn" href="https://drafts.csswg.org/web-animations#local-time" id="ref-for-local-time⑨">local
times</a>. This allows a single worklet animation to coordinate multiple effects - see <a href="#example-2">§ 9.2 Example 2: Twitter header.</a> for an example of such a use-case.</p>
<pre class="idl highlight def">[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed" id="ref-for-Exposed④"><c- g>Exposed</c-></a>=<c- n>AnimationWorklet</c->]
<c- b>interface</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="interface" data-export id="workletgroupeffect"><code><c- g>WorkletGroupEffect</c-></code></dfn> {
  <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#idl-sequence" id="ref-for-idl-sequence①"><c- b>sequence</c-></a>&lt;<a data-link-type="idl-name" href="#workletanimationeffect" id="ref-for-workletanimationeffect③"><c- n>WorkletAnimationEffect</c-></a>> <dfn class="dfn-paneled idl-code" data-dfn-for="WorkletGroupEffect" data-dfn-type="method" data-export data-lt="getChildren()" id="dom-workletgroupeffect-getchildren"><code><c- g>getChildren</c-></code></dfn>();
};
</pre>
   <p class="issue" id="issue-9ff2b6cb"><a class="self-link" href="#issue-9ff2b6cb"></a> The above interface exposes a conservative subset of GroupEffect
proposed as part of web-animation-2. We should instead move this into a delta spec against the
web-animation. <a href="https://github.com/w3c/csswg-drafts/issues/2071">[Issue #w3c/csswg-drafts#2071]</a></p>
   <p class="note" role="note"><span class="marker">Note:</span> Group Effect is currently an experimental feature and not well specified in web animations. So
the concept of <code class="idl"><a data-link-type="idl" href="#workletgroupeffect" id="ref-for-workletgroupeffect③">WorkletGroupEffect</a></code> may change dramatically as <a data-link-type="dfn" href="https://w3c.github.io/web-animations/level-2/#group-effect" id="ref-for-group-effect②">Group Effect</a> get specified.
See https://github.com/yi-gu/group_effect/blob/master/README.md for more details.</p>
   <h3 class="heading settled" data-level="6.2" id="scroll-timeline"><span class="secno">6.2. </span><span class="content">ScrollTimeline</span><a class="self-link" href="#scroll-timeline"></a></h3>
    <em>This section is not normative.</em> 
   <p><code class="idl"><a data-link-type="idl" href="https://wicg.github.io/scroll-animations/#scrolltimeline" id="ref-for-scrolltimeline">ScrollTimeline</a></code> is a new concept being proposed for addition to web animation API. It defines
an animation timeline whose time value depends on the scroll position of a scroll container. <a data-link-type="dfn" href="#worklet-animation" id="ref-for-worklet-animation①④">Worklet animations</a> can have a scroll timeline and thus drive their scripted effects based
on a scroll offset.</p>
   <p class="note" role="note"><span class="marker">Note:</span> <strong>Access to input</strong>: We are interested on exposing additional user input beside
scrolling (e.g., touch/pointer input) to these animations so that authors can create jank-free
input driven animations which are not really possible today. We are still trying to figure out the
right abstractions and mechanisms to do this.</p>
   <h2 class="heading settled" data-level="7" id="security-considerations"><span class="secno">7. </span><span class="content">Security Considerations</span><a class="self-link" href="#security-considerations"></a></h2>
   <p>There are no known security issues introduced by these features.</p>
   <h2 class="heading settled" data-level="8" id="privacy-considerations"><span class="secno">8. </span><span class="content">Privacy Considerations</span><a class="self-link" href="#privacy-considerations"></a></h2>
   <p>There are no known privacy issues introduced by these features.</p>
   <h2 class="heading settled" data-level="9" id="examples"><span class="secno">9. </span><span class="content">Examples</span><a class="self-link" href="#examples"></a></h2>
   <h3 class="heading settled" data-level="9.1" id="example-1"><span class="secno">9.1. </span><span class="content">Example 1: Spring timing.</span><a class="self-link" href="#example-1"></a></h3>
    Here we use Animation Worklet to create animation with a custom spring timing. 
<pre class="lang-markup highlight">
<c- p>&lt;</c-><c- f>div</c-> <c- e>id</c-><c- o>=</c-><c- s>'target'</c-><c- p>>&lt;/</c-><c- f>div</c-><c- p>></c->

<c- p>&lt;</c-><c- f>script</c-><c- p>></c->
<c- k>await</c-> CSS<c- p>.</c->animationWorklet<c- p>.</c->addModule<c- p>(</c-><c- t>'spring-animator.js'</c-><c- p>);</c->
targetEl <c- o>=</c-> document<c- p>.</c->getElementById<c- p>(</c-><c- t>'target'</c-><c- p>);</c->

<c- a>const</c-> effect <c- o>=</c-> <c- ow>new</c-> KeyframeEffect<c- p>(</c->
  targetEl<c- p>,</c->
  <c- p>{</c->transform<c- o>:</c-> <c- p>[</c-><c- t>'translateX(0)'</c-><c- p>,</c-> <c- t>'translateX(50vw)'</c-><c- p>]},</c->
  <c- p>{</c->duration<c- o>:</c-> <c- mf>1000</c-><c- p>}</c->
<c- p>);</c->
<c- a>const</c-> animation <c- o>=</c-> <c- ow>new</c-> WorkletAnimation<c- p>(</c-><c- t>'spring'</c-><c- p>,</c-> effect<c- p>,</c-> document<c- p>.</c->timeline<c- p>,</c-> <c- p>{</c->k<c- o>:</c-> <c- mf>2</c-><c- p>,</c-> ratio<c- o>:</c-> <c- mf>0.7</c-><c- p>});</c->
animation<c- p>.</c->play<c- p>();</c->
<c- p>&lt;/</c-><c- f>script</c-><c- p>></c->

</pre>
<pre class="lang-javascript highlight">registerAnimator<c- p>(</c-><c- t>'spring'</c-><c- p>,</c-> <c- a>class</c-> SpringAnimator <c- p>{</c->
  <c- kr>constructor</c-><c- p>(</c->options <c- o>=</c-> <c- p>{</c->k<c- o>:</c-> <c- mf>1</c-><c- p>,</c-> ratio<c- o>:</c-> <c- mf>0.5</c-><c- p>})</c-> <c- p>{</c->
    <c- k>this</c-><c- p>.</c->timing <c- o>=</c-> createSpring<c- p>(</c->options<c- p>.</c->k<c- p>,</c-> options<c- p>.</c->ratio<c- p>);</c->
  <c- p>}</c->

  animate<c- p>(</c->currentTime<c- p>,</c-> effect<c- p>)</c-> <c- p>{</c->
    <c- a>let</c-> delta <c- o>=</c-> <c- k>this</c-><c- p>.</c->timing<c- p>(</c->currentTime<c- p>);</c->
    <c- c1>// scale this by target duration</c->
    delta <c- o>=</c-> delta <c- o>*</c-> <c- p>(</c->effect<c- p>.</c->getTimings<c- p>().</c->duration <c- o>/</c-> <c- mf>2</c-><c- p>);</c->
    effect<c- p>.</c->localTime <c- o>=</c-> delta<c- p>;</c->
    <c- c1>// TODO: Provide a method for animate to mark animation as finished once</c->
    <c- c1>// spring simulation is complete, e.g., this.finish()</c->
    <c- c1>// See issue https://github.com/w3c/css-houdini-drafts/issues/808</c->
  <c- p>}</c->
<c- p>});</c->

<c- a>function</c-> createSpring<c- p>(</c->springConstant<c- p>,</c-> ratio<c- p>)</c-> <c- p>{</c->
  <c- c1>// Normalize mass and distance to 1 and assume a reasonable init velocit</c->
  <c- c1>// but these can also become options to this animator.</c->
  <c- a>const</c-> velocity <c- o>=</c-> <c- mf>0.2</c-><c- p>;</c->
  <c- a>const</c-> mass <c- o>=</c-> <c- mf>1</c-><c- p>;</c->
  <c- a>const</c-> distance <c- o>=</c-> <c- mf>1</c-><c- p>;</c->

  <c- c1>// Keep ratio &lt; 1 to ensure it is under-damped.</c->
  ratio <c- o>=</c-> Math<c- p>.</c->min<c- p>(</c->ratio<c- p>,</c-> <c- mf>1</c-> <c- o>-</c-> <c- mf>1e-5</c-><c- p>);</c->

  <c- a>const</c-> damping <c- o>=</c-> ratio <c- o>*</c-> <c- mf>2.0</c-> <c- o>*</c-> Math<c- p>.</c->sqrt<c- p>(</c->springConstant<c- p>);</c->
  <c- a>const</c-> w <c- o>=</c-> Math<c- p>.</c->sqrt<c- p>(</c-><c- mf>4.0</c-> <c- o>*</c-> springConstant <c- o>-</c-> damping <c- o>*</c-> damping<c- p>)</c-> <c- o>/</c-> <c- p>(</c-><c- mf>2.0</c-> <c- o>*</c-> mass<c- p>);</c->
  <c- a>const</c-> r <c- o>=</c-> <c- o>-</c-><c- p>(</c->damping <c- o>/</c-> <c- mf>2.0</c-><c- p>);</c->
  <c- a>const</c-> c1 <c- o>=</c-> distance<c- p>;</c->
  <c- a>const</c-> c2 <c- o>=</c-> <c- p>(</c->velocity <c- o>-</c-> r <c- o>*</c-> distance<c- p>)</c-> <c- o>/</c-> w<c- p>;</c->

  <c- c1>// return a value in [0..distance]</c->
  <c- k>return</c-> <c- a>function</c-> springTiming<c- p>(</c->timeMs<c- p>)</c-> <c- p>{</c->
    <c- a>const</c-> time <c- o>=</c-> timeMs <c- o>/</c-> <c- mf>1000</c-><c- p>;</c-> <c- c1>// in seconds</c->
    <c- a>const</c-> result <c- o>=</c-> Math<c- p>.</c->pow<c- p>(</c->Math<c- p>.</c->E<c- p>,</c-> r <c- o>*</c-> time<c- p>)</c-> <c- o>*</c->
                  <c- p>(</c->c1 <c- o>*</c-> Math<c- p>.</c->cos<c- p>(</c->w <c- o>*</c-> time<c- p>)</c-> <c- o>+</c-> c2 <c- o>*</c-> Math<c- p>.</c->sin<c- p>(</c->w <c- o>*</c-> time<c- p>));</c->
    <c- k>return</c-> distance <c- o>-</c-> result<c- p>;</c->
  <c- p>}</c->
<c- p>}</c->
</pre>
   <h3 class="heading settled" data-level="9.2" id="example-2"><span class="secno">9.2. </span><span class="content">Example 2: Twitter header.</span><a class="self-link" href="#example-2"></a></h3>
    An example of twitter profile header effect where two elements (avatar, and header) are updated in
sync with scroll offset with an additional feature where avatar can have additional physic based
movement based on the velocity and acceleration of the scrolling. 
<pre class="lang-markup highlight"><c- p>&lt;</c-><c- f>div</c-> <c- e>id</c-><c- o>=</c-><c- s>'scrollingContainer'</c-><c- p>></c->
  <c- p>&lt;</c-><c- f>div</c-> <c- e>id</c-><c- o>=</c-><c- s>'header'</c-> <c- e>style</c-><c- o>=</c-><c- s>'height: 150px'</c-><c- p>>&lt;/</c-><c- f>div</c-><c- p>></c->
  <c- p>&lt;</c-><c- f>div</c-> <c- e>id</c-><c- o>=</c-><c- s>'avatar'</c-><c- p>>&lt;</c-><c- f>img</c-><c- p>>&lt;/</c-><c- f>div</c-><c- p>></c->
<c- p>&lt;/</c-><c- f>div</c-><c- p>></c->

// In document scope.
<c- p>&lt;</c-><c- f>script</c-><c- p>></c->
<c- a>const</c-> headerEl <c- o>=</c-> document<c- p>.</c->getElementById<c- p>(</c-><c- t>'header'</c-><c- p>);</c->
<c- a>const</c-> avatarEl <c- o>=</c-> document<c- p>.</c->getElementById<c- p>(</c-><c- t>'avatar'</c-><c- p>);</c->
<c- a>const</c-> scrollingContainerEl <c- o>=</c-> document<c- p>.</c->getElementById<c- p>(</c-><c- t>'scrollingContainer'</c-><c- p>);</c->


<c- a>const</c-> scrollTimeline  <c- o>=</c-> <c- ow>new</c-> ScrollTimeline<c- p>({</c->
  scrollSource<c- o>:</c-> scrollingContainerEl<c- p>,</c->
  orientation<c- o>:</c-> <c- t>'block'</c-><c- p>,</c->
  timeRange<c- o>:</c-> <c- mf>1000</c-><c- p>,</c->
  startScrollOffset<c- o>:</c-> <c- mf>0</c-><c- p>,</c->
  endScrollOffset<c- o>:</c-> headerEl<c- p>.</c->clientHeight
<c- p>});</c->

<c- a>const</c-> effects <c- o>=</c-> <c- p>[</c->
    <c- d>/* avatar scales down as we scroll up */</c->
    <c- ow>new</c-> KeyframeEffect<c- p>(</c->avatarEl<c- p>,</c->
                    <c- p>{</c->transform<c- o>:</c-> <c- p>[</c-><c- t>'scale(1)'</c-><c- p>,</c-> <c- t>'scale(0.5)'</c-><c- p>]},</c->
                    <c- p>{</c->duration<c- o>:</c-> scrollTimeline<c- p>.</c->timeRange<c- p>}),</c->
    <c- d>/* header loses transparency as we scroll up */</c->
    <c- ow>new</c-> KeyframeEffect<c- p>(</c->headerEl<c- p>,</c->
                    <c- p>{</c->opacity<c- o>:</c-> <c- p>[</c-><c- mf>0</c-><c- p>,</c-> <c- mf>0.8</c-><c- p>]},</c->
                    <c- p>{</c->duration<c- o>:</c-> scrollTimeline<c- p>.</c->timeRange<c- p>})</c->
<c- p>];</c->

<c- k>await</c-> CSS<c- p>.</c->animationWorklet<c- p>.</c->addModule<c- p>(</c-><c- t>'twitter-header-animator.js'</c-><c- p>);</c->
<c- a>const</c-> animation <c- o>=</c-> <c- ow>new</c-> WorkletAnimation<c- p>(</c-><c- t>'twitter-header'</c-><c- p>,</c-> effects<c- p>,</c-> scrollTimeline<c- p>);</c->

animation<c- p>.</c->play<c- p>();</c->
<c- p>&lt;/</c-><c- f>script</c-><c- p>></c->

</pre>
<pre class="lang-javascript highlight"><c- c1>// Inside AnimationWorkletGlobalScope.</c->
registerAnimator<c- p>(</c-><c- t>'twitter-header'</c-><c- p>,</c-> <c- a>class</c-> HeaderAnimator <c- p>{</c->
  <c- kr>constructor</c-><c- p>(</c->options<c- p>,</c-> state <c- o>=</c-> <c- p>{</c->velocity<c- o>:</c-> <c- mf>0</c-><c- p>,</c-> acceleration<c- o>:</c-> <c- mf>0</c-><c- p>})</c-> <c- p>{</c->
    <c- c1>// `state` is either undefined (first time) or it is the previous state (after an animator</c->
    <c- c1>// is migrated between global scopes).</c->
    <c- k>this</c-><c- p>.</c->velocity <c- o>=</c-> state<c- p>.</c->velocity<c- p>;</c->
    <c- k>this</c-><c- p>.</c->acceleration <c- o>=</c-> state<c- p>.</c->acceleration<c- p>;</c->
  <c- p>}</c->


  animate<c- p>(</c->currentTime<c- p>,</c-> effect<c- p>)</c-> <c- p>{</c->
    <c- a>const</c-> scroll <c- o>=</c-> currentTime<c- p>;</c->  <c- c1>// scroll is in [0, 1000] range</c->

    <c- k>if</c-> <c- p>(</c-><c- k>this</c-><c- p>.</c->prevScroll<c- p>)</c-> <c- p>{</c->
      <c- k>this</c-><c- p>.</c->velocity <c- o>=</c-> scroll <c- o>-</c-> <c- k>this</c-><c- p>.</c->prevScroll<c- p>;</c->
      <c- k>this</c-><c- p>.</c->acceleration <c- o>=</c-> <c- k>this</c-><c- p>.</c->velocity <c- o>-</c-> <c- k>this</c-><c- p>.</c->prevVelocity<c- p>;</c->
    <c- p>}</c->
    <c- k>this</c-><c- p>.</c->prevScroll <c- o>=</c-> scroll<c- p>;</c->
    <c- k>this</c-><c- p>.</c->prevVelocity <c- o>=</c-> velocity<c- p>;</c->


    <c- c1>// Drive the output group effect by setting its children local times individually.</c->
    effect<c- p>.</c->children<c- p>[</c-><c- mf>0</c-><c- p>].</c->localTime <c- o>=</c-> scroll<c- p>;</c->

    effect<c- p>.</c->children<c- p>[</c-><c- mf>1</c-><c- p>].</c->localTime <c- o>=</c-> curve<c- p>(</c->velocity<c- p>,</c-> acceleration<c- p>,</c-> scroll<c- p>);</c->
  <c- p>}</c->

  state<c- p>()</c-> <c- p>{</c->
    <c- c1>// Invoked before any migration attempts. The returned object must be structure clonable</c->
    <c- c1>// and will be passed to constructor to help animator restore its state after migration to the</c->
    <c- c1>// new scope.</c->
    <c- k>return</c-> <c- p>{</c->
      <c- k>this</c-><c- p>.</c->velocity<c- p>,</c->
      <c- k>this</c-><c- p>.</c->acceleration
    <c- p>}</c->
  <c- p>}</c->

<c- p>});</c->

curve<c- p>(</c->scroll<c- p>,</c-> velocity<c- p>,</c-> acceleration<c- p>)</c-> <c- p>{</c->

 <c- k>return</c-> <c- d>/* compute an return a physical movement curve based on scroll position, and per frame</c->
<c- d>           velocity and acceleration. */</c-> <c- p>;</c->
<c- p>}</c->

</pre>
   <h3 class="heading settled" data-level="9.3" id="example-3"><span class="secno">9.3. </span><span class="content">Example 3: Parallax backgrounds.</span><a class="self-link" href="#example-3"></a></h3>
    A simple parallax background example. 
<pre class="lang-markup highlight"><c- p>&lt;</c-><c- f>style</c-><c- p>></c->
<c- p>.</c-><c- nc>parallax</c-> <c- p>{</c->
    <c- k>position</c-><c- p>:</c-> <c- kc>fixed</c-><c- p>;</c->
    <c- k>top</c-><c- p>:</c-> <c- mi>0</c-><c- p>;</c->
    <c- k>left</c-><c- p>:</c-> <c- mi>0</c-><c- p>;</c->
    <c- k>opacity</c-><c- p>:</c-> <c- mf>0.5</c-><c- p>;</c->
<c- p>}</c->
<c- p>&lt;/</c-><c- f>style</c-><c- p>></c->
<c- p>&lt;</c-><c- f>div</c-> <c- e>id</c-><c- o>=</c-><c- s>'scrollingContainer'</c-><c- p>></c->
  <c- p>&lt;</c-><c- f>div</c-> <c- e>id</c-><c- o>=</c-><c- s>"slow"</c-> <c- e>class</c-><c- o>=</c-><c- s>"parallax"</c-><c- p>>&lt;/</c-><c- f>div</c-><c- p>></c->
  <c- p>&lt;</c-><c- f>div</c-> <c- e>id</c-><c- o>=</c-><c- s>"fast"</c-> <c- e>class</c-><c- o>=</c-><c- s>"parallax"</c-><c- p>>&lt;/</c-><c- f>div</c-><c- p>></c->
<c- p>&lt;/</c-><c- f>div</c-><c- p>></c->

<c- p>&lt;</c-><c- f>script</c-><c- p>></c->
<c- k>await</c-> CSS<c- p>.</c->animationWorklet<c- p>.</c->addModule<c- p>(</c-><c- t>'parallax-animator.js'</c-><c- p>);</c->

<c- a>const</c-> parallaxSlowEl <c- o>=</c-> document<c- p>.</c->getElementById<c- p>(</c-><c- t>'slow'</c-><c- p>);</c->
<c- a>const</c-> parallaxFastEl <c- o>=</c-> document<c- p>.</c->getElementById<c- p>(</c-><c- t>'fast'</c-><c- p>);</c->
<c- a>const</c-> scrollingContainerEl <c- o>=</c-> document<c- p>.</c->getElementById<c- p>(</c-><c- t>'scrollingContainer'</c-><c- p>);</c->

<c- a>const</c-> scrollTimeline <c- o>=</c-> <c- ow>new</c-> ScrollTimeline<c- p>({</c->
  scrollSource<c- o>:</c-> scrollingContainerEl<c- p>,</c->
  orientation<c- o>:</c-> <c- t>'block'</c-><c- p>,</c->
  timeRange<c- o>:</c-> <c- mf>1000</c->
<c- p>});</c->
<c- a>const</c-> scrollRange <c- o>=</c-> scrollingContainerEl<c- p>.</c->scrollHeight <c- o>-</c-> scrollingContainerEl<c- p>.</c->clientHeight<c- p>;</c->

<c- a>const</c-> slowParallax <c- o>=</c-> <c- ow>new</c-> WorkletAnimation<c- p>(</c->
    <c- t>'parallax'</c-><c- p>,</c->
    <c- ow>new</c-> KeyframeEffect<c- p>(</c->parallaxSlowEl<c- p>,</c->
        <c- p>{</c-><c- t>'transform'</c-><c- o>:</c-> <c- p>[</c-><c- t>'translateY(0)'</c-><c- p>,</c-> <c- t>'translateY('</c-> <c- o>+</c-> <c- o>-</c->scrollRange <c- o>+</c-> <c- t>'px)'</c-><c- p>]},</c->
        <c- p>{</c->duration<c- o>:</c-> scrollTimeline<c- p>.</c->timeRange<c- p>}),</c->
    scrollTimeline<c- p>,</c->
    <c- p>{</c->rate <c- o>:</c-> <c- mf>0.4</c-><c- p>}</c->
<c- p>);</c->
slowParallax<c- p>.</c->play<c- p>();</c->

<c- a>const</c-> fastParallax <c- o>=</c-> <c- ow>new</c-> WorkletAnimation<c- p>(</c->
    <c- t>'parallax'</c-><c- p>,</c->
    <c- ow>new</c-> KeyframeEffect<c- p>(</c->parallaxFastEl<c- p>,</c->
        <c- p>{</c-><c- t>'transform'</c-><c- o>:</c-> <c- p>[</c-><c- t>'translateY(0)'</c-><c- p>,</c-> <c- t>'translateY('</c-> <c- o>+</c-> <c- o>-</c->scrollRange <c- o>+</c-> <c- t>'px)'</c-><c- p>]},</c->
        <c- p>{</c->duration<c- o>:</c-> scrollTimeline<c- p>.</c->timeRange<c- p>}),</c->
    scrollTimeline<c- p>,</c->
    <c- p>{</c->rate <c- o>:</c-> <c- mf>0.8</c-><c- p>}</c->
<c- p>);</c->
fastParallax<c- p>.</c->play<c- p>();</c->
<c- p>&lt;/</c-><c- f>script</c-><c- p>></c->

</pre>
<pre class="lang-javascript highlight"><c- c1>// Inside AnimationWorkletGlobalScope.</c->
registerAnimator<c- p>(</c-><c- t>'parallax'</c-><c- p>,</c-> <c- a>class</c-> ParallaxAnimator <c- p>{</c->
  <c- kr>constructor</c-><c- p>(</c->options<c- p>)</c-> <c- p>{</c->
    <c- k>this</c-><c- p>.</c->rate_ <c- o>=</c-> options<c- p>.</c->rate<c- p>;</c->
  <c- p>}</c->

  animate<c- p>(</c->currentTime<c- p>,</c-> effect<c- p>)</c-> <c- p>{</c->
    effect<c- p>.</c->localTime <c- o>=</c-> currentTime <c- o>*</c-> <c- k>this</c-><c- p>.</c->rate_<c- p>;</c->
  <c- p>}</c->
<c- p>});</c->
</pre>
  </main>
  <h2 class="no-ref no-num heading settled" id="w3c-conformance"><span class="content"> Conformance</span><a class="self-link" href="#w3c-conformance"></a></h2>
  <h3 class="no-ref heading settled" id="w3c-conventions"><span class="content"> Document conventions</span><a class="self-link" href="#w3c-conventions"></a></h3>
  <p>Conformance requirements are expressed with a combination of
    descriptive assertions and RFC 2119 terminology. The key words “MUST”,
    “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”,
    “RECOMMENDED”, “MAY”, and “OPTIONAL” in the normative parts of this
    document are to be interpreted as described in RFC 2119.
    However, for readability, these words do not appear in all uppercase
    letters in this specification. </p>
  <p>All of the text of this specification is normative except sections
    explicitly marked as non-normative, examples, and notes. <a data-link-type="biblio" href="#biblio-rfc2119" title="Key words for use in RFCs to Indicate Requirement Levels">[RFC2119]</a></p>
  <p>Examples in this specification are introduced with the words “for example”
    or are set apart from the normative text with <code>class="example"</code>,
    like this: </p>
  <div class="example" id="example-ae2b6bc0">
   <a class="self-link" href="#example-ae2b6bc0"></a> 
   <p>This is an example of an informative example.</p>
  </div>
  <p>Informative notes begin with the word “Note” and are set apart from the
    normative text with <code>class="note"</code>, like this: </p>
  <p class="note" role="note">Note, this is an informative note.</p>
  <p>Advisements are normative sections styled to evoke special attention and are
    set apart from other normative text with <code>&lt;strong class="advisement"></code>, like
    this: <strong class="advisement"> UAs MUST provide an accessible alternative. </strong></p>
  <h3 class="no-ref heading settled" id="w3c-conformance-classes"><span class="content"> Conformance classes</span><a class="self-link" href="#w3c-conformance-classes"></a></h3>
  <p>Conformance to this specification
    is defined for three conformance classes: </p>
  <dl>
   <dt>style sheet 
   <dd>A <a href="http://www.w3.org/TR/CSS21/conform.html#style-sheet">CSS
            style sheet</a>. 
   <dt>renderer 
   <dd>A <a href="http://www.w3.org/TR/CSS21/conform.html#user-agent">UA</a> that interprets the semantics of a style sheet and renders
            documents that use them. 
   <dt>authoring tool 
   <dd>A <a href="http://www.w3.org/TR/CSS21/conform.html#user-agent">UA</a> that writes a style sheet. 
  </dl>
  <p>A style sheet is conformant to this specification
    if all of its statements that use syntax defined in this module are valid
    according to the generic CSS grammar and the individual grammars of each
    feature defined in this module. </p>
  <p>A renderer is conformant to this specification
    if, in addition to interpreting the style sheet as defined by the
    appropriate specifications, it supports all the features defined
    by this specification by parsing them correctly
    and rendering the document accordingly. However, the inability of a
    UA to correctly render a document due to limitations of the device
    does not make the UA non-conformant. (For example, a UA is not
    required to render color on a monochrome monitor.) </p>
  <p>An authoring tool is conformant to this specification
    if it writes style sheets that are syntactically correct according to the
    generic CSS grammar and the individual grammars of each feature in
    this module, and meet all other conformance requirements of style sheets
    as described in this module. </p>
  <h3 class="no-ref heading settled" id="w3c-partial"><span class="content"> Partial implementations</span><a class="self-link" href="#w3c-partial"></a></h3>
  <p>So that authors can exploit the forward-compatible parsing rules to
    assign fallback values, CSS renderers <strong>must</strong> treat as invalid (and <a href="http://www.w3.org/TR/CSS21/conform.html#ignore">ignore
    as appropriate</a>) any at-rules, properties, property values, keywords,
    and other syntactic constructs for which they have no usable level of
    support. In particular, user agents <strong>must not</strong> selectively
    ignore unsupported component values and honor supported values in a single
    multi-value property declaration: if any value is considered invalid
    (as unsupported values must be), CSS requires that the entire declaration
    be ignored.</p>
  <h4 class="heading settled" id="w3c-conform-future-proofing"><span class="content"> Implementations of Unstable and Proprietary Features</span><a class="self-link" href="#w3c-conform-future-proofing"></a></h4>
  <p>To avoid clashes with future stable CSS features,
        the CSSWG recommends <a href="http://www.w3.org/TR/CSS/#future-proofing">following best practices</a> for the implementation of <a href="http://www.w3.org/TR/CSS/#unstable">unstable</a> features and <a href="http://www.w3.org/TR/CSS/#proprietary-extension">proprietary extensions</a> to CSS. </p>
  <h3 class="no-ref heading settled" id="w3c-testing"><span class="content"> Non-experimental implementations</span><a class="self-link" href="#w3c-testing"></a></h3>
  <p>Once a specification reaches the Candidate Recommendation stage,
    non-experimental implementations are possible, and implementors should
    release an unprefixed implementation of any CR-level feature they
    can demonstrate to be correctly implemented according to spec. </p>
  <p>To establish and maintain the interoperability of CSS across
    implementations, the CSS Working Group requests that non-experimental
    CSS renderers submit an implementation report (and, if necessary, the
    testcases used for that implementation report) to the W3C before
    releasing an unprefixed implementation of any CSS features. Testcases
    submitted to W3C are subject to review and correction by the CSS
    Working Group. </p>
  <p>Further information on submitting testcases and implementation reports
    can be found from on the CSS Working Group’s website at <a href="http://www.w3.org/Style/CSS/Test/">http://www.w3.org/Style/CSS/Test/</a>.
    Questions should be directed to the <a href="http://lists.w3.org/Archives/Public/public-css-testsuite">public-css-testsuite@w3.org</a> mailing list.</p>
  <script src="https://www.w3.org/scripts/TR/2021/fixup.js"></script>
  <h2 class="no-num no-ref heading settled" id="index"><span class="content">Index</span><a class="self-link" href="#index"></a></h2>
  <h3 class="no-num no-ref heading settled" id="index-defined-here"><span class="content">Terms defined by this specification</span><a class="self-link" href="#index-defined-here"></a></h3>
  <ul class="index">
   <li><a href="#animate-function">animate function</a><span>, in § 3.3</span>
   <li><a href="#animation-animator-name">animation animator name</a><span>, in § 5.1</span>
   <li><a href="#animation-worklet">Animation Worklet</a><span>, in § 2</span>
   <li><a href="#dom-css-animationworklet">animationWorklet</a><span>, in § 2</span>
   <li><a href="#animationworkletglobalscope">AnimationWorkletGlobalScope</a><span>, in § 2</span>
   <li><a href="#animator">Animator</a><span>, in § 3</span>
   <li><a href="#animator-current-time">animator current time</a><span>, in § 4</span>
   <li><a href="#animator-definition">animator definition</a><span>, in § 3.3</span>
   <li><a href="#animator-definitions">animator definitions</a><span>, in § 3.4</span>
   <li><a href="#animator-effect">Animator Effect</a><span>, in § 3.5</span>
   <li><a href="#animator-instance">animator instance</a><span>, in § 4</span>
   <li><a href="#callbackdef-animatorinstanceconstructor">AnimatorInstanceConstructor</a><span>, in § 2</span>
   <li><a href="#animator-instance-set">animator instance set</a><span>, in § 4.1</span>
   <li><a href="#animator-name">animator name</a><span>, in § 3.3</span>
   <li><a href="#dom-workletanimation-animatorname">animatorName</a><span>, in § 5.1</span>
   <li><a href="#animator-serialized-options">animator serialized options</a><span>, in § 4</span>
   <li><a href="#animator-timeline">animator timeline</a><span>, in § 4</span>
   <li><a href="#associate-animator-instance-of-worklet-animation">associate animator instance of worklet animation</a><span>, in § 5.4</span>
   <li><a href="#class-constructor">class constructor</a><span>, in § 3.3</span>
   <li><a href="#dom-workletanimation-workletanimation">constructor(animatorName)</a><span>, in § 5.2</span>
   <li><a href="#dom-workletanimation-workletanimation">constructor(animatorName, effects)</a><span>, in § 5.2</span>
   <li><a href="#dom-workletanimation-workletanimation">constructor(animatorName, effects, timeline)</a><span>, in § 5.2</span>
   <li><a href="#dom-workletanimation-workletanimation">constructor(animatorName, effects, timeline, options)</a><span>, in § 5.2</span>
   <li><a href="#corresponding-animator-instance">corresponding animator instance</a><span>, in § 5.1</span>
   <li><a href="#corresponding-effect">corresponding effect</a><span>, in § 3.5</span>
   <li><a href="#create-a-new-animator-instance">create a new animator instance</a><span>, in § 4.1</span>
   <li><a href="#disassociate-animator-instance-of-worklet-animation">disassociate animator instance of worklet animation</a><span>, in § 5.4</span>
   <li><a href="#document-animator-definition">document animator definition</a><span>, in § 3.3</span>
   <li><a href="#document-animator-definitions">document animator definitions</a><span>, in § 3.4</span>
   <li><a href="#effect">effect</a><span>, in § 4</span>
   <li><a href="#frame-requested-flag">frame requested flag</a><span>, in § 4.5</span>
   <li><a href="#dom-workletgroupeffect-getchildren">getChildren()</a><span>, in § 6.1</span>
   <li><a href="#dom-workletanimationeffect-getcomputedtiming">getComputedTiming()</a><span>, in § 3.5</span>
   <li><a href="#dom-workletanimationeffect-gettiming">getTiming()</a><span>, in § 3.5</span>
   <li><a href="#dom-workletanimationeffect-localtime">localTime</a><span>, in § 3.5</span>
   <li><a href="#migrate-an-animator-instance">migrate an animator instance</a><span>, in § 4.4</span>
   <li><a href="#dom-animationworkletglobalscope-registeranimator">registerAnimator(name, animatorCtor)</a><span>, in § 3.4</span>
   <li><a href="#remove-an-animator-instance">remove an animator instance</a><span>, in § 4.3</span>
   <li><a href="#run-animators">run animators</a><span>, in § 4.2</span>
   <li><a href="#serialized-options">serialized options</a><span>, in § 5.1</span>
   <li><a href="#set-animator-instance-of-worklet-animation">set animator instance of worklet animation</a><span>, in § 5.4</span>
   <li><a href="#stateful-animator">Stateful Animator</a><span>, in § 3.2</span>
   <li><a href="#stateful-animator-definition">stateful animator definition</a><span>, in § 3.3</span>
   <li><a href="#stateful-animator-instance">stateful animator instance</a><span>, in § 4</span>
   <li>
    stateful flag
    <ul>
     <li><a href="#animator-definition-stateful-flag">dfn for animator definition</a><span>, in § 3.3</span>
     <li><a href="#document-animator-definition-stateful-flag">dfn for document animator definition</a><span>, in § 3.3</span>
    </ul>
   <li><a href="#state-function">state function</a><span>, in § 3.3</span>
   <li><a href="#stateless-animator">Stateless Animator</a><span>, in § 3.1</span>
   <li><a href="#sync-animation-timings-to-worklet">sync animation timings to worklet</a><span>, in § 5.3</span>
   <li><a href="#sync-local-times-to-document">sync local times to document</a><span>, in § 5.3</span>
   <li><a href="#sync-requested-flag">sync requested flag</a><span>, in § 4</span>
   <li><a href="#worklet-animation">Worklet animation</a><span>, in § 5.1</span>
   <li><a href="#workletanimation">WorkletAnimation</a><span>, in § 5.1</span>
   <li><a href="#dom-workletanimation-workletanimation">WorkletAnimation(animatorName)</a><span>, in § 5.2</span>
   <li><a href="#dom-workletanimation-workletanimation">WorkletAnimation(animatorName, effects)</a><span>, in § 5.2</span>
   <li><a href="#dom-workletanimation-workletanimation">WorkletAnimation(animatorName, effects, timeline)</a><span>, in § 5.2</span>
   <li><a href="#dom-workletanimation-workletanimation">WorkletAnimation(animatorName, effects, timeline, options)</a><span>, in § 5.2</span>
   <li><a href="#workletanimationeffect">WorkletAnimationEffect</a><span>, in § 3.5</span>
   <li><a href="#workletgroupeffect">WorkletGroupEffect</a><span>, in § 6.1</span>
  </ul>
  <h3 class="no-num no-ref heading settled" id="index-defined-elsewhere"><span class="content">Terms defined by reference</span><a class="self-link" href="#index-defined-elsewhere"></a></h3>
  <ul class="index">
   <li>
    <a data-link-type="biblio">[]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="f9ffa42e">ScrollTimeline</span>
     <li><span class="dfn-paneled" id="ba972ac6">active</span>
     <li><span class="dfn-paneled" id="59b5eed5">animation</span>
     <li><span class="dfn-paneled" id="d506ba10">animation class</span>
     <li><span class="dfn-paneled" id="4b3eb2a2">animation effect</span>
     <li><span class="dfn-paneled" id="49babf4f">callback this value</span>
     <li><span class="dfn-paneled" id="dd26ac30">child effect</span>
     <li><span class="dfn-paneled" id="ff806377">constructing</span>
     <li><span class="dfn-paneled" id="8fd40ad9">converting</span>
     <li><span class="dfn-paneled" id="f5d14679">current time</span>
     <li><span class="dfn-paneled" id="0802bb36">default document timeline</span>
     <li><span class="dfn-paneled" id="ff44116e">effect stack</span>
     <li><span class="dfn-paneled" id="91d37919">effect value</span>
     <li><span class="dfn-paneled" id="7501f85c">end delay</span>
     <li><span class="dfn-paneled" id="4f6cd2c0">fill mode</span>
     <li><span class="dfn-paneled" id="1f8e7f3a">finished</span>
     <li><span class="dfn-paneled" id="a3e56dcb">Function</span>
     <li><span class="dfn-paneled" id="6aabef20">Get</span>
     <li><span class="dfn-paneled" id="493d7401">group effect</span>
     <li><span class="dfn-paneled" id="dce7aeba">idle</span>
     <li><span class="dfn-paneled" id="9f683089">inherited time</span>
     <li><span class="dfn-paneled" id="684a1ec3">Invoke</span>
     <li><span class="dfn-paneled" id="d56bd241">IsConstructor</span>
     <li><span class="dfn-paneled" id="d337c9c5">iteration count</span>
     <li><span class="dfn-paneled" id="3a3467e2">iteration duration</span>
     <li><span class="dfn-paneled" id="c019dd86">iteration start</span>
     <li><span class="dfn-paneled" id="fb0f7c22">local time</span>
     <li><span class="dfn-paneled" id="c02f2e75">NotSupportedError</span>
     <li><span class="dfn-paneled" id="a4f1c52f">paused</span>
     <li><span class="dfn-paneled" id="57e5a139">persisted</span>
     <li><span class="dfn-paneled" id="8f36f887">play state</span>
     <li><span class="dfn-paneled" id="690d895e">playback direction</span>
     <li><span class="dfn-paneled" id="03b2aea5">playback rate</span>
     <li><span class="dfn-paneled" id="e0d69e88">ready</span>
     <li><span class="dfn-paneled" id="26c694d4">removed</span>
     <li><span class="dfn-paneled" id="d84d7676">replace state</span>
     <li><span class="dfn-paneled" id="5d9ba21d">running</span>
     <li><span class="dfn-paneled" id="1791b5a0">running the animation frame callbacks</span>
     <li><span class="dfn-paneled" id="c26f57fa">set the current time</span>
     <li><span class="dfn-paneled" id="36b7e0a7">set the start time</span>
     <li><span class="dfn-paneled" id="704aacbc">set the target effect of an animation</span>
     <li><span class="dfn-paneled" id="58dd1ba7">set the timeline of an animation</span>
     <li><span class="dfn-paneled" id="8c27c1b9">start delay</span>
     <li><span class="dfn-paneled" id="5b0c7c0e">structureddeserialize</span>
     <li><span class="dfn-paneled" id="5aeb6c4f">structuredserialize</span>
     <li><span class="dfn-paneled" id="ac129361">target property</span>
     <li><span class="dfn-paneled" id="604e2d49">throw</span>
     <li><span class="dfn-paneled" id="c2c87b36">timeline</span>
     <li><span class="dfn-paneled" id="45778aab">timing function</span>
     <li><span class="dfn-paneled" id="4739df91">TypeError</span>
     <li><span class="dfn-paneled" id="9d770734">update the timing properties of an animation effect</span>
    </ul>
   <li>
    <a data-link-type="biblio">[CSS-TRANSITIONS-1]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="6b3eac42">start time</span>
    </ul>
   <li>
    <a data-link-type="biblio">[CSS-VALUES-4]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="9213678e">&lt;ident></span>
    </ul>
   <li>
    <a data-link-type="biblio">[CSSOM-1]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="a43c62be">CSS</span>
    </ul>
   <li>
    <a data-link-type="biblio">[DOM]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="85394472">Document</span>
     <li><span class="dfn-paneled" id="a973e0fe">document</span>
    </ul>
   <li>
    <a data-link-type="biblio">[HTML]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="5d7209e9">Window</span>
     <li><span class="dfn-paneled" id="2879c404">Worklet</span>
     <li><span class="dfn-paneled" id="0c9b0d3c">WorkletGlobalScope</span>
     <li><span class="dfn-paneled" id="ce3d2bbb">current global object</span>
     <li><span class="dfn-paneled" id="9a517a7d">queue a task</span>
     <li><span class="dfn-paneled" id="3b8ce5a6">worklet global scope type</span>
    </ul>
   <li>
    <a data-link-type="biblio">[INFRA]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="1243a891">exist</span>
     <li><span class="dfn-paneled" id="527b10aa">get</span>
     <li><span class="dfn-paneled" id="649608b9">list</span>
     <li><span class="dfn-paneled" id="3fca5a9e">map</span>
     <li><span class="dfn-paneled" id="0e6b2056">set</span>
     <li><span class="dfn-paneled" id="984221ca">struct</span>
    </ul>
   <li>
    <a data-link-type="biblio">[WEB-ANIMATIONS-1]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="b516749f">Animation</span>
     <li><span class="dfn-paneled" id="dd130a0f">AnimationEffect</span>
     <li><span class="dfn-paneled" id="28642d4f">AnimationTimeline</span>
     <li><span class="dfn-paneled" id="079e827a">ComputedEffectTiming</span>
     <li><span class="dfn-paneled" id="40abc39b">EffectTiming</span>
     <li><span class="dfn-paneled" id="213de25e">finish()</span>
     <li><span class="dfn-paneled" id="506a1554">updateTiming()</span>
    </ul>
   <li>
    <a data-link-type="biblio">[WEB-ANIMATIONS-2]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="8f9dc1f2">getComputedTiming()</span>
    </ul>
   <li>
    <a data-link-type="biblio">[WEBIDL]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="8855a9aa">DOMString</span>
     <li><span class="dfn-paneled" id="889e932f">Exposed</span>
     <li><span class="dfn-paneled" id="7fb6fbc6">Global</span>
     <li><span class="dfn-paneled" id="a5c91173">SameObject</span>
     <li><span class="dfn-paneled" id="6c6b1005">any</span>
     <li><span class="dfn-paneled" id="3ab7bf79">callback function</span>
     <li><span class="dfn-paneled" id="8c800cdf">double</span>
     <li><span class="dfn-paneled" id="9cce47fd">sequence</span>
     <li><span class="dfn-paneled" id="5f90bbfb">undefined</span>
    </ul>
  </ul>
  <h2 class="no-num no-ref heading settled" id="references"><span class="content">References</span><a class="self-link" href="#references"></a></h2>
  <h3 class="no-num no-ref heading settled" id="normative"><span class="content">Normative References</span><a class="self-link" href="#normative"></a></h3>
  <dl>
   <dt id="biblio-css-transitions-1">[CSS-TRANSITIONS-1]
   <dd>David Baron; et al. <a href="https://drafts.csswg.org/css-transitions/"><cite>CSS Transitions</cite></a>. URL: <a href="https://drafts.csswg.org/css-transitions/">https://drafts.csswg.org/css-transitions/</a>
   <dt id="biblio-css-values-4">[CSS-VALUES-4]
   <dd>Tab Atkins Jr.; Elika Etemad. <a href="https://drafts.csswg.org/css-values-4/"><cite>CSS Values and Units Module Level 4</cite></a>. URL: <a href="https://drafts.csswg.org/css-values-4/">https://drafts.csswg.org/css-values-4/</a>
   <dt id="biblio-cssom-1">[CSSOM-1]
   <dd>Daniel Glazman; Emilio Cobos Álvarez. <a href="https://drafts.csswg.org/cssom/"><cite>CSS Object Model (CSSOM)</cite></a>. URL: <a href="https://drafts.csswg.org/cssom/">https://drafts.csswg.org/cssom/</a>
   <dt id="biblio-dom">[DOM]
   <dd>Anne van Kesteren. <a href="https://dom.spec.whatwg.org/"><cite>DOM Standard</cite></a>. Living Standard. URL: <a href="https://dom.spec.whatwg.org/">https://dom.spec.whatwg.org/</a>
   <dt id="biblio-html">[HTML]
   <dd>Anne van Kesteren; et al. <a href="https://html.spec.whatwg.org/multipage/"><cite>HTML Standard</cite></a>. Living Standard. URL: <a href="https://html.spec.whatwg.org/multipage/">https://html.spec.whatwg.org/multipage/</a>
   <dt id="biblio-infra">[INFRA]
   <dd>Anne van Kesteren; Domenic Denicola. <a href="https://infra.spec.whatwg.org/"><cite>Infra Standard</cite></a>. Living Standard. URL: <a href="https://infra.spec.whatwg.org/">https://infra.spec.whatwg.org/</a>
   <dt id="biblio-rfc2119">[RFC2119]
   <dd>S. Bradner. <a href="https://datatracker.ietf.org/doc/html/rfc2119"><cite>Key words for use in RFCs to Indicate Requirement Levels</cite></a>. March 1997. Best Current Practice. URL: <a href="https://datatracker.ietf.org/doc/html/rfc2119">https://datatracker.ietf.org/doc/html/rfc2119</a>
   <dt id="biblio-web-animations-1">[WEB-ANIMATIONS-1]
   <dd>Brian Birtles; et al. <a href="https://drafts.csswg.org/web-animations-1/"><cite>Web Animations</cite></a>. URL: <a href="https://drafts.csswg.org/web-animations-1/">https://drafts.csswg.org/web-animations-1/</a>
   <dt id="biblio-web-animations-2">[WEB-ANIMATIONS-2]
   <dd>Brian Birtles; Robert Flack. <a href="https://drafts.csswg.org/web-animations-2/"><cite>Web Animations Level 2</cite></a>. URL: <a href="https://drafts.csswg.org/web-animations-2/">https://drafts.csswg.org/web-animations-2/</a>
   <dt id="biblio-webidl">[WEBIDL]
   <dd>Edgar Chen; Timothy Gu. <a href="https://webidl.spec.whatwg.org/"><cite>Web IDL Standard</cite></a>. Living Standard. URL: <a href="https://webidl.spec.whatwg.org/">https://webidl.spec.whatwg.org/</a>
  </dl>
  <h3 class="no-num no-ref heading settled" id="informative"><span class="content">Informative References</span><a class="self-link" href="#informative"></a></h3>
  <dl>
   <dt id="biblio-explainer">[EXPLAINER]
   <dd><a href="https://github.com/w3c/css-houdini-drafts/blob/master/css-animation-worklet-1/README.md"><cite>Animation Worklet Explainer</cite></a>. URL: <a href="https://github.com/w3c/css-houdini-drafts/blob/master/css-animation-worklet-1/README.md">https://github.com/w3c/css-houdini-drafts/blob/master/css-animation-worklet-1/README.md</a>
   <dt id="biblio-principles">[PRINCIPLES]
   <dd><a href="https://github.com/w3c/css-houdini-drafts/blob/master/css-animation-worklet-1/principles.md"><cite>Animation Worklet Design Principles and Goals</cite></a>. URL: <a href="https://github.com/w3c/css-houdini-drafts/blob/master/css-animation-worklet-1/principles.md">https://github.com/w3c/css-houdini-drafts/blob/master/css-animation-worklet-1/principles.md</a>
  </dl>
  <h2 class="no-num no-ref heading settled" id="idl-index"><span class="content">IDL Index</span><a class="self-link" href="#idl-index"></a></h2>
<pre class="idl highlight def">[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed"><c- g>Exposed</c-></a>=<c- n>Window</c->]
<c- b>partial</c-> <c- b>namespace</c-> <a class="idl-code" data-link-type="namespace" href="https://drafts.csswg.org/cssom-1/#namespacedef-css"><c- g>CSS</c-></a> {
    [<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#SameObject"><c- g>SameObject</c-></a>] <c- b>readonly</c-> <c- b>attribute</c-> <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/worklets.html#worklet"><c- n>Worklet</c-></a> <a data-readonly data-type="Worklet" href="#dom-css-animationworklet"><code><c- g>animationWorklet</c-></code></a>;
};

[ <a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Global"><c- g>Global</c-></a>=(<a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/worklets.html#worklet"><c- n>Worklet</c-></a>,<a data-link-type="idl-name"><c- n>AnimationWorklet</c-></a>), <a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed"><c- g>Exposed</c-></a>=<c- n>AnimationWorklet</c-> ]
<c- b>interface</c-> <a href="#animationworkletglobalscope"><code><c- g>AnimationWorkletGlobalScope</c-></code></a> : <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/worklets.html#workletglobalscope"><c- n>WorkletGlobalScope</c-></a> {
    <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-undefined"><c- b>undefined</c-></a> <a class="idl-code" data-link-type="method" href="#dom-animationworkletglobalscope-registeranimator"><c- g>registerAnimator</c-></a>(<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString"><c- b>DOMString</c-></a> <a href="#dom-animationworkletglobalscope-registeranimator-name-animatorctor-name"><code><c- g>name</c-></code></a>, <a data-link-type="idl-name" href="#callbackdef-animatorinstanceconstructor"><c- n>AnimatorInstanceConstructor</c-></a> <a href="#dom-animationworkletglobalscope-registeranimator-name-animatorctor-animatorctor"><code><c- g>animatorCtor</c-></code></a>);
};

<c- b>callback</c-> <a href="#callbackdef-animatorinstanceconstructor"><code><c- g>AnimatorInstanceConstructor</c-></code></a> = <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-any"><c- b>any</c-></a> (<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-any"><c- b>any</c-></a> <a href="#dom-animatorinstanceconstructor-options"><code><c- g>options</c-></code></a>, <c- b>optional</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-any"><c- b>any</c-></a> <a href="#dom-animatorinstanceconstructor-state"><code><c- g>state</c-></code></a>);

[ <a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed"><c- g>Exposed</c-></a>=<c- n>AnimationWorklet</c-> ]
<c- b>interface</c-> <a href="#workletanimationeffect"><code><c- g>WorkletAnimationEffect</c-></code></a> {
    <a data-link-type="idl-name" href="https://drafts.csswg.org/web-animations-1/#dictdef-effecttiming"><c- n>EffectTiming</c-></a>         <a class="idl-code" data-link-type="method" href="#dom-workletanimationeffect-gettiming"><c- g>getTiming</c-></a>();
    <a data-link-type="idl-name" href="https://drafts.csswg.org/web-animations-1/#dictdef-computedeffecttiming"><c- n>ComputedEffectTiming</c-></a> <a class="idl-code" data-link-type="method" href="#dom-workletanimationeffect-getcomputedtiming"><c- g>getComputedTiming</c-></a>();
    <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-double"><c- b>double</c-></a>? <a class="idl-code" data-link-type="attribute" data-type="double?" href="#dom-workletanimationeffect-localtime"><c- g>localTime</c-></a>;
};


[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed"><c- g>Exposed</c-></a>=<c- n>Window</c->]
<c- b>interface</c-> <a href="#workletanimation"><code><c- g>WorkletAnimation</c-></code></a> : <a data-link-type="idl-name" href="https://drafts.csswg.org/web-animations-1/#animation"><c- n>Animation</c-></a> {
        <a class="idl-code" data-link-type="constructor" href="#dom-workletanimation-workletanimation"><c- g>constructor</c-></a>(<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString"><c- b>DOMString</c-></a> <a href="#dom-workletanimation-workletanimation-animatorname-effects-timeline-options-animatorname"><code><c- g>animatorName</c-></code></a>,
              <c- b>optional</c-> (<a data-link-type="idl-name" href="https://drafts.csswg.org/web-animations-1/#animationeffect"><c- n>AnimationEffect</c-></a> <c- b>or</c-> <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#idl-sequence"><c- b>sequence</c-></a>&lt;<a data-link-type="idl-name" href="https://drafts.csswg.org/web-animations-1/#animationeffect"><c- n>AnimationEffect</c-></a>>)? <a href="#dom-workletanimation-workletanimation-animatorname-effects-timeline-options-effects"><code><c- g>effects</c-></code></a> = <c- b>null</c->,
              <c- b>optional</c-> <a data-link-type="idl-name" href="https://drafts.csswg.org/web-animations-1/#animationtimeline"><c- n>AnimationTimeline</c-></a>? <a href="#dom-workletanimation-workletanimation-animatorname-effects-timeline-options-timeline"><code><c- g>timeline</c-></code></a>,
              <c- b>optional</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-any"><c- b>any</c-></a> <a href="#dom-workletanimation-workletanimation-animatorname-effects-timeline-options-options"><code><c- g>options</c-></code></a>);
        <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString"><c- b>DOMString</c-></a> <a data-readonly data-type="DOMString" href="#dom-workletanimation-animatorname"><code><c- g>animatorName</c-></code></a>;
};

[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed"><c- g>Exposed</c-></a>=<c- n>AnimationWorklet</c->]
<c- b>interface</c-> <a href="#workletgroupeffect"><code><c- g>WorkletGroupEffect</c-></code></a> {
  <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#idl-sequence"><c- b>sequence</c-></a>&lt;<a data-link-type="idl-name" href="#workletanimationeffect"><c- n>WorkletAnimationEffect</c-></a>> <a href="#dom-workletgroupeffect-getchildren"><code><c- g>getChildren</c-></code></a>();
};

</pre>
  <h2 class="no-num no-ref heading settled" id="issues-index"><span class="content">Issues Index</span><a class="self-link" href="#issues-index"></a></h2>
  <div style="counter-reset:issue">
   <div class="issue"> Consider giving user agents permission to skip running individual animator
instances to throttle slow animators. <a class="issue-return" href="#issue-68dc788e" title="Jump to section">↵</a></div>
   <div class="issue"> should be explicit as to what happens if the animateFunction throws an exception. At least
we should have wording that the localTime values of the effects are ignored to avoid incorrect
partial updates. <a class="issue-return" href="#issue-9dc01310" title="Jump to section">↵</a></div>
   <div class="issue"> Come with appropriate mechanism’s for <a data-link-type="dfn" href="#animator-instance">animator instance</a> to get notified when its
   animation currentTime is changing e.g., via reverse(), finish() or playbackRate change. So that
   it can react appropriately. <a href="https://github.com/w3c/css-houdini-drafts/issues/811">[Issue #811]</a> <a class="issue-return" href="#issue-61e3a71a" title="Jump to section">↵</a></div>
   <div class="issue"> In web-animation play state is updated before the actual change in particular some operations
such as play() are asynchronous. We should really invoke these Animator related operation after the
appropriate animation operation is complete instead of when play state has changed. This will
require either finding (or introducing) q new hook in web animation or having override for each such
async operation. <a class="issue-return" href="#issue-e070ee55" title="Jump to section">↵</a></div>
   <div class="issue"> The above interface exposes a conservative subset of GroupEffect
proposed as part of web-animation-2. We should instead move this into a delta spec against the
web-animation. <a href="https://github.com/w3c/csswg-drafts/issues/2071">[Issue #w3c/csswg-drafts#2071]</a> <a class="issue-return" href="#issue-9ff2b6cb" title="Jump to section">↵</a></div>
  </div>
<script>/* Boilerplate: script-dom-helper */
"use strict";
function query(sel) { return document.querySelector(sel); }

function queryAll(sel) { return [...document.querySelectorAll(sel)]; }

function iter(obj) {
	if(!obj) return [];
	var it = obj[Symbol.iterator];
	if(it) return it;
	return Object.entries(obj);
}

function mk(tagname, attrs, ...children) {
	const el = document.createElement(tagname);
	for(const [k,v] of iter(attrs)) {
		if(k.slice(0,3) == "_on") {
			const eventName = k.slice(3);
			el.addEventListener(eventName, v);
		} else if(k[0] == "_") {
			// property, not attribute
			el[k.slice(1)] = v;
		} else {
			if(v === false || v == null) {
        continue;
      } else if(v === true) {
        el.setAttribute(k, "");
        continue;
      } else {
  			el.setAttribute(k, v);
      }
		}
	}
	append(el, children);
	return el;
}

/* Create shortcuts for every known HTML element */
[
  "a",
  "abbr",
  "acronym",
  "address",
  "applet",
  "area",
  "article",
  "aside",
  "audio",
  "b",
  "base",
  "basefont",
  "bdo",
  "big",
  "blockquote",
  "body",
  "br",
  "button",
  "canvas",
  "caption",
  "center",
  "cite",
  "code",
  "col",
  "colgroup",
  "datalist",
  "dd",
  "del",
  "details",
  "dfn",
  "dialog",
  "div",
  "dl",
  "dt",
  "em",
  "embed",
  "fieldset",
  "figcaption",
  "figure",
  "font",
  "footer",
  "form",
  "frame",
  "frameset",
  "head",
  "header",
  "h1",
  "h2",
  "h3",
  "h4",
  "h5",
  "h6",
  "hr",
  "html",
  "i",
  "iframe",
  "img",
  "input",
  "ins",
  "kbd",
  "label",
  "legend",
  "li",
  "link",
  "main",
  "map",
  "mark",
  "meta",
  "meter",
  "nav",
  "nobr",
  "noscript",
  "object",
  "ol",
  "optgroup",
  "option",
  "output",
  "p",
  "param",
  "pre",
  "progress",
  "q",
  "s",
  "samp",
  "script",
  "section",
  "select",
  "small",
  "source",
  "span",
  "strike",
  "strong",
  "style",
  "sub",
  "summary",
  "sup",
  "table",
  "tbody",
  "td",
  "template",
  "textarea",
  "tfoot",
  "th",
  "thead",
  "time",
  "title",
  "tr",
  "u",
  "ul",
  "var",
  "video",
  "wbr",
  "xmp",
].forEach(tagname=>{
	mk[tagname] = (...args) => mk(tagname, ...args);
});

function* nodesFromChildList(children) {
	for(const child of children.flat(Infinity)) {
		if(child instanceof Node) {
			yield child;
		} else {
			yield new Text(child);
		}
	}
}
function append(el, ...children) {
	for(const child of nodesFromChildList(children)) {
		if(el instanceof Node) el.appendChild(child);
		else el.push(child);
	}
	return el;
}

function insertAfter(el, ...children) {
	for(const child of nodesFromChildList(children)) {
		el.parentNode.insertBefore(child, el.nextSibling);
	}
	return el;
}

function clearContents(el) {
	el.innerHTML = "";
	return el;
}

function parseHTML(markup) {
	if(markup.toLowerCase().trim().indexOf('<!doctype') === 0) {
		const doc = document.implementation.createHTMLDocument("");
		doc.documentElement.innerHTML = markup;
		return doc;
	} else {
		const el = mk.template({});
		el.innerHTML = markup;
		return el.content;
	}
}</script>
<script>/* Boilerplate: script-dfn-panel */
"use strict";
{
let dfnPanelData = {
"03b2aea5": {"dfnID":"03b2aea5","dfnText":"playback rate","external":true,"refSections":[{"refs":[{"id":"ref-for-playback-rate"}],"title":"5.3. Worklet Animation Timing and Sync Model"}],"url":"https://drafts.csswg.org/web-animations#playback-rate"},
"079e827a": {"dfnID":"079e827a","dfnText":"ComputedEffectTiming","external":true,"refSections":[{"refs":[{"id":"ref-for-dictdef-computedeffecttiming"}],"title":"3.5. Animator Effect"}],"url":"https://drafts.csswg.org/web-animations-1/#dictdef-computedeffecttiming"},
"0802bb36": {"dfnID":"0802bb36","dfnText":"default document timeline","external":true,"refSections":[{"refs":[{"id":"ref-for-the-documents-default-timeline"}],"title":"5.2. Creating a Worklet Animation"}],"url":"https://drafts.csswg.org/web-animations#the-documents-default-timeline"},
"0c9b0d3c": {"dfnID":"0c9b0d3c","dfnText":"WorkletGlobalScope","external":true,"refSections":[{"refs":[{"id":"ref-for-workletglobalscope"}],"title":"2. Animation Worklet"},{"refs":[{"id":"ref-for-workletglobalscope\u2460"}],"title":"3.2. Stateful Animator"},{"refs":[{"id":"ref-for-workletglobalscope\u2461"}],"title":"5.3. Worklet Animation Timing and Sync Model"}],"url":"https://html.spec.whatwg.org/multipage/worklets.html#workletglobalscope"},
"0e6b2056": {"dfnID":"0e6b2056","dfnText":"set","external":true,"refSections":[{"refs":[{"id":"ref-for-map-set"},{"id":"ref-for-map-set\u2460"},{"id":"ref-for-map-set\u2461"}],"title":"3.4. Registering an Animator Definition"}],"url":"https://infra.spec.whatwg.org/#map-set"},
"1243a891": {"dfnID":"1243a891","dfnText":"exist","external":true,"refSections":[{"refs":[{"id":"ref-for-map-exists"},{"id":"ref-for-map-exists\u2460"}],"title":"3.4. Registering an Animator Definition"},{"refs":[{"id":"ref-for-map-exists\u2461"}],"title":"5.2. Creating a Worklet Animation"}],"url":"https://infra.spec.whatwg.org/#map-exists"},
"1791b5a0": {"dfnID":"1791b5a0","dfnText":"running the animation frame callbacks","external":true,"refSections":[{"refs":[{"id":"ref-for-run-the-animation-frame-callbacks"},{"id":"ref-for-run-the-animation-frame-callbacks\u2460"}],"title":"5.3. Worklet Animation Timing and Sync Model"}],"url":"https://html.spec.whatwg.org/#run-the-animation-frame-callbacks"},
"1f8e7f3a": {"dfnID":"1f8e7f3a","dfnText":"finished","external":true,"refSections":[{"refs":[{"id":"ref-for-finished"},{"id":"ref-for-finished\u2460"}],"title":"5.4. Web Animations Overrides"}],"url":"https://drafts.csswg.org/web-animations#finished"},
"213de25e": {"dfnID":"213de25e","dfnText":"finish()","external":true,"refSections":[{"refs":[{"id":"ref-for-dom-animation-finish"}],"title":"5.3. Worklet Animation Timing and Sync Model"}],"url":"https://drafts.csswg.org/web-animations-1/#dom-animation-finish"},
"26c694d4": {"dfnID":"26c694d4","dfnText":"removed","external":true,"refSections":[{"refs":[{"id":"ref-for-removed"}],"title":"5.4. Web Animations Overrides"}],"url":"https://drafts.csswg.org/web-animations#removed"},
"28642d4f": {"dfnID":"28642d4f","dfnText":"AnimationTimeline","external":true,"refSections":[{"refs":[{"id":"ref-for-animationtimeline"}],"title":"5.1. Worklet Animation"}],"url":"https://drafts.csswg.org/web-animations-1/#animationtimeline"},
"2879c404": {"dfnID":"2879c404","dfnText":"Worklet","external":true,"refSections":[{"refs":[{"id":"ref-for-worklet"},{"id":"ref-for-worklet\u2460"},{"id":"ref-for-worklet\u2461"}],"title":"2. Animation Worklet"}],"url":"https://html.spec.whatwg.org/multipage/worklets.html#worklet"},
"36b7e0a7": {"dfnID":"36b7e0a7","dfnText":"set the start time","external":true,"refSections":[{"refs":[{"id":"ref-for-set-the-start-time"}],"title":"5.4. Web Animations Overrides"}],"url":"https://drafts.csswg.org/web-animations#set-the-start-time"},
"3a3467e2": {"dfnID":"3a3467e2","dfnText":"iteration duration","external":true,"refSections":[{"refs":[{"id":"ref-for-iteration-duration"}],"title":"3.5. Animator Effect"},{"refs":[{"id":"ref-for-iteration-duration\u2460"}],"title":"5.3. Worklet Animation Timing and Sync Model"}],"url":"https://drafts.csswg.org/web-animations#iteration-duration"},
"3ab7bf79": {"dfnID":"3ab7bf79","dfnText":"callback function","external":true,"refSections":[{"refs":[{"id":"ref-for-dfn-callback-function"},{"id":"ref-for-dfn-callback-function\u2460"},{"id":"ref-for-dfn-callback-function\u2461"}],"title":"3.3. Animator Definition"},{"refs":[{"id":"ref-for-dfn-callback-function\u2462"},{"id":"ref-for-dfn-callback-function\u2463"}],"title":"3.4. Registering an Animator Definition"}],"url":"https://webidl.spec.whatwg.org/#dfn-callback-function"},
"3b8ce5a6": {"dfnID":"3b8ce5a6","dfnText":"worklet global scope type","external":true,"refSections":[{"refs":[{"id":"ref-for-worklet-global-scope-type"}],"title":"2. Animation Worklet"}],"url":"https://html.spec.whatwg.org/multipage/worklets.html#worklet-global-scope-type"},
"3fca5a9e": {"dfnID":"3fca5a9e","dfnText":"map","external":true,"refSections":[{"refs":[{"id":"ref-for-ordered-map"},{"id":"ref-for-ordered-map\u2460"},{"id":"ref-for-ordered-map\u2461"},{"id":"ref-for-ordered-map\u2462"}],"title":"3.4. Registering an Animator Definition"},{"refs":[{"id":"ref-for-ordered-map\u2463"}],"title":"5.2. Creating a Worklet Animation"}],"url":"https://infra.spec.whatwg.org/#ordered-map"},
"40abc39b": {"dfnID":"40abc39b","dfnText":"EffectTiming","external":true,"refSections":[{"refs":[{"id":"ref-for-dictdef-effecttiming"}],"title":"3.5. Animator Effect"}],"url":"https://drafts.csswg.org/web-animations-1/#dictdef-effecttiming"},
"45778aab": {"dfnID":"45778aab","dfnText":"timing function","external":true,"refSections":[{"refs":[{"id":"ref-for-timing-function"}],"title":"3.5. Animator Effect"},{"refs":[{"id":"ref-for-timing-function\u2460"}],"title":"5.3. Worklet Animation Timing and Sync Model"}],"url":"https://drafts.csswg.org/web-animations#timing-function"},
"4739df91": {"dfnID":"4739df91","dfnText":"TypeError","external":true,"refSections":[{"refs":[{"id":"ref-for-sec-native-error-types-used-in-this-standard-typeerror"},{"id":"ref-for-sec-native-error-types-used-in-this-standard-typeerror\u2460"}],"title":"3.4. Registering an Animator Definition"},{"refs":[{"id":"ref-for-sec-native-error-types-used-in-this-standard-typeerror\u2461"},{"id":"ref-for-sec-native-error-types-used-in-this-standard-typeerror\u2462"}],"title":"5.2. Creating a Worklet Animation"}],"url":"https://tc39.github.io/ecma262/#sec-native-error-types-used-in-this-standard-typeerror"},
"493d7401": {"dfnID":"493d7401","dfnText":"group effect","external":true,"refSections":[{"refs":[{"id":"ref-for-group-effect"},{"id":"ref-for-group-effect\u2460"},{"id":"ref-for-group-effect\u2461"}],"title":"6.1. Worklet Group Effect"}],"url":"https://w3c.github.io/web-animations/level-2/#group-effect"},
"49babf4f": {"dfnID":"49babf4f","dfnText":"callback this value","external":true,"refSections":[{"refs":[{"id":"ref-for-dfn-callback-this-value"}],"title":"4.2. Running Animators"},{"refs":[{"id":"ref-for-dfn-callback-this-value\u2460"}],"title":"4.4. Migrating an Animator Instance"}],"url":"https://heycam.github.io/webidl/#dfn-callback-this-value"},
"4b3eb2a2": {"dfnID":"4b3eb2a2","dfnText":"animation effect","external":true,"refSections":[{"refs":[{"id":"ref-for-animation-effect"}],"title":"1. Introduction"},{"refs":[{"id":"ref-for-animation-effect\u2460"}],"title":"3. Animator"},{"refs":[{"id":"ref-for-animation-effect\u2461"},{"id":"ref-for-animation-effect\u2462"},{"id":"ref-for-animation-effect\u2463"}],"title":"3.5. Animator Effect"},{"refs":[{"id":"ref-for-animation-effect\u2464"}],"title":"5.1. Worklet Animation"},{"refs":[{"id":"ref-for-animation-effect\u2465"}],"title":"5.3. Worklet Animation Timing and Sync Model"},{"refs":[{"id":"ref-for-animation-effect\u2466"}],"title":"5.4. Web Animations Overrides"},{"refs":[{"id":"ref-for-animation-effect\u2467"},{"id":"ref-for-animation-effect\u2468"}],"title":"6.1. Worklet Group Effect"}],"url":"https://drafts.csswg.org/web-animations#animation-effect"},
"4f6cd2c0": {"dfnID":"4f6cd2c0","dfnText":"fill mode","external":true,"refSections":[{"refs":[{"id":"ref-for-fill-mode"}],"title":"3.5. Animator Effect"},{"refs":[{"id":"ref-for-fill-mode\u2460"}],"title":"5.3. Worklet Animation Timing and Sync Model"}],"url":"https://drafts.csswg.org/web-animations#fill-mode"},
"506a1554": {"dfnID":"506a1554","dfnText":"updateTiming()","external":true,"refSections":[{"refs":[{"id":"ref-for-dom-animationeffect-updatetiming"}],"title":"3.5. Animator Effect"}],"url":"https://drafts.csswg.org/web-animations-1/#dom-animationeffect-updatetiming"},
"527b10aa": {"dfnID":"527b10aa","dfnText":"get","external":true,"refSections":[{"refs":[{"id":"ref-for-map-get"}],"title":"3.4. Registering an Animator Definition"}],"url":"https://infra.spec.whatwg.org/#map-get"},
"57e5a139": {"dfnID":"57e5a139","dfnText":"persisted","external":true,"refSections":[{"refs":[{"id":"ref-for-persisted"}],"title":"5.4. Web Animations Overrides"}],"url":"https://drafts.csswg.org/web-animations#persisted"},
"58dd1ba7": {"dfnID":"58dd1ba7","dfnText":"set the timeline of an animation","external":true,"refSections":[{"refs":[{"id":"ref-for-set-the-timeline-of-an-animation"}],"title":"5.2. Creating a Worklet Animation"},{"refs":[{"id":"ref-for-set-the-timeline-of-an-animation\u2460"}],"title":"5.4. Web Animations Overrides"}],"url":"https://drafts.csswg.org/web-animations#set-the-timeline-of-an-animation"},
"59b5eed5": {"dfnID":"59b5eed5","dfnText":"animation","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-animation"}],"title":"3. Animator"},{"refs":[{"id":"ref-for-concept-animation\u2460"},{"id":"ref-for-concept-animation\u2461"}],"title":"5.1. Worklet Animation"},{"refs":[{"id":"ref-for-concept-animation\u2462"}],"title":"5.3. Worklet Animation Timing and Sync Model"},{"refs":[{"id":"ref-for-concept-animation\u2463"}],"title":"5.4. Web Animations Overrides"}],"url":"https://drafts.csswg.org/web-animations#concept-animation"},
"5aeb6c4f": {"dfnID":"5aeb6c4f","dfnText":"structuredserialize","external":true,"refSections":[{"refs":[{"id":"ref-for-structuredserialize"}],"title":"4.4. Migrating an Animator Instance"},{"refs":[{"id":"ref-for-structuredserialize\u2460"}],"title":"5.2. Creating a Worklet Animation"}],"url":"http://w3c.github.io/html/infrastructure.html#structuredserialize"},
"5b0c7c0e": {"dfnID":"5b0c7c0e","dfnText":"structureddeserialize","external":true,"refSections":[{"refs":[{"id":"ref-for-structureddeserialize"},{"id":"ref-for-structureddeserialize\u2460"}],"title":"4.1. Creating an Animator Instance"}],"url":"http://w3c.github.io/html/infrastructure.html#structureddeserialize"},
"5d7209e9": {"dfnID":"5d7209e9","dfnText":"Window","external":true,"refSections":[{"refs":[{"id":"ref-for-window"}],"title":"5.2. Creating a Worklet Animation"}],"url":"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window"},
"5d9ba21d": {"dfnID":"5d9ba21d","dfnText":"running","external":true,"refSections":[{"refs":[{"id":"ref-for-running"},{"id":"ref-for-running\u2460"}],"title":"5.4. Web Animations Overrides"}],"url":"https://drafts.csswg.org/web-animations#running"},
"5f90bbfb": {"dfnID":"5f90bbfb","dfnText":"undefined","external":true,"refSections":[{"refs":[{"id":"ref-for-idl-undefined"}],"title":"2. Animation Worklet"}],"url":"https://webidl.spec.whatwg.org/#idl-undefined"},
"604e2d49": {"dfnID":"604e2d49","dfnText":"throw","external":true,"refSections":[{"refs":[{"id":"ref-for-dfn-throw"},{"id":"ref-for-dfn-throw\u2460"},{"id":"ref-for-dfn-throw\u2461"}],"title":"3.4. Registering an Animator Definition"},{"refs":[{"id":"ref-for-dfn-throw\u2462"},{"id":"ref-for-dfn-throw\u2463"}],"title":"5.2. Creating a Worklet Animation"}],"url":"https://heycam.github.io/webidl/#dfn-throw"},
"649608b9": {"dfnID":"649608b9","dfnText":"list","external":true,"refSections":[{"refs":[{"id":"ref-for-list"}],"title":"5.2. Creating a Worklet Animation"}],"url":"https://infra.spec.whatwg.org/#list"},
"684a1ec3": {"dfnID":"684a1ec3","dfnText":"Invoke","external":true,"refSections":[{"refs":[{"id":"ref-for-invoke-a-callback-function"}],"title":"4.2. Running Animators"},{"refs":[{"id":"ref-for-invoke-a-callback-function\u2460"}],"title":"4.4. Migrating an Animator Instance"}],"url":"https://heycam.github.io/webidl/#invoke-a-callback-function"},
"690d895e": {"dfnID":"690d895e","dfnText":"playback direction","external":true,"refSections":[{"refs":[{"id":"ref-for-playback-direction"}],"title":"3.5. Animator Effect"},{"refs":[{"id":"ref-for-playback-direction\u2460"}],"title":"5.3. Worklet Animation Timing and Sync Model"}],"url":"https://drafts.csswg.org/web-animations#playback-direction"},
"6aabef20": {"dfnID":"6aabef20","dfnText":"Get","external":true,"refSections":[{"refs":[{"id":"ref-for-sec-get-o-p"},{"id":"ref-for-sec-get-o-p\u2460"},{"id":"ref-for-sec-get-o-p\u2461"}],"title":"3.4. Registering an Animator Definition"}],"url":"https://tc39.github.io/ecma262/#sec-get-o-p"},
"6b3eac42": {"dfnID":"6b3eac42","dfnText":"start time","external":true,"refSections":[{"refs":[{"id":"ref-for-transition-start-time"}],"title":"5.3. Worklet Animation Timing and Sync Model"}],"url":"https://drafts.csswg.org/css-transitions-1/#transition-start-time"},
"6c6b1005": {"dfnID":"6c6b1005","dfnText":"any","external":true,"refSections":[{"refs":[{"id":"ref-for-idl-any"},{"id":"ref-for-idl-any\u2460"},{"id":"ref-for-idl-any\u2461"}],"title":"2. Animation Worklet"},{"refs":[{"id":"ref-for-idl-any\u2462"}],"title":"5.1. Worklet Animation"}],"url":"https://webidl.spec.whatwg.org/#idl-any"},
"704aacbc": {"dfnID":"704aacbc","dfnText":"set the target effect of an animation","external":true,"refSections":[{"refs":[{"id":"ref-for-set-the-target-effect-of-an-animation"}],"title":"5.2. Creating a Worklet Animation"},{"refs":[{"id":"ref-for-set-the-target-effect-of-an-animation\u2460"}],"title":"5.4. Web Animations Overrides"}],"url":"https://drafts.csswg.org/web-animations#set-the-target-effect-of-an-animation"},
"7501f85c": {"dfnID":"7501f85c","dfnText":"end delay","external":true,"refSections":[{"refs":[{"id":"ref-for-end-delay"}],"title":"3.5. Animator Effect"},{"refs":[{"id":"ref-for-end-delay\u2460"}],"title":"5.3. Worklet Animation Timing and Sync Model"}],"url":"https://drafts.csswg.org/web-animations#end-delay"},
"7fb6fbc6": {"dfnID":"7fb6fbc6","dfnText":"Global","external":true,"refSections":[{"refs":[{"id":"ref-for-Global"}],"title":"2. Animation Worklet"}],"url":"https://webidl.spec.whatwg.org/#Global"},
"85394472": {"dfnID":"85394472","dfnText":"Document","external":true,"refSections":[{"refs":[{"id":"ref-for-document"}],"title":"5.2. Creating a Worklet Animation"}],"url":"https://dom.spec.whatwg.org/#document"},
"8855a9aa": {"dfnID":"8855a9aa","dfnText":"DOMString","external":true,"refSections":[{"refs":[{"id":"ref-for-idl-DOMString"}],"title":"2. Animation Worklet"},{"refs":[{"id":"ref-for-idl-DOMString\u2460"},{"id":"ref-for-idl-DOMString\u2461"}],"title":"5.1. Worklet Animation"}],"url":"https://webidl.spec.whatwg.org/#idl-DOMString"},
"889e932f": {"dfnID":"889e932f","dfnText":"Exposed","external":true,"refSections":[{"refs":[{"id":"ref-for-Exposed"},{"id":"ref-for-Exposed\u2460"}],"title":"2. Animation Worklet"},{"refs":[{"id":"ref-for-Exposed\u2461"}],"title":"3.5. Animator Effect"},{"refs":[{"id":"ref-for-Exposed\u2462"}],"title":"5.1. Worklet Animation"},{"refs":[{"id":"ref-for-Exposed\u2463"}],"title":"6.1. Worklet Group Effect"}],"url":"https://webidl.spec.whatwg.org/#Exposed"},
"8c27c1b9": {"dfnID":"8c27c1b9","dfnText":"start delay","external":true,"refSections":[{"refs":[{"id":"ref-for-start-delay"}],"title":"3.5. Animator Effect"},{"refs":[{"id":"ref-for-start-delay\u2460"}],"title":"5.3. Worklet Animation Timing and Sync Model"}],"url":"https://drafts.csswg.org/web-animations#start-delay"},
"8c800cdf": {"dfnID":"8c800cdf","dfnText":"double","external":true,"refSections":[{"refs":[{"id":"ref-for-idl-double"},{"id":"ref-for-idl-double\u2460"}],"title":"3.5. Animator Effect"}],"url":"https://webidl.spec.whatwg.org/#idl-double"},
"8f36f887": {"dfnID":"8f36f887","dfnText":"play state","external":true,"refSections":[{"refs":[{"id":"ref-for-play-state"}],"title":"5.1. Worklet Animation"},{"refs":[{"id":"ref-for-play-state\u2460"},{"id":"ref-for-play-state\u2461"}],"title":"5.3. Worklet Animation Timing and Sync Model"},{"refs":[{"id":"ref-for-play-state\u2462"},{"id":"ref-for-play-state\u2463"}],"title":"5.4. Web Animations Overrides"}],"url":"https://drafts.csswg.org/web-animations#play-state"},
"8f9dc1f2": {"dfnID":"8f9dc1f2","dfnText":"getComputedTiming()","external":true,"refSections":[{"refs":[{"id":"ref-for-dom-animationeffect-getcomputedtiming"}],"title":"5.3. Worklet Animation Timing and Sync Model"}],"url":"https://drafts.csswg.org/web-animations-2/#dom-animationeffect-getcomputedtiming"},
"8fd40ad9": {"dfnID":"8fd40ad9","dfnText":"converting","external":true,"refSections":[{"refs":[{"id":"ref-for-es-type-mapping"},{"id":"ref-for-es-type-mapping\u2460"}],"title":"3.4. Registering an Animator Definition"}],"url":"https://heycam.github.io/webidl/#es-type-mapping"},
"91d37919": {"dfnID":"91d37919","dfnText":"effect value","external":true,"refSections":[{"refs":[{"id":"ref-for-effect-value"}],"title":"5.3. Worklet Animation Timing and Sync Model"}],"url":"https://drafts.csswg.org/web-animations#effect-value"},
"9213678e": {"dfnID":"9213678e","dfnText":"<ident>","external":true,"refSections":[{"refs":[{"id":"ref-for-typedef-ident"}],"title":"3.3. Animator Definition"},{"refs":[{"id":"ref-for-typedef-ident\u2460"}],"title":"3.4. Registering an Animator Definition"}],"url":"https://drafts.csswg.org/css-values-4/#typedef-ident"},
"984221ca": {"dfnID":"984221ca","dfnText":"struct","external":true,"refSections":[{"refs":[{"id":"ref-for-struct"},{"id":"ref-for-struct\u2460"}],"title":"3.3. Animator Definition"},{"refs":[{"id":"ref-for-struct\u2461"}],"title":"4. Animator Instance"}],"url":"https://infra.spec.whatwg.org/#struct"},
"9a517a7d": {"dfnID":"9a517a7d","dfnText":"queue a task","external":true,"refSections":[{"refs":[{"id":"ref-for-queue-a-task"}],"title":"3.4. Registering an Animator Definition"},{"refs":[{"id":"ref-for-queue-a-task\u2460"},{"id":"ref-for-queue-a-task\u2461"}],"title":"4.4. Migrating an Animator Instance"},{"refs":[{"id":"ref-for-queue-a-task\u2462"},{"id":"ref-for-queue-a-task\u2463"}],"title":"5.3. Worklet Animation Timing and Sync Model"},{"refs":[{"id":"ref-for-queue-a-task\u2464"},{"id":"ref-for-queue-a-task\u2465"}],"title":"5.4. Web Animations Overrides"}],"url":"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task"},
"9cce47fd": {"dfnID":"9cce47fd","dfnText":"sequence","external":true,"refSections":[{"refs":[{"id":"ref-for-idl-sequence"}],"title":"5.1. Worklet Animation"},{"refs":[{"id":"ref-for-idl-sequence\u2460"}],"title":"6.1. Worklet Group Effect"}],"url":"https://webidl.spec.whatwg.org/#idl-sequence"},
"9d770734": {"dfnID":"9d770734","dfnText":"update the timing properties of an animation effect","external":true,"refSections":[{"refs":[{"id":"ref-for-update-the-timing-properties-of-an-animation-effect"}],"title":"5.4. Web Animations Overrides"}],"url":"https://drafts.csswg.org/web-animations#update-the-timing-properties-of-an-animation-effect"},
"9f683089": {"dfnID":"9f683089","dfnText":"inherited time","external":true,"refSections":[{"refs":[{"id":"ref-for-inherited-time"}],"title":"5.1. Worklet Animation"}],"url":"https://drafts.csswg.org/web-animations#inherited-time"},
"a3e56dcb": {"dfnID":"a3e56dcb","dfnText":"Function","external":true,"refSections":[{"refs":[{"id":"ref-for-Function"},{"id":"ref-for-Function\u2460"}],"title":"3.3. Animator Definition"},{"refs":[{"id":"ref-for-Function\u2461"},{"id":"ref-for-Function\u2462"}],"title":"3.4. Registering an Animator Definition"}],"url":"https://heycam.github.io/webidl/#Function"},
"a43c62be": {"dfnID":"a43c62be","dfnText":"CSS","external":true,"refSections":[{"refs":[{"id":"ref-for-namespacedef-css"}],"title":"2. Animation Worklet"}],"url":"https://drafts.csswg.org/cssom-1/#namespacedef-css"},
"a4f1c52f": {"dfnID":"a4f1c52f","dfnText":"paused","external":true,"refSections":[{"refs":[{"id":"ref-for-paused"},{"id":"ref-for-paused\u2460"}],"title":"5.4. Web Animations Overrides"}],"url":"https://drafts.csswg.org/web-animations#paused"},
"a5c91173": {"dfnID":"a5c91173","dfnText":"SameObject","external":true,"refSections":[{"refs":[{"id":"ref-for-SameObject"}],"title":"2. Animation Worklet"}],"url":"https://webidl.spec.whatwg.org/#SameObject"},
"a973e0fe": {"dfnID":"a973e0fe","dfnText":"document","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-document"}],"title":"3.3. Animator Definition"},{"refs":[{"id":"ref-for-concept-document\u2460"},{"id":"ref-for-concept-document\u2461"}],"title":"3.4. Registering an Animator Definition"},{"refs":[{"id":"ref-for-concept-document\u2462"}],"title":"5.2. Creating a Worklet Animation"}],"url":"https://dom.spec.whatwg.org/#concept-document"},
"ac129361": {"dfnID":"ac129361","dfnText":"target property","external":true,"refSections":[{"refs":[{"id":"ref-for-target-property"}],"title":"5.3. Worklet Animation Timing and Sync Model"}],"url":"https://drafts.csswg.org/web-animations#target-property"},
"animate-function": {"dfnID":"animate-function","dfnText":"animate function","external":false,"refSections":[{"refs":[{"id":"ref-for-animate-function"}],"title":"3.4. Registering an Animator Definition"},{"refs":[{"id":"ref-for-animate-function\u2460"}],"title":"4.2. Running Animators"}],"url":"#animate-function"},
"animation-animator-name": {"dfnID":"animation-animator-name","dfnText":"animation animator name","external":false,"refSections":[{"refs":[{"id":"ref-for-animation-animator-name"}],"title":"5.2. Creating a Worklet Animation"},{"refs":[{"id":"ref-for-animation-animator-name\u2460"}],"title":"5.4. Web Animations Overrides"}],"url":"#animation-animator-name"},
"animation-worklet": {"dfnID":"animation-worklet","dfnText":"Animation Worklet","external":false,"refSections":[{"refs":[{"id":"ref-for-animation-worklet"}],"title":"1. Introduction"},{"refs":[{"id":"ref-for-animation-worklet\u2460"}],"title":"1.1. Relationship to the Web Animations API"},{"refs":[{"id":"ref-for-animation-worklet\u2461"}],"title":"3.2. Stateful Animator"}],"url":"#animation-worklet"},
"animationworkletglobalscope": {"dfnID":"animationworkletglobalscope","dfnText":"AnimationWorkletGlobalScope","external":false,"refSections":[{"refs":[{"id":"ref-for-animationworkletglobalscope"},{"id":"ref-for-animationworkletglobalscope\u2460"}],"title":"2. Animation Worklet"},{"refs":[{"id":"ref-for-animationworkletglobalscope\u2461"}],"title":"3. Animator"},{"refs":[{"id":"ref-for-animationworkletglobalscope\u2462"},{"id":"ref-for-animationworkletglobalscope\u2463"},{"id":"ref-for-animationworkletglobalscope\u2464"}],"title":"3.4. Registering an Animator Definition"},{"refs":[{"id":"ref-for-animationworkletglobalscope\u2465"}],"title":"3.5. Animator Effect"},{"refs":[{"id":"ref-for-animationworkletglobalscope\u2466"}],"title":"4. Animator Instance"},{"refs":[{"id":"ref-for-animationworkletglobalscope\u2467"},{"id":"ref-for-animationworkletglobalscope\u2468"},{"id":"ref-for-animationworkletglobalscope\u2460\u24ea"}],"title":"4.1. Creating an Animator Instance"},{"refs":[{"id":"ref-for-animationworkletglobalscope\u2460\u2460"},{"id":"ref-for-animationworkletglobalscope\u2460\u2461"}],"title":"4.4. Migrating an Animator Instance"},{"refs":[{"id":"ref-for-animationworkletglobalscope\u2460\u2462"}],"title":"5.3. Worklet Animation Timing and Sync Model"},{"refs":[{"id":"ref-for-animationworkletglobalscope\u2460\u2463"},{"id":"ref-for-animationworkletglobalscope\u2460\u2464"}],"title":"5.4. Web Animations Overrides"}],"url":"#animationworkletglobalscope"},
"animator": {"dfnID":"animator","dfnText":"Animator","external":false,"refSections":[{"refs":[{"id":"ref-for-animator"}],"title":"4. Animator Instance"}],"url":"#animator"},
"animator-current-time": {"dfnID":"animator-current-time","dfnText":"animator current time","external":false,"refSections":[{"refs":[{"id":"ref-for-animator-current-time"}],"title":"4.1. Creating an Animator Instance"},{"refs":[{"id":"ref-for-animator-current-time\u2460"}],"title":"4.2. Running Animators"},{"refs":[{"id":"ref-for-animator-current-time\u2461"}],"title":"5.3. Worklet Animation Timing and Sync Model"}],"url":"#animator-current-time"},
"animator-definition": {"dfnID":"animator-definition","dfnText":"animator definition","external":false,"refSections":[{"refs":[{"id":"ref-for-animator-definition"}],"title":"3.3. Animator Definition"},{"refs":[{"id":"ref-for-animator-definition\u2460"}],"title":"3.4. Registering an Animator Definition"},{"refs":[{"id":"ref-for-animator-definition\u2461"}],"title":"4. Animator Instance"},{"refs":[{"id":"ref-for-animator-definition\u2462"}],"title":"5.1. Worklet Animation"}],"url":"#animator-definition"},
"animator-definition-stateful-flag": {"dfnID":"animator-definition-stateful-flag","dfnText":"stateful flag","external":false,"refSections":[{"refs":[{"id":"ref-for-animator-definition-stateful-flag"}],"title":"3.3. Animator Definition"},{"refs":[{"id":"ref-for-animator-definition-stateful-flag\u2460"},{"id":"ref-for-animator-definition-stateful-flag\u2461"}],"title":"3.4. Registering an Animator Definition"},{"refs":[{"id":"ref-for-animator-definition-stateful-flag\u2462"}],"title":"4.4. Migrating an Animator Instance"}],"url":"#animator-definition-stateful-flag"},
"animator-definitions": {"dfnID":"animator-definitions","dfnText":"animator definitions","external":false,"refSections":[{"refs":[{"id":"ref-for-animator-definitions"}],"title":"3.4. Registering an Animator Definition"},{"refs":[{"id":"ref-for-animator-definitions\u2460"}],"title":"4.1. Creating an Animator Instance"},{"refs":[{"id":"ref-for-animator-definitions\u2461"}],"title":"4.2. Running Animators"},{"refs":[{"id":"ref-for-animator-definitions\u2462"}],"title":"4.4. Migrating an Animator Instance"}],"url":"#animator-definitions"},
"animator-effect": {"dfnID":"animator-effect","dfnText":"Animator Effect","external":false,"refSections":[{"refs":[{"id":"ref-for-animator-effect"}],"title":"3.5. Animator Effect"},{"refs":[{"id":"ref-for-animator-effect\u2460"}],"title":"4. Animator Instance"}],"url":"#animator-effect"},
"animator-instance": {"dfnID":"animator-instance","dfnText":"animator instance","external":false,"refSections":[{"refs":[{"id":"ref-for-animator-instance"}],"title":"3.2. Stateful Animator"},{"refs":[{"id":"ref-for-animator-instance\u2460"}],"title":"4. Animator Instance"},{"refs":[{"id":"ref-for-animator-instance\u2461"},{"id":"ref-for-animator-instance\u2462"},{"id":"ref-for-animator-instance\u2463"}],"title":"4.1. Creating an Animator Instance"},{"refs":[{"id":"ref-for-animator-instance\u2464"},{"id":"ref-for-animator-instance\u2465"},{"id":"ref-for-animator-instance\u2466"}],"title":"4.2. Running Animators"},{"refs":[{"id":"ref-for-animator-instance\u2467"}],"title":"4.5. Requesting Animation Frames"},{"refs":[{"id":"ref-for-animator-instance\u2468"},{"id":"ref-for-animator-instance\u2460\u24ea"},{"id":"ref-for-animator-instance\u2460\u2460"}],"title":"5.1. Worklet Animation"},{"refs":[{"id":"ref-for-animator-instance\u2460\u2461"},{"id":"ref-for-animator-instance\u2460\u2462"},{"id":"ref-for-animator-instance\u2460\u2463"},{"id":"ref-for-animator-instance\u2460\u2464"}],"title":"5.3. Worklet Animation Timing and Sync Model"},{"refs":[{"id":"ref-for-animator-instance\u2460\u2465"}],"title":"5.4. Web Animations Overrides"}],"url":"#animator-instance"},
"animator-instance-set": {"dfnID":"animator-instance-set","dfnText":"animator instance set","external":false,"refSections":[{"refs":[{"id":"ref-for-animator-instance-set"}],"title":"4.1. Creating an Animator Instance"},{"refs":[{"id":"ref-for-animator-instance-set\u2460"},{"id":"ref-for-animator-instance-set\u2461"}],"title":"4.2. Running Animators"},{"refs":[{"id":"ref-for-animator-instance-set\u2462"}],"title":"4.3. Removing an Animator Instance"},{"refs":[{"id":"ref-for-animator-instance-set\u2463"}],"title":"5.3. Worklet Animation Timing and Sync Model"}],"url":"#animator-instance-set"},
"animator-name": {"dfnID":"animator-name","dfnText":"animator name","external":false,"refSections":[{"refs":[{"id":"ref-for-animator-name"}],"title":"3.4. Registering an Animator Definition"},{"refs":[{"id":"ref-for-animator-name\u2460"}],"title":"4. Animator Instance"},{"refs":[{"id":"ref-for-animator-name\u2461"}],"title":"4.1. Creating an Animator Instance"},{"refs":[{"id":"ref-for-animator-name\u2462"}],"title":"4.2. Running Animators"},{"refs":[{"id":"ref-for-animator-name\u2463"},{"id":"ref-for-animator-name\u2464"}],"title":"4.4. Migrating an Animator Instance"}],"url":"#animator-name"},
"animator-serialized-options": {"dfnID":"animator-serialized-options","dfnText":"animator serialized options","external":false,"refSections":[{"refs":[{"id":"ref-for-animator-serialized-options"}],"title":"4.1. Creating an Animator Instance"},{"refs":[{"id":"ref-for-animator-serialized-options\u2460"}],"title":"4.4. Migrating an Animator Instance"}],"url":"#animator-serialized-options"},
"animator-timeline": {"dfnID":"animator-timeline","dfnText":"animator timeline","external":false,"refSections":[{"refs":[{"id":"ref-for-animator-timeline"}],"title":"4.1. Creating an Animator Instance"},{"refs":[{"id":"ref-for-animator-timeline\u2460"}],"title":"4.4. Migrating an Animator Instance"}],"url":"#animator-timeline"},
"associate-animator-instance-of-worklet-animation": {"dfnID":"associate-animator-instance-of-worklet-animation","dfnText":"associate animator instance of worklet animation","external":false,"refSections":[{"refs":[{"id":"ref-for-associate-animator-instance-of-worklet-animation"},{"id":"ref-for-associate-animator-instance-of-worklet-animation\u2460"}],"title":"5.4. Web Animations Overrides"}],"url":"#associate-animator-instance-of-worklet-animation"},
"b516749f": {"dfnID":"b516749f","dfnText":"Animation","external":true,"refSections":[{"refs":[{"id":"ref-for-animation"}],"title":"1.1. Relationship to the Web Animations API"},{"refs":[{"id":"ref-for-animation\u2460"},{"id":"ref-for-animation\u2461"}],"title":"5.1. Worklet Animation"}],"url":"https://drafts.csswg.org/web-animations-1/#animation"},
"ba972ac6": {"dfnID":"ba972ac6","dfnText":"active","external":true,"refSections":[{"refs":[{"id":"ref-for-active"}],"title":"5.4. Web Animations Overrides"}],"url":"https://drafts.csswg.org/web-animations#active"},
"c019dd86": {"dfnID":"c019dd86","dfnText":"iteration start","external":true,"refSections":[{"refs":[{"id":"ref-for-iteration-start"}],"title":"3.5. Animator Effect"},{"refs":[{"id":"ref-for-iteration-start\u2460"}],"title":"5.3. Worklet Animation Timing and Sync Model"}],"url":"https://drafts.csswg.org/web-animations#iteration-start"},
"c02f2e75": {"dfnID":"c02f2e75","dfnText":"NotSupportedError","external":true,"refSections":[{"refs":[{"id":"ref-for-notsupportederror"}],"title":"3.4. Registering an Animator Definition"}],"url":"https://heycam.github.io/webidl/#notsupportederror"},
"c26f57fa": {"dfnID":"c26f57fa","dfnText":"set the current time","external":true,"refSections":[{"refs":[{"id":"ref-for-set-the-current-time"}],"title":"5.4. Web Animations Overrides"}],"url":"https://drafts.csswg.org/web-animations#set-the-current-time"},
"c2c87b36": {"dfnID":"c2c87b36","dfnText":"timeline","external":true,"refSections":[{"refs":[{"id":"ref-for-timeline"}],"title":"4. Animator Instance"},{"refs":[{"id":"ref-for-timeline\u2460"}],"title":"4.5. Requesting Animation Frames"},{"refs":[{"id":"ref-for-timeline\u2461"},{"id":"ref-for-timeline\u2462"}],"title":"5.1. Worklet Animation"},{"refs":[{"id":"ref-for-timeline\u2463"}],"title":"5.4. Web Animations Overrides"}],"url":"https://drafts.csswg.org/web-animations#timeline"},
"callbackdef-animatorinstanceconstructor": {"dfnID":"callbackdef-animatorinstanceconstructor","dfnText":"AnimatorInstanceConstructor","external":false,"refSections":[{"refs":[{"id":"ref-for-callbackdef-animatorinstanceconstructor"}],"title":"2. Animation Worklet"},{"refs":[{"id":"ref-for-callbackdef-animatorinstanceconstructor\u2460"}],"title":"3.3. Animator Definition"}],"url":"#callbackdef-animatorinstanceconstructor"},
"ce3d2bbb": {"dfnID":"ce3d2bbb","dfnText":"current global object","external":true,"refSections":[{"refs":[{"id":"ref-for-current-global-object"}],"title":"5.2. Creating a Worklet Animation"}],"url":"https://html.spec.whatwg.org/multipage/webappapis.html#current-global-object"},
"class-constructor": {"dfnID":"class-constructor","dfnText":"class constructor","external":false,"refSections":[{"refs":[{"id":"ref-for-class-constructor"}],"title":"3.4. Registering an Animator Definition"},{"refs":[{"id":"ref-for-class-constructor\u2460"}],"title":"4.1. Creating an Animator Instance"}],"url":"#class-constructor"},
"corresponding-animator-instance": {"dfnID":"corresponding-animator-instance","dfnText":"corresponding animator instance","external":false,"refSections":[{"refs":[{"id":"ref-for-corresponding-animator-instance"},{"id":"ref-for-corresponding-animator-instance\u2460"}],"title":"5.1. Worklet Animation"},{"refs":[{"id":"ref-for-corresponding-animator-instance\u2461"},{"id":"ref-for-corresponding-animator-instance\u2462"}],"title":"5.3. Worklet Animation Timing and Sync Model"},{"refs":[{"id":"ref-for-corresponding-animator-instance\u2463"},{"id":"ref-for-corresponding-animator-instance\u2464"},{"id":"ref-for-corresponding-animator-instance\u2465"},{"id":"ref-for-corresponding-animator-instance\u2466"},{"id":"ref-for-corresponding-animator-instance\u2467"},{"id":"ref-for-corresponding-animator-instance\u2468"}],"title":"5.4. Web Animations Overrides"},{"refs":[{"id":"ref-for-corresponding-animator-instance\u2460\u24ea"}],"title":"6.1. Worklet Group Effect"}],"url":"#corresponding-animator-instance"},
"corresponding-effect": {"dfnID":"corresponding-effect","dfnText":"corresponding effect","external":false,"refSections":[{"refs":[{"id":"ref-for-corresponding-effect"}],"title":"4.1. Creating an Animator Instance"},{"refs":[{"id":"ref-for-corresponding-effect\u2460"},{"id":"ref-for-corresponding-effect\u2461"}],"title":"5.3. Worklet Animation Timing and Sync Model"}],"url":"#corresponding-effect"},
"create-a-new-animator-instance": {"dfnID":"create-a-new-animator-instance","dfnText":"create a new animator instance","external":false,"refSections":[{"refs":[{"id":"ref-for-create-a-new-animator-instance"}],"title":"4.4. Migrating an Animator Instance"},{"refs":[{"id":"ref-for-create-a-new-animator-instance\u2460"}],"title":"5.4. Web Animations Overrides"}],"url":"#create-a-new-animator-instance"},
"d337c9c5": {"dfnID":"d337c9c5","dfnText":"iteration count","external":true,"refSections":[{"refs":[{"id":"ref-for-iteration-count"}],"title":"3.5. Animator Effect"},{"refs":[{"id":"ref-for-iteration-count\u2460"}],"title":"5.3. Worklet Animation Timing and Sync Model"}],"url":"https://drafts.csswg.org/web-animations#iteration-count"},
"d506ba10": {"dfnID":"d506ba10","dfnText":"animation class","external":true,"refSections":[{"refs":[{"id":"ref-for-animation-class"}],"title":"5.5. Effect Stack and Composite Order"}],"url":"https://drafts.csswg.org/web-animations#animation-class"},
"d56bd241": {"dfnID":"d56bd241","dfnText":"IsConstructor","external":true,"refSections":[{"refs":[{"id":"ref-for-sec-isconstructor"}],"title":"3.4. Registering an Animator Definition"}],"url":"https://tc39.github.io/ecma262/#sec-isconstructor"},
"d84d7676": {"dfnID":"d84d7676","dfnText":"replace state","external":true,"refSections":[{"refs":[{"id":"ref-for-replace-state"}],"title":"5.4. Web Animations Overrides"}],"url":"https://drafts.csswg.org/web-animations#replace-state"},
"dce7aeba": {"dfnID":"dce7aeba","dfnText":"idle","external":true,"refSections":[{"refs":[{"id":"ref-for-idle"},{"id":"ref-for-idle\u2460"}],"title":"5.4. Web Animations Overrides"}],"url":"https://drafts.csswg.org/web-animations#idle"},
"dd130a0f": {"dfnID":"dd130a0f","dfnText":"AnimationEffect","external":true,"refSections":[{"refs":[{"id":"ref-for-animationeffect"}],"title":"3.5. Animator Effect"},{"refs":[{"id":"ref-for-animationeffect\u2460"},{"id":"ref-for-animationeffect\u2461"}],"title":"5.1. Worklet Animation"},{"refs":[{"id":"ref-for-animationeffect\u2462"},{"id":"ref-for-animationeffect\u2463"}],"title":"5.2. Creating a Worklet Animation"}],"url":"https://drafts.csswg.org/web-animations-1/#animationeffect"},
"dd26ac30": {"dfnID":"dd26ac30","dfnText":"child effect","external":true,"refSections":[{"refs":[{"id":"ref-for-child-effect"},{"id":"ref-for-child-effect\u2460"}],"title":"6.1. Worklet Group Effect"}],"url":"https://w3c.github.io/web-animations/level-2/#child-effect"},
"disassociate-animator-instance-of-worklet-animation": {"dfnID":"disassociate-animator-instance-of-worklet-animation","dfnText":"disassociate animator instance of worklet animation","external":false,"refSections":[{"refs":[{"id":"ref-for-disassociate-animator-instance-of-worklet-animation"},{"id":"ref-for-disassociate-animator-instance-of-worklet-animation\u2460"}],"title":"5.4. Web Animations Overrides"}],"url":"#disassociate-animator-instance-of-worklet-animation"},
"document-animator-definition": {"dfnID":"document-animator-definition","dfnText":"document animator definition","external":false,"refSections":[{"refs":[{"id":"ref-for-document-animator-definition"}],"title":"3.4. Registering an Animator Definition"}],"url":"#document-animator-definition"},
"document-animator-definition-stateful-flag": {"dfnID":"document-animator-definition-stateful-flag","dfnText":"stateful flag","external":false,"refSections":[{"refs":[{"id":"ref-for-document-animator-definition-stateful-flag"}],"title":"3.4. Registering an Animator Definition"}],"url":"#document-animator-definition-stateful-flag"},
"document-animator-definitions": {"dfnID":"document-animator-definitions","dfnText":"document animator definitions","external":false,"refSections":[{"refs":[{"id":"ref-for-document-animator-definitions"}],"title":"3.4. Registering an Animator Definition"},{"refs":[{"id":"ref-for-document-animator-definitions\u2460"}],"title":"5.2. Creating a Worklet Animation"}],"url":"#document-animator-definitions"},
"dom-animationworkletglobalscope-registeranimator": {"dfnID":"dom-animationworkletglobalscope-registeranimator","dfnText":"registerAnimator(name, animatorCtor)","external":false,"refSections":[{"refs":[{"id":"ref-for-dom-animationworkletglobalscope-registeranimator"}],"title":"2. Animation Worklet"},{"refs":[{"id":"ref-for-dom-animationworkletglobalscope-registeranimator\u2460"},{"id":"ref-for-dom-animationworkletglobalscope-registeranimator\u2461"}],"title":"3.4. Registering an Animator Definition"}],"url":"#dom-animationworkletglobalscope-registeranimator"},
"dom-animationworkletglobalscope-registeranimator-name-animatorctor-animatorctor": {"dfnID":"dom-animationworkletglobalscope-registeranimator-name-animatorctor-animatorctor","dfnText":"animatorCtor","external":false,"refSections":[],"url":"#dom-animationworkletglobalscope-registeranimator-name-animatorctor-animatorctor"},
"dom-animationworkletglobalscope-registeranimator-name-animatorctor-name": {"dfnID":"dom-animationworkletglobalscope-registeranimator-name-animatorctor-name","dfnText":"name","external":false,"refSections":[],"url":"#dom-animationworkletglobalscope-registeranimator-name-animatorctor-name"},
"dom-animatorinstanceconstructor-options": {"dfnID":"dom-animatorinstanceconstructor-options","dfnText":"options","external":false,"refSections":[],"url":"#dom-animatorinstanceconstructor-options"},
"dom-animatorinstanceconstructor-state": {"dfnID":"dom-animatorinstanceconstructor-state","dfnText":"state","external":false,"refSections":[],"url":"#dom-animatorinstanceconstructor-state"},
"dom-css-animationworklet": {"dfnID":"dom-css-animationworklet","dfnText":"animationWorklet","external":false,"refSections":[{"refs":[{"id":"ref-for-dom-css-animationworklet"},{"id":"ref-for-dom-css-animationworklet\u2460"},{"id":"ref-for-dom-css-animationworklet\u2461"}],"title":"2. Animation Worklet"}],"url":"#dom-css-animationworklet"},
"dom-workletanimation-animatorname": {"dfnID":"dom-workletanimation-animatorname","dfnText":"animatorName","external":false,"refSections":[],"url":"#dom-workletanimation-animatorname"},
"dom-workletanimation-workletanimation": {"dfnID":"dom-workletanimation-workletanimation","dfnText":"WorkletAnimation(animatorName, effects, timeline, options)","external":false,"refSections":[{"refs":[{"id":"ref-for-dom-workletanimation-workletanimation"}],"title":"5.1. Worklet Animation"}],"url":"#dom-workletanimation-workletanimation"},
"dom-workletanimation-workletanimation-animatorname-effects-timeline-options-animatorname": {"dfnID":"dom-workletanimation-workletanimation-animatorname-effects-timeline-options-animatorname","dfnText":"animatorName","external":false,"refSections":[],"url":"#dom-workletanimation-workletanimation-animatorname-effects-timeline-options-animatorname"},
"dom-workletanimation-workletanimation-animatorname-effects-timeline-options-effects": {"dfnID":"dom-workletanimation-workletanimation-animatorname-effects-timeline-options-effects","dfnText":"effects","external":false,"refSections":[],"url":"#dom-workletanimation-workletanimation-animatorname-effects-timeline-options-effects"},
"dom-workletanimation-workletanimation-animatorname-effects-timeline-options-options": {"dfnID":"dom-workletanimation-workletanimation-animatorname-effects-timeline-options-options","dfnText":"options","external":false,"refSections":[],"url":"#dom-workletanimation-workletanimation-animatorname-effects-timeline-options-options"},
"dom-workletanimation-workletanimation-animatorname-effects-timeline-options-timeline": {"dfnID":"dom-workletanimation-workletanimation-animatorname-effects-timeline-options-timeline","dfnText":"timeline","external":false,"refSections":[],"url":"#dom-workletanimation-workletanimation-animatorname-effects-timeline-options-timeline"},
"dom-workletanimationeffect-getcomputedtiming": {"dfnID":"dom-workletanimationeffect-getcomputedtiming","dfnText":"getComputedTiming()","external":false,"refSections":[{"refs":[{"id":"ref-for-dom-workletanimationeffect-getcomputedtiming"}],"title":"3.5. Animator Effect"}],"url":"#dom-workletanimationeffect-getcomputedtiming"},
"dom-workletanimationeffect-gettiming": {"dfnID":"dom-workletanimationeffect-gettiming","dfnText":"getTiming()","external":false,"refSections":[{"refs":[{"id":"ref-for-dom-workletanimationeffect-gettiming"}],"title":"3.5. Animator Effect"}],"url":"#dom-workletanimationeffect-gettiming"},
"dom-workletanimationeffect-localtime": {"dfnID":"dom-workletanimationeffect-localtime","dfnText":"localTime","external":false,"refSections":[{"refs":[{"id":"ref-for-dom-workletanimationeffect-localtime"}],"title":"3.5. Animator Effect"}],"url":"#dom-workletanimationeffect-localtime"},
"dom-workletgroupeffect-getchildren": {"dfnID":"dom-workletgroupeffect-getchildren","dfnText":"getChildren","external":false,"refSections":[],"url":"#dom-workletgroupeffect-getchildren"},
"e0d69e88": {"dfnID":"e0d69e88","dfnText":"ready","external":true,"refSections":[{"refs":[{"id":"ref-for-ready"},{"id":"ref-for-ready\u2460"}],"title":"5.4. Web Animations Overrides"}],"url":"https://drafts.csswg.org/web-animations#ready"},
"effect": {"dfnID":"effect","dfnText":"effect","external":false,"refSections":[{"refs":[{"id":"ref-for-effect"}],"title":"4.1. Creating an Animator Instance"},{"refs":[{"id":"ref-for-effect\u2460"}],"title":"4.2. Running Animators"},{"refs":[{"id":"ref-for-effect\u2461"}],"title":"4.4. Migrating an Animator Instance"},{"refs":[{"id":"ref-for-effect\u2462"},{"id":"ref-for-effect\u2463"}],"title":"5.3. Worklet Animation Timing and Sync Model"}],"url":"#effect"},
"f5d14679": {"dfnID":"f5d14679","dfnText":"current time","external":true,"refSections":[{"refs":[{"id":"ref-for-current-time"},{"id":"ref-for-current-time\u2460"}],"title":"4.5. Requesting Animation Frames"},{"refs":[{"id":"ref-for-current-time\u2461"}],"title":"5.1. Worklet Animation"},{"refs":[{"id":"ref-for-current-time\u2462"},{"id":"ref-for-current-time\u2463"},{"id":"ref-for-current-time\u2464"}],"title":"5.3. Worklet Animation Timing and Sync Model"}],"url":"https://drafts.csswg.org/web-animations#current-time"},
"f9ffa42e": {"dfnID":"f9ffa42e","dfnText":"ScrollTimeline","external":true,"refSections":[{"refs":[{"id":"ref-for-scrolltimeline"}],"title":"6.2. ScrollTimeline"}],"url":"https://wicg.github.io/scroll-animations/#scrolltimeline"},
"fb0f7c22": {"dfnID":"fb0f7c22","dfnText":"local time","external":true,"refSections":[{"refs":[{"id":"ref-for-local-time"},{"id":"ref-for-local-time\u2460"},{"id":"ref-for-local-time\u2461"},{"id":"ref-for-local-time\u2462"}],"title":"3.5. Animator Effect"},{"refs":[{"id":"ref-for-local-time\u2463"},{"id":"ref-for-local-time\u2464"}],"title":"5.1. Worklet Animation"},{"refs":[{"id":"ref-for-local-time\u2465"},{"id":"ref-for-local-time\u2466"}],"title":"5.3. Worklet Animation Timing and Sync Model"},{"refs":[{"id":"ref-for-local-time\u2467"},{"id":"ref-for-local-time\u2468"}],"title":"6.1. Worklet Group Effect"}],"url":"https://drafts.csswg.org/web-animations#local-time"},
"ff44116e": {"dfnID":"ff44116e","dfnText":"effect stack","external":true,"refSections":[{"refs":[{"id":"ref-for-effect-stack"}],"title":"5.5. Effect Stack and Composite Order"}],"url":"https://drafts.csswg.org/web-animations#effect-stack"},
"ff806377": {"dfnID":"ff806377","dfnText":"constructing","external":true,"refSections":[{"refs":[{"id":"ref-for-construct-a-callback-function"},{"id":"ref-for-construct-a-callback-function\u2460"}],"title":"4.1. Creating an Animator Instance"}],"url":"https://heycam.github.io/webidl/#construct-a-callback-function"},
"frame-requested-flag": {"dfnID":"frame-requested-flag","dfnText":"frame requested flag","external":false,"refSections":[{"refs":[{"id":"ref-for-frame-requested-flag"}],"title":"4. Animator Instance"},{"refs":[{"id":"ref-for-frame-requested-flag\u2460"}],"title":"4.1. Creating an Animator Instance"},{"refs":[{"id":"ref-for-frame-requested-flag\u2461"},{"id":"ref-for-frame-requested-flag\u2462"}],"title":"4.2. Running Animators"},{"refs":[{"id":"ref-for-frame-requested-flag\u2463"},{"id":"ref-for-frame-requested-flag\u2464"}],"title":"4.5. Requesting Animation Frames"}],"url":"#frame-requested-flag"},
"migrate-an-animator-instance": {"dfnID":"migrate-an-animator-instance","dfnText":"migrate an animator instance","external":false,"refSections":[{"refs":[{"id":"ref-for-migrate-an-animator-instance"}],"title":"3.2. Stateful Animator"}],"url":"#migrate-an-animator-instance"},
"remove-an-animator-instance": {"dfnID":"remove-an-animator-instance","dfnText":"remove an animator instance","external":false,"refSections":[{"refs":[{"id":"ref-for-remove-an-animator-instance"}],"title":"4.4. Migrating an Animator Instance"},{"refs":[{"id":"ref-for-remove-an-animator-instance\u2460"}],"title":"5.4. Web Animations Overrides"}],"url":"#remove-an-animator-instance"},
"run-animators": {"dfnID":"run-animators","dfnText":"run animators","external":false,"refSections":[{"refs":[{"id":"ref-for-run-animators"},{"id":"ref-for-run-animators\u2460"}],"title":"4.2. Running Animators"},{"refs":[{"id":"ref-for-run-animators\u2461"}],"title":"4.5. Requesting Animation Frames"}],"url":"#run-animators"},
"serialized-options": {"dfnID":"serialized-options","dfnText":"serialized options","external":false,"refSections":[{"refs":[{"id":"ref-for-serialized-options"}],"title":"5.2. Creating a Worklet Animation"},{"refs":[{"id":"ref-for-serialized-options\u2460"}],"title":"5.4. Web Animations Overrides"}],"url":"#serialized-options"},
"set-animator-instance-of-worklet-animation": {"dfnID":"set-animator-instance-of-worklet-animation","dfnText":"set animator instance of worklet animation","external":false,"refSections":[{"refs":[{"id":"ref-for-set-animator-instance-of-worklet-animation"}],"title":"5.2. Creating a Worklet Animation"},{"refs":[{"id":"ref-for-set-animator-instance-of-worklet-animation\u2460"},{"id":"ref-for-set-animator-instance-of-worklet-animation\u2461"}],"title":"5.4. Web Animations Overrides"}],"url":"#set-animator-instance-of-worklet-animation"},
"state-function": {"dfnID":"state-function","dfnText":"state function","external":false,"refSections":[{"refs":[{"id":"ref-for-state-function"}],"title":"3.2. Stateful Animator"},{"refs":[{"id":"ref-for-state-function\u2460"}],"title":"3.4. Registering an Animator Definition"},{"refs":[{"id":"ref-for-state-function\u2461"}],"title":"4.4. Migrating an Animator Instance"}],"url":"#state-function"},
"stateful-animator": {"dfnID":"stateful-animator","dfnText":"Stateful Animator","external":false,"refSections":[{"refs":[{"id":"ref-for-stateful-animator"}],"title":"3. Animator"}],"url":"#stateful-animator"},
"stateful-animator-definition": {"dfnID":"stateful-animator-definition","dfnText":"stateful animator definition","external":false,"refSections":[{"refs":[{"id":"ref-for-stateful-animator-definition"}],"title":"3.4. Registering an Animator Definition"},{"refs":[{"id":"ref-for-stateful-animator-definition\u2460"}],"title":"4. Animator Instance"}],"url":"#stateful-animator-definition"},
"stateful-animator-instance": {"dfnID":"stateful-animator-instance","dfnText":"stateful animator instance","external":false,"refSections":[{"refs":[{"id":"ref-for-stateful-animator-instance"}],"title":"4.4. Migrating an Animator Instance"}],"url":"#stateful-animator-instance"},
"stateless-animator": {"dfnID":"stateless-animator","dfnText":"Stateless Animator","external":false,"refSections":[{"refs":[{"id":"ref-for-stateless-animator"}],"title":"3. Animator"},{"refs":[{"id":"ref-for-stateless-animator\u2460"},{"id":"ref-for-stateless-animator\u2461"}],"title":"3.1. Stateless Animator"}],"url":"#stateless-animator"},
"sync-animation-timings-to-worklet": {"dfnID":"sync-animation-timings-to-worklet","dfnText":"sync animation timings to worklet","external":false,"refSections":[{"refs":[{"id":"ref-for-sync-animation-timings-to-worklet"},{"id":"ref-for-sync-animation-timings-to-worklet\u2460"}],"title":"5.4. Web Animations Overrides"}],"url":"#sync-animation-timings-to-worklet"},
"sync-local-times-to-document": {"dfnID":"sync-local-times-to-document","dfnText":"sync local times to document","external":false,"refSections":[{"refs":[{"id":"ref-for-sync-local-times-to-document"}],"title":"4.2. Running Animators"}],"url":"#sync-local-times-to-document"},
"sync-requested-flag": {"dfnID":"sync-requested-flag","dfnText":"sync requested flag","external":false,"refSections":[{"refs":[{"id":"ref-for-sync-requested-flag"}],"title":"3.5. Animator Effect"},{"refs":[{"id":"ref-for-sync-requested-flag\u2460"}],"title":"4.1. Creating an Animator Instance"},{"refs":[{"id":"ref-for-sync-requested-flag\u2461"}],"title":"4.2. Running Animators"},{"refs":[{"id":"ref-for-sync-requested-flag\u2462"},{"id":"ref-for-sync-requested-flag\u2463"}],"title":"5.3. Worklet Animation Timing and Sync Model"}],"url":"#sync-requested-flag"},
"worklet-animation": {"dfnID":"worklet-animation","dfnText":"Worklet animation","external":false,"refSections":[{"refs":[{"id":"ref-for-worklet-animation"},{"id":"ref-for-worklet-animation\u2460"}],"title":"4. Animator Instance"},{"refs":[{"id":"ref-for-worklet-animation\u2461"}],"title":"4.5. Requesting Animation Frames"},{"refs":[{"id":"ref-for-worklet-animation\u2462"},{"id":"ref-for-worklet-animation\u2463"},{"id":"ref-for-worklet-animation\u2464"}],"title":"5.1. Worklet Animation"},{"refs":[{"id":"ref-for-worklet-animation\u2465"},{"id":"ref-for-worklet-animation\u2466"},{"id":"ref-for-worklet-animation\u2467"},{"id":"ref-for-worklet-animation\u2468"}],"title":"5.3. Worklet Animation Timing and Sync Model"},{"refs":[{"id":"ref-for-worklet-animation\u2460\u24ea"},{"id":"ref-for-worklet-animation\u2460\u2460"}],"title":"5.4. Web Animations Overrides"},{"refs":[{"id":"ref-for-worklet-animation\u2460\u2461"}],"title":"5.5. Effect Stack and Composite Order"},{"refs":[{"id":"ref-for-worklet-animation\u2460\u2462"}],"title":"6.1. Worklet Group Effect"},{"refs":[{"id":"ref-for-worklet-animation\u2460\u2463"}],"title":"6.2. ScrollTimeline"}],"url":"#worklet-animation"},
"workletanimation": {"dfnID":"workletanimation","dfnText":"WorkletAnimation","external":false,"refSections":[{"refs":[{"id":"ref-for-workletanimation"},{"id":"ref-for-workletanimation\u2460"}],"title":"3. Animator"},{"refs":[{"id":"ref-for-workletanimation\u2461"},{"id":"ref-for-workletanimation\u2462"}],"title":"5.2. Creating a Worklet Animation"}],"url":"#workletanimation"},
"workletanimationeffect": {"dfnID":"workletanimationeffect","dfnText":"WorkletAnimationEffect","external":false,"refSections":[{"refs":[{"id":"ref-for-workletanimationeffect"},{"id":"ref-for-workletanimationeffect\u2460"}],"title":"3.5. Animator Effect"},{"refs":[{"id":"ref-for-workletanimationeffect\u2461"}],"title":"4.1. Creating an Animator Instance"},{"refs":[{"id":"ref-for-workletanimationeffect\u2462"}],"title":"6.1. Worklet Group Effect"}],"url":"#workletanimationeffect"},
"workletgroupeffect": {"dfnID":"workletgroupeffect","dfnText":"WorkletGroupEffect","external":false,"refSections":[{"refs":[{"id":"ref-for-workletgroupeffect"}],"title":"5.2. Creating a Worklet Animation"},{"refs":[{"id":"ref-for-workletgroupeffect\u2460"},{"id":"ref-for-workletgroupeffect\u2461"},{"id":"ref-for-workletgroupeffect\u2462"}],"title":"6.1. Worklet Group Effect"}],"url":"#workletgroupeffect"},
};

document.addEventListener("DOMContentLoaded", ()=>{
    genAllDfnPanels();

    document.body.addEventListener("click", (e) => {
        // If not handled already, just hide all dfn panels.
        hideAllDfnPanels();
    });
});

window.addEventListener("resize", () => {
    // Pin any visible dfn panel
    queryAll(".dfn-panel.on, .dfn-panel.activated").forEach(el=>positionDfnPanel(el));
});

function genAllDfnPanels() {
    for(const panelData of Object.values(dfnPanelData)) {
        const dfnID = panelData.dfnID;
        const dfn = document.getElementById(dfnID);
        if(!dfn) {
            console.log(`Can't find dfn#${dfnID}.`, panelData);
            continue;
        }
        dfn.panelData = panelData;
        insertDfnPopupAction(dfn);
    }
}

function genDfnPanel(dfn, { dfnID, url, dfnText, refSections, external }) {
    const dfnPanel = mk.aside({
        class: "dfn-panel on",
        id: `infopanel-for-${dfnID}`,
        "data-for": dfnID,
        "aria-labelled-by":`infopaneltitle-for-${dfnID}`,
        },
        mk.span({id:`infopaneltitle-for-${dfnID}`, style:"display:none"},
            `Info about the '${dfnText}' ${external?"external":""} reference.`),
        mk.a({href:url, class:"dfn-link"}, url),
        refSections.length == 0 ? [] :
            mk.b({}, "Referenced in:"),
            mk.ul({},
                ...refSections.map(section=>
                    mk.li({},
                        ...section.refs.map((ref, refI)=>
                            [
                                mk.a({ href: `#${ref.id}` },
                                    (refI == 0) ? section.title : `(${refI + 1})`
                                ),
                                " ",
                            ]
                        ),
                    ),
                ),
            ),
        genLinkingSyntaxes(dfn),
    );

    dfnPanel.addEventListener('click', (event) => {
        if (event.target.nodeName == 'A') {
            scrollToTargetAndHighlight(event);
            pinDfnPanel(dfnPanel);
        }
        event.stopPropagation();
        refocusOnTarget(event);
    });
    dfnPanel.addEventListener('keydown', (event) => {
        if(event.keyCode == 27) { // Escape key
            hideDfnPanel({dfnPanel});
            event.stopPropagation();
            event.preventDefault();
        }
    });

    dfnPanel.dfn = dfn;
    dfn.dfnPanel = dfnPanel;
    return dfnPanel;
}



function hideAllDfnPanels() {
    // Delete the currently-active dfn panel.
    queryAll(".dfn-panel").forEach(dfnPanel=>hideDfnPanel({dfnPanel}));
}

function showDfnPanel(dfn) {
    hideAllDfnPanels(); // Only display one at a time.

    dfn.setAttribute("aria-expanded", "true");

    const dfnPanel = genDfnPanel(dfn, dfn.panelData);

    // Give the dfn a unique tabindex, and then
    // give all the tabbable panel bits successive indexes.
    let tabIndex = 100;
    dfn.tabIndex = tabIndex++;
    const tabbable = dfnPanel.querySelectorAll(":is(a, button)");
    for (const el of tabbable) {
        el.tabIndex = tabIndex++;
    }

    append(document.body, dfnPanel);
    positionDfnPanel(dfnPanel);
}

function positionDfnPanel(dfnPanel) {
    const dfn = dfnPanel.dfn;
    const dfnPos = getBounds(dfn);
    dfnPanel.style.top = dfnPos.bottom + "px";
    dfnPanel.style.left = dfnPos.left + "px";

    const panelPos = dfnPanel.getBoundingClientRect();
    const panelMargin = 8;
    const maxRight = document.body.parentNode.clientWidth - panelMargin;
    if (panelPos.right > maxRight) {
        const overflowAmount = panelPos.right - maxRight;
        const newLeft = Math.max(panelMargin, dfnPos.left - overflowAmount);
        dfnPanel.style.left = newLeft + "px";
    }
}

function pinDfnPanel(dfnPanel) {
    // Switch it to "activated" state, which pins it.
    dfnPanel.classList.add("activated");
    dfnPanel.style.position = "fixed";
    dfnPanel.style.left = null;
    dfnPanel.style.top = null;
}

function hideDfnPanel({dfn, dfnPanel}) {
    if(!dfnPanel) dfnPanel = dfn.dfnPanel;
    if(!dfn) dfn = dfnPanel.dfn;
    dfn.dfnPanel = undefined;
    dfnPanel.dfn = undefined;
    dfn.setAttribute("aria-expanded", "false");
    dfn.tabIndex = undefined;
    dfnPanel.remove()
}

function toggleDfnPanel(dfn) {
    if(dfn.dfnPanel) {
        hideDfnPanel(dfn);
    } else {
        showDfnPanel(dfn);
    }
}

function insertDfnPopupAction(dfn) {
    dfn.setAttribute('role', 'button');
    dfn.setAttribute('aria-expanded', 'false')
    dfn.tabIndex = 0;
    dfn.classList.add('has-dfn-panel');
    dfn.addEventListener('click', (event) => {
        toggleDfnPanel(dfn);
        event.stopPropagation();
    });
    dfn.addEventListener('keypress', (event) => {
        const kc = event.keyCode;
        // 32->Space, 13->Enter
        if(kc == 32 || kc == 13) {
            toggleDfnPanel(dfn);
            event.stopPropagation();
            event.preventDefault();
        }
    });
}

function refocusOnTarget(event) {
    const target = event.target;
    setTimeout(() => {
        // Refocus on the event.target element.
        // This is needed after browser scrolls to the destination.
        target.focus();
    });
}

// TODO: shared util
// Returns the root-level absolute position {left and top} of element.
function getBounds(el, relativeTo=document.body) {
    const relativeRect = relativeTo.getBoundingClientRect();
    const elRect = el.getBoundingClientRect();
    const top = elRect.top - relativeRect.top;
    const left = elRect.left - relativeRect.left;
    return {
        top,
        left,
        bottom: top + elRect.height,
        right: left + elRect.width,
    }
}

function scrollToTargetAndHighlight(event) {
    let hash = event.target.hash;
    if (hash) {
        hash = decodeURIComponent(hash.substring(1));
        const dest = document.getElementById(hash);
        if (dest) {
            dest.classList.add('highlighted');
            setTimeout(() => dest.classList.remove('highlighted'), 1000);
        }
    }
}

// Functions, divided by link type, that wrap an autolink's
// contents with the appropriate outer syntax.
// Alternately, a string naming another type they format
// the same as.
function needsFor(type) {
    switch(type) {
        case "descriptor":
        case "value":
        case "element-attr":
        case "attr-value":
        case "element-state":
        case "method":
        case "constructor":
        case "argument":
        case "attribute":
        case "const":
        case "dict-member":
        case "event":
        case "enum-value":
        case "stringifier":
        case "serializer":
        case "iterator":
        case "maplike":
        case "setlike":
        case "state":
        case "mode":
        case "context":
        case "facet": return true;

        default: return false;
    }
}
function refusesFor(type) {
    switch(type) {
        case "property":
        case "element":
        case "interface":
        case "namespace":
        case "callback":
        case "dictionary":
        case "enum":
        case "exception":
        case "typedef":
        case "http-header":
        case "permission": return true;

        default: return false;
    }
}
function linkFormatterFromType(type) {
    switch(type) {
        case 'scheme':
        case 'permission':
        case 'dfn': return (text) => `[=${text}=]`;

        case 'abstract-op': return (text) => `[\$${text}\$]`;

        case 'function':
        case 'at-rule':
        case 'selector':
        case 'value': return (text) => `''${text}''`;

        case 'http-header': return (text) => `[:${text}:]`;

        case 'interface':
        case 'constructor':
        case 'method':
        case 'argument':
        case 'attribute':
        case 'callback':
        case 'dictionary':
        case 'dict-member':
        case 'enum':
        case 'enum-value':
        case 'exception':
        case 'const':
        case 'typedef':
        case 'stringifier':
        case 'serializer':
        case 'iterator':
        case 'maplike':
        case 'setlike':
        case 'extended-attribute':
        case 'event':
        case 'idl': return (text) => `{{${text}}}`;

        case 'element-state':
        case 'element-attr':
        case 'attr-value':
        case 'element': return (element) => `<{${element}}>`;

        case 'grammar': return (text) => `${text} (within a <pre class=prod>)`;

        case 'type': return (text)=> `<<${text}>>`;

        case 'descriptor':
        case 'property': return (text) => `'${text}'`;

        default: return;
    };
};

function genLinkingSyntaxes(dfn) {
    if(dfn.tagName != "DFN") return;

    const type = dfn.getAttribute('data-dfn-type');
    if(!type) {
        console.log(`<dfn> doesn't have a data-dfn-type:`, dfn);
        return [];
    }

    // Return a function that wraps link text based on the type
    const linkFormatter = linkFormatterFromType(type);
    if(!linkFormatter) {
        console.log(`<dfn> has an unknown data-dfn-type:`, dfn);
        return [];
    }

    let ltAlts;
    if(dfn.hasAttribute('data-lt')) {
        ltAlts = dfn.getAttribute('data-lt')
            .split("|")
            .map(x=>x.trim());
    } else {
        ltAlts = [dfn.textContent.trim()];
    }
    if(type == "type") {
        // lt of "<foo>", but "foo" is the interior;
        // <<foo/bar>> is how you write it with a for,
        // not <foo/<bar>> or whatever.
        for(var i = 0; i < ltAlts.length; i++) {
            const lt = ltAlts[i];
            const match = /<(.*)>/.exec(lt);
            if(match) { ltAlts[i] = match[1]; }
        }
    }

    let forAlts;
    if(dfn.hasAttribute('data-dfn-for')) {
        forAlts = dfn.getAttribute('data-dfn-for')
            .split(",")
            .map(x=>x.trim());
    } else {
        forAlts = [''];
    }

    let linkingSyntaxes = [];
    if(!needsFor(type)) {
        for(const lt of ltAlts) {
            linkingSyntaxes.push(linkFormatter(lt));
        }
    }
    if(!refusesFor(type)) {
        for(const f of forAlts) {
            linkingSyntaxes.push(linkFormatter(`${f}/${ltAlts[0]}`))
        }
    }
    return [
        mk.b({}, 'Possible linking syntaxes:'),
        mk.ul({},
            ...linkingSyntaxes.map(link => {
                const copyLink = async () =>
                    await navigator.clipboard.writeText(link);
                return mk.li({},
                    mk.div({ class: 'link-item' },
                        mk.button({
                            class: 'copy-icon', title: 'Copy',
                            type: 'button',
                            _onclick: copyLink,
                            tabindex: 0,
                        }, mk.span({ class: 'icon' }) ),
                        mk.span({}, link)
                    )
                );
            })
        )
    ];
}
}
</script>
<script>/* Boilerplate: script-ref-hints */
"use strict";
{
let refsData = {
"#animate-function": {"displayText":"animate function","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-animation-worklet","spec":"css-animation-worklet-1","status":"local","text":"animate function","type":"dfn","url":"#animate-function"},
"#animation-animator-name": {"displayText":"animation animator name","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-animation-worklet","spec":"css-animation-worklet-1","status":"local","text":"animation animator name","type":"dfn","url":"#animation-animator-name"},
"#animation-worklet": {"displayText":"animation worklet","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-animation-worklet","spec":"css-animation-worklet-1","status":"local","text":"animation worklet","type":"dfn","url":"#animation-worklet"},
"#animationworkletglobalscope": {"displayText":"AnimationWorkletGlobalScope","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-animation-worklet","spec":"css-animation-worklet-1","status":"local","text":"AnimationWorkletGlobalScope","type":"interface","url":"#animationworkletglobalscope"},
"#animator": {"displayText":"animator","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-animation-worklet","spec":"css-animation-worklet-1","status":"local","text":"animator","type":"dfn","url":"#animator"},
"#animator-current-time": {"displayText":"animator current time","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-animation-worklet","spec":"css-animation-worklet-1","status":"local","text":"animator current time","type":"dfn","url":"#animator-current-time"},
"#animator-definition": {"displayText":"animator definition","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-animation-worklet","spec":"css-animation-worklet-1","status":"local","text":"animator definition","type":"dfn","url":"#animator-definition"},
"#animator-definition-stateful-flag": {"displayText":"stateful flag","export":true,"for_":["animator definition"],"level":"1","normative":true,"shortname":"css-animation-worklet","spec":"css-animation-worklet-1","status":"local","text":"stateful flag","type":"dfn","url":"#animator-definition-stateful-flag"},
"#animator-definitions": {"displayText":"animator definitions","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-animation-worklet","spec":"css-animation-worklet-1","status":"local","text":"animator definitions","type":"dfn","url":"#animator-definitions"},
"#animator-effect": {"displayText":"animator effect","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-animation-worklet","spec":"css-animation-worklet-1","status":"local","text":"animator effect","type":"dfn","url":"#animator-effect"},
"#animator-instance": {"displayText":"animator instance","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-animation-worklet","spec":"css-animation-worklet-1","status":"local","text":"animator instance","type":"dfn","url":"#animator-instance"},
"#animator-instance-set": {"displayText":"animator instance set","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-animation-worklet","spec":"css-animation-worklet-1","status":"local","text":"animator instance set","type":"dfn","url":"#animator-instance-set"},
"#animator-name": {"displayText":"animator name","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-animation-worklet","spec":"css-animation-worklet-1","status":"local","text":"animator name","type":"dfn","url":"#animator-name"},
"#animator-serialized-options": {"displayText":"animator serialized options","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-animation-worklet","spec":"css-animation-worklet-1","status":"local","text":"animator serialized options","type":"dfn","url":"#animator-serialized-options"},
"#animator-timeline": {"displayText":"animator timeline","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-animation-worklet","spec":"css-animation-worklet-1","status":"local","text":"animator timeline","type":"dfn","url":"#animator-timeline"},
"#associate-animator-instance-of-worklet-animation": {"displayText":"associate animator instance of worklet animation","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-animation-worklet","spec":"css-animation-worklet-1","status":"local","text":"associate animator instance of worklet animation","type":"dfn","url":"#associate-animator-instance-of-worklet-animation"},
"#callbackdef-animatorinstanceconstructor": {"displayText":"AnimatorInstanceConstructor","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-animation-worklet","spec":"css-animation-worklet-1","status":"local","text":"AnimatorInstanceConstructor","type":"callback","url":"#callbackdef-animatorinstanceconstructor"},
"#class-constructor": {"displayText":"class constructor","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-animation-worklet","spec":"css-animation-worklet-1","status":"local","text":"class constructor","type":"dfn","url":"#class-constructor"},
"#corresponding-animator-instance": {"displayText":"corresponding animator instance","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-animation-worklet","spec":"css-animation-worklet-1","status":"local","text":"corresponding animator instance","type":"dfn","url":"#corresponding-animator-instance"},
"#corresponding-effect": {"displayText":"corresponding effect","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-animation-worklet","spec":"css-animation-worklet-1","status":"local","text":"corresponding effect","type":"dfn","url":"#corresponding-effect"},
"#create-a-new-animator-instance": {"displayText":"create a new animator instance","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-animation-worklet","spec":"css-animation-worklet-1","status":"local","text":"create a new animator instance","type":"dfn","url":"#create-a-new-animator-instance"},
"#disassociate-animator-instance-of-worklet-animation": {"displayText":"disassociate animator instance of worklet animation","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-animation-worklet","spec":"css-animation-worklet-1","status":"local","text":"disassociate animator instance of worklet animation","type":"dfn","url":"#disassociate-animator-instance-of-worklet-animation"},
"#document-animator-definition": {"displayText":"document animator definition","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-animation-worklet","spec":"css-animation-worklet-1","status":"local","text":"document animator definition","type":"dfn","url":"#document-animator-definition"},
"#document-animator-definition-stateful-flag": {"displayText":"stateful flag","export":true,"for_":["document animator definition"],"level":"1","normative":true,"shortname":"css-animation-worklet","spec":"css-animation-worklet-1","status":"local","text":"stateful flag","type":"dfn","url":"#document-animator-definition-stateful-flag"},
"#document-animator-definitions": {"displayText":"document animator definitions","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-animation-worklet","spec":"css-animation-worklet-1","status":"local","text":"document animator definitions","type":"dfn","url":"#document-animator-definitions"},
"#dom-animationworkletglobalscope-registeranimator": {"displayText":"registerAnimator(name, animatorCtor)","export":true,"for_":["AnimationWorkletGlobalScope"],"level":"1","normative":true,"shortname":"css-animation-worklet","spec":"css-animation-worklet-1","status":"local","text":"registerAnimator(name, animatorCtor)","type":"method","url":"#dom-animationworkletglobalscope-registeranimator"},
"#dom-css-animationworklet": {"displayText":"animationWorklet","export":true,"for_":["CSS"],"level":"1","normative":true,"shortname":"css-animation-worklet","spec":"css-animation-worklet-1","status":"local","text":"animationWorklet","type":"attribute","url":"#dom-css-animationworklet"},
"#dom-workletanimation-workletanimation": {"displayText":"WorkletAnimation(animatorName, effects, timeline, options)","export":true,"for_":["WorkletAnimation"],"level":"1","normative":true,"shortname":"css-animation-worklet","spec":"css-animation-worklet-1","status":"local","text":"WorkletAnimation(animatorName, effects, timeline, options)","type":"constructor","url":"#dom-workletanimation-workletanimation"},
"#dom-workletanimationeffect-getcomputedtiming": {"displayText":"getComputedTiming()","export":true,"for_":["WorkletAnimationEffect"],"level":"1","normative":true,"shortname":"css-animation-worklet","spec":"css-animation-worklet-1","status":"local","text":"getComputedTiming()","type":"method","url":"#dom-workletanimationeffect-getcomputedtiming"},
"#dom-workletanimationeffect-gettiming": {"displayText":"getTiming()","export":true,"for_":["WorkletAnimationEffect"],"level":"1","normative":true,"shortname":"css-animation-worklet","spec":"css-animation-worklet-1","status":"local","text":"getTiming()","type":"method","url":"#dom-workletanimationeffect-gettiming"},
"#dom-workletanimationeffect-localtime": {"displayText":"localTime","export":true,"for_":["WorkletAnimationEffect"],"level":"1","normative":true,"shortname":"css-animation-worklet","spec":"css-animation-worklet-1","status":"local","text":"localTime","type":"attribute","url":"#dom-workletanimationeffect-localtime"},
"#effect": {"displayText":"effect","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-animation-worklet","spec":"css-animation-worklet-1","status":"local","text":"effect","type":"dfn","url":"#effect"},
"#frame-requested-flag": {"displayText":"frame requested flag","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-animation-worklet","spec":"css-animation-worklet-1","status":"local","text":"frame requested flag","type":"dfn","url":"#frame-requested-flag"},
"#migrate-an-animator-instance": {"displayText":"migrate an animator instance","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-animation-worklet","spec":"css-animation-worklet-1","status":"local","text":"migrate an animator instance","type":"dfn","url":"#migrate-an-animator-instance"},
"#remove-an-animator-instance": {"displayText":"remove an animator instance","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-animation-worklet","spec":"css-animation-worklet-1","status":"local","text":"remove an animator instance","type":"dfn","url":"#remove-an-animator-instance"},
"#run-animators": {"displayText":"run animators","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-animation-worklet","spec":"css-animation-worklet-1","status":"local","text":"run animators","type":"dfn","url":"#run-animators"},
"#serialized-options": {"displayText":"serialized options","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-animation-worklet","spec":"css-animation-worklet-1","status":"local","text":"serialized options","type":"dfn","url":"#serialized-options"},
"#set-animator-instance-of-worklet-animation": {"displayText":"set animator instance of worklet animation","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-animation-worklet","spec":"css-animation-worklet-1","status":"local","text":"set animator instance of worklet animation","type":"dfn","url":"#set-animator-instance-of-worklet-animation"},
"#state-function": {"displayText":"state function","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-animation-worklet","spec":"css-animation-worklet-1","status":"local","text":"state function","type":"dfn","url":"#state-function"},
"#stateful-animator": {"displayText":"stateful animator","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-animation-worklet","spec":"css-animation-worklet-1","status":"local","text":"stateful animator","type":"dfn","url":"#stateful-animator"},
"#stateful-animator-definition": {"displayText":"stateful animator definition","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-animation-worklet","spec":"css-animation-worklet-1","status":"local","text":"stateful animator definition","type":"dfn","url":"#stateful-animator-definition"},
"#stateful-animator-instance": {"displayText":"stateful animator instance","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-animation-worklet","spec":"css-animation-worklet-1","status":"local","text":"stateful animator instance","type":"dfn","url":"#stateful-animator-instance"},
"#stateless-animator": {"displayText":"stateless animator","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-animation-worklet","spec":"css-animation-worklet-1","status":"local","text":"stateless animator","type":"dfn","url":"#stateless-animator"},
"#sync-animation-timings-to-worklet": {"displayText":"sync animation timings to worklet","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-animation-worklet","spec":"css-animation-worklet-1","status":"local","text":"sync animation timings to worklet","type":"dfn","url":"#sync-animation-timings-to-worklet"},
"#sync-local-times-to-document": {"displayText":"sync local times to document","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-animation-worklet","spec":"css-animation-worklet-1","status":"local","text":"sync local times to document","type":"dfn","url":"#sync-local-times-to-document"},
"#sync-requested-flag": {"displayText":"sync requested flag","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-animation-worklet","spec":"css-animation-worklet-1","status":"local","text":"sync requested flag","type":"dfn","url":"#sync-requested-flag"},
"#worklet-animation": {"displayText":"worklet animation","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-animation-worklet","spec":"css-animation-worklet-1","status":"local","text":"worklet animation","type":"dfn","url":"#worklet-animation"},
"#workletanimation": {"displayText":"WorkletAnimation","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-animation-worklet","spec":"css-animation-worklet-1","status":"local","text":"WorkletAnimation","type":"interface","url":"#workletanimation"},
"#workletanimationeffect": {"displayText":"WorkletAnimationEffect","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-animation-worklet","spec":"css-animation-worklet-1","status":"local","text":"WorkletAnimationEffect","type":"interface","url":"#workletanimationeffect"},
"#workletgroupeffect": {"displayText":"WorkletGroupEffect","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-animation-worklet","spec":"css-animation-worklet-1","status":"local","text":"WorkletGroupEffect","type":"interface","url":"#workletgroupeffect"},
"http://w3c.github.io/html/infrastructure.html#structureddeserialize": {"displayText":"structureddeserialize","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-animation-worklet","spec":"","status":"anchor-block","text":"structureddeserialize","type":"dfn","url":"http://w3c.github.io/html/infrastructure.html#structureddeserialize"},
"http://w3c.github.io/html/infrastructure.html#structuredserialize": {"displayText":"structuredserialize","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-animation-worklet","spec":"","status":"anchor-block","text":"structuredserialize","type":"dfn","url":"http://w3c.github.io/html/infrastructure.html#structuredserialize"},
"https://dom.spec.whatwg.org/#concept-document": {"displayText":"document","export":true,"for_":[],"level":"1","normative":true,"shortname":"dom","spec":"dom","status":"current","text":"document","type":"dfn","url":"https://dom.spec.whatwg.org/#concept-document"},
"https://dom.spec.whatwg.org/#document": {"displayText":"Document","export":true,"for_":[],"level":"1","normative":true,"shortname":"dom","spec":"dom","status":"current","text":"Document","type":"interface","url":"https://dom.spec.whatwg.org/#document"},
"https://drafts.csswg.org/css-transitions-1/#transition-start-time": {"displayText":"start time","export":true,"for_":["transition"],"level":"1","normative":true,"shortname":"css-transitions","spec":"css-transitions-1","status":"current","text":"start time","type":"dfn","url":"https://drafts.csswg.org/css-transitions-1/#transition-start-time"},
"https://drafts.csswg.org/css-values-4/#typedef-ident": {"displayText":"<ident>","export":true,"for_":[],"level":"4","normative":true,"shortname":"css-values","spec":"css-values-4","status":"current","text":"<ident>","type":"type","url":"https://drafts.csswg.org/css-values-4/#typedef-ident"},
"https://drafts.csswg.org/cssom-1/#namespacedef-css": {"displayText":"CSS","export":true,"for_":[],"level":"1","normative":true,"shortname":"cssom","spec":"cssom-1","status":"current","text":"CSS","type":"namespace","url":"https://drafts.csswg.org/cssom-1/#namespacedef-css"},
"https://drafts.csswg.org/web-animations#active": {"displayText":"active","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-animation-worklet","spec":"","status":"anchor-block","text":"active","type":"dfn","url":"https://drafts.csswg.org/web-animations#active"},
"https://drafts.csswg.org/web-animations#animation-class": {"displayText":"animation class","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-animation-worklet","spec":"","status":"anchor-block","text":"animation class","type":"dfn","url":"https://drafts.csswg.org/web-animations#animation-class"},
"https://drafts.csswg.org/web-animations#animation-effect": {"displayText":"animation effect","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-animation-worklet","spec":"","status":"anchor-block","text":"animation effect","type":"dfn","url":"https://drafts.csswg.org/web-animations#animation-effect"},
"https://drafts.csswg.org/web-animations#concept-animation": {"displayText":"animation","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-animation-worklet","spec":"","status":"anchor-block","text":"animation","type":"dfn","url":"https://drafts.csswg.org/web-animations#concept-animation"},
"https://drafts.csswg.org/web-animations#current-time": {"displayText":"current time","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-animation-worklet","spec":"","status":"anchor-block","text":"current time","type":"dfn","url":"https://drafts.csswg.org/web-animations#current-time"},
"https://drafts.csswg.org/web-animations#effect-stack": {"displayText":"effect stack","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-animation-worklet","spec":"","status":"anchor-block","text":"effect stack","type":"dfn","url":"https://drafts.csswg.org/web-animations#effect-stack"},
"https://drafts.csswg.org/web-animations#effect-value": {"displayText":"effect value","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-animation-worklet","spec":"","status":"anchor-block","text":"effect value","type":"dfn","url":"https://drafts.csswg.org/web-animations#effect-value"},
"https://drafts.csswg.org/web-animations#end-delay": {"displayText":"end delay","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-animation-worklet","spec":"","status":"anchor-block","text":"end delay","type":"dfn","url":"https://drafts.csswg.org/web-animations#end-delay"},
"https://drafts.csswg.org/web-animations#fill-mode": {"displayText":"fill mode","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-animation-worklet","spec":"","status":"anchor-block","text":"fill mode","type":"dfn","url":"https://drafts.csswg.org/web-animations#fill-mode"},
"https://drafts.csswg.org/web-animations#finished": {"displayText":"finished","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-animation-worklet","spec":"","status":"anchor-block","text":"finished","type":"dfn","url":"https://drafts.csswg.org/web-animations#finished"},
"https://drafts.csswg.org/web-animations#idle": {"displayText":"idle","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-animation-worklet","spec":"","status":"anchor-block","text":"idle","type":"dfn","url":"https://drafts.csswg.org/web-animations#idle"},
"https://drafts.csswg.org/web-animations#inherited-time": {"displayText":"inherited time","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-animation-worklet","spec":"","status":"anchor-block","text":"inherited time","type":"dfn","url":"https://drafts.csswg.org/web-animations#inherited-time"},
"https://drafts.csswg.org/web-animations#iteration-count": {"displayText":"iteration count","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-animation-worklet","spec":"","status":"anchor-block","text":"iteration count","type":"dfn","url":"https://drafts.csswg.org/web-animations#iteration-count"},
"https://drafts.csswg.org/web-animations#iteration-duration": {"displayText":"iteration duration","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-animation-worklet","spec":"","status":"anchor-block","text":"iteration duration","type":"dfn","url":"https://drafts.csswg.org/web-animations#iteration-duration"},
"https://drafts.csswg.org/web-animations#iteration-start": {"displayText":"iteration start","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-animation-worklet","spec":"","status":"anchor-block","text":"iteration start","type":"dfn","url":"https://drafts.csswg.org/web-animations#iteration-start"},
"https://drafts.csswg.org/web-animations#local-time": {"displayText":"local time","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-animation-worklet","spec":"","status":"anchor-block","text":"local time","type":"dfn","url":"https://drafts.csswg.org/web-animations#local-time"},
"https://drafts.csswg.org/web-animations#paused": {"displayText":"paused","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-animation-worklet","spec":"","status":"anchor-block","text":"paused","type":"dfn","url":"https://drafts.csswg.org/web-animations#paused"},
"https://drafts.csswg.org/web-animations#persisted": {"displayText":"persisted","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-animation-worklet","spec":"","status":"anchor-block","text":"persisted","type":"dfn","url":"https://drafts.csswg.org/web-animations#persisted"},
"https://drafts.csswg.org/web-animations#play-state": {"displayText":"play state","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-animation-worklet","spec":"","status":"anchor-block","text":"play state","type":"dfn","url":"https://drafts.csswg.org/web-animations#play-state"},
"https://drafts.csswg.org/web-animations#playback-direction": {"displayText":"playback direction","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-animation-worklet","spec":"","status":"anchor-block","text":"playback direction","type":"dfn","url":"https://drafts.csswg.org/web-animations#playback-direction"},
"https://drafts.csswg.org/web-animations#playback-rate": {"displayText":"playback rate","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-animation-worklet","spec":"","status":"anchor-block","text":"playback rate","type":"dfn","url":"https://drafts.csswg.org/web-animations#playback-rate"},
"https://drafts.csswg.org/web-animations#ready": {"displayText":"ready","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-animation-worklet","spec":"","status":"anchor-block","text":"ready","type":"dfn","url":"https://drafts.csswg.org/web-animations#ready"},
"https://drafts.csswg.org/web-animations#removed": {"displayText":"removed","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-animation-worklet","spec":"","status":"anchor-block","text":"removed","type":"dfn","url":"https://drafts.csswg.org/web-animations#removed"},
"https://drafts.csswg.org/web-animations#replace-state": {"displayText":"replace state","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-animation-worklet","spec":"","status":"anchor-block","text":"replace state","type":"dfn","url":"https://drafts.csswg.org/web-animations#replace-state"},
"https://drafts.csswg.org/web-animations#running": {"displayText":"running","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-animation-worklet","spec":"","status":"anchor-block","text":"running","type":"dfn","url":"https://drafts.csswg.org/web-animations#running"},
"https://drafts.csswg.org/web-animations#set-the-current-time": {"displayText":"set the current time","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-animation-worklet","spec":"","status":"anchor-block","text":"set the current time","type":"dfn","url":"https://drafts.csswg.org/web-animations#set-the-current-time"},
"https://drafts.csswg.org/web-animations#set-the-start-time": {"displayText":"set the start time","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-animation-worklet","spec":"","status":"anchor-block","text":"set the start time","type":"dfn","url":"https://drafts.csswg.org/web-animations#set-the-start-time"},
"https://drafts.csswg.org/web-animations#set-the-target-effect-of-an-animation": {"displayText":"set the target effect of an animation","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-animation-worklet","spec":"","status":"anchor-block","text":"set the target effect of an animation","type":"dfn","url":"https://drafts.csswg.org/web-animations#set-the-target-effect-of-an-animation"},
"https://drafts.csswg.org/web-animations#set-the-timeline-of-an-animation": {"displayText":"set the timeline of an animation","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-animation-worklet","spec":"","status":"anchor-block","text":"set the timeline of an animation","type":"dfn","url":"https://drafts.csswg.org/web-animations#set-the-timeline-of-an-animation"},
"https://drafts.csswg.org/web-animations#start-delay": {"displayText":"start delay","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-animation-worklet","spec":"","status":"anchor-block","text":"start delay","type":"dfn","url":"https://drafts.csswg.org/web-animations#start-delay"},
"https://drafts.csswg.org/web-animations#target-property": {"displayText":"target property","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-animation-worklet","spec":"","status":"anchor-block","text":"target property","type":"dfn","url":"https://drafts.csswg.org/web-animations#target-property"},
"https://drafts.csswg.org/web-animations#the-documents-default-timeline": {"displayText":"default document timeline","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-animation-worklet","spec":"","status":"anchor-block","text":"default document timeline","type":"dfn","url":"https://drafts.csswg.org/web-animations#the-documents-default-timeline"},
"https://drafts.csswg.org/web-animations#timeline": {"displayText":"timeline","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-animation-worklet","spec":"","status":"anchor-block","text":"timeline","type":"dfn","url":"https://drafts.csswg.org/web-animations#timeline"},
"https://drafts.csswg.org/web-animations#timing-function": {"displayText":"timing function","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-animation-worklet","spec":"","status":"anchor-block","text":"timing function","type":"dfn","url":"https://drafts.csswg.org/web-animations#timing-function"},
"https://drafts.csswg.org/web-animations#update-the-timing-properties-of-an-animation-effect": {"displayText":"update the timing properties of an animation effect","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-animation-worklet","spec":"","status":"anchor-block","text":"update the timing properties of an animation effect","type":"dfn","url":"https://drafts.csswg.org/web-animations#update-the-timing-properties-of-an-animation-effect"},
"https://drafts.csswg.org/web-animations-1/#animation": {"displayText":"Animation","export":true,"for_":[],"level":"1","normative":true,"shortname":"web-animations","spec":"web-animations-1","status":"current","text":"Animation","type":"interface","url":"https://drafts.csswg.org/web-animations-1/#animation"},
"https://drafts.csswg.org/web-animations-1/#animationeffect": {"displayText":"AnimationEffect","export":true,"for_":[],"level":"1","normative":true,"shortname":"web-animations","spec":"web-animations-1","status":"current","text":"AnimationEffect","type":"interface","url":"https://drafts.csswg.org/web-animations-1/#animationeffect"},
"https://drafts.csswg.org/web-animations-1/#animationtimeline": {"displayText":"AnimationTimeline","export":true,"for_":[],"level":"1","normative":true,"shortname":"web-animations","spec":"web-animations-1","status":"current","text":"AnimationTimeline","type":"interface","url":"https://drafts.csswg.org/web-animations-1/#animationtimeline"},
"https://drafts.csswg.org/web-animations-1/#dictdef-computedeffecttiming": {"displayText":"ComputedEffectTiming","export":true,"for_":[],"level":"1","normative":true,"shortname":"web-animations","spec":"web-animations-1","status":"current","text":"ComputedEffectTiming","type":"dictionary","url":"https://drafts.csswg.org/web-animations-1/#dictdef-computedeffecttiming"},
"https://drafts.csswg.org/web-animations-1/#dictdef-effecttiming": {"displayText":"EffectTiming","export":true,"for_":[],"level":"1","normative":true,"shortname":"web-animations","spec":"web-animations-1","status":"current","text":"EffectTiming","type":"dictionary","url":"https://drafts.csswg.org/web-animations-1/#dictdef-effecttiming"},
"https://drafts.csswg.org/web-animations-1/#dom-animation-finish": {"displayText":"finish()","export":true,"for_":["Animation"],"level":"1","normative":true,"shortname":"web-animations","spec":"web-animations-1","status":"current","text":"finish()","type":"method","url":"https://drafts.csswg.org/web-animations-1/#dom-animation-finish"},
"https://drafts.csswg.org/web-animations-1/#dom-animationeffect-updatetiming": {"displayText":"updateTiming()","export":true,"for_":["AnimationEffect"],"level":"1","normative":true,"shortname":"web-animations","spec":"web-animations-1","status":"current","text":"updateTiming()","type":"method","url":"https://drafts.csswg.org/web-animations-1/#dom-animationeffect-updatetiming"},
"https://drafts.csswg.org/web-animations-2/#dom-animationeffect-getcomputedtiming": {"displayText":"getComputedTiming()","export":true,"for_":["AnimationEffect"],"level":"2","normative":true,"shortname":"web-animations","spec":"web-animations-2","status":"current","text":"getComputedTiming()","type":"method","url":"https://drafts.csswg.org/web-animations-2/#dom-animationeffect-getcomputedtiming"},
"https://heycam.github.io/webidl/#Function": {"displayText":"Function","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-animation-worklet","spec":"","status":"anchor-block","text":"function","type":"dfn","url":"https://heycam.github.io/webidl/#Function"},
"https://heycam.github.io/webidl/#construct-a-callback-function": {"displayText":"constructing","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-animation-worklet","spec":"","status":"anchor-block","text":"constructing","type":"dfn","url":"https://heycam.github.io/webidl/#construct-a-callback-function"},
"https://heycam.github.io/webidl/#dfn-callback-this-value": {"displayText":"callback this value","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-animation-worklet","spec":"","status":"anchor-block","text":"callback this value","type":"dfn","url":"https://heycam.github.io/webidl/#dfn-callback-this-value"},
"https://heycam.github.io/webidl/#dfn-throw": {"displayText":"throw","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-animation-worklet","spec":"","status":"anchor-block","text":"throw","type":"dfn","url":"https://heycam.github.io/webidl/#dfn-throw"},
"https://heycam.github.io/webidl/#es-type-mapping": {"displayText":"converting","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-animation-worklet","spec":"","status":"anchor-block","text":"converting","type":"dfn","url":"https://heycam.github.io/webidl/#es-type-mapping"},
"https://heycam.github.io/webidl/#invoke-a-callback-function": {"displayText":"Invoke","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-animation-worklet","spec":"","status":"anchor-block","text":"invoke","type":"dfn","url":"https://heycam.github.io/webidl/#invoke-a-callback-function"},
"https://heycam.github.io/webidl/#notsupportederror": {"displayText":"NotSupportedError","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-animation-worklet","spec":"","status":"anchor-block","text":"notsupportederror","type":"dfn","url":"https://heycam.github.io/webidl/#notsupportederror"},
"https://html.spec.whatwg.org/#run-the-animation-frame-callbacks": {"displayText":"running the animation frame callbacks","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-animation-worklet","spec":"","status":"anchor-block","text":"running the animation frame callbacks","type":"dfn","url":"https://html.spec.whatwg.org/#run-the-animation-frame-callbacks"},
"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window": {"displayText":"Window","export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"Window","type":"interface","url":"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window"},
"https://html.spec.whatwg.org/multipage/webappapis.html#current-global-object": {"displayText":"current global object","export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"current global object","type":"dfn","url":"https://html.spec.whatwg.org/multipage/webappapis.html#current-global-object"},
"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task": {"displayText":"queue a task","export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"queue a task","type":"dfn","url":"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task"},
"https://html.spec.whatwg.org/multipage/worklets.html#worklet": {"displayText":"Worklet","export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"Worklet","type":"interface","url":"https://html.spec.whatwg.org/multipage/worklets.html#worklet"},
"https://html.spec.whatwg.org/multipage/worklets.html#worklet-global-scope-type": {"displayText":"worklet global scope type","export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"worklet global scope type","type":"dfn","url":"https://html.spec.whatwg.org/multipage/worklets.html#worklet-global-scope-type"},
"https://html.spec.whatwg.org/multipage/worklets.html#workletglobalscope": {"displayText":"WorkletGlobalScope","export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"WorkletGlobalScope","type":"interface","url":"https://html.spec.whatwg.org/multipage/worklets.html#workletglobalscope"},
"https://infra.spec.whatwg.org/#list": {"displayText":"list","export":true,"for_":[],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"list","type":"dfn","url":"https://infra.spec.whatwg.org/#list"},
"https://infra.spec.whatwg.org/#map-exists": {"displayText":"exist","export":true,"for_":["map"],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"exist","type":"dfn","url":"https://infra.spec.whatwg.org/#map-exists"},
"https://infra.spec.whatwg.org/#map-get": {"displayText":"get","export":true,"for_":["map"],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"get","type":"dfn","url":"https://infra.spec.whatwg.org/#map-get"},
"https://infra.spec.whatwg.org/#map-set": {"displayText":"set","export":true,"for_":["map"],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"set","type":"dfn","url":"https://infra.spec.whatwg.org/#map-set"},
"https://infra.spec.whatwg.org/#ordered-map": {"displayText":"map","export":true,"for_":[],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"map","type":"dfn","url":"https://infra.spec.whatwg.org/#ordered-map"},
"https://infra.spec.whatwg.org/#struct": {"displayText":"struct","export":true,"for_":[],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"struct","type":"dfn","url":"https://infra.spec.whatwg.org/#struct"},
"https://tc39.github.io/ecma262/#sec-get-o-p": {"displayText":"Get","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-animation-worklet","spec":"","status":"anchor-block","text":"get","type":"dfn","url":"https://tc39.github.io/ecma262/#sec-get-o-p"},
"https://tc39.github.io/ecma262/#sec-isconstructor": {"displayText":"IsConstructor","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-animation-worklet","spec":"","status":"anchor-block","text":"isconstructor","type":"dfn","url":"https://tc39.github.io/ecma262/#sec-isconstructor"},
"https://tc39.github.io/ecma262/#sec-native-error-types-used-in-this-standard-typeerror": {"displayText":"TypeError","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-animation-worklet","spec":"","status":"anchor-block","text":"typeerror","type":"dfn","url":"https://tc39.github.io/ecma262/#sec-native-error-types-used-in-this-standard-typeerror"},
"https://w3c.github.io/web-animations/level-2/#child-effect": {"displayText":"child effect","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-animation-worklet","spec":"","status":"anchor-block","text":"child effect","type":"dfn","url":"https://w3c.github.io/web-animations/level-2/#child-effect"},
"https://w3c.github.io/web-animations/level-2/#group-effect": {"displayText":"group effect","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-animation-worklet","spec":"","status":"anchor-block","text":"group effect","type":"dfn","url":"https://w3c.github.io/web-animations/level-2/#group-effect"},
"https://webidl.spec.whatwg.org/#Exposed": {"displayText":"Exposed","export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"Exposed","type":"extended-attribute","url":"https://webidl.spec.whatwg.org/#Exposed"},
"https://webidl.spec.whatwg.org/#Global": {"displayText":"Global","export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"Global","type":"extended-attribute","url":"https://webidl.spec.whatwg.org/#Global"},
"https://webidl.spec.whatwg.org/#SameObject": {"displayText":"SameObject","export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"SameObject","type":"extended-attribute","url":"https://webidl.spec.whatwg.org/#SameObject"},
"https://webidl.spec.whatwg.org/#dfn-callback-function": {"displayText":"callback function","export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"callback function","type":"dfn","url":"https://webidl.spec.whatwg.org/#dfn-callback-function"},
"https://webidl.spec.whatwg.org/#idl-DOMString": {"displayText":"DOMString","export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"DOMString","type":"interface","url":"https://webidl.spec.whatwg.org/#idl-DOMString"},
"https://webidl.spec.whatwg.org/#idl-any": {"displayText":"any","export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"any","type":"interface","url":"https://webidl.spec.whatwg.org/#idl-any"},
"https://webidl.spec.whatwg.org/#idl-double": {"displayText":"double","export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"double","type":"interface","url":"https://webidl.spec.whatwg.org/#idl-double"},
"https://webidl.spec.whatwg.org/#idl-sequence": {"displayText":"sequence","export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"sequence","type":"dfn","url":"https://webidl.spec.whatwg.org/#idl-sequence"},
"https://webidl.spec.whatwg.org/#idl-undefined": {"displayText":"undefined","export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"undefined","type":"interface","url":"https://webidl.spec.whatwg.org/#idl-undefined"},
"https://wicg.github.io/scroll-animations/#scrolltimeline": {"displayText":"ScrollTimeline","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-animation-worklet","spec":"","status":"anchor-block","text":"ScrollTimeline","type":"interface","url":"https://wicg.github.io/scroll-animations/#scrolltimeline"},
};

function mkRefHint(link, ref) {
    const linkText = link.textContent;
    let dfnTextElements = '';
    if (ref.displayText.toLowerCase() != linkText.toLowerCase()) {
        // Give the original term if it's being displayed in a different way.
        // But allow casing differences, they're insignificant.
        dfnTextElements =
            mk.li({},
                mk.b({}, "Term: "),
                mk.span({}, ref.displayText)
            );
    }
    const forList = ref.for_;
    let forListElements;
    if(forList.length == 0) {
        forListElements = [];
    } else if(forList.length == 1) {
        forListElements = mk.li({},
            mk.b({}, "For: "),
            mk.span({}, forList[0]),
        );
    } else {
        forListElements = mk.li({},
            mk.b({}, "For: "),
            mk.ul({},
                ...forList.map(forItem =>
                    mk.li({},
                        mk.span({}, forItem)
                    ),
                ),
            ),
        );
    }
    const url = ref.url;
    const safeUrl = encodeURIComponent(url);
    const hintPanel = mk.aside({
        class: "ref-hint",
        id: `ref-hint-for-${safeUrl}`,
        "data-for": url,
        "aria-labelled-by": `ref-hint-for-${safeUrl}`,
    },
        mk.ul({},
            dfnTextElements,
            mk.li({},
                mk.b({}, "URL: "),
                mk.a({ href: url, class: "ref" }, url),
            ),
            mk.li({},
                mk.b({}, "Type: "),
                mk.span({}, `${ref.type}`),
            ),
            mk.li({},
                mk.b({}, "Spec: "),
                mk.span({}, `${ref.spec ? ref.spec : ''}`),
            ),
            forListElements
        ),
    );
    hintPanel.forLink = link;
    setupRefHintEventListeners(link, hintPanel);
    return hintPanel;
}

function hideAllRefHints() {
    queryAll(".ref-hint").forEach(el=>hideRefHint(el));
}

function hideRefHint(refHint) {
    const link = refHint.forLink;
    link.setAttribute("aria-expanded", "false");
    if(refHint.teardownEventListeners) {
        refHint.teardownEventListeners();
    }
    refHint.remove();
}

function showRefHint(link) {
    if(link.classList.contains("dfn-link")) return;
    const url = link.getAttribute("href");
    const ref = refsData[url];
    if(!ref) return;

    hideAllRefHints(); // Only display one at this time.

    const refHint = mkRefHint(link, ref);
    append(document.body, refHint);
    link.setAttribute("aria-expanded", "true");
    positionRefHint(refHint);
}

function setupRefHintEventListeners(link, refHint) {
    if (refHint.teardownEventListeners) return;
    // Add event handlers to hide the refHint after the user moves away
    // from both the link and refHint, if not hovering either within one second.
    let timeout = null;
    const startHidingRefHint = (event) => {
        if (timeout) {
            clearTimeout(timeout);
        }
        timeout = setTimeout(() => {
            hideRefHint(refHint);
        }, 1000);
    }
    const resetHidingRefHint = (event) => {
        if (timeout) clearTimeout(timeout);
        timeout = null;
    };
    link.addEventListener("mouseleave", startHidingRefHint);
    link.addEventListener("mouseenter", resetHidingRefHint);
    link.addEventListener("blur", startHidingRefHint);
    link.addEventListener("focus", resetHidingRefHint);
    refHint.addEventListener("mouseleave", startHidingRefHint);
    refHint.addEventListener("mouseenter", resetHidingRefHint);
    refHint.addEventListener("blur", startHidingRefHint);
    refHint.addEventListener("focus", resetHidingRefHint);

    refHint.teardownEventListeners = () => {
        // remove event listeners
        resetHidingRefHint();
        link.removeEventListener("mouseleave", startHidingRefHint);
        link.removeEventListener("mouseenter", resetHidingRefHint);
        link.removeEventListener("blur", startHidingRefHint);
        link.removeEventListener("focus", resetHidingRefHint);
        refHint.removeEventListener("mouseleave", startHidingRefHint);
        refHint.removeEventListener("mouseenter", resetHidingRefHint);
        refHint.removeEventListener("blur", startHidingRefHint);
        refHint.removeEventListener("focus", resetHidingRefHint);
    };
}

function positionRefHint(refHint) {
    const link = refHint.forLink;
    const linkPos = getBounds(link);
    refHint.style.top = linkPos.bottom + "px";
    refHint.style.left = linkPos.left + "px";

    const panelPos = refHint.getBoundingClientRect();
    const panelMargin = 8;
    const maxRight = document.body.parentNode.clientWidth - panelMargin;
    if (panelPos.right > maxRight) {
        const overflowAmount = panelPos.right - maxRight;
        const newLeft = Math.max(panelMargin, linkPos.left - overflowAmount);
        refHint.style.left = newLeft + "px";
    }
}

// TODO: shared util
// Returns the root-level absolute position {left and top} of element.
function getBounds(el, relativeTo=document.body) {
    const relativeRect = relativeTo.getBoundingClientRect();
    const elRect = el.getBoundingClientRect();
    const top = elRect.top - relativeRect.top;
    const left = elRect.left - relativeRect.left;
    return {
        top,
        left,
        bottom: top + elRect.height,
        right: left + elRect.width,
    }
}

function showRefHintListener(e) {
    // If the target isn't in a link (or is a link),
    // just ignore it.
    let link = e.target.closest("a");
    if(!link) return;

    // If the target is in a ref-hint panel
    // (aka a link in the already-open one),
    // also just ignore it.
    if(link.closest(".ref-hint")) return;

    // Otherwise, show the panel for the link.
    showRefHint(link);
}

function hideAllHintsListener(e) {
    // If the click is inside a ref-hint panel, ignore it.
    if(e.target.closest(".ref-hint")) return;
    // Otherwise, close all the current panels.
    hideAllRefHints();
}

document.addEventListener("DOMContentLoaded", () => {
    document.body.addEventListener("mousedown", showRefHintListener);
    document.body.addEventListener("focus", showRefHintListener);

    document.body.addEventListener("click", hideAllHintsListener);
});

window.addEventListener("resize", () => {
    // Hide any open ref hint.
    hideAllRefHints();
});
}
</script>
<script>/* Boilerplate: script-var-click-highlighting */
"use strict";
{
/*
Color-choosing design:

* Colors are ordered by goodness.
* On clicking a var, give it the earliest color
    with the lowest usage in the algorithm.
* On re-clicking, re-use the var's most recent color
    if that's not currently being used elsewhere.
*/

const COLOR_COUNT = 7;

document.addEventListener("click", e=>{
    if(e.target.nodeName == "VAR") {
        highlightSameAlgoVars(e.target);
    }
});

function highlightSameAlgoVars(v) {
    // Find the algorithm container.
    let algoContainer = findAlgoContainer(v);

    // Not highlighting document-global vars,
    // too likely to be unrelated.
    if(algoContainer == null) return;

    const varName = nameFromVar(v);
    if(!v.hasAttribute("data-var-color")) {
        const newColor = chooseHighlightColor(algoContainer, v);
        for(const el of algoContainer.querySelectorAll("var")) {
            if(nameFromVar(el) == varName) {
                el.setAttribute("data-var-color", newColor);
                el.setAttribute("data-var-last-color", newColor);
            }
        }
    } else {
        for(const el of algoContainer.querySelectorAll("var")) {
            if(nameFromVar(el) == varName) {
                el.removeAttribute("data-var-color");
            }
        }
    }
}
function findAlgoContainer(el) {
    while(el != document.body) {
        if(el.hasAttribute("data-algorithm")) return el;
        el = el.parentNode;
    }
    return null;
}
function nameFromVar(el) {
    return el.textContent.replace(/(\s|\xa0)+/g, " ").trim();
}
function colorCountsFromContainer(container) {
    const namesFromColor = Array.from({length:COLOR_COUNT}, x=>new Set());
    for(let v of container.querySelectorAll("var[data-var-color]")) {
        let color = +v.getAttribute("data-var-color");
        namesFromColor[color].add(nameFromVar(v));
    }

    return namesFromColor.map(x=>x.size);
}
function leastUsedColor(colors) {
    // Find the earliest color with the lowest count.
    let minCount = Infinity;
    let minColor = null;
    for(var i = 0; i < colors.length; i++) {
        if(colors[i] < minCount) {
            minColor = i;
            minCount = colors[i];
        }
    }
    return minColor;
}
function chooseHighlightColor(container, v) {
    const colorCounts = colorCountsFromContainer(container);
    if(v.hasAttribute("data-var-last-color")) {
        let color = +v.getAttribute("data-var-last-color");
        if(colorCounts[color] == 0) return color;
    }
    return leastUsedColor(colorCounts);
}
}
</script>