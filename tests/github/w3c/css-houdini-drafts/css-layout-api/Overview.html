<!doctype html><html lang="en">
 <head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
  <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
  <title>CSS Layout API Level 1</title>
  <meta content="ED" name="w3c-status">
  <link href="https://www.w3.org/StyleSheets/TR/2021/W3C-ED" rel="stylesheet">
  <link href="https://www.w3.org/TR/css-layout-api-1/" rel="canonical">
  <meta content="dark light" name="color-scheme">
<style>
/* Put nice boxes around each algorithm. */
[data-algorithm]:not(.heading) {
    padding: .5em;
    border: thin solid #ddd; border-radius: .5em;
    margin: .5em calc(-0.5em - 1px);
}
[data-algorithm]:not(.heading) > :first-child {
    margin-top: 0;
}
[data-algorithm]:not(.heading) > :last-child {
    margin-bottom: 0;
}
</style>
<style>/* Boilerplate: style-autolinks */
.css.css, .property.property, .descriptor.descriptor {
    color: var(--a-normal-text);
    font-size: inherit;
    font-family: inherit;
}
.css::before, .property::before, .descriptor::before {
    content: "‘";
}
.css::after, .property::after, .descriptor::after {
    content: "’";
}
.property, .descriptor {
    /* Don't wrap property and descriptor names */
    white-space: nowrap;
}
.type { /* CSS value <type> */
    font-style: italic;
}
pre .property::before, pre .property::after {
    content: "";
}
[data-link-type="property"]::before,
[data-link-type="propdesc"]::before,
[data-link-type="descriptor"]::before,
[data-link-type="value"]::before,
[data-link-type="function"]::before,
[data-link-type="at-rule"]::before,
[data-link-type="selector"]::before,
[data-link-type="maybe"]::before {
    content: "‘";
}
[data-link-type="property"]::after,
[data-link-type="propdesc"]::after,
[data-link-type="descriptor"]::after,
[data-link-type="value"]::after,
[data-link-type="function"]::after,
[data-link-type="at-rule"]::after,
[data-link-type="selector"]::after,
[data-link-type="maybe"]::after {
    content: "’";
}

[data-link-type].production::before,
[data-link-type].production::after,
.prod [data-link-type]::before,
.prod [data-link-type]::after {
    content: "";
}

[data-link-type=element],
[data-link-type=element-attr] {
    font-family: Menlo, Consolas, "DejaVu Sans Mono", monospace;
    font-size: .9em;
}
[data-link-type=element]::before { content: "<" }
[data-link-type=element]::after  { content: ">" }

[data-link-type=biblio] {
    white-space: pre;
}

@media (prefers-color-scheme: dark) {
    :root {
        --selflink-text: black;
        --selflink-bg: silver;
        --selflink-hover-text: white;
    }
}
</style>
<style>/* Boilerplate: style-colors */
/* Any --*-text not paired with a --*-bg is assumed to have a transparent bg */
:root {
    color-scheme: light dark;

    --text: black;
    --bg: white;

    --unofficial-watermark: url(https://www.w3.org/StyleSheets/TR/2016/logos/UD-watermark);

    --logo-bg: #1a5e9a;
    --logo-active-bg: #c00;
    --logo-text: white;

    --tocnav-normal-text: #707070;
    --tocnav-normal-bg: var(--bg);
    --tocnav-hover-text: var(--tocnav-normal-text);
    --tocnav-hover-bg: #f8f8f8;
    --tocnav-active-text: #c00;
    --tocnav-active-bg: var(--tocnav-normal-bg);

    --tocsidebar-text: var(--text);
    --tocsidebar-bg: #f7f8f9;
    --tocsidebar-shadow: rgba(0,0,0,.1);
    --tocsidebar-heading-text: hsla(203,20%,40%,.7);

    --toclink-text: var(--text);
    --toclink-underline: #3980b5;
    --toclink-visited-text: var(--toclink-text);
    --toclink-visited-underline: #054572;

    --heading-text: #005a9c;

    --hr-text: var(--text);

    --algo-border: #def;

    --del-text: red;
    --del-bg: transparent;
    --ins-text: #080;
    --ins-bg: transparent;

    --a-normal-text: #034575;
    --a-normal-underline: #bbb;
    --a-visited-text: var(--a-normal-text);
    --a-visited-underline: #707070;
    --a-hover-bg: rgba(75%, 75%, 75%, .25);
    --a-active-text: #c00;
    --a-active-underline: #c00;

    --blockquote-border: silver;
    --blockquote-bg: transparent;
    --blockquote-text: currentcolor;

    --issue-border: #e05252;
    --issue-bg: #fbe9e9;
    --issue-text: var(--text);
    --issueheading-text: #831616;

    --example-border: #e0cb52;
    --example-bg: #fcfaee;
    --example-text: var(--text);
    --exampleheading-text: #574b0f;

    --note-border: #52e052;
    --note-bg: #e9fbe9;
    --note-text: var(--text);
    --noteheading-text: hsl(120, 70%, 30%);
    --notesummary-underline: silver;

    --assertion-border: #aaa;
    --assertion-bg: #eee;
    --assertion-text: black;

    --advisement-border: orange;
    --advisement-bg: #fec;
    --advisement-text: var(--text);
    --advisementheading-text: #b35f00;

    --warning-border: red;
    --warning-bg: hsla(40,100%,50%,0.95);
    --warning-text: var(--text);

    --amendment-border: #330099;
    --amendment-bg: #F5F0FF;
    --amendment-text: var(--text);
    --amendmentheading-text: #220066;

    --def-border: #8ccbf2;
    --def-bg: #def;
    --def-text: var(--text);
    --defrow-border: #bbd7e9;

    --datacell-border: silver;

    --indexinfo-text: #707070;

    --indextable-hover-text: black;
    --indextable-hover-bg: #f7f8f9;

    --outdatedspec-bg: rgba(0, 0, 0, .5);
    --outdatedspec-text: black;
    --outdated-bg: maroon;
    --outdated-text: white;
    --outdated-shadow: red;

    --editedrec-bg: darkorange;
}

@media (prefers-color-scheme: dark) {
    :root {
        --text: #ddd;
        --bg: black;

        --unofficial-watermark: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='400'%3E%3Cg fill='%23100808' transform='translate(200 200) rotate(-45) translate(-200 -200)' stroke='%23100808' stroke-width='3'%3E%3Ctext x='50%25' y='220' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EUNOFFICIAL%3C/text%3E%3Ctext x='50%25' y='305' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EDRAFT%3C/text%3E%3C/g%3E%3C/svg%3E");

        --logo-bg: #1a5e9a;
        --logo-active-bg: #c00;
        --logo-text: white;

        --tocnav-normal-text: #999;
        --tocnav-normal-bg: var(--bg);
        --tocnav-hover-text: var(--tocnav-normal-text);
        --tocnav-hover-bg: #080808;
        --tocnav-active-text: #f44;
        --tocnav-active-bg: var(--tocnav-normal-bg);

        --tocsidebar-text: var(--text);
        --tocsidebar-bg: #080808;
        --tocsidebar-shadow: rgba(255,255,255,.1);
        --tocsidebar-heading-text: hsla(203,20%,40%,.7);

        --toclink-text: var(--text);
        --toclink-underline: #6af;
        --toclink-visited-text: var(--toclink-text);
        --toclink-visited-underline: #054572;

        --heading-text: #8af;

        --hr-text: var(--text);

        --algo-border: #456;

        --del-text: #f44;
        --del-bg: transparent;
        --ins-text: #4a4;
        --ins-bg: transparent;

        --a-normal-text: #6af;
        --a-normal-underline: #555;
        --a-visited-text: var(--a-normal-text);
        --a-visited-underline: var(--a-normal-underline);
        --a-hover-bg: rgba(25%, 25%, 25%, .2);
        --a-active-text: #f44;
        --a-active-underline: var(--a-active-text);

        --borderedblock-bg: rgba(255, 255, 255, .05);

        --blockquote-border: silver;
        --blockquote-bg: var(--borderedblock-bg);
        --blockquote-text: currentcolor;

        --issue-border: #e05252;
        --issue-bg: var(--borderedblock-bg);
        --issue-text: var(--text);
        --issueheading-text: hsl(0deg, 70%, 70%);

        --example-border: hsl(50deg, 90%, 60%);
        --example-bg: var(--borderedblock-bg);
        --example-text: var(--text);
        --exampleheading-text: hsl(50deg, 70%, 70%);

        --note-border: hsl(120deg, 100%, 35%);
        --note-bg: var(--borderedblock-bg);
        --note-text: var(--text);
        --noteheading-text: hsl(120, 70%, 70%);
        --notesummary-underline: silver;

        --assertion-border: #444;
        --assertion-bg: var(--borderedblock-bg);
        --assertion-text: var(--text);

        --advisement-border: orange;
        --advisement-bg: #222218;
        --advisement-text: var(--text);
        --advisementheading-text: #f84;

        --warning-border: red;
        --warning-bg: hsla(40,100%,20%,0.95);
        --warning-text: var(--text);

        --amendment-border: #330099;
        --amendment-bg: #080010;
        --amendment-text: var(--text);
        --amendmentheading-text: #cc00ff;

        --def-border: #8ccbf2;
        --def-bg: #080818;
        --def-text: var(--text);
        --defrow-border: #136;

        --datacell-border: silver;

        --indexinfo-text: #aaa;

        --indextable-hover-text: var(--text);
        --indextable-hover-bg: #181818;

        --outdatedspec-bg: rgba(255, 255, 255, .5);
        --outdatedspec-text: black;
        --outdated-bg: maroon;
        --outdated-text: white;
        --outdated-shadow: red;

        --editedrec-bg: darkorange;
    }
    /* In case a transparent-bg image doesn't expect to be on a dark bg,
       which is quite common in practice... */
    img { background: white; }
}
</style>
<style>/* Boilerplate: style-counters */
body {
    counter-reset: example figure issue;
}
.issue {
    counter-increment: issue;
}
.issue:not(.no-marker)::before {
    content: "Issue " counter(issue);
}

.example {
    counter-increment: example;
}
.example:not(.no-marker)::before {
    content: "Example " counter(example);
}
.invalid.example:not(.no-marker)::before,
.illegal.example:not(.no-marker)::before {
    content: "Invalid Example" counter(example);
}

figcaption {
    counter-increment: figure;
}
figcaption:not(.no-marker)::before {
    content: "Figure " counter(figure) " ";
}
</style>
<style>/* Boilerplate: style-issues */
a[href].issue-return {
    float: right;
    float: inline-end;
    color: var(--issueheading-text);
    font-weight: bold;
    text-decoration: none;
}
</style>
<style>/* Boilerplate: style-md-lists */
/* This is a weird hack for me not yet following the commonmark spec
   regarding paragraph and lists. */
[data-md] > :first-child {
    margin-top: 0;
}
[data-md] > :last-child {
    margin-bottom: 0;
}
</style>
<style>/* Boilerplate: style-selflinks */
:root {
    --selflink-text: white;
    --selflink-bg: gray;
    --selflink-hover-text: black;
}
.heading, .issue, .note, .example, li, dt {
    position: relative;
}
a.self-link {
    position: absolute;
    top: 0;
    left: calc(-1 * (3.5rem - 26px));
    width: calc(3.5rem - 26px);
    height: 2em;
    text-align: center;
    border: none;
    transition: opacity .2s;
    opacity: .5;
}
a.self-link:hover {
    opacity: 1;
}
.heading > a.self-link {
    font-size: 83%;
}
.example > a.self-link,
.note > a.self-link,
.issue > a.self-link {
    /* These blocks are overflow:auto, so positioning outside
       doesn't work. */
    left: auto;
    right: 0;
}
li > a.self-link {
    left: calc(-1 * (3.5rem - 26px) - 2em);
}
dfn > a.self-link {
    top: auto;
    left: auto;
    opacity: 0;
    width: 1.5em;
    height: 1.5em;
    background: var(--selflink-bg);
    color: var(--selflink-text);
    font-style: normal;
    transition: opacity .2s, background-color .2s, color .2s;
}
dfn:hover > a.self-link {
    opacity: 1;
}
dfn > a.self-link:hover {
    color: var(--selflink-hover-text);
}

a.self-link::before            { content: "¶"; }
.heading > a.self-link::before { content: "§"; }
dfn > a.self-link::before      { content: "#"; }
</style>
 <body class="h-entry">
  <div class="head">
   <p data-fill-with="logo"><a class="logo" href="https://www.w3.org/"> <img alt="W3C" height="48" src="https://www.w3.org/StyleSheets/TR/2021/logos/W3C" width="72"> </a> </p>
   <h1 class="p-name no-ref" id="title">CSS Layout API Level 1</h1>
   <p id="w3c-state"><a href="https://www.w3.org/standards/types/#ED">Editor’s Draft</a>, <time class="dt-updated" datetime="1970-01-01">1 January 1970</time></p>
   <details open>
    <summary>More details about this document</summary>
    <div data-fill-with="spec-metadata">
     <dl>
      <dt>This version:
      <dd><a class="u-url" href="https://drafts.css-houdini.org/css-layout-api-1/">https://drafts.css-houdini.org/css-layout-api-1/</a>
      <dt>Latest published version:
      <dd><a href="https://www.w3.org/TR/css-layout-api-1/">https://www.w3.org/TR/css-layout-api-1/</a>
      <dt>Feedback:
      <dd><span><a href="mailto:public-houdini@w3.org?subject=%5Bcss-layout-api%5D%20YOUR%20TOPIC%20HERE">public-houdini@w3.org</a> with subject line “<kbd>[css-layout-api] <i data-lt>… message topic …</i></kbd>” (<a href="http://lists.w3.org/Archives/Public/public-houdini/" rel="discussion">archives</a>)</span>
      <dt class="editor">Editors:
      <dd class="editor p-author h-card vcard" data-editor-id="69511"><a class="p-name fn u-email email" href="mailto:gwhit@microsoft.com">Greg Whitworth</a>
      <dd class="editor p-author h-card vcard" data-editor-id="73001"><a class="p-name fn u-email email" href="mailto:ikilpatrick@chromium.org">Ian Kilpatrick</a>
      <dd class="editor p-author h-card vcard" data-editor-id="42199"><a class="p-name fn u-url url" href="http://xanthir.com/contact/">Tab Atkins-Bittner</a> (<span class="p-org org">Google</span>)
      <dd class="editor p-author h-card vcard"><a class="p-name fn u-email email" href="mailto:robert@ocallahan.org">Robert O'Callahan</a>
      <dd class="editor p-author h-card vcard" data-editor-id="49885"><a class="p-name fn u-email email" href="mailto:rossen.atanassov@microsoft.com">Rossen Atanassov</a>
      <dt class="editor">Former Editor:
      <dd class="editor p-author h-card vcard" data-editor-id="47691"><a class="p-name fn u-email email" href="mailto:shanestephens@google.com">Shane Stephens</a>
     </dl>
    </div>
   </details>
   <div data-fill-with="warning"></div>
   <p class="copyright" data-fill-with="copyright"><a href="https://www.w3.org/policies/#copyright">Copyright</a> © 1970 <a href="https://www.w3.org/">World Wide Web Consortium</a>. <abbr title="World Wide Web Consortium">W3C</abbr><sup>®</sup> <a href="https://www.w3.org/policies/#Legal_Disclaimer">liability</a>, <a href="https://www.w3.org/policies/#W3C_Trademarks">trademark</a> and <a href="https://www.w3.org/copyright/software-license/" rel="license" title="W3C Software and Document License">permissive document license</a> rules apply. </p>
   <hr title="Separator for header">
  </div>
  <div class="p-summary" data-fill-with="abstract">
   <h2 class="no-num no-toc no-ref heading settled" id="abstract"><span class="content">Abstract</span><a class="self-link" href="#abstract"></a></h2>
   <p>An API for allowing web developers to define their own layout modes with javascript.
See <a href="https://github.com/w3c/css-houdini-drafts/blob/master/css-layout-api/EXPLAINER.md">EXPLAINER</a>.</p>
  </div>
  <h2 class="no-num no-toc no-ref heading settled" id="sotd"><span class="content">Status of this document</span></h2>
  <div data-fill-with="status">
   <p> This is a public copy of the editors’ draft.
	It is provided for discussion only and may change at any moment.
	Its publication here does not imply endorsement of its contents by W3C.
	Don’t cite this document other than as work in progress. </p>
   <p>Please send feedback
	by <a href="https://github.com/w3c/css-houdini-drafts/issues">filing issues in GitHub</a> (preferred),
	including the spec code “css-layout-api” in the title, like this:
	“[css-layout-api] <i>…summary of comment…</i>”.
	All issues and comments are <a href="https://lists.w3.org/Archives/Public/public-houdini-archive/">archived</a>.
	Alternately, feedback can be sent to the (<a href="https://lists.w3.org/Archives/Public/www-style/">archived</a>) public mailing list <a href="mailto:www-style@w3.org?Subject=%5Bcss-layout-api%5D%20PUT%20SUBJECT%20HERE">www-style@w3.org</a>. </p>
   <p>This document is governed by the <a href="https://www.w3.org/policies/process/20231103/" id="w3c_process_revision">03 November 2023 W3C Process Document</a>. </p>
   <p></p>
  </div>
  <div data-fill-with="at-risk"></div>
  <nav data-fill-with="table-of-contents" id="toc">
   <h2 class="no-num no-toc no-ref heading settled" id="contents"><span class="content">Table of Contents</span></h2>
   <ol class="toc" role="directory">
    <li><a href="#intro"><span class="secno">1</span> <span class="content">Introduction</span></a>
    <li>
     <a href="#layout-api-containers"><span class="secno">2</span> <span class="content">Layout API Containers</span></a>
     <ol class="toc">
      <li><a href="#painting"><span class="secno">2.1</span> <span class="content">Layout API Container Painting</span></a>
      <li><a href="#layout-api-box-tree"><span class="secno">2.2</span> <span class="content">Box Tree Transformations</span></a>
     </ol>
    <li>
     <a href="#layout-worklet"><span class="secno">3</span> <span class="content">Layout Worklet</span></a>
     <ol class="toc">
      <li><a href="#concepts"><span class="secno">3.1</span> <span class="content">Concepts</span></a>
      <li><a href="#registering-layout"><span class="secno">3.2</span> <span class="content">Registering A Layout</span></a>
      <li><a href="#terminology"><span class="secno">3.3</span> <span class="content">Terminology</span></a>
     </ol>
    <li>
     <a href="#layout-api"><span class="secno">4</span> <span class="content">Layout API</span></a>
     <ol class="toc">
      <li>
       <a href="#layout-children"><span class="secno">4.1</span> <span class="content">Layout Children</span></a>
       <ol class="toc">
        <li><a href="#layout-child-box-tree"><span class="secno">4.1.1</span> <span class="content">LayoutChildren and the Box Tree</span></a>
       </ol>
      <li><a href="#layout-fragments"><span class="secno">4.2</span> <span class="content">Layout Fragments</span></a>
      <li><a href="#intrinsic-sizes"><span class="secno">4.3</span> <span class="content">Intrinsic Sizes</span></a>
      <li>
       <a href="#layout-constraints"><span class="secno">4.4</span> <span class="content">Layout Constraints</span></a>
       <ol class="toc">
        <li><a href="#layout-constraints-children"><span class="secno">4.4.1</span> <span class="content">Constraints for Layout Children</span></a>
       </ol>
      <li><a href="#breaking-and-fragmentation"><span class="secno">4.5</span> <span class="content">Breaking and Fragmentation</span></a>
      <li><a href="#edges"><span class="secno">4.6</span> <span class="content">Edges</span></a>
     </ol>
    <li>
     <a href="#interactions-with-other-modules"><span class="secno">5</span> <span class="content">Interactions with other Modules</span></a>
     <ol class="toc">
      <li>
       <a href="#interaction-sizing"><span class="secno">5.1</span> <span class="content">Sizing</span></a>
       <ol class="toc">
        <li><a href="#interaction-sizing-positiong-layout"><span class="secno">5.1.1</span> <span class="content">Positioned layout sizing</span></a>
       </ol>
      <li><a href="#interaction-positioning"><span class="secno">5.2</span> <span class="content">Positioning</span></a>
      <li><a href="#interaction-overflow"><span class="secno">5.3</span> <span class="content">Overflow</span></a>
      <li><a href="#interaction-fragmentation"><span class="secno">5.4</span> <span class="content">Fragmentation</span></a>
      <li><a href="#interaction-alignment"><span class="secno">5.5</span> <span class="content">Alignment</span></a>
     </ol>
    <li>
     <a href="#layout"><span class="secno">6</span> <span class="content">Layout</span></a>
     <ol class="toc">
      <li><a href="#processing-model"><span class="secno">6.1</span> <span class="content">Processing Model</span></a>
      <li>
       <a href="#performing-layout"><span class="secno">6.2</span> <span class="content">Performing Layout</span></a>
       <ol class="toc">
        <li><a href="#determining-intrinsic-sizes"><span class="secno">6.2.1</span> <span class="content">Determining Intrinsic Sizes</span></a>
        <li><a href="#generating-fragments"><span class="secno">6.2.2</span> <span class="content">Generating Fragments</span></a>
        <li><a href="#global-scope-selection"><span class="secno">6.2.3</span> <span class="content">Global Scope Selection</span></a>
        <li><a href="#utility-algorithms"><span class="secno">6.2.4</span> <span class="content">Utility Algorithms</span></a>
       </ol>
     </ol>
    <li><a href="#examples"><span class="secno">7</span> <span class="content">Examples</span></a>
    <li><a href="#security-considerations"><span class="secno">8</span> <span class="content">Security Considerations</span></a>
    <li><a href="#privacy-considerations"><span class="secno">9</span> <span class="content">Privacy Considerations</span></a>
    <li>
     <a href="#w3c-conformance"><span class="secno"></span> </a>
     <ol class="toc">
      <li><a href="#w3c-conventions"><span class="secno"></span> </a>
      <li><a href="#w3c-conformance-classes"><span class="secno"></span> </a>
      <li>
       <a href="#w3c-partial"><span class="secno"></span> </a>
       <ol class="toc">
        <li><a href="#w3c-conform-future-proofing"><span class="secno"></span> </a>
       </ol>
      <li><a href="#w3c-testing"><span class="secno"></span> </a>
     </ol>
    <li>
     <a href="#index"><span class="secno"></span> <span class="content">Index</span></a>
     <ol class="toc">
      <li><a href="#index-defined-here"><span class="secno"></span> <span class="content">Terms defined by this specification</span></a>
      <li><a href="#index-defined-elsewhere"><span class="secno"></span> <span class="content">Terms defined by reference</span></a>
     </ol>
    <li>
     <a href="#references"><span class="secno"></span> <span class="content">References</span></a>
     <ol class="toc">
      <li><a href="#normative"><span class="secno"></span> <span class="content">Normative References</span></a>
      <li><a href="#informative"><span class="secno"></span> <span class="content">Informative References</span></a>
     </ol>
    <li><a href="#idl-index"><span class="secno"></span> <span class="content">IDL Index</span></a>
   </ol>
  </nav>
  <main>
   <h2 class="heading settled" data-level="1" id="intro"><span class="secno">1. </span><span class="content">Introduction</span><a class="self-link" href="#intro"></a></h2>
   <p><em>This section is not normative.</em></p>
   <p>The layout stage of CSS is responsible for generating and positioning <a data-link-type="dfn" href="https://drafts.csswg.org/css-break-3/#fragment" id="ref-for-fragment">fragments</a> from the <a data-link-type="dfn" href="https://drafts.csswg.org/css-display-4/#box-tree" id="ref-for-box-tree">box tree</a>.</p>
   <p>This specification describes an API which allows developers to layout a <a data-link-type="dfn" href="https://drafts.csswg.org/css-display-3/#box" id="ref-for-box">box</a> in response to
computed style and <a data-link-type="dfn" href="https://drafts.csswg.org/css-display-4/#box-tree" id="ref-for-box-tree①">box tree</a> changes.</p>
   <p>For a high level overview of this API, see the <a href="https://github.com/w3c/css-houdini-drafts/blob/master/css-layout-api/EXPLAINER.md">EXPLAINER</a>.</p>
   <h2 class="heading settled" data-level="2" id="layout-api-containers"><span class="secno">2. </span><span class="content">Layout API Containers</span><a class="self-link" href="#layout-api-containers"></a></h2>
   <p>A new <a href="https://www.w3.org/TR/css-values-3/#comb-one">alternative</a> value is added
to the <a class="production css" data-link-type="type" href="https://drafts.csswg.org/css-display-4/#typedef-display-inside" id="ref-for-typedef-display-inside">&lt;display-inside></a> production: <code>layout(<a class="production css" data-link-type="type" href="https://drafts.csswg.org/css-values-4/#typedef-ident" id="ref-for-typedef-ident">&lt;ident></a>)</code>.</p>
   <dl>
    <dt><dfn class="dfn-paneled css" data-dfn-for="display" data-dfn-type="value" data-export id="valdef-display-layout">layout()</dfn> 
    <dd> This value causes an element to generate a <a data-link-type="dfn" href="#layout-api-container" id="ref-for-layout-api-container">layout API container</a> box. 
   </dl>
   <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="layout-api-container">layout API container</dfn> is the box generated by an element with a <a class="production css" data-link-type="type" href="https://drafts.csswg.org/css-display-4/#typedef-display-inside" id="ref-for-typedef-display-inside①">&lt;display-inside></a> <a data-link-type="dfn" href="https://drafts.csswg.org/css-cascade-5/#computed-value" id="ref-for-computed-value">computed value</a> <a class="css" data-link-type="maybe" href="#valdef-display-layout" id="ref-for-valdef-display-layout">layout()</a>.</p>
   <p>A <a data-link-type="dfn" href="#layout-api-container" id="ref-for-layout-api-container①">layout API container</a> establishes a new <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="layout-api-formatting-context">layout API formatting context</dfn> for its
contents. This is the same as establishing a block formatting context, except that the layout
provided by the author is used instead of the block layout.
For example, floats do not intrude into the layout API container, and the layout API container’s
margins do not collapse with the margins of its contents.</p>
   <p><a data-link-type="dfn" href="#layout-api-container" id="ref-for-layout-api-container②">Layout API containers</a> form a containing block for their contents <a href="https://www.w3.org/TR/CSS2/visudet.html#containing-block-details">exactly like block
containers do</a>. <a data-link-type="biblio" href="#biblio-css21" title="Cascading Style Sheets Level 2 Revision 1 (CSS 2.1) Specification">[CSS21]</a></p>
   <p class="note" role="note"><span class="marker">Note:</span> In a future level of the specification there may be a way to override the containing block
    behaviour.</p>
   <p>The <a class="property css" data-link-type="property" href="https://drafts.csswg.org/css-overflow-3/#propdef-overflow" id="ref-for-propdef-overflow">overflow</a> property applies to <a data-link-type="dfn" href="#layout-api-container" id="ref-for-layout-api-container③">layout API containers</a>. This is discussed in <a href="#interaction-overflow">§ 5.3 Overflow</a>.</p>
   <p>As the layout is entirely up to the author, properties which are used in other layout modes (e.g.
flex, block) may not apply. For example an author may not respect the <a class="property css" data-link-type="property" href="https://drafts.csswg.org/css-box-4/#propdef-margin" id="ref-for-propdef-margin">margin</a> property on children.</p>
   <div class="example" id="example-425e488b">
    <a class="self-link" href="#example-425e488b"></a> The HTML below shows an example of setting the <a class="css" data-link-type="maybe" href="https://drafts.csswg.org/css-shapes-2/#valdef-shape-inside-display" id="ref-for-valdef-shape-inside-display">display</a> to a <a class="css" data-link-type="maybe" href="#valdef-display-layout" id="ref-for-valdef-display-layout①">layout()</a> function, if the CSS
Layout API is supported. 
<pre class="lang-html highlight"><c- cp>&lt;!DOCTYPE html></c->
<c- p>&lt;</c-><c- f>style</c-><c- p>></c->
<c- p>@</c-><c- k>supports</c-> <c- o>(</c-><c- f>display</c-><c- o>:</c-> <c- f>layout</c-><c- o>(</c-><c- f>centering</c-><c- o>))</c-> <c- p>{</c->
  <c- p>.</c-><c- nc>centering-layout</c-> <c- p>{</c-> <c- k>display</c-><c- p>:</c-> <c- nf>layout</c-><c- p>(</c-><c- n>centering</c-><c- p>);</c-> <c- p>}</c->
<c- p>}</c->
<c- p>&lt;/</c-><c- f>style</c-><c- p>></c->
<c- p>&lt;</c-><c- f>div</c-> <c- e>class</c-><c- o>=</c-><c- s>"centering-layout"</c-><c- p>>&lt;/</c-><c- f>div</c-><c- p>></c->
</pre>
   </div>
   <h3 class="heading settled" data-level="2.1" id="painting"><span class="secno">2.1. </span><span class="content">Layout API Container Painting</span><a class="self-link" href="#painting"></a></h3>
   <p><a data-link-type="dfn" href="#layout-api-container" id="ref-for-layout-api-container④">Layout API Container</a> children paint exactly the same as inline blocks <a data-link-type="biblio" href="#biblio-css21" title="Cascading Style Sheets Level 2 Revision 1 (CSS 2.1) Specification">[CSS21]</a>, except that
the order in which they are returned from the layout method (via <code class="idl"><a data-link-type="idl" href="#dom-fragmentresultoptions-childfragments" id="ref-for-dom-fragmentresultoptions-childfragments">childFragments</a></code>) is used in place of raw document order, and <a class="property css" data-link-type="property" href="https://www.w3.org/TR/CSS21/visuren.html#propdef-z-index" id="ref-for-propdef-z-index">z-index</a> values other than <a class="css" data-link-type="maybe" href="https://drafts.csswg.org/css2/#valdef-z-index-auto" id="ref-for-valdef-z-index-auto">auto</a> create a stacking context even if <a class="property css" data-link-type="property" href="https://drafts.csswg.org/css-position-3/#propdef-position" id="ref-for-propdef-position">position</a> is <a class="css" data-link-type="maybe" href="https://drafts.csswg.org/css-position-3/#valdef-position-static" id="ref-for-valdef-position-static">static</a>.</p>
   <h3 class="heading settled" data-level="2.2" id="layout-api-box-tree"><span class="secno">2.2. </span><span class="content">Box Tree Transformations</span><a class="self-link" href="#layout-api-box-tree"></a></h3>
   <p>The inflow children of a <a data-link-type="dfn" href="#layout-api-container" id="ref-for-layout-api-container⑤">layout API container</a> can act in different ways depending on the value
of <a data-link-type="dfn" href="#document-layout-definition-layout-options" id="ref-for-document-layout-definition-layout-options">layout options'</a> <code class="idl"><a data-link-type="idl" href="#dom-layoutoptions-childdisplay" id="ref-for-dom-layoutoptions-childdisplay">childDisplay</a></code> (set by <code>layoutOptions</code> on the class).</p>
   <p>If the value of <a data-link-type="dfn" href="#document-layout-definition-layout-options" id="ref-for-document-layout-definition-layout-options①">layout options'</a> <code class="idl"><a data-link-type="idl" href="#dom-layoutoptions-childdisplay" id="ref-for-dom-layoutoptions-childdisplay①">childDisplay</a></code> is <code>"block"</code> the <a class="property css" data-link-type="property" href="https://drafts.csswg.org/css-display-4/#propdef-display" id="ref-for-propdef-display">display</a> value of that child is <a data-link-type="dfn" href="https://drafts.csswg.org/css-display-4/#blockify" id="ref-for-blockify">blockified</a>. This is similar to
children of <a data-link-type="dfn" href="https://drafts.csswg.org/css-flexbox-1/#flex-container" id="ref-for-flex-container">flex containers</a> or <a data-link-type="dfn" href="https://drafts.csswg.org/css-grid-2/#grid-container" id="ref-for-grid-container">grid containers</a>. See <a data-link-type="biblio" href="#biblio-css3-display" title="CSS Display Module Level 3">[css3-display]</a>.</p>
   <p>If the value of <a data-link-type="dfn" href="#document-layout-definition-layout-options" id="ref-for-document-layout-definition-layout-options②">layout options'</a> <code class="idl"><a data-link-type="idl" href="#dom-layoutoptions-childdisplay" id="ref-for-dom-layoutoptions-childdisplay②">childDisplay</a></code> is <code>"normal"</code>, no <a data-link-type="dfn" href="https://drafts.csswg.org/css-display-4/#blockify" id="ref-for-blockify①">blockification</a> occurs. Instead children with a <a class="production css" data-link-type="type" href="https://drafts.csswg.org/css-display-4/#typedef-display-outside" id="ref-for-typedef-display-outside">&lt;display-outside></a> <a data-link-type="dfn" href="https://drafts.csswg.org/css-cascade-5/#computed-value" id="ref-for-computed-value①">computed value</a> of <a class="css" data-link-type="maybe" href="https://drafts.csswg.org/css-display-3/#valdef-display-inline" id="ref-for-valdef-display-inline">inline</a> (a <a data-link-type="dfn" href="https://drafts.csswg.org/css-inline-3/#root-inline-box" id="ref-for-root-inline-box">root inline box</a>) will produce a single <code class="idl"><a data-link-type="idl" href="#layoutfragment" id="ref-for-layoutfragment">LayoutFragment</a></code> representing each line when <code class="idl"><a data-link-type="idl" href="#dom-layoutchild-layoutnextfragment" id="ref-for-dom-layoutchild-layoutnextfragment">layoutNextFragment()</a></code> is called.</p>
   <p class="note" role="note"><span class="marker">Note:</span> This allows authors to adjust the available inline size of each line, and position each line
    separately.</p>
   <p>Children of a <code class="idl"><a data-link-type="idl" href="#layoutchild" id="ref-for-layoutchild">LayoutChild</a></code> which represents <a data-link-type="dfn" href="https://drafts.csswg.org/css-inline-3/#root-inline-box" id="ref-for-root-inline-box①">root inline box</a> also have some additional
transformations.</p>
   <ul>
    <li data-md>
     <p>A <a data-link-type="dfn" href="https://drafts.csswg.org/css-display-4/#block-level" id="ref-for-block-level">block-level</a> box inside a <a data-link-type="dfn" href="https://drafts.csswg.org/css-display-4/#inline-level" id="ref-for-inline-level">inline-level</a> box is <a data-link-type="dfn" href="https://drafts.csswg.org/css-display-4/#inlinify" id="ref-for-inlinify">inlinified</a> I.e. its <a class="production css" data-link-type="type" href="https://drafts.csswg.org/css-display-4/#typedef-display-outside" id="ref-for-typedef-display-outside①">&lt;display-outside></a> is set to <a class="css" data-link-type="maybe" href="https://drafts.csswg.org/css-display-3/#valdef-display-inline" id="ref-for-valdef-display-inline①">inline</a>.</p>
    <li data-md>
     <p>A <a data-link-type="dfn" href="https://drafts.csswg.org/css-page-floats-3/#float" id="ref-for-float">float</a> inside a <a data-link-type="dfn" href="https://drafts.csswg.org/css-display-4/#inline-level" id="ref-for-inline-level①">inline-level</a> box is not taken out of flow. Instead it must be treated as
 inflow, and be <a data-link-type="dfn" href="https://drafts.csswg.org/css-display-4/#inlinify" id="ref-for-inlinify①">inlinified</a>.</p>
   </ul>
   <p>In both of the above cases the children become <a data-link-type="dfn" href="https://drafts.csswg.org/css-display-4/#atomic-inline" id="ref-for-atomic-inline">atomic inlines</a>.</p>
   <p class="note" role="note"><span class="marker">Note:</span> User agents would not perform any "inline splitting" or fragmenting when they encounter a <a data-link-type="dfn" href="https://drafts.csswg.org/css-display-4/#block-level" id="ref-for-block-level①">block-level</a> box.</p>
   <div class="note" role="note">
     Note: In the example below "inline-span" would be represented as a single <code class="idl"><a data-link-type="idl" href="#layoutchild" id="ref-for-layoutchild①">LayoutChild</a></code> with
    both "block" and "float" being <a data-link-type="dfn" href="https://drafts.csswg.org/css-display-4/#atomic-inline" id="ref-for-atomic-inline①">atomic inlines</a>. 
<pre class="lang-html highlight"><c- p>&lt;</c-><c- f>span</c-> <c- e>id</c-><c- o>=</c-><c- s>"inline-span"</c-><c- p>></c->
  Text
  <c- p>&lt;</c-><c- f>div</c-> <c- e>id</c-><c- o>=</c-><c- s>"block"</c-><c- p>>&lt;/</c-><c- f>div</c-><c- p>></c->
  <c- p>&lt;</c-><c- f>div</c-> <c- e>id</c-><c- o>=</c-><c- s>"float"</c-><c- p>>&lt;/</c-><c- f>div</c-><c- p>></c->
  Text
<c- p>&lt;/</c-><c- f>span</c-><c- p>></c->
</pre>
   </div>
   <h2 class="heading settled" data-level="3" id="layout-worklet"><span class="secno">3. </span><span class="content">Layout Worklet</span><a class="self-link" href="#layout-worklet"></a></h2>
   <p>The <code class="idl"><a data-link-type="idl" href="#dom-css-layoutworklet" id="ref-for-dom-css-layoutworklet">layoutWorklet</a></code> attribute allows access to the <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/worklets.html#worklet" id="ref-for-worklet">Worklet</a></code> responsible for all the classes
which are related to layout.</p>
   <p>The <code class="idl"><a data-link-type="idl" href="#dom-css-layoutworklet" id="ref-for-dom-css-layoutworklet①">layoutWorklet</a></code>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/worklets.html#worklet-global-scope-type" id="ref-for-worklet-global-scope-type">worklet global scope type</a> is <code class="idl"><a data-link-type="idl" href="#layoutworkletglobalscope" id="ref-for-layoutworkletglobalscope">LayoutWorkletGlobalScope</a></code>.</p>
<pre class="idl highlight def"><c- b>partial</c-> <c- b>namespace</c-> <a class="idl-code" data-link-type="namespace" href="https://drafts.csswg.org/cssom-1/#namespacedef-css" id="ref-for-namespacedef-css"><c- g>CSS</c-></a> {
    [<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#SameObject" id="ref-for-SameObject"><c- g>SameObject</c-></a>] <c- b>readonly</c-> <c- b>attribute</c-> <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/worklets.html#worklet" id="ref-for-worklet①"><c- n>Worklet</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="CSS" data-dfn-type="attribute" data-export data-readonly data-type="Worklet" id="dom-css-layoutworklet"><code><c- g>layoutWorklet</c-></code></dfn>;
};
</pre>
   <p>The <code class="idl"><a data-link-type="idl" href="#layoutworkletglobalscope" id="ref-for-layoutworkletglobalscope①">LayoutWorkletGlobalScope</a></code> is the global execution context of the <code class="idl"><a data-link-type="idl" href="#dom-css-layoutworklet" id="ref-for-dom-css-layoutworklet②">layoutWorklet</a></code>.</p>
<pre class="idl highlight def">[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Global" id="ref-for-Global"><c- g>Global</c-></a>=(<a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/worklets.html#worklet" id="ref-for-worklet②"><c- n>Worklet</c-></a>,<a data-link-type="idl-name"><c- n>LayoutWorklet</c-></a>),<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed" id="ref-for-Exposed"><c- g>Exposed</c-></a>=<c- n>LayoutWorklet</c->]
<c- b>interface</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="interface" data-export id="layoutworkletglobalscope"><code><c- g>LayoutWorkletGlobalScope</c-></code></dfn> : <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/worklets.html#workletglobalscope" id="ref-for-workletglobalscope"><c- n>WorkletGlobalScope</c-></a> {
    <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-undefined" id="ref-for-idl-undefined"><c- b>undefined</c-></a> <a class="idl-code" data-link-type="method" href="#dom-layoutworkletglobalscope-registerlayout" id="ref-for-dom-layoutworkletglobalscope-registerlayout"><c- g>registerLayout</c-></a>(<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString" id="ref-for-idl-DOMString"><c- b>DOMString</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="LayoutWorkletGlobalScope/registerLayout(name, layoutCtor)" data-dfn-type="argument" data-export id="dom-layoutworkletglobalscope-registerlayout-name-layoutctor-name"><code><c- g>name</c-></code></dfn>, <a data-link-type="idl-name" href="https://webidl.spec.whatwg.org/#VoidFunction" id="ref-for-VoidFunction"><c- n>VoidFunction</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="LayoutWorkletGlobalScope/registerLayout(name, layoutCtor)" data-dfn-type="argument" data-export id="dom-layoutworkletglobalscope-registerlayout-name-layoutctor-layoutctor"><code><c- g>layoutCtor</c-></code></dfn>);
};
</pre>
   <div class="example" id="example-c2dc04c5">
    <a class="self-link" href="#example-c2dc04c5"></a> Web developers can feature detect by: 
<pre class="lang-javascript highlight"><c- k>if</c-> <c- p>(</c-><c- t>'layoutWorklet'</c-> <c- ow>in</c-> CSS<c- p>)</c-> <c- p>{</c->
  console<c- p>.</c->log<c- p>(</c-><c- t>'CSS Layout API available!'</c-><c- p>);</c->
<c- p>}</c->
</pre>
   </div>
   <h3 class="heading settled" data-level="3.1" id="concepts"><span class="secno">3.1. </span><span class="content">Concepts</span><a class="self-link" href="#concepts"></a></h3>
   <p>This section describes internal data-structures created when <code class="idl"><a data-link-type="idl" href="#dom-layoutworkletglobalscope-registerlayout" id="ref-for-dom-layoutworkletglobalscope-registerlayout①">registerLayout(name, layoutCtor)</a></code> is
called.</p>
   <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="layout-definition">layout definition</dfn> is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#struct" id="ref-for-struct">struct</a> which describes the information needed by the <code class="idl"><a data-link-type="idl" href="#layoutworkletglobalscope" id="ref-for-layoutworkletglobalscope②">LayoutWorkletGlobalScope</a></code> about the author defined layout (which can be referenced by the <a class="css" data-link-type="maybe" href="#valdef-display-layout" id="ref-for-valdef-display-layout②">layout()</a> function). It consists of:</p>
   <ul>
    <li data-md>
     <p><dfn class="dfn-paneled" data-dfn-for="layout definition" data-dfn-type="dfn" data-noexport id="layout-definition-class-constructor">class constructor</dfn> which is the class <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#sec-constructor" id="ref-for-sec-constructor">constructor</a>.</p>
    <li data-md>
     <p><dfn class="dfn-paneled" data-dfn-for="layout definition" data-dfn-type="dfn" data-noexport id="layout-definition-layout-function">layout function</dfn> which is the layout <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#sec-terms-and-definitions-function" id="ref-for-sec-terms-and-definitions-function">function</a> callback.</p>
    <li data-md>
     <p><dfn class="dfn-paneled" data-dfn-for="layout definition" data-dfn-type="dfn" data-noexport id="layout-definition-intrinsic-sizes-function">intrinsic sizes function</dfn> which is the intrinsic sizes <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#sec-terms-and-definitions-function" id="ref-for-sec-terms-and-definitions-function①">function</a> callback.</p>
    <li data-md>
     <p><dfn class="dfn-paneled" data-dfn-for="layout definition" data-dfn-type="dfn" data-noexport id="layout-definition-constructor-valid-flag">constructor valid flag</dfn>.</p>
    <li data-md>
     <p><dfn class="dfn-paneled" data-dfn-for="layout definition" data-dfn-type="dfn" data-noexport id="layout-definition-input-properties">input properties</dfn> which is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list">list</a> of <code>DOMStrings</code>.</p>
    <li data-md>
     <p><dfn class="dfn-paneled" data-dfn-for="layout definition" data-dfn-type="dfn" data-noexport id="layout-definition-child-input-properties">child input properties</dfn> which is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list①">list</a> of <code>DOMStrings</code>.</p>
    <li data-md>
     <p><dfn class="dfn-paneled" data-dfn-for="layout definition" data-dfn-type="dfn" data-noexport id="layout-definition-layout-options">layout options</dfn> a <code class="idl"><a data-link-type="idl" href="#dictdef-layoutoptions" id="ref-for-dictdef-layoutoptions">LayoutOptions</a></code>.</p>
   </ul>
   <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="document-layout-definition">document layout definition</dfn> is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#struct" id="ref-for-struct①">struct</a> which describes the information needed by
the <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-document" id="ref-for-concept-document">document</a> about the author defined layout (which can be referenced by the <a class="css" data-link-type="maybe" href="#valdef-display-layout" id="ref-for-valdef-display-layout③">layout()</a> function). It consists of:</p>
   <ul>
    <li data-md>
     <p><dfn class="dfn-paneled" data-dfn-for="document layout definition" data-dfn-type="dfn" data-noexport id="document-layout-definition-input-properties">input properties</dfn> which is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list②">list</a> of <code>DOMStrings</code></p>
    <li data-md>
     <p><dfn class="dfn-paneled" data-dfn-for="document layout definition" data-dfn-type="dfn" data-noexport id="document-layout-definition-child-input-properties">child input properties</dfn> which is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list③">list</a> of <code>DOMStrings</code>.</p>
    <li data-md>
     <p><dfn class="dfn-paneled" data-dfn-for="document layout definition" data-dfn-type="dfn" data-noexport id="document-layout-definition-layout-options">layout options</dfn> a <code class="idl"><a data-link-type="idl" href="#dictdef-layoutoptions" id="ref-for-dictdef-layoutoptions①">LayoutOptions</a></code>.</p>
   </ul>
   <h3 class="heading settled" data-level="3.2" id="registering-layout"><span class="secno">3.2. </span><span class="content">Registering A Layout</span><a class="self-link" href="#registering-layout"></a></h3>
   <p>The section describes how a web developer uses <code class="idl"><a data-link-type="idl" href="#dom-layoutworkletglobalscope-registerlayout" id="ref-for-dom-layoutworkletglobalscope-registerlayout②">registerLayout(name, layoutCtor)</a></code> to register a
layout.</p>
<pre class="idl highlight def">[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed" id="ref-for-Exposed①"><c- g>Exposed</c-></a>=<c- n>LayoutWorklet</c->]
<c- b>dictionary</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="dictionary" data-export id="dictdef-layoutoptions"><code><c- g>LayoutOptions</c-></code></dfn> {
  <a data-link-type="idl-name" href="#enumdef-childdisplaytype" id="ref-for-enumdef-childdisplaytype"><c- n>ChildDisplayType</c-></a> <dfn class="dfn-paneled idl-code" data-default="&quot;block&quot;" data-dfn-for="LayoutOptions" data-dfn-type="dict-member" data-export data-type="ChildDisplayType" id="dom-layoutoptions-childdisplay"><code><c- g>childDisplay</c-></code></dfn> = "block";
  <a data-link-type="idl-name" href="#enumdef-layoutsizingmode" id="ref-for-enumdef-layoutsizingmode"><c- n>LayoutSizingMode</c-></a> <dfn class="dfn-paneled idl-code" data-default="&quot;block-like&quot;" data-dfn-for="LayoutOptions" data-dfn-type="dict-member" data-export data-type="LayoutSizingMode" id="dom-layoutoptions-sizing"><code><c- g>sizing</c-></code></dfn> = "block-like";
};

[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed" id="ref-for-Exposed②"><c- g>Exposed</c-></a>=<c- n>LayoutWorklet</c->]
<c- b>enum</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="enum" data-export id="enumdef-childdisplaytype"><code><c- g>ChildDisplayType</c-></code></dfn> {
    <dfn class="dfn-paneled idl-code" data-dfn-for="ChildDisplayType" data-dfn-type="enum-value" data-export id="dom-childdisplaytype-block"><code><c- s>"block"</c-></code></dfn>, // default - "blockifies" the child boxes.
    <dfn class="dfn-paneled idl-code" data-dfn-for="ChildDisplayType" data-dfn-type="enum-value" data-export id="dom-childdisplaytype-normal"><code><c- s>"normal"</c-></code></dfn>,
};

[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed" id="ref-for-Exposed③"><c- g>Exposed</c-></a>=<c- n>LayoutWorklet</c->]
<c- b>enum</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="enum" data-export id="enumdef-layoutsizingmode"><code><c- g>LayoutSizingMode</c-></code></dfn> {
    <dfn class="dfn-paneled idl-code" data-dfn-for="LayoutSizingMode" data-dfn-type="enum-value" data-export id="dom-layoutsizingmode-block-like"><code><c- s>"block-like"</c-></code></dfn>, // default - Sizing behaves like block containers.
    <dfn class="dfn-paneled idl-code" data-dfn-for="LayoutSizingMode" data-dfn-type="enum-value" data-export id="dom-layoutsizingmode-manual"><code><c- s>"manual"</c-></code></dfn>, // Sizing is specified by the web developer.
};
</pre>
   <p>The <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-document" id="ref-for-concept-document①">document</a> has a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map" id="ref-for-ordered-map">map</a> of <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="document-layout-definitions">document layout definitions</dfn>. Initially this map is
empty; it is populated when <code class="idl"><a data-link-type="idl" href="#dom-layoutworkletglobalscope-registerlayout" id="ref-for-dom-layoutworkletglobalscope-registerlayout③">registerLayout(name, layoutCtor)</a></code> is called.</p>
   <p>The <code class="idl"><a data-link-type="idl" href="#layoutworkletglobalscope" id="ref-for-layoutworkletglobalscope③">LayoutWorkletGlobalScope</a></code> has a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map" id="ref-for-ordered-map①">map</a> of <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="layout-definitions">layout definitions</dfn>. Initially this map
is empty; it is populated when <code class="idl"><a data-link-type="idl" href="#dom-layoutworkletglobalscope-registerlayout" id="ref-for-dom-layoutworkletglobalscope-registerlayout④">registerLayout(name, layoutCtor)</a></code> is called.</p>
   <p>Each <a data-link-type="dfn" href="https://drafts.csswg.org/css-display-3/#box" id="ref-for-box①">box</a> representing a <a data-link-type="dfn" href="#layout-api-container" id="ref-for-layout-api-container⑥">layout API container</a> has a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map" id="ref-for-ordered-map②">map</a> of <dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="layout class instances" data-noexport id="layout-class-instances">layout class
instances</dfn>. Initially this map is empty; it is populated when the user agent calls either <a data-link-type="dfn" href="#determine-the-intrinsic-sizes" id="ref-for-determine-the-intrinsic-sizes">determine the intrinsic sizes</a> or <a data-link-type="dfn" href="#generate-a-fragment" id="ref-for-generate-a-fragment">generate a fragment</a> for a <a data-link-type="dfn" href="https://drafts.csswg.org/css-display-3/#box" id="ref-for-box②">box</a>.</p>
   <p>Each <a data-link-type="dfn" href="https://drafts.csswg.org/css-display-3/#box" id="ref-for-box③">box</a> representing a <a data-link-type="dfn" href="#layout-api-container" id="ref-for-layout-api-container⑦">layout API container</a> has a <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="stylemap">styleMap</dfn> internal slot.
This is a <code class="idl"><a data-link-type="idl" href="https://drafts.css-houdini.org/css-typed-om-1/#stylepropertymapreadonly" id="ref-for-stylepropertymapreadonly">StylePropertyMapReadOnly</a></code> which contains the properties listed in <code>inputProperties</code>.</p>
   <p>The user agent <em>clear</em> the <a data-link-type="dfn" href="#stylemap" id="ref-for-stylemap">styleMap</a> internal slot for a <a data-link-type="dfn" href="https://drafts.csswg.org/css-display-3/#box" id="ref-for-box④">box</a> when:</p>
   <ul>
    <li data-md>
     <p>The <a data-link-type="dfn" href="https://drafts.csswg.org/css-cascade-5/#computed-value" id="ref-for-computed-value②">computed values</a> of <a data-link-type="dfn" href="#document-layout-definition-input-properties" id="ref-for-document-layout-definition-input-properties">input properties</a> for the <a data-link-type="dfn" href="https://drafts.csswg.org/css-display-3/#box" id="ref-for-box⑤">box</a> changes.</p>
    <li data-md>
     <p>When the <a data-link-type="dfn" href="https://drafts.csswg.org/css-display-3/#box" id="ref-for-box⑥">box</a> is removed from the <a data-link-type="dfn" href="https://drafts.csswg.org/css-display-4/#box-tree" id="ref-for-box-tree②">box tree</a>.</p>
    <li data-md>
     <p>Every 1000 layout passes.</p>
     <p class="note" role="note"><span class="marker">Note:</span> The above rule exists to ensure that web developers do not rely on being able to store
    non-regeneratable state on the <code class="idl"><a data-link-type="idl" href="https://drafts.css-houdini.org/css-typed-om-1/#stylepropertymapreadonly" id="ref-for-stylepropertymapreadonly①">StylePropertyMapReadOnly</a></code> object.
    The 1000 limit was picked as a high upper bound, this limit may improve (downwards) over
    time.</p>
   </ul>
   <div class="note" role="note">
     Note: The shape of the class should be: 
<pre class="lang-javascript highlight">registerLayout<c- p>(</c-><c- t>'example'</c-><c- p>,</c-> <c- a>class</c-> <c- p>{</c->
    <c- k>static</c-> inputProperties <c- o>=</c-> <c- p>[</c-><c- t>'--foo'</c-><c- p>];</c->
    <c- k>static</c-> childrenInputProperties <c- o>=</c-> <c- p>[</c-><c- t>'--bar'</c-><c- p>];</c->
    <c- k>static</c-> layoutOptions <c- o>=</c-> <c- p>{</c->
      childDisplay<c- o>:</c-> <c- t>'normal'</c-><c- p>,</c->
      sizing<c- o>:</c-> <c- t>'block-like'</c->
    <c- p>};</c->

    <c- k>async</c-> intrinsicSizes<c- p>(</c->children<c- p>,</c-> edges<c- p>,</c-> styleMap<c- p>)</c-> <c- p>{</c->
        <c- c1>// Intrinsic sizes code goes here.</c->
    <c- p>}</c->

    <c- k>async</c-> layout<c- p>(</c->children<c- p>,</c-> edges<c- p>,</c-> constraints<c- p>,</c-> styleMap<c- p>,</c-> breakToken<c- p>)</c-> <c- p>{</c->
        <c- c1>// Layout code goes here.</c->
    <c- p>}</c->
<c- p>});</c->
</pre>
   </div>
   <p>The algorithm below is run when the <code class="idl"><a data-link-type="idl" href="#dom-layoutworkletglobalscope-registerlayout" id="ref-for-dom-layoutworkletglobalscope-registerlayout⑤">registerLayout(name, layoutCtor)</a></code> is called. It notifies the
user agent layout engine about the new user defined layout.</p>
   <div class="algorithm" data-algorithm="registerLayout(name, layoutCtor)" data-algorithm-for="LayoutWorkletGlobalScope">
     When the <dfn class="dfn-paneled idl-code" data-dfn-for="LayoutWorkletGlobalScope" data-dfn-type="method" data-export id="dom-layoutworkletglobalscope-registerlayout"><code>registerLayout(<var>name</var>, <var>layoutCtor</var>)</code></dfn> method
is called, the user agent <em>must</em> run the following steps: 
    <ol>
     <li data-md>
      <p>If the <var>name</var> is an empty string, <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#dfn-throw" id="ref-for-dfn-throw">throw</a> a <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#sec-native-error-types-used-in-this-standard-typeerror" id="ref-for-sec-native-error-types-used-in-this-standard-typeerror">TypeError</a> and abort all these steps.</p>
     <li data-md>
      <p>Let <var>layoutDefinitionMap</var> be <code class="idl"><a data-link-type="idl" href="#layoutworkletglobalscope" id="ref-for-layoutworkletglobalscope④">LayoutWorkletGlobalScope</a></code>’s <a data-link-type="dfn" href="#layout-definitions" id="ref-for-layout-definitions">layout definitions</a> map.</p>
     <li data-md>
      <p>If <var>layoutDefinitionMap</var>[<var>name</var>] <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-exists" id="ref-for-map-exists">exists</a> <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#dfn-throw" id="ref-for-dfn-throw①">throw</a> a "<code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#invalidmodificationerror" id="ref-for-invalidmodificationerror">InvalidModificationError</a></code>" <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException">DOMException</a></code> and abort all these steps.</p>
     <li data-md>
      <p>Let <var>inputProperties</var> be an empty <code>sequence&lt;DOMString></code>.</p>
     <li data-md>
      <p>Let <var>inputPropertiesIterable</var> be the result of <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#sec-get-o-p" id="ref-for-sec-get-o-p">Get</a>(<var>layoutCtor</var>, "inputProperties").</p>
     <li data-md>
      <p>If <var>inputPropertiesIterable</var> is not undefined, then set <var>inputProperties</var> to the result of <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#javascript-string-convert" id="ref-for-javascript-string-convert">converting</a> <var>inputPropertiesIterable</var> to a <code>sequence&lt;DOMString></code>. If an
exception is <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#dfn-throw" id="ref-for-dfn-throw②">thrown</a>, rethrow the exception and abort all these steps.</p>
     <li data-md>
      <p>Filter <var>inputProperties</var> so that it only contains <a data-link-type="dfn" href="https://drafts.csswg.org/cssom-1/#supported-css-property" id="ref-for-supported-css-property">supported CSS properties</a> and <a data-link-type="dfn" href="https://drafts.csswg.org/css-variables-2/#custom-property" id="ref-for-custom-property">custom properties</a>.</p>
      <p class="note" role="note"><span class="marker">Note:</span> The list of CSS properties provided by the input properties getter can either be
    custom or native CSS properties.</p>
      <p class="note" role="note"><span class="marker">Note:</span> The list of CSS properties may contain shorthands.</p>
      <p class="note" role="note"><span class="marker">Note:</span> In order for a layout class to be forwards compatible, the list of CSS properties can
    also contains currently invalid properties for the user agent. For example <code>margin-bikeshed-property</code>.</p>
     <li data-md>
      <p>Let <var>childInputProperties</var> be an empty <code>sequence&lt;DOMString></code>.</p>
     <li data-md>
      <p>Let <var>childInputPropertiesIterable</var> be the result of <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#sec-get-o-p" id="ref-for-sec-get-o-p①">Get</a>(<var>layoutCtor</var>,
"childInputProperties").</p>
     <li data-md>
      <p>If <var>childInputPropertiesIterable</var> is not undefined, then set <var>childInputProperties</var> to the
result of <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#javascript-string-convert" id="ref-for-javascript-string-convert①">converting</a> <var>childInputPropertiesIterable</var> to a <code>sequence&lt;DOMString></code>. If an exception is <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#dfn-throw" id="ref-for-dfn-throw③">thrown</a>, rethrow the exception
and abort all these steps.</p>
     <li data-md>
      <p>Filter <var>childInputProperties</var> so that it only contains <a data-link-type="dfn" href="https://drafts.csswg.org/cssom-1/#supported-css-property" id="ref-for-supported-css-property①">supported CSS properties</a> and <a data-link-type="dfn" href="https://drafts.csswg.org/css-variables-2/#custom-property" id="ref-for-custom-property①">custom properties</a>.</p>
     <li data-md>
      <p>Let <var>layoutOptionsValue</var> be the result of <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#sec-get-o-p" id="ref-for-sec-get-o-p②">Get</a>(<var>layoutCtor</var>, "layoutOptions").</p>
     <li data-md>
      <p>Let <var>layoutOptions</var> be the result of <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#javascript-string-convert" id="ref-for-javascript-string-convert②">converting</a> <var>layoutOptionsValue</var> to a <code class="idl"><a data-link-type="idl" href="#dictdef-layoutoptions" id="ref-for-dictdef-layoutoptions②">LayoutOptions</a></code>. If an exception is <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#dfn-throw" id="ref-for-dfn-throw④">thrown</a>, rethrow the exception and abort all these
steps.</p>
     <li data-md>
      <p>Let <var>prototype</var> be the result of <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#sec-get-o-p" id="ref-for-sec-get-o-p③">Get</a>(<var>layoutCtor</var>, "prototype").</p>
     <li data-md>
      <p>If the result of <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#sec-ecmascript-data-types-and-values" id="ref-for-sec-ecmascript-data-types-and-values">Type</a>(<var>prototype</var>) is not Object, <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#dfn-throw" id="ref-for-dfn-throw⑤">throw</a> a <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#sec-native-error-types-used-in-this-standard-typeerror" id="ref-for-sec-native-error-types-used-in-this-standard-typeerror①">TypeError</a> and abort
all these steps.</p>
     <li data-md>
      <p>Let <var>intrinsicSizesValue</var> be the result of <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#sec-get-o-p" id="ref-for-sec-get-o-p④">Get</a>(<var>prototype</var>, "intrinsicSizes").</p>
     <li data-md>
      <p>Let <var>intrinsicSizes</var> be the result of <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#javascript-string-convert" id="ref-for-javascript-string-convert③">converting</a> <var>intrinsicSizesValue</var> to the <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#sec-terms-and-definitions-function" id="ref-for-sec-terms-and-definitions-function②">Function</a> <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#dfn-callback-function" id="ref-for-dfn-callback-function">callback function</a> type. Rethrow any exceptions from the conversion.</p>
     <li data-md>
      <p>Let <var>layoutValue</var> be the result of <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#sec-get-o-p" id="ref-for-sec-get-o-p⑤">Get</a>(<var>prototype</var>, <code>"layout"</code>).</p>
     <li data-md>
      <p>Let <var>layout</var> be the result of <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#javascript-string-convert" id="ref-for-javascript-string-convert④">converting</a> <var>layoutValue</var> to the <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#sec-terms-and-definitions-function" id="ref-for-sec-terms-and-definitions-function③">Function</a> <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#dfn-callback-function" id="ref-for-dfn-callback-function①">callback function</a> type. Rethrow any exceptions from the conversion.</p>
     <li data-md>
      <p>Let <var>definition</var> be a new <a data-link-type="dfn" href="#layout-definition" id="ref-for-layout-definition">layout definition</a> with:</p>
      <ul>
       <li data-md>
        <p><a data-link-type="dfn" href="#layout-definition-class-constructor" id="ref-for-layout-definition-class-constructor">class constructor</a> being <var>layoutCtor</var>.</p>
       <li data-md>
        <p><a data-link-type="dfn" href="#layout-definition-layout-function" id="ref-for-layout-definition-layout-function">layout function</a> being <var>layout</var>.</p>
       <li data-md>
        <p><a data-link-type="dfn" href="#layout-definition-intrinsic-sizes-function" id="ref-for-layout-definition-intrinsic-sizes-function">intrinsic sizes function</a> being <var>intrinsicSizes</var>.</p>
       <li data-md>
        <p><a data-link-type="dfn" href="#layout-definition-constructor-valid-flag" id="ref-for-layout-definition-constructor-valid-flag">constructor valid flag</a> being <b>true</b>.</p>
       <li data-md>
        <p><a data-link-type="dfn" href="#layout-definition-child-input-properties" id="ref-for-layout-definition-child-input-properties">child input properties</a> being <var>childInputProperties</var>.</p>
       <li data-md>
        <p><a data-link-type="dfn" href="#layout-definition-input-properties" id="ref-for-layout-definition-input-properties">input properties</a> being <var>inputProperties</var>.</p>
       <li data-md>
        <p><a data-link-type="dfn" href="#layout-definition-layout-options" id="ref-for-layout-definition-layout-options">layout options</a> being <var>layoutOptions</var>.</p>
      </ul>
     <li data-md>
      <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-set" id="ref-for-map-set">Set</a> <var>layoutDefinitionMap</var>[<var>name</var>] to <var>definition</var>.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task" id="ref-for-queue-a-task">Queue a task</a> to run the following steps:</p>
      <ol>
       <li data-md>
        <p>Let <var>documentLayoutDefinitionMap</var> be the associated <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-document" id="ref-for-concept-document②">document’s</a> <a data-link-type="dfn" href="#document-layout-definitions" id="ref-for-document-layout-definitions">document layout definitions</a> <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map" id="ref-for-ordered-map③">map</a>.</p>
       <li data-md>
        <p>Let <var>documentDefinition</var> be a new <a data-link-type="dfn" href="#document-layout-definition" id="ref-for-document-layout-definition">document layout definition</a> with:</p>
        <ul>
         <li data-md>
          <p><a data-link-type="dfn" href="#document-layout-definition-child-input-properties" id="ref-for-document-layout-definition-child-input-properties">child input properties</a> being <var>childInputProperties</var>.</p>
         <li data-md>
          <p><a data-link-type="dfn" href="#document-layout-definition-input-properties" id="ref-for-document-layout-definition-input-properties①">input properties</a> being <var>inputProperties</var>.</p>
         <li data-md>
          <p><a data-link-type="dfn" href="#document-layout-definition-layout-options" id="ref-for-document-layout-definition-layout-options③">layout options</a> being <var>layoutOptions</var>.</p>
        </ul>
       <li data-md>
        <p>If <var>documentLayoutDefinitionMap</var>[<var>name</var>] <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-exists" id="ref-for-map-exists①">exists</a>, run the following steps:</p>
        <ol>
         <li data-md>
          <p>Let <var>existingDocumentDefinition</var> be the result of <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-get" id="ref-for-map-get">get</a> <var>documentLayoutDefinitionMap</var>[<var>name</var>].</p>
         <li data-md>
          <p>If <var>existingDocumentDefinition</var> is <code>"invalid"</code>, abort all these steps.</p>
         <li data-md>
          <p>If <var>existingDocumentDefinition</var> and <var>documentDefinition</var> are not equivalent, (that is <a data-link-type="dfn" href="#document-layout-definition-input-properties" id="ref-for-document-layout-definition-input-properties②">input properties</a>, <a data-link-type="dfn" href="#document-layout-definition-child-input-properties" id="ref-for-document-layout-definition-child-input-properties①">child input properties</a>, and <a data-link-type="dfn" href="#document-layout-definition-layout-options" id="ref-for-document-layout-definition-layout-options④">layout options</a> are
different), then:</p>
          <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-set" id="ref-for-map-set①">Set</a> <var>documentLayoutDefinitionMap</var>[<var>name</var>] to <code>"invalid"</code>.</p>
          <p>Log an error to the debugging console stating that the same class was registered
with different <code>inputProperties</code>, <code>childInputProperties</code>, or <code>layoutOptions</code>.</p>
        </ol>
       <li data-md>
        <p>Otherwise, <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-set" id="ref-for-map-set②">set</a> <var>documentLayoutDefinitionMap</var>[<var>name</var>] to <var>documentDefinition</var>.</p>
      </ol>
    </ol>
   </div>
   <h3 class="heading settled" data-level="3.3" id="terminology"><span class="secno">3.3. </span><span class="content">Terminology</span><a class="self-link" href="#terminology"></a></h3>
   <p>We define the following terms to be clear about which layout algorithm (formatting context) we are
talking about.</p>
   <p>The <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="current-layout">current layout</dfn> is the layout algorithm for the <a data-link-type="dfn" href="https://drafts.csswg.org/css-display-3/#box" id="ref-for-box⑦">box</a> we are currently performing
layout for.</p>
   <p>The <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="parent-layout">parent layout</dfn> is the layout algorithm for the <a data-link-type="dfn" href="https://drafts.csswg.org/css-display-3/#box" id="ref-for-box⑧">box’s</a> direct parent, (the layout
algorithm which is requesting the <a data-link-type="dfn" href="#current-layout" id="ref-for-current-layout">current layout</a> to be performed).</p>
   <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="child-layout">child layout</dfn> is the layout algorithm for a <code class="idl"><a data-link-type="idl" href="#layoutchild" id="ref-for-layoutchild②">LayoutChild</a></code> of the <a data-link-type="dfn" href="#current-layout" id="ref-for-current-layout①">current layout</a>.</p>
   <h2 class="heading settled" data-level="4" id="layout-api"><span class="secno">4. </span><span class="content">Layout API</span><a class="self-link" href="#layout-api"></a></h2>
   <p>This section describes the objects of the Layout API provided to web developers.</p>
   <h3 class="heading settled" data-level="4.1" id="layout-children"><span class="secno">4.1. </span><span class="content">Layout Children</span><a class="self-link" href="#layout-children"></a></h3>
   <p>A <code class="idl"><a data-link-type="idl" href="#layoutchild" id="ref-for-layoutchild③">LayoutChild</a></code> represents a inflow CSS generated <a data-link-type="dfn" href="https://drafts.csswg.org/css-display-3/#box" id="ref-for-box⑨">box</a> before layout has occurred. (The box or
boxes will all have a computed value of <a class="property css" data-link-type="property" href="https://drafts.csswg.org/css-display-4/#propdef-display" id="ref-for-propdef-display①">display</a> that is not <a class="css" data-link-type="maybe" href="https://drafts.csswg.org/css-display-3/#valdef-display-none" id="ref-for-valdef-display-none">none</a>).</p>
   <p>The <code class="idl"><a data-link-type="idl" href="#layoutchild" id="ref-for-layoutchild④">LayoutChild</a></code> does not contain any layout information itself (like inline or block size) but
can be used to generate <code class="idl"><a data-link-type="idl" href="#layoutfragment" id="ref-for-layoutfragment①">LayoutFragment</a></code>s which do contain layout information.</p>
   <p>An author cannot construct a <code class="idl"><a data-link-type="idl" href="#layoutchild" id="ref-for-layoutchild⑤">LayoutChild</a></code> with this API, this happens at a separate stage of the
user agent rendering engine (post style resolution).</p>
   <p>An array of <code class="idl"><a data-link-type="idl" href="#layoutchild" id="ref-for-layoutchild⑥">LayoutChild</a></code>ren is passed into the layout/intrinsicSizes methods which represents the
children of the current box which is being laid out.</p>
<pre class="idl highlight def">[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed" id="ref-for-Exposed④"><c- g>Exposed</c-></a>=<c- n>LayoutWorklet</c->]
<c- b>interface</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="interface" data-export id="layoutchild"><code><c- g>LayoutChild</c-></code></dfn> {
    <c- b>readonly</c-> <c- b>attribute</c-> <a data-link-type="idl-name" href="https://drafts.css-houdini.org/css-typed-om-1/#stylepropertymapreadonly" id="ref-for-stylepropertymapreadonly②"><c- n>StylePropertyMapReadOnly</c-></a> <a class="idl-code" data-link-type="attribute" data-readonly data-type="StylePropertyMapReadOnly" href="#dom-layoutchild-stylemap" id="ref-for-dom-layoutchild-stylemap"><c- g>styleMap</c-></a>;

    <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise" id="ref-for-idl-promise"><c- b>Promise</c-></a>&lt;<a data-link-type="idl-name" href="#intrinsicsizes" id="ref-for-intrinsicsizes"><c- n>IntrinsicSizes</c-></a>> <a class="idl-code" data-link-type="method" href="#dom-layoutchild-intrinsicsizes" id="ref-for-dom-layoutchild-intrinsicsizes"><c- g>intrinsicSizes</c-></a>();
    <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise" id="ref-for-idl-promise①"><c- b>Promise</c-></a>&lt;<a data-link-type="idl-name" href="#layoutfragment" id="ref-for-layoutfragment②"><c- n>LayoutFragment</c-></a>> <a class="idl-code" data-link-type="method" href="#dom-layoutchild-layoutnextfragment" id="ref-for-dom-layoutchild-layoutnextfragment①"><c- g>layoutNextFragment</c-></a>(<a data-link-type="idl-name" href="#dictdef-layoutconstraintsoptions" id="ref-for-dictdef-layoutconstraintsoptions"><c- n>LayoutConstraintsOptions</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="LayoutChild/layoutNextFragment(constraints, breakToken)" data-dfn-type="argument" data-export id="dom-layoutchild-layoutnextfragment-constraints-breaktoken-constraints"><code><c- g>constraints</c-></code></dfn>, <a data-link-type="idl-name" href="#childbreaktoken" id="ref-for-childbreaktoken"><c- n>ChildBreakToken</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="LayoutChild/layoutNextFragment(constraints, breakToken)" data-dfn-type="argument" data-export id="dom-layoutchild-layoutnextfragment-constraints-breaktoken-breaktoken"><code><c- g>breakToken</c-></code></dfn>);
};
</pre>
   <p>The <code class="idl"><a data-link-type="idl" href="#layoutchild" id="ref-for-layoutchild⑦">LayoutChild</a></code> has internal slot(s):</p>
   <ul>
    <li data-md>
     <p><dfn class="dfn-paneled idl-code" data-dfn-for="LayoutChild" data-dfn-type="attribute" data-export id="dom-layoutchild-box-slot"><code>[[box]]</code></dfn> a CSS <a data-link-type="dfn" href="https://drafts.csswg.org/css-display-3/#box" id="ref-for-box①⓪">box</a>.</p>
    <li data-md>
     <p><dfn class="dfn-paneled idl-code" data-dfn-for="LayoutChild" data-dfn-type="attribute" data-export id="dom-layoutchild-stylemap-slot"><code>[[styleMap]]</code></dfn> a <code class="idl"><a data-link-type="idl" href="https://drafts.css-houdini.org/css-typed-om-1/#stylepropertymapreadonly" id="ref-for-stylepropertymapreadonly③">StylePropertyMapReadOnly</a></code>, this is the
computed style for the child, it is populated with only the properties listed in <code>childInputProperties</code>.</p>
   </ul>
   <ul>
    <li data-md>
     <p><dfn class="dfn-paneled idl-code" data-dfn-for="LayoutChild" data-dfn-type="attribute" data-export id="dom-layoutchild-unique-id-slot"><code>[[unique id]]</code></dfn> the <a data-link-type="dfn" href="#layout-api-context-unique-id" id="ref-for-layout-api-context-unique-id">unique id</a> of the current <a data-link-type="dfn" href="#layout-api-context" id="ref-for-layout-api-context">layout api context</a>. This slot is used so that a <code class="idl"><a data-link-type="idl" href="#layoutchild" id="ref-for-layoutchild⑧">LayoutChild</a></code> used outside the current layout
   pass is invalid.</p>
   </ul>
   <p>The <code class="idl"><a data-link-type="idl" href="#dom-layoutchild-stylemap-slot" id="ref-for-dom-layoutchild-stylemap-slot">[[styleMap]]</a></code> may be pre-populated when the <a data-link-type="dfn" href="https://drafts.csswg.org/css-cascade-5/#computed-value" id="ref-for-computed-value③">computed value</a> for properties
listed in the in <a data-link-type="dfn" href="#layout-definition-child-input-properties" id="ref-for-layout-definition-child-input-properties①">child input properties</a> for the <code class="idl"><a data-link-type="idl" href="#dom-layoutchild-box-slot" id="ref-for-dom-layoutchild-box-slot">[[box]]</a></code>.</p>
   <div class="example" id="example-0b365c06">
    <a class="self-link" href="#example-0b365c06"></a> The example below shows the basic usage of a <code class="idl"><a data-link-type="idl" href="#layoutchild" id="ref-for-layoutchild⑨">LayoutChild</a></code>. 
<pre class="lang-javascript highlight">registerLayout<c- p>(</c-><c- t>'example-layout-child'</c-><c- p>,</c-> <c- a>class</c-> <c- p>{</c->
  <c- k>static</c-> childInputProperties <c- o>=</c-> <c- p>[</c-><c- t>'--foo'</c-><c- p>];</c->

  <c- k>async</c-> layout<c- p>(</c->children<c- p>,</c-> edges<c- p>,</c-> constraints<c- p>,</c-> styleMap<c- p>)</c-> <c- p>{</c->

    <c- c1>// An array of LayoutChildren is passed into both the layout function,</c->
    <c- c1>// and intrinsic sizes function below.</c->
    <c- a>const</c-> child <c- o>=</c-> children<c- p>[</c-><c- mf>0</c-><c- p>];</c->

    <c- c1>// You can query the any properties listed in "childInputProperties".</c->
    <c- a>const</c-> fooValue <c- o>=</c-> child<c- p>.</c->styleMap<c- p>.</c->get<c- p>(</c-><c- t>'--foo'</c-><c- p>);</c->

    <c- c1>// And perform layout!</c->
    <c- a>const</c-> fragment <c- o>=</c-> <c- k>await</c-> child<c- p>.</c->layoutNextFragment<c- p>({});</c->

  <c- p>}</c->

  <c- k>async</c-> intrinsicSizes<c- p>(</c->children<c- p>,</c-> edges<c- p>,</c-> styleMap<c- p>)</c-> <c- p>{</c->

    <c- c1>// Or request the intrinsic size!</c->
    <c- a>const</c-> childIntrinsicSize <c- o>=</c-> <c- k>await</c-> children<c- p>[</c-><c- mf>0</c-><c- p>].</c->intrinsicSizes<c- p>();</c->

  <c- p>}</c->
<c- p>});</c->
</pre>
   </div>
   <p>A <code class="idl"><a data-link-type="idl" href="#layoutchild" id="ref-for-layoutchild①⓪">LayoutChild</a></code> could be generated by:</p>
   <ul>
    <li data-md>
     <p>An <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-element" id="ref-for-concept-element">element</a>.</p>
    <li data-md>
     <p>A <a data-link-type="dfn" href="https://drafts.csswg.org/css-inline-3/#root-inline-box" id="ref-for-root-inline-box②">root inline box</a>.</p>
    <li data-md>
     <p>A <a class="css" data-link-type="selector" href="https://drafts.csswg.org/css-pseudo-4/#selectordef-before" id="ref-for-selectordef-before">::before</a> or <a class="css" data-link-type="selector" href="https://drafts.csswg.org/css-pseudo-4/#selectordef-after" id="ref-for-selectordef-after">::after</a> pseudo-element.</p>
     <p class="note" role="note"><span class="marker">Note:</span> Other pseudo-elements such as <a class="css" data-link-type="selector" href="https://drafts.csswg.org/css-pseudo-4/#selectordef-first-letter" id="ref-for-selectordef-first-letter">::first-letter</a> or <a class="css" data-link-type="selector" href="https://drafts.csswg.org/css-pseudo-4/#selectordef-first-line" id="ref-for-selectordef-first-line">::first-line</a> do not
    generate a <code class="idl"><a data-link-type="idl" href="#layoutchild" id="ref-for-layoutchild①①">LayoutChild</a></code> for layout purposes. They are additional
    styling information for a text node.</p>
    <li data-md>
     <p>An <a data-link-type="dfn" href="https://drafts.csswg.org/css-display-4/#anonymous" id="ref-for-anonymous">anonymous box</a>. For example an anonymous box may be inserted as a result of:</p>
     <ul>
      <li data-md>
       <p>A text node which has undergone <a data-link-type="dfn" href="https://drafts.csswg.org/css-display-4/#blockify" id="ref-for-blockify②">blockification</a>. (Or more generally a <a data-link-type="dfn" href="https://drafts.csswg.org/css-inline-3/#root-inline-box" id="ref-for-root-inline-box③">root inline box</a> which has undergone <a data-link-type="dfn" href="https://drafts.csswg.org/css-display-4/#blockify" id="ref-for-blockify③">blockification</a>).</p>
      <li data-md>
       <p>An element with <a class="css" data-link-type="propdesc" href="https://drafts.csswg.org/css-display-4/#propdef-display" id="ref-for-propdef-display②">display: table-cell</a> which doesn’t have a parent with <a class="css" data-link-type="propdesc" href="https://drafts.csswg.org/css-display-4/#propdef-display" id="ref-for-propdef-display③">display: table</a>.</p>
     </ul>
   </ul>
   <div class="note" role="note">
     Note: As an example the following would be placed into three <code class="idl"><a data-link-type="idl" href="#layoutchild" id="ref-for-layoutchild①②">LayoutChild</a></code>ren: 
<pre class="lang-html highlight"><c- p>&lt;</c-><c- f>style</c-><c- p>></c->
  <c- p>#</c-><c- nn>box</c-><c- p>::</c-><c- nd>before</c-> <c- p>{</c-> <c- k>content</c-><c- p>:</c-> <c- t>'hello!'</c-><c- p>;</c-> <c- p>}</c->
<c- p>&lt;/</c-><c- f>style</c-><c- p>></c->
<c- p>&lt;</c-><c- f>div</c-> <c- e>id</c-><c- o>=</c-><c- s>"box"</c-><c- p>></c->A block level box with text.<c- p>&lt;/</c-><c- f>div</c-><c- p>></c->
<c- p>&lt;</c-><c- f>img</c-> <c- e>src</c-><c- o>=</c-><c- s>"..."</c-> <c- p>/></c->
</pre>
   </div>
   <div class="note" role="note">
     Note: As an example the following would be placed into a single <code class="idl"><a data-link-type="idl" href="#layoutchild" id="ref-for-layoutchild①③">LayoutChild</a></code> as they share a <a data-link-type="dfn" href="https://drafts.csswg.org/css-inline-3/#root-inline-box" id="ref-for-root-inline-box④">root inline box</a>: 
<pre class="lang-html highlight">This is a next node, <c- p>&lt;</c-><c- f>span</c-><c- p>></c->with some additional styling,
that may<c- p>&lt;/</c-><c- f>span</c-><c- p>></c-> break over<c- p>&lt;</c-><c- f>br</c-><c- p>></c->multiple lines.
</pre>
   </div>
   <p>Multiple non-<a data-link-type="dfn" href="https://drafts.csswg.org/css-display-4/#atomic-inline" id="ref-for-atomic-inline②">atomic inlines</a> are placed within the same <code class="idl"><a data-link-type="idl" href="#layoutchild" id="ref-for-layoutchild①④">LayoutChild</a></code> to allow rendering
engines to perform text shaping across element boundaries.</p>
   <div class="note" role="note">
     Note: As an example the following should produce one <code class="idl"><a data-link-type="idl" href="#layoutfragment" id="ref-for-layoutfragment③">LayoutFragment</a></code> but is from
    three non-<a data-link-type="dfn" href="https://drafts.csswg.org/css-display-4/#atomic-inline" id="ref-for-atomic-inline③">atomic inlines</a>: 
<pre class="lang-html highlight">ع<c- p>&lt;</c-><c- f>span</c-> <c- e>style</c-><c- o>=</c-><c- s>"color: blue"</c-><c- p>></c->ع<c- p>&lt;/</c-><c- f>span</c-><c- p>></c->ع
</pre>
   </div>
   <p class="note" role="note"><span class="marker">Note:</span> When accessing the <code class="idl"><a data-link-type="idl" href="#dom-layoutchild-stylemap" id="ref-for-dom-layoutchild-stylemap①">styleMap</a></code> the user agent can create a new <code class="idl"><a data-link-type="idl" href="https://drafts.css-houdini.org/css-typed-om-1/#stylepropertymapreadonly" id="ref-for-stylepropertymapreadonly④">StylePropertyMapReadOnly</a></code> if none exists yet.</p>
   <div class="algorithm" data-algorithm="styleMap" data-algorithm-for="LayoutChild">
     The <dfn class="dfn-paneled idl-code" data-dfn-for="LayoutChild" data-dfn-type="attribute" data-export id="dom-layoutchild-stylemap"><code>styleMap</code></dfn>, on getting from a <code class="idl"><a data-link-type="idl" href="#layoutchild" id="ref-for-layoutchild①⑤">LayoutChild</a></code> <var>this</var>, the
user agent must perform the following steps: 
    <ol>
     <li data-md>
      <p>If <var>this</var>’ <code class="idl"><a data-link-type="idl" href="#dom-layoutchild-stylemap-slot" id="ref-for-dom-layoutchild-stylemap-slot①">[[styleMap]]</a></code> is null, then:</p>
      <ol>
       <li data-md>
        <p>Let <var>box</var> be <var>this</var>’ <code class="idl"><a data-link-type="idl" href="#dom-layoutchild-box-slot" id="ref-for-dom-layoutchild-box-slot①">[[box]]</a></code>.</p>
       <li data-md>
        <p>Let <var>definition</var> be the result of <a data-link-type="dfn" href="#get-a-layout-definition" id="ref-for-get-a-layout-definition">get a layout definition</a>.</p>
       <li data-md>
        <p>Let <var>childInputProperties</var> be <var>definition</var>’s <a data-link-type="dfn" href="#layout-definition-child-input-properties" id="ref-for-layout-definition-child-input-properties②">child input properties</a>.</p>
       <li data-md>
        <p>Let <var>styleMap</var> be a new <code class="idl"><a data-link-type="idl" href="https://drafts.css-houdini.org/css-typed-om-1/#stylepropertymapreadonly" id="ref-for-stylepropertymapreadonly⑤">StylePropertyMapReadOnly</a></code> populated with <em>only</em> the <a data-link-type="dfn" href="https://drafts.csswg.org/css-cascade-5/#computed-value" id="ref-for-computed-value④">computed values</a> for properties listed in <var>childInputProperties</var> for <var>box</var>.</p>
       <li data-md>
        <p>Set <var>this</var>’ <code class="idl"><a data-link-type="idl" href="#dom-layoutchild-stylemap-slot" id="ref-for-dom-layoutchild-stylemap-slot②">[[styleMap]]</a></code> internal slot to <var>styleMap</var>.</p>
      </ol>
      <p class="note" role="note"><span class="marker">Note:</span> If the user agent always pre-populates <code class="idl"><a data-link-type="idl" href="#dom-layoutchild-stylemap-slot" id="ref-for-dom-layoutchild-stylemap-slot③">[[styleMap]]</a></code> then this branch
    of the algorithm won’t be reached.</p>
     <li data-md>
      <p>Return <var>this</var>’ <code class="idl"><a data-link-type="idl" href="https://drafts.css-houdini.org/css-typed-om-1/#stylepropertymapreadonly" id="ref-for-stylepropertymapreadonly⑥">StylePropertyMapReadOnly</a></code> contained in the <code class="idl"><a data-link-type="idl" href="#dom-layoutchild-stylemap-slot" id="ref-for-dom-layoutchild-stylemap-slot④">[[styleMap]]</a></code> internal slot.</p>
    </ol>
   </div>
   <p class="note" role="note"><span class="marker">Note:</span> The <code class="idl"><a data-link-type="idl" href="#dom-layoutchild-intrinsicsizes" id="ref-for-dom-layoutchild-intrinsicsizes①">intrinsicSizes()</a></code> method allows the web developer to query the intrinsic sizes of the <code class="idl"><a data-link-type="idl" href="#layoutchild" id="ref-for-layoutchild①⑥">LayoutChild</a></code>.</p>
   <div class="algorithm" data-algorithm="intrinsicSizes()" data-algorithm-for="LayoutChild">
     When the <dfn class="dfn-paneled idl-code" data-dfn-for="LayoutChild" data-dfn-type="method" data-export id="dom-layoutchild-intrinsicsizes"><code>intrinsicSizes()</code></dfn> method is called on a <code class="idl"><a data-link-type="idl" href="#layoutchild" id="ref-for-layoutchild①⑦">LayoutChild</a></code> <var>this</var>, the user agent must perform the following steps: 
    <ol>
     <li data-md>
      <p>Let <var>p</var> be a new promise.</p>
     <li data-md>
      <p>Let <var>context</var> be the <a data-link-type="dfn" href="#current-layout" id="ref-for-current-layout②">current layout’s</a> <a data-link-type="dfn" href="#layout-api-context" id="ref-for-layout-api-context①">layout API context</a>.</p>
     <li data-md>
      <p>If <var>this</var>’ <code class="idl"><a data-link-type="idl" href="#dom-layoutchild-unique-id-slot" id="ref-for-dom-layoutchild-unique-id-slot">[[unique id]]</a></code> is not equal to <var>context</var>’s <a data-link-type="dfn" href="#layout-api-context-unique-id" id="ref-for-layout-api-context-unique-id①">unique id</a>, reject <var>p</var> with a "<code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#invalidstateerror" id="ref-for-invalidstateerror">InvalidStateError</a></code>" <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException①">DOMException</a></code>, and abort all these steps.</p>
      <p class="note" role="note"><span class="marker">Note:</span> This is to ensure that only <code class="idl"><a data-link-type="idl" href="#layoutchild" id="ref-for-layoutchild①⑧">LayoutChild</a></code>ren passed in as arguments to either the
    layout or intrinsicSizes method are used.</p>
     <li data-md>
      <p>Let <var>task</var> be a new <a data-link-type="dfn" href="#layout-api-work-task" id="ref-for-layout-api-work-task">layout API work task</a> with:</p>
      <ul>
       <li data-md>
        <p><a data-link-type="dfn" href="#layout-api-work-task-layout-child" id="ref-for-layout-api-work-task-layout-child">layout child</a> being <var>this</var>.</p>
       <li data-md>
        <p><a data-link-type="dfn" href="#layout-api-work-task-task-type" id="ref-for-layout-api-work-task-task-type">task type</a> being <code>"intrinsic-sizes"</code>.</p>
       <li data-md>
        <p><a data-link-type="dfn" href="#layout-api-work-task-promise" id="ref-for-layout-api-work-task-promise">promise</a> being <var>p</var>.</p>
      </ul>
     <li data-md>
      <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-append" id="ref-for-list-append">Append</a> <var>task</var> to <var>context</var>’s <a data-link-type="dfn" href="#layout-api-context-work-queue" id="ref-for-layout-api-context-work-queue">work queue</a>.</p>
     <li data-md>
      <p>Return <var>p</var>.</p>
    </ol>
   </div>
   <p class="note" role="note"><span class="marker">Note:</span> The <code class="idl"><a data-link-type="idl" href="#dom-layoutchild-layoutnextfragment" id="ref-for-dom-layoutchild-layoutnextfragment②">layoutNextFragment()</a></code> method allows the web developer to produce a <code class="idl"><a data-link-type="idl" href="#layoutfragment" id="ref-for-layoutfragment④">LayoutFragment</a></code> for a given <code class="idl"><a data-link-type="idl" href="#layoutchild" id="ref-for-layoutchild①⑨">LayoutChild</a></code> (the result of performing layout).</p>
   <div class="algorithm" data-algorithm="layoutNextFragment(constraints, breakToken)" data-algorithm-for="LayoutChild">
     When the <dfn class="dfn-paneled idl-code" data-dfn-for="LayoutChild" data-dfn-type="method" data-export id="dom-layoutchild-layoutnextfragment"><code>layoutNextFragment(<var>constraints</var>, <var>breakToken</var>)</code></dfn> method is
called on a <code class="idl"><a data-link-type="idl" href="#layoutchild" id="ref-for-layoutchild②⓪">LayoutChild</a></code> <var>this</var>, the user agent must perform the following steps: 
    <ol>
     <li data-md>
      <p>Let <var>p</var> be a new promise.</p>
     <li data-md>
      <p>Let <var>context</var> be the <a data-link-type="dfn" href="#current-layout" id="ref-for-current-layout③">current layout’s</a> <a data-link-type="dfn" href="#layout-api-context" id="ref-for-layout-api-context②">layout API context</a>.</p>
     <li data-md>
      <p>If <var>this</var>’ <code class="idl"><a data-link-type="idl" href="#dom-layoutchild-unique-id-slot" id="ref-for-dom-layoutchild-unique-id-slot①">[[unique id]]</a></code> is not equal to <var>context</var>’s <a data-link-type="dfn" href="#layout-api-context-unique-id" id="ref-for-layout-api-context-unique-id②">unique id</a>, reject <var>p</var> with a "<code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#invalidstateerror" id="ref-for-invalidstateerror①">InvalidStateError</a></code>" <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException②">DOMException</a></code>, and abort all these steps.</p>
      <p class="note" role="note"><span class="marker">Note:</span> This is to ensure that only <code class="idl"><a data-link-type="idl" href="#layoutchild" id="ref-for-layoutchild②①">LayoutChild</a></code>ren passed in as arguments to either the
    layout or intrinsicSizes method are used.</p>
     <li data-md>
      <p>If <var>breakToken</var>’s <code class="idl"><a data-link-type="idl" href="#dom-childbreaktoken-unique-id-slot" id="ref-for-dom-childbreaktoken-unique-id-slot">[[unique id]]</a></code> is not equal to <var>context</var>’s <a data-link-type="dfn" href="#layout-api-context-unique-id" id="ref-for-layout-api-context-unique-id③">unique id</a>,
reject <var>p</var> with a "<code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#invalidstateerror" id="ref-for-invalidstateerror②">InvalidStateError</a></code>" <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException③">DOMException</a></code>, and abort all these steps.</p>
     <li data-md>
      <p>If <var>context</var>’s <a data-link-type="dfn" href="#layout-api-context-mode" id="ref-for-layout-api-context-mode">mode</a> is <code>"intrinsic-sizes"</code>, reject <var>p</var> with
a "<code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#notsupportederror" id="ref-for-notsupportederror">NotSupportedError</a></code>" <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException④">DOMException</a></code>.</p>
      <p class="note" role="note"><span class="marker">Note:</span> This is to ensure that inside a <code>intrinsicSizes</code> callback, <code class="idl"><a data-link-type="idl" href="#dom-layoutchild-layoutnextfragment" id="ref-for-dom-layoutchild-layoutnextfragment③">layoutNextFragment()</a></code> cannot be called.</p>
     <li data-md>
      <p>Let <var>task</var> be a new <a data-link-type="dfn" href="#layout-api-work-task" id="ref-for-layout-api-work-task①">layout API work task</a> with:</p>
      <ul>
       <li data-md>
        <p><a data-link-type="dfn" href="#layout-api-work-task-layout-constraints" id="ref-for-layout-api-work-task-layout-constraints">layout constraints</a> being <var>constraints</var>.</p>
       <li data-md>
        <p><a data-link-type="dfn" href="#layout-api-work-task-layout-child" id="ref-for-layout-api-work-task-layout-child①">layout child</a> being <var>this</var>.</p>
       <li data-md>
        <p><a data-link-type="dfn" href="#layout-api-work-task-child-break-token" id="ref-for-layout-api-work-task-child-break-token">child break token</a> being <var>breakToken</var>.</p>
       <li data-md>
        <p><a data-link-type="dfn" href="#layout-api-work-task-task-type" id="ref-for-layout-api-work-task-task-type①">task type</a> being <code>"layout"</code>.</p>
       <li data-md>
        <p><a data-link-type="dfn" href="#layout-api-work-task-promise" id="ref-for-layout-api-work-task-promise①">promise</a> being <var>p</var>.</p>
      </ul>
     <li data-md>
      <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-append" id="ref-for-list-append①">Append</a> <var>task</var> to <var>context</var>’s <a data-link-type="dfn" href="#layout-api-context-work-queue" id="ref-for-layout-api-context-work-queue①">work queue</a>.</p>
     <li data-md>
      <p>Return <var>p</var>.</p>
    </ol>
   </div>
   <h4 class="heading settled" data-level="4.1.1" id="layout-child-box-tree"><span class="secno">4.1.1. </span><span class="content">LayoutChildren and the Box Tree</span><a class="self-link" href="#layout-child-box-tree"></a></h4>
   <p>Each <a data-link-type="dfn" href="https://drafts.csswg.org/css-display-3/#box" id="ref-for-box①①">box</a> has a <dfn class="dfn-paneled idl-code" data-dfn-for="box" data-dfn-type="attribute" data-export id="dom-box-layoutchildmap-slot"><code>[[layoutChildMap]]</code></dfn> internal slot, which is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map" id="ref-for-ordered-map④">map</a> of <code class="idl"><a data-link-type="idl" href="#layoutworkletglobalscope" id="ref-for-layoutworkletglobalscope⑤">LayoutWorkletGlobalScope</a></code>s to <code class="idl"><a data-link-type="idl" href="#layoutchild" id="ref-for-layoutchild②②">LayoutChild</a></code>ren.</p>
   <p class="note" role="note"><span class="marker">Note:</span> <a data-link-type="dfn" href="#get-a-layout-child" id="ref-for-get-a-layout-child">Get a layout child</a> returns a <code class="idl"><a data-link-type="idl" href="#layoutchild" id="ref-for-layoutchild②③">LayoutChild</a></code> object for the correct <code class="idl"><a data-link-type="idl" href="#layoutworkletglobalscope" id="ref-for-layoutworkletglobalscope⑥">LayoutWorkletGlobalScope</a></code> and creates one if it doesn’t exist yet.</p>
   <div class="algorithm" data-algorithm="get a layout child">
     When the user agent wants to <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="get-a-layout-child">get a layout child</dfn> given <var>workletGlobalScope</var>, <var>name</var>, <var>box</var>, and <var>uniqueId</var>, it <em>must</em> run the following steps: 
    <ol>
     <li data-md>
      <p>Assert that:</p>
      <ul>
       <li data-md>
        <p><var>box</var> is currently attached to the <a data-link-type="dfn" href="https://drafts.csswg.org/css-display-4/#box-tree" id="ref-for-box-tree③">box tree</a>.</p>
       <li data-md>
        <p><var>box</var>’s <a data-link-type="dfn" href="https://drafts.csswg.org/css-display-4/#containing-block" id="ref-for-containing-block">containing block</a> is a <a data-link-type="dfn" href="#layout-api-container" id="ref-for-layout-api-container⑧">layout API container</a>.</p>
       <li data-md>
        <p>The <a data-link-type="dfn" href="https://drafts.csswg.org/css-display-4/#containing-block" id="ref-for-containing-block①">containing block’s</a> <a class="css" data-link-type="maybe" href="#valdef-display-layout" id="ref-for-valdef-display-layout④">layout()</a> function’s first argument is <var>name</var>.</p>
      </ul>
     <li data-md>
      <p>Let <var>layoutChildMap</var> be <var>box</var>’s <code class="idl"><a data-link-type="idl" href="#dom-box-layoutchildmap-slot" id="ref-for-dom-box-layoutchildmap-slot">[[layoutChildMap]]</a></code>.</p>
     <li data-md>
      <p>If <var>layoutChildMap</var>[<var>workletGlobalScope</var>] does not <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-exists" id="ref-for-map-exists②">exist</a>, run the following
steps:</p>
      <ol>
       <li data-md>
        <p>Let <var>definition</var> be the result of <a data-link-type="dfn" href="#get-a-layout-definition" id="ref-for-get-a-layout-definition①">get a layout definition</a> given <var>name</var>, and <var>workletGlobalScope</var>.</p>
        <p>Assert that <a data-link-type="dfn" href="#get-a-layout-definition" id="ref-for-get-a-layout-definition②">get a layout definition</a> succeeded, and <var>definition</var> is not <code>"invalid"</code>.</p>
       <li data-md>
        <p>Let <var>childInputProperties</var> be <var>definition</var>’s <a data-link-type="dfn" href="#layout-definition-child-input-properties" id="ref-for-layout-definition-child-input-properties③">child input
properties</a>.</p>
       <li data-md>
        <p>Let <var>layoutChild</var> be a new <code class="idl"><a data-link-type="idl" href="#layoutchild" id="ref-for-layoutchild②④">LayoutChild</a></code> with internal slot(s):</p>
        <ul>
         <li data-md>
          <p><code class="idl"><a data-link-type="idl" href="#dom-layoutchild-box-slot" id="ref-for-dom-layoutchild-box-slot②">[[box]]</a></code> set to <var>box</var>.</p>
         <li data-md>
          <p><code class="idl"><a data-link-type="idl" href="#dom-layoutchild-stylemap-slot" id="ref-for-dom-layoutchild-stylemap-slot⑤">[[styleMap]]</a></code> set to a new <code class="idl"><a data-link-type="idl" href="https://drafts.css-houdini.org/css-typed-om-1/#stylepropertymapreadonly" id="ref-for-stylepropertymapreadonly⑦">StylePropertyMapReadOnly</a></code> populated with <em>only</em> the <a data-link-type="dfn" href="https://drafts.csswg.org/css-cascade-5/#computed-value" id="ref-for-computed-value⑤">computed values</a> for properties listed in <var>childInputProperties</var>.</p>
        </ul>
       <li data-md>
        <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-set" id="ref-for-map-set③">Set</a> <var>layoutChildMap</var>[<var>workletGlobalScope</var>] to <var>layoutChild</var>.</p>
      </ol>
     <li data-md>
      <p>Let <var>layoutChild</var> be the result of <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-get" id="ref-for-map-get①">get</a> <var>layoutChildMap</var>[<var>workletGlobalScope</var>].</p>
     <li data-md>
      <p>Set <var>layoutChild</var>’s <code class="idl"><a data-link-type="idl" href="#dom-layoutchild-unique-id-slot" id="ref-for-dom-layoutchild-unique-id-slot②">[[unique id]]</a></code> internal slot to <var>uniqueId</var>.</p>
     <li data-md>
      <p>Return <var>layoutChild</var>.</p>
    </ol>
   </div>
   <p>When a <a data-link-type="dfn" href="https://drafts.csswg.org/css-display-3/#box" id="ref-for-box①②">box</a> is inserted into the <a data-link-type="dfn" href="https://drafts.csswg.org/css-display-4/#box-tree" id="ref-for-box-tree④">box tree</a> the user agent <em>may</em> pre-populate the <code class="idl"><a data-link-type="idl" href="#dom-box-layoutchildmap-slot" id="ref-for-dom-box-layoutchildmap-slot①">[[layoutChildMap]]</a></code> for all <code class="idl"><a data-link-type="idl" href="#layoutworkletglobalscope" id="ref-for-layoutworkletglobalscope⑦">LayoutWorkletGlobalScope</a></code>s.</p>
   <p>When a <a data-link-type="dfn" href="https://drafts.csswg.org/css-display-3/#box" id="ref-for-box①③">box</a> is removed from the <a data-link-type="dfn" href="https://drafts.csswg.org/css-display-4/#box-tree" id="ref-for-box-tree⑤">box tree</a> the user agent <em>must</em> clear the <code class="idl"><a data-link-type="idl" href="#dom-box-layoutchildmap-slot" id="ref-for-dom-box-layoutchildmap-slot②">[[layoutChildMap]]</a></code>.</p>
   <p>The user agent <em>must</em> clear the <code class="idl"><a data-link-type="idl" href="#dom-box-layoutchildmap-slot" id="ref-for-dom-box-layoutchildmap-slot③">[[layoutChildMap]]</a></code> internal slot every 1000 layout
passes.</p>
   <p class="note" role="note"><span class="marker">Note:</span> The above rule exists to ensure that web developers do not rely on being able to store
    non-regeneratable state on the <code class="idl"><a data-link-type="idl" href="#layoutchild" id="ref-for-layoutchild②⑤">LayoutChild</a></code> object.
    The 1000 limit was picked as a high upper bound, this limit may improve (downwards) over time.</p>
   <div class="algorithm" data-algorithm="update a layout child style">
     When the user agent wants to <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="update-a-layout-child-style">update a layout child style</dfn> given <var>box</var>, it <em>must</em> run the following steps: 
    <ol>
     <li data-md>
      <p>Assert that:</p>
      <ul>
       <li data-md>
        <p><var>box</var> is currently attached to the <a data-link-type="dfn" href="https://drafts.csswg.org/css-display-4/#box-tree" id="ref-for-box-tree⑥">box tree</a>.</p>
      </ul>
     <li data-md>
      <p>If <var>box</var>’s <a data-link-type="dfn" href="https://drafts.csswg.org/css-display-4/#containing-block" id="ref-for-containing-block②">containing block</a> is not a <a data-link-type="dfn" href="#layout-api-container" id="ref-for-layout-api-container⑨">layout API container</a>, abort all these
steps.</p>
     <li data-md>
      <p>Let <var>layoutChildMap</var> be <var>box</var>’s <code class="idl"><a data-link-type="idl" href="#dom-box-layoutchildmap-slot" id="ref-for-dom-box-layoutchildmap-slot④">[[layoutChildMap]]</a></code>.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-iterate" id="ref-for-map-iterate">For each</a> <var>layoutChild</var> in <var>layoutChildMap</var>:</p>
      <ol>
       <li data-md>
        <p><var>layoutChild</var>’s <code class="idl"><a data-link-type="idl" href="#dom-layoutchild-stylemap-slot" id="ref-for-dom-layoutchild-stylemap-slot⑥">[[styleMap]]</a></code> to null.</p>
      </ol>
    </ol>
   </div>
   <p>When the <a data-link-type="dfn" href="https://drafts.csswg.org/css-cascade-5/#computed-value" id="ref-for-computed-value⑥">computed values</a> of <a data-link-type="dfn" href="#document-layout-definition-child-input-properties" id="ref-for-document-layout-definition-child-input-properties②">child input properties</a> for a <a data-link-type="dfn" href="https://drafts.csswg.org/css-display-3/#box" id="ref-for-box①④">box</a> changes the user agent must run the <a data-link-type="dfn" href="#update-a-layout-child-style" id="ref-for-update-a-layout-child-style">update a layout child style</a> algorithm.</p>
   <h3 class="heading settled" data-level="4.2" id="layout-fragments"><span class="secno">4.2. </span><span class="content">Layout Fragments</span><a class="self-link" href="#layout-fragments"></a></h3>
   <p>A <code class="idl"><a data-link-type="idl" href="#layoutfragment" id="ref-for-layoutfragment⑤">LayoutFragment</a></code> represents a CSS <a data-link-type="dfn" href="https://drafts.csswg.org/css-break-3/#fragment" id="ref-for-fragment①">fragment</a> of a <code class="idl"><a data-link-type="idl" href="#layoutchild" id="ref-for-layoutchild②⑥">LayoutChild</a></code> after layout has occurred on
that child. This is produced by the <code class="idl"><a data-link-type="idl" href="#dom-layoutchild-layoutnextfragment" id="ref-for-dom-layoutchild-layoutnextfragment④">layoutNextFragment()</a></code> method.</p>
<pre class="idl highlight def">[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed" id="ref-for-Exposed⑤"><c- g>Exposed</c-></a>=<c- n>LayoutWorklet</c->]
<c- b>interface</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="interface" data-export id="layoutfragment"><code><c- g>LayoutFragment</c-></code></dfn> {
    <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-double" id="ref-for-idl-double"><c- b>double</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="LayoutFragment" data-dfn-type="attribute" data-export data-readonly data-type="double" id="dom-layoutfragment-inlinesize"><code><c- g>inlineSize</c-></code></dfn>;
    <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-double" id="ref-for-idl-double①"><c- b>double</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="LayoutFragment" data-dfn-type="attribute" data-export data-readonly data-type="double" id="dom-layoutfragment-blocksize"><code><c- g>blockSize</c-></code></dfn>;

    <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-double" id="ref-for-idl-double②"><c- b>double</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="LayoutFragment" data-dfn-type="attribute" data-export data-type="double" id="dom-layoutfragment-inlineoffset"><code><c- g>inlineOffset</c-></code></dfn>;
    <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-double" id="ref-for-idl-double③"><c- b>double</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="LayoutFragment" data-dfn-type="attribute" data-export data-type="double" id="dom-layoutfragment-blockoffset"><code><c- g>blockOffset</c-></code></dfn>;

    <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-any" id="ref-for-idl-any"><c- b>any</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="LayoutFragment" data-dfn-type="attribute" data-export data-readonly data-type="any" id="dom-layoutfragment-data"><code><c- g>data</c-></code></dfn>;

    <c- b>readonly</c-> <c- b>attribute</c-> <a data-link-type="idl-name" href="#childbreaktoken" id="ref-for-childbreaktoken①"><c- n>ChildBreakToken</c-></a>? <dfn class="dfn-paneled idl-code" data-dfn-for="LayoutFragment" data-dfn-type="attribute" data-export data-readonly data-type="ChildBreakToken?" id="dom-layoutfragment-breaktoken"><code><c- g>breakToken</c-></code></dfn>;
};
</pre>
   <p>The <code class="idl"><a data-link-type="idl" href="#layoutfragment" id="ref-for-layoutfragment⑥">LayoutFragment</a></code> has internal slot(s):</p>
   <ul>
    <li data-md>
     <p><dfn class="dfn-paneled idl-code" data-dfn-for="LayoutFragment" data-dfn-type="attribute" data-export id="dom-layoutfragment-unique-id-slot"><code>[[unique id]]</code></dfn> the <a data-link-type="dfn" href="#layout-api-context-unique-id" id="ref-for-layout-api-context-unique-id④">unique id</a> of the <a data-link-type="dfn" href="#layout-api-context" id="ref-for-layout-api-context③">layout api context</a> which produced this child fragment. This slot is used so that a <code class="idl"><a data-link-type="idl" href="#layoutfragment" id="ref-for-layoutfragment⑦">LayoutFragment</a></code> from a previous layout pass is invalid.</p>
   </ul>
   <hr>
   <p>The <code class="idl"><a data-link-type="idl" href="#layoutfragment" id="ref-for-layoutfragment⑧">LayoutFragment</a></code> has <code class="idl"><a data-link-type="idl" href="#dom-layoutfragment-inlinesize" id="ref-for-dom-layoutfragment-inlinesize">inlineSize</a></code> and <code class="idl"><a data-link-type="idl" href="#dom-layoutfragment-blocksize" id="ref-for-dom-layoutfragment-blocksize">blockSize</a></code> attributes, which are set by the respective child’s layout algorithm. They represent the <b>border
box</b> size of the CSS <a data-link-type="dfn" href="https://drafts.csswg.org/css-break-3/#fragment" id="ref-for-fragment②">fragment</a>, and are relative to the <a data-link-type="dfn" href="#current-layout" id="ref-for-current-layout④">current layout’s</a> writing mode.</p>
   <p>The <code class="idl"><a data-link-type="idl" href="#dom-layoutfragment-inlinesize" id="ref-for-dom-layoutfragment-inlinesize①">inlineSize</a></code> and <code class="idl"><a data-link-type="idl" href="#dom-layoutfragment-blocksize" id="ref-for-dom-layoutfragment-blocksize①">blockSize</a></code> attributes cannot be changed. If
the <a data-link-type="dfn" href="#current-layout" id="ref-for-current-layout⑤">current layout</a> requires a different <code class="idl"><a data-link-type="idl" href="#dom-layoutfragment-inlinesize" id="ref-for-dom-layoutfragment-inlinesize②">inlineSize</a></code> or <code class="idl"><a data-link-type="idl" href="#dom-layoutfragment-blocksize" id="ref-for-dom-layoutfragment-blocksize②">blockSize</a></code> the author must perform <code class="idl"><a data-link-type="idl" href="#dom-layoutchild-layoutnextfragment" id="ref-for-dom-layoutchild-layoutnextfragment⑤">layoutNextFragment()</a></code> again with
different arguments in order to get different results.</p>
   <p>The author inside the current layout can position a resulting <code class="idl"><a data-link-type="idl" href="#layoutfragment" id="ref-for-layoutfragment⑨">LayoutFragment</a></code> by setting its <code class="idl"><a data-link-type="idl" href="#dom-layoutfragment-inlineoffset" id="ref-for-dom-layoutfragment-inlineoffset">inlineOffset</a></code> and <code class="idl"><a data-link-type="idl" href="#dom-layoutfragment-blockoffset" id="ref-for-dom-layoutfragment-blockoffset">blockOffset</a></code> attributes. If not set by the
author they default to zero. The <code class="idl"><a data-link-type="idl" href="#dom-layoutfragment-inlineoffset" id="ref-for-dom-layoutfragment-inlineoffset①">inlineOffset</a></code> and <code class="idl"><a data-link-type="idl" href="#dom-layoutfragment-blockoffset" id="ref-for-dom-layoutfragment-blockoffset①">blockOffset</a></code> attributes represent the position of the <code class="idl"><a data-link-type="idl" href="#layoutfragment" id="ref-for-layoutfragment①⓪">LayoutFragment</a></code> relative to its parent’s <b>border
box</b>, before transform or positioning (e.g. if a fragment is <a data-link-type="dfn" href="https://drafts.csswg.org/css-position-3/#relative-position" id="ref-for-relative-position">relatively positioned</a>) has
been applied.</p>
   <figure>
     <img alt="An example of position a fragment in different writing modes." src="img/layout-fragment-offsets.png" width="800"> 
    <figcaption> A simple visualization showing positioning a <code class="idl"><a data-link-type="idl" href="#layoutfragment" id="ref-for-layoutfragment①①">LayoutFragment</a></code> using <code class="idl"><a data-link-type="idl" href="#dom-layoutfragment-inlineoffset" id="ref-for-dom-layoutfragment-inlineoffset②">inlineOffset</a></code> and <code class="idl"><a data-link-type="idl" href="#dom-layoutfragment-blockoffset" id="ref-for-dom-layoutfragment-blockoffset②">blockOffset</a></code> in different writing
        modes. </figcaption>
   </figure>
   <div class="example" id="example-b84555b2">
    <a class="self-link" href="#example-b84555b2"></a> The example below shows the basic usage of a <code class="idl"><a data-link-type="idl" href="#layoutfragment" id="ref-for-layoutfragment①②">LayoutFragment</a></code>. 
<pre class="lang-javascript highlight">registerLayout<c- p>(</c-><c- t>'example-layout-fragment'</c-><c- p>,</c-> <c- a>class</c-> <c- p>{</c->
  <c- k>async</c-> layout<c- p>(</c->children<c- p>,</c-> edges<c- p>,</c-> constraints<c- p>,</c-> styleMap<c- p>)</c-> <c- p>{</c->

    <c- c1>// You must perform layout to generate a fragment.</c->
    <c- a>const</c-> fragment <c- o>=</c-> <c- k>await</c-> child<c- p>.</c->layoutNextFragment<c- p>({});</c->

    <c- c1>// You can query the size of the fragment produced:</c->
    console<c- p>.</c->log<c- p>(</c->fragment<c- p>.</c->inlineSize<c- p>);</c->
    console<c- p>.</c->log<c- p>(</c->fragment<c- p>.</c->blockSize<c- p>);</c->

    <c- c1>// You can set the position of the fragment, e.g. this will set it to the</c->
    <c- c1>// top-left corner:</c->
    fragment<c- p>.</c->inlineOffset <c- o>=</c-> edges<c- p>.</c->inlineStart<c- p>;</c->
    fragment<c- p>.</c->blockOffset <c- o>=</c-> edges<c- p>.</c->blockStart<c- p>;</c->

    <c- c1>// Data may be passed from the child layout:</c->
    console<c- p>.</c->log<c- p>(</c->fragment<c- p>.</c->data<c- p>);</c->

    <c- c1>// If the child fragmented, you can use the breakToken to produce the next</c->
    <c- c1>// fragment in the chain.</c->
    <c- a>const</c-> nextFragment <c- o>=</c-> <c- k>await</c-> child<c- p>.</c->layoutNextFragment<c- p>({},</c-> fragment<c- p>.</c->breakToken<c- p>);</c->
  <c- p>}</c->
<c- p>});</c->
</pre>
   </div>
   <p>A <a data-link-type="dfn" href="#layout-api-container" id="ref-for-layout-api-container①⓪">layout API container</a> can communicate with other <a data-link-type="dfn" href="#layout-api-container" id="ref-for-layout-api-container①①">layout API containers</a> by using the <code class="idl"><a data-link-type="idl" href="#dom-layoutfragment-data" id="ref-for-dom-layoutfragment-data">data</a></code> attribute. This is set by the <code class="idl"><a data-link-type="idl" href="#dom-fragmentresultoptions-data" id="ref-for-dom-fragmentresultoptions-data">data</a></code> member in the <code class="idl"><a data-link-type="idl" href="#dictdef-fragmentresultoptions" id="ref-for-dictdef-fragmentresultoptions">FragmentResultOptions</a></code> dictionary.</p>
   <p>The <code class="idl"><a data-link-type="idl" href="#layoutfragment" id="ref-for-layoutfragment①③">LayoutFragment</a></code>’s <code class="idl"><a data-link-type="idl" href="#dom-layoutfragment-breaktoken" id="ref-for-dom-layoutfragment-breaktoken">breakToken</a></code> specifies where the <code class="idl"><a data-link-type="idl" href="#layoutchild" id="ref-for-layoutchild②⑦">LayoutChild</a></code> last
fragmented. If the <code class="idl"><a data-link-type="idl" href="#dom-layoutfragment-breaktoken" id="ref-for-dom-layoutfragment-breaktoken①">breakToken</a></code> is null the <code class="idl"><a data-link-type="idl" href="#layoutchild" id="ref-for-layoutchild②⑧">LayoutChild</a></code> wont produce any more <code class="idl"><a data-link-type="idl" href="#layoutfragment" id="ref-for-layoutfragment①④">LayoutFragment</a></code>s for that token chain. The <code class="idl"><a data-link-type="idl" href="#dom-layoutfragment-breaktoken" id="ref-for-dom-layoutfragment-breaktoken②">breakToken</a></code> can be passed to the <code class="idl"><a data-link-type="idl" href="#dom-layoutchild-layoutnextfragment" id="ref-for-dom-layoutchild-layoutnextfragment⑥">layoutNextFragment()</a></code> function to produce the next <code class="idl"><a data-link-type="idl" href="#layoutfragment" id="ref-for-layoutfragment①⑤">LayoutFragment</a></code> for a
particular child. The <code class="idl"><a data-link-type="idl" href="#dom-layoutfragment-breaktoken" id="ref-for-dom-layoutfragment-breaktoken③">breakToken</a></code> cannot be changed.
If the <a data-link-type="dfn" href="#current-layout" id="ref-for-current-layout⑥">current layout</a> requires a different <code class="idl"><a data-link-type="idl" href="#dom-layoutfragment-breaktoken" id="ref-for-dom-layoutfragment-breaktoken④">breakToken</a></code> the author must perform <code class="idl"><a data-link-type="idl" href="#dom-layoutchild-layoutnextfragment" id="ref-for-dom-layoutchild-layoutnextfragment⑦">layoutNextFragment()</a></code> again with different arguments.</p>
   <h3 class="heading settled" data-level="4.3" id="intrinsic-sizes"><span class="secno">4.3. </span><span class="content">Intrinsic Sizes</span><a class="self-link" href="#intrinsic-sizes"></a></h3>
<pre class="idl highlight def">[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed" id="ref-for-Exposed⑥"><c- g>Exposed</c-></a>=<c- n>LayoutWorklet</c->]
<c- b>interface</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="interface" data-export id="intrinsicsizes"><code><c- g>IntrinsicSizes</c-></code></dfn> {
  <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-double" id="ref-for-idl-double④"><c- b>double</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="IntrinsicSizes" data-dfn-type="attribute" data-export data-readonly data-type="double" id="dom-intrinsicsizes-mincontentsize"><code><c- g>minContentSize</c-></code></dfn>;
  <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-double" id="ref-for-idl-double⑤"><c- b>double</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="IntrinsicSizes" data-dfn-type="attribute" data-export data-readonly data-type="double" id="dom-intrinsicsizes-maxcontentsize"><code><c- g>maxContentSize</c-></code></dfn>;
};
</pre>
   <p>A <code class="idl"><a data-link-type="idl" href="#intrinsicsizes" id="ref-for-intrinsicsizes①">IntrinsicSizes</a></code> object represents the <a data-link-type="dfn" href="https://drafts.csswg.org/css-sizing-3/#min-content" id="ref-for-min-content">min-content size</a> and <a data-link-type="dfn" href="https://drafts.csswg.org/css-sizing-3/#max-content" id="ref-for-max-content">max-content size</a> of a CSS <a data-link-type="dfn" href="https://drafts.csswg.org/css-display-3/#box" id="ref-for-box①⑤">box</a>. It has <code class="idl"><a data-link-type="idl" href="#dom-intrinsicsizes-mincontentsize" id="ref-for-dom-intrinsicsizes-mincontentsize">minContentSize</a></code> and <code class="idl"><a data-link-type="idl" href="#dom-intrinsicsizes-maxcontentsize" id="ref-for-dom-intrinsicsizes-maxcontentsize">maxContentSize</a></code> attributes
which represent the <b>border box</b> min/max-content contribution of the <code class="idl"><a data-link-type="idl" href="#layoutchild" id="ref-for-layoutchild②⑨">LayoutChild</a></code> for the <a data-link-type="dfn" href="#current-layout" id="ref-for-current-layout⑦">current layout</a>. The attributes are relative to the inline direction of the <a data-link-type="dfn" href="#current-layout" id="ref-for-current-layout⑧">current layout’s</a> writing mode.</p>
   <p>The <code class="idl"><a data-link-type="idl" href="#dom-intrinsicsizes-mincontentsize" id="ref-for-dom-intrinsicsizes-mincontentsize①">minContentSize</a></code> and <code class="idl"><a data-link-type="idl" href="#dom-intrinsicsizes-maxcontentsize" id="ref-for-dom-intrinsicsizes-maxcontentsize①">maxContentSize</a></code> cannot be changed. They
must not change for a <code class="idl"><a data-link-type="idl" href="#layoutchild" id="ref-for-layoutchild③⓪">LayoutChild</a></code> within the current layout pass.</p>
   <div class="example" id="example-d47b1d7d">
    <a class="self-link" href="#example-d47b1d7d"></a> The example below shows the border-box intrinsic sizes of two children. 
<pre class="lang-html highlight"><c- p>&lt;</c-><c- f>style</c-><c- p>></c->
<c- p>.</c-><c- nc>child-0</c-> <c- p>{</c->
  <c- k>width</c-><c- p>:</c-> <c- mi>380</c-><c- b>px</c-><c- p>;</c->
  <c- k>border</c-><c- p>:</c-> <c- kc>solid</c-> <c- mi>10</c-><c- b>px</c-><c- p>;</c->
<c- p>}</c->

<c- p>.</c-><c- nc>child-1</c-> <c- p>{</c->
  <c- k>border</c-><c- p>:</c-> <c- kc>solid</c-> <c- mi>5</c-><c- b>px</c-><c- p>;</c->
<c- p>}</c->

<c- p>.</c-><c- nc>box</c-> <c- p>{</c->
  <c- k>display</c-><c- p>:</c-> <c- nf>layout</c-><c- p>(</c-><c- n>intrinsic</c-><c- g>-sizes-example</c-><c- p>);</c->
  <c- k>font</c-><c- p>:</c-> <c- mi>25</c-><c- b>px</c-><c- o>/</c-><c- mi>1</c-> <c- n>Ahem</c-><c- p>;</c->
<c- p>}</c->
<c- p>&lt;/</c-><c- f>style</c-><c- p>></c->

<c- p>&lt;</c-><c- f>div</c-> <c- e>class</c-><c- o>=</c-><c- s>"box"</c-><c- p>></c->
  <c- p>&lt;</c-><c- f>div</c-> <c- e>class</c-><c- o>=</c-><c- s>"child-0"</c-><c- p>>&lt;/</c-><c- f>div</c-><c- p>></c->
  <c- p>&lt;</c-><c- f>div</c-> <c- e>class</c-><c- o>=</c-><c- s>"child-1"</c-><c- p>></c->XXX XXXX<c- p>&lt;/</c-><c- f>div</c-><c- p>></c->
<c- p>&lt;/</c-><c- f>div</c-><c- p>></c->
</pre>
<pre class="lang-javascript highlight">registerLayout<c- p>(</c-><c- t>'intrinsic-sizes-example'</c-><c- p>,</c-> <c- a>class</c-> <c- p>{</c->
    <c- k>async</c-> intrinsicSizes<c- p>(</c->children<c- p>,</c-> edges<c- p>,</c-> styleMap<c- p>)</c-> <c- p>{</c->
      <c- a>const</c-> childrenSizes <c- o>=</c-> <c- k>await</c-> Promise<c- p>.</c->all<c- p>(</c->children<c- p>.</c->map<c- p>((</c->child<c- p>)</c-> <c- p>=></c-> <c- p>{</c->
          <c- k>return</c-> child<c- p>.</c->intrinsicSizes<c- p>();</c->
      <c- p>}));</c->

      childrenSizes<c- p>[</c-><c- mf>0</c-><c- p>].</c->minContentSize<c- p>;</c-> <c- c1>// 400, (380+10+10) child has a fixed size.</c->
      childrenSizes<c- p>[</c-><c- mf>0</c-><c- p>].</c->maxContentSize<c- p>;</c-> <c- c1>// 400, (380+10+10) child has a fixed size.</c->

      childrenSizes<c- p>[</c-><c- mf>1</c-><c- p>].</c->minContentSize<c- p>;</c-> <c- c1>// 100, size of "XXXX".</c->
      childrenSizes<c- p>[</c-><c- mf>1</c-><c- p>].</c->maxContentSize<c- p>;</c-> <c- c1>// 200, size of "XXX XXXX".</c->
    <c- p>}</c->

    layout<c- p>()</c-> <c- p>{}</c->
<c- p>});</c->
</pre>
   </div>
   <h3 class="heading settled" data-level="4.4" id="layout-constraints"><span class="secno">4.4. </span><span class="content">Layout Constraints</span><a class="self-link" href="#layout-constraints"></a></h3>
   <p>A <code class="idl"><a data-link-type="idl" href="#layoutconstraints" id="ref-for-layoutconstraints">LayoutConstraints</a></code> object is passed into the layout method which represents the all the
constraints for the <a data-link-type="dfn" href="#current-layout" id="ref-for-current-layout⑨">current layout</a> to perform layout within.</p>
<pre class="idl highlight def">[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed" id="ref-for-Exposed⑦"><c- g>Exposed</c-></a>=<c- n>LayoutWorklet</c->]
<c- b>interface</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="interface" data-export id="layoutconstraints"><code><c- g>LayoutConstraints</c-></code></dfn> {
    <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-double" id="ref-for-idl-double⑥"><c- b>double</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="LayoutConstraints" data-dfn-type="attribute" data-export data-readonly data-type="double" id="dom-layoutconstraints-availableinlinesize"><code><c- g>availableInlineSize</c-></code></dfn>;
    <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-double" id="ref-for-idl-double⑦"><c- b>double</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="LayoutConstraints" data-dfn-type="attribute" data-export data-readonly data-type="double" id="dom-layoutconstraints-availableblocksize"><code><c- g>availableBlockSize</c-></code></dfn>;

    <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-double" id="ref-for-idl-double⑧"><c- b>double</c-></a>? <dfn class="dfn-paneled idl-code" data-dfn-for="LayoutConstraints" data-dfn-type="attribute" data-export data-readonly data-type="double?" id="dom-layoutconstraints-fixedinlinesize"><code><c- g>fixedInlineSize</c-></code></dfn>;
    <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-double" id="ref-for-idl-double⑨"><c- b>double</c-></a>? <dfn class="dfn-paneled idl-code" data-dfn-for="LayoutConstraints" data-dfn-type="attribute" data-export data-readonly data-type="double?" id="dom-layoutconstraints-fixedblocksize"><code><c- g>fixedBlockSize</c-></code></dfn>;

    <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-double" id="ref-for-idl-double①⓪"><c- b>double</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="LayoutConstraints" data-dfn-type="attribute" data-export data-readonly data-type="double" id="dom-layoutconstraints-percentageinlinesize"><code><c- g>percentageInlineSize</c-></code></dfn>;
    <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-double" id="ref-for-idl-double①①"><c- b>double</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="LayoutConstraints" data-dfn-type="attribute" data-export data-readonly data-type="double" id="dom-layoutconstraints-percentageblocksize"><code><c- g>percentageBlockSize</c-></code></dfn>;

    <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-double" id="ref-for-idl-double①②"><c- b>double</c-></a>? <dfn class="dfn-paneled idl-code" data-dfn-for="LayoutConstraints" data-dfn-type="attribute" data-export data-readonly data-type="double?" id="dom-layoutconstraints-blockfragmentationoffset"><code><c- g>blockFragmentationOffset</c-></code></dfn>;
    <c- b>readonly</c-> <c- b>attribute</c-> <a data-link-type="idl-name" href="#enumdef-blockfragmentationtype" id="ref-for-enumdef-blockfragmentationtype"><c- n>BlockFragmentationType</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="LayoutConstraints" data-dfn-type="attribute" data-export data-readonly data-type="BlockFragmentationType" id="dom-layoutconstraints-blockfragmentationtype"><code><c- g>blockFragmentationType</c-></code></dfn>;

    <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-any" id="ref-for-idl-any①"><c- b>any</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="LayoutConstraints" data-dfn-type="attribute" data-export data-readonly data-type="any" id="dom-layoutconstraints-data"><code><c- g>data</c-></code></dfn>;
};

<c- b>enum</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="enum" data-export id="enumdef-blockfragmentationtype"><code><c- g>BlockFragmentationType</c-></code></dfn> { <dfn class="dfn-paneled idl-code" data-dfn-for="BlockFragmentationType" data-dfn-type="enum-value" data-export id="dom-blockfragmentationtype-none"><code><c- s>"none"</c-></code></dfn>, <dfn class="dfn-paneled idl-code" data-dfn-for="BlockFragmentationType" data-dfn-type="enum-value" data-export id="dom-blockfragmentationtype-page"><code><c- s>"page"</c-></code></dfn>, <dfn class="dfn-paneled idl-code" data-dfn-for="BlockFragmentationType" data-dfn-type="enum-value" data-export id="dom-blockfragmentationtype-column"><code><c- s>"column"</c-></code></dfn>, <dfn class="dfn-paneled idl-code" data-dfn-for="BlockFragmentationType" data-dfn-type="enum-value" data-export id="dom-blockfragmentationtype-region"><code><c- s>"region"</c-></code></dfn> };
</pre>
   <p>The <code class="idl"><a data-link-type="idl" href="#layoutconstraints" id="ref-for-layoutconstraints①">LayoutConstraints</a></code> object has <code class="idl"><a data-link-type="idl" href="#dom-layoutconstraints-availableinlinesize" id="ref-for-dom-layoutconstraints-availableinlinesize">availableInlineSize</a></code> and <code class="idl"><a data-link-type="idl" href="#dom-layoutconstraints-availableblocksize" id="ref-for-dom-layoutconstraints-availableblocksize">availableBlockSize</a></code> attributes. This represents the <a data-link-type="dfn" href="https://drafts.csswg.org/css-sizing-3/#available" id="ref-for-available">available space</a> for the <a data-link-type="dfn" href="#current-layout" id="ref-for-current-layout①⓪">current layout</a> to respect.</p>
   <p class="note" role="note"><span class="marker">Note:</span> Some layouts may need to produce a <code class="idl"><a data-link-type="idl" href="#layoutfragment" id="ref-for-layoutfragment①⑥">LayoutFragment</a></code> which exceed this size. For example a <a data-link-type="dfn" href="https://drafts.csswg.org/css-display-4/#replaced-element" id="ref-for-replaced-element">replaced element</a>. The <a data-link-type="dfn" href="#parent-layout" id="ref-for-parent-layout">parent layout</a> should expect this to occur and deal with it
    appropriately.</p>
   <p>A <a data-link-type="dfn" href="#parent-layout" id="ref-for-parent-layout①">parent layout</a> may require the <a data-link-type="dfn" href="#current-layout" id="ref-for-current-layout①①">current layout</a> to be exactly a particular size. If the <code class="idl"><a data-link-type="idl" href="#dom-layoutconstraints-fixedinlinesize" id="ref-for-dom-layoutconstraints-fixedinlinesize">fixedInlineSize</a></code> or <code class="idl"><a data-link-type="idl" href="#dom-layoutconstraints-fixedblocksize" id="ref-for-dom-layoutconstraints-fixedblocksize">fixedBlockSize</a></code> are specified the <a data-link-type="dfn" href="#current-layout" id="ref-for-current-layout①②">current layout</a> should produce a <code class="idl"><a data-link-type="idl" href="#layoutfragment" id="ref-for-layoutfragment①⑦">LayoutFragment</a></code> with a the specified size in the appropriate
direction.</p>
   <p>The <code class="idl"><a data-link-type="idl" href="#layoutconstraints" id="ref-for-layoutconstraints②">LayoutConstraints</a></code> object has <code class="idl"><a data-link-type="idl" href="#dom-layoutconstraints-percentageinlinesize" id="ref-for-dom-layoutconstraints-percentageinlinesize">percentageInlineSize</a></code> and <code class="idl"><a data-link-type="idl" href="#dom-layoutconstraints-percentageblocksize" id="ref-for-dom-layoutconstraints-percentageblocksize">percentageBlockSize</a></code> attributes. These represent the size that percentages
should be resolved against while performing layout.</p>
   <p>The <code class="idl"><a data-link-type="idl" href="#layoutconstraints" id="ref-for-layoutconstraints③">LayoutConstraints</a></code> has a <code class="idl"><a data-link-type="idl" href="#dom-layoutconstraints-blockfragmentationtype" id="ref-for-dom-layoutconstraints-blockfragmentationtype">blockFragmentationType</a></code> attribute. The <a data-link-type="dfn" href="#current-layout" id="ref-for-current-layout①③">current layout</a> should produce a <code class="idl"><a data-link-type="idl" href="#layoutfragment" id="ref-for-layoutfragment①⑧">LayoutFragment</a></code> which fragments at the <code class="idl"><a data-link-type="idl" href="#dom-layoutconstraints-blockfragmentationoffset" id="ref-for-dom-layoutconstraints-blockfragmentationoffset">blockFragmentationOffset</a></code> if possible.</p>
   <p>The <a data-link-type="dfn" href="#current-layout" id="ref-for-current-layout①④">current layout</a> can choose not to fragment a <code class="idl"><a data-link-type="idl" href="#layoutchild" id="ref-for-layoutchild③①">LayoutChild</a></code> based on the <code class="idl"><a data-link-type="idl" href="#dom-layoutconstraints-blockfragmentationtype" id="ref-for-dom-layoutconstraints-blockfragmentationtype①">blockFragmentationType</a></code>, for example if the child has a property like <a class="css" data-link-type="propdesc" href="https://drafts.csswg.org/css-break-3/#propdef-break-inside" id="ref-for-propdef-break-inside">break-inside: avoid-page;</a>.</p>
   <div class="example" id="example-a59e8196">
    <a class="self-link" href="#example-a59e8196"></a> The example below shows the basic usage of the <code class="idl"><a data-link-type="idl" href="#layoutconstraints" id="ref-for-layoutconstraints④">LayoutConstraints</a></code> object. 
<pre class="lang-javascript highlight"><c- c1>// The class below is registered with a "block-like" sizingMode, and can use the fixedInlineSize,</c->
<c- c1>// fixedBlockSize attributes.</c->
registerLayout<c- p>(</c-><c- t>'layout-constraints-example'</c-><c- p>,</c-> <c- a>class</c-> <c- p>{</c->
    <c- k>async</c-> layout<c- p>(</c->children<c- p>,</c-> edges<c- p>,</c-> constraints<c- p>,</c-> styleMap<c- p>)</c-> <c- p>{</c->

        <c- c1>// Calculate the available size.</c->
        <c- a>const</c-> availableInlineSize <c- o>=</c-> constraints<c- p>.</c->fixedInlineSize <c- o>-</c-> edges<c- p>.</c->inline<c- p>;</c->
        <c- a>const</c-> availableBlockSize <c- o>=</c-> constraints<c- p>.</c->fixedBlockSize <c- o>?</c->
            constraints<c- p>.</c->fixedBlockSize <c- o>-</c-> edges<c- p>.</c->inline <c- o>:</c-> <c- kc>null</c-><c- p>;</c->

        <c- c1>// Web developers should resolve any percentages against the percentage sizes.</c->
        <c- a>const</c-> value <c- o>=</c-> constraints<c- p>.</c->percentageInlineSize <c- o>*</c-> <c- mf>0.5</c-><c- p>;</c->

    <c- p>}</c->
<c- p>});</c->
</pre>
   </div>
   <hr>
   <p>The <a data-link-type="dfn" href="#create-a-layout-constraints-object" id="ref-for-create-a-layout-constraints-object">create a layout constraints object</a> algorithm is used to create the <code class="idl"><a data-link-type="idl" href="#layoutconstraints" id="ref-for-layoutconstraints⑤">LayoutConstraints</a></code> object. Depending on the <code class="idl"><a data-link-type="idl" href="#dom-layoutoptions-sizing" id="ref-for-dom-layoutoptions-sizing">sizing</a></code> it will either pre-calculate the <code class="idl"><a data-link-type="idl" href="#dom-layoutconstraints-fixedinlinesize" id="ref-for-dom-layoutconstraints-fixedinlinesize①">fixedInlineSize</a></code> and <code class="idl"><a data-link-type="idl" href="#dom-layoutconstraints-fixedblocksize" id="ref-for-dom-layoutconstraints-fixedblocksize①">fixedBlockSize</a></code> upfront.</p>
   <div class="algorithm" data-algorithm="create a layout constraints object">
     When the user agent wants to <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="create-a-layout-constraints-object">create a layout constraints object</dfn> given <var>sizingMode</var>, <var>box</var>,
and <var>internalLayoutConstraints</var>, it <em>must</em> run the following steps: 
    <ol>
     <li data-md>
      <p>If <var>sizingMode</var> is <code>"block-like"</code> then:</p>
      <ol>
       <li data-md>
        <p>Let <var>fixedInlineSize</var> be the result of calculating <var>box</var>’s <b>border-box</b> <a data-link-type="dfn" href="https://drafts.csswg.org/css-writing-modes-4/#inline-size" id="ref-for-inline-size">inline size</a> (relative to <var>box</var>’s writing mode) exactly like block containers do.</p>
       <li data-md>
        <p>Let <var>fixedBlockSize</var> be null if <var>box</var>’s <a data-link-type="dfn" href="https://drafts.csswg.org/css-writing-modes-4/#block-size" id="ref-for-block-size">block size</a> is unable to be calculated at this
stage, (e.g. <a data-link-type="dfn" href="https://drafts.csswg.org/css-writing-modes-4/#block-size" id="ref-for-block-size①">block size</a> is <a class="css" data-link-type="maybe" href="https://drafts.csswg.org/css-sizing-3/#valdef-width-auto" id="ref-for-valdef-width-auto">auto</a>), otherwise the result of calculating <var>box</var>’s <b>border-box</b> <a data-link-type="dfn" href="https://drafts.csswg.org/css-writing-modes-4/#block-size" id="ref-for-block-size②">block size</a> exactly like block containers do.</p>
       <li data-md>
        <p>Return a new <code class="idl"><a data-link-type="idl" href="#layoutconstraints" id="ref-for-layoutconstraints⑥">LayoutConstraints</a></code> object with:</p>
        <ul>
         <li data-md>
          <p><code class="idl"><a data-link-type="idl" href="#dom-layoutconstraints-fixedinlinesize" id="ref-for-dom-layoutconstraints-fixedinlinesize②">fixedInlineSize</a></code>, and <code class="idl"><a data-link-type="idl" href="#dom-layoutconstraints-availableinlinesize" id="ref-for-dom-layoutconstraints-availableinlinesize①">availableInlineSize</a></code> set to <var>fixedInlineSize</var>.</p>
         <li data-md>
          <p><code class="idl"><a data-link-type="idl" href="#dom-layoutconstraints-percentageinlinesize" id="ref-for-dom-layoutconstraints-percentageinlinesize①">percentageInlineSize</a></code> set to <var>internalLayoutConstraints</var>’
percentage resolution size in the inline axis (relative to <var>box</var>’s writing mode).</p>
         <li data-md>
          <p><code class="idl"><a data-link-type="idl" href="#dom-layoutconstraints-fixedblocksize" id="ref-for-dom-layoutconstraints-fixedblocksize②">fixedBlockSize</a></code> set to <var>fixedBlockSize</var>.</p>
         <li data-md>
          <p><code class="idl"><a data-link-type="idl" href="#dom-layoutconstraints-availableblocksize" id="ref-for-dom-layoutconstraints-availableblocksize①">availableBlockSize</a></code> set to <var>fixedBlockSize</var> if not null,
otherwise <var>internalLayoutConstraints</var>’ <a data-link-type="dfn" href="https://drafts.csswg.org/css-sizing-3/#available" id="ref-for-available①">available space</a> in the block axis
(relative to <var>box</var>’s writing mode).</p>
         <li data-md>
          <p><code class="idl"><a data-link-type="idl" href="#dom-layoutconstraints-percentageblocksize" id="ref-for-dom-layoutconstraints-percentageblocksize①">percentageBlockSize</a></code> set to <var>internalLayoutConstraints</var>’
percentage resolution size in the block axis (relative to <var>box</var>’s writing mode).</p>
        </ul>
      </ol>
     <li data-md>
      <p>If <var>sizingMode</var> is <code>"manual"</code> then:</p>
      <ol>
       <li data-md>
        <p>Return a new <code class="idl"><a data-link-type="idl" href="#layoutconstraints" id="ref-for-layoutconstraints⑦">LayoutConstraints</a></code> object with:</p>
        <ul>
         <li data-md>
          <p><code class="idl"><a data-link-type="idl" href="#dom-layoutconstraints-fixedinlinesize" id="ref-for-dom-layoutconstraints-fixedinlinesize③">fixedInlineSize</a></code>/<code class="idl"><a data-link-type="idl" href="#dom-layoutconstraints-fixedblocksize" id="ref-for-dom-layoutconstraints-fixedblocksize③">fixedBlockSize</a></code> set to <var>internalLayoutConstraints</var>’ fixed inline/block size (relative to <var>box</var>’s writing
mode) imposed by the <a data-link-type="dfn" href="#parent-layout" id="ref-for-parent-layout②">parent layout</a>. Either may be null.</p>
          <p class="note" role="note"><span class="marker">Note:</span> See <a href="#interaction-sizing">§ 5.1 Sizing</a> for different scenarios when this can occur.</p>
         <li data-md>
          <p><code class="idl"><a data-link-type="idl" href="#dom-layoutconstraints-availableinlinesize" id="ref-for-dom-layoutconstraints-availableinlinesize②">availableInlineSize</a></code>/<code class="idl"><a data-link-type="idl" href="#dom-layoutconstraints-availableblocksize" id="ref-for-dom-layoutconstraints-availableblocksize②">availableBlockSize</a></code> set
to <var>internalLayoutConstraints</var>’ <a data-link-type="dfn" href="https://drafts.csswg.org/css-sizing-3/#available" id="ref-for-available②">available space</a>.</p>
         <li data-md>
          <p><code class="idl"><a data-link-type="idl" href="#dom-layoutconstraints-percentageinlinesize" id="ref-for-dom-layoutconstraints-percentageinlinesize②">percentageInlineSize</a></code>/<code class="idl"><a data-link-type="idl" href="#dom-layoutconstraints-percentageblocksize" id="ref-for-dom-layoutconstraints-percentageblocksize②">percentageBlockSize</a></code> set to <var>internalLayoutConstraints</var>’ percentage resolution size.</p>
        </ul>
      </ol>
    </ol>
   </div>
   <h4 class="heading settled" data-level="4.4.1" id="layout-constraints-children"><span class="secno">4.4.1. </span><span class="content">Constraints for Layout Children</span><a class="self-link" href="#layout-constraints-children"></a></h4>
   <p>The <code class="idl"><a data-link-type="idl" href="#dictdef-layoutconstraintsoptions" id="ref-for-dictdef-layoutconstraintsoptions①">LayoutConstraintsOptions</a></code> dictionary represents the set of constraints which can be passed to
a <code class="idl"><a data-link-type="idl" href="#layoutchild" id="ref-for-layoutchild③②">LayoutChild</a></code> to produce a <code class="idl"><a data-link-type="idl" href="#layoutfragment" id="ref-for-layoutfragment①⑨">LayoutFragment</a></code>.</p>
<pre class="idl highlight def"><c- b>dictionary</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="dictionary" data-export id="dictdef-layoutconstraintsoptions"><code><c- g>LayoutConstraintsOptions</c-></code></dfn> {
    <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-double" id="ref-for-idl-double①③"><c- b>double</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="LayoutConstraintsOptions" data-dfn-type="dict-member" data-export data-type="double" id="dom-layoutconstraintsoptions-availableinlinesize"><code><c- g>availableInlineSize</c-></code></dfn>;
    <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-double" id="ref-for-idl-double①④"><c- b>double</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="LayoutConstraintsOptions" data-dfn-type="dict-member" data-export data-type="double" id="dom-layoutconstraintsoptions-availableblocksize"><code><c- g>availableBlockSize</c-></code></dfn>;

    <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-double" id="ref-for-idl-double①⑤"><c- b>double</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="LayoutConstraintsOptions" data-dfn-type="dict-member" data-export data-type="double" id="dom-layoutconstraintsoptions-fixedinlinesize"><code><c- g>fixedInlineSize</c-></code></dfn>;
    <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-double" id="ref-for-idl-double①⑥"><c- b>double</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="LayoutConstraintsOptions" data-dfn-type="dict-member" data-export data-type="double" id="dom-layoutconstraintsoptions-fixedblocksize"><code><c- g>fixedBlockSize</c-></code></dfn>;

    <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-double" id="ref-for-idl-double①⑦"><c- b>double</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="LayoutConstraintsOptions" data-dfn-type="dict-member" data-export data-type="double" id="dom-layoutconstraintsoptions-percentageinlinesize"><code><c- g>percentageInlineSize</c-></code></dfn>;
    <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-double" id="ref-for-idl-double①⑧"><c- b>double</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="LayoutConstraintsOptions" data-dfn-type="dict-member" data-export data-type="double" id="dom-layoutconstraintsoptions-percentageblocksize"><code><c- g>percentageBlockSize</c-></code></dfn>;

    <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-double" id="ref-for-idl-double①⑨"><c- b>double</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="LayoutConstraintsOptions" data-dfn-type="dict-member" data-export data-type="double" id="dom-layoutconstraintsoptions-blockfragmentationoffset"><code><c- g>blockFragmentationOffset</c-></code></dfn>;
    <a data-link-type="idl-name" href="#enumdef-blockfragmentationtype" id="ref-for-enumdef-blockfragmentationtype①"><c- n>BlockFragmentationType</c-></a> <dfn class="dfn-paneled idl-code" data-default="&quot;none&quot;" data-dfn-for="LayoutConstraintsOptions" data-dfn-type="dict-member" data-export data-type="BlockFragmentationType" id="dom-layoutconstraintsoptions-blockfragmentationtype"><code><c- g>blockFragmentationType</c-></code></dfn> = "none";

    <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-any" id="ref-for-idl-any②"><c- b>any</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="LayoutConstraintsOptions" data-dfn-type="dict-member" data-export data-type="any" id="dom-layoutconstraintsoptions-data"><code><c- g>data</c-></code></dfn>;
};
</pre>
   <p class="note" role="note"><span class="marker">Note:</span> The <a data-link-type="dfn" href="#translate-a-layoutconstraintsoptions-to-internal-constraints" id="ref-for-translate-a-layoutconstraintsoptions-to-internal-constraints">translate a LayoutConstraintsOptions to internal constraints</a> describes how to convert
    a <code class="idl"><a data-link-type="idl" href="#dictdef-layoutconstraintsoptions" id="ref-for-dictdef-layoutconstraintsoptions②">LayoutConstraintsOptions</a></code> object into a user agents internal representation.</p>
   <div class="algorithm" data-algorithm="translate a LayoutConstraintsOptions to internal constraints">
     When the user agent wants to <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="translate-a-layoutconstraintsoptions-to-internal-constraints">translate a LayoutConstraintsOptions to internal constraints</dfn> given <var>options</var>, it <em>must</em> run the following steps: 
    <ol>
     <li data-md>
      <p>Let the <a data-link-type="dfn" href="https://drafts.csswg.org/css-sizing-3/#available" id="ref-for-available③">available space</a> in the inline direction (with respect to the <a data-link-type="dfn" href="#current-layout" id="ref-for-current-layout①⑤">current layout</a>,
be the result of:</p>
      <ul>
       <li data-md>
        <p>If <var>options</var>’ <code class="idl"><a data-link-type="idl" href="#dom-layoutconstraintsoptions-availableinlinesize" id="ref-for-dom-layoutconstraintsoptions-availableinlinesize">availableInlineSize</a></code> is not null, and <code class="idl"><a data-link-type="idl" href="#dom-layoutconstraintsoptions-availableinlinesize" id="ref-for-dom-layoutconstraintsoptions-availableinlinesize①">availableInlineSize</a></code> is greater than zero, let the result be <code class="idl"><a data-link-type="idl" href="#dom-layoutconstraintsoptions-availableinlinesize" id="ref-for-dom-layoutconstraintsoptions-availableinlinesize②">availableInlineSize</a></code>.</p>
       <li data-md>
        <p>Otherwhise, let the result be zero.</p>
      </ul>
     <li data-md>
      <p>Let the <a data-link-type="dfn" href="https://drafts.csswg.org/css-sizing-3/#available" id="ref-for-available④">available space</a> in the block direction (with respect to the <a data-link-type="dfn" href="#current-layout" id="ref-for-current-layout①⑥">current layout</a>),
be the result of:</p>
      <ul>
       <li data-md>
        <p>If <var>options</var>’ <code class="idl"><a data-link-type="idl" href="#dom-layoutconstraintsoptions-availableblocksize" id="ref-for-dom-layoutconstraintsoptions-availableblocksize">availableBlockSize</a></code> is not null, and <code class="idl"><a data-link-type="idl" href="#dom-layoutconstraintsoptions-availableblocksize" id="ref-for-dom-layoutconstraintsoptions-availableblocksize①">availableBlockSize</a></code> is greater than zero, let the result be <code class="idl"><a data-link-type="idl" href="#dom-layoutconstraintsoptions-availableblocksize" id="ref-for-dom-layoutconstraintsoptions-availableblocksize②">availableBlockSize</a></code>.</p>
       <li data-md>
        <p>Otherwhise, let the result be zero.</p>
      </ul>
     <li data-md>
      <p>Let the override size in the inline direction (with respect to the <a data-link-type="dfn" href="#current-layout" id="ref-for-current-layout①⑦">current layout</a>, be the
result of:</p>
      <ul>
       <li data-md>
        <p>Let the result be <var>options</var>’ <code class="idl"><a data-link-type="idl" href="#dom-layoutconstraintsoptions-fixedinlinesize" id="ref-for-dom-layoutconstraintsoptions-fixedinlinesize">fixedInlineSize</a></code>.</p>
      </ul>
      <p class="note" role="note"><span class="marker">Note:</span> If the <code class="idl"><a data-link-type="idl" href="#dom-layoutconstraintsoptions-fixedinlinesize" id="ref-for-dom-layoutconstraintsoptions-fixedinlinesize①">fixedInlineSize</a></code> is null, no override size is
    applied.</p>
     <li data-md>
      <p>Let the override size in the block direction (with respect to the <a data-link-type="dfn" href="#current-layout" id="ref-for-current-layout①⑧">current layout</a>, be the
result of:</p>
      <ul>
       <li data-md>
        <p>Let the result be <var>options</var>’ <code class="idl"><a data-link-type="idl" href="#dom-layoutconstraintsoptions-fixedblocksize" id="ref-for-dom-layoutconstraintsoptions-fixedblocksize">fixedBlockSize</a></code>.</p>
      </ul>
      <p class="note" role="note"><span class="marker">Note:</span> If the <code class="idl"><a data-link-type="idl" href="#dom-layoutconstraintsoptions-fixedblocksize" id="ref-for-dom-layoutconstraintsoptions-fixedblocksize①">fixedBlockSize</a></code> is null, no override size is
    applied.</p>
     <li data-md>
      <p>Let the percentage resultion size in the inline direction (with respect to the <a data-link-type="dfn" href="#current-layout" id="ref-for-current-layout①⑨">current layout</a>, be the result of:</p>
      <ul>
       <li data-md>
        <p>If <var>options</var>’ <code class="idl"><a data-link-type="idl" href="#dom-layoutconstraintsoptions-percentageinlinesize" id="ref-for-dom-layoutconstraintsoptions-percentageinlinesize">percentageInlineSize</a></code> is not null, and <code class="idl"><a data-link-type="idl" href="#dom-layoutconstraintsoptions-percentageinlinesize" id="ref-for-dom-layoutconstraintsoptions-percentageinlinesize①">percentageInlineSize</a></code> is greater than zero, let the result
be <code class="idl"><a data-link-type="idl" href="#dom-layoutconstraintsoptions-percentageinlinesize" id="ref-for-dom-layoutconstraintsoptions-percentageinlinesize②">percentageInlineSize</a></code>.</p>
       <li data-md>
        <p>If <var>options</var>’ <code class="idl"><a data-link-type="idl" href="#dom-layoutconstraintsoptions-availableinlinesize" id="ref-for-dom-layoutconstraintsoptions-availableinlinesize③">availableInlineSize</a></code> is not null, and <code class="idl"><a data-link-type="idl" href="#dom-layoutconstraintsoptions-availableinlinesize" id="ref-for-dom-layoutconstraintsoptions-availableinlinesize④">availableInlineSize</a></code> is greater than zero, let the result be <code class="idl"><a data-link-type="idl" href="#dom-layoutconstraintsoptions-availableinlinesize" id="ref-for-dom-layoutconstraintsoptions-availableinlinesize⑤">availableInlineSize</a></code>.</p>
       <li data-md>
        <p>Otherwhise, let the result be zero.</p>
      </ul>
     <li data-md>
      <p>Let the percentage resultion size in the block direction (with respect to the <a data-link-type="dfn" href="#current-layout" id="ref-for-current-layout②⓪">current layout</a>, be the result of:</p>
      <ul>
       <li data-md>
        <p>If <var>options</var>’ <code class="idl"><a data-link-type="idl" href="#dom-layoutconstraintsoptions-percentageblocksize" id="ref-for-dom-layoutconstraintsoptions-percentageblocksize">percentageBlockSize</a></code> is not null, and <code class="idl"><a data-link-type="idl" href="#dom-layoutconstraintsoptions-percentageblocksize" id="ref-for-dom-layoutconstraintsoptions-percentageblocksize①">percentageBlockSize</a></code> is greater than zero, let the result
be <code class="idl"><a data-link-type="idl" href="#dom-layoutconstraintsoptions-percentageblocksize" id="ref-for-dom-layoutconstraintsoptions-percentageblocksize②">percentageBlockSize</a></code>.</p>
       <li data-md>
        <p>If <var>options</var>’ <code class="idl"><a data-link-type="idl" href="#dom-layoutconstraintsoptions-availableblocksize" id="ref-for-dom-layoutconstraintsoptions-availableblocksize③">availableBlockSize</a></code> is not null, and <code class="idl"><a data-link-type="idl" href="#dom-layoutconstraintsoptions-availableblocksize" id="ref-for-dom-layoutconstraintsoptions-availableblocksize④">availableBlockSize</a></code> is greater than zero, let the result be <code class="idl"><a data-link-type="idl" href="#dom-layoutconstraintsoptions-availableblocksize" id="ref-for-dom-layoutconstraintsoptions-availableblocksize⑤">availableBlockSize</a></code>.</p>
       <li data-md>
        <p>Otherwhise, let the result be zero.</p>
      </ul>
     <li data-md>
      <p>If the <a data-link-type="dfn" href="#child-layout" id="ref-for-child-layout">child layout</a> is a <a data-link-type="dfn" href="#layout-api-container" id="ref-for-layout-api-container①②">layout API container</a>, then let the store the data (passed by <code class="idl"><a data-link-type="idl" href="#dom-layoutconstraints-data" id="ref-for-dom-layoutconstraints-data">data</a></code>) be the result of:</p>
      <ul>
       <li data-md>
        <p>Invoking <a data-link-type="dfn" href="https://html.spec.whatwg.org/#structuredserializeforstorage" id="ref-for-structuredserializeforstorage">StructuredSerializeForStorage</a> on <var>options</var>’ <code class="idl"><a data-link-type="idl" href="#dom-layoutconstraintsoptions-data" id="ref-for-dom-layoutconstraintsoptions-data">data</a></code>.</p>
      </ul>
    </ol>
   </div>
   <div class="example" id="example-00166d24">
    <a class="self-link" href="#example-00166d24"></a> The example below shows the basic usage of the <code class="idl"><a data-link-type="idl" href="#dictdef-layoutconstraintsoptions" id="ref-for-dictdef-layoutconstraintsoptions③">LayoutConstraintsOptions</a></code> dictionary. 
<pre class="lang-javascript highlight"><c- c1>// The class below is registered with a "block-like" sizingMode, and can use the</c->
<c- c1>// fixedInlineSize, fixedBlockSize attributes.</c->
registerLayout<c- p>(</c-><c- t>'child-layout-constraints-example'</c-><c- p>,</c-> <c- a>class</c-> <c- p>{</c->
    <c- k>async</c-> layout<c- p>(</c->children<c- p>,</c-> edges<c- p>,</c-> constraints<c- p>,</c-> styleMap<c- p>)</c-> <c- p>{</c->

        <c- c1>// The call below gives the child an "available" space. It will try and</c->
        <c- c1>// fit within this.</c->
        <c- a>const</c-> fragment <c- o>=</c-> children<c- p>[</c-><c- mf>0</c-><c- p>].</c->layoutNextFragment<c- p>({</c->
            availableInlineSize<c- o>:</c-> <c- mf>100</c-><c- p>,</c->
            availableBlockSize<c- o>:</c-> <c- mf>200</c-><c- p>,</c->
        <c- p>});</c->

        <c- c1>// The call below gives the child a "fixed" size, it will be forced to</c->
        <c- c1>// this size ignoring any style set.</c->
        <c- a>const</c-> fragment <c- o>=</c-> children<c- p>[</c-><c- mf>0</c-><c- p>].</c->layoutNextFragment<c- p>({</c->
            fixedInlineSize<c- o>:</c-> <c- mf>20</c-><c- p>,</c->
            fixedBlockSize<c- o>:</c-> <c- mf>30</c-><c- p>,</c->
        <c- p>});</c->

    <c- p>}</c->
<c- p>});</c->
</pre>
   </div>
   <h3 class="heading settled" data-level="4.5" id="breaking-and-fragmentation"><span class="secno">4.5. </span><span class="content">Breaking and Fragmentation</span><a class="self-link" href="#breaking-and-fragmentation"></a></h3>
   <p>A <code class="idl"><a data-link-type="idl" href="#layoutchild" id="ref-for-layoutchild③③">LayoutChild</a></code> can produce multiple <code class="idl"><a data-link-type="idl" href="#layoutfragment" id="ref-for-layoutfragment②⓪">LayoutFragment</a></code>s. A <code class="idl"><a data-link-type="idl" href="#layoutchild" id="ref-for-layoutchild③④">LayoutChild</a></code> may fragment in the
block direction if a <code class="idl"><a data-link-type="idl" href="#dom-layoutconstraints-blockfragmentationtype" id="ref-for-dom-layoutconstraints-blockfragmentationtype②">blockFragmentationType</a></code> is not none.  Additionally <code class="idl"><a data-link-type="idl" href="#layoutchild" id="ref-for-layoutchild③⑤">LayoutChild</a></code> which represents <a data-link-type="dfn" href="https://drafts.csswg.org/css-display-4/#inline-level" id="ref-for-inline-level②">inline-level</a> content, may fragment line by line if the <a data-link-type="dfn" href="#document-layout-definition-layout-options" id="ref-for-document-layout-definition-layout-options⑤">layout options'</a> <code class="idl"><a data-link-type="idl" href="#dom-layoutoptions-childdisplay" id="ref-for-dom-layoutoptions-childdisplay③">childDisplay</a></code> (set by <code>layoutOptions</code>) is <code>"normal"</code>.</p>
<pre class="idl highlight def">[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed" id="ref-for-Exposed⑧"><c- g>Exposed</c-></a>=<c- n>LayoutWorklet</c->]
<c- b>interface</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="interface" data-export id="childbreaktoken"><code><c- g>ChildBreakToken</c-></code></dfn> {
    <c- b>readonly</c-> <c- b>attribute</c-> <a data-link-type="idl-name" href="#enumdef-breaktype" id="ref-for-enumdef-breaktype"><c- n>BreakType</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="ChildBreakToken" data-dfn-type="attribute" data-export data-readonly data-type="BreakType" id="dom-childbreaktoken-breaktype"><code><c- g>breakType</c-></code></dfn>;
    <c- b>readonly</c-> <c- b>attribute</c-> <a data-link-type="idl-name" href="#layoutchild" id="ref-for-layoutchild③⑥"><c- n>LayoutChild</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="ChildBreakToken" data-dfn-type="attribute" data-export data-readonly data-type="LayoutChild" id="dom-childbreaktoken-child"><code><c- g>child</c-></code></dfn>;
};

[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed" id="ref-for-Exposed⑨"><c- g>Exposed</c-></a>=<c- n>LayoutWorklet</c->]
<c- b>interface</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="interface" data-export id="breaktoken"><code><c- g>BreakToken</c-></code></dfn> {
    <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-frozen-array" id="ref-for-idl-frozen-array"><c- b>FrozenArray</c-></a>&lt;<a data-link-type="idl-name" href="#childbreaktoken" id="ref-for-childbreaktoken②"><c- n>ChildBreakToken</c-></a>> <dfn class="dfn-paneled idl-code" data-dfn-for="BreakToken" data-dfn-type="attribute" data-export data-readonly data-type="FrozenArray<ChildBreakToken>" id="dom-breaktoken-childbreaktokens"><code><c- g>childBreakTokens</c-></code></dfn>;
    <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-any" id="ref-for-idl-any③"><c- b>any</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="BreakToken" data-dfn-type="attribute" data-export data-readonly data-type="any" id="dom-breaktoken-data"><code><c- g>data</c-></code></dfn>;
};

<c- b>dictionary</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="dictionary" data-export id="dictdef-breaktokenoptions"><code><c- g>BreakTokenOptions</c-></code></dfn> {
    <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#idl-sequence" id="ref-for-idl-sequence"><c- b>sequence</c-></a>&lt;<a data-link-type="idl-name" href="#childbreaktoken" id="ref-for-childbreaktoken③"><c- n>ChildBreakToken</c-></a>> <dfn class="dfn-paneled idl-code" data-dfn-for="BreakTokenOptions" data-dfn-type="dict-member" data-export data-type="sequence<ChildBreakToken>" id="dom-breaktokenoptions-childbreaktokens"><code><c- g>childBreakTokens</c-></code></dfn>;
    <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-any" id="ref-for-idl-any④"><c- b>any</c-></a> <dfn class="dfn-paneled idl-code" data-default="null" data-dfn-for="BreakTokenOptions" data-dfn-type="dict-member" data-export data-type="any" id="dom-breaktokenoptions-data"><code><c- g>data</c-></code></dfn> = <c- b>null</c->;
};

<c- b>enum</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="enum" data-export id="enumdef-breaktype"><code><c- g>BreakType</c-></code></dfn> { <dfn class="dfn-paneled idl-code" data-dfn-for="BreakType" data-dfn-type="enum-value" data-export id="dom-breaktype-none"><code><c- s>"none"</c-></code></dfn>, <dfn class="dfn-paneled idl-code" data-dfn-for="BreakType" data-dfn-type="enum-value" data-export id="dom-breaktype-line"><code><c- s>"line"</c-></code></dfn>, <dfn class="dfn-paneled idl-code" data-dfn-for="BreakType" data-dfn-type="enum-value" data-export id="dom-breaktype-column"><code><c- s>"column"</c-></code></dfn>, <dfn class="dfn-paneled idl-code" data-dfn-for="BreakType" data-dfn-type="enum-value" data-export id="dom-breaktype-page"><code><c- s>"page"</c-></code></dfn>, <dfn class="dfn-paneled idl-code" data-dfn-for="BreakType" data-dfn-type="enum-value" data-export id="dom-breaktype-region"><code><c- s>"region"</c-></code></dfn> };
</pre>
   <p>The <code class="idl"><a data-link-type="idl" href="#childbreaktoken" id="ref-for-childbreaktoken④">ChildBreakToken</a></code> has internal slot(s):</p>
   <ul>
    <li data-md>
     <p><dfn class="dfn-paneled idl-code" data-dfn-for="ChildBreakToken" data-dfn-type="attribute" data-export id="dom-childbreaktoken-unique-id-slot"><code>[[unique id]]</code></dfn> the <a data-link-type="dfn" href="#layout-api-context-unique-id" id="ref-for-layout-api-context-unique-id⑤">unique id</a> of the <a data-link-type="dfn" href="#layout-api-context" id="ref-for-layout-api-context④">layout api context</a> which produced this child break token. This slot is used so that a <code class="idl"><a data-link-type="idl" href="#childbreaktoken" id="ref-for-childbreaktoken⑤">ChildBreakToken</a></code> from a previous layout pass is invalid.</p>
   </ul>
   <hr>
   <p>A subsequent <code class="idl"><a data-link-type="idl" href="#layoutfragment" id="ref-for-layoutfragment②①">LayoutFragment</a></code> is produced by using the previous <code class="idl"><a data-link-type="idl" href="#layoutfragment" id="ref-for-layoutfragment②②">LayoutFragment</a></code>’s <code class="idl"><a data-link-type="idl" href="#dom-layoutfragment-breaktoken" id="ref-for-dom-layoutfragment-breaktoken⑤">breakToken</a></code>. This tells the <a data-link-type="dfn" href="#child-layout" id="ref-for-child-layout①">child layout</a> to produce a <code class="idl"><a data-link-type="idl" href="#layoutfragment" id="ref-for-layoutfragment②③">LayoutFragment</a></code> starting at the point encoded in the <code class="idl"><a data-link-type="idl" href="#childbreaktoken" id="ref-for-childbreaktoken⑥">ChildBreakToken</a></code>.</p>
   <h3 class="heading settled" data-level="4.6" id="edges"><span class="secno">4.6. </span><span class="content">Edges</span><a class="self-link" href="#edges"></a></h3>
   <p>A <code class="idl"><a data-link-type="idl" href="#layoutedges" id="ref-for-layoutedges">LayoutEdges</a></code> object is passed into the layout method. This represents the sum of all the <a data-link-type="dfn" href="https://www.w3.org/TR/CSS21/box.html#box-dimensions" id="ref-for-box-dimensions">box model edges</a> (border, scrollbar, padding), for the current box which is being laid out.</p>
<pre class="idl highlight def">[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed" id="ref-for-Exposed①⓪"><c- g>Exposed</c-></a>=<c- n>LayoutWorklet</c->]
<c- b>interface</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="interface" data-export id="layoutedges"><code><c- g>LayoutEdges</c-></code></dfn> {
  <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-double" id="ref-for-idl-double②⓪"><c- b>double</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="LayoutEdges" data-dfn-type="attribute" data-export data-readonly data-type="double" id="dom-layoutedges-inlinestart"><code><c- g>inlineStart</c-></code></dfn>;
  <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-double" id="ref-for-idl-double②①"><c- b>double</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="LayoutEdges" data-dfn-type="attribute" data-export data-readonly data-type="double" id="dom-layoutedges-inlineend"><code><c- g>inlineEnd</c-></code></dfn>;

  <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-double" id="ref-for-idl-double②②"><c- b>double</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="LayoutEdges" data-dfn-type="attribute" data-export data-readonly data-type="double" id="dom-layoutedges-blockstart"><code><c- g>blockStart</c-></code></dfn>;
  <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-double" id="ref-for-idl-double②③"><c- b>double</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="LayoutEdges" data-dfn-type="attribute" data-export data-readonly data-type="double" id="dom-layoutedges-blockend"><code><c- g>blockEnd</c-></code></dfn>;

  // Convenience attributes for the sum in one direction.
  <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-double" id="ref-for-idl-double②④"><c- b>double</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="LayoutEdges" data-dfn-type="attribute" data-export data-readonly data-type="double" id="dom-layoutedges-inline"><code><c- g>inline</c-></code></dfn>;
  <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-double" id="ref-for-idl-double②⑤"><c- b>double</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="LayoutEdges" data-dfn-type="attribute" data-export data-readonly data-type="double" id="dom-layoutedges-block"><code><c- g>block</c-></code></dfn>;
};
</pre>
   <p>Each of the accessors represents the width in CSS pixels of an edge in each of the <a data-link-type="dfn" href="https://drafts.csswg.org/css-writing-modes-4/#abstract-dimensions" id="ref-for-abstract-dimensions">abstract dimensions</a> (<code class="idl"><a data-link-type="idl" href="#dom-layoutedges-inlinestart" id="ref-for-dom-layoutedges-inlinestart">inlineStart</a></code>, <code class="idl"><a data-link-type="idl" href="#dom-layoutedges-inlineend" id="ref-for-dom-layoutedges-inlineend">inlineEnd</a></code>, <code class="idl"><a data-link-type="idl" href="#dom-layoutedges-blockstart" id="ref-for-dom-layoutedges-blockstart">blockStart</a></code>, <code class="idl"><a data-link-type="idl" href="#dom-layoutedges-blockend" id="ref-for-dom-layoutedges-blockend">blockEnd</a></code>).</p>
   <p>The <code class="idl"><a data-link-type="idl" href="#dom-layoutedges-inline" id="ref-for-dom-layoutedges-inline">inline</a></code>, and <code class="idl"><a data-link-type="idl" href="#dom-layoutedges-block" id="ref-for-dom-layoutedges-block">block</a></code> on the <code class="idl"><a data-link-type="idl" href="#layoutedges" id="ref-for-layoutedges①">LayoutEdges</a></code> object are convenience
attributes which represent the sum in that direction.</p>
   <figure>
     <img alt="An example of layout edges." src="img/edges.png" width="800"> 
    <figcaption> A visualization showing the <code class="idl"><a data-link-type="idl" href="#layoutedges" id="ref-for-layoutedges②">LayoutEdges</a></code> object for a <a data-link-type="dfn" href="https://drafts.csswg.org/css-display-3/#box" id="ref-for-box①⑥">box</a> with different sized
        scrollbar, border, and padding. </figcaption>
   </figure>
   <div class="example" id="example-4ab22fb2">
    <a class="self-link" href="#example-4ab22fb2"></a> This example shows an node styled by CSS, and what its respective <code class="idl"><a data-link-type="idl" href="#layoutedges" id="ref-for-layoutedges③">LayoutEdges</a></code> could contain. 
<pre class="lang-html highlight"><c- p>&lt;</c-><c- f>style</c-><c- p>></c->
<c- p>.</c-><c- nc>container</c-> <c- p>{</c->
  <c- k>width</c-><c- p>:</c-> <c- mi>50</c-><c- b>px</c-><c- p>;</c->
  <c- k>height</c-><c- p>:</c-> <c- mi>50</c-><c- b>px</c-><c- p>;</c->
<c- p>}</c->

<c- p>.</c-><c- nc>box</c-> <c- p>{</c->
  <c- k>display</c-><c- p>:</c-> <c- nf>layout</c-><c- p>(</c-><c- n>box</c-><c- g>-edges</c-><c- p>);</c->

  <c- k>padding</c-><c- p>:</c-> <c- mi>10</c-><c- b>%</c-><c- p>;</c->
  <c- k>border</c-><c- p>:</c-> <c- kc>solid</c-> <c- mi>2</c-><c- b>px</c-><c- p>;</c->
  <c- k>overflow-y</c-><c- p>:</c-> <c- kc>scroll</c-><c- p>;</c->
<c- p>}</c->
<c- p>&lt;/</c-><c- f>style</c-><c- p>></c->

<c- p>&lt;</c-><c- f>div</c-> <c- e>class</c-><c- o>=</c-><c- s>"container"</c-><c- p>></c->
  <c- p>&lt;</c-><c- f>div</c-> <c- e>class</c-><c- o>=</c-><c- s>"box"</c-><c- p>>&lt;/</c-><c- f>div</c-><c- p>></c->
<c- p>&lt;/</c-><c- f>div</c-><c- p>></c->
</pre>
<pre class="lang-javascript highlight">registerLayout<c- p>(</c-><c- t>'box-edges'</c-><c- p>,</c-> <c- a>class</c-> <c- p>{</c->
    <c- k>async</c-> layout<c- p>(</c->children<c- p>,</c-> edges<c- p>,</c-> constraints<c- p>,</c-> styleMap<c- p>,</c-> breakToken<c- p>)</c-> <c- p>{</c->
        edges<c- p>.</c->inlineStart<c- p>;</c-> <c- c1>// 2 + 5 (as 10% * 50px = 5px).</c->
        edges<c- p>.</c->blockEnd<c- p>;</c-> <c- c1>// 7 (2 + 5)</c->
        edges<c- p>.</c->inlineEnd<c- p>;</c-> <c- c1>// UA-dependent, due to scrollbar.</c->
                         <c- c1>//  Could be 2 + 5 + 0 or 2 + 5 + 16 for example.</c->
        edges<c- p>.</c->block<c- p>;</c-> <c- c1>// 14 (2 + 5 + 5 + 2).</c->
    <c- p>}</c->
<c- p>}</c->
</pre>
   </div>
   <h2 class="heading settled" data-level="5" id="interactions-with-other-modules"><span class="secno">5. </span><span class="content">Interactions with other Modules</span><a class="self-link" href="#interactions-with-other-modules"></a></h2>
   <p>This section describes how other CSS modules interact with the CSS Layout API.</p>
   <h3 class="heading settled" data-level="5.1" id="interaction-sizing"><span class="secno">5.1. </span><span class="content">Sizing</span><a class="self-link" href="#interaction-sizing"></a></h3>
   <p>User agents must use the <code class="idl"><a data-link-type="idl" href="#layoutconstraints" id="ref-for-layoutconstraints⑧">LayoutConstraints</a></code> object to communicate to the <a data-link-type="dfn" href="#current-layout" id="ref-for-current-layout②①">current layout</a> the
size they would like the fragment to be.</p>
   <p>If the user agent wishes to force a size on the box, it can use the <code class="idl"><a data-link-type="idl" href="#dom-layoutconstraints-fixedinlinesize" id="ref-for-dom-layoutconstraints-fixedinlinesize④">fixedInlineSize</a></code> and <code class="idl"><a data-link-type="idl" href="#dom-layoutconstraints-fixedblocksize" id="ref-for-dom-layoutconstraints-fixedblocksize④">fixedBlockSize</a></code> attributes to do so.</p>
   <p>The <a data-link-type="dfn" href="#layout-api-container" id="ref-for-layout-api-container①③">layout API container</a> can be passed size information in different ways depending on the value
of <a data-link-type="dfn" href="#document-layout-definition-layout-options" id="ref-for-document-layout-definition-layout-options⑥">layout options'</a> <code class="idl"><a data-link-type="idl" href="#dom-layoutoptions-sizing" id="ref-for-dom-layoutoptions-sizing①">sizing</a></code> (set by <code>layoutOptions</code> on the class).</p>
   <p>If the value of <a data-link-type="dfn" href="#document-layout-definition-layout-options" id="ref-for-document-layout-definition-layout-options⑦">layout options'</a> <code class="idl"><a data-link-type="idl" href="#dom-layoutoptions-sizing" id="ref-for-dom-layoutoptions-sizing②">sizing</a></code> is <code>"block-like"</code>, then the <code class="idl"><a data-link-type="idl" href="#layoutconstraints" id="ref-for-layoutconstraints⑨">LayoutConstraints</a></code> passed to the <a data-link-type="dfn" href="#layout-api-container" id="ref-for-layout-api-container①④">layout API container</a>:</p>
   <ul>
    <li data-md>
     <p><em>Must</em> calculate and set <code class="idl"><a data-link-type="idl" href="#dom-layoutconstraints-fixedinlinesize" id="ref-for-dom-layoutconstraints-fixedinlinesize⑤">fixedInlineSize</a></code> based off the rules
specified in <a data-link-type="biblio" href="#biblio-css-sizing-3" title="CSS Box Sizing Module Level 3">[css-sizing-3]</a> and the formatting context in which it participates, e.g.</p>
     <ul>
      <li data-md>
       <p>As a <a data-link-type="dfn" href="https://drafts.csswg.org/css-display-4/#block-level" id="ref-for-block-level②">block-level</a> box in a <a data-link-type="dfn" href="https://drafts.csswg.org/css-display-4/#block-formatting-context" id="ref-for-block-formatting-context">block formatting context</a>, it is sized like a <a data-link-type="dfn" href="https://drafts.csswg.org/css-display-4/#block-box" id="ref-for-block-box">block box</a> that establishes a formatting context, with an <a class="css" data-link-type="maybe" href="https://drafts.csswg.org/css-sizing-3/#valdef-width-auto" id="ref-for-valdef-width-auto①">auto</a> <a data-link-type="dfn" href="https://drafts.csswg.org/css-writing-modes-4/#inline-size" id="ref-for-inline-size①">inline size</a> calculated as for non-replaced block boxes.</p>
      <li data-md>
       <p>As an <a data-link-type="dfn" href="https://drafts.csswg.org/css-display-4/#inline-level" id="ref-for-inline-level③">inline-level</a> box in an <a data-link-type="dfn" href="https://drafts.csswg.org/css-display-4/#inline-formatting-context" id="ref-for-inline-formatting-context">inline formatting context</a>, it is sized as an atomic
inline-level box (such as an inline-block).</p>
     </ul>
    <li data-md>
     <p><em>Must</em> calculate and set <code class="idl"><a data-link-type="idl" href="#dom-layoutconstraints-fixedblocksize" id="ref-for-dom-layoutconstraints-fixedblocksize⑤">fixedBlockSize</a></code> based off the rules
specified in <a data-link-type="biblio" href="#biblio-css-sizing-3" title="CSS Box Sizing Module Level 3">[css-sizing-3]</a>, and the formatting context in which it participates. If the <a data-link-type="dfn" href="#layout-api-container" id="ref-for-layout-api-container①⑤">layout API container</a> has an <a class="css" data-link-type="maybe" href="https://drafts.csswg.org/css-sizing-3/#valdef-width-auto" id="ref-for-valdef-width-auto②">auto</a> <a data-link-type="dfn" href="https://drafts.csswg.org/css-writing-modes-4/#block-size" id="ref-for-block-size③">block size</a>, and cannot be determined
ahead of time, <code class="idl"><a data-link-type="idl" href="#dom-layoutconstraints-fixedblocksize" id="ref-for-dom-layoutconstraints-fixedblocksize⑥">fixedBlockSize</a></code> must be set to <code>null</code>.</p>
   </ul>
   <p>If the value of <a data-link-type="dfn" href="#document-layout-definition-layout-options" id="ref-for-document-layout-definition-layout-options⑧">layout options'</a> <code class="idl"><a data-link-type="idl" href="#dom-layoutoptions-sizing" id="ref-for-dom-layoutoptions-sizing③">sizing</a></code> is <code>"manual"</code>, then the user-agent must not pre-calculate <code class="idl"><a data-link-type="idl" href="#dom-layoutconstraints-fixedinlinesize" id="ref-for-dom-layoutconstraints-fixedinlinesize⑥">fixedInlineSize</a></code> and/or <code class="idl"><a data-link-type="idl" href="#dom-layoutconstraints-fixedblocksize" id="ref-for-dom-layoutconstraints-fixedblocksize⑦">fixedBlockSize</a></code> ahead of time,
except when it is being forced to a particular size by the formatting context in which it
participates, for example:</p>
   <ul>
    <li data-md>
     <p>If the <a data-link-type="dfn" href="#layout-api-container" id="ref-for-layout-api-container①⑥">layout API container</a> is within a <a data-link-type="dfn" href="https://drafts.csswg.org/css-display-4/#block-formatting-context" id="ref-for-block-formatting-context①">block formatting context</a>, is inflow, and has
an <a class="css" data-link-type="maybe" href="https://drafts.csswg.org/css-sizing-3/#valdef-width-auto" id="ref-for-valdef-width-auto③">auto</a> inline size, the user agent <em>must</em> set the <code class="idl"><a data-link-type="idl" href="#dom-layoutconstraints-fixedinlinesize" id="ref-for-dom-layoutconstraints-fixedinlinesize⑦">fixedInlineSize</a></code> to the <a data-link-type="dfn" href="https://drafts.csswg.org/css-sizing-3/#stretch-fit-inline-size" id="ref-for-stretch-fit-inline-size">stretch-fit inline size</a>.</p>
   </ul>
   <div class="note" role="note">
     Note: In the example below the <a data-link-type="dfn" href="#layout-api-container" id="ref-for-layout-api-container①⑦">layout API container</a> has its inline size set to 50. 
<pre class="lang-html highlight"><c- p>&lt;</c-><c- f>style</c-><c- p>></c->
  <c- p>#</c-><c- nn>container</c-> <c- p>{</c->
    <c- k>width</c-><c- p>:</c-> <c- mi>100</c-><c- b>px</c-><c- p>;</c->
    <c- k>height</c-><c- p>:</c-> <c- mi>100</c-><c- b>px</c-><c- p>;</c->
    <c- k>box-sizing</c-><c- p>:</c-> <c- kc>border-box</c-><c- p>;</c->
    <c- k>padding</c-><c- p>:</c-> <c- mi>5</c-><c- b>px</c-><c- p>;</c->
  <c- p>}</c->
  <c- p>#</c-><c- nn>layout-api</c-> <c- p>{</c->
    <c- k>display</c-><c- p>:</c-> <c- nf>layout</c-><c- p>(</c-><c- n>foo</c-><c- p>);</c->
    <c- k>margin</c-><c- p>:</c-> <c- mi>0</c-> <c- mi>20</c-><c- b>px</c-><c- p>;</c->
  <c- p>}</c->
<c- p>&lt;/</c-><c- f>style</c-><c- p>></c->
<c- p>&lt;</c-><c- f>div</c-> <c- e>id</c-><c- o>=</c-><c- s>"container"</c-><c- p>></c->
  <c- p>&lt;</c-><c- f>div</c-> <c- e>id</c-><c- o>=</c-><c- s>"layout-api"</c-><c- p>>&lt;/</c-><c- f>div</c-><c- p>></c->
<c- p>&lt;/</c-><c- f>div</c-><c- p>></c->
</pre>
   </div>
   <h4 class="heading settled" data-level="5.1.1" id="interaction-sizing-positiong-layout"><span class="secno">5.1.1. </span><span class="content">Positioned layout sizing</span><a class="self-link" href="#interaction-sizing-positiong-layout"></a></h4>
   <p>If a <a data-link-type="dfn" href="#layout-api-container" id="ref-for-layout-api-container①⑧">layout API container</a> is out-of-flow positioned the user agent <em>must</em> solve the
positioned size equations (<a href="https://drafts.csswg.org/css-position-3/#abs-non-replaced-width"><cite>CSS Positioned Layout 3</cite> § 5.1 The Width of Absolutely-Positioned, Non-Replaced Elements</a>, <a href="https://drafts.csswg.org/css-position-3/#abs-non-replaced-height"><cite>CSS Positioned Layout 3</cite> § 5.3 The Height Of Absolutely Positioned, Non-Replaced Elements</a>), and set the appropriate <code class="idl"><a data-link-type="idl" href="#dom-layoutconstraints-fixedinlinesize" id="ref-for-dom-layoutconstraints-fixedinlinesize⑧">fixedInlineSize</a></code> and <code class="idl"><a data-link-type="idl" href="#dom-layoutconstraints-fixedblocksize" id="ref-for-dom-layoutconstraints-fixedblocksize⑧">fixedBlockSize</a></code>.</p>
   <div class="note" role="note">
     Note: In the example below the <a data-link-type="dfn" href="#layout-api-container" id="ref-for-layout-api-container①⑨">layout API container</a> has its inline and block size fixed to 
    <ol start="80">
     <li data-md>
    </ol>
<pre class="lang-html highlight"><c- p>&lt;</c-><c- f>style</c-><c- p>></c->
  <c- p>#</c-><c- nn>container</c-> <c- p>{</c->
    <c- k>position</c-><c- p>:</c-> <c- kc>relative</c-><c- p>;</c->
    <c- k>width</c-><c- p>:</c-> <c- mi>100</c-><c- b>px</c-><c- p>;</c->
    <c- k>height</c-><c- p>:</c-> <c- mi>100</c-><c- b>px</c-><c- p>;</c->
  <c- p>}</c->
  <c- p>#</c-><c- nn>layout-api</c-> <c- p>{</c->
    <c- k>display</c-><c- p>:</c-> <c- nf>layout</c-><c- p>(</c-><c- n>foo</c-><c- p>);</c->
    <c- k>top</c-><c- p>:</c-> <c- mi>10</c-><c- b>px</c-><c- p>;</c->
    <c- k>bottom</c-><c- p>:</c-> <c- mi>10</c-><c- b>px</c-><c- p>;</c->
    <c- k>left</c-><c- p>:</c-> <c- mi>10</c-><c- b>px</c-><c- p>;</c->
    <c- k>right</c-><c- p>:</c-> <c- mi>10</c-><c- b>px</c-><c- p>;</c->
    <c- k>position</c-><c- p>:</c-> <c- kc>absolute</c-><c- p>;</c->
  <c- p>}</c->
<c- p>&lt;/</c-><c- f>style</c-><c- p>></c->
<c- p>&lt;</c-><c- f>div</c-> <c- e>id</c-><c- o>=</c-><c- s>"container"</c-><c- p>></c->
  <c- p>&lt;</c-><c- f>div</c-> <c- e>id</c-><c- o>=</c-><c- s>"layout-api"</c-><c- p>>&lt;/</c-><c- f>div</c-><c- p>></c->
<c- p>&lt;/</c-><c- f>div</c-><c- p>></c->
</pre>
   </div>
   <h3 class="heading settled" data-level="5.2" id="interaction-positioning"><span class="secno">5.2. </span><span class="content">Positioning</span><a class="self-link" href="#interaction-positioning"></a></h3>
   <p>All positioning in this level of the specification is handled by the user agent.</p>
   <p>As a result:</p>
   <ul>
    <li data-md>
     <p>Out-of-flow children do not appear as <code class="idl"><a data-link-type="idl" href="#layoutchild" id="ref-for-layoutchild③⑦">LayoutChild</a></code>ren.</p>
    <li data-md>
     <p><a data-link-type="dfn" href="#layout-api-container" id="ref-for-layout-api-container②⓪">Layout API containers</a> establish <a data-link-type="dfn" href="https://drafts.csswg.org/css-display-4/#containing-block" id="ref-for-containing-block③">containing blocks</a> <a href="https://www.w3.org/TR/CSS2/visudet.html#containing-block-details">exactly like block
  containers do</a>. <a data-link-type="biblio" href="#biblio-css21" title="Cascading Style Sheets Level 2 Revision 1 (CSS 2.1) Specification">[CSS21]</a></p>
    <li data-md>
     <p>The <code class="idl"><a data-link-type="idl" href="#dom-layoutfragment-inlineoffset" id="ref-for-dom-layoutfragment-inlineoffset③">inlineOffset</a></code> and <code class="idl"><a data-link-type="idl" href="#dom-layoutfragment-blockoffset" id="ref-for-dom-layoutfragment-blockoffset③">blockOffset</a></code> represent the position of
  the fragment before any positioning and transforms have occured.</p>
    <li data-md>
     <p>The <a data-link-type="dfn" href="https://www.w3.org/TR/CSS21/visudet.html#static-position" id="ref-for-static-position">static position</a> of an absolutely-positioned child of a <a data-link-type="dfn" href="#layout-api-container" id="ref-for-layout-api-container②①">layout API container</a> is set
  to the <a data-link-type="dfn" href="https://drafts.csswg.org/css-writing-modes-4/#inline-start" id="ref-for-inline-start">inline-start</a>, <a data-link-type="dfn" href="https://drafts.csswg.org/css-writing-modes-4/#block-start" id="ref-for-block-start">block-start</a> padding edge of the <a data-link-type="dfn" href="#layout-api-container" id="ref-for-layout-api-container②②">layout API container</a>. Auto
  margins are treated as zero for the child.</p>
   </ul>
   <div class="note" role="note">
     Note: In the example below: 
    <ul>
     <li data-md>
      <p>"child-relative" would be the only child passed to the author’s layout. If it was positioned
  at (<code class="idl"><a data-link-type="idl" href="#dom-layoutfragment-inlineoffset" id="ref-for-dom-layoutfragment-inlineoffset④">inlineOffset</a></code> <code>= 20</code>, <code class="idl"><a data-link-type="idl" href="#dom-layoutfragment-blockoffset" id="ref-for-dom-layoutfragment-blockoffset④">blockOffset</a></code> <code> = 30</code>), its final position would be (<code>25</code>, <code>40</code>) as the
  relative positioning was handled by the user agent.</p>
     <li data-md>
      <p>"child-absolute" would not appear as a <code class="idl"><a data-link-type="idl" href="#layoutchild" id="ref-for-layoutchild③⑧">LayoutChild</a></code>, and instead would be laid out and
  positioned by the user agent.</p>
     <li data-md>
      <p>The examples above also apply in a similar way to sticky and fixed positioned children.</p>
    </ul>
<pre class="lang-html highlight"><c- p>&lt;</c-><c- f>style</c-><c- p>></c->
  <c- p>#</c-><c- nn>container</c-> <c- p>{</c->
    <c- k>display</c-><c- p>:</c-> <c- nf>layout</c-><c- p>(</c-><c- n>foo</c-><c- p>);</c->
    <c- k>position</c-><c- p>:</c-> <c- kc>relative</c-><c- p>;</c-> <c- c>/* container is a containing block */</c->
    <c- k>width</c-><c- p>:</c-> <c- mi>100</c-><c- b>px</c-><c- p>;</c->
    <c- k>height</c-><c- p>:</c-> <c- mi>100</c-><c- b>px</c-><c- p>;</c->
  <c- p>}</c->
  <c- p>#</c-><c- nn>child-relative</c-> <c- p>{</c->
    <c- k>position</c-><c- p>:</c-> <c- kc>relative</c-><c- p>;</c->
    <c- k>left</c-><c- p>:</c-> <c- mi>5</c-><c- b>px</c-><c- p>;</c->
    <c- k>top</c-><c- p>:</c-> <c- mi>10</c-><c- b>px</c-><c- p>;</c->
  <c- p>}</c->
<c- p>&lt;/</c-><c- f>style</c-><c- p>></c->
<c- p>&lt;</c-><c- f>div</c-> <c- e>id</c-><c- o>=</c-><c- s>"container"</c-><c- p>></c->
  <c- p>&lt;</c-><c- f>div</c-> <c- e>id</c-><c- o>=</c-><c- s>"child-relative"</c-><c- p>>&lt;/</c-><c- f>div</c-><c- p>></c->
  <c- p>&lt;</c-><c- f>div</c-> <c- e>id</c-><c- o>=</c-><c- s>"child-absolute"</c-><c- p>>&lt;/</c-><c- f>div</c-><c- p>></c->
<c- p>&lt;/</c-><c- f>div</c-><c- p>></c->
</pre>
   </div>
   <h3 class="heading settled" data-level="5.3" id="interaction-overflow"><span class="secno">5.3. </span><span class="content">Overflow</span><a class="self-link" href="#interaction-overflow"></a></h3>
   <p>The <a data-link-type="dfn" href="https://drafts.csswg.org/css-overflow-3/#scrollable-overflow" id="ref-for-scrollable-overflow">scrollable overflow</a> for a <a data-link-type="dfn" href="#layout-api-container" id="ref-for-layout-api-container②③">layout API container</a> is handled by the user agent in this
level of the specification.</p>
   <p>A <a data-link-type="dfn" href="#layout-api-container" id="ref-for-layout-api-container②④">layout API container</a> should calculate its scrollable overflow exactly like block containers
do.</p>
   <p>Even if the author’s <a data-link-type="dfn" href="#layout-api-container" id="ref-for-layout-api-container②⑤">layout API container</a> positions a fragment into the <a data-link-type="dfn" href="https://drafts.csswg.org/css-overflow-3/#scrollable-overflow" id="ref-for-scrollable-overflow①">scrollable overflow</a> region, relative positioning or transforms may cause the fragment to shift such that its <a data-link-type="dfn" href="https://drafts.csswg.org/css-overflow-3/#scrollable-overflow" id="ref-for-scrollable-overflow②">scrollable overflow</a> region, causing no overflow to occur.</p>
   <h3 class="heading settled" data-level="5.4" id="interaction-fragmentation"><span class="secno">5.4. </span><span class="content">Fragmentation</span><a class="self-link" href="#interaction-fragmentation"></a></h3>
   <p>A <a data-link-type="dfn" href="#parent-layout" id="ref-for-parent-layout③">parent layout</a> can ask the <a data-link-type="dfn" href="#current-layout" id="ref-for-current-layout②②">current layout</a> to <a data-link-type="dfn" href="https://drafts.csswg.org/css-break-3/#fragment" id="ref-for-fragment③">fragment</a> by setting the <code class="idl"><a data-link-type="idl" href="#dom-layoutconstraints-blockfragmentationtype" id="ref-for-dom-layoutconstraints-blockfragmentationtype③">blockFragmentationType</a></code> and <code class="idl"><a data-link-type="idl" href="#dom-layoutconstraints-blockfragmentationoffset" id="ref-for-dom-layoutconstraints-blockfragmentationoffset①">blockFragmentationOffset</a></code>.</p>
   <p>E.g. <a data-link-type="biblio" href="#biblio-css-multicol-1" title="CSS Multi-column Layout Module Level 1">[css-multicol-1]</a> layout would set a <code class="idl"><a data-link-type="idl" href="#dom-layoutconstraints-blockfragmentationtype" id="ref-for-dom-layoutconstraints-blockfragmentationtype④">blockFragmentationType</a></code> to <code>"column"</code> and set the <code class="idl"><a data-link-type="idl" href="#dom-layoutconstraints-blockfragmentationoffset" id="ref-for-dom-layoutconstraints-blockfragmentationoffset②">blockFragmentationOffset</a></code> to where it needs the
child to fragment.</p>
   <h3 class="heading settled" data-level="5.5" id="interaction-alignment"><span class="secno">5.5. </span><span class="content">Alignment</span><a class="self-link" href="#interaction-alignment"></a></h3>
   <p>The first/last baseline sets of a <a data-link-type="dfn" href="#layout-api-container" id="ref-for-layout-api-container②⑥">layout API container</a> is generated exactly like block
containers do (see <a href="https://drafts.csswg.org/css-align-3/#baseline-export"><cite>CSS Box Alignment 3</cite> § 9.1 Determining the Baselines of a Box</a>). Except that the order of the in-flow children
should be determined by the in which they are returned form the layout method (via <code class="idl"><a data-link-type="idl" href="#dom-fragmentresultoptions-childfragments" id="ref-for-dom-fragmentresultoptions-childfragments①">childFragments</a></code>) instead of the document order.</p>
   <div class="note" role="note">
     Note: In a future level of the specification there will be the ability for the author to define the
baselines themselves. This will be of the form: 
    <p>To <em>query</em> baseline information from a <code class="idl"><a data-link-type="idl" href="#layoutchild" id="ref-for-layoutchild③⑨">LayoutChild</a></code>.</p>
<pre class="lang-javascript highlight"><c- a>const</c-> fragment <c- o>=</c-> <c- k>await</c-> child<c- p>.</c->layoutNextFragment<c- p>({</c->
  fixedInlineSize<c- o>:</c-> availableInlineSize<c- p>,</c->
  baselineRequests<c- o>:</c-> <c- p>[</c-><c- t>'alphabetic'</c-><c- p>,</c-> <c- t>'middle'</c-><c- p>],</c->
<c- p>});</c->
fragment<c- p>.</c->baselines<c- p>.</c->get<c- p>(</c-><c- t>'alphabetic'</c-><c- p>)</c-> <c- o>===</c-> <c- mf>25</c-> <c- d>/* or something */</c-><c- p>;</c->
</pre>
    <p>To <em>produce</em> baseline information for a <a data-link-type="dfn" href="#parent-layout" id="ref-for-parent-layout④">parent layout</a>:</p>
<pre class="lang-javascript highlight">registerLayout<c- p>(</c-><c- t>'baseline-producing'</c-><c- p>,</c-> <c- a>class</c-> <c- p>{</c->
  <c- k>async</c-> layout<c- p>(</c->children<c- p>,</c-> edges<c- p>,</c-> constraints<c- p>,</c-> styleMap<c- p>)</c-> <c- p>{</c->
    <c- a>const</c-> result <c- o>=</c-> <c- p>{</c->baselines<c- o>:</c-> <c- p>{}};</c->

    <c- k>for</c-> <c- p>(</c-><c- a>let</c-> baselineRequest <c- k>of</c-> constraints<c- p>.</c->baselineRequests<c- p>)</c-> <c- p>{</c->
      <c- c1>// baselineRequest === 'alphabetic', or something else.</c->
      result<c- p>.</c->baselines<c- p>[</c->baselineRequest<c- p>]</c-> <c- o>=</c-> <c- mf>25</c-><c- p>;</c->
    <c- p>}</c->

    <c- k>return</c-> result<c- p>;</c->
  <c- p>}</c->
<c- p>});</c->
</pre>
   </div>
   <h2 class="heading settled" data-level="6" id="layout"><span class="secno">6. </span><span class="content">Layout</span><a class="self-link" href="#layout"></a></h2>
   <p>This section describes how the CSS Layout API interacts with the user agent’s layout engine.</p>
   <h3 class="heading settled" data-level="6.1" id="processing-model"><span class="secno">6.1. </span><span class="content">Processing Model</span><a class="self-link" href="#processing-model"></a></h3>
   <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="layout-api-work-task">layout API work task</dfn> is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#struct" id="ref-for-struct②">struct</a> which describes the information needed by the user
agent layout engine to perform layout work. It consists of:</p>
   <ul>
    <li data-md>
     <p><dfn class="dfn-paneled" data-dfn-for="layout api work task" data-dfn-type="dfn" data-noexport id="layout-api-work-task-layout-constraints">layout constraints</dfn> a <code class="idl"><a data-link-type="idl" href="#dictdef-layoutconstraintsoptions" id="ref-for-dictdef-layoutconstraintsoptions④">LayoutConstraintsOptions</a></code>.</p>
    <li data-md>
     <p><dfn class="dfn-paneled" data-dfn-for="layout api work task" data-dfn-type="dfn" data-noexport id="layout-api-work-task-layout-child">layout child</dfn> a <code class="idl"><a data-link-type="idl" href="#layoutchild" id="ref-for-layoutchild④⓪">LayoutChild</a></code>.</p>
    <li data-md>
     <p><dfn class="dfn-paneled" data-dfn-for="layout api work task" data-dfn-type="dfn" data-noexport id="layout-api-work-task-child-break-token">child break token</dfn> a <code class="idl"><a data-link-type="idl" href="#childbreaktoken" id="ref-for-childbreaktoken⑦">ChildBreakToken</a></code>.</p>
    <li data-md>
     <p><dfn class="dfn-paneled" data-dfn-for="layout api work task" data-dfn-type="dfn" data-noexport id="layout-api-work-task-task-type">task type</dfn> which is either <code>"layout"</code>, or <code>"intrinsic-sizes"</code></p>
    <li data-md>
     <p><dfn class="dfn-paneled" data-dfn-for="layout api work task" data-dfn-type="dfn" data-noexport id="layout-api-work-task-promise">promise</dfn> a promise object.</p>
   </ul>
   <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="layout-api-context">layout API context</dfn> is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#struct" id="ref-for-struct③">struct</a> which describes the information needed by the <a data-link-type="dfn" href="#current-layout" id="ref-for-current-layout②③">current layout</a> to produce either a fragment or determine the intrinsic-sizes for a <a data-link-type="dfn" href="https://drafts.csswg.org/css-display-3/#box" id="ref-for-box①⑦">box</a>. It
consits of:</p>
   <ul>
    <li data-md>
     <p><dfn class="dfn-paneled" data-dfn-for="layout API context" data-dfn-type="dfn" data-noexport id="layout-api-context-work-queue">work queue</dfn> which is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list④">list</a> of <a data-link-type="dfn" href="#layout-api-work-task" id="ref-for-layout-api-work-task②">layout API work tasks</a>. The user agent will alternate between processing these tasks, and running the
microtask queue.</p>
    <li data-md>
     <p><dfn class="dfn-paneled" data-dfn-for="layout API context" data-dfn-type="dfn" data-noexport id="layout-api-context-unique-id">unique id</dfn> a internal unique identifier. This is used for
determining that objects exposed to the web developer are only used within the correct
layout pass. E.g. <code class="idl"><a data-link-type="idl" href="#layoutfragment" id="ref-for-layoutfragment②④">LayoutFragment</a></code>s returned in the <code class="idl"><a data-link-type="idl" href="#dictdef-fragmentresultoptions" id="ref-for-dictdef-fragmentresultoptions①">FragmentResultOptions</a></code> dictionary
belong to the current layout pass.</p>
    <li data-md>
     <p><dfn class="dfn-paneled" data-dfn-for="layout API context" data-dfn-type="dfn" data-noexport id="layout-api-context-mode">mode</dfn> which is either <code>"layout"</code>, or <code>"intrinsic-sizes"</code>. This is used for determining what the user agent layout
engine is producing, and if a call to <code class="idl"><a data-link-type="idl" href="#dom-layoutchild-layoutnextfragment" id="ref-for-dom-layoutchild-layoutnextfragment⑧">layoutNextFragment()</a></code> is valid.</p>
   </ul>
   <div class="algorithm" data-algorithm="create a layout api context">
     When the user agent wants to <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="create-a-layout-api-context">create a layout API context</dfn> given <var>mode</var>, it <em>must</em> run the following steps: 
    <ol>
     <li data-md>
      <p>Return a new <a data-link-type="dfn" href="#layout-api-context" id="ref-for-layout-api-context⑤">layout API context</a> with:</p>
      <ul>
       <li data-md>
        <p><a data-link-type="dfn" href="#layout-api-context-work-queue" id="ref-for-layout-api-context-work-queue②">work queue</a> being a new <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-empty" id="ref-for-list-empty">empty</a> <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list⑤">list</a>.</p>
       <li data-md>
        <p><a data-link-type="dfn" href="#layout-api-context-unique-id" id="ref-for-layout-api-context-unique-id⑥">unique id</a> being a unique id.</p>
       <li data-md>
        <p><a data-link-type="dfn" href="#layout-api-context-mode" id="ref-for-layout-api-context-mode①">mode</a> being <var>mode</var>.</p>
      </ul>
    </ol>
   </div>
   <h3 class="heading settled" data-level="6.2" id="performing-layout"><span class="secno">6.2. </span><span class="content">Performing Layout</span><a class="self-link" href="#performing-layout"></a></h3>
   <p>The section describes how a user agent calls the web developer defined layout to produces intrinsic
sizes, and fragments.</p>
<pre class="idl highlight def">// This is the final return value from the author defined layout() method.
<c- b>dictionary</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="dictionary" data-export id="dictdef-fragmentresultoptions"><code><c- g>FragmentResultOptions</c-></code></dfn> {
    <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-double" id="ref-for-idl-double②⑥"><c- b>double</c-></a> <dfn class="dfn-paneled idl-code" data-default="0" data-dfn-for="FragmentResultOptions" data-dfn-type="dict-member" data-export data-type="double" id="dom-fragmentresultoptions-inlinesize"><code><c- g>inlineSize</c-></code></dfn> = 0;
    <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-double" id="ref-for-idl-double②⑦"><c- b>double</c-></a> <dfn class="dfn-paneled idl-code" data-default="0" data-dfn-for="FragmentResultOptions" data-dfn-type="dict-member" data-export data-type="double" id="dom-fragmentresultoptions-blocksize"><code><c- g>blockSize</c-></code></dfn> = 0;
    <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-double" id="ref-for-idl-double②⑧"><c- b>double</c-></a> <dfn class="dfn-paneled idl-code" data-default="0" data-dfn-for="FragmentResultOptions" data-dfn-type="dict-member" data-export data-type="double" id="dom-fragmentresultoptions-autoblocksize"><code><c- g>autoBlockSize</c-></code></dfn> = 0;
    <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#idl-sequence" id="ref-for-idl-sequence①"><c- b>sequence</c-></a>&lt;<a data-link-type="idl-name" href="#layoutfragment" id="ref-for-layoutfragment②⑤"><c- n>LayoutFragment</c-></a>> <dfn class="dfn-paneled idl-code" data-default="[]" data-dfn-for="FragmentResultOptions" data-dfn-type="dict-member" data-export data-type="sequence<LayoutFragment>" id="dom-fragmentresultoptions-childfragments"><code><c- g>childFragments</c-></code></dfn> = [];
    <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-any" id="ref-for-idl-any⑤"><c- b>any</c-></a> <dfn class="dfn-paneled idl-code" data-default="null" data-dfn-for="FragmentResultOptions" data-dfn-type="dict-member" data-export data-type="any" id="dom-fragmentresultoptions-data"><code><c- g>data</c-></code></dfn> = <c- b>null</c->;
    <a data-link-type="idl-name" href="#dictdef-breaktokenoptions" id="ref-for-dictdef-breaktokenoptions"><c- n>BreakTokenOptions</c-></a> <dfn class="dfn-paneled idl-code" data-default="null" data-dfn-for="FragmentResultOptions" data-dfn-type="dict-member" data-export data-type="BreakTokenOptions" id="dom-fragmentresultoptions-breaktoken"><code><c- g>breakToken</c-></code></dfn> = <c- b>null</c->;
};

[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed" id="ref-for-Exposed①①"><c- g>Exposed</c-></a>=<c- n>LayoutWorklet</c->]
<c- b>interface</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="interface" data-export id="fragmentresult"><code><c- g>FragmentResult</c-></code></dfn> {
    <a class="idl-code" data-link-type="constructor" href="#dom-fragmentresult-fragmentresult" id="ref-for-dom-fragmentresult-fragmentresult"><c- g>constructor</c-></a>(<c- b>optional</c-> <a data-link-type="idl-name" href="#dictdef-fragmentresultoptions" id="ref-for-dictdef-fragmentresultoptions②"><c- n>FragmentResultOptions</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="FragmentResult/FragmentResult(options), FragmentResult/constructor(options), FragmentResult/FragmentResult(), FragmentResult/constructor()" data-dfn-type="argument" data-export id="dom-fragmentresult-fragmentresult-options-options"><code><c- g>options</c-></code></dfn> = {});
    <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-double" id="ref-for-idl-double②⑨"><c- b>double</c-></a> <a class="idl-code" data-link-type="attribute" data-readonly data-type="double" href="#dom-fragmentresult-inlinesize" id="ref-for-dom-fragmentresult-inlinesize"><c- g>inlineSize</c-></a>;
    <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-double" id="ref-for-idl-double③⓪"><c- b>double</c-></a> <a class="idl-code" data-link-type="attribute" data-readonly data-type="double" href="#dom-fragmentresult-blocksize" id="ref-for-dom-fragmentresult-blocksize"><c- g>blockSize</c-></a>;
};

<c- b>dictionary</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="dictionary" data-export id="dictdef-intrinsicsizesresultoptions"><code><c- g>IntrinsicSizesResultOptions</c-></code></dfn> {
    <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-double" id="ref-for-idl-double③①"><c- b>double</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="IntrinsicSizesResultOptions" data-dfn-type="dict-member" data-export data-type="double" id="dom-intrinsicsizesresultoptions-maxcontentsize"><code><c- g>maxContentSize</c-></code></dfn>;
    <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-double" id="ref-for-idl-double③②"><c- b>double</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="IntrinsicSizesResultOptions" data-dfn-type="dict-member" data-export data-type="double" id="dom-intrinsicsizesresultoptions-mincontentsize"><code><c- g>minContentSize</c-></code></dfn>;
};
</pre>
   <p>The <code class="idl"><a data-link-type="idl" href="#fragmentresult" id="ref-for-fragmentresult">FragmentResult</a></code> has internal slot(s):</p>
   <ul>
    <li data-md>
     <p><dfn class="dfn-paneled idl-code" data-dfn-for="FragmentResult" data-dfn-type="attribute" data-export id="dom-fragmentresult-box-slot"><code>[[box]]</code></dfn> a CSS <a data-link-type="dfn" href="https://drafts.csswg.org/css-display-3/#box" id="ref-for-box①⑧">box</a>.</p>
    <li data-md>
     <p><dfn class="dfn-paneled idl-code" data-dfn-for="FragmentResult" data-dfn-type="attribute" data-export id="dom-fragmentresult-inline-size-slot"><code>[[inline size]]</code></dfn> the inline size of the resulting
fragment.</p>
    <li data-md>
     <p><dfn class="dfn-paneled idl-code" data-dfn-for="FragmentResult" data-dfn-type="attribute" data-export id="dom-fragmentresult-block-size-slot"><code>[[block size]]</code></dfn> the block size of the resulting
fragment.</p>
    <li data-md>
     <p><dfn class="dfn-paneled idl-code" data-dfn-for="FragmentResult" data-dfn-type="attribute" data-export id="dom-fragmentresult-child-fragments-slot"><code>[[child fragments]]</code></dfn> the list of child fragments.</p>
    <li data-md>
     <p><dfn class="dfn-paneled idl-code" data-dfn-for="FragmentResult" data-dfn-type="attribute" data-export id="dom-fragmentresult-data-slot"><code>[[data]]</code></dfn> some optional serialized data.</p>
    <li data-md>
     <p><dfn class="dfn-paneled idl-code" data-dfn-for="FragmentResult" data-dfn-type="attribute" data-export id="dom-fragmentresult-internal-break-token-slot"><code>[[internal break token]]</code></dfn> an internal representation of
the break information for this fragment.</p>
    <li data-md>
     <p><dfn class="dfn-paneled idl-code" data-dfn-for="FragmentResult" data-dfn-type="attribute" data-export id="dom-fragmentresult-unique-id-slot"><code>[[unique id]]</code></dfn> the <a data-link-type="dfn" href="#layout-api-context-unique-id" id="ref-for-layout-api-context-unique-id⑦">unique id</a> of the current <a data-link-type="dfn" href="#layout-api-context" id="ref-for-layout-api-context⑥">layout api context</a>. This slot is used so that a <code class="idl"><a data-link-type="idl" href="#fragmentresult" id="ref-for-fragmentresult①">FragmentResult</a></code> used outside the
current layout pass is invalid.</p>
   </ul>
   <hr>
   <p>The web developer defined layout method can return either a <code class="idl"><a data-link-type="idl" href="#dictdef-fragmentresultoptions" id="ref-for-dictdef-fragmentresultoptions③">FragmentResultOptions</a></code> or a <code class="idl"><a data-link-type="idl" href="#fragmentresult" id="ref-for-fragmentresult②">FragmentResult</a></code>. The <code class="idl"><a data-link-type="idl" href="#fragmentresult" id="ref-for-fragmentresult③">FragmentResult</a></code> can be used for determining the final size of the
fragment or detecting if the provided <code class="idl"><a data-link-type="idl" href="#dictdef-fragmentresultoptions" id="ref-for-dictdef-fragmentresultoptions④">FragmentResultOptions</a></code> would result in triggering a
fallback to <a data-link-type="dfn" href="https://drafts.csswg.org/css-display-4/#flow-layout" id="ref-for-flow-layout">flow layout</a>.</p>
   <div class="example" id="example-23995455">
    <a class="self-link" href="#example-23995455"></a> This example show the web developer using the <code class="idl"><a data-link-type="idl" href="#fragmentresult" id="ref-for-fragmentresult④">FragmentResult</a></code> instead of just returning the <code class="idl"><a data-link-type="idl" href="#dictdef-fragmentresultoptions" id="ref-for-dictdef-fragmentresultoptions⑤">FragmentResultOptions</a></code> object. 
<pre class="lang-javascript highlight">registerLayout<c- p>(</c-><c- t>'feature-detection'</c-><c- p>,</c-> <c- a>class</c-> <c- p>{</c->
    <c- k>async</c-> layout<c- p>(</c->children<c- p>,</c-> edges<c- p>,</c-> constraints<c- p>,</c-> styleMap<c- p>,</c-> breakToken<c- p>)</c-> <c- p>{</c->

      <c- a>let</c-> result<c- p>;</c->
      <c- k>try</c-> <c- p>{</c->
        result <c- o>=</c-> <c- ow>new</c-> FragmentResult<c- p>({</c->
          childFragments<c- o>:</c-> <c- p>[],</c->
          autoBlockSize<c- o>:</c-> <c- mf>100</c->
        <c- p>});</c->
      <c- p>}</c-> <c- k>catch</c-> <c- p>(</c->e<c- p>)</c-> <c- p>{</c->
        <c- c1>// The above call may throw, if the dictionary was just returned, it</c->
        <c- c1>//  would fallback to flow layout.</c->
      <c- p>}</c->

      <c- c1>// The web developer can test what size the fragment will be.</c->
      result<c- p>.</c->blockSize<c- p>;</c->

      <c- c1>// Instead of returning the dictionary, we can just return this object.</c->
      <c- k>return</c-> result<c- p>;</c->
    <c- p>}</c->
<c- p>}</c->
</pre>
   </div>
   <div class="algorithm" data-algorithm="inlineSize" data-algorithm-for="FragmentResult">
     The <dfn class="dfn-paneled idl-code" data-dfn-for="FragmentResult" data-dfn-type="attribute" data-export id="dom-fragmentresult-inlinesize"><code>inlineSize</code></dfn>, on getting from a <code class="idl"><a data-link-type="idl" href="#fragmentresult" id="ref-for-fragmentresult⑤">FragmentResult</a></code> <var>this</var>,
the user agent must perform the following steps: 
    <ol>
     <li data-md>
      <p>Return <var>this</var>’ <code class="idl"><a data-link-type="idl" href="#dom-fragmentresult-inline-size-slot" id="ref-for-dom-fragmentresult-inline-size-slot">[[inline size]]</a></code> internal slot.</p>
    </ol>
   </div>
   <div class="algorithm" data-algorithm="blockSize" data-algorithm-for="FragmentResult">
     The <dfn class="dfn-paneled idl-code" data-dfn-for="FragmentResult" data-dfn-type="attribute" data-export id="dom-fragmentresult-blocksize"><code>blockSize</code></dfn>, on getting from a <code class="idl"><a data-link-type="idl" href="#fragmentresult" id="ref-for-fragmentresult⑥">FragmentResult</a></code> <var>this</var>,
the user agent must perform the following steps: 
    <ol>
     <li data-md>
      <p>Return <var>this</var>’ <code class="idl"><a data-link-type="idl" href="#dom-fragmentresult-block-size-slot" id="ref-for-dom-fragmentresult-block-size-slot">[[block size]]</a></code> internal slot.</p>
    </ol>
   </div>
   <div class="algorithm" data-algorithm="FragmentResult(options)" data-algorithm-for="FragmentResult">
     When the <dfn class="dfn-paneled idl-code" data-dfn-for="FragmentResult" data-dfn-type="constructor" data-export data-lt="FragmentResult(options)|constructor(options)|FragmentResult()|constructor()" id="dom-fragmentresult-fragmentresult"><code>FragmentResult(<var>options</var>)</code></dfn> constructor is called,
the user agent must perform the following steps: 
    <ol>
     <li data-md>
      <p>Let <var>context</var> be the <a data-link-type="dfn" href="#current-layout" id="ref-for-current-layout②④">current layout’s</a> <a data-link-type="dfn" href="#layout-api-context" id="ref-for-layout-api-context⑦">layout API context</a>.</p>
     <li data-md>
      <p>Return the result of <a data-link-type="dfn" href="#construct-a-fragment-result" id="ref-for-construct-a-fragment-result">construct a fragment result</a> given <var>context</var>, and <var>options</var>.</p>
    </ol>
   </div>
   <p class="note" role="note"><span class="marker">Note:</span> The <a data-link-type="dfn" href="#construct-a-fragment-result" id="ref-for-construct-a-fragment-result①">construct a fragment result</a> algorithm performs a series of validation checks (the
    web developer isn’t using an object from a previous invocation, and determines the final size of
    the resulting fragment.</p>
   <div class="algorithm" data-algorithm="construct a fragment result">
     When the user agent wants to <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="construct-a-fragment-result">construct a fragment result</dfn> given <var>context</var>, and <var>options</var> the user agent must perform the following steps: 
    <ol>
     <li data-md>
      <p>Let <var>uniqueId</var> be <var>context</var>’s <a data-link-type="dfn" href="#layout-api-context-unique-id" id="ref-for-layout-api-context-unique-id⑧">unique id</a>.</p>
     <li data-md>
      <p>Let <var>box</var> be the <a data-link-type="dfn" href="#current-layout" id="ref-for-current-layout②⑤">current layout’s</a> <a data-link-type="dfn" href="https://drafts.csswg.org/css-display-3/#box" id="ref-for-box①⑨">box</a>.</p>
     <li data-md>
      <p>Let <var>breakTokenOptions</var> be <var>options</var>’s <code class="idl"><a data-link-type="idl" href="#dom-fragmentresultoptions-breaktoken" id="ref-for-dom-fragmentresultoptions-breaktoken">breakToken</a></code>.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-iterate" id="ref-for-list-iterate">For each</a> <var>childFragment</var> in <var>options</var>’s <code class="idl"><a data-link-type="idl" href="#dom-fragmentresultoptions-childfragments" id="ref-for-dom-fragmentresultoptions-childfragments②">childFragments</a></code>,
perform the following stubsteps:</p>
      <ol>
       <li data-md>
        <p>If <var>childFragment</var>’s <code class="idl"><a data-link-type="idl" href="#dom-layoutfragment-unique-id-slot" id="ref-for-dom-layoutfragment-unique-id-slot">[[unique id]]</a></code> internal slot is not equal to <var>uniqueId</var>, then <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#dfn-throw" id="ref-for-dfn-throw⑥">throw</a> a <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#sec-native-error-types-used-in-this-standard-typeerror" id="ref-for-sec-native-error-types-used-in-this-standard-typeerror②">TypeError</a>, and abort all these steps.</p>
      </ol>
     <li data-md>
      <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-iterate" id="ref-for-list-iterate①">For each</a> <var>childBreakToken</var> in <var>breakTokenOptions</var>’s <code class="idl"><a data-link-type="idl" href="#dom-breaktokenoptions-childbreaktokens" id="ref-for-dom-breaktokenoptions-childbreaktokens">childBreakTokens</a></code>, perform the following stubsteps:</p>
      <ol>
       <li data-md>
        <p>If <var>childBreakToken</var>’s <code class="idl"><a data-link-type="idl" href="#dom-childbreaktoken-unique-id-slot" id="ref-for-dom-childbreaktoken-unique-id-slot①">[[unique id]]</a></code> internal slot is not equal to <var>uniqueId</var>, then <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#dfn-throw" id="ref-for-dfn-throw⑦">throw</a> a <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#sec-native-error-types-used-in-this-standard-typeerror" id="ref-for-sec-native-error-types-used-in-this-standard-typeerror③">TypeError</a>, and abort all these steps.</p>
      </ol>
     <li data-md>
      <p>If <var>sizingMode</var> is <code>"block-like"</code>:</p>
      <ul>
       <li data-md>
        <p>Then:</p>
        <ol>
         <li data-md>
          <p>Let <var>inlineSize</var> be the result of calculating <var>box</var>’s <b>border-box</b> <a data-link-type="dfn" href="https://drafts.csswg.org/css-writing-modes-4/#inline-size" id="ref-for-inline-size②">inline size</a> (relative to <var>box</var>’s writing mode) exactly like block containers do.</p>
         <li data-md>
          <p>Let <var>blockSize</var> be the result of calculating <var>box</var>’s <b>border-box</b> <a data-link-type="dfn" href="https://drafts.csswg.org/css-writing-modes-4/#block-size" id="ref-for-block-size④">block size</a> (relative to <var>box</var>’s writing mode) exactly like block containers do,
given <var>fragment</var>’s <code class="idl"><a data-link-type="idl" href="#dom-fragmentresultoptions-autoblocksize" id="ref-for-dom-fragmentresultoptions-autoblocksize">autoBlockSize</a></code> as the "intrinsic
block size".</p>
        </ol>
       <li data-md>
        <p>Otherwise (<var>sizingMode</var> is <code>"manual"</code>):</p>
        <ol>
         <li data-md>
          <p>Let <var>inlineSize</var> be <var>fragment</var>’s <code class="idl"><a data-link-type="idl" href="#dom-fragmentresultoptions-inlinesize" id="ref-for-dom-fragmentresultoptions-inlinesize">inlineSize</a></code>.</p>
         <li data-md>
          <p>Let <var>blockSize</var> be <var>fragment</var>’s <code class="idl"><a data-link-type="idl" href="#dom-fragmentresultoptions-blocksize" id="ref-for-dom-fragmentresultoptions-blocksize">blockSize</a></code>.</p>
        </ol>
      </ul>
     <li data-md>
      <p>Let <var>clonedData</var> be the result of invoking <a data-link-type="dfn" href="https://html.spec.whatwg.org/#structuredserializeforstorage" id="ref-for-structuredserializeforstorage①">StructuredSerializeForStorage</a> on <var>options</var>’s <code class="idl"><a data-link-type="idl" href="#dom-fragmentresultoptions-data" id="ref-for-dom-fragmentresultoptions-data①">data</a></code>.</p>
     <li data-md>
      <p>Let <var>clonedBreakTokenData</var> be the result of invoking <a data-link-type="dfn" href="https://html.spec.whatwg.org/#structuredserializeforstorage" id="ref-for-structuredserializeforstorage②">StructuredSerializeForStorage</a> on <var>breakTokenOptions</var>’s <code class="idl"><a data-link-type="idl" href="#dom-breaktokenoptions-data" id="ref-for-dom-breaktokenoptions-data">data</a></code>.</p>
     <li data-md>
      <p>Let <var>internalBreakToken</var> be the internal representation of the <a data-link-type="dfn" href="https://drafts.csswg.org/css-break-4/#fragmentation-break" id="ref-for-fragmentation-break">fragmentation break</a> containing <var>clonedBreakTokenData</var>, and <var>breakTokenOptions</var>.</p>
     <li data-md>
      <p>Return a new <code class="idl"><a data-link-type="idl" href="#fragmentresult" id="ref-for-fragmentresult⑦">FragmentResult</a></code> with:</p>
      <ul>
       <li data-md>
        <p><code class="idl"><a data-link-type="idl" href="#dom-fragmentresult-box-slot" id="ref-for-dom-fragmentresult-box-slot">[[box]]</a></code> being <var>box</var>.</p>
       <li data-md>
        <p><code class="idl"><a data-link-type="idl" href="#dom-fragmentresult-inline-size-slot" id="ref-for-dom-fragmentresult-inline-size-slot①">[[inline size]]</a></code> being <var>inlineSize</var>.</p>
       <li data-md>
        <p><code class="idl"><a data-link-type="idl" href="#dom-fragmentresult-block-size-slot" id="ref-for-dom-fragmentresult-block-size-slot①">[[block size]]</a></code> being <var>blockSize</var>.</p>
       <li data-md>
        <p><code class="idl"><a data-link-type="idl" href="#dom-fragmentresult-child-fragments-slot" id="ref-for-dom-fragmentresult-child-fragments-slot">[[child fragments]]</a></code> being <var>options</var>’s <code class="idl"><a data-link-type="idl" href="#dom-fragmentresultoptions-childfragments" id="ref-for-dom-fragmentresultoptions-childfragments③">childFragments</a></code>.</p>
       <li data-md>
        <p><code class="idl"><a data-link-type="idl" href="#dom-fragmentresult-data-slot" id="ref-for-dom-fragmentresult-data-slot">[[data]]</a></code> being <var>clonedData</var>.</p>
       <li data-md>
        <p><code class="idl"><a data-link-type="idl" href="#dom-fragmentresult-internal-break-token-slot" id="ref-for-dom-fragmentresult-internal-break-token-slot">[[internal break token]]</a></code> being <var>internalBreakToken</var>.</p>
       <li data-md>
        <p><code class="idl"><a data-link-type="idl" href="#dom-fragmentresult-unique-id-slot" id="ref-for-dom-fragmentresult-unique-id-slot">[[unique id]]</a></code> being <var>uniqueId</var>.</p>
      </ul>
    </ol>
   </div>
   <h4 class="heading settled" data-level="6.2.1" id="determining-intrinsic-sizes"><span class="secno">6.2.1. </span><span class="content">Determining Intrinsic Sizes</span><a class="self-link" href="#determining-intrinsic-sizes"></a></h4>
   <p>The <a data-link-type="dfn" href="#determine-the-intrinsic-sizes" id="ref-for-determine-the-intrinsic-sizes①">determine the intrinsic sizes</a> algorithm defines how a user agent is to query the author
defined layout for a <a data-link-type="dfn" href="https://drafts.csswg.org/css-display-3/#box" id="ref-for-box②⓪">box’s</a> <a data-link-type="dfn" href="https://drafts.csswg.org/css-sizing-3/#intrinsic-size" id="ref-for-intrinsic-size">intrinsic sizes</a> information.</p>
   <p class="note" role="note"><span class="marker">Note:</span> The <a data-link-type="dfn" href="#determine-the-intrinsic-sizes" id="ref-for-determine-the-intrinsic-sizes②">determine the intrinsic sizes</a> algorithm allows for user agents to cache an arbitrary
    number of previous invocations to reuse.</p>
   <div class="algorithm" data-algorithm="determine the intrinsic sizes">
     When the user agent wants to <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="determine-the-intrinsic-sizes">determine the intrinsic sizes</dfn> of a <a data-link-type="dfn" href="#layout-api-formatting-context" id="ref-for-layout-api-formatting-context">layout API formatting context</a> for a given <var>box</var>, <var>childBoxes</var> it <em>must</em> run the following steps: 
    <ol>
     <li data-md>
      <p>Let <var>layoutFunction</var> be the <a class="css" data-link-type="maybe" href="#valdef-display-layout" id="ref-for-valdef-display-layout⑤">layout()</a> for the <a data-link-type="dfn" href="https://drafts.csswg.org/css-cascade-5/#computed-value" id="ref-for-computed-value⑦">computed value</a> of <a class="production css" data-link-type="type" href="https://drafts.csswg.org/css-display-4/#typedef-display-inside" id="ref-for-typedef-display-inside②">&lt;display-inside></a> for <var>box</var>.</p>
     <li data-md>
      <p>Let <var>name</var> be the first argument of the <var>layoutFunction</var>.</p>
     <li data-md>
      <p>Let <var>documentDefinition</var> be the result of <a data-link-type="dfn" href="#get-a-document-layout-definition" id="ref-for-get-a-document-layout-definition">get a document layout definition</a> given <var>name</var>.</p>
      <p>If <a data-link-type="dfn" href="#get-a-document-layout-definition" id="ref-for-get-a-document-layout-definition①">get a document layout definition</a> returned failure, or if <var>documentDefinition</var> is <code>"invalid"</code>, then let <var>box</var> fallback to the <a data-link-type="dfn" href="https://drafts.csswg.org/css-display-4/#flow-layout" id="ref-for-flow-layout①">flow layout</a> and abort all these
steps.</p>
     <li data-md>
      <p>Let <var>workletGlobalScope</var> be a <code class="idl"><a data-link-type="idl" href="#layoutworkletglobalscope" id="ref-for-layoutworkletglobalscope⑧">LayoutWorkletGlobalScope</a></code> from the layout <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/worklets.html#worklet" id="ref-for-worklet③">Worklet</a></code>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/worklets.html#concept-worklet-global-scopes" id="ref-for-concept-worklet-global-scopes">global scopes</a>, following the rules defined in <a href="#global-scope-selection">§ 6.2.3 Global Scope Selection</a>.</p>
      <p>The user agent <em>may</em> also <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/worklets.html#create-a-worklet-global-scope" id="ref-for-create-a-worklet-global-scope">create a worklet global scope</a> at this time, given the
layout <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/worklets.html#worklet" id="ref-for-worklet④">Worklet</a></code>.</p>
     <li data-md>
      <p>Run <a data-link-type="dfn" href="#invoke-an-intrinsic-sizes-callback" id="ref-for-invoke-an-intrinsic-sizes-callback">invoke an intrinsic sizes callback</a> given <var>name</var>, <var>box</var>, <var>childBoxes</var>, and <var>workletGlobalScope</var> optionally <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel" id="ref-for-in-parallel">in parallel</a>.</p>
      <p class="note" role="note"><span class="marker">Note:</span> If the user agent runs <a data-link-type="dfn" href="#invoke-an-intrinsic-sizes-callback" id="ref-for-invoke-an-intrinsic-sizes-callback①">invoke an intrinsic sizes callback</a> on a thread <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel" id="ref-for-in-parallel①">in parallel</a>, it should select a layout worklet global scope which can be used on that
    thread.</p>
    </ol>
   </div>
   <div class="algorithm" data-algorithm="invoke an intrinsic sizes callback">
     When the user agent wants to <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="invoke-an-intrinsic-sizes-callback">invoke an intrinsic sizes callback</dfn> given <var>name</var>, <var>box</var>, <var>childBoxes</var>, and <var>workletGlobalScope</var>, it <em>must</em> run the following steps: 
    <ol>
     <li data-md>
      <p>Let <var>definition</var> be the result of <a data-link-type="dfn" href="#get-a-layout-definition" id="ref-for-get-a-layout-definition③">get a layout definition</a> given <var>name</var>, and <var>workletGlobalScope</var>.</p>
      <p>If <a data-link-type="dfn" href="#get-a-layout-definition" id="ref-for-get-a-layout-definition④">get a layout definition</a> returned failure, let the <var>box</var> fallback to the <a data-link-type="dfn" href="https://drafts.csswg.org/css-display-4/#flow-layout" id="ref-for-flow-layout②">flow layout</a> and abort all these steps.</p>
     <li data-md>
      <p>Let <var>layoutInstance</var> be the result of <a data-link-type="dfn" href="#get-a-layout-class-instance" id="ref-for-get-a-layout-class-instance">get a layout class instance</a> given <var>box</var>, <var>definition</var>, <var>workletGlobalScope</var>.</p>
      <p>If <a data-link-type="dfn" href="#get-a-layout-class-instance" id="ref-for-get-a-layout-class-instance①">get a layout class instance</a> returned failure, let the <var>box</var> fallback to the <a data-link-type="dfn" href="https://drafts.csswg.org/css-display-4/#flow-layout" id="ref-for-flow-layout③">flow layout</a> and abort all these steps.</p>
     <li data-md>
      <p>Let <var>inputProperties</var> be <var>definition</var>’s <a data-link-type="dfn" href="#layout-definition-input-properties" id="ref-for-layout-definition-input-properties①">input properties</a>.</p>
     <li data-md>
      <p>Let <var>children</var> be a new <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list⑥">list</a>.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-iterate" id="ref-for-list-iterate②">For each</a> <var>childBox</var> in <var>childBoxes</var> perform the following substeps:</p>
      <ol>
       <li data-md>
        <p>Let <var>layoutChild</var> be the result of <a data-link-type="dfn" href="#get-a-layout-child" id="ref-for-get-a-layout-child①">get a layout child</a> given <var>workletGlobalScope</var>, <var>name</var>, <var>childBox</var>, and <var>context</var>’s <a data-link-type="dfn" href="#layout-api-context-unique-id" id="ref-for-layout-api-context-unique-id⑨">unique id</a>.</p>
       <li data-md>
        <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-append" id="ref-for-list-append②">Append</a> <var>layoutChild</var> to <var>children</var>.</p>
      </ol>
     <li data-md>
      <p>Let <var>edges</var> be a new <code class="idl"><a data-link-type="idl" href="#layoutedges" id="ref-for-layoutedges④">LayoutEdges</a></code> populated with the <a data-link-type="dfn" href="https://drafts.csswg.org/css-cascade-5/#computed-value" id="ref-for-computed-value⑧">computed value</a> for all the <a data-link-type="dfn" href="https://www.w3.org/TR/CSS21/box.html#box-dimensions" id="ref-for-box-dimensions①">box model edges</a> for <var>box</var>.</p>
     <li data-md>
      <p>Let <var>styleMap</var> be the result of <a data-link-type="dfn" href="#get-a-style-map" id="ref-for-get-a-style-map">get a style map</a> given <var>box</var>, and <var>inputProperties</var>.</p>
     <li data-md>
      <p>At this stage the user agent may re-use the <a data-link-type="dfn" href="https://drafts.csswg.org/css-sizing-3/#intrinsic-size" id="ref-for-intrinsic-size①">intrinsic sizes</a> from a previous invocation if <var>children</var>, <var>edges</var>, and <var>styleMap</var> are equivalent to that previous invocation. If so let
the intrinsic sizes the cached intrinsic sizes and abort all these steps.</p>
     <li data-md>
      <p>Let <var>context</var> be the result of <a data-link-type="dfn" href="#create-a-layout-api-context" id="ref-for-create-a-layout-api-context">create a layout API context</a> given <code>"intrinsic-sizes"</code>.</p>
     <li data-md>
      <p>Let <var>intrinsicSizesFunction</var> be <var>definition</var>’s <a data-link-type="dfn" href="#layout-definition-intrinsic-sizes-function" id="ref-for-layout-definition-intrinsic-sizes-function①">intrinsic sizes function</a>.</p>
     <li data-md>
      <p>Let <var>value</var> be the result of <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#invoke-a-callback-function" id="ref-for-invoke-a-callback-function">Invoke</a>(<var>intrinsicSizesFunction</var>, <var>layoutInstance</var>,
    «<var>children</var>, <var>edges</var>, <var>styleMap</var>»).</p>
      <p>If an exception is <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#dfn-throw" id="ref-for-dfn-throw⑧">thrown</a> the let <var>box</var> fallback to the <a data-link-type="dfn" href="https://drafts.csswg.org/css-display-4/#flow-layout" id="ref-for-flow-layout④">flow layout</a> and abort all
these steps.</p>
     <li data-md>
      <p>If <var>value</var> is a promise:</p>
      <ul>
       <li data-md>
        <p>Then:</p>
        <ol>
         <li data-md>
          <p>Let <var>intrinsicSizesValue</var> be the result of <a data-link-type="dfn" href="#run-a-work-queue" id="ref-for-run-a-work-queue">run a work queue</a> given <var>value</var>, and <var>context</var>’s <a data-link-type="dfn" href="#layout-api-context-work-queue" id="ref-for-layout-api-context-work-queue③">work queue</a>.</p>
          <p>If <a data-link-type="dfn" href="#run-a-work-queue" id="ref-for-run-a-work-queue①">run a work queue</a> returns failure, let the <var>box</var> fallback to the <a data-link-type="dfn" href="https://drafts.csswg.org/css-display-4/#flow-layout" id="ref-for-flow-layout⑤">flow layout</a> and abort all these steps.</p>
        </ol>
       <li data-md>
        <p>Otherwise:</p>
        <ol>
         <li data-md>
          <p>Let <var>intrinsicSizesValue</var> be <var>value</var>.</p>
        </ol>
      </ul>
     <li data-md>
      <p>Let <var>intrinsicSizes</var> be the result of <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#javascript-string-convert" id="ref-for-javascript-string-convert⑤">converting</a> <var>intrinsicSizesValue</var> to a <code class="idl"><a data-link-type="idl" href="#dictdef-intrinsicsizesresultoptions" id="ref-for-dictdef-intrinsicsizesresultoptions">IntrinsicSizesResultOptions</a></code>. If an exception is <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#dfn-throw" id="ref-for-dfn-throw⑨">thrown</a>, let <var>box</var> fallback to the <a data-link-type="dfn" href="https://drafts.csswg.org/css-display-4/#flow-layout" id="ref-for-flow-layout⑥">flow layout</a> and abort all these steps.</p>
     <li data-md>
      <p>Set the <a data-link-type="dfn" href="https://drafts.csswg.org/css-sizing-3/#intrinsic-size" id="ref-for-intrinsic-size②">intrinsic sizes</a> of <var>box</var>:</p>
      <ul>
       <li data-md>
        <p>Let <var>intrinsicSizes</var>’s <code class="idl"><a data-link-type="idl" href="#dom-intrinsicsizesresultoptions-mincontentsize" id="ref-for-dom-intrinsicsizesresultoptions-mincontentsize">minContentSize</a></code> be the <a data-link-type="dfn" href="https://drafts.csswg.org/css-sizing-3/#min-content" id="ref-for-min-content①">min-content size</a> of <var>box</var>.</p>
       <li data-md>
        <p>Let <var>intrinsicSizes</var>’s <code class="idl"><a data-link-type="idl" href="#dom-intrinsicsizesresultoptions-maxcontentsize" id="ref-for-dom-intrinsicsizesresultoptions-maxcontentsize">maxContentSize</a></code> be the <a data-link-type="dfn" href="https://drafts.csswg.org/css-sizing-3/#max-content" id="ref-for-max-content①">max-content size</a> of <var>box</var>.</p>
      </ul>
    </ol>
   </div>
   <h4 class="heading settled" data-level="6.2.2" id="generating-fragments"><span class="secno">6.2.2. </span><span class="content">Generating Fragments</span><a class="self-link" href="#generating-fragments"></a></h4>
   <p>The <a data-link-type="dfn" href="#generate-a-fragment" id="ref-for-generate-a-fragment①">generate a fragment</a> algorithm defines how a user agent is to generate a <a data-link-type="dfn" href="https://drafts.csswg.org/css-display-3/#box" id="ref-for-box②①">box’s</a> <a data-link-type="dfn" href="https://drafts.csswg.org/css-break-3/#fragment" id="ref-for-fragment④">fragment</a> for an author defined layout.</p>
   <p class="note" role="note"><span class="marker">Note:</span> The <a data-link-type="dfn" href="#generate-a-fragment" id="ref-for-generate-a-fragment②">generate a fragment</a> algorithm allows for user agents to cache an arbitrary number of
    previous invocations to reuse.</p>
   <div class="algorithm" data-algorithm="generate a fragment">
     When the user agent wants to <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="generate-a-fragment">generate a fragment</dfn> of a <a data-link-type="dfn" href="#layout-api-formatting-context" id="ref-for-layout-api-formatting-context①">layout API formatting context</a> for a given <var>box</var>, <var>childBoxes</var>, <var>internalLayoutConstraints</var>, and an optional <var>internalBreakToken</var> it <em>must</em> run the following steps: 
    <ol>
     <li data-md>
      <p>Let <var>layoutFunction</var> be the <a class="css" data-link-type="maybe" href="#valdef-display-layout" id="ref-for-valdef-display-layout⑥">layout()</a> for the <a data-link-type="dfn" href="https://drafts.csswg.org/css-cascade-5/#computed-value" id="ref-for-computed-value⑨">computed value</a> of <a class="production css" data-link-type="type" href="https://drafts.csswg.org/css-display-4/#typedef-display-inside" id="ref-for-typedef-display-inside③">&lt;display-inside></a> for <var>box</var>.</p>
     <li data-md>
      <p>Let <var>name</var> be the first argument of the <var>layoutFunction</var>.</p>
     <li data-md>
      <p>Let <var>documentDefinition</var> be the result of <a data-link-type="dfn" href="#get-a-document-layout-definition" id="ref-for-get-a-document-layout-definition②">get a document layout definition</a> given <var>name</var>.</p>
      <p>If <a data-link-type="dfn" href="#get-a-document-layout-definition" id="ref-for-get-a-document-layout-definition③">get a document layout definition</a> returned failure, or if <var>documentDefinition</var> is <code>"invalid"</code>, then let <var>box</var> fallback to the <a data-link-type="dfn" href="https://drafts.csswg.org/css-display-4/#flow-layout" id="ref-for-flow-layout⑦">flow layout</a> and abort all these
steps.</p>
     <li data-md>
      <p>Let <var>workletGlobalScope</var> be a <code class="idl"><a data-link-type="idl" href="#layoutworkletglobalscope" id="ref-for-layoutworkletglobalscope⑨">LayoutWorkletGlobalScope</a></code> from the layout <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/worklets.html#worklet" id="ref-for-worklet⑤">Worklet</a></code>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/worklets.html#concept-worklet-global-scopes" id="ref-for-concept-worklet-global-scopes①">global scopes</a>, following the rules defined in <a href="#global-scope-selection">§ 6.2.3 Global Scope Selection</a>.</p>
      <p>The user agent <em>may</em> also <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/worklets.html#create-a-worklet-global-scope" id="ref-for-create-a-worklet-global-scope①">create a worklet global scope</a> at this time, given the
layout <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/worklets.html#worklet" id="ref-for-worklet⑥">Worklet</a></code>.</p>
     <li data-md>
      <p>Run <a data-link-type="dfn" href="#invoke-a-layout-callback" id="ref-for-invoke-a-layout-callback">invoke a layout callback</a> given <var>name</var>, <var>box</var>, <var>childBoxes</var>, <var>internalLayoutConstraints</var>, <var>internalBreakToken</var>, and <var>workletGlobalScope</var> optionally <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel" id="ref-for-in-parallel②">in parallel</a>.</p>
      <p class="note" role="note"><span class="marker">Note:</span> If the user agent runs <a data-link-type="dfn" href="#invoke-a-layout-callback" id="ref-for-invoke-a-layout-callback①">invoke a layout callback</a> on a thread <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel" id="ref-for-in-parallel③">in parallel</a>, it
    should select a layout worklet global scope which can be used on that thread.</p>
    </ol>
   </div>
   <div class="algorithm" data-algorithm="invoke a layout callback">
     When the user agent wants to <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="invoke-a-layout-callback">invoke a layout callback</dfn> given <var>name</var>, <var>box</var>, <var>childBoxes</var>, <var>internalLayoutConstraints</var>, <var>internalBreakToken</var>, and <var>workletGlobalScope</var>, it <em>must</em> run the
following steps: 
    <ol>
     <li data-md>
      <p>Let <var>definition</var> be the result of <a data-link-type="dfn" href="#get-a-layout-definition" id="ref-for-get-a-layout-definition⑤">get a layout definition</a> given <var>name</var>, and <var>workletGlobalScope</var>.</p>
      <p>If <a data-link-type="dfn" href="#get-a-layout-definition" id="ref-for-get-a-layout-definition⑥">get a layout definition</a> returned failure, let the <var>box</var> fallback to the <a data-link-type="dfn" href="https://drafts.csswg.org/css-display-4/#flow-layout" id="ref-for-flow-layout⑧">flow layout</a> and abort all these steps.</p>
     <li data-md>
      <p>Let <var>layoutInstance</var> be the result of <a data-link-type="dfn" href="#get-a-layout-class-instance" id="ref-for-get-a-layout-class-instance②">get a layout class instance</a> given <var>box</var>, <var>definition</var>, <var>workletGlobalScope</var>.</p>
      <p>If <a data-link-type="dfn" href="#get-a-layout-class-instance" id="ref-for-get-a-layout-class-instance③">get a layout class instance</a> returned failure, let the <var>box</var> fallback to the <a data-link-type="dfn" href="https://drafts.csswg.org/css-display-4/#flow-layout" id="ref-for-flow-layout⑨">flow layout</a> and abort all these steps.</p>
     <li data-md>
      <p>Let <var>context</var> be the result of <a data-link-type="dfn" href="#create-a-layout-api-context" id="ref-for-create-a-layout-api-context①">create a layout API context</a> given <code>"layout"</code>.</p>
     <li data-md>
      <p>Let <var>sizingMode</var> be <var>definition</var>’s <a data-link-type="dfn" href="#layout-definition-layout-options" id="ref-for-layout-definition-layout-options①">layout options</a>' <code class="idl"><a data-link-type="idl" href="#dom-layoutoptions-sizing" id="ref-for-dom-layoutoptions-sizing④">sizing</a></code> property.</p>
     <li data-md>
      <p>Let <var>inputProperties</var> be <var>definition</var>’s <a data-link-type="dfn" href="#layout-definition-input-properties" id="ref-for-layout-definition-input-properties②">input properties</a>.</p>
     <li data-md>
      <p>Let <var>children</var> be a new <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list⑦">list</a>.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-iterate" id="ref-for-list-iterate③">For each</a> <var>childBox</var> in <var>childBoxes</var> perform the following substeps:</p>
      <ol>
       <li data-md>
        <p>Let <var>layoutChild</var> be the result of <a data-link-type="dfn" href="#get-a-layout-child" id="ref-for-get-a-layout-child②">get a layout child</a> given <var>workletGlobalScope</var>, <var>name</var>, <var>childBox</var>, and <var>context</var>’s <a data-link-type="dfn" href="#layout-api-context-unique-id" id="ref-for-layout-api-context-unique-id①⓪">unique id</a>.</p>
       <li data-md>
        <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-append" id="ref-for-list-append③">Append</a> <var>layoutChild</var> to <var>children</var>.</p>
      </ol>
     <li data-md>
      <p>Let <var>edges</var> be a new <code class="idl"><a data-link-type="idl" href="#layoutedges" id="ref-for-layoutedges⑤">LayoutEdges</a></code> populated with the <a data-link-type="dfn" href="https://drafts.csswg.org/css-cascade-5/#computed-value" id="ref-for-computed-value①⓪">computed value</a> for all the <a data-link-type="dfn" href="https://www.w3.org/TR/CSS21/box.html#box-dimensions" id="ref-for-box-dimensions②">box model edges</a> for <var>box</var>.</p>
     <li data-md>
      <p>Let <var>layoutConstraints</var> be the result of <a data-link-type="dfn" href="#create-a-layout-constraints-object" id="ref-for-create-a-layout-constraints-object①">create a layout constraints object</a> given <var>internalLayoutConstraints</var>, <var>box</var>, and <var>sizingMode</var>.</p>
     <li data-md>
      <p>Let <var>styleMap</var> be the result of <a data-link-type="dfn" href="#get-a-style-map" id="ref-for-get-a-style-map①">get a style map</a> given <var>box</var>, and <var>inputProperties</var>.</p>
     <li data-md>
      <p>Let <var>breakToken</var> be a new <code class="idl"><a data-link-type="idl" href="#breaktoken" id="ref-for-breaktoken">BreakToken</a></code> populated with the appropriate information from <var>internalBreakToken</var>.</p>
      <p>If <var>internalBreakToken</var> is null, let <var>breakToken</var> be null.</p>
     <li data-md>
      <p>At this stage the user agent may re-use a <a data-link-type="dfn" href="https://drafts.csswg.org/css-break-3/#fragment" id="ref-for-fragment⑤">fragment</a> from a previous invocation if <var>children</var>, <var>styleMap</var>, <var>layoutConstraints</var>, <var>breakToken</var> are equivalent to that previous
invocation. If so let the fragment output be that cached fragment and abort all these steps.</p>
     <li data-md>
      <p>Let <var>layoutFunction</var> be <var>definition</var>’s <a data-link-type="dfn" href="#layout-definition-layout-function" id="ref-for-layout-definition-layout-function①">layout function</a>.</p>
     <li data-md>
      <p>Let <var>value</var> be the result of <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#invoke-a-callback-function" id="ref-for-invoke-a-callback-function①">Invoke</a>(<var>layoutFunction</var>, <var>layoutInstance</var>, «<var>children</var>, <var>edges</var>, <var>layoutConstraints</var>, <var>styleMap</var>, <var>breakToken</var>»).</p>
      <p>If an exception is <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#dfn-throw" id="ref-for-dfn-throw①⓪">thrown</a> the let <var>box</var> fallback to the <a data-link-type="dfn" href="https://drafts.csswg.org/css-display-4/#flow-layout" id="ref-for-flow-layout①⓪">flow layout</a> and abort all
these steps.</p>
     <li data-md>
      <p>If <var>value</var> is a promise:</p>
      <ul>
       <li data-md>
        <p>Then:</p>
        <ol>
         <li data-md>
          <p>Let <var>fragmentResultValue</var> be the result of <a data-link-type="dfn" href="#run-a-work-queue" id="ref-for-run-a-work-queue②">run a work queue</a> given <var>value</var>.</p>
          <p>If <a data-link-type="dfn" href="#run-a-work-queue" id="ref-for-run-a-work-queue③">run a work queue</a> returns failure, let the <var>box</var> fallback to the <a data-link-type="dfn" href="https://drafts.csswg.org/css-display-4/#flow-layout" id="ref-for-flow-layout①①">flow layout</a> and abort all these steps.</p>
        </ol>
       <li data-md>
        <p>Otherwise:</p>
        <ol>
         <li data-md>
          <p>Let <var>fragmentResultValue</var> be <var>value</var>.</p>
        </ol>
      </ul>
     <li data-md>
      <p>If <var>fragmentResultValue</var> is a <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#dfn-platform-object" id="ref-for-dfn-platform-object">platform object</a>:</p>
      <ul>
       <li data-md>
        <p>Then:</p>
        <ol>
         <li data-md>
          <p>Let <var>fragmentResult</var> be the result <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#javascript-string-convert" id="ref-for-javascript-string-convert⑥">converting</a> <var>fragmentResultValue</var> to a <code class="idl"><a data-link-type="idl" href="#fragmentresult" id="ref-for-fragmentresult⑧">FragmentResult</a></code>.</p>
          <p>If an exception is <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#dfn-throw" id="ref-for-dfn-throw①①">thrown</a>, let <var>box</var> fallback to the <a data-link-type="dfn" href="https://drafts.csswg.org/css-display-4/#flow-layout" id="ref-for-flow-layout①②">flow layout</a> and abort all
these steps.</p>
        </ol>
       <li data-md>
        <p>Otherwise:</p>
        <ol>
         <li data-md>
          <p>Let <var>fragmentResultOptions</var> be the result of <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#javascript-string-convert" id="ref-for-javascript-string-convert⑦">converting</a> <var>fragmentResultValue</var> to
a <code class="idl"><a data-link-type="idl" href="#dictdef-fragmentresultoptions" id="ref-for-dictdef-fragmentresultoptions⑥">FragmentResultOptions</a></code>.</p>
          <p>If an exception is <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#dfn-throw" id="ref-for-dfn-throw①②">thrown</a>, let <var>box</var> fallback to the <a data-link-type="dfn" href="https://drafts.csswg.org/css-display-4/#flow-layout" id="ref-for-flow-layout①③">flow layout</a> and abort
all these steps.</p>
         <li data-md>
          <p>Let <var>fragmentResult</var> be the result of <a data-link-type="dfn" href="#construct-a-fragment-result" id="ref-for-construct-a-fragment-result②">construct a fragment result</a> given <var>fragmentResultOptions</var>.</p>
          <p>If an exception is <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#dfn-throw" id="ref-for-dfn-throw①③">thrown</a>, let <var>box</var> fallback to the <a data-link-type="dfn" href="https://drafts.csswg.org/css-display-4/#flow-layout" id="ref-for-flow-layout①④">flow layout</a> and abort
all these steps.</p>
        </ol>
      </ul>
     <li data-md>
      <p>Return an internal representation of a <a data-link-type="dfn" href="https://drafts.csswg.org/css-break-3/#fragment" id="ref-for-fragment⑥">fragment</a> with:</p>
      <ul>
       <li data-md>
        <p>The <a data-link-type="dfn" href="https://drafts.csswg.org/css-writing-modes-4/#inline-size" id="ref-for-inline-size③">inline size</a> set to <var>fragmentResult</var>’s <code class="idl"><a data-link-type="idl" href="#dom-fragmentresult-inline-size-slot" id="ref-for-dom-fragmentresult-inline-size-slot②">[[inline size]]</a></code>.</p>
       <li data-md>
        <p>The <a data-link-type="dfn" href="https://drafts.csswg.org/css-writing-modes-4/#block-size" id="ref-for-block-size⑤">block size</a> set to <var>fragmentResult</var>’s <code class="idl"><a data-link-type="idl" href="#dom-fragmentresult-inline-size-slot" id="ref-for-dom-fragmentresult-inline-size-slot③">[[inline size]]</a></code>.</p>
       <li data-md>
        <p>The child fragments set to <var>fragmentResult</var>’s <code class="idl"><a data-link-type="idl" href="#dom-fragmentresult-child-fragments-slot" id="ref-for-dom-fragmentresult-child-fragments-slot①">[[child fragments]]</a></code>.</p>
        <p>The ordering <em>is</em> important as this dictates their paint order (described in <a href="#layout-api-containers">§ 2 Layout API Containers</a>). Their position relative to the <b>border box</b> of the
fragment should be based off the author specified <code class="idl"><a data-link-type="idl" href="#dom-layoutfragment-inlineoffset" id="ref-for-dom-layoutfragment-inlineoffset⑤">inlineOffset</a></code> and <code class="idl"><a data-link-type="idl" href="#dom-layoutfragment-blockoffset" id="ref-for-dom-layoutfragment-blockoffset⑤">blockOffset</a></code>.</p>
       <li data-md>
        <p>The <a data-link-type="dfn" href="https://drafts.csswg.org/css-break-4/#fragmentation-break" id="ref-for-fragmentation-break①">fragmentation break</a> information set to <var>fragmentResult</var>’s <code class="idl"><a data-link-type="idl" href="#dom-fragmentresult-internal-break-token-slot" id="ref-for-dom-fragmentresult-internal-break-token-slot①">[[internal break token]]</a></code>.</p>
       <li data-md>
        <p>Store <var>fragmentResult</var>’s <code class="idl"><a data-link-type="idl" href="#dom-fragmentresult-data-slot" id="ref-for-dom-fragmentresult-data-slot①">[[data]]</a></code> with the <a data-link-type="dfn" href="https://drafts.csswg.org/css-break-3/#fragment" id="ref-for-fragment⑦">fragment</a>.</p>
      </ul>
    </ol>
   </div>
   <h4 class="heading settled" data-level="6.2.3" id="global-scope-selection"><span class="secno">6.2.3. </span><span class="content">Global Scope Selection</span><a class="self-link" href="#global-scope-selection"></a></h4>
   <p>When the user agent needs to select a <code class="idl"><a data-link-type="idl" href="#layoutworkletglobalscope" id="ref-for-layoutworkletglobalscope①⓪">LayoutWorkletGlobalScope</a></code> from the layout <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/worklets.html#worklet" id="ref-for-worklet⑦">Worklet</a></code>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/worklets.html#concept-worklet-global-scopes" id="ref-for-concept-worklet-global-scopes②">global scopes</a> <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list⑧">list</a> it <em>must</em>:</p>
   <ul>
    <li data-md>
     <p>Select from at <em>least</em> two <code class="idl"><a data-link-type="idl" href="#layoutworkletglobalscope" id="ref-for-layoutworkletglobalscope①①">LayoutWorkletGlobalScope</a></code>s, unless the user agent is
under memory constraints.</p>
    <li data-md>
     <p><em>Not</em> re-use the same <code class="idl"><a data-link-type="idl" href="#layoutworkletglobalscope" id="ref-for-layoutworkletglobalscope①②">LayoutWorkletGlobalScope</a></code> more than 1000 times in a row.</p>
     <p class="note" role="note"><span class="marker">Note:</span> The 1000 limit was picked as a high upper bound, this limit may improve (downwards)
    over time.</p>
   </ul>
   <p class="note" role="note"><span class="marker">Note:</span> These rules exist to ensure that authors do not rely on being able to store state on the
    global object or non-regeneratable state on the class. See <a href="https://html.spec.whatwg.org/multipage/worklets.html#worklets-idempotent">the
    discussion in the worklets specification about code idempotence</a>.</p>
   <h4 class="heading settled" data-level="6.2.4" id="utility-algorithms"><span class="secno">6.2.4. </span><span class="content">Utility Algorithms</span><a class="self-link" href="#utility-algorithms"></a></h4>
   <p>The section specifies algorithms common to the <a data-link-type="dfn" href="#determine-the-intrinsic-sizes" id="ref-for-determine-the-intrinsic-sizes③">determine the intrinsic sizes</a> and <a data-link-type="dfn" href="#generate-a-fragment" id="ref-for-generate-a-fragment③">generate a fragment</a> algorithms.</p>
   <p class="note" role="note"><span class="marker">Note:</span> <a data-link-type="dfn" href="#get-a-document-layout-definition" id="ref-for-get-a-document-layout-definition④">Get a document layout definition</a> returns a <a data-link-type="dfn" href="#document-layout-definition" id="ref-for-document-layout-definition①">document layout definition</a> from the
  owning <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-document" id="ref-for-concept-document③">document</a>.</p>
   <div class="algorithm" data-algorithm="get a document layout definition">
     When the user agent wants to <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="get-a-document-layout-definition">get a document layout definition</dfn> given <var>name</var>, it <em>must</em> run the following steps: 
    <ol>
     <li data-md>
      <p>Let <var>documentLayoutDefinitionMap</var> be the associated <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-document" id="ref-for-concept-document④">document’s</a> <a data-link-type="dfn" href="#document-layout-definitions" id="ref-for-document-layout-definitions①">document layout definitions</a> map.</p>
     <li data-md>
      <p>If <var>documentLayoutDefinitionMap</var>[<var>name</var>] does not <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-exists" id="ref-for-map-exists③">exist</a>, return failure and
abort all these steps.</p>
     <li data-md>
      <p>Return the result of <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-get" id="ref-for-map-get②">get</a> <var>documentLayoutDefinitionMap</var>[<var>name</var>].</p>
    </ol>
   </div>
   <p class="note" role="note"><span class="marker">Note:</span> <a data-link-type="dfn" href="#get-a-layout-definition" id="ref-for-get-a-layout-definition⑦">Get a layout definition</a> returns a <a data-link-type="dfn" href="#layout-definition" id="ref-for-layout-definition①">layout definition</a> for a given <code class="idl"><a data-link-type="idl" href="#layoutworkletglobalscope" id="ref-for-layoutworkletglobalscope①③">LayoutWorkletGlobalScope</a></code>, it the desired definition doesn’t exist it will "invalidate" the <a data-link-type="dfn" href="#document-layout-definition" id="ref-for-document-layout-definition②">document layout definition</a>, (so that the layout can’t be used again), and return failure.</p>
   <div class="algorithm" data-algorithm="get a layout definition">
     When the user agent wants to <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="get-a-layout-definition">get a layout definition</dfn> given <var>name</var>, and <var>workletGlobalScope</var>, it <em>must</em> run the following steps: 
    <ol>
     <li data-md>
      <p>Let <var>layoutDefinitionMap</var> be <var>workletGlobalScope</var>’s <a data-link-type="dfn" href="#layout-definitions" id="ref-for-layout-definitions①">layout definitions</a> map.</p>
     <li data-md>
      <p>If <var>layoutDefinitionMap</var>[<var>name</var>] does not <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-exists" id="ref-for-map-exists④">exist</a>, run the following steps:</p>
      <ol>
       <li data-md>
        <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task" id="ref-for-queue-a-task①">Queue a task</a> to run the following steps:</p>
        <ol>
         <li data-md>
          <p>Let <var>documentLayoutDefinitionMap</var> be the associated <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-document" id="ref-for-concept-document⑤">document’s</a> <a data-link-type="dfn" href="#document-layout-definition" id="ref-for-document-layout-definition③">document layout definition</a> map.</p>
         <li data-md>
          <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-set" id="ref-for-map-set④">Set</a> <var>documentLayoutDefinitionMap</var>[<var>name</var>] to <code>"invalid"</code>.</p>
         <li data-md>
          <p>The user agent <em>should</em> log an error to the debugging console stating that a
class wasn’t registered in all <code class="idl"><a data-link-type="idl" href="#layoutworkletglobalscope" id="ref-for-layoutworkletglobalscope①④">LayoutWorkletGlobalScope</a></code>s.</p>
        </ol>
       <li data-md>
        <p>Return failure, and abort all these steps.</p>
      </ol>
     <li data-md>
      <p>Return the result of <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#sec-get-o-p" id="ref-for-sec-get-o-p⑥">get</a> <var>layoutDefinitionMap</var>[<var>name</var>].</p>
    </ol>
   </div>
   <p class="note" role="note"><span class="marker">Note:</span> <a data-link-type="dfn" href="#get-a-layout-class-instance" id="ref-for-get-a-layout-class-instance④">Get a layout class instance</a> returns an instance of the web developer provided class.
    (Registered in <code class="idl"><a data-link-type="idl" href="#dom-layoutworkletglobalscope-registerlayout" id="ref-for-dom-layoutworkletglobalscope-registerlayout⑥">registerLayout()</a></code>). If one isn’t present yet, it will create a new one. This
    algorithm may fail, as the constructor may throw an exception.</p>
   <div class="algorithm" data-algorithm="get a layout class instance">
     When the user agent wants to <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="get-a-layout-class-instance">get a layout class instance</dfn> given <var>box</var>, <var>definition</var>, and <var>workletGlobalScope</var>, it <em>must</em> run the following steps: 
    <ol>
     <li data-md>
      <p>Let <var>layoutClassInstanceMap</var> be <var>box</var>’s <a data-link-type="dfn" href="#layout-class-instances" id="ref-for-layout-class-instances">layout class instances</a> map.</p>
     <li data-md>
      <p>Let <var>layoutInstance</var> be the result of <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#sec-get-o-p" id="ref-for-sec-get-o-p⑦">get</a> <var>layoutClassInstanceMap</var>[<var>workletGlobalScope</var>].
If <var>layoutInstance</var> is null, run the following steps:</p>
      <ol>
       <li data-md>
        <p>If the <a data-link-type="dfn" href="#layout-definition-constructor-valid-flag" id="ref-for-layout-definition-constructor-valid-flag①">constructor valid flag</a> on <var>definition</var> is false, then return failure and
abort all these steps.</p>
       <li data-md>
        <p>Let <var>layoutCtor</var> be the <a data-link-type="dfn" href="#layout-definition-class-constructor" id="ref-for-layout-definition-class-constructor①">class constructor</a> on <var>definition</var>.</p>
       <li data-md>
        <p>Let <var>layoutInstance</var> be the result of <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#sec-construct" id="ref-for-sec-construct">Construct</a>(<var>layoutCtor</var>).</p>
        <p>If <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#sec-construct" id="ref-for-sec-construct①">construct</a> throws an exception, set the <var>definition</var>’s <a data-link-type="dfn" href="#layout-definition-constructor-valid-flag" id="ref-for-layout-definition-constructor-valid-flag②">constructor valid flag</a> to false, then return failure and abort all these steps.</p>
       <li data-md>
        <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-set" id="ref-for-map-set⑤">Set</a> <var>layoutClassInstanceMap</var>[<var>workletGlobalScope</var>] to <var>layoutInstance</var>.</p>
      </ol>
     <li data-md>
      <p>Return <var>layoutInstance</var>.</p>
    </ol>
   </div>
   <div class="algorithm" data-algorithm="get a style map">
     When the user agent wants to <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="get-a-style-map">get a style map</dfn> given <var>box</var>, and <var>inputProperties</var>, it <em>must</em> run the following steps: 
    <ol>
     <li data-md>
      <p>If <var>box</var>’s <a data-link-type="dfn" href="#stylemap" id="ref-for-stylemap①">styleMap</a> is null, then:</p>
      <ol>
       <li data-md>
        <p>Let <var>styleMap</var> be a new <code class="idl"><a data-link-type="idl" href="https://drafts.css-houdini.org/css-typed-om-1/#stylepropertymapreadonly" id="ref-for-stylepropertymapreadonly⑧">StylePropertyMapReadOnly</a></code> populated with <em>only</em> the <a data-link-type="dfn" href="https://drafts.csswg.org/css-cascade-5/#computed-value" id="ref-for-computed-value①①">computed values</a> for properties listed in <var>inputProperties</var> for <var>box</var>.</p>
       <li data-md>
        <p>Set <var>box</var>’s <a data-link-type="dfn" href="#stylemap" id="ref-for-stylemap②">styleMap</a> internal slot to <var>styleMap</var>.</p>
      </ol>
     <li data-md>
      <p>Return <var>box</var>’s <code class="idl"><a data-link-type="idl" href="https://drafts.css-houdini.org/css-typed-om-1/#stylepropertymapreadonly" id="ref-for-stylepropertymapreadonly⑨">StylePropertyMapReadOnly</a></code> contained in the <a data-link-type="dfn" href="#stylemap" id="ref-for-stylemap③">styleMap</a> internal slot.</p>
    </ol>
   </div>
   <p><a data-link-type="dfn" href="#run-a-work-queue" id="ref-for-run-a-work-queue④">Run a work queue</a> is designed to allow user agents to work in both a single threaded, and
multi-threaded environment.</p>
   <p class="note" role="note"><span class="marker">Note:</span> <a data-link-type="dfn" href="#run-a-work-queue" id="ref-for-run-a-work-queue⑤">Run a work queue</a> processes <a data-link-type="dfn" href="#layout-api-work-task" id="ref-for-layout-api-work-task③">layout api work task</a>s enqueued with <code class="idl"><a data-link-type="idl" href="#dom-layoutchild-intrinsicsizes" id="ref-for-dom-layoutchild-intrinsicsizes②">intrinsicSizes()</a></code> and <code class="idl"><a data-link-type="idl" href="#dom-layoutchild-layoutnextfragment" id="ref-for-dom-layoutchild-layoutnextfragment⑨">layoutNextFragment()</a></code>. It will continue
    processing tasks until the promise from the web developers layout or intrinsicSizes method is
    resolved, or the queue is empty after running the microtask queue.</p>
   <p>The result of running the queue will either be the result of the layout or intrinsicSizes
    method, or failure.</p>
   <div class="algorithm" data-algorithm="run a work queue">
     When the user agent wants to <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="run-a-work-queue">run a work queue</dfn> given <var>promise</var>, and <var>workQueue</var>, it <em>must</em> run the following steps: 
    <ol>
     <li data-md>
      <p>If <var>promise</var> is not a promise, return failure.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-while" id="ref-for-iteration-while">While</a> <var>workQueue</var> is not <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-empty" id="ref-for-list-empty①">empty</a>, and <var>promise</var> is pending:</p>
      <ol>
       <li data-md>
        <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-iterate" id="ref-for-list-iterate④">For each</a> <var>task</var> in <var>workQueue</var>:</p>
        <ol>
         <li data-md>
          <p>Let <var>layoutChild</var> be <var>task</var>’s <a data-link-type="dfn" href="#layout-api-work-task-layout-child" id="ref-for-layout-api-work-task-layout-child②">layout child</a>.</p>
         <li data-md>
          <p>Let <var>box</var> be <var>layoutChild</var>’s <a data-link-type="dfn" href="https://drafts.csswg.org/css-display-3/#box" id="ref-for-box②②">box</a> in the <code class="idl"><a data-link-type="idl" href="#dom-layoutchild-box-slot" id="ref-for-dom-layoutchild-box-slot③">[[box]]</a></code> internal slot.</p>
         <li data-md>
          <p>Let <var>childPromise</var> be <var>task</var>’s <a data-link-type="dfn" href="#layout-api-work-task-promise" id="ref-for-layout-api-work-task-promise②">promise</a>.</p>
         <li data-md>
          <p>If <var>task</var>’s <a data-link-type="dfn" href="#layout-api-work-task-task-type" id="ref-for-layout-api-work-task-task-type②">task type</a> is <code>"layout"</code>,</p>
          <ul>
           <li data-md>
            <p>Then <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task" id="ref-for-queue-a-task②">queue a task</a>, or run synchronously, the following substeps:</p>
            <ol>
             <li data-md>
              <p>Let <var>childConstraints</var> be <var>task</var>’s <a data-link-type="dfn" href="#layout-api-work-task-layout-constraints" id="ref-for-layout-api-work-task-layout-constraints①">layout constraints</a>.</p>
             <li data-md>
              <p>Let <var>childBreakToken</var> be <var>task</var>’s <a data-link-type="dfn" href="#layout-api-work-task-child-break-token" id="ref-for-layout-api-work-task-child-break-token①">child break token</a>.</p>
             <li data-md>
              <p>Let <var>targetRealm</var> be <var>layoutChild</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-global-object-realm" id="ref-for-concept-global-object-realm">Realm</a>.</p>
             <li data-md>
              <p>Let <var>internalFragment</var> be the result of the user agent producing a <a data-link-type="dfn" href="https://drafts.csswg.org/css-break-3/#fragment" id="ref-for-fragment⑧">fragment</a> based on <var>box</var>, <var>childConstraints</var>, and <var>childBreakToken</var>.</p>
              <p>Invoking <a data-link-type="dfn" href="#translate-a-layoutconstraintsoptions-to-internal-constraints" id="ref-for-translate-a-layoutconstraintsoptions-to-internal-constraints①">translate a LayoutConstraintsOptions to internal constraints</a> given <var>childConstraints</var>, must be run to translate the given <code class="idl"><a data-link-type="idl" href="#dictdef-layoutconstraintsoptions" id="ref-for-dictdef-layoutconstraintsoptions⑤">LayoutConstraintsOptions</a></code> into the internal constraints for the user
agent’s layout engine.</p>
             <li data-md>
              <p>Let <var>fragment</var> be a new <code class="idl"><a data-link-type="idl" href="#layoutfragment" id="ref-for-layoutfragment②⑥">LayoutFragment</a></code> with:</p>
              <ul>
               <li data-md>
                <p><code class="idl"><a data-link-type="idl" href="#dom-layoutfragment-inlinesize" id="ref-for-dom-layoutfragment-inlinesize③">inlineSize</a></code> being <var>internalFragment</var>’s <a data-link-type="dfn" href="https://drafts.csswg.org/css-writing-modes-4/#inline-size" id="ref-for-inline-size④">inline size</a> relative to the <a data-link-type="dfn" href="#current-layout" id="ref-for-current-layout②⑥">current layout’s</a> writing mode.</p>
               <li data-md>
                <p><code class="idl"><a data-link-type="idl" href="#dom-layoutfragment-blocksize" id="ref-for-dom-layoutfragment-blocksize③">blockSize</a></code> being <var>internalFragment</var>’s <a data-link-type="dfn" href="https://drafts.csswg.org/css-writing-modes-4/#block-size" id="ref-for-block-size⑥">block size</a> relative to the <a data-link-type="dfn" href="#current-layout" id="ref-for-current-layout②⑦">current layout’s</a> writing mode.</p>
               <li data-md>
                <p><code class="idl"><a data-link-type="idl" href="#dom-layoutfragment-inlineoffset" id="ref-for-dom-layoutfragment-inlineoffset⑥">inlineOffset</a></code> initially set to 0.</p>
               <li data-md>
                <p><code class="idl"><a data-link-type="idl" href="#dom-layoutfragment-blockoffset" id="ref-for-dom-layoutfragment-blockoffset⑥">blockOffset</a></code> initially set to 0.</p>
               <li data-md>
                <p><code class="idl"><a data-link-type="idl" href="#dom-layoutfragment-breaktoken" id="ref-for-dom-layoutfragment-breaktoken⑥">breakToken</a></code> being a new <code class="idl"><a data-link-type="idl" href="#childbreaktoken" id="ref-for-childbreaktoken⑧">ChildBreakToken</a></code> representing <var>internalFragment</var>’s internal break token, if any.</p>
               <li data-md>
                <p>If <var>internalFragment</var> has a <var>clonedData</var> object stored with it, let <code class="idl"><a data-link-type="idl" href="#dom-layoutfragment-data" id="ref-for-dom-layoutfragment-data①">data</a></code> being the result of <a data-link-type="dfn" href="https://html.spec.whatwg.org/#structureddeserialize" id="ref-for-structureddeserialize">StructuredDeserialize</a>(<var>clonedData</var>, <var>targetRealm</var>), otherwise null.</p>
              </ul>
             <li data-md>
              <p>Resolve <var>childPromise</var> with <var>fragment</var>.</p>
            </ol>
           <li data-md>
            <p>Otherwise <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task" id="ref-for-queue-a-task③">queue a task</a>, or run synchronously, the following substeps:</p>
            <ol>
             <li data-md>
              <p>Let <var>internalIntrinsicSizes</var> be the result of the user agent calculating the <b>border box</b> min/max content contribution of <var>box</var>.</p>
             <li data-md>
              <p>Let <var>intrinsicSizes</var> be a new <code class="idl"><a data-link-type="idl" href="#intrinsicsizes" id="ref-for-intrinsicsizes②">IntrinsicSizes</a></code> with:</p>
              <ul>
               <li data-md>
                <p><code class="idl"><a data-link-type="idl" href="#dom-intrinsicsizes-mincontentsize" id="ref-for-dom-intrinsicsizes-mincontentsize②">minContentSize</a></code> being <var>internalIntrinsicSizes</var>’ <b>border box</b> min-content contribution, relative to the <a data-link-type="dfn" href="#current-layout" id="ref-for-current-layout②⑧">current layout’s</a> writing mode.</p>
               <li data-md>
                <p><code class="idl"><a data-link-type="idl" href="#dom-intrinsicsizes-maxcontentsize" id="ref-for-dom-intrinsicsizes-maxcontentsize②">maxContentSize</a></code> being <var>internalIntrinsicSizes</var>’s <b>border box</b> max-content contribution, relative to the <a data-link-type="dfn" href="#current-layout" id="ref-for-current-layout②⑨">current layout’s</a> writing mode.</p>
              </ul>
             <li data-md>
              <p>Resolve <var>childPromise</var> with <var>intrinsicSizes</var>.</p>
            </ol>
          </ul>
        </ol>
       <li data-md>
        <p>Wait (optionally <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel" id="ref-for-in-parallel④">in parallel</a>) for all of the above tasks to complete.</p>
        <p class="note" role="note"><span class="marker">Note:</span> If the tasks were perform synchronously, then this step is a no-op.</p>
       <li data-md>
        <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-empty" id="ref-for-list-empty②">Empty</a> <var>workQueue</var>.</p>
       <li data-md>
        <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#perform-a-microtask-checkpoint" id="ref-for-perform-a-microtask-checkpoint">Perform a microtask checkpoint</a>.</p>
      </ol>
     <li data-md>
      <p>If <var>promise</var> isn’t fulfilled (it is pending, or got rejected), return failure.</p>
     <li data-md>
      <p>Return the fulfilled value of <var>promise</var>.</p>
    </ol>
   </div>
   <h2 class="heading settled" data-level="7" id="examples"><span class="secno">7. </span><span class="content">Examples</span><a class="self-link" href="#examples"></a></h2>
   <div class="example" id="example-c28dfd2e">
    <a class="self-link" href="#example-c28dfd2e"></a> The layout algorithm below performs a block-like layout (positioning fragments sequentially in the
block direction), while centering its children in the inline direction. 
<pre class="lang-javascript highlight">registerLayout<c- p>(</c-><c- t>'block-like'</c-><c- p>,</c-> <c- a>class</c-> <c- p>{</c->
    <c- k>async</c-> intrinsicSizes<c- p>(</c->children<c- p>,</c-> edges<c- p>,</c-> styleMap<c- p>)</c-> <c- p>{</c->
      <c- a>const</c-> childrenSizes <c- o>=</c-> <c- k>await</c-> Promise<c- p>.</c->all<c- p>(</c->children<c- p>.</c->map<c- p>((</c->child<c- p>)</c-> <c- p>=></c-> <c- p>{</c->
          <c- k>return</c-> child<c- p>.</c->intrinsicSizes<c- p>();</c->
      <c- p>}));</c->

      <c- a>const</c-> maxContentSize <c- o>=</c-> childrenSizes<c- p>.</c->reduce<c- p>((</c->max<c- p>,</c-> childSizes<c- p>)</c-> <c- p>=></c-> <c- p>{</c->
          <c- k>return</c-> Math<c- p>.</c->max<c- p>(</c->max<c- p>,</c-> childSizes<c- p>.</c->maxContentSize<c- p>);</c->
      <c- p>},</c-> <c- mf>0</c-><c- p>)</c-> <c- o>+</c-> edges<c- p>.</c->inline<c- p>;</c->

      <c- a>const</c-> minContentSize <c- o>=</c-> childrenSizes<c- p>.</c->reduce<c- p>((</c->max<c- p>,</c-> childSizes<c- p>)</c-> <c- p>=></c-> <c- p>{</c->
          <c- k>return</c-> Math<c- p>.</c->max<c- p>(</c->max<c- p>,</c-> childSizes<c- p>.</c->minContentSize<c- p>);</c->
      <c- p>},</c-> <c- mf>0</c-><c- p>)</c-> <c- o>+</c-> edges<c- p>.</c->inline<c- p>;</c->

      <c- k>return</c-> <c- p>{</c->maxContentSize<c- p>,</c-> minContentSize<c- p>};</c->
    <c- p>}</c->

    <c- k>async</c-> layout<c- p>(</c->children<c- p>,</c-> edges<c- p>,</c-> constraints<c- p>,</c-> styleMap<c- p>)</c-> <c- p>{</c->
        <c- c1>// Determine our (inner) available size.</c->
        <c- a>const</c-> availableInlineSize <c- o>=</c-> constraints<c- p>.</c->fixedInlineSize <c- o>-</c-> edges<c- p>.</c->inline<c- p>;</c->
        <c- a>const</c-> availableBlockSize <c- o>=</c-> constraints<c- p>.</c->fixedBlockSize <c- o>?</c->
            constraints<c- p>.</c->fixedBlockSize <c- o>-</c-> edges<c- p>.</c->block <c- o>:</c-> <c- kc>null</c-><c- p>;</c->

        <c- a>const</c-> childFragments <c- o>=</c-> <c- p>[];</c->
        <c- a>const</c-> childConstraints <c- o>=</c-> <c- p>{</c-> availableInlineSize<c- p>,</c-> availableBlockSize <c- p>};</c->

        <c- a>const</c-> childFragments <c- o>=</c-> <c- k>await</c-> Promise<c- p>.</c->all<c- p>(</c->children<c- p>.</c->map<c- p>((</c->child<c- p>)</c-> <c- p>=></c-> <c- p>{</c->
            <c- k>return</c-> child<c- p>.</c->layoutNextFragment<c- p>(</c->childConstraints<c- p>);</c->
        <c- p>}));</c->

        <c- a>let</c-> blockOffset <c- o>=</c-> edges<c- p>.</c->blockStart<c- p>;</c->
        <c- k>for</c-> <c- p>(</c-><c- a>let</c-> fragment <c- k>of</c-> childFragments<c- p>)</c-> <c- p>{</c->
            <c- c1>// Position the fragment in a block like manner, centering it in the</c->
            <c- c1>// inline direction.</c->
            fragment<c- p>.</c->blockOffset <c- o>=</c-> blockOffset<c- p>;</c->
            fragment<c- p>.</c->inlineOffset <c- o>=</c-> Math<c- p>.</c->max<c- p>(</c->
                edges<c- p>.</c->inlineStart<c- p>,</c->
                <c- p>(</c->availableInlineSize <c- o>-</c-> fragment<c- p>.</c->inlineSize<c- p>)</c-> <c- o>/</c-> <c- mf>2</c-><c- p>);</c->

            blockOffset <c- o>+=</c-> fragment<c- p>.</c->blockSize<c- p>;</c->
        <c- p>}</c->

        <c- a>const</c-> autoBlockSize <c- o>=</c-> blockOffset <c- o>+</c-> edges<c- p>.</c->blockEnd<c- p>;</c->

        <c- k>return</c-> <c- p>{</c->
            autoBlockSize<c- p>,</c->
            childFragments<c- p>,</c->
        <c- p>};</c->
    <c- p>}</c->
<c- p>});</c->
</pre>
   </div>
   <div class="example" id="example-223b1071">
    <a class="self-link" href="#example-223b1071"></a> The layout algorithm performs a flexbox-like distribution of spare space in the inline direction. It
creates child layout constraints which specify that a child should be a fixed inline size. 
<pre class="lang-javascript highlight">registerLayout<c- p>(</c-><c- t>'flex-distribution-like'</c-><c- p>,</c-> <c- a>class</c-> <c- p>{</c->
    <c- k>async</c-> intrinsicSizes<c- p>(</c->children<c- p>,</c-> edges<c- p>,</c-> styleMap<c- p>)</c-> <c- p>{</c->
      <c- a>const</c-> childrenSizes <c- o>=</c-> <c- k>await</c-> Promise<c- p>.</c->all<c- p>(</c->children<c- p>.</c->map<c- p>((</c->child<c- p>)</c-> <c- p>=></c-> <c- p>{</c->
          <c- k>return</c-> child<c- p>.</c->intrinsicSizes<c- p>();</c->
      <c- p>}));</c->

      <c- a>const</c-> maxContentSize <c- o>=</c-> childrenSizes<c- p>.</c->reduce<c- p>((</c->sum<c- p>,</c-> childSizes<c- p>)</c-> <c- p>=></c-> <c- p>{</c->
          <c- k>return</c-> sum <c- o>+</c-> childSizes<c- p>.</c->maxContentSize<c- p>;</c->
      <c- p>},</c-> <c- mf>0</c-><c- p>)</c-> <c- o>+</c-> edges<c- p>.</c->inline<c- p>;</c->

      <c- a>const</c-> minContentSize <c- o>=</c-> childrenSizes<c- p>.</c->reduce<c- p>((</c->max<c- p>,</c-> childSizes<c- p>)</c-> <c- p>=></c-> <c- p>{</c->
          <c- k>return</c-> sum <c- o>+</c-> childSizes<c- p>.</c->minContentSize<c- p>;</c->
      <c- p>},</c-> <c- mf>0</c-><c- p>)</c-> <c- o>+</c-> edges<c- p>.</c->inline<c- p>;</c->

      <c- k>return</c-> <c- p>{</c->maxContentSize<c- p>,</c-> minContentSize<c- p>};</c->
    <c- p>}</c->

    <c- k>async</c-> layout<c- p>(</c->children<c- p>,</c-> edges<c- p>,</c-> constraints<c- p>,</c-> styleMap<c- p>)</c-> <c- p>{</c->
        <c- c1>// Determine our (inner) available size.</c->
        <c- a>const</c-> availableInlineSize <c- o>=</c->
            constraints<c- p>.</c->fixedInlineSize <c- o>-</c-> edges<c- p>.</c->inline<c- p>;</c->
        <c- a>const</c-> availableBlockSize <c- o>=</c-> constraints<c- p>.</c->fixedBlockSize <c- o>?</c->
            constraints<c- p>.</c->fixedBlockSize <c- o>-</c-> edges<c- p>.</c->block <c- o>:</c-> <c- kc>null</c-><c- p>;</c->

        <c- a>const</c-> childConstraints <c- o>=</c-> <c- p>{</c-> availableInlineSize<c- p>,</c-> availableBlockSize <c- p>};</c->

        <c- a>const</c-> unconstrainedChildFragments <c- o>=</c-> <c- k>await</c-> Promise<c- p>.</c->all<c- p>(</c->children<c- p>.</c->map<c- p>((</c->child<c- p>)</c-> <c- p>=></c-> <c- p>{</c->
            <c- k>return</c-> child<c- p>.</c->layoutNextFragment<c- p>(</c->childConstraints<c- p>);</c->
        <c- p>}));</c->

        <c- a>const</c-> unconstrainedSizes <c- o>=</c-> <c- p>[];</c->
        <c- a>const</c-> totalSize <c- o>=</c-> unconstrainedChildFragments<c- p>.</c->reduce<c- p>((</c->sum<c- p>,</c-> fragment<c- p>,</c-> i<c- p>)</c-> <c- p>=></c-> <c- p>{</c->
            unconstrainedSizes<c- p>[</c->i<c- p>]</c-> <c- o>=</c-> fragment<c- p>.</c->inlineSize<c- p>;</c->
            <c- k>return</c-> sum <c- o>+</c-> fragment<c- p>.</c->inlineSize<c- p>;</c->
        <c- p>},</c-> <c- mf>0</c-><c- p>);</c->

        <c- c1>// Distribute spare space between children.</c->
        <c- a>const</c-> remainingSpace <c- o>=</c-> Math<c- p>.</c->max<c- p>(</c-><c- mf>0</c-><c- p>,</c-> inlineSize <c- o>-</c-> totalSize<c- p>);</c->
        <c- a>const</c-> extraSpace <c- o>=</c-> remainingSpace <c- o>/</c-> children<c- p>.</c->length<c- p>;</c->

        <c- a>const</c-> childFragments <c- o>=</c-> <c- k>await</c-> Promise<c- p>.</c->all<c- p>(</c->children<c- p>.</c->map<c- p>((</c->child<c- p>,</c-> i<c- p>)</c-> <c- p>=></c-> <c- p>{</c->
            <c- k>return</c-> child<c- p>.</c->layoutNextFragment<c- p>({</c->
                fixedInlineSize<c- o>:</c-> unconstrainedSizes<c- p>[</c->i<c- p>]</c-> <c- o>+</c-> extraSpace<c- p>,</c->
                availableBlockSize
            <c- p>});</c->
        <c- p>}));</c->

        <c- c1>// Position the fragments.</c->
        <c- a>let</c-> inlineOffset <c- o>=</c-> <c- mf>0</c-><c- p>;</c->
        <c- a>let</c-> maxChildBlockSize <c- o>=</c-> <c- mf>0</c-><c- p>;</c->
        <c- k>for</c-> <c- p>(</c-><c- a>let</c-> fragment <c- k>of</c-> childFragments<c- p>)</c-> <c- p>{</c->
            fragment<c- p>.</c->inlineOffset <c- o>=</c-> inlineOffset<c- p>;</c->
            fragment<c- p>.</c->blockOffset <c- o>=</c-> edges<c- p>.</c->blockStart<c- p>;</c->

            inlineOffset <c- o>+=</c-> fragment<c- p>.</c->inlineSize<c- p>;</c->
            maxChildBlockSize <c- o>=</c-> Math<c- p>.</c->max<c- p>(</c->maxChildBlockSize<c- p>,</c-> fragment<c- p>.</c->blockSize<c- p>);</c->
        <c- p>}</c->

        <c- k>return</c-> <c- p>{</c->
            autoBlockSize<c- o>:</c-> maxChildBlockSize <c- o>+</c-> edges<c- p>.</c->block<c- p>,</c->
            childFragments<c- p>,</c->
        <c- p>};</c->
    <c- p>}</c->
<c- p>});</c->
</pre>
   </div>
   <div class="example" id="example-412c6264">
    <a class="self-link" href="#example-412c6264"></a> This example shows a simple layout which indents child fragments for a certain number of
lines. 
    <p>This example also demonstrates using the previous <code class="idl"><a data-link-type="idl" href="#dom-layoutfragment-breaktoken" id="ref-for-dom-layoutfragment-breaktoken⑦">breakToken</a></code> of a <code class="idl"><a data-link-type="idl" href="#layoutfragment" id="ref-for-layoutfragment②⑦">LayoutFragment</a></code> to produce the next fragment for the <code class="idl"><a data-link-type="idl" href="#layoutchild" id="ref-for-layoutchild④①">LayoutChild</a></code>.</p>
    <p>It also demonstrates using the <code class="idl"><a data-link-type="idl" href="#breaktoken" id="ref-for-breaktoken①">BreakToken</a></code> to respect the <code class="idl"><a data-link-type="idl" href="#layoutconstraints" id="ref-for-layoutconstraints①⓪">LayoutConstraints</a></code>' <code class="idl"><a data-link-type="idl" href="#dom-layoutconstraints-blockfragmentationtype" id="ref-for-dom-layoutconstraints-blockfragmentationtype⑤">blockFragmentationType</a></code>, it resumes it layout from the previous <code class="idl"><a data-link-type="idl" href="#breaktoken" id="ref-for-breaktoken②">BreakToken</a></code>.
It returns a <code class="idl"><a data-link-type="idl" href="#dictdef-fragmentresultoptions" id="ref-for-dictdef-fragmentresultoptions⑦">FragmentResultOptions</a></code> with a <code class="idl"><a data-link-type="idl" href="#dom-fragmentresultoptions-breaktoken" id="ref-for-dom-fragmentresultoptions-breaktoken①">breakToken</a></code> which is used to
resume the layout.</p>
<pre class="lang-javascript highlight">registerLayout<c- p>(</c-><c- t>'indent-lines'</c-><c- p>,</c-> <c- a>class</c-> <c- p>{</c->
    <c- k>static</c-> layoutOptions <c- o>=</c-> <c- p>{</c->childDisplay<c- o>:</c-> <c- t>'normal'</c-><c- p>};</c->
    <c- k>static</c-> inputProperties <c- o>=</c-> <c- p>[</c-><c- t>'--indent'</c-><c- p>,</c-> <c- t>'--indent-lines'</c-><c- p>];</c->

    <c- k>async</c-> layout<c- p>(</c->children<c- p>,</c-> edges<c- p>,</c-> constraints<c- p>,</c-> styleMap<c- p>,</c-> breakToken<c- p>)</c-> <c- p>{</c->
        <c- c1>// Determine our (inner) available size.</c->
        <c- a>const</c-> availableInlineSize <c- o>=</c->
            constraints<c- p>.</c->fixedInlineSize <c- o>-</c-> edges<c- p>.</c->inline<c- p>;</c->
        <c- a>const</c-> availableBlockSize <c- o>=</c-> constraints<c- p>.</c->fixedBlockSize <c- o>?</c->
            constraints<c- p>.</c->fixedBlockSize <c- o>-</c-> edges<c- p>.</c->block <c- o>:</c-> <c- kc>null</c-><c- p>;</c->

        <c- c1>// Detrermine the number of lines to indent, and the indent amount.</c->
        <c- a>const</c-> indent <c- o>=</c-> resolveLength<c- p>(</c->constraints<c- p>,</c-> styleMap<c- p>.</c->get<c- p>(</c-><c- t>'--indent'</c-><c- p>));</c->
        <c- a>let</c-> lines <c- o>=</c-> styleMap<c- p>.</c->get<c- p>(</c-><c- t>'--indent-lines'</c-><c- p>).</c->value<c- p>;</c->

        <c- a>const</c-> childFragments <c- o>=</c-> <c- p>[];</c->

        <c- a>let</c-> childBreakToken <c- o>=</c-> <c- kc>null</c-><c- p>;</c->
        <c- k>if</c-> <c- p>(</c->breakToken<c- p>)</c-> <c- p>{</c->
            childBreakToken <c- o>=</c-> breakToken<c- p>.</c->childBreakTokens<c- p>[</c-><c- mf>0</c-><c- p>];</c->

            <c- c1>// Remove all the children we have already produced fragments for.</c->
            children<c- p>.</c->splice<c- p>(</c-><c- mf>0</c-><c- p>,</c-> children<c- p>.</c->indexOf<c- p>(</c->childBreakToken<c- p>.</c->child<c- p>));</c->
        <c- p>}</c->

        <c- a>let</c-> blockOffset <c- o>=</c-> edges<c- p>.</c->blockStart<c- p>;</c->
        <c- a>let</c-> child <c- o>=</c-> children<c- p>.</c->shift<c- p>();</c->
        <c- k>while</c-> <c- p>(</c->child<c- p>)</c-> <c- p>{</c->
            <c- a>const</c-> shouldIndent <c- o>=</c-> lines<c- o>--</c-> <c- o>></c-> <c- mf>0</c-><c- p>;</c->

            <c- c1>// Adjust the inline size for the indent.</c->
            <c- a>const</c-> childAvailableInlineSize <c- o>=</c-> shouldIndent <c- o>?</c->
                availableInlineSize <c- o>-</c-> indent <c- o>:</c-> availableInlineSize<c- p>;</c->

            <c- a>const</c-> childConstraints <c- o>=</c-> <c- p>{</c->
                availableInlineSize<c- o>:</c-> childAvailableInlineSize<c- p>,</c->
                availableBlockSize<c- p>,</c->
                percentageInlineSize<c- o>:</c-> availableInlineSize<c- p>,</c->
                blockFragmentationType<c- o>:</c-> constraints<c- p>.</c->blockFragmentationType<c- p>,</c->
            <c- p>};</c->

            <c- a>const</c-> fragment <c- o>=</c-> <c- k>await</c-> child<c- p>.</c->layoutNextFragment<c- p>(</c->childConstraints<c- p>,</c->
                                                            childBreakToken<c- p>);</c->
            childFragments<c- p>.</c->push<c- p>(</c->fragment<c- p>);</c->

            <c- c1>// Position the fragment.</c->
            fragment<c- p>.</c->inlineOffset <c- o>=</c-> shouldIndent <c- o>?</c->
                edges<c- p>.</c->inlineStart <c- o>+</c-> indent <c- o>:</c-> edges<c- p>.</c->inlineStart<c- p>;</c->
            fragment<c- p>.</c->blockOffset <c- o>=</c-> blockOffset<c- p>;</c->
            blockOffset <c- o>+=</c-> fragment<c- p>.</c->blockSize<c- p>;</c->

            <c- c1>// Check if we have gone over the block fragmentation limit.</c->
            <c- k>if</c-> <c- p>(</c->constraints<c- p>.</c->blockFragmentationType <c- o>!=</c-> <c- t>'none'</c-> <c- o>&amp;&amp;</c->
                blockOffset <c- o>></c-> constraints<c- p>.</c->blockSize<c- p>)</c-> <c- p>{</c->
                <c- k>break</c-><c- p>;</c->
            <c- p>}</c->

            <c- k>if</c-> <c- p>(</c->fragment<c- p>.</c->breakToken<c- p>)</c-> <c- p>{</c->
                childBreakToken <c- o>=</c-> fragment<c- p>.</c->breakToken<c- p>;</c->
            <c- p>}</c-> <c- k>else</c-> <c- p>{</c->
                <c- c1>// If a fragment doesn’t have a break token, we move onto the</c->
                <c- c1>// next child.</c->
                child <c- o>=</c-> children<c- p>.</c->shift<c- p>();</c->
                childBreakToken <c- o>=</c-> <c- kc>null</c-><c- p>;</c->
            <c- p>}</c->
        <c- p>}</c->

        <c- a>const</c-> autoBlockSize <c- o>=</c-> blockOffset <c- o>+</c-> edges<c- p>.</c->blockEnd<c- p>;</c->

        <c- c1>// Return our fragment.</c->
        <c- a>const</c-> result <c- o>=</c-> <c- p>{</c->
            autoBlockSize<c- p>,</c->
            childFragments<c- o>:</c-> childFragments<c- p>,</c->
        <c- p>}</c->

        <c- k>if</c-> <c- p>(</c->childBreakToken<c- p>)</c-> <c- p>{</c->
            result<c- p>.</c->breakToken <c- o>=</c-> <c- p>{</c->
                childBreakTokens<c- o>:</c-> <c- p>[</c->childBreakToken<c- p>],</c->
            <c- p>};</c->
        <c- p>}</c->

        <c- k>return</c-> result<c- p>;</c->
    <c- p>}</c->
<c- p>});</c->
</pre>
   </div>
   <h2 class="heading settled" data-level="8" id="security-considerations"><span class="secno">8. </span><span class="content">Security Considerations</span><a class="self-link" href="#security-considerations"></a></h2>
   <p>There are no known security issues introduced by these features.</p>
   <h2 class="heading settled" data-level="9" id="privacy-considerations"><span class="secno">9. </span><span class="content">Privacy Considerations</span><a class="self-link" href="#privacy-considerations"></a></h2>
   <p>There are no known privacy issues introduced by these features.</p>
  </main>
  <h2 class="no-ref no-num heading settled" id="w3c-conformance"><span class="content"> Conformance</span></h2>
  <h3 class="no-ref heading settled" id="w3c-conventions"><span class="content"> Document conventions</span></h3>
  <p>Conformance requirements are expressed with a combination of
    descriptive assertions and RFC 2119 terminology. The key words “MUST”,
    “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”,
    “RECOMMENDED”, “MAY”, and “OPTIONAL” in the normative parts of this
    document are to be interpreted as described in RFC 2119.
    However, for readability, these words do not appear in all uppercase
    letters in this specification. </p>
  <p>All of the text of this specification is normative except sections
    explicitly marked as non-normative, examples, and notes. <a data-link-type="biblio">[RFC2119]</a></p>
  <p>Examples in this specification are introduced with the words “for example”
    or are set apart from the normative text with <code>class="example"</code>,
    like this: </p>
  <div class="example">
   <p>This is an example of an informative example.</p>
  </div>
  <p>Informative notes begin with the word “Note” and are set apart from the
    normative text with <code>class="note"</code>, like this: </p>
  <p class="note" role="note">Note, this is an informative note.</p>
  <p>Advisements are normative sections styled to evoke special attention and are
    set apart from other normative text with <code>&lt;strong class="advisement"></code>, like
    this: <strong class="advisement"> UAs MUST provide an accessible alternative. </strong></p>
  <wpt open title="Tests relating to the content of this specification
                     may be documented in “Tests” blocks like this one.
                     Any such block is non-normative."></wpt>
  <h3 class="no-ref heading settled" id="w3c-conformance-classes"><span class="content"> Conformance classes</span></h3>
  <p>Conformance to this specification
    is defined for three conformance classes: </p>
  <dl>
   <dt>style sheet 
   <dd>A <a href="http://www.w3.org/TR/CSS21/conform.html#style-sheet">CSS
            style sheet</a>. 
   <dt>renderer 
   <dd>A <a href="http://www.w3.org/TR/CSS21/conform.html#user-agent">UA</a> that interprets the semantics of a style sheet and renders
            documents that use them. 
   <dt>authoring tool 
   <dd>A <a href="http://www.w3.org/TR/CSS21/conform.html#user-agent">UA</a> that writes a style sheet. 
  </dl>
  <p>A style sheet is conformant to this specification
    if all of its statements that use syntax defined in this module are valid
    according to the generic CSS grammar and the individual grammars of each
    feature defined in this module. </p>
  <p>A renderer is conformant to this specification
    if, in addition to interpreting the style sheet as defined by the
    appropriate specifications, it supports all the features defined
    by this specification by parsing them correctly
    and rendering the document accordingly. However, the inability of a
    UA to correctly render a document due to limitations of the device
    does not make the UA non-conformant. (For example, a UA is not
    required to render color on a monochrome monitor.) </p>
  <p>An authoring tool is conformant to this specification
    if it writes style sheets that are syntactically correct according to the
    generic CSS grammar and the individual grammars of each feature in
    this module, and meet all other conformance requirements of style sheets
    as described in this module. </p>
  <h3 class="no-ref heading settled" id="w3c-partial"><span class="content"> Partial implementations</span></h3>
  <p>So that authors can exploit the forward-compatible parsing rules to
    assign fallback values, CSS renderers <strong>must</strong> treat as invalid (and <a href="http://www.w3.org/TR/CSS21/conform.html#ignore">ignore
    as appropriate</a>) any at-rules, properties, property values, keywords,
    and other syntactic constructs for which they have no usable level of
    support. In particular, user agents <strong>must not</strong> selectively
    ignore unsupported component values and honor supported values in a single
    multi-value property declaration: if any value is considered invalid
    (as unsupported values must be), CSS requires that the entire declaration
    be ignored.</p>
  <h4 class="heading settled" id="w3c-conform-future-proofing"><span class="content"> Implementations of Unstable and Proprietary Features</span></h4>
  <p>To avoid clashes with future stable CSS features,
        the CSSWG recommends <a href="http://www.w3.org/TR/CSS/#future-proofing">following best practices</a> for the implementation of <a href="http://www.w3.org/TR/CSS/#unstable">unstable</a> features and <a href="http://www.w3.org/TR/CSS/#proprietary-extension">proprietary extensions</a> to CSS. </p>
  <h3 class="no-ref heading settled" id="w3c-testing"><span class="content"> Non-experimental implementations</span></h3>
  <p>Once a specification reaches the Candidate Recommendation stage,
    non-experimental implementations are possible, and implementors should
    release an unprefixed implementation of any CR-level feature they
    can demonstrate to be correctly implemented according to spec. </p>
  <p>To establish and maintain the interoperability of CSS across
    implementations, the CSS Working Group requests that non-experimental
    CSS renderers submit an implementation report (and, if necessary, the
    testcases used for that implementation report) to the W3C before
    releasing an unprefixed implementation of any CSS features. Testcases
    submitted to W3C are subject to review and correction by the CSS
    Working Group. </p>
  <p>Further information on submitting testcases and implementation reports
    can be found from on the CSS Working Group’s website at <a href="http://www.w3.org/Style/CSS/Test/">http://www.w3.org/Style/CSS/Test/</a>.
    Questions should be directed to the <a href="http://lists.w3.org/Archives/Public/public-css-testsuite">public-css-testsuite@w3.org</a> mailing list.</p>
  <script src="https://www.w3.org/scripts/TR/2021/fixup.js"></script>
  <h2 class="no-num no-ref heading settled" id="index"><span class="content">Index</span><a class="self-link" href="#index"></a></h2>
  <h3 class="no-num no-ref heading settled" id="index-defined-here"><span class="content">Terms defined by this specification</span><a class="self-link" href="#index-defined-here"></a></h3>
  <ul class="index">
   <li><a href="#dom-fragmentresultoptions-autoblocksize">autoBlockSize</a><span>, in § 6.2</span>
   <li>
    availableBlockSize
    <ul>
     <li><a href="#dom-layoutconstraints-availableblocksize">attribute for LayoutConstraints</a><span>, in § 4.4</span>
     <li><a href="#dom-layoutconstraintsoptions-availableblocksize">dict-member for LayoutConstraintsOptions</a><span>, in § 4.4.1</span>
    </ul>
   <li>
    availableInlineSize
    <ul>
     <li><a href="#dom-layoutconstraints-availableinlinesize">attribute for LayoutConstraints</a><span>, in § 4.4</span>
     <li><a href="#dom-layoutconstraintsoptions-availableinlinesize">dict-member for LayoutConstraintsOptions</a><span>, in § 4.4.1</span>
    </ul>
   <li><a href="#dom-childdisplaytype-block">"block"</a><span>, in § 3.2</span>
   <li><a href="#dom-layoutedges-block">block</a><span>, in § 4.6</span>
   <li><a href="#dom-layoutedges-blockend">blockEnd</a><span>, in § 4.6</span>
   <li>
    blockFragmentationOffset
    <ul>
     <li><a href="#dom-layoutconstraints-blockfragmentationoffset">attribute for LayoutConstraints</a><span>, in § 4.4</span>
     <li><a href="#dom-layoutconstraintsoptions-blockfragmentationoffset">dict-member for LayoutConstraintsOptions</a><span>, in § 4.4.1</span>
    </ul>
   <li><a href="#enumdef-blockfragmentationtype">BlockFragmentationType</a><span>, in § 4.4</span>
   <li>
    blockFragmentationType
    <ul>
     <li><a href="#dom-layoutconstraints-blockfragmentationtype">attribute for LayoutConstraints</a><span>, in § 4.4</span>
     <li><a href="#dom-layoutconstraintsoptions-blockfragmentationtype">dict-member for LayoutConstraintsOptions</a><span>, in § 4.4.1</span>
    </ul>
   <li><a href="#dom-layoutsizingmode-block-like">"block-like"</a><span>, in § 3.2</span>
   <li><a href="#dom-layoutfragment-blockoffset">blockOffset</a><span>, in § 4.2</span>
   <li><a href="#dom-fragmentresult-block-size-slot">[[block size]]</a><span>, in § 6.2</span>
   <li>
    blockSize
    <ul>
     <li><a href="#dom-fragmentresult-blocksize">attribute for FragmentResult</a><span>, in § 6.2</span>
     <li><a href="#dom-layoutfragment-blocksize">attribute for LayoutFragment</a><span>, in § 4.2</span>
     <li><a href="#dom-fragmentresultoptions-blocksize">dict-member for FragmentResultOptions</a><span>, in § 6.2</span>
    </ul>
   <li><a href="#dom-layoutedges-blockstart">blockStart</a><span>, in § 4.6</span>
   <li>
    [[box]]
    <ul>
     <li><a href="#dom-fragmentresult-box-slot">attribute for FragmentResult</a><span>, in § 6.2</span>
     <li><a href="#dom-layoutchild-box-slot">attribute for LayoutChild</a><span>, in § 4.1</span>
    </ul>
   <li><a href="#breaktoken">BreakToken</a><span>, in § 4.5</span>
   <li>
    breakToken
    <ul>
     <li><a href="#dom-layoutfragment-breaktoken">attribute for LayoutFragment</a><span>, in § 4.2</span>
     <li><a href="#dom-fragmentresultoptions-breaktoken">dict-member for FragmentResultOptions</a><span>, in § 6.2</span>
    </ul>
   <li><a href="#dictdef-breaktokenoptions">BreakTokenOptions</a><span>, in § 4.5</span>
   <li><a href="#enumdef-breaktype">BreakType</a><span>, in § 4.5</span>
   <li><a href="#dom-childbreaktoken-breaktype">breakType</a><span>, in § 4.5</span>
   <li><a href="#dom-childbreaktoken-child">child</a><span>, in § 4.5</span>
   <li><a href="#layout-api-work-task-child-break-token">child break token</a><span>, in § 6.1</span>
   <li><a href="#childbreaktoken">ChildBreakToken</a><span>, in § 4.5</span>
   <li>
    childBreakTokens
    <ul>
     <li><a href="#dom-breaktoken-childbreaktokens">attribute for BreakToken</a><span>, in § 4.5</span>
     <li><a href="#dom-breaktokenoptions-childbreaktokens">dict-member for BreakTokenOptions</a><span>, in § 4.5</span>
    </ul>
   <li><a href="#dom-layoutoptions-childdisplay">childDisplay</a><span>, in § 3.2</span>
   <li><a href="#enumdef-childdisplaytype">ChildDisplayType</a><span>, in § 3.2</span>
   <li><a href="#dom-fragmentresult-child-fragments-slot">[[child fragments]]</a><span>, in § 6.2</span>
   <li><a href="#dom-fragmentresultoptions-childfragments">childFragments</a><span>, in § 6.2</span>
   <li>
    child input properties
    <ul>
     <li><a href="#document-layout-definition-child-input-properties">dfn for document layout definition</a><span>, in § 3.1</span>
     <li><a href="#layout-definition-child-input-properties">dfn for layout definition</a><span>, in § 3.1</span>
    </ul>
   <li><a href="#child-layout">child layout</a><span>, in § 3.3</span>
   <li><a href="#layout-definition-class-constructor">class constructor</a><span>, in § 3.1</span>
   <li>
    "column"
    <ul>
     <li><a href="#dom-blockfragmentationtype-column">enum-value for BlockFragmentationType</a><span>, in § 4.4</span>
     <li><a href="#dom-breaktype-column">enum-value for BreakType</a><span>, in § 4.5</span>
    </ul>
   <li><a href="#construct-a-fragment-result">construct a fragment result</a><span>, in § 6.2</span>
   <li><a href="#dom-fragmentresult-fragmentresult">constructor()</a><span>, in § 6.2</span>
   <li><a href="#dom-fragmentresult-fragmentresult">constructor(options)</a><span>, in § 6.2</span>
   <li><a href="#layout-definition-constructor-valid-flag">constructor valid flag</a><span>, in § 3.1</span>
   <li><a href="#create-a-layout-api-context">create a layout API context</a><span>, in § 6.1</span>
   <li><a href="#create-a-layout-constraints-object">create a layout constraints object</a><span>, in § 4.4</span>
   <li><a href="#current-layout">current layout</a><span>, in § 3.3</span>
   <li><a href="#dom-fragmentresult-data-slot">[[data]]</a><span>, in § 6.2</span>
   <li>
    data
    <ul>
     <li><a href="#dom-breaktoken-data">attribute for BreakToken</a><span>, in § 4.5</span>
     <li><a href="#dom-layoutconstraints-data">attribute for LayoutConstraints</a><span>, in § 4.4</span>
     <li><a href="#dom-layoutfragment-data">attribute for LayoutFragment</a><span>, in § 4.2</span>
     <li><a href="#dom-breaktokenoptions-data">dict-member for BreakTokenOptions</a><span>, in § 4.5</span>
     <li><a href="#dom-fragmentresultoptions-data">dict-member for FragmentResultOptions</a><span>, in § 6.2</span>
     <li><a href="#dom-layoutconstraintsoptions-data">dict-member for LayoutConstraintsOptions</a><span>, in § 4.4.1</span>
    </ul>
   <li><a href="#determine-the-intrinsic-sizes">determine the intrinsic sizes</a><span>, in § 6.2.1</span>
   <li><a href="#document-layout-definition">document layout definition</a><span>, in § 3.1</span>
   <li><a href="#document-layout-definitions">document layout definitions</a><span>, in § 3.2</span>
   <li>
    fixedBlockSize
    <ul>
     <li><a href="#dom-layoutconstraints-fixedblocksize">attribute for LayoutConstraints</a><span>, in § 4.4</span>
     <li><a href="#dom-layoutconstraintsoptions-fixedblocksize">dict-member for LayoutConstraintsOptions</a><span>, in § 4.4.1</span>
    </ul>
   <li>
    fixedInlineSize
    <ul>
     <li><a href="#dom-layoutconstraints-fixedinlinesize">attribute for LayoutConstraints</a><span>, in § 4.4</span>
     <li><a href="#dom-layoutconstraintsoptions-fixedinlinesize">dict-member for LayoutConstraintsOptions</a><span>, in § 4.4.1</span>
    </ul>
   <li><a href="#fragmentresult">FragmentResult</a><span>, in § 6.2</span>
   <li><a href="#dom-fragmentresult-fragmentresult">FragmentResult()</a><span>, in § 6.2</span>
   <li><a href="#dom-fragmentresult-fragmentresult">FragmentResult(options)</a><span>, in § 6.2</span>
   <li><a href="#dictdef-fragmentresultoptions">FragmentResultOptions</a><span>, in § 6.2</span>
   <li><a href="#generate-a-fragment">generate a fragment</a><span>, in § 6.2.2</span>
   <li><a href="#get-a-document-layout-definition">get a document layout definition</a><span>, in § 6.2.4</span>
   <li><a href="#get-a-layout-child">get a layout child</a><span>, in § 4.1.1</span>
   <li><a href="#get-a-layout-class-instance">get a layout class instance</a><span>, in § 6.2.4</span>
   <li><a href="#get-a-layout-definition">get a layout definition</a><span>, in § 6.2.4</span>
   <li><a href="#get-a-style-map">get a style map</a><span>, in § 6.2.4</span>
   <li><a href="#dom-layoutedges-inline">inline</a><span>, in § 4.6</span>
   <li><a href="#dom-layoutedges-inlineend">inlineEnd</a><span>, in § 4.6</span>
   <li><a href="#dom-layoutfragment-inlineoffset">inlineOffset</a><span>, in § 4.2</span>
   <li><a href="#dom-fragmentresult-inline-size-slot">[[inline size]]</a><span>, in § 6.2</span>
   <li>
    inlineSize
    <ul>
     <li><a href="#dom-fragmentresult-inlinesize">attribute for FragmentResult</a><span>, in § 6.2</span>
     <li><a href="#dom-layoutfragment-inlinesize">attribute for LayoutFragment</a><span>, in § 4.2</span>
     <li><a href="#dom-fragmentresultoptions-inlinesize">dict-member for FragmentResultOptions</a><span>, in § 6.2</span>
    </ul>
   <li><a href="#dom-layoutedges-inlinestart">inlineStart</a><span>, in § 4.6</span>
   <li>
    input properties
    <ul>
     <li><a href="#document-layout-definition-input-properties">dfn for document layout definition</a><span>, in § 3.1</span>
     <li><a href="#layout-definition-input-properties">dfn for layout definition</a><span>, in § 3.1</span>
    </ul>
   <li><a href="#dom-fragmentresult-internal-break-token-slot">[[internal break token]]</a><span>, in § 6.2</span>
   <li><a href="#intrinsicsizes">IntrinsicSizes</a><span>, in § 4.3</span>
   <li><a href="#dom-layoutchild-intrinsicsizes">intrinsicSizes()</a><span>, in § 4.1</span>
   <li><a href="#layout-definition-intrinsic-sizes-function">intrinsic sizes function</a><span>, in § 3.1</span>
   <li><a href="#dictdef-intrinsicsizesresultoptions">IntrinsicSizesResultOptions</a><span>, in § 6.2</span>
   <li><a href="#invoke-a-layout-callback">invoke a layout callback</a><span>, in § 6.2.2</span>
   <li><a href="#invoke-an-intrinsic-sizes-callback">invoke an intrinsic sizes callback</a><span>, in § 6.2.1</span>
   <li><a href="#valdef-display-layout">layout()</a><span>, in § 2</span>
   <li><a href="#layout-api-container">layout API container</a><span>, in § 2</span>
   <li><a href="#layout-api-context">layout API context</a><span>, in § 6.1</span>
   <li><a href="#layout-api-formatting-context">layout API formatting context</a><span>, in § 2</span>
   <li><a href="#layout-api-work-task">layout API work task</a><span>, in § 6.1</span>
   <li><a href="#layout-api-work-task-layout-child">layout child</a><span>, in § 6.1</span>
   <li><a href="#layoutchild">LayoutChild</a><span>, in § 4.1</span>
   <li><a href="#dom-box-layoutchildmap-slot">[[layoutChildMap]]</a><span>, in § 4.1.1</span>
   <li><a href="#layout-class-instances">layout class instances</a><span>, in § 3.2</span>
   <li><a href="#layout-api-work-task-layout-constraints">layout constraints</a><span>, in § 6.1</span>
   <li><a href="#layoutconstraints">LayoutConstraints</a><span>, in § 4.4</span>
   <li><a href="#dictdef-layoutconstraintsoptions">LayoutConstraintsOptions</a><span>, in § 4.4.1</span>
   <li><a href="#layout-definition">layout definition</a><span>, in § 3.1</span>
   <li><a href="#layout-definitions">layout definitions</a><span>, in § 3.2</span>
   <li><a href="#layoutedges">LayoutEdges</a><span>, in § 4.6</span>
   <li><a href="#layoutfragment">LayoutFragment</a><span>, in § 4.2</span>
   <li><a href="#layout-definition-layout-function">layout function</a><span>, in § 3.1</span>
   <li><a href="#dom-layoutchild-layoutnextfragment">layoutNextFragment(constraints, breakToken)</a><span>, in § 4.1</span>
   <li>
    layout options
    <ul>
     <li><a href="#document-layout-definition-layout-options">dfn for document layout definition</a><span>, in § 3.1</span>
     <li><a href="#layout-definition-layout-options">dfn for layout definition</a><span>, in § 3.1</span>
    </ul>
   <li><a href="#dictdef-layoutoptions">LayoutOptions</a><span>, in § 3.2</span>
   <li><a href="#enumdef-layoutsizingmode">LayoutSizingMode</a><span>, in § 3.2</span>
   <li><a href="#dom-css-layoutworklet">layoutWorklet</a><span>, in § 3</span>
   <li><a href="#layoutworkletglobalscope">LayoutWorkletGlobalScope</a><span>, in § 3</span>
   <li><a href="#dom-breaktype-line">"line"</a><span>, in § 4.5</span>
   <li><a href="#dom-layoutsizingmode-manual">"manual"</a><span>, in § 3.2</span>
   <li>
    maxContentSize
    <ul>
     <li><a href="#dom-intrinsicsizes-maxcontentsize">attribute for IntrinsicSizes</a><span>, in § 4.3</span>
     <li><a href="#dom-intrinsicsizesresultoptions-maxcontentsize">dict-member for IntrinsicSizesResultOptions</a><span>, in § 6.2</span>
    </ul>
   <li>
    minContentSize
    <ul>
     <li><a href="#dom-intrinsicsizes-mincontentsize">attribute for IntrinsicSizes</a><span>, in § 4.3</span>
     <li><a href="#dom-intrinsicsizesresultoptions-mincontentsize">dict-member for IntrinsicSizesResultOptions</a><span>, in § 6.2</span>
    </ul>
   <li><a href="#layout-api-context-mode">mode</a><span>, in § 6.1</span>
   <li>
    "none"
    <ul>
     <li><a href="#dom-blockfragmentationtype-none">enum-value for BlockFragmentationType</a><span>, in § 4.4</span>
     <li><a href="#dom-breaktype-none">enum-value for BreakType</a><span>, in § 4.5</span>
    </ul>
   <li><a href="#dom-childdisplaytype-normal">"normal"</a><span>, in § 3.2</span>
   <li>
    "page"
    <ul>
     <li><a href="#dom-blockfragmentationtype-page">enum-value for BlockFragmentationType</a><span>, in § 4.4</span>
     <li><a href="#dom-breaktype-page">enum-value for BreakType</a><span>, in § 4.5</span>
    </ul>
   <li><a href="#parent-layout">parent layout</a><span>, in § 3.3</span>
   <li>
    percentageBlockSize
    <ul>
     <li><a href="#dom-layoutconstraints-percentageblocksize">attribute for LayoutConstraints</a><span>, in § 4.4</span>
     <li><a href="#dom-layoutconstraintsoptions-percentageblocksize">dict-member for LayoutConstraintsOptions</a><span>, in § 4.4.1</span>
    </ul>
   <li>
    percentageInlineSize
    <ul>
     <li><a href="#dom-layoutconstraints-percentageinlinesize">attribute for LayoutConstraints</a><span>, in § 4.4</span>
     <li><a href="#dom-layoutconstraintsoptions-percentageinlinesize">dict-member for LayoutConstraintsOptions</a><span>, in § 4.4.1</span>
    </ul>
   <li><a href="#layout-api-work-task-promise">promise</a><span>, in § 6.1</span>
   <li>
    "region"
    <ul>
     <li><a href="#dom-blockfragmentationtype-region">enum-value for BlockFragmentationType</a><span>, in § 4.4</span>
     <li><a href="#dom-breaktype-region">enum-value for BreakType</a><span>, in § 4.5</span>
    </ul>
   <li><a href="#dom-layoutworkletglobalscope-registerlayout">registerLayout(name, layoutCtor)</a><span>, in § 3.2</span>
   <li><a href="#run-a-work-queue">run a work queue</a><span>, in § 6.2.4</span>
   <li><a href="#dom-layoutoptions-sizing">sizing</a><span>, in § 3.2</span>
   <li><a href="#dom-layoutchild-stylemap-slot">[[styleMap]]</a><span>, in § 4.1</span>
   <li>
    styleMap
    <ul>
     <li><a href="#dom-layoutchild-stylemap">attribute for LayoutChild</a><span>, in § 4.1</span>
     <li><a href="#stylemap">definition of</a><span>, in § 3.2</span>
    </ul>
   <li><a href="#layout-api-work-task-task-type">task type</a><span>, in § 6.1</span>
   <li><a href="#translate-a-layoutconstraintsoptions-to-internal-constraints">translate a LayoutConstraintsOptions to internal constraints</a><span>, in § 4.4.1</span>
   <li>
    [[unique id]]
    <ul>
     <li><a href="#dom-childbreaktoken-unique-id-slot">attribute for ChildBreakToken</a><span>, in § 4.5</span>
     <li><a href="#dom-fragmentresult-unique-id-slot">attribute for FragmentResult</a><span>, in § 6.2</span>
     <li><a href="#dom-layoutchild-unique-id-slot">attribute for LayoutChild</a><span>, in § 4.1</span>
     <li><a href="#dom-layoutfragment-unique-id-slot">attribute for LayoutFragment</a><span>, in § 4.2</span>
    </ul>
   <li><a href="#layout-api-context-unique-id">unique id</a><span>, in § 6.1</span>
   <li><a href="#update-a-layout-child-style">update a layout child style</a><span>, in § 4.1.1</span>
   <li><a href="#layout-api-context-work-queue">work queue</a><span>, in § 6.1</span>
  </ul>
  <h3 class="no-num no-ref heading settled" id="index-defined-elsewhere"><span class="content">Terms defined by reference</span><a class="self-link" href="#index-defined-elsewhere"></a></h3>
  <ul class="index">
   <li>
    <a data-link-type="biblio">[]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="26ebcd74">box model edges</span>
     <li><span class="dfn-paneled" id="5b322f88">Construct</span>
     <li><span class="dfn-paneled" id="b181fb6a">constructor</span>
     <li><span class="dfn-paneled" id="c43fb743">function</span>
     <li><span class="dfn-paneled" id="6aabef20">Get</span>
     <li><span class="dfn-paneled" id="682c2a6a">static position</span>
     <li><span class="dfn-paneled" id="67d3c8a4">structureddeserialize</span>
     <li><span class="dfn-paneled" id="d5538b86">structuredserializeforstorage</span>
     <li><span class="dfn-paneled" id="c4df1374">type</span>
     <li><span class="dfn-paneled" id="4739df91">TypeError</span>
    </ul>
   <li>
    <a data-link-type="biblio">[CSS-BOX-4]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="cecbe9cd">margin</span>
    </ul>
   <li>
    <a data-link-type="biblio">[CSS-BREAK-3]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="9522389e">break-inside</span>
     <li><span class="dfn-paneled" id="9729fd44">fragment</span>
    </ul>
   <li>
    <a data-link-type="biblio">[CSS-BREAK-4]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="6458a3ef">fragmentation break</span>
    </ul>
   <li>
    <a data-link-type="biblio">[CSS-CASCADE-5]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="9cd25054">computed value</span>
    </ul>
   <li>
    <a data-link-type="biblio">[CSS-DISPLAY-4]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="671b24ea">&lt;display-inside></span>
     <li><span class="dfn-paneled" id="28f7b01c">&lt;display-outside></span>
     <li><span class="dfn-paneled" id="43b15e47">anonymous box</span>
     <li><span class="dfn-paneled" id="a18c5781">atomic inline</span>
     <li><span class="dfn-paneled" id="8e39589a">block box</span>
     <li><span class="dfn-paneled" id="ca960d4f">block formatting context</span>
     <li><span class="dfn-paneled" id="8379845e">block-level</span>
     <li><span class="dfn-paneled" id="5568b839">blockification</span>
     <li><span class="dfn-paneled" id="1a548a6a">blockify</span>
     <li><span class="dfn-paneled" id="df19338c">box tree</span>
     <li><span class="dfn-paneled" id="ea663a43">containing block</span>
     <li><span class="dfn-paneled" id="e7f0dd6c">display</span>
     <li><span class="dfn-paneled" id="f271d0a1">flow layout</span>
     <li><span class="dfn-paneled" id="b8f126f1">inline formatting context</span>
     <li><span class="dfn-paneled" id="d7fa3e1c">inline-level</span>
     <li><span class="dfn-paneled" id="f27b1fe0">inlinify</span>
     <li><span class="dfn-paneled" id="a8485ff4">replaced element</span>
    </ul>
   <li>
    <a data-link-type="biblio">[CSS-FLEXBOX-1]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="24285d87">flex container</span>
    </ul>
   <li>
    <a data-link-type="biblio">[CSS-GRID-2]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="f005b2f6">grid container</span>
    </ul>
   <li>
    <a data-link-type="biblio">[CSS-INLINE-3]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="6f7798a0">root inline box</span>
    </ul>
   <li>
    <a data-link-type="biblio">[CSS-OVERFLOW-3]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="86928bde">overflow</span>
     <li><span class="dfn-paneled" id="b2a71e73">scrollable overflow</span>
    </ul>
   <li>
    <a data-link-type="biblio">[CSS-PAGE-FLOATS-3]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="a9ae485f">float</span>
    </ul>
   <li>
    <a data-link-type="biblio">[CSS-POSITION-3]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="b8a0ba74">position</span>
     <li><span class="dfn-paneled" id="cbe444e7">relatively position</span>
     <li><span class="dfn-paneled" id="288dfcac">static</span>
    </ul>
   <li>
    <a data-link-type="biblio">[CSS-PSEUDO-4]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="fd0c9e35">::after</span>
     <li><span class="dfn-paneled" id="5869f885">::before</span>
     <li><span class="dfn-paneled" id="a1addf6c">::first-letter</span>
     <li><span class="dfn-paneled" id="75bfa627">::first-line</span>
    </ul>
   <li>
    <a data-link-type="biblio">[CSS-SHAPES-2]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="350c6cee">display</span>
    </ul>
   <li>
    <a data-link-type="biblio">[CSS-SIZING-3]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="0e5cedd7">auto</span>
     <li><span class="dfn-paneled" id="11ee6625">available space</span>
     <li><span class="dfn-paneled" id="aba62b39">intrinsic size</span>
     <li><span class="dfn-paneled" id="26a40c98">max-content size</span>
     <li><span class="dfn-paneled" id="3f0db204">min-content size</span>
     <li><span class="dfn-paneled" id="126bc6b7">stretch-fit inline size</span>
    </ul>
   <li>
    <a data-link-type="biblio">[CSS-TYPED-OM-1]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="32c697dc">StylePropertyMapReadOnly</span>
    </ul>
   <li>
    <a data-link-type="biblio">[CSS-VALUES-4]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="9213678e">&lt;ident></span>
    </ul>
   <li>
    <a data-link-type="biblio">[CSS-VARIABLES-2]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="198f1537">custom property</span>
    </ul>
   <li>
    <a data-link-type="biblio">[CSS-WRITING-MODES-4]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="a903fb73">abstract dimensions</span>
     <li><span class="dfn-paneled" id="190183bb">block size</span>
     <li><span class="dfn-paneled" id="1370dad0">block-start</span>
     <li><span class="dfn-paneled" id="37f0daea">inline size</span>
     <li><span class="dfn-paneled" id="466b2ed9">inline-start</span>
    </ul>
   <li>
    <a data-link-type="biblio">[CSS21]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="5455396f">z-index</span>
    </ul>
   <li>
    <a data-link-type="biblio">[CSS22]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="d332e4ec">auto</span>
    </ul>
   <li>
    <a data-link-type="biblio">[CSS3-DISPLAY]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="5722daa9">box</span>
     <li><span class="dfn-paneled" id="5778d843">inline</span>
     <li><span class="dfn-paneled" id="aadf4a05">none</span>
    </ul>
   <li>
    <a data-link-type="biblio">[CSSOM-1]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="a43c62be">CSS</span>
     <li><span class="dfn-paneled" id="e11b0bf7">supported CSS property</span>
    </ul>
   <li>
    <a data-link-type="biblio">[DOM]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="a973e0fe">document</span>
     <li><span class="dfn-paneled" id="27d9b7ea">element</span>
    </ul>
   <li>
    <a data-link-type="biblio">[HTML]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="2879c404">Worklet</span>
     <li><span class="dfn-paneled" id="0c9b0d3c">WorkletGlobalScope</span>
     <li><span class="dfn-paneled" id="e4ffa115">create a worklet global scope</span>
     <li><span class="dfn-paneled" id="6f738b30">global scopes</span>
     <li><span class="dfn-paneled" id="a72449dd">in parallel</span>
     <li><span class="dfn-paneled" id="8603b31a">perform a microtask checkpoint</span>
     <li><span class="dfn-paneled" id="9a517a7d">queue a task</span>
     <li><span class="dfn-paneled" id="b75a7d23">realm</span>
     <li><span class="dfn-paneled" id="3b8ce5a6">worklet global scope type</span>
    </ul>
   <li>
    <a data-link-type="biblio">[INFRA]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="53275e46">append</span>
     <li><span class="dfn-paneled" id="a088e610">convert</span>
     <li><span class="dfn-paneled" id="03afaf9c">empty</span>
     <li><span class="dfn-paneled" id="1243a891">exist</span>
     <li><span class="dfn-paneled" id="16d07e10">for each <small>(for list)</small></span>
     <li><span class="dfn-paneled" id="45209803">for each <small>(for map)</small></span>
     <li><span class="dfn-paneled" id="527b10aa">get</span>
     <li><span class="dfn-paneled" id="649608b9">list</span>
     <li><span class="dfn-paneled" id="3fca5a9e">map</span>
     <li><span class="dfn-paneled" id="0e6b2056">set</span>
     <li><span class="dfn-paneled" id="984221ca">struct</span>
     <li><span class="dfn-paneled" id="cbdc89b4">while</span>
    </ul>
   <li>
    <a data-link-type="biblio">[WEBIDL]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="dca2de17">DOMException</span>
     <li><span class="dfn-paneled" id="8855a9aa">DOMString</span>
     <li><span class="dfn-paneled" id="889e932f">Exposed</span>
     <li><span class="dfn-paneled" id="dcf5fafa">FrozenArray</span>
     <li><span class="dfn-paneled" id="7fb6fbc6">Global</span>
     <li><span class="dfn-paneled" id="cae6bf57">InvalidModificationError</span>
     <li><span class="dfn-paneled" id="797018a7">InvalidStateError</span>
     <li><span class="dfn-paneled" id="3182eb71">NotSupportedError</span>
     <li><span class="dfn-paneled" id="bdbd19d1">Promise</span>
     <li><span class="dfn-paneled" id="a5c91173">SameObject</span>
     <li><span class="dfn-paneled" id="7004c2a7">VoidFunction</span>
     <li><span class="dfn-paneled" id="6c6b1005">any</span>
     <li><span class="dfn-paneled" id="3ab7bf79">callback function</span>
     <li><span class="dfn-paneled" id="8c800cdf">double</span>
     <li><span class="dfn-paneled" id="10ce5f6f">invoke</span>
     <li><span class="dfn-paneled" id="6728fdee">platform object</span>
     <li><span class="dfn-paneled" id="9cce47fd">sequence</span>
     <li><span class="dfn-paneled" id="b4cfa5ce">throw</span>
     <li><span class="dfn-paneled" id="5f90bbfb">undefined</span>
    </ul>
  </ul>
  <h2 class="no-num no-ref heading settled" id="references"><span class="content">References</span><a class="self-link" href="#references"></a></h2>
  <h3 class="no-num no-ref heading settled" id="normative"><span class="content">Normative References</span><a class="self-link" href="#normative"></a></h3>
  <dl>
   <dt id="biblio-css-align-3">[CSS-ALIGN-3]
   <dd>Elika Etemad; Tab Atkins Jr.. <a href="https://drafts.csswg.org/css-align/"><cite>CSS Box Alignment Module Level 3</cite></a>. URL: <a href="https://drafts.csswg.org/css-align/">https://drafts.csswg.org/css-align/</a>
   <dt id="biblio-css-box-4">[CSS-BOX-4]
   <dd>Elika Etemad. <a href="https://drafts.csswg.org/css-box-4/"><cite>CSS Box Model Module Level 4</cite></a>. URL: <a href="https://drafts.csswg.org/css-box-4/">https://drafts.csswg.org/css-box-4/</a>
   <dt id="biblio-css-break-3">[CSS-BREAK-3]
   <dd>Rossen Atanassov; Elika Etemad. <a href="https://drafts.csswg.org/css-break/"><cite>CSS Fragmentation Module Level 3</cite></a>. URL: <a href="https://drafts.csswg.org/css-break/">https://drafts.csswg.org/css-break/</a>
   <dt id="biblio-css-break-4">[CSS-BREAK-4]
   <dd>Rossen Atanassov; Elika Etemad. <a href="https://drafts.csswg.org/css-break-4/"><cite>CSS Fragmentation Module Level 4</cite></a>. URL: <a href="https://drafts.csswg.org/css-break-4/">https://drafts.csswg.org/css-break-4/</a>
   <dt id="biblio-css-cascade-5">[CSS-CASCADE-5]
   <dd>Elika Etemad; Miriam Suzanne; Tab Atkins Jr.. <a href="https://drafts.csswg.org/css-cascade-5/"><cite>CSS Cascading and Inheritance Level 5</cite></a>. URL: <a href="https://drafts.csswg.org/css-cascade-5/">https://drafts.csswg.org/css-cascade-5/</a>
   <dt id="biblio-css-display-4">[CSS-DISPLAY-4]
   <dd><a href="https://drafts.csswg.org/css-display-4/"><cite>CSS Display Module Level 4</cite></a>. Editor's Draft. URL: <a href="https://drafts.csswg.org/css-display-4/">https://drafts.csswg.org/css-display-4/</a>
   <dt id="biblio-css-flexbox-1">[CSS-FLEXBOX-1]
   <dd>Tab Atkins Jr.; et al. <a href="https://drafts.csswg.org/css-flexbox-1/"><cite>CSS Flexible Box Layout Module Level 1</cite></a>. URL: <a href="https://drafts.csswg.org/css-flexbox-1/">https://drafts.csswg.org/css-flexbox-1/</a>
   <dt id="biblio-css-grid-2">[CSS-GRID-2]
   <dd>Tab Atkins Jr.; Elika Etemad; Rossen Atanassov. <a href="https://drafts.csswg.org/css-grid-2/"><cite>CSS Grid Layout Module Level 2</cite></a>. URL: <a href="https://drafts.csswg.org/css-grid-2/">https://drafts.csswg.org/css-grid-2/</a>
   <dt id="biblio-css-inline-3">[CSS-INLINE-3]
   <dd>Elika Etemad. <a href="https://drafts.csswg.org/css-inline-3/"><cite>CSS Inline Layout Module Level 3</cite></a>. URL: <a href="https://drafts.csswg.org/css-inline-3/">https://drafts.csswg.org/css-inline-3/</a>
   <dt id="biblio-css-overflow-3">[CSS-OVERFLOW-3]
   <dd>Elika Etemad; Florian Rivoal. <a href="https://drafts.csswg.org/css-overflow-3/"><cite>CSS Overflow Module Level 3</cite></a>. URL: <a href="https://drafts.csswg.org/css-overflow-3/">https://drafts.csswg.org/css-overflow-3/</a>
   <dt id="biblio-css-page-floats-3">[CSS-PAGE-FLOATS-3]
   <dd>Johannes Wilm. <a href="https://drafts.csswg.org/css-page-floats/"><cite>CSS Page Floats</cite></a>. URL: <a href="https://drafts.csswg.org/css-page-floats/">https://drafts.csswg.org/css-page-floats/</a>
   <dt id="biblio-css-position-3">[CSS-POSITION-3]
   <dd>Elika Etemad; Tab Atkins Jr.. <a href="https://drafts.csswg.org/css-position-3/"><cite>CSS Positioned Layout Module Level 3</cite></a>. URL: <a href="https://drafts.csswg.org/css-position-3/">https://drafts.csswg.org/css-position-3/</a>
   <dt id="biblio-css-pseudo-4">[CSS-PSEUDO-4]
   <dd>Daniel Glazman; Elika Etemad; Alan Stearns. <a href="https://drafts.csswg.org/css-pseudo-4/"><cite>CSS Pseudo-Elements Module Level 4</cite></a>. URL: <a href="https://drafts.csswg.org/css-pseudo-4/">https://drafts.csswg.org/css-pseudo-4/</a>
   <dt id="biblio-css-sizing-3">[CSS-SIZING-3]
   <dd>Tab Atkins Jr.; Elika Etemad. <a href="https://drafts.csswg.org/css-sizing-3/"><cite>CSS Box Sizing Module Level 3</cite></a>. URL: <a href="https://drafts.csswg.org/css-sizing-3/">https://drafts.csswg.org/css-sizing-3/</a>
   <dt id="biblio-css-typed-om-1">[CSS-TYPED-OM-1]
   <dd>Tab Atkins Jr.; François Remy. <a href="https://drafts.css-houdini.org/css-typed-om-1/"><cite>CSS Typed OM Level 1</cite></a>. URL: <a href="https://drafts.css-houdini.org/css-typed-om-1/">https://drafts.css-houdini.org/css-typed-om-1/</a>
   <dt id="biblio-css-values-4">[CSS-VALUES-4]
   <dd>Tab Atkins Jr.; Elika Etemad. <a href="https://drafts.csswg.org/css-values-4/"><cite>CSS Values and Units Module Level 4</cite></a>. URL: <a href="https://drafts.csswg.org/css-values-4/">https://drafts.csswg.org/css-values-4/</a>
   <dt id="biblio-css-variables-2">[CSS-VARIABLES-2]
   <dd><a href="https://drafts.csswg.org/css-variables-2/"><cite>CSS Custom Properties for Cascading Variables Module Level 2</cite></a>. Editor's Draft. URL: <a href="https://drafts.csswg.org/css-variables-2/">https://drafts.csswg.org/css-variables-2/</a>
   <dt id="biblio-css-writing-modes-4">[CSS-WRITING-MODES-4]
   <dd>Elika Etemad; Koji Ishii. <a href="https://drafts.csswg.org/css-writing-modes-4/"><cite>CSS Writing Modes Level 4</cite></a>. URL: <a href="https://drafts.csswg.org/css-writing-modes-4/">https://drafts.csswg.org/css-writing-modes-4/</a>
   <dt id="biblio-css21">[CSS21]
   <dd>Bert Bos; et al. <a href="https://drafts.csswg.org/css2/"><cite>Cascading Style Sheets Level 2 Revision 1 (CSS 2.1) Specification</cite></a>. URL: <a href="https://drafts.csswg.org/css2/">https://drafts.csswg.org/css2/</a>
   <dt id="biblio-css22">[CSS22]
   <dd>Bert Bos. <a href="https://drafts.csswg.org/css2/"><cite>Cascading Style Sheets Level 2 Revision 2 (CSS 2.2) Specification</cite></a>. URL: <a href="https://drafts.csswg.org/css2/">https://drafts.csswg.org/css2/</a>
   <dt id="biblio-css3-display">[CSS3-DISPLAY]
   <dd>Elika Etemad; Tab Atkins Jr.. <a href="https://drafts.csswg.org/css-display/"><cite>CSS Display Module Level 3</cite></a>. URL: <a href="https://drafts.csswg.org/css-display/">https://drafts.csswg.org/css-display/</a>
   <dt id="biblio-cssom-1">[CSSOM-1]
   <dd>Daniel Glazman; Emilio Cobos Álvarez. <a href="https://drafts.csswg.org/cssom/"><cite>CSS Object Model (CSSOM)</cite></a>. URL: <a href="https://drafts.csswg.org/cssom/">https://drafts.csswg.org/cssom/</a>
   <dt id="biblio-dom">[DOM]
   <dd>Anne van Kesteren. <a href="https://dom.spec.whatwg.org/"><cite>DOM Standard</cite></a>. Living Standard. URL: <a href="https://dom.spec.whatwg.org/">https://dom.spec.whatwg.org/</a>
   <dt id="biblio-html">[HTML]
   <dd>Anne van Kesteren; et al. <a href="https://html.spec.whatwg.org/multipage/"><cite>HTML Standard</cite></a>. Living Standard. URL: <a href="https://html.spec.whatwg.org/multipage/">https://html.spec.whatwg.org/multipage/</a>
   <dt id="biblio-infra">[INFRA]
   <dd>Anne van Kesteren; Domenic Denicola. <a href="https://infra.spec.whatwg.org/"><cite>Infra Standard</cite></a>. Living Standard. URL: <a href="https://infra.spec.whatwg.org/">https://infra.spec.whatwg.org/</a>
   <dt id="biblio-webidl">[WEBIDL]
   <dd>Edgar Chen; Timothy Gu. <a href="https://webidl.spec.whatwg.org/"><cite>Web IDL Standard</cite></a>. Living Standard. URL: <a href="https://webidl.spec.whatwg.org/">https://webidl.spec.whatwg.org/</a>
  </dl>
  <h3 class="no-num no-ref heading settled" id="informative"><span class="content">Informative References</span><a class="self-link" href="#informative"></a></h3>
  <dl>
   <dt id="biblio-css-multicol-1">[CSS-MULTICOL-1]
   <dd>Florian Rivoal; Rachel Andrew. <a href="https://drafts.csswg.org/css-multicol/"><cite>CSS Multi-column Layout Module Level 1</cite></a>. URL: <a href="https://drafts.csswg.org/css-multicol/">https://drafts.csswg.org/css-multicol/</a>
   <dt id="biblio-css-shapes-2">[CSS-SHAPES-2]
   <dd><a href="https://drafts.csswg.org/css-shapes-2/"><cite>CSS Shapes Module Level 2</cite></a>. Editor's Draft. URL: <a href="https://drafts.csswg.org/css-shapes-2/">https://drafts.csswg.org/css-shapes-2/</a>
  </dl>
  <h2 class="no-num no-ref heading settled" id="idl-index"><span class="content">IDL Index</span><a class="self-link" href="#idl-index"></a></h2>
<pre class="idl highlight def"><c- b>partial</c-> <c- b>namespace</c-> <a class="idl-code" data-link-type="namespace" href="https://drafts.csswg.org/cssom-1/#namespacedef-css"><c- g>CSS</c-></a> {
    [<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#SameObject"><c- g>SameObject</c-></a>] <c- b>readonly</c-> <c- b>attribute</c-> <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/worklets.html#worklet"><c- n>Worklet</c-></a> <a data-readonly data-type="Worklet" href="#dom-css-layoutworklet"><code><c- g>layoutWorklet</c-></code></a>;
};

[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Global"><c- g>Global</c-></a>=(<a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/worklets.html#worklet"><c- n>Worklet</c-></a>,<a data-link-type="idl-name"><c- n>LayoutWorklet</c-></a>),<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed"><c- g>Exposed</c-></a>=<c- n>LayoutWorklet</c->]
<c- b>interface</c-> <a href="#layoutworkletglobalscope"><code><c- g>LayoutWorkletGlobalScope</c-></code></a> : <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/worklets.html#workletglobalscope"><c- n>WorkletGlobalScope</c-></a> {
    <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-undefined"><c- b>undefined</c-></a> <a class="idl-code" data-link-type="method" href="#dom-layoutworkletglobalscope-registerlayout"><c- g>registerLayout</c-></a>(<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString"><c- b>DOMString</c-></a> <a href="#dom-layoutworkletglobalscope-registerlayout-name-layoutctor-name"><code><c- g>name</c-></code></a>, <a data-link-type="idl-name" href="https://webidl.spec.whatwg.org/#VoidFunction"><c- n>VoidFunction</c-></a> <a href="#dom-layoutworkletglobalscope-registerlayout-name-layoutctor-layoutctor"><code><c- g>layoutCtor</c-></code></a>);
};

[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed"><c- g>Exposed</c-></a>=<c- n>LayoutWorklet</c->]
<c- b>dictionary</c-> <a href="#dictdef-layoutoptions"><code><c- g>LayoutOptions</c-></code></a> {
  <a data-link-type="idl-name" href="#enumdef-childdisplaytype"><c- n>ChildDisplayType</c-></a> <a data-default="&quot;block&quot;" data-type="ChildDisplayType" href="#dom-layoutoptions-childdisplay"><code><c- g>childDisplay</c-></code></a> = "block";
  <a data-link-type="idl-name" href="#enumdef-layoutsizingmode"><c- n>LayoutSizingMode</c-></a> <a data-default="&quot;block-like&quot;" data-type="LayoutSizingMode" href="#dom-layoutoptions-sizing"><code><c- g>sizing</c-></code></a> = "block-like";
};

[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed"><c- g>Exposed</c-></a>=<c- n>LayoutWorklet</c->]
<c- b>enum</c-> <a href="#enumdef-childdisplaytype"><code><c- g>ChildDisplayType</c-></code></a> {
    <a href="#dom-childdisplaytype-block"><code><c- s>"block"</c-></code></a>, // default - "blockifies" the child boxes.
    <a href="#dom-childdisplaytype-normal"><code><c- s>"normal"</c-></code></a>,
};

[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed"><c- g>Exposed</c-></a>=<c- n>LayoutWorklet</c->]
<c- b>enum</c-> <a href="#enumdef-layoutsizingmode"><code><c- g>LayoutSizingMode</c-></code></a> {
    <a href="#dom-layoutsizingmode-block-like"><code><c- s>"block-like"</c-></code></a>, // default - Sizing behaves like block containers.
    <a href="#dom-layoutsizingmode-manual"><code><c- s>"manual"</c-></code></a>, // Sizing is specified by the web developer.
};

[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed"><c- g>Exposed</c-></a>=<c- n>LayoutWorklet</c->]
<c- b>interface</c-> <a href="#layoutchild"><code><c- g>LayoutChild</c-></code></a> {
    <c- b>readonly</c-> <c- b>attribute</c-> <a data-link-type="idl-name" href="https://drafts.css-houdini.org/css-typed-om-1/#stylepropertymapreadonly"><c- n>StylePropertyMapReadOnly</c-></a> <a class="idl-code" data-link-type="attribute" data-readonly data-type="StylePropertyMapReadOnly" href="#dom-layoutchild-stylemap"><c- g>styleMap</c-></a>;

    <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise"><c- b>Promise</c-></a>&lt;<a data-link-type="idl-name" href="#intrinsicsizes"><c- n>IntrinsicSizes</c-></a>> <a class="idl-code" data-link-type="method" href="#dom-layoutchild-intrinsicsizes"><c- g>intrinsicSizes</c-></a>();
    <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise"><c- b>Promise</c-></a>&lt;<a data-link-type="idl-name" href="#layoutfragment"><c- n>LayoutFragment</c-></a>> <a class="idl-code" data-link-type="method" href="#dom-layoutchild-layoutnextfragment"><c- g>layoutNextFragment</c-></a>(<a data-link-type="idl-name" href="#dictdef-layoutconstraintsoptions"><c- n>LayoutConstraintsOptions</c-></a> <a href="#dom-layoutchild-layoutnextfragment-constraints-breaktoken-constraints"><code><c- g>constraints</c-></code></a>, <a data-link-type="idl-name" href="#childbreaktoken"><c- n>ChildBreakToken</c-></a> <a href="#dom-layoutchild-layoutnextfragment-constraints-breaktoken-breaktoken"><code><c- g>breakToken</c-></code></a>);
};

[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed"><c- g>Exposed</c-></a>=<c- n>LayoutWorklet</c->]
<c- b>interface</c-> <a href="#layoutfragment"><code><c- g>LayoutFragment</c-></code></a> {
    <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-double"><c- b>double</c-></a> <a data-readonly data-type="double" href="#dom-layoutfragment-inlinesize"><code><c- g>inlineSize</c-></code></a>;
    <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-double"><c- b>double</c-></a> <a data-readonly data-type="double" href="#dom-layoutfragment-blocksize"><code><c- g>blockSize</c-></code></a>;

    <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-double"><c- b>double</c-></a> <a data-type="double" href="#dom-layoutfragment-inlineoffset"><code><c- g>inlineOffset</c-></code></a>;
    <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-double"><c- b>double</c-></a> <a data-type="double" href="#dom-layoutfragment-blockoffset"><code><c- g>blockOffset</c-></code></a>;

    <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-any"><c- b>any</c-></a> <a data-readonly data-type="any" href="#dom-layoutfragment-data"><code><c- g>data</c-></code></a>;

    <c- b>readonly</c-> <c- b>attribute</c-> <a data-link-type="idl-name" href="#childbreaktoken"><c- n>ChildBreakToken</c-></a>? <a data-readonly data-type="ChildBreakToken?" href="#dom-layoutfragment-breaktoken"><code><c- g>breakToken</c-></code></a>;
};

[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed"><c- g>Exposed</c-></a>=<c- n>LayoutWorklet</c->]
<c- b>interface</c-> <a href="#intrinsicsizes"><code><c- g>IntrinsicSizes</c-></code></a> {
  <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-double"><c- b>double</c-></a> <a data-readonly data-type="double" href="#dom-intrinsicsizes-mincontentsize"><code><c- g>minContentSize</c-></code></a>;
  <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-double"><c- b>double</c-></a> <a data-readonly data-type="double" href="#dom-intrinsicsizes-maxcontentsize"><code><c- g>maxContentSize</c-></code></a>;
};

[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed"><c- g>Exposed</c-></a>=<c- n>LayoutWorklet</c->]
<c- b>interface</c-> <a href="#layoutconstraints"><code><c- g>LayoutConstraints</c-></code></a> {
    <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-double"><c- b>double</c-></a> <a data-readonly data-type="double" href="#dom-layoutconstraints-availableinlinesize"><code><c- g>availableInlineSize</c-></code></a>;
    <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-double"><c- b>double</c-></a> <a data-readonly data-type="double" href="#dom-layoutconstraints-availableblocksize"><code><c- g>availableBlockSize</c-></code></a>;

    <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-double"><c- b>double</c-></a>? <a data-readonly data-type="double?" href="#dom-layoutconstraints-fixedinlinesize"><code><c- g>fixedInlineSize</c-></code></a>;
    <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-double"><c- b>double</c-></a>? <a data-readonly data-type="double?" href="#dom-layoutconstraints-fixedblocksize"><code><c- g>fixedBlockSize</c-></code></a>;

    <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-double"><c- b>double</c-></a> <a data-readonly data-type="double" href="#dom-layoutconstraints-percentageinlinesize"><code><c- g>percentageInlineSize</c-></code></a>;
    <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-double"><c- b>double</c-></a> <a data-readonly data-type="double" href="#dom-layoutconstraints-percentageblocksize"><code><c- g>percentageBlockSize</c-></code></a>;

    <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-double"><c- b>double</c-></a>? <a data-readonly data-type="double?" href="#dom-layoutconstraints-blockfragmentationoffset"><code><c- g>blockFragmentationOffset</c-></code></a>;
    <c- b>readonly</c-> <c- b>attribute</c-> <a data-link-type="idl-name" href="#enumdef-blockfragmentationtype"><c- n>BlockFragmentationType</c-></a> <a data-readonly data-type="BlockFragmentationType" href="#dom-layoutconstraints-blockfragmentationtype"><code><c- g>blockFragmentationType</c-></code></a>;

    <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-any"><c- b>any</c-></a> <a data-readonly data-type="any" href="#dom-layoutconstraints-data"><code><c- g>data</c-></code></a>;
};

<c- b>enum</c-> <a href="#enumdef-blockfragmentationtype"><code><c- g>BlockFragmentationType</c-></code></a> { <a href="#dom-blockfragmentationtype-none"><code><c- s>"none"</c-></code></a>, <a href="#dom-blockfragmentationtype-page"><code><c- s>"page"</c-></code></a>, <a href="#dom-blockfragmentationtype-column"><code><c- s>"column"</c-></code></a>, <a href="#dom-blockfragmentationtype-region"><code><c- s>"region"</c-></code></a> };

<c- b>dictionary</c-> <a href="#dictdef-layoutconstraintsoptions"><code><c- g>LayoutConstraintsOptions</c-></code></a> {
    <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-double"><c- b>double</c-></a> <a data-type="double" href="#dom-layoutconstraintsoptions-availableinlinesize"><code><c- g>availableInlineSize</c-></code></a>;
    <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-double"><c- b>double</c-></a> <a data-type="double" href="#dom-layoutconstraintsoptions-availableblocksize"><code><c- g>availableBlockSize</c-></code></a>;

    <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-double"><c- b>double</c-></a> <a data-type="double" href="#dom-layoutconstraintsoptions-fixedinlinesize"><code><c- g>fixedInlineSize</c-></code></a>;
    <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-double"><c- b>double</c-></a> <a data-type="double" href="#dom-layoutconstraintsoptions-fixedblocksize"><code><c- g>fixedBlockSize</c-></code></a>;

    <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-double"><c- b>double</c-></a> <a data-type="double" href="#dom-layoutconstraintsoptions-percentageinlinesize"><code><c- g>percentageInlineSize</c-></code></a>;
    <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-double"><c- b>double</c-></a> <a data-type="double" href="#dom-layoutconstraintsoptions-percentageblocksize"><code><c- g>percentageBlockSize</c-></code></a>;

    <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-double"><c- b>double</c-></a> <a data-type="double" href="#dom-layoutconstraintsoptions-blockfragmentationoffset"><code><c- g>blockFragmentationOffset</c-></code></a>;
    <a data-link-type="idl-name" href="#enumdef-blockfragmentationtype"><c- n>BlockFragmentationType</c-></a> <a data-default="&quot;none&quot;" data-type="BlockFragmentationType" href="#dom-layoutconstraintsoptions-blockfragmentationtype"><code><c- g>blockFragmentationType</c-></code></a> = "none";

    <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-any"><c- b>any</c-></a> <a data-type="any" href="#dom-layoutconstraintsoptions-data"><code><c- g>data</c-></code></a>;
};

[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed"><c- g>Exposed</c-></a>=<c- n>LayoutWorklet</c->]
<c- b>interface</c-> <a href="#childbreaktoken"><code><c- g>ChildBreakToken</c-></code></a> {
    <c- b>readonly</c-> <c- b>attribute</c-> <a data-link-type="idl-name" href="#enumdef-breaktype"><c- n>BreakType</c-></a> <a data-readonly data-type="BreakType" href="#dom-childbreaktoken-breaktype"><code><c- g>breakType</c-></code></a>;
    <c- b>readonly</c-> <c- b>attribute</c-> <a data-link-type="idl-name" href="#layoutchild"><c- n>LayoutChild</c-></a> <a data-readonly data-type="LayoutChild" href="#dom-childbreaktoken-child"><code><c- g>child</c-></code></a>;
};

[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed"><c- g>Exposed</c-></a>=<c- n>LayoutWorklet</c->]
<c- b>interface</c-> <a href="#breaktoken"><code><c- g>BreakToken</c-></code></a> {
    <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-frozen-array"><c- b>FrozenArray</c-></a>&lt;<a data-link-type="idl-name" href="#childbreaktoken"><c- n>ChildBreakToken</c-></a>> <a data-readonly data-type="FrozenArray<ChildBreakToken>" href="#dom-breaktoken-childbreaktokens"><code><c- g>childBreakTokens</c-></code></a>;
    <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-any"><c- b>any</c-></a> <a data-readonly data-type="any" href="#dom-breaktoken-data"><code><c- g>data</c-></code></a>;
};

<c- b>dictionary</c-> <a href="#dictdef-breaktokenoptions"><code><c- g>BreakTokenOptions</c-></code></a> {
    <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#idl-sequence"><c- b>sequence</c-></a>&lt;<a data-link-type="idl-name" href="#childbreaktoken"><c- n>ChildBreakToken</c-></a>> <a data-type="sequence<ChildBreakToken>" href="#dom-breaktokenoptions-childbreaktokens"><code><c- g>childBreakTokens</c-></code></a>;
    <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-any"><c- b>any</c-></a> <a data-default="null" data-type="any" href="#dom-breaktokenoptions-data"><code><c- g>data</c-></code></a> = <c- b>null</c->;
};

<c- b>enum</c-> <a href="#enumdef-breaktype"><code><c- g>BreakType</c-></code></a> { <a href="#dom-breaktype-none"><code><c- s>"none"</c-></code></a>, <a href="#dom-breaktype-line"><code><c- s>"line"</c-></code></a>, <a href="#dom-breaktype-column"><code><c- s>"column"</c-></code></a>, <a href="#dom-breaktype-page"><code><c- s>"page"</c-></code></a>, <a href="#dom-breaktype-region"><code><c- s>"region"</c-></code></a> };

[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed"><c- g>Exposed</c-></a>=<c- n>LayoutWorklet</c->]
<c- b>interface</c-> <a href="#layoutedges"><code><c- g>LayoutEdges</c-></code></a> {
  <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-double"><c- b>double</c-></a> <a data-readonly data-type="double" href="#dom-layoutedges-inlinestart"><code><c- g>inlineStart</c-></code></a>;
  <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-double"><c- b>double</c-></a> <a data-readonly data-type="double" href="#dom-layoutedges-inlineend"><code><c- g>inlineEnd</c-></code></a>;

  <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-double"><c- b>double</c-></a> <a data-readonly data-type="double" href="#dom-layoutedges-blockstart"><code><c- g>blockStart</c-></code></a>;
  <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-double"><c- b>double</c-></a> <a data-readonly data-type="double" href="#dom-layoutedges-blockend"><code><c- g>blockEnd</c-></code></a>;

  // Convenience attributes for the sum in one direction.
  <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-double"><c- b>double</c-></a> <a data-readonly data-type="double" href="#dom-layoutedges-inline"><code><c- g>inline</c-></code></a>;
  <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-double"><c- b>double</c-></a> <a data-readonly data-type="double" href="#dom-layoutedges-block"><code><c- g>block</c-></code></a>;
};

// This is the final return value from the author defined layout() method.
<c- b>dictionary</c-> <a href="#dictdef-fragmentresultoptions"><code><c- g>FragmentResultOptions</c-></code></a> {
    <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-double"><c- b>double</c-></a> <a data-default="0" data-type="double" href="#dom-fragmentresultoptions-inlinesize"><code><c- g>inlineSize</c-></code></a> = 0;
    <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-double"><c- b>double</c-></a> <a data-default="0" data-type="double" href="#dom-fragmentresultoptions-blocksize"><code><c- g>blockSize</c-></code></a> = 0;
    <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-double"><c- b>double</c-></a> <a data-default="0" data-type="double" href="#dom-fragmentresultoptions-autoblocksize"><code><c- g>autoBlockSize</c-></code></a> = 0;
    <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#idl-sequence"><c- b>sequence</c-></a>&lt;<a data-link-type="idl-name" href="#layoutfragment"><c- n>LayoutFragment</c-></a>> <a data-default="[]" data-type="sequence<LayoutFragment>" href="#dom-fragmentresultoptions-childfragments"><code><c- g>childFragments</c-></code></a> = [];
    <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-any"><c- b>any</c-></a> <a data-default="null" data-type="any" href="#dom-fragmentresultoptions-data"><code><c- g>data</c-></code></a> = <c- b>null</c->;
    <a data-link-type="idl-name" href="#dictdef-breaktokenoptions"><c- n>BreakTokenOptions</c-></a> <a data-default="null" data-type="BreakTokenOptions" href="#dom-fragmentresultoptions-breaktoken"><code><c- g>breakToken</c-></code></a> = <c- b>null</c->;
};

[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed"><c- g>Exposed</c-></a>=<c- n>LayoutWorklet</c->]
<c- b>interface</c-> <a href="#fragmentresult"><code><c- g>FragmentResult</c-></code></a> {
    <a class="idl-code" data-link-type="constructor" href="#dom-fragmentresult-fragmentresult"><c- g>constructor</c-></a>(<c- b>optional</c-> <a data-link-type="idl-name" href="#dictdef-fragmentresultoptions"><c- n>FragmentResultOptions</c-></a> <a href="#dom-fragmentresult-fragmentresult-options-options"><code><c- g>options</c-></code></a> = {});
    <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-double"><c- b>double</c-></a> <a class="idl-code" data-link-type="attribute" data-readonly data-type="double" href="#dom-fragmentresult-inlinesize"><c- g>inlineSize</c-></a>;
    <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-double"><c- b>double</c-></a> <a class="idl-code" data-link-type="attribute" data-readonly data-type="double" href="#dom-fragmentresult-blocksize"><c- g>blockSize</c-></a>;
};

<c- b>dictionary</c-> <a href="#dictdef-intrinsicsizesresultoptions"><code><c- g>IntrinsicSizesResultOptions</c-></code></a> {
    <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-double"><c- b>double</c-></a> <a data-type="double" href="#dom-intrinsicsizesresultoptions-maxcontentsize"><code><c- g>maxContentSize</c-></code></a>;
    <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-double"><c- b>double</c-></a> <a data-type="double" href="#dom-intrinsicsizesresultoptions-mincontentsize"><code><c- g>minContentSize</c-></code></a>;
};

</pre>