<!doctype html><html lang="en">
 <head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
  <title>CSS Painting API Level 1</title>
  <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
  <meta content="ED" name="w3c-status">
  <link href="../default.css" rel="stylesheet" type="text/css">
  <link href="../csslogo.ico" rel="shortcut icon" type="image/x-icon">
  <link href="https://www.w3.org/StyleSheets/TR/2016/W3C-ED" rel="stylesheet" type="text/css">
  <link href="http://www.w3.org/TR/2016/WD-css-paint-api-1-20160607/" rel="canonical">
<style>
/* Put nice boxes around each algorithm. */
[data-algorithm]:not(.heading) {
    padding: .5em;
    border: thin solid #ddd; border-radius: .5em;
    margin: .5em calc(-0.5em - 1px);
}
[data-algorithm]:not(.heading) > :first-child {
    margin-top: 0;
}
[data-algorithm]:not(.heading) > :last-child {
    margin-bottom: 0;
}
</style>
<style>/* style-md-lists */

/* This is a weird hack for me not yet following the commonmark spec
   regarding paragraph and lists. */
[data-md] > :first-child {
    margin-top: 0;
}
[data-md] > :last-child {
    margin-bottom: 0;
}</style>
<style>/* style-selflinks */

.heading, .issue, .note, .example, li, dt {
    position: relative;
}
a.self-link {
    position: absolute;
    top: 0;
    left: calc(-1 * (3.5rem - 26px));
    width: calc(3.5rem - 26px);
    height: 2em;
    text-align: center;
    border: none;
    transition: opacity .2s;
    opacity: .5;
}
a.self-link:hover {
    opacity: 1;
}
.heading > a.self-link {
    font-size: 83%;
}
li > a.self-link {
    left: calc(-1 * (3.5rem - 26px) - 2em);
}
dfn > a.self-link {
    top: auto;
    left: auto;
    opacity: 0;
    width: 1.5em;
    height: 1.5em;
    background: gray;
    color: white;
    font-style: normal;
    transition: opacity .2s, background-color .2s, color .2s;
}
dfn:hover > a.self-link {
    opacity: 1;
}
dfn > a.self-link:hover {
    color: black;
}

a.self-link::before            { content: "¶"; }
.heading > a.self-link::before { content: "§"; }
dfn > a.self-link::before      { content: "#"; }</style>
<style>/* style-counters */

body {
    counter-reset: example figure issue;
}
.issue {
    counter-increment: issue;
}
.issue:not(.no-marker)::before {
    content: "Issue " counter(issue);
}

.example {
    counter-increment: example;
}
.example:not(.no-marker)::before {
    content: "Example " counter(example);
}
.invalid.example:not(.no-marker)::before,
.illegal.example:not(.no-marker)::before {
    content: "Invalid Example" counter(example);
}

figcaption {
    counter-increment: figure;
}
figcaption:not(.no-marker)::before {
    content: "Figure " counter(figure) " ";
}</style>
<style>/* style-autolinks */

.css.css, .property.property, .descriptor.descriptor {
    color: #005a9c;
    font-size: inherit;
    font-family: inherit;
}
.css::before, .property::before, .descriptor::before {
    content: "‘";
}
.css::after, .property::after, .descriptor::after {
    content: "’";
}
.property, .descriptor {
    /* Don't wrap property and descriptor names */
    white-space: nowrap;
}
.type { /* CSS value <type> */
    font-style: italic;
}
pre .property::before, pre .property::after {
    content: "";
}
[data-link-type="property"]::before,
[data-link-type="propdesc"]::before,
[data-link-type="descriptor"]::before,
[data-link-type="value"]::before,
[data-link-type="function"]::before,
[data-link-type="at-rule"]::before,
[data-link-type="selector"]::before,
[data-link-type="maybe"]::before {
    content: "‘";
}
[data-link-type="property"]::after,
[data-link-type="propdesc"]::after,
[data-link-type="descriptor"]::after,
[data-link-type="value"]::after,
[data-link-type="function"]::after,
[data-link-type="at-rule"]::after,
[data-link-type="selector"]::after,
[data-link-type="maybe"]::after {
    content: "’";
}

[data-link-type].production::before,
[data-link-type].production::after,
.prod [data-link-type]::before,
.prod [data-link-type]::after {
    content: "";
}

[data-link-type=element],
[data-link-type=element-attr] {
    font-family: Menlo, Consolas, "DejaVu Sans Mono", monospace;
    font-size: .9em;
}
[data-link-type=element]::before { content: "<" }
[data-link-type=element]::after  { content: ">" }

[data-link-type=biblio] {
    white-space: pre;
}</style>
<style>/* style-dfn-panel */

        .dfn-panel {
            position: absolute;
            z-index: 35;
            height: auto;
            width: -webkit-fit-content;
            width: fit-content;
            max-width: 300px;
            max-height: 500px;
            overflow: auto;
            padding: 0.5em 0.75em;
            font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
            background: #DDDDDD;
            color: black;
            border: outset 0.2em;
        }
        .dfn-panel:not(.on) { display: none; }
        .dfn-panel * { margin: 0; padding: 0; text-indent: 0; }
        .dfn-panel > b { display: block; }
        .dfn-panel a { color: black; }
        .dfn-panel a:not(:hover) { text-decoration: none !important; border-bottom: none !important; }
        .dfn-panel > b + b { margin-top: 0.25em; }
        .dfn-panel ul { padding: 0; }
        .dfn-panel li { list-style: inside; }
        .dfn-panel.activated {
            display: inline-block;
            position: fixed;
            left: .5em;
            bottom: 2em;
            margin: 0 auto;
            max-width: calc(100vw - 1.5em - .4em - .5em);
            max-height: 30vh;
        }

        .dfn-paneled { cursor: pointer; }
        </style>
<style>/* style-syntax-highlighting */
pre.idl.highlight { color: #708090; }
.highlight:not(.idl) { background: hsl(24, 20%, 95%); }
code.highlight { padding: .1em; border-radius: .3em; }
pre.highlight, pre > code.highlight { display: block; padding: 1em; margin: .5em 0; overflow: auto; border-radius: 0; }
.highlight .c { color: #708090 } /* Comment */
.highlight .k { color: #990055 } /* Keyword */
.highlight .l { color: #000000 } /* Literal */
.highlight .n { color: #0077aa } /* Name */
.highlight .o { color: #999999 } /* Operator */
.highlight .p { color: #999999 } /* Punctuation */
.highlight .cm { color: #708090 } /* Comment.Multiline */
.highlight .cp { color: #708090 } /* Comment.Preproc */
.highlight .c1 { color: #708090 } /* Comment.Single */
.highlight .cs { color: #708090 } /* Comment.Special */
.highlight .kc { color: #990055 } /* Keyword.Constant */
.highlight .kd { color: #990055 } /* Keyword.Declaration */
.highlight .kn { color: #990055 } /* Keyword.Namespace */
.highlight .kp { color: #990055 } /* Keyword.Pseudo */
.highlight .kr { color: #990055 } /* Keyword.Reserved */
.highlight .kt { color: #990055 } /* Keyword.Type */
.highlight .ld { color: #000000 } /* Literal.Date */
.highlight .m { color: #000000 } /* Literal.Number */
.highlight .s { color: #a67f59 } /* Literal.String */
.highlight .na { color: #0077aa } /* Name.Attribute */
.highlight .nc { color: #0077aa } /* Name.Class */
.highlight .no { color: #0077aa } /* Name.Constant */
.highlight .nd { color: #0077aa } /* Name.Decorator */
.highlight .ni { color: #0077aa } /* Name.Entity */
.highlight .ne { color: #0077aa } /* Name.Exception */
.highlight .nf { color: #0077aa } /* Name.Function */
.highlight .nl { color: #0077aa } /* Name.Label */
.highlight .nn { color: #0077aa } /* Name.Namespace */
.highlight .py { color: #0077aa } /* Name.Property */
.highlight .nt { color: #669900 } /* Name.Tag */
.highlight .nv { color: #222222 } /* Name.Variable */
.highlight .ow { color: #999999 } /* Operator.Word */
.highlight .mb { color: #000000 } /* Literal.Number.Bin */
.highlight .mf { color: #000000 } /* Literal.Number.Float */
.highlight .mh { color: #000000 } /* Literal.Number.Hex */
.highlight .mi { color: #000000 } /* Literal.Number.Integer */
.highlight .mo { color: #000000 } /* Literal.Number.Oct */
.highlight .sb { color: #a67f59 } /* Literal.String.Backtick */
.highlight .sc { color: #a67f59 } /* Literal.String.Char */
.highlight .sd { color: #a67f59 } /* Literal.String.Doc */
.highlight .s2 { color: #a67f59 } /* Literal.String.Double */
.highlight .se { color: #a67f59 } /* Literal.String.Escape */
.highlight .sh { color: #a67f59 } /* Literal.String.Heredoc */
.highlight .si { color: #a67f59 } /* Literal.String.Interpol */
.highlight .sx { color: #a67f59 } /* Literal.String.Other */
.highlight .sr { color: #a67f59 } /* Literal.String.Regex */
.highlight .s1 { color: #a67f59 } /* Literal.String.Single */
.highlight .ss { color: #a67f59 } /* Literal.String.Symbol */
.highlight .vc { color: #0077aa } /* Name.Variable.Class */
.highlight .vg { color: #0077aa } /* Name.Variable.Global */
.highlight .vi { color: #0077aa } /* Name.Variable.Instance */
.highlight .il { color: #000000 } /* Literal.Number.Integer.Long */
</style>
 <body class="h-entry">
  <div class="head">
   <p data-fill-with="logo"><a class="logo" href="https://www.w3.org/"> <img alt="W3C" height="48" src="https://www.w3.org/StyleSheets/TR/2016/logos/W3C" width="72"> </a> </p>
   <h1 class="p-name no-ref" id="title">CSS Painting API Level 1</h1>
   <h2 class="no-num no-toc no-ref heading settled" id="subtitle"><span class="content">Editor’s Draft, <time class="dt-updated" datetime="1970-01-01">1 January 1970</time></span></h2>
   <div data-fill-with="spec-metadata">
    <dl>
     <dt>This version:
     <dd><a class="u-url" href="https://drafts.css-houdini.org/css-paint-api-1/">https://drafts.css-houdini.org/css-paint-api-1/</a>
     <dt>Latest published version:
     <dd><a href="http://www.w3.org/TR/2016/WD-css-paint-api-1-20160607/">http://www.w3.org/TR/2016/WD-css-paint-api-1-20160607/</a>
     <dt>Previous Versions:
     <dd><a href="http://www.w3.org/TR/2016/WD-css-paint-api-1-20160607/" rel="prev">http://www.w3.org/TR/2016/WD-css-paint-api-1-20160607/</a>
     <dt>Feedback:
     <dd><span><a href="mailto:public-houdini@w3.org?subject=%5Bcss-paint-api%5D%20YOUR%20TOPIC%20HERE">public-houdini@w3.org</a> with subject line “<kbd>[css-paint-api] <i data-lt="">… message topic …</i></kbd>” (<a href="http://lists.w3.org/Archives/Public/public-houdini/" rel="discussion">archives</a>)</span>
     <dt class="editor">Editors:
     <dd class="editor p-author h-card vcard" data-editor-id="47691"><a class="p-name fn u-email email" href="mailto:shanestephens@google.com">Shane Stephens</a>
     <dd class="editor p-author h-card vcard" data-editor-id="73001"><a class="p-name fn u-email email" href="mailto:ikilpatrick@chromium.org">Ian Kilpatrick</a>
     <dd class="editor p-author h-card vcard" data-editor-id="42080"><a class="p-name fn u-email email" href="mailto:dino@apple.com">Dean Jackson</a>
    </dl>
   </div>
   <div data-fill-with="warning"></div>
   <p class="copyright" data-fill-with="copyright"><a href="http://www.w3.org/Consortium/Legal/ipr-notice#Copyright">Copyright</a> © 1970 <a href="http://www.w3.org/"><abbr title="World Wide Web Consortium">W3C</abbr></a><sup>®</sup> (<a href="http://www.csail.mit.edu/"><abbr title="Massachusetts Institute of Technology">MIT</abbr></a>, <a href="http://www.ercim.eu/"><abbr title="European Research Consortium for Informatics and Mathematics">ERCIM</abbr></a>, <a href="http://www.keio.ac.jp/">Keio</a>, <a href="http://ev.buaa.edu.cn/">Beihang</a>). W3C <a href="http://www.w3.org/Consortium/Legal/ipr-notice#Legal_Disclaimer">liability</a>, <a href="http://www.w3.org/Consortium/Legal/ipr-notice#W3C_Trademarks">trademark</a> and <a href="http://www.w3.org/Consortium/Legal/copyright-documents">document use</a> rules apply. </p>
   <hr title="Separator for header">
  </div>
  <div class="p-summary" data-fill-with="abstract">
   <h2 class="no-num no-toc no-ref heading settled" id="abstract"><span class="content">Abstract</span></h2>
   <p>An API for allowing web developers to define a custom CSS <a class="production css" data-link-type="type" href="https://drafts.csswg.org/css-images-3/#typedef-image" id="ref-for-typedef-image">&lt;image></a> with javascript, which will

respond to style and size changes.
See <a href="https://github.com/w3c/css-houdini-drafts/blob/master/css-paint-api/EXPLAINER.md">EXPLAINER</a>.</p>
  </div>
  <h2 class="no-num no-toc no-ref heading settled" id="status"><span class="content">Status of this document</span></h2>
  <div data-fill-with="status">
   <p> This is a public copy of the editors’ draft.
	It is provided for discussion only and may change at any moment.
	Its publication here does not imply endorsement of its contents by W3C.
	Don’t cite this document other than as work in progress. </p>
   <p> <a href="https://github.com/w3c/css-houdini-drafts/issues">GitHub Issues</a> are preferred for discussion of this specification.
	When filing an issue, please put the text “css-paint-api” in the title,
	preferably like this:
	“[css-paint-api] <i>…summary of comment…</i>”.
	All issues and comments are <a href="https://lists.w3.org/Archives/Public/public-houdini-archive/">archived</a>. </p>
   <p> This document was produced by the <a href="http://www.w3.org/Style/CSS/members">CSS Working Group</a> (part of the <a href="http://www.w3.org/Style/">Style Activity</a>). </p>
   <p> This document was produced by a group operating under
	the <a href="http://www.w3.org/Consortium/Patent-Policy/">W3C Patent Policy</a>.
	W3C maintains a <a href="http://www.w3.org/2004/01/pp-impl/32061/status" rel="disclosure">public list of any patent disclosures</a> made in connection with the deliverables of the group;
	that page also includes instructions for disclosing a patent.
	An individual who has actual knowledge of a patent which the individual believes contains <a href="http://www.w3.org/Consortium/Patent-Policy/#def-essential">Essential Claim(s)</a> must disclose the information in accordance with <a href="http://www.w3.org/Consortium/Patent-Policy/#sec-Disclosure">section 6 of the W3C Patent Policy</a>. </p>
   <p> This document is governed by the <a href="https://www.w3.org/2018/Process-20180201/" id="w3c_process_revision">1 February 2018 W3C Process Document</a>. </p>
   <p></p>
  </div>
  <div data-fill-with="at-risk"></div>
  <nav data-fill-with="table-of-contents" id="toc">
   <h2 class="no-num no-toc no-ref" id="contents">Table of Contents</h2>
   <ol class="toc" role="directory">
    <li><a href="#intro"><span class="secno">1</span> <span class="content">Introduction</span></a>
    <li><a href="#paint-invalidation"><span class="secno">2</span> <span class="content">Paint Invalidation</span></a>
    <li><a href="#paint-worklet"><span class="secno">3</span> <span class="content">Paint Worklet</span></a>
    <li><a href="#concepts"><span class="secno">4</span> <span class="content">Concepts</span></a>
    <li><a href="#registering-custom-paint"><span class="secno">5</span> <span class="content">Registering Custom Paint</span></a>
    <li><a href="#paint-notation"><span class="secno">6</span> <span class="content">Paint Notation</span></a>
    <li><a href="#2d-rendering-context"><span class="secno">7</span> <span class="content">The 2D rendering context</span></a>
    <li><a href="#drawing-an-image"><span class="secno">8</span> <span class="content">Drawing an image</span></a>
    <li>
     <a href="#examples"><span class="secno">9</span> <span class="content">Examples</span></a>
     <ol class="toc">
      <li><a href="#example-1"><span class="secno">9.1</span> <span class="content">Example 1: Colored Circle</span></a>
      <li><a href="#example-2"><span class="secno">9.2</span> <span class="content">Example 2: Image Placeholder</span></a>
      <li><a href="#example-3"><span class="secno">9.3</span> <span class="content">Example 3: Arcs</span></a>
      <li><a href="#example-4"><span class="secno">9.4</span> <span class="content">Example 4: Different Colors (based on size)</span></a>
      <li><a href="#example-5"><span class="secno">9.5</span> <span class="content">Example 5: Drawing outside an element’s area</span></a>
     </ol>
    <li>
     <a href="#conformance"><span class="secno"></span> <span class="content"> Conformance</span></a>
     <ol class="toc">
      <li><a href="#conventions"><span class="secno"></span> <span class="content"> Document conventions</span></a>
      <li><a href="#conformance-classes"><span class="secno"></span> <span class="content"> Conformance classes</span></a>
      <li>
       <a href="#partial"><span class="secno"></span> <span class="content"> Partial implementations</span></a>
       <ol class="toc">
        <li><a href="#conform-future-proofing"><span class="secno"></span> <span class="content"> Implementations of Unstable and Proprietary Features</span></a>
       </ol>
      <li><a href="#testing"><span class="secno"></span> <span class="content"> Non-experimental implementations</span></a>
     </ol>
    <li>
     <a href="#index"><span class="secno"></span> <span class="content">Index</span></a>
     <ol class="toc">
      <li><a href="#index-defined-here"><span class="secno"></span> <span class="content">Terms defined by this specification</span></a>
      <li><a href="#index-defined-elsewhere"><span class="secno"></span> <span class="content">Terms defined by reference</span></a>
     </ol>
    <li>
     <a href="#references"><span class="secno"></span> <span class="content">References</span></a>
     <ol class="toc">
      <li><a href="#normative"><span class="secno"></span> <span class="content">Normative References</span></a>
     </ol>
    <li><a href="#idl-index"><span class="secno"></span> <span class="content">IDL Index</span></a>
   </ol>
  </nav>
  <main>
   <h2 class="heading settled" data-level="1" id="intro"><span class="secno">1. </span><span class="content">Introduction</span><a class="self-link" href="#intro"></a></h2>
   <p>The paint stage of CSS is responsible for painting the background, content and highlight of a
box based on that box’s size (as generated by the layout stage) and computed style.</p>
   <p>This specification describes an API which allows developers to paint a part of a box in
response to size / computed style changes with an additional <a class="production css" data-link-type="type" href="https://drafts.csswg.org/css-images-3/#typedef-image" id="ref-for-typedef-image①">&lt;image></a> function.</p>
   <p class="note" role="note"><span>Note:</span> In a future version of the spec, support could be added for defining the clip, global alpha,
    filter on a portion of a box (for example on the background layers).</p>
   <h2 class="heading settled" data-level="2" id="paint-invalidation"><span class="secno">2. </span><span class="content">Paint Invalidation</span><a class="self-link" href="#paint-invalidation"></a></h2>
   <p>Each <a class="production css" data-link-type="function" href="#funcdef-paint" id="ref-for-funcdef-paint">&lt;paint()></a> function for a box has an associated <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="paint-valid-flag">paint valid flag</dfn>. It may be either <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="paint-valid">paint-valid</dfn> or <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="paint-invalid">paint-invalid</dfn>. It is initially set to <a data-link-type="dfn" href="#paint-invalid" id="ref-for-paint-invalid">paint-invalid</a>.</p>
   <div class="algorithm" data-algorithm="invalidate paint functions">
     When the user agent wants to <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="invalidate-paint-functions">invalidate paint functions</dfn> given <var>box</var>, the user agent <em>must</em> run the following steps: 
    <ol>
     <li data-md="">
      <p>For each <a class="production css" data-link-type="function" href="#funcdef-paint" id="ref-for-funcdef-paint①">&lt;paint()></a> function on the <var>box</var>, perform the following steps:</p>
      <ol>
       <li data-md="">
        <p>Let <var>paintFunction</var> be the current <a class="production css" data-link-type="function" href="#funcdef-paint" id="ref-for-funcdef-paint②">&lt;paint()></a> function on the <var>box</var>.</p>
       <li data-md="">
        <p>Let <var>name</var> be the first argument of the <a class="production css" data-link-type="function" href="#funcdef-paint" id="ref-for-funcdef-paint③">&lt;paint()></a> function.</p>
       <li data-md="">
        <p>Let <var>documentPaintDefinitionMap</var> be the associated <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-document" id="ref-for-concept-document">document</a>’s <a data-link-type="dfn" href="#document-paint-definitions" id="ref-for-document-paint-definitions">document paint
definitions</a> map.</p>
       <li data-md="">
        <p>Let <var>documentDefinition</var> be the result of <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#sec-get-o-p" id="ref-for-sec-get-o-p">get</a> <var>documentPaintDefinitionMap</var>[<var>name</var>].</p>
       <li data-md="">
        <p>Let <var>inputProperties</var> be <var>documentDefinition</var>’s <a data-link-type="dfn" href="#document-paint-definition-input-properties" id="ref-for-document-paint-definition-input-properties">input
properties</a> list.</p>
       <li data-md="">
        <p>For each <var>property</var> in <var>inputProperties</var>, if the <var>property</var>’s <a data-link-type="dfn" href="https://drafts.csswg.org/css-cascade-4/#computed-value" id="ref-for-computed-value">computed value</a> has
changed, set the <a data-link-type="dfn" href="#paint-valid-flag" id="ref-for-paint-valid-flag">paint valid flag</a> on the <var>paintFunction</var> to <a data-link-type="dfn" href="#paint-invalid" id="ref-for-paint-invalid①">paint-invalid</a>.</p>
      </ol>
    </ol>
   </div>
   <p>Performing <a data-link-type="dfn" href="#draw-a-paint-image" id="ref-for-draw-a-paint-image">draw a paint image</a> results in the <a data-link-type="dfn" href="#paint-valid-flag" id="ref-for-paint-valid-flag①">paint valid flag</a> for a <a class="production css" data-link-type="function" href="#funcdef-paint" id="ref-for-funcdef-paint④">&lt;paint()></a> function on a box to be set to <a data-link-type="dfn" href="#paint-valid" id="ref-for-paint-valid">paint-valid</a>.</p>
   <p><a data-link-type="dfn" href="#invalidate-paint-functions" id="ref-for-invalidate-paint-functions">Invalidate paint functions</a> <em>must</em> be run when the user agent recalculates the computed
style for a box.</p>
   <p class="note" role="note"><span>Note:</span> In a future version of the spec, support could be added for partial invalidation. The user
    agent will be able to specify a region of the rendering context which needs to be re-painted by
    the paint class.</p>
   <h2 class="heading settled" data-level="3" id="paint-worklet"><span class="secno">3. </span><span class="content">Paint Worklet</span><a class="self-link" href="#paint-worklet"></a></h2>
   <p>The <code class="idl"><a data-link-type="idl" href="#dom-css-paintworklet" id="ref-for-dom-css-paintworklet">paintWorklet</a></code> attribute allows access to the <code class="idl"><a data-link-type="idl" href="https://drafts.css-houdini.org/worklets/#worklet" id="ref-for-worklet">Worklet</a></code> responsible for all the classes
which are related to painting.</p>
   <p>The <code class="idl"><a data-link-type="idl" href="#dom-css-paintworklet" id="ref-for-dom-css-paintworklet①">paintWorklet</a></code>'s <a data-link-type="dfn" href="https://drafts.css-houdini.org/worklets/#worklet-global-scope-type" id="ref-for-worklet-global-scope-type">worklet global scope type</a> is <code class="idl"><a data-link-type="idl" href="#paintworkletglobalscope" id="ref-for-paintworkletglobalscope">PaintWorkletGlobalScope</a></code>.</p>
<pre class="idl highlight def"><span class="kt">partial</span> <span class="kt">interface</span> <a class="nv idl-code" data-link-type="interface" href="https://drafts.csswg.org/cssom-1/#css" id="ref-for-css">CSS</a> {
    [<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#SameObject" id="ref-for-SameObject">SameObject</a>] <span class="kt">readonly</span> <span class="kt">attribute</span> <a class="n" data-link-type="idl-name" href="https://drafts.css-houdini.org/worklets/#worklet" id="ref-for-worklet①">Worklet</a> <dfn class="nv dfn-paneled idl-code" data-dfn-for="CSS" data-dfn-type="attribute" data-export="" data-readonly="" data-type="Worklet" id="dom-css-paintworklet"><code>paintWorklet</code></dfn>;
};
</pre>
   <p>A <code class="idl"><a data-link-type="idl" href="#paintworkletglobalscope" id="ref-for-paintworkletglobalscope①">PaintWorkletGlobalScope</a></code> is a global execution context of the <code class="idl"><a data-link-type="idl" href="#dom-css-paintworklet" id="ref-for-dom-css-paintworklet②">paintWorklet</a></code>.</p>
   <p>A <code class="idl"><a data-link-type="idl" href="#paintworkletglobalscope" id="ref-for-paintworkletglobalscope②">PaintWorkletGlobalScope</a></code> has a <code class="idl"><a data-link-type="idl" href="#dom-paintworkletglobalscope-devicepixelratio" id="ref-for-dom-paintworkletglobalscope-devicepixelratio">devicePixelRatio</a></code> property which is
identical to the Window.<code class="idl"><a data-link-type="idl" href="https://drafts.csswg.org/cssom-view-1/#dom-window-devicepixelratio" id="ref-for-dom-window-devicepixelratio">devicePixelRatio</a></code> property.</p>
<pre class="idl highlight def">[<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Global" id="ref-for-Global">Global</a>=(<a class="n" data-link-type="idl-name" href="https://drafts.css-houdini.org/worklets/#worklet" id="ref-for-worklet②">Worklet</a>,<a class="n" data-link-type="idl-name">PaintWorklet</a>),<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed" id="ref-for-Exposed">Exposed</a>=<span class="n">PaintWorklet</span>]
<span class="kt">interface</span> <dfn class="nv dfn-paneled idl-code" data-dfn-type="interface" data-export="" id="paintworkletglobalscope"><code>PaintWorkletGlobalScope</code></dfn> : <a class="n" data-link-type="idl-name" href="https://drafts.css-houdini.org/worklets/#workletglobalscope" id="ref-for-workletglobalscope">WorkletGlobalScope</a> {
    <span class="kt">void</span> <a class="nv idl-code" data-link-type="method" href="#dom-paintworkletglobalscope-registerpaint" id="ref-for-dom-paintworkletglobalscope-registerpaint">registerPaint</a>(<a class="n idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString" id="ref-for-idl-DOMString"><span class="kt">DOMString</span></a> <dfn class="nv idl-code" data-dfn-for="PaintWorkletGlobalScope/registerPaint(name, paintCtor)" data-dfn-type="argument" data-export="" id="dom-paintworkletglobalscope-registerpaint-name-paintctor-name"><code>name</code><a class="self-link" href="#dom-paintworkletglobalscope-registerpaint-name-paintctor-name"></a></dfn>, <a class="n" data-link-type="idl-name" href="https://heycam.github.io/webidl/#VoidFunction" id="ref-for-VoidFunction">VoidFunction</a> <dfn class="nv idl-code" data-dfn-for="PaintWorkletGlobalScope/registerPaint(name, paintCtor)" data-dfn-type="argument" data-export="" id="dom-paintworkletglobalscope-registerpaint-name-paintctor-paintctor"><code>paintCtor</code><a class="self-link" href="#dom-paintworkletglobalscope-registerpaint-name-paintctor-paintctor"></a></dfn>);
    <span class="kt">readonly</span> <span class="kt">attribute</span> <a class="n idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-unrestricted-double" id="ref-for-idl-unrestricted-double"><span class="kt">unrestricted</span> <span class="kt">double</span></a> <dfn class="nv dfn-paneled idl-code" data-dfn-for="PaintWorkletGlobalScope" data-dfn-type="attribute" data-export="" data-readonly="" data-type="unrestricted double" id="dom-paintworkletglobalscope-devicepixelratio"><code>devicePixelRatio</code></dfn>;
};
</pre>
   <p>The <code class="idl"><a data-link-type="idl" href="#dictdef-paintrenderingcontext2dsettings" id="ref-for-dictdef-paintrenderingcontext2dsettings">PaintRenderingContext2DSettings</a></code> contains the settings for the rendering context associated
with the paint canvas. The <code class="idl"><a data-link-type="idl" href="#dictdef-paintrenderingcontext2dsettings" id="ref-for-dictdef-paintrenderingcontext2dsettings①">PaintRenderingContext2DSettings</a></code> provides a supported subset of canvas
rendering context 2D settings. In the future, it may be extended to support color management in
paint canvas.</p>
<pre class="idl highlight def"><span class="kt">dictionary</span> <dfn class="nv dfn-paneled idl-code" data-dfn-type="dictionary" data-export="" id="dictdef-paintrenderingcontext2dsettings"><code>PaintRenderingContext2DSettings</code></dfn> {
    <a class="n idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-boolean" id="ref-for-idl-boolean"><span class="kt">boolean</span></a> <dfn class="nv idl-code" data-default="true" data-dfn-for="PaintRenderingContext2DSettings" data-dfn-type="dict-member" data-export="" data-type="boolean " id="dom-paintrenderingcontext2dsettings-alpha"><code>alpha</code><a class="self-link" href="#dom-paintrenderingcontext2dsettings-alpha"></a></dfn> = <span class="kt">true</span>;
};
</pre>
   <div class="note" role="note">
     Note: The shape of the class should be: 
<pre class="lang-javascript highlight"><span class="kr">class</span> MyPaint <span class="p">{</span>
    <span class="kr">static</span> get inputProperties<span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="p">[</span><span class="s1">'--foo'</span><span class="p">];</span> <span class="p">}</span>
    <span class="kr">static</span> get inputArguments<span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="p">[</span><span class="s1">'&lt;color>'</span><span class="p">];</span> <span class="p">}</span>
    <span class="kr">static</span> get contextOptions<span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="p">{</span>alpha<span class="o">:</span> <span class="kc">true</span><span class="p">};</span> <span class="p">}</span>

    paint<span class="p">(</span>ctx<span class="p">,</span> size<span class="p">,</span> styleMap<span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Paint code goes here.</span>
<span class="c1"></span>    <span class="p">}</span>
<span class="p">}</span>
</pre>
   </div>
   <h2 class="heading settled" data-level="4" id="concepts"><span class="secno">4. </span><span class="content">Concepts</span><a class="self-link" href="#concepts"></a></h2>
   <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="paint-definition">paint definition</dfn> is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#struct" id="ref-for-struct">struct</a> which describes the information needed by the <code class="idl"><a data-link-type="idl" href="#paintworkletglobalscope" id="ref-for-paintworkletglobalscope③">PaintWorkletGlobalScope</a></code> about the author defined <a class="production css" data-link-type="type" href="https://drafts.csswg.org/css-images-3/#typedef-image" id="ref-for-typedef-image②">&lt;image></a> (which can be referenced by the <a class="production css" data-link-type="function" href="#funcdef-paint" id="ref-for-funcdef-paint⑤">&lt;paint()></a> function). It consists of:</p>
   <ul>
    <li data-md="">
     <p><dfn class="dfn-paneled" data-dfn-for="paint definition" data-dfn-type="dfn" data-noexport="" id="paint-definition-class-constructor">class constructor</dfn> which is the class <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#sec-constructor" id="ref-for-sec-constructor">constructor</a>.</p>
    <li data-md="">
     <p><dfn class="dfn-paneled" data-dfn-for="paint definition" data-dfn-type="dfn" data-noexport="" id="paint-definition-paint-function">paint function</dfn> which is the paint <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#sec-terms-and-definitions-function" id="ref-for-sec-terms-and-definitions-function">function</a> callback.</p>
    <li data-md="">
     <p><dfn class="dfn-paneled" data-dfn-for="paint definition" data-dfn-type="dfn" data-noexport="" id="paint-definition-constructor-valid-flag">constructor valid flag</dfn>.</p>
    <li data-md="">
     <p><dfn class="dfn-paneled" data-dfn-for="paint definition" data-dfn-type="dfn" data-noexport="" id="paint-definition-input-properties">input properties</dfn> which is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list">list</a> of <code>DOMStrings</code>.</p>
    <li data-md="">
     <p>A <dfn class="dfn-paneled" data-dfn-for="paint definition" data-dfn-type="dfn" data-noexport="" id="paint-definition-paintrenderingcontext2dsettings-object">PaintRenderingContext2DSettings object</dfn>.</p>
   </ul>
   <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="document-paint-definition">document paint definition</dfn> is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#struct" id="ref-for-struct①">struct</a> which describes the information
needed by the <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-document" id="ref-for-concept-document①">document</a> about the author defined <a class="production css" data-link-type="type" href="https://drafts.csswg.org/css-images-3/#typedef-image" id="ref-for-typedef-image③">&lt;image></a> function (which can be referenced
by the paint function). It consists of:</p>
   <ul>
    <li data-md="">
     <p>A <dfn class="dfn-paneled" data-dfn-for="document paint definition" data-dfn-type="dfn" data-noexport="" id="document-paint-definition-input-properties">input properties</dfn> which is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list①">list</a> of <code>DOMStrings</code>.</p>
    <li data-md="">
     <p>A <dfn class="dfn-paneled" data-dfn-for="document paint definition" data-dfn-type="dfn" data-noexport="" id="document-paint-definition-input-argument-syntaxes">input argument syntaxes</dfn> which is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list②">list</a> of
parsed <a href="https://www.w3.org/TR/css-properties-values-api-1/#supported-syntax-strings">CSS Properties and Values API 1 §2.3 Supported syntax strings</a>.</p>
    <li data-md="">
     <p>A <dfn class="dfn-paneled" data-dfn-for="document paint definition" data-dfn-type="dfn" data-noexport="" id="document-paint-definition-paintrenderingcontext2dsettings-object">PaintRenderingContext2DSettings object</dfn>.</p>
   </ul>
   <h2 class="heading settled" data-level="5" id="registering-custom-paint"><span class="secno">5. </span><span class="content">Registering Custom Paint</span><a class="self-link" href="#registering-custom-paint"></a></h2>
   <p>The <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-document" id="ref-for-concept-document②">document</a> has a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map" id="ref-for-ordered-map">map</a> of <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="document-paint-definitions">document paint definitions</dfn>. Initially
this map is empty; it is populated when <code class="idl"><a data-link-type="idl" href="#dom-paintworkletglobalscope-registerpaint" id="ref-for-dom-paintworkletglobalscope-registerpaint①">registerPaint(name, paintCtor)</a></code> is called.</p>
   <p>A <code class="idl"><a data-link-type="idl" href="#paintworkletglobalscope" id="ref-for-paintworkletglobalscope④">PaintWorkletGlobalScope</a></code> has a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map" id="ref-for-ordered-map①">map</a> of <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="paint-definitions">paint definitions</dfn>. Initially this map
is empty; it is populated when <code class="idl"><a data-link-type="idl" href="#dom-paintworkletglobalscope-registerpaint" id="ref-for-dom-paintworkletglobalscope-registerpaint②">registerPaint(name, paintCtor)</a></code> is called.</p>
   <p>A <code class="idl"><a data-link-type="idl" href="#paintworkletglobalscope" id="ref-for-paintworkletglobalscope⑤">PaintWorkletGlobalScope</a></code> has a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map" id="ref-for-ordered-map②">map</a> of <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="paint-class-instances">paint class instances</dfn>. Initially this
map is empty; it is populated when <a data-link-type="dfn" href="#draw-a-paint-image" id="ref-for-draw-a-paint-image①">draw a paint image</a> is invoked by the user agent.</p>
   <p>Instances of paint classes in the <a data-link-type="dfn" href="#paint-class-instances" id="ref-for-paint-class-instances">paint class instances</a> map may be disposed and removed from
the map by the user agent at any time. This may be done when a <a class="production css" data-link-type="function" href="#funcdef-paint" id="ref-for-funcdef-paint⑥">&lt;paint()></a> function no longer is
used, or the user agent needs to reclaim memory.</p>
   <div class="algorithm" data-algorithm="registerPaint(name, paintCtor)">
     When the <dfn class="dfn-paneled idl-code" data-dfn-for="PaintWorkletGlobalScope" data-dfn-type="method" data-export="" id="dom-paintworkletglobalscope-registerpaint"><code>registerPaint(<var>name</var>, <var>paintCtor</var>)</code></dfn> method is
called, the user agent <em>must</em> run the following steps: 
    <ol>
     <li data-md="">
      <p>If the <var>name</var> is an empty string, <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-throw" id="ref-for-dfn-throw">throw</a> a <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#sec-native-error-types-used-in-this-standard-typeerror" id="ref-for-sec-native-error-types-used-in-this-standard-typeerror">TypeError</a> and abort all these steps.</p>
     <li data-md="">
      <p>Let <var>paintDefinitionMap</var> be <code class="idl"><a data-link-type="idl" href="#paintworkletglobalscope" id="ref-for-paintworkletglobalscope⑥">PaintWorkletGlobalScope</a></code>'s <a data-link-type="dfn" href="#paint-definitions" id="ref-for-paint-definitions">paint definitions</a> map.</p>
     <li data-md="">
      <p>If <var>paintDefinitionMap</var>[<var>name</var>] <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-exists" id="ref-for-map-exists">exists</a> <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-throw" id="ref-for-dfn-throw①">throw</a> a
"<a data-link-type="dfn" href="https://heycam.github.io/webidl/#invalidmodificationerror" id="ref-for-invalidmodificationerror">InvalidModificationError</a>" <a data-link-type="dfn" href="https://heycam.github.io/webidl/#idl-domexception" id="ref-for-idl-domexception">DOMException</a> and abort all these steps.</p>
     <li data-md="">
      <p>Let <var>inputProperties</var> be an empty <code>sequence&lt;DOMString></code>.</p>
     <li data-md="">
      <p>Let <var>inputPropertiesIterable</var> be the result of <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#sec-get-o-p" id="ref-for-sec-get-o-p①">Get</a>(<var>paintCtor</var>, "inputProperties").</p>
     <li data-md="">
      <p>If <var>inputPropertiesIterable</var> is not undefined, then set <var>inputProperties</var> to the result of <a data-link-type="dfn" href="https://heycam.github.io/webidl/#es-type-mapping" id="ref-for-es-type-mapping">converting</a> <var>inputPropertiesIterable</var> to a <code>sequence&lt;DOMString></code>. If an
exception is <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-throw" id="ref-for-dfn-throw②">thrown</a>, rethrow the exception and abort all these steps.</p>
    </ol>
    <p class="note" role="note"><span>Note:</span> The list of CSS properties provided by the input properties getter can either be custom or
        native CSS properties.</p>
    <p class="note" role="note"><span>Note:</span> The list of CSS properties may contain shorthands.</p>
    <p class="note" role="note"><span>Note:</span> In order for a paint image class to be forwards compatible, the list of CSS properties can
        also contains currently invalid properties for the user agent. For example <code>margin-bikeshed-property</code>.</p>
    <ol start="7">
     <li data-md="">
      <p>Let <var>inputArguments</var> be an empty <code>sequence&lt;DOMString></code>.</p>
     <li data-md="">
      <p>Let <var>inputArgumentsIterable</var> be the result of <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#sec-get-o-p" id="ref-for-sec-get-o-p②">Get</a>(<var>paintCtor</var>, "inputArguments").</p>
     <li data-md="">
      <p>If <var>inputArgumentsIterable</var> is not undefined, then set <var>inputArguments</var> to the result of <a data-link-type="dfn" href="https://heycam.github.io/webidl/#es-type-mapping" id="ref-for-es-type-mapping①">converting</a> <var>inputArgumentsIterable</var> to a <code>sequence&lt;DOMString></code>. If an
execption is thrown, rethrow the execption and abort all these steps.</p>
     <li data-md="">
      <p>Let <var>inputArgumentSyntaxes</var> be an <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-empty" id="ref-for-list-empty">empty</a> <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list③">list</a>.</p>
     <li data-md="">
      <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-iterate" id="ref-for-list-iterate">For each</a> <var>item</var> in <var>inputArguments</var> perform the following substeps:</p>
      <ol>
       <li data-md="">
        <p>Let <var>parsedSyntax</var> be the result of parsing <var>item</var> according to the rules in <a href="https://www.w3.org/TR/css-properties-values-api-1/#supported-syntax-strings">CSS Properties and Values API 1 §2.3 Supported syntax strings</a>. If it fails to parse <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-throw" id="ref-for-dfn-throw③">throw</a> a <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#sec-native-error-types-used-in-this-standard-typeerror" id="ref-for-sec-native-error-types-used-in-this-standard-typeerror①">TypeError</a> and abort all these steps.</p>
       <li data-md="">
        <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-append" id="ref-for-list-append">Append</a> <var>parsedSyntax</var> to <var>inputArgumentSyntaxes</var>.</p>
      </ol>
     <li data-md="">
      <p>Let <var>contextOptionsValue</var> be the result of <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#sec-get-o-p" id="ref-for-sec-get-o-p③">Get</a>(<var>paintCtor</var>, "contextOptions").</p>
     <li data-md="">
      <p>Let <var>paintRenderingContext2DSettings</var> be the result of <a data-link-type="dfn" href="https://heycam.github.io/webidl/#es-type-mapping" id="ref-for-es-type-mapping②">converting</a> <var>contextOptionsValue</var> to a <code class="idl"><a data-link-type="idl" href="#dictdef-paintrenderingcontext2dsettings" id="ref-for-dictdef-paintrenderingcontext2dsettings②">PaintRenderingContext2DSettings</a></code>.
If an exception is <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-throw" id="ref-for-dfn-throw④">thrown</a>, rethrow the exception and abort all these steps.</p>
      <p class="note" role="note"><span>Note:</span> Setting <code>paintRenderingContext2DSettings.alpha</code> is <code>false</code> allows user agents
    to anti-alias text in addition to performing "visibility" optimizations, e.g. not
    painting an image behind the paint image as the paint image is opaque.</p>
     <li data-md="">
      <p>If the result of <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#sec-isconstructor" id="ref-for-sec-isconstructor">IsConstructor</a>(<var>paintCtor</var>) is false, <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-throw" id="ref-for-dfn-throw⑤">throw</a> a <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#sec-native-error-types-used-in-this-standard-typeerror" id="ref-for-sec-native-error-types-used-in-this-standard-typeerror②">TypeError</a> and abort all these steps.</p>
     <li data-md="">
      <p>Let <var>prototype</var> be the result of <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#sec-get-o-p" id="ref-for-sec-get-o-p④">Get</a>(<var>paintCtor</var>, "prototype").</p>
     <li data-md="">
      <p>If the result of <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#sec-ecmascript-data-types-and-values" id="ref-for-sec-ecmascript-data-types-and-values">Type</a>(<var>prototype</var>) is not Object, <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-throw" id="ref-for-dfn-throw⑥">throw</a> a <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#sec-native-error-types-used-in-this-standard-typeerror" id="ref-for-sec-native-error-types-used-in-this-standard-typeerror③">TypeError</a> and
abort all these steps.</p>
     <li data-md="">
      <p>Let <var>paint</var> be the result of <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#sec-get-o-p" id="ref-for-sec-get-o-p⑤">Get</a>(<var>prototype</var>, "paint").</p>
     <li data-md="">
      <p>If the result of <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#sec-iscallable" id="ref-for-sec-iscallable">IsCallable</a>(<var>paint</var>) is false, <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-throw" id="ref-for-dfn-throw⑦">throw</a> a <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#sec-native-error-types-used-in-this-standard-typeerror" id="ref-for-sec-native-error-types-used-in-this-standard-typeerror④">TypeError</a> and
abort all these steps.</p>
     <li data-md="">
      <p>Let <var>definition</var> be a new <a data-link-type="dfn" href="#paint-definition" id="ref-for-paint-definition">paint definition</a> with:</p>
      <ul>
       <li data-md="">
        <p><a data-link-type="dfn" href="#paint-definition-class-constructor" id="ref-for-paint-definition-class-constructor">class constructor</a> being <var>paintCtor</var>.</p>
       <li data-md="">
        <p><a data-link-type="dfn" href="#paint-definition-paint-function" id="ref-for-paint-definition-paint-function">paint function</a> being <var>paint</var>.</p>
       <li data-md="">
        <p><a data-link-type="dfn" href="#paint-definition-constructor-valid-flag" id="ref-for-paint-definition-constructor-valid-flag">constructor valid flag</a> being <b>true</b>.</p>
       <li data-md="">
        <p><a data-link-type="dfn" href="#paint-definition-input-properties" id="ref-for-paint-definition-input-properties">input properties</a> being <var>inputProperties</var>.</p>
       <li data-md="">
        <p><a data-link-type="dfn" href="#paint-definition-paintrenderingcontext2dsettings-object" id="ref-for-paint-definition-paintrenderingcontext2dsettings-object">PaintRenderingContext2DSettings object</a> being <var>paintRenderingContext2DSettings</var>.</p>
      </ul>
     <li data-md="">
      <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-set" id="ref-for-map-set">Set</a> <var>paintDefinitionMap</var>[<var>name</var>] to <var>definition</var>.</p>
     <li data-md="">
      <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task" id="ref-for-queue-a-task">Queue a task</a> to run the following steps:</p>
      <ol>
       <li data-md="">
        <p>Let <var>documentPaintDefinitionMap</var> be the associated <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-document" id="ref-for-concept-document③">document’s</a> <a data-link-type="dfn" href="#document-paint-definitions" id="ref-for-document-paint-definitions①">document paint
definitions</a> <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map" id="ref-for-ordered-map③">map</a>.</p>
       <li data-md="">
        <p>Let <var>documentDefinition</var> be a new <a data-link-type="dfn" href="#document-paint-definition" id="ref-for-document-paint-definition">document paint definition</a> with:</p>
        <ul>
         <li data-md="">
          <p><a data-link-type="dfn" href="#document-paint-definition-input-properties" id="ref-for-document-paint-definition-input-properties①">input properties</a> being <var>inputProperties</var>.</p>
         <li data-md="">
          <p><a data-link-type="dfn" href="#document-paint-definition-input-argument-syntaxes" id="ref-for-document-paint-definition-input-argument-syntaxes">input argument syntaxes</a> being <var>inputArgumentSyntaxes</var>.</p>
         <li data-md="">
          <p><a data-link-type="dfn" href="#document-paint-definition-paintrenderingcontext2dsettings-object" id="ref-for-document-paint-definition-paintrenderingcontext2dsettings-object">PaintRenderingContext2DSettings object</a> being <var>paintRenderingContext2DSettings</var>.</p>
        </ul>
       <li data-md="">
        <p>If <var>documentPaintDefinitionMap</var>[<var>name</var>] <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-exists" id="ref-for-map-exists①">exists</a>, run the following steps:</p>
        <ol>
         <li data-md="">
          <p>Let <var>existingDocumentDefinition</var> be the result of <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-get" id="ref-for-map-get">get</a> <var>documentPaintDefinitionMap</var>[<var>name</var>].</p>
         <li data-md="">
          <p>If <var>existingDocumentDefinition</var> is <code>"invalid"</code>, abort all these steps.</p>
         <li data-md="">
          <p>If <var>existingDocumentDefinition</var> and <var>documentDefinition</var> are not equivalent, (that is <a data-link-type="dfn" href="#document-paint-definition-input-properties" id="ref-for-document-paint-definition-input-properties②">input properties</a>, <a data-link-type="dfn" href="#document-paint-definition-input-argument-syntaxes" id="ref-for-document-paint-definition-input-argument-syntaxes①">input argument syntaxes</a>, and <a data-link-type="dfn" href="#document-paint-definition-paintrenderingcontext2dsettings-object" id="ref-for-document-paint-definition-paintrenderingcontext2dsettings-object①">PaintRenderingContext2DSettings object</a> are different), then:</p>
          <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-set" id="ref-for-map-set①">Set</a> <var>documentPaintDefinitionMap</var>[<var>name</var>] to <code>"invalid"</code>.</p>
          <p>Log an error to the debugging console stating that the same class was registered
with different <code>inputProperties</code>, <code>inputArguments</code>, or <code>paintRenderingContext2DSettings</code>.</p>
        </ol>
       <li data-md="">
        <p>Otherwise, <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-set" id="ref-for-map-set②">set</a> <var>documentPaintDefinitionMap</var>[<var>name</var>] to <var>documentDefinition</var>.</p>
      </ol>
    </ol>
    <p class="note" role="note"><span>Note:</span> The list of input properties should only be looked up once, the class doesn’t have the
    opportunity to dynamically change its input properties.</p>
    <p class="note" role="note"><span>Note:</span> In a future version of the spec, the author could have the ability to receive a different type
    of RenderingContext. In particular the author may want a WebGL rendering context to render 3D
    effects. There are complexities in setting up a WebGL rendering context to take the <code class="idl"><a data-link-type="idl" href="#paintsize" id="ref-for-paintsize">PaintSize</a></code> and <code class="idl"><a data-link-type="idl" href="https://drafts.css-houdini.org/css-typed-om-1/#stylepropertymap" id="ref-for-stylepropertymap">StylePropertyMap</a></code> as inputs.</p>
   </div>
   <h2 class="heading settled" data-level="6" id="paint-notation"><span class="secno">6. </span><span class="content">Paint Notation</span><a class="self-link" href="#paint-notation"></a></h2>
<pre class="prod"><dfn class="dfn-paneled" data-dfn-type="function" data-export="" id="funcdef-paint">paint()</dfn> = paint( <a class="production" data-link-type="type" href="https://drafts.csswg.org/css-values-4/#typedef-ident" id="ref-for-typedef-ident">&lt;ident></a><a data-link-type="grammar" href="https://drafts.csswg.org/css-values-4/#comb-comma" id="ref-for-comb-comma">,</a> <a class="production" data-link-type="type" href="https://drafts.csswg.org/css-syntax-3/#typedef-declaration-value" id="ref-for-typedef-declaration-value">&lt;declaration-value></a><a data-link-type="grammar" href="https://drafts.csswg.org/css-values-4/#mult-opt" id="ref-for-mult-opt">?</a> )
</pre>
   <p>The <a class="production css" data-link-type="function" href="#funcdef-paint" id="ref-for-funcdef-paint⑦">&lt;paint()></a> function is an additional notation to be supported by the <a class="production css" data-link-type="type" href="https://drafts.csswg.org/css-images-3/#typedef-image" id="ref-for-typedef-image④">&lt;image></a> type.</p>
   <div class="example" id="example-9c744bd7">
    <a class="self-link" href="#example-9c744bd7"></a> 
<pre class="lang-markup highlight"><span class="p">&lt;</span><span class="nt">style</span><span class="p">></span>
    <span class="p">.</span><span class="nc">logo</span> <span class="p">{</span> <span class="k">background-image</span><span class="p">:</span> <span class="nf">paint</span><span class="p">(</span><span class="n">company</span><span class="o">-</span><span class="n">logo</span><span class="p">);</span> <span class="p">}</span>
    <span class="p">.</span><span class="nc">chat-bubble</span> <span class="p">{</span> <span class="k">background-image</span><span class="p">:</span> <span class="nf">paint</span><span class="p">(</span><span class="n">chat</span><span class="o">-</span><span class="n">bubble</span><span class="p">,</span> <span class="kc">blue</span><span class="p">);</span> <span class="p">}</span>
<span class="p">&lt;/</span><span class="nt">style</span><span class="p">></span>
</pre>
   </div>
   <p>For the <a class="property" data-link-type="propdesc" href="https://drafts.csswg.org/css-ui-4/#propdef-cursor" id="ref-for-propdef-cursor">cursor</a> property, the <a class="production css" data-link-type="function" href="#funcdef-paint" id="ref-for-funcdef-paint⑧">&lt;paint()></a> function should be treated as an <a data-link-type="dfn" href="https://drafts.csswg.org/css-images-4/#invalid-image" id="ref-for-invalid-image">invalid image</a> and
fallback to the next supported <a class="production css" data-link-type="type" href="https://drafts.csswg.org/css-images-3/#typedef-image" id="ref-for-typedef-image⑤">&lt;image></a>.</p>
   <p>At <a data-link-type="dfn" href="https://drafts.csswg.org/css-cascade-4/#computed-value" id="ref-for-computed-value①">computed value</a> time the <a class="production css" data-link-type="function" href="#funcdef-paint" id="ref-for-funcdef-paint⑨">&lt;paint()></a> function does <em>not</em> need to match the grammar
registered by <code class="idl"><a data-link-type="idl" href="#dom-paintworkletglobalscope-registerpaint" id="ref-for-dom-paintworkletglobalscope-registerpaint③">registerPaint()</a></code>. Instead this will result in an <a data-link-type="dfn" href="https://drafts.csswg.org/css-images-4/#invalid-image" id="ref-for-invalid-image①">invalid image</a> when the
parsing occurs inside <a data-link-type="dfn" href="#draw-a-paint-image" id="ref-for-draw-a-paint-image②">draw a paint image</a>.</p>
   <h2 class="heading settled" data-level="7" id="2d-rendering-context"><span class="secno">7. </span><span class="content">The 2D rendering context</span><a class="self-link" href="#2d-rendering-context"></a></h2>
<pre class="idl highlight def">[<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed" id="ref-for-Exposed①">Exposed</a>=<span class="n">PaintWorklet</span>]
<span class="kt">interface</span> <dfn class="nv dfn-paneled idl-code" data-dfn-type="interface" data-export="" id="paintrenderingcontext2d"><code>PaintRenderingContext2D</code></dfn> {
};
<a class="n" data-link-type="idl-name" href="#paintrenderingcontext2d" id="ref-for-paintrenderingcontext2d">PaintRenderingContext2D</a> <span class="kt">implements</span> <a class="n" data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/canvas.html#canvasstate" id="ref-for-canvasstate">CanvasState</a>;
<a class="n" data-link-type="idl-name" href="#paintrenderingcontext2d" id="ref-for-paintrenderingcontext2d①">PaintRenderingContext2D</a> <span class="kt">implements</span> <a class="n" data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/canvas.html#canvastransform" id="ref-for-canvastransform">CanvasTransform</a>;
<a class="n" data-link-type="idl-name" href="#paintrenderingcontext2d" id="ref-for-paintrenderingcontext2d②">PaintRenderingContext2D</a> <span class="kt">implements</span> <a class="n" data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/canvas.html#canvascompositing" id="ref-for-canvascompositing">CanvasCompositing</a>;
<a class="n" data-link-type="idl-name" href="#paintrenderingcontext2d" id="ref-for-paintrenderingcontext2d③">PaintRenderingContext2D</a> <span class="kt">implements</span> <a class="n" data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/canvas.html#canvasimagesmoothing" id="ref-for-canvasimagesmoothing">CanvasImageSmoothing</a>;
<a class="n" data-link-type="idl-name" href="#paintrenderingcontext2d" id="ref-for-paintrenderingcontext2d④">PaintRenderingContext2D</a> <span class="kt">implements</span> <a class="n" data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/canvas.html#canvasfillstrokestyles" id="ref-for-canvasfillstrokestyles">CanvasFillStrokeStyles</a>;
<a class="n" data-link-type="idl-name" href="#paintrenderingcontext2d" id="ref-for-paintrenderingcontext2d⑤">PaintRenderingContext2D</a> <span class="kt">implements</span> <a class="n" data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/canvas.html#canvasshadowstyles" id="ref-for-canvasshadowstyles">CanvasShadowStyles</a>;
<a class="n" data-link-type="idl-name" href="#paintrenderingcontext2d" id="ref-for-paintrenderingcontext2d⑥">PaintRenderingContext2D</a> <span class="kt">implements</span> <a class="n" data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/canvas.html#canvasrect" id="ref-for-canvasrect">CanvasRect</a>;
<a class="n" data-link-type="idl-name" href="#paintrenderingcontext2d" id="ref-for-paintrenderingcontext2d⑦">PaintRenderingContext2D</a> <span class="kt">implements</span> <a class="n" data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/canvas.html#canvasdrawpath" id="ref-for-canvasdrawpath">CanvasDrawPath</a>;
<a class="n" data-link-type="idl-name" href="#paintrenderingcontext2d" id="ref-for-paintrenderingcontext2d⑧">PaintRenderingContext2D</a> <span class="kt">implements</span> <a class="n" data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/canvas.html#canvasdrawimage" id="ref-for-canvasdrawimage">CanvasDrawImage</a>;
<a class="n" data-link-type="idl-name" href="#paintrenderingcontext2d" id="ref-for-paintrenderingcontext2d⑨">PaintRenderingContext2D</a> <span class="kt">implements</span> <a class="n" data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/canvas.html#canvaspathdrawingstyles" id="ref-for-canvaspathdrawingstyles">CanvasPathDrawingStyles</a>;
<a class="n" data-link-type="idl-name" href="#paintrenderingcontext2d" id="ref-for-paintrenderingcontext2d①⓪">PaintRenderingContext2D</a> <span class="kt">implements</span> <a class="n" data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/canvas.html#canvaspath" id="ref-for-canvaspath">CanvasPath</a>;
</pre>
   <p class="note" role="note"><span>Note:</span> The <code class="idl"><a data-link-type="idl" href="#paintrenderingcontext2d" id="ref-for-paintrenderingcontext2d①①">PaintRenderingContext2D</a></code> implements a subset of the <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/canvas.html#canvasrenderingcontext2d" id="ref-for-canvasrenderingcontext2d">CanvasRenderingContext2D</a></code> API.
    Specifically it doesn’t implement the <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/canvas.html#canvasimagedata" id="ref-for-canvasimagedata">CanvasImageData</a></code>, <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/canvas.html#canvasuserinterface" id="ref-for-canvasuserinterface">CanvasUserInterface</a></code>, <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/canvas.html#canvastext" id="ref-for-canvastext">CanvasText</a></code>, or <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/canvas.html#canvastextdrawingstyles" id="ref-for-canvastextdrawingstyles">CanvasTextDrawingStyles</a></code> APIs.</p>
   <p>A <code class="idl"><a data-link-type="idl" href="#paintrenderingcontext2d" id="ref-for-paintrenderingcontext2d①②">PaintRenderingContext2D</a></code> object has a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/scripting.html#output-bitmap" id="ref-for-output-bitmap">output bitmap</a>. This is initialised when the
object is created. The size of the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/scripting.html#output-bitmap" id="ref-for-output-bitmap①">output bitmap</a> is the size of the fragment it is
rendering.</p>
   <p>The size of the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/scripting.html#output-bitmap" id="ref-for-output-bitmap②">output bitmap</a> does not necessarily represent the size of the actual bitmap
that the user agent will use internally or during rendering. For example, if the visual viewport is
zoomed the user agent may internally use bitmaps which correspond to the number of device pixels in
the coordinate space, so that the resulting rendering is of high quality.</p>
   <p>Additionally the user agent may record the sequence of drawing operations which have been applied to
the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/scripting.html#output-bitmap" id="ref-for-output-bitmap③">output bitmap</a> such that the user agent can subsequently draw onto a device bitmap at the
correct resolution. This also allows user agents to re-use the same output of the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/scripting.html#output-bitmap" id="ref-for-output-bitmap④">output
bitmap</a> repeatably while the visual viewport is being zoomed for example.</p>
   <p>Whenever <code>"currentColor"</code> is used as a color in the <code class="idl"><a data-link-type="idl" href="#paintrenderingcontext2d" id="ref-for-paintrenderingcontext2d①③">PaintRenderingContext2D</a></code> API, it
is treated as opaque black.</p>
   <div class="example" id="example-f64de17c">
    <a class="self-link" href="#example-f64de17c"></a> The code below will produce a solid black rectange. 
<pre class="lang-javascript highlight">registerPaint<span class="p">(</span><span class="s1">'currentcolor'</span><span class="p">,</span> <span class="kr">class</span> <span class="p">{</span>
    paint<span class="p">(</span>ctx<span class="p">,</span> size<span class="p">)</span> <span class="p">{</span>
        ctx<span class="p">.</span>fillStyle <span class="o">=</span> <span class="s1">'currentColor'</span><span class="p">;</span>
        ctx<span class="p">.</span>fillRect<span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> size<span class="p">.</span>width<span class="p">,</span> size<span class="p">.</span>height<span class="p">);</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre>
   </div>
   <div class="algorithm" data-algorithm="create a PaintRenderingContext2D object">
     When the user agent is to <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="create-a-paintrenderingcontext2d-object">create a PaintRenderingContext2D object</dfn> for a given <var>width</var>, <var>height</var>, and <var>paintRenderingContext2DSettings</var>, it <em>must</em> run the following steps: 
    <ol>
     <li data-md="">
      <p>Create a new <code class="idl"><a data-link-type="idl" href="#paintrenderingcontext2d" id="ref-for-paintrenderingcontext2d①④">PaintRenderingContext2D</a></code>.</p>
     <li data-md="">
      <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/scripting.html#set-bitmap-dimensions" id="ref-for-set-bitmap-dimensions">Set bitmap dimensions</a> for the context’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/scripting.html#output-bitmap" id="ref-for-output-bitmap⑤">output bitmap</a> to the rounded values of <var>width</var> and <var>height</var>.</p>
     <li data-md="">
      <p>Set the <code class="idl"><a data-link-type="idl" href="#paintrenderingcontext2d" id="ref-for-paintrenderingcontext2d①⑤">PaintRenderingContext2D</a></code>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/scripting.html#concept-canvas-alpha" id="ref-for-concept-canvas-alpha">alpha</a> flag to |paintRenderingContext2DSettings.alpha|.</p>
     <li data-md="">
      <p>Return the new <code class="idl"><a data-link-type="idl" href="#paintrenderingcontext2d" id="ref-for-paintrenderingcontext2d①⑥">PaintRenderingContext2D</a></code>.</p>
    </ol>
    <p class="note" role="note"><span>Note:</span> The initial state of the rendering context is set inside the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/scripting.html#set-bitmap-dimensions" id="ref-for-set-bitmap-dimensions①">set bitmap dimensions</a> algorithm, as it invokes <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/scripting.html#reset-the-rendering-context-to-its-default-state" id="ref-for-reset-the-rendering-context-to-its-default-state">reset the rendering context to its default state</a> and clears the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/scripting.html#output-bitmap" id="ref-for-output-bitmap⑥">output bitmap</a>.</p>
   </div>
   <h2 class="heading settled" data-level="8" id="drawing-an-image"><span class="secno">8. </span><span class="content">Drawing an image</span><a class="self-link" href="#drawing-an-image"></a></h2>
   <p>If a <a class="production css" data-link-type="function" href="#funcdef-paint" id="ref-for-funcdef-paint①⓪">&lt;paint()></a> function for a <a data-link-type="dfn" href="https://drafts.csswg.org/css-display-3/#css-box" id="ref-for-css-box">box</a> is <a data-link-type="dfn" href="#paint-invalid" id="ref-for-paint-invalid②">paint-invalid</a> and the <a data-link-type="dfn" href="https://drafts.csswg.org/css-display-3/#css-box" id="ref-for-css-box①">box</a> is inside the
visual viewport, then user agent <em>must</em> <a data-link-type="dfn" href="#draw-a-paint-image" id="ref-for-draw-a-paint-image③">draw a paint image</a> for the current frame.</p>
   <p class="note" role="note"><span>Note:</span> The user agent can optionally defer drawing images which are <a data-link-type="dfn" href="#paint-invalid" id="ref-for-paint-invalid③">paint-invalid</a> and outside
    the visual viewport.</p>
   <div class="example" id="example-c82a7f9b">
    <a class="self-link" href="#example-c82a7f9b"></a> If an author updates a style inside a <code>requestAnimationFrame</code>, e.g. 
<pre class="lang-javascript highlight">requestAnimationFrame<span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    element<span class="p">.</span>styleMap<span class="p">.</span>set<span class="p">(</span><span class="s1">'--custom-prop-invalidates-paint'</span><span class="p">,</span> <span class="mi">42</span><span class="p">);</span>
<span class="p">});</span>
</pre>
    <p>And the <code>element</code> is inside the visual viewport, the user agent is required to <a data-link-type="dfn" href="#draw-a-paint-image" id="ref-for-draw-a-paint-image④">draw a paint image</a> and display the result for the current frame.</p>
   </div>
   <p>The <a data-link-type="dfn" href="#draw-a-paint-image" id="ref-for-draw-a-paint-image⑤">draw a paint image</a> function is invoked by the user agent during the <a data-link-type="dfn" href="https://drafts.csswg.org/css-images-3/#object-size-negotiation" id="ref-for-object-size-negotiation">object size
negotiation</a> algorithm which is responsible for rendering an <a class="production css" data-link-type="type" href="https://drafts.csswg.org/css-images-3/#typedef-image" id="ref-for-typedef-image⑥">&lt;image></a>, with <var>concreteObjectSize</var> set to the <a data-link-type="dfn" href="https://drafts.csswg.org/css-images-3/#concrete-object-size" id="ref-for-concrete-object-size">concrete object size</a> of the <a data-link-type="dfn" href="https://drafts.csswg.org/css-display-3/#css-box" id="ref-for-css-box②">box</a>.</p>
   <p>For the purposes of the <a data-link-type="dfn" href="https://drafts.csswg.org/css-images-3/#object-size-negotiation" id="ref-for-object-size-negotiation①">object size negotiation</a> algorithm, the paint image has no <a data-link-type="dfn" href="https://drafts.csswg.org/css-images-3/#intrinsic-dimensions" id="ref-for-intrinsic-dimensions">intrinsic dimensions</a>.</p>
   <p class="note" role="note"><span>Note:</span> In a future version of the spec, the author could have the ability to specify the <a data-link-type="dfn" href="https://drafts.csswg.org/css-images-3/#intrinsic-dimensions" id="ref-for-intrinsic-dimensions①">intrinsic
    dimensions</a> of the paint image. This will probably be exposed as a callback allowing the
    author to define static <a data-link-type="dfn" href="https://drafts.csswg.org/css-images-3/#intrinsic-dimensions" id="ref-for-intrinsic-dimensions②">intrinsic dimensions</a> or dynamically updating the <a data-link-type="dfn" href="https://drafts.csswg.org/css-images-3/#intrinsic-dimensions" id="ref-for-intrinsic-dimensions③">intrinsic
    dimensions</a> based on computed style and size changes.</p>
   <p>The <code class="idl"><a data-link-type="idl" href="#paintsize" id="ref-for-paintsize①">PaintSize</a></code> object represents the size of the image that the author should draw. This is
the <a data-link-type="dfn" href="https://drafts.csswg.org/css-images-3/#concrete-object-size" id="ref-for-concrete-object-size①">concrete object size</a> given by the user agent.</p>
   <p class="note" role="note"><span>Note:</span> See <a href="https://www.w3.org/TR/css3-images/#object-sizing-examples">CSS Images 3 §5.4 Examples of CSS Object Sizing</a> for examples on how the <a data-link-type="dfn" href="https://drafts.csswg.org/css-images-3/#concrete-object-size" id="ref-for-concrete-object-size②">concrete object
    size</a> is calculated.</p>
   <p>The <a data-link-type="dfn" href="#draw-a-paint-image" id="ref-for-draw-a-paint-image⑥">draw a paint image</a> function may be speculatively invoked by the user agent at any point,
with any <var>concreteObjectSize</var>. The resulting image is not displayed.</p>
   <p class="note" role="note"><span>Note:</span> User agents may use any heuristic to speculate a possible future value for <var>concretObjectSize</var>,
    for example speculating that the size remains unchanged.</p>
   <p class="note" role="note"><span>Note:</span> Although the image is not displayed, it may still be cached, and subsequent invocations of <a class="production css" data-link-type="function" href="#funcdef-paint" id="ref-for-funcdef-paint①①">&lt;paint()></a> may use the cached image.</p>
<pre class="idl highlight def">[<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed" id="ref-for-Exposed②">Exposed</a>=<span class="n">PaintWorklet</span>]
<span class="kt">interface</span> <dfn class="nv dfn-paneled idl-code" data-dfn-type="interface" data-export="" id="paintsize"><code>PaintSize</code></dfn> {
    <span class="kt">readonly</span> <span class="kt">attribute</span> <a class="n idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-double" id="ref-for-idl-double"><span class="kt">double</span></a> <dfn class="nv idl-code" data-dfn-for="PaintSize" data-dfn-type="attribute" data-export="" data-readonly="" data-type="double" id="dom-paintsize-width"><code>width</code><a class="self-link" href="#dom-paintsize-width"></a></dfn>;
    <span class="kt">readonly</span> <span class="kt">attribute</span> <a class="n idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-double" id="ref-for-idl-double①"><span class="kt">double</span></a> <dfn class="nv idl-code" data-dfn-for="PaintSize" data-dfn-type="attribute" data-export="" data-readonly="" data-type="double" id="dom-paintsize-height"><code>height</code><a class="self-link" href="#dom-paintsize-height"></a></dfn>;
};
</pre>
   <div class="algorithm" data-algorithm="draw a paint image">
     When the user agent wants to <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="draw-a-paint-image">draw a paint image</dfn> of a <a class="production css" data-link-type="function" href="#funcdef-paint" id="ref-for-funcdef-paint①②">&lt;paint()></a> function for a <var>box</var> into its appropriate stacking level (as defined by the property the CSS property its associated
with), given <var>concreteObjectSize</var> it <em>must</em> run the following steps: 
    <ol>
     <li data-md="">
      <p>Let <var>paintFunction</var> be the <a class="production css" data-link-type="function" href="#funcdef-paint" id="ref-for-funcdef-paint①③">&lt;paint()></a> function on the <var>box</var> which the user agent wants to
draw.</p>
     <li data-md="">
      <p>If the <a data-link-type="dfn" href="#paint-valid-flag" id="ref-for-paint-valid-flag②">paint valid flag</a> for the <var>paintFunction</var> is <a data-link-type="dfn" href="#paint-valid" id="ref-for-paint-valid①">paint-valid</a>, and the
previous invocation had the same <var>concreteObjectSize</var>, the user agent <em>may</em> use the
drawn image from the previous invocation. If so it <em>may</em> abort all these steps and
use the previously drawn image.</p>
      <p class="note" role="note"><span>Note:</span> The user agent for implementation reasons may also continue with all these steps in
    this case. It can do this every frame, or multiple times per frame.</p>
     <li data-md="">
      <p>Set the <a data-link-type="dfn" href="#paint-valid-flag" id="ref-for-paint-valid-flag③">paint valid flag</a> for the <var>paintFunction</var> to <a data-link-type="dfn" href="#paint-valid" id="ref-for-paint-valid②">paint-valid</a>.</p>
     <li data-md="">
      <p>Let <var>name</var> be the first argument of the <var>paintFunction</var>.</p>
     <li data-md="">
      <p>Let <var>documentPaintDefinitionMap</var> be the associated <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-document" id="ref-for-concept-document④">document’s</a> <a data-link-type="dfn" href="#document-paint-definitions" id="ref-for-document-paint-definitions②">document paint
definitions</a> map.</p>
     <li data-md="">
      <p>If <var>documentPaintDefinitionMap</var>[<var>name</var>] does not <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-exists" id="ref-for-map-exists②">exist</a>, let the image output
be an <a data-link-type="dfn" href="https://drafts.csswg.org/css-images-4/#invalid-image" id="ref-for-invalid-image②">invalid image</a> and abort all these steps.</p>
     <li data-md="">
      <p>Let <var>documentDefinition</var> be the result of <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-get" id="ref-for-map-get①">get</a> <var>documentPaintDefinitionMap</var>[<var>name</var>].</p>
     <li data-md="">
      <p>If <var>documentDefinition</var> is <code>"invalid"</code>, let the image output be an <a data-link-type="dfn" href="https://drafts.csswg.org/css-images-4/#invalid-image" id="ref-for-invalid-image③">invalid
image</a> and abort all these steps.</p>
     <li data-md="">
      <p>Let <var>inputArgumentSyntaxes</var> be <var>documentDefinition</var>’s <a data-link-type="dfn" href="#document-paint-definition-input-argument-syntaxes" id="ref-for-document-paint-definition-input-argument-syntaxes②">input argument syntaxes</a>.</p>
     <li data-md="">
      <p>Let <var>inputArguments</var> be the <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list④">list</a> of all the <var>paintFunction</var> arguments <em>after</em> the "paint name" argument.</p>
     <li data-md="">
      <p>If <var>inputArguments</var> do not match the registered grammar given by <var>inputArgumentSyntaxes</var>,
let the image output be an <a data-link-type="dfn" href="https://drafts.csswg.org/css-images-4/#invalid-image" id="ref-for-invalid-image④">invalid image</a> and abort all these steps.</p>
      <div class="example" id="example-a927fd5d">
       <a class="self-link" href="#example-a927fd5d"></a> This step may fail in the following cases: 
<pre class="lang-javascript highlight"><span class="c1">// paint.js</span>
<span class="c1"></span>registerPaint<span class="p">(</span><span class="s1">'failing-argument-syntax'</span><span class="p">,</span> <span class="kr">class</span> <span class="p">{</span>
    <span class="kr">static</span> get inputArguments<span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="p">[</span><span class="s1">'&lt;length>'</span><span class="p">];</span> <span class="p">}</span>
    paint<span class="p">(</span>ctx<span class="p">,</span> size<span class="p">,</span> styleMap<span class="p">,</span> args<span class="p">)</span> <span class="p">{</span> <span class="cm">/* paint code here. */</span> <span class="p">}</span>
<span class="p">});</span>
</pre>
<pre class="lang-markup highlight"><span class="p">&lt;</span><span class="nt">style</span><span class="p">></span>
    <span class="p">.</span><span class="nc">example-1</span> <span class="p">{</span>
        <span class="k">background-image</span><span class="p">:</span> <span class="nf">paint</span><span class="p">(</span><span class="n">failing</span><span class="o">-</span><span class="n">argument</span><span class="o">-</span><span class="n">syntax</span><span class="p">,</span> <span class="kc">red</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="p">.</span><span class="nc">example-2</span> <span class="p">{</span>
        <span class="k">background-image</span><span class="p">:</span> <span class="nf">paint</span><span class="p">(</span><span class="n">failing</span><span class="o">-</span><span class="n">argument</span><span class="o">-</span><span class="n">syntax</span><span class="p">,</span> <span class="mi">1</span><span class="kt">px</span><span class="p">,</span> <span class="mi">2</span><span class="kt">px</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">&lt;/</span><span class="nt">style</span><span class="p">></span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">example-1</span><span class="p">>&lt;/</span><span class="nt">div</span><span class="p">></span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">example-2</span><span class="p">>&lt;/</span><span class="nt">div</span><span class="p">></span>
<span class="p">&lt;</span><span class="nt">script</span><span class="p">></span>
    CSS<span class="p">.</span>paintWorklet<span class="p">.</span>addModule<span class="p">(</span><span class="s1">'paint.js'</span><span class="p">);</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">></span>
</pre>
       <p><code>example-1</code> produces an <a data-link-type="dfn" href="https://drafts.csswg.org/css-images-4/#invalid-image" id="ref-for-invalid-image⑤">invalid image</a> as <code>"red"</code> does not
    match the registered grammar.</p>
       <p><code>example-2</code> produces an <a data-link-type="dfn" href="https://drafts.csswg.org/css-images-4/#invalid-image" id="ref-for-invalid-image⑥">invalid image</a> as there are too many function
    arguments.</p>
      </div>
     <li data-md="">
      <p>Let <var>workletGlobalScope</var> be a <code class="idl"><a data-link-type="idl" href="#paintworkletglobalscope" id="ref-for-paintworkletglobalscope⑦">PaintWorkletGlobalScope</a></code> from the list of <a data-link-type="dfn" href="https://drafts.css-houdini.org/worklets/#worklets-workletglobalscopes" id="ref-for-worklets-workletglobalscopes">worklet’s
WorkletGlobalScopes</a> from the paint <code class="idl"><a data-link-type="idl" href="https://drafts.css-houdini.org/worklets/#worklet" id="ref-for-worklet③">Worklet</a></code>.</p>
      <p>The user agent <em>must</em> have, and select from at least two <code class="idl"><a data-link-type="idl" href="#paintworkletglobalscope" id="ref-for-paintworkletglobalscope⑧">PaintWorkletGlobalScope</a></code>s
in the <a data-link-type="dfn" href="https://drafts.css-houdini.org/worklets/#worklets-workletglobalscopes" id="ref-for-worklets-workletglobalscopes①">worklet’s WorkletGlobalScopes</a> <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list⑤">list</a>, unless the user agent is under
memory constraints.</p>
      <p class="note" role="note"><span>Note:</span> This is to ensure that authors do not rely on being able to store state on the global
    object or non-regeneratable state on the class.</p>
      <p>The user agent <em>may</em> also <a data-link-type="dfn">create a WorkletGlobalScope</a> at this time, given the
paint <code class="idl"><a data-link-type="idl" href="https://drafts.css-houdini.org/worklets/#worklet" id="ref-for-worklet④">Worklet</a></code>.</p>
     <li data-md="">
      <p>Run <a data-link-type="dfn" href="#invoke-a-paint-callback" id="ref-for-invoke-a-paint-callback">invoke a paint callback</a> given <var>name</var>, <var>inputArguments</var>, <var>concreteObjectSize</var>, <var>workletGlobalScope</var> optionally <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel" id="ref-for-in-parallel">in parallel</a>.</p>
      <p class="note" role="note"><span>Note:</span> If the user agent runs <a data-link-type="dfn" href="#invoke-a-paint-callback" id="ref-for-invoke-a-paint-callback①">invoke a paint callback</a> on a thread <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel" id="ref-for-in-parallel①">in parallel</a>,
    it should select a paint worklet global scope which can be used on that thread.</p>
    </ol>
   </div>
   <div class="algorithm" data-algorithm="invoke a paint callback">
     When the user agent wants to <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="invoke-a-paint-callback">invoke a paint callback</dfn> given <var>name</var>, <var>inputArguments</var>, <var>concreteObjectSize</var>, and <var>workletGlobalScope</var>, it <em>must</em> run the following steps: 
    <ol>
     <li data-md="">
      <p>Let <var>paintDefinitionMap</var> be <var>workletGlobalScope</var>’s <a data-link-type="dfn" href="#paint-definitions" id="ref-for-paint-definitions①">paint definitions</a> map.</p>
     <li data-md="">
      <p>If <var>paintDefinitionMap</var>[<var>name</var>] does not <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-exists" id="ref-for-map-exists③">exist</a>, run the following steps:</p>
      <ol>
       <li data-md="">
        <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task" id="ref-for-queue-a-task①">Queue a task</a> to run the following steps:</p>
        <ol>
         <li data-md="">
          <p>Let <var>documentPaintDefinitionMap</var> be the associated <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-document" id="ref-for-concept-document⑤">document</a>’s <a data-link-type="dfn" href="#document-paint-definitions" id="ref-for-document-paint-definitions③">document
paint definitions</a> map.</p>
         <li data-md="">
          <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-set" id="ref-for-map-set③">Set</a> <var>documentPaintDefinitionMap</var>[<var>name</var>] to <code>"invalid"</code>.</p>
         <li data-md="">
          <p>The user agent <em>should</em> log an error to the debugging console stating that a
class wasn’t registered in all <code class="idl"><a data-link-type="idl" href="#paintworkletglobalscope" id="ref-for-paintworkletglobalscope⑨">PaintWorkletGlobalScope</a></code>s.</p>
        </ol>
       <li data-md="">
        <p>Let the image output be an <a data-link-type="dfn" href="https://drafts.csswg.org/css-images-4/#invalid-image" id="ref-for-invalid-image⑦">invalid image</a> and abort all these steps.</p>
      </ol>
      <p class="note" role="note"><span>Note:</span> This handles the case where there could be a paint worklet global scope which didn’t
    receive the <code class="idl"><a data-link-type="idl" href="#dom-paintworkletglobalscope-registerpaint" id="ref-for-dom-paintworkletglobalscope-registerpaint④">registerPaint(name, paintCtor)</a></code> for <var>name</var> (however another global scope
    did). A paint callback which is invoked on the other global scope could succeed, but
    wont succeed on a subsequent frame when <a data-link-type="dfn" href="#draw-a-paint-image" id="ref-for-draw-a-paint-image⑦">draw a paint image</a> is called.</p>
     <li data-md="">
      <p>Let <var>definition</var> be the result of <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#sec-get-o-p" id="ref-for-sec-get-o-p⑥">get</a> <var>paintDefinitionMap</var>[<var>name</var>].</p>
     <li data-md="">
      <p>Let <var>paintClassInstanceMap</var> be <var>workletGlobalScope</var>’s <a data-link-type="dfn" href="#paint-class-instances" id="ref-for-paint-class-instances①">paint class instances</a> map.</p>
     <li data-md="">
      <p>Let <var>paintInstance</var> be the result of <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#sec-get-o-p" id="ref-for-sec-get-o-p⑦">get</a> <var>paintClassInstanceMap</var>[|name]|. If <var>paintInstance</var> is null, run the following steps:</p>
      <ol>
       <li data-md="">
        <p>If the <a data-link-type="dfn" href="#paint-definition-constructor-valid-flag" id="ref-for-paint-definition-constructor-valid-flag①">constructor valid flag</a> on <var>definition</var> is false, let the image output be an <a data-link-type="dfn" href="https://drafts.csswg.org/css-images-4/#invalid-image" id="ref-for-invalid-image⑧">invalid image</a> and abort all these steps.</p>
       <li data-md="">
        <p>Let <var>paintCtor</var> be the <a data-link-type="dfn" href="#paint-definition-class-constructor" id="ref-for-paint-definition-class-constructor①">class constructor</a> on <var>definition</var>.</p>
       <li data-md="">
        <p>Let <var>paintInstance</var> be the result of <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#sec-construct" id="ref-for-sec-construct">Construct</a>(<var>paintCtor</var>).</p>
        <p>If <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#sec-construct" id="ref-for-sec-construct①">construct</a> throws an exception, set the <var>definition</var>’s <a data-link-type="dfn" href="#paint-definition-constructor-valid-flag" id="ref-for-paint-definition-constructor-valid-flag②">constructor valid
flag</a> to false, let the image output be an <a data-link-type="dfn" href="https://drafts.csswg.org/css-images-4/#invalid-image" id="ref-for-invalid-image⑨">invalid image</a> and abort all these
steps.</p>
       <li data-md="">
        <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-set" id="ref-for-map-set④">Set</a> <var>paintClassInstanceMap</var>[<var>name</var>] to <var>paintInstance</var>.</p>
      </ol>
     <li data-md="">
      <p>Let <var>inputProperties</var> be <var>definition</var>’s <a data-link-type="dfn" href="#paint-definition-input-properties" id="ref-for-paint-definition-input-properties①">input properties</a>.</p>
     <li data-md="">
      <p>Let <var>styleMap</var> be a new <code class="idl"><a data-link-type="idl" href="https://drafts.css-houdini.org/css-typed-om-1/#stylepropertymapreadonly" id="ref-for-stylepropertymapreadonly">StylePropertyMapReadOnly</a></code> populated with <em>only</em> the <a data-link-type="dfn" href="https://drafts.csswg.org/css-cascade-4/#computed-value" id="ref-for-computed-value②">computed value</a>’s for properties listed in <var>inputProperties</var>.</p>
     <li data-md="">
      <p>Let <var>renderingContext</var> be the result of <a data-link-type="dfn" href="#create-a-paintrenderingcontext2d-object" id="ref-for-create-a-paintrenderingcontext2d-object">create a PaintRenderingContext2D object</a> given:</p>
      <ul>
       <li data-md="">
        <p>"width" - The width given by <var>concreteObjectSize</var>.</p>
       <li data-md="">
        <p>"height" - The height given by <var>concreteObjectSize</var>.</p>
       <li data-md="">
        <p>"paintRenderingContext2DSettings" - The <a data-link-type="dfn" href="#paint-definition-paintrenderingcontext2dsettings-object" id="ref-for-paint-definition-paintrenderingcontext2dsettings-object①">PaintRenderingContext2DSettings object</a> given by <var>definition</var>.</p>
      </ul>
      <p class="note" role="note"><span>Note:</span> The <var>renderingContext</var> is not be re-used between invocations of paint. Implicitly this
    means that there is no stored data, or state on the <var>renderingContext</var> between
    invocations. For example you can’t setup a clip on the context, and expect the same clip
    to be applied next time the paint method is called.</p>
      <p class="note" role="note"><span>Note:</span> Implicitly this also means that <var>renderingContext</var> is effectively "neutered" after a
    paint method is complete. The author code may hold a reference to <var>renderingContext</var> and
    invoke methods on it, but this will have no effect on the current image, or subsequent
    images.</p>
     <li data-md="">
      <p>Let <var>paintSize</var> be a new <code class="idl"><a data-link-type="idl" href="#paintsize" id="ref-for-paintsize②">PaintSize</a></code> initialized to the width and height defined by <var>concreteObjectSize</var>.</p>
     <li data-md="">
      <p>At this stage the user agent may re-use an image from a previous invocation if <var>paintSize</var>, <var>styleMap</var>, <var>inputArguments</var> are equivalent to that previous invocation. If so let the image
output be that cached image and abort all these steps.</p>
      <div class="note" role="note">
        In the example below, both <code>div-1</code> and <code>div-2</code> have paint
    functions which have equivalent javascript arguments. A user-agent can cache the result
    of one invocation and use it for both elements. 
<pre class="lang-javascript highlight"><span class="c1">// paint.js</span>
<span class="c1"></span>registerPaint<span class="p">(</span><span class="s1">'simple'</span><span class="p">,</span> <span class="kr">class</span> <span class="p">{</span>
    paint<span class="p">(</span>ctx<span class="p">,</span> size<span class="p">)</span> <span class="p">{</span>
        ctx<span class="p">.</span>fillStyle <span class="o">=</span> <span class="s1">'green'</span><span class="p">;</span>
        ctx<span class="p">.</span>fillRect<span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> size<span class="p">.</span>width<span class="p">,</span> size<span class="p">.</span>height<span class="p">);</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre>
<pre class="lang-markup highlight"><span class="p">&lt;</span><span class="nt">style</span><span class="p">></span>
    <span class="p">.</span><span class="nc">div-1</span> <span class="p">{</span>
        <span class="k">width</span><span class="p">:</span> <span class="mi">50</span><span class="kt">px</span><span class="p">;</span>
        <span class="k">height</span><span class="p">:</span> <span class="mi">50</span><span class="kt">px</span><span class="p">;</span>
        <span class="k">background-image</span><span class="p">:</span> <span class="nf">paint</span><span class="p">(</span><span class="n">simple</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="p">.</span><span class="nc">div-2</span> <span class="p">{</span>
        <span class="k">width</span><span class="p">:</span> <span class="mi">100</span><span class="kt">px</span><span class="p">;</span>
        <span class="k">height</span><span class="p">:</span> <span class="mi">100</span><span class="kt">px</span><span class="p">;</span>

        <span class="k">background-size</span><span class="p">:</span> <span class="mi">50</span><span class="kt">%</span> <span class="mi">50</span><span class="kt">%</span><span class="p">;</span>
        <span class="k">background-image</span><span class="p">:</span> <span class="nf">paint</span><span class="p">(</span><span class="n">simple</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">&lt;/</span><span class="nt">style</span><span class="p">></span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">div-1</span><span class="p">>&lt;/</span><span class="nt">div</span><span class="p">></span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">div-2</span><span class="p">>&lt;/</span><span class="nt">div</span><span class="p">></span>
<span class="p">&lt;</span><span class="nt">script</span><span class="p">></span>
    CSS<span class="p">.</span>paintWorklet<span class="p">.</span>addModule<span class="p">(</span><span class="s1">'paint.js'</span><span class="p">);</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">></span>
</pre>
      </div>
     <li data-md="">
      <p>Let <var>paintFunctionCallback</var> be <var>definition</var>’s <a data-link-type="dfn" href="#paint-definition-paint-function" id="ref-for-paint-definition-paint-function①">paint function</a>.</p>
     <li data-md="">
      <p><a data-link-type="dfn" href="https://heycam.github.io/webidl/#invoke-a-callback-function" id="ref-for-invoke-a-callback-function">Invoke</a> <var>paintFunctionCallback</var> with arguments «<var>renderingContext</var>, <var>paintSize</var>, <var>styleMap</var>, <var>inputArguments</var>», and with <var>paintInstance</var> as the <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-callback-this-value" id="ref-for-dfn-callback-this-value">callback this value</a>.</p>
      <p>If <var>paintFunctionCallback</var> does not complete within an acceptable time (as determined by the
user agent, i.e. it is a "long running script") the user agent <em>may</em> terminate the
script, let the image output be an <a data-link-type="dfn" href="https://drafts.csswg.org/css-images-4/#invalid-image" id="ref-for-invalid-image①⓪">invalid image</a>, and abort all these steps.</p>
      <p class="note" role="note"><span>Note:</span> User agents could provide tooling within their debugging tools to show authors how
    expensive their paint classes are. User agents could also how an "unresponsive script"
    dialog in this case if appropriate.</p>
     <li data-md="">
      <p>The image output is to be produced from the <var>renderingContext</var> given to the method.</p>
      <p>If an exception is <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-throw" id="ref-for-dfn-throw⑧">thrown</a> the let the image output be an <a data-link-type="dfn" href="https://drafts.csswg.org/css-images-4/#invalid-image" id="ref-for-invalid-image①①">invalid image</a>.</p>
    </ol>
    <p class="note" role="note"><span>Note:</span> The contents of the resulting image are not designed to be accessible. Authors can communicate
    any useful information through the standard accessibility APIs.</p>
   </div>
   <h2 class="heading settled" data-level="9" id="examples"><span class="secno">9. </span><span class="content">Examples</span><a class="self-link" href="#examples"></a></h2>
   <h3 class="heading settled" data-level="9.1" id="example-1"><span class="secno">9.1. </span><span class="content">Example 1: Colored Circle</span><a class="self-link" href="#example-1"></a></h3>
   <p>The example below makes use of the fact that <a class="production css" data-link-type="function" href="#funcdef-paint" id="ref-for-funcdef-paint①④">&lt;paint()></a> functions are able to be animated. E.g.
when the textarea is focused in the example below, the <code>--circle-color</code> property will
transition from <code>deepskyblue</code> to <code>purple</code>.</p>
   <p>This ability isn’t limited to just transitions, it also applies to CSS animations, and the Web
Animations API.</p>
<pre class="lang-markup highlight"><span class="cp">&lt;!DOCTYPE html></span>
<span class="p">&lt;</span><span class="nt">style</span><span class="p">></span>
  <span class="p">#</span><span class="nn">example</span> <span class="p">{</span>
    --<span class="n">circle-color</span><span class="p">:</span> <span class="kc">deepskyblue</span><span class="p">;</span>

    <span class="k">background-image</span><span class="p">:</span> <span class="nf">paint</span><span class="p">(</span><span class="kc">circle</span><span class="p">);</span>
    <span class="k">font-family</span><span class="p">:</span> <span class="kc">sans-serif</span><span class="p">;</span>
    <span class="k">font-size</span><span class="p">:</span> <span class="mi">36</span><span class="kt">px</span><span class="p">;</span>
    <span class="k">transition</span><span class="p">:</span> <span class="o">--</span><span class="kc">circle</span><span class="o">-</span><span class="kc">color</span> <span class="mi">1</span><span class="kt">s</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="p">#</span><span class="nn">example</span><span class="p">:</span><span class="nd">focus</span> <span class="p">{</span>
    --<span class="n">circle-color</span><span class="p">:</span> <span class="kc">purple</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">&lt;/</span><span class="nt">style</span><span class="p">></span>

<span class="p">&lt;</span><span class="nt">textarea</span> <span class="na">id</span><span class="o">=</span><span class="s">"example"</span><span class="p">></span>
  CSS is awesome.
<span class="p">&lt;/</span><span class="nt">textarea</span><span class="p">></span>

<span class="p">&lt;</span><span class="nt">script</span><span class="p">></span>
    CSS<span class="p">.</span>registerProperty<span class="p">({</span>
      name<span class="o">:</span> <span class="s1">'--circle-color'</span><span class="p">,</span>
      syntax<span class="o">:</span> <span class="s1">'&lt;color>'</span><span class="p">,</span>
      initialValue<span class="o">:</span> <span class="s1">'black'</span><span class="p">,</span>
      inherit<span class="o">:</span> <span class="kc">false</span>
    <span class="p">});</span>
    CSS<span class="p">.</span>paintWorklet<span class="p">.</span>addModule<span class="p">(</span><span class="s1">'circle.js'</span><span class="p">);</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">></span>
</pre>
<pre class="lang-javascript highlight"><span class="c1">// circle.js</span>
<span class="c1"></span>registerPaint<span class="p">(</span><span class="s1">'circle'</span><span class="p">,</span> <span class="kr">class</span> <span class="p">{</span>
  <span class="kr">static</span> get inputProperties<span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="p">[</span><span class="s1">'--circle-color'</span><span class="p">];</span> <span class="p">}</span>
  paint<span class="p">(</span>ctx<span class="p">,</span> geom<span class="p">,</span> properties<span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Change the fill color.</span>
<span class="c1"></span>    <span class="kr">const</span> color <span class="o">=</span> properties<span class="p">.</span>get<span class="p">(</span><span class="s1">'--circle-color'</span><span class="p">);</span>
    ctx<span class="p">.</span>fillStyle <span class="o">=</span> color<span class="p">.</span>cssText<span class="p">;</span>

    <span class="c1">// Determine the center point and radius.</span>
<span class="c1"></span>    <span class="kr">const</span> x <span class="o">=</span> geom<span class="p">.</span>width <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
    <span class="kr">const</span> y <span class="o">=</span> geom<span class="p">.</span>height <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
    <span class="kr">const</span> radius <span class="o">=</span> Math<span class="p">.</span>min<span class="p">(</span>x<span class="p">,</span> y<span class="p">);</span>

    <span class="c1">// Draw the circle \o/</span>
<span class="c1"></span>    ctx<span class="p">.</span>beginPath<span class="p">();</span>
    ctx<span class="p">.</span>arc<span class="p">(</span>x<span class="p">,</span> y<span class="p">,</span> radius<span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> Math<span class="p">.</span>PI<span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
    ctx<span class="p">.</span>fill<span class="p">();</span>
  <span class="p">}</span>
<span class="p">});</span>
</pre>
   <h3 class="heading settled" data-level="9.2" id="example-2"><span class="secno">9.2. </span><span class="content">Example 2: Image Placeholder</span><a class="self-link" href="#example-2"></a></h3>
   <p>It is possible for an author to use paint to draw a placeholder image while an image is being
loaded.</p>
<pre class="lang-markup highlight"><span class="cp">&lt;!DOCTYPE html></span>
<span class="p">&lt;</span><span class="nt">style</span><span class="p">></span>
<span class="p">#</span><span class="nn">example</span> <span class="p">{</span>
    --<span class="n">image</span><span class="p">:</span> url<span class="p">(</span><span class="s1">'#someUrlWhichIsLoading'</span><span class="p">);</span>
    <span class="k">background-image</span><span class="p">:</span> <span class="nf">paint</span><span class="p">(</span><span class="n">image</span><span class="o">-</span><span class="n">with</span><span class="o">-</span><span class="n">placeholder</span><span class="p">);</span>
<span class="p">}</span>
<span class="p">&lt;/</span><span class="nt">style</span><span class="p">></span>

<span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">"example"</span><span class="p">>&lt;/</span><span class="nt">div</span><span class="p">></span>

<span class="p">&lt;</span><span class="nt">script</span><span class="p">></span>
    CSS<span class="p">.</span>registerProperty<span class="p">({</span>
        name<span class="o">:</span> <span class="s1">'--image'</span><span class="p">,</span>
        syntax<span class="o">:</span> <span class="s1">'&lt;image> | none'</span><span class="p">,</span>
        initialValue<span class="o">:</span> <span class="s1">'none'</span><span class="p">,</span>
    <span class="p">});</span>
    CSS<span class="p">.</span>paintWorklet<span class="p">.</span>addModule<span class="p">(</span><span class="s1">'image-placeholder.js'</span><span class="p">);</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">></span>
</pre>
<pre class="lang-javascript highlight"><span class="c1">// image-placeholder.js</span>
<span class="c1"></span>registerPaint<span class="p">(</span><span class="s1">'image-with-placeholder'</span><span class="p">,</span> <span class="kr">class</span> <span class="p">{</span>
    <span class="kr">static</span> get inputProperties<span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="p">[</span><span class="s1">'--image'</span><span class="p">];</span> <span class="p">}</span>
    paint<span class="p">(</span>ctx<span class="p">,</span> geom<span class="p">,</span> properties<span class="p">)</span> <span class="p">{</span>
        <span class="kr">const</span> img <span class="o">=</span> properties<span class="p">.</span>get<span class="p">(</span><span class="s1">'--image'</span><span class="p">);</span>

        <span class="k">switch</span> <span class="p">(</span>img<span class="p">.</span>state<span class="p">)</span> <span class="p">{</span>
            <span class="k">case</span> <span class="s1">'ready'</span><span class="o">:</span>
                <span class="c1">// The image is loaded! Draw the image.</span>
<span class="c1"></span>                ctx<span class="p">.</span>drawImage<span class="p">(</span>img<span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> geom<span class="p">.</span>width<span class="p">,</span> geom<span class="p">.</span>height<span class="p">);</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="k">case</span> <span class="s1">'pending'</span><span class="o">:</span>
                <span class="c1">// The image is loading, draw some mountains.</span>
<span class="c1"></span>                drawMountains<span class="p">(</span>ctx<span class="p">);</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="k">case</span> <span class="s1">'invalid'</span><span class="o">:</span>
            <span class="k">default</span><span class="o">:</span>
                <span class="c1">// The image is invalid (e.g. it didn’t load), draw a sad face.</span>
<span class="c1"></span>                drawSadFace<span class="p">(</span>ctx<span class="p">);</span>
                <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre>
   <h3 class="heading settled" data-level="9.3" id="example-3"><span class="secno">9.3. </span><span class="content">Example 3: Arcs</span><a class="self-link" href="#example-3"></a></h3>
<pre class="lang-markup highlight"><span class="cp">&lt;!DOCTYPE html></span>
<span class="p">&lt;</span><span class="nt">style</span><span class="p">></span>
<span class="p">#</span><span class="nn">example</span> <span class="p">{</span>
  <span class="k">width</span><span class="p">:</span> <span class="mi">200</span><span class="kt">px</span><span class="p">;</span>
  <span class="k">height</span><span class="p">:</span> <span class="mi">200</span><span class="kt">px</span><span class="p">;</span>

  <span class="k">background-image</span><span class="p">:</span>
    <span class="nf">paint</span><span class="p">(</span><span class="n">arc</span><span class="p">,</span> <span class="kc">purple</span><span class="p">,</span> <span class="mf">0.4</span><span class="kt">turn</span><span class="p">,</span> <span class="mf">0.8</span><span class="kt">turn</span><span class="p">,</span> <span class="mi">40</span><span class="kt">px</span><span class="p">,</span> <span class="mi">15</span><span class="kt">px</span><span class="p">),</span>
    <span class="nf">paint</span><span class="p">(</span><span class="n">arc</span><span class="p">,</span> <span class="kc">blue</span><span class="p">,</span> <span class="mi">-20</span><span class="kt">deg</span><span class="p">,</span> <span class="mi">170</span><span class="kt">deg</span><span class="p">,</span> <span class="mi">30</span><span class="kt">px</span><span class="p">,</span> <span class="mi">20</span><span class="kt">px</span><span class="p">),</span>
    <span class="nf">paint</span><span class="p">(</span><span class="n">arc</span><span class="p">,</span> <span class="kc">red</span><span class="p">,</span> <span class="mi">45</span><span class="kt">deg</span><span class="p">,</span> <span class="mi">220</span><span class="kt">deg</span><span class="p">,</span> <span class="mi">50</span><span class="kt">px</span><span class="p">,</span> <span class="mi">10</span><span class="kt">px</span><span class="p">);</span>
<span class="p">}</span>
<span class="p">&lt;/</span><span class="nt">style</span><span class="p">></span>

<span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">"example"</span><span class="p">>&lt;/</span><span class="nt">div</span><span class="p">></span>

<span class="p">&lt;</span><span class="nt">script</span><span class="p">></span>
    CSS<span class="p">.</span>paintWorklet<span class="p">.</span>addModule<span class="p">(</span><span class="s1">'arc.js'</span><span class="p">);</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">></span>
</pre>
<pre class="lang-javascript highlight"><span class="c1">// arc.js</span>
<span class="c1"></span>registerPaint<span class="p">(</span><span class="s1">'arc'</span><span class="p">,</span> <span class="kr">class</span> <span class="p">{</span>
  <span class="kr">static</span> get inputArguments<span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">[</span>
      <span class="s1">'&lt;color>'</span><span class="p">,</span>
      <span class="s1">'&lt;angle>'</span><span class="p">,</span>  <span class="c1">// startAngle</span>
<span class="c1"></span>      <span class="s1">'&lt;angle>'</span><span class="p">,</span>  <span class="c1">// endAngle</span>
<span class="c1"></span>      <span class="s1">'&lt;length>'</span><span class="p">,</span> <span class="c1">// radius</span>
<span class="c1"></span>      <span class="s1">'&lt;length>'</span><span class="p">,</span> <span class="c1">// lineWidth</span>
<span class="c1"></span>    <span class="p">];</span>
  <span class="p">}</span>

  paint<span class="p">(</span>ctx<span class="p">,</span> geom<span class="p">,</span> _<span class="p">,</span> args<span class="p">)</span> <span class="p">{</span>
    ctx<span class="p">.</span>strokeStyle <span class="o">=</span> args<span class="p">[</span><span class="mi">0</span><span class="p">].</span>cssText<span class="p">;</span>

    <span class="c1">// Determine the center point.</span>
<span class="c1"></span>    <span class="kr">const</span> x <span class="o">=</span> geom<span class="p">.</span>width <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
    <span class="kr">const</span> y <span class="o">=</span> geom<span class="p">.</span>height <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>

    <span class="c1">// Convert the start and end angles to radians.</span>
<span class="c1"></span>    <span class="kr">const</span> startAngle <span class="o">=</span> <span class="k">this</span><span class="p">.</span>convertAngle<span class="p">(</span>args<span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> Math<span class="p">.</span>PI <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
    <span class="kr">const</span> endAngle <span class="o">=</span> <span class="k">this</span><span class="p">.</span>convertAngle<span class="p">(</span>args<span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">-</span> Math<span class="p">.</span>PI <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>

    <span class="c1">// Convert the radius and lineWidth to px.</span>
<span class="c1"></span>    <span class="kr">const</span> radius <span class="o">=</span> <span class="k">this</span><span class="p">.</span>convertLength<span class="p">(</span>args<span class="p">[</span><span class="mi">3</span><span class="p">]);</span>
    <span class="kr">const</span> lineWidth <span class="o">=</span> <span class="k">this</span><span class="p">.</span>convertLength<span class="p">(</span>args<span class="p">[</span><span class="mi">4</span><span class="p">]);</span>

    ctx<span class="p">.</span>lineWidth <span class="o">=</span> lineWidth<span class="p">;</span>

    ctx<span class="p">.</span>beginPath<span class="p">();</span>
    ctx<span class="p">.</span>arc<span class="p">(</span>x<span class="p">,</span> y<span class="p">,</span> radius<span class="p">,</span> startAngle<span class="p">,</span> endAngle<span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
    ctx<span class="p">.</span>stroke<span class="p">();</span>
  <span class="p">}</span>

  convertAngle<span class="p">(</span>angle<span class="p">)</span> <span class="p">{</span>
    <span class="k">switch</span> <span class="p">(</span>angle<span class="p">.</span>unit<span class="p">)</span> <span class="p">{</span>
      <span class="k">case</span> <span class="s1">'deg'</span><span class="o">:</span>
        <span class="k">return</span> angle<span class="p">.</span>value <span class="o">*</span> Math<span class="p">.</span>PI <span class="o">/</span> <span class="mi">180</span><span class="p">;</span>
      <span class="k">case</span> <span class="s1">'rad'</span><span class="o">:</span>
        <span class="k">return</span> angle<span class="p">.</span>value<span class="p">;</span>
      <span class="k">case</span> <span class="s1">'grad'</span><span class="o">:</span>
        <span class="k">return</span> angle<span class="p">.</span>value <span class="o">*</span> Math<span class="p">.</span>PI <span class="o">/</span> <span class="mi">200</span><span class="p">;</span>
      <span class="k">case</span> <span class="s1">'turn'</span><span class="o">:</span>
        <span class="k">return</span> angle<span class="p">.</span>value <span class="o">*</span> Math<span class="p">.</span>PI <span class="o">/</span> <span class="mf">0.5</span><span class="p">;</span>
      <span class="k">default</span><span class="o">:</span>
        <span class="k">throw</span> Error<span class="p">(</span><span class="sb">`Unknown angle unit: </span><span class="si">${</span>angle<span class="p">.</span>unit<span class="si">}</span><span class="sb">`</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>

  convertLength<span class="p">(</span>length<span class="p">)</span> <span class="p">{</span>
    <span class="k">switch</span> <span class="p">(</span>length<span class="p">.</span>type<span class="p">)</span> <span class="p">{</span>
      <span class="k">case</span> <span class="s1">'px'</span><span class="o">:</span>
        <span class="k">return</span> length<span class="p">.</span>value<span class="p">;</span>
      <span class="k">default</span><span class="o">:</span>
        <span class="k">throw</span> Error<span class="p">(</span><span class="sb">`Unkown length type: </span><span class="si">${</span>length<span class="p">.</span>type<span class="si">}</span><span class="sb">`</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">});</span>
</pre>
   <h3 class="heading settled" data-level="9.4" id="example-4"><span class="secno">9.4. </span><span class="content">Example 4: Different Colors (based on size)</span><a class="self-link" href="#example-4"></a></h3>
<pre class="lang-markup highlight"><span class="p">&lt;</span><span class="nt">h1</span><span class="p">></span>
    Heading 1
<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">></span>
<span class="p">&lt;</span><span class="nt">h1</span><span class="p">></span>
    Another heading
<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">></span>

<span class="p">&lt;</span><span class="nt">style</span><span class="p">></span>
<span class="nt">h1</span> <span class="p">{</span>
    <span class="k">background-image</span><span class="p">:</span> <span class="nf">paint</span><span class="p">(</span><span class="n">heading</span><span class="o">-</span><span class="kc">color</span><span class="p">);</span>
<span class="p">}</span>
<span class="p">&lt;/</span><span class="nt">style</span><span class="p">></span>

<span class="p">&lt;</span><span class="nt">script</span><span class="p">></span>
    CSS<span class="p">.</span>paintWorklet<span class="p">.</span>addModule<span class="p">(</span><span class="s1">'heading-color.js'</span><span class="p">);</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">></span>
</pre>
<pre class="lang-javascript highlight"><span class="c1">// heading-color.js</span>
<span class="c1"></span>registerPaint<span class="p">(</span><span class="s1">'heading-color'</span><span class="p">,</span> <span class="kr">class</span> <span class="p">{</span>
    <span class="kr">static</span> get inputProperties<span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="p">[];</span> <span class="p">}</span>
    paint<span class="p">(</span>ctx<span class="p">,</span> geom<span class="p">,</span> properties<span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Select a color based on the width and height of the image.</span>
<span class="c1"></span>        <span class="kr">const</span> width <span class="o">=</span> geom<span class="p">.</span>width<span class="p">;</span>
        <span class="kr">const</span> height <span class="o">=</span> geom<span class="p">.</span>height<span class="p">;</span>
        <span class="kr">const</span> color <span class="o">=</span> colorArray<span class="p">[(</span>width <span class="o">*</span> height<span class="p">)</span> <span class="o">%</span> colorArray<span class="p">.</span>length<span class="p">];</span>

        <span class="c1">// Draw just a solid image.</span>
<span class="c1"></span>        ctx<span class="p">.</span>fillStyle <span class="o">=</span> color<span class="p">;</span>
        ctx<span class="p">.</span>fillRect<span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> width<span class="p">,</span> height<span class="p">);</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre>
   <h3 class="heading settled" data-level="9.5" id="example-5"><span class="secno">9.5. </span><span class="content">Example 5: Drawing outside an element’s area</span><a class="self-link" href="#example-5"></a></h3>
   <p>It is possible to draw outside an element’s area by using the <a class="property" data-link-type="propdesc" href="https://drafts.csswg.org/css-backgrounds-3/#propdef-border-image" id="ref-for-propdef-border-image">border-image</a> property.</p>
<pre class="lang-markup highlight"><span class="p">&lt;</span><span class="nt">style</span><span class="p">></span>
<span class="p">#</span><span class="nn">overdraw</span> <span class="p">{</span>
    --<span class="k">border-width</span><span class="p">:</span> <span class="mi">10</span><span class="p">;</span>

    <span class="k">border-style</span><span class="p">:</span> <span class="kc">solid</span><span class="p">;</span>
    <span class="k">border-width</span><span class="p">:</span> calc<span class="p">(</span><span class="nf">var</span><span class="p">(</span><span class="o">--</span><span class="n">border</span><span class="o">-</span><span class="n">width</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1</span><span class="kt">px</span><span class="p">);</span>

    <span class="k">border-image-source</span><span class="p">:</span> <span class="nf">paint</span><span class="p">(</span><span class="n">overdraw</span><span class="p">);</span>
    <span class="k">border-image-slice</span><span class="p">:</span> <span class="mi">0</span> <span class="kc">fill</span><span class="p">;</span>
    <span class="k">border-image-outset</span><span class="p">:</span> calc<span class="p">(</span><span class="nf">var</span><span class="p">(</span><span class="o">--</span><span class="n">border</span><span class="o">-</span><span class="n">width</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1</span><span class="kt">px</span><span class="p">);</span>

    <span class="k">width</span><span class="p">:</span> <span class="mi">200</span><span class="kt">px</span><span class="p">;</span>
    <span class="k">height</span><span class="p">:</span> <span class="mi">200</span><span class="kt">px</span><span class="p">;</span>
<span class="p">}</span>
<span class="p">&lt;/</span><span class="nt">style</span><span class="p">></span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">"overdraw"</span><span class="p">>&lt;/</span><span class="nt">div</span><span class="p">></span>
<span class="p">&lt;</span><span class="nt">script</span><span class="p">></span>
    CSS<span class="p">.</span>paintWorklet<span class="p">.</span>addModule<span class="p">(</span><span class="s1">'overdraw.js'</span><span class="p">);</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">></span>
</pre>
<pre class="lang-javascript highlight"><span class="c1">// overdraw.js</span>
<span class="c1"></span>registerPaint<span class="p">(</span><span class="s1">'overdraw'</span><span class="p">,</span> <span class="kr">class</span> <span class="p">{</span>
    <span class="kr">static</span> get inputProperties<span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="p">[</span><span class="s1">'--border-width'</span><span class="p">];</span> <span class="p">}</span>
    paint<span class="p">(</span>ctx<span class="p">,</span> geom<span class="p">,</span> properties<span class="p">)</span> <span class="p">{</span>
        <span class="kr">const</span> borderWidth <span class="o">=</span> parseInt<span class="p">(</span>properties<span class="p">.</span>get<span class="p">(</span><span class="s1">'--border-width'</span><span class="p">));</span>
        ctx<span class="p">.</span>shadowColor <span class="o">=</span> <span class="s1">'rgba(0,0,0,0.25)'</span><span class="p">;</span>
        ctx<span class="p">.</span>shadowBlur <span class="o">=</span> borderWidth<span class="p">;</span>

        ctx<span class="p">.</span>fillStyle <span class="o">=</span> <span class="s1">'rgba(255, 255, 255, 1)'</span><span class="p">;</span>
        ctx<span class="p">.</span>fillRect<span class="p">(</span>borderWidth<span class="p">,</span>
                     borderWidth<span class="p">,</span>
                     geom<span class="p">.</span>width <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> borderWidth<span class="p">,</span>
                     geom<span class="p">.</span>height <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> borderWidth<span class="p">);</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre>
  </main>
  <h2 class="no-ref no-num heading settled" id="conformance"><span class="content"> Conformance</span><a class="self-link" href="#conformance"></a></h2>
  <h3 class="no-ref heading settled" id="conventions"><span class="content"> Document conventions</span><a class="self-link" href="#conventions"></a></h3>
  <p>Conformance requirements are expressed with a combination of
    descriptive assertions and RFC 2119 terminology. The key words “MUST”,
    “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”,
    “RECOMMENDED”, “MAY”, and “OPTIONAL” in the normative parts of this
    document are to be interpreted as described in RFC 2119.
    However, for readability, these words do not appear in all uppercase
    letters in this specification. </p>
  <p>All of the text of this specification is normative except sections
    explicitly marked as non-normative, examples, and notes. <a data-link-type="biblio" href="#biblio-rfc2119">[RFC2119]</a></p>
  <p>Examples in this specification are introduced with the words “for example”
    or are set apart from the normative text with <code>class="example"</code>,
    like this: </p>
  <div class="example" id="example-f839f6c8">
   <a class="self-link" href="#example-f839f6c8"></a> 
   <p>This is an example of an informative example.</p>
  </div>
  <p>Informative notes begin with the word “Note” and are set apart from the
    normative text with <code>class="note"</code>, like this: </p>
  <p class="note" role="note">Note, this is an informative note.</p>
  <p>Advisements are normative sections styled to evoke special attention and are
    set apart from other normative text with <code>&lt;strong class="advisement"></code>, like
    this: <strong class="advisement"> UAs MUST provide an accessible alternative. </strong> </p>
  <h3 class="no-ref heading settled" id="conformance-classes"><span class="content"> Conformance classes</span><a class="self-link" href="#conformance-classes"></a></h3>
  <p>Conformance to this specification
    is defined for three conformance classes: </p>
  <dl>
   <dt>style sheet 
   <dd>A <a href="http://www.w3.org/TR/CSS21/conform.html#style-sheet">CSS
            style sheet</a>. 
   <dt>renderer 
   <dd>A <a href="http://www.w3.org/TR/CSS21/conform.html#user-agent">UA</a> that interprets the semantics of a style sheet and renders
            documents that use them. 
   <dt>authoring tool 
   <dd>A <a href="http://www.w3.org/TR/CSS21/conform.html#user-agent">UA</a> that writes a style sheet. 
  </dl>
  <p>A style sheet is conformant to this specification
    if all of its statements that use syntax defined in this module are valid
    according to the generic CSS grammar and the individual grammars of each
    feature defined in this module. </p>
  <p>A renderer is conformant to this specification
    if, in addition to interpreting the style sheet as defined by the
    appropriate specifications, it supports all the features defined
    by this specification by parsing them correctly
    and rendering the document accordingly. However, the inability of a
    UA to correctly render a document due to limitations of the device
    does not make the UA non-conformant. (For example, a UA is not
    required to render color on a monochrome monitor.) </p>
  <p>An authoring tool is conformant to this specification
    if it writes style sheets that are syntactically correct according to the
    generic CSS grammar and the individual grammars of each feature in
    this module, and meet all other conformance requirements of style sheets
    as described in this module. </p>
  <h3 class="no-ref heading settled" id="partial"><span class="content"> Partial implementations</span><a class="self-link" href="#partial"></a></h3>
  <p>So that authors can exploit the forward-compatible parsing rules to
    assign fallback values, CSS renderers <strong>must</strong> treat as invalid (and <a href="http://www.w3.org/TR/CSS21/conform.html#ignore">ignore
    as appropriate</a>) any at-rules, properties, property values, keywords,
    and other syntactic constructs for which they have no usable level of
    support. In particular, user agents <strong>must not</strong> selectively
    ignore unsupported component values and honor supported values in a single
    multi-value property declaration: if any value is considered invalid
    (as unsupported values must be), CSS requires that the entire declaration
    be ignored.</p>
  <h4 class="heading settled" id="conform-future-proofing"><span class="content"> Implementations of Unstable and Proprietary Features</span><a class="self-link" href="#conform-future-proofing"></a></h4>
  <p>To avoid clashes with future stable CSS features,
        the CSSWG recommends <a href="http://www.w3.org/TR/CSS/#future-proofing">following best practices</a> for the implementation of <a href="http://www.w3.org/TR/CSS/#unstable">unstable</a> features and <a href="http://www.w3.org/TR/CSS/#proprietary-extension">proprietary extensions</a> to CSS. </p>
  <h3 class="no-ref heading settled" id="testing"><span class="content"> Non-experimental implementations</span><a class="self-link" href="#testing"></a></h3>
  <p>Once a specification reaches the Candidate Recommendation stage,
    non-experimental implementations are possible, and implementors should
    release an unprefixed implementation of any CR-level feature they
    can demonstrate to be correctly implemented according to spec. </p>
  <p>To establish and maintain the interoperability of CSS across
    implementations, the CSS Working Group requests that non-experimental
    CSS renderers submit an implementation report (and, if necessary, the
    testcases used for that implementation report) to the W3C before
    releasing an unprefixed implementation of any CSS features. Testcases
    submitted to W3C are subject to review and correction by the CSS
    Working Group. </p>
  <p>
   Further information on submitting testcases and implementation reports
    can be found from on the CSS Working Group’s website at <a href="http://www.w3.org/Style/CSS/Test/">http://www.w3.org/Style/CSS/Test/</a>.
    Questions should be directed to the <a href="http://lists.w3.org/Archives/Public/public-css-testsuite">public-css-testsuite@w3.org</a> mailing list. 
<script src="https://www.w3.org/scripts/TR/2016/fixup.js"></script>
  </p>
  <h2 class="no-num no-ref heading settled" id="index"><span class="content">Index</span><a class="self-link" href="#index"></a></h2>
  <h3 class="no-num no-ref heading settled" id="index-defined-here"><span class="content">Terms defined by this specification</span><a class="self-link" href="#index-defined-here"></a></h3>
  <ul class="index">
   <li><a href="#dom-paintrenderingcontext2dsettings-alpha">alpha</a><span>, in §3</span>
   <li><a href="#paint-definition-class-constructor">class constructor</a><span>, in §4</span>
   <li><a href="#paint-definition-constructor-valid-flag">constructor valid flag</a><span>, in §4</span>
   <li><a href="#create-a-paintrenderingcontext2d-object">create a PaintRenderingContext2D object</a><span>, in §7</span>
   <li><a href="#dom-paintworkletglobalscope-devicepixelratio">devicePixelRatio</a><span>, in §3</span>
   <li><a href="#document-paint-definition">document paint definition</a><span>, in §4</span>
   <li><a href="#document-paint-definitions">document paint definitions</a><span>, in §5</span>
   <li><a href="#draw-a-paint-image">draw a paint image</a><span>, in §8</span>
   <li><a href="#dom-paintsize-height">height</a><span>, in §8</span>
   <li><a href="#document-paint-definition-input-argument-syntaxes">input argument syntaxes</a><span>, in §4</span>
   <li>
    input properties
    <ul>
     <li><a href="#document-paint-definition-input-properties">dfn for document paint definition</a><span>, in §4</span>
     <li><a href="#paint-definition-input-properties">dfn for paint definition</a><span>, in §4</span>
    </ul>
   <li><a href="#invalidate-paint-functions">invalidate paint functions</a><span>, in §2</span>
   <li><a href="#invoke-a-paint-callback">invoke a paint callback</a><span>, in §8</span>
   <li><a href="#funcdef-paint">paint()</a><span>, in §6</span>
   <li><a href="#paint-class-instances">paint class instances</a><span>, in §5</span>
   <li><a href="#paint-definition">paint definition</a><span>, in §4</span>
   <li><a href="#paint-definitions">paint definitions</a><span>, in §5</span>
   <li><a href="#paint-definition-paint-function">paint function</a><span>, in §4</span>
   <li><a href="#paint-invalid">paint-invalid</a><span>, in §2</span>
   <li><a href="#paintrenderingcontext2d">PaintRenderingContext2D</a><span>, in §7</span>
   <li><a href="#dictdef-paintrenderingcontext2dsettings">PaintRenderingContext2DSettings</a><span>, in §3</span>
   <li>
    PaintRenderingContext2DSettings object
    <ul>
     <li><a href="#document-paint-definition-paintrenderingcontext2dsettings-object">dfn for document paint definition</a><span>, in §4</span>
     <li><a href="#paint-definition-paintrenderingcontext2dsettings-object">dfn for paint definition</a><span>, in §4</span>
    </ul>
   <li><a href="#paintsize">PaintSize</a><span>, in §8</span>
   <li><a href="#paint-valid">paint-valid</a><span>, in §2</span>
   <li><a href="#paint-valid-flag">paint valid flag</a><span>, in §2</span>
   <li><a href="#dom-css-paintworklet">paintWorklet</a><span>, in §3</span>
   <li><a href="#paintworkletglobalscope">PaintWorkletGlobalScope</a><span>, in §3</span>
   <li><a href="#dom-paintworkletglobalscope-registerpaint">registerPaint(name, paintCtor)</a><span>, in §5</span>
   <li><a href="#dom-paintsize-width">width</a><span>, in §8</span>
  </ul>
  <h3 class="no-num no-ref heading settled" id="index-defined-elsewhere"><span class="content">Terms defined by reference</span><a class="self-link" href="#index-defined-elsewhere"></a></h3>
  <ul class="index">
   <li>
    <a data-link-type="biblio">[css-backgrounds-3]</a> defines the following terms:
    <ul>
     <li><a href="https://drafts.csswg.org/css-backgrounds-3/#propdef-border-image">border-image</a>
    </ul>
   <li>
    <a data-link-type="biblio">[css-cascade-4]</a> defines the following terms:
    <ul>
     <li><a href="https://drafts.csswg.org/css-cascade-4/#computed-value">computed value</a>
    </ul>
   <li>
    <a data-link-type="biblio">[css-display-3]</a> defines the following terms:
    <ul>
     <li><a href="https://drafts.csswg.org/css-display-3/#css-box">box</a>
    </ul>
   <li>
    <a data-link-type="biblio">[css-images-4]</a> defines the following terms:
    <ul>
     <li><a href="https://drafts.csswg.org/css-images-4/#invalid-image">invalid image</a>
    </ul>
   <li>
    <a data-link-type="biblio">[css-syntax-3]</a> defines the following terms:
    <ul>
     <li><a href="https://drafts.csswg.org/css-syntax-3/#typedef-declaration-value">&lt;declaration-value></a>
    </ul>
   <li>
    <a data-link-type="biblio">[css-typed-om-1]</a> defines the following terms:
    <ul>
     <li><a href="https://drafts.css-houdini.org/css-typed-om-1/#stylepropertymap">StylePropertyMap</a>
     <li><a href="https://drafts.css-houdini.org/css-typed-om-1/#stylepropertymapreadonly">StylePropertyMapReadOnly</a>
    </ul>
   <li>
    <a data-link-type="biblio">[css-ui-4]</a> defines the following terms:
    <ul>
     <li><a href="https://drafts.csswg.org/css-ui-4/#propdef-cursor">cursor</a>
    </ul>
   <li>
    <a data-link-type="biblio">[css-values-4]</a> defines the following terms:
    <ul>
     <li><a href="https://drafts.csswg.org/css-values-4/#comb-comma">,</a>
     <li><a href="https://drafts.csswg.org/css-values-4/#typedef-ident">&lt;ident></a>
     <li><a href="https://drafts.csswg.org/css-values-4/#mult-opt">?</a>
    </ul>
   <li>
    <a data-link-type="biblio">[css3-images]</a> defines the following terms:
    <ul>
     <li><a href="https://drafts.csswg.org/css-images-3/#typedef-image">&lt;image></a>
     <li><a href="https://drafts.csswg.org/css-images-3/#concrete-object-size">concrete object size</a>
     <li><a href="https://drafts.csswg.org/css-images-3/#intrinsic-dimensions">intrinsic dimensions</a>
     <li><a href="https://drafts.csswg.org/css-images-3/#object-size-negotiation">object size negotiation</a>
    </ul>
   <li>
    <a data-link-type="biblio">[cssom-1]</a> defines the following terms:
    <ul>
     <li><a href="https://drafts.csswg.org/cssom-1/#css">CSS</a>
    </ul>
   <li>
    <a data-link-type="biblio">[cssom-view-1]</a> defines the following terms:
    <ul>
     <li><a href="https://drafts.csswg.org/cssom-view-1/#dom-window-devicepixelratio">devicePixelRatio</a>
    </ul>
   <li>
    <a data-link-type="biblio">[DOM]</a> defines the following terms:
    <ul>
     <li><a href="https://dom.spec.whatwg.org/#concept-document">document</a>
    </ul>
   <li>
    <a data-link-type="biblio">[HTML]</a> defines the following terms:
    <ul>
     <li><a href="https://html.spec.whatwg.org/multipage/canvas.html#canvascompositing">CanvasCompositing</a>
     <li><a href="https://html.spec.whatwg.org/multipage/canvas.html#canvasdrawimage">CanvasDrawImage</a>
     <li><a href="https://html.spec.whatwg.org/multipage/canvas.html#canvasdrawpath">CanvasDrawPath</a>
     <li><a href="https://html.spec.whatwg.org/multipage/canvas.html#canvasfillstrokestyles">CanvasFillStrokeStyles</a>
     <li><a href="https://html.spec.whatwg.org/multipage/canvas.html#canvasimagedata">CanvasImageData</a>
     <li><a href="https://html.spec.whatwg.org/multipage/canvas.html#canvasimagesmoothing">CanvasImageSmoothing</a>
     <li><a href="https://html.spec.whatwg.org/multipage/canvas.html#canvaspath">CanvasPath</a>
     <li><a href="https://html.spec.whatwg.org/multipage/canvas.html#canvaspathdrawingstyles">CanvasPathDrawingStyles</a>
     <li><a href="https://html.spec.whatwg.org/multipage/canvas.html#canvasrect">CanvasRect</a>
     <li><a href="https://html.spec.whatwg.org/multipage/canvas.html#canvasrenderingcontext2d">CanvasRenderingContext2D</a>
     <li><a href="https://html.spec.whatwg.org/multipage/canvas.html#canvasshadowstyles">CanvasShadowStyles</a>
     <li><a href="https://html.spec.whatwg.org/multipage/canvas.html#canvasstate">CanvasState</a>
     <li><a href="https://html.spec.whatwg.org/multipage/canvas.html#canvastext">CanvasText</a>
     <li><a href="https://html.spec.whatwg.org/multipage/canvas.html#canvastextdrawingstyles">CanvasTextDrawingStyles</a>
     <li><a href="https://html.spec.whatwg.org/multipage/canvas.html#canvastransform">CanvasTransform</a>
     <li><a href="https://html.spec.whatwg.org/multipage/canvas.html#canvasuserinterface">CanvasUserInterface</a>
     <li><a href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel">in parallel</a>
     <li><a href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task">queue a task</a>
    </ul>
   <li>
    <a data-link-type="biblio">[INFRA]</a> defines the following terms:
    <ul>
     <li><a href="https://infra.spec.whatwg.org/#list-append">append</a>
     <li><a href="https://infra.spec.whatwg.org/#list-empty">empty</a>
     <li><a href="https://infra.spec.whatwg.org/#map-exists">exist</a>
     <li><a href="https://infra.spec.whatwg.org/#list-iterate">for each</a>
     <li><a href="https://infra.spec.whatwg.org/#map-get">get</a>
     <li><a href="https://infra.spec.whatwg.org/#list">list</a>
     <li><a href="https://infra.spec.whatwg.org/#ordered-map">map</a>
     <li><a href="https://infra.spec.whatwg.org/#map-set">set</a>
     <li><a href="https://infra.spec.whatwg.org/#struct">struct</a>
    </ul>
   <li>
    <a data-link-type="biblio">[WebIDL]</a> defines the following terms:
    <ul>
     <li><a href="https://heycam.github.io/webidl/#idl-DOMString">DOMString</a>
     <li><a href="https://heycam.github.io/webidl/#Exposed">Exposed</a>
     <li><a href="https://heycam.github.io/webidl/#Global">Global</a>
     <li><a href="https://heycam.github.io/webidl/#SameObject">SameObject</a>
     <li><a href="https://heycam.github.io/webidl/#VoidFunction">VoidFunction</a>
     <li><a href="https://heycam.github.io/webidl/#idl-boolean">boolean</a>
     <li><a href="https://heycam.github.io/webidl/#dfn-callback-this-value">callback this value</a>
     <li><a href="https://heycam.github.io/webidl/#idl-double">double</a>
     <li><a href="https://heycam.github.io/webidl/#invoke-a-callback-function">invoke</a>
     <li><a href="https://heycam.github.io/webidl/#dfn-throw">throw</a>
     <li><a href="https://heycam.github.io/webidl/#idl-unrestricted-double">unrestricted double</a>
    </ul>
   <li>
    <a data-link-type="biblio">[worklets-1]</a> defines the following terms:
    <ul>
     <li><a href="https://drafts.css-houdini.org/worklets/#worklet">Worklet</a>
     <li><a href="https://drafts.css-houdini.org/worklets/#workletglobalscope">WorkletGlobalScope</a>
     <li><a href="https://drafts.css-houdini.org/worklets/#worklet-global-scope-type">worklet global scope type</a>
     <li><a href="https://drafts.css-houdini.org/worklets/#worklets-workletglobalscopes">worklet's workletglobalscopes</a>
    </ul>
  </ul>
  <h2 class="no-num no-ref heading settled" id="references"><span class="content">References</span><a class="self-link" href="#references"></a></h2>
  <h3 class="no-num no-ref heading settled" id="normative"><span class="content">Normative References</span><a class="self-link" href="#normative"></a></h3>
  <dl>
   <dt id="biblio-css-backgrounds-3">[CSS-BACKGROUNDS-3]
   <dd>Bert Bos; Elika Etemad; Brad Kemper. <a href="https://www.w3.org/TR/css-backgrounds-3/">CSS Backgrounds and Borders Module Level 3</a>. 17 October 2017. CR. URL: <a href="https://www.w3.org/TR/css-backgrounds-3/">https://www.w3.org/TR/css-backgrounds-3/</a>
   <dt id="biblio-css-cascade-4">[CSS-CASCADE-4]
   <dd>Elika Etemad; Tab Atkins Jr.. <a href="https://www.w3.org/TR/css-cascade-4/">CSS Cascading and Inheritance Level 4</a>. 14 January 2016. CR. URL: <a href="https://www.w3.org/TR/css-cascade-4/">https://www.w3.org/TR/css-cascade-4/</a>
   <dt id="biblio-css-display-3">[CSS-DISPLAY-3]
   <dd>Elika Etemad. <a href="https://www.w3.org/TR/css-display-3/">CSS Display Module Level 3</a>. 20 July 2017. WD. URL: <a href="https://www.w3.org/TR/css-display-3/">https://www.w3.org/TR/css-display-3/</a>
   <dt id="biblio-css-images-4">[CSS-IMAGES-4]
   <dd>Tab Atkins Jr.; Elika Etemad; Lea Verou. <a href="https://www.w3.org/TR/css-images-4/">CSS Image Values and Replaced Content Module Level 4</a>. 13 April 2017. WD. URL: <a href="https://www.w3.org/TR/css-images-4/">https://www.w3.org/TR/css-images-4/</a>
   <dt id="biblio-css-syntax-3">[CSS-SYNTAX-3]
   <dd>Tab Atkins Jr.; Simon Sapin. <a href="https://www.w3.org/TR/css-syntax-3/">CSS Syntax Module Level 3</a>. 20 February 2014. CR. URL: <a href="https://www.w3.org/TR/css-syntax-3/">https://www.w3.org/TR/css-syntax-3/</a>
   <dt id="biblio-css-typed-om-1">[CSS-TYPED-OM-1]
   <dd>Shane Stephens; Tab Atkins Jr.. <a href="https://www.w3.org/TR/css-typed-om-1/">CSS Typed OM Level 1</a>. 1 August 2017. WD. URL: <a href="https://www.w3.org/TR/css-typed-om-1/">https://www.w3.org/TR/css-typed-om-1/</a>
   <dt id="biblio-css-ui-4">[CSS-UI-4]
   <dd>Florian Rivoal. <a href="https://www.w3.org/TR/css-ui-4/">CSS Basic User Interface Module Level 4</a>. 22 December 2017. WD. URL: <a href="https://www.w3.org/TR/css-ui-4/">https://www.w3.org/TR/css-ui-4/</a>
   <dt id="biblio-css-values-4">[CSS-VALUES-4]
   <dd>CSS Values and Units Module Level 4 URL: <a href="https://drafts.csswg.org/css-values-4/">https://drafts.csswg.org/css-values-4/</a>
   <dt id="biblio-css3-images">[CSS3-IMAGES]
   <dd>Elika Etemad; Tab Atkins Jr.. <a href="https://www.w3.org/TR/css3-images/">CSS Image Values and Replaced Content Module Level 3</a>. 17 April 2012. CR. URL: <a href="https://www.w3.org/TR/css3-images/">https://www.w3.org/TR/css3-images/</a>
   <dt id="biblio-cssom-1">[CSSOM-1]
   <dd>Simon Pieters; Glenn Adams. <a href="https://www.w3.org/TR/cssom-1/">CSS Object Model (CSSOM)</a>. 17 March 2016. WD. URL: <a href="https://www.w3.org/TR/cssom-1/">https://www.w3.org/TR/cssom-1/</a>
   <dt id="biblio-cssom-view-1">[CSSOM-VIEW-1]
   <dd>Simon Pieters. <a href="https://www.w3.org/TR/cssom-view-1/">CSSOM View Module</a>. 17 March 2016. WD. URL: <a href="https://www.w3.org/TR/cssom-view-1/">https://www.w3.org/TR/cssom-view-1/</a>
   <dt id="biblio-dom">[DOM]
   <dd>Anne van Kesteren. <a href="https://dom.spec.whatwg.org/">DOM Standard</a>. Living Standard. URL: <a href="https://dom.spec.whatwg.org/">https://dom.spec.whatwg.org/</a>
   <dt id="biblio-html">[HTML]
   <dd>Anne van Kesteren; et al. <a href="https://html.spec.whatwg.org/multipage/">HTML Standard</a>. Living Standard. URL: <a href="https://html.spec.whatwg.org/multipage/">https://html.spec.whatwg.org/multipage/</a>
   <dt id="biblio-infra">[INFRA]
   <dd>Anne van Kesteren; Domenic Denicola. <a href="https://infra.spec.whatwg.org/">Infra Standard</a>. Living Standard. URL: <a href="https://infra.spec.whatwg.org/">https://infra.spec.whatwg.org/</a>
   <dt id="biblio-rfc2119">[RFC2119]
   <dd>S. Bradner. <a href="https://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>. March 1997. Best Current Practice. URL: <a href="https://tools.ietf.org/html/rfc2119">https://tools.ietf.org/html/rfc2119</a>
   <dt id="biblio-webidl">[WebIDL]
   <dd>Cameron McCormack; Boris Zbarsky; Tobie Langel. <a href="https://heycam.github.io/webidl/">Web IDL</a>. 15 December 2016. ED. URL: <a href="https://heycam.github.io/webidl/">https://heycam.github.io/webidl/</a>
   <dt id="biblio-worklets-1">[WORKLETS-1]
   <dd>Ian Kilpatrick. <a href="https://www.w3.org/TR/worklets-1/">Worklets Level 1</a>. 7 June 2016. WD. URL: <a href="https://www.w3.org/TR/worklets-1/">https://www.w3.org/TR/worklets-1/</a>
  </dl>
  <h2 class="no-num no-ref heading settled" id="idl-index"><span class="content">IDL Index</span><a class="self-link" href="#idl-index"></a></h2>
<pre class="idl highlight def"><span class="kt">partial</span> <span class="kt">interface</span> <a class="nv idl-code" data-link-type="interface" href="https://drafts.csswg.org/cssom-1/#css" id="ref-for-css①">CSS</a> {
    [<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#SameObject" id="ref-for-SameObject①">SameObject</a>] <span class="kt">readonly</span> <span class="kt">attribute</span> <a class="n" data-link-type="idl-name" href="https://drafts.css-houdini.org/worklets/#worklet" id="ref-for-worklet①①">Worklet</a> <a class="nv" data-readonly="" data-type="Worklet" href="#dom-css-paintworklet"><code>paintWorklet</code></a>;
};

[<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Global" id="ref-for-Global①">Global</a>=(<a class="n" data-link-type="idl-name" href="https://drafts.css-houdini.org/worklets/#worklet" id="ref-for-worklet②①">Worklet</a>,<a class="n" data-link-type="idl-name">PaintWorklet</a>),<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed" id="ref-for-Exposed③">Exposed</a>=<span class="n">PaintWorklet</span>]
<span class="kt">interface</span> <a class="nv" href="#paintworkletglobalscope"><code>PaintWorkletGlobalScope</code></a> : <a class="n" data-link-type="idl-name" href="https://drafts.css-houdini.org/worklets/#workletglobalscope" id="ref-for-workletglobalscope①">WorkletGlobalScope</a> {
    <span class="kt">void</span> <a class="nv idl-code" data-link-type="method" href="#dom-paintworkletglobalscope-registerpaint" id="ref-for-dom-paintworkletglobalscope-registerpaint⑤">registerPaint</a>(<a class="n idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString" id="ref-for-idl-DOMString①"><span class="kt">DOMString</span></a> <a class="nv" href="#dom-paintworkletglobalscope-registerpaint-name-paintctor-name"><code>name</code></a>, <a class="n" data-link-type="idl-name" href="https://heycam.github.io/webidl/#VoidFunction" id="ref-for-VoidFunction①">VoidFunction</a> <a class="nv" href="#dom-paintworkletglobalscope-registerpaint-name-paintctor-paintctor"><code>paintCtor</code></a>);
    <span class="kt">readonly</span> <span class="kt">attribute</span> <a class="n idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-unrestricted-double" id="ref-for-idl-unrestricted-double①"><span class="kt">unrestricted</span> <span class="kt">double</span></a> <a class="nv" data-readonly="" data-type="unrestricted double" href="#dom-paintworkletglobalscope-devicepixelratio"><code>devicePixelRatio</code></a>;
};

<span class="kt">dictionary</span> <a class="nv" href="#dictdef-paintrenderingcontext2dsettings"><code>PaintRenderingContext2DSettings</code></a> {
    <a class="n idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-boolean" id="ref-for-idl-boolean①"><span class="kt">boolean</span></a> <a class="nv" data-default="true" data-type="boolean " href="#dom-paintrenderingcontext2dsettings-alpha"><code>alpha</code></a> = <span class="kt">true</span>;
};

[<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed" id="ref-for-Exposed①①">Exposed</a>=<span class="n">PaintWorklet</span>]
<span class="kt">interface</span> <a class="nv" href="#paintrenderingcontext2d"><code>PaintRenderingContext2D</code></a> {
};
<a class="n" data-link-type="idl-name" href="#paintrenderingcontext2d" id="ref-for-paintrenderingcontext2d①⑧">PaintRenderingContext2D</a> <span class="kt">implements</span> <a class="n" data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/canvas.html#canvasstate" id="ref-for-canvasstate①">CanvasState</a>;
<a class="n" data-link-type="idl-name" href="#paintrenderingcontext2d" id="ref-for-paintrenderingcontext2d①⑦">PaintRenderingContext2D</a> <span class="kt">implements</span> <a class="n" data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/canvas.html#canvastransform" id="ref-for-canvastransform①">CanvasTransform</a>;
<a class="n" data-link-type="idl-name" href="#paintrenderingcontext2d" id="ref-for-paintrenderingcontext2d②①">PaintRenderingContext2D</a> <span class="kt">implements</span> <a class="n" data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/canvas.html#canvascompositing" id="ref-for-canvascompositing①">CanvasCompositing</a>;
<a class="n" data-link-type="idl-name" href="#paintrenderingcontext2d" id="ref-for-paintrenderingcontext2d③①">PaintRenderingContext2D</a> <span class="kt">implements</span> <a class="n" data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/canvas.html#canvasimagesmoothing" id="ref-for-canvasimagesmoothing①">CanvasImageSmoothing</a>;
<a class="n" data-link-type="idl-name" href="#paintrenderingcontext2d" id="ref-for-paintrenderingcontext2d④①">PaintRenderingContext2D</a> <span class="kt">implements</span> <a class="n" data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/canvas.html#canvasfillstrokestyles" id="ref-for-canvasfillstrokestyles①">CanvasFillStrokeStyles</a>;
<a class="n" data-link-type="idl-name" href="#paintrenderingcontext2d" id="ref-for-paintrenderingcontext2d⑤①">PaintRenderingContext2D</a> <span class="kt">implements</span> <a class="n" data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/canvas.html#canvasshadowstyles" id="ref-for-canvasshadowstyles①">CanvasShadowStyles</a>;
<a class="n" data-link-type="idl-name" href="#paintrenderingcontext2d" id="ref-for-paintrenderingcontext2d⑥①">PaintRenderingContext2D</a> <span class="kt">implements</span> <a class="n" data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/canvas.html#canvasrect" id="ref-for-canvasrect①">CanvasRect</a>;
<a class="n" data-link-type="idl-name" href="#paintrenderingcontext2d" id="ref-for-paintrenderingcontext2d⑦①">PaintRenderingContext2D</a> <span class="kt">implements</span> <a class="n" data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/canvas.html#canvasdrawpath" id="ref-for-canvasdrawpath①">CanvasDrawPath</a>;
<a class="n" data-link-type="idl-name" href="#paintrenderingcontext2d" id="ref-for-paintrenderingcontext2d⑧①">PaintRenderingContext2D</a> <span class="kt">implements</span> <a class="n" data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/canvas.html#canvasdrawimage" id="ref-for-canvasdrawimage①">CanvasDrawImage</a>;
<a class="n" data-link-type="idl-name" href="#paintrenderingcontext2d" id="ref-for-paintrenderingcontext2d⑨①">PaintRenderingContext2D</a> <span class="kt">implements</span> <a class="n" data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/canvas.html#canvaspathdrawingstyles" id="ref-for-canvaspathdrawingstyles①">CanvasPathDrawingStyles</a>;
<a class="n" data-link-type="idl-name" href="#paintrenderingcontext2d" id="ref-for-paintrenderingcontext2d①⓪①">PaintRenderingContext2D</a> <span class="kt">implements</span> <a class="n" data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/canvas.html#canvaspath" id="ref-for-canvaspath①">CanvasPath</a>;

[<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed" id="ref-for-Exposed②①">Exposed</a>=<span class="n">PaintWorklet</span>]
<span class="kt">interface</span> <a class="nv" href="#paintsize"><code>PaintSize</code></a> {
    <span class="kt">readonly</span> <span class="kt">attribute</span> <a class="n idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-double" id="ref-for-idl-double②"><span class="kt">double</span></a> <a class="nv" data-readonly="" data-type="double" href="#dom-paintsize-width"><code>width</code></a>;
    <span class="kt">readonly</span> <span class="kt">attribute</span> <a class="n idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-double" id="ref-for-idl-double①①"><span class="kt">double</span></a> <a class="nv" data-readonly="" data-type="double" href="#dom-paintsize-height"><code>height</code></a>;
};

</pre>
  <aside class="dfn-panel" data-for="paint-valid-flag">
   <b><a href="#paint-valid-flag">#paint-valid-flag</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-paint-valid-flag">2. Paint Invalidation</a> <a href="#ref-for-paint-valid-flag①">(2)</a>
    <li><a href="#ref-for-paint-valid-flag②">8. Drawing an image</a> <a href="#ref-for-paint-valid-flag③">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="paint-valid">
   <b><a href="#paint-valid">#paint-valid</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-paint-valid">2. Paint Invalidation</a>
    <li><a href="#ref-for-paint-valid①">8. Drawing an image</a> <a href="#ref-for-paint-valid②">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="paint-invalid">
   <b><a href="#paint-invalid">#paint-invalid</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-paint-invalid">2. Paint Invalidation</a> <a href="#ref-for-paint-invalid①">(2)</a>
    <li><a href="#ref-for-paint-invalid②">8. Drawing an image</a> <a href="#ref-for-paint-invalid③">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="invalidate-paint-functions">
   <b><a href="#invalidate-paint-functions">#invalidate-paint-functions</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-invalidate-paint-functions">2. Paint Invalidation</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-css-paintworklet">
   <b><a href="#dom-css-paintworklet">#dom-css-paintworklet</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-css-paintworklet">3. Paint Worklet</a> <a href="#ref-for-dom-css-paintworklet①">(2)</a> <a href="#ref-for-dom-css-paintworklet②">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="paintworkletglobalscope">
   <b><a href="#paintworkletglobalscope">#paintworkletglobalscope</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-paintworkletglobalscope">3. Paint Worklet</a> <a href="#ref-for-paintworkletglobalscope①">(2)</a> <a href="#ref-for-paintworkletglobalscope②">(3)</a>
    <li><a href="#ref-for-paintworkletglobalscope③">4. Concepts</a>
    <li><a href="#ref-for-paintworkletglobalscope④">5. Registering Custom Paint</a> <a href="#ref-for-paintworkletglobalscope⑤">(2)</a> <a href="#ref-for-paintworkletglobalscope⑥">(3)</a>
    <li><a href="#ref-for-paintworkletglobalscope⑦">8. Drawing an image</a> <a href="#ref-for-paintworkletglobalscope⑧">(2)</a> <a href="#ref-for-paintworkletglobalscope⑨">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-paintworkletglobalscope-devicepixelratio">
   <b><a href="#dom-paintworkletglobalscope-devicepixelratio">#dom-paintworkletglobalscope-devicepixelratio</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-paintworkletglobalscope-devicepixelratio">3. Paint Worklet</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dictdef-paintrenderingcontext2dsettings">
   <b><a href="#dictdef-paintrenderingcontext2dsettings">#dictdef-paintrenderingcontext2dsettings</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dictdef-paintrenderingcontext2dsettings">3. Paint Worklet</a> <a href="#ref-for-dictdef-paintrenderingcontext2dsettings①">(2)</a>
    <li><a href="#ref-for-dictdef-paintrenderingcontext2dsettings②">5. Registering Custom Paint</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="paint-definition">
   <b><a href="#paint-definition">#paint-definition</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-paint-definition">5. Registering Custom Paint</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="paint-definition-class-constructor">
   <b><a href="#paint-definition-class-constructor">#paint-definition-class-constructor</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-paint-definition-class-constructor">5. Registering Custom Paint</a>
    <li><a href="#ref-for-paint-definition-class-constructor①">8. Drawing an image</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="paint-definition-paint-function">
   <b><a href="#paint-definition-paint-function">#paint-definition-paint-function</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-paint-definition-paint-function">5. Registering Custom Paint</a>
    <li><a href="#ref-for-paint-definition-paint-function①">8. Drawing an image</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="paint-definition-constructor-valid-flag">
   <b><a href="#paint-definition-constructor-valid-flag">#paint-definition-constructor-valid-flag</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-paint-definition-constructor-valid-flag">5. Registering Custom Paint</a>
    <li><a href="#ref-for-paint-definition-constructor-valid-flag①">8. Drawing an image</a> <a href="#ref-for-paint-definition-constructor-valid-flag②">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="paint-definition-input-properties">
   <b><a href="#paint-definition-input-properties">#paint-definition-input-properties</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-paint-definition-input-properties">5. Registering Custom Paint</a>
    <li><a href="#ref-for-paint-definition-input-properties①">8. Drawing an image</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="paint-definition-paintrenderingcontext2dsettings-object">
   <b><a href="#paint-definition-paintrenderingcontext2dsettings-object">#paint-definition-paintrenderingcontext2dsettings-object</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-paint-definition-paintrenderingcontext2dsettings-object">5. Registering Custom Paint</a>
    <li><a href="#ref-for-paint-definition-paintrenderingcontext2dsettings-object①">8. Drawing an image</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="document-paint-definition">
   <b><a href="#document-paint-definition">#document-paint-definition</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-document-paint-definition">5. Registering Custom Paint</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="document-paint-definition-input-properties">
   <b><a href="#document-paint-definition-input-properties">#document-paint-definition-input-properties</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-document-paint-definition-input-properties">2. Paint Invalidation</a>
    <li><a href="#ref-for-document-paint-definition-input-properties①">5. Registering Custom Paint</a> <a href="#ref-for-document-paint-definition-input-properties②">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="document-paint-definition-input-argument-syntaxes">
   <b><a href="#document-paint-definition-input-argument-syntaxes">#document-paint-definition-input-argument-syntaxes</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-document-paint-definition-input-argument-syntaxes">5. Registering Custom Paint</a> <a href="#ref-for-document-paint-definition-input-argument-syntaxes①">(2)</a>
    <li><a href="#ref-for-document-paint-definition-input-argument-syntaxes②">8. Drawing an image</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="document-paint-definition-paintrenderingcontext2dsettings-object">
   <b><a href="#document-paint-definition-paintrenderingcontext2dsettings-object">#document-paint-definition-paintrenderingcontext2dsettings-object</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-document-paint-definition-paintrenderingcontext2dsettings-object">5. Registering Custom Paint</a> <a href="#ref-for-document-paint-definition-paintrenderingcontext2dsettings-object①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="document-paint-definitions">
   <b><a href="#document-paint-definitions">#document-paint-definitions</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-document-paint-definitions">2. Paint Invalidation</a>
    <li><a href="#ref-for-document-paint-definitions①">5. Registering Custom Paint</a>
    <li><a href="#ref-for-document-paint-definitions②">8. Drawing an image</a> <a href="#ref-for-document-paint-definitions③">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="paint-definitions">
   <b><a href="#paint-definitions">#paint-definitions</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-paint-definitions">5. Registering Custom Paint</a>
    <li><a href="#ref-for-paint-definitions①">8. Drawing an image</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="paint-class-instances">
   <b><a href="#paint-class-instances">#paint-class-instances</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-paint-class-instances">5. Registering Custom Paint</a>
    <li><a href="#ref-for-paint-class-instances①">8. Drawing an image</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-paintworkletglobalscope-registerpaint">
   <b><a href="#dom-paintworkletglobalscope-registerpaint">#dom-paintworkletglobalscope-registerpaint</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-paintworkletglobalscope-registerpaint">3. Paint Worklet</a>
    <li><a href="#ref-for-dom-paintworkletglobalscope-registerpaint①">5. Registering Custom Paint</a> <a href="#ref-for-dom-paintworkletglobalscope-registerpaint②">(2)</a>
    <li><a href="#ref-for-dom-paintworkletglobalscope-registerpaint③">6. Paint Notation</a>
    <li><a href="#ref-for-dom-paintworkletglobalscope-registerpaint④">8. Drawing an image</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="funcdef-paint">
   <b><a href="#funcdef-paint">#funcdef-paint</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-funcdef-paint">2. Paint Invalidation</a> <a href="#ref-for-funcdef-paint①">(2)</a> <a href="#ref-for-funcdef-paint②">(3)</a> <a href="#ref-for-funcdef-paint③">(4)</a> <a href="#ref-for-funcdef-paint④">(5)</a>
    <li><a href="#ref-for-funcdef-paint⑤">4. Concepts</a>
    <li><a href="#ref-for-funcdef-paint⑥">5. Registering Custom Paint</a>
    <li><a href="#ref-for-funcdef-paint⑦">6. Paint Notation</a> <a href="#ref-for-funcdef-paint⑧">(2)</a> <a href="#ref-for-funcdef-paint⑨">(3)</a>
    <li><a href="#ref-for-funcdef-paint①⓪">8. Drawing an image</a> <a href="#ref-for-funcdef-paint①①">(2)</a> <a href="#ref-for-funcdef-paint①②">(3)</a> <a href="#ref-for-funcdef-paint①③">(4)</a>
    <li><a href="#ref-for-funcdef-paint①④">9.1. Example 1: Colored Circle</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="paintrenderingcontext2d">
   <b><a href="#paintrenderingcontext2d">#paintrenderingcontext2d</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-paintrenderingcontext2d">7. The 2D rendering context</a> <a href="#ref-for-paintrenderingcontext2d①">(2)</a> <a href="#ref-for-paintrenderingcontext2d②">(3)</a> <a href="#ref-for-paintrenderingcontext2d③">(4)</a> <a href="#ref-for-paintrenderingcontext2d④">(5)</a> <a href="#ref-for-paintrenderingcontext2d⑤">(6)</a> <a href="#ref-for-paintrenderingcontext2d⑥">(7)</a> <a href="#ref-for-paintrenderingcontext2d⑦">(8)</a> <a href="#ref-for-paintrenderingcontext2d⑧">(9)</a> <a href="#ref-for-paintrenderingcontext2d⑨">(10)</a> <a href="#ref-for-paintrenderingcontext2d①⓪">(11)</a> <a href="#ref-for-paintrenderingcontext2d①①">(12)</a> <a href="#ref-for-paintrenderingcontext2d①②">(13)</a> <a href="#ref-for-paintrenderingcontext2d①③">(14)</a> <a href="#ref-for-paintrenderingcontext2d①④">(15)</a> <a href="#ref-for-paintrenderingcontext2d①⑤">(16)</a> <a href="#ref-for-paintrenderingcontext2d①⑥">(17)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="create-a-paintrenderingcontext2d-object">
   <b><a href="#create-a-paintrenderingcontext2d-object">#create-a-paintrenderingcontext2d-object</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-create-a-paintrenderingcontext2d-object">8. Drawing an image</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="paintsize">
   <b><a href="#paintsize">#paintsize</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-paintsize">5. Registering Custom Paint</a>
    <li><a href="#ref-for-paintsize①">8. Drawing an image</a> <a href="#ref-for-paintsize②">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="draw-a-paint-image">
   <b><a href="#draw-a-paint-image">#draw-a-paint-image</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-draw-a-paint-image">2. Paint Invalidation</a>
    <li><a href="#ref-for-draw-a-paint-image①">5. Registering Custom Paint</a>
    <li><a href="#ref-for-draw-a-paint-image②">6. Paint Notation</a>
    <li><a href="#ref-for-draw-a-paint-image③">8. Drawing an image</a> <a href="#ref-for-draw-a-paint-image④">(2)</a> <a href="#ref-for-draw-a-paint-image⑤">(3)</a> <a href="#ref-for-draw-a-paint-image⑥">(4)</a> <a href="#ref-for-draw-a-paint-image⑦">(5)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="invoke-a-paint-callback">
   <b><a href="#invoke-a-paint-callback">#invoke-a-paint-callback</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-invoke-a-paint-callback">8. Drawing an image</a> <a href="#ref-for-invoke-a-paint-callback①">(2)</a>
   </ul>
  </aside>
<script>/* script-dfn-panel */

        document.body.addEventListener("click", function(e) {
            var queryAll = function(sel) { return [].slice.call(document.querySelectorAll(sel)); }
            // Find the dfn element or panel, if any, that was clicked on.
            var el = e.target;
            var target;
            var hitALink = false;
            while(el.parentElement) {
                if(el.tagName == "A") {
                    // Clicking on a link in a <dfn> shouldn't summon the panel
                    hitALink = true;
                }
                if(el.classList.contains("dfn-paneled")) {
                    target = "dfn";
                    break;
                }
                if(el.classList.contains("dfn-panel")) {
                    target = "dfn-panel";
                    break;
                }
                el = el.parentElement;
            }
            if(target != "dfn-panel") {
                // Turn off any currently "on" or "activated" panels.
                queryAll(".dfn-panel.on, .dfn-panel.activated").forEach(function(el){
                    el.classList.remove("on");
                    el.classList.remove("activated");
                });
            }
            if(target == "dfn" && !hitALink) {
                // open the panel
                var dfnPanel = document.querySelector(".dfn-panel[data-for='" + el.id + "']");
                if(dfnPanel) {
                    console.log(dfnPanel);
                    dfnPanel.classList.add("on");
                    var rect = el.getBoundingClientRect();
                    dfnPanel.style.left = window.scrollX + rect.right + 5 + "px";
                    dfnPanel.style.top = window.scrollY + rect.top + "px";
                    var panelRect = dfnPanel.getBoundingClientRect();
                    var panelWidth = panelRect.right - panelRect.left;
                    if(panelRect.right > document.body.scrollWidth && (rect.left - (panelWidth + 5)) > 0) {
                        // Reposition, because the panel is overflowing
                        dfnPanel.style.left = window.scrollX + rect.left - (panelWidth + 5) + "px";
                    }
                } else {
                    console.log("Couldn't find .dfn-panel[data-for='" + el.id + "']");
                }
            } else if(target == "dfn-panel") {
                // Switch it to "activated" state, which pins it.
                el.classList.add("activated");
                el.style.left = null;
                el.style.top = null;
            }

        });
        </script>