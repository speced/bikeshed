<!doctype html><html lang="en">
 <head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
  <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
  <title>CSS Painting API Level 1</title>
  <meta content="ED" name="w3c-status">
  <link href="https://www.w3.org/StyleSheets/TR/2021/W3C-ED" rel="stylesheet">
  <link href="http://www.w3.org/TR/css-paint-api-1/" rel="canonical">
  <meta content="dark light" name="color-scheme">
  <link href="https://www.w3.org/StyleSheets/TR/2021/dark.css" media="(prefers-color-scheme: dark)" rel="stylesheet" type="text/css">
<style>
/* Put nice boxes around each algorithm. */
[data-algorithm]:not(.heading) {
    padding: .5em;
    border: thin solid #ddd; border-radius: .5em;
    margin: .5em calc(-0.5em - 1px);
}
[data-algorithm]:not(.heading) > :first-child {
    margin-top: 0;
}
[data-algorithm]:not(.heading) > :last-child {
    margin-bottom: 0;
}
</style>
<style>/* Boilerplate: style-autolinks */
.css.css, .property.property, .descriptor.descriptor {
    color: var(--a-normal-text);
    font-size: inherit;
    font-family: inherit;
}
.css::before, .property::before, .descriptor::before {
    content: "‘";
}
.css::after, .property::after, .descriptor::after {
    content: "’";
}
.property, .descriptor {
    /* Don't wrap property and descriptor names */
    white-space: nowrap;
}
.type { /* CSS value <type> */
    font-style: italic;
}
pre .property::before, pre .property::after {
    content: "";
}
[data-link-type="property"]::before,
[data-link-type="propdesc"]::before,
[data-link-type="descriptor"]::before,
[data-link-type="value"]::before,
[data-link-type="function"]::before,
[data-link-type="at-rule"]::before,
[data-link-type="selector"]::before,
[data-link-type="maybe"]::before {
    content: "‘";
}
[data-link-type="property"]::after,
[data-link-type="propdesc"]::after,
[data-link-type="descriptor"]::after,
[data-link-type="value"]::after,
[data-link-type="function"]::after,
[data-link-type="at-rule"]::after,
[data-link-type="selector"]::after,
[data-link-type="maybe"]::after {
    content: "’";
}

[data-link-type].production::before,
[data-link-type].production::after,
.prod [data-link-type]::before,
.prod [data-link-type]::after {
    content: "";
}

[data-link-type=element],
[data-link-type=element-attr] {
    font-family: Menlo, Consolas, "DejaVu Sans Mono", monospace;
    font-size: .9em;
}
[data-link-type=element]::before { content: "<" }
[data-link-type=element]::after  { content: ">" }

[data-link-type=biblio] {
    white-space: pre;
}

@media (prefers-color-scheme: dark) {
    :root {
        --selflink-text: black;
        --selflink-bg: silver;
        --selflink-hover-text: white;
    }
}
</style>
<style>/* Boilerplate: style-colors */
/* Any --*-text not paired with a --*-bg is assumed to have a transparent bg */
:root {
    color-scheme: light dark;

    --text: black;
    --bg: white;

    --unofficial-watermark: url(https://www.w3.org/StyleSheets/TR/2016/logos/UD-watermark);

    --logo-bg: #1a5e9a;
    --logo-active-bg: #c00;
    --logo-text: white;

    --tocnav-normal-text: #707070;
    --tocnav-normal-bg: var(--bg);
    --tocnav-hover-text: var(--tocnav-normal-text);
    --tocnav-hover-bg: #f8f8f8;
    --tocnav-active-text: #c00;
    --tocnav-active-bg: var(--tocnav-normal-bg);

    --tocsidebar-text: var(--text);
    --tocsidebar-bg: #f7f8f9;
    --tocsidebar-shadow: rgba(0,0,0,.1);
    --tocsidebar-heading-text: hsla(203,20%,40%,.7);

    --toclink-text: var(--text);
    --toclink-underline: #3980b5;
    --toclink-visited-text: var(--toclink-text);
    --toclink-visited-underline: #054572;

    --heading-text: #005a9c;

    --hr-text: var(--text);

    --algo-border: #def;

    --del-text: red;
    --del-bg: transparent;
    --ins-text: #080;
    --ins-bg: transparent;

    --a-normal-text: #034575;
    --a-normal-underline: #bbb;
    --a-visited-text: var(--a-normal-text);
    --a-visited-underline: #707070;
    --a-hover-bg: rgba(75%, 75%, 75%, .25);
    --a-active-text: #c00;
    --a-active-underline: #c00;

    --blockquote-border: silver;
    --blockquote-bg: transparent;
    --blockquote-text: currentcolor;

    --issue-border: #e05252;
    --issue-bg: #fbe9e9;
    --issue-text: var(--text);
    --issueheading-text: #831616;

    --example-border: #e0cb52;
    --example-bg: #fcfaee;
    --example-text: var(--text);
    --exampleheading-text: #574b0f;

    --note-border: #52e052;
    --note-bg: #e9fbe9;
    --note-text: var(--text);
    --noteheading-text: hsl(120, 70%, 30%);
    --notesummary-underline: silver;

    --assertion-border: #aaa;
    --assertion-bg: #eee;
    --assertion-text: black;

    --advisement-border: orange;
    --advisement-bg: #fec;
    --advisement-text: var(--text);
    --advisementheading-text: #b35f00;

    --warning-border: red;
    --warning-bg: hsla(40,100%,50%,0.95);
    --warning-text: var(--text);

    --amendment-border: #330099;
    --amendment-bg: #F5F0FF;
    --amendment-text: var(--text);
    --amendmentheading-text: #220066;

    --def-border: #8ccbf2;
    --def-bg: #def;
    --def-text: var(--text);
    --defrow-border: #bbd7e9;

    --datacell-border: silver;

    --indexinfo-text: #707070;

    --indextable-hover-text: black;
    --indextable-hover-bg: #f7f8f9;

    --outdatedspec-bg: rgba(0, 0, 0, .5);
    --outdatedspec-text: black;
    --outdated-bg: maroon;
    --outdated-text: white;
    --outdated-shadow: red;

    --editedrec-bg: darkorange;
}

@media (prefers-color-scheme: dark) {
    :root {
        --text: #ddd;
        --bg: black;

        --unofficial-watermark: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='400'%3E%3Cg fill='%23100808' transform='translate(200 200) rotate(-45) translate(-200 -200)' stroke='%23100808' stroke-width='3'%3E%3Ctext x='50%25' y='220' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EUNOFFICIAL%3C/text%3E%3Ctext x='50%25' y='305' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EDRAFT%3C/text%3E%3C/g%3E%3C/svg%3E");

        --logo-bg: #1a5e9a;
        --logo-active-bg: #c00;
        --logo-text: white;

        --tocnav-normal-text: #999;
        --tocnav-normal-bg: var(--bg);
        --tocnav-hover-text: var(--tocnav-normal-text);
        --tocnav-hover-bg: #080808;
        --tocnav-active-text: #f44;
        --tocnav-active-bg: var(--tocnav-normal-bg);

        --tocsidebar-text: var(--text);
        --tocsidebar-bg: #080808;
        --tocsidebar-shadow: rgba(255,255,255,.1);
        --tocsidebar-heading-text: hsla(203,20%,40%,.7);

        --toclink-text: var(--text);
        --toclink-underline: #6af;
        --toclink-visited-text: var(--toclink-text);
        --toclink-visited-underline: #054572;

        --heading-text: #8af;

        --hr-text: var(--text);

        --algo-border: #456;

        --del-text: #f44;
        --del-bg: transparent;
        --ins-text: #4a4;
        --ins-bg: transparent;

        --a-normal-text: #6af;
        --a-normal-underline: #555;
        --a-visited-text: var(--a-normal-text);
        --a-visited-underline: var(--a-normal-underline);
        --a-hover-bg: rgba(25%, 25%, 25%, .2);
        --a-active-text: #f44;
        --a-active-underline: var(--a-active-text);

        --borderedblock-bg: rgba(255, 255, 255, .05);

        --blockquote-border: silver;
        --blockquote-bg: var(--borderedblock-bg);
        --blockquote-text: currentcolor;

        --issue-border: #e05252;
        --issue-bg: var(--borderedblock-bg);
        --issue-text: var(--text);
        --issueheading-text: hsl(0deg, 70%, 70%);

        --example-border: hsl(50deg, 90%, 60%);
        --example-bg: var(--borderedblock-bg);
        --example-text: var(--text);
        --exampleheading-text: hsl(50deg, 70%, 70%);

        --note-border: hsl(120deg, 100%, 35%);
        --note-bg: var(--borderedblock-bg);
        --note-text: var(--text);
        --noteheading-text: hsl(120, 70%, 70%);
        --notesummary-underline: silver;

        --assertion-border: #444;
        --assertion-bg: var(--borderedblock-bg);
        --assertion-text: var(--text);

        --advisement-border: orange;
        --advisement-bg: #222218;
        --advisement-text: var(--text);
        --advisementheading-text: #f84;

        --warning-border: red;
        --warning-bg: hsla(40,100%,20%,0.95);
        --warning-text: var(--text);

        --amendment-border: #330099;
        --amendment-bg: #080010;
        --amendment-text: var(--text);
        --amendmentheading-text: #cc00ff;

        --def-border: #8ccbf2;
        --def-bg: #080818;
        --def-text: var(--text);
        --defrow-border: #136;

        --datacell-border: silver;

        --indexinfo-text: #aaa;

        --indextable-hover-text: var(--text);
        --indextable-hover-bg: #181818;

        --outdatedspec-bg: rgba(255, 255, 255, .5);
        --outdatedspec-text: black;
        --outdated-bg: maroon;
        --outdated-text: white;
        --outdated-shadow: red;

        --editedrec-bg: darkorange;
    }
    /* In case a transparent-bg image doesn't expect to be on a dark bg,
       which is quite common in practice... */
    img { background: white; }
}
</style>
<style>/* Boilerplate: style-counters */
body {
    counter-reset: example figure issue;
}
.issue {
    counter-increment: issue;
}
.issue:not(.no-marker)::before {
    content: "Issue " counter(issue);
}

.example {
    counter-increment: example;
}
.example:not(.no-marker)::before {
    content: "Example " counter(example);
}
.invalid.example:not(.no-marker)::before,
.illegal.example:not(.no-marker)::before {
    content: "Invalid Example" counter(example);
}

figcaption {
    counter-increment: figure;
}
figcaption:not(.no-marker)::before {
    content: "Figure " counter(figure) " ";
}
</style>
<style>/* Boilerplate: style-dfn-panel */
:root {
    --dfnpanel-bg: #ddd;
    --dfnpanel-text: var(--text);
    --dfnpanel-target-bg: #ffc;
    --dfnpanel-target-outline: orange;
}
@media (prefers-color-scheme: dark) {
    :root {
        --dfnpanel-bg: #222;
        --dfnpanel-text: var(--text);
        --dfnpanel-target-bg: #333;
        --dfnpanel-target-outline: silver;
    }
}
.dfn-panel {
    position: absolute;
    z-index: 35;
    width: 20em;
    width: 300px;
    height: auto;
    max-height: 500px;
    overflow: auto;
    padding: 0.5em 0.75em;
    font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
    background: var(--dfnpanel-bg);
    color: var(--dfnpanel-text);
    border: outset 0.2em;
    white-space: normal; /* in case it's moved into a pre */
}
.dfn-panel:not(.on) { display: none; }
.dfn-panel * { margin: 0; padding: 0; text-indent: 0; }
.dfn-panel > b { display: block; }
.dfn-panel a { color: var(--dfnpanel-text); }
.dfn-panel a:not(:hover) { text-decoration: none !important; border-bottom: none !important; }
.dfn-panel a:focus {
    outline: 5px auto Highlight;
    outline: 5px auto -webkit-focus-ring-color;
}
.dfn-panel > b + b { margin-top: 0.25em; }
.dfn-panel ul { padding: 0 0 0 1em; list-style: none; }
.dfn-panel li a {
    max-width: calc(300px - 1.5em - 1em);
    overflow: hidden;
    text-overflow: ellipsis;
}

.dfn-panel.activated {
    display: inline-block;
    position: fixed;
    left: 8px;
    bottom: 2em;
    margin: 0 auto;
    max-width: calc(100vw - 1.5em - .4em - .5em);
    max-height: 30vh;
    transition: left 1s ease-out, bottom 1s ease-out;
}

.dfn-panel .link-item:hover {
    text-decoration: underline;
}
.dfn-panel .link-item .copy-icon {
    opacity: 0;
}
.dfn-panel .link-item:hover .copy-icon,
.dfn-panel .link-item .copy-icon:focus {
    opacity: 1;
}

.dfn-panel .copy-icon {
    display: inline-block;
    margin-right: 0.5em;
    width: 0.85em;
    height: 1em;
    border-radius: 3px;
    background-color: #ccc;
    cursor: pointer;
}

.dfn-panel .copy-icon .icon {
    width: 100%;
    height: 100%;
    background-color: #fff;
    display: flex;
    justify-content: center;
    align-items: center;
    position: relative;
}

.dfn-panel .copy-icon .icon::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    border: 1px solid black;
    background-color: #ccc;
    opacity: 0.25;
    transform: translate(3px, -3px);
}

.dfn-panel .copy-icon:active .icon::before {
    opacity: 1;
}

.dfn-paneled[role="button"] { cursor: help; }

.highlighted {
    animation: target-fade 3s;
}

@keyframes target-fade {
    from {
        background-color: var(--dfnpanel-target-bg);
        outline: 5px solid var(--dfnpanel-target-outline);
    }
    to {
        color: var(--a-normal-text);
        background-color: transparent;
        outline: transparent;
    }
}
</style>
<style>/* Boilerplate: style-idl-highlighting */
pre.idl.highlight {
    background: var(--borderedblock-bg, var(--def-bg));
}
</style>
<style>/* Boilerplate: style-issues */
a[href].issue-return {
    float: right;
    float: inline-end;
    color: var(--issueheading-text);
    font-weight: bold;
    text-decoration: none;
}
</style>
<style>/* Boilerplate: style-md-lists */
/* This is a weird hack for me not yet following the commonmark spec
   regarding paragraph and lists. */
[data-md] > :first-child {
    margin-top: 0;
}
[data-md] > :last-child {
    margin-bottom: 0;
}
</style>
<style>/* Boilerplate: style-mdn-anno */
:root {
	--mdn-bg: #EEE;
	--mdn-shadow: #999;
	--mdn-nosupport-text: #ccc;
	--mdn-pass: green;
	--mdn-fail: red;
}
@media (prefers-color-scheme: dark) {
	:root {
		--mdn-bg: #222;
		--mdn-shadow: #444;
		--mdn-nosupport-text: #666;
		--mdn-pass: #690;
		--mdn-fail: #d22;
	}
}
.mdn-anno {
	background: var(--mdn-bg, #EEE);
	border-radius: .25em;
	box-shadow: 0 0 3px var(--mdn-shadow, #999);
	color: var(--text, black);
	font: 1em sans-serif;
	hyphens: none;
	max-width: min-content;
	overflow: hidden;
	padding: 0.2em;
	position: absolute;
	right: 0.3em;
	top: auto;
	white-space: nowrap;
	word-wrap: normal;
	z-index: 8;
}
.mdn-anno.unpositioned {
	display: none;
}
.mdn-anno.overlapping-main {
	opacity: .2;
	transition: opacity .1s;
}
.mdn-anno[open] {
	opacity: 1;
	z-index: 9;
	min-width: 9em;
}
.mdn-anno:hover {
	opacity: 1;
	outline: var(--text, black) 1px solid;
}
.mdn-anno > summary {
	font-weight: normal;
	text-align: right;
	cursor: pointer;
	display: block;
}
.mdn-anno > summary > .less-than-two-engines-flag {
	color: var(--mdn-fail);
	padding-right: 2px;
}
.mdn-anno > summary > .all-engines-flag {
	color: var(--mdn-pass);
	padding-right: 2px;
}
.mdn-anno > summary > span {
	color: #fff;
	background-color: #000;
	font-weight: normal;
	font-family: zillaslab, Palatino, "Palatino Linotype", serif;
	padding: 2px 3px 0px 3px;
	line-height: 1.3em;
	vertical-align: top;
}
.mdn-anno > .feature {
	margin-top: 20px;
}
.mdn-anno > .feature:not(:first-of-type) {
	border-top: 1px solid #999;
	margin-top: 6px;
	padding-top: 2px;
}
.mdn-anno > .feature > .less-than-two-engines-text {
	color: var(--mdn-fail);
}
.mdn-anno > .feature > .all-engines-text {
	color: var(--mdn-pass);
}
.mdn-anno > .feature > p {
	font-size: .75em;
	margin-top: 6px;
	margin-bottom: 0;
}
.mdn-anno > .feature > p + p {
	margin-top: 3px;
}
.mdn-anno > .feature > .support {
	display: block;
	font-size: 0.6em;
	margin: 0;
	padding: 0;
	margin-top: 2px;
}
.mdn-anno > .feature > .support + div {
	padding-top: 0.5em;
}
.mdn-anno > .feature > .support > hr {
	display: block;
	border: none;
	border-top: 1px dotted #999;
	padding: 3px 0px 0px 0px;
	margin: 2px 3px 0px 3px;
}
.mdn-anno > .feature > .support > hr::before {
	content: "";
}
.mdn-anno > .feature > .support > span {
	padding: 0.2em 0;
	display: block;
	display: table;
}
.mdn-anno > .feature > .support > span.no {
	color: var(--mdn-nosupport-text);
	filter: grayscale(100%);
}
.mdn-anno > .feature > .support > span.no::before {
	opacity: 0.5;
}
.mdn-anno > .feature > .support > span:first-of-type {
	padding-top: 0.5em;
}
.mdn-anno > .feature > .support > span > span {
	padding: 0 0.5em;
	display: table-cell;
}
.mdn-anno > .feature > .support > span > span:first-child {
	width: 100%;
}
.mdn-anno > .feature > .support > span > span:last-child {
	width: 100%;
	white-space: pre;
	padding: 0;
}
.mdn-anno > .feature > .support > span::before {
	content: ' ';
	display: table-cell;
	min-width: 1.5em;
	height: 1.5em;
	background: no-repeat center center;
	background-size: contain;
	text-align: right;
	font-size: 0.75em;
	font-weight: bold;
}
.mdn-anno > .feature > .support > .chrome_android::before {
	background-image: url(https://resources.whatwg.org/browser-logos/chrome.svg);
}
.mdn-anno > .feature > .support > .firefox_android::before {
	background-image: url(https://resources.whatwg.org/browser-logos/firefox.png);
}
.mdn-anno > .feature > .support > .chrome::before {
	background-image: url(https://resources.whatwg.org/browser-logos/chrome.svg);
}
.mdn-anno > .feature > .support > .edge_blink::before {
	background-image: url(https://resources.whatwg.org/browser-logos/edge.svg);
}
.mdn-anno > .feature > .support > .edge::before {
	background-image: url(https://resources.whatwg.org/browser-logos/edge_legacy.svg);
}
.mdn-anno > .feature > .support > .firefox::before {
	background-image: url(https://resources.whatwg.org/browser-logos/firefox.png);
}
.mdn-anno > .feature > .support > .ie::before {
	background-image: url(https://resources.whatwg.org/browser-logos/ie.png);
}
.mdn-anno > .feature > .support > .safari_ios::before {
	background-image: url(https://resources.whatwg.org/browser-logos/safari-ios.svg);
}
.mdn-anno > .feature > .support > .nodejs::before {
	background-image: url(https://nodejs.org/static/images/favicons/favicon.ico);
}
.mdn-anno > .feature > .support > .opera_android::before {
	background-image: url(https://resources.whatwg.org/browser-logos/opera.svg);
}
.mdn-anno > .feature > .support > .opera::before {
	background-image: url(https://resources.whatwg.org/browser-logos/opera.svg);
}
.mdn-anno > .feature > .support > .safari::before {
	background-image: url(https://resources.whatwg.org/browser-logos/safari.png);
}
.mdn-anno > .feature > .support > .samsunginternet_android::before {
	background-image: url(https://resources.whatwg.org/browser-logos/samsung.svg);
}
.mdn-anno > .feature > .support > .webview_android::before {
	background-image: url(https://resources.whatwg.org/browser-logos/android-webview.png);
}
.name-slug-mismatch {
	color: red;
}
.caniuse-status:hover {
	z-index: 9;
}
/* dt, li, .issue, .note, and .example are "position: relative", so to put annotation at right margin, must move to right of containing block */;
.h-entry:not(.status-LS) dt > .mdn-anno, .h-entry:not(.status-LS) li > .mdn-anno, .h-entry:not(.status-LS) .issue > .mdn-anno, .h-entry:not(.status-LS) .note > .mdn-anno, .h-entry:not(.status-LS) .example > .mdn-anno {
	right: -6.7em;
}
.h-entry p + .mdn-anno {
	margin-top: 0;
}
 h2 + .mdn-anno.after {
	margin: -48px 0 0 0;
}
 h3 + .mdn-anno.after {
	margin: -46px 0 0 0;
}
 h4 + .mdn-anno.after {
	margin: -42px 0 0 0;
}
 h5 + .mdn-anno.after {
	margin: -40px 0 0 0;
}
 h6 + .mdn-anno.after {
	margin: -40px 0 0 0;
}
</style>
<style>/* Boilerplate: style-ref-hints */
:root {
    --ref-hint-bg: #ddd;
    --ref-hint-text: var(--text);
}
@media (prefers-color-scheme: dark) {
    :root {
        --ref-hint-bg: #222;
        --ref-hint-text: var(--text);
    }
}

.ref-hint {
    display: inline-block;
    position: absolute;
    z-index: 35;
    width: 20em;
    width: 300px;
    height: auto;
    max-height: 500px;
    overflow: auto;
    padding: 0.5em 0.5em;
    font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
    background: var(--ref-hint-bg);
    color: var(--ref-hint-text);
    border: outset 0.2em;
    white-space: normal; /* in case it's moved into a pre */
}

.ref-hint * { margin: 0; padding: 0; text-indent: 0; }

.ref-hint ul { padding: 0 0 0 1em; list-style: none; }
</style>
<style>/* Boilerplate: style-selflinks */
:root {
    --selflink-text: white;
    --selflink-bg: gray;
    --selflink-hover-text: black;
}
.heading, .issue, .note, .example, li, dt {
    position: relative;
}
a.self-link {
    position: absolute;
    top: 0;
    left: calc(-1 * (3.5rem - 26px));
    width: calc(3.5rem - 26px);
    height: 2em;
    text-align: center;
    border: none;
    transition: opacity .2s;
    opacity: .5;
}
a.self-link:hover {
    opacity: 1;
}
.heading > a.self-link {
    font-size: 83%;
}
.example > a.self-link,
.note > a.self-link,
.issue > a.self-link {
    /* These blocks are overflow:auto, so positioning outside
       doesn't work. */
    left: auto;
    right: 0;
}
li > a.self-link {
    left: calc(-1 * (3.5rem - 26px) - 2em);
}
dfn > a.self-link {
    top: auto;
    left: auto;
    opacity: 0;
    width: 1.5em;
    height: 1.5em;
    background: var(--selflink-bg);
    color: var(--selflink-text);
    font-style: normal;
    transition: opacity .2s, background-color .2s, color .2s;
}
dfn:hover > a.self-link {
    opacity: 1;
}
dfn > a.self-link:hover {
    color: var(--selflink-hover-text);
}

a.self-link::before            { content: "¶"; }
.heading > a.self-link::before { content: "§"; }
dfn > a.self-link::before      { content: "#"; }
</style>
<style>/* Boilerplate: style-syntax-highlighting */
code.highlight { padding: .1em; border-radius: .3em; }
pre.highlight, pre > code.highlight { display: block; padding: 1em; margin: .5em 0; overflow: auto; border-radius: 0; }

.highlight:not(.idl) { background: rgba(0, 0, 0, .03); }
c-[a] { color: #990055 } /* Keyword.Declaration */
c-[b] { color: #990055 } /* Keyword.Type */
c-[c] { color: #708090 } /* Comment */
c-[d] { color: #708090 } /* Comment.Multiline */
c-[e] { color: #0077aa } /* Name.Attribute */
c-[f] { color: #669900 } /* Name.Tag */
c-[g] { color: #222222 } /* Name.Variable */
c-[k] { color: #990055 } /* Keyword */
c-[l] { color: #000000 } /* Literal */
c-[m] { color: #000000 } /* Literal.Number */
c-[n] { color: #0077aa } /* Name */
c-[o] { color: #999999 } /* Operator */
c-[p] { color: #999999 } /* Punctuation */
c-[s] { color: #a67f59 } /* Literal.String */
c-[t] { color: #a67f59 } /* Literal.String.Single */
c-[u] { color: #a67f59 } /* Literal.String.Double */
c-[cp] { color: #708090 } /* Comment.Preproc */
c-[c1] { color: #708090 } /* Comment.Single */
c-[cs] { color: #708090 } /* Comment.Special */
c-[kc] { color: #990055 } /* Keyword.Constant */
c-[kn] { color: #990055 } /* Keyword.Namespace */
c-[kp] { color: #990055 } /* Keyword.Pseudo */
c-[kr] { color: #990055 } /* Keyword.Reserved */
c-[ld] { color: #000000 } /* Literal.Date */
c-[nc] { color: #0077aa } /* Name.Class */
c-[no] { color: #0077aa } /* Name.Constant */
c-[nd] { color: #0077aa } /* Name.Decorator */
c-[ni] { color: #0077aa } /* Name.Entity */
c-[ne] { color: #0077aa } /* Name.Exception */
c-[nf] { color: #0077aa } /* Name.Function */
c-[nl] { color: #0077aa } /* Name.Label */
c-[nn] { color: #0077aa } /* Name.Namespace */
c-[py] { color: #0077aa } /* Name.Property */
c-[ow] { color: #999999 } /* Operator.Word */
c-[mb] { color: #000000 } /* Literal.Number.Bin */
c-[mf] { color: #000000 } /* Literal.Number.Float */
c-[mh] { color: #000000 } /* Literal.Number.Hex */
c-[mi] { color: #000000 } /* Literal.Number.Integer */
c-[mo] { color: #000000 } /* Literal.Number.Oct */
c-[sb] { color: #a67f59 } /* Literal.String.Backtick */
c-[sc] { color: #a67f59 } /* Literal.String.Char */
c-[sd] { color: #a67f59 } /* Literal.String.Doc */
c-[se] { color: #a67f59 } /* Literal.String.Escape */
c-[sh] { color: #a67f59 } /* Literal.String.Heredoc */
c-[si] { color: #a67f59 } /* Literal.String.Interpol */
c-[sx] { color: #a67f59 } /* Literal.String.Other */
c-[sr] { color: #a67f59 } /* Literal.String.Regex */
c-[ss] { color: #a67f59 } /* Literal.String.Symbol */
c-[vc] { color: #0077aa } /* Name.Variable.Class */
c-[vg] { color: #0077aa } /* Name.Variable.Global */
c-[vi] { color: #0077aa } /* Name.Variable.Instance */
c-[il] { color: #000000 } /* Literal.Number.Integer.Long */

@media (prefers-color-scheme: dark) {
    .highlight:not(.idl) { background: rgba(255, 255, 255, .05); }

    c-[a] { color: #d33682 } /* Keyword.Declaration */
    c-[b] { color: #d33682 } /* Keyword.Type */
    c-[c] { color: #2aa198 } /* Comment */
    c-[d] { color: #2aa198 } /* Comment.Multiline */
    c-[e] { color: #268bd2 } /* Name.Attribute */
    c-[f] { color: #b58900 } /* Name.Tag */
    c-[g] { color: #cb4b16 } /* Name.Variable */
    c-[k] { color: #d33682 } /* Keyword */
    c-[l] { color: #657b83 } /* Literal */
    c-[m] { color: #657b83 } /* Literal.Number */
    c-[n] { color: #268bd2 } /* Name */
    c-[o] { color: #657b83 } /* Operator */
    c-[p] { color: #657b83 } /* Punctuation */
    c-[s] { color: #6c71c4 } /* Literal.String */
    c-[t] { color: #6c71c4 } /* Literal.String.Single */
    c-[u] { color: #6c71c4 } /* Literal.String.Double */
    c-[ch] { color: #2aa198 } /* Comment.Hashbang */
    c-[cp] { color: #2aa198 } /* Comment.Preproc */
    c-[cpf] { color: #2aa198 } /* Comment.PreprocFile */
    c-[c1] { color: #2aa198 } /* Comment.Single */
    c-[cs] { color: #2aa198 } /* Comment.Special */
    c-[kc] { color: #d33682 } /* Keyword.Constant */
    c-[kn] { color: #d33682 } /* Keyword.Namespace */
    c-[kp] { color: #d33682 } /* Keyword.Pseudo */
    c-[kr] { color: #d33682 } /* Keyword.Reserved */
    c-[ld] { color: #657b83 } /* Literal.Date */
    c-[nc] { color: #268bd2 } /* Name.Class */
    c-[no] { color: #268bd2 } /* Name.Constant */
    c-[nd] { color: #268bd2 } /* Name.Decorator */
    c-[ni] { color: #268bd2 } /* Name.Entity */
    c-[ne] { color: #268bd2 } /* Name.Exception */
    c-[nf] { color: #268bd2 } /* Name.Function */
    c-[nl] { color: #268bd2 } /* Name.Label */
    c-[nn] { color: #268bd2 } /* Name.Namespace */
    c-[py] { color: #268bd2 } /* Name.Property */
    c-[ow] { color: #657b83 } /* Operator.Word */
    c-[mb] { color: #657b83 } /* Literal.Number.Bin */
    c-[mf] { color: #657b83 } /* Literal.Number.Float */
    c-[mh] { color: #657b83 } /* Literal.Number.Hex */
    c-[mi] { color: #657b83 } /* Literal.Number.Integer */
    c-[mo] { color: #657b83 } /* Literal.Number.Oct */
    c-[sa] { color: #6c71c4 } /* Literal.String.Affix */
    c-[sb] { color: #6c71c4 } /* Literal.String.Backtick */
    c-[sc] { color: #6c71c4 } /* Literal.String.Char */
    c-[dl] { color: #6c71c4 } /* Literal.String.Delimiter */
    c-[sd] { color: #6c71c4 } /* Literal.String.Doc */
    c-[se] { color: #6c71c4 } /* Literal.String.Escape */
    c-[sh] { color: #6c71c4 } /* Literal.String.Heredoc */
    c-[si] { color: #6c71c4 } /* Literal.String.Interpol */
    c-[sx] { color: #6c71c4 } /* Literal.String.Other */
    c-[sr] { color: #6c71c4 } /* Literal.String.Regex */
    c-[ss] { color: #6c71c4 } /* Literal.String.Symbol */
    c-[fm] { color: #268bd2 } /* Name.Function.Magic */
    c-[vc] { color: #cb4b16 } /* Name.Variable.Class */
    c-[vg] { color: #cb4b16 } /* Name.Variable.Global */
    c-[vi] { color: #cb4b16 } /* Name.Variable.Instance */
    c-[vm] { color: #cb4b16 } /* Name.Variable.Magic */
    c-[il] { color: #657b83 } /* Literal.Number.Integer.Long */
}
</style>
<style>/* Boilerplate: style-var-click-highlighting */
/*
Colors were chosen in Lab using https://nixsensor.com/free-color-converter/
D50 2deg illuminant, L in [0,100], a and b in [-128, 128]
0 = lab(85,0,85)
1 = lab(85,80,30)
2 = lab(85,-40,40)
3 = lab(85,-50,0)
4 = lab(85,5,15)
5 = lab(85,-10,-50)
6 = lab(85,35,-15)

For darkmode:
0 = oklab(50%   0%  108%)
1 = oklab(50% -51%   51%)
2 = oklab(50% -64%  -20%)
3 = oklab(50%   6%   19%)
4 = oklab(50% -12%  -64%)
5 = oklab(50%  44%  -19%)  
6 = oklab(50% 102%   38%)
*/

[data-algorithm] var { cursor: pointer; }
var[data-var-color] { background-color: var(--var-bg); box-shadow: 0 0 0 2px var(--var-bg); }

var[data-var-color] { --var-bg: #F4D200; }
var[data-var-color="1"] { --var-bg: #FF87A2; }
var[data-var-color="2"] { --var-bg: #96E885; }
var[data-var-color="3"] { --var-bg: #3EEED2; }
var[data-var-color="4"] { --var-bg: #EACFB6; }
var[data-var-color="5"] { --var-bg: #82DDFF; }
var[data-var-color="6"] { --var-vg: #FFBCF2; }

@media (prefers-color-scheme: dark) {
	var[data-var-color] { --var-bg: #bc1a00; }
	var[data-var-color="1"] { --var-bg: #007f00; }
	var[data-var-color="2"] { --var-bg: #008698; }
	var[data-var-color="3"] { --var-bg: #7f5b2b; }
	var[data-var-color="4"] { --var-bg: #004df3; }
	var[data-var-color="5"] { --var-bg: #a1248a; }
	var[data-var-color="6"] { --var-vg: #ff0000; }
}
</style>
 <body class="h-entry">
  <div class="head">
   <p data-fill-with="logo"><a class="logo" href="https://www.w3.org/"> <img alt="W3C" height="48" src="https://www.w3.org/StyleSheets/TR/2021/logos/W3C" width="72"> </a> </p>
   <h1 class="p-name no-ref" id="title">CSS Painting API Level 1</h1>
   <p id="w3c-state"><a href="https://www.w3.org/standards/types/#ED">Editor’s Draft</a>, <time class="dt-updated" datetime="1970-01-01">1 January 1970</time></p>
   <details open>
    <summary>More details about this document</summary>
    <div data-fill-with="spec-metadata">
     <dl>
      <dt>This version:
      <dd><a class="u-url" href="https://drafts.css-houdini.org/css-paint-api-1/">https://drafts.css-houdini.org/css-paint-api-1/</a>
      <dt>Latest published version:
      <dd><a href="http://www.w3.org/TR/css-paint-api-1/">http://www.w3.org/TR/css-paint-api-1/</a>
      <dt>Previous Versions:
      <dd><a href="https://www.w3.org/TR/2018/WD-css-paint-api-1-20180410/" rel="prev">https://www.w3.org/TR/2018/WD-css-paint-api-1-20180410/</a>
      <dd><a href="https://www.w3.org/TR/2016/WD-css-paint-api-1-20160607/" rel="prev">https://www.w3.org/TR/2016/WD-css-paint-api-1-20160607/</a>
      <dt>Feedback:
      <dd><span><a href="mailto:public-houdini@w3.org?subject=%5Bcss-paint-api%5D%20YOUR%20TOPIC%20HERE">public-houdini@w3.org</a> with subject line “<kbd>[css-paint-api] <i data-lt>… message topic …</i></kbd>” (<a href="http://lists.w3.org/Archives/Public/public-houdini/" rel="discussion">archives</a>)</span>
      <dt class="editor">Editors:
      <dd class="editor p-author h-card vcard" data-editor-id="73001"><a class="p-name fn u-email email" href="mailto:ikilpatrick@chromium.org">Ian Kilpatrick</a>
      <dd class="editor p-author h-card vcard" data-editor-id="42080"><a class="p-name fn u-email email" href="mailto:dino@apple.com">Dean Jackson</a>
      <dt class="editor">Former Editor:
      <dd class="editor p-author h-card vcard" data-editor-id="47691"><a class="p-name fn u-email email" href="mailto:shanestephens@google.com">Shane Stephens</a>
     </dl>
    </div>
   </details>
   <div data-fill-with="warning"></div>
   <p class="copyright" data-fill-with="copyright"><a href="https://www.w3.org/policies/#copyright">Copyright</a> © 1970 <a href="https://www.w3.org/">World Wide Web Consortium</a>. <abbr title="World Wide Web Consortium">W3C</abbr><sup>®</sup> <a href="https://www.w3.org/policies/#Legal_Disclaimer">liability</a>, <a href="https://www.w3.org/policies/#W3C_Trademarks">trademark</a> and <a href="https://www.w3.org/copyright/software-license/" rel="license" title="W3C Software and Document License">permissive document license</a> rules apply. </p>
   <hr title="Separator for header">
  </div>
  <div class="p-summary" data-fill-with="abstract">
   <h2 class="no-num no-toc no-ref heading settled" id="abstract"><span class="content">Abstract</span></h2>
   <p>An API for allowing web developers to define a custom CSS <a class="production css" data-link-type="type" href="https://drafts.csswg.org/css-images-3/#typedef-image" id="ref-for-typedef-image">&lt;image></a> with javascript, which will
respond to style and size changes.
See <a href="https://github.com/w3c/css-houdini-drafts/blob/master/css-paint-api/EXPLAINER.md">EXPLAINER</a>.</p>
  </div>
  <h2 class="no-num no-toc no-ref heading settled" id="sotd"><span class="content">Status of this document</span></h2>
  <div data-fill-with="status">
   <p> This is a public copy of the editors’ draft.
	It is provided for discussion only and may change at any moment.
	Its publication here does not imply endorsement of its contents by W3C.
	Don’t cite this document other than as work in progress. </p>
   <p>Please send feedback
	by <a href="https://github.com/w3c/css-houdini-drafts/issues">filing issues in GitHub</a> (preferred),
	including the spec code “css-paint-api” in the title, like this:
	“[css-paint-api] <i>…summary of comment…</i>”.
	All issues and comments are <a href="https://lists.w3.org/Archives/Public/public-houdini-archive/">archived</a>.
	Alternately, feedback can be sent to the (<a href="https://lists.w3.org/Archives/Public/www-style/">archived</a>) public mailing list <a href="mailto:www-style@w3.org?Subject=%5Bcss-paint-api%5D%20PUT%20SUBJECT%20HERE">www-style@w3.org</a>. </p>
   <p>This document is governed by the <a href="https://www.w3.org/policies/process/20231103/" id="w3c_process_revision">03 November 2023 W3C Process Document</a>. </p>
   <p></p>
  </div>
  <div data-fill-with="at-risk"></div>
  <nav data-fill-with="table-of-contents" id="toc">
   <h2 class="no-num no-toc no-ref" id="contents">Table of Contents</h2>
   <ol class="toc" role="directory">
    <li><a href="#intro"><span class="secno">1</span> <span class="content">Introduction</span></a>
    <li><a href="#paint-worklet"><span class="secno">2</span> <span class="content">Paint Worklet</span></a>
    <li><a href="#concepts"><span class="secno">3</span> <span class="content">Concepts</span></a>
    <li><a href="#registering-custom-paint"><span class="secno">4</span> <span class="content">Registering Custom Paint</span></a>
    <li><a href="#paint-notation"><span class="secno">5</span> <span class="content">Paint Notation</span></a>
    <li>
     <a href="#2d-rendering-context"><span class="secno">6</span> <span class="content">The 2D rendering context</span></a>
     <ol class="toc">
      <li><a href="#drawing-a-cssimagevalue"><span class="secno">6.1</span> <span class="content">Drawing a CSSImageValue</span></a>
     </ol>
    <li>
     <a href="#drawing-an-image"><span class="secno">7</span> <span class="content">Drawing an image</span></a>
     <ol class="toc">
      <li><a href="#global-scope-selection"><span class="secno">7.1</span> <span class="content">Global Scope Selection</span></a>
     </ol>
    <li>
     <a href="#examples"><span class="secno">8</span> <span class="content">Examples</span></a>
     <ol class="toc">
      <li><a href="#example-1"><span class="secno">8.1</span> <span class="content">Example 1: Colored Circle</span></a>
      <li><a href="#example-2"><span class="secno">8.2</span> <span class="content">Example 2: Image Placeholder</span></a>
      <li><a href="#example-3"><span class="secno">8.3</span> <span class="content">Example 3: Arcs</span></a>
      <li><a href="#example-4"><span class="secno">8.4</span> <span class="content">Example 4: Different Colors (based on size)</span></a>
      <li><a href="#example-5"><span class="secno">8.5</span> <span class="content">Example 5: Drawing outside an element’s area</span></a>
     </ol>
    <li><a href="#security-considerations"><span class="secno">9</span> <span class="content">Security Considerations</span></a>
    <li><a href="#privacy-considerations"><span class="secno">10</span> <span class="content">Privacy Considerations</span></a>
    <li><a href="#changes"><span class="secno">11</span> <span class="content">Changes</span></a>
    <li>
     <a href="#w3c-conformance"><span class="secno"></span> <span class="content"> Conformance</span></a>
     <ol class="toc">
      <li><a href="#w3c-conventions"><span class="secno"></span> <span class="content"> Document conventions</span></a>
      <li><a href="#w3c-conformance-classes"><span class="secno"></span> <span class="content"> Conformance classes</span></a>
      <li>
       <a href="#w3c-partial"><span class="secno"></span> <span class="content"> Partial implementations</span></a>
       <ol class="toc">
        <li><a href="#w3c-conform-future-proofing"><span class="secno"></span> <span class="content"> Implementations of Unstable and Proprietary Features</span></a>
       </ol>
      <li><a href="#w3c-testing"><span class="secno"></span> <span class="content"> Non-experimental implementations</span></a>
     </ol>
    <li>
     <a href="#index"><span class="secno"></span> <span class="content">Index</span></a>
     <ol class="toc">
      <li><a href="#index-defined-here"><span class="secno"></span> <span class="content">Terms defined by this specification</span></a>
      <li><a href="#index-defined-elsewhere"><span class="secno"></span> <span class="content">Terms defined by reference</span></a>
     </ol>
    <li>
     <a href="#references"><span class="secno"></span> <span class="content">References</span></a>
     <ol class="toc">
      <li><a href="#normative"><span class="secno"></span> <span class="content">Normative References</span></a>
     </ol>
    <li><a href="#idl-index"><span class="secno"></span> <span class="content">IDL Index</span></a>
   </ol>
  </nav>
  <main>
   <h2 class="heading settled" data-level="1" id="intro"><span class="secno">1. </span><span class="content">Introduction</span><a class="self-link" href="#intro"></a></h2>
   <p>The paint stage of CSS is responsible for painting the background, content and highlight of a
box based on that box’s size (as generated by the layout stage) and computed style.</p>
   <p>This specification describes an API which allows developers to paint a part of a box in
response to size / computed style changes with an additional <a class="production css" data-link-type="type" href="https://drafts.csswg.org/css-images-3/#typedef-image" id="ref-for-typedef-image①">&lt;image></a> function.</p>
   <p class="note" role="note"><span class="marker">Note:</span> In a future version of the spec, support could be added for defining the clip, global alpha,
    filter on a portion of a box (for example on the background layers).</p>
   <h2 class="heading settled" data-level="2" id="paint-worklet"><span class="secno">2. </span><span class="content">Paint Worklet</span><a class="self-link" href="#paint-worklet"></a></h2>
   <p>The <code class="idl"><a data-link-type="idl" href="#dom-css-paintworklet" id="ref-for-dom-css-paintworklet">paintWorklet</a></code> attribute allows access to the <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/worklets.html#worklet" id="ref-for-worklet">Worklet</a></code> responsible for all the classes
which are related to painting.</p>
   <p>The <code class="idl"><a data-link-type="idl" href="#dom-css-paintworklet" id="ref-for-dom-css-paintworklet①">paintWorklet</a></code>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/worklets.html#worklet-global-scope-type" id="ref-for-worklet-global-scope-type">worklet global scope type</a> is <code class="idl"><a data-link-type="idl" href="#paintworkletglobalscope" id="ref-for-paintworkletglobalscope">PaintWorkletGlobalScope</a></code>.</p>
   <p>The <code class="idl"><a data-link-type="idl" href="#dom-css-paintworklet" id="ref-for-dom-css-paintworklet②">paintWorklet</a></code>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/worklets.html#worklet-destination-type" id="ref-for-worklet-destination-type">worklet destination type</a> is <code>"paintworklet"</code>.</p>
<pre class="idl highlight def"><c- b>partial</c-> <c- b>namespace</c-> <a class="idl-code" data-link-type="namespace" href="https://drafts.csswg.org/cssom-1/#namespacedef-css" id="ref-for-namespacedef-css"><c- g>CSS</c-></a> {
    [<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#SameObject" id="ref-for-SameObject"><c- g>SameObject</c-></a>] <c- b>readonly</c-> <c- b>attribute</c-> <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/worklets.html#worklet" id="ref-for-worklet①"><c- n>Worklet</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="CSS" data-dfn-type="attribute" data-export data-readonly data-type="Worklet" id="dom-css-paintworklet"><code><c- g>paintWorklet</c-></code></dfn>;
};
</pre>
   <p>A <code class="idl"><a data-link-type="idl" href="#paintworkletglobalscope" id="ref-for-paintworkletglobalscope①">PaintWorkletGlobalScope</a></code> is a global execution context of the <code class="idl"><a data-link-type="idl" href="#dom-css-paintworklet" id="ref-for-dom-css-paintworklet③">paintWorklet</a></code>.</p>
   <p>A <code class="idl"><a data-link-type="idl" href="#paintworkletglobalscope" id="ref-for-paintworkletglobalscope②">PaintWorkletGlobalScope</a></code> has a <code class="idl"><a data-link-type="idl" href="#dom-paintworkletglobalscope-devicepixelratio" id="ref-for-dom-paintworkletglobalscope-devicepixelratio">devicePixelRatio</a></code> property which is
identical to the Window.<code class="idl"><a data-link-type="idl" href="https://drafts.csswg.org/cssom-view-1/#dom-window-devicepixelratio" id="ref-for-dom-window-devicepixelratio">devicePixelRatio</a></code> property.</p>
<pre class="idl highlight def">[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Global" id="ref-for-Global"><c- g>Global</c-></a>=(<a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/worklets.html#worklet" id="ref-for-worklet②"><c- n>Worklet</c-></a>,<a data-link-type="idl-name"><c- n>PaintWorklet</c-></a>),<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed" id="ref-for-Exposed"><c- g>Exposed</c-></a>=<c- n>PaintWorklet</c->]
<c- b>interface</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="interface" data-export id="paintworkletglobalscope"><code><c- g>PaintWorkletGlobalScope</c-></code></dfn> : <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/worklets.html#workletglobalscope" id="ref-for-workletglobalscope"><c- n>WorkletGlobalScope</c-></a> {
    <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-undefined" id="ref-for-idl-undefined"><c- b>undefined</c-></a> <a class="idl-code" data-link-type="method" href="#dom-paintworkletglobalscope-registerpaint" id="ref-for-dom-paintworkletglobalscope-registerpaint"><c- g>registerPaint</c-></a>(<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString" id="ref-for-idl-DOMString"><c- b>DOMString</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="PaintWorkletGlobalScope/registerPaint(name, paintCtor)" data-dfn-type="argument" data-export id="dom-paintworkletglobalscope-registerpaint-name-paintctor-name"><code><c- g>name</c-></code></dfn>, <a data-link-type="idl-name" href="https://webidl.spec.whatwg.org/#VoidFunction" id="ref-for-VoidFunction"><c- n>VoidFunction</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="PaintWorkletGlobalScope/registerPaint(name, paintCtor)" data-dfn-type="argument" data-export id="dom-paintworkletglobalscope-registerpaint-name-paintctor-paintctor"><code><c- g>paintCtor</c-></code></dfn>);
    <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-unrestricted-double" id="ref-for-idl-unrestricted-double"><c- b>unrestricted</c-> <c- b>double</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="PaintWorkletGlobalScope" data-dfn-type="attribute" data-export data-readonly data-type="unrestricted double" id="dom-paintworkletglobalscope-devicepixelratio"><code><c- g>devicePixelRatio</c-></code></dfn>;
};
</pre>
   <p>The <code class="idl"><a data-link-type="idl" href="#dictdef-paintrenderingcontext2dsettings" id="ref-for-dictdef-paintrenderingcontext2dsettings">PaintRenderingContext2DSettings</a></code> contains the settings for the rendering context associated
with the paint canvas. The <code class="idl"><a data-link-type="idl" href="#dictdef-paintrenderingcontext2dsettings" id="ref-for-dictdef-paintrenderingcontext2dsettings①">PaintRenderingContext2DSettings</a></code> provides a supported subset of canvas
rendering context 2D settings. In the future, it may be extended to support color management in
paint canvas.</p>
<pre class="idl highlight def"><c- b>dictionary</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="dictionary" data-export id="dictdef-paintrenderingcontext2dsettings"><code><c- g>PaintRenderingContext2DSettings</c-></code></dfn> {
    <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-boolean" id="ref-for-idl-boolean"><c- b>boolean</c-></a> <dfn class="dfn-paneled idl-code" data-default="true" data-dfn-for="PaintRenderingContext2DSettings" data-dfn-type="dict-member" data-export data-type="boolean" id="dom-paintrenderingcontext2dsettings-alpha"><code><c- g>alpha</c-></code></dfn> = <c- b>true</c->;
};
</pre>
   <div class="note" role="note">
     Note: The shape of the class should be: 
<pre class="lang-javascript highlight"><c- a>class</c-> MyPaint <c- p>{</c->
    <c- k>static</c-> get inputProperties<c- p>()</c-> <c- p>{</c-> <c- k>return</c-> <c- p>[</c-><c- t>'--foo'</c-><c- p>];</c-> <c- p>}</c->
    <c- k>static</c-> get inputArguments<c- p>()</c-> <c- p>{</c-> <c- k>return</c-> <c- p>[</c-><c- t>'&lt;color>'</c-><c- p>];</c-> <c- p>}</c->
    <c- k>static</c-> get contextOptions<c- p>()</c-> <c- p>{</c-> <c- k>return</c-> <c- p>{</c->alpha<c- o>:</c-> <c- kc>true</c-><c- p>};</c-> <c- p>}</c->

    paint<c- p>(</c->ctx<c- p>,</c-> size<c- p>,</c-> styleMap<c- p>)</c-> <c- p>{</c->
        <c- c1>// Paint code goes here.</c->
    <c- p>}</c->
<c- p>}</c->
</pre>
   </div>
   <h2 class="heading settled" data-level="3" id="concepts"><span class="secno">3. </span><span class="content">Concepts</span><a class="self-link" href="#concepts"></a></h2>
   <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="paint-definition">paint definition</dfn> is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#struct" id="ref-for-struct">struct</a> which describes the information needed by the <code class="idl"><a data-link-type="idl" href="#paintworkletglobalscope" id="ref-for-paintworkletglobalscope③">PaintWorkletGlobalScope</a></code> about the author defined <a class="production css" data-link-type="type" href="https://drafts.csswg.org/css-images-3/#typedef-image" id="ref-for-typedef-image②">&lt;image></a> (which can be referenced by the <a class="production css" data-link-type="function" href="#funcdef-paint" id="ref-for-funcdef-paint">&lt;paint()></a> function). It consists of:</p>
   <ul>
    <li data-md>
     <p><dfn class="dfn-paneled" data-dfn-for="paint definition" data-dfn-type="dfn" data-noexport id="paint-definition-class-constructor">class constructor</dfn> which is the class <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#sec-constructor" id="ref-for-sec-constructor">constructor</a>.</p>
    <li data-md>
     <p><dfn class="dfn-paneled" data-dfn-for="paint definition" data-dfn-type="dfn" data-noexport id="paint-definition-paint-function">paint function</dfn> which is the paint <a data-link-type="dfn" href="https://drafts.csswg.org/css-syntax-3/#function" id="ref-for-function">Function</a> <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#dfn-callback-function" id="ref-for-dfn-callback-function">callback function</a> type.</p>
    <li data-md>
     <p><dfn class="dfn-paneled" data-dfn-for="paint definition" data-dfn-type="dfn" data-noexport id="paint-definition-constructor-valid-flag">constructor valid flag</dfn>.</p>
    <li data-md>
     <p><dfn class="dfn-paneled" data-dfn-for="paint definition" data-dfn-type="dfn" data-noexport id="paint-definition-input-properties">input properties</dfn> which is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list">list</a> of <code>DOMStrings</code>.</p>
    <li data-md>
     <p>A <dfn class="dfn-paneled" data-dfn-for="paint definition" data-dfn-type="dfn" data-noexport id="paint-definition-paintrenderingcontext2dsettings-object">PaintRenderingContext2DSettings object</dfn>.</p>
   </ul>
   <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="document-paint-definition">document paint definition</dfn> is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#struct" id="ref-for-struct①">struct</a> which describes the information
needed by the <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-document" id="ref-for-concept-document">document</a> about the author defined <a class="production css" data-link-type="type" href="https://drafts.csswg.org/css-images-3/#typedef-image" id="ref-for-typedef-image③">&lt;image></a> function (which can be referenced
by the paint function). It consists of:</p>
   <ul>
    <li data-md>
     <p>A <dfn class="dfn-paneled" data-dfn-for="document paint definition" data-dfn-type="dfn" data-noexport id="document-paint-definition-input-properties">input properties</dfn> which is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list①">list</a> of <code>DOMStrings</code>.</p>
    <li data-md>
     <p>A <dfn class="dfn-paneled" data-dfn-for="document paint definition" data-dfn-type="dfn" data-noexport id="document-paint-definition-input-argument-syntaxes">input argument syntaxes</dfn> which is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list②">list</a> of <a data-link-type="dfn" href="https://drafts.css-houdini.org/css-properties-values-api-1/#syntax-definition" id="ref-for-syntax-definition">syntax definitions</a>.</p>
    <li data-md>
     <p>A <dfn class="dfn-paneled" data-dfn-for="document paint definition" data-dfn-type="dfn" data-noexport id="document-paint-definition-paintrenderingcontext2dsettings-object">PaintRenderingContext2DSettings object</dfn>.</p>
   </ul>
   <h2 class="heading settled" data-level="4" id="registering-custom-paint"><span class="secno">4. </span><span class="content">Registering Custom Paint</span><a class="self-link" href="#registering-custom-paint"></a></h2>
   <p>The <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-document" id="ref-for-concept-document①">document</a> has a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map" id="ref-for-ordered-map">map</a> of <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="document-paint-definitions">document paint definitions</dfn>. Initially
this map is empty; it is populated when <code class="idl"><a data-link-type="idl" href="#dom-paintworkletglobalscope-registerpaint" id="ref-for-dom-paintworkletglobalscope-registerpaint①">registerPaint(name, paintCtor)</a></code> is called.</p>
   <p>A <code class="idl"><a data-link-type="idl" href="#paintworkletglobalscope" id="ref-for-paintworkletglobalscope④">PaintWorkletGlobalScope</a></code> has a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map" id="ref-for-ordered-map①">map</a> of <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="paint-definitions">paint definitions</dfn>. Initially this map
is empty; it is populated when <code class="idl"><a data-link-type="idl" href="#dom-paintworkletglobalscope-registerpaint" id="ref-for-dom-paintworkletglobalscope-registerpaint②">registerPaint(name, paintCtor)</a></code> is called.</p>
   <p>A <code class="idl"><a data-link-type="idl" href="#paintworkletglobalscope" id="ref-for-paintworkletglobalscope⑤">PaintWorkletGlobalScope</a></code> has a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map" id="ref-for-ordered-map②">map</a> of <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="paint-class-instances">paint class instances</dfn>. Initially this
map is empty; it is populated when <a data-link-type="dfn" href="#draw-a-paint-image" id="ref-for-draw-a-paint-image">draw a paint image</a> is invoked by the user agent.</p>
   <p>Instances of paint classes in the <a data-link-type="dfn" href="#paint-class-instances" id="ref-for-paint-class-instances">paint class instances</a> map may be disposed and removed from
the map by the user agent at any time. This may be done when a <a class="production css" data-link-type="function" href="#funcdef-paint" id="ref-for-funcdef-paint①">&lt;paint()></a> function no longer is
used, or the user agent needs to reclaim memory.</p>
   <div class="algorithm" data-algorithm="registerPaint(name, paintCtor)" data-algorithm-for="PaintWorkletGlobalScope">
     When the <dfn class="dfn-paneled idl-code" data-dfn-for="PaintWorkletGlobalScope" data-dfn-type="method" data-export id="dom-paintworkletglobalscope-registerpaint"><code>registerPaint(<var>name</var>, <var>paintCtor</var>)</code></dfn> method is
called, the user agent <em>must</em> run the following steps: 
    <ol>
     <li data-md>
      <p>If the <var>name</var> is an empty string, <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#dfn-throw" id="ref-for-dfn-throw">throw</a> a <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#sec-native-error-types-used-in-this-standard-typeerror" id="ref-for-sec-native-error-types-used-in-this-standard-typeerror">TypeError</a> and abort all these steps.</p>
     <li data-md>
      <p>Let <var>paintDefinitionMap</var> be <code class="idl"><a data-link-type="idl" href="#paintworkletglobalscope" id="ref-for-paintworkletglobalscope⑥">PaintWorkletGlobalScope</a></code>'s <a data-link-type="dfn" href="#paint-definitions" id="ref-for-paint-definitions">paint definitions</a> map.</p>
     <li data-md>
      <p>If <var>paintDefinitionMap</var>[<var>name</var>] <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-exists" id="ref-for-map-exists">exists</a> <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#dfn-throw" id="ref-for-dfn-throw①">throw</a> a
"<code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#invalidmodificationerror" id="ref-for-invalidmodificationerror">InvalidModificationError</a></code>" <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException">DOMException</a></code> and abort all these steps.</p>
     <li data-md>
      <p>Let <var>inputProperties</var> be an empty <code>sequence&lt;DOMString></code>.</p>
     <li data-md>
      <p>Let <var>inputPropertiesIterable</var> be the result of <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#sec-get-o-p" id="ref-for-sec-get-o-p">Get</a>(<var>paintCtor</var>, "inputProperties").</p>
     <li data-md>
      <p>If <var>inputPropertiesIterable</var> is not undefined, then set <var>inputProperties</var> to the result of <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#web-idl-arguments-list-converting" id="ref-for-web-idl-arguments-list-converting">converting</a> <var>inputPropertiesIterable</var> to a <code>sequence&lt;DOMString></code>. If an
exception is <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#dfn-throw" id="ref-for-dfn-throw②">thrown</a>, rethrow the exception and abort all these steps.</p>
     <li data-md>
      <p>Filter <var>inputProperties</var> so that it only contains <a data-link-type="dfn" href="https://drafts.csswg.org/cssom-1/#supported-css-property" id="ref-for-supported-css-property">supported CSS properties</a> and <a data-link-type="dfn" href="https://drafts.csswg.org/css-variables-2/#custom-property" id="ref-for-custom-property">custom properties</a>.</p>
    </ol>
    <p class="note" role="note"><span class="marker">Note:</span> The list of CSS properties provided by the input properties getter can either be custom or
        native CSS properties.</p>
    <p class="note" role="note"><span class="marker">Note:</span> The list of CSS properties may contain shorthands.</p>
    <p class="note" role="note"><span class="marker">Note:</span> In order for a paint image class to be forwards compatible, the list of CSS properties can
        also contains currently invalid properties for the user agent. For example <code>margin-bikeshed-property</code>.</p>
    <ol start="8">
     <li data-md>
      <p>Let <var>inputArguments</var> be an empty <code>sequence&lt;DOMString></code>.</p>
     <li data-md>
      <p>Let <var>inputArgumentsIterable</var> be the result of <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#sec-get-o-p" id="ref-for-sec-get-o-p①">Get</a>(<var>paintCtor</var>, "inputArguments").</p>
     <li data-md>
      <p>If <var>inputArgumentsIterable</var> is not undefined, then set <var>inputArguments</var> to the result of <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#web-idl-arguments-list-converting" id="ref-for-web-idl-arguments-list-converting①">converting</a> <var>inputArgumentsIterable</var> to a <code>sequence&lt;DOMString></code>. If an
exception is thrown, rethrow the exception and abort all these steps.</p>
     <li data-md>
      <p>Let <var>inputArgumentSyntaxes</var> be an <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-empty" id="ref-for-list-empty">empty</a> <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list③">list</a>.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-iterate" id="ref-for-list-iterate">For each</a> <var>item</var> in <var>inputArguments</var> perform the following substeps:</p>
      <ol>
       <li data-md>
        <p>Attempt to <a data-link-type="dfn" href="https://drafts.css-houdini.org/css-properties-values-api-1/#consume-a-syntax-definition" id="ref-for-consume-a-syntax-definition">consume a syntax definition</a> from <var>item</var>.
If failure was returned, <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#dfn-throw" id="ref-for-dfn-throw③">throw</a> a <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#sec-native-error-types-used-in-this-standard-typeerror" id="ref-for-sec-native-error-types-used-in-this-standard-typeerror①">TypeError</a> and abort all these steps.
Otherwise, let <var>parsedSyntax</var> be the returned <a data-link-type="dfn" href="https://drafts.css-houdini.org/css-properties-values-api-1/#syntax-definition" id="ref-for-syntax-definition①">syntax definition</a>.</p>
       <li data-md>
        <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-append" id="ref-for-list-append">Append</a> <var>parsedSyntax</var> to <var>inputArgumentSyntaxes</var>.</p>
      </ol>
     <li data-md>
      <p>Let <var>contextOptionsValue</var> be the result of <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#sec-get-o-p" id="ref-for-sec-get-o-p②">Get</a>(<var>paintCtor</var>, "contextOptions").</p>
     <li data-md>
      <p>Let <var>paintRenderingContext2DSettings</var> be the result of <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#web-idl-arguments-list-converting" id="ref-for-web-idl-arguments-list-converting②">converting</a> <var>contextOptionsValue</var> to a <code class="idl"><a data-link-type="idl" href="#dictdef-paintrenderingcontext2dsettings" id="ref-for-dictdef-paintrenderingcontext2dsettings②">PaintRenderingContext2DSettings</a></code>.
If an exception is <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#dfn-throw" id="ref-for-dfn-throw④">thrown</a>, rethrow the exception and abort all these steps.</p>
      <p class="note" role="note"><span class="marker">Note:</span> Setting <code>paintRenderingContext2DSettings.alpha</code> is <code>false</code> allows user agents
    to anti-alias text in addition to performing "visibility" optimizations, e.g. not
    painting an image behind the paint image as the paint image is opaque.</p>
     <li data-md>
      <p>If the result of <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#sec-isconstructor" id="ref-for-sec-isconstructor">IsConstructor</a>(<var>paintCtor</var>) is false, <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#dfn-throw" id="ref-for-dfn-throw⑤">throw</a> a <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#sec-native-error-types-used-in-this-standard-typeerror" id="ref-for-sec-native-error-types-used-in-this-standard-typeerror②">TypeError</a> and abort all these steps.</p>
     <li data-md>
      <p>Let <var>prototype</var> be the result of <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#sec-get-o-p" id="ref-for-sec-get-o-p③">Get</a>(<var>paintCtor</var>, "prototype").</p>
     <li data-md>
      <p>If the result of <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#sec-ecmascript-data-types-and-values" id="ref-for-sec-ecmascript-data-types-and-values">Type</a>(<var>prototype</var>) is not Object, <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#dfn-throw" id="ref-for-dfn-throw⑥">throw</a> a <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#sec-native-error-types-used-in-this-standard-typeerror" id="ref-for-sec-native-error-types-used-in-this-standard-typeerror③">TypeError</a> and
abort all these steps.</p>
     <li data-md>
      <p>Let <var>paintValue</var> be the result of <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#sec-get-o-p" id="ref-for-sec-get-o-p④">Get</a>(<var>prototype</var>, "paint").</p>
     <li data-md>
      <p>Let <var>paint</var> be the result of <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#web-idl-arguments-list-converting" id="ref-for-web-idl-arguments-list-converting③">converting</a> <var>paintValue</var> to the <a data-link-type="dfn" href="https://drafts.csswg.org/css-syntax-3/#function" id="ref-for-function①">Function</a> <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#dfn-callback-function" id="ref-for-dfn-callback-function①">callback function</a> type. Rethrow any exceptions from the conversion.</p>
     <li data-md>
      <p>Let <var>definition</var> be a new <a data-link-type="dfn" href="#paint-definition" id="ref-for-paint-definition">paint definition</a> with:</p>
      <ul>
       <li data-md>
        <p><a data-link-type="dfn" href="#paint-definition-class-constructor" id="ref-for-paint-definition-class-constructor">class constructor</a> being <var>paintCtor</var>.</p>
       <li data-md>
        <p><a data-link-type="dfn" href="#paint-definition-paint-function" id="ref-for-paint-definition-paint-function">paint function</a> being <var>paint</var>.</p>
       <li data-md>
        <p><a data-link-type="dfn" href="#paint-definition-constructor-valid-flag" id="ref-for-paint-definition-constructor-valid-flag">constructor valid flag</a> being <b>true</b>.</p>
       <li data-md>
        <p><a data-link-type="dfn" href="#paint-definition-input-properties" id="ref-for-paint-definition-input-properties">input properties</a> being <var>inputProperties</var>.</p>
       <li data-md>
        <p><a data-link-type="dfn" href="#paint-definition-paintrenderingcontext2dsettings-object" id="ref-for-paint-definition-paintrenderingcontext2dsettings-object">PaintRenderingContext2DSettings object</a> being <var>paintRenderingContext2DSettings</var>.</p>
      </ul>
     <li data-md>
      <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-set" id="ref-for-map-set">Set</a> <var>paintDefinitionMap</var>[<var>name</var>] to <var>definition</var>.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task" id="ref-for-queue-a-task">Queue a task</a> to run the following steps:</p>
      <ol>
       <li data-md>
        <p>Let <var>documentPaintDefinitionMap</var> be the associated <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-document" id="ref-for-concept-document②">document’s</a> <a data-link-type="dfn" href="#document-paint-definitions" id="ref-for-document-paint-definitions">document paint
definitions</a> <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map" id="ref-for-ordered-map③">map</a>.</p>
       <li data-md>
        <p>Let <var>documentDefinition</var> be a new <a data-link-type="dfn" href="#document-paint-definition" id="ref-for-document-paint-definition">document paint definition</a> with:</p>
        <ul>
         <li data-md>
          <p><a data-link-type="dfn" href="#document-paint-definition-input-properties" id="ref-for-document-paint-definition-input-properties">input properties</a> being <var>inputProperties</var>.</p>
         <li data-md>
          <p><a data-link-type="dfn" href="#document-paint-definition-input-argument-syntaxes" id="ref-for-document-paint-definition-input-argument-syntaxes">input argument syntaxes</a> being <var>inputArgumentSyntaxes</var>.</p>
         <li data-md>
          <p><a data-link-type="dfn" href="#document-paint-definition-paintrenderingcontext2dsettings-object" id="ref-for-document-paint-definition-paintrenderingcontext2dsettings-object">PaintRenderingContext2DSettings object</a> being <var>paintRenderingContext2DSettings</var>.</p>
        </ul>
       <li data-md>
        <p>If <var>documentPaintDefinitionMap</var>[<var>name</var>] <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-exists" id="ref-for-map-exists①">exists</a>, run the following steps:</p>
        <ol>
         <li data-md>
          <p>Let <var>existingDocumentDefinition</var> be the result of <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-get" id="ref-for-map-get">get</a> <var>documentPaintDefinitionMap</var>[<var>name</var>].</p>
         <li data-md>
          <p>If <var>existingDocumentDefinition</var> is <code>"invalid"</code>, abort all these steps.</p>
         <li data-md>
          <p>If <var>existingDocumentDefinition</var> and <var>documentDefinition</var> are not equivalent, (that is <a data-link-type="dfn" href="#document-paint-definition-input-properties" id="ref-for-document-paint-definition-input-properties①">input properties</a>, <a data-link-type="dfn" href="#document-paint-definition-input-argument-syntaxes" id="ref-for-document-paint-definition-input-argument-syntaxes①">input argument syntaxes</a>, and <a data-link-type="dfn" href="#document-paint-definition-paintrenderingcontext2dsettings-object" id="ref-for-document-paint-definition-paintrenderingcontext2dsettings-object①">PaintRenderingContext2DSettings object</a> are different), then:</p>
          <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-set" id="ref-for-map-set①">Set</a> <var>documentPaintDefinitionMap</var>[<var>name</var>] to <code>"invalid"</code>.</p>
          <p>Log an error to the debugging console stating that the same class was registered
with different <code>inputProperties</code>, <code>inputArguments</code>, or <code>paintRenderingContext2DSettings</code>.</p>
        </ol>
       <li data-md>
        <p>Otherwise, <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-set" id="ref-for-map-set②">set</a> <var>documentPaintDefinitionMap</var>[<var>name</var>] to <var>documentDefinition</var>.</p>
      </ol>
    </ol>
    <p class="note" role="note"><span class="marker">Note:</span> The list of input properties should only be looked up once, the class doesn’t have the
    opportunity to dynamically change its input properties.</p>
    <p class="note" role="note"><span class="marker">Note:</span> In a future version of the spec, the author could have the ability to receive a different type
    of RenderingContext. In particular the author may want a WebGL rendering context to render 3D
    effects. There are complexities in setting up a WebGL rendering context to take the <code class="idl"><a data-link-type="idl" href="#paintsize" id="ref-for-paintsize">PaintSize</a></code> and <code class="idl"><a data-link-type="idl" href="https://drafts.css-houdini.org/css-typed-om-1/#stylepropertymap" id="ref-for-stylepropertymap">StylePropertyMap</a></code> as inputs.</p>
   </div>
   <h2 class="heading settled" data-level="5" id="paint-notation"><span class="secno">5. </span><span class="content">Paint Notation</span><a class="self-link" href="#paint-notation"></a></h2>
<pre class="prod"><dfn class="dfn-paneled" data-dfn-type="function" data-export id="funcdef-paint">paint()</dfn> = paint( <a class="production" data-link-type="type" href="https://drafts.csswg.org/css-values-4/#typedef-ident" id="ref-for-typedef-ident">&lt;ident></a><a data-link-type="grammar" href="https://drafts.csswg.org/css-values-4/#comb-comma" id="ref-for-comb-comma">,</a> <a class="production" data-link-type="type" href="https://drafts.csswg.org/css-syntax-3/#typedef-declaration-value" id="ref-for-typedef-declaration-value">&lt;declaration-value></a><a data-link-type="grammar" href="https://drafts.csswg.org/css-values-4/#mult-opt" id="ref-for-mult-opt">?</a> )
</pre>
   <p>The <a class="production css" data-link-type="function" href="#funcdef-paint" id="ref-for-funcdef-paint②">&lt;paint()></a> function is an additional notation to be supported by the <a class="production css" data-link-type="type" href="https://drafts.csswg.org/css-images-3/#typedef-image" id="ref-for-typedef-image④">&lt;image></a> type.</p>
   <div class="example" id="example-b92885ef">
    <a class="self-link" href="#example-b92885ef"></a> 
<pre class="lang-markup highlight"><c- p>&lt;</c-><c- f>style</c-><c- p>></c->
    <c- p>.</c-><c- nc>logo</c-> <c- p>{</c-> <c- k>background-image</c-><c- p>:</c-> <c- nf>paint</c-><c- p>(</c-><c- n>company</c-><c- g>-logo</c-><c- p>);</c-> <c- p>}</c->
    <c- p>.</c-><c- nc>chat-bubble</c-> <c- p>{</c-> <c- k>background-image</c-><c- p>:</c-> <c- nf>paint</c-><c- p>(</c-><c- n>chat</c-><c- g>-bubble</c-><c- p>,</c-> <c- kc>blue</c-><c- p>);</c-> <c- p>}</c->
<c- p>&lt;/</c-><c- f>style</c-><c- p>></c->
</pre>
   </div>
   <p>For the <a class="property css" data-link-type="property" href="https://drafts.csswg.org/css-ui-4/#propdef-cursor" id="ref-for-propdef-cursor">cursor</a> property, the <a class="production css" data-link-type="function" href="#funcdef-paint" id="ref-for-funcdef-paint③">&lt;paint()></a> function should be treated as an <a data-link-type="dfn" href="https://drafts.csswg.org/css-images-4/#invalid-image" id="ref-for-invalid-image">invalid image</a> and
fallback to the next supported <a class="production css" data-link-type="type" href="https://drafts.csswg.org/css-images-3/#typedef-image" id="ref-for-typedef-image⑤">&lt;image></a>.</p>
   <p>At <a data-link-type="dfn" href="https://drafts.csswg.org/css-cascade-5/#computed-value" id="ref-for-computed-value">computed value</a> time the <a class="production css" data-link-type="function" href="#funcdef-paint" id="ref-for-funcdef-paint④">&lt;paint()></a> function does <em>not</em> need to match the grammar
registered by <code class="idl"><a data-link-type="idl" href="#dom-paintworkletglobalscope-registerpaint" id="ref-for-dom-paintworkletglobalscope-registerpaint③">registerPaint()</a></code>. Instead this will result in an <a data-link-type="dfn" href="https://drafts.csswg.org/css-images-4/#invalid-image" id="ref-for-invalid-image①">invalid image</a> when the
parsing occurs inside <a data-link-type="dfn" href="#draw-a-paint-image" id="ref-for-draw-a-paint-image①">draw a paint image</a>.</p>
   <h2 class="heading settled" data-level="6" id="2d-rendering-context"><span class="secno">6. </span><span class="content">The 2D rendering context</span><a class="self-link" href="#2d-rendering-context"></a></h2>
<pre class="idl highlight def">[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed" id="ref-for-Exposed①"><c- g>Exposed</c-></a>=<c- n>PaintWorklet</c->]
<c- b>interface</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="interface" data-export id="paintrenderingcontext2d"><code><c- g>PaintRenderingContext2D</c-></code></dfn> {
};
<a data-link-type="idl-name" href="#paintrenderingcontext2d" id="ref-for-paintrenderingcontext2d"><c- n>PaintRenderingContext2D</c-></a> <c- b>includes</c-> <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/canvas.html#canvasstate" id="ref-for-canvasstate"><c- n>CanvasState</c-></a>;
<a data-link-type="idl-name" href="#paintrenderingcontext2d" id="ref-for-paintrenderingcontext2d①"><c- n>PaintRenderingContext2D</c-></a> <c- b>includes</c-> <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/canvas.html#canvastransform" id="ref-for-canvastransform"><c- n>CanvasTransform</c-></a>;
<a data-link-type="idl-name" href="#paintrenderingcontext2d" id="ref-for-paintrenderingcontext2d②"><c- n>PaintRenderingContext2D</c-></a> <c- b>includes</c-> <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/canvas.html#canvascompositing" id="ref-for-canvascompositing"><c- n>CanvasCompositing</c-></a>;
<a data-link-type="idl-name" href="#paintrenderingcontext2d" id="ref-for-paintrenderingcontext2d③"><c- n>PaintRenderingContext2D</c-></a> <c- b>includes</c-> <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/canvas.html#canvasimagesmoothing" id="ref-for-canvasimagesmoothing"><c- n>CanvasImageSmoothing</c-></a>;
<a data-link-type="idl-name" href="#paintrenderingcontext2d" id="ref-for-paintrenderingcontext2d④"><c- n>PaintRenderingContext2D</c-></a> <c- b>includes</c-> <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/canvas.html#canvasfillstrokestyles" id="ref-for-canvasfillstrokestyles"><c- n>CanvasFillStrokeStyles</c-></a>;
<a data-link-type="idl-name" href="#paintrenderingcontext2d" id="ref-for-paintrenderingcontext2d⑤"><c- n>PaintRenderingContext2D</c-></a> <c- b>includes</c-> <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/canvas.html#canvasshadowstyles" id="ref-for-canvasshadowstyles"><c- n>CanvasShadowStyles</c-></a>;
<a data-link-type="idl-name" href="#paintrenderingcontext2d" id="ref-for-paintrenderingcontext2d⑥"><c- n>PaintRenderingContext2D</c-></a> <c- b>includes</c-> <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/canvas.html#canvasrect" id="ref-for-canvasrect"><c- n>CanvasRect</c-></a>;
<a data-link-type="idl-name" href="#paintrenderingcontext2d" id="ref-for-paintrenderingcontext2d⑦"><c- n>PaintRenderingContext2D</c-></a> <c- b>includes</c-> <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/canvas.html#canvasdrawpath" id="ref-for-canvasdrawpath"><c- n>CanvasDrawPath</c-></a>;
<a data-link-type="idl-name" href="#paintrenderingcontext2d" id="ref-for-paintrenderingcontext2d⑧"><c- n>PaintRenderingContext2D</c-></a> <c- b>includes</c-> <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/canvas.html#canvasdrawimage" id="ref-for-canvasdrawimage"><c- n>CanvasDrawImage</c-></a>;
<a data-link-type="idl-name" href="#paintrenderingcontext2d" id="ref-for-paintrenderingcontext2d⑨"><c- n>PaintRenderingContext2D</c-></a> <c- b>includes</c-> <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/canvas.html#canvaspathdrawingstyles" id="ref-for-canvaspathdrawingstyles"><c- n>CanvasPathDrawingStyles</c-></a>;
<a data-link-type="idl-name" href="#paintrenderingcontext2d" id="ref-for-paintrenderingcontext2d①⓪"><c- n>PaintRenderingContext2D</c-></a> <c- b>includes</c-> <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/canvas.html#canvaspath" id="ref-for-canvaspath"><c- n>CanvasPath</c-></a>;
</pre>
   <p class="note" role="note"><span class="marker">Note:</span> The <code class="idl"><a data-link-type="idl" href="#paintrenderingcontext2d" id="ref-for-paintrenderingcontext2d①①">PaintRenderingContext2D</a></code> implements a subset of the <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/canvas.html#canvasrenderingcontext2d" id="ref-for-canvasrenderingcontext2d">CanvasRenderingContext2D</a></code> API.
    Specifically it doesn’t implement the <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/canvas.html#canvasimagedata" id="ref-for-canvasimagedata">CanvasImageData</a></code>, <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/canvas.html#canvasuserinterface" id="ref-for-canvasuserinterface">CanvasUserInterface</a></code>, <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/canvas.html#canvastext" id="ref-for-canvastext">CanvasText</a></code>, or <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/canvas.html#canvastextdrawingstyles" id="ref-for-canvastextdrawingstyles">CanvasTextDrawingStyles</a></code> APIs.</p>
   <p>A <code class="idl"><a data-link-type="idl" href="#paintrenderingcontext2d" id="ref-for-paintrenderingcontext2d①②">PaintRenderingContext2D</a></code> object has a <dfn class="dfn-paneled" data-dfn-for="PaintRenderingContext2D" data-dfn-type="dfn" data-noexport id="paintrenderingcontext2d-output-bitmap">output bitmap</dfn>.
This is initialised when the object is created.
The size of the <a data-link-type="dfn" href="#paintrenderingcontext2d-output-bitmap" id="ref-for-paintrenderingcontext2d-output-bitmap">output bitmap</a> is the <a data-link-type="dfn" href="https://drafts.csswg.org/css-images-3/#concrete-object-size" id="ref-for-concrete-object-size">concrete object size</a> of the object it is rendering to.</p>
   <p>A <code class="idl"><a data-link-type="idl" href="#paintrenderingcontext2d" id="ref-for-paintrenderingcontext2d①③">PaintRenderingContext2D</a></code> object also has an <dfn class="dfn-paneled" data-dfn-for="PaintRenderingContext2D" data-dfn-type="dfn" data-noexport id="paintrenderingcontext2d-alpha">alpha</dfn> flag,
which can be set to true or false.
Initially, when the context is created,
its alpha flag must be set to true.
When a <code class="idl"><a data-link-type="idl" href="#paintrenderingcontext2d" id="ref-for-paintrenderingcontext2d①④">PaintRenderingContext2D</a></code> object has its alpha flag set to false,
then its alpha channel must be fixed to 1.0 (fully opaque) for all pixels,
and attempts to change the alpha component of any pixel must be silently ignored.</p>
   <p>The size of the <a data-link-type="dfn" href="#paintrenderingcontext2d-output-bitmap" id="ref-for-paintrenderingcontext2d-output-bitmap①">output bitmap</a> does not necessarily represent the size of the actual bitmap
that the user agent will use internally or during rendering. For example, if the visual viewport is
zoomed the user agent may internally use bitmaps which correspond to the number of device pixels in
the coordinate space, so that the resulting rendering is of high quality.</p>
   <p>Additionally the user agent may record the sequence of drawing operations which have been applied to
the <a data-link-type="dfn" href="#paintrenderingcontext2d-output-bitmap" id="ref-for-paintrenderingcontext2d-output-bitmap②">output bitmap</a> such that the user agent can subsequently draw onto a device bitmap at the
correct resolution. This also allows user agents to re-use the same output of the <a data-link-type="dfn" href="#paintrenderingcontext2d-output-bitmap" id="ref-for-paintrenderingcontext2d-output-bitmap③">output bitmap</a> repeatably while the visual viewport is being zoomed for example.</p>
   <p>Whenever <code>"currentColor"</code> is used as a color in the <code class="idl"><a data-link-type="idl" href="#paintrenderingcontext2d" id="ref-for-paintrenderingcontext2d①⑤">PaintRenderingContext2D</a></code> API, it
is treated as opaque black.</p>
   <div class="example" id="example-191bbc01">
    <a class="self-link" href="#example-191bbc01"></a> The code below will produce a solid black rectange. 
<pre class="lang-javascript highlight">registerPaint<c- p>(</c-><c- t>'currentcolor'</c-><c- p>,</c-> <c- a>class</c-> <c- p>{</c->
    paint<c- p>(</c->ctx<c- p>,</c-> size<c- p>)</c-> <c- p>{</c->
        ctx<c- p>.</c->fillStyle <c- o>=</c-> <c- t>'currentColor'</c-><c- p>;</c->
        ctx<c- p>.</c->fillRect<c- p>(</c-><c- mf>0</c-><c- p>,</c-> <c- mf>0</c-><c- p>,</c-> size<c- p>.</c->width<c- p>,</c-> size<c- p>.</c->height<c- p>);</c->
    <c- p>}</c->
<c- p>});</c->
</pre>
   </div>
   <div class="algorithm" data-algorithm="create a PaintRenderingContext2D object">
     When the user agent is to <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="create-a-paintrenderingcontext2d-object">create a PaintRenderingContext2D object</dfn> for a given <var>width</var>, <var>height</var>, and <var>paintRenderingContext2DSettings</var>, it <em>must</em> run the following steps: 
    <ol>
     <li data-md>
      <p>Create a new <code class="idl"><a data-link-type="idl" href="#paintrenderingcontext2d" id="ref-for-paintrenderingcontext2d①⑥">PaintRenderingContext2D</a></code>.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/canvas.html#concept-canvas-set-bitmap-dimensions" id="ref-for-concept-canvas-set-bitmap-dimensions">Set bitmap dimensions</a> for the context’s <a data-link-type="dfn" href="#paintrenderingcontext2d-output-bitmap" id="ref-for-paintrenderingcontext2d-output-bitmap④">output bitmap</a> to the rounded values of <var>width</var> and <var>height</var>.</p>
     <li data-md>
      <p>Set the <code class="idl"><a data-link-type="idl" href="#paintrenderingcontext2d" id="ref-for-paintrenderingcontext2d①⑦">PaintRenderingContext2D</a></code>'s <a data-link-type="dfn" href="#paintrenderingcontext2d-alpha" id="ref-for-paintrenderingcontext2d-alpha">alpha</a> flag to <var>paintRenderingContext2DSettings</var>’s <code class="idl"><a data-link-type="idl" href="#dom-paintrenderingcontext2dsettings-alpha" id="ref-for-dom-paintrenderingcontext2dsettings-alpha">alpha</a></code>.</p>
     <li data-md>
      <p>Return the new <code class="idl"><a data-link-type="idl" href="#paintrenderingcontext2d" id="ref-for-paintrenderingcontext2d①⑧">PaintRenderingContext2D</a></code>.</p>
    </ol>
    <p class="note" role="note"><span class="marker">Note:</span> The initial state of the rendering context is set inside the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/canvas.html#concept-canvas-set-bitmap-dimensions" id="ref-for-concept-canvas-set-bitmap-dimensions①">set bitmap dimensions</a> algorithm, as it invokes <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/canvas.html#reset-the-rendering-context-to-its-default-state" id="ref-for-reset-the-rendering-context-to-its-default-state">reset the rendering context to its default state</a> and clears the <a data-link-type="dfn" href="#paintrenderingcontext2d-output-bitmap" id="ref-for-paintrenderingcontext2d-output-bitmap⑤">output bitmap</a>.</p>
   </div>
   <h3 class="heading settled" data-level="6.1" id="drawing-a-cssimagevalue"><span class="secno">6.1. </span><span class="content">Drawing a CSSImageValue</span><a class="self-link" href="#drawing-a-cssimagevalue"></a></h3>
   <p>The <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/canvas.html#canvasimagesource" id="ref-for-canvasimagesource">CanvasImageSource</a></code> typedef is extended to also include the <code class="idl"><a data-link-type="idl" href="https://drafts.css-houdini.org/css-typed-om-1/#cssimagevalue" id="ref-for-cssimagevalue">CSSImageValue</a></code> type to be used
as an image source.</p>
   <p>For interfaces which use the <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/canvas.html#canvasdrawimage" id="ref-for-canvasdrawimage①">CanvasDrawImage</a></code> mixin:</p>
   <ul>
    <li data-md>
     <p>When a <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/canvas.html#canvasimagesource" id="ref-for-canvasimagesource①">CanvasImageSource</a></code> object represents an <code class="idl"><a data-link-type="idl" href="https://drafts.css-houdini.org/css-typed-om-1/#cssimagevalue" id="ref-for-cssimagevalue①">CSSImageValue</a></code>, the result of invoking
 the value’s underlying image algorithm must be used as the source image for the purposes of <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/canvas.html#dom-context-2d-drawimage" id="ref-for-dom-context-2d-drawimage">drawImage</a></code>.</p>
   </ul>
   <p class="note" role="note"><span class="marker">Note:</span> This should eventually be moved to the canvas section of the HTML specification.
See <a href="https://github.com/w3c/css-houdini-drafts/issues/819">Issue 819</a>.</p>
   <h2 class="heading settled" data-level="7" id="drawing-an-image"><span class="secno">7. </span><span class="content">Drawing an image</span><a class="self-link" href="#drawing-an-image"></a></h2>
   <p>If a <a class="production css" data-link-type="function" href="#funcdef-paint" id="ref-for-funcdef-paint⑤">&lt;paint()></a> function image for a <a data-link-type="dfn" href="https://drafts.csswg.org/css-display-4/#box" id="ref-for-box">box</a> is within the visual viewport, the user agent <em>must</em> display an image output from an invocation of the <a data-link-type="dfn" href="#draw-a-paint-image" id="ref-for-draw-a-paint-image②">draw a paint image</a> algorithm.</p>
   <p class="note" role="note"><span class="marker">Note:</span> The user agent doesn’t have to run <a data-link-type="dfn" href="#draw-a-paint-image" id="ref-for-draw-a-paint-image③">draw a paint image</a> each frame for a <a class="production css" data-link-type="function" href="#funcdef-paint" id="ref-for-funcdef-paint⑥">&lt;paint()></a> function within the visual viewport. It can cache results, (potentially using additional
    invalidation steps) to display the correct image output.</p>
   <p class="note" role="note"><span class="marker">Note:</span> The user agent can optionally defer drawing images which are outside the visual viewport.</p>
   <div class="example" id="example-b382d1f5">
    <a class="self-link" href="#example-b382d1f5"></a> If an author updates a style inside a <code>requestAnimationFrame</code>, e.g. 
<pre class="lang-javascript highlight">requestAnimationFrame<c- p>(</c-><c- a>function</c-><c- p>()</c-> <c- p>{</c->
    element<c- p>.</c->styleMap<c- p>.</c->set<c- p>(</c-><c- t>'--custom-prop-invalidates-paint'</c-><c- p>,</c-> <c- mf>42</c-><c- p>);</c->
<c- p>});</c->
</pre>
    <p>And the <code>element</code> is inside the visual viewport, the user agent is required to <a data-link-type="dfn" href="#draw-a-paint-image" id="ref-for-draw-a-paint-image④">draw a paint image</a> and display the result for the current frame.</p>
   </div>
   <p>The <a data-link-type="dfn" href="#draw-a-paint-image" id="ref-for-draw-a-paint-image⑤">draw a paint image</a> function is invoked by the user agent during the <a data-link-type="dfn" href="https://drafts.csswg.org/css-images-3/#object-size-negotiation" id="ref-for-object-size-negotiation">object size
negotiation</a> algorithm which is responsible for rendering an <a class="production css" data-link-type="type" href="https://drafts.csswg.org/css-images-3/#typedef-image" id="ref-for-typedef-image⑥">&lt;image></a>, with <var>snappedConcreteObjectSize</var> defined as follows. Let <var>concreteObjectSize</var> be the <a data-link-type="dfn" href="https://drafts.csswg.org/css-images-3/#concrete-object-size" id="ref-for-concrete-object-size①">concrete object
size</a> of the <a data-link-type="dfn" href="https://drafts.csswg.org/css-display-4/#box" id="ref-for-box①">box</a>.  The <var>snappedConcreteObjectSize</var> is usually the same as the <var>concreteObjectSize</var>. However, the user agent may adjust the size such that it paints to pixel
boundaries. If it does, the user agent should adjust the <var>snappedConcreteObjectSize</var> by the
proportional change from its original size such that the <a class="production css" data-link-type="function" href="#funcdef-paint" id="ref-for-funcdef-paint⑦">&lt;paint()></a> function can adjust the drawing
accordingly.</p>
   <p>For the purposes of the <a data-link-type="dfn" href="https://drafts.csswg.org/css-images-3/#object-size-negotiation" id="ref-for-object-size-negotiation①">object size negotiation</a> algorithm,
the paint image has no <a data-link-type="dfn" href="https://drafts.csswg.org/css-images-3/#natural-dimensions" id="ref-for-natural-dimensions">natural dimensions</a>.</p>
   <p class="note" role="note"><span class="marker">Note:</span> In a future version of the spec, the author could have the ability to specify the <a data-link-type="dfn" href="https://drafts.csswg.org/css-images-3/#natural-dimensions" id="ref-for-natural-dimensions①">natural
    dimensions</a> of the paint image. This will probably be exposed as a callback allowing the
    author to define static <a data-link-type="dfn" href="https://drafts.csswg.org/css-images-3/#natural-dimensions" id="ref-for-natural-dimensions②">natural dimensions</a> or dynamically updating the <a data-link-type="dfn" href="https://drafts.csswg.org/css-images-3/#natural-dimensions" id="ref-for-natural-dimensions③">natural
    dimensions</a> based on computed style and size changes.</p>
   <p>The <code class="idl"><a data-link-type="idl" href="#paintsize" id="ref-for-paintsize①">PaintSize</a></code> object represents the size of the image that the author should draw. This is
the <var>snappedConcreteObjectSize</var> given by the user agent.</p>
   <p class="note" role="note"><span class="marker">Note:</span> See <a href="https://drafts.csswg.org/css-images-3/#object-sizing-examples"><cite>CSS Images 3</cite> § 4.4 Examples of CSS Object Sizing</a> for examples on how the <a data-link-type="dfn" href="https://drafts.csswg.org/css-images-3/#concrete-object-size" id="ref-for-concrete-object-size②">concrete object
    size</a> is calculated.</p>
   <p>The <a data-link-type="dfn" href="#draw-a-paint-image" id="ref-for-draw-a-paint-image⑥">draw a paint image</a> function may be speculatively invoked by the user agent at any point,
with any <var>snappedConcreteObjectSize</var>. The resulting image is not displayed.</p>
   <p class="note" role="note"><span class="marker">Note:</span> User agents may use any heuristic to speculate a possible future value for <var>snappedConcreteObjectSize</var>, for example speculating that the size remains unchanged.</p>
   <p class="note" role="note"><span class="marker">Note:</span> Although the image is not displayed, it may still be cached, and subsequent invocations of <a class="production css" data-link-type="function" href="#funcdef-paint" id="ref-for-funcdef-paint⑧">&lt;paint()></a> may use the cached image.</p>
<pre class="idl highlight def">[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed" id="ref-for-Exposed②"><c- g>Exposed</c-></a>=<c- n>PaintWorklet</c->]
<c- b>interface</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="interface" data-export id="paintsize"><code><c- g>PaintSize</c-></code></dfn> {
    <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-double" id="ref-for-idl-double"><c- b>double</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="PaintSize" data-dfn-type="attribute" data-export data-readonly data-type="double" id="dom-paintsize-width"><code><c- g>width</c-></code></dfn>;
    <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-double" id="ref-for-idl-double①"><c- b>double</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="PaintSize" data-dfn-type="attribute" data-export data-readonly data-type="double" id="dom-paintsize-height"><code><c- g>height</c-></code></dfn>;
};
</pre>
   <div class="algorithm" data-algorithm="draw a paint image">
     When the user agent wants to <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="draw-a-paint-image">draw a paint image</dfn> of a <a class="production css" data-link-type="function" href="#funcdef-paint" id="ref-for-funcdef-paint⑨">&lt;paint()></a> function for a <var>box</var> into its appropriate stacking level (as defined by the property the CSS property its associated
with), given <var>snappedConcreteObjectSize</var> it <em>must</em> run the following steps: 
    <ol>
     <li data-md>
      <p>Let <var>paintFunction</var> be the <a class="production css" data-link-type="function" href="#funcdef-paint" id="ref-for-funcdef-paint①⓪">&lt;paint()></a> function on the <var>box</var> which the user agent wants to
draw.</p>
     <li data-md>
      <p>Let <var>name</var> be the first argument of the <var>paintFunction</var>.</p>
     <li data-md>
      <p>Let <var>documentPaintDefinitionMap</var> be the associated <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-document" id="ref-for-concept-document③">document’s</a> <a data-link-type="dfn" href="#document-paint-definitions" id="ref-for-document-paint-definitions①">document paint
definitions</a> map.</p>
     <li data-md>
      <p>If <var>documentPaintDefinitionMap</var>[<var>name</var>] does not <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-exists" id="ref-for-map-exists②">exist</a>, let the image output
be an <a data-link-type="dfn" href="https://drafts.csswg.org/css-images-4/#invalid-image" id="ref-for-invalid-image②">invalid image</a> and abort all these steps.</p>
     <li data-md>
      <p>Let <var>documentDefinition</var> be the result of <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-get" id="ref-for-map-get①">get</a> <var>documentPaintDefinitionMap</var>[<var>name</var>].</p>
     <li data-md>
      <p>If <var>documentDefinition</var> is <code>"invalid"</code>, let the image output be an <a data-link-type="dfn" href="https://drafts.csswg.org/css-images-4/#invalid-image" id="ref-for-invalid-image③">invalid
image</a> and abort all these steps.</p>
     <li data-md>
      <p>Let <var>inputArgumentSyntaxes</var> be <var>documentDefinition</var>’s <a data-link-type="dfn" href="#document-paint-definition-input-argument-syntaxes" id="ref-for-document-paint-definition-input-argument-syntaxes②">input argument syntaxes</a>.</p>
     <li data-md>
      <p>Let <var>inputArguments</var> be the <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list④">list</a> of all the <var>paintFunction</var> arguments <em>after</em> the "paint name" argument.</p>
     <li data-md>
      <p>If <var>inputArguments</var> do not match the registered grammar given by <var>inputArgumentSyntaxes</var>, let
the image output be an <a data-link-type="dfn" href="https://drafts.csswg.org/css-images-4/#invalid-image" id="ref-for-invalid-image④">invalid image</a> and abort all these steps.</p>
      <div class="example" id="example-a43f39b7">
       <a class="self-link" href="#example-a43f39b7"></a> This step may fail in the following cases: 
<pre class="lang-javascript highlight"><c- c1>// paint.js</c->
registerPaint<c- p>(</c-><c- t>'failing-argument-syntax'</c-><c- p>,</c-> <c- a>class</c-> <c- p>{</c->
    <c- k>static</c-> get inputArguments<c- p>()</c-> <c- p>{</c-> <c- k>return</c-> <c- p>[</c-><c- t>'&lt;length>'</c-><c- p>];</c-> <c- p>}</c->
    paint<c- p>(</c->ctx<c- p>,</c-> size<c- p>,</c-> styleMap<c- p>,</c-> args<c- p>)</c-> <c- p>{</c-> <c- d>/* paint code here. */</c-> <c- p>}</c->
<c- p>});</c->
</pre>
<pre class="lang-markup highlight"><c- p>&lt;</c-><c- f>style</c-><c- p>></c->
    <c- p>.</c-><c- nc>example-1</c-> <c- p>{</c->
        <c- k>background-image</c-><c- p>:</c-> <c- nf>paint</c-><c- p>(</c-><c- n>failing</c-><c- g>-argument-syntax</c-><c- p>,</c-> <c- kc>red</c-><c- p>);</c->
    <c- p>}</c->
    <c- p>.</c-><c- nc>example-2</c-> <c- p>{</c->
        <c- k>background-image</c-><c- p>:</c-> <c- nf>paint</c-><c- p>(</c-><c- n>failing</c-><c- g>-argument-syntax</c-><c- p>,</c-> <c- mi>1</c-><c- b>px</c-><c- p>,</c-> <c- mi>2</c-><c- b>px</c-><c- p>);</c->
    <c- p>}</c->
<c- p>&lt;/</c-><c- f>style</c-><c- p>></c->
<c- p>&lt;</c-><c- f>div</c-> <c- e>class</c-><c- o>=</c-><c- s>example-1</c-><c- p>>&lt;/</c-><c- f>div</c-><c- p>></c->
<c- p>&lt;</c-><c- f>div</c-> <c- e>class</c-><c- o>=</c-><c- s>example-2</c-><c- p>>&lt;/</c-><c- f>div</c-><c- p>></c->
<c- p>&lt;</c-><c- f>script</c-><c- p>></c->
    CSS<c- p>.</c->paintWorklet<c- p>.</c->addModule<c- p>(</c-><c- t>'paint.js'</c-><c- p>);</c->
<c- p>&lt;/</c-><c- f>script</c-><c- p>></c->
</pre>
       <p><code>example-1</code> produces an <a data-link-type="dfn" href="https://drafts.csswg.org/css-images-4/#invalid-image" id="ref-for-invalid-image⑤">invalid image</a> as <code>"red"</code> does not
    match the registered grammar.</p>
       <p><code>example-2</code> produces an <a data-link-type="dfn" href="https://drafts.csswg.org/css-images-4/#invalid-image" id="ref-for-invalid-image⑥">invalid image</a> as there are too many function
    arguments.</p>
      </div>
     <li data-md>
      <p>Let <var>workletGlobalScope</var> be a <code class="idl"><a data-link-type="idl" href="#paintworkletglobalscope" id="ref-for-paintworkletglobalscope⑦">PaintWorkletGlobalScope</a></code> from the the paint <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/worklets.html#worklet" id="ref-for-worklet③">Worklet</a></code>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/worklets.html#concept-worklet-global-scopes" id="ref-for-concept-worklet-global-scopes">global scopes</a>, following the rules defined in <a href="#global-scope-selection">§ 7.1 Global Scope Selection</a>.</p>
      <p>The user agent <em>may</em> also <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/worklets.html#create-a-worklet-global-scope" id="ref-for-create-a-worklet-global-scope">create a worklet global scope</a> at this time, given the
paint <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/worklets.html#worklet" id="ref-for-worklet④">Worklet</a></code>.</p>
     <li data-md>
      <p>Run <a data-link-type="dfn" href="#invoke-a-paint-callback" id="ref-for-invoke-a-paint-callback">invoke a paint callback</a> given <var>name</var>, <var>inputArguments</var>, <var>snappedConcreteObjectSize</var>, <var>workletGlobalScope</var> optionally <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel" id="ref-for-in-parallel">in parallel</a>.</p>
      <p class="note" role="note"><span class="marker">Note:</span> If the user agent runs <a data-link-type="dfn" href="#invoke-a-paint-callback" id="ref-for-invoke-a-paint-callback①">invoke a paint callback</a> on a thread <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel" id="ref-for-in-parallel①">in parallel</a>,
    it should select a paint worklet global scope which can be used on that thread.</p>
    </ol>
   </div>
   <div class="algorithm" data-algorithm="invoke a paint callback">
     When the user agent wants to <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="invoke-a-paint-callback">invoke a paint callback</dfn> given <var>name</var>, <var>inputArguments</var>, <var>snappedConcreteObjectSize</var>, and <var>workletGlobalScope</var>, it <em>must</em> run the following steps: 
    <ol>
     <li data-md>
      <p>Let <var>paintDefinitionMap</var> be <var>workletGlobalScope</var>’s <a data-link-type="dfn" href="#paint-definitions" id="ref-for-paint-definitions①">paint definitions</a> map.</p>
     <li data-md>
      <p>If <var>paintDefinitionMap</var>[<var>name</var>] does not <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-exists" id="ref-for-map-exists③">exist</a>, run the following steps:</p>
      <ol>
       <li data-md>
        <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task" id="ref-for-queue-a-task①">Queue a task</a> to run the following steps:</p>
        <ol>
         <li data-md>
          <p>Let <var>documentPaintDefinitionMap</var> be the associated <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-document" id="ref-for-concept-document④">document</a>'s <a data-link-type="dfn" href="#document-paint-definitions" id="ref-for-document-paint-definitions②">document
paint definitions</a> map.</p>
         <li data-md>
          <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-set" id="ref-for-map-set③">Set</a> <var>documentPaintDefinitionMap</var>[<var>name</var>] to <code>"invalid"</code>.</p>
         <li data-md>
          <p>The user agent <em>should</em> log an error to the debugging console stating that a
class wasn’t registered in all <code class="idl"><a data-link-type="idl" href="#paintworkletglobalscope" id="ref-for-paintworkletglobalscope⑧">PaintWorkletGlobalScope</a></code>s.</p>
        </ol>
       <li data-md>
        <p>Let the image output be an <a data-link-type="dfn" href="https://drafts.csswg.org/css-images-4/#invalid-image" id="ref-for-invalid-image⑦">invalid image</a> and abort all these steps.</p>
      </ol>
      <p class="note" role="note"><span class="marker">Note:</span> This handles the case where there could be a paint worklet global scope which didn’t
    receive the <code class="idl"><a data-link-type="idl" href="#dom-paintworkletglobalscope-registerpaint" id="ref-for-dom-paintworkletglobalscope-registerpaint④">registerPaint(name, paintCtor)</a></code> for <var>name</var> (however another global scope
    did). A paint callback which is invoked on the other global scope could succeed, but
    wont succeed on a subsequent frame when <a data-link-type="dfn" href="#draw-a-paint-image" id="ref-for-draw-a-paint-image⑦">draw a paint image</a> is called.</p>
     <li data-md>
      <p>Let <var>definition</var> be the result of <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#sec-get-o-p" id="ref-for-sec-get-o-p⑤">get</a> <var>paintDefinitionMap</var>[<var>name</var>].</p>
     <li data-md>
      <p>Let <var>paintClassInstanceMap</var> be <var>workletGlobalScope</var>’s <a data-link-type="dfn" href="#paint-class-instances" id="ref-for-paint-class-instances①">paint class instances</a> map.</p>
     <li data-md>
      <p>Let <var>paintInstance</var> be the result of <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#sec-get-o-p" id="ref-for-sec-get-o-p⑥">get</a> <var>paintClassInstanceMap</var>[|name]|. If <var>paintInstance</var> is null, run the following steps:</p>
      <ol>
       <li data-md>
        <p>If the <a data-link-type="dfn" href="#paint-definition-constructor-valid-flag" id="ref-for-paint-definition-constructor-valid-flag①">constructor valid flag</a> on <var>definition</var> is false, let the image output be an <a data-link-type="dfn" href="https://drafts.csswg.org/css-images-4/#invalid-image" id="ref-for-invalid-image⑧">invalid image</a> and abort all these steps.</p>
       <li data-md>
        <p>Let <var>paintCtor</var> be the <a data-link-type="dfn" href="#paint-definition-class-constructor" id="ref-for-paint-definition-class-constructor①">class constructor</a> on <var>definition</var>.</p>
       <li data-md>
        <p>Let <var>paintInstance</var> be the result of <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#sec-construct" id="ref-for-sec-construct">Construct</a>(<var>paintCtor</var>).</p>
        <p>If <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#sec-construct" id="ref-for-sec-construct①">construct</a> throws an exception,
set the <var>definition</var>’s <a data-link-type="dfn" href="#paint-definition-constructor-valid-flag" id="ref-for-paint-definition-constructor-valid-flag②">constructor valid flag</a> to false,
let the image output be an <a data-link-type="dfn" href="https://drafts.csswg.org/css-images-4/#invalid-image" id="ref-for-invalid-image⑨">invalid image</a> and abort all these
steps.</p>
       <li data-md>
        <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-set" id="ref-for-map-set④">Set</a> <var>paintClassInstanceMap</var>[<var>name</var>] to <var>paintInstance</var>.</p>
      </ol>
     <li data-md>
      <p>Let <var>inputProperties</var> be <var>definition</var>’s <a data-link-type="dfn" href="#paint-definition-input-properties" id="ref-for-paint-definition-input-properties①">input properties</a>.</p>
     <li data-md>
      <p>Let <var>styleMap</var> be a new <code class="idl"><a data-link-type="idl" href="https://drafts.css-houdini.org/css-typed-om-1/#stylepropertymapreadonly" id="ref-for-stylepropertymapreadonly">StylePropertyMapReadOnly</a></code> populated with <em>only</em> the <a data-link-type="dfn" href="https://drafts.csswg.org/css-cascade-5/#computed-value" id="ref-for-computed-value①">computed value</a>'s for properties listed in <var>inputProperties</var>.</p>
     <li data-md>
      <p>Let <var>renderingContext</var> be the result of <a data-link-type="dfn" href="#create-a-paintrenderingcontext2d-object" id="ref-for-create-a-paintrenderingcontext2d-object">create a PaintRenderingContext2D object</a> given:</p>
      <ul>
       <li data-md>
        <p>"width" - The width given by <var>snappedConcreteObjectSize</var>.</p>
       <li data-md>
        <p>"height" - The height given by <var>snappedConcreteObjectSize</var>.</p>
       <li data-md>
        <p>"paintRenderingContext2DSettings" - The <a data-link-type="dfn" href="#paint-definition-paintrenderingcontext2dsettings-object" id="ref-for-paint-definition-paintrenderingcontext2dsettings-object①">PaintRenderingContext2DSettings object</a> given by <var>definition</var>.</p>
      </ul>
      <p class="note" role="note"><span class="marker">Note:</span> The <var>renderingContext</var> is not be re-used between invocations of paint. Implicitly this
    means that there is no stored data, or state on the <var>renderingContext</var> between
    invocations. For example you can’t setup a clip on the context, and expect the same clip
    to be applied next time the paint method is called.</p>
      <p class="note" role="note"><span class="marker">Note:</span> Implicitly this also means that <var>renderingContext</var> is effectively "neutered" after a
    paint method is complete. The author code may hold a reference to <var>renderingContext</var> and
    invoke methods on it, but this will have no effect on the current image, or subsequent
    images.</p>
     <li data-md>
      <p>Let <var>paintSize</var> be a new <code class="idl"><a data-link-type="idl" href="#paintsize" id="ref-for-paintsize②">PaintSize</a></code> initialized to the width and height defined by <var>snappedConcreteObjectSize</var>.</p>
     <li data-md>
      <p>At this stage the user agent may re-use an image from a previous invocation if <var>paintSize</var>, <var>styleMap</var>, <var>inputArguments</var> are equivalent to that previous invocation. If so let the image
output be that cached image and abort all these steps.</p>
      <div class="note" role="note">
        In the example below, both <code>div-1</code> and <code>div-2</code> have paint
    functions which have equivalent javascript arguments. A user-agent can cache the result
    of one invocation and use it for both elements. 
<pre class="lang-javascript highlight"><c- c1>// paint.js</c->
registerPaint<c- p>(</c-><c- t>'simple'</c-><c- p>,</c-> <c- a>class</c-> <c- p>{</c->
    paint<c- p>(</c->ctx<c- p>,</c-> size<c- p>)</c-> <c- p>{</c->
        ctx<c- p>.</c->fillStyle <c- o>=</c-> <c- t>'green'</c-><c- p>;</c->
        ctx<c- p>.</c->fillRect<c- p>(</c-><c- mf>0</c-><c- p>,</c-> <c- mf>0</c-><c- p>,</c-> size<c- p>.</c->width<c- p>,</c-> size<c- p>.</c->height<c- p>);</c->
    <c- p>}</c->
<c- p>});</c->
</pre>
<pre class="lang-markup highlight"><c- p>&lt;</c-><c- f>style</c-><c- p>></c->
    <c- p>.</c-><c- nc>div-1</c-> <c- p>{</c->
        <c- k>width</c-><c- p>:</c-> <c- mi>50</c-><c- b>px</c-><c- p>;</c->
        <c- k>height</c-><c- p>:</c-> <c- mi>50</c-><c- b>px</c-><c- p>;</c->
        <c- k>background-image</c-><c- p>:</c-> <c- nf>paint</c-><c- p>(</c-><c- n>simple</c-><c- p>);</c->
    <c- p>}</c->
    <c- p>.</c-><c- nc>div-2</c-> <c- p>{</c->
        <c- k>width</c-><c- p>:</c-> <c- mi>100</c-><c- b>px</c-><c- p>;</c->
        <c- k>height</c-><c- p>:</c-> <c- mi>100</c-><c- b>px</c-><c- p>;</c->

        <c- k>background-size</c-><c- p>:</c-> <c- mi>50</c-><c- b>%</c-> <c- mi>50</c-><c- b>%</c-><c- p>;</c->
        <c- k>background-image</c-><c- p>:</c-> <c- nf>paint</c-><c- p>(</c-><c- n>simple</c-><c- p>);</c->
    <c- p>}</c->
<c- p>&lt;/</c-><c- f>style</c-><c- p>></c->
<c- p>&lt;</c-><c- f>div</c-> <c- e>class</c-><c- o>=</c-><c- s>div-1</c-><c- p>>&lt;/</c-><c- f>div</c-><c- p>></c->
<c- p>&lt;</c-><c- f>div</c-> <c- e>class</c-><c- o>=</c-><c- s>div-2</c-><c- p>>&lt;/</c-><c- f>div</c-><c- p>></c->
<c- p>&lt;</c-><c- f>script</c-><c- p>></c->
    CSS<c- p>.</c->paintWorklet<c- p>.</c->addModule<c- p>(</c-><c- t>'paint.js'</c-><c- p>);</c->
<c- p>&lt;/</c-><c- f>script</c-><c- p>></c->
</pre>
      </div>
     <li data-md>
      <p>Let <var>paintFunctionCallback</var> be <var>definition</var>’s <a data-link-type="dfn" href="#paint-definition-paint-function" id="ref-for-paint-definition-paint-function①">paint function</a>.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#invoke-a-callback-function" id="ref-for-invoke-a-callback-function">Invoke</a> <var>paintFunctionCallback</var> with arguments «<var>renderingContext</var>, <var>paintSize</var>, <var>styleMap</var>, <var>inputArguments</var>», and with <var>paintInstance</var> as the <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#dfn-callback-this-value" id="ref-for-dfn-callback-this-value">callback this value</a>.</p>
      <p>If <var>paintFunctionCallback</var> does not complete within an acceptable time (as determined by the
user agent, i.e. it is a "long running script") the user agent <em>may</em> terminate the
script, let the image output be an <a data-link-type="dfn" href="https://drafts.csswg.org/css-images-4/#invalid-image" id="ref-for-invalid-image①⓪">invalid image</a>, and abort all these steps.</p>
      <p class="note" role="note"><span class="marker">Note:</span> User agents could provide tooling within their debugging tools to show authors how
    expensive their paint classes are. User agents could also how an "unresponsive script"
    dialog in this case if appropriate.</p>
     <li data-md>
      <p>The image output is to be produced from the <var>renderingContext</var> given to the method.</p>
      <p>If an exception is <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#dfn-throw" id="ref-for-dfn-throw⑦">thrown</a> the let the image output be an <a data-link-type="dfn" href="https://drafts.csswg.org/css-images-4/#invalid-image" id="ref-for-invalid-image①①">invalid image</a>.</p>
    </ol>
    <p class="note" role="note"><span class="marker">Note:</span> The contents of the resulting image are not designed to be accessible. Authors can communicate
    any useful information through the standard accessibility APIs.</p>
   </div>
   <h3 class="heading settled" data-level="7.1" id="global-scope-selection"><span class="secno">7.1. </span><span class="content">Global Scope Selection</span><a class="self-link" href="#global-scope-selection"></a></h3>
   <p>When the user agent needs to select a <code class="idl"><a data-link-type="idl" href="#paintworkletglobalscope" id="ref-for-paintworkletglobalscope⑨">PaintWorkletGlobalScope</a></code> from the paint <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/worklets.html#worklet" id="ref-for-worklet⑤">Worklet</a></code>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/worklets.html#concept-worklet-global-scopes" id="ref-for-concept-worklet-global-scopes①">global scopes</a> <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list⑤">list</a> it <em>must</em>:</p>
   <ul>
    <li data-md>
     <p>Select from at <em>least</em> two <code class="idl"><a data-link-type="idl" href="#paintworkletglobalscope" id="ref-for-paintworkletglobalscope①⓪">PaintWorkletGlobalScope</a></code>s, unless the user agent is under
memory constraints.</p>
    <li data-md>
     <p><em>Not</em> re-use the same <code class="idl"><a data-link-type="idl" href="#paintworkletglobalscope" id="ref-for-paintworkletglobalscope①①">PaintWorkletGlobalScope</a></code> more than 1000 times in a row.</p>
     <p class="note" role="note"><span class="marker">Note:</span> The 1000 limit was picked as a high upper bound, this limit may improve (downwards)
    over time.</p>
   </ul>
   <p class="note" role="note"><span class="marker">Note:</span> These rules exist to ensure that authors do not rely on being able to store state on the
    global object or non-regeneratable state on the class. See <a href="https://html.spec.whatwg.org/multipage/worklets.html#worklets-idempotent">the
    discussion in the worklets specification about code idempotence</a>.</p>
   <h2 class="heading settled" data-level="8" id="examples"><span class="secno">8. </span><span class="content">Examples</span><a class="self-link" href="#examples"></a></h2>
   <h3 class="heading settled" data-level="8.1" id="example-1"><span class="secno">8.1. </span><span class="content">Example 1: Colored Circle</span><a class="self-link" href="#example-1"></a></h3>
   <p>The example below makes use of the fact that <a class="production css" data-link-type="function" href="#funcdef-paint" id="ref-for-funcdef-paint①①">&lt;paint()></a> functions are able to be animated. E.g.
when the textarea is focused in the example below, the <code>--circle-color</code> property will
transition from <code>deepskyblue</code> to <code>purple</code>.</p>
   <p>This ability isn’t limited to just transitions, it also applies to CSS animations, and the Web
Animations API.</p>
<pre class="lang-markup highlight"><c- cp>&lt;!DOCTYPE html></c->
<c- p>&lt;</c-><c- f>style</c-><c- p>></c->
  <c- p>#</c-><c- nn>example</c-> <c- p>{</c->
    <c- g>--circle-color</c-><c- p>:</c-> <c- kc>deepskyblue</c-><c- p>;</c->

    <c- k>background-image</c-><c- p>:</c-> <c- nf>paint</c-><c- p>(</c-><c- kc>circle</c-><c- p>);</c->
    <c- k>font-family</c-><c- p>:</c-> <c- kc>sans-serif</c-><c- p>;</c->
    <c- k>font-size</c-><c- p>:</c-> <c- mi>36</c-><c- b>px</c-><c- p>;</c->
    <c- k>transition</c-><c- p>:</c-> <c- o>--</c-><c- kc>circle</c-><c- o>-</c-><c- kc>color</c-> <c- mi>1</c-><c- b>s</c-><c- p>;</c->
  <c- p>}</c->

  <c- p>#</c-><c- nn>example</c-><c- p>:</c-><c- nd>focus</c-> <c- p>{</c->
    <c- g>--circle-color</c-><c- p>:</c-> <c- kc>purple</c-><c- p>;</c->
  <c- p>}</c->
<c- p>&lt;/</c-><c- f>style</c-><c- p>></c->

<c- p>&lt;</c-><c- f>textarea</c-> <c- e>id</c-><c- o>=</c-><c- s>"example"</c-><c- p>></c->
  CSS is awesome.
<c- p>&lt;/</c-><c- f>textarea</c-><c- p>></c->

<c- p>&lt;</c-><c- f>script</c-><c- p>></c->
    CSS<c- p>.</c->registerProperty<c- p>({</c->
      name<c- o>:</c-> <c- t>'--circle-color'</c-><c- p>,</c->
      syntax<c- o>:</c-> <c- t>'&lt;color>'</c-><c- p>,</c->
      initialValue<c- o>:</c-> <c- t>'black'</c-><c- p>,</c->
      inherits<c- o>:</c-> <c- kc>false</c->
    <c- p>});</c->
    CSS<c- p>.</c->paintWorklet<c- p>.</c->addModule<c- p>(</c-><c- t>'circle.js'</c-><c- p>);</c->
<c- p>&lt;/</c-><c- f>script</c-><c- p>></c->
</pre>
<pre class="lang-javascript highlight"><c- c1>// circle.js</c->
registerPaint<c- p>(</c-><c- t>'circle'</c-><c- p>,</c-> <c- a>class</c-> <c- p>{</c->
  <c- k>static</c-> get inputProperties<c- p>()</c-> <c- p>{</c-> <c- k>return</c-> <c- p>[</c-><c- t>'--circle-color'</c-><c- p>];</c-> <c- p>}</c->
  paint<c- p>(</c->ctx<c- p>,</c-> geom<c- p>,</c-> properties<c- p>)</c-> <c- p>{</c->
    <c- c1>// Change the fill color.</c->
    <c- a>const</c-> color <c- o>=</c-> properties<c- p>.</c->get<c- p>(</c-><c- t>'--circle-color'</c-><c- p>);</c->
    ctx<c- p>.</c->fillStyle <c- o>=</c-> color<c- p>.</c->cssText<c- p>;</c->

    <c- c1>// Determine the center point and radius.</c->
    <c- a>const</c-> x <c- o>=</c-> geom<c- p>.</c->width <c- o>/</c-> <c- mf>2</c-><c- p>;</c->
    <c- a>const</c-> y <c- o>=</c-> geom<c- p>.</c->height <c- o>/</c-> <c- mf>2</c-><c- p>;</c->
    <c- a>const</c-> radius <c- o>=</c-> Math<c- p>.</c->min<c- p>(</c->x<c- p>,</c-> y<c- p>);</c->

    <c- c1>// Draw the circle \o/</c->
    ctx<c- p>.</c->beginPath<c- p>();</c->
    ctx<c- p>.</c->arc<c- p>(</c->x<c- p>,</c-> y<c- p>,</c-> radius<c- p>,</c-> <c- mf>0</c-><c- p>,</c-> <c- mf>2</c-> <c- o>*</c-> Math<c- p>.</c->PI<c- p>,</c-> <c- kc>false</c-><c- p>);</c->
    ctx<c- p>.</c->fill<c- p>();</c->
  <c- p>}</c->
<c- p>});</c->
</pre>
   <h3 class="heading settled" data-level="8.2" id="example-2"><span class="secno">8.2. </span><span class="content">Example 2: Image Placeholder</span><a class="self-link" href="#example-2"></a></h3>
   <p>It is possible for an author to use paint to draw a placeholder image while an image is being
loaded.</p>
<pre class="lang-markup highlight"><c- cp>&lt;!DOCTYPE html></c->
<c- p>&lt;</c-><c- f>style</c-><c- p>></c->
<c- p>#</c-><c- nn>example</c-> <c- p>{</c->
    <c- g>--image</c-><c- p>:</c-> url<c- p>(</c-><c- t>'#someUrlWhichIsLoading'</c-><c- p>);</c->
    <c- k>background-image</c-><c- p>:</c-> <c- nf>paint</c-><c- p>(</c-><c- n>image</c-><c- g>-with-placeholder</c-><c- p>);</c->
<c- p>}</c->
<c- p>&lt;/</c-><c- f>style</c-><c- p>></c->

<c- p>&lt;</c-><c- f>div</c-> <c- e>id</c-><c- o>=</c-><c- s>"example"</c-><c- p>>&lt;/</c-><c- f>div</c-><c- p>></c->

<c- p>&lt;</c-><c- f>script</c-><c- p>></c->
    CSS<c- p>.</c->registerProperty<c- p>({</c->
        name<c- o>:</c-> <c- t>'--image'</c-><c- p>,</c->
        syntax<c- o>:</c-> <c- t>'&lt;image> | none'</c-><c- p>,</c->
        initialValue<c- o>:</c-> <c- t>'none'</c-><c- p>,</c->
    <c- p>});</c->
    CSS<c- p>.</c->paintWorklet<c- p>.</c->addModule<c- p>(</c-><c- t>'image-placeholder.js'</c-><c- p>);</c->
<c- p>&lt;/</c-><c- f>script</c-><c- p>></c->
</pre>
<pre class="lang-javascript highlight"><c- c1>// image-placeholder.js</c->
registerPaint<c- p>(</c-><c- t>'image-with-placeholder'</c-><c- p>,</c-> <c- a>class</c-> <c- p>{</c->
    <c- k>static</c-> get inputProperties<c- p>()</c-> <c- p>{</c-> <c- k>return</c-> <c- p>[</c-><c- t>'--image'</c-><c- p>];</c-> <c- p>}</c->
    paint<c- p>(</c->ctx<c- p>,</c-> geom<c- p>,</c-> properties<c- p>)</c-> <c- p>{</c->
        <c- a>const</c-> img <c- o>=</c-> properties<c- p>.</c->get<c- p>(</c-><c- t>'--image'</c-><c- p>);</c->

        <c- k>switch</c-> <c- p>(</c->img<c- p>.</c->state<c- p>)</c-> <c- p>{</c->
            <c- k>case</c-> <c- t>'ready'</c-><c- o>:</c->
                <c- c1>// The image is loaded! Draw the image.</c->
                ctx<c- p>.</c->drawImage<c- p>(</c->img<c- p>,</c-> <c- mf>0</c-><c- p>,</c-> <c- mf>0</c-><c- p>,</c-> geom<c- p>.</c->width<c- p>,</c-> geom<c- p>.</c->height<c- p>);</c->
                <c- k>break</c-><c- p>;</c->
            <c- k>case</c-> <c- t>'pending'</c-><c- o>:</c->
                <c- c1>// The image is loading, draw some mountains.</c->
                drawMountains<c- p>(</c->ctx<c- p>);</c->
                <c- k>break</c-><c- p>;</c->
            <c- k>case</c-> <c- t>'invalid'</c-><c- o>:</c->
            <c- k>default</c-><c- o>:</c->
                <c- c1>// The image is invalid (e.g. it didn’t load), draw a sad face.</c->
                drawSadFace<c- p>(</c->ctx<c- p>);</c->
                <c- k>break</c-><c- p>;</c->
        <c- p>}</c->
    <c- p>}</c->
<c- p>});</c->
</pre>
   <h3 class="heading settled" data-level="8.3" id="example-3"><span class="secno">8.3. </span><span class="content">Example 3: Arcs</span><a class="self-link" href="#example-3"></a></h3>
<pre class="lang-markup highlight"><c- cp>&lt;!DOCTYPE html></c->
<c- p>&lt;</c-><c- f>style</c-><c- p>></c->
<c- p>#</c-><c- nn>example</c-> <c- p>{</c->
  <c- k>width</c-><c- p>:</c-> <c- mi>200</c-><c- b>px</c-><c- p>;</c->
  <c- k>height</c-><c- p>:</c-> <c- mi>200</c-><c- b>px</c-><c- p>;</c->

  <c- k>background-image</c-><c- p>:</c->
    <c- nf>paint</c-><c- p>(</c-><c- n>arc</c-><c- p>,</c-> <c- kc>purple</c-><c- p>,</c-> <c- mf>0.4</c-><c- b>turn</c-><c- p>,</c-> <c- mf>0.8</c-><c- b>turn</c-><c- p>,</c-> <c- mi>40</c-><c- b>px</c-><c- p>,</c-> <c- mi>15</c-><c- b>px</c-><c- p>),</c->
    <c- nf>paint</c-><c- p>(</c-><c- n>arc</c-><c- p>,</c-> <c- kc>blue</c-><c- p>,</c-> <c- mi>-20</c-><c- b>deg</c-><c- p>,</c-> <c- mi>170</c-><c- b>deg</c-><c- p>,</c-> <c- mi>30</c-><c- b>px</c-><c- p>,</c-> <c- mi>20</c-><c- b>px</c-><c- p>),</c->
    <c- nf>paint</c-><c- p>(</c-><c- n>arc</c-><c- p>,</c-> <c- kc>red</c-><c- p>,</c-> <c- mi>45</c-><c- b>deg</c-><c- p>,</c-> <c- mi>220</c-><c- b>deg</c-><c- p>,</c-> <c- mi>50</c-><c- b>px</c-><c- p>,</c-> <c- mi>10</c-><c- b>px</c-><c- p>);</c->
<c- p>}</c->
<c- p>&lt;/</c-><c- f>style</c-><c- p>></c->

<c- p>&lt;</c-><c- f>div</c-> <c- e>id</c-><c- o>=</c-><c- s>"example"</c-><c- p>>&lt;/</c-><c- f>div</c-><c- p>></c->

<c- p>&lt;</c-><c- f>script</c-><c- p>></c->
    CSS<c- p>.</c->paintWorklet<c- p>.</c->addModule<c- p>(</c-><c- t>'arc.js'</c-><c- p>);</c->
<c- p>&lt;/</c-><c- f>script</c-><c- p>></c->
</pre>
<pre class="lang-javascript highlight"><c- c1>// arc.js</c->
registerPaint<c- p>(</c-><c- t>'arc'</c-><c- p>,</c-> <c- a>class</c-> <c- p>{</c->
  <c- k>static</c-> get inputArguments<c- p>()</c-> <c- p>{</c->
    <c- k>return</c-> <c- p>[</c->
      <c- t>'&lt;color>'</c-><c- p>,</c->
      <c- t>'&lt;angle>'</c-><c- p>,</c->  <c- c1>// startAngle</c->
      <c- t>'&lt;angle>'</c-><c- p>,</c->  <c- c1>// endAngle</c->
      <c- t>'&lt;length>'</c-><c- p>,</c-> <c- c1>// radius</c->
      <c- t>'&lt;length>'</c-><c- p>,</c-> <c- c1>// lineWidth</c->
    <c- p>];</c->
  <c- p>}</c->

  paint<c- p>(</c->ctx<c- p>,</c-> geom<c- p>,</c-> _<c- p>,</c-> args<c- p>)</c-> <c- p>{</c->
    ctx<c- p>.</c->strokeStyle <c- o>=</c-> args<c- p>[</c-><c- mf>0</c-><c- p>].</c->cssText<c- p>;</c->

    <c- c1>// Determine the center point.</c->
    <c- a>const</c-> x <c- o>=</c-> geom<c- p>.</c->width <c- o>/</c-> <c- mf>2</c-><c- p>;</c->
    <c- a>const</c-> y <c- o>=</c-> geom<c- p>.</c->height <c- o>/</c-> <c- mf>2</c-><c- p>;</c->

    <c- c1>// Convert the start and end angles to radians.</c->
    <c- a>const</c-> startAngle <c- o>=</c-> <c- k>this</c-><c- p>.</c->convertAngle<c- p>(</c->args<c- p>[</c-><c- mf>1</c-><c- p>])</c-> <c- o>-</c-> Math<c- p>.</c->PI <c- o>/</c-> <c- mf>2</c-><c- p>;</c->
    <c- a>const</c-> endAngle <c- o>=</c-> <c- k>this</c-><c- p>.</c->convertAngle<c- p>(</c->args<c- p>[</c-><c- mf>2</c-><c- p>])</c-> <c- o>-</c-> Math<c- p>.</c->PI <c- o>/</c-> <c- mf>2</c-><c- p>;</c->

    <c- c1>// Convert the radius and lineWidth to px.</c->
    <c- a>const</c-> radius <c- o>=</c-> <c- k>this</c-><c- p>.</c->convertLength<c- p>(</c->args<c- p>[</c-><c- mf>3</c-><c- p>]);</c->
    <c- a>const</c-> lineWidth <c- o>=</c-> <c- k>this</c-><c- p>.</c->convertLength<c- p>(</c->args<c- p>[</c-><c- mf>4</c-><c- p>]);</c->

    ctx<c- p>.</c->lineWidth <c- o>=</c-> lineWidth<c- p>;</c->

    ctx<c- p>.</c->beginPath<c- p>();</c->
    ctx<c- p>.</c->arc<c- p>(</c->x<c- p>,</c-> y<c- p>,</c-> radius<c- p>,</c-> startAngle<c- p>,</c-> endAngle<c- p>,</c-> <c- kc>false</c-><c- p>);</c->
    ctx<c- p>.</c->stroke<c- p>();</c->
  <c- p>}</c->

  convertAngle<c- p>(</c->angle<c- p>)</c-> <c- p>{</c->
    <c- k>switch</c-> <c- p>(</c->angle<c- p>.</c->unit<c- p>)</c-> <c- p>{</c->
      <c- k>case</c-> <c- t>'deg'</c-><c- o>:</c->
        <c- k>return</c-> angle<c- p>.</c->value <c- o>*</c-> Math<c- p>.</c->PI <c- o>/</c-> <c- mf>180</c-><c- p>;</c->
      <c- k>case</c-> <c- t>'rad'</c-><c- o>:</c->
        <c- k>return</c-> angle<c- p>.</c->value<c- p>;</c->
      <c- k>case</c-> <c- t>'grad'</c-><c- o>:</c->
        <c- k>return</c-> angle<c- p>.</c->value <c- o>*</c-> Math<c- p>.</c->PI <c- o>/</c-> <c- mf>200</c-><c- p>;</c->
      <c- k>case</c-> <c- t>'turn'</c-><c- o>:</c->
        <c- k>return</c-> angle<c- p>.</c->value <c- o>*</c-> Math<c- p>.</c->PI <c- o>/</c-> <c- mf>0.5</c-><c- p>;</c->
      <c- k>default</c-><c- o>:</c->
        <c- k>throw</c-> <c- ne>Error</c-><c- p>(</c-><c- sb>`Unknown angle unit: </c-><c- si>${</c->angle<c- p>.</c->unit<c- si>}</c-><c- sb>`</c-><c- p>);</c->
    <c- p>}</c->
  <c- p>}</c->

  convertLength<c- p>(</c->length<c- p>)</c-> <c- p>{</c->
    <c- k>switch</c-> <c- p>(</c->length<c- p>.</c->type<c- p>)</c-> <c- p>{</c->
      <c- k>case</c-> <c- t>'px'</c-><c- o>:</c->
        <c- k>return</c-> length<c- p>.</c->value<c- p>;</c->
      <c- k>default</c-><c- o>:</c->
        <c- k>throw</c-> <c- ne>Error</c-><c- p>(</c-><c- sb>`Unkown length type: </c-><c- si>${</c->length<c- p>.</c->type<c- si>}</c-><c- sb>`</c-><c- p>);</c->
    <c- p>}</c->
  <c- p>}</c->
<c- p>});</c->
</pre>
   <h3 class="heading settled" data-level="8.4" id="example-4"><span class="secno">8.4. </span><span class="content">Example 4: Different Colors (based on size)</span><a class="self-link" href="#example-4"></a></h3>
<pre class="lang-markup highlight"><c- p>&lt;</c-><c- f>h1</c-><c- p>></c->
    Heading 1
<c- p>&lt;/</c-><c- f>h1</c-><c- p>></c->
<c- p>&lt;</c-><c- f>h1</c-><c- p>></c->
    Another heading
<c- p>&lt;/</c-><c- f>h1</c-><c- p>></c->

<c- p>&lt;</c-><c- f>style</c-><c- p>></c->
<c- f>h1</c-> <c- p>{</c->
    <c- k>background-image</c-><c- p>:</c-> <c- nf>paint</c-><c- p>(</c-><c- n>heading</c-><c- g>-color</c-><c- p>);</c->
<c- p>}</c->
<c- p>&lt;/</c-><c- f>style</c-><c- p>></c->

<c- p>&lt;</c-><c- f>script</c-><c- p>></c->
    CSS<c- p>.</c->paintWorklet<c- p>.</c->addModule<c- p>(</c-><c- t>'heading-color.js'</c-><c- p>);</c->
<c- p>&lt;/</c-><c- f>script</c-><c- p>></c->
</pre>
<pre class="lang-javascript highlight"><c- c1>// heading-color.js</c->
registerPaint<c- p>(</c-><c- t>'heading-color'</c-><c- p>,</c-> <c- a>class</c-> <c- p>{</c->
    <c- k>static</c-> get inputProperties<c- p>()</c-> <c- p>{</c-> <c- k>return</c-> <c- p>[];</c-> <c- p>}</c->
    paint<c- p>(</c->ctx<c- p>,</c-> geom<c- p>,</c-> properties<c- p>)</c-> <c- p>{</c->
        <c- c1>// Select a color based on the width and height of the image.</c->
        <c- a>const</c-> width <c- o>=</c-> geom<c- p>.</c->width<c- p>;</c->
        <c- a>const</c-> height <c- o>=</c-> geom<c- p>.</c->height<c- p>;</c->
        <c- a>const</c-> color <c- o>=</c-> colorArray<c- p>[(</c->width <c- o>*</c-> height<c- p>)</c-> <c- o>%</c-> colorArray<c- p>.</c->length<c- p>];</c->

        <c- c1>// Draw just a solid image.</c->
        ctx<c- p>.</c->fillStyle <c- o>=</c-> color<c- p>;</c->
        ctx<c- p>.</c->fillRect<c- p>(</c-><c- mf>0</c-><c- p>,</c-> <c- mf>0</c-><c- p>,</c-> width<c- p>,</c-> height<c- p>);</c->
    <c- p>}</c->
<c- p>});</c->
</pre>
   <h3 class="heading settled" data-level="8.5" id="example-5"><span class="secno">8.5. </span><span class="content">Example 5: Drawing outside an element’s area</span><a class="self-link" href="#example-5"></a></h3>
   <p>It is possible to draw outside an element’s area by using the <a class="property css" data-link-type="property" href="https://drafts.csswg.org/css-backgrounds-3/#propdef-border-image" id="ref-for-propdef-border-image">border-image</a> property.</p>
<pre class="lang-markup highlight"><c- p>&lt;</c-><c- f>style</c-><c- p>></c->
<c- p>#</c-><c- nn>overdraw</c-> <c- p>{</c->
    <c- g>--border-width</c-><c- p>:</c-> <c- mi>10</c-><c- p>;</c->

    <c- k>border-style</c-><c- p>:</c-> <c- kc>solid</c-><c- p>;</c->
    <c- k>border-width</c-><c- p>:</c-> calc<c- p>(</c-><c- nf>var</c-><c- p>(</c-><c- g>--border-width</c-><c- p>)</c-> <c- o>*</c-> <c- mi>1</c-><c- b>px</c-><c- p>);</c->

    <c- k>border-image-source</c-><c- p>:</c-> <c- nf>paint</c-><c- p>(</c-><c- n>overdraw</c-><c- p>);</c->
    <c- k>border-image-slice</c-><c- p>:</c-> <c- mi>0</c-> <c- kc>fill</c-><c- p>;</c->
    <c- k>border-image-outset</c-><c- p>:</c-> calc<c- p>(</c-><c- nf>var</c-><c- p>(</c-><c- g>--border-width</c-><c- p>)</c-> <c- o>*</c-> <c- mi>1</c-><c- b>px</c-><c- p>);</c->

    <c- k>width</c-><c- p>:</c-> <c- mi>200</c-><c- b>px</c-><c- p>;</c->
    <c- k>height</c-><c- p>:</c-> <c- mi>200</c-><c- b>px</c-><c- p>;</c->
<c- p>}</c->
<c- p>&lt;/</c-><c- f>style</c-><c- p>></c->
<c- p>&lt;</c-><c- f>div</c-> <c- e>id</c-><c- o>=</c-><c- s>"overdraw"</c-><c- p>>&lt;/</c-><c- f>div</c-><c- p>></c->
<c- p>&lt;</c-><c- f>script</c-><c- p>></c->
    CSS<c- p>.</c->paintWorklet<c- p>.</c->addModule<c- p>(</c-><c- t>'overdraw.js'</c-><c- p>);</c->
<c- p>&lt;/</c-><c- f>script</c-><c- p>></c->
</pre>
<pre class="lang-javascript highlight"><c- c1>// overdraw.js</c->
registerPaint<c- p>(</c-><c- t>'overdraw'</c-><c- p>,</c-> <c- a>class</c-> <c- p>{</c->
    <c- k>static</c-> get inputProperties<c- p>()</c-> <c- p>{</c-> <c- k>return</c-> <c- p>[</c-><c- t>'--border-width'</c-><c- p>];</c-> <c- p>}</c->
    paint<c- p>(</c->ctx<c- p>,</c-> geom<c- p>,</c-> properties<c- p>)</c-> <c- p>{</c->
        <c- a>const</c-> borderWidth <c- o>=</c-> parseInt<c- p>(</c->properties<c- p>.</c->get<c- p>(</c-><c- t>'--border-width'</c-><c- p>));</c->
        ctx<c- p>.</c->shadowColor <c- o>=</c-> <c- t>'rgba(0,0,0,0.25)'</c-><c- p>;</c->
        ctx<c- p>.</c->shadowBlur <c- o>=</c-> borderWidth<c- p>;</c->

        ctx<c- p>.</c->fillStyle <c- o>=</c-> <c- t>'rgba(255, 255, 255, 1)'</c-><c- p>;</c->
        ctx<c- p>.</c->fillRect<c- p>(</c->borderWidth<c- p>,</c->
                     borderWidth<c- p>,</c->
                     geom<c- p>.</c->width <c- o>-</c-> <c- mf>2</c-> <c- o>*</c-> borderWidth<c- p>,</c->
                     geom<c- p>.</c->height <c- o>-</c-> <c- mf>2</c-> <c- o>*</c-> borderWidth<c- p>);</c->
    <c- p>}</c->
<c- p>});</c->
</pre>
   <h2 class="heading settled" data-level="9" id="security-considerations"><span class="secno">9. </span><span class="content">Security Considerations</span><a class="self-link" href="#security-considerations"></a></h2>
   <p>There are no known security issues introduced by these features.</p>
   <h2 class="heading settled" data-level="10" id="privacy-considerations"><span class="secno">10. </span><span class="content">Privacy Considerations</span><a class="self-link" href="#privacy-considerations"></a></h2>
   <ul>
    <li data-md>
     <p>The timing of paint callbacks can be used as a high-bandwidth channel for detecting "visited" state for links.
(<a href="https://github.com/w3c/css-houdini-drafts/issues/791">details</a>)
This is not a fundamentally new privacy leak,
as visited state leaks from many interactions,
but absent any further mitigations,
this is a particularly high-bandwidth channel of the information.</p>
     <p>No official mitigations are planned at this time,
as this privacy leak needs to be addressed more directly
to fix all such channels.</p>
   </ul>
   <h2 class="heading settled" data-level="11" id="changes"><span class="secno">11. </span><span class="content">Changes</span><a class="self-link" href="#changes"></a></h2>
   <p>Changes since the <a href="https://www.w3.org/TR/2018/CR-css-paint-api-1-20180809/">9 August 2018 CR publication</a>:</p>
   <ul>
    <li data-md>
     <p>Filtered the list of input properties to a paint worklet to be only known or custom properties.</p>
    <li data-md>
     <p>Added alpha flag to <code class="idl"><a data-link-type="idl" href="#paintrenderingcontext2d" id="ref-for-paintrenderingcontext2d①⑨">PaintRenderingContext2D</a></code> to control whether the rendering surface is forced opaque or allows transparency.</p>
    <li data-md>
     <p>Fix definition for the size of the output bitmap:</p>
     <blockquote>
      <p>
       The size of the output bitmap is the 
       <ins>concrete object size of the object it is rendering to</ins>
       <del>size of the fragment it is rendering</del>
       .
      </p>
     </blockquote>
   </ul>
  </main>
  <h2 class="no-ref no-num heading settled" id="w3c-conformance"><span class="content"> Conformance</span><a class="self-link" href="#w3c-conformance"></a></h2>
  <h3 class="no-ref heading settled" id="w3c-conventions"><span class="content"> Document conventions</span><a class="self-link" href="#w3c-conventions"></a></h3>
  <p>Conformance requirements are expressed with a combination of
    descriptive assertions and RFC 2119 terminology. The key words “MUST”,
    “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”,
    “RECOMMENDED”, “MAY”, and “OPTIONAL” in the normative parts of this
    document are to be interpreted as described in RFC 2119.
    However, for readability, these words do not appear in all uppercase
    letters in this specification. </p>
  <p>All of the text of this specification is normative except sections
    explicitly marked as non-normative, examples, and notes. <a data-link-type="biblio" href="#biblio-rfc2119" title="Key words for use in RFCs to Indicate Requirement Levels">[RFC2119]</a></p>
  <p>Examples in this specification are introduced with the words “for example”
    or are set apart from the normative text with <code>class="example"</code>,
    like this: </p>
  <div class="example" id="example-ae2b6bc0">
   <a class="self-link" href="#example-ae2b6bc0"></a> 
   <p>This is an example of an informative example.</p>
  </div>
  <p>Informative notes begin with the word “Note” and are set apart from the
    normative text with <code>class="note"</code>, like this: </p>
  <p class="note" role="note">Note, this is an informative note.</p>
  <p>Advisements are normative sections styled to evoke special attention and are
    set apart from other normative text with <code>&lt;strong class="advisement"></code>, like
    this: <strong class="advisement"> UAs MUST provide an accessible alternative. </strong></p>
  <h3 class="no-ref heading settled" id="w3c-conformance-classes"><span class="content"> Conformance classes</span><a class="self-link" href="#w3c-conformance-classes"></a></h3>
  <p>Conformance to this specification
    is defined for three conformance classes: </p>
  <dl>
   <dt>style sheet 
   <dd>A <a href="http://www.w3.org/TR/CSS21/conform.html#style-sheet">CSS
            style sheet</a>. 
   <dt>renderer 
   <dd>A <a href="http://www.w3.org/TR/CSS21/conform.html#user-agent">UA</a> that interprets the semantics of a style sheet and renders
            documents that use them. 
   <dt>authoring tool 
   <dd>A <a href="http://www.w3.org/TR/CSS21/conform.html#user-agent">UA</a> that writes a style sheet. 
  </dl>
  <p>A style sheet is conformant to this specification
    if all of its statements that use syntax defined in this module are valid
    according to the generic CSS grammar and the individual grammars of each
    feature defined in this module. </p>
  <p>A renderer is conformant to this specification
    if, in addition to interpreting the style sheet as defined by the
    appropriate specifications, it supports all the features defined
    by this specification by parsing them correctly
    and rendering the document accordingly. However, the inability of a
    UA to correctly render a document due to limitations of the device
    does not make the UA non-conformant. (For example, a UA is not
    required to render color on a monochrome monitor.) </p>
  <p>An authoring tool is conformant to this specification
    if it writes style sheets that are syntactically correct according to the
    generic CSS grammar and the individual grammars of each feature in
    this module, and meet all other conformance requirements of style sheets
    as described in this module. </p>
  <h3 class="no-ref heading settled" id="w3c-partial"><span class="content"> Partial implementations</span><a class="self-link" href="#w3c-partial"></a></h3>
  <p>So that authors can exploit the forward-compatible parsing rules to
    assign fallback values, CSS renderers <strong>must</strong> treat as invalid (and <a href="http://www.w3.org/TR/CSS21/conform.html#ignore">ignore
    as appropriate</a>) any at-rules, properties, property values, keywords,
    and other syntactic constructs for which they have no usable level of
    support. In particular, user agents <strong>must not</strong> selectively
    ignore unsupported component values and honor supported values in a single
    multi-value property declaration: if any value is considered invalid
    (as unsupported values must be), CSS requires that the entire declaration
    be ignored.</p>
  <h4 class="heading settled" id="w3c-conform-future-proofing"><span class="content"> Implementations of Unstable and Proprietary Features</span><a class="self-link" href="#w3c-conform-future-proofing"></a></h4>
  <p>To avoid clashes with future stable CSS features,
        the CSSWG recommends <a href="http://www.w3.org/TR/CSS/#future-proofing">following best practices</a> for the implementation of <a href="http://www.w3.org/TR/CSS/#unstable">unstable</a> features and <a href="http://www.w3.org/TR/CSS/#proprietary-extension">proprietary extensions</a> to CSS. </p>
  <h3 class="no-ref heading settled" id="w3c-testing"><span class="content"> Non-experimental implementations</span><a class="self-link" href="#w3c-testing"></a></h3>
  <p>Once a specification reaches the Candidate Recommendation stage,
    non-experimental implementations are possible, and implementors should
    release an unprefixed implementation of any CR-level feature they
    can demonstrate to be correctly implemented according to spec. </p>
  <p>To establish and maintain the interoperability of CSS across
    implementations, the CSS Working Group requests that non-experimental
    CSS renderers submit an implementation report (and, if necessary, the
    testcases used for that implementation report) to the W3C before
    releasing an unprefixed implementation of any CSS features. Testcases
    submitted to W3C are subject to review and correction by the CSS
    Working Group. </p>
  <p>Further information on submitting testcases and implementation reports
    can be found from on the CSS Working Group’s website at <a href="http://www.w3.org/Style/CSS/Test/">http://www.w3.org/Style/CSS/Test/</a>.
    Questions should be directed to the <a href="http://lists.w3.org/Archives/Public/public-css-testsuite">public-css-testsuite@w3.org</a> mailing list.</p>
  <script src="https://www.w3.org/scripts/TR/2021/fixup.js"></script>
  <h2 class="no-num no-ref heading settled" id="index"><span class="content">Index</span><a class="self-link" href="#index"></a></h2>
  <h3 class="no-num no-ref heading settled" id="index-defined-here"><span class="content">Terms defined by this specification</span><a class="self-link" href="#index-defined-here"></a></h3>
  <ul class="index">
   <li>
    alpha
    <ul>
     <li><a href="#paintrenderingcontext2d-alpha">dfn for PaintRenderingContext2D</a><span>, in § 6</span>
     <li><a href="#dom-paintrenderingcontext2dsettings-alpha">dict-member for PaintRenderingContext2DSettings</a><span>, in § 2</span>
    </ul>
   <li><a href="#paint-definition-class-constructor">class constructor</a><span>, in § 3</span>
   <li><a href="#paint-definition-constructor-valid-flag">constructor valid flag</a><span>, in § 3</span>
   <li><a href="#create-a-paintrenderingcontext2d-object">create a PaintRenderingContext2D object</a><span>, in § 6</span>
   <li><a href="#dom-paintworkletglobalscope-devicepixelratio">devicePixelRatio</a><span>, in § 2</span>
   <li><a href="#document-paint-definition">document paint definition</a><span>, in § 3</span>
   <li><a href="#document-paint-definitions">document paint definitions</a><span>, in § 4</span>
   <li><a href="#draw-a-paint-image">draw a paint image</a><span>, in § 7</span>
   <li><a href="#dom-paintsize-height">height</a><span>, in § 7</span>
   <li><a href="#document-paint-definition-input-argument-syntaxes">input argument syntaxes</a><span>, in § 3</span>
   <li>
    input properties
    <ul>
     <li><a href="#document-paint-definition-input-properties">dfn for document paint definition</a><span>, in § 3</span>
     <li><a href="#paint-definition-input-properties">dfn for paint definition</a><span>, in § 3</span>
    </ul>
   <li><a href="#invoke-a-paint-callback">invoke a paint callback</a><span>, in § 7</span>
   <li><a href="#paintrenderingcontext2d-output-bitmap">output bitmap</a><span>, in § 6</span>
   <li><a href="#funcdef-paint">paint()</a><span>, in § 5</span>
   <li><a href="#paint-class-instances">paint class instances</a><span>, in § 4</span>
   <li><a href="#paint-definition">paint definition</a><span>, in § 3</span>
   <li><a href="#paint-definitions">paint definitions</a><span>, in § 4</span>
   <li><a href="#paint-definition-paint-function">paint function</a><span>, in § 3</span>
   <li><a href="#paintrenderingcontext2d">PaintRenderingContext2D</a><span>, in § 6</span>
   <li><a href="#dictdef-paintrenderingcontext2dsettings">PaintRenderingContext2DSettings</a><span>, in § 2</span>
   <li>
    PaintRenderingContext2DSettings object
    <ul>
     <li><a href="#document-paint-definition-paintrenderingcontext2dsettings-object">dfn for document paint definition</a><span>, in § 3</span>
     <li><a href="#paint-definition-paintrenderingcontext2dsettings-object">dfn for paint definition</a><span>, in § 3</span>
    </ul>
   <li><a href="#paintsize">PaintSize</a><span>, in § 7</span>
   <li><a href="#dom-css-paintworklet">paintWorklet</a><span>, in § 2</span>
   <li><a href="#paintworkletglobalscope">PaintWorkletGlobalScope</a><span>, in § 2</span>
   <li><a href="#dom-paintworkletglobalscope-registerpaint">registerPaint(name, paintCtor)</a><span>, in § 4</span>
   <li><a href="#dom-paintsize-width">width</a><span>, in § 7</span>
  </ul>
  <h3 class="no-num no-ref heading settled" id="index-defined-elsewhere"><span class="content">Terms defined by reference</span><a class="self-link" href="#index-defined-elsewhere"></a></h3>
  <ul class="index">
   <li>
    <a data-link-type="biblio">[]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="5b322f88">construct</span>
     <li><span class="dfn-paneled" id="b181fb6a">constructor</span>
     <li><span class="dfn-paneled" id="6aabef20">get</span>
     <li><span class="dfn-paneled" id="d56bd241">isconstructor</span>
     <li><span class="dfn-paneled" id="c4df1374">type</span>
     <li><span class="dfn-paneled" id="4739df91">typeerror</span>
    </ul>
   <li>
    <a data-link-type="biblio">[CSS-BACKGROUNDS-3]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="a4cd8a8d">border-image</span>
    </ul>
   <li>
    <a data-link-type="biblio">[CSS-CASCADE-5]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="9cd25054">computed value</span>
    </ul>
   <li>
    <a data-link-type="biblio">[CSS-DISPLAY-4]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="881c2f72">box</span>
    </ul>
   <li>
    <a data-link-type="biblio">[CSS-IMAGES-3]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="998b9e6e">&lt;image></span>
     <li><span class="dfn-paneled" id="1f6aa483">concrete object size</span>
     <li><span class="dfn-paneled" id="d3936525">natural dimension</span>
     <li><span class="dfn-paneled" id="ae390677">object size negotiation</span>
    </ul>
   <li>
    <a data-link-type="biblio">[CSS-IMAGES-4]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="e1b8b09d">invalid image</span>
    </ul>
   <li>
    <a data-link-type="biblio">[CSS-PROPERTIES-VALUES-API-1]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="74bf8d66">consume a syntax definition</span>
     <li><span class="dfn-paneled" id="cfb5cfc9">syntax definition</span>
    </ul>
   <li>
    <a data-link-type="biblio">[CSS-SYNTAX-3]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="8144e597">&lt;declaration-value></span>
     <li><span class="dfn-paneled" id="4650cbb8">function</span>
    </ul>
   <li>
    <a data-link-type="biblio">[CSS-TYPED-OM-1]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="4464a8c5">CSSImageValue</span>
     <li><span class="dfn-paneled" id="698cada8">StylePropertyMap</span>
     <li><span class="dfn-paneled" id="32c697dc">StylePropertyMapReadOnly</span>
    </ul>
   <li>
    <a data-link-type="biblio">[CSS-UI-4]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="647de2a6">cursor</span>
    </ul>
   <li>
    <a data-link-type="biblio">[CSS-VALUES-4]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="9f9120ff">,</span>
     <li><span class="dfn-paneled" id="9213678e">&lt;ident></span>
     <li><span class="dfn-paneled" id="537cf076">?</span>
    </ul>
   <li>
    <a data-link-type="biblio">[CSS-VARIABLES-2]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="198f1537">custom property</span>
    </ul>
   <li>
    <a data-link-type="biblio">[CSSOM-1]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="a43c62be">CSS</span>
     <li><span class="dfn-paneled" id="e11b0bf7">supported css property</span>
    </ul>
   <li>
    <a data-link-type="biblio">[CSSOM-VIEW-1]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="c0159396">devicePixelRatio</span>
    </ul>
   <li>
    <a data-link-type="biblio">[DOM]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="a973e0fe">document</span>
    </ul>
   <li>
    <a data-link-type="biblio">[HTML]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="1981495f">CanvasCompositing</span>
     <li><span class="dfn-paneled" id="448f6a24">CanvasDrawImage</span>
     <li><span class="dfn-paneled" id="70de881b">CanvasDrawPath</span>
     <li><span class="dfn-paneled" id="95a140e6">CanvasFillStrokeStyles</span>
     <li><span class="dfn-paneled" id="cec3ac11">CanvasImageData</span>
     <li><span class="dfn-paneled" id="02579ab7">CanvasImageSmoothing</span>
     <li><span class="dfn-paneled" id="1439b86e">CanvasImageSource</span>
     <li><span class="dfn-paneled" id="59551364">CanvasPath</span>
     <li><span class="dfn-paneled" id="c85add6f">CanvasPathDrawingStyles</span>
     <li><span class="dfn-paneled" id="65a2d66b">CanvasRect</span>
     <li><span class="dfn-paneled" id="8699eea2">CanvasRenderingContext2D</span>
     <li><span class="dfn-paneled" id="791149df">CanvasShadowStyles</span>
     <li><span class="dfn-paneled" id="3cb51bf6">CanvasState</span>
     <li><span class="dfn-paneled" id="d6888cc4">CanvasText</span>
     <li><span class="dfn-paneled" id="333bd5a6">CanvasTextDrawingStyles</span>
     <li><span class="dfn-paneled" id="aa310bd6">CanvasTransform</span>
     <li><span class="dfn-paneled" id="75723177">CanvasUserInterface</span>
     <li><span class="dfn-paneled" id="2879c404">Worklet</span>
     <li><span class="dfn-paneled" id="0c9b0d3c">WorkletGlobalScope</span>
     <li><span class="dfn-paneled" id="e4ffa115">create a worklet global scope</span>
     <li><span class="dfn-paneled" id="0deaf786">drawImage()</span>
     <li><span class="dfn-paneled" id="6f738b30">global scopes</span>
     <li><span class="dfn-paneled" id="a72449dd">in parallel</span>
     <li><span class="dfn-paneled" id="9a517a7d">queue a task</span>
     <li><span class="dfn-paneled" id="114b7a63">reset the rendering context to its default state</span>
     <li><span class="dfn-paneled" id="b8eed9b5">set bitmap dimensions</span>
     <li><span class="dfn-paneled" id="93252241">worklet destination type</span>
     <li><span class="dfn-paneled" id="3b8ce5a6">worklet global scope type</span>
    </ul>
   <li>
    <a data-link-type="biblio">[INFRA]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="53275e46">append</span>
     <li><span class="dfn-paneled" id="03afaf9c">empty</span>
     <li><span class="dfn-paneled" id="1243a891">exist</span>
     <li><span class="dfn-paneled" id="16d07e10">for each</span>
     <li><span class="dfn-paneled" id="527b10aa">get</span>
     <li><span class="dfn-paneled" id="649608b9">list</span>
     <li><span class="dfn-paneled" id="3fca5a9e">map</span>
     <li><span class="dfn-paneled" id="0e6b2056">set</span>
     <li><span class="dfn-paneled" id="984221ca">struct</span>
    </ul>
   <li>
    <a data-link-type="biblio">[WEBIDL]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="dca2de17">DOMException</span>
     <li><span class="dfn-paneled" id="8855a9aa">DOMString</span>
     <li><span class="dfn-paneled" id="889e932f">Exposed</span>
     <li><span class="dfn-paneled" id="7fb6fbc6">Global</span>
     <li><span class="dfn-paneled" id="cae6bf57">InvalidModificationError</span>
     <li><span class="dfn-paneled" id="a5c91173">SameObject</span>
     <li><span class="dfn-paneled" id="7004c2a7">VoidFunction</span>
     <li><span class="dfn-paneled" id="5372cca8">boolean</span>
     <li><span class="dfn-paneled" id="3ab7bf79">callback function</span>
     <li><span class="dfn-paneled" id="a9bf6bd5">callback this value</span>
     <li><span class="dfn-paneled" id="b4fb645c">converting</span>
     <li><span class="dfn-paneled" id="8c800cdf">double</span>
     <li><span class="dfn-paneled" id="10ce5f6f">invoke</span>
     <li><span class="dfn-paneled" id="b4cfa5ce">throw</span>
     <li><span class="dfn-paneled" id="5f90bbfb">undefined</span>
     <li><span class="dfn-paneled" id="11e0b87f">unrestricted double</span>
    </ul>
  </ul>
  <h2 class="no-num no-ref heading settled" id="references"><span class="content">References</span><a class="self-link" href="#references"></a></h2>
  <h3 class="no-num no-ref heading settled" id="normative"><span class="content">Normative References</span><a class="self-link" href="#normative"></a></h3>
  <dl>
   <dt id="biblio-css-backgrounds-3">[CSS-BACKGROUNDS-3]
   <dd>Elika Etemad; Brad Kemper. <a href="https://drafts.csswg.org/css-backgrounds/"><cite>CSS Backgrounds and Borders Module Level 3</cite></a>. URL: <a href="https://drafts.csswg.org/css-backgrounds/">https://drafts.csswg.org/css-backgrounds/</a>
   <dt id="biblio-css-cascade-5">[CSS-CASCADE-5]
   <dd>Elika Etemad; Miriam Suzanne; Tab Atkins Jr.. <a href="https://drafts.csswg.org/css-cascade-5/"><cite>CSS Cascading and Inheritance Level 5</cite></a>. URL: <a href="https://drafts.csswg.org/css-cascade-5/">https://drafts.csswg.org/css-cascade-5/</a>
   <dt id="biblio-css-display-4">[CSS-DISPLAY-4]
   <dd><a href="https://drafts.csswg.org/css-display-4/"><cite>CSS Display Module Level 4</cite></a>. Editor's Draft. URL: <a href="https://drafts.csswg.org/css-display-4/">https://drafts.csswg.org/css-display-4/</a>
   <dt id="biblio-css-images-3">[CSS-IMAGES-3]
   <dd>Tab Atkins Jr.; Elika Etemad; Lea Verou. <a href="https://drafts.csswg.org/css-images-3/"><cite>CSS Images Module Level 3</cite></a>. URL: <a href="https://drafts.csswg.org/css-images-3/">https://drafts.csswg.org/css-images-3/</a>
   <dt id="biblio-css-images-4">[CSS-IMAGES-4]
   <dd>Tab Atkins Jr.; Elika Etemad; Lea Verou. <a href="https://drafts.csswg.org/css-images-4/"><cite>CSS Images Module Level 4</cite></a>. URL: <a href="https://drafts.csswg.org/css-images-4/">https://drafts.csswg.org/css-images-4/</a>
   <dt id="biblio-css-properties-values-api-1">[CSS-PROPERTIES-VALUES-API-1]
   <dd>Tab Atkins Jr.; Alan Stearns; Greg Whitworth. <a href="https://drafts.css-houdini.org/css-properties-values-api-1/"><cite>CSS Properties and Values API Level 1</cite></a>. URL: <a href="https://drafts.css-houdini.org/css-properties-values-api-1/">https://drafts.css-houdini.org/css-properties-values-api-1/</a>
   <dt id="biblio-css-syntax-3">[CSS-SYNTAX-3]
   <dd>Tab Atkins Jr.; Simon Sapin. <a href="https://drafts.csswg.org/css-syntax/"><cite>CSS Syntax Module Level 3</cite></a>. URL: <a href="https://drafts.csswg.org/css-syntax/">https://drafts.csswg.org/css-syntax/</a>
   <dt id="biblio-css-typed-om-1">[CSS-TYPED-OM-1]
   <dd>Tab Atkins Jr.; François Remy. <a href="https://drafts.css-houdini.org/css-typed-om-1/"><cite>CSS Typed OM Level 1</cite></a>. URL: <a href="https://drafts.css-houdini.org/css-typed-om-1/">https://drafts.css-houdini.org/css-typed-om-1/</a>
   <dt id="biblio-css-ui-4">[CSS-UI-4]
   <dd>Florian Rivoal. <a href="https://drafts.csswg.org/css-ui-4/"><cite>CSS Basic User Interface Module Level 4</cite></a>. URL: <a href="https://drafts.csswg.org/css-ui-4/">https://drafts.csswg.org/css-ui-4/</a>
   <dt id="biblio-css-values-4">[CSS-VALUES-4]
   <dd>Tab Atkins Jr.; Elika Etemad. <a href="https://drafts.csswg.org/css-values-4/"><cite>CSS Values and Units Module Level 4</cite></a>. URL: <a href="https://drafts.csswg.org/css-values-4/">https://drafts.csswg.org/css-values-4/</a>
   <dt id="biblio-css-variables-2">[CSS-VARIABLES-2]
   <dd><a href="https://drafts.csswg.org/css-variables-2/"><cite>CSS Custom Properties for Cascading Variables Module Level 2</cite></a>. Editor's Draft. URL: <a href="https://drafts.csswg.org/css-variables-2/">https://drafts.csswg.org/css-variables-2/</a>
   <dt id="biblio-cssom-1">[CSSOM-1]
   <dd>Daniel Glazman; Emilio Cobos Álvarez. <a href="https://drafts.csswg.org/cssom/"><cite>CSS Object Model (CSSOM)</cite></a>. URL: <a href="https://drafts.csswg.org/cssom/">https://drafts.csswg.org/cssom/</a>
   <dt id="biblio-cssom-view-1">[CSSOM-VIEW-1]
   <dd>Simon Pieters. <a href="https://drafts.csswg.org/cssom-view/"><cite>CSSOM View Module</cite></a>. URL: <a href="https://drafts.csswg.org/cssom-view/">https://drafts.csswg.org/cssom-view/</a>
   <dt id="biblio-dom">[DOM]
   <dd>Anne van Kesteren. <a href="https://dom.spec.whatwg.org/"><cite>DOM Standard</cite></a>. Living Standard. URL: <a href="https://dom.spec.whatwg.org/">https://dom.spec.whatwg.org/</a>
   <dt id="biblio-html">[HTML]
   <dd>Anne van Kesteren; et al. <a href="https://html.spec.whatwg.org/multipage/"><cite>HTML Standard</cite></a>. Living Standard. URL: <a href="https://html.spec.whatwg.org/multipage/">https://html.spec.whatwg.org/multipage/</a>
   <dt id="biblio-infra">[INFRA]
   <dd>Anne van Kesteren; Domenic Denicola. <a href="https://infra.spec.whatwg.org/"><cite>Infra Standard</cite></a>. Living Standard. URL: <a href="https://infra.spec.whatwg.org/">https://infra.spec.whatwg.org/</a>
   <dt id="biblio-rfc2119">[RFC2119]
   <dd>S. Bradner. <a href="https://datatracker.ietf.org/doc/html/rfc2119"><cite>Key words for use in RFCs to Indicate Requirement Levels</cite></a>. March 1997. Best Current Practice. URL: <a href="https://datatracker.ietf.org/doc/html/rfc2119">https://datatracker.ietf.org/doc/html/rfc2119</a>
   <dt id="biblio-webidl">[WEBIDL]
   <dd>Edgar Chen; Timothy Gu. <a href="https://webidl.spec.whatwg.org/"><cite>Web IDL Standard</cite></a>. Living Standard. URL: <a href="https://webidl.spec.whatwg.org/">https://webidl.spec.whatwg.org/</a>
  </dl>
  <h2 class="no-num no-ref heading settled" id="idl-index"><span class="content">IDL Index</span><a class="self-link" href="#idl-index"></a></h2>
<pre class="idl highlight def"><c- b>partial</c-> <c- b>namespace</c-> <a class="idl-code" data-link-type="namespace" href="https://drafts.csswg.org/cssom-1/#namespacedef-css"><c- g>CSS</c-></a> {
    [<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#SameObject"><c- g>SameObject</c-></a>] <c- b>readonly</c-> <c- b>attribute</c-> <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/worklets.html#worklet"><c- n>Worklet</c-></a> <a data-readonly data-type="Worklet" href="#dom-css-paintworklet"><code><c- g>paintWorklet</c-></code></a>;
};

[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Global"><c- g>Global</c-></a>=(<a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/worklets.html#worklet"><c- n>Worklet</c-></a>,<a data-link-type="idl-name"><c- n>PaintWorklet</c-></a>),<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed"><c- g>Exposed</c-></a>=<c- n>PaintWorklet</c->]
<c- b>interface</c-> <a href="#paintworkletglobalscope"><code><c- g>PaintWorkletGlobalScope</c-></code></a> : <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/worklets.html#workletglobalscope"><c- n>WorkletGlobalScope</c-></a> {
    <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-undefined"><c- b>undefined</c-></a> <a class="idl-code" data-link-type="method" href="#dom-paintworkletglobalscope-registerpaint"><c- g>registerPaint</c-></a>(<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString"><c- b>DOMString</c-></a> <a href="#dom-paintworkletglobalscope-registerpaint-name-paintctor-name"><code><c- g>name</c-></code></a>, <a data-link-type="idl-name" href="https://webidl.spec.whatwg.org/#VoidFunction"><c- n>VoidFunction</c-></a> <a href="#dom-paintworkletglobalscope-registerpaint-name-paintctor-paintctor"><code><c- g>paintCtor</c-></code></a>);
    <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-unrestricted-double"><c- b>unrestricted</c-> <c- b>double</c-></a> <a data-readonly data-type="unrestricted double" href="#dom-paintworkletglobalscope-devicepixelratio"><code><c- g>devicePixelRatio</c-></code></a>;
};

<c- b>dictionary</c-> <a href="#dictdef-paintrenderingcontext2dsettings"><code><c- g>PaintRenderingContext2DSettings</c-></code></a> {
    <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-boolean"><c- b>boolean</c-></a> <a data-default="true" data-type="boolean" href="#dom-paintrenderingcontext2dsettings-alpha"><code><c- g>alpha</c-></code></a> = <c- b>true</c->;
};

[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed"><c- g>Exposed</c-></a>=<c- n>PaintWorklet</c->]
<c- b>interface</c-> <a href="#paintrenderingcontext2d"><code><c- g>PaintRenderingContext2D</c-></code></a> {
};
<a data-link-type="idl-name" href="#paintrenderingcontext2d"><c- n>PaintRenderingContext2D</c-></a> <c- b>includes</c-> <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/canvas.html#canvasstate"><c- n>CanvasState</c-></a>;
<a data-link-type="idl-name" href="#paintrenderingcontext2d"><c- n>PaintRenderingContext2D</c-></a> <c- b>includes</c-> <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/canvas.html#canvastransform"><c- n>CanvasTransform</c-></a>;
<a data-link-type="idl-name" href="#paintrenderingcontext2d"><c- n>PaintRenderingContext2D</c-></a> <c- b>includes</c-> <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/canvas.html#canvascompositing"><c- n>CanvasCompositing</c-></a>;
<a data-link-type="idl-name" href="#paintrenderingcontext2d"><c- n>PaintRenderingContext2D</c-></a> <c- b>includes</c-> <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/canvas.html#canvasimagesmoothing"><c- n>CanvasImageSmoothing</c-></a>;
<a data-link-type="idl-name" href="#paintrenderingcontext2d"><c- n>PaintRenderingContext2D</c-></a> <c- b>includes</c-> <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/canvas.html#canvasfillstrokestyles"><c- n>CanvasFillStrokeStyles</c-></a>;
<a data-link-type="idl-name" href="#paintrenderingcontext2d"><c- n>PaintRenderingContext2D</c-></a> <c- b>includes</c-> <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/canvas.html#canvasshadowstyles"><c- n>CanvasShadowStyles</c-></a>;
<a data-link-type="idl-name" href="#paintrenderingcontext2d"><c- n>PaintRenderingContext2D</c-></a> <c- b>includes</c-> <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/canvas.html#canvasrect"><c- n>CanvasRect</c-></a>;
<a data-link-type="idl-name" href="#paintrenderingcontext2d"><c- n>PaintRenderingContext2D</c-></a> <c- b>includes</c-> <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/canvas.html#canvasdrawpath"><c- n>CanvasDrawPath</c-></a>;
<a data-link-type="idl-name" href="#paintrenderingcontext2d"><c- n>PaintRenderingContext2D</c-></a> <c- b>includes</c-> <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/canvas.html#canvasdrawimage"><c- n>CanvasDrawImage</c-></a>;
<a data-link-type="idl-name" href="#paintrenderingcontext2d"><c- n>PaintRenderingContext2D</c-></a> <c- b>includes</c-> <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/canvas.html#canvaspathdrawingstyles"><c- n>CanvasPathDrawingStyles</c-></a>;
<a data-link-type="idl-name" href="#paintrenderingcontext2d"><c- n>PaintRenderingContext2D</c-></a> <c- b>includes</c-> <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/canvas.html#canvaspath"><c- n>CanvasPath</c-></a>;

[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed"><c- g>Exposed</c-></a>=<c- n>PaintWorklet</c->]
<c- b>interface</c-> <a href="#paintsize"><code><c- g>PaintSize</c-></code></a> {
    <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-double"><c- b>double</c-></a> <a data-readonly data-type="double" href="#dom-paintsize-width"><code><c- g>width</c-></code></a>;
    <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-double"><c- b>double</c-></a> <a data-readonly data-type="double" href="#dom-paintsize-height"><code><c- g>height</c-></code></a>;
};

</pre>
  <details class="mdn-anno unpositioned" data-anno-for="ref-for-dom-css-paintworklet">
   <summary><b class="less-than-two-engines-flag" title="This feature is in less than two current engines.">⚠</b><span>MDN</span></summary>
   <div class="feature">
    <p><a href="https://developer.mozilla.org/en-US/docs/Web/API/CSS/paintWorklet_static" title="The static, read-only paintWorklet property of the CSS interface provides access to the paint worklet, which programmatically generates an image where a CSS property expects a file.">CSS/paintWorklet_static</a></p>
    <p class="less-than-two-engines-text">In only one current engine.</p>
    <div class="support">
     <span class="firefox no"><span>Firefox</span><span>None</span></span><span class="safari no"><span>Safari</span><span>None</span></span><span class="chrome yes"><span>Chrome</span><span>65+</span></span>
     <hr>
     <span class="opera no"><span>Opera</span><span>?</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span>
     <hr>
     <span class="edge no"><span>Edge (Legacy)</span><span>?</span></span><span class="ie no"><span>IE</span><span>None</span></span>
     <hr>
     <span class="firefox_android no"><span>Firefox for Android</span><span>?</span></span><span class="safari_ios no"><span>iOS Safari</span><span>?</span></span><span class="chrome_android no"><span>Chrome for Android</span><span>?</span></span><span class="webview_android no"><span>Android WebView</span><span>?</span></span><span class="samsunginternet_android no"><span>Samsung Internet</span><span>?</span></span><span class="opera_android no"><span>Opera Mobile</span><span>?</span></span>
    </div>
   </div>
  </details>
  <details class="mdn-anno unpositioned" data-anno-for="ref-for-dom-paintworkletglobalscope-devicepixelratio">
   <summary><b class="less-than-two-engines-flag" title="This feature is in less than two current engines.">⚠</b><span>MDN</span></summary>
   <div class="feature">
    <p><a href="https://developer.mozilla.org/en-US/docs/Web/API/PaintWorkletGlobalScope/devicePixelRatio" title="The read-only devicePixelRatio read-only property of the PaintWorkletGlobalScope interface returns the current device&apos;s ratio of physical pixels to logical pixels.">PaintWorkletGlobalScope/devicePixelRatio</a></p>
    <p class="less-than-two-engines-text">In only one current engine.</p>
    <div class="support">
     <span class="firefox no"><span>Firefox</span><span>None</span></span><span class="safari no"><span>Safari</span><span>None</span></span><span class="chrome yes"><span>Chrome</span><span>65+</span></span>
     <hr>
     <span class="opera no"><span>Opera</span><span>?</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span>
     <hr>
     <span class="edge no"><span>Edge (Legacy)</span><span>?</span></span><span class="ie no"><span>IE</span><span>None</span></span>
     <hr>
     <span class="firefox_android no"><span>Firefox for Android</span><span>?</span></span><span class="safari_ios no"><span>iOS Safari</span><span>?</span></span><span class="chrome_android no"><span>Chrome for Android</span><span>?</span></span><span class="webview_android no"><span>Android WebView</span><span>?</span></span><span class="samsunginternet_android no"><span>Samsung Internet</span><span>?</span></span><span class="opera_android no"><span>Opera Mobile</span><span>?</span></span>
    </div>
   </div>
  </details>
  <details class="mdn-anno unpositioned" data-anno-for="dom-paintworkletglobalscope-registerpaint">
   <summary><b class="less-than-two-engines-flag" title="This feature is in less than two current engines.">⚠</b><span>MDN</span></summary>
   <div class="feature">
    <p><a href="https://developer.mozilla.org/en-US/docs/Web/API/PaintWorkletGlobalScope/registerPaint" title="The registerPaint() method of the PaintWorkletGlobalScope interface registers a class to programmatically generate an image where a CSS property expects a file.">PaintWorkletGlobalScope/registerPaint</a></p>
    <p class="less-than-two-engines-text">In only one current engine.</p>
    <div class="support">
     <span class="firefox no"><span>Firefox</span><span>None</span></span><span class="safari no"><span>Safari</span><span>None</span></span><span class="chrome yes"><span>Chrome</span><span>65+</span></span>
     <hr>
     <span class="opera no"><span>Opera</span><span>?</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span>
     <hr>
     <span class="edge no"><span>Edge (Legacy)</span><span>?</span></span><span class="ie no"><span>IE</span><span>None</span></span>
     <hr>
     <span class="firefox_android no"><span>Firefox for Android</span><span>?</span></span><span class="safari_ios no"><span>iOS Safari</span><span>?</span></span><span class="chrome_android no"><span>Chrome for Android</span><span>?</span></span><span class="webview_android no"><span>Android WebView</span><span>?</span></span><span class="samsunginternet_android no"><span>Samsung Internet</span><span>?</span></span><span class="opera_android no"><span>Opera Mobile</span><span>?</span></span>
    </div>
   </div>
  </details>
  <details class="mdn-anno unpositioned" data-anno-for="paintworkletglobalscope">
   <summary><b class="less-than-two-engines-flag" title="This feature is in less than two current engines.">⚠</b><span>MDN</span></summary>
   <div class="feature">
    <p><a href="https://developer.mozilla.org/en-US/docs/Web/API/PaintWorkletGlobalScope" title="The PaintWorkletGlobalScope interface of the CSS Painting API represents the global object available inside a paint Worklet.">PaintWorkletGlobalScope</a></p>
    <p class="less-than-two-engines-text">In only one current engine.</p>
    <div class="support">
     <span class="firefox no"><span>Firefox</span><span>None</span></span><span class="safari no"><span>Safari</span><span>None</span></span><span class="chrome yes"><span>Chrome</span><span>65+</span></span>
     <hr>
     <span class="opera no"><span>Opera</span><span>?</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span>
     <hr>
     <span class="edge no"><span>Edge (Legacy)</span><span>?</span></span><span class="ie no"><span>IE</span><span>None</span></span>
     <hr>
     <span class="firefox_android no"><span>Firefox for Android</span><span>?</span></span><span class="safari_ios no"><span>iOS Safari</span><span>?</span></span><span class="chrome_android no"><span>Chrome for Android</span><span>?</span></span><span class="webview_android no"><span>Android WebView</span><span>?</span></span><span class="samsunginternet_android no"><span>Samsung Internet</span><span>?</span></span><span class="opera_android no"><span>Opera Mobile</span><span>?</span></span>
    </div>
   </div>
  </details>
  <details class="mdn-anno unpositioned" data-anno-for="paint-notation">
   <summary><b class="less-than-two-engines-flag" title="This feature is in less than two current engines.">⚠</b><span>MDN</span></summary>
   <div class="feature">
    <p><a href="https://developer.mozilla.org/en-US/docs/Web/CSS/image/paint" title="The paint() CSS function defines an <image> value generated with a PaintWorklet.">image/paint</a></p>
    <p class="less-than-two-engines-text">In only one current engine.</p>
    <div class="support">
     <span class="firefox no"><span>Firefox</span><span>None</span></span><span class="safari no"><span>Safari</span><span>None</span></span><span class="chrome yes"><span>Chrome</span><span>65+</span></span>
     <hr>
     <span class="opera no"><span>Opera</span><span>?</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span>
     <hr>
     <span class="edge no"><span>Edge (Legacy)</span><span>?</span></span><span class="ie no"><span>IE</span><span>None</span></span>
     <hr>
     <span class="firefox_android no"><span>Firefox for Android</span><span>?</span></span><span class="safari_ios no"><span>iOS Safari</span><span>?</span></span><span class="chrome_android no"><span>Chrome for Android</span><span>?</span></span><span class="webview_android no"><span>Android WebView</span><span>?</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>9.2+</span></span><span class="opera_android no"><span>Opera Mobile</span><span>?</span></span>
    </div>
   </div>
  </details>
<script>/* Boilerplate: script-dom-helper */
"use strict";
function query(sel) { return document.querySelector(sel); }

function queryAll(sel) { return [...document.querySelectorAll(sel)]; }

function iter(obj) {
	if(!obj) return [];
	var it = obj[Symbol.iterator];
	if(it) return it;
	return Object.entries(obj);
}

function mk(tagname, attrs, ...children) {
	const el = document.createElement(tagname);
	for(const [k,v] of iter(attrs)) {
		if(k.slice(0,3) == "_on") {
			const eventName = k.slice(3);
			el.addEventListener(eventName, v);
		} else if(k[0] == "_") {
			// property, not attribute
			el[k.slice(1)] = v;
		} else {
			if(v === false || v == null) {
        continue;
      } else if(v === true) {
        el.setAttribute(k, "");
        continue;
      } else {
  			el.setAttribute(k, v);
      }
		}
	}
	append(el, children);
	return el;
}

/* Create shortcuts for every known HTML element */
[
  "a",
  "abbr",
  "acronym",
  "address",
  "applet",
  "area",
  "article",
  "aside",
  "audio",
  "b",
  "base",
  "basefont",
  "bdo",
  "big",
  "blockquote",
  "body",
  "br",
  "button",
  "canvas",
  "caption",
  "center",
  "cite",
  "code",
  "col",
  "colgroup",
  "datalist",
  "dd",
  "del",
  "details",
  "dfn",
  "dialog",
  "div",
  "dl",
  "dt",
  "em",
  "embed",
  "fieldset",
  "figcaption",
  "figure",
  "font",
  "footer",
  "form",
  "frame",
  "frameset",
  "head",
  "header",
  "h1",
  "h2",
  "h3",
  "h4",
  "h5",
  "h6",
  "hr",
  "html",
  "i",
  "iframe",
  "img",
  "input",
  "ins",
  "kbd",
  "label",
  "legend",
  "li",
  "link",
  "main",
  "map",
  "mark",
  "meta",
  "meter",
  "nav",
  "nobr",
  "noscript",
  "object",
  "ol",
  "optgroup",
  "option",
  "output",
  "p",
  "param",
  "pre",
  "progress",
  "q",
  "s",
  "samp",
  "script",
  "section",
  "select",
  "small",
  "source",
  "span",
  "strike",
  "strong",
  "style",
  "sub",
  "summary",
  "sup",
  "table",
  "tbody",
  "td",
  "template",
  "textarea",
  "tfoot",
  "th",
  "thead",
  "time",
  "title",
  "tr",
  "u",
  "ul",
  "var",
  "video",
  "wbr",
  "xmp",
].forEach(tagname=>{
	mk[tagname] = (...args) => mk(tagname, ...args);
});

function* nodesFromChildList(children) {
	for(const child of children.flat(Infinity)) {
		if(child instanceof Node) {
			yield child;
		} else {
			yield new Text(child);
		}
	}
}
function append(el, ...children) {
	for(const child of nodesFromChildList(children)) {
		if(el instanceof Node) el.appendChild(child);
		else el.push(child);
	}
	return el;
}

function insertAfter(el, ...children) {
	for(const child of nodesFromChildList(children)) {
		el.parentNode.insertBefore(child, el.nextSibling);
	}
	return el;
}

function clearContents(el) {
	el.innerHTML = "";
	return el;
}

function parseHTML(markup) {
	if(markup.toLowerCase().trim().indexOf('<!doctype') === 0) {
		const doc = document.implementation.createHTMLDocument("");
		doc.documentElement.innerHTML = markup;
		return doc;
	} else {
		const el = mk.template({});
		el.innerHTML = markup;
		return el.content;
	}
}</script>
<script>/* Boilerplate: script-dfn-panel */
"use strict";
{
let dfnPanelData = {
"02579ab7": {"dfnID":"02579ab7","dfnText":"CanvasImageSmoothing","external":true,"refSections":[{"refs":[{"id":"ref-for-canvasimagesmoothing"}],"title":"6. The 2D rendering context"}],"url":"https://html.spec.whatwg.org/multipage/canvas.html#canvasimagesmoothing"},
"03afaf9c": {"dfnID":"03afaf9c","dfnText":"empty","external":true,"refSections":[{"refs":[{"id":"ref-for-list-empty"}],"title":"4. Registering Custom Paint"}],"url":"https://infra.spec.whatwg.org/#list-empty"},
"0c9b0d3c": {"dfnID":"0c9b0d3c","dfnText":"WorkletGlobalScope","external":true,"refSections":[{"refs":[{"id":"ref-for-workletglobalscope"}],"title":"2. Paint Worklet"}],"url":"https://html.spec.whatwg.org/multipage/worklets.html#workletglobalscope"},
"0deaf786": {"dfnID":"0deaf786","dfnText":"drawImage()","external":true,"refSections":[{"refs":[{"id":"ref-for-dom-context-2d-drawimage"}],"title":"6.1. Drawing a CSSImageValue"}],"url":"https://html.spec.whatwg.org/multipage/canvas.html#dom-context-2d-drawimage"},
"0e6b2056": {"dfnID":"0e6b2056","dfnText":"set","external":true,"refSections":[{"refs":[{"id":"ref-for-map-set"},{"id":"ref-for-map-set\u2460"},{"id":"ref-for-map-set\u2461"}],"title":"4. Registering Custom Paint"},{"refs":[{"id":"ref-for-map-set\u2462"},{"id":"ref-for-map-set\u2463"}],"title":"7. Drawing an image"}],"url":"https://infra.spec.whatwg.org/#map-set"},
"10ce5f6f": {"dfnID":"10ce5f6f","dfnText":"invoke","external":true,"refSections":[{"refs":[{"id":"ref-for-invoke-a-callback-function"}],"title":"7. Drawing an image"}],"url":"https://webidl.spec.whatwg.org/#invoke-a-callback-function"},
"114b7a63": {"dfnID":"114b7a63","dfnText":"reset the rendering context to its default state","external":true,"refSections":[{"refs":[{"id":"ref-for-reset-the-rendering-context-to-its-default-state"}],"title":"6. The 2D rendering context"}],"url":"https://html.spec.whatwg.org/multipage/canvas.html#reset-the-rendering-context-to-its-default-state"},
"11e0b87f": {"dfnID":"11e0b87f","dfnText":"unrestricted double","external":true,"refSections":[{"refs":[{"id":"ref-for-idl-unrestricted-double"}],"title":"2. Paint Worklet"}],"url":"https://webidl.spec.whatwg.org/#idl-unrestricted-double"},
"1243a891": {"dfnID":"1243a891","dfnText":"exist","external":true,"refSections":[{"refs":[{"id":"ref-for-map-exists"},{"id":"ref-for-map-exists\u2460"}],"title":"4. Registering Custom Paint"},{"refs":[{"id":"ref-for-map-exists\u2461"},{"id":"ref-for-map-exists\u2462"}],"title":"7. Drawing an image"}],"url":"https://infra.spec.whatwg.org/#map-exists"},
"1439b86e": {"dfnID":"1439b86e","dfnText":"CanvasImageSource","external":true,"refSections":[{"refs":[{"id":"ref-for-canvasimagesource"},{"id":"ref-for-canvasimagesource\u2460"}],"title":"6.1. Drawing a CSSImageValue"}],"url":"https://html.spec.whatwg.org/multipage/canvas.html#canvasimagesource"},
"16d07e10": {"dfnID":"16d07e10","dfnText":"for each","external":true,"refSections":[{"refs":[{"id":"ref-for-list-iterate"}],"title":"4. Registering Custom Paint"}],"url":"https://infra.spec.whatwg.org/#list-iterate"},
"1981495f": {"dfnID":"1981495f","dfnText":"CanvasCompositing","external":true,"refSections":[{"refs":[{"id":"ref-for-canvascompositing"}],"title":"6. The 2D rendering context"}],"url":"https://html.spec.whatwg.org/multipage/canvas.html#canvascompositing"},
"198f1537": {"dfnID":"198f1537","dfnText":"custom property","external":true,"refSections":[{"refs":[{"id":"ref-for-custom-property"}],"title":"4. Registering Custom Paint"}],"url":"https://drafts.csswg.org/css-variables-2/#custom-property"},
"1f6aa483": {"dfnID":"1f6aa483","dfnText":"concrete object size","external":true,"refSections":[{"refs":[{"id":"ref-for-concrete-object-size"}],"title":"6. The 2D rendering context"},{"refs":[{"id":"ref-for-concrete-object-size\u2460"},{"id":"ref-for-concrete-object-size\u2461"}],"title":"7. Drawing an image"}],"url":"https://drafts.csswg.org/css-images-3/#concrete-object-size"},
"2879c404": {"dfnID":"2879c404","dfnText":"Worklet","external":true,"refSections":[{"refs":[{"id":"ref-for-worklet"},{"id":"ref-for-worklet\u2460"},{"id":"ref-for-worklet\u2461"}],"title":"2. Paint Worklet"},{"refs":[{"id":"ref-for-worklet\u2462"},{"id":"ref-for-worklet\u2463"}],"title":"7. Drawing an image"},{"refs":[{"id":"ref-for-worklet\u2464"}],"title":"7.1. Global Scope Selection"}],"url":"https://html.spec.whatwg.org/multipage/worklets.html#worklet"},
"32c697dc": {"dfnID":"32c697dc","dfnText":"StylePropertyMapReadOnly","external":true,"refSections":[{"refs":[{"id":"ref-for-stylepropertymapreadonly"}],"title":"7. Drawing an image"}],"url":"https://drafts.css-houdini.org/css-typed-om-1/#stylepropertymapreadonly"},
"333bd5a6": {"dfnID":"333bd5a6","dfnText":"CanvasTextDrawingStyles","external":true,"refSections":[{"refs":[{"id":"ref-for-canvastextdrawingstyles"}],"title":"6. The 2D rendering context"}],"url":"https://html.spec.whatwg.org/multipage/canvas.html#canvastextdrawingstyles"},
"3ab7bf79": {"dfnID":"3ab7bf79","dfnText":"callback function","external":true,"refSections":[{"refs":[{"id":"ref-for-dfn-callback-function"}],"title":"3. Concepts"},{"refs":[{"id":"ref-for-dfn-callback-function\u2460"}],"title":"4. Registering Custom Paint"}],"url":"https://webidl.spec.whatwg.org/#dfn-callback-function"},
"3b8ce5a6": {"dfnID":"3b8ce5a6","dfnText":"worklet global scope type","external":true,"refSections":[{"refs":[{"id":"ref-for-worklet-global-scope-type"}],"title":"2. Paint Worklet"}],"url":"https://html.spec.whatwg.org/multipage/worklets.html#worklet-global-scope-type"},
"3cb51bf6": {"dfnID":"3cb51bf6","dfnText":"CanvasState","external":true,"refSections":[{"refs":[{"id":"ref-for-canvasstate"}],"title":"6. The 2D rendering context"}],"url":"https://html.spec.whatwg.org/multipage/canvas.html#canvasstate"},
"3fca5a9e": {"dfnID":"3fca5a9e","dfnText":"map","external":true,"refSections":[{"refs":[{"id":"ref-for-ordered-map"},{"id":"ref-for-ordered-map\u2460"},{"id":"ref-for-ordered-map\u2461"},{"id":"ref-for-ordered-map\u2462"}],"title":"4. Registering Custom Paint"}],"url":"https://infra.spec.whatwg.org/#ordered-map"},
"4464a8c5": {"dfnID":"4464a8c5","dfnText":"CSSImageValue","external":true,"refSections":[{"refs":[{"id":"ref-for-cssimagevalue"},{"id":"ref-for-cssimagevalue\u2460"}],"title":"6.1. Drawing a CSSImageValue"}],"url":"https://drafts.css-houdini.org/css-typed-om-1/#cssimagevalue"},
"448f6a24": {"dfnID":"448f6a24","dfnText":"CanvasDrawImage","external":true,"refSections":[{"refs":[{"id":"ref-for-canvasdrawimage"}],"title":"6. The 2D rendering context"},{"refs":[{"id":"ref-for-canvasdrawimage\u2460"}],"title":"6.1. Drawing a CSSImageValue"}],"url":"https://html.spec.whatwg.org/multipage/canvas.html#canvasdrawimage"},
"4650cbb8": {"dfnID":"4650cbb8","dfnText":"function","external":true,"refSections":[{"refs":[{"id":"ref-for-function"}],"title":"3. Concepts"},{"refs":[{"id":"ref-for-function\u2460"}],"title":"4. Registering Custom Paint"}],"url":"https://drafts.csswg.org/css-syntax-3/#function"},
"4739df91": {"dfnID":"4739df91","dfnText":"typeerror","external":true,"refSections":[{"refs":[{"id":"ref-for-sec-native-error-types-used-in-this-standard-typeerror"},{"id":"ref-for-sec-native-error-types-used-in-this-standard-typeerror\u2460"},{"id":"ref-for-sec-native-error-types-used-in-this-standard-typeerror\u2461"},{"id":"ref-for-sec-native-error-types-used-in-this-standard-typeerror\u2462"}],"title":"4. Registering Custom Paint"}],"url":"https://tc39.github.io/ecma262/#sec-native-error-types-used-in-this-standard-typeerror"},
"527b10aa": {"dfnID":"527b10aa","dfnText":"get","external":true,"refSections":[{"refs":[{"id":"ref-for-map-get"}],"title":"4. Registering Custom Paint"},{"refs":[{"id":"ref-for-map-get\u2460"}],"title":"7. Drawing an image"}],"url":"https://infra.spec.whatwg.org/#map-get"},
"53275e46": {"dfnID":"53275e46","dfnText":"append","external":true,"refSections":[{"refs":[{"id":"ref-for-list-append"}],"title":"4. Registering Custom Paint"}],"url":"https://infra.spec.whatwg.org/#list-append"},
"5372cca8": {"dfnID":"5372cca8","dfnText":"boolean","external":true,"refSections":[{"refs":[{"id":"ref-for-idl-boolean"}],"title":"2. Paint Worklet"}],"url":"https://webidl.spec.whatwg.org/#idl-boolean"},
"537cf076": {"dfnID":"537cf076","dfnText":"?","external":true,"refSections":[{"refs":[{"id":"ref-for-mult-opt"}],"title":"5. Paint Notation"}],"url":"https://drafts.csswg.org/css-values-4/#mult-opt"},
"59551364": {"dfnID":"59551364","dfnText":"CanvasPath","external":true,"refSections":[{"refs":[{"id":"ref-for-canvaspath"}],"title":"6. The 2D rendering context"}],"url":"https://html.spec.whatwg.org/multipage/canvas.html#canvaspath"},
"5b322f88": {"dfnID":"5b322f88","dfnText":"construct","external":true,"refSections":[{"refs":[{"id":"ref-for-sec-construct"},{"id":"ref-for-sec-construct\u2460"}],"title":"7. Drawing an image"}],"url":"https://tc39.github.io/ecma262/#sec-construct"},
"5f90bbfb": {"dfnID":"5f90bbfb","dfnText":"undefined","external":true,"refSections":[{"refs":[{"id":"ref-for-idl-undefined"}],"title":"2. Paint Worklet"}],"url":"https://webidl.spec.whatwg.org/#idl-undefined"},
"647de2a6": {"dfnID":"647de2a6","dfnText":"cursor","external":true,"refSections":[{"refs":[{"id":"ref-for-propdef-cursor"}],"title":"5. Paint Notation"}],"url":"https://drafts.csswg.org/css-ui-4/#propdef-cursor"},
"649608b9": {"dfnID":"649608b9","dfnText":"list","external":true,"refSections":[{"refs":[{"id":"ref-for-list"},{"id":"ref-for-list\u2460"},{"id":"ref-for-list\u2461"}],"title":"3. Concepts"},{"refs":[{"id":"ref-for-list\u2462"}],"title":"4. Registering Custom Paint"},{"refs":[{"id":"ref-for-list\u2463"}],"title":"7. Drawing an image"},{"refs":[{"id":"ref-for-list\u2464"}],"title":"7.1. Global Scope Selection"}],"url":"https://infra.spec.whatwg.org/#list"},
"65a2d66b": {"dfnID":"65a2d66b","dfnText":"CanvasRect","external":true,"refSections":[{"refs":[{"id":"ref-for-canvasrect"}],"title":"6. The 2D rendering context"}],"url":"https://html.spec.whatwg.org/multipage/canvas.html#canvasrect"},
"698cada8": {"dfnID":"698cada8","dfnText":"StylePropertyMap","external":true,"refSections":[{"refs":[{"id":"ref-for-stylepropertymap"}],"title":"4. Registering Custom Paint"}],"url":"https://drafts.css-houdini.org/css-typed-om-1/#stylepropertymap"},
"6aabef20": {"dfnID":"6aabef20","dfnText":"get","external":true,"refSections":[{"refs":[{"id":"ref-for-sec-get-o-p"},{"id":"ref-for-sec-get-o-p\u2460"},{"id":"ref-for-sec-get-o-p\u2461"},{"id":"ref-for-sec-get-o-p\u2462"},{"id":"ref-for-sec-get-o-p\u2463"}],"title":"4. Registering Custom Paint"},{"refs":[{"id":"ref-for-sec-get-o-p\u2464"},{"id":"ref-for-sec-get-o-p\u2465"}],"title":"7. Drawing an image"}],"url":"https://tc39.github.io/ecma262/#sec-get-o-p"},
"6f738b30": {"dfnID":"6f738b30","dfnText":"global scopes","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-worklet-global-scopes"}],"title":"7. Drawing an image"},{"refs":[{"id":"ref-for-concept-worklet-global-scopes\u2460"}],"title":"7.1. Global Scope Selection"}],"url":"https://html.spec.whatwg.org/multipage/worklets.html#concept-worklet-global-scopes"},
"7004c2a7": {"dfnID":"7004c2a7","dfnText":"VoidFunction","external":true,"refSections":[{"refs":[{"id":"ref-for-VoidFunction"}],"title":"2. Paint Worklet"}],"url":"https://webidl.spec.whatwg.org/#VoidFunction"},
"70de881b": {"dfnID":"70de881b","dfnText":"CanvasDrawPath","external":true,"refSections":[{"refs":[{"id":"ref-for-canvasdrawpath"}],"title":"6. The 2D rendering context"}],"url":"https://html.spec.whatwg.org/multipage/canvas.html#canvasdrawpath"},
"74bf8d66": {"dfnID":"74bf8d66","dfnText":"consume a syntax definition","external":true,"refSections":[{"refs":[{"id":"ref-for-consume-a-syntax-definition"}],"title":"4. Registering Custom Paint"}],"url":"https://drafts.css-houdini.org/css-properties-values-api-1/#consume-a-syntax-definition"},
"75723177": {"dfnID":"75723177","dfnText":"CanvasUserInterface","external":true,"refSections":[{"refs":[{"id":"ref-for-canvasuserinterface"}],"title":"6. The 2D rendering context"}],"url":"https://html.spec.whatwg.org/multipage/canvas.html#canvasuserinterface"},
"791149df": {"dfnID":"791149df","dfnText":"CanvasShadowStyles","external":true,"refSections":[{"refs":[{"id":"ref-for-canvasshadowstyles"}],"title":"6. The 2D rendering context"}],"url":"https://html.spec.whatwg.org/multipage/canvas.html#canvasshadowstyles"},
"7fb6fbc6": {"dfnID":"7fb6fbc6","dfnText":"Global","external":true,"refSections":[{"refs":[{"id":"ref-for-Global"}],"title":"2. Paint Worklet"}],"url":"https://webidl.spec.whatwg.org/#Global"},
"8144e597": {"dfnID":"8144e597","dfnText":"<declaration-value>","external":true,"refSections":[{"refs":[{"id":"ref-for-typedef-declaration-value"}],"title":"5. Paint Notation"}],"url":"https://drafts.csswg.org/css-syntax-3/#typedef-declaration-value"},
"8699eea2": {"dfnID":"8699eea2","dfnText":"CanvasRenderingContext2D","external":true,"refSections":[{"refs":[{"id":"ref-for-canvasrenderingcontext2d"}],"title":"6. The 2D rendering context"}],"url":"https://html.spec.whatwg.org/multipage/canvas.html#canvasrenderingcontext2d"},
"881c2f72": {"dfnID":"881c2f72","dfnText":"box","external":true,"refSections":[{"refs":[{"id":"ref-for-box"},{"id":"ref-for-box\u2460"}],"title":"7. Drawing an image"}],"url":"https://drafts.csswg.org/css-display-4/#box"},
"8855a9aa": {"dfnID":"8855a9aa","dfnText":"DOMString","external":true,"refSections":[{"refs":[{"id":"ref-for-idl-DOMString"}],"title":"2. Paint Worklet"}],"url":"https://webidl.spec.whatwg.org/#idl-DOMString"},
"889e932f": {"dfnID":"889e932f","dfnText":"Exposed","external":true,"refSections":[{"refs":[{"id":"ref-for-Exposed"}],"title":"2. Paint Worklet"},{"refs":[{"id":"ref-for-Exposed\u2460"}],"title":"6. The 2D rendering context"},{"refs":[{"id":"ref-for-Exposed\u2461"}],"title":"7. Drawing an image"}],"url":"https://webidl.spec.whatwg.org/#Exposed"},
"8c800cdf": {"dfnID":"8c800cdf","dfnText":"double","external":true,"refSections":[{"refs":[{"id":"ref-for-idl-double"},{"id":"ref-for-idl-double\u2460"}],"title":"7. Drawing an image"}],"url":"https://webidl.spec.whatwg.org/#idl-double"},
"9213678e": {"dfnID":"9213678e","dfnText":"<ident>","external":true,"refSections":[{"refs":[{"id":"ref-for-typedef-ident"}],"title":"5. Paint Notation"}],"url":"https://drafts.csswg.org/css-values-4/#typedef-ident"},
"93252241": {"dfnID":"93252241","dfnText":"worklet destination type","external":true,"refSections":[{"refs":[{"id":"ref-for-worklet-destination-type"}],"title":"2. Paint Worklet"}],"url":"https://html.spec.whatwg.org/multipage/worklets.html#worklet-destination-type"},
"95a140e6": {"dfnID":"95a140e6","dfnText":"CanvasFillStrokeStyles","external":true,"refSections":[{"refs":[{"id":"ref-for-canvasfillstrokestyles"}],"title":"6. The 2D rendering context"}],"url":"https://html.spec.whatwg.org/multipage/canvas.html#canvasfillstrokestyles"},
"984221ca": {"dfnID":"984221ca","dfnText":"struct","external":true,"refSections":[{"refs":[{"id":"ref-for-struct"},{"id":"ref-for-struct\u2460"}],"title":"3. Concepts"}],"url":"https://infra.spec.whatwg.org/#struct"},
"998b9e6e": {"dfnID":"998b9e6e","dfnText":"<image>","external":true,"refSections":[{"refs":[{"id":"ref-for-typedef-image"}],"title":"Unnumbered Section"},{"refs":[{"id":"ref-for-typedef-image\u2460"}],"title":"1. Introduction"},{"refs":[{"id":"ref-for-typedef-image\u2461"},{"id":"ref-for-typedef-image\u2462"}],"title":"3. Concepts"},{"refs":[{"id":"ref-for-typedef-image\u2463"},{"id":"ref-for-typedef-image\u2464"}],"title":"5. Paint Notation"},{"refs":[{"id":"ref-for-typedef-image\u2465"}],"title":"7. Drawing an image"}],"url":"https://drafts.csswg.org/css-images-3/#typedef-image"},
"9a517a7d": {"dfnID":"9a517a7d","dfnText":"queue a task","external":true,"refSections":[{"refs":[{"id":"ref-for-queue-a-task"}],"title":"4. Registering Custom Paint"},{"refs":[{"id":"ref-for-queue-a-task\u2460"}],"title":"7. Drawing an image"}],"url":"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task"},
"9cd25054": {"dfnID":"9cd25054","dfnText":"computed value","external":true,"refSections":[{"refs":[{"id":"ref-for-computed-value"}],"title":"5. Paint Notation"},{"refs":[{"id":"ref-for-computed-value\u2460"}],"title":"7. Drawing an image"}],"url":"https://drafts.csswg.org/css-cascade-5/#computed-value"},
"9f9120ff": {"dfnID":"9f9120ff","dfnText":",","external":true,"refSections":[{"refs":[{"id":"ref-for-comb-comma"}],"title":"5. Paint Notation"}],"url":"https://drafts.csswg.org/css-values-4/#comb-comma"},
"a43c62be": {"dfnID":"a43c62be","dfnText":"CSS","external":true,"refSections":[{"refs":[{"id":"ref-for-namespacedef-css"}],"title":"2. Paint Worklet"}],"url":"https://drafts.csswg.org/cssom-1/#namespacedef-css"},
"a4cd8a8d": {"dfnID":"a4cd8a8d","dfnText":"border-image","external":true,"refSections":[{"refs":[{"id":"ref-for-propdef-border-image"}],"title":"8.5. Example 5: Drawing outside an element\u2019s area"}],"url":"https://drafts.csswg.org/css-backgrounds-3/#propdef-border-image"},
"a5c91173": {"dfnID":"a5c91173","dfnText":"SameObject","external":true,"refSections":[{"refs":[{"id":"ref-for-SameObject"}],"title":"2. Paint Worklet"}],"url":"https://webidl.spec.whatwg.org/#SameObject"},
"a72449dd": {"dfnID":"a72449dd","dfnText":"in parallel","external":true,"refSections":[{"refs":[{"id":"ref-for-in-parallel"},{"id":"ref-for-in-parallel\u2460"}],"title":"7. Drawing an image"}],"url":"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel"},
"a973e0fe": {"dfnID":"a973e0fe","dfnText":"document","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-document"}],"title":"3. Concepts"},{"refs":[{"id":"ref-for-concept-document\u2460"},{"id":"ref-for-concept-document\u2461"}],"title":"4. Registering Custom Paint"},{"refs":[{"id":"ref-for-concept-document\u2462"},{"id":"ref-for-concept-document\u2463"}],"title":"7. Drawing an image"}],"url":"https://dom.spec.whatwg.org/#concept-document"},
"a9bf6bd5": {"dfnID":"a9bf6bd5","dfnText":"callback this value","external":true,"refSections":[{"refs":[{"id":"ref-for-dfn-callback-this-value"}],"title":"7. Drawing an image"}],"url":"https://webidl.spec.whatwg.org/#dfn-callback-this-value"},
"aa310bd6": {"dfnID":"aa310bd6","dfnText":"CanvasTransform","external":true,"refSections":[{"refs":[{"id":"ref-for-canvastransform"}],"title":"6. The 2D rendering context"}],"url":"https://html.spec.whatwg.org/multipage/canvas.html#canvastransform"},
"ae390677": {"dfnID":"ae390677","dfnText":"object size negotiation","external":true,"refSections":[{"refs":[{"id":"ref-for-object-size-negotiation"},{"id":"ref-for-object-size-negotiation\u2460"}],"title":"7. Drawing an image"}],"url":"https://drafts.csswg.org/css-images-3/#object-size-negotiation"},
"b181fb6a": {"dfnID":"b181fb6a","dfnText":"constructor","external":true,"refSections":[{"refs":[{"id":"ref-for-sec-constructor"}],"title":"3. Concepts"}],"url":"https://tc39.github.io/ecma262/#sec-constructor"},
"b4cfa5ce": {"dfnID":"b4cfa5ce","dfnText":"throw","external":true,"refSections":[{"refs":[{"id":"ref-for-dfn-throw"},{"id":"ref-for-dfn-throw\u2460"},{"id":"ref-for-dfn-throw\u2461"},{"id":"ref-for-dfn-throw\u2462"},{"id":"ref-for-dfn-throw\u2463"},{"id":"ref-for-dfn-throw\u2464"},{"id":"ref-for-dfn-throw\u2465"}],"title":"4. Registering Custom Paint"},{"refs":[{"id":"ref-for-dfn-throw\u2466"}],"title":"7. Drawing an image"}],"url":"https://webidl.spec.whatwg.org/#dfn-throw"},
"b4fb645c": {"dfnID":"b4fb645c","dfnText":"converting","external":true,"refSections":[{"refs":[{"id":"ref-for-web-idl-arguments-list-converting"},{"id":"ref-for-web-idl-arguments-list-converting\u2460"},{"id":"ref-for-web-idl-arguments-list-converting\u2461"},{"id":"ref-for-web-idl-arguments-list-converting\u2462"}],"title":"4. Registering Custom Paint"}],"url":"https://webidl.spec.whatwg.org/#web-idl-arguments-list-converting"},
"b8eed9b5": {"dfnID":"b8eed9b5","dfnText":"set bitmap dimensions","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-canvas-set-bitmap-dimensions"},{"id":"ref-for-concept-canvas-set-bitmap-dimensions\u2460"}],"title":"6. The 2D rendering context"}],"url":"https://html.spec.whatwg.org/multipage/canvas.html#concept-canvas-set-bitmap-dimensions"},
"c0159396": {"dfnID":"c0159396","dfnText":"devicePixelRatio","external":true,"refSections":[{"refs":[{"id":"ref-for-dom-window-devicepixelratio"}],"title":"2. Paint Worklet"}],"url":"https://drafts.csswg.org/cssom-view-1/#dom-window-devicepixelratio"},
"c4df1374": {"dfnID":"c4df1374","dfnText":"type","external":true,"refSections":[{"refs":[{"id":"ref-for-sec-ecmascript-data-types-and-values"}],"title":"4. Registering Custom Paint"}],"url":"https://tc39.github.io/ecma262/#sec-ecmascript-data-types-and-values"},
"c85add6f": {"dfnID":"c85add6f","dfnText":"CanvasPathDrawingStyles","external":true,"refSections":[{"refs":[{"id":"ref-for-canvaspathdrawingstyles"}],"title":"6. The 2D rendering context"}],"url":"https://html.spec.whatwg.org/multipage/canvas.html#canvaspathdrawingstyles"},
"cae6bf57": {"dfnID":"cae6bf57","dfnText":"InvalidModificationError","external":true,"refSections":[{"refs":[{"id":"ref-for-invalidmodificationerror"}],"title":"4. Registering Custom Paint"}],"url":"https://webidl.spec.whatwg.org/#invalidmodificationerror"},
"cec3ac11": {"dfnID":"cec3ac11","dfnText":"CanvasImageData","external":true,"refSections":[{"refs":[{"id":"ref-for-canvasimagedata"}],"title":"6. The 2D rendering context"}],"url":"https://html.spec.whatwg.org/multipage/canvas.html#canvasimagedata"},
"cfb5cfc9": {"dfnID":"cfb5cfc9","dfnText":"syntax definition","external":true,"refSections":[{"refs":[{"id":"ref-for-syntax-definition"}],"title":"3. Concepts"},{"refs":[{"id":"ref-for-syntax-definition\u2460"}],"title":"4. Registering Custom Paint"}],"url":"https://drafts.css-houdini.org/css-properties-values-api-1/#syntax-definition"},
"create-a-paintrenderingcontext2d-object": {"dfnID":"create-a-paintrenderingcontext2d-object","dfnText":"create a PaintRenderingContext2D object","external":false,"refSections":[{"refs":[{"id":"ref-for-create-a-paintrenderingcontext2d-object"}],"title":"7. Drawing an image"}],"url":"#create-a-paintrenderingcontext2d-object"},
"d3936525": {"dfnID":"d3936525","dfnText":"natural dimension","external":true,"refSections":[{"refs":[{"id":"ref-for-natural-dimensions"},{"id":"ref-for-natural-dimensions\u2460"},{"id":"ref-for-natural-dimensions\u2461"},{"id":"ref-for-natural-dimensions\u2462"}],"title":"7. Drawing an image"}],"url":"https://drafts.csswg.org/css-images-3/#natural-dimensions"},
"d56bd241": {"dfnID":"d56bd241","dfnText":"isconstructor","external":true,"refSections":[{"refs":[{"id":"ref-for-sec-isconstructor"}],"title":"4. Registering Custom Paint"}],"url":"https://tc39.github.io/ecma262/#sec-isconstructor"},
"d6888cc4": {"dfnID":"d6888cc4","dfnText":"CanvasText","external":true,"refSections":[{"refs":[{"id":"ref-for-canvastext"}],"title":"6. The 2D rendering context"}],"url":"https://html.spec.whatwg.org/multipage/canvas.html#canvastext"},
"dca2de17": {"dfnID":"dca2de17","dfnText":"DOMException","external":true,"refSections":[{"refs":[{"id":"ref-for-idl-DOMException"}],"title":"4. Registering Custom Paint"}],"url":"https://webidl.spec.whatwg.org/#idl-DOMException"},
"dictdef-paintrenderingcontext2dsettings": {"dfnID":"dictdef-paintrenderingcontext2dsettings","dfnText":"PaintRenderingContext2DSettings","external":false,"refSections":[{"refs":[{"id":"ref-for-dictdef-paintrenderingcontext2dsettings"},{"id":"ref-for-dictdef-paintrenderingcontext2dsettings\u2460"}],"title":"2. Paint Worklet"},{"refs":[{"id":"ref-for-dictdef-paintrenderingcontext2dsettings\u2461"}],"title":"4. Registering Custom Paint"}],"url":"#dictdef-paintrenderingcontext2dsettings"},
"document-paint-definition": {"dfnID":"document-paint-definition","dfnText":"document paint definition","external":false,"refSections":[{"refs":[{"id":"ref-for-document-paint-definition"}],"title":"4. Registering Custom Paint"}],"url":"#document-paint-definition"},
"document-paint-definition-input-argument-syntaxes": {"dfnID":"document-paint-definition-input-argument-syntaxes","dfnText":"input argument syntaxes","external":false,"refSections":[{"refs":[{"id":"ref-for-document-paint-definition-input-argument-syntaxes"},{"id":"ref-for-document-paint-definition-input-argument-syntaxes\u2460"}],"title":"4. Registering Custom Paint"},{"refs":[{"id":"ref-for-document-paint-definition-input-argument-syntaxes\u2461"}],"title":"7. Drawing an image"}],"url":"#document-paint-definition-input-argument-syntaxes"},
"document-paint-definition-input-properties": {"dfnID":"document-paint-definition-input-properties","dfnText":"input properties","external":false,"refSections":[{"refs":[{"id":"ref-for-document-paint-definition-input-properties"},{"id":"ref-for-document-paint-definition-input-properties\u2460"}],"title":"4. Registering Custom Paint"}],"url":"#document-paint-definition-input-properties"},
"document-paint-definition-paintrenderingcontext2dsettings-object": {"dfnID":"document-paint-definition-paintrenderingcontext2dsettings-object","dfnText":"PaintRenderingContext2DSettings object","external":false,"refSections":[{"refs":[{"id":"ref-for-document-paint-definition-paintrenderingcontext2dsettings-object"},{"id":"ref-for-document-paint-definition-paintrenderingcontext2dsettings-object\u2460"}],"title":"4. Registering Custom Paint"}],"url":"#document-paint-definition-paintrenderingcontext2dsettings-object"},
"document-paint-definitions": {"dfnID":"document-paint-definitions","dfnText":"document paint definitions","external":false,"refSections":[{"refs":[{"id":"ref-for-document-paint-definitions"}],"title":"4. Registering Custom Paint"},{"refs":[{"id":"ref-for-document-paint-definitions\u2460"},{"id":"ref-for-document-paint-definitions\u2461"}],"title":"7. Drawing an image"}],"url":"#document-paint-definitions"},
"dom-css-paintworklet": {"dfnID":"dom-css-paintworklet","dfnText":"paintWorklet","external":false,"refSections":[{"refs":[{"id":"ref-for-dom-css-paintworklet"},{"id":"ref-for-dom-css-paintworklet\u2460"},{"id":"ref-for-dom-css-paintworklet\u2461"},{"id":"ref-for-dom-css-paintworklet\u2462"}],"title":"2. Paint Worklet"}],"url":"#dom-css-paintworklet"},
"dom-paintrenderingcontext2dsettings-alpha": {"dfnID":"dom-paintrenderingcontext2dsettings-alpha","dfnText":"alpha","external":false,"refSections":[{"refs":[{"id":"ref-for-dom-paintrenderingcontext2dsettings-alpha"}],"title":"6. The 2D rendering context"}],"url":"#dom-paintrenderingcontext2dsettings-alpha"},
"dom-paintsize-height": {"dfnID":"dom-paintsize-height","dfnText":"height","external":false,"refSections":[],"url":"#dom-paintsize-height"},
"dom-paintsize-width": {"dfnID":"dom-paintsize-width","dfnText":"width","external":false,"refSections":[],"url":"#dom-paintsize-width"},
"dom-paintworkletglobalscope-devicepixelratio": {"dfnID":"dom-paintworkletglobalscope-devicepixelratio","dfnText":"devicePixelRatio","external":false,"refSections":[{"refs":[{"id":"ref-for-dom-paintworkletglobalscope-devicepixelratio"}],"title":"2. Paint Worklet"}],"url":"#dom-paintworkletglobalscope-devicepixelratio"},
"dom-paintworkletglobalscope-registerpaint": {"dfnID":"dom-paintworkletglobalscope-registerpaint","dfnText":"registerPaint(name, paintCtor)","external":false,"refSections":[{"refs":[{"id":"ref-for-dom-paintworkletglobalscope-registerpaint"}],"title":"2. Paint Worklet"},{"refs":[{"id":"ref-for-dom-paintworkletglobalscope-registerpaint\u2460"},{"id":"ref-for-dom-paintworkletglobalscope-registerpaint\u2461"}],"title":"4. Registering Custom Paint"},{"refs":[{"id":"ref-for-dom-paintworkletglobalscope-registerpaint\u2462"}],"title":"5. Paint Notation"},{"refs":[{"id":"ref-for-dom-paintworkletglobalscope-registerpaint\u2463"}],"title":"7. Drawing an image"}],"url":"#dom-paintworkletglobalscope-registerpaint"},
"dom-paintworkletglobalscope-registerpaint-name-paintctor-name": {"dfnID":"dom-paintworkletglobalscope-registerpaint-name-paintctor-name","dfnText":"name","external":false,"refSections":[],"url":"#dom-paintworkletglobalscope-registerpaint-name-paintctor-name"},
"dom-paintworkletglobalscope-registerpaint-name-paintctor-paintctor": {"dfnID":"dom-paintworkletglobalscope-registerpaint-name-paintctor-paintctor","dfnText":"paintCtor","external":false,"refSections":[],"url":"#dom-paintworkletglobalscope-registerpaint-name-paintctor-paintctor"},
"draw-a-paint-image": {"dfnID":"draw-a-paint-image","dfnText":"draw a paint image","external":false,"refSections":[{"refs":[{"id":"ref-for-draw-a-paint-image"}],"title":"4. Registering Custom Paint"},{"refs":[{"id":"ref-for-draw-a-paint-image\u2460"}],"title":"5. Paint Notation"},{"refs":[{"id":"ref-for-draw-a-paint-image\u2461"},{"id":"ref-for-draw-a-paint-image\u2462"},{"id":"ref-for-draw-a-paint-image\u2463"},{"id":"ref-for-draw-a-paint-image\u2464"},{"id":"ref-for-draw-a-paint-image\u2465"},{"id":"ref-for-draw-a-paint-image\u2466"}],"title":"7. Drawing an image"}],"url":"#draw-a-paint-image"},
"e11b0bf7": {"dfnID":"e11b0bf7","dfnText":"supported css property","external":true,"refSections":[{"refs":[{"id":"ref-for-supported-css-property"}],"title":"4. Registering Custom Paint"}],"url":"https://drafts.csswg.org/cssom-1/#supported-css-property"},
"e1b8b09d": {"dfnID":"e1b8b09d","dfnText":"invalid image","external":true,"refSections":[{"refs":[{"id":"ref-for-invalid-image"},{"id":"ref-for-invalid-image\u2460"}],"title":"5. Paint Notation"},{"refs":[{"id":"ref-for-invalid-image\u2461"},{"id":"ref-for-invalid-image\u2462"},{"id":"ref-for-invalid-image\u2463"},{"id":"ref-for-invalid-image\u2464"},{"id":"ref-for-invalid-image\u2465"},{"id":"ref-for-invalid-image\u2466"},{"id":"ref-for-invalid-image\u2467"},{"id":"ref-for-invalid-image\u2468"},{"id":"ref-for-invalid-image\u2460\u24ea"},{"id":"ref-for-invalid-image\u2460\u2460"}],"title":"7. Drawing an image"}],"url":"https://drafts.csswg.org/css-images-4/#invalid-image"},
"e4ffa115": {"dfnID":"e4ffa115","dfnText":"create a worklet global scope","external":true,"refSections":[{"refs":[{"id":"ref-for-create-a-worklet-global-scope"}],"title":"7. Drawing an image"}],"url":"https://html.spec.whatwg.org/multipage/worklets.html#create-a-worklet-global-scope"},
"funcdef-paint": {"dfnID":"funcdef-paint","dfnText":"paint()","external":false,"refSections":[{"refs":[{"id":"ref-for-funcdef-paint"}],"title":"3. Concepts"},{"refs":[{"id":"ref-for-funcdef-paint\u2460"}],"title":"4. Registering Custom Paint"},{"refs":[{"id":"ref-for-funcdef-paint\u2461"},{"id":"ref-for-funcdef-paint\u2462"},{"id":"ref-for-funcdef-paint\u2463"}],"title":"5. Paint Notation"},{"refs":[{"id":"ref-for-funcdef-paint\u2464"},{"id":"ref-for-funcdef-paint\u2465"},{"id":"ref-for-funcdef-paint\u2466"},{"id":"ref-for-funcdef-paint\u2467"},{"id":"ref-for-funcdef-paint\u2468"},{"id":"ref-for-funcdef-paint\u2460\u24ea"}],"title":"7. Drawing an image"},{"refs":[{"id":"ref-for-funcdef-paint\u2460\u2460"}],"title":"8.1. Example 1: Colored Circle"}],"url":"#funcdef-paint"},
"invoke-a-paint-callback": {"dfnID":"invoke-a-paint-callback","dfnText":"invoke a paint callback","external":false,"refSections":[{"refs":[{"id":"ref-for-invoke-a-paint-callback"},{"id":"ref-for-invoke-a-paint-callback\u2460"}],"title":"7. Drawing an image"}],"url":"#invoke-a-paint-callback"},
"paint-class-instances": {"dfnID":"paint-class-instances","dfnText":"paint class instances","external":false,"refSections":[{"refs":[{"id":"ref-for-paint-class-instances"}],"title":"4. Registering Custom Paint"},{"refs":[{"id":"ref-for-paint-class-instances\u2460"}],"title":"7. Drawing an image"}],"url":"#paint-class-instances"},
"paint-definition": {"dfnID":"paint-definition","dfnText":"paint definition","external":false,"refSections":[{"refs":[{"id":"ref-for-paint-definition"}],"title":"4. Registering Custom Paint"}],"url":"#paint-definition"},
"paint-definition-class-constructor": {"dfnID":"paint-definition-class-constructor","dfnText":"class constructor","external":false,"refSections":[{"refs":[{"id":"ref-for-paint-definition-class-constructor"}],"title":"4. Registering Custom Paint"},{"refs":[{"id":"ref-for-paint-definition-class-constructor\u2460"}],"title":"7. Drawing an image"}],"url":"#paint-definition-class-constructor"},
"paint-definition-constructor-valid-flag": {"dfnID":"paint-definition-constructor-valid-flag","dfnText":"constructor valid flag","external":false,"refSections":[{"refs":[{"id":"ref-for-paint-definition-constructor-valid-flag"}],"title":"4. Registering Custom Paint"},{"refs":[{"id":"ref-for-paint-definition-constructor-valid-flag\u2460"},{"id":"ref-for-paint-definition-constructor-valid-flag\u2461"}],"title":"7. Drawing an image"}],"url":"#paint-definition-constructor-valid-flag"},
"paint-definition-input-properties": {"dfnID":"paint-definition-input-properties","dfnText":"input properties","external":false,"refSections":[{"refs":[{"id":"ref-for-paint-definition-input-properties"}],"title":"4. Registering Custom Paint"},{"refs":[{"id":"ref-for-paint-definition-input-properties\u2460"}],"title":"7. Drawing an image"}],"url":"#paint-definition-input-properties"},
"paint-definition-paint-function": {"dfnID":"paint-definition-paint-function","dfnText":"paint function","external":false,"refSections":[{"refs":[{"id":"ref-for-paint-definition-paint-function"}],"title":"4. Registering Custom Paint"},{"refs":[{"id":"ref-for-paint-definition-paint-function\u2460"}],"title":"7. Drawing an image"}],"url":"#paint-definition-paint-function"},
"paint-definition-paintrenderingcontext2dsettings-object": {"dfnID":"paint-definition-paintrenderingcontext2dsettings-object","dfnText":"PaintRenderingContext2DSettings object","external":false,"refSections":[{"refs":[{"id":"ref-for-paint-definition-paintrenderingcontext2dsettings-object"}],"title":"4. Registering Custom Paint"},{"refs":[{"id":"ref-for-paint-definition-paintrenderingcontext2dsettings-object\u2460"}],"title":"7. Drawing an image"}],"url":"#paint-definition-paintrenderingcontext2dsettings-object"},
"paint-definitions": {"dfnID":"paint-definitions","dfnText":"paint definitions","external":false,"refSections":[{"refs":[{"id":"ref-for-paint-definitions"}],"title":"4. Registering Custom Paint"},{"refs":[{"id":"ref-for-paint-definitions\u2460"}],"title":"7. Drawing an image"}],"url":"#paint-definitions"},
"paintrenderingcontext2d": {"dfnID":"paintrenderingcontext2d","dfnText":"PaintRenderingContext2D","external":false,"refSections":[{"refs":[{"id":"ref-for-paintrenderingcontext2d"},{"id":"ref-for-paintrenderingcontext2d\u2460"},{"id":"ref-for-paintrenderingcontext2d\u2461"},{"id":"ref-for-paintrenderingcontext2d\u2462"},{"id":"ref-for-paintrenderingcontext2d\u2463"},{"id":"ref-for-paintrenderingcontext2d\u2464"},{"id":"ref-for-paintrenderingcontext2d\u2465"},{"id":"ref-for-paintrenderingcontext2d\u2466"},{"id":"ref-for-paintrenderingcontext2d\u2467"},{"id":"ref-for-paintrenderingcontext2d\u2468"},{"id":"ref-for-paintrenderingcontext2d\u2460\u24ea"},{"id":"ref-for-paintrenderingcontext2d\u2460\u2460"},{"id":"ref-for-paintrenderingcontext2d\u2460\u2461"},{"id":"ref-for-paintrenderingcontext2d\u2460\u2462"},{"id":"ref-for-paintrenderingcontext2d\u2460\u2463"},{"id":"ref-for-paintrenderingcontext2d\u2460\u2464"},{"id":"ref-for-paintrenderingcontext2d\u2460\u2465"},{"id":"ref-for-paintrenderingcontext2d\u2460\u2466"},{"id":"ref-for-paintrenderingcontext2d\u2460\u2467"}],"title":"6. The 2D rendering context"},{"refs":[{"id":"ref-for-paintrenderingcontext2d\u2460\u2468"}],"title":"11. Changes"}],"url":"#paintrenderingcontext2d"},
"paintrenderingcontext2d-alpha": {"dfnID":"paintrenderingcontext2d-alpha","dfnText":"alpha","external":false,"refSections":[{"refs":[{"id":"ref-for-paintrenderingcontext2d-alpha"}],"title":"6. The 2D rendering context"}],"url":"#paintrenderingcontext2d-alpha"},
"paintrenderingcontext2d-output-bitmap": {"dfnID":"paintrenderingcontext2d-output-bitmap","dfnText":"output bitmap","external":false,"refSections":[{"refs":[{"id":"ref-for-paintrenderingcontext2d-output-bitmap"},{"id":"ref-for-paintrenderingcontext2d-output-bitmap\u2460"},{"id":"ref-for-paintrenderingcontext2d-output-bitmap\u2461"},{"id":"ref-for-paintrenderingcontext2d-output-bitmap\u2462"},{"id":"ref-for-paintrenderingcontext2d-output-bitmap\u2463"},{"id":"ref-for-paintrenderingcontext2d-output-bitmap\u2464"}],"title":"6. The 2D rendering context"}],"url":"#paintrenderingcontext2d-output-bitmap"},
"paintsize": {"dfnID":"paintsize","dfnText":"PaintSize","external":false,"refSections":[{"refs":[{"id":"ref-for-paintsize"}],"title":"4. Registering Custom Paint"},{"refs":[{"id":"ref-for-paintsize\u2460"},{"id":"ref-for-paintsize\u2461"}],"title":"7. Drawing an image"}],"url":"#paintsize"},
"paintworkletglobalscope": {"dfnID":"paintworkletglobalscope","dfnText":"PaintWorkletGlobalScope","external":false,"refSections":[{"refs":[{"id":"ref-for-paintworkletglobalscope"},{"id":"ref-for-paintworkletglobalscope\u2460"},{"id":"ref-for-paintworkletglobalscope\u2461"}],"title":"2. Paint Worklet"},{"refs":[{"id":"ref-for-paintworkletglobalscope\u2462"}],"title":"3. Concepts"},{"refs":[{"id":"ref-for-paintworkletglobalscope\u2463"},{"id":"ref-for-paintworkletglobalscope\u2464"},{"id":"ref-for-paintworkletglobalscope\u2465"}],"title":"4. Registering Custom Paint"},{"refs":[{"id":"ref-for-paintworkletglobalscope\u2466"},{"id":"ref-for-paintworkletglobalscope\u2467"}],"title":"7. Drawing an image"},{"refs":[{"id":"ref-for-paintworkletglobalscope\u2468"},{"id":"ref-for-paintworkletglobalscope\u2460\u24ea"},{"id":"ref-for-paintworkletglobalscope\u2460\u2460"}],"title":"7.1. Global Scope Selection"}],"url":"#paintworkletglobalscope"},
};

document.addEventListener("DOMContentLoaded", ()=>{
    genAllDfnPanels();

    document.body.addEventListener("click", (e) => {
        // If not handled already, just hide all dfn panels.
        hideAllDfnPanels();
    });
});

window.addEventListener("resize", () => {
    // Pin any visible dfn panel
    queryAll(".dfn-panel.on, .dfn-panel.activated").forEach(el=>positionDfnPanel(el));
});

function genAllDfnPanels() {
    for(const panelData of Object.values(dfnPanelData)) {
        const dfnID = panelData.dfnID;
        const dfn = document.getElementById(dfnID);
        if(!dfn) {
            console.log(`Can't find dfn#${dfnID}.`, panelData);
            continue;
        }
        dfn.panelData = panelData;
        insertDfnPopupAction(dfn);
    }
}

function genDfnPanel(dfn, { dfnID, url, dfnText, refSections, external }) {
    const dfnPanel = mk.aside({
        class: "dfn-panel on",
        id: `infopanel-for-${dfnID}`,
        "data-for": dfnID,
        "aria-labelled-by":`infopaneltitle-for-${dfnID}`,
        },
        mk.span({id:`infopaneltitle-for-${dfnID}`, style:"display:none"},
            `Info about the '${dfnText}' ${external?"external":""} reference.`),
        mk.a({href:url, class:"dfn-link"}, url),
        refSections.length == 0 ? [] :
            mk.b({}, "Referenced in:"),
            mk.ul({},
                ...refSections.map(section=>
                    mk.li({},
                        ...section.refs.map((ref, refI)=>
                            [
                                mk.a({ href: `#${ref.id}` },
                                    (refI == 0) ? section.title : `(${refI + 1})`
                                ),
                                " ",
                            ]
                        ),
                    ),
                ),
            ),
        genLinkingSyntaxes(dfn),
    );

    dfnPanel.addEventListener('click', (event) => {
        if (event.target.nodeName == 'A') {
            scrollToTargetAndHighlight(event);
            pinDfnPanel(dfnPanel);
        }
        event.stopPropagation();
        refocusOnTarget(event);
    });
    dfnPanel.addEventListener('keydown', (event) => {
        if(event.keyCode == 27) { // Escape key
            hideDfnPanel({dfnPanel});
            event.stopPropagation();
            event.preventDefault();
        }
    });

    dfnPanel.dfn = dfn;
    dfn.dfnPanel = dfnPanel;
    return dfnPanel;
}



function hideAllDfnPanels() {
    // Delete the currently-active dfn panel.
    queryAll(".dfn-panel").forEach(dfnPanel=>hideDfnPanel({dfnPanel}));
}

function showDfnPanel(dfn) {
    hideAllDfnPanels(); // Only display one at a time.

    dfn.setAttribute("aria-expanded", "true");

    const dfnPanel = genDfnPanel(dfn, dfn.panelData);

    // Give the dfn a unique tabindex, and then
    // give all the tabbable panel bits successive indexes.
    let tabIndex = 100;
    dfn.tabIndex = tabIndex++;
    const tabbable = dfnPanel.querySelectorAll(":is(a, button)");
    for (const el of tabbable) {
        el.tabIndex = tabIndex++;
    }

    append(document.body, dfnPanel);
    positionDfnPanel(dfnPanel);
}

function positionDfnPanel(dfnPanel) {
    const dfn = dfnPanel.dfn;
    const dfnPos = getBounds(dfn);
    dfnPanel.style.top = dfnPos.bottom + "px";
    dfnPanel.style.left = dfnPos.left + "px";

    const panelPos = dfnPanel.getBoundingClientRect();
    const panelMargin = 8;
    const maxRight = document.body.parentNode.clientWidth - panelMargin;
    if (panelPos.right > maxRight) {
        const overflowAmount = panelPos.right - maxRight;
        const newLeft = Math.max(panelMargin, dfnPos.left - overflowAmount);
        dfnPanel.style.left = newLeft + "px";
    }
}

function pinDfnPanel(dfnPanel) {
    // Switch it to "activated" state, which pins it.
    dfnPanel.classList.add("activated");
    dfnPanel.style.position = "fixed";
    dfnPanel.style.left = null;
    dfnPanel.style.top = null;
}

function hideDfnPanel({dfn, dfnPanel}) {
    if(!dfnPanel) dfnPanel = dfn.dfnPanel;
    if(!dfn) dfn = dfnPanel.dfn;
    dfn.dfnPanel = undefined;
    dfnPanel.dfn = undefined;
    dfn.setAttribute("aria-expanded", "false");
    dfn.tabIndex = undefined;
    dfnPanel.remove()
}

function toggleDfnPanel(dfn) {
    if(dfn.dfnPanel) {
        hideDfnPanel(dfn);
    } else {
        showDfnPanel(dfn);
    }
}

function insertDfnPopupAction(dfn) {
    dfn.setAttribute('role', 'button');
    dfn.setAttribute('aria-expanded', 'false')
    dfn.tabIndex = 0;
    dfn.classList.add('has-dfn-panel');
    dfn.addEventListener('click', (event) => {
        toggleDfnPanel(dfn);
        event.stopPropagation();
    });
    dfn.addEventListener('keypress', (event) => {
        const kc = event.keyCode;
        // 32->Space, 13->Enter
        if(kc == 32 || kc == 13) {
            toggleDfnPanel(dfn);
            event.stopPropagation();
            event.preventDefault();
        }
    });
}

function refocusOnTarget(event) {
    const target = event.target;
    setTimeout(() => {
        // Refocus on the event.target element.
        // This is needed after browser scrolls to the destination.
        target.focus();
    });
}

// TODO: shared util
// Returns the root-level absolute position {left and top} of element.
function getBounds(el, relativeTo=document.body) {
    const relativeRect = relativeTo.getBoundingClientRect();
    const elRect = el.getBoundingClientRect();
    const top = elRect.top - relativeRect.top;
    const left = elRect.left - relativeRect.left;
    return {
        top,
        left,
        bottom: top + elRect.height,
        right: left + elRect.width,
    }
}

function scrollToTargetAndHighlight(event) {
    let hash = event.target.hash;
    if (hash) {
        hash = decodeURIComponent(hash.substring(1));
        const dest = document.getElementById(hash);
        if (dest) {
            dest.classList.add('highlighted');
            setTimeout(() => dest.classList.remove('highlighted'), 1000);
        }
    }
}

// Functions, divided by link type, that wrap an autolink's
// contents with the appropriate outer syntax.
// Alternately, a string naming another type they format
// the same as.
function needsFor(type) {
    switch(type) {
        case "descriptor":
        case "value":
        case "element-attr":
        case "attr-value":
        case "element-state":
        case "method":
        case "constructor":
        case "argument":
        case "attribute":
        case "const":
        case "dict-member":
        case "event":
        case "enum-value":
        case "stringifier":
        case "serializer":
        case "iterator":
        case "maplike":
        case "setlike":
        case "state":
        case "mode":
        case "context":
        case "facet": return true;

        default: return false;
    }
}
function refusesFor(type) {
    switch(type) {
        case "property":
        case "element":
        case "interface":
        case "namespace":
        case "callback":
        case "dictionary":
        case "enum":
        case "exception":
        case "typedef":
        case "http-header":
        case "permission": return true;

        default: return false;
    }
}
function linkFormatterFromType(type) {
    switch(type) {
        case 'scheme':
        case 'permission':
        case 'dfn': return (text) => `[=${text}=]`;

        case 'abstract-op': return (text) => `[\$${text}\$]`;

        case 'function':
        case 'at-rule':
        case 'selector':
        case 'value': return (text) => `''${text}''`;

        case 'http-header': return (text) => `[:${text}:]`;

        case 'interface':
        case 'constructor':
        case 'method':
        case 'argument':
        case 'attribute':
        case 'callback':
        case 'dictionary':
        case 'dict-member':
        case 'enum':
        case 'enum-value':
        case 'exception':
        case 'const':
        case 'typedef':
        case 'stringifier':
        case 'serializer':
        case 'iterator':
        case 'maplike':
        case 'setlike':
        case 'extended-attribute':
        case 'event':
        case 'idl': return (text) => `{{${text}}}`;

        case 'element-state':
        case 'element-attr':
        case 'attr-value':
        case 'element': return (element) => `<{${element}}>`;

        case 'grammar': return (text) => `${text} (within a <pre class=prod>)`;

        case 'type': return (text)=> `<<${text}>>`;

        case 'descriptor':
        case 'property': return (text) => `'${text}'`;

        default: return;
    };
};

function genLinkingSyntaxes(dfn) {
    if(dfn.tagName != "DFN") return;

    const type = dfn.getAttribute('data-dfn-type');
    if(!type) {
        console.log(`<dfn> doesn't have a data-dfn-type:`, dfn);
        return [];
    }

    // Return a function that wraps link text based on the type
    const linkFormatter = linkFormatterFromType(type);
    if(!linkFormatter) {
        console.log(`<dfn> has an unknown data-dfn-type:`, dfn);
        return [];
    }

    let ltAlts;
    if(dfn.hasAttribute('data-lt')) {
        ltAlts = dfn.getAttribute('data-lt')
            .split("|")
            .map(x=>x.trim());
    } else {
        ltAlts = [dfn.textContent.trim()];
    }
    if(type == "type") {
        // lt of "<foo>", but "foo" is the interior;
        // <<foo/bar>> is how you write it with a for,
        // not <foo/<bar>> or whatever.
        for(var i = 0; i < ltAlts.length; i++) {
            const lt = ltAlts[i];
            const match = /<(.*)>/.exec(lt);
            if(match) { ltAlts[i] = match[1]; }
        }
    }

    let forAlts;
    if(dfn.hasAttribute('data-dfn-for')) {
        forAlts = dfn.getAttribute('data-dfn-for')
            .split(",")
            .map(x=>x.trim());
    } else {
        forAlts = [''];
    }

    let linkingSyntaxes = [];
    if(!needsFor(type)) {
        for(const lt of ltAlts) {
            linkingSyntaxes.push(linkFormatter(lt));
        }
    }
    if(!refusesFor(type)) {
        for(const f of forAlts) {
            linkingSyntaxes.push(linkFormatter(`${f}/${ltAlts[0]}`))
        }
    }
    return [
        mk.b({}, 'Possible linking syntaxes:'),
        mk.ul({},
            ...linkingSyntaxes.map(link => {
                const copyLink = async () =>
                    await navigator.clipboard.writeText(link);
                return mk.li({},
                    mk.div({ class: 'link-item' },
                        mk.button({
                            class: 'copy-icon', title: 'Copy',
                            type: 'button',
                            _onclick: copyLink,
                            tabindex: 0,
                        }, mk.span({ class: 'icon' }) ),
                        mk.span({}, link)
                    )
                );
            })
        )
    ];
}
}
</script>
<script>/* Boilerplate: script-position-annos */
"use strict";
{
function repositionAnnoPanels(){
    const panels = [...document.querySelectorAll("[data-anno-for]")];
    hydratePanels(panels);
    let vSoFar = 0;
    for(const panel of panels.sort(cmpTops)) {
        if(panel.top < vSoFar) {
            panel.top = vSoFar;
            panel.style.top = vSoFar + "px";
        }
        vSoFar = panel.top + panel.height + 15;
    }
}
function hydratePanels(panels) {
    const main = document.querySelector("main");
    let mainRect;
    if(main) mainRect = main.getBoundingClientRect();
    // First display them all, if they're not already visible.
    for(const panel of panels) {
        panel.classList.remove("unpositioned");
    }
    // Measure them all
    for(const panel of panels) {
        const dfn = document.getElementById(panel.getAttribute("data-anno-for"));
        if(!dfn) {
            console.log("Can't find the annotation panel target:", panel);
            continue;
        }
        panel.dfn = dfn;
        panel.top = window.scrollY + dfn.getBoundingClientRect().top;
        let panelRect = panel.getBoundingClientRect();
        panel.height = panelRect.height;
        if(main) {
            panel.overlappingMain = panelRect.left < mainRect.right;
        } else {
            panel.overlappingMain = false;
        }
    }
    // And finally position them
    for(const panel of panels) {
        const dfn = panel.dfn;
        if(!dfn) continue;
        panel.style.top = panel.top + "px";
        panel.classList.toggle("overlapping-main", panel.overlappingMain);
    }
}

function cmpTops(a,b) {
    return a.top - b.top;
}

window.addEventListener("load", repositionAnnoPanels);
window.addEventListener("resize", repositionAnnoPanels);
}
</script>
<script>/* Boilerplate: script-ref-hints */
"use strict";
{
let refsData = {
"#create-a-paintrenderingcontext2d-object": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"css-paint-api","spec":"css-paint-api-1","status":"local","text":"create a paintrenderingcontext2d object","type":"dfn","url":"#create-a-paintrenderingcontext2d-object"},
"#dictdef-paintrenderingcontext2dsettings": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"css-paint-api","spec":"css-paint-api-1","status":"local","text":"PaintRenderingContext2DSettings","type":"dictionary","url":"#dictdef-paintrenderingcontext2dsettings"},
"#document-paint-definition": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"css-paint-api","spec":"css-paint-api-1","status":"local","text":"document paint definition","type":"dfn","url":"#document-paint-definition"},
"#document-paint-definition-input-argument-syntaxes": {"export":true,"for_":["document paint definition"],"level":"1","normative":true,"shortname":"css-paint-api","spec":"css-paint-api-1","status":"local","text":"input argument syntaxes","type":"dfn","url":"#document-paint-definition-input-argument-syntaxes"},
"#document-paint-definition-input-properties": {"export":true,"for_":["document paint definition"],"level":"1","normative":true,"shortname":"css-paint-api","spec":"css-paint-api-1","status":"local","text":"input properties","type":"dfn","url":"#document-paint-definition-input-properties"},
"#document-paint-definition-paintrenderingcontext2dsettings-object": {"export":true,"for_":["document paint definition"],"level":"1","normative":true,"shortname":"css-paint-api","spec":"css-paint-api-1","status":"local","text":"paintrenderingcontext2dsettings object","type":"dfn","url":"#document-paint-definition-paintrenderingcontext2dsettings-object"},
"#document-paint-definitions": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"css-paint-api","spec":"css-paint-api-1","status":"local","text":"document paint definitions","type":"dfn","url":"#document-paint-definitions"},
"#dom-css-paintworklet": {"export":true,"for_":["CSS"],"level":"1","normative":true,"shortname":"css-paint-api","spec":"css-paint-api-1","status":"local","text":"paintWorklet","type":"attribute","url":"#dom-css-paintworklet"},
"#dom-paintrenderingcontext2dsettings-alpha": {"export":true,"for_":["PaintRenderingContext2DSettings"],"level":"1","normative":true,"shortname":"css-paint-api","spec":"css-paint-api-1","status":"local","text":"alpha","type":"dict-member","url":"#dom-paintrenderingcontext2dsettings-alpha"},
"#dom-paintworkletglobalscope-devicepixelratio": {"export":true,"for_":["PaintWorkletGlobalScope"],"level":"1","normative":true,"shortname":"css-paint-api","spec":"css-paint-api-1","status":"local","text":"devicePixelRatio","type":"attribute","url":"#dom-paintworkletglobalscope-devicepixelratio"},
"#dom-paintworkletglobalscope-registerpaint": {"export":true,"for_":["PaintWorkletGlobalScope"],"level":"1","normative":true,"shortname":"css-paint-api","spec":"css-paint-api-1","status":"local","text":"registerPaint(name, paintCtor)","type":"method","url":"#dom-paintworkletglobalscope-registerpaint"},
"#draw-a-paint-image": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"css-paint-api","spec":"css-paint-api-1","status":"local","text":"draw a paint image","type":"dfn","url":"#draw-a-paint-image"},
"#funcdef-paint": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"css-paint-api","spec":"css-paint-api-1","status":"local","text":"paint()","type":"function","url":"#funcdef-paint"},
"#invoke-a-paint-callback": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"css-paint-api","spec":"css-paint-api-1","status":"local","text":"invoke a paint callback","type":"dfn","url":"#invoke-a-paint-callback"},
"#paint-class-instances": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"css-paint-api","spec":"css-paint-api-1","status":"local","text":"paint class instances","type":"dfn","url":"#paint-class-instances"},
"#paint-definition": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"css-paint-api","spec":"css-paint-api-1","status":"local","text":"paint definition","type":"dfn","url":"#paint-definition"},
"#paint-definition-class-constructor": {"export":true,"for_":["paint definition"],"level":"1","normative":true,"shortname":"css-paint-api","spec":"css-paint-api-1","status":"local","text":"class constructor","type":"dfn","url":"#paint-definition-class-constructor"},
"#paint-definition-constructor-valid-flag": {"export":true,"for_":["paint definition"],"level":"1","normative":true,"shortname":"css-paint-api","spec":"css-paint-api-1","status":"local","text":"constructor valid flag","type":"dfn","url":"#paint-definition-constructor-valid-flag"},
"#paint-definition-input-properties": {"export":true,"for_":["paint definition"],"level":"1","normative":true,"shortname":"css-paint-api","spec":"css-paint-api-1","status":"local","text":"input properties","type":"dfn","url":"#paint-definition-input-properties"},
"#paint-definition-paint-function": {"export":true,"for_":["paint definition"],"level":"1","normative":true,"shortname":"css-paint-api","spec":"css-paint-api-1","status":"local","text":"paint function","type":"dfn","url":"#paint-definition-paint-function"},
"#paint-definition-paintrenderingcontext2dsettings-object": {"export":true,"for_":["paint definition"],"level":"1","normative":true,"shortname":"css-paint-api","spec":"css-paint-api-1","status":"local","text":"paintrenderingcontext2dsettings object","type":"dfn","url":"#paint-definition-paintrenderingcontext2dsettings-object"},
"#paint-definitions": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"css-paint-api","spec":"css-paint-api-1","status":"local","text":"paint definitions","type":"dfn","url":"#paint-definitions"},
"#paintrenderingcontext2d": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"css-paint-api","spec":"css-paint-api-1","status":"local","text":"PaintRenderingContext2D","type":"interface","url":"#paintrenderingcontext2d"},
"#paintrenderingcontext2d-alpha": {"export":true,"for_":["PaintRenderingContext2D"],"level":"1","normative":true,"shortname":"css-paint-api","spec":"css-paint-api-1","status":"local","text":"alpha","type":"dfn","url":"#paintrenderingcontext2d-alpha"},
"#paintrenderingcontext2d-output-bitmap": {"export":true,"for_":["PaintRenderingContext2D"],"level":"1","normative":true,"shortname":"css-paint-api","spec":"css-paint-api-1","status":"local","text":"output bitmap","type":"dfn","url":"#paintrenderingcontext2d-output-bitmap"},
"#paintsize": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"css-paint-api","spec":"css-paint-api-1","status":"local","text":"PaintSize","type":"interface","url":"#paintsize"},
"#paintworkletglobalscope": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"css-paint-api","spec":"css-paint-api-1","status":"local","text":"PaintWorkletGlobalScope","type":"interface","url":"#paintworkletglobalscope"},
"https://dom.spec.whatwg.org/#concept-document": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"dom","spec":"dom","status":"current","text":"document","type":"dfn","url":"https://dom.spec.whatwg.org/#concept-document"},
"https://drafts.css-houdini.org/css-properties-values-api-1/#consume-a-syntax-definition": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"css-properties-values-api","spec":"css-properties-values-api-1","status":"current","text":"consume a syntax definition","type":"dfn","url":"https://drafts.css-houdini.org/css-properties-values-api-1/#consume-a-syntax-definition"},
"https://drafts.css-houdini.org/css-properties-values-api-1/#syntax-definition": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"css-properties-values-api","spec":"css-properties-values-api-1","status":"current","text":"syntax definition","type":"dfn","url":"https://drafts.css-houdini.org/css-properties-values-api-1/#syntax-definition"},
"https://drafts.css-houdini.org/css-typed-om-1/#cssimagevalue": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"css-typed-om","spec":"css-typed-om-1","status":"current","text":"CSSImageValue","type":"interface","url":"https://drafts.css-houdini.org/css-typed-om-1/#cssimagevalue"},
"https://drafts.css-houdini.org/css-typed-om-1/#stylepropertymap": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"css-typed-om","spec":"css-typed-om-1","status":"current","text":"StylePropertyMap","type":"interface","url":"https://drafts.css-houdini.org/css-typed-om-1/#stylepropertymap"},
"https://drafts.css-houdini.org/css-typed-om-1/#stylepropertymapreadonly": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"css-typed-om","spec":"css-typed-om-1","status":"current","text":"StylePropertyMapReadOnly","type":"interface","url":"https://drafts.css-houdini.org/css-typed-om-1/#stylepropertymapreadonly"},
"https://drafts.csswg.org/css-backgrounds-3/#propdef-border-image": {"export":true,"for_":[],"level":"3","normative":true,"shortname":"css-backgrounds","spec":"css-backgrounds-3","status":"current","text":"border-image","type":"property","url":"https://drafts.csswg.org/css-backgrounds-3/#propdef-border-image"},
"https://drafts.csswg.org/css-cascade-5/#computed-value": {"export":true,"for_":[],"level":"5","normative":true,"shortname":"css-cascade","spec":"css-cascade-5","status":"current","text":"computed value","type":"dfn","url":"https://drafts.csswg.org/css-cascade-5/#computed-value"},
"https://drafts.csswg.org/css-display-4/#box": {"export":true,"for_":["CSS"],"level":"4","normative":true,"shortname":"css-display","spec":"css-display-4","status":"current","text":"box","type":"dfn","url":"https://drafts.csswg.org/css-display-4/#box"},
"https://drafts.csswg.org/css-images-3/#concrete-object-size": {"export":true,"for_":[],"level":"3","normative":true,"shortname":"css-images","spec":"css-images-3","status":"current","text":"concrete object size","type":"dfn","url":"https://drafts.csswg.org/css-images-3/#concrete-object-size"},
"https://drafts.csswg.org/css-images-3/#natural-dimensions": {"export":true,"for_":[],"level":"3","normative":true,"shortname":"css-images","spec":"css-images-3","status":"current","text":"natural dimension","type":"dfn","url":"https://drafts.csswg.org/css-images-3/#natural-dimensions"},
"https://drafts.csswg.org/css-images-3/#object-size-negotiation": {"export":true,"for_":[],"level":"3","normative":true,"shortname":"css-images","spec":"css-images-3","status":"current","text":"object size negotiation","type":"dfn","url":"https://drafts.csswg.org/css-images-3/#object-size-negotiation"},
"https://drafts.csswg.org/css-images-3/#typedef-image": {"export":true,"for_":[],"level":"3","normative":true,"shortname":"css-images","spec":"css-images-3","status":"current","text":"<image>","type":"type","url":"https://drafts.csswg.org/css-images-3/#typedef-image"},
"https://drafts.csswg.org/css-images-4/#invalid-image": {"export":true,"for_":[],"level":"4","normative":true,"shortname":"css-images","spec":"css-images-4","status":"current","text":"invalid image","type":"dfn","url":"https://drafts.csswg.org/css-images-4/#invalid-image"},
"https://drafts.csswg.org/css-syntax-3/#function": {"export":true,"for_":["CSS"],"level":"3","normative":true,"shortname":"css-syntax","spec":"css-syntax-3","status":"current","text":"function","type":"dfn","url":"https://drafts.csswg.org/css-syntax-3/#function"},
"https://drafts.csswg.org/css-syntax-3/#typedef-declaration-value": {"export":true,"for_":[],"level":"3","normative":true,"shortname":"css-syntax","spec":"css-syntax-3","status":"current","text":"<declaration-value>","type":"type","url":"https://drafts.csswg.org/css-syntax-3/#typedef-declaration-value"},
"https://drafts.csswg.org/css-ui-4/#propdef-cursor": {"export":true,"for_":[],"level":"4","normative":true,"shortname":"css-ui","spec":"css-ui-4","status":"current","text":"cursor","type":"property","url":"https://drafts.csswg.org/css-ui-4/#propdef-cursor"},
"https://drafts.csswg.org/css-values-4/#comb-comma": {"export":true,"for_":[],"level":"4","normative":true,"shortname":"css-values","spec":"css-values-4","status":"current","text":",","type":"grammar","url":"https://drafts.csswg.org/css-values-4/#comb-comma"},
"https://drafts.csswg.org/css-values-4/#mult-opt": {"export":true,"for_":[],"level":"4","normative":true,"shortname":"css-values","spec":"css-values-4","status":"current","text":"?","type":"grammar","url":"https://drafts.csswg.org/css-values-4/#mult-opt"},
"https://drafts.csswg.org/css-values-4/#typedef-ident": {"export":true,"for_":[],"level":"4","normative":true,"shortname":"css-values","spec":"css-values-4","status":"current","text":"<ident>","type":"type","url":"https://drafts.csswg.org/css-values-4/#typedef-ident"},
"https://drafts.csswg.org/css-variables-2/#custom-property": {"export":true,"for_":[],"level":"2","normative":true,"shortname":"css-variables","spec":"css-variables-2","status":"current","text":"custom property","type":"dfn","url":"https://drafts.csswg.org/css-variables-2/#custom-property"},
"https://drafts.csswg.org/cssom-1/#namespacedef-css": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"cssom","spec":"cssom-1","status":"current","text":"CSS","type":"namespace","url":"https://drafts.csswg.org/cssom-1/#namespacedef-css"},
"https://drafts.csswg.org/cssom-1/#supported-css-property": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"cssom","spec":"cssom-1","status":"current","text":"supported css property","type":"dfn","url":"https://drafts.csswg.org/cssom-1/#supported-css-property"},
"https://drafts.csswg.org/cssom-view-1/#dom-window-devicepixelratio": {"export":true,"for_":["Window"],"level":"1","normative":true,"shortname":"cssom-view","spec":"cssom-view-1","status":"current","text":"devicePixelRatio","type":"attribute","url":"https://drafts.csswg.org/cssom-view-1/#dom-window-devicepixelratio"},
"https://html.spec.whatwg.org/multipage/canvas.html#canvascompositing": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"CanvasCompositing","type":"interface","url":"https://html.spec.whatwg.org/multipage/canvas.html#canvascompositing"},
"https://html.spec.whatwg.org/multipage/canvas.html#canvasdrawimage": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"CanvasDrawImage","type":"interface","url":"https://html.spec.whatwg.org/multipage/canvas.html#canvasdrawimage"},
"https://html.spec.whatwg.org/multipage/canvas.html#canvasdrawpath": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"CanvasDrawPath","type":"interface","url":"https://html.spec.whatwg.org/multipage/canvas.html#canvasdrawpath"},
"https://html.spec.whatwg.org/multipage/canvas.html#canvasfillstrokestyles": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"CanvasFillStrokeStyles","type":"interface","url":"https://html.spec.whatwg.org/multipage/canvas.html#canvasfillstrokestyles"},
"https://html.spec.whatwg.org/multipage/canvas.html#canvasimagedata": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"CanvasImageData","type":"interface","url":"https://html.spec.whatwg.org/multipage/canvas.html#canvasimagedata"},
"https://html.spec.whatwg.org/multipage/canvas.html#canvasimagesmoothing": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"CanvasImageSmoothing","type":"interface","url":"https://html.spec.whatwg.org/multipage/canvas.html#canvasimagesmoothing"},
"https://html.spec.whatwg.org/multipage/canvas.html#canvasimagesource": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"CanvasImageSource","type":"typedef","url":"https://html.spec.whatwg.org/multipage/canvas.html#canvasimagesource"},
"https://html.spec.whatwg.org/multipage/canvas.html#canvaspath": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"CanvasPath","type":"interface","url":"https://html.spec.whatwg.org/multipage/canvas.html#canvaspath"},
"https://html.spec.whatwg.org/multipage/canvas.html#canvaspathdrawingstyles": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"CanvasPathDrawingStyles","type":"interface","url":"https://html.spec.whatwg.org/multipage/canvas.html#canvaspathdrawingstyles"},
"https://html.spec.whatwg.org/multipage/canvas.html#canvasrect": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"CanvasRect","type":"interface","url":"https://html.spec.whatwg.org/multipage/canvas.html#canvasrect"},
"https://html.spec.whatwg.org/multipage/canvas.html#canvasrenderingcontext2d": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"CanvasRenderingContext2D","type":"interface","url":"https://html.spec.whatwg.org/multipage/canvas.html#canvasrenderingcontext2d"},
"https://html.spec.whatwg.org/multipage/canvas.html#canvasshadowstyles": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"CanvasShadowStyles","type":"interface","url":"https://html.spec.whatwg.org/multipage/canvas.html#canvasshadowstyles"},
"https://html.spec.whatwg.org/multipage/canvas.html#canvasstate": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"CanvasState","type":"interface","url":"https://html.spec.whatwg.org/multipage/canvas.html#canvasstate"},
"https://html.spec.whatwg.org/multipage/canvas.html#canvastext": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"CanvasText","type":"interface","url":"https://html.spec.whatwg.org/multipage/canvas.html#canvastext"},
"https://html.spec.whatwg.org/multipage/canvas.html#canvastextdrawingstyles": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"CanvasTextDrawingStyles","type":"interface","url":"https://html.spec.whatwg.org/multipage/canvas.html#canvastextdrawingstyles"},
"https://html.spec.whatwg.org/multipage/canvas.html#canvastransform": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"CanvasTransform","type":"interface","url":"https://html.spec.whatwg.org/multipage/canvas.html#canvastransform"},
"https://html.spec.whatwg.org/multipage/canvas.html#canvasuserinterface": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"CanvasUserInterface","type":"interface","url":"https://html.spec.whatwg.org/multipage/canvas.html#canvasuserinterface"},
"https://html.spec.whatwg.org/multipage/canvas.html#concept-canvas-set-bitmap-dimensions": {"export":false,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"set bitmap dimensions","type":"dfn","url":"https://html.spec.whatwg.org/multipage/canvas.html#concept-canvas-set-bitmap-dimensions"},
"https://html.spec.whatwg.org/multipage/canvas.html#dom-context-2d-drawimage": {"export":true,"for_":["CanvasDrawImage"],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"drawImage()","type":"method","url":"https://html.spec.whatwg.org/multipage/canvas.html#dom-context-2d-drawimage"},
"https://html.spec.whatwg.org/multipage/canvas.html#reset-the-rendering-context-to-its-default-state": {"export":false,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"reset the rendering context to its default state","type":"dfn","url":"https://html.spec.whatwg.org/multipage/canvas.html#reset-the-rendering-context-to-its-default-state"},
"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"in parallel","type":"dfn","url":"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel"},
"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"queue a task","type":"dfn","url":"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task"},
"https://html.spec.whatwg.org/multipage/worklets.html#concept-worklet-global-scopes": {"export":true,"for_":["Worklet"],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"global scopes","type":"dfn","url":"https://html.spec.whatwg.org/multipage/worklets.html#concept-worklet-global-scopes"},
"https://html.spec.whatwg.org/multipage/worklets.html#create-a-worklet-global-scope": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"create a worklet global scope","type":"dfn","url":"https://html.spec.whatwg.org/multipage/worklets.html#create-a-worklet-global-scope"},
"https://html.spec.whatwg.org/multipage/worklets.html#worklet": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"Worklet","type":"interface","url":"https://html.spec.whatwg.org/multipage/worklets.html#worklet"},
"https://html.spec.whatwg.org/multipage/worklets.html#worklet-destination-type": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"worklet destination type","type":"dfn","url":"https://html.spec.whatwg.org/multipage/worklets.html#worklet-destination-type"},
"https://html.spec.whatwg.org/multipage/worklets.html#worklet-global-scope-type": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"worklet global scope type","type":"dfn","url":"https://html.spec.whatwg.org/multipage/worklets.html#worklet-global-scope-type"},
"https://html.spec.whatwg.org/multipage/worklets.html#workletglobalscope": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"WorkletGlobalScope","type":"interface","url":"https://html.spec.whatwg.org/multipage/worklets.html#workletglobalscope"},
"https://infra.spec.whatwg.org/#list": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"list","type":"dfn","url":"https://infra.spec.whatwg.org/#list"},
"https://infra.spec.whatwg.org/#list-append": {"export":true,"for_":["list"],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"append","type":"dfn","url":"https://infra.spec.whatwg.org/#list-append"},
"https://infra.spec.whatwg.org/#list-empty": {"export":true,"for_":["list","stack","queue","set"],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"empty","type":"dfn","url":"https://infra.spec.whatwg.org/#list-empty"},
"https://infra.spec.whatwg.org/#list-iterate": {"export":true,"for_":["list","set"],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"for each","type":"dfn","url":"https://infra.spec.whatwg.org/#list-iterate"},
"https://infra.spec.whatwg.org/#map-exists": {"export":true,"for_":["map"],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"exist","type":"dfn","url":"https://infra.spec.whatwg.org/#map-exists"},
"https://infra.spec.whatwg.org/#map-get": {"export":true,"for_":["map"],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"get","type":"dfn","url":"https://infra.spec.whatwg.org/#map-get"},
"https://infra.spec.whatwg.org/#map-set": {"export":true,"for_":["map"],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"set","type":"dfn","url":"https://infra.spec.whatwg.org/#map-set"},
"https://infra.spec.whatwg.org/#ordered-map": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"map","type":"dfn","url":"https://infra.spec.whatwg.org/#ordered-map"},
"https://infra.spec.whatwg.org/#struct": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"struct","type":"dfn","url":"https://infra.spec.whatwg.org/#struct"},
"https://tc39.github.io/ecma262/#sec-construct": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"css-paint-api","spec":"","status":"anchor-block","text":"construct","type":"dfn","url":"https://tc39.github.io/ecma262/#sec-construct"},
"https://tc39.github.io/ecma262/#sec-constructor": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"css-paint-api","spec":"","status":"anchor-block","text":"constructor","type":"dfn","url":"https://tc39.github.io/ecma262/#sec-constructor"},
"https://tc39.github.io/ecma262/#sec-ecmascript-data-types-and-values": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"css-paint-api","spec":"","status":"anchor-block","text":"type","type":"dfn","url":"https://tc39.github.io/ecma262/#sec-ecmascript-data-types-and-values"},
"https://tc39.github.io/ecma262/#sec-get-o-p": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"css-paint-api","spec":"","status":"anchor-block","text":"get","type":"dfn","url":"https://tc39.github.io/ecma262/#sec-get-o-p"},
"https://tc39.github.io/ecma262/#sec-isconstructor": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"css-paint-api","spec":"","status":"anchor-block","text":"isconstructor","type":"dfn","url":"https://tc39.github.io/ecma262/#sec-isconstructor"},
"https://tc39.github.io/ecma262/#sec-native-error-types-used-in-this-standard-typeerror": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"css-paint-api","spec":"","status":"anchor-block","text":"typeerror","type":"dfn","url":"https://tc39.github.io/ecma262/#sec-native-error-types-used-in-this-standard-typeerror"},
"https://webidl.spec.whatwg.org/#Exposed": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"Exposed","type":"extended-attribute","url":"https://webidl.spec.whatwg.org/#Exposed"},
"https://webidl.spec.whatwg.org/#Global": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"Global","type":"extended-attribute","url":"https://webidl.spec.whatwg.org/#Global"},
"https://webidl.spec.whatwg.org/#SameObject": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"SameObject","type":"extended-attribute","url":"https://webidl.spec.whatwg.org/#SameObject"},
"https://webidl.spec.whatwg.org/#VoidFunction": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"VoidFunction","type":"callback","url":"https://webidl.spec.whatwg.org/#VoidFunction"},
"https://webidl.spec.whatwg.org/#dfn-callback-function": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"callback function","type":"dfn","url":"https://webidl.spec.whatwg.org/#dfn-callback-function"},
"https://webidl.spec.whatwg.org/#dfn-callback-this-value": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"callback this value","type":"dfn","url":"https://webidl.spec.whatwg.org/#dfn-callback-this-value"},
"https://webidl.spec.whatwg.org/#dfn-throw": {"export":true,"for_":["exception"],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"throw","type":"dfn","url":"https://webidl.spec.whatwg.org/#dfn-throw"},
"https://webidl.spec.whatwg.org/#idl-DOMException": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"DOMException","type":"interface","url":"https://webidl.spec.whatwg.org/#idl-DOMException"},
"https://webidl.spec.whatwg.org/#idl-DOMString": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"DOMString","type":"interface","url":"https://webidl.spec.whatwg.org/#idl-DOMString"},
"https://webidl.spec.whatwg.org/#idl-boolean": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"boolean","type":"interface","url":"https://webidl.spec.whatwg.org/#idl-boolean"},
"https://webidl.spec.whatwg.org/#idl-double": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"double","type":"interface","url":"https://webidl.spec.whatwg.org/#idl-double"},
"https://webidl.spec.whatwg.org/#idl-undefined": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"undefined","type":"interface","url":"https://webidl.spec.whatwg.org/#idl-undefined"},
"https://webidl.spec.whatwg.org/#idl-unrestricted-double": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"unrestricted double","type":"interface","url":"https://webidl.spec.whatwg.org/#idl-unrestricted-double"},
"https://webidl.spec.whatwg.org/#invalidmodificationerror": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"InvalidModificationError","type":"exception","url":"https://webidl.spec.whatwg.org/#invalidmodificationerror"},
"https://webidl.spec.whatwg.org/#invoke-a-callback-function": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"invoke","type":"dfn","url":"https://webidl.spec.whatwg.org/#invoke-a-callback-function"},
"https://webidl.spec.whatwg.org/#web-idl-arguments-list-converting": {"export":false,"for_":["Web IDL arguments list"],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"converting","type":"dfn","url":"https://webidl.spec.whatwg.org/#web-idl-arguments-list-converting"},
};

function mkRefHint(link, ref) {
    const linkText = link.textContent;
    let dfnTextElements = '';
    if (ref.text != linkText) {
        dfnTextElements =
            mk.li({},
                mk.b({}, "Term: "),
                mk.span({}, ref.text)
            );
    }
    const forList = ref.for_;
    let forListElements;
    if(forList.length == 0) {
        forListElements = [];
    } else if(forList.length == 1) {
        forListElements = mk.li({},
            mk.b({}, "For: "),
            mk.span({}, forList[0]),
        );
    } else {
        forListElements = mk.li({},
            mk.b({}, "For: "),
            mk.ul({},
                ...forList.map(forItem =>
                    mk.li({},
                        mk.span({}, forItem)
                    ),
                ),
            ),
        );
    }
    const url = ref.url;
    const safeUrl = encodeURIComponent(url);
    const hintPanel = mk.aside({
        class: "ref-hint",
        id: `ref-hint-for-${safeUrl}`,
        "data-for": url,
        "aria-labelled-by": `ref-hint-for-${safeUrl}`,
    },
        mk.ul({},
            dfnTextElements,
            mk.li({},
                mk.b({}, "URL: "),
                mk.a({ href: url, class: "ref" }, url),
            ),
            mk.li({},
                mk.b({}, "Type: "),
                mk.span({}, `${ref.type}`),
            ),
            mk.li({},
                mk.b({}, "Spec: "),
                mk.span({}, `${ref.spec ? ref.spec : ''}`),
            ),
            forListElements
        ),
    );
    hintPanel.forLink = link;
    setupRefHintEventListeners(link, hintPanel);
    return hintPanel;
}

function hideAllRefHints() {
    queryAll(".ref-hint").forEach(el=>hideRefHint(el));
}

function hideRefHint(refHint) {
    const link = refHint.forLink;
    link.setAttribute("aria-expanded", "false");
    if(refHint.teardownEventListeners) {
        refHint.teardownEventListeners();
    }
    refHint.remove();
}

function showRefHint(link) {
    if(link.classList.contains("dfn-link")) return;
    const url = link.getAttribute("href");
    const ref = refsData[url];
    if(!ref) return;

    hideAllRefHints(); // Only display one at this time.

    const refHint = mkRefHint(link, ref);
    append(document.body, refHint);
    link.setAttribute("aria-expanded", "true");
    positionRefHint(refHint);
}

function setupRefHintEventListeners(link, refHint) {
    if (refHint.teardownEventListeners) return;
    // Add event handlers to hide the refHint after the user moves away
    // from both the link and refHint, if not hovering either within one second.
    let timeout = null;
    const startHidingRefHint = (event) => {
        if (timeout) {
            clearTimeout(timeout);
        }
        timeout = setTimeout(() => {
            hideRefHint(refHint);
        }, 1000);
    }
    const resetHidingRefHint = (event) => {
        if (timeout) clearTimeout(timeout);
        timeout = null;
    };
    link.addEventListener("mouseleave", startHidingRefHint);
    link.addEventListener("mouseenter", resetHidingRefHint);
    link.addEventListener("blur", startHidingRefHint);
    link.addEventListener("focus", resetHidingRefHint);
    refHint.addEventListener("mouseleave", startHidingRefHint);
    refHint.addEventListener("mouseenter", resetHidingRefHint);
    refHint.addEventListener("blur", startHidingRefHint);
    refHint.addEventListener("focus", resetHidingRefHint);

    refHint.teardownEventListeners = () => {
        // remove event listeners
        resetHidingRefHint();
        link.removeEventListener("mouseleave", startHidingRefHint);
        link.removeEventListener("mouseenter", resetHidingRefHint);
        link.removeEventListener("blur", startHidingRefHint);
        link.removeEventListener("focus", resetHidingRefHint);
        refHint.removeEventListener("mouseleave", startHidingRefHint);
        refHint.removeEventListener("mouseenter", resetHidingRefHint);
        refHint.removeEventListener("blur", startHidingRefHint);
        refHint.removeEventListener("focus", resetHidingRefHint);
    };
}

function positionRefHint(refHint) {
    const link = refHint.forLink;
    const linkPos = getBounds(link);
    refHint.style.top = linkPos.bottom + "px";
    refHint.style.left = linkPos.left + "px";

    const panelPos = refHint.getBoundingClientRect();
    const panelMargin = 8;
    const maxRight = document.body.parentNode.clientWidth - panelMargin;
    if (panelPos.right > maxRight) {
        const overflowAmount = panelPos.right - maxRight;
        const newLeft = Math.max(panelMargin, linkPos.left - overflowAmount);
        refHint.style.left = newLeft + "px";
    }
}

// TODO: shared util
// Returns the root-level absolute position {left and top} of element.
function getBounds(el, relativeTo=document.body) {
    const relativeRect = relativeTo.getBoundingClientRect();
    const elRect = el.getBoundingClientRect();
    const top = elRect.top - relativeRect.top;
    const left = elRect.left - relativeRect.left;
    return {
        top,
        left,
        bottom: top + elRect.height,
        right: left + elRect.width,
    }
}

function showRefHintListener(e) {
    // If the target isn't in a link (or is a link),
    // just ignore it.
    let link = e.target.closest("a");
    if(!link) return;

    // If the target is in a ref-hint panel
    // (aka a link in the already-open one),
    // also just ignore it.
    if(link.closest(".ref-hint")) return;

    // Otherwise, show the panel for the link.
    showRefHint(link);
}

function hideAllHintsListener(e) {
    // If the click is inside a ref-hint panel, ignore it.
    if(e.target.closest(".ref-hint")) return;
    // Otherwise, close all the current panels.
    hideAllRefHints();
}

document.addEventListener("DOMContentLoaded", () => {
    document.body.addEventListener("mousedown", showRefHintListener);
    document.body.addEventListener("focus", showRefHintListener);

    document.body.addEventListener("click", hideAllHintsListener);
});

window.addEventListener("resize", () => {
    // Hide any open ref hint.
    hideAllRefHints();
});
}
</script>
<script>/* Boilerplate: script-var-click-highlighting */
"use strict";
{
/*
Color-choosing design:

* Colors are ordered by goodness.
* On clicking a var, give it the earliest color
    with the lowest usage in the algorithm.
* On re-clicking, re-use the var's most recent color
    if that's not currently being used elsewhere.
*/

const COLOR_COUNT = 7;

document.addEventListener("click", e=>{
    if(e.target.nodeName == "VAR") {
        highlightSameAlgoVars(e.target);
    }
});

function highlightSameAlgoVars(v) {
    // Find the algorithm container.
    let algoContainer = findAlgoContainer(v);

    // Not highlighting document-global vars,
    // too likely to be unrelated.
    if(algoContainer == null) return;

    const varName = nameFromVar(v);
    if(!v.hasAttribute("data-var-color")) {
        const newColor = chooseHighlightColor(algoContainer, v);
        for(const el of algoContainer.querySelectorAll("var")) {
            if(nameFromVar(el) == varName) {
                el.setAttribute("data-var-color", newColor);
                el.setAttribute("data-var-last-color", newColor);
            }
        }
    } else {
        for(const el of algoContainer.querySelectorAll("var")) {
            if(nameFromVar(el) == varName) {
                el.removeAttribute("data-var-color");
            }
        }
    }
}
function findAlgoContainer(el) {
    while(el != document.body) {
        if(el.hasAttribute("data-algorithm")) return el;
        el = el.parentNode;
    }
    return null;
}
function nameFromVar(el) {
    return el.textContent.replace(/(\s|\xa0)+/g, " ").trim();
}
function colorCountsFromContainer(container) {
    const namesFromColor = Array.from({length:COLOR_COUNT}, x=>new Set());
    for(let v of container.querySelectorAll("var[data-var-color]")) {
        let color = +v.getAttribute("data-var-color");
        namesFromColor[color].add(nameFromVar(v));
    }

    return namesFromColor.map(x=>x.size);
}
function leastUsedColor(colors) {
    // Find the earliest color with the lowest count.
    let minCount = Infinity;
    let minColor = null;
    for(var i = 0; i < colors.length; i++) {
        if(colors[i] < minCount) {
            minColor = i;
            minCount = colors[i];
        }
    }
    return minColor;
}
function chooseHighlightColor(container, v) {
    const colorCounts = colorCountsFromContainer(container);
    if(v.hasAttribute("data-var-last-color")) {
        let color = +v.getAttribute("data-var-last-color");
        if(colorCounts[color] == 0) return color;
    }
    return leastUsedColor(colorCounts);
}
}
</script>