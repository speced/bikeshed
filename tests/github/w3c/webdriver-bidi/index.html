<!doctype html><html lang="en">
 <head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
  <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
  <title>WebDriver BiDi</title>
  <meta content="ED" name="w3c-status">
  <link href="https://www.w3.org/StyleSheets/TR/2021/W3C-ED" rel="stylesheet">
  <link href="https://w3c.github.io/webdriver-bidi/" rel="canonical">
  <link href="https://www.w3.org/2008/site/images/favicon.ico" rel="icon">
  <meta content="dark light" name="color-scheme">
  <link href="https://www.w3.org/StyleSheets/TR/2021/dark.css" media="(prefers-color-scheme: dark)" rel="stylesheet" type="text/css">
<style>/* Boilerplate: style-autolinks */
.css.css, .property.property, .descriptor.descriptor {
    color: var(--a-normal-text);
    font-size: inherit;
    font-family: inherit;
}
.css::before, .property::before, .descriptor::before {
    content: "‘";
}
.css::after, .property::after, .descriptor::after {
    content: "’";
}
.property, .descriptor {
    /* Don't wrap property and descriptor names */
    white-space: nowrap;
}
.type { /* CSS value <type> */
    font-style: italic;
}
pre .property::before, pre .property::after {
    content: "";
}
[data-link-type="property"]::before,
[data-link-type="propdesc"]::before,
[data-link-type="descriptor"]::before,
[data-link-type="value"]::before,
[data-link-type="function"]::before,
[data-link-type="at-rule"]::before,
[data-link-type="selector"]::before,
[data-link-type="maybe"]::before {
    content: "‘";
}
[data-link-type="property"]::after,
[data-link-type="propdesc"]::after,
[data-link-type="descriptor"]::after,
[data-link-type="value"]::after,
[data-link-type="function"]::after,
[data-link-type="at-rule"]::after,
[data-link-type="selector"]::after,
[data-link-type="maybe"]::after {
    content: "’";
}

[data-link-type].production::before,
[data-link-type].production::after,
.prod [data-link-type]::before,
.prod [data-link-type]::after {
    content: "";
}

[data-link-type=element],
[data-link-type=element-attr] {
    font-family: Menlo, Consolas, "DejaVu Sans Mono", monospace;
    font-size: .9em;
}
[data-link-type=element]::before { content: "<" }
[data-link-type=element]::after  { content: ">" }

[data-link-type=biblio] {
    white-space: pre;
}

@media (prefers-color-scheme: dark) {
    :root {
        --selflink-text: black;
        --selflink-bg: silver;
        --selflink-hover-text: white;
    }
}
</style>
<style>/* Boilerplate: style-colors */
/* Any --*-text not paired with a --*-bg is assumed to have a transparent bg */
:root {
    color-scheme: light dark;

    --text: black;
    --bg: white;

    --unofficial-watermark: url(https://www.w3.org/StyleSheets/TR/2016/logos/UD-watermark);

    --logo-bg: #1a5e9a;
    --logo-active-bg: #c00;
    --logo-text: white;

    --tocnav-normal-text: #707070;
    --tocnav-normal-bg: var(--bg);
    --tocnav-hover-text: var(--tocnav-normal-text);
    --tocnav-hover-bg: #f8f8f8;
    --tocnav-active-text: #c00;
    --tocnav-active-bg: var(--tocnav-normal-bg);

    --tocsidebar-text: var(--text);
    --tocsidebar-bg: #f7f8f9;
    --tocsidebar-shadow: rgba(0,0,0,.1);
    --tocsidebar-heading-text: hsla(203,20%,40%,.7);

    --toclink-text: var(--text);
    --toclink-underline: #3980b5;
    --toclink-visited-text: var(--toclink-text);
    --toclink-visited-underline: #054572;

    --heading-text: #005a9c;

    --hr-text: var(--text);

    --algo-border: #def;

    --del-text: red;
    --del-bg: transparent;
    --ins-text: #080;
    --ins-bg: transparent;

    --a-normal-text: #034575;
    --a-normal-underline: #bbb;
    --a-visited-text: var(--a-normal-text);
    --a-visited-underline: #707070;
    --a-hover-bg: rgba(75%, 75%, 75%, .25);
    --a-active-text: #c00;
    --a-active-underline: #c00;

    --blockquote-border: silver;
    --blockquote-bg: transparent;
    --blockquote-text: currentcolor;

    --issue-border: #e05252;
    --issue-bg: #fbe9e9;
    --issue-text: var(--text);
    --issueheading-text: #831616;

    --example-border: #e0cb52;
    --example-bg: #fcfaee;
    --example-text: var(--text);
    --exampleheading-text: #574b0f;

    --note-border: #52e052;
    --note-bg: #e9fbe9;
    --note-text: var(--text);
    --noteheading-text: hsl(120, 70%, 30%);
    --notesummary-underline: silver;

    --assertion-border: #aaa;
    --assertion-bg: #eee;
    --assertion-text: black;

    --advisement-border: orange;
    --advisement-bg: #fec;
    --advisement-text: var(--text);
    --advisementheading-text: #b35f00;

    --warning-border: red;
    --warning-bg: hsla(40,100%,50%,0.95);
    --warning-text: var(--text);

    --amendment-border: #330099;
    --amendment-bg: #F5F0FF;
    --amendment-text: var(--text);
    --amendmentheading-text: #220066;

    --def-border: #8ccbf2;
    --def-bg: #def;
    --def-text: var(--text);
    --defrow-border: #bbd7e9;

    --datacell-border: silver;

    --indexinfo-text: #707070;

    --indextable-hover-text: black;
    --indextable-hover-bg: #f7f8f9;

    --outdatedspec-bg: rgba(0, 0, 0, .5);
    --outdatedspec-text: black;
    --outdated-bg: maroon;
    --outdated-text: white;
    --outdated-shadow: red;

    --editedrec-bg: darkorange;
}

@media (prefers-color-scheme: dark) {
    :root {
        --text: #ddd;
        --bg: black;

        --unofficial-watermark: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='400'%3E%3Cg fill='%23100808' transform='translate(200 200) rotate(-45) translate(-200 -200)' stroke='%23100808' stroke-width='3'%3E%3Ctext x='50%25' y='220' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EUNOFFICIAL%3C/text%3E%3Ctext x='50%25' y='305' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EDRAFT%3C/text%3E%3C/g%3E%3C/svg%3E");

        --logo-bg: #1a5e9a;
        --logo-active-bg: #c00;
        --logo-text: white;

        --tocnav-normal-text: #999;
        --tocnav-normal-bg: var(--bg);
        --tocnav-hover-text: var(--tocnav-normal-text);
        --tocnav-hover-bg: #080808;
        --tocnav-active-text: #f44;
        --tocnav-active-bg: var(--tocnav-normal-bg);

        --tocsidebar-text: var(--text);
        --tocsidebar-bg: #080808;
        --tocsidebar-shadow: rgba(255,255,255,.1);
        --tocsidebar-heading-text: hsla(203,20%,40%,.7);

        --toclink-text: var(--text);
        --toclink-underline: #6af;
        --toclink-visited-text: var(--toclink-text);
        --toclink-visited-underline: #054572;

        --heading-text: #8af;

        --hr-text: var(--text);

        --algo-border: #456;

        --del-text: #f44;
        --del-bg: transparent;
        --ins-text: #4a4;
        --ins-bg: transparent;

        --a-normal-text: #6af;
        --a-normal-underline: #555;
        --a-visited-text: var(--a-normal-text);
        --a-visited-underline: var(--a-normal-underline);
        --a-hover-bg: rgba(25%, 25%, 25%, .2);
        --a-active-text: #f44;
        --a-active-underline: var(--a-active-text);

        --borderedblock-bg: rgba(255, 255, 255, .05);

        --blockquote-border: silver;
        --blockquote-bg: var(--borderedblock-bg);
        --blockquote-text: currentcolor;

        --issue-border: #e05252;
        --issue-bg: var(--borderedblock-bg);
        --issue-text: var(--text);
        --issueheading-text: hsl(0deg, 70%, 70%);

        --example-border: hsl(50deg, 90%, 60%);
        --example-bg: var(--borderedblock-bg);
        --example-text: var(--text);
        --exampleheading-text: hsl(50deg, 70%, 70%);

        --note-border: hsl(120deg, 100%, 35%);
        --note-bg: var(--borderedblock-bg);
        --note-text: var(--text);
        --noteheading-text: hsl(120, 70%, 70%);
        --notesummary-underline: silver;

        --assertion-border: #444;
        --assertion-bg: var(--borderedblock-bg);
        --assertion-text: var(--text);

        --advisement-border: orange;
        --advisement-bg: #222218;
        --advisement-text: var(--text);
        --advisementheading-text: #f84;

        --warning-border: red;
        --warning-bg: hsla(40,100%,20%,0.95);
        --warning-text: var(--text);

        --amendment-border: #330099;
        --amendment-bg: #080010;
        --amendment-text: var(--text);
        --amendmentheading-text: #cc00ff;

        --def-border: #8ccbf2;
        --def-bg: #080818;
        --def-text: var(--text);
        --defrow-border: #136;

        --datacell-border: silver;

        --indexinfo-text: #aaa;

        --indextable-hover-text: var(--text);
        --indextable-hover-bg: #181818;

        --outdatedspec-bg: rgba(255, 255, 255, .5);
        --outdatedspec-text: black;
        --outdated-bg: maroon;
        --outdated-text: white;
        --outdated-shadow: red;

        --editedrec-bg: darkorange;
    }
    /* In case a transparent-bg image doesn't expect to be on a dark bg,
       which is quite common in practice... */
    img { background: white; }
}
</style>
<style>/* Boilerplate: style-counters */
body {
    counter-reset: example figure issue;
}
.issue {
    counter-increment: issue;
}
.issue:not(.no-marker)::before {
    content: "Issue " counter(issue);
}

.example {
    counter-increment: example;
}
.example:not(.no-marker)::before {
    content: "Example " counter(example);
}
.invalid.example:not(.no-marker)::before,
.illegal.example:not(.no-marker)::before {
    content: "Invalid Example" counter(example);
}

figcaption {
    counter-increment: figure;
}
figcaption:not(.no-marker)::before {
    content: "Figure " counter(figure) " ";
}
</style>
<style>/* Boilerplate: style-dfn-panel */
:root {
    --dfnpanel-bg: #ddd;
    --dfnpanel-text: var(--text);
    --dfnpanel-target-bg: #ffc;
    --dfnpanel-target-outline: orange;
}
@media (prefers-color-scheme: dark) {
    :root {
        --dfnpanel-bg: #222;
        --dfnpanel-text: var(--text);
        --dfnpanel-target-bg: #333;
        --dfnpanel-target-outline: silver;
    }
}
.dfn-panel {
    position: absolute;
    z-index: 35;
    width: 20em;
    width: 300px;
    height: auto;
    max-height: 500px;
    overflow: auto;
    padding: 0.5em 0.75em;
    font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
    background: var(--dfnpanel-bg);
    color: var(--dfnpanel-text);
    border: outset 0.2em;
    white-space: normal; /* in case it's moved into a pre */
}
.dfn-panel:not(.on) { display: none; }
.dfn-panel * { margin: 0; padding: 0; text-indent: 0; }
.dfn-panel > b { display: block; }
.dfn-panel a { color: var(--dfnpanel-text); }
.dfn-panel a:not(:hover) { text-decoration: none !important; border-bottom: none !important; }
.dfn-panel a:focus {
    outline: 5px auto Highlight;
    outline: 5px auto -webkit-focus-ring-color;
}
.dfn-panel > b + b { margin-top: 0.25em; }
.dfn-panel ul { padding: 0 0 0 1em; list-style: none; }
.dfn-panel li a {
    max-width: calc(300px - 1.5em - 1em);
    overflow: hidden;
    text-overflow: ellipsis;
}

.dfn-panel.activated {
    display: inline-block;
    position: fixed;
    left: 8px;
    bottom: 2em;
    margin: 0 auto;
    max-width: calc(100vw - 1.5em - .4em - .5em);
    max-height: 30vh;
    transition: left 1s ease-out, bottom 1s ease-out;
}

.dfn-panel .link-item:hover {
    text-decoration: underline;
}
.dfn-panel .link-item .copy-icon {
    opacity: 0;
}
.dfn-panel .link-item:hover .copy-icon,
.dfn-panel .link-item .copy-icon:focus {
    opacity: 1;
}

.dfn-panel .copy-icon {
    display: inline-block;
    margin-right: 0.5em;
    width: 0.85em;
    height: 1em;
    border-radius: 3px;
    background-color: #ccc;
    cursor: pointer;
}

.dfn-panel .copy-icon .icon {
    width: 100%;
    height: 100%;
    background-color: #fff;
    display: flex;
    justify-content: center;
    align-items: center;
    position: relative;
}

.dfn-panel .copy-icon .icon::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    border: 1px solid black;
    background-color: #ccc;
    opacity: 0.25;
    transform: translate(3px, -3px);
}

.dfn-panel .copy-icon:active .icon::before {
    opacity: 1;
}

.dfn-paneled[role="button"] { cursor: help; }

.highlighted {
    animation: target-fade 3s;
}

@keyframes target-fade {
    from {
        background-color: var(--dfnpanel-target-bg);
        outline: 5px solid var(--dfnpanel-target-outline);
    }
    to {
        color: var(--a-normal-text);
        background-color: transparent;
        outline: transparent;
    }
}
</style>
<style>/* Boilerplate: style-issues */
a[href].issue-return {
    float: right;
    float: inline-end;
    color: var(--issueheading-text);
    font-weight: bold;
    text-decoration: none;
}
</style>
<style>/* Boilerplate: style-md-lists */
/* This is a weird hack for me not yet following the commonmark spec
   regarding paragraph and lists. */
[data-md] > :first-child {
    margin-top: 0;
}
[data-md] > :last-child {
    margin-bottom: 0;
}
</style>
<style>/* Boilerplate: style-ref-hints */
:root {
    --ref-hint-bg: #ddd;
    --ref-hint-text: var(--text);
}
@media (prefers-color-scheme: dark) {
    :root {
        --ref-hint-bg: #222;
        --ref-hint-text: var(--text);
    }
}

.ref-hint {
    display: inline-block;
    position: absolute;
    z-index: 35;
    width: 20em;
    width: 300px;
    height: auto;
    max-height: 500px;
    overflow: auto;
    padding: 0.5em 0.5em;
    font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
    background: var(--ref-hint-bg);
    color: var(--ref-hint-text);
    border: outset 0.2em;
    white-space: normal; /* in case it's moved into a pre */
}

.ref-hint * { margin: 0; padding: 0; text-indent: 0; }

.ref-hint ul { padding: 0 0 0 1em; list-style: none; }
</style>
<style>/* Boilerplate: style-selflinks */
:root {
    --selflink-text: white;
    --selflink-bg: gray;
    --selflink-hover-text: black;
}
.heading, .issue, .note, .example, li, dt {
    position: relative;
}
a.self-link {
    position: absolute;
    top: 0;
    left: calc(-1 * (3.5rem - 26px));
    width: calc(3.5rem - 26px);
    height: 2em;
    text-align: center;
    border: none;
    transition: opacity .2s;
    opacity: .5;
}
a.self-link:hover {
    opacity: 1;
}
.heading > a.self-link {
    font-size: 83%;
}
.example > a.self-link,
.note > a.self-link,
.issue > a.self-link {
    /* These blocks are overflow:auto, so positioning outside
       doesn't work. */
    left: auto;
    right: 0;
}
li > a.self-link {
    left: calc(-1 * (3.5rem - 26px) - 2em);
}
dfn > a.self-link {
    top: auto;
    left: auto;
    opacity: 0;
    width: 1.5em;
    height: 1.5em;
    background: var(--selflink-bg);
    color: var(--selflink-text);
    font-style: normal;
    transition: opacity .2s, background-color .2s, color .2s;
}
dfn:hover > a.self-link {
    opacity: 1;
}
dfn > a.self-link:hover {
    color: var(--selflink-hover-text);
}

a.self-link::before            { content: "¶"; }
.heading > a.self-link::before { content: "§"; }
dfn > a.self-link::before      { content: "#"; }
</style>
<style>/* Boilerplate: style-var-click-highlighting */
/*
Colors were chosen in Lab using https://nixsensor.com/free-color-converter/
D50 2deg illuminant, L in [0,100], a and b in [-128, 128]
0 = lab(85,0,85)
1 = lab(85,80,30)
2 = lab(85,-40,40)
3 = lab(85,-50,0)
4 = lab(85,5,15)
5 = lab(85,-10,-50)
6 = lab(85,35,-15)

For darkmode:
0 = oklab(50%   0%  108%)
1 = oklab(50% -51%   51%)
2 = oklab(50% -64%  -20%)
3 = oklab(50%   6%   19%)
4 = oklab(50% -12%  -64%)
5 = oklab(50%  44%  -19%)  
6 = oklab(50% 102%   38%)
*/

[data-algorithm] var { cursor: pointer; }
var[data-var-color] { background-color: var(--var-bg); box-shadow: 0 0 0 2px var(--var-bg); }

var[data-var-color] { --var-bg: #F4D200; }
var[data-var-color="1"] { --var-bg: #FF87A2; }
var[data-var-color="2"] { --var-bg: #96E885; }
var[data-var-color="3"] { --var-bg: #3EEED2; }
var[data-var-color="4"] { --var-bg: #EACFB6; }
var[data-var-color="5"] { --var-bg: #82DDFF; }
var[data-var-color="6"] { --var-vg: #FFBCF2; }

@media (prefers-color-scheme: dark) {
	var[data-var-color] { --var-bg: #bc1a00; }
	var[data-var-color="1"] { --var-bg: #007f00; }
	var[data-var-color="2"] { --var-bg: #008698; }
	var[data-var-color="3"] { --var-bg: #7f5b2b; }
	var[data-var-color="4"] { --var-bg: #004df3; }
	var[data-var-color="5"] { --var-bg: #a1248a; }
	var[data-var-color="6"] { --var-vg: #ff0000; }
}
</style>
 <body class="h-entry">
  <div class="head">
   <p data-fill-with="logo"><a class="logo" href="https://www.w3.org/"> <img alt="W3C" height="48" src="https://www.w3.org/StyleSheets/TR/2021/logos/W3C" width="72"> </a> </p>
   <h1 class="p-name no-ref" id="title">WebDriver BiDi</h1>
   <p id="w3c-state"><a href="https://www.w3.org/standards/types/#ED">Editor’s Draft</a>, <time class="dt-updated" datetime="1970-01-01">1 January 1970</time></p>
   <details open>
    <summary>More details about this document</summary>
    <div data-fill-with="spec-metadata">
     <dl>
      <dt>This version:
      <dd><a class="u-url" href="https://w3c.github.io/webdriver-bidi/">https://w3c.github.io/webdriver-bidi/</a>
     </dl>
    </div>
   </details>
   <div data-fill-with="warning"></div>
   <p class="copyright" data-fill-with="copyright"><a href="https://www.w3.org/policies/#copyright">Copyright</a> © 1970 <a href="https://www.w3.org/">World Wide Web Consortium</a>. <abbr title="World Wide Web Consortium">W3C</abbr><sup>®</sup> <a href="https://www.w3.org/policies/#Legal_Disclaimer">liability</a>, <a href="https://www.w3.org/policies/#W3C_Trademarks">trademark</a> and <a href="https://www.w3.org/copyright/software-license/" rel="license" title="W3C Software and Document License">permissive document license</a> rules apply. </p>
   <hr title="Separator for header">
  </div>
  <div class="p-summary" data-fill-with="abstract">
   <h2 class="no-num no-toc no-ref heading settled" id="abstract"><span class="content">Abstract</span></h2>
   <p>This document defines the BiDirectional WebDriver Protocol, a mechanism for remote control of user agents.</p>
  </div>
  <h2 class="no-num no-toc no-ref heading settled" id="sotd"><span class="content">Status of this document</span></h2>
  <div data-fill-with="status">
   <p> This is a public copy of the editors’ draft.
        It is provided for discussion only and may change at any moment.
        Its publication here does not imply endorsement of its contents by W3C.
        Don’t cite this document other than as work in progress. </p>
   <p> <a href="https://github.com/w3c/webdriver-bidi/issues">GitHub Issues</a> are preferred for discussion of this specification. </p>
   <p> This document was produced by the <a href="https://www.w3.org/groups/wg/browser-tools-testing">Browser Testing and Tools Working Group</a>. </p>
   <p> This document was produced by a group operating under
        the <a href="https://www.w3.org/Consortium/Patent-Policy-20170801/">W3C Patent Policy</a>.
        W3C maintains a <a href="https://www.w3.org/2004/01/pp-impl/32061/status" rel="disclosure">public list of any patent disclosures</a> made in connection with the deliverables of the group;
        that page also includes instructions for disclosing a patent.
        An individual who has actual knowledge of a patent which the individual believes contains <a href="https://www.w3.org/Consortium/Patent-Policy-20170801/#def-essential">Essential Claim(s)</a> must disclose the information in accordance with <a href="https://www.w3.org/Consortium/Patent-Policy-20170801/#sec-Disclosure">section 6 of the W3C Patent Policy</a>. </p>
   <p> This document is governed by the <a href="https://www.w3.org/policies/process/20231103/" id="w3c_process_revision">03 November 2023 W3C Process Document</a>. </p>
   <p></p>
  </div>
  <div data-fill-with="at-risk"></div>
  <nav data-fill-with="table-of-contents" id="toc">
   <h2 class="no-num no-toc no-ref" id="contents">Table of Contents</h2>
   <ol class="toc" role="directory">
    <li><a href="#intro"><span class="secno">1</span> <span class="content">Introduction</span></a>
    <li><a href="#infrastructure"><span class="secno">2</span> <span class="content">Infrastructure</span></a>
    <li>
     <a href="#protocol"><span class="secno">3</span> <span class="content">Protocol</span></a>
     <ol class="toc">
      <li><a href="#protocol-definition"><span class="secno">3.1</span> <span class="content">Definition</span></a>
      <li><a href="#session"><span class="secno">3.2</span> <span class="content">Session</span></a>
      <li><a href="#protocol-modules"><span class="secno">3.3</span> <span class="content">Modules</span></a>
      <li><a href="#commands"><span class="secno">3.4</span> <span class="content">Commands</span></a>
      <li><a href="#events"><span class="secno">3.5</span> <span class="content">Events</span></a>
     </ol>
    <li>
     <a href="#transport"><span class="secno">4</span> <span class="content">Transport</span></a>
     <ol class="toc">
      <li><a href="#establishing"><span class="secno">4.1</span> <span class="content">Establishing a Connection</span></a>
     </ol>
    <li>
     <a href="#data-types"><span class="secno">5</span> <span class="content">Common Data Types</span></a>
     <ol class="toc">
      <li><a href="#type-common-RemoteValue"><span class="secno">5.1</span> <span class="content">Remote Value</span></a>
     </ol>
    <li>
     <a href="#modules"><span class="secno">6</span> <span class="content">Modules</span></a>
     <ol class="toc">
      <li>
       <a href="#module-session"><span class="secno">6.1</span> <span class="content">The session Module</span></a>
       <ol class="toc">
        <li><a href="#module-session-definition"><span class="secno">6.1.1</span> <span class="content">Definition</span></a>
        <li>
         <a href="#module-session-commands"><span class="secno">6.1.2</span> <span class="content">Commands</span></a>
         <ol class="toc">
          <li><a href="#command-session-status"><span class="secno">6.1.2.1</span> <span class="content">The session.status Command</span></a>
          <li><a href="#command-session-subscribe"><span class="secno">6.1.2.2</span> <span class="content">The session.subscribe Command</span></a>
          <li><a href="#command-session-unsubscribe"><span class="secno">6.1.2.3</span> <span class="content">The session.unsubscribe Command</span></a>
         </ol>
       </ol>
      <li>
       <a href="#module-browsingContext"><span class="secno">6.2</span> <span class="content">The browsingContext Module</span></a>
       <ol class="toc">
        <li><a href="#module-browsingContext-definition"><span class="secno">6.2.1</span> <span class="content">Definition</span></a>
        <li>
         <a href="#module-browsingcontext-types"><span class="secno">6.2.2</span> <span class="content">Types</span></a>
         <ol class="toc">
          <li><a href="#type-browsingContext-Browsingcontext"><span class="secno">6.2.2.1</span> <span class="content">The browsingContext.BrowsingContext Type</span></a>
          <li><a href="#type-browsingContext-BrowsingContextInfo"><span class="secno">6.2.2.2</span> <span class="content">The browsingContext.BrowsingContextInfo Type</span></a>
         </ol>
        <li>
         <a href="#module-browsingContext-commands"><span class="secno">6.2.3</span> <span class="content">Commands</span></a>
         <ol class="toc">
          <li><a href="#command-browsingContext-list"><span class="secno">6.2.3.1</span> <span class="content">The browsingContext.getTree Command</span></a>
         </ol>
        <li>
         <a href="#module-contexts-events"><span class="secno">6.2.4</span> <span class="content">Events</span></a>
         <ol class="toc">
          <li><a href="#event-browsingContext-contextCreated"><span class="secno">6.2.4.1</span> <span class="content">The browsingContext.contextCreated Event</span></a>
          <li><a href="#event-browsingContext-contextDestroyed"><span class="secno">6.2.4.2</span> <span class="content">The browsingContext.contextDestroyed Event</span></a>
         </ol>
       </ol>
      <li>
       <a href="#module-script"><span class="secno">6.3</span> <span class="content">The script Module</span></a>
       <ol class="toc">
        <li><a href="#module-script-definition"><span class="secno">6.3.1</span> <span class="content">Definition</span></a>
        <li>
         <a href="#module-script-types"><span class="secno">6.3.2</span> <span class="content">Types</span></a>
         <ol class="toc">
          <li><a href="#type-script-Realm"><span class="secno">6.3.2.1</span> <span class="content">The script.Realm type</span></a>
          <li><a href="#type-script-RealmInfo"><span class="secno">6.3.2.2</span> <span class="content">The script.RealmInfo type</span></a>
         </ol>
        <li>
         <a href="#module-script-commands"><span class="secno">6.3.3</span> <span class="content">Commands</span></a>
         <ol class="toc">
          <li><a href="#command-script-getRealms"><span class="secno">6.3.3.1</span> <span class="content">The script.getRealms Command</span></a>
         </ol>
        <li>
         <a href="#module-script-events"><span class="secno">6.3.4</span> <span class="content">Events</span></a>
         <ol class="toc">
          <li><a href="#event-script-realmCreated"><span class="secno">6.3.4.1</span> <span class="content">The script.realmCreated Event</span></a>
          <li><a href="#event-script-realmDestroyed"><span class="secno">6.3.4.2</span> <span class="content">The script.realmDestroyed Event</span></a>
         </ol>
       </ol>
      <li>
       <a href="#module-log"><span class="secno">6.4</span> <span class="content">Log</span></a>
       <ol class="toc">
        <li><a href="#module-log-definition"><span class="secno">6.4.1</span> <span class="content">Definition</span></a>
        <li>
         <a href="#module-log-types"><span class="secno">6.4.2</span> <span class="content">Types</span></a>
         <ol class="toc">
          <li><a href="#types-log-logentry"><span class="secno">6.4.2.1</span> <span class="content">log.LogEntry</span></a>
          <li><a href="#types-log-stackframe"><span class="secno">6.4.2.2</span> <span class="content">log.StackFrame</span></a>
         </ol>
        <li>
         <a href="#module-log-events"><span class="secno">6.4.3</span> <span class="content">Events</span></a>
         <ol class="toc">
          <li><a href="#event-log-entryAdded"><span class="secno">6.4.3.1</span> <span class="content">entryAdded</span></a>
         </ol>
       </ol>
     </ol>
    <li>
     <a href="#patches"><span class="secno">7</span> <span class="content">Patches to Other Specifications</span></a>
     <ol class="toc">
      <li><a href="#patches-html"><span class="secno">7.1</span> <span class="content">HTML</span></a>
      <li><a href="#patches-console"><span class="secno">7.2</span> <span class="content">Console</span></a>
     </ol>
    <li>
     <a href="#index"><span class="secno"></span> <span class="content">Index</span></a>
     <ol class="toc">
      <li><a href="#index-defined-here"><span class="secno"></span> <span class="content">Terms defined by this specification</span></a>
      <li><a href="#index-defined-elsewhere"><span class="secno"></span> <span class="content">Terms defined by reference</span></a>
     </ol>
    <li>
     <a href="#references"><span class="secno"></span> <span class="content">References</span></a>
     <ol class="toc">
      <li><a href="#normative"><span class="secno"></span> <span class="content">Normative References</span></a>
      <li><a href="#informative"><span class="secno"></span> <span class="content">Informative References</span></a>
     </ol>
    <li><a href="#issues-index"><span class="secno"></span> <span class="content">Issues Index</span></a>
   </ol>
  </nav>
  <main>
   <h2 class="heading settled" data-level="1" id="intro"><span class="secno">1. </span><span class="content">Introduction</span><a class="self-link" href="#intro"></a></h2>
   <p><em>This section is non-normative.</em></p>
   <p><a data-link-type="biblio" href="#biblio-webdriver" title="WebDriver">WebDriver</a> defines a protocol for introspection and
remote control of user agents. This specification extends WebDriver by
introducing bidirectional communication. In place of the strict
command/response format of WebDriver, this permits events to stream
from the user agent to the controlling software, better matching the
evented nature of the browser DOM.</p>
   <h2 class="heading settled" data-level="2" id="infrastructure"><span class="secno">2. </span><span class="content">Infrastructure</span><a class="self-link" href="#infrastructure"></a></h2>
   <p>This specification depends on the Infra Standard. <a data-link-type="biblio" href="#biblio-infra" title="Infra Standard">[INFRA]</a></p>
   <p>Network protocol messages are defined using CDDL. <a data-link-type="biblio" href="#biblio-rfc8610" title="Concise Data Definition Language (CDDL): A Notational Convention to Express Concise Binary Object Representation (CBOR) and JSON Data Structures">[RFC8610]</a></p>
   <h2 class="heading settled" data-level="3" id="protocol"><span class="secno">3. </span><span class="content">Protocol</span><a class="self-link" href="#protocol"></a></h2>
   <p>This section defines the basic concepts of the WebDriver BiDi
protocol. These terms are distinct from their representation at the <a href="#transport">transport</a> layer.</p>
   <p>The protocol is defined using a <a data-link-type="biblio" href="#biblio-rfc8610" title="Concise Data Definition Language (CDDL): A Notational Convention to Express Concise Binary Object Representation (CBOR) and JSON Data Structures">CDDL</a> definition. For the
convenience of implementors two seperate CDDL definitions are defined; the <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="remote-end-definition">remote end definition</dfn> which defines the format of messages produced
on the <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-local-ends" id="ref-for-dfn-local-ends">local end</a> and consumed on the <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-remote-ends" id="ref-for-dfn-remote-ends">remote end</a>, and the <dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="local end definition" data-noexport id="local-end-definition">local end
definition</dfn> which defines the format of messages produced on the <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-remote-ends" id="ref-for-dfn-remote-ends①">remote
end</a> and consumed on the <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-local-ends" id="ref-for-dfn-local-ends①">local end</a></p>
   <h3 class="heading settled" data-level="3.1" id="protocol-definition"><span class="secno">3.1. </span><span class="content">Definition</span><a class="self-link" href="#protocol-definition"></a></h3>
   <p class="issue" id="issue-40ad1db0"><a class="self-link" href="#issue-40ad1db0"></a> Should this be an appendix?</p>
   <p>This section gives the initial contents of the <a data-link-type="dfn" href="#remote-end-definition" id="ref-for-remote-end-definition">remote end definition</a> and <a data-link-type="dfn" href="#local-end-definition" id="ref-for-local-end-definition">local end definition</a>. These are augmented by the definition fragments defined in
the remainder of the specification.</p>
   <p><a data-link-type="dfn" href="#remote-end-definition" id="ref-for-remote-end-definition①">Remote end definition</a></p>
<pre class="cddl remote-cddl">Command = {
  id: uint,
  CommandData,
  *text => any,
}

CommandData = (
  SessionCommand //
  BrowsingContextCommand
)

EmptyParams = { *text }
</pre>
   <p><a data-link-type="dfn" href="#local-end-definition" id="ref-for-local-end-definition①">Local end definition</a></p>
<pre class="cddl local-cddl">Message = (
  CommandResponse //
  ErrorResponse //
  Event
)

CommandResponse = {
  id: uint,
  result: ResultData,
  *text => any
}

ErrorResponse = {
  id: uint / null,
  error: "unknown error" / "unknown method" / "invalid argument",
  message: text,
  ?stacktrace: text,
  *text => any
}

ResultData = (
  EmptyResult //
  SessionResult //
  BrowsingContextResult //
  ScriptResult
)

EmptyResult = {}

Event = {
  EventData,
  *text => any
}

EventData = (
  BrowsingContextEvent //
  ScriptEvent
)
</pre>
   <h3 class="heading settled" data-level="3.2" id="session"><span class="secno">3.2. </span><span class="content">Session</span><a class="self-link" href="#session"></a></h3>
   <p>WebDriver BiDi uses the same <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-sessions" id="ref-for-dfn-sessions">session</a> concept as WebDriver.</p>
   <h3 class="heading settled" data-level="3.3" id="protocol-modules"><span class="secno">3.3. </span><span class="content">Modules</span><a class="self-link" href="#protocol-modules"></a></h3>
   <p>The WebDriver BiDi protocol is organized into modules.</p>
   <p>Each <dfn class="dfn-paneled" data-dfn-type="dfn" data-export id="module">module</dfn> represents a collection of related <a data-link-type="dfn" href="#command" id="ref-for-command">commands</a> and <a data-link-type="dfn" href="#event" id="ref-for-event">events</a> pertaining to a certain aspect of the user
agent. For example, a module might contain functionality for inspecting and
manipulating the DOM, or for script execution.</p>
   <p>Each module has a <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="module-name">module name</dfn> which is a string. The <a data-link-type="dfn" href="#command-command-name" id="ref-for-command-command-name">command name</a> and <a data-link-type="dfn" href="#event-event-name" id="ref-for-event-event-name">event name</a> for commands and events defined in the
module start with the <a data-link-type="dfn" href="#module-name" id="ref-for-module-name">module name</a> followed by a period "<code>.</code>".</p>
   <p>Modules which contain <a data-link-type="dfn" href="#command" id="ref-for-command①">commands</a> define <a data-link-type="dfn" href="#remote-end-definition" id="ref-for-remote-end-definition②">remote end definition</a> fragments. These provide choices in the <code>CommandData</code> group for the
module’s <a data-link-type="dfn" href="#command" id="ref-for-command②">commands</a>, and can also define additional definition properties. They
can also define <a data-link-type="dfn" href="#local-end-definition" id="ref-for-local-end-definition②">local end definition</a> fragments that provide additional choices
in the <code>ResultData</code> group for the results of commands in the module.</p>
   <p>Modules which contain events define <a data-link-type="dfn" href="#local-end-definition" id="ref-for-local-end-definition③">local end definition</a> fragments that are
choices in the <code>Event</code> group for the module’s <a data-link-type="dfn" href="#event" id="ref-for-event①">events</a>.</p>
   <p>An implementation may define <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="extension-modules">extension modules</dfn>. These must have a <a data-link-type="dfn" href="#module-name" id="ref-for-module-name①">module name</a> that contains a single colon "<code>:</code>" character. The
part before the colon is the prefix; this is typically the same for all
extension modules specific to a given implementation and should be unique for a
given implementation. Such modules extend the <a data-link-type="dfn" href="#local-end-definition" id="ref-for-local-end-definition④">local end definition</a> and <a data-link-type="dfn" href="#remote-end-definition" id="ref-for-remote-end-definition③">remote
end definition</a> providing additional groups as choices for the defined <a data-link-type="dfn" href="#command" id="ref-for-command③">commands</a> and <a data-link-type="dfn" href="#event" id="ref-for-event②">events</a>.</p>
   <h3 class="heading settled" data-level="3.4" id="commands"><span class="secno">3.4. </span><span class="content">Commands</span><a class="self-link" href="#commands"></a></h3>
   <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-export id="command">command</dfn> is an asynchronous operation, requested by
the <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-local-ends" id="ref-for-dfn-local-ends②">local end</a> and run on the <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-remote-ends" id="ref-for-dfn-remote-ends②">remote end</a>, resulting in either a
result or an error being returned to the <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-local-ends" id="ref-for-dfn-local-ends③">local end</a>. Multiple
commands can run at the same time, and commands can potentially be
long-running. As a consequence, commands can finish out-of-order.</p>
   <p>Each <a data-link-type="dfn" href="#command" id="ref-for-command④">command</a> is defined by:</p>
   <ul>
    <li data-md>
     <p>A <dfn class="dfn-paneled" data-dfn-for="command" data-dfn-type="dfn" data-export id="command-command-type">command type</dfn> which is defined by a <a data-link-type="dfn" href="#remote-end-definition" id="ref-for-remote-end-definition④">remote
 end definition</a> fragment containing a group. Each such group has two fields:</p>
     <ul>
      <li data-md>
       <p><code>method</code> which is a string literal of the form <code>[module
name].[method name]</code>. This is the <dfn class="dfn-paneled" data-dfn-for="command" data-dfn-type="dfn" data-export data-lt="command name" id="command-command-name">command
name</dfn>.</p>
      <li data-md>
       <p><code>params</code> which defines a mapping containing data that to be passed into
the command. The populated value of this map is the <dfn class="dfn-paneled" data-dfn-for="command" data-dfn-type="dfn" data-export id="command-command-parameters">command parameters</dfn>.</p>
     </ul>
    <li data-md>
     <p>A <dfn class="dfn-paneled" data-dfn-for="command" data-dfn-type="dfn" data-export id="command-result-type">result type</dfn>, which is defined by a <a data-link-type="dfn" href="#local-end-definition" id="ref-for-local-end-definition⑤">local
end definition</a> fragment.</p>
    <li data-md>
     <p>A set of <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-remote-end-steps" id="ref-for-dfn-remote-end-steps">remote end steps</a> which define the actions to take for a command
given <a data-link-type="dfn" href="#command-command-parameters" id="ref-for-command-command-parameters">command parameters</a> and return an instance of the command <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#dfn-return-type" id="ref-for-dfn-return-type">return
type</a>.</p>
   </ul>
   <p>When commands are send from the <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-local-ends" id="ref-for-dfn-local-ends④">local end</a> they have a command id. This is an
identifier used by the <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-local-ends" id="ref-for-dfn-local-ends⑤">local end</a> to identify the response from a particular
command. From the point of view of the <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-remote-ends" id="ref-for-dfn-remote-ends③">remote end</a> this identifier is opaque
and cannot be used internally to identify the command.</p>
   <p class="note" role="note"><span class="marker">Note:</span> This is because the command id is entirely controlled by the <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-local-ends" id="ref-for-dfn-local-ends⑥">local end</a> and isn’t necessarily unique over the course of a session. For example a <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-local-ends" id="ref-for-dfn-local-ends⑦">local
end</a> which ignores all responses could use the same command id for each command.</p>
   <p>The <dfn class="dfn-paneled" data-dfn-for="command" data-dfn-type="dfn" data-export id="command-set-of-all-command-names">set of all command names</dfn> is a set containing
all the defined <a data-link-type="dfn" href="#command-command-name" id="ref-for-command-command-name①">command names</a>, including any belonging to <a data-link-type="dfn" href="#extension-modules" id="ref-for-extension-modules">extension
modules</a>.</p>
   <h3 class="heading settled" data-level="3.5" id="events"><span class="secno">3.5. </span><span class="content">Events</span><a class="self-link" href="#events"></a></h3>
   <p>An <dfn class="dfn-paneled" data-dfn-type="dfn" data-export id="event">event</dfn> is a notification, sent by the <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-remote-ends" id="ref-for-dfn-remote-ends④">remote
end</a> to the <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-local-ends" id="ref-for-dfn-local-ends⑧">local end</a>, signaling that something of interest has
occurred on the <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-remote-ends" id="ref-for-dfn-remote-ends⑤">remote end</a>.</p>
   <ul>
    <li data-md>
     <p>An <dfn class="dfn-paneled" data-dfn-for="event" data-dfn-type="dfn" data-export id="event-event-type">event type</dfn> is defined by a <a data-link-type="dfn" href="#local-end-definition" id="ref-for-local-end-definition⑥">local
 end definition</a> fragment containing a group. Each such group has two fields:</p>
     <ul>
      <li data-md>
       <p><code>method</code> which is a string literal of the form <code>[module
name].[event name]</code>. This is the <dfn class="dfn-paneled" data-dfn-for="event" data-dfn-type="dfn" data-export data-lt="event name" id="event-event-name">event
name</dfn>.</p>
      <li data-md>
       <p><code>params</code> which defines a mapping containing event data. The
populated value of this map is the <dfn class="dfn-paneled" data-dfn-for="command" data-dfn-type="dfn" data-export data-lt="event parameters." id="command-event-parameters">event
parameters.</dfn></p>
     </ul>
    <li data-md>
     <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-export id="remote-end-event-trigger">remote end event trigger</dfn> which defines when the event is
 triggered and steps to construct the <a data-link-type="dfn" href="#event-event-type" id="ref-for-event-event-type">event type</a> data.</p>
    <li data-md>
     <p>Optionally, a set of <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="remote-end-subscribe-steps">remote end subscribe steps</dfn>, which define
 steps to take when a local end subscribes to an event. Where defined these
 steps have an associated <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="subscribe-priority">subscribe priority</dfn> which is an integer
 controlling the order in which the steps are run when multiple events are
 enabled at once, with lower integers indicating steps that run earlier.</p>
   </ul>
   <p>A <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-sessions" id="ref-for-dfn-sessions①">session</a> has a <dfn class="dfn-paneled" data-dfn-for="event" data-dfn-type="dfn" data-export id="event-global-event-set">global event set</dfn> which is a set
containing the event names for events that are enabled for all
browsing contexts. This initially contains the <a data-link-type="dfn" href="#event-event-name" id="ref-for-event-event-name①">event name</a> for events that
are <dfn class="dfn-paneled" data-dfn-for="event" data-dfn-type="dfn" data-export id="event-in-the-default-event-set">in the default event set</dfn>.</p>
   <p>A <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-sessions" id="ref-for-dfn-sessions②">session</a> has a <dfn class="dfn-paneled" data-dfn-for="event" data-dfn-type="dfn" data-export id="event-browsing-context-event-map">browsing context event map</dfn>,
which is a map with <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#top-level-browsing-context" id="ref-for-top-level-browsing-context">top-level browsing context</a> keys and values that are a
set of <a data-link-type="dfn" href="#event-event-name" id="ref-for-event-event-name②">event name</a>s for events that are enabled in the given browsing
context.</p>
   <div class="algorithm" data-algorithm="event enabled browsing contexts">
    <p>To obtain a list of <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="event-enabled-browsing-contexts">event enabled browsing contexts</dfn> given <var>session</var> and <var>event name</var>:</p>
    <ol>
     <li data-md>
      <p>Let <var>contexts</var> be an empty set.</p>
     <li data-md>
      <p>For each <var>context</var> → <var>events</var> of <var>session</var>’s <a data-link-type="dfn" href="#event-browsing-context-event-map" id="ref-for-event-browsing-context-event-map">browsing context event map</a>:</p>
      <ol>
       <li data-md>
        <p>If <var>events</var> contains <var>event name</var>, append <var>context</var> to <var>contexts</var></p>
      </ol>
     <li data-md>
      <p>Return <var>contexts</var>.</p>
    </ol>
   </div>
   <div class="algorithm" data-algorithm="event is enabled">
    <p>To determine if an <dfn class="dfn-paneled" data-dfn-type="dfn" data-export id="event-is-enabled">event is enabled</dfn> given <var>session</var>, <var>event name</var> and <var>browsing contexts</var>:</p>
    <p class="note" role="note"><span class="marker">Note:</span> <var>browsing contexts</var> is a set because a <a data-link-type="dfn">shared worker</a> can be associated
      with multiple contexts.</p>
    <ol>
     <li data-md>
      <p>Let <var>top-level browsing contexts</var> be an empty set.</p>
     <li data-md>
      <p>For each <var>browsing context</var> of <var>browsing contexts</var>, append <var>browsing
 context</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#top-level-browsing-context" id="ref-for-top-level-browsing-context①">top-level browsing context</a> to <var>top-level browsing contexts</var>.</p>
     <li data-md>
      <p>Let <var>event map</var> be the <a data-link-type="dfn" href="#event-browsing-context-event-map" id="ref-for-event-browsing-context-event-map①">browsing context event map</a> for <var>session</var>.</p>
     <li data-md>
      <p>For each <var>browsing context</var> of <var>top-level browsing contexts</var>:</p>
      <ol>
       <li data-md>
        <p>If <var>event map</var> <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#header-list-contains" id="ref-for-header-list-contains">contains</a> <var>browsing context</var>, let <var>browsing context
 events</var> be <var>event map</var>[<var>browsing context</var>].  Otherwise let <var>browsing
 context events</var> be null.</p>
       <li data-md>
        <p>If <var>browsing context events</var> is not null, and <var>browsing context events</var> <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#header-list-contains" id="ref-for-header-list-contains①">contains</a> <var>event name</var>, return true.</p>
      </ol>
     <li data-md>
      <p>If the <a data-link-type="dfn" href="#event-global-event-set" id="ref-for-event-global-event-set">global event set</a> for <var>session</var> <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#header-list-contains" id="ref-for-header-list-contains②">contains</a> <var>event name</var> return
 true.</p>
     <li data-md>
      <p>Return false.</p>
    </ol>
   </div>
   <div class="algorithm" data-algorithm="obtain a set of event names">
    <p>To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="obtain-a-set-of-event-names">obtain a set of event names</dfn> given an <var>name</var>:</p>
    <ol>
     <li data-md>
      <p>Let <var>events</var> be an empty set.</p>
     <li data-md>
      <p>If <var>name</var> contains a U+002E (period):</p>
      <ol>
       <li data-md>
        <p>If <var>name</var> is the <a data-link-type="dfn" href="#event-event-name" id="ref-for-event-event-name③">event name</a> for an event, append <var>name</var> to <var>events</var> and return <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-success" id="ref-for-dfn-success">success</a> with data <var>events</var>.</p>
       <li data-md>
        <p>Return an <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-errors" id="ref-for-dfn-errors">error</a> with <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-error-code" id="ref-for-dfn-error-code">error code</a> <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-invalid-argument" id="ref-for-dfn-invalid-argument">Invalid Argument</a></p>
      </ol>
     <li data-md>
      <p>Otherwise <var>name</var> is interpreted as representing all the events in a
 module. If <var>name</var> is not a <a data-link-type="dfn" href="#module-name" id="ref-for-module-name②">module name</a> return an <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-errors" id="ref-for-dfn-errors①">error</a> with <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-error-code" id="ref-for-dfn-error-code①">error code</a> <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-invalid-argument" id="ref-for-dfn-invalid-argument①">Invalid Argument</a>.</p>
     <li data-md>
      <p>Append the <a data-link-type="dfn" href="#event-event-name" id="ref-for-event-event-name④">event name</a> for each <a data-link-type="dfn" href="#event" id="ref-for-event③">event</a> in the module with name <var>name</var> to <var>events</var>.</p>
     <li data-md>
      <p>Return <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-success" id="ref-for-dfn-success①">success</a> with data <var>events</var>.</p>
    </ol>
   </div>
   <h2 class="heading settled" data-level="4" id="transport"><span class="secno">4. </span><span class="content">Transport</span><a class="self-link" href="#transport"></a></h2>
   <p>Message transport is provided using the WebSocket protocol. <a data-link-type="biblio" href="#biblio-rfc6455" title="The WebSocket Protocol">[RFC6455]</a></p>
   <p class="note" role="note"><span class="marker">Note:</span> In the terms of the WebSocket protocol, the <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-local-ends" id="ref-for-dfn-local-ends⑨">local end</a> is the
client and the <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-remote-ends" id="ref-for-dfn-remote-ends⑥">remote end</a> is the server / remote host.</p>
   <p class="note" role="note"><span class="marker">Note:</span> The encoding of <a data-link-type="dfn" href="#command" id="ref-for-command⑤">commands</a> and <a data-link-type="dfn" href="#event" id="ref-for-event④">events</a> as messages is
similar to JSON-RPC, but this specification does not normatively
reference it. <a data-link-type="biblio" href="#biblio-json-rpc" title="JSON-RPC 2.0 Specification">[JSON-RPC]</a> The normative requirements on <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-remote-ends" id="ref-for-dfn-remote-ends⑦">remote
ends</a> are instead given as a precise processing model, while no
normative requirements are given for <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-local-ends" id="ref-for-dfn-local-ends①⓪">local ends</a>.</p>
   <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="websocket-listener">WebSocket listener</dfn> is a network endpoint that is able
to accept incoming <a data-link-type="biblio" href="#biblio-rfc6455" title="The WebSocket Protocol">WebSocket</a> connections.</p>
   <p>A <a data-link-type="dfn" href="#websocket-listener" id="ref-for-websocket-listener">WebSocket listener</a> has a <dfn class="dfn-paneled" data-dfn-for="listener" data-dfn-type="dfn" data-noexport id="listener-host">host</dfn>, a <dfn class="dfn-paneled" data-dfn-for="listener" data-dfn-type="dfn" data-noexport id="listener-port">port</dfn>, a <dfn class="dfn-paneled" data-dfn-for="listener" data-dfn-type="dfn" data-noexport id="listener-secure-flag">secure flag</dfn>, and a <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="list-of-websocket-resources">list of WebSocket resources</dfn>.</p>
   <p>When a <a data-link-type="dfn" href="#websocket-listener" id="ref-for-websocket-listener①">WebSocket listener</a> <var>listener</var> is created, a <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-remote-ends" id="ref-for-dfn-remote-ends⑧">remote end</a> must start to listen for WebSocket connections on the host and port
given by <var>listener</var>’s <a data-link-type="dfn" href="#listener-host" id="ref-for-listener-host">host</a> and <a data-link-type="dfn" href="#listener-port" id="ref-for-listener-port">port</a>. If <var>listener</var>’s <a data-link-type="dfn" href="#listener-secure-flag" id="ref-for-listener-secure-flag">secure flag</a> is set, then connections
established from <var>listener</var> must be TLS encrypted.</p>
   <p>A <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-remote-ends" id="ref-for-dfn-remote-ends⑨">remote end</a> has a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-set" id="ref-for-ordered-set">set</a> of <a data-link-type="dfn" href="#websocket-listener" id="ref-for-websocket-listener②">WebSocket listeners</a> <dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="active listeners" data-noexport id="active-listeners">active
listeners</dfn>, which is initially empty.</p>
   <p>A WebDriver <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-sessions" id="ref-for-dfn-sessions③">session</a> has a <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="websocket-connection">WebSocket connection</dfn> which is
a network connection that follows the requirements of the <a data-link-type="biblio" href="#biblio-rfc6455" title="The WebSocket Protocol">WebSocket protocol</a>. This is initially null.</p>
   <div>
    <p>When a client <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc6455#section-4.1" id="ref-for-section-4.1">establishes a WebSocket connection</a> <var>connection</var> by
connecting to one of the set of <a data-link-type="dfn" href="#active-listeners" id="ref-for-active-listeners">active listeners</a> <var>listener</var>, the
implementation must proceed according to the WebSocket <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc6455#section-4.2" id="ref-for-section-4.2">server-side
requirements</a>, with the following steps run when deciding whether to
accept the incoming connection:</p>
    <ol>
     <li data-md>
      <p>Let <var>resource name</var> be the resource name from <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc6455#section-4.2.1" id="ref-for-section-4.2.1">reading the
 client’s opening handshake</a>. If <var>resource name</var> is not in <var>listener</var>’s <a data-link-type="dfn" href="#list-of-websocket-resources" id="ref-for-list-of-websocket-resources">list of WebSocket resources</a>, then stop
 running these steps and act as if the requested service is not
 available.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="#get-a-session-id-for-a-websocket-resource" id="ref-for-get-a-session-id-for-a-websocket-resource">Get a session ID for a WebSocket resource</a> with <var>resource name</var> and let <var>session id</var> be that value. If <var>session id</var> is null then
 stop running these steps and act as if the requested service is not
 available.</p>
     <li data-md>
      <p>If there is a <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-sessions" id="ref-for-dfn-sessions④">session</a> in the list of <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-active-session" id="ref-for-dfn-active-session">active sessions</a> with <var>session id</var> as its <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-session-id" id="ref-for-dfn-session-id">session ID</a> then let <var>session</var> be that
 session. Otherwise stop running these steps and act as if the
 requested service is not available.</p>
     <li data-md>
      <p>Run any other implementation-defined steps to decide if the
 connection should be accepted, and if it is not stop running these
 steps and act as if the requested service is not available.</p>
     <li data-md>
      <p>Otherwise set <var>session</var>’s <a data-link-type="dfn" href="#websocket-connection" id="ref-for-websocket-connection">WebSocket connection</a> to <var>connection</var>, and proceed with the WebSocket <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc6455#section-4.2" id="ref-for-section-4.2①">server-side
 requirements</a> when a server chooses to accept an incoming connection.</p>
    </ol>
    <p class="issue" id="issue-0dc5e7b6"><a class="self-link" href="#issue-0dc5e7b6"></a> Do we support > 1 connection for a single session?</p>
   </div>
   <p>When <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc6455#section-6.2" id="ref-for-section-6.2">a WebSocket message has been received</a> for a <a data-link-type="dfn" href="#websocket-connection" id="ref-for-websocket-connection①">WebSocket
connection</a> <var>connection</var> with type <var>type</var> and data <var>data</var>, a <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-remote-ends" id="ref-for-dfn-remote-ends①⓪">remote
end</a> must <a data-link-type="dfn" href="#handle-an-incoming-message" id="ref-for-handle-an-incoming-message">handle an incoming message</a> given <var>connection</var>, <var>type</var> and <var>data</var>.</p>
   <p>When <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc6455#section-7.1.3" id="ref-for-section-7.1.3">the WebSocket closing handshake is started</a> or when <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc6455#section-7.1.4" id="ref-for-section-7.1.4">the
WebSocket connection is closed</a> for a <a data-link-type="dfn" href="#websocket-connection" id="ref-for-websocket-connection②">WebSocket connection</a> <var>connection</var>, a <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-remote-ends" id="ref-for-dfn-remote-ends①①">remote end</a> must <a data-link-type="dfn" href="#handle-a-connection-closing" id="ref-for-handle-a-connection-closing">handle a connection closing</a> given <var>connection</var>.</p>
   <p class="note" role="note"><span class="marker">Note:</span> Both conditions are needed because it is possible for a
WebSocket connection to be closed without a closing handshake.</p>
   <div class="algorithm" data-algorithm="construct a WebSocket resource name">
    <p>To <dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="construct a WebSocket resource name|constructing a
WebSocket resource name" data-noexport id="construct-a-websocket-resource-name">construct a WebSocket resource name</dfn> given a <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-sessions" id="ref-for-dfn-sessions⑤">session</a> <var>session</var>:</p>
    <ol>
     <li data-md>
      <p>Return the result of concatenating the string "<code>/session/</code>"
 with <var>session</var>’s <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-session-id" id="ref-for-dfn-session-id①">session ID</a>.</p>
    </ol>
   </div>
   <div class="algorithm" data-algorithm="construct a WebSocket URL">
    <p>To <dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="construct a WebSocket URL|constructing a WebSocket
URL" data-noexport id="construct-a-websocket-url">construct a WebSocket URL</dfn> given a <a data-link-type="dfn" href="#websocket-listener" id="ref-for-websocket-listener③">WebSocket listener</a> <var>listener</var> and <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-sessions" id="ref-for-dfn-sessions⑥">session</a> <var>session</var>:</p>
    <ol>
     <li data-md>
      <p>Let <var>resource name</var> be the result of <a data-link-type="dfn" href="#construct-a-websocket-resource-name" id="ref-for-construct-a-websocket-resource-name">constructing a WebSocket
 resource name</a> given <var>session</var>.</p>
     <li data-md>
      <p>Return a <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc6455#section-3" id="ref-for-section-3">WebSocket URI</a> constructed with host set to <var>listener</var>’s <a data-link-type="dfn" href="#listener-host" id="ref-for-listener-host①">host</a>, port set to <var>listener</var>’s <a data-link-type="dfn" href="#listener-port" id="ref-for-listener-port①">port</a>, path set to <var>resource name</var>, following the wss-URI
 construct if <var>listener</var>’s <a data-link-type="dfn" href="#listener-secure-flag" id="ref-for-listener-secure-flag①">secure flag</a> is set and the ws-URL
 construct otherwise.</p>
    </ol>
   </div>
   <div class="algorithm" data-algorithm="get a session ID for a WebSocket resource">
    <p>To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="get-a-session-id-for-a-websocket-resource">get a session ID for a WebSocket resource</dfn> given <var>resource name</var>:</p>
    <ol>
     <li data-md>
      <p>If <var>resource name</var> doesn’t begin with the byte string
 "<code>/session/</code>", return null.</p>
     <li data-md>
      <p>Let <var>session id</var> be the bytes in <var>resource name</var> following the
 "<code>/session/</code>" prefix.</p>
     <li data-md>
      <p>If <var>session id</var> is not the string representation of a <a data-link-type="biblio" href="#biblio-rfc4122" title="Universally Unique IDentifiers (UUIDs)">UUID</a>, return null.</p>
     <li data-md>
      <p>Return <var>session id</var>.</p>
    </ol>
   </div>
   <div class="algorithm" data-algorithm="start listening for a WebSocket connection">
     To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="start-listening-for-a-websocket-connection">start listening for a WebSocket connection</dfn> given a <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-sessions" id="ref-for-dfn-sessions⑦">session</a> <var>session</var>: 
    <ol>
     <li data-md>
      <p>If there is an existing <a data-link-type="dfn" href="#websocket-listener" id="ref-for-websocket-listener④">WebSocket listener</a> in the set of <a data-link-type="dfn" href="#active-listeners" id="ref-for-active-listeners①">active listeners</a> which the <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-remote-ends" id="ref-for-dfn-remote-ends①②">remote end</a> would like to reuse,
  let <var>listener</var> be that listener. Otherwise let <var>listener</var> be a new <a data-link-type="dfn" href="#websocket-listener" id="ref-for-websocket-listener⑤">WebSocket listener</a> with <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#implementation-defined" id="ref-for-implementation-defined">implementation-defined</a> <a data-link-type="dfn" href="#listener-host" id="ref-for-listener-host②">host</a>, <a data-link-type="dfn" href="#listener-port" id="ref-for-listener-port②">port</a>, <a data-link-type="dfn" href="#listener-secure-flag" id="ref-for-listener-secure-flag②">secure flag</a>,
  and an empty <a data-link-type="dfn" href="#list-of-websocket-resources" id="ref-for-list-of-websocket-resources①">list of WebSocket resources</a>.</p>
     <li data-md>
      <p>Let <var>resource name</var> be the result of <a data-link-type="dfn" href="#construct-a-websocket-resource-name" id="ref-for-construct-a-websocket-resource-name①">constructing a WebSocket
  resource name</a> given <var>session</var>.</p>
     <li data-md>
      <p>Append <var>resource name</var> to the <a data-link-type="dfn" href="#list-of-websocket-resources" id="ref-for-list-of-websocket-resources②">list of WebSocket resources</a> for <var>listener</var>.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#set-append" id="ref-for-set-append">Append</a> <var>listener</var> to the <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-remote-ends" id="ref-for-dfn-remote-ends①③">remote end</a>'s <a data-link-type="dfn" href="#active-listeners" id="ref-for-active-listeners②">active
   listeners</a>.</p>
     <li data-md>
      <p>Return <var>listener</var>.</p>
    </ol>
   </div>
   <p class="note" role="note"><span class="marker">Note:</span> An <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-intermediary-node" id="ref-for-dfn-intermediary-node">intermediary node</a> handling multiple sessions can use one
or many WebSocket listeners. <a data-link-type="biblio" href="#biblio-webdriver" title="WebDriver">WebDriver</a> defines that
an <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-endpoint-node" id="ref-for-dfn-endpoint-node">endpoint node</a> supports at most one session at a time, so it’s
expected to only have a single listener.</p>
   <p class="note" role="note"><span class="marker">Note:</span> For an <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-endpoint-node" id="ref-for-dfn-endpoint-node①">endpoint node</a> the <a data-link-type="dfn" href="#listener-host" id="ref-for-listener-host③">host</a> in the above steps will
typically be "<code>localhost</code>".</p>
   <div class="algorithm" data-algorithm="handle an incoming message">
     To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="handle-an-incoming-message">handle an incoming message</dfn> given a <a data-link-type="dfn" href="#websocket-connection" id="ref-for-websocket-connection③">WebSocket connection</a> <var>connection</var>, type <var>type</var> and data <var>data</var>: 
    <ol>
     <li data-md>
      <p>If <var>type</var> is not <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc6455#section-5.2" id="ref-for-section-5.2">text</a>, <a data-link-type="dfn" href="#respond-with-an-error" id="ref-for-respond-with-an-error">respond with an
  error</a> given <var>connection</var>, null, and <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-invalid-argument" id="ref-for-dfn-invalid-argument②">invalid argument</a>, and finally
  return.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#assert" id="ref-for-assert">Assert</a>: <var>data</var> is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#scalar-value-string" id="ref-for-scalar-value-string">scalar value string</a>, because the
   WebSocket <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc6455#section-8.1" id="ref-for-section-8.1">handling errors in UTF-8-encoded data</a> would already
   have <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc6455#section-7.1.7" id="ref-for-section-7.1.7">failed the WebSocket
   connection</a> otherwise.</p>
      <p class="issue" id="issue-449f8f30"><a class="self-link" href="#issue-449f8f30"></a> Nothing seems to define what <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc6455#section-7.4" id="ref-for-section-7.4">status code</a> is used for UTF-8 errors.</p>
     <li data-md>
      <p>Let <var>parsed</var> be the result of <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#parse-a-json-string-to-an-infra-value" id="ref-for-parse-a-json-string-to-an-infra-value">parsing JSON
 into Infra values</a> given <var>data</var>. If this throws an exception, then <a data-link-type="dfn" href="#respond-with-an-error" id="ref-for-respond-with-an-error①">respond
 with an error</a> given <var>connection</var>, null, and <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-invalid-argument" id="ref-for-dfn-invalid-argument③">invalid argument</a>, and
 finally return.</p>
     <li data-md>
      <p>Match <var>parsed</var> against the <a data-link-type="dfn" href="#remote-end-definition" id="ref-for-remote-end-definition⑤">remote end definition</a>. If this results in a
  match:</p>
      <ol>
       <li data-md>
        <p>Let <var>matched</var> be the map representing the matched data.</p>
       <li data-md>
        <p class="assertion">Assert: <var>matched</var> <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#header-list-contains" id="ref-for-header-list-contains③">contains</a> "<code>id</code>", "<code>method</code>", and
 "<code>params</code>".</p>
       <li data-md>
        <p>Let <var>command id</var> be <var>matched</var>["<code>id</code>"].</p>
       <li data-md>
        <p>Let <var>method</var> be <var>matched</var>["<code>method</code>"]</p>
       <li data-md>
        <p>Run the following steps in parallel:</p>
        <ol>
         <li data-md>
          <p>Let <var>result</var> be the result of running the <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-remote-end-steps" id="ref-for-dfn-remote-end-steps①">remote end steps</a> for the
 command with <a data-link-type="dfn" href="#command-command-name" id="ref-for-command-command-name②">command name</a> <var>method</var> given <a data-link-type="dfn" href="#command-command-parameters" id="ref-for-command-command-parameters①">command parameters</a> <var>matched</var>["<code>params</code>"]</p>
         <li data-md>
          <p>If <var>result</var> is an <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-errors" id="ref-for-dfn-errors②">error</a>, then <a data-link-type="dfn" href="#respond-with-an-error" id="ref-for-respond-with-an-error②">respond with an error</a> given <var>connection</var>, <var>command id</var>, and <var>result</var>’s <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-error-code" id="ref-for-dfn-error-code②">error code</a>, and finally
 return.</p>
         <li data-md>
          <p>Let <var>value</var> be <var>result</var>’s data.</p>
         <li data-md>
          <p class="assertion">Assert: <var>value</var> matches the definition for the <a data-link-type="dfn" href="#command-result-type" id="ref-for-command-result-type">result type</a> corresponding to the command with <a data-link-type="dfn" href="#command-command-name" id="ref-for-command-command-name③">command name</a> <var>method</var>.</p>
         <li data-md>
          <p>Let <var>response</var> be a new map matching the <code>CommandResponse</code> production in the <a data-link-type="dfn" href="#local-end-definition" id="ref-for-local-end-definition⑦">local end definition</a> with the <code>id</code> field set to <var>command id</var> and the <code>value</code> field set to <var>value</var>.</p>
         <li data-md>
          <p>Let <var>serialized</var> be the result of <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#serialize-an-infra-value-to-json-bytes" id="ref-for-serialize-an-infra-value-to-json-bytes">serialize an infra value to JSON
 bytes</a> given <var>response</var>.</p>
         <li data-md>
          <p><a data-link-type="dfn" href="https://tools.ietf.org/html/rfc6455#section-6.1" id="ref-for-section-6.1">Send a WebSocket message</a> comprised of <var>serialized</var> over <var>connection</var> and return.</p>
        </ol>
      </ol>
     <li data-md>
      <p>Otherwise:</p>
      <ol>
       <li data-md>
        <p>Let <var>command id</var> be null.</p>
       <li data-md>
        <p>If <var>parsed</var> is a map and <var>parsed</var>["<code>id</code>"] exists and is an
 integer greater than or equal to zero, set <var>command id</var> to that integer.</p>
       <li data-md>
        <p>Let <var>error code</var> be <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-invalid-argument" id="ref-for-dfn-invalid-argument④">invalid argument</a>.</p>
       <li data-md>
        <p>If <var>parsed</var> is a map and <var>parsed</var>["<code>method</code>"] exists and is a
 string, but <var>parsed</var>["<code>method</code>"] is not in the <a data-link-type="dfn" href="#command-set-of-all-command-names" id="ref-for-command-set-of-all-command-names">set of all
 command names</a>, set <var>error code</var> to <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-unknown-command" id="ref-for-dfn-unknown-command">unknown command</a>.</p>
       <li data-md>
        <p><a data-link-type="dfn" href="#respond-with-an-error" id="ref-for-respond-with-an-error③">Respond with an error</a> given <var>connection</var>, <var>command id</var>, and <var>error code</var>.</p>
      </ol>
    </ol>
   </div>
   <div class="algorithm" data-algorithm="get related browsing contexts">
    <p>To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="get-related-browsing-contexts">get related browsing contexts</dfn> given an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#settings-object" id="ref-for-settings-object">settings object</a> <var>settings</var>:</p>
    <ol>
     <li data-md>
      <p>Let <var>related browsing contexts</var> be an empty set</p>
     <li data-md>
      <p>If the <a data-link-type="dfn">responsible document</a> of <var>settings</var> is a <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-document" id="ref-for-concept-document">Document</a>, append the <a data-link-type="dfn">responsible document</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#concept-document-bc" id="ref-for-concept-document-bc">browsing context</a> to <var>related browsing
 contexts</var>.</p>
      <p>Otherwise if the <a data-link-type="dfn">global object</a> specified by <var>settings</var> is a <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/workers.html#workerglobalscope" id="ref-for-workerglobalscope">WorkerGlobalScope</a></code>, for each <var>owner</var> in the <a data-link-type="dfn">global object</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/workers.html#concept-WorkerGlobalScope-owner-set" id="ref-for-concept-WorkerGlobalScope-owner-set">owner set</a>, if <var>owner</var> is a <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-document" id="ref-for-concept-document①">Document</a>, append <var>owner</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#concept-document-bc" id="ref-for-concept-document-bc①">browsing context</a> to <var>related browsing contexts</var>.</p>
     <li data-md>
      <p>Return <var>related browsing contexts</var>.</p>
    </ol>
   </div>
   <div class="algorithm" data-algorithm="emit an event">
     To <dfn class="dfn-paneled" data-dfn-type="dfn" data-export id="emit-an-event">emit an event</dfn> given <var>body</var> and <var>related
browsing contexts</var>: 
    <ol>
     <li data-md>
      <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#assert" id="ref-for-assert①">Assert</a>: <var>body</var> has <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-size" id="ref-for-map-size">size</a> 2 and <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#header-list-contains" id="ref-for-header-list-contains④">contains</a> "<code>method</code>"
  and "<code>params</code>".</p>
     <li data-md>
      <p>If the <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-current-session" id="ref-for-dfn-current-session">current session</a> is null, or the <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-current-session" id="ref-for-dfn-current-session①">current session</a>'s <a data-link-type="dfn" href="#websocket-connection" id="ref-for-websocket-connection④">WebSocket
  Connection</a> is null then return false.</p>
     <li data-md>
      <p>If <a data-link-type="dfn" href="#event-is-enabled" id="ref-for-event-is-enabled">event is enabled</a> given <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-current-session" id="ref-for-dfn-current-session②">current session</a>, <var>body</var>["<code>method</code>"] and <var>related browsing contexts</var>:</p>
      <ol>
       <li data-md>
        <p>Let <var>connection</var> be the <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-current-session" id="ref-for-dfn-current-session③">current session</a>'s <a data-link-type="dfn" href="#websocket-connection" id="ref-for-websocket-connection⑤">WebSocket connection</a>.</p>
       <li data-md>
        <p>Let <var>serialized</var> be the result of <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#serialize-an-infra-value-to-json-bytes" id="ref-for-serialize-an-infra-value-to-json-bytes①">serialize an infra value to JSON
    bytes</a> given <var>body</var>.</p>
       <li data-md>
        <p><a data-link-type="dfn" href="https://tools.ietf.org/html/rfc6455#section-6.1" id="ref-for-section-6.1①">Send a WebSocket message</a> comprised of <var>serialized</var> over <var>connection</var>.</p>
       <li data-md>
        <p>Return true</p>
      </ol>
     <li data-md>
      <p>Return false</p>
    </ol>
   </div>
   <div class="algorithm" data-algorithm="respond with an error">
     To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="respond-with-an-error">respond with an error</dfn> given a <a data-link-type="dfn" href="#websocket-connection" id="ref-for-websocket-connection⑥">WebSocket connection</a> <var>connection</var>, <var>command id</var>, and <var>error code</var>: 
    <ol>
     <li data-md>
      <p>Let <var>error data</var> be a new map matching the <code>ErrorResponse</code> production in the <a data-link-type="dfn" href="#local-end-definition" id="ref-for-local-end-definition⑧">local end definition</a>, with the <code>id</code> field
  set to <var>command id</var>, the <code>error</code> field set to <var>error code</var>, the <code>message</code> field set to an implementation-defined string
  containing a human-readable definition of the error that occurred and the <code>stacktrace</code> field optionally set to an implementation-defined
  string containing a stack trace report of the active stack frames at the
  time when the error occurred.</p>
     <li data-md>
      <p>Let <var>response</var> be the result of <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#serialize-an-infra-value-to-json-bytes" id="ref-for-serialize-an-infra-value-to-json-bytes②">serialize an infra value to JSON bytes</a> given <var>error data</var>.</p>
      <p class="note" role="note"><span class="marker">Note:</span> <var>command id</var> can be null, in which case the <code>id</code> field will
  also be set to null, not omitted from <var>response</var>.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://tools.ietf.org/html/rfc6455#section-6.1" id="ref-for-section-6.1②">Send a WebSocket message</a> comprised of <var>response</var> over <var>connection</var>.</p>
    </ol>
   </div>
   <div class="algorithm" data-algorithm="handle a connection closing">
    <p>To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="handle-a-connection-closing">handle a connection closing</dfn> given a <a data-link-type="dfn" href="#websocket-connection" id="ref-for-websocket-connection⑦">WebSocket connection</a> <var>connection</var>:</p>
    <ol>
     <li data-md>
      <p>If there is a WebDriver <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-sessions" id="ref-for-dfn-sessions⑧">session</a> with <var>connection</var> as its <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-connection" id="ref-for-concept-connection">connection</a>,
  set the <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-connection" id="ref-for-concept-connection①">connection</a> on that <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-sessions" id="ref-for-dfn-sessions⑨">session</a> to null.</p>
    </ol>
    <p class="issue" id="issue-02ccb156"><a class="self-link" href="#issue-02ccb156"></a> This should also reset any internal state</p>
   </div>
   <p class="note" role="note"><span class="marker">Note:</span> This does not end any <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-sessions" id="ref-for-dfn-sessions①⓪">session</a>.</p>
   <p class="issue" id="issue-9f7aff26"><a class="self-link" href="#issue-9f7aff26"></a> Need to hook in to the session ending to allow the UA to close
the listener if it wants.</p>
   <h3 class="heading settled" data-level="4.1" id="establishing"><span class="secno">4.1. </span><span class="content">Establishing a Connection</span><a class="self-link" href="#establishing"></a></h3>
   <p>WebDriver clients opt in to a bidirectional connection by requesting a
capability with the name "<code>webSocketUrl</code>" and value
true.</p>
   <p>This specification defines an <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-additional-webdriver-capability" id="ref-for-dfn-additional-webdriver-capability">additional webdriver capability</a> with the <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-capability-name" id="ref-for-dfn-capability-name">capability name</a> "<code>webSocketUrl</code>".</p>
   <div class="algorithm" data-algorithm="webSocketUrl capability deserialization algorithm">
     The <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-additional-capability-deserialization-algorithm" id="ref-for-dfn-additional-capability-deserialization-algorithm">additional capability deserialization algorithm</a> for the
"<code>webSocketUrl</code>" capability, with parameter <var>value</var> is: 
    <ol>
     <li data-md>
      <p>If <var>value</var> is not a boolean, return <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-errors" id="ref-for-dfn-errors③">error</a> with <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-error-code" id="ref-for-dfn-error-code③">code</a> <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-invalid-argument" id="ref-for-dfn-invalid-argument⑤">invalid argument</a>.</p>
     <li data-md>
      <p>Return <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-success" id="ref-for-dfn-success②">success</a> with data <var>value</var>.</p>
    </ol>
   </div>
   <div class="algorithm" data-algorithm="webSocketUrl capability serialization algorithm">
     The <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-matched-capability-serialization-algorithm" id="ref-for-dfn-matched-capability-serialization-algorithm">matched capability serialization algorithm</a> for the "<code>webSocketUrl</code>" capability,
with parameter <var>value</var> is: 
    <ol>
     <li data-md>
      <p>If <var>value</var> is false, return <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-success" id="ref-for-dfn-success③">success</a> with data null.</p>
     <li data-md>
      <p>Return <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-success" id="ref-for-dfn-success④">success</a> with data true.</p>
    </ol>
   </div>
   <div class="algorithm" data-algorithm="webSocketUrl new session algorithm">
     The <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-webdriver-new-session-algorithm" id="ref-for-dfn-webdriver-new-session-algorithm">WebDriver new session algorithm</a> defined by this specification,
with parameters <var>session</var> and <var>capabilities</var> is: 
    <ol>
     <li data-md>
      <p>Let <var>webSocketUrl</var> be the result of <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-get-a-property" id="ref-for-dfn-get-a-property">getting a property</a> named
  "<code>webSocketUrl</code>" from <var>capabilities</var>.</p>
     <li data-md>
      <p>If <var>webSocketUrl</var> is undefined, return.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#assert" id="ref-for-assert②">Assert</a>: <var>webSocketUrl</var> is true.</p>
     <li data-md>
      <p>Let <var>listener</var> be the result of <a data-link-type="dfn" href="#start-listening-for-a-websocket-connection" id="ref-for-start-listening-for-a-websocket-connection">start listening for a WebSocket
  connection</a> given <var>session</var>.</p>
     <li data-md>
      <p>Set <var>webSocketUrl</var> to the result of <a data-link-type="dfn" href="#construct-a-websocket-url" id="ref-for-construct-a-websocket-url">constructing a WebSocket
  URL</a> given <var>listener</var> and <var>session</var>.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-set-a-property" id="ref-for-dfn-set-a-property">Set a property</a> on <var>capabilities</var> named
  "<code>webSocketUrl</code>" to <var>webSocketUrl</var>.</p>
    </ol>
   </div>
   <h2 class="heading settled" data-level="5" id="data-types"><span class="secno">5. </span><span class="content">Common Data Types</span><a class="self-link" href="#data-types"></a></h2>
   <h3 class="heading settled" data-level="5.1" id="type-common-RemoteValue"><span class="secno">5.1. </span><span class="content">Remote Value</span><a class="self-link" href="#type-common-RemoteValue"></a></h3>
   <p>Values accessible from the ECMAScript runtime are represented by a mirror
object, specified as <code>RemoteValue</code>. The value’s type is specified in
the <code>type</code> property. In the case of JSON-representable primitive
values, this contains the value in the <code>value</code> property; in the case
of non-JSON-representable primitives, the <code>value</code> property contains a
string representation of the value. For non-primitive objects, the <code>objectId</code> property contains a string id that provides a unique
handle to the object, valid for its lifetime inside the engine. For some
non-primitive types, the <code>value</code> property contains a representation
of the data in the ECMAScript object; for container types this can contain
further <code>RemoteValue</code> instances. The <code>value</code> property can
be null if there is a duplicate object i.e. the object has already been
serialized in the current <code>RemoteValue</code>, perhaps as part of a
cycle, or otherwise when the maximum serialization depth is reached.</p>
   <p><a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-node" id="ref-for-concept-node">Nodes</a> are also represented by <code>RemoteValue</code> instances. These have
a partial serialization of the node in the value property.</p>
   <p class="note" role="note"><span class="marker">Note:</span> mirror objects do not keep the original object alive in the runtime. If an
object is discarded in the runtime subsequent attempts to access it via the
protocol will result in an error.</p>
   <p>A <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-sessions" id="ref-for-dfn-sessions①①">session</a> has an <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="object-id-map">object id map</dfn>. This is a weak map from objects to
their corresponding id.</p>
   <p class="issue" id="issue-992788ee"><a class="self-link" href="#issue-992788ee"></a> Should this be explicitly per realm?</p>
   <div class="algorithm" data-algorithm="object id for an object">
     To get the <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="object-id-for-an-object">object id for an object</dfn> given an <var>object</var>: 
    <ol>
     <li data-md>
      <p>If the <a data-link-type="dfn" href="#object-id-map" id="ref-for-object-id-map">object id map</a> for the <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-current-session" id="ref-for-dfn-current-session④">current session</a> does not contain <var>object</var> run the following steps:</p>
      <ol>
       <li data-md>
        <p>Let <var>object id</var> be a new, unique, string identifier for <var>object</var>. If <var>object</var> is an <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-element" id="ref-for-concept-element">element</a> this must be the <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-web-element-reference" id="ref-for-dfn-web-element-reference">web element reference</a> for <var>object</var>; if it’s a <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#windowproxy" id="ref-for-windowproxy">WindowProxy</a></code> object, this must be the <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-window-handle" id="ref-for-dfn-window-handle">window handle</a> for <var>object</var>.</p>
       <li data-md>
        <p>Set the value of <var>object</var> in the <a data-link-type="dfn" href="#object-id-map" id="ref-for-object-id-map①">object id map</a> to <var>object id</var>.</p>
      </ol>
     <li data-md>
      <p>Return the result of getting the value for <var>object</var> in <a data-link-type="dfn" href="#object-id-map" id="ref-for-object-id-map②">object id map</a>.</p>
    </ol>
   </div>
   <p><a data-link-type="dfn" href="#remote-end-definition" id="ref-for-remote-end-definition⑥">remote end definition</a> and <a data-link-type="dfn" href="#local-end-definition" id="ref-for-local-end-definition⑨">local end definition</a></p>
<pre>RemoteValue = {
  UndefinedValue //
  NullValue //
  StringValue //
  NumberValue //
  BooleanValue //
  BigIntValue //
  SymbolValue //
  ArrayValue //
  ObjectValue //
  FunctionValue //
  RegExpValue //
  DateValue //
  MapValue //
  SetValue //
  WeakMapValue //
  WeakSetValue //
  IteratorValue //
  GeneratorValue //
  ErrorValue //
  ProxyValue //
  PromiseValue //
  TypedArrayValue //
  ArrayBufferValue //
  NodeValue //
  WindowProxyValue //
}

ObjectId = text;

ListValue = [*RemoteValue];

MappingValue = [*[(RemoteValue / text), RemoteValue]];

UndefinedValue = {
  type: "undefined",
}

NullValue = {
  type: "null",
}

StringValue = {
  type: "string",
  value: text,
}

SpecialNumber = "NaN" / "-0" / "+Infinity" / "-Infinity";

NumberValue = {
  type: "number",
  value: number / SpecialNumber,
}

BooleanValue = {
  type: "boolean",
  value: bool,
}

BigIntValue = {
  type: "bigint",
  value: text,
}

SymbolValue = {
  type: "symbol",
  objectId: ObjectId,
}

ArrayValue = {
  type: "array",
  objectId: ObjectId,
  value?: ListValue,
}

ObjectValue = {
  type: "object",
  objectId: ObjectId,
  value?: MappingValue,
}

FunctionValue = {
  type: "function",
  objectId: ObjectId,
}

RegExpValue = {
  type: "regexp",
  objectId: ObjectId,
  value: text
}

DateValue = {
  type: "date",
  objectId: ObjectId,
  value: text
}

MapValue = {
  type: "map",
  objectId: ObjectId,
  value?: MappingValue,
}

SetValue = {
  type: "set",
  objectId: ObjectId,
  value?: ListValue
}

WeakMapValue = {
  type: "weakmap",
  objectId: ObjectId,
}

WeakSetValue = {
  type: "weakset",
  objectId: ObjectId,
}

ErrorValue = {
  type: "error",
  objectId: ObjectId,
}

PromiseValue = {
  type: "promise",
  objectId: ObjectId,
}

TypedArrayValue = {
  type: "typedarray",
  objectId: ObjectId,
}

ArrayBufferValue = {
  type: "arraybuffer",
  objectId: ObjectId,
}

NodeValue = {
  type: "node",
  objectId: ObjectId,
  value?: NodeProperties,
}

NodeProperties = {
  nodeType: uint,
  nodeValue: text,
  localName?: text,
  namespaceURI?: text,
  childNodeCount: uint,
  children?: [*NodeValue],
  attributes?: {*text => text},
  shadowRoot?: NodeValue / null,
}

WindowProxyValue = {
  type: "window",
  objectId: ObjectId,
}
</pre>
   <p class="issue" id="issue-14921645"><a class="self-link" href="#issue-14921645"></a> Add WASM types?</p>
   <p class="issue" id="issue-ace5d7fc"><a class="self-link" href="#issue-ace5d7fc"></a> Should WindowProxy get attributes in a similar style to Node?</p>
   <p class="issue" id="issue-daee5863"><a class="self-link" href="#issue-daee5863"></a> handle String / Number / etc. wrapper objects specially?</p>
   <div class="algorithm" data-algorithm="serialize as a remote value">
    <p>To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="serialize-as-a-remote-value">serialize as a remote value</dfn> given an <var>value</var>, a <var>max depth</var>, <var>node details</var>, and a <var>set of known objects</var>:</p>
    <ol>
     <li data-md>
      <p>In the following list of conditions and associated steps, run the first set
 of steps for which the associated condition is true:</p>
      <dl>
       <dt><a data-link-type="dfn" href="https://tc39.es/ecma262/#sec-ecmascript-data-types-and-values" id="ref-for-sec-ecmascript-data-types-and-values">Type</a>(<var>value</var>) is Undefined 
       <dd>Let <var>remote value</var> be a map matching the <code>UndefinedValue</code> production in the <a data-link-type="dfn" href="#local-end-definition" id="ref-for-local-end-definition①⓪">local end definition</a>. 
       <dt><a data-link-type="dfn" href="https://tc39.es/ecma262/#sec-ecmascript-data-types-and-values" id="ref-for-sec-ecmascript-data-types-and-values①">Type</a>(<var>value</var>) is Null 
       <dd>Let <var>remote value</var> be a map matching the <code>NullValue</code> production in the <a data-link-type="dfn" href="#local-end-definition" id="ref-for-local-end-definition①①">local end definition</a>. 
       <dt><a data-link-type="dfn" href="https://tc39.es/ecma262/#sec-ecmascript-data-types-and-values" id="ref-for-sec-ecmascript-data-types-and-values②">Type</a>(<var>value</var>) is String 
       <dd>
        Let <var>remote value</var> be a map matching the <code>StringValue</code> production in the <a data-link-type="dfn" href="#local-end-definition" id="ref-for-local-end-definition①②">local end definition</a>, with the <code>value</code> property set to <var>value</var>. 
        <p class="issue" id="issue-d33a79cf"><a class="self-link" href="#issue-d33a79cf"></a> This doesn’t handle lone surrogates</p>
       <dt><a data-link-type="dfn" href="https://tc39.es/ecma262/#sec-ecmascript-data-types-and-values" id="ref-for-sec-ecmascript-data-types-and-values③">Type</a>(<var>value</var>) is Number 
       <dd>
        <ol>
         <li data-md>
          <p>Switch on the value of <var>value</var>:</p>
          <dl>
           <dt>NaN 
           <dd>Let <var>serialized</var> be <code>"NaN"</code> 
           <dt>-0 
           <dd>Let <var>serialized</var> be <code>"-0"</code> 
           <dt>+Infinity 
           <dd>Let <var>serialized</var> be <code>"+Infinity"</code> 
           <dt>-Infinity 
           <dd>Let <var>serialized</var> be <code>"-Infinity"</code> 
           <dt>Otherwise: 
           <dd>Let <var>serialized</var> be <var>value</var> 
          </dl>
         <li data-md>
          <p>Let <var>remote value</var> be a map matching the <code>NumberValue</code> production in the <a data-link-type="dfn" href="#local-end-definition" id="ref-for-local-end-definition①③">local end definition</a>, with the <code>value</code> property set to <var>serialized</var>.</p>
        </ol>
       <dt><a data-link-type="dfn" href="https://tc39.es/ecma262/#sec-ecmascript-data-types-and-values" id="ref-for-sec-ecmascript-data-types-and-values④">Type</a>(<var>value</var>) is Boolean 
       <dd>Let <var>remote value</var> be a map matching the <code>BooleanValue</code> production in the <a data-link-type="dfn" href="#local-end-definition" id="ref-for-local-end-definition①④">local end definition</a>, with the <code>value</code> property set to <var>value</var>. 
       <dt><a data-link-type="dfn" href="https://tc39.es/ecma262/#sec-ecmascript-data-types-and-values" id="ref-for-sec-ecmascript-data-types-and-values⑤">Type</a>(<var>value</var>) is BigInt 
       <dd>Let <var>remote value</var> be a map matching the <code>BigIntValue</code> production in the <a data-link-type="dfn" href="#local-end-definition" id="ref-for-local-end-definition①⑤">local end definition</a>, with the <code>value</code> property set to the result of running the <a data-link-type="dfn" href="https://tc39.es/ecma262/#sec-tostring" id="ref-for-sec-tostring">ToString</a> operation on <var>value</var>. 
       <dt><a data-link-type="dfn" href="https://tc39.es/ecma262/#sec-ecmascript-data-types-and-values" id="ref-for-sec-ecmascript-data-types-and-values⑥">Type</a>(<var>value</var>) is Symbol 
       <dd>Let <var>remote value</var> be a map matching the <code>SymbolValue</code> production in the <a data-link-type="dfn" href="#local-end-definition" id="ref-for-local-end-definition①⑥">local end definition</a>, with the <code>objectId</code> property set to the <a data-link-type="dfn" href="#object-id-for-an-object" id="ref-for-object-id-for-an-object">object id for an object</a> <var>value</var>. 
       <dt><a data-link-type="dfn" href="https://tc39.es/ecma262/#sec-isarray" id="ref-for-sec-isarray">IsArray</a>(<var>value</var>) 
       <dd>
        <ol>
         <li data-md>
          <p>Let <var>serialized</var> be null.</p>
         <li data-md>
          <p>If <var>value</var> is not in the <var>set of known objects</var>, and <var>max depth</var> is not null and greater than 0, run the following steps:</p>
          <ol>
           <li data-md>
            <p>Append <var>value</var> to the <var>set of known objects</var></p>
           <li data-md>
            <p>Let <var>serialized</var> be the result of <a data-link-type="dfn" href="#serialize-as-a-list" id="ref-for-serialize-as-a-list">serialize as a list</a> given <a data-link-type="dfn" href="https://tc39.es/ecma262/#sec-createarrayiterator" id="ref-for-sec-createarrayiterator">CreateArrayIterator</a>(<var>value</var>, value), <var>max depth</var>, <var>node details</var> and <var>set of known objects</var>.</p>
          </ol>
         <li data-md>
          <p>Let <var>remote value</var> be a map matching the <code>ArrayValue</code> production
 in the <a data-link-type="dfn" href="#local-end-definition" id="ref-for-local-end-definition①⑦">local end definition</a>, with the <code>objectId</code> property set
 to the <a data-link-type="dfn" href="#object-id-for-an-object" id="ref-for-object-id-for-an-object①">object id for an object</a> <var>value</var>, and the <code>value</code> field set to <var>serialized</var> if it’s not null, or ommitted otherwise.</p>
        </ol>
       <dt><a data-link-type="dfn" href="https://tc39.es/ecma262/#sec-isregexp" id="ref-for-sec-isregexp">IsRegExp</a>(<var>value</var>) 
       <dd>
        <ol>
         <li data-md>
          <p>Let <var>pattern</var> be <a data-link-type="dfn" href="https://tc39.es/ecma262/#sec-tostring" id="ref-for-sec-tostring①">ToString</a>(<a data-link-type="dfn" href="https://tc39.es/ecma262/#sec-get" id="ref-for-sec-get">Get</a>(<var>value</var>, "source")).</p>
         <li data-md>
          <p>Let <var>flags</var> be <a data-link-type="dfn" href="https://tc39.es/ecma262/#sec-tostring" id="ref-for-sec-tostring②">ToString</a>(<a data-link-type="dfn" href="https://tc39.es/ecma262/#sec-get" id="ref-for-sec-get①">Get</a>(<var>value</var>, "flags")).</p>
         <li data-md>
          <p>Let <var>serialized</var> be the string-concatenation of "/", <var>pattern</var>, "/", and <var>flags</var>.</p>
         <li data-md>
          <p>Let <var>remote value</var> be a map matching the <code>RegExpValue</code> production in the <a data-link-type="dfn" href="#local-end-definition" id="ref-for-local-end-definition①⑧">local end definition</a>, with the <code>objectId</code> property set to the <a data-link-type="dfn" href="#object-id-for-an-object" id="ref-for-object-id-for-an-object②">object id for an object</a> <var>object</var> and the value
 set to <var>serialized</var></p>
        </ol>
       <dt><var>value</var> has a [[DateValue]] <a data-link-type="dfn" href="https://tc39.es/ecma262/#sec-object-internal-methods-and-internal-slots" id="ref-for-sec-object-internal-methods-and-internal-slots">internal slot</a>. 
       <dd>
        <ol>
         <li data-md>
          <p>Let <var>serialized</var> be <a data-link-type="dfn" href="https://tc39.es/ecma262/#sec-todatestring" id="ref-for-sec-todatestring">ToDateString</a>(<a data-link-type="dfn" href="https://tc39.es/ecma262/#thistimevalue" id="ref-for-thistimevalue">thisTimeValue</a>(<var>value</var>)).</p>
         <li data-md>
          <p>Let <var>remote value</var> be a map matching the <code>DateValue</code> production in the <a data-link-type="dfn" href="#local-end-definition" id="ref-for-local-end-definition①⑨">local end definition</a>, with the <code>objectId</code> property set to the <a data-link-type="dfn" href="#object-id-for-an-object" id="ref-for-object-id-for-an-object③">object id for an object</a> <var>object</var> and the value
 set to <var>serialized</var>.</p>
        </ol>
       <dt><var>value</var> has a [[MapData]] <a data-link-type="dfn" href="https://tc39.es/ecma262/#sec-object-internal-methods-and-internal-slots" id="ref-for-sec-object-internal-methods-and-internal-slots①">internal slot</a> 
       <dd>
        <ol>
         <li data-md>
          <p>Let <var>serialized</var> be null.</p>
         <li data-md>
          <p>If <var>value</var> is not in the <var>set of known objects</var>, and <var>max depth</var> is not null and greater than 0, run the following steps:</p>
          <ol>
           <li data-md>
            <p>Append <var>value</var> to the <var>set of known objects</var></p>
           <li data-md>
            <p>Let <var>serialized</var> be the result of <a data-link-type="dfn" href="#serialize-as-a-mapping" id="ref-for-serialize-as-a-mapping">serialize as a mapping</a> given <a data-link-type="dfn" href="https://tc39.es/ecma262/#sec-createmapiterator" id="ref-for-sec-createmapiterator">CreateMapIterator</a>(<var>value</var>, key+value), <var>max depth</var>, <var>node details</var> and <var>set of known objects</var>.</p>
          </ol>
        </ol>
        <ol>
         <li data-md>
          <p>Let <var>remote value</var> be a map matching the <code>MapValue</code> production in the <a data-link-type="dfn" href="#local-end-definition" id="ref-for-local-end-definition②⓪">local end definition</a>, with the <code>objectId</code> property set to the <a data-link-type="dfn" href="#object-id-for-an-object" id="ref-for-object-id-for-an-object④">object id for an object</a> <var>value</var>, and the <code>value</code> field set to <var>serialized</var> if it’s
 not null, or ommitted otherwise.</p>
        </ol>
       <dt><var>value</var> has a [[SetData]] <a data-link-type="dfn" href="https://tc39.es/ecma262/#sec-object-internal-methods-and-internal-slots" id="ref-for-sec-object-internal-methods-and-internal-slots②">internal slot</a> 
       <dd>
        <ol>
         <li data-md>
          <p>Let <var>serialized</var> be null.</p>
         <li data-md>
          <p>If <var>value</var> is not in the <var>set of known objects</var>, and <var>max depth</var> is not null and greater than 0, run the following steps:</p>
          <ol>
           <li data-md>
            <p>Append <var>value</var> to the <var>set of known objects</var></p>
           <li data-md>
            <p>Let <var>serialized</var> be the result of <a data-link-type="dfn" href="#serialize-as-a-list" id="ref-for-serialize-as-a-list①">serialize as a list</a> given <a data-link-type="dfn" href="https://tc39.es/ecma262/#sec-createsetiterator" id="ref-for-sec-createsetiterator">CreateSetIterator</a>(<var>value</var>, value), <var>max depth</var>, <var>node details</var> and <var>set of known objects</var>.</p>
          </ol>
        </ol>
        <ol>
         <li data-md>
          <p>Let <var>remote value</var> be a map matching the <code>SetValue</code> production in the <a data-link-type="dfn" href="#local-end-definition" id="ref-for-local-end-definition②①">local end definition</a>, with the <code>objectId</code> property set to the <a data-link-type="dfn" href="#object-id-for-an-object" id="ref-for-object-id-for-an-object⑤">object id for an object</a> <var>value</var>, and the <code>value</code> field set to <var>serialized</var> if it’s
  not null, or ommitted otherwise.</p>
        </ol>
       <dt><var>value</var> has a [[WeakMapData]] <a data-link-type="dfn" href="https://tc39.es/ecma262/#sec-object-internal-methods-and-internal-slots" id="ref-for-sec-object-internal-methods-and-internal-slots③">internal slot</a> 
       <dd>Let <var>remote value</var> be a map matching the <code>WeakMapValue</code> production in the <a data-link-type="dfn" href="#local-end-definition" id="ref-for-local-end-definition②②">local end definition</a>, with the <code>objectId</code> property set to the <a data-link-type="dfn" href="#object-id-for-an-object" id="ref-for-object-id-for-an-object⑥">object id for an object</a> <var>value</var>. 
       <dt><var>value</var> has a [[WeakSetData]] <a data-link-type="dfn" href="https://tc39.es/ecma262/#sec-object-internal-methods-and-internal-slots" id="ref-for-sec-object-internal-methods-and-internal-slots④">internal slot</a> 
       <dd>Let <var>remote value</var> be a map matching the <code>WeakSetValue</code> production in the <a data-link-type="dfn" href="#local-end-definition" id="ref-for-local-end-definition②③">local end definition</a>, with the <code>objectId</code> property set to the <a data-link-type="dfn" href="#object-id-for-an-object" id="ref-for-object-id-for-an-object⑦">object id for an object</a> <var>value</var>. 
       <dt><var>value</var> has an [[ErrorData]] <a data-link-type="dfn" href="https://tc39.es/ecma262/#sec-object-internal-methods-and-internal-slots" id="ref-for-sec-object-internal-methods-and-internal-slots⑤">internal slot</a> 
       <dd>Let <var>remote value</var> be a map matching the <code>ErrorValue</code> production in the <a data-link-type="dfn" href="#local-end-definition" id="ref-for-local-end-definition②④">local end definition</a>, with the <code>objectId</code> property set to the <a data-link-type="dfn" href="#object-id-for-an-object" id="ref-for-object-id-for-an-object⑧">object id for an object</a> <var>value</var>. 
       <dt><a data-link-type="dfn" href="https://tc39.es/ecma262/#sec-ispromise" id="ref-for-sec-ispromise">IsPromise</a>(<var>value</var>) 
       <dd>Let <var>remote value</var> be a map matching the <code>PromiseValue</code> production in the <a data-link-type="dfn" href="#local-end-definition" id="ref-for-local-end-definition②⑤">local end definition</a>, with the <code>objectId</code> property set to the <a data-link-type="dfn" href="#object-id-for-an-object" id="ref-for-object-id-for-an-object⑨">object id for an object</a> <var>value</var>. 
       <dt><var>value</var> has a [[TypedArrayName]] <a data-link-type="dfn" href="https://tc39.es/ecma262/#sec-object-internal-methods-and-internal-slots" id="ref-for-sec-object-internal-methods-and-internal-slots⑥">internal slot</a> 
       <dd>Let <var>remote value</var> be a map matching the <code>TypedArrayValue</code> production in the <a data-link-type="dfn" href="#local-end-definition" id="ref-for-local-end-definition②⑥">local end definition</a>, with the <code>objectId</code> property set to the <a data-link-type="dfn" href="#object-id-for-an-object" id="ref-for-object-id-for-an-object①⓪">object id for an object</a> <var>value</var>. 
       <dt><var>value</var> has an [[ArrayBufferData]] <a data-link-type="dfn" href="https://tc39.es/ecma262/#sec-object-internal-methods-and-internal-slots" id="ref-for-sec-object-internal-methods-and-internal-slots⑦">internal slot</a> 
       <dd>Let <var>remote value</var> be a map matching the <code>ArrayBufferValue</code> production in the <a data-link-type="dfn" href="#local-end-definition" id="ref-for-local-end-definition②⑦">local end definition</a>, with the <code>objectId</code> property set to the <a data-link-type="dfn" href="#object-id-for-an-object" id="ref-for-object-id-for-an-object①①">object id for an object</a> <var>value</var>. 
       <dt><var>value</var> is a <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#dfn-platform-object" id="ref-for-dfn-platform-object">platform object</a> that implements <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#boundary-point-node" id="ref-for-boundary-point-node">Node</a> 
       <dd>
        <ol>
         <li data-md>
          <p>Let <var>serialized</var> be null.</p>
         <li data-md>
          <p>If <var>node details</var> is true, run the following steps:</p>
          <ol>
           <li data-md>
            <p>Let <var>serialized</var> be a map.</p>
           <li data-md>
            <p>"nodeType", <a data-link-type="dfn" href="https://tc39.es/ecma262/#sec-get" id="ref-for-sec-get②">Get</a>(<var>value</var>, "nodeType"), false)</p>
           <li data-md>
            <p>Set <var>serialized</var>["<code>nodeValue</code>"] to <a data-link-type="dfn" href="https://tc39.es/ecma262/#sec-get" id="ref-for-sec-get③">Get</a>(<var>value</var>, "nodeValue")</p>
           <li data-md>
            <p>If <var>value</var> is an <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-element" id="ref-for-concept-element①">Element</a> or an <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-attribute" id="ref-for-concept-attribute">Attribute</a>:</p>
            <ol>
             <li data-md>
              <p>Set <var>serialized</var>["<code>localName</code>" to <a data-link-type="dfn" href="https://tc39.es/ecma262/#sec-get" id="ref-for-sec-get④">Get</a>(<var>value</var>, "localName")</p>
             <li data-md>
              <p>Set <var>serialized</var>["<code>namespaceURI</code>"] to <a data-link-type="dfn" href="https://tc39.es/ecma262/#sec-get" id="ref-for-sec-get⑤">Get</a>(<var>value</var>, "namespaceURI")</p>
            </ol>
           <li data-md>
            <p>Let <var>child node count</var> be the <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-size" id="ref-for-list-size">size</a> of <var>serialized</var>’s <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-tree-child" id="ref-for-concept-tree-child">children</a>.</p>
           <li data-md>
            <p>Set <var>serialized</var>["<code>childNodeCount</code>" to <var>child node count</var></p>
           <li data-md>
            <p>If <var>max depth</var> is equal to 0 let <var>children</var> be null.
 Otherwise, let <var>children</var> be an empty list and, for each node <var>child</var> in the <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-tree-child" id="ref-for-concept-tree-child①">children</a> of <var>value</var>:</p>
            <ol>
             <li data-md>
              <p>Let <var>child depth</var> be <var>max depth</var> - 1 if <var>max depth</var> is not null, or null otherwise.</p>
             <li data-md>
              <p>Let <var>serialized</var> be the result of <a data-link-type="dfn" href="#serialize-as-a-remote-value" id="ref-for-serialize-as-a-remote-value">serialize as a remote value</a> with <var>child</var>, <var>child depth</var>, <var>node details</var> and <var>set of known objects</var>.</p>
             <li data-md>
              <p>Append <var>serialized</var> to <var>children</var>.</p>
            </ol>
           <li data-md>
            <p>Set <var>serialized</var>["<code>children</code>"] to <var>children</var>.</p>
           <li data-md>
            <p>If <var>value</var> is an <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-element" id="ref-for-concept-element②">Element</a>:</p>
            <ol>
             <li data-md>
              <p>Let <var>attributes</var> be a new map.</p>
             <li data-md>
              <p>For each <var>attribute</var> in <var>value</var>’s <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-element-attribute" id="ref-for-concept-element-attribute">attribute list</a>:</p>
              <ol>
               <li data-md>
                <p>Let <var>name</var> be <var>attribute</var>’s <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-attribute-qualified-name" id="ref-for-concept-attribute-qualified-name">qualified name</a></p>
               <li data-md>
                <p>Let <var>value</var> be <var>attribute</var>’s <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-attribute-value" id="ref-for-concept-attribute-value">value</a>.</p>
               <li data-md>
                <p>Set <var>attributes</var>[<var>name</var>] to <var>value</var></p>
              </ol>
             <li data-md>
              <p>Set <var>serialized</var>["<code>attributes</code>"] to <var>attributes</var>.</p>
             <li data-md>
              <p>Let <var>shadow root</var> be <var>value</var>’s <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-element-shadow-root" id="ref-for-concept-element-shadow-root">shadow root</a>.</p>
             <li data-md>
              <p>If <var>shadow root</var> is null, let <var>serialized shadow</var> be null.
  Otherwise run the following substeps:</p>
              <ol>
               <li data-md>
                <p>Let <var>child depth</var> be <var>max depth</var> - 1 if <var>max depth</var> is not
  null, or null otherwise.</p>
               <li data-md>
                <p>Let <var>serialized shadow</var> be the result of <a data-link-type="dfn" href="#serialize-as-a-remote-value" id="ref-for-serialize-as-a-remote-value①">serialize as a remote value</a> with <var>shadow root</var>, <var>child depth</var>,
  false and <var>set of known objects</var>.</p>
                <p class="note" role="note"><span class="marker">Note:</span> this means the <code>objectId</code> for the shadow root
will be serialized irrespective of whether the shadow is open or closed,
but no properties of the node will be returned.</p>
              </ol>
             <li data-md>
              <p>Set= <var>serialized</var>["<code>shadowRoot</code>"] to <var>serialized shadow</var>.</p>
            </ol>
          </ol>
         <li data-md>
          <p>Let <var>remote value</var> be a map matching the <code>NodeValue</code> production in the <a data-link-type="dfn" href="#local-end-definition" id="ref-for-local-end-definition②⑧">local end definition</a>, with the <code>objectId</code> property set to the <a data-link-type="dfn" href="#object-id-for-an-object" id="ref-for-object-id-for-an-object①②">object id for an object</a> <var>value</var>, and <code>value</code> set to <var>serialized</var>, if <var>serialized</var> is not null.</p>
        </ol>
       <dt><var>value</var> is a <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#dfn-platform-object" id="ref-for-dfn-platform-object①">platform object</a> that implements <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#windowproxy" id="ref-for-windowproxy①">WindowProxy</a></code> 
       <dd>1. Let <var>remote value</var> be a map matching the <code>WindowProxyValue</code> production in the <a data-link-type="dfn" href="#local-end-definition" id="ref-for-local-end-definition②⑨">local end definition</a>, with the <code>objectId</code> property set to the <a data-link-type="dfn" href="#object-id-for-an-object" id="ref-for-object-id-for-an-object①③">object id for an object</a> <var>value</var>. 
       <dt><var>value</var> is a <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#dfn-platform-object" id="ref-for-dfn-platform-object②">platform object</a> 
       <dd>1. Let <var>remote value</var> be a map matching the <code>ObjectValue</code> production in the <a data-link-type="dfn" href="#local-end-definition" id="ref-for-local-end-definition③⓪">local end definition</a>, with the <code>objectId</code> property set to the <a data-link-type="dfn" href="#object-id-for-an-object" id="ref-for-object-id-for-an-object①④">object id for an object</a> <var>value</var>. 
       <dt><a data-link-type="dfn" href="https://tc39.es/ecma262/#sec-iscallable" id="ref-for-sec-iscallable">IsCallable</a>(<var>value</var>) 
       <dd>Let <var>remote value</var> be a map matching the <code>FunctionValue</code> production in the <a data-link-type="dfn" href="#local-end-definition" id="ref-for-local-end-definition③①">local end definition</a>, with the <code>objectId</code> property set to the <a data-link-type="dfn" href="#object-id-for-an-object" id="ref-for-object-id-for-an-object①⑤">object id for an object</a> <var>value</var>. 
       <dt>Otherwise: 
       <dd>
        <ol>
         <li data-md>
          <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#assert" id="ref-for-assert③">Assert</a>: <a data-link-type="dfn" href="https://tc39.es/ecma262/#sec-ecmascript-data-types-and-values" id="ref-for-sec-ecmascript-data-types-and-values⑦">type</a>(<var>value</var>) is Object</p>
         <li data-md>
          <p>let <var>serialized</var> be null.</p>
         <li data-md>
          <p>If <var>value</var> is not in the <var>set of known objects</var>, and <var>max depth</var> is greater than 0, run the following steps:</p>
          <ol>
           <li data-md>
            <p>Append <var>value</var> to the <var>set of known objects</var></p>
           <li data-md>
            <p>Let <var>serialized</var> be the result of <a data-link-type="dfn" href="#serialize-as-a-mapping" id="ref-for-serialize-as-a-mapping①">serialize as a mapping</a> given <a data-link-type="dfn" href="https://tc39.es/ecma262/#sec-enumerableownpropertynames" id="ref-for-sec-enumerableownpropertynames">EnumerableOwnPropertyNames</a>(<var>value</var>, key+value), <var>max depth</var>, <var>node
  details</var> and <var>set of known objects</var></p>
          </ol>
         <li data-md>
          <p>Let <var>remote value</var> be a map matching the <code>ObjectValue</code> production
 in the <a data-link-type="dfn" href="#local-end-definition" id="ref-for-local-end-definition③②">local end definition</a>, with the <code>objectId</code> property set
 to the <a data-link-type="dfn" href="#object-id-for-an-object" id="ref-for-object-id-for-an-object①⑥">object id for an object</a> <var>value</var>, and the <code>value</code> field
 set to <var>serialized</var>.</p>
        </ol>
      </dl>
     <li data-md>
      <p>Return <var>remote value</var></p>
    </ol>
    <p class="issue" id="issue-66909ae2"><a class="self-link" href="#issue-66909ae2"></a> Does it make sense to use the same depth parameter for nodes and objects
in general?</p>
   </div>
   <div class="algorithm" data-algorithm="serialize as a list">
     To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="serialize-as-a-list">serialize as a list</dfn> given <var>iterable</var>, <var>max depth</var>, <var>node details</var> and <var>set of known objects</var>: 
    <ol>
     <li data-md>
      <p>Let <var>serialized</var> be a new list.</p>
     <li data-md>
      <p>For each <var>child value</var> in <var>iterable</var>:</p>
      <ol>
       <li data-md>
        <p>Let <var>child depth</var> be <var>max depth</var> - 1 if <var>max depth</var> is not null, or null
 otherwise.</p>
       <li data-md>
        <p>Let <var>serialized child</var> be the result of <a data-link-type="dfn" href="#serialize-as-a-remote-value" id="ref-for-serialize-as-a-remote-value②">serialize as a remote value</a> with arguments <var>child value</var>, <var>child depth</var>, <var>node details</var> and <var>set of
 known objects</var>.</p>
       <li data-md>
        <p>Append <var>serialized child</var> to <var>serialized</var>.</p>
      </ol>
     <li data-md>
      <p>Return <var>serialized</var></p>
    </ol>
   </div>
   <p class="issue" id="issue-c12b3c7f"><a class="self-link" href="#issue-c12b3c7f"></a> this assumes for-in works on iterators</p>
   <div class="algorithm" data-algorithm="serialize as a mapping">
     To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="serialize-as-a-mapping">serialize as a mapping</dfn> given <var>iterable</var>, <var>max depth</var>, <var>node details</var> and <var>set of known objects</var>: 
    <ol>
     <li data-md>
      <p>Let <var>serialized</var> be a new list.</p>
     <li data-md>
      <p>For <var>item</var> in <var>iterable</var>:</p>
      <ol>
       <li data-md>
        <p class="assertion">Assert: <a data-link-type="dfn" href="https://tc39.es/ecma262/#sec-isarray" id="ref-for-sec-isarray①">IsArray</a>(<var>item</var>)</p>
       <li data-md>
        <p>Let <var>property</var> be <a data-link-type="dfn" href="https://tc39.es/ecma262/#sec-createlistfromarraylike" id="ref-for-sec-createlistfromarraylike">CreateListFromArrayLike</a>(<var>item</var>)</p>
       <li data-md>
        <p class="assertion">Assert: <var>property</var> is a list of <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-size" id="ref-for-list-size①">size</a> 2</p>
       <li data-md>
        <p>Let <var>key</var> be <var>property</var>[0] and let <var>value</var> be <var>property</var>[1]</p>
       <li data-md>
        <p>Let <var>child depth</var> be <var>max depth</var> - 1 if <var>max depth</var> is not null, or null
 otherwise.</p>
       <li data-md>
        <p>If <a data-link-type="dfn" href="https://tc39.es/ecma262/#sec-ecmascript-data-types-and-values" id="ref-for-sec-ecmascript-data-types-and-values⑧">Type</a>(<var>key</var>) is String, let <var>serialized key</var> be <var>child key</var>,
 otherwise let <var>serialized key</var> be the result of <a data-link-type="dfn" href="#serialize-as-a-remote-value" id="ref-for-serialize-as-a-remote-value③">serialize as a remote
 value</a> with arguments <var>child key</var>, <var>child depth</var>, <var>node details</var> and <var>set of known objects</var>.</p>
       <li data-md>
        <p>Let <var>serialized value</var> be the result of <a data-link-type="dfn" href="#serialize-as-a-remote-value" id="ref-for-serialize-as-a-remote-value④">serialize as a remote value</a> with arguments <var>value</var>, <var>child depth</var>, <var>node details</var> and <var>set of known
 objects</var>.</p>
       <li data-md>
        <p>Let <var>serialized child</var> be («<var>serialized key</var>, <var>serialized value</var>»).</p>
       <li data-md>
        <p>Append <var>serialized child</var> to <var>serialized</var>.</p>
      </ol>
     <li data-md>
      <p>Return <var>serialized</var></p>
    </ol>
   </div>
   <h2 class="heading settled" data-level="6" id="modules"><span class="secno">6. </span><span class="content">Modules</span><a class="self-link" href="#modules"></a></h2>
   <h3 class="heading settled" data-level="6.1" id="module-session"><span class="secno">6.1. </span><span class="content">The session Module</span><a class="self-link" href="#module-session"></a></h3>
   <p>The <dfn class="dfn-paneled" data-dfn-for="modules" data-dfn-type="dfn" data-export id="modules-session">session</dfn> module contains commands and
events for monitoring the status of the remote end.</p>
   <h4 class="heading settled" data-level="6.1.1" id="module-session-definition"><span class="secno">6.1.1. </span><span class="content">Definition</span><a class="self-link" href="#module-session-definition"></a></h4>
   <p><a data-link-type="dfn" href="#remote-end-definition" id="ref-for-remote-end-definition⑦">remote end definition</a></p>
<pre class="cddl remote-cddl">SessionCommand = (SessionStatusCommand //
                  SessionSubscribeCommand)
</pre>
   <p><a data-link-type="dfn" href="#local-end-definition" id="ref-for-local-end-definition③③">local end definition</a></p>
<pre class="cddl local-cddl">SessionResult = (StatusResult)

</pre>
   <div class="algorithm" data-algorithm="update the event map">
    <p>To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="update-the-event-map">update the event map</dfn>, given <var>session</var>, <var>list of event names</var>, <var>browsing contexts</var>, and <var>enabled</var>:</p>
    <p class="note" role="note"><span class="marker">Note:</span> The return value of this algorithm is a map between event names and
contexts. When the events are being enabled globally, the contexts in the return
value are those for which the event was already enabled. When the events are
enabled for specific contexts, the contexts in the return value are those for
which the event are now enabled but were not previously. When events are
disabled, the return value is always empty.</p>
    <ol>
     <li data-md>
      <p>Let <var>global event set</var> be a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-clone" id="ref-for-list-clone">clone</a> of the <a data-link-type="dfn" href="#event-global-event-set" id="ref-for-event-global-event-set①">global event set</a> for <var>session</var>.</p>
     <li data-md>
      <p>Let <var>event map</var> be a new map.</p>
     <li data-md>
      <p>For each <var>key</var> → <var>value</var> of the <a data-link-type="dfn" href="#event-browsing-context-event-map" id="ref-for-event-browsing-context-event-map②">browsing context event map</a> for <var>session</var>:</p>
      <ol>
       <li data-md>
        <p>Set <var>event map</var>[<var>key</var>] to a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-clone" id="ref-for-list-clone①">clone</a> of <var>value</var>.</p>
      </ol>
     <li data-md>
      <p>Let <var>enabled events</var> be a new map.</p>
     <li data-md>
      <p>Let <var>event names</var> be an empty set.</p>
      <ol>
       <li data-md>
        <p>For each entry <var>name</var> in <var>list of event names</var>, let <var>event names</var> be
 the union of <var>event names</var> and the result of <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-try" id="ref-for-dfn-try">trying</a> to <a data-link-type="dfn" href="#obtain-a-set-of-event-names" id="ref-for-obtain-a-set-of-event-names">obtain a set
 of event names</a> with <var>name</var>.</p>
      </ol>
     <li data-md>
      <p>If <var>browsing contexts</var> is null:</p>
      <ol>
       <li data-md>
        <p>If <var>enabled</var> is true:</p>
        <ol>
         <li data-md>
          <p>For each <var>event name</var> of <var>event names</var>:</p>
          <ol>
           <li data-md>
            <p>If <var>global event set</var> doesn’t contain <var>event name</var>:</p>
            <ol>
             <li data-md>
              <p>Let <var>event enabled contexts</var> be the <a data-link-type="dfn" href="#event-enabled-browsing-contexts" id="ref-for-event-enabled-browsing-contexts">event enabled browsing
  contexts</a> given <var>session</var> and <var>event name</var></p>
             <li data-md>
              <p>Add <var>event name</var> to <var>global event set</var>.</p>
             <li data-md>
              <p>For each <var>context</var> of <var>event enabled contexts</var>, remove <var>event
  name</var> from <var>event map</var>[<var>context</var>].</p>
             <li data-md>
              <p>Set <var>enabled events</var>[<var>event name</var>] to <var>event enabled contexts</var>.</p>
            </ol>
          </ol>
        </ol>
       <li data-md>
        <p>If <var>enabled</var> is false:</p>
        <ol>
         <li data-md>
          <p>For each <var>event name</var> in <var>event names</var>:</p>
          <ol>
           <li data-md>
            <p>If <var>global event set</var> <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#header-list-contains" id="ref-for-header-list-contains⑤">contains</a> <var>event name</var>, remove <var>event
 name</var> from <var>global event set</var>. Otherwise return <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-errors" id="ref-for-dfn-errors④">error</a> with <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-error-code" id="ref-for-dfn-error-code④">error code</a> <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-invalid-argument" id="ref-for-dfn-invalid-argument⑥">invalid argument</a>.</p>
          </ol>
        </ol>
      </ol>
     <li data-md>
      <p>Otherwise, if <var>browsing contexts</var> is not null:</p>
      <ol>
       <li data-md>
        <p>Let <var>targets</var> be an empty map.</p>
       <li data-md>
        <p>For each <var>context id</var> in <var>browsing contexts</var>:</p>
        <ol>
         <li data-md>
          <p>Let <var>context</var> be the result of <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-try" id="ref-for-dfn-try①">trying</a> to <a data-link-type="dfn" href="#get-a-browsing-context" id="ref-for-get-a-browsing-context">get a browsing context</a> with <var>context id</var>.</p>
         <li data-md>
          <p>Let <var>top-level context</var> be the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#top-level-browsing-context" id="ref-for-top-level-browsing-context②">top-level browsing context</a> for <var>context</var>.</p>
         <li data-md>
          <p>If <var>event map</var> does not contain <var>top-level context</var>, set <var>event
 map</var>[<var>top-level context</var>] to a new set.</p>
         <li data-md>
          <p>Set <var>targets</var>[<var>top-level context</var>] to <var>event map</var>[<var>top-level context</var>].</p>
        </ol>
       <li data-md>
        <p>For each <var>event name</var> in <var>event names</var>:</p>
        <ol>
         <li data-md>
          <p>If <var>enabled</var> is true and <var>global event set</var> contains <var>event name</var>, continue.</p>
         <li data-md>
          <p>For each <var>context</var> → <var>target</var> in <var>targets</var>:</p>
          <ol>
           <li data-md>
            <p>If <var>enabled</var> is true and <var>target</var> does not contain <var>event name</var>:</p>
            <ol>
             <li data-md>
              <p>Add <var>event name</var> to <var>target</var>.</p>
             <li data-md>
              <p>If <var>enabled events</var> does not contain <var>event name</var>, set <var>enabled
 events</var>[<var>event name</var>] to a new set.</p>
             <li data-md>
              <p>Append <var>context</var> to <var>enabled events</var>[<var>event name</var>].</p>
            </ol>
           <li data-md>
            <p>If <var>enabled</var> is false:</p>
            <ol>
             <li data-md>
              <p>If <var>target</var> contains <var>event name</var>, remove <var>event name</var> from <var>target</var>. Otherwise return <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-errors" id="ref-for-dfn-errors⑤">error</a> with <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-error-code" id="ref-for-dfn-error-code⑤">error code</a> <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-invalid-argument" id="ref-for-dfn-invalid-argument⑦">invalid
 argument</a>.</p>
            </ol>
          </ol>
        </ol>
      </ol>
     <li data-md>
      <p>Set the <a data-link-type="dfn" href="#event-global-event-set" id="ref-for-event-global-event-set②">global event set</a> for <var>session</var> to <var>global event set</var>.</p>
     <li data-md>
      <p>Set the <a data-link-type="dfn" href="#event-browsing-context-event-map" id="ref-for-event-browsing-context-event-map③">browsing context event map</a> for <var>session</var> to <var>event map</var>.</p>
     <li data-md>
      <p>Return <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-success" id="ref-for-dfn-success⑤">success</a> with data <var>enabled events</var>.</p>
    </ol>
    <p class="note" role="note"><span class="marker">Note:</span> Implementations that do additional work when an event is enabled,
e.g. subscribing to the relevant engine-internal events, will likely perform
those additional steps when updating the event map. This specification uses
a model where hooks are always called and then the event map is used to
filter only those that ought to be returned to the local end.</p>
   </div>
   <h4 class="heading settled" data-level="6.1.2" id="module-session-commands"><span class="secno">6.1.2. </span><span class="content">Commands</span><a class="self-link" href="#module-session-commands"></a></h4>
   <h5 class="heading settled" data-level="6.1.2.1" id="command-session-status"><span class="secno">6.1.2.1. </span><span class="content">The session.status Command</span><a class="self-link" href="#command-session-status"></a></h5>
   <p>The <dfn class="dfn-paneled" data-dfn-for="commands" data-dfn-type="dfn" data-export id="commands-sessionstatus">session.status</dfn> command returns information about
whether a remote end is in a state in which it can create new sessions,
but may additionally include arbitrary meta information that is specific
to the implementation.</p>
   <dl>
    <dt>Command Type
    <dd>
<pre class="cddl remote-cddl">SessionStatusCommand = {
  method: "session.status",
  params: EmptyParams,
}
</pre>
    <dt>Return Type
    <dd>
<pre class="cddl local-cddl">SessionStatusResult = {
  ready: bool,
  message: text,
}
</pre>
   </dl>
   <p>The <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-remote-end-steps" id="ref-for-dfn-remote-end-steps②">remote end steps</a> are:</p>
   <ol>
    <li data-md>
     <p>Let <var>body</var> be a new <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map" id="ref-for-ordered-map">map</a> with the following properties:</p>
     <dl>
      <dt>"ready"
      <dd>The <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-remote-ends" id="ref-for-dfn-remote-ends①④">remote end</a>’s readiness state.
      <dt>"message"
      <dd>An implementation-defined string explaining the <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-remote-ends" id="ref-for-dfn-remote-ends①⑤">remote end</a>’s readiness
 state.
     </dl>
    <li data-md>
     <p>Return <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-success" id="ref-for-dfn-success⑥">success</a> with data <var>body</var></p>
   </ol>
   <h5 class="heading settled" data-level="6.1.2.2" id="command-session-subscribe"><span class="secno">6.1.2.2. </span><span class="content">The session.subscribe Command</span><a class="self-link" href="#command-session-subscribe"></a></h5>
   <p>The <dfn class="dfn-paneled" data-dfn-for="commands" data-dfn-type="dfn" data-export id="commands-sessionsubscribe">session.subscribe</dfn> command enables certain events
either globally or for a set of browsing contexts</p>
   <p class="issue" id="issue-77ae0f57"><a class="self-link" href="#issue-77ae0f57"></a> This needs to be generalized to work with realms too</p>
   <dl>
    <dt>Command Type
    <dd>
<pre class="cddl remote-cddl">SessionSubscribeCommand = {
  method: "session.subscribe",
  params: SubscribeParameters
}

SessionSubscribeParameters = {
  events: [*text],
  ?contexts: [*BrowsingContext],
}
</pre>
    <dt>Return Type
    <dd>
<pre class="cddl local-cddl">EmptyResult
</pre>
   </dl>
   <p>The <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-remote-end-steps" id="ref-for-dfn-remote-end-steps③">remote end steps</a> with <var>command parameters</var> are:</p>
   <div class="algorithm" data-algorithm="remote end steps for session.subscribe">
    <ol>
     <li data-md>
      <p>Let the <var>list of event names</var> be the value of the <code>events</code> field of <var>command parameters</var></p>
     <li data-md>
      <p>Let the <var>list of contexts</var> be the value of the <code>contexts</code> field of <var>command parameters</var> if it is present or null if it isn’t.</p>
     <li data-md>
      <p>Let <var>enabled events</var> be the result of <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-try" id="ref-for-dfn-try②">trying</a> to <a data-link-type="dfn" href="#update-the-event-map" id="ref-for-update-the-event-map">update the event map</a> with <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-current-session" id="ref-for-dfn-current-session⑤">current session</a>, <var>list of event names</var> , <var>list of contexts</var> and
 enabled true.</p>
     <li data-md>
      <p>Let <var>subscribe step events</var> be a new map.</p>
     <li data-md>
      <p>For each <var>event name</var> → <var>contexts</var> in <var>enabled events</var>:</p>
      <ol>
       <li data-md>
        <p>If the <a data-link-type="dfn" href="#event" id="ref-for-event⑤">event</a> with <a data-link-type="dfn" href="#event-event-name" id="ref-for-event-event-name⑤">event name</a> <var>event name</var> defines <a data-link-type="dfn" href="#remote-end-subscribe-steps" id="ref-for-remote-end-subscribe-steps">remote end
 subscribe steps</a>, set <var>subscribe step events</var>[<var>event name</var>] to <var>contexts</var>.</p>
      </ol>
     <li data-md>
      <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-sort-in-ascending-order" id="ref-for-map-sort-in-ascending-order">Sort in ascending order</a> <var>subscribe step events</var> using the following less
 than algorithm given two entries with keys <var>event name one</var> and <var>event
 name two</var>:</p>
      <ol>
       <li data-md>
        <p>Let <var>event one</var> be the <a data-link-type="dfn" href="#event" id="ref-for-event⑥">event</a> with name <var>event name one</var></p>
       <li data-md>
        <p>Let <var>event two</var> be the <a data-link-type="dfn" href="#event" id="ref-for-event⑦">event</a> with name <var>event name two</var></p>
       <li data-md>
        <p>Return true if <var>event one</var>’s <a data-link-type="dfn" href="#subscribe-priority" id="ref-for-subscribe-priority">subscribe priority</a> is less than <var>event
 two</var>’s susbscribe priority, or false otherwise.</p>
      </ol>
     <li data-md>
      <p>For each <var>event name</var> → <var>contexts</var> in <var>subscribe step events</var>:</p>
      <ol>
       <li data-md>
        <p>If <var>list of contexts</var> is null, let <var>include contexts</var> be a list of all <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#top-level-browsing-context" id="ref-for-top-level-browsing-context③">top-level browsing contexts</a> that are not contained in <var>contexts</var>, and
 let <var>include global</var> be true.</p>
        <p>Otherwise let <var>include contexts</var> be <var>contexts</var> and let <var>include global</var> be
 false.</p>
       <li data-md>
        <p>Run the <a data-link-type="dfn" href="#remote-end-subscribe-steps" id="ref-for-remote-end-subscribe-steps①">remote end subscribe steps</a> for the <a data-link-type="dfn" href="#event" id="ref-for-event⑧">event</a> with <a data-link-type="dfn" href="#event-event-name" id="ref-for-event-event-name⑥">event name</a> <var>event name</var> given <var>include contexts</var> and <var>include global</var>.</p>
      </ol>
     <li data-md>
      <p>Return <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-success" id="ref-for-dfn-success⑦">success</a> with data null.</p>
    </ol>
   </div>
   <h5 class="heading settled" data-level="6.1.2.3" id="command-session-unsubscribe"><span class="secno">6.1.2.3. </span><span class="content">The session.unsubscribe Command</span><a class="self-link" href="#command-session-unsubscribe"></a></h5>
   <p>The <dfn class="dfn-paneled" data-dfn-for="commands" data-dfn-type="dfn" data-export id="commands-sessionunsubscribe">session.unsubscribe</dfn> command disables events
either globally or for a set of browsing contexts</p>
   <p class="issue" id="issue-851a021c"><a class="self-link" href="#issue-851a021c"></a> This needs to be generalised to work with realms too</p>
   <dl>
    <dt>Command Type
    <dd>
<pre class="cddl remote-cddl">SessionUnsubscribeCommand = {
  method: "session.unsubscribe",
  params: SubscribeParameters
}
</pre>
    <dt>Return Type
    <dd>
<pre class="cddl local-cddl">EmptyResult
</pre>
   </dl>
   <p>The <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-remote-end-steps" id="ref-for-dfn-remote-end-steps④">remote end steps</a> with <var>command parameters</var> are:</p>
   <div class="algorithm" data-algorithm="remote end steps for session.unsubscribe">
    <ol>
     <li data-md>
      <p>Let the <var>list of event names</var> be the value of the <code>events</code> field of <var>command parameters</var>.</p>
     <li data-md>
      <p>Let the <var>list of contexts</var> be the value of the <code>contexts</code> field of <var>command parameters</var> if it is present or null if it isn’t.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-try" id="ref-for-dfn-try③">Try</a> to <a data-link-type="dfn" href="#update-the-event-map" id="ref-for-update-the-event-map①">update the event map</a> with <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-current-session" id="ref-for-dfn-current-session⑥">current session</a>, <var>list of event names</var>, <var>list of contexts</var> and enabled false.</p>
     <li data-md>
      <p>Return <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-success" id="ref-for-dfn-success⑧">success</a> with data null.</p>
    </ol>
   </div>
   <h3 class="heading settled" data-level="6.2" id="module-browsingContext"><span class="secno">6.2. </span><span class="content">The browsingContext Module</span><a class="self-link" href="#module-browsingContext"></a></h3>
   <p>The <dfn class="dfn-paneled" data-dfn-for="modules" data-dfn-type="dfn" data-export id="modules-browsingcontext">browsingContext</dfn> module contains commands and
events relating to browsing contexts.</p>
   <h4 class="heading settled" data-level="6.2.1" id="module-browsingContext-definition"><span class="secno">6.2.1. </span><span class="content">Definition</span><a class="self-link" href="#module-browsingContext-definition"></a></h4>
   <p><a data-link-type="dfn" href="#remote-end-definition" id="ref-for-remote-end-definition⑧">remote end definition</a></p>
<pre class="cddl remote-cddl">BrowsingContextCommand = (BrowsingContextGetTreeCommand)
</pre>
   <p><a data-link-type="dfn" href="#local-end-definition" id="ref-for-local-end-definition③④">local end definition</a></p>
<pre class="cddl local-cddl">BrowsingContextResult = (BrowsingContextGetTreeResult)

BrowsingContextEvent = (
    BrowsingContextCreatedEvent //
    BrowsingContextDestroyedEvent
)

</pre>
   <h4 class="heading settled" data-level="6.2.2" id="module-browsingcontext-types"><span class="secno">6.2.2. </span><span class="content">Types</span><a class="self-link" href="#module-browsingcontext-types"></a></h4>
   <h5 class="heading settled" data-level="6.2.2.1" id="type-browsingContext-Browsingcontext"><span class="secno">6.2.2.1. </span><span class="content">The browsingContext.BrowsingContext Type</span><a class="self-link" href="#type-browsingContext-Browsingcontext"></a></h5>
   <p><a data-link-type="dfn" href="#remote-end-definition" id="ref-for-remote-end-definition⑨">remote end definition</a> and <a data-link-type="dfn" href="#local-end-definition" id="ref-for-local-end-definition③⑤">local end definition</a></p>
<pre class="cddl local-cddl remote-cddl">BrowsingContext = text;
</pre>
   <p>Each <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#browsing-context" id="ref-for-browsing-context">browsing context</a> has an associated <dfn class="dfn-paneled" data-dfn-type="dfn" data-export data-lt="browsing context id" id="browsing-context-id">browsing context
id</dfn>, which is a string uniquely identifying that browsing context. This is
implicitly set when the context is created. For browsing contexts with an
associated WebDriver <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-window-handle" id="ref-for-dfn-window-handle①">window handle</a> the <a data-link-type="dfn" href="#browsing-context-id" id="ref-for-browsing-context-id">browsing context id</a> must be the
same as the <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-window-handle" id="ref-for-dfn-window-handle②">window handle</a>.</p>
   <div class="algorithm" data-algorithm="get a browsing context">
     To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="get-a-browsing-context">get a browsing context</dfn> given <var>context id</var>: 
    <ol>
     <li data-md>
      <p>If <var>context id</var> is null, return <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-success" id="ref-for-dfn-success⑨">success</a> with data null.</p>
     <li data-md>
      <p>If there is no browsing context with <a data-link-type="dfn" href="#browsing-context-id" id="ref-for-browsing-context-id①">browsing context id</a> <var>context id</var> return <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-errors" id="ref-for-dfn-errors⑥">error</a> with <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-error-code" id="ref-for-dfn-error-code⑥">error code</a> <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-no-such-frame" id="ref-for-dfn-no-such-frame">no such frame</a></p>
     <li data-md>
      <p>Let <var>context</var> be the browsing context with id <var>context id</var>.</p>
     <li data-md>
      <p>Return <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-success" id="ref-for-dfn-success①⓪">success</a> with data <var>context</var></p>
    </ol>
   </div>
   <h5 class="heading settled" data-level="6.2.2.2" id="type-browsingContext-BrowsingContextInfo"><span class="secno">6.2.2.2. </span><span class="content">The browsingContext.BrowsingContextInfo Type</span><a class="self-link" href="#type-browsingContext-BrowsingContextInfo"></a></h5>
   <p><a data-link-type="dfn" href="#local-end-definition" id="ref-for-local-end-definition③⑥">local end definition</a></p>
<pre class="cddl local-cddl">BrowsingContextInfoList = [* BrowsingContextInfo]

BrowsingContextInfo = {
  context: BrowsingContext,
  ?parent: BrowsingContext / null,
  url: text,
  children: BrowsingContextInfoList / null
}

</pre>
   <p>The <code>BrowsingContextInfo</code> type represents the properties of a
browsing context.</p>
   <div class="algorithm" data-algorithm="get the browsing context info">
     To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="get-the-browsing-context-info">get the browsing context info</dfn> given <var>context</var>, <var>depth</var> and <var>max depth</var>: 
    <ol>
     <li data-md>
      <p>Let <var>context id</var> be the <a data-link-type="dfn" href="#browsing-context-id" id="ref-for-browsing-context-id②">browsing context id</a> for <var>context</var>.</p>
     <li data-md>
      <p>If <var>context</var> has a <a data-link-type="dfn">parent browsing context</a> let <var>parent id</var> be the <a data-link-type="dfn" href="#browsing-context-id" id="ref-for-browsing-context-id③">browsing context id</a> of that parent. Otherwise let <var>parent id</var> be null.</p>
     <li data-md>
      <p>Let <var>document</var> be <var>context</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#nav-document" id="ref-for-nav-document">active document</a>.</p>
     <li data-md>
      <p>Let <var>url</var> be the result of running the <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-serializer" id="ref-for-concept-url-serializer">URL serializer</a>, given <var>document</var>’s <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-document-url" id="ref-for-concept-document-url">URL</a>.</p>
      <p class="note" role="note"><span class="marker">Note:</span> This includes the fragment component of the URL.</p>
     <li data-md>
      <p>Let <var>child info</var> be the result of <a data-link-type="dfn" href="#get-the-descendent-browsing-contexts" id="ref-for-get-the-descendent-browsing-contexts">get the descendent browsing contexts</a> given <var>context id</var>, <var>depth</var> + 1, and <var>max depth</var>.</p>
     <li data-md>
      <p>Let <var>context info</var> be a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map" id="ref-for-ordered-map①">map</a> matching the <code>BrowsingContextInfo</code> production with the <code>context</code> field set to <var>context id</var>, the <code>parent</code> field set to <var>parent id</var> if <var>depth</var> is 0, or unset otherwise, the <code>url</code> field set to <var>url</var>, and the <code>children</code> field set to <var>child info</var>.</p>
     <li data-md>
      <p>Return <var>context info</var>.</p>
    </ol>
   </div>
   <div class="algorithm" data-algorithm="get the descendent browsing contexts">
     To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="get-the-descendent-browsing-contexts">get the descendent browsing contexts</dfn> given <var>parent id</var>, <var>depth</var> and <var>max depth</var>: 
    <ol>
     <li data-md>
      <p>If <var>max depth</var> is greater than zero, and <var>depth</var> is equal to <var>max depth</var>,
 return null.</p>
     <li data-md>
      <p>Let <var>parent</var> be the result of <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-try" id="ref-for-dfn-try④">trying</a> to <a data-link-type="dfn" href="#get-a-browsing-context" id="ref-for-get-a-browsing-context①">get a browsing context</a> given <var>parent id</var>.</p>
     <li data-md>
      <p>If <var>parent</var> is null, let <var>child contexts</var> be a list containing all <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#top-level-browsing-context" id="ref-for-top-level-browsing-context④">top-level
 browsing contexts</a>. Otherwise let <var>child contexts</var> be a list containing all <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#browsing-context" id="ref-for-browsing-context①">browsing contexts</a> which are <a data-link-type="dfn">child browsing contexts</a> of <var>parent</var>.</p>
     <li data-md>
      <p>Let <var>contexts info</var> be a list.</p>
     <li data-md>
      <p>For each <var>context</var> of <var>child contexts</var>:</p>
      <ol>
       <li data-md>
        <p>Let <var>info</var> be the result of <a data-link-type="dfn" href="#get-the-browsing-context-info" id="ref-for-get-the-browsing-context-info">get the browsing context info</a> given <var>context</var>, <var>depth</var>, and <var>max depth</var>.</p>
       <li data-md>
        <p>Append <var>info</var> to <var>contexts info</var></p>
      </ol>
     <li data-md>
      <p>Return <var>contexts info</var></p>
    </ol>
   </div>
   <h4 class="heading settled" data-level="6.2.3" id="module-browsingContext-commands"><span class="secno">6.2.3. </span><span class="content">Commands</span><a class="self-link" href="#module-browsingContext-commands"></a></h4>
   <h5 class="heading settled" data-level="6.2.3.1" id="command-browsingContext-list"><span class="secno">6.2.3.1. </span><span class="content">The browsingContext.getTree Command</span><a class="self-link" href="#command-browsingContext-list"></a></h5>
   <p>The <dfn class="dfn-paneled" data-dfn-for="commands" data-dfn-type="dfn" data-export id="commands-browsingcontextgettree">browsingContext.getTree</dfn> command returns a
tree of all browsing contexts that are descendents of the given context, or all
top-level contexts when no parent is provided.</p>
   <dl>
    <dt>Command Type
    <dd>
<pre class="cddl remote-cddl">BrowsingContextGetTreeCommand = {
  method: "browsingContext.getTree",
  params: BrowsingContextGetTreeParameters
}

BrowsingContextGetTreeParameters = {
  ?maxDepth: uint,
  ?parent: BrowsingContext,
}
</pre>
    <dt>Return Type
    <dd>
<pre class="cddl local-cddl">BrowsingContextGetTreeResult = {
  contexts: BrowsingContextInfoList
}
</pre>
   </dl>
   <div class="algorithm" data-algorithm="remote end steps for browsingContext.getTree">
     The <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-remote-end-steps" id="ref-for-dfn-remote-end-steps⑤">remote end steps</a> with <var>command parameters</var> are: 
    <ol>
     <li data-md>
      <p>Let the <var>parent id</var> be the value of the <code>parent</code> field of <var>command parameters</var> if present, or null otherwise.</p>
     <li data-md>
      <p>Let <var>max depth</var> be the value of the <code>maxDepth</code> field of <var>command
 parameters</var> if present, or 0 otherwise.</p>
     <li data-md>
      <p>Let <var>depth</var> be 0.</p>
     <li data-md>
      <p>Let <var>contexts</var> be the result of <a data-link-type="dfn" href="#get-the-descendent-browsing-contexts" id="ref-for-get-the-descendent-browsing-contexts①">get the descendent browsing contexts</a>,
 given <var>parent id</var>, <var>depth</var>, and <var>max depth</var>.</p>
     <li data-md>
      <p>Let <var>body</var> be a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map" id="ref-for-ordered-map②">map</a> matching the <code>BrowsingContextGetTreeResult</code> production, with the <code>contexts</code> field set to <var>contexts</var>.</p>
     <li data-md>
      <p>Return <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-success" id="ref-for-dfn-success①①">success</a> with data <var>body</var>.</p>
    </ol>
   </div>
   <h4 class="heading settled" data-level="6.2.4" id="module-contexts-events"><span class="secno">6.2.4. </span><span class="content">Events</span><a class="self-link" href="#module-contexts-events"></a></h4>
   <h5 class="heading settled" data-level="6.2.4.1" id="event-browsingContext-contextCreated"><span class="secno">6.2.4.1. </span><span class="content">The browsingContext.contextCreated Event</span><a class="self-link" href="#event-browsingContext-contextCreated"></a></h5>
   <dl>
    <dt>Event Type
    <dd>
<pre class="cddl local-cddl"> BrowsingContextCreatedEvent = {
  method: "browsingContext.contextCreated",
  params: BrowsingContextInfo
}
</pre>
   </dl>
   <div class="algorithm" data-algorithm="Recursively emit context created events">
    <p>To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="recursively-emit-context-created-events">Recursively emit context created events</dfn> given <var>context</var>:</p>
    <ol>
     <li data-md>
      <p><a data-link-type="dfn" href="#emit-a-context-created-event" id="ref-for-emit-a-context-created-event">Emit a context created event</a> with <var>context</var>.</p>
     <li data-md>
      <p>For each child browsing context, <var>child</var>, of <var>context</var>:</p>
      <ol>
       <li data-md>
        <p><a data-link-type="dfn" href="#recursively-emit-context-created-events" id="ref-for-recursively-emit-context-created-events">Recursively emit context created events</a> given <var>child</var>.</p>
      </ol>
    </ol>
   </div>
   <div class="algorithm" data-algorithm="Emit a context created event">
    <p>To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="emit-a-context-created-event">Emit a context created event</dfn> given <var>context</var>:</p>
    <ol>
     <li data-md>
      <p>Let <var>related contexts</var> be a set containing <var>context</var>.</p>
     <li data-md>
      <p>Let <var>params</var> be the result of <a data-link-type="dfn" href="#get-the-browsing-context-info" id="ref-for-get-the-browsing-context-info①">get the browsing context info</a> given <var>context</var>, 0, and 1.</p>
     <li data-md>
      <p>Let <var>body</var> be a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map" id="ref-for-ordered-map③">map</a> matching the <code>BrowsingContextCreatedEvent</code> production, with the <code>params</code> field set to <var>params</var>.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="#emit-an-event" id="ref-for-emit-an-event">Emit an event</a> with <var>body</var> and <var>related contexts</var>.</p>
    </ol>
   </div>
   <div class="algorithm" data-algorithm="remote end event trigger for browsingContext.contextCreated">
    <p>The <a data-link-type="dfn" href="#remote-end-event-trigger" id="ref-for-remote-end-event-trigger">remote end event trigger</a> is:</p>
    <p>When the <a data-link-type="dfn" href="https://html.spec.whatwg.org/#creating-a-new-browsing-context" id="ref-for-creating-a-new-browsing-context">create a new browsing context</a> algorithm is invoked, after the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#nav-document" id="ref-for-nav-document①">active document</a> of the browsing context is set, run the following steps:</p>
    <ol>
     <li data-md>
      <p>Let <var>context</var> be the newly created browsing context.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="#emit-a-context-created-event" id="ref-for-emit-a-context-created-event①">Emit a context created event</a> given <var>context</var>.</p>
    </ol>
   </div>
   <div class="algorithm" data-algorithm="remote end subscribe steps for browsingContext.contextCreated">
    <p>The <a data-link-type="dfn" href="#remote-end-subscribe-steps" id="ref-for-remote-end-subscribe-steps②">remote end subscribe steps</a>, with <a data-link-type="dfn" href="#subscribe-priority" id="ref-for-subscribe-priority①">subscribe priority</a> 1, given <var>contexts</var> and <var>include global</var> are:</p>
    <ol>
     <li data-md>
      <p>For each <var>context</var> in <var>contexts</var>:</p>
      <ol>
       <li data-md>
        <p><a data-link-type="dfn" href="#recursively-emit-context-created-events" id="ref-for-recursively-emit-context-created-events①">Recursively emit context created events</a> given <var>context</var>.</p>
      </ol>
    </ol>
   </div>
   <h5 class="heading settled" data-level="6.2.4.2" id="event-browsingContext-contextDestroyed"><span class="secno">6.2.4.2. </span><span class="content">The browsingContext.contextDestroyed Event</span><a class="self-link" href="#event-browsingContext-contextDestroyed"></a></h5>
   <dl>
    <dt>Event Type
    <dd>
<pre class="cddl local-cddl"> BrowsingContextDestroyedEvent = {
  method: "browsingContext.contextDestroyed",
  params: BrowsingContextInfo
}
</pre>
   </dl>
    The <a data-link-type="dfn" href="#remote-end-event-trigger" id="ref-for-remote-end-event-trigger①">remote end event trigger</a> is: 
   <div class="algorithm" data-algorithm="remote end event trigger for browsingContext.contexDestroyed">
    <p>Run the following <a data-link-type="dfn" href="#browsing-context-tree-discarded" id="ref-for-browsing-context-tree-discarded">browsing context tree discarded</a> steps:</p>
    <ol>
     <li data-md>
      <p>If the <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-current-session" id="ref-for-dfn-current-session⑦">current session</a> is null, return.</p>
     <li data-md>
      <p>Let <var>context</var> be the browsing context being discarded.</p>
     <li data-md>
      <p>Let <var>params</var> be the result of <a data-link-type="dfn" href="#get-the-browsing-context-info" id="ref-for-get-the-browsing-context-info②">get the browsing context info</a>, given <var>context</var>, 0, and 0.</p>
     <li data-md>
      <p>Let <var>body</var> be a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map" id="ref-for-ordered-map④">map</a> matching the <code>BrowsingContextDestroyedEvent</code> production, with the <code>params</code> field set to <var>params</var>.</p>
     <li data-md>
      <p>Let <var>related browsing contexts</var> be a set containing the <a data-link-type="dfn">parent browsing
  context</a> of <var>context</var>, if that is not null, or an empty set otherwise.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="#emit-an-event" id="ref-for-emit-an-event①">Emit an event</a> with <var>body</var> and <var>related browsing contexts</var>.</p>
    </ol>
    <p class="issue" id="issue-7a4ace46"><a class="self-link" href="#issue-7a4ace46"></a> the way this hooks into HTML feels very fragile. See https://github.com/whatwg/html/issues/6194</p>
    <p class="issue" id="issue-4e122e13"><a class="self-link" href="#issue-4e122e13"></a> It’s unclear if we ought to only fire this event for browsing
contexts that have active documents; navigation can also cause contexts to
become inaccessible but not yet get discarded because bfcache.</p>
   </div>
   <h3 class="heading settled" data-level="6.3" id="module-script"><span class="secno">6.3. </span><span class="content">The script Module</span><a class="self-link" href="#module-script"></a></h3>
   <p>The <dfn class="dfn-paneled" data-dfn-for="modules" data-dfn-type="dfn" data-export id="modules-script">script</dfn> module contains commands and events
relating to script realms and execution.</p>
   <h4 class="heading settled" data-level="6.3.1" id="module-script-definition"><span class="secno">6.3.1. </span><span class="content">Definition</span><a class="self-link" href="#module-script-definition"></a></h4>
   <p><a data-link-type="dfn" href="#remote-end-definition" id="ref-for-remote-end-definition①⓪">Remote end definition</a></p>
<pre class="cddl remote-cddl">ScriptCommand = (ScriptGetRealmsCommand)

</pre>
   <p><a data-link-type="dfn" href="#local-end-definition" id="ref-for-local-end-definition③⑦">local end definition</a></p>
<pre class="cddl local-cddl">ScriptResult = (ScriptGetRealmsResult)

ScriptEvent = (
    ScriptRealmCreatedEvent //
    ScriptRealmDestroyedEvent
)

</pre>
   <h4 class="heading settled" data-level="6.3.2" id="module-script-types"><span class="secno">6.3.2. </span><span class="content">Types</span><a class="self-link" href="#module-script-types"></a></h4>
   <h5 class="heading settled" data-level="6.3.2.1" id="type-script-Realm"><span class="secno">6.3.2.1. </span><span class="content">The script.Realm type</span><a class="self-link" href="#type-script-Realm"></a></h5>
   <p><a data-link-type="dfn" href="#remote-end-definition" id="ref-for-remote-end-definition①①">Remote end definition</a> and <a data-link-type="dfn" href="#local-end-definition" id="ref-for-local-end-definition③⑧">local end definition</a></p>
<pre class="cddl local-cddl remote-cddl">Realm = text;
</pre>
   <p>Each <a data-link-type="dfn" href="https://tc39.es/ecma262/#sec-code-realms" id="ref-for-sec-code-realms">realm</a> has an associated <dfn class="dfn-paneled" data-dfn-type="dfn" data-export id="realm-id">realm id</dfn>, which is a string
uniquely identifying that realm. This is implicitly set when the realm is
created.</p>
   <h5 class="heading settled" data-level="6.3.2.2" id="type-script-RealmInfo"><span class="secno">6.3.2.2. </span><span class="content">The script.RealmInfo type</span><a class="self-link" href="#type-script-RealmInfo"></a></h5>
   <p><a data-link-type="dfn" href="#local-end-definition" id="ref-for-local-end-definition③⑨">Local end definition</a></p>
<pre class="cddl local-cddl">RealmInfo = {
  realm: Realm,
  type: RealmType,
  origin: text
}

RealmType = "window" / "dedicated-worker" / "shared-worker" / "service-worker" / "worker" / "paint-worklet" / "audio-worklet" / "worklet" / text
</pre>
   <p>The <code>RealmInfo</code> type represents the properties of a realm.</p>
   <div class="algorithm" data-algorithm="get the realm info">
     To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="get-the-realm-info">get the realm info</dfn> given <var>environment settings</var>: 
    <ol>
     <li data-md>
      <p>Let <var>realm</var> be <var>environment settings</var>’ <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#realm-execution-context" id="ref-for-realm-execution-context">realm execution context</a>'s Realm component.</p>
     <li data-md>
      <p>Let <var>realm id</var> be the <a data-link-type="dfn" href="#realm-id" id="ref-for-realm-id">realm id</a> for <var>realm</var>.</p>
     <li data-md>
      <p>Run the steps under the first matching condition:</p>
      <dl>
       <dt>The <a data-link-type="dfn">global object</a> specified by <var>environment settings</var> is a <a data-link-type="dfn" href="https://drafts.csswg.org/css-color-3/#window" id="ref-for-window">Window</a> object 
       <dd>
        <ol>
         <li data-md>
          <p>Let <var>type</var> be "<code>window</code>".</p>
        </ol>
       <dt>The <a data-link-type="dfn">global object</a> specified by <var>environment settings</var> is a <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/workers.html#dedicatedworkerglobalscope" id="ref-for-dedicatedworkerglobalscope">DedicatedWorkerGlobalScope</a></code> object 
       <dd>
        <ol>
         <li data-md>
          <p>Let <var>type</var> be "<code>dedicated-worker</code>".</p>
        </ol>
       <dt>The <a data-link-type="dfn">global object</a> specified by <var>environment settings</var> is a <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/workers.html#sharedworkerglobalscope" id="ref-for-sharedworkerglobalscope">SharedWorkerGlobalScope</a></code> object 
       <dd>
        <ol>
         <li data-md>
          <p>Let <var>type</var> be "<code>shared-worker</code>".</p>
        </ol>
       <dt>The <a data-link-type="dfn">global object</a> specified by <var>environment settings</var> is a <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/ServiceWorker/#serviceworkerglobalscope" id="ref-for-serviceworkerglobalscope">ServiceWorkerGlobalScope</a></code> object 
       <dd>
        <ol>
         <li data-md>
          <p>Let <var>type</var> be "<code>service-worker</code>".</p>
        </ol>
       <dt>The <a data-link-type="dfn">global object</a> specified by <var>environment settings</var> is a <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/workers.html#workerglobalscope" id="ref-for-workerglobalscope①">WorkerGlobalScope</a></code> object 
       <dd>
        <ol>
         <li data-md>
          <p>Let <var>type</var> be "<code>worker</code>".</p>
        </ol>
       <dt>The <a data-link-type="dfn">global object</a> specified by <var>environment settings</var> is a <code class="idl"><a data-link-type="idl" href="https://drafts.css-houdini.org/css-paint-api-1/#paintworkletglobalscope" id="ref-for-paintworkletglobalscope">PaintWorkletGlobalScope</a></code> object 
       <dd>
        <ol>
         <li data-md>
          <p>Let <var>type</var> be "<code>paint-worklet</code>".</p>
        </ol>
       <dt>The <a data-link-type="dfn">global object</a> specified by <var>environment settings</var> is a <code class="idl"><a data-link-type="idl" href="https://webaudio.github.io/web-audio-api/#AudioWorkletGlobalScope" id="ref-for-AudioWorkletGlobalScope">AudioWorkletGlobalScope</a></code> object 
       <dd>
        <ol>
         <li data-md>
          <p>Let <var>type</var> be "<code>audio-worklet</code>".</p>
        </ol>
       <dt>The <a data-link-type="dfn">global object</a> specified by <var>environment settings</var> is a <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/worklets.html#workletglobalscope" id="ref-for-workletglobalscope">WorkletGlobalScope</a></code> object 
       <dd>
        <ol>
         <li data-md>
          <p>Let <var>type</var> be "<code>worklet</code>".</p>
        </ol>
       <dt>Otherwise: 
       <dd>
        <ol>
         <li data-md>
          <p>Return null.</p>
        </ol>
      </dl>
     <li data-md>
      <p>Let <var>origin</var> be the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#ascii-serialisation-of-an-origin" id="ref-for-ascii-serialisation-of-an-origin">serialization of an origin</a> given <var>environment settings</var>’s <var>origin</var>.</p>
     <li data-md>
      <p>Let <var>realm info</var> be a map matching the <code>RealmInfo</code> production,
  with the <code>realm</code> field set to <var>realm id</var>, the <code>type</code> field set to <var>type</var> and the <code>origin</code> field set to <var>origin</var>.</p>
     <li data-md>
      <p>Return <var>realm info</var></p>
    </ol>
    <p class="issue" id="issue-56892cd2"><a class="self-link" href="#issue-56892cd2"></a> We currently don’t provide information about realms of unknown
       types. That might be a problem for e.g. extension-related realms.</p>
    <p class="note" role="note"><span class="marker">Note:</span> Future variations of this specification will retain the invariant that
         the last component of the type name after splitting on "<code>-</code>"
         will always be "<code>worker</code>" for globals implementing <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/workers.html#workerglobalscope" id="ref-for-workerglobalscope②">WorkerGlobalScope</a></code>, and "<code>worklet</code>" for globals
         implementing <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/worklets.html#workletglobalscope" id="ref-for-workletglobalscope①">WorkletGlobalScope</a></code>.</p>
   </div>
   <h4 class="heading settled" data-level="6.3.3" id="module-script-commands"><span class="secno">6.3.3. </span><span class="content">Commands</span><a class="self-link" href="#module-script-commands"></a></h4>
   <h5 class="heading settled" data-level="6.3.3.1" id="command-script-getRealms"><span class="secno">6.3.3.1. </span><span class="content">The script.getRealms Command</span><a class="self-link" href="#command-script-getRealms"></a></h5>
   <p>The <dfn class="dfn-paneled" data-dfn-for="commands" data-dfn-type="dfn" data-export id="commands-scriptgetrealms">script.getRealms</dfn> command returns a list of
all realms, optionally filtered to <a data-link-type="dfn" href="https://tc39.es/ecma262/#sec-code-realms" id="ref-for-sec-code-realms①">realms</a> of a specific type, or to the
realm associated with the <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-document" id="ref-for-concept-document②">document</a> currently loaded in a specified <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#browsing-context" id="ref-for-browsing-context②">browsing context</a>.</p>
   <dl>
    <dt>Command Type
    <dd>
<pre class="cddl remote-cddl">ScriptGetRealmsCommand = {
  method: "script.getRealms",
  params: GetRealmsParameters
}

GetRealmsParameters = {
  ?context: BrowsingContext,
  ?type: RealmType,
}
</pre>
    <dt>Return Type
    <dd>
<pre class="cddl local-cddl">RealmInfoList = [* RealmInfo]

ScriptGetRealmsResult = {
  realms: RealmInfoList
}
</pre>
   </dl>
   <div class="algorithm" data-algorithm="remote end steps for script.getRealms">
     The <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-remote-end-steps" id="ref-for-dfn-remote-end-steps⑥">remote end steps</a> with <var>command parameters</var> are: 
    <ol>
     <li data-md>
      <p>Let <var>environment settings</var> be a list of all the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object" id="ref-for-environment-settings-object">environment settings objects</a> that have their <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-execution-ready-flag" id="ref-for-concept-environment-execution-ready-flag">execution ready flag</a> set.</p>
     <li data-md>
      <p>If <var>command parameters</var> contains <code>context</code>:</p>
      <ol>
       <li data-md>
        <p>Let <var>context</var> be the result of <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-try" id="ref-for-dfn-try⑤">trying</a> to <a data-link-type="dfn" href="#get-a-browsing-context" id="ref-for-get-a-browsing-context②">get a browsing context</a> with <var>command parameters</var>["<code>context</code>"].</p>
       <li data-md>
        <p>Let <var>document</var> be <var>context</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#nav-document" id="ref-for-nav-document②">active document</a>.</p>
       <li data-md>
        <p>Let <var>context environment settings</var> be a list.</p>
       <li data-md>
        <p>For each <var>settings</var> of <var>environment settings</var>:</p>
        <ol>
         <li data-md>
          <p>If any of the following conditions hold:</p>
          <ul>
           <li data-md>
            <p>The <a data-link-type="dfn">responsible document</a> of <var>settings</var> is <var>document</var></p>
           <li data-md>
            <p>The <a data-link-type="dfn">global object</a> specified by <var>settings</var> is a <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/workers.html#workerglobalscope" id="ref-for-workerglobalscope③">WorkerGlobalScope</a></code> with <var>document</var> in its <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/workers.html#concept-WorkerGlobalScope-owner-set" id="ref-for-concept-WorkerGlobalScope-owner-set①">owner set</a></p>
          </ul>
          <p>Append <var>settings</var> to <var>context environment settings</var>.</p>
        </ol>
       <li data-md>
        <p>Set <var>environment settings</var> to <var>context environment settings</var>.</p>
      </ol>
     <li data-md>
      <p>Let <var>realms</var> be a list.</p>
     <li data-md>
      <p>For each <var>settings</var> of <var>environment settings</var>:</p>
      <ol>
       <li data-md>
        <p>Let <var>realm info</var> be the result of <a data-link-type="dfn" href="#get-the-realm-info" id="ref-for-get-the-realm-info">get the realm info</a> given <var>settings</var></p>
       <li data-md>
        <p>If <var>command parameters</var> contains <code>type</code> and <var>realm
 info</var>["<code>type</code>"] is not equal to <var>command
 parameters</var>["<code>type</code>"] then <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue" id="ref-for-iteration-continue">continue</a>.</p>
       <li data-md>
        <p>If <var>realm info</var> is not null, append <var>realm info</var> to <var>realms</var>.</p>
      </ol>
     <li data-md>
      <p>Let <var>body</var> be a map matching the <code>GetRealmsResult</code> production,
 with the <code>realms</code> field set to <var>realms</var>.</p>
     <li data-md>
      <p>Return <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-success" id="ref-for-dfn-success①②">success</a> with data <var>body</var>.</p>
    </ol>
    <p class="issue" id="issue-ac9113ee"><a class="self-link" href="#issue-ac9113ee"></a> Extend this to also allow realm parents e.g. for nested workers? Or get all ancestor workers.</p>
    <p class="issue" id="issue-b6525c5d"><a class="self-link" href="#issue-b6525c5d"></a> We might want to have a more sophisticated filter system than just a
       literal match.</p>
   </div>
   <h4 class="heading settled" data-level="6.3.4" id="module-script-events"><span class="secno">6.3.4. </span><span class="content">Events</span><a class="self-link" href="#module-script-events"></a></h4>
   <h5 class="heading settled" data-level="6.3.4.1" id="event-script-realmCreated"><span class="secno">6.3.4.1. </span><span class="content">The script.realmCreated Event</span><a class="self-link" href="#event-script-realmCreated"></a></h5>
   <dl>
    <dt>Event Type
    <dd>
<pre class="cddl local-cddl"> ScriptRealmCreatedEvent = {
  method: "script.realmCreated",
  params: RealmInfo
}
</pre>
   </dl>
    The <a data-link-type="dfn" href="#remote-end-event-trigger" id="ref-for-remote-end-event-trigger②">remote end event trigger</a> is: 
   <div class="algorithm" data-algorithm="remote end event trigger for script.realmCreated">
    <p>When any of the <a data-link-type="dfn" href="https://html.spec.whatwg.org/#set-up-a-window-environment-settings-object" id="ref-for-set-up-a-window-environment-settings-object">set up a window environment settings object</a>, <a data-link-type="dfn" href="https://html.spec.whatwg.org/#set-up-a-worker-environment-settings-object" id="ref-for-set-up-a-worker-environment-settings-object">set up a
worker environment settings object</a> or <a data-link-type="dfn">set up a worklet environment settings
object</a> algorithms are invoked, immediately prior to returning the settings
object:</p>
    <ol>
     <li data-md>
      <p>Let <var>environment settings</var> be the newly created <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object" id="ref-for-environment-settings-object①">environment settings
  object</a>.</p>
     <li data-md>
      <p>Let <var>realm info</var> be be the result of <a data-link-type="dfn" href="#get-the-realm-info" id="ref-for-get-the-realm-info①">get the realm info</a> given <var>environment settings</var>.</p>
     <li data-md>
      <p>If <var>realm info</var> is null, return.</p>
     <li data-md>
      <p>Let <var>related browsing contexts</var> be the result of <a data-link-type="dfn" href="#get-related-browsing-contexts" id="ref-for-get-related-browsing-contexts">get related browsing
  contexts</a> given <var>environment settings</var>.</p>
     <li data-md>
      <p>Let <var>body</var> be a map matching the <code>RealmCreatedEvent</code> production, with the <code>params</code> field set to <var>realm info</var>.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="#emit-an-event" id="ref-for-emit-an-event②">Emit an event</a> with <var>body</var> and <var>related browsing contexts</var>.</p>
    </ol>
   </div>
   <div class="algorithm" data-algorithm="remote end subscribe steps for script.realmCreated">
    <p>The <a data-link-type="dfn" href="#remote-end-subscribe-steps" id="ref-for-remote-end-subscribe-steps③">remote end subscribe steps</a> with <a data-link-type="dfn" href="#subscribe-priority" id="ref-for-subscribe-priority②">subscribe priority</a> 2, given <var>contexts</var> and <var>include global</var> are:</p>
    <ol>
     <li data-md>
      <p>Let <var>environment settings</var> be a list of all the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object" id="ref-for-environment-settings-object②">environment settings objects</a> that have their <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-execution-ready-flag" id="ref-for-concept-environment-execution-ready-flag①">execution ready flag</a> set.</p>
     <li data-md>
      <p>For each <var>settings</var> of <var>environment settings</var>:</p>
      <ol>
       <li data-md>
        <p>If the <a data-link-type="dfn">responsible document</a> of <var>settings</var> is a <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-document" id="ref-for-concept-document③">Document</a>:</p>
        <ol>
         <li data-md>
          <p>Let <var>context</var> be <var>settings</var>’s <a data-link-type="dfn">responsible document</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#concept-document-bc" id="ref-for-concept-document-bc②">browsing context</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#top-level-browsing-context" id="ref-for-top-level-browsing-context⑤">top-level browsing context</a>.</p>
         <li data-md>
          <p>If <var>context</var> is not in <var>contexts</var>, continue.</p>
         <li data-md>
          <p>Append <var>context</var> to <var>related contexts</var>.</p>
        </ol>
        <p>Otherwise, if <var>include global</var> is false, continue.</p>
       <li data-md>
        <p>Let <var>realm info</var> be the result of <a data-link-type="dfn" href="#get-the-realm-info" id="ref-for-get-the-realm-info②">get the realm info</a> given <var>settings</var></p>
       <li data-md>
        <p>Let <var>body</var> be a map matching the <code>RealmCreatedEvent</code> production, with the <code>params</code> field set to <var>realm info</var>.</p>
       <li data-md>
        <p><a data-link-type="dfn" href="#emit-an-event" id="ref-for-emit-an-event③">Emit an event</a> with <var>body</var> and <var>related contexts</var>.</p>
      </ol>
    </ol>
    <p class="issue" id="issue-74a40be3"><a class="self-link" href="#issue-74a40be3"></a> Should the order here be better defined?</p>
   </div>
   <h5 class="heading settled" data-level="6.3.4.2" id="event-script-realmDestroyed"><span class="secno">6.3.4.2. </span><span class="content">The script.realmDestroyed Event</span><a class="self-link" href="#event-script-realmDestroyed"></a></h5>
   <dl>
    <dt>Event Type
    <dd>
<pre class="cddl local-cddl">RealmDestroyedParameters = {
  realm: Realm
}

ScriptRealmDestroyedEvent = {
  method: "script.realmDestoyed",
  params: RealmDestroyedParameters
}
</pre>
   </dl>
    The <a data-link-type="dfn" href="#remote-end-event-trigger" id="ref-for-remote-end-event-trigger③">remote end event trigger</a> is: 
   <div class="algorithm" data-algorithm="remote end event trigger for script.realmDestroyed">
     Define the following <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-lifecycle.html#unloading-document-cleanup-steps" id="ref-for-unloading-document-cleanup-steps">unloading document cleanup steps</a> with <var>document</var>: 
    <ol>
     <li data-md>
      <p>Let <var>related browsing contexts</var> be an empty set.</p>
     <li data-md>
      <p>Append <var>document</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#concept-document-bc" id="ref-for-concept-document-bc③">browsing context</a> to <var>related browsing
  contexts</var>.</p>
     <li data-md>
      <p>For each <var>worklet global scope</var> in <var>document</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/#concept-document-worklet-global-scopes" id="ref-for-concept-document-worklet-global-scopes">worklet global scopes</a>:</p>
      <ol>
       <li data-md>
        <p>Let <var>realm</var> be <var>worklet global scope</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm" id="ref-for-concept-relevant-realm">relevant Realm</a>.</p>
       <li data-md>
        <p>Let <var>realm id</var> be the <a data-link-type="dfn" href="#realm-id" id="ref-for-realm-id①">realm id</a> for <var>realm</var>.</p>
       <li data-md>
        <p>Let <var>params</var> be a map mathcing the <code>RealmDestroyedParameters</code> production, with the <code>realm</code> field set of <var>realm id</var>.</p>
       <li data-md>
        <p>Let <var>body</var> be a map matching the <code>RealmDestroyedEvent</code> production, with the <code>params</code> field set to <var>params</var>.</p>
       <li data-md>
        <p><a data-link-type="dfn" href="#emit-an-event" id="ref-for-emit-an-event④">Emit an event</a> with <var>body</var> and <var>related browsing contexts</var>.</p>
      </ol>
     <li data-md>
      <p>Let <var>environment settings</var> be the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object" id="ref-for-environment-settings-object③">environment settings object</a> whose <a data-link-type="dfn">responsible document</a> is <var>document</var>.</p>
     <li data-md>
      <p>Let <var>realm</var> be <var>environment settings</var>’ <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#realm-execution-context" id="ref-for-realm-execution-context①">realm execution context</a>'s Realm component.</p>
     <li data-md>
      <p>Let <var>realm id</var> be the <a data-link-type="dfn" href="#realm-id" id="ref-for-realm-id②">realm id</a> for <var>realm</var>.</p>
     <li data-md>
      <p>Let <var>params</var> be a map mathcing the <code>RealmDestroyedParameters</code> production, with the <code>realm</code> field set to <var>realm id</var>.</p>
     <li data-md>
      <p>Let <var>body</var> be a map matching the <code>RealmDestroyedEvent</code> production, with the <code>params</code> field set to <var>params</var>.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="#emit-an-event" id="ref-for-emit-an-event⑤">Emit an event</a> with <var>body</var> and <var>related browsing contexts</var>.</p>
    </ol>
    <p>Whenever a <a data-link-type="dfn" href="https://html.spec.whatwg.org/#worker-event-loop-2" id="ref-for-worker-event-loop-2">worker event loop</a> <var>event loop</var> is destroyed, either because the
worker comes to the end of its lifecycle, or prematurely via the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/workers.html#terminate-a-worker" id="ref-for-terminate-a-worker">terminate a
worker</a> algorithm:</p>
    <ol>
     <li data-md>
      <p>Let <var>environment settings</var> be the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object" id="ref-for-environment-settings-object④">environment settings object</a> for which <var>event loop</var> is the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#responsible-event-loop" id="ref-for-responsible-event-loop">responsible event loop</a>.</p>
     <li data-md>
      <p>Let <var>related browsing contexts</var> be the result of <a data-link-type="dfn" href="#get-related-browsing-contexts" id="ref-for-get-related-browsing-contexts①">get related browsing
  contexts</a> given <var>environment settings</var>.</p>
     <li data-md>
      <p>Let <var>realm</var> be <var>environment settings</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/#environment-settings-object&apos;s-realm" id="ref-for-environment-settings-object&apos;s-realm">environment settings object’s Realm</a>.</p>
     <li data-md>
      <p>Let <var>realm id</var> be the <a data-link-type="dfn" href="#realm-id" id="ref-for-realm-id③">realm id</a> for <var>realm</var>.</p>
     <li data-md>
      <p>Let <var>params</var> be a map mathcing the <code>RealmDestroyedParameters</code> production, with the <code>realm</code> field set of <var>realm id</var>.</p>
     <li data-md>
      <p>Let <var>body</var> be a map matching the <code>RealmDestroyedEvent</code> production, with the <code>params</code> field set to <var>params</var>.</p>
    </ol>
   </div>
   <h3 class="heading settled" data-level="6.4" id="module-log"><span class="secno">6.4. </span><span class="content">Log</span><a class="self-link" href="#module-log"></a></h3>
   <p>The <dfn class="dfn-paneled" data-dfn-for="modules" data-dfn-type="dfn" data-export id="modules-log">log</dfn> module contains functionality and events
related to logging.</p>
   <p>A <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-sessions" id="ref-for-dfn-sessions①②">session</a> has a <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="log-event-buffer">log event buffer</dfn> which is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map" id="ref-for-ordered-map⑤">map</a> from <a data-link-type="dfn" href="#browsing-context-id" id="ref-for-browsing-context-id④">browsing context id</a> to a list of log events for that context that have not
been emitted. User agents may impose a maximum size on this buffer, subject to
the condition that if events A and B happen in the same context with A occuring
before B, and both are added to the buffer, the entry for B must not be removed
before the entry for A.</p>
   <div class="algorithm" data-algorithm="buffer a log event">
    <p>To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="buffer-a-log-event">buffer a log event</dfn> given <var>contexts</var> and <var>event</var>:</p>
    <ol>
     <li data-md>
      <p>Let <var>buffer</var> be the <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-current-session" id="ref-for-dfn-current-session⑧">current session</a>'s <a data-link-type="dfn" href="#log-event-buffer" id="ref-for-log-event-buffer">log event buffer</a>.</p>
     <li data-md>
      <p>Let <var>context ids</var> be a new list.</p>
     <li data-md>
      <p>For each <var>context</var> of <var>contexts</var>:</p>
      <ol>
       <li data-md>
        <p>Append the <a data-link-type="dfn" href="#browsing-context-id" id="ref-for-browsing-context-id⑤">browsing context id</a> for <var>context</var> to <var>context ids</var>.</p>
      </ol>
     <li data-md>
      <p>For each <var>context id</var> in <var>context ids</var>:</p>
      <ol>
       <li data-md>
        <p>Let <var>other contexts</var> be an empty list</p>
       <li data-md>
        <p>For each <var>other id</var> in <var>context ids</var>:</p>
       <li data-md>
        <p>If <var>other id</var> is not equal to <var>context id</var>, append <var>other id</var> to <var>other
  contexts</var>.</p>
       <li data-md>
        <p>If <var>buffer</var> does not contain <var>context id</var>, let <var>buffer</var>[<var>context id</var>] be a
 new list.</p>
       <li data-md>
        <p>Append (<var>event</var>, <var>other contexts</var>) to <var>buffer</var>[<var>context id</var>].</p>
      </ol>
    </ol>
    <p class="note" role="note"><span class="marker">Note:</span> we store the other contexts here so that each event is only emitted
once. In practice this is only relevant for workers that can be associated with
multiple browsing contexts.</p>
    <p class="issue" id="issue-d20b5797"><a class="self-link" href="#issue-d20b5797"></a> Do we want to key this on browsing context or top-level browsing context?
The difference is in what happens if an event occurs in a frame and that frame
is then navigated before the local end subscribes to log events for the top
level context.</p>
   </div>
   <h4 class="heading settled" data-level="6.4.1" id="module-log-definition"><span class="secno">6.4.1. </span><span class="content">Definition</span><a class="self-link" href="#module-log-definition"></a></h4>
   <p><a data-link-type="dfn" href="#remote-end-definition" id="ref-for-remote-end-definition①②">remote end definition</a></p>
<pre class="cddl remote-cddl">LogEvent = (
  LogEntryAddedEvent
)
</pre>
   <h4 class="heading settled" data-level="6.4.2" id="module-log-types"><span class="secno">6.4.2. </span><span class="content">Types</span><a class="self-link" href="#module-log-types"></a></h4>
   <h5 class="heading settled" data-level="6.4.2.1" id="types-log-logentry"><span class="secno">6.4.2.1. </span><span class="content">log.LogEntry</span><a class="self-link" href="#types-log-logentry"></a></h5>
<pre class="cddl local-cddl">LogLevel = "debug" / "info" / "warning" / "error"

LogEntry = (
  GenericLogEntry //
  ConsoleLogEntry //
  JavascriptLogEntry
)

BaseLogEntry = {
  level: LogLevel,
  text: text / null,
  timestamp: int,
  ?stackTrace: [*StackFrame],
}

GenericLogEntry = {
  BaseLogEntry,
  type: text,
}

ConsoleLogEntry = {
  BaseLogEntry,
  type: "console",
  method: text,
  realm: Realm,
  args: [*RemoteValue],
}

JavascriptLogEntry = {
  BaseLogEntry,
  type: "javascript",
}

</pre>
   <p>Each log event is represented by a <code>LogEntry</code> object. This has a <code>type</code> property which represents the type of log entry added, a <code>level</code> property representing severity, a <code>text</code> property
with the log message string itself, and a <code>timestamp</code> property
corresponding to the time the log entry was generated. Specific variants of the <code>LogEntry</code> are used to represent logs from different sources, and
provide additional fields specific to the entry type.</p>
   <h5 class="heading settled" data-level="6.4.2.2" id="types-log-stackframe"><span class="secno">6.4.2.2. </span><span class="content">log.StackFrame</span><a class="self-link" href="#types-log-stackframe"></a></h5>
<pre class="cddl local-cddl">StackFrame = {
  url: text,
  functionName: text,
  lineNumber: int,
  columnNumber: int,
}

</pre>
   <p>A frame in a stacktrace is represented by a <code>StackFrame</code> object. This
has a <code>url</code> property, which represents the URL of the script, a <code>functionName</code> property which represents the name of the executing
function, and <code>lineNumber</code> and <code>columnNumber</code> properties,
which represent the line and column number of the executed code.</p>
   <p>The <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="current-stack-trace">current stack trace</dfn> is a representation of the stack of the <a data-link-type="dfn" href="https://tc39.es/ecma262/#running-execution-context" id="ref-for-running-execution-context">running execution context</a>. The details of this are unspecified, and so the
behaviour here is implementation defined, but the general process is as follows:</p>
   <ol>
    <li data-md>
     <p>Let <var>stack trace</var> be a new list.</p>
    <li data-md>
     <p>For each stack frame <var>frame</var> in the stack of the running execution context,
  starting from the most recently executed frame, run the following steps:</p>
     <ol>
      <li data-md>
       <p>Let <var>url</var> be the result of running the <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-serializer" id="ref-for-concept-url-serializer①">URL serializer</a>, given
 the <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url" id="ref-for-concept-url">URL</a> of <var>frame</var>’s associated script resource.</p>
      <li data-md>
       <p>Let <var>functionName</var> be the name of <var>frame</var>’s associated function.</p>
      <li data-md>
       <p>Let <var>lineNumber</var> and <var>columnNumber</var> be the one-based line and zero-based
 column numbers, respectively, of the location in <var>frame</var>’s associated
 script resource corresponding to <var>frame</var>.</p>
      <li data-md>
       <p>Let <var>frame info</var> be a new map matching the <code>StackFrame</code> production, with the <code>url</code> field set to <var>url</var>, the <code>functionName</code> field set to <var>functionName</var>, the <code>lineNumber</code> field set to <var>lineNumber</var> and the <code>columnNumber</code> field set to <var>columnNumber</var>.</p>
     </ol>
    <li data-md>
     <p>Append <var>frame info</var> to <var>stack trace</var>.</p>
    <li data-md>
     <p>Return <var>stack trace</var></p>
   </ol>
   <h4 class="heading settled" data-level="6.4.3" id="module-log-events"><span class="secno">6.4.3. </span><span class="content">Events</span><a class="self-link" href="#module-log-events"></a></h4>
   <h5 class="heading settled" data-level="6.4.3.1" id="event-log-entryAdded"><span class="secno">6.4.3.1. </span><span class="content">entryAdded</span><a class="self-link" href="#event-log-entryAdded"></a></h5>
   <dl>
    <dt>Event Type
    <dd>
<pre class="cddl local-cddl"> LogEntryAddedEvent = {
  method: "log.entryAdded",
  params: LogEntry,
}
</pre>
   </dl>
   <p>The <a data-link-type="dfn" href="#remote-end-event-trigger" id="ref-for-remote-end-event-trigger④">remote end event trigger</a> is:</p>
   <div class="algorithm" data-algorithm="remote end event trigger for log.entryAdded">
    <p>Define the following <a data-link-type="dfn" href="#console-steps" id="ref-for-console-steps">console steps</a> with <var>method</var>, <var>args</var>, and <var>options</var>:</p>
    <ol>
     <li data-md>
      <p>If <var>method</var> is "<code>error</code>" or "<code>assert</code>", let <var>level</var> be
 "<code>error</code>". If <var>method</var> is "<code>debug</code>" or
 "<code>trace</code>" let <var>level</var> be "<code>debug</code>". If <var>method</var> is
 "<code>warn</code>" or <code>warning</code>, let <var>level</var> be
 "<code>warning</code>". Otherwise let <var>level</var> be "<code>info</code>".</p>
     <li data-md>
      <p>Let <var>timestamp</var> be a <a data-link-type="dfn" href="https://tc39.es/ecma262/#sec-time-values-and-time-range" id="ref-for-sec-time-values-and-time-range">time value</a> representing the current date and time in UTC.</p>
     <li data-md>
      <p>Let <var>text</var> be an empty string.</p>
     <li data-md>
      <p>If <a data-link-type="dfn" href="https://tc39.es/ecma262/#sec-ecmascript-data-types-and-values" id="ref-for-sec-ecmascript-data-types-and-values⑨">Type</a>(|<var>args</var>[0]) is String, and <var>args</var>[0] contains a <a data-link-type="dfn" href="https://console.spec.whatwg.org#formatting-specifiers" id="ref-for-formatting-specifiers">formatting
 specifier</a>, let <var>formatted args</var> be <a data-link-type="dfn" href="https://console.spec.whatwg.org#formatter" id="ref-for-formatter">Formatter</a>(<var>args</var>). Otherwise let <var>formatted args</var> be <var>args</var>.</p>
      <p class="issue" id="issue-b611588d"><a class="self-link" href="#issue-b611588d"></a> This is underdefined in the console spec, so it’s unclar if we can get
 interoperable behaviour here.</p>
     <li data-md>
      <p>For each <var>arg</var> in <var>formatted args</var>:</p>
      <ol>
       <li data-md>
        <p>If <var>arg</var> is not the first entry in <var>args</var>, append a U+0020 SPACE to <var>text</var>.</p>
       <li data-md>
        <p>If <var>arg</var> is a <a data-link-type="dfn" href="https://tc39.es/ecma262/#sec-primitive-value" id="ref-for-sec-primitive-value">primitive value</a>, append <a data-link-type="dfn" href="https://tc39.es/ecma262/#sec-tostring" id="ref-for-sec-tostring③">ToString</a>(<var>arg</var>) to <var>text</var>. Otherwise append an implementation-defined string to <var>text</var>.</p>
      </ol>
     <li data-md>
      <p>Let <var>serialized args</var> be a new list.</p>
     <li data-md>
      <p>For each <var>arg</var> of <var>args</var>, append the result of <a data-link-type="dfn" href="#serialize-as-a-remote-value" id="ref-for-serialize-as-a-remote-value⑤">serialize as a remote
 value</a> given <var>arg</var>, null, true, and an empty <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-set" id="ref-for-ordered-set①">set</a> to <var>serialized args</var>.</p>
     <li data-md>
      <p>Let <var>realm</var> be the <a data-link-type="dfn" href="#realm-id" id="ref-for-realm-id④">realm id</a> of the <a data-link-type="dfn" href="https://tc39.es/ecma262/#current-realm" id="ref-for-current-realm">current Realm Record</a>.</p>
     <li data-md>
      <p>Let <var>stack</var> be the <a data-link-type="dfn" href="#current-stack-trace" id="ref-for-current-stack-trace">current stack trace</a>.</p>
     <li data-md>
      <p>Let <var>entry</var> be a map matching the <code>ConsoleLogEntry</code> production,
 with the the <code>level</code> field set to <var>level</var>, the <code>text</code> field set to <var>text</var>, the <code>timestamp</code> field set to <var>timestamp</var>, the <code>stackTrace</code> field set to <var>stack</var> if <var>stack</var> is not null, or
 omitted otherwise, the <var>method</var> field set to <var>method</var>, the <code>realm</code> field set to <var>realm</var> and the <code>args</code> field set to <var>serialized
 args</var>.</p>
     <li data-md>
      <p>Let <var>body</var> be a map matching the <code>LogEntryAddedEvent</code> production, with
 the <code>params</code> field set to <var>entry</var>.</p>
     <li data-md>
      <p>Let <var>settings</var> be the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#current-settings-object" id="ref-for-current-settings-object">current settings object</a></p>
     <li data-md>
      <p>Let <var>related browsing contexts</var> be the result of <a data-link-type="dfn" href="#get-related-browsing-contexts" id="ref-for-get-related-browsing-contexts②">get related browsing
 contexts</a> given <var>settings</var>.</p>
     <li data-md>
      <p>Let <var>emitted</var> be the result of <a data-link-type="dfn" href="#emit-an-event" id="ref-for-emit-an-event⑥">emit an event</a> with <var>body</var> and <var>related
 browsing contexts</var>.</p>
     <li data-md>
      <p>If <var>emitted</var> is false, append (<var>related browsing contexts</var>, <var>body</var>) to the <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-current-session" id="ref-for-dfn-current-session⑨">current session</a>'s <a data-link-type="dfn" href="#log-event-buffer" id="ref-for-log-event-buffer①">log event buffer</a>.</p>
    </ol>
    <p>Define the following <a data-link-type="dfn" href="#error-reporting-steps" id="ref-for-error-reporting-steps">error reporting steps</a> with arguments <var>script</var>, <var>line number</var>, <var>column number</var>, <var>message</var> and <var>handled</var>:</p>
    <ol>
     <li data-md>
      <p>If <var>handled</var> is true return.</p>
     <li data-md>
      <p>Let <var>settings</var> be <var>script</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#settings-object" id="ref-for-settings-object①">settings object</a>.</p>
     <li data-md>
      <p>Let <var>stack</var> be the <a data-link-type="dfn" href="#current-stack-trace" id="ref-for-current-stack-trace①">current stack trace</a> for the exception.</p>
     <li data-md>
      <p>Let <var>entry</var> be a map matching the <code>JavascriptLogEntry</code> production,
 with <code>level</code> set to "<code>error</code>", <code>text</code> set to <var>message</var>, and the <code>timestamp</code> field set to <var>timestamp</var>.</p>
     <li data-md>
      <p>Let <var>related browsing contexts</var> be the result of <a data-link-type="dfn" href="#get-related-browsing-contexts" id="ref-for-get-related-browsing-contexts③">get related browsing
 contexts</a> given <var>settings</var>.</p>
     <li data-md>
      <p>Let <var>emitted</var> be the result of <a data-link-type="dfn" href="#emit-an-event" id="ref-for-emit-an-event⑦">emit an event</a> with <var>body</var> and <var>related
 browsing contexts</var>.</p>
     <li data-md>
      <p>If <var>emitted</var> is false, <a data-link-type="dfn" href="#buffer-a-log-event" id="ref-for-buffer-a-log-event">buffer a log event</a> given <var>related browsing contexts</var> and <var>body</var>.</p>
    </ol>
    <p class="issue" id="issue-d863e230"><a class="self-link" href="#issue-d863e230"></a> Lots more things require logging. CDP has LogEntryAdded types xml,
javascript, network, storage, appcache, rendering, security, deprecation,
worker, violation, intervention, recommendation, other. These are in addition to
the js exception and console API types that are represented by different methods.</p>
    <p class="issue" id="issue-365f0ed7"><a class="self-link" href="#issue-365f0ed7"></a> Allow implementation-defined log types</p>
   </div>
   <div class="algorithm" data-algorithm="remote end subscribe steps for log.entryAdded">
    <p>The <a data-link-type="dfn" href="#remote-end-subscribe-steps" id="ref-for-remote-end-subscribe-steps④">remote end subscribe steps</a>, with <a data-link-type="dfn" href="#subscribe-priority" id="ref-for-subscribe-priority③">subscribe priority</a> 10, given <var>contexts</var> and <var>include global</var> are:</p>
    <ol>
     <li data-md>
      <p>For each <var>context id</var> → <var>events</var> in <a data-link-type="dfn" href="#log-event-buffer" id="ref-for-log-event-buffer②">log event buffer</a>:</p>
      <ol>
       <li data-md>
        <p>Let <var>maybe context</var> be the result of <a data-link-type="dfn" href="#get-a-browsing-context" id="ref-for-get-a-browsing-context③">getting a browsing context</a> given <var>context id</var>.</p>
       <li data-md>
        <p>If <var>maybe context</var> is an <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-errors" id="ref-for-dfn-errors⑦">error</a>, remove <var>context id</var> from <a data-link-type="dfn" href="#log-event-buffer" id="ref-for-log-event-buffer③">log event
 buffer</a> and continue.</p>
       <li data-md>
        <p>Let <var>context</var> be <var>maybe context</var>’s data</p>
       <li data-md>
        <p>Let <var>top level context</var> be <var>context</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#top-level-browsing-context" id="ref-for-top-level-browsing-context⑥">top-level browsing context</a>.</p>
       <li data-md>
        <p>Let <var>related contexts</var> be a new set containing <var>context</var>.</p>
       <li data-md>
        <p>If <var>include global</var> is true and <var>top level context</var> is not in <var>contexts</var>,
 or if <var>include global</var> is false and <var>top level context</var> is in <var>contexts</var>:</p>
        <ol>
         <li data-md>
          <p>For each (<var>event</var>, <var>other contexts</var>) in <var>events</var>:</p>
          <ol>
           <li data-md>
            <p><a data-link-type="dfn" href="#emit-an-event" id="ref-for-emit-an-event⑧">Emit an event</a> with <var>event</var> and <var>related contexts</var>.</p>
           <li data-md>
            <p>For each <var>other context id</var> in <var>other contexts</var>:</p>
            <ol>
             <li data-md>
              <p>If <a data-link-type="dfn" href="#log-event-buffer" id="ref-for-log-event-buffer④">log event buffer</a> contains <var>other context id</var>, remove <var>event</var> from <a data-link-type="dfn" href="#log-event-buffer" id="ref-for-log-event-buffer⑤">log event buffer</a>[<var>other context id</var>].</p>
            </ol>
          </ol>
        </ol>
      </ol>
    </ol>
   </div>
   <h2 class="heading settled" data-level="7" id="patches"><span class="secno">7. </span><span class="content">Patches to Other Specifications</span><a class="self-link" href="#patches"></a></h2>
   <p>This specification requires some changes to external specifications to provide the necessary
integration points. It is assumed that these patches will be committed to the other specifications
as part of the standards process.</p>
   <h3 class="heading settled" data-level="7.1" id="patches-html"><span class="secno">7.1. </span><span class="content">HTML</span><a class="self-link" href="#patches-html"></a></h3>
   <p>The <a data-link-type="dfn" href="https://html.spec.whatwg.org/#a-browsing-context-is-discarded" id="ref-for-a-browsing-context-is-discarded">a browsing context is discarded</a> algorithm is modified to read as follows:</p>
   <div class="algorithm" data-algorithm="browsing context tree discarded">
     To discard a browsing context <var>browsingContext</var>, run these steps: 
    <ol>
     <li data-md>
      <p>If this is not a recursive invocation of this algorithm, call any <dfn class="dfn-paneled" data-dfn-type="dfn" data-export data-lt="browsing context tree discarded" id="browsing-context-tree-discarded">browsing context
  tree discarded</dfn> steps defined in external specifications with <var>browsingContext</var>.</p>
     <li data-md>
      <p>Discard all <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#document" id="ref-for-document">Document</a></code> objects for all the entries in <var>browsingContext</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/#session-history" id="ref-for-session-history">session
  history</a>.</p>
     <li data-md>
      <p>If <var>browsingContext</var> is a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#top-level-browsing-context" id="ref-for-top-level-browsing-context⑦">top-level browsing context</a>, then <a data-link-type="dfn" href="https://html.spec.whatwg.org/#bcg-remove" id="ref-for-bcg-remove">remove a browsing context</a> <var>browsingContext</var>.</p>
    </ol>
   </div>
   <p class="issue" id="issue-b664c1e3"><a class="self-link" href="#issue-b664c1e3"></a> The actual patch might be better to split the algorithm into an outer algorithm that is
called by external callers and an inner algorithm that’s used for recursive calls. That’s quite hard
to express as a patch to the specification since it requires changing multiple parts.</p>
   <p>The <a data-link-type="dfn" href="https://html.spec.whatwg.org/#report-the-error" id="ref-for-report-the-error">report an error</a> algorithm is modified with an additional step at the
end:</p>
   <div class="algorithm" data-algorithm="error reporting steps">
    <ol start="11">
     <li data-md>
      <p>Call any <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="error-reporting-steps">error reporting steps</dfn> defined in external specifications
   with <var>script</var>, <var>line</var>, <var>col</var>, <var>message</var>, and true if the error is <a data-link-type="dfn" href="https://html.spec.whatwg.org/#concept-error-handled" id="ref-for-concept-error-handled">handled</a>, or false otherwise.</p>
    </ol>
   </div>
   <h3 class="heading settled" data-level="7.2" id="patches-console"><span class="secno">7.2. </span><span class="content">Console</span><a class="self-link" href="#patches-console"></a></h3>
   <p>Other specifications can define <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="console-steps">console steps</dfn>. When any method of the <code class="idl"><a data-link-type="idl" href="https://console.spec.whatwg.org/#namespacedef-console" id="ref-for-namespacedef-console">console</a></code> interface is called, with method name <var>method</var> and argument <var>args</var>:</p>
   <ol>
    <li data-md>
     <p>If that method does not call the <a data-link-type="dfn" href="https://console.spec.whatwg.org#printer" id="ref-for-printer">Printer</a> operation, call any <a data-link-type="dfn" href="#console-steps" id="ref-for-console-steps①">console
 steps</a> defined in external specification with arguments <var>method</var>, <var>args</var> and, undefined.</p>
     <p>Otherwise, at the point when the <a data-link-type="dfn" href="https://console.spec.whatwg.org#printer" id="ref-for-printer①">Printer</a> operation is called with
 arguments <var>name</var>, <var>printerArgs</var> and <var>options</var> (which is undefined if the
 argument is not provided), call any <a data-link-type="dfn" href="#console-steps" id="ref-for-console-steps②">console steps</a> defined in
 external specification with arguments <var>name</var>, <var>printerArgs</var>, and <var>options</var>.</p>
   </ol>
  </main>
  <script src="https://www.w3.org/scripts/TR/2021/fixup.js"></script>
  <h2 class="no-num no-ref heading settled" id="index"><span class="content">Index</span><a class="self-link" href="#index"></a></h2>
  <h3 class="no-num no-ref heading settled" id="index-defined-here"><span class="content">Terms defined by this specification</span><a class="self-link" href="#index-defined-here"></a></h3>
  <ul class="index">
   <li><a href="#active-listeners">active listeners</a><span>, in § 4</span>
   <li><a href="#modules-browsingcontext">browsingContext</a><span>, in § 6.2</span>
   <li><a href="#event-browsing-context-event-map">browsing context event map</a><span>, in § 3.5</span>
   <li><a href="#commands-browsingcontextgettree">browsingContext.getTree</a><span>, in § 6.2.3.1</span>
   <li><a href="#browsing-context-id">browsing context id</a><span>, in § 6.2.2.1</span>
   <li><a href="#browsing-context-tree-discarded">browsing context tree discarded</a><span>, in § 7.1</span>
   <li><a href="#buffer-a-log-event">buffer a log event</a><span>, in § 6.4</span>
   <li><a href="#command">command</a><span>, in § 3.4</span>
   <li><a href="#command-command-name">command name</a><span>, in § 3.4</span>
   <li><a href="#command-command-parameters">command parameters</a><span>, in § 3.4</span>
   <li><a href="#command-command-type">command type</a><span>, in § 3.4</span>
   <li><a href="#console-steps">console steps</a><span>, in § 7.2</span>
   <li><a href="#construct-a-websocket-resource-name">construct a WebSocket resource name</a><span>, in § 4</span>
   <li><a href="#construct-a-websocket-url">construct a WebSocket URL</a><span>, in § 4</span>
   <li><a href="#construct-a-websocket-resource-name">constructing a WebSocket resource name</a><span>, in § 4</span>
   <li><a href="#construct-a-websocket-url">constructing a WebSocket URL</a><span>, in § 4</span>
   <li><a href="#current-stack-trace">current stack trace</a><span>, in § 6.4.2.2</span>
   <li><a href="#emit-a-context-created-event">Emit a context created event</a><span>, in § 6.2.4.1</span>
   <li><a href="#emit-an-event">emit an event</a><span>, in § 4</span>
   <li><a href="#error-reporting-steps">error reporting steps</a><span>, in § 7.1</span>
   <li><a href="#event">event</a><span>, in § 3.5</span>
   <li><a href="#event-enabled-browsing-contexts">event enabled browsing contexts</a><span>, in § 3.5</span>
   <li><a href="#event-is-enabled">event is enabled</a><span>, in § 3.5</span>
   <li><a href="#event-event-name">event name</a><span>, in § 3.5</span>
   <li><a href="#command-event-parameters">event parameters.</a><span>, in § 3.5</span>
   <li><a href="#event-event-type">event type</a><span>, in § 3.5</span>
   <li><a href="#extension-modules">extension modules</a><span>, in § 3.3</span>
   <li><a href="#get-a-browsing-context">get a browsing context</a><span>, in § 6.2.2.1</span>
   <li><a href="#get-a-session-id-for-a-websocket-resource">get a session ID for a WebSocket resource</a><span>, in § 4</span>
   <li><a href="#get-related-browsing-contexts">get related browsing contexts</a><span>, in § 4</span>
   <li><a href="#get-the-browsing-context-info">get the browsing context info</a><span>, in § 6.2.2.2</span>
   <li><a href="#get-the-descendent-browsing-contexts">get the descendent browsing contexts</a><span>, in § 6.2.2.2</span>
   <li><a href="#get-the-realm-info">get the realm info</a><span>, in § 6.3.2.2</span>
   <li><a href="#event-global-event-set">global event set</a><span>, in § 3.5</span>
   <li><a href="#handle-a-connection-closing">handle a connection closing</a><span>, in § 4</span>
   <li><a href="#handle-an-incoming-message">handle an incoming message</a><span>, in § 4</span>
   <li><a href="#listener-host">host</a><span>, in § 4</span>
   <li><a href="#event-in-the-default-event-set">in the default event set</a><span>, in § 3.5</span>
   <li><a href="#list-of-websocket-resources">list of WebSocket resources</a><span>, in § 4</span>
   <li><a href="#local-end-definition">local end definition</a><span>, in § 3</span>
   <li><a href="#modules-log">log</a><span>, in § 6.4</span>
   <li><a href="#log-event-buffer">log event buffer</a><span>, in § 6.4</span>
   <li><a href="#module">module</a><span>, in § 3.3</span>
   <li><a href="#module-name">module name</a><span>, in § 3.3</span>
   <li><a href="#object-id-for-an-object">object id for an object</a><span>, in § 5.1</span>
   <li><a href="#object-id-map">object id map</a><span>, in § 5.1</span>
   <li><a href="#obtain-a-set-of-event-names">obtain a set of event names</a><span>, in § 3.5</span>
   <li><a href="#listener-port">port</a><span>, in § 4</span>
   <li><a href="#realm-id">realm id</a><span>, in § 6.3.2.1</span>
   <li><a href="#recursively-emit-context-created-events">Recursively emit context created events</a><span>, in § 6.2.4.1</span>
   <li><a href="#remote-end-definition">remote end definition</a><span>, in § 3</span>
   <li><a href="#remote-end-event-trigger">remote end event trigger</a><span>, in § 3.5</span>
   <li><a href="#remote-end-subscribe-steps">remote end subscribe steps</a><span>, in § 3.5</span>
   <li><a href="#respond-with-an-error">respond with an error</a><span>, in § 4</span>
   <li><a href="#command-result-type">result type</a><span>, in § 3.4</span>
   <li><a href="#modules-script">script</a><span>, in § 6.3</span>
   <li><a href="#commands-scriptgetrealms">script.getRealms</a><span>, in § 6.3.3.1</span>
   <li><a href="#listener-secure-flag">secure flag</a><span>, in § 4</span>
   <li><a href="#serialize-as-a-list">serialize as a list</a><span>, in § 5.1</span>
   <li><a href="#serialize-as-a-mapping">serialize as a mapping</a><span>, in § 5.1</span>
   <li><a href="#serialize-as-a-remote-value">serialize as a remote value</a><span>, in § 5.1</span>
   <li><a href="#modules-session">session</a><span>, in § 6.1</span>
   <li><a href="#commands-sessionstatus">session.status</a><span>, in § 6.1.2.1</span>
   <li><a href="#commands-sessionsubscribe">session.subscribe</a><span>, in § 6.1.2.2</span>
   <li><a href="#commands-sessionunsubscribe">session.unsubscribe</a><span>, in § 6.1.2.3</span>
   <li><a href="#command-set-of-all-command-names">set of all command names</a><span>, in § 3.4</span>
   <li><a href="#start-listening-for-a-websocket-connection">start listening for a WebSocket connection</a><span>, in § 4</span>
   <li><a href="#subscribe-priority">subscribe priority</a><span>, in § 3.5</span>
   <li><a href="#update-the-event-map">update the event map</a><span>, in § 6.1.1</span>
   <li><a href="#websocket-connection">WebSocket connection</a><span>, in § 4</span>
   <li><a href="#websocket-listener">WebSocket listener</a><span>, in § 4</span>
  </ul>
  <h3 class="no-num no-ref heading settled" id="index-defined-elsewhere"><span class="content">Terms defined by reference</span><a class="self-link" href="#index-defined-elsewhere"></a></h3>
  <ul class="index">
   <li>
    <a data-link-type="biblio">[CONSOLE]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="7b1760b0">console</span>
     <li><span class="dfn-paneled" id="8ef06ef9">formatter</span>
     <li><span class="dfn-paneled" id="40a66c6b">formatting specifier</span>
     <li><span class="dfn-paneled" id="09fc63ab">printer</span>
    </ul>
   <li>
    <a data-link-type="biblio">[CSS-COLOR-3]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="95a8ae14">window</span>
    </ul>
   <li>
    <a data-link-type="biblio">[CSS-PAINT-API-1]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="6b7fd43d">PaintWorkletGlobalScope</span>
    </ul>
   <li>
    <a data-link-type="biblio">[DOM]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="85394472">Document</span>
     <li><span class="dfn-paneled" id="db0a062f">attribute</span>
     <li><span class="dfn-paneled" id="77211728">attribute list</span>
     <li><span class="dfn-paneled" id="92b2d7da">children</span>
     <li><span class="dfn-paneled" id="a973e0fe">document</span>
     <li><span class="dfn-paneled" id="27d9b7ea">element</span>
     <li><span class="dfn-paneled" id="d462b34f">node</span>
     <li><span class="dfn-paneled" id="2ef14d2e">nodes</span>
     <li><span class="dfn-paneled" id="4d437809">qualified name</span>
     <li><span class="dfn-paneled" id="ce720392">shadow root</span>
     <li><span class="dfn-paneled" id="347e8fe9">url</span>
     <li><span class="dfn-paneled" id="3b681a11">value</span>
    </ul>
   <li>
    <a data-link-type="biblio">[ECMASCRIPT]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="34e1a2c9">createarrayiterator</span>
     <li><span class="dfn-paneled" id="b44c8bda">createlistfromarraylike</span>
     <li><span class="dfn-paneled" id="2b83b63d">createmapiterator</span>
     <li><span class="dfn-paneled" id="ec4bb300">createsetiterator</span>
     <li><span class="dfn-paneled" id="5582c476">current realm record</span>
     <li><span class="dfn-paneled" id="7ef0edbd">enumerableownpropertynames</span>
     <li><span class="dfn-paneled" id="47eb8c57">get</span>
     <li><span class="dfn-paneled" id="900ce14b">internal slot</span>
     <li><span class="dfn-paneled" id="8f3fa597">isarray</span>
     <li><span class="dfn-paneled" id="1754fd49">iscallable</span>
     <li><span class="dfn-paneled" id="7728ef75">ispromise</span>
     <li><span class="dfn-paneled" id="a60df0fb">isregexp</span>
     <li><span class="dfn-paneled" id="61755c00">primitive value</span>
     <li><span class="dfn-paneled" id="704f9119">realm</span>
     <li><span class="dfn-paneled" id="a4739eca">running execution context</span>
     <li><span class="dfn-paneled" id="65ad9555">thistimevalue</span>
     <li><span class="dfn-paneled" id="bba0f383">time value</span>
     <li><span class="dfn-paneled" id="e16c05f6">todatestring</span>
     <li><span class="dfn-paneled" id="51f1a168">tostring</span>
     <li><span class="dfn-paneled" id="b7212a68">type</span>
    </ul>
   <li>
    <a data-link-type="biblio">[FETCH]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="697965b2">connection</span>
     <li><span class="dfn-paneled" id="d5434eef">contains</span>
    </ul>
   <li>
    <a data-link-type="biblio">[HTML]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="b8308563">DedicatedWorkerGlobalScope</span>
     <li><span class="dfn-paneled" id="165b73c9">SharedWorkerGlobalScope</span>
     <li><span class="dfn-paneled" id="94039a0c">WindowProxy</span>
     <li><span class="dfn-paneled" id="83c59a3a">WorkerGlobalScope</span>
     <li><span class="dfn-paneled" id="0c9b0d3c">WorkletGlobalScope</span>
     <li><span class="dfn-paneled" id="6877d20b">a browsing context is discarded</span>
     <li><span class="dfn-paneled" id="35972864">active document</span>
     <li><span class="dfn-paneled" id="0d0390b4">browsing context</span>
     <li><span class="dfn-paneled" id="3b2ff63e">browsing context <small>(for Document)</small></span>
     <li><span class="dfn-paneled" id="36b72cc4">create a new browsing context</span>
     <li><span class="dfn-paneled" id="12b8dfc0">current settings object</span>
     <li><span class="dfn-paneled" id="3e12e042">environment settings object</span>
     <li><span class="dfn-paneled" id="c96bc515">environment settings object's realm</span>
     <li><span class="dfn-paneled" id="f5265332">execution ready flag</span>
     <li><span class="dfn-paneled" id="d1a73969">handled</span>
     <li><span class="dfn-paneled" id="dc248371">owner set</span>
     <li><span class="dfn-paneled" id="ce15d5dc">realm execution context</span>
     <li><span class="dfn-paneled" id="5991ccfb">relevant realm</span>
     <li><span class="dfn-paneled" id="e0a96298">remove a browsing context</span>
     <li><span class="dfn-paneled" id="e6be17f4">report an error</span>
     <li><span class="dfn-paneled" id="e3288657">responsible event loop</span>
     <li><span class="dfn-paneled" id="dae0bfde">serialization of an origin</span>
     <li><span class="dfn-paneled" id="21704849">session history</span>
     <li><span class="dfn-paneled" id="5d64e3f2">set up a window environment settings object</span>
     <li><span class="dfn-paneled" id="326f501d">set up a worker environment settings object</span>
     <li><span class="dfn-paneled" id="f1eccc95">settings object</span>
     <li><span class="dfn-paneled" id="a41b1317">terminate a worker</span>
     <li><span class="dfn-paneled" id="ae2a6342">top-level browsing context</span>
     <li><span class="dfn-paneled" id="4411082c">unloading document cleanup steps</span>
     <li><span class="dfn-paneled" id="6f49634d">worker event loop</span>
     <li><span class="dfn-paneled" id="4cef69e3">worklet global scopes</span>
    </ul>
   <li>
    <a data-link-type="biblio">[INFRA]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="a3b18719">append</span>
     <li><span class="dfn-paneled" id="77b4c09a">assert</span>
     <li><span class="dfn-paneled" id="027e3e49">clone</span>
     <li><span class="dfn-paneled" id="f937b7b6">continue</span>
     <li><span class="dfn-paneled" id="860300d4">implementation-defined</span>
     <li><span class="dfn-paneled" id="3fca5a9e">map</span>
     <li><span class="dfn-paneled" id="8e8decb4">parse json into infra values</span>
     <li><span class="dfn-paneled" id="762869d3">scalar value string</span>
     <li><span class="dfn-paneled" id="4c07280e">serialize an infra value to json bytes</span>
     <li><span class="dfn-paneled" id="15e48c39">set</span>
     <li><span class="dfn-paneled" id="0204d188">size <small>(for list)</small></span>
     <li><span class="dfn-paneled" id="653d0848">size <small>(for map)</small></span>
     <li><span class="dfn-paneled" id="fe28f7a2">sort in ascending order</span>
    </ul>
   <li>
    <a data-link-type="biblio">[RFC6455]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="7162eb1a">%x1 denotes a text frame</span>
     <li><span class="dfn-paneled" id="1065054c">a websocket message has been received</span>
     <li><span class="dfn-paneled" id="1e855c18">establishes a websocket connection</span>
     <li><span class="dfn-paneled" id="a0f3a43b">fail the websocket connection</span>
     <li><span class="dfn-paneled" id="2499ae2a">handling errors in utf-8-encoded data</span>
     <li><span class="dfn-paneled" id="e4c5f264">reading the client's opening handshake</span>
     <li><span class="dfn-paneled" id="b7ad9913">send a websocket message</span>
     <li><span class="dfn-paneled" id="31afd3ea">server-side requirements</span>
     <li><span class="dfn-paneled" id="5644bb38">status codes</span>
     <li><span class="dfn-paneled" id="adc2b755">the websocket closing handshake is started</span>
     <li><span class="dfn-paneled" id="36f1b87f">the websocket connection is closed</span>
     <li><span class="dfn-paneled" id="7fdc1cbb">websocket uri</span>
    </ul>
   <li>
    <a data-link-type="biblio">[SERVICE-WORKERS]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="86d2a717">ServiceWorkerGlobalScope</span>
    </ul>
   <li>
    <a data-link-type="biblio">[URL]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="dcffbccd">url</span>
     <li><span class="dfn-paneled" id="5442ea33">url serializer</span>
    </ul>
   <li>
    <a data-link-type="biblio">[WEBAUDIO]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="8fe058df">AudioWorkletGlobalScope</span>
    </ul>
   <li>
    <a data-link-type="biblio">[WEBDRIVER]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="49bb0560">active sessions</span>
     <li><span class="dfn-paneled" id="3555dec9">additional capability deserialization algorithm</span>
     <li><span class="dfn-paneled" id="189cc7e1">additional webdriver capability</span>
     <li><span class="dfn-paneled" id="36acc234">capability name</span>
     <li><span class="dfn-paneled" id="ae9c1639">current session</span>
     <li><span class="dfn-paneled" id="ee843963">endpoint node</span>
     <li><span class="dfn-paneled" id="a4c28706">error</span>
     <li><span class="dfn-paneled" id="c8ff8493">error code</span>
     <li><span class="dfn-paneled" id="814d830a">getting a property</span>
     <li><span class="dfn-paneled" id="93f9e904">intermediary node</span>
     <li><span class="dfn-paneled" id="8da4d1e3">invalid argument</span>
     <li><span class="dfn-paneled" id="9a707b42">local end</span>
     <li><span class="dfn-paneled" id="a192e236">matched capability serialization algorithm</span>
     <li><span class="dfn-paneled" id="0d868320">no such frame</span>
     <li><span class="dfn-paneled" id="35d404ee">remote end</span>
     <li><span class="dfn-paneled" id="82c23298">remote end steps</span>
     <li><span class="dfn-paneled" id="79d221ec">session</span>
     <li><span class="dfn-paneled" id="4fc3ddf9">session id</span>
     <li><span class="dfn-paneled" id="cb9acc83">set a property</span>
     <li><span class="dfn-paneled" id="4be6272b">success</span>
     <li><span class="dfn-paneled" id="e7c89135">try</span>
     <li><span class="dfn-paneled" id="8b8836ef">unknown command</span>
     <li><span class="dfn-paneled" id="94cf11b8">web element reference</span>
     <li><span class="dfn-paneled" id="a795f739">webdriver new session algorithm</span>
     <li><span class="dfn-paneled" id="660a1a43">window handle</span>
    </ul>
   <li>
    <a data-link-type="biblio">[WEBIDL]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="6728fdee">platform object</span>
     <li><span class="dfn-paneled" id="07bd1803">return type</span>
    </ul>
  </ul>
  <h2 class="no-num no-ref heading settled" id="references"><span class="content">References</span><a class="self-link" href="#references"></a></h2>
  <h3 class="no-num no-ref heading settled" id="normative"><span class="content">Normative References</span><a class="self-link" href="#normative"></a></h3>
  <dl>
   <dt id="biblio-console">[CONSOLE]
   <dd>Dominic Farolino; Robert Kowalski; Terin Stock. <a href="https://console.spec.whatwg.org/"><cite>Console Standard</cite></a>. Living Standard. URL: <a href="https://console.spec.whatwg.org/">https://console.spec.whatwg.org/</a>
   <dt id="biblio-css-color-3">[CSS-COLOR-3]
   <dd>Tantek Çelik; Chris Lilley; David Baron. <a href="https://drafts.csswg.org/css-color-3/"><cite>CSS Color Module Level 3</cite></a>. URL: <a href="https://drafts.csswg.org/css-color-3/">https://drafts.csswg.org/css-color-3/</a>
   <dt id="biblio-css-paint-api-1">[CSS-PAINT-API-1]
   <dd>Ian Kilpatrick; Dean Jackson. <a href="https://drafts.css-houdini.org/css-paint-api-1/"><cite>CSS Painting API Level 1</cite></a>. URL: <a href="https://drafts.css-houdini.org/css-paint-api-1/">https://drafts.css-houdini.org/css-paint-api-1/</a>
   <dt id="biblio-dom">[DOM]
   <dd>Anne van Kesteren. <a href="https://dom.spec.whatwg.org/"><cite>DOM Standard</cite></a>. Living Standard. URL: <a href="https://dom.spec.whatwg.org/">https://dom.spec.whatwg.org/</a>
   <dt id="biblio-ecmascript">[ECMASCRIPT]
   <dd><a href="https://tc39.es/ecma262/multipage/"><cite>ECMAScript Language Specification</cite></a>. URL: <a href="https://tc39.es/ecma262/multipage/">https://tc39.es/ecma262/multipage/</a>
   <dt id="biblio-fetch">[FETCH]
   <dd>Anne van Kesteren. <a href="https://fetch.spec.whatwg.org/"><cite>Fetch Standard</cite></a>. Living Standard. URL: <a href="https://fetch.spec.whatwg.org/">https://fetch.spec.whatwg.org/</a>
   <dt id="biblio-html">[HTML]
   <dd>Anne van Kesteren; et al. <a href="https://html.spec.whatwg.org/multipage/"><cite>HTML Standard</cite></a>. Living Standard. URL: <a href="https://html.spec.whatwg.org/multipage/">https://html.spec.whatwg.org/multipage/</a>
   <dt id="biblio-infra">[INFRA]
   <dd>Anne van Kesteren; Domenic Denicola. <a href="https://infra.spec.whatwg.org/"><cite>Infra Standard</cite></a>. Living Standard. URL: <a href="https://infra.spec.whatwg.org/">https://infra.spec.whatwg.org/</a>
   <dt id="biblio-rfc4122">[RFC4122]
   <dd>K. Davis; B. Peabody; P. Leach. <a href="https://www.rfc-editor.org/rfc/rfc9562"><cite>Universally Unique IDentifiers (UUIDs)</cite></a>. May 2024. Proposed Standard. URL: <a href="https://www.rfc-editor.org/rfc/rfc9562">https://www.rfc-editor.org/rfc/rfc9562</a>
   <dt id="biblio-rfc6455">[RFC6455]
   <dd>I. Fette; A. Melnikov. <a href="https://www.rfc-editor.org/rfc/rfc6455"><cite>The WebSocket Protocol</cite></a>. December 2011. Proposed Standard. URL: <a href="https://www.rfc-editor.org/rfc/rfc6455">https://www.rfc-editor.org/rfc/rfc6455</a>
   <dt id="biblio-rfc8610">[RFC8610]
   <dd>H. Birkholz; C. Vigano; C. Bormann. <a href="https://www.rfc-editor.org/rfc/rfc8610"><cite>Concise Data Definition Language (CDDL): A Notational Convention to Express Concise Binary Object Representation (CBOR) and JSON Data Structures</cite></a>. June 2019. Proposed Standard. URL: <a href="https://www.rfc-editor.org/rfc/rfc8610">https://www.rfc-editor.org/rfc/rfc8610</a>
   <dt id="biblio-service-workers">[SERVICE-WORKERS]
   <dd>Jake Archibald; Marijn Kruisselbrink. <a href="https://w3c.github.io/ServiceWorker/"><cite>Service Workers</cite></a>. URL: <a href="https://w3c.github.io/ServiceWorker/">https://w3c.github.io/ServiceWorker/</a>
   <dt id="biblio-url">[URL]
   <dd>Anne van Kesteren. <a href="https://url.spec.whatwg.org/"><cite>URL Standard</cite></a>. Living Standard. URL: <a href="https://url.spec.whatwg.org/">https://url.spec.whatwg.org/</a>
   <dt id="biblio-webaudio">[WEBAUDIO]
   <dd>Paul Adenot; Hongchan Choi. <a href="https://webaudio.github.io/web-audio-api/"><cite>Web Audio API</cite></a>. URL: <a href="https://webaudio.github.io/web-audio-api/">https://webaudio.github.io/web-audio-api/</a>
   <dt id="biblio-webdriver">[WEBDRIVER]
   <dd>Simon Stewart; David Burns. <a href="https://w3c.github.io/webdriver/"><cite>WebDriver</cite></a>. URL: <a href="https://w3c.github.io/webdriver/">https://w3c.github.io/webdriver/</a>
   <dt id="biblio-webidl">[WEBIDL]
   <dd>Edgar Chen; Timothy Gu. <a href="https://webidl.spec.whatwg.org/"><cite>Web IDL Standard</cite></a>. Living Standard. URL: <a href="https://webidl.spec.whatwg.org/">https://webidl.spec.whatwg.org/</a>
  </dl>
  <h3 class="no-num no-ref heading settled" id="informative"><span class="content">Informative References</span><a class="self-link" href="#informative"></a></h3>
  <dl>
   <dt id="biblio-json-rpc">[JSON-RPC]
   <dd>JSON-RPC Working Group. <a href="https://www.jsonrpc.org/specification"><cite>JSON-RPC 2.0 Specification</cite></a>. 4 January 2013. URL: <a href="https://www.jsonrpc.org/specification">https://www.jsonrpc.org/specification</a>
  </dl>
  <h2 class="no-num no-ref heading settled" id="issues-index"><span class="content">Issues Index</span><a class="self-link" href="#issues-index"></a></h2>
  <div style="counter-reset:issue">
   <div class="issue"> Should this be an appendix? <a class="issue-return" href="#issue-40ad1db0" title="Jump to section">↵</a></div>
   <div class="issue"> Do we support > 1 connection for a single session? <a class="issue-return" href="#issue-0dc5e7b6" title="Jump to section">↵</a></div>
   <div class="issue"> Nothing seems to define what <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc6455#section-7.4">status code</a> is used for UTF-8 errors. <a class="issue-return" href="#issue-449f8f30" title="Jump to section">↵</a></div>
   <div class="issue"> This should also reset any internal state <a class="issue-return" href="#issue-02ccb156" title="Jump to section">↵</a></div>
   <div class="issue"> Need to hook in to the session ending to allow the UA to close
the listener if it wants. <a class="issue-return" href="#issue-9f7aff26" title="Jump to section">↵</a></div>
   <div class="issue"> Should this be explicitly per realm? <a class="issue-return" href="#issue-992788ee" title="Jump to section">↵</a></div>
   <div class="issue"> Add WASM types? <a class="issue-return" href="#issue-14921645" title="Jump to section">↵</a></div>
   <div class="issue"> Should WindowProxy get attributes in a similar style to Node? <a class="issue-return" href="#issue-ace5d7fc" title="Jump to section">↵</a></div>
   <div class="issue"> handle String / Number / etc. wrapper objects specially? <a class="issue-return" href="#issue-daee5863" title="Jump to section">↵</a></div>
   <div class="issue"> This doesn’t handle lone surrogates <a class="issue-return" href="#issue-d33a79cf" title="Jump to section">↵</a></div>
   <div class="issue"> Does it make sense to use the same depth parameter for nodes and objects
in general? <a class="issue-return" href="#issue-66909ae2" title="Jump to section">↵</a></div>
   <div class="issue"> this assumes for-in works on iterators <a class="issue-return" href="#issue-c12b3c7f" title="Jump to section">↵</a></div>
   <div class="issue"> This needs to be generalized to work with realms too <a class="issue-return" href="#issue-77ae0f57" title="Jump to section">↵</a></div>
   <div class="issue"> This needs to be generalised to work with realms too <a class="issue-return" href="#issue-851a021c" title="Jump to section">↵</a></div>
   <div class="issue"> the way this hooks into HTML feels very fragile. See https://github.com/whatwg/html/issues/6194 <a class="issue-return" href="#issue-7a4ace46" title="Jump to section">↵</a></div>
   <div class="issue"> It’s unclear if we ought to only fire this event for browsing
contexts that have active documents; navigation can also cause contexts to
become inaccessible but not yet get discarded because bfcache. <a class="issue-return" href="#issue-4e122e13" title="Jump to section">↵</a></div>
   <div class="issue"> We currently don’t provide information about realms of unknown
       types. That might be a problem for e.g. extension-related realms. <a class="issue-return" href="#issue-56892cd2" title="Jump to section">↵</a></div>
   <div class="issue"> Extend this to also allow realm parents e.g. for nested workers? Or get all ancestor workers. <a class="issue-return" href="#issue-ac9113ee" title="Jump to section">↵</a></div>
   <div class="issue"> We might want to have a more sophisticated filter system than just a
       literal match. <a class="issue-return" href="#issue-b6525c5d" title="Jump to section">↵</a></div>
   <div class="issue"> Should the order here be better defined? <a class="issue-return" href="#issue-74a40be3" title="Jump to section">↵</a></div>
   <div class="issue"> Do we want to key this on browsing context or top-level browsing context?
The difference is in what happens if an event occurs in a frame and that frame
is then navigated before the local end subscribes to log events for the top
level context. <a class="issue-return" href="#issue-d20b5797" title="Jump to section">↵</a></div>
   <div class="issue"> This is underdefined in the console spec, so it’s unclar if we can get
 interoperable behaviour here. <a class="issue-return" href="#issue-b611588d" title="Jump to section">↵</a></div>
   <div class="issue"> Lots more things require logging. CDP has LogEntryAdded types xml,
javascript, network, storage, appcache, rendering, security, deprecation,
worker, violation, intervention, recommendation, other. These are in addition to
the js exception and console API types that are represented by different methods. <a class="issue-return" href="#issue-d863e230" title="Jump to section">↵</a></div>
   <div class="issue"> Allow implementation-defined log types <a class="issue-return" href="#issue-365f0ed7" title="Jump to section">↵</a></div>
   <div class="issue"> The actual patch might be better to split the algorithm into an outer algorithm that is
called by external callers and an inner algorithm that’s used for recursive calls. That’s quite hard
to express as a patch to the specification since it requires changing multiple parts. <a class="issue-return" href="#issue-b664c1e3" title="Jump to section">↵</a></div>
  </div>
<script>/* Boilerplate: script-dom-helper */
"use strict";
function query(sel) { return document.querySelector(sel); }

function queryAll(sel) { return [...document.querySelectorAll(sel)]; }

function iter(obj) {
	if(!obj) return [];
	var it = obj[Symbol.iterator];
	if(it) return it;
	return Object.entries(obj);
}

function mk(tagname, attrs, ...children) {
	const el = document.createElement(tagname);
	for(const [k,v] of iter(attrs)) {
		if(k.slice(0,3) == "_on") {
			const eventName = k.slice(3);
			el.addEventListener(eventName, v);
		} else if(k[0] == "_") {
			// property, not attribute
			el[k.slice(1)] = v;
		} else {
			if(v === false || v == null) {
        continue;
      } else if(v === true) {
        el.setAttribute(k, "");
        continue;
      } else {
  			el.setAttribute(k, v);
      }
		}
	}
	append(el, children);
	return el;
}

/* Create shortcuts for every known HTML element */
[
  "a",
  "abbr",
  "acronym",
  "address",
  "applet",
  "area",
  "article",
  "aside",
  "audio",
  "b",
  "base",
  "basefont",
  "bdo",
  "big",
  "blockquote",
  "body",
  "br",
  "button",
  "canvas",
  "caption",
  "center",
  "cite",
  "code",
  "col",
  "colgroup",
  "datalist",
  "dd",
  "del",
  "details",
  "dfn",
  "dialog",
  "div",
  "dl",
  "dt",
  "em",
  "embed",
  "fieldset",
  "figcaption",
  "figure",
  "font",
  "footer",
  "form",
  "frame",
  "frameset",
  "head",
  "header",
  "h1",
  "h2",
  "h3",
  "h4",
  "h5",
  "h6",
  "hr",
  "html",
  "i",
  "iframe",
  "img",
  "input",
  "ins",
  "kbd",
  "label",
  "legend",
  "li",
  "link",
  "main",
  "map",
  "mark",
  "meta",
  "meter",
  "nav",
  "nobr",
  "noscript",
  "object",
  "ol",
  "optgroup",
  "option",
  "output",
  "p",
  "param",
  "pre",
  "progress",
  "q",
  "s",
  "samp",
  "script",
  "section",
  "select",
  "small",
  "source",
  "span",
  "strike",
  "strong",
  "style",
  "sub",
  "summary",
  "sup",
  "table",
  "tbody",
  "td",
  "template",
  "textarea",
  "tfoot",
  "th",
  "thead",
  "time",
  "title",
  "tr",
  "u",
  "ul",
  "var",
  "video",
  "wbr",
  "xmp",
].forEach(tagname=>{
	mk[tagname] = (...args) => mk(tagname, ...args);
});

function* nodesFromChildList(children) {
	for(const child of children.flat(Infinity)) {
		if(child instanceof Node) {
			yield child;
		} else {
			yield new Text(child);
		}
	}
}
function append(el, ...children) {
	for(const child of nodesFromChildList(children)) {
		if(el instanceof Node) el.appendChild(child);
		else el.push(child);
	}
	return el;
}

function insertAfter(el, ...children) {
	for(const child of nodesFromChildList(children)) {
		el.parentNode.insertBefore(child, el.nextSibling);
	}
	return el;
}

function clearContents(el) {
	el.innerHTML = "";
	return el;
}

function parseHTML(markup) {
	if(markup.toLowerCase().trim().indexOf('<!doctype') === 0) {
		const doc = document.implementation.createHTMLDocument("");
		doc.documentElement.innerHTML = markup;
		return doc;
	} else {
		const el = mk.template({});
		el.innerHTML = markup;
		return el.content;
	}
}</script>
<script>/* Boilerplate: script-dfn-panel */
"use strict";
{
let dfnPanelData = {
"0204d188": {"dfnID":"0204d188","dfnText":"size (for list)","external":true,"refSections":[{"refs":[{"id":"ref-for-list-size"},{"id":"ref-for-list-size\u2460"}],"title":"5.1. Remote Value"}],"url":"https://infra.spec.whatwg.org/#list-size"},
"027e3e49": {"dfnID":"027e3e49","dfnText":"clone","external":true,"refSections":[{"refs":[{"id":"ref-for-list-clone"},{"id":"ref-for-list-clone\u2460"}],"title":"6.1.1. Definition"}],"url":"https://infra.spec.whatwg.org/#list-clone"},
"07bd1803": {"dfnID":"07bd1803","dfnText":"return type","external":true,"refSections":[{"refs":[{"id":"ref-for-dfn-return-type"}],"title":"3.4. Commands"}],"url":"https://webidl.spec.whatwg.org/#dfn-return-type"},
"09fc63ab": {"dfnID":"09fc63ab","dfnText":"printer","external":true,"refSections":[{"refs":[{"id":"ref-for-printer"},{"id":"ref-for-printer\u2460"}],"title":"7.2. Console"}],"url":"https://console.spec.whatwg.org#printer"},
"0c9b0d3c": {"dfnID":"0c9b0d3c","dfnText":"WorkletGlobalScope","external":true,"refSections":[{"refs":[{"id":"ref-for-workletglobalscope"},{"id":"ref-for-workletglobalscope\u2460"}],"title":"6.3.2.2. The script.RealmInfo type"}],"url":"https://html.spec.whatwg.org/multipage/worklets.html#workletglobalscope"},
"0d0390b4": {"dfnID":"0d0390b4","dfnText":"browsing context","external":true,"refSections":[{"refs":[{"id":"ref-for-browsing-context"}],"title":"6.2.2.1. The browsingContext.BrowsingContext Type"},{"refs":[{"id":"ref-for-browsing-context\u2460"}],"title":"6.2.2.2. The browsingContext.BrowsingContextInfo Type"},{"refs":[{"id":"ref-for-browsing-context\u2461"}],"title":"6.3.3.1. The script.getRealms Command"}],"url":"https://html.spec.whatwg.org/multipage/document-sequences.html#browsing-context"},
"0d868320": {"dfnID":"0d868320","dfnText":"no such frame","external":true,"refSections":[{"refs":[{"id":"ref-for-dfn-no-such-frame"}],"title":"6.2.2.1. The browsingContext.BrowsingContext Type"}],"url":"https://w3c.github.io/webdriver/#dfn-no-such-frame"},
"1065054c": {"dfnID":"1065054c","dfnText":"a websocket message has been received","external":true,"refSections":[{"refs":[{"id":"ref-for-section-6.2"}],"title":"4. Transport"}],"url":"https://tools.ietf.org/html/rfc6455#section-6.2"},
"12b8dfc0": {"dfnID":"12b8dfc0","dfnText":"current settings object","external":true,"refSections":[{"refs":[{"id":"ref-for-current-settings-object"}],"title":"6.4.3.1. entryAdded"}],"url":"https://html.spec.whatwg.org/multipage/webappapis.html#current-settings-object"},
"15e48c39": {"dfnID":"15e48c39","dfnText":"set","external":true,"refSections":[{"refs":[{"id":"ref-for-ordered-set"}],"title":"4. Transport"},{"refs":[{"id":"ref-for-ordered-set\u2460"}],"title":"6.4.3.1. entryAdded"}],"url":"https://infra.spec.whatwg.org/#ordered-set"},
"165b73c9": {"dfnID":"165b73c9","dfnText":"SharedWorkerGlobalScope","external":true,"refSections":[{"refs":[{"id":"ref-for-sharedworkerglobalscope"}],"title":"6.3.2.2. The script.RealmInfo type"}],"url":"https://html.spec.whatwg.org/multipage/workers.html#sharedworkerglobalscope"},
"1754fd49": {"dfnID":"1754fd49","dfnText":"iscallable","external":true,"refSections":[{"refs":[{"id":"ref-for-sec-iscallable"}],"title":"5.1. Remote Value"}],"url":"https://tc39.es/ecma262/#sec-iscallable"},
"189cc7e1": {"dfnID":"189cc7e1","dfnText":"additional webdriver capability","external":true,"refSections":[{"refs":[{"id":"ref-for-dfn-additional-webdriver-capability"}],"title":"4.1. Establishing a Connection"}],"url":"https://w3c.github.io/webdriver/#dfn-additional-webdriver-capability"},
"1e855c18": {"dfnID":"1e855c18","dfnText":"establishes a websocket connection","external":true,"refSections":[{"refs":[{"id":"ref-for-section-4.1"}],"title":"4. Transport"}],"url":"https://tools.ietf.org/html/rfc6455#section-4.1"},
"21704849": {"dfnID":"21704849","dfnText":"session history","external":true,"refSections":[{"refs":[{"id":"ref-for-session-history"}],"title":"7.1. HTML"}],"url":"https://html.spec.whatwg.org/#session-history"},
"2499ae2a": {"dfnID":"2499ae2a","dfnText":"handling errors in utf-8-encoded data","external":true,"refSections":[{"refs":[{"id":"ref-for-section-8.1"}],"title":"4. Transport"}],"url":"https://tools.ietf.org/html/rfc6455#section-8.1"},
"27d9b7ea": {"dfnID":"27d9b7ea","dfnText":"element","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-element"},{"id":"ref-for-concept-element\u2460"},{"id":"ref-for-concept-element\u2461"}],"title":"5.1. Remote Value"}],"url":"https://dom.spec.whatwg.org/#concept-element"},
"2b83b63d": {"dfnID":"2b83b63d","dfnText":"createmapiterator","external":true,"refSections":[{"refs":[{"id":"ref-for-sec-createmapiterator"}],"title":"5.1. Remote Value"}],"url":"https://tc39.es/ecma262/#sec-createmapiterator"},
"2ef14d2e": {"dfnID":"2ef14d2e","dfnText":"nodes","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-node"}],"title":"5.1. Remote Value"}],"url":"https://dom.spec.whatwg.org/#concept-node"},
"31afd3ea": {"dfnID":"31afd3ea","dfnText":"server-side requirements","external":true,"refSections":[{"refs":[{"id":"ref-for-section-4.2"},{"id":"ref-for-section-4.2\u2460"}],"title":"4. Transport"}],"url":"https://tools.ietf.org/html/rfc6455#section-4.2"},
"326f501d": {"dfnID":"326f501d","dfnText":"set up a worker environment settings object","external":true,"refSections":[{"refs":[{"id":"ref-for-set-up-a-worker-environment-settings-object"}],"title":"6.3.4.1. The script.realmCreated Event"}],"url":"https://html.spec.whatwg.org/#set-up-a-worker-environment-settings-object"},
"347e8fe9": {"dfnID":"347e8fe9","dfnText":"url","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-document-url"}],"title":"6.2.2.2. The browsingContext.BrowsingContextInfo Type"}],"url":"https://dom.spec.whatwg.org/#concept-document-url"},
"34e1a2c9": {"dfnID":"34e1a2c9","dfnText":"createarrayiterator","external":true,"refSections":[{"refs":[{"id":"ref-for-sec-createarrayiterator"}],"title":"5.1. Remote Value"}],"url":"https://tc39.es/ecma262/#sec-createarrayiterator"},
"3555dec9": {"dfnID":"3555dec9","dfnText":"additional capability deserialization algorithm","external":true,"refSections":[{"refs":[{"id":"ref-for-dfn-additional-capability-deserialization-algorithm"}],"title":"4.1. Establishing a Connection"}],"url":"https://w3c.github.io/webdriver/#dfn-additional-capability-deserialization-algorithm"},
"35972864": {"dfnID":"35972864","dfnText":"active document","external":true,"refSections":[{"refs":[{"id":"ref-for-nav-document"}],"title":"6.2.2.2. The browsingContext.BrowsingContextInfo Type"},{"refs":[{"id":"ref-for-nav-document\u2460"}],"title":"6.2.4.1. The browsingContext.contextCreated Event"},{"refs":[{"id":"ref-for-nav-document\u2461"}],"title":"6.3.3.1. The script.getRealms Command"}],"url":"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-document"},
"35d404ee": {"dfnID":"35d404ee","dfnText":"remote end","external":true,"refSections":[{"refs":[{"id":"ref-for-dfn-remote-ends"},{"id":"ref-for-dfn-remote-ends\u2460"}],"title":"3. Protocol"},{"refs":[{"id":"ref-for-dfn-remote-ends\u2461"},{"id":"ref-for-dfn-remote-ends\u2462"}],"title":"3.4. Commands"},{"refs":[{"id":"ref-for-dfn-remote-ends\u2463"},{"id":"ref-for-dfn-remote-ends\u2464"}],"title":"3.5. Events"},{"refs":[{"id":"ref-for-dfn-remote-ends\u2465"},{"id":"ref-for-dfn-remote-ends\u2466"},{"id":"ref-for-dfn-remote-ends\u2467"},{"id":"ref-for-dfn-remote-ends\u2468"},{"id":"ref-for-dfn-remote-ends\u2460\u24ea"},{"id":"ref-for-dfn-remote-ends\u2460\u2460"},{"id":"ref-for-dfn-remote-ends\u2460\u2461"},{"id":"ref-for-dfn-remote-ends\u2460\u2462"}],"title":"4. Transport"},{"refs":[{"id":"ref-for-dfn-remote-ends\u2460\u2463"},{"id":"ref-for-dfn-remote-ends\u2460\u2464"}],"title":"6.1.2.1. The session.status Command"}],"url":"https://w3c.github.io/webdriver/#dfn-remote-ends"},
"36acc234": {"dfnID":"36acc234","dfnText":"capability name","external":true,"refSections":[{"refs":[{"id":"ref-for-dfn-capability-name"}],"title":"4.1. Establishing a Connection"}],"url":"https://w3c.github.io/webdriver/#dfn-capability-name"},
"36b72cc4": {"dfnID":"36b72cc4","dfnText":"create a new browsing context","external":true,"refSections":[{"refs":[{"id":"ref-for-creating-a-new-browsing-context"}],"title":"6.2.4.1. The browsingContext.contextCreated Event"}],"url":"https://html.spec.whatwg.org/#creating-a-new-browsing-context"},
"36f1b87f": {"dfnID":"36f1b87f","dfnText":"the websocket connection is closed","external":true,"refSections":[{"refs":[{"id":"ref-for-section-7.1.4"}],"title":"4. Transport"}],"url":"https://tools.ietf.org/html/rfc6455#section-7.1.4"},
"3b2ff63e": {"dfnID":"3b2ff63e","dfnText":"browsing context (for Document)","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-document-bc"},{"id":"ref-for-concept-document-bc\u2460"}],"title":"4. Transport"},{"refs":[{"id":"ref-for-concept-document-bc\u2461"}],"title":"6.3.4.1. The script.realmCreated Event"},{"refs":[{"id":"ref-for-concept-document-bc\u2462"}],"title":"6.3.4.2. The script.realmDestroyed Event"}],"url":"https://html.spec.whatwg.org/multipage/document-sequences.html#concept-document-bc"},
"3b681a11": {"dfnID":"3b681a11","dfnText":"value","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-attribute-value"}],"title":"5.1. Remote Value"}],"url":"https://dom.spec.whatwg.org/#concept-attribute-value"},
"3e12e042": {"dfnID":"3e12e042","dfnText":"environment settings object","external":true,"refSections":[{"refs":[{"id":"ref-for-environment-settings-object"}],"title":"6.3.3.1. The script.getRealms Command"},{"refs":[{"id":"ref-for-environment-settings-object\u2460"},{"id":"ref-for-environment-settings-object\u2461"}],"title":"6.3.4.1. The script.realmCreated Event"},{"refs":[{"id":"ref-for-environment-settings-object\u2462"},{"id":"ref-for-environment-settings-object\u2463"}],"title":"6.3.4.2. The script.realmDestroyed Event"}],"url":"https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object"},
"3fca5a9e": {"dfnID":"3fca5a9e","dfnText":"map","external":true,"refSections":[{"refs":[{"id":"ref-for-ordered-map"}],"title":"6.1.2.1. The session.status Command"},{"refs":[{"id":"ref-for-ordered-map\u2460"}],"title":"6.2.2.2. The browsingContext.BrowsingContextInfo Type"},{"refs":[{"id":"ref-for-ordered-map\u2461"}],"title":"6.2.3.1. The browsingContext.getTree Command"},{"refs":[{"id":"ref-for-ordered-map\u2462"}],"title":"6.2.4.1. The browsingContext.contextCreated Event"},{"refs":[{"id":"ref-for-ordered-map\u2463"}],"title":"6.2.4.2. The browsingContext.contextDestroyed Event"},{"refs":[{"id":"ref-for-ordered-map\u2464"}],"title":"6.4. Log"}],"url":"https://infra.spec.whatwg.org/#ordered-map"},
"40a66c6b": {"dfnID":"40a66c6b","dfnText":"formatting specifier","external":true,"refSections":[{"refs":[{"id":"ref-for-formatting-specifiers"}],"title":"6.4.3.1. entryAdded"}],"url":"https://console.spec.whatwg.org#formatting-specifiers"},
"4411082c": {"dfnID":"4411082c","dfnText":"unloading document cleanup steps","external":true,"refSections":[{"refs":[{"id":"ref-for-unloading-document-cleanup-steps"}],"title":"6.3.4.2. The script.realmDestroyed Event"}],"url":"https://html.spec.whatwg.org/multipage/document-lifecycle.html#unloading-document-cleanup-steps"},
"47eb8c57": {"dfnID":"47eb8c57","dfnText":"get","external":true,"refSections":[{"refs":[{"id":"ref-for-sec-get"},{"id":"ref-for-sec-get\u2460"},{"id":"ref-for-sec-get\u2461"},{"id":"ref-for-sec-get\u2462"},{"id":"ref-for-sec-get\u2463"},{"id":"ref-for-sec-get\u2464"}],"title":"5.1. Remote Value"}],"url":"https://tc39.es/ecma262/#sec-get"},
"49bb0560": {"dfnID":"49bb0560","dfnText":"active sessions","external":true,"refSections":[{"refs":[{"id":"ref-for-dfn-active-session"}],"title":"4. Transport"}],"url":"https://w3c.github.io/webdriver/#dfn-active-session"},
"4be6272b": {"dfnID":"4be6272b","dfnText":"success","external":true,"refSections":[{"refs":[{"id":"ref-for-dfn-success"},{"id":"ref-for-dfn-success\u2460"}],"title":"3.5. Events"},{"refs":[{"id":"ref-for-dfn-success\u2461"},{"id":"ref-for-dfn-success\u2462"},{"id":"ref-for-dfn-success\u2463"}],"title":"4.1. Establishing a Connection"},{"refs":[{"id":"ref-for-dfn-success\u2464"}],"title":"6.1.1. Definition"},{"refs":[{"id":"ref-for-dfn-success\u2465"}],"title":"6.1.2.1. The session.status Command"},{"refs":[{"id":"ref-for-dfn-success\u2466"}],"title":"6.1.2.2. The session.subscribe Command"},{"refs":[{"id":"ref-for-dfn-success\u2467"}],"title":"6.1.2.3. The session.unsubscribe Command"},{"refs":[{"id":"ref-for-dfn-success\u2468"},{"id":"ref-for-dfn-success\u2460\u24ea"}],"title":"6.2.2.1. The browsingContext.BrowsingContext Type"},{"refs":[{"id":"ref-for-dfn-success\u2460\u2460"}],"title":"6.2.3.1. The browsingContext.getTree Command"},{"refs":[{"id":"ref-for-dfn-success\u2460\u2461"}],"title":"6.3.3.1. The script.getRealms Command"}],"url":"https://w3c.github.io/webdriver/#dfn-success"},
"4c07280e": {"dfnID":"4c07280e","dfnText":"serialize an infra value to json bytes","external":true,"refSections":[{"refs":[{"id":"ref-for-serialize-an-infra-value-to-json-bytes"},{"id":"ref-for-serialize-an-infra-value-to-json-bytes\u2460"},{"id":"ref-for-serialize-an-infra-value-to-json-bytes\u2461"}],"title":"4. Transport"}],"url":"https://infra.spec.whatwg.org/#serialize-an-infra-value-to-json-bytes"},
"4cef69e3": {"dfnID":"4cef69e3","dfnText":"worklet global scopes","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-document-worklet-global-scopes"}],"title":"6.3.4.2. The script.realmDestroyed Event"}],"url":"https://html.spec.whatwg.org/#concept-document-worklet-global-scopes"},
"4d437809": {"dfnID":"4d437809","dfnText":"qualified name","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-attribute-qualified-name"}],"title":"5.1. Remote Value"}],"url":"https://dom.spec.whatwg.org/#concept-attribute-qualified-name"},
"4fc3ddf9": {"dfnID":"4fc3ddf9","dfnText":"session id","external":true,"refSections":[{"refs":[{"id":"ref-for-dfn-session-id"},{"id":"ref-for-dfn-session-id\u2460"}],"title":"4. Transport"}],"url":"https://w3c.github.io/webdriver/#dfn-session-id"},
"51f1a168": {"dfnID":"51f1a168","dfnText":"tostring","external":true,"refSections":[{"refs":[{"id":"ref-for-sec-tostring"},{"id":"ref-for-sec-tostring\u2460"},{"id":"ref-for-sec-tostring\u2461"}],"title":"5.1. Remote Value"},{"refs":[{"id":"ref-for-sec-tostring\u2462"}],"title":"6.4.3.1. entryAdded"}],"url":"https://tc39.es/ecma262/#sec-tostring"},
"5442ea33": {"dfnID":"5442ea33","dfnText":"url serializer","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-url-serializer"}],"title":"6.2.2.2. The browsingContext.BrowsingContextInfo Type"},{"refs":[{"id":"ref-for-concept-url-serializer\u2460"}],"title":"6.4.2.2. log.StackFrame"}],"url":"https://url.spec.whatwg.org/#concept-url-serializer"},
"5582c476": {"dfnID":"5582c476","dfnText":"current realm record","external":true,"refSections":[{"refs":[{"id":"ref-for-current-realm"}],"title":"6.4.3.1. entryAdded"}],"url":"https://tc39.es/ecma262/#current-realm"},
"5644bb38": {"dfnID":"5644bb38","dfnText":"status codes","external":true,"refSections":[{"refs":[{"id":"ref-for-section-7.4"}],"title":"4. Transport"}],"url":"https://tools.ietf.org/html/rfc6455#section-7.4"},
"5991ccfb": {"dfnID":"5991ccfb","dfnText":"relevant realm","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-relevant-realm"}],"title":"6.3.4.2. The script.realmDestroyed Event"}],"url":"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm"},
"5d64e3f2": {"dfnID":"5d64e3f2","dfnText":"set up a window environment settings object","external":true,"refSections":[{"refs":[{"id":"ref-for-set-up-a-window-environment-settings-object"}],"title":"6.3.4.1. The script.realmCreated Event"}],"url":"https://html.spec.whatwg.org/#set-up-a-window-environment-settings-object"},
"61755c00": {"dfnID":"61755c00","dfnText":"primitive value","external":true,"refSections":[{"refs":[{"id":"ref-for-sec-primitive-value"}],"title":"6.4.3.1. entryAdded"}],"url":"https://tc39.es/ecma262/#sec-primitive-value"},
"653d0848": {"dfnID":"653d0848","dfnText":"size (for map)","external":true,"refSections":[{"refs":[{"id":"ref-for-map-size"}],"title":"4. Transport"}],"url":"https://infra.spec.whatwg.org/#map-size"},
"65ad9555": {"dfnID":"65ad9555","dfnText":"thistimevalue","external":true,"refSections":[{"refs":[{"id":"ref-for-thistimevalue"}],"title":"5.1. Remote Value"}],"url":"https://tc39.es/ecma262/#thistimevalue"},
"660a1a43": {"dfnID":"660a1a43","dfnText":"window handle","external":true,"refSections":[{"refs":[{"id":"ref-for-dfn-window-handle"}],"title":"5.1. Remote Value"},{"refs":[{"id":"ref-for-dfn-window-handle\u2460"},{"id":"ref-for-dfn-window-handle\u2461"}],"title":"6.2.2.1. The browsingContext.BrowsingContext Type"}],"url":"https://w3c.github.io/webdriver/#dfn-window-handle"},
"6728fdee": {"dfnID":"6728fdee","dfnText":"platform object","external":true,"refSections":[{"refs":[{"id":"ref-for-dfn-platform-object"},{"id":"ref-for-dfn-platform-object\u2460"},{"id":"ref-for-dfn-platform-object\u2461"}],"title":"5.1. Remote Value"}],"url":"https://webidl.spec.whatwg.org/#dfn-platform-object"},
"6877d20b": {"dfnID":"6877d20b","dfnText":"a browsing context is discarded","external":true,"refSections":[{"refs":[{"id":"ref-for-a-browsing-context-is-discarded"}],"title":"7.1. HTML"}],"url":"https://html.spec.whatwg.org/#a-browsing-context-is-discarded"},
"697965b2": {"dfnID":"697965b2","dfnText":"connection","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-connection"},{"id":"ref-for-concept-connection\u2460"}],"title":"4. Transport"}],"url":"https://fetch.spec.whatwg.org/#concept-connection"},
"6b7fd43d": {"dfnID":"6b7fd43d","dfnText":"PaintWorkletGlobalScope","external":true,"refSections":[{"refs":[{"id":"ref-for-paintworkletglobalscope"}],"title":"6.3.2.2. The script.RealmInfo type"}],"url":"https://drafts.css-houdini.org/css-paint-api-1/#paintworkletglobalscope"},
"6f49634d": {"dfnID":"6f49634d","dfnText":"worker event loop","external":true,"refSections":[{"refs":[{"id":"ref-for-worker-event-loop-2"}],"title":"6.3.4.2. The script.realmDestroyed Event"}],"url":"https://html.spec.whatwg.org/#worker-event-loop-2"},
"704f9119": {"dfnID":"704f9119","dfnText":"realm","external":true,"refSections":[{"refs":[{"id":"ref-for-sec-code-realms"}],"title":"6.3.2.1. The script.Realm type"},{"refs":[{"id":"ref-for-sec-code-realms\u2460"}],"title":"6.3.3.1. The script.getRealms Command"}],"url":"https://tc39.es/ecma262/#sec-code-realms"},
"7162eb1a": {"dfnID":"7162eb1a","dfnText":"%x1 denotes a text frame","external":true,"refSections":[{"refs":[{"id":"ref-for-section-5.2"}],"title":"4. Transport"}],"url":"https://tools.ietf.org/html/rfc6455#section-5.2"},
"762869d3": {"dfnID":"762869d3","dfnText":"scalar value string","external":true,"refSections":[{"refs":[{"id":"ref-for-scalar-value-string"}],"title":"4. Transport"}],"url":"https://infra.spec.whatwg.org/#scalar-value-string"},
"77211728": {"dfnID":"77211728","dfnText":"attribute list","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-element-attribute"}],"title":"5.1. Remote Value"}],"url":"https://dom.spec.whatwg.org/#concept-element-attribute"},
"7728ef75": {"dfnID":"7728ef75","dfnText":"ispromise","external":true,"refSections":[{"refs":[{"id":"ref-for-sec-ispromise"}],"title":"5.1. Remote Value"}],"url":"https://tc39.es/ecma262/#sec-ispromise"},
"77b4c09a": {"dfnID":"77b4c09a","dfnText":"assert","external":true,"refSections":[{"refs":[{"id":"ref-for-assert"},{"id":"ref-for-assert\u2460"}],"title":"4. Transport"},{"refs":[{"id":"ref-for-assert\u2461"}],"title":"4.1. Establishing a Connection"},{"refs":[{"id":"ref-for-assert\u2462"}],"title":"5.1. Remote Value"}],"url":"https://infra.spec.whatwg.org/#assert"},
"79d221ec": {"dfnID":"79d221ec","dfnText":"session","external":true,"refSections":[{"refs":[{"id":"ref-for-dfn-sessions"}],"title":"3.2. Session"},{"refs":[{"id":"ref-for-dfn-sessions\u2460"},{"id":"ref-for-dfn-sessions\u2461"}],"title":"3.5. Events"},{"refs":[{"id":"ref-for-dfn-sessions\u2462"},{"id":"ref-for-dfn-sessions\u2463"},{"id":"ref-for-dfn-sessions\u2464"},{"id":"ref-for-dfn-sessions\u2465"},{"id":"ref-for-dfn-sessions\u2466"},{"id":"ref-for-dfn-sessions\u2467"},{"id":"ref-for-dfn-sessions\u2468"},{"id":"ref-for-dfn-sessions\u2460\u24ea"}],"title":"4. Transport"},{"refs":[{"id":"ref-for-dfn-sessions\u2460\u2460"}],"title":"5.1. Remote Value"},{"refs":[{"id":"ref-for-dfn-sessions\u2460\u2461"}],"title":"6.4. Log"}],"url":"https://w3c.github.io/webdriver/#dfn-sessions"},
"7b1760b0": {"dfnID":"7b1760b0","dfnText":"console","external":true,"refSections":[{"refs":[{"id":"ref-for-namespacedef-console"}],"title":"7.2. Console"}],"url":"https://console.spec.whatwg.org/#namespacedef-console"},
"7ef0edbd": {"dfnID":"7ef0edbd","dfnText":"enumerableownpropertynames","external":true,"refSections":[{"refs":[{"id":"ref-for-sec-enumerableownpropertynames"}],"title":"5.1. Remote Value"}],"url":"https://tc39.es/ecma262/#sec-enumerableownpropertynames"},
"7fdc1cbb": {"dfnID":"7fdc1cbb","dfnText":"websocket uri","external":true,"refSections":[{"refs":[{"id":"ref-for-section-3"}],"title":"4. Transport"}],"url":"https://tools.ietf.org/html/rfc6455#section-3"},
"814d830a": {"dfnID":"814d830a","dfnText":"getting a property","external":true,"refSections":[{"refs":[{"id":"ref-for-dfn-get-a-property"}],"title":"4.1. Establishing a Connection"}],"url":"https://w3c.github.io/webdriver/#dfn-get-a-property"},
"82c23298": {"dfnID":"82c23298","dfnText":"remote end steps","external":true,"refSections":[{"refs":[{"id":"ref-for-dfn-remote-end-steps"}],"title":"3.4. Commands"},{"refs":[{"id":"ref-for-dfn-remote-end-steps\u2460"}],"title":"4. Transport"},{"refs":[{"id":"ref-for-dfn-remote-end-steps\u2461"}],"title":"6.1.2.1. The session.status Command"},{"refs":[{"id":"ref-for-dfn-remote-end-steps\u2462"}],"title":"6.1.2.2. The session.subscribe Command"},{"refs":[{"id":"ref-for-dfn-remote-end-steps\u2463"}],"title":"6.1.2.3. The session.unsubscribe Command"},{"refs":[{"id":"ref-for-dfn-remote-end-steps\u2464"}],"title":"6.2.3.1. The browsingContext.getTree Command"},{"refs":[{"id":"ref-for-dfn-remote-end-steps\u2465"}],"title":"6.3.3.1. The script.getRealms Command"}],"url":"https://w3c.github.io/webdriver/#dfn-remote-end-steps"},
"83c59a3a": {"dfnID":"83c59a3a","dfnText":"WorkerGlobalScope","external":true,"refSections":[{"refs":[{"id":"ref-for-workerglobalscope"}],"title":"4. Transport"},{"refs":[{"id":"ref-for-workerglobalscope\u2460"},{"id":"ref-for-workerglobalscope\u2461"}],"title":"6.3.2.2. The script.RealmInfo type"},{"refs":[{"id":"ref-for-workerglobalscope\u2462"}],"title":"6.3.3.1. The script.getRealms Command"}],"url":"https://html.spec.whatwg.org/multipage/workers.html#workerglobalscope"},
"85394472": {"dfnID":"85394472","dfnText":"Document","external":true,"refSections":[{"refs":[{"id":"ref-for-document"}],"title":"7.1. HTML"}],"url":"https://dom.spec.whatwg.org/#document"},
"860300d4": {"dfnID":"860300d4","dfnText":"implementation-defined","external":true,"refSections":[{"refs":[{"id":"ref-for-implementation-defined"}],"title":"4. Transport"}],"url":"https://infra.spec.whatwg.org/#implementation-defined"},
"86d2a717": {"dfnID":"86d2a717","dfnText":"ServiceWorkerGlobalScope","external":true,"refSections":[{"refs":[{"id":"ref-for-serviceworkerglobalscope"}],"title":"6.3.2.2. The script.RealmInfo type"}],"url":"https://w3c.github.io/ServiceWorker/#serviceworkerglobalscope"},
"8b8836ef": {"dfnID":"8b8836ef","dfnText":"unknown command","external":true,"refSections":[{"refs":[{"id":"ref-for-dfn-unknown-command"}],"title":"4. Transport"}],"url":"https://w3c.github.io/webdriver/#dfn-unknown-command"},
"8da4d1e3": {"dfnID":"8da4d1e3","dfnText":"invalid argument","external":true,"refSections":[{"refs":[{"id":"ref-for-dfn-invalid-argument"},{"id":"ref-for-dfn-invalid-argument\u2460"}],"title":"3.5. Events"},{"refs":[{"id":"ref-for-dfn-invalid-argument\u2461"},{"id":"ref-for-dfn-invalid-argument\u2462"},{"id":"ref-for-dfn-invalid-argument\u2463"}],"title":"4. Transport"},{"refs":[{"id":"ref-for-dfn-invalid-argument\u2464"}],"title":"4.1. Establishing a Connection"},{"refs":[{"id":"ref-for-dfn-invalid-argument\u2465"},{"id":"ref-for-dfn-invalid-argument\u2466"}],"title":"6.1.1. Definition"}],"url":"https://w3c.github.io/webdriver/#dfn-invalid-argument"},
"8e8decb4": {"dfnID":"8e8decb4","dfnText":"parse json into infra values","external":true,"refSections":[{"refs":[{"id":"ref-for-parse-a-json-string-to-an-infra-value"}],"title":"4. Transport"}],"url":"https://infra.spec.whatwg.org/#parse-a-json-string-to-an-infra-value"},
"8ef06ef9": {"dfnID":"8ef06ef9","dfnText":"formatter","external":true,"refSections":[{"refs":[{"id":"ref-for-formatter"}],"title":"6.4.3.1. entryAdded"}],"url":"https://console.spec.whatwg.org#formatter"},
"8f3fa597": {"dfnID":"8f3fa597","dfnText":"isarray","external":true,"refSections":[{"refs":[{"id":"ref-for-sec-isarray"},{"id":"ref-for-sec-isarray\u2460"}],"title":"5.1. Remote Value"}],"url":"https://tc39.es/ecma262/#sec-isarray"},
"8fe058df": {"dfnID":"8fe058df","dfnText":"AudioWorkletGlobalScope","external":true,"refSections":[{"refs":[{"id":"ref-for-AudioWorkletGlobalScope"}],"title":"6.3.2.2. The script.RealmInfo type"}],"url":"https://webaudio.github.io/web-audio-api/#AudioWorkletGlobalScope"},
"900ce14b": {"dfnID":"900ce14b","dfnText":"internal slot","external":true,"refSections":[{"refs":[{"id":"ref-for-sec-object-internal-methods-and-internal-slots"},{"id":"ref-for-sec-object-internal-methods-and-internal-slots\u2460"},{"id":"ref-for-sec-object-internal-methods-and-internal-slots\u2461"},{"id":"ref-for-sec-object-internal-methods-and-internal-slots\u2462"},{"id":"ref-for-sec-object-internal-methods-and-internal-slots\u2463"},{"id":"ref-for-sec-object-internal-methods-and-internal-slots\u2464"},{"id":"ref-for-sec-object-internal-methods-and-internal-slots\u2465"},{"id":"ref-for-sec-object-internal-methods-and-internal-slots\u2466"}],"title":"5.1. Remote Value"}],"url":"https://tc39.es/ecma262/#sec-object-internal-methods-and-internal-slots"},
"92b2d7da": {"dfnID":"92b2d7da","dfnText":"children","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-tree-child"},{"id":"ref-for-concept-tree-child\u2460"}],"title":"5.1. Remote Value"}],"url":"https://dom.spec.whatwg.org/#concept-tree-child"},
"93f9e904": {"dfnID":"93f9e904","dfnText":"intermediary node","external":true,"refSections":[{"refs":[{"id":"ref-for-dfn-intermediary-node"}],"title":"4. Transport"}],"url":"https://w3c.github.io/webdriver/#dfn-intermediary-node"},
"94039a0c": {"dfnID":"94039a0c","dfnText":"WindowProxy","external":true,"refSections":[{"refs":[{"id":"ref-for-windowproxy"},{"id":"ref-for-windowproxy\u2460"}],"title":"5.1. Remote Value"}],"url":"https://html.spec.whatwg.org/multipage/nav-history-apis.html#windowproxy"},
"94cf11b8": {"dfnID":"94cf11b8","dfnText":"web element reference","external":true,"refSections":[{"refs":[{"id":"ref-for-dfn-web-element-reference"}],"title":"5.1. Remote Value"}],"url":"https://w3c.github.io/webdriver/#dfn-web-element-reference"},
"95a8ae14": {"dfnID":"95a8ae14","dfnText":"window","external":true,"refSections":[{"refs":[{"id":"ref-for-window"}],"title":"6.3.2.2. The script.RealmInfo type"}],"url":"https://drafts.csswg.org/css-color-3/#window"},
"9a707b42": {"dfnID":"9a707b42","dfnText":"local end","external":true,"refSections":[{"refs":[{"id":"ref-for-dfn-local-ends"},{"id":"ref-for-dfn-local-ends\u2460"}],"title":"3. Protocol"},{"refs":[{"id":"ref-for-dfn-local-ends\u2461"},{"id":"ref-for-dfn-local-ends\u2462"},{"id":"ref-for-dfn-local-ends\u2463"},{"id":"ref-for-dfn-local-ends\u2464"},{"id":"ref-for-dfn-local-ends\u2465"},{"id":"ref-for-dfn-local-ends\u2466"}],"title":"3.4. Commands"},{"refs":[{"id":"ref-for-dfn-local-ends\u2467"}],"title":"3.5. Events"},{"refs":[{"id":"ref-for-dfn-local-ends\u2468"},{"id":"ref-for-dfn-local-ends\u2460\u24ea"}],"title":"4. Transport"}],"url":"https://w3c.github.io/webdriver/#dfn-local-ends"},
"a0f3a43b": {"dfnID":"a0f3a43b","dfnText":"fail the websocket connection","external":true,"refSections":[{"refs":[{"id":"ref-for-section-7.1.7"}],"title":"4. Transport"}],"url":"https://tools.ietf.org/html/rfc6455#section-7.1.7"},
"a192e236": {"dfnID":"a192e236","dfnText":"matched capability serialization algorithm","external":true,"refSections":[{"refs":[{"id":"ref-for-dfn-matched-capability-serialization-algorithm"}],"title":"4.1. Establishing a Connection"}],"url":"https://w3c.github.io/webdriver/#dfn-matched-capability-serialization-algorithm"},
"a3b18719": {"dfnID":"a3b18719","dfnText":"append","external":true,"refSections":[{"refs":[{"id":"ref-for-set-append"}],"title":"4. Transport"}],"url":"https://infra.spec.whatwg.org/#set-append"},
"a41b1317": {"dfnID":"a41b1317","dfnText":"terminate a worker","external":true,"refSections":[{"refs":[{"id":"ref-for-terminate-a-worker"}],"title":"6.3.4.2. The script.realmDestroyed Event"}],"url":"https://html.spec.whatwg.org/multipage/workers.html#terminate-a-worker"},
"a4739eca": {"dfnID":"a4739eca","dfnText":"running execution context","external":true,"refSections":[{"refs":[{"id":"ref-for-running-execution-context"}],"title":"6.4.2.2. log.StackFrame"}],"url":"https://tc39.es/ecma262/#running-execution-context"},
"a4c28706": {"dfnID":"a4c28706","dfnText":"error","external":true,"refSections":[{"refs":[{"id":"ref-for-dfn-errors"},{"id":"ref-for-dfn-errors\u2460"}],"title":"3.5. Events"},{"refs":[{"id":"ref-for-dfn-errors\u2461"}],"title":"4. Transport"},{"refs":[{"id":"ref-for-dfn-errors\u2462"}],"title":"4.1. Establishing a Connection"},{"refs":[{"id":"ref-for-dfn-errors\u2463"},{"id":"ref-for-dfn-errors\u2464"}],"title":"6.1.1. Definition"},{"refs":[{"id":"ref-for-dfn-errors\u2465"}],"title":"6.2.2.1. The browsingContext.BrowsingContext Type"},{"refs":[{"id":"ref-for-dfn-errors\u2466"}],"title":"6.4.3.1. entryAdded"}],"url":"https://w3c.github.io/webdriver/#dfn-errors"},
"a60df0fb": {"dfnID":"a60df0fb","dfnText":"isregexp","external":true,"refSections":[{"refs":[{"id":"ref-for-sec-isregexp"}],"title":"5.1. Remote Value"}],"url":"https://tc39.es/ecma262/#sec-isregexp"},
"a795f739": {"dfnID":"a795f739","dfnText":"webdriver new session algorithm","external":true,"refSections":[{"refs":[{"id":"ref-for-dfn-webdriver-new-session-algorithm"}],"title":"4.1. Establishing a Connection"}],"url":"https://w3c.github.io/webdriver/#dfn-webdriver-new-session-algorithm"},
"a973e0fe": {"dfnID":"a973e0fe","dfnText":"document","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-document"},{"id":"ref-for-concept-document\u2460"}],"title":"4. Transport"},{"refs":[{"id":"ref-for-concept-document\u2461"}],"title":"6.3.3.1. The script.getRealms Command"},{"refs":[{"id":"ref-for-concept-document\u2462"}],"title":"6.3.4.1. The script.realmCreated Event"}],"url":"https://dom.spec.whatwg.org/#concept-document"},
"active-listeners": {"dfnID":"active-listeners","dfnText":"active\nlisteners","external":false,"refSections":[{"refs":[{"id":"ref-for-active-listeners"},{"id":"ref-for-active-listeners\u2460"},{"id":"ref-for-active-listeners\u2461"}],"title":"4. Transport"}],"url":"#active-listeners"},
"adc2b755": {"dfnID":"adc2b755","dfnText":"the websocket closing handshake is started","external":true,"refSections":[{"refs":[{"id":"ref-for-section-7.1.3"}],"title":"4. Transport"}],"url":"https://tools.ietf.org/html/rfc6455#section-7.1.3"},
"ae2a6342": {"dfnID":"ae2a6342","dfnText":"top-level browsing context","external":true,"refSections":[{"refs":[{"id":"ref-for-top-level-browsing-context"},{"id":"ref-for-top-level-browsing-context\u2460"}],"title":"3.5. Events"},{"refs":[{"id":"ref-for-top-level-browsing-context\u2461"}],"title":"6.1.1. Definition"},{"refs":[{"id":"ref-for-top-level-browsing-context\u2462"}],"title":"6.1.2.2. The session.subscribe Command"},{"refs":[{"id":"ref-for-top-level-browsing-context\u2463"}],"title":"6.2.2.2. The browsingContext.BrowsingContextInfo Type"},{"refs":[{"id":"ref-for-top-level-browsing-context\u2464"}],"title":"6.3.4.1. The script.realmCreated Event"},{"refs":[{"id":"ref-for-top-level-browsing-context\u2465"}],"title":"6.4.3.1. entryAdded"},{"refs":[{"id":"ref-for-top-level-browsing-context\u2466"}],"title":"7.1. HTML"}],"url":"https://html.spec.whatwg.org/multipage/document-sequences.html#top-level-browsing-context"},
"ae9c1639": {"dfnID":"ae9c1639","dfnText":"current session","external":true,"refSections":[{"refs":[{"id":"ref-for-dfn-current-session"},{"id":"ref-for-dfn-current-session\u2460"},{"id":"ref-for-dfn-current-session\u2461"},{"id":"ref-for-dfn-current-session\u2462"}],"title":"4. Transport"},{"refs":[{"id":"ref-for-dfn-current-session\u2463"}],"title":"5.1. Remote Value"},{"refs":[{"id":"ref-for-dfn-current-session\u2464"}],"title":"6.1.2.2. The session.subscribe Command"},{"refs":[{"id":"ref-for-dfn-current-session\u2465"}],"title":"6.1.2.3. The session.unsubscribe Command"},{"refs":[{"id":"ref-for-dfn-current-session\u2466"}],"title":"6.2.4.2. The browsingContext.contextDestroyed Event"},{"refs":[{"id":"ref-for-dfn-current-session\u2467"}],"title":"6.4. Log"},{"refs":[{"id":"ref-for-dfn-current-session\u2468"}],"title":"6.4.3.1. entryAdded"}],"url":"https://w3c.github.io/webdriver/#dfn-current-session"},
"b44c8bda": {"dfnID":"b44c8bda","dfnText":"createlistfromarraylike","external":true,"refSections":[{"refs":[{"id":"ref-for-sec-createlistfromarraylike"}],"title":"5.1. Remote Value"}],"url":"https://tc39.es/ecma262/#sec-createlistfromarraylike"},
"b7212a68": {"dfnID":"b7212a68","dfnText":"type","external":true,"refSections":[{"refs":[{"id":"ref-for-sec-ecmascript-data-types-and-values"},{"id":"ref-for-sec-ecmascript-data-types-and-values\u2460"},{"id":"ref-for-sec-ecmascript-data-types-and-values\u2461"},{"id":"ref-for-sec-ecmascript-data-types-and-values\u2462"},{"id":"ref-for-sec-ecmascript-data-types-and-values\u2463"},{"id":"ref-for-sec-ecmascript-data-types-and-values\u2464"},{"id":"ref-for-sec-ecmascript-data-types-and-values\u2465"},{"id":"ref-for-sec-ecmascript-data-types-and-values\u2466"},{"id":"ref-for-sec-ecmascript-data-types-and-values\u2467"}],"title":"5.1. Remote Value"},{"refs":[{"id":"ref-for-sec-ecmascript-data-types-and-values\u2468"}],"title":"6.4.3.1. entryAdded"}],"url":"https://tc39.es/ecma262/#sec-ecmascript-data-types-and-values"},
"b7ad9913": {"dfnID":"b7ad9913","dfnText":"send a websocket message","external":true,"refSections":[{"refs":[{"id":"ref-for-section-6.1"},{"id":"ref-for-section-6.1\u2460"},{"id":"ref-for-section-6.1\u2461"}],"title":"4. Transport"}],"url":"https://tools.ietf.org/html/rfc6455#section-6.1"},
"b8308563": {"dfnID":"b8308563","dfnText":"DedicatedWorkerGlobalScope","external":true,"refSections":[{"refs":[{"id":"ref-for-dedicatedworkerglobalscope"}],"title":"6.3.2.2. The script.RealmInfo type"}],"url":"https://html.spec.whatwg.org/multipage/workers.html#dedicatedworkerglobalscope"},
"bba0f383": {"dfnID":"bba0f383","dfnText":"time value","external":true,"refSections":[{"refs":[{"id":"ref-for-sec-time-values-and-time-range"}],"title":"6.4.3.1. entryAdded"}],"url":"https://tc39.es/ecma262/#sec-time-values-and-time-range"},
"browsing-context-id": {"dfnID":"browsing-context-id","dfnText":"browsing context\nid","external":false,"refSections":[{"refs":[{"id":"ref-for-browsing-context-id"},{"id":"ref-for-browsing-context-id\u2460"}],"title":"6.2.2.1. The browsingContext.BrowsingContext Type"},{"refs":[{"id":"ref-for-browsing-context-id\u2461"},{"id":"ref-for-browsing-context-id\u2462"}],"title":"6.2.2.2. The browsingContext.BrowsingContextInfo Type"},{"refs":[{"id":"ref-for-browsing-context-id\u2463"},{"id":"ref-for-browsing-context-id\u2464"}],"title":"6.4. Log"}],"url":"#browsing-context-id"},
"browsing-context-tree-discarded": {"dfnID":"browsing-context-tree-discarded","dfnText":"browsing context\n  tree discarded","external":false,"refSections":[{"refs":[{"id":"ref-for-browsing-context-tree-discarded"}],"title":"6.2.4.2. The browsingContext.contextDestroyed Event"}],"url":"#browsing-context-tree-discarded"},
"buffer-a-log-event": {"dfnID":"buffer-a-log-event","dfnText":"buffer a log event","external":false,"refSections":[{"refs":[{"id":"ref-for-buffer-a-log-event"}],"title":"6.4.3.1. entryAdded"}],"url":"#buffer-a-log-event"},
"c8ff8493": {"dfnID":"c8ff8493","dfnText":"error code","external":true,"refSections":[{"refs":[{"id":"ref-for-dfn-error-code"},{"id":"ref-for-dfn-error-code\u2460"}],"title":"3.5. Events"},{"refs":[{"id":"ref-for-dfn-error-code\u2461"}],"title":"4. Transport"},{"refs":[{"id":"ref-for-dfn-error-code\u2462"}],"title":"4.1. Establishing a Connection"},{"refs":[{"id":"ref-for-dfn-error-code\u2463"},{"id":"ref-for-dfn-error-code\u2464"}],"title":"6.1.1. Definition"},{"refs":[{"id":"ref-for-dfn-error-code\u2465"}],"title":"6.2.2.1. The browsingContext.BrowsingContext Type"}],"url":"https://w3c.github.io/webdriver/#dfn-error-code"},
"c96bc515": {"dfnID":"c96bc515","dfnText":"environment settings object's realm","external":true,"refSections":[{"refs":[{"id":"ref-for-environment-settings-object's-realm"}],"title":"6.3.4.2. The script.realmDestroyed Event"}],"url":"https://html.spec.whatwg.org/#environment-settings-object's-realm"},
"cb9acc83": {"dfnID":"cb9acc83","dfnText":"set a property","external":true,"refSections":[{"refs":[{"id":"ref-for-dfn-set-a-property"}],"title":"4.1. Establishing a Connection"}],"url":"https://w3c.github.io/webdriver/#dfn-set-a-property"},
"ce15d5dc": {"dfnID":"ce15d5dc","dfnText":"realm execution context","external":true,"refSections":[{"refs":[{"id":"ref-for-realm-execution-context"}],"title":"6.3.2.2. The script.RealmInfo type"},{"refs":[{"id":"ref-for-realm-execution-context\u2460"}],"title":"6.3.4.2. The script.realmDestroyed Event"}],"url":"https://html.spec.whatwg.org/multipage/webappapis.html#realm-execution-context"},
"ce720392": {"dfnID":"ce720392","dfnText":"shadow root","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-element-shadow-root"}],"title":"5.1. Remote Value"}],"url":"https://dom.spec.whatwg.org/#concept-element-shadow-root"},
"command": {"dfnID":"command","dfnText":"command","external":false,"refSections":[{"refs":[{"id":"ref-for-command"},{"id":"ref-for-command\u2460"},{"id":"ref-for-command\u2461"},{"id":"ref-for-command\u2462"}],"title":"3.3. Modules"},{"refs":[{"id":"ref-for-command\u2463"}],"title":"3.4. Commands"},{"refs":[{"id":"ref-for-command\u2464"}],"title":"4. Transport"}],"url":"#command"},
"command-command-name": {"dfnID":"command-command-name","dfnText":"command\nname","external":false,"refSections":[{"refs":[{"id":"ref-for-command-command-name"}],"title":"3.3. Modules"},{"refs":[{"id":"ref-for-command-command-name\u2460"}],"title":"3.4. Commands"},{"refs":[{"id":"ref-for-command-command-name\u2461"},{"id":"ref-for-command-command-name\u2462"}],"title":"4. Transport"}],"url":"#command-command-name"},
"command-command-parameters": {"dfnID":"command-command-parameters","dfnText":"command parameters","external":false,"refSections":[{"refs":[{"id":"ref-for-command-command-parameters"}],"title":"3.4. Commands"},{"refs":[{"id":"ref-for-command-command-parameters\u2460"}],"title":"4. Transport"}],"url":"#command-command-parameters"},
"command-command-type": {"dfnID":"command-command-type","dfnText":"command type","external":false,"refSections":[],"url":"#command-command-type"},
"command-event-parameters": {"dfnID":"command-event-parameters","dfnText":"event\nparameters.","external":false,"refSections":[],"url":"#command-event-parameters"},
"command-result-type": {"dfnID":"command-result-type","dfnText":"result type","external":false,"refSections":[{"refs":[{"id":"ref-for-command-result-type"}],"title":"4. Transport"}],"url":"#command-result-type"},
"command-set-of-all-command-names": {"dfnID":"command-set-of-all-command-names","dfnText":"set of all command names","external":false,"refSections":[{"refs":[{"id":"ref-for-command-set-of-all-command-names"}],"title":"4. Transport"}],"url":"#command-set-of-all-command-names"},
"commands-browsingcontextgettree": {"dfnID":"commands-browsingcontextgettree","dfnText":"browsingContext.getTree","external":false,"refSections":[],"url":"#commands-browsingcontextgettree"},
"commands-scriptgetrealms": {"dfnID":"commands-scriptgetrealms","dfnText":"script.getRealms","external":false,"refSections":[],"url":"#commands-scriptgetrealms"},
"commands-sessionstatus": {"dfnID":"commands-sessionstatus","dfnText":"session.status","external":false,"refSections":[],"url":"#commands-sessionstatus"},
"commands-sessionsubscribe": {"dfnID":"commands-sessionsubscribe","dfnText":"session.subscribe","external":false,"refSections":[],"url":"#commands-sessionsubscribe"},
"commands-sessionunsubscribe": {"dfnID":"commands-sessionunsubscribe","dfnText":"session.unsubscribe","external":false,"refSections":[],"url":"#commands-sessionunsubscribe"},
"console-steps": {"dfnID":"console-steps","dfnText":"console steps","external":false,"refSections":[{"refs":[{"id":"ref-for-console-steps"}],"title":"6.4.3.1. entryAdded"},{"refs":[{"id":"ref-for-console-steps\u2460"},{"id":"ref-for-console-steps\u2461"}],"title":"7.2. Console"}],"url":"#console-steps"},
"construct-a-websocket-resource-name": {"dfnID":"construct-a-websocket-resource-name","dfnText":"construct a WebSocket resource name","external":false,"refSections":[{"refs":[{"id":"ref-for-construct-a-websocket-resource-name"},{"id":"ref-for-construct-a-websocket-resource-name\u2460"}],"title":"4. Transport"}],"url":"#construct-a-websocket-resource-name"},
"construct-a-websocket-url": {"dfnID":"construct-a-websocket-url","dfnText":"construct a WebSocket URL","external":false,"refSections":[{"refs":[{"id":"ref-for-construct-a-websocket-url"}],"title":"4.1. Establishing a Connection"}],"url":"#construct-a-websocket-url"},
"current-stack-trace": {"dfnID":"current-stack-trace","dfnText":"current stack trace","external":false,"refSections":[{"refs":[{"id":"ref-for-current-stack-trace"},{"id":"ref-for-current-stack-trace\u2460"}],"title":"6.4.3.1. entryAdded"}],"url":"#current-stack-trace"},
"d1a73969": {"dfnID":"d1a73969","dfnText":"handled","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-error-handled"}],"title":"7.1. HTML"}],"url":"https://html.spec.whatwg.org/#concept-error-handled"},
"d462b34f": {"dfnID":"d462b34f","dfnText":"node","external":true,"refSections":[{"refs":[{"id":"ref-for-boundary-point-node"}],"title":"5.1. Remote Value"}],"url":"https://dom.spec.whatwg.org/#boundary-point-node"},
"d5434eef": {"dfnID":"d5434eef","dfnText":"contains","external":true,"refSections":[{"refs":[{"id":"ref-for-header-list-contains"},{"id":"ref-for-header-list-contains\u2460"},{"id":"ref-for-header-list-contains\u2461"}],"title":"3.5. Events"},{"refs":[{"id":"ref-for-header-list-contains\u2462"},{"id":"ref-for-header-list-contains\u2463"}],"title":"4. Transport"},{"refs":[{"id":"ref-for-header-list-contains\u2464"}],"title":"6.1.1. Definition"}],"url":"https://fetch.spec.whatwg.org/#header-list-contains"},
"dae0bfde": {"dfnID":"dae0bfde","dfnText":"serialization of an origin","external":true,"refSections":[{"refs":[{"id":"ref-for-ascii-serialisation-of-an-origin"}],"title":"6.3.2.2. The script.RealmInfo type"}],"url":"https://html.spec.whatwg.org/multipage/browsers.html#ascii-serialisation-of-an-origin"},
"db0a062f": {"dfnID":"db0a062f","dfnText":"attribute","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-attribute"}],"title":"5.1. Remote Value"}],"url":"https://dom.spec.whatwg.org/#concept-attribute"},
"dc248371": {"dfnID":"dc248371","dfnText":"owner set","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-WorkerGlobalScope-owner-set"}],"title":"4. Transport"},{"refs":[{"id":"ref-for-concept-WorkerGlobalScope-owner-set\u2460"}],"title":"6.3.3.1. The script.getRealms Command"}],"url":"https://html.spec.whatwg.org/multipage/workers.html#concept-WorkerGlobalScope-owner-set"},
"dcffbccd": {"dfnID":"dcffbccd","dfnText":"url","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-url"}],"title":"6.4.2.2. log.StackFrame"}],"url":"https://url.spec.whatwg.org/#concept-url"},
"e0a96298": {"dfnID":"e0a96298","dfnText":"remove a browsing context","external":true,"refSections":[{"refs":[{"id":"ref-for-bcg-remove"}],"title":"7.1. HTML"}],"url":"https://html.spec.whatwg.org/#bcg-remove"},
"e16c05f6": {"dfnID":"e16c05f6","dfnText":"todatestring","external":true,"refSections":[{"refs":[{"id":"ref-for-sec-todatestring"}],"title":"5.1. Remote Value"}],"url":"https://tc39.es/ecma262/#sec-todatestring"},
"e3288657": {"dfnID":"e3288657","dfnText":"responsible event loop","external":true,"refSections":[{"refs":[{"id":"ref-for-responsible-event-loop"}],"title":"6.3.4.2. The script.realmDestroyed Event"}],"url":"https://html.spec.whatwg.org/multipage/webappapis.html#responsible-event-loop"},
"e4c5f264": {"dfnID":"e4c5f264","dfnText":"reading the client's opening handshake","external":true,"refSections":[{"refs":[{"id":"ref-for-section-4.2.1"}],"title":"4. Transport"}],"url":"https://tools.ietf.org/html/rfc6455#section-4.2.1"},
"e6be17f4": {"dfnID":"e6be17f4","dfnText":"report an error","external":true,"refSections":[{"refs":[{"id":"ref-for-report-the-error"}],"title":"7.1. HTML"}],"url":"https://html.spec.whatwg.org/#report-the-error"},
"e7c89135": {"dfnID":"e7c89135","dfnText":"try","external":true,"refSections":[{"refs":[{"id":"ref-for-dfn-try"},{"id":"ref-for-dfn-try\u2460"}],"title":"6.1.1. Definition"},{"refs":[{"id":"ref-for-dfn-try\u2461"}],"title":"6.1.2.2. The session.subscribe Command"},{"refs":[{"id":"ref-for-dfn-try\u2462"}],"title":"6.1.2.3. The session.unsubscribe Command"},{"refs":[{"id":"ref-for-dfn-try\u2463"}],"title":"6.2.2.2. The browsingContext.BrowsingContextInfo Type"},{"refs":[{"id":"ref-for-dfn-try\u2464"}],"title":"6.3.3.1. The script.getRealms Command"}],"url":"https://w3c.github.io/webdriver/#dfn-try"},
"ec4bb300": {"dfnID":"ec4bb300","dfnText":"createsetiterator","external":true,"refSections":[{"refs":[{"id":"ref-for-sec-createsetiterator"}],"title":"5.1. Remote Value"}],"url":"https://tc39.es/ecma262/#sec-createsetiterator"},
"ee843963": {"dfnID":"ee843963","dfnText":"endpoint node","external":true,"refSections":[{"refs":[{"id":"ref-for-dfn-endpoint-node"},{"id":"ref-for-dfn-endpoint-node\u2460"}],"title":"4. Transport"}],"url":"https://w3c.github.io/webdriver/#dfn-endpoint-node"},
"emit-a-context-created-event": {"dfnID":"emit-a-context-created-event","dfnText":"Emit a context created event","external":false,"refSections":[{"refs":[{"id":"ref-for-emit-a-context-created-event"},{"id":"ref-for-emit-a-context-created-event\u2460"}],"title":"6.2.4.1. The browsingContext.contextCreated Event"}],"url":"#emit-a-context-created-event"},
"emit-an-event": {"dfnID":"emit-an-event","dfnText":"emit an event","external":false,"refSections":[{"refs":[{"id":"ref-for-emit-an-event"}],"title":"6.2.4.1. The browsingContext.contextCreated Event"},{"refs":[{"id":"ref-for-emit-an-event\u2460"}],"title":"6.2.4.2. The browsingContext.contextDestroyed Event"},{"refs":[{"id":"ref-for-emit-an-event\u2461"},{"id":"ref-for-emit-an-event\u2462"}],"title":"6.3.4.1. The script.realmCreated Event"},{"refs":[{"id":"ref-for-emit-an-event\u2463"},{"id":"ref-for-emit-an-event\u2464"}],"title":"6.3.4.2. The script.realmDestroyed Event"},{"refs":[{"id":"ref-for-emit-an-event\u2465"},{"id":"ref-for-emit-an-event\u2466"},{"id":"ref-for-emit-an-event\u2467"}],"title":"6.4.3.1. entryAdded"}],"url":"#emit-an-event"},
"error-reporting-steps": {"dfnID":"error-reporting-steps","dfnText":"error reporting steps","external":false,"refSections":[{"refs":[{"id":"ref-for-error-reporting-steps"}],"title":"6.4.3.1. entryAdded"}],"url":"#error-reporting-steps"},
"event": {"dfnID":"event","dfnText":"event","external":false,"refSections":[{"refs":[{"id":"ref-for-event"},{"id":"ref-for-event\u2460"},{"id":"ref-for-event\u2461"}],"title":"3.3. Modules"},{"refs":[{"id":"ref-for-event\u2462"}],"title":"3.5. Events"},{"refs":[{"id":"ref-for-event\u2463"}],"title":"4. Transport"},{"refs":[{"id":"ref-for-event\u2464"},{"id":"ref-for-event\u2465"},{"id":"ref-for-event\u2466"},{"id":"ref-for-event\u2467"}],"title":"6.1.2.2. The session.subscribe Command"}],"url":"#event"},
"event-browsing-context-event-map": {"dfnID":"event-browsing-context-event-map","dfnText":"browsing context event map","external":false,"refSections":[{"refs":[{"id":"ref-for-event-browsing-context-event-map"},{"id":"ref-for-event-browsing-context-event-map\u2460"}],"title":"3.5. Events"},{"refs":[{"id":"ref-for-event-browsing-context-event-map\u2461"},{"id":"ref-for-event-browsing-context-event-map\u2462"}],"title":"6.1.1. Definition"}],"url":"#event-browsing-context-event-map"},
"event-enabled-browsing-contexts": {"dfnID":"event-enabled-browsing-contexts","dfnText":"event enabled browsing contexts","external":false,"refSections":[{"refs":[{"id":"ref-for-event-enabled-browsing-contexts"}],"title":"6.1.1. Definition"}],"url":"#event-enabled-browsing-contexts"},
"event-event-name": {"dfnID":"event-event-name","dfnText":"event\nname","external":false,"refSections":[{"refs":[{"id":"ref-for-event-event-name"}],"title":"3.3. Modules"},{"refs":[{"id":"ref-for-event-event-name\u2460"},{"id":"ref-for-event-event-name\u2461"},{"id":"ref-for-event-event-name\u2462"},{"id":"ref-for-event-event-name\u2463"}],"title":"3.5. Events"},{"refs":[{"id":"ref-for-event-event-name\u2464"},{"id":"ref-for-event-event-name\u2465"}],"title":"6.1.2.2. The session.subscribe Command"}],"url":"#event-event-name"},
"event-event-type": {"dfnID":"event-event-type","dfnText":"event type","external":false,"refSections":[{"refs":[{"id":"ref-for-event-event-type"}],"title":"3.5. Events"}],"url":"#event-event-type"},
"event-global-event-set": {"dfnID":"event-global-event-set","dfnText":"global event set","external":false,"refSections":[{"refs":[{"id":"ref-for-event-global-event-set"}],"title":"3.5. Events"},{"refs":[{"id":"ref-for-event-global-event-set\u2460"},{"id":"ref-for-event-global-event-set\u2461"}],"title":"6.1.1. Definition"}],"url":"#event-global-event-set"},
"event-in-the-default-event-set": {"dfnID":"event-in-the-default-event-set","dfnText":"in the default event set","external":false,"refSections":[],"url":"#event-in-the-default-event-set"},
"event-is-enabled": {"dfnID":"event-is-enabled","dfnText":"event is enabled","external":false,"refSections":[{"refs":[{"id":"ref-for-event-is-enabled"}],"title":"4. Transport"}],"url":"#event-is-enabled"},
"extension-modules": {"dfnID":"extension-modules","dfnText":"extension modules","external":false,"refSections":[{"refs":[{"id":"ref-for-extension-modules"}],"title":"3.4. Commands"}],"url":"#extension-modules"},
"f1eccc95": {"dfnID":"f1eccc95","dfnText":"settings object","external":true,"refSections":[{"refs":[{"id":"ref-for-settings-object"}],"title":"4. Transport"},{"refs":[{"id":"ref-for-settings-object\u2460"}],"title":"6.4.3.1. entryAdded"}],"url":"https://html.spec.whatwg.org/multipage/webappapis.html#settings-object"},
"f5265332": {"dfnID":"f5265332","dfnText":"execution ready flag","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-environment-execution-ready-flag"}],"title":"6.3.3.1. The script.getRealms Command"},{"refs":[{"id":"ref-for-concept-environment-execution-ready-flag\u2460"}],"title":"6.3.4.1. The script.realmCreated Event"}],"url":"https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-execution-ready-flag"},
"f937b7b6": {"dfnID":"f937b7b6","dfnText":"continue","external":true,"refSections":[{"refs":[{"id":"ref-for-iteration-continue"}],"title":"6.3.3.1. The script.getRealms Command"}],"url":"https://infra.spec.whatwg.org/#iteration-continue"},
"fe28f7a2": {"dfnID":"fe28f7a2","dfnText":"sort in ascending order","external":true,"refSections":[{"refs":[{"id":"ref-for-map-sort-in-ascending-order"}],"title":"6.1.2.2. The session.subscribe Command"}],"url":"https://infra.spec.whatwg.org/#map-sort-in-ascending-order"},
"get-a-browsing-context": {"dfnID":"get-a-browsing-context","dfnText":"get a browsing context","external":false,"refSections":[{"refs":[{"id":"ref-for-get-a-browsing-context"}],"title":"6.1.1. Definition"},{"refs":[{"id":"ref-for-get-a-browsing-context\u2460"}],"title":"6.2.2.2. The browsingContext.BrowsingContextInfo Type"},{"refs":[{"id":"ref-for-get-a-browsing-context\u2461"}],"title":"6.3.3.1. The script.getRealms Command"},{"refs":[{"id":"ref-for-get-a-browsing-context\u2462"}],"title":"6.4.3.1. entryAdded"}],"url":"#get-a-browsing-context"},
"get-a-session-id-for-a-websocket-resource": {"dfnID":"get-a-session-id-for-a-websocket-resource","dfnText":"get a session ID for a WebSocket resource","external":false,"refSections":[{"refs":[{"id":"ref-for-get-a-session-id-for-a-websocket-resource"}],"title":"4. Transport"}],"url":"#get-a-session-id-for-a-websocket-resource"},
"get-related-browsing-contexts": {"dfnID":"get-related-browsing-contexts","dfnText":"get related browsing contexts","external":false,"refSections":[{"refs":[{"id":"ref-for-get-related-browsing-contexts"}],"title":"6.3.4.1. The script.realmCreated Event"},{"refs":[{"id":"ref-for-get-related-browsing-contexts\u2460"}],"title":"6.3.4.2. The script.realmDestroyed Event"},{"refs":[{"id":"ref-for-get-related-browsing-contexts\u2461"},{"id":"ref-for-get-related-browsing-contexts\u2462"}],"title":"6.4.3.1. entryAdded"}],"url":"#get-related-browsing-contexts"},
"get-the-browsing-context-info": {"dfnID":"get-the-browsing-context-info","dfnText":"get the browsing context info","external":false,"refSections":[{"refs":[{"id":"ref-for-get-the-browsing-context-info"}],"title":"6.2.2.2. The browsingContext.BrowsingContextInfo Type"},{"refs":[{"id":"ref-for-get-the-browsing-context-info\u2460"}],"title":"6.2.4.1. The browsingContext.contextCreated Event"},{"refs":[{"id":"ref-for-get-the-browsing-context-info\u2461"}],"title":"6.2.4.2. The browsingContext.contextDestroyed Event"}],"url":"#get-the-browsing-context-info"},
"get-the-descendent-browsing-contexts": {"dfnID":"get-the-descendent-browsing-contexts","dfnText":"get the descendent browsing contexts","external":false,"refSections":[{"refs":[{"id":"ref-for-get-the-descendent-browsing-contexts"}],"title":"6.2.2.2. The browsingContext.BrowsingContextInfo Type"},{"refs":[{"id":"ref-for-get-the-descendent-browsing-contexts\u2460"}],"title":"6.2.3.1. The browsingContext.getTree Command"}],"url":"#get-the-descendent-browsing-contexts"},
"get-the-realm-info": {"dfnID":"get-the-realm-info","dfnText":"get the realm info","external":false,"refSections":[{"refs":[{"id":"ref-for-get-the-realm-info"}],"title":"6.3.3.1. The script.getRealms Command"},{"refs":[{"id":"ref-for-get-the-realm-info\u2460"},{"id":"ref-for-get-the-realm-info\u2461"}],"title":"6.3.4.1. The script.realmCreated Event"}],"url":"#get-the-realm-info"},
"handle-a-connection-closing": {"dfnID":"handle-a-connection-closing","dfnText":"handle a connection closing","external":false,"refSections":[{"refs":[{"id":"ref-for-handle-a-connection-closing"}],"title":"4. Transport"}],"url":"#handle-a-connection-closing"},
"handle-an-incoming-message": {"dfnID":"handle-an-incoming-message","dfnText":"handle an incoming message","external":false,"refSections":[{"refs":[{"id":"ref-for-handle-an-incoming-message"}],"title":"4. Transport"}],"url":"#handle-an-incoming-message"},
"list-of-websocket-resources": {"dfnID":"list-of-websocket-resources","dfnText":"list of WebSocket resources","external":false,"refSections":[{"refs":[{"id":"ref-for-list-of-websocket-resources"},{"id":"ref-for-list-of-websocket-resources\u2460"},{"id":"ref-for-list-of-websocket-resources\u2461"}],"title":"4. Transport"}],"url":"#list-of-websocket-resources"},
"listener-host": {"dfnID":"listener-host","dfnText":"host","external":false,"refSections":[{"refs":[{"id":"ref-for-listener-host"},{"id":"ref-for-listener-host\u2460"},{"id":"ref-for-listener-host\u2461"},{"id":"ref-for-listener-host\u2462"}],"title":"4. Transport"}],"url":"#listener-host"},
"listener-port": {"dfnID":"listener-port","dfnText":"port","external":false,"refSections":[{"refs":[{"id":"ref-for-listener-port"},{"id":"ref-for-listener-port\u2460"},{"id":"ref-for-listener-port\u2461"}],"title":"4. Transport"}],"url":"#listener-port"},
"listener-secure-flag": {"dfnID":"listener-secure-flag","dfnText":"secure flag","external":false,"refSections":[{"refs":[{"id":"ref-for-listener-secure-flag"},{"id":"ref-for-listener-secure-flag\u2460"},{"id":"ref-for-listener-secure-flag\u2461"}],"title":"4. Transport"}],"url":"#listener-secure-flag"},
"local-end-definition": {"dfnID":"local-end-definition","dfnText":"local end\ndefinition","external":false,"refSections":[{"refs":[{"id":"ref-for-local-end-definition"},{"id":"ref-for-local-end-definition\u2460"}],"title":"3.1. Definition"},{"refs":[{"id":"ref-for-local-end-definition\u2461"},{"id":"ref-for-local-end-definition\u2462"},{"id":"ref-for-local-end-definition\u2463"}],"title":"3.3. Modules"},{"refs":[{"id":"ref-for-local-end-definition\u2464"}],"title":"3.4. Commands"},{"refs":[{"id":"ref-for-local-end-definition\u2465"}],"title":"3.5. Events"},{"refs":[{"id":"ref-for-local-end-definition\u2466"},{"id":"ref-for-local-end-definition\u2467"}],"title":"4. Transport"},{"refs":[{"id":"ref-for-local-end-definition\u2468"},{"id":"ref-for-local-end-definition\u2460\u24ea"},{"id":"ref-for-local-end-definition\u2460\u2460"},{"id":"ref-for-local-end-definition\u2460\u2461"},{"id":"ref-for-local-end-definition\u2460\u2462"},{"id":"ref-for-local-end-definition\u2460\u2463"},{"id":"ref-for-local-end-definition\u2460\u2464"},{"id":"ref-for-local-end-definition\u2460\u2465"},{"id":"ref-for-local-end-definition\u2460\u2466"},{"id":"ref-for-local-end-definition\u2460\u2467"},{"id":"ref-for-local-end-definition\u2460\u2468"},{"id":"ref-for-local-end-definition\u2461\u24ea"},{"id":"ref-for-local-end-definition\u2461\u2460"},{"id":"ref-for-local-end-definition\u2461\u2461"},{"id":"ref-for-local-end-definition\u2461\u2462"},{"id":"ref-for-local-end-definition\u2461\u2463"},{"id":"ref-for-local-end-definition\u2461\u2464"},{"id":"ref-for-local-end-definition\u2461\u2465"},{"id":"ref-for-local-end-definition\u2461\u2466"},{"id":"ref-for-local-end-definition\u2461\u2467"},{"id":"ref-for-local-end-definition\u2461\u2468"},{"id":"ref-for-local-end-definition\u2462\u24ea"},{"id":"ref-for-local-end-definition\u2462\u2460"},{"id":"ref-for-local-end-definition\u2462\u2461"}],"title":"5.1. Remote Value"},{"refs":[{"id":"ref-for-local-end-definition\u2462\u2462"}],"title":"6.1.1. Definition"},{"refs":[{"id":"ref-for-local-end-definition\u2462\u2463"}],"title":"6.2.1. Definition"},{"refs":[{"id":"ref-for-local-end-definition\u2462\u2464"}],"title":"6.2.2.1. The browsingContext.BrowsingContext Type"},{"refs":[{"id":"ref-for-local-end-definition\u2462\u2465"}],"title":"6.2.2.2. The browsingContext.BrowsingContextInfo Type"},{"refs":[{"id":"ref-for-local-end-definition\u2462\u2466"}],"title":"6.3.1. Definition"},{"refs":[{"id":"ref-for-local-end-definition\u2462\u2467"}],"title":"6.3.2.1. The script.Realm type"},{"refs":[{"id":"ref-for-local-end-definition\u2462\u2468"}],"title":"6.3.2.2. The script.RealmInfo type"}],"url":"#local-end-definition"},
"log-event-buffer": {"dfnID":"log-event-buffer","dfnText":"log event buffer","external":false,"refSections":[{"refs":[{"id":"ref-for-log-event-buffer"}],"title":"6.4. Log"},{"refs":[{"id":"ref-for-log-event-buffer\u2460"},{"id":"ref-for-log-event-buffer\u2461"},{"id":"ref-for-log-event-buffer\u2462"},{"id":"ref-for-log-event-buffer\u2463"},{"id":"ref-for-log-event-buffer\u2464"}],"title":"6.4.3.1. entryAdded"}],"url":"#log-event-buffer"},
"module": {"dfnID":"module","dfnText":"module","external":false,"refSections":[],"url":"#module"},
"module-name": {"dfnID":"module-name","dfnText":"module name","external":false,"refSections":[{"refs":[{"id":"ref-for-module-name"},{"id":"ref-for-module-name\u2460"}],"title":"3.3. Modules"},{"refs":[{"id":"ref-for-module-name\u2461"}],"title":"3.5. Events"}],"url":"#module-name"},
"modules-browsingcontext": {"dfnID":"modules-browsingcontext","dfnText":"browsingContext","external":false,"refSections":[],"url":"#modules-browsingcontext"},
"modules-log": {"dfnID":"modules-log","dfnText":"log","external":false,"refSections":[],"url":"#modules-log"},
"modules-script": {"dfnID":"modules-script","dfnText":"script","external":false,"refSections":[],"url":"#modules-script"},
"modules-session": {"dfnID":"modules-session","dfnText":"session","external":false,"refSections":[],"url":"#modules-session"},
"object-id-for-an-object": {"dfnID":"object-id-for-an-object","dfnText":"object id for an object","external":false,"refSections":[{"refs":[{"id":"ref-for-object-id-for-an-object"},{"id":"ref-for-object-id-for-an-object\u2460"},{"id":"ref-for-object-id-for-an-object\u2461"},{"id":"ref-for-object-id-for-an-object\u2462"},{"id":"ref-for-object-id-for-an-object\u2463"},{"id":"ref-for-object-id-for-an-object\u2464"},{"id":"ref-for-object-id-for-an-object\u2465"},{"id":"ref-for-object-id-for-an-object\u2466"},{"id":"ref-for-object-id-for-an-object\u2467"},{"id":"ref-for-object-id-for-an-object\u2468"},{"id":"ref-for-object-id-for-an-object\u2460\u24ea"},{"id":"ref-for-object-id-for-an-object\u2460\u2460"},{"id":"ref-for-object-id-for-an-object\u2460\u2461"},{"id":"ref-for-object-id-for-an-object\u2460\u2462"},{"id":"ref-for-object-id-for-an-object\u2460\u2463"},{"id":"ref-for-object-id-for-an-object\u2460\u2464"},{"id":"ref-for-object-id-for-an-object\u2460\u2465"}],"title":"5.1. Remote Value"}],"url":"#object-id-for-an-object"},
"object-id-map": {"dfnID":"object-id-map","dfnText":"object id map","external":false,"refSections":[{"refs":[{"id":"ref-for-object-id-map"},{"id":"ref-for-object-id-map\u2460"},{"id":"ref-for-object-id-map\u2461"}],"title":"5.1. Remote Value"}],"url":"#object-id-map"},
"obtain-a-set-of-event-names": {"dfnID":"obtain-a-set-of-event-names","dfnText":"obtain a set of event names","external":false,"refSections":[{"refs":[{"id":"ref-for-obtain-a-set-of-event-names"}],"title":"6.1.1. Definition"}],"url":"#obtain-a-set-of-event-names"},
"realm-id": {"dfnID":"realm-id","dfnText":"realm id","external":false,"refSections":[{"refs":[{"id":"ref-for-realm-id"}],"title":"6.3.2.2. The script.RealmInfo type"},{"refs":[{"id":"ref-for-realm-id\u2460"},{"id":"ref-for-realm-id\u2461"},{"id":"ref-for-realm-id\u2462"}],"title":"6.3.4.2. The script.realmDestroyed Event"},{"refs":[{"id":"ref-for-realm-id\u2463"}],"title":"6.4.3.1. entryAdded"}],"url":"#realm-id"},
"recursively-emit-context-created-events": {"dfnID":"recursively-emit-context-created-events","dfnText":"Recursively emit context created events","external":false,"refSections":[{"refs":[{"id":"ref-for-recursively-emit-context-created-events"},{"id":"ref-for-recursively-emit-context-created-events\u2460"}],"title":"6.2.4.1. The browsingContext.contextCreated Event"}],"url":"#recursively-emit-context-created-events"},
"remote-end-definition": {"dfnID":"remote-end-definition","dfnText":"remote end definition","external":false,"refSections":[{"refs":[{"id":"ref-for-remote-end-definition"},{"id":"ref-for-remote-end-definition\u2460"}],"title":"3.1. Definition"},{"refs":[{"id":"ref-for-remote-end-definition\u2461"},{"id":"ref-for-remote-end-definition\u2462"}],"title":"3.3. Modules"},{"refs":[{"id":"ref-for-remote-end-definition\u2463"}],"title":"3.4. Commands"},{"refs":[{"id":"ref-for-remote-end-definition\u2464"}],"title":"4. Transport"},{"refs":[{"id":"ref-for-remote-end-definition\u2465"}],"title":"5.1. Remote Value"},{"refs":[{"id":"ref-for-remote-end-definition\u2466"}],"title":"6.1.1. Definition"},{"refs":[{"id":"ref-for-remote-end-definition\u2467"}],"title":"6.2.1. Definition"},{"refs":[{"id":"ref-for-remote-end-definition\u2468"}],"title":"6.2.2.1. The browsingContext.BrowsingContext Type"},{"refs":[{"id":"ref-for-remote-end-definition\u2460\u24ea"}],"title":"6.3.1. Definition"},{"refs":[{"id":"ref-for-remote-end-definition\u2460\u2460"}],"title":"6.3.2.1. The script.Realm type"},{"refs":[{"id":"ref-for-remote-end-definition\u2460\u2461"}],"title":"6.4.1. Definition"}],"url":"#remote-end-definition"},
"remote-end-event-trigger": {"dfnID":"remote-end-event-trigger","dfnText":"remote end event trigger","external":false,"refSections":[{"refs":[{"id":"ref-for-remote-end-event-trigger"}],"title":"6.2.4.1. The browsingContext.contextCreated Event"},{"refs":[{"id":"ref-for-remote-end-event-trigger\u2460"}],"title":"6.2.4.2. The browsingContext.contextDestroyed Event"},{"refs":[{"id":"ref-for-remote-end-event-trigger\u2461"}],"title":"6.3.4.1. The script.realmCreated Event"},{"refs":[{"id":"ref-for-remote-end-event-trigger\u2462"}],"title":"6.3.4.2. The script.realmDestroyed Event"},{"refs":[{"id":"ref-for-remote-end-event-trigger\u2463"}],"title":"6.4.3.1. entryAdded"}],"url":"#remote-end-event-trigger"},
"remote-end-subscribe-steps": {"dfnID":"remote-end-subscribe-steps","dfnText":"remote end subscribe steps","external":false,"refSections":[{"refs":[{"id":"ref-for-remote-end-subscribe-steps"},{"id":"ref-for-remote-end-subscribe-steps\u2460"}],"title":"6.1.2.2. The session.subscribe Command"},{"refs":[{"id":"ref-for-remote-end-subscribe-steps\u2461"}],"title":"6.2.4.1. The browsingContext.contextCreated Event"},{"refs":[{"id":"ref-for-remote-end-subscribe-steps\u2462"}],"title":"6.3.4.1. The script.realmCreated Event"},{"refs":[{"id":"ref-for-remote-end-subscribe-steps\u2463"}],"title":"6.4.3.1. entryAdded"}],"url":"#remote-end-subscribe-steps"},
"respond-with-an-error": {"dfnID":"respond-with-an-error","dfnText":"respond with an error","external":false,"refSections":[{"refs":[{"id":"ref-for-respond-with-an-error"},{"id":"ref-for-respond-with-an-error\u2460"},{"id":"ref-for-respond-with-an-error\u2461"},{"id":"ref-for-respond-with-an-error\u2462"}],"title":"4. Transport"}],"url":"#respond-with-an-error"},
"serialize-as-a-list": {"dfnID":"serialize-as-a-list","dfnText":"serialize as a list","external":false,"refSections":[{"refs":[{"id":"ref-for-serialize-as-a-list"},{"id":"ref-for-serialize-as-a-list\u2460"}],"title":"5.1. Remote Value"}],"url":"#serialize-as-a-list"},
"serialize-as-a-mapping": {"dfnID":"serialize-as-a-mapping","dfnText":"serialize as a mapping","external":false,"refSections":[{"refs":[{"id":"ref-for-serialize-as-a-mapping"},{"id":"ref-for-serialize-as-a-mapping\u2460"}],"title":"5.1. Remote Value"}],"url":"#serialize-as-a-mapping"},
"serialize-as-a-remote-value": {"dfnID":"serialize-as-a-remote-value","dfnText":"serialize as a remote value","external":false,"refSections":[{"refs":[{"id":"ref-for-serialize-as-a-remote-value"},{"id":"ref-for-serialize-as-a-remote-value\u2460"},{"id":"ref-for-serialize-as-a-remote-value\u2461"},{"id":"ref-for-serialize-as-a-remote-value\u2462"},{"id":"ref-for-serialize-as-a-remote-value\u2463"}],"title":"5.1. Remote Value"},{"refs":[{"id":"ref-for-serialize-as-a-remote-value\u2464"}],"title":"6.4.3.1. entryAdded"}],"url":"#serialize-as-a-remote-value"},
"start-listening-for-a-websocket-connection": {"dfnID":"start-listening-for-a-websocket-connection","dfnText":"start listening for a WebSocket connection","external":false,"refSections":[{"refs":[{"id":"ref-for-start-listening-for-a-websocket-connection"}],"title":"4.1. Establishing a Connection"}],"url":"#start-listening-for-a-websocket-connection"},
"subscribe-priority": {"dfnID":"subscribe-priority","dfnText":"subscribe priority","external":false,"refSections":[{"refs":[{"id":"ref-for-subscribe-priority"}],"title":"6.1.2.2. The session.subscribe Command"},{"refs":[{"id":"ref-for-subscribe-priority\u2460"}],"title":"6.2.4.1. The browsingContext.contextCreated Event"},{"refs":[{"id":"ref-for-subscribe-priority\u2461"}],"title":"6.3.4.1. The script.realmCreated Event"},{"refs":[{"id":"ref-for-subscribe-priority\u2462"}],"title":"6.4.3.1. entryAdded"}],"url":"#subscribe-priority"},
"update-the-event-map": {"dfnID":"update-the-event-map","dfnText":"update the event map","external":false,"refSections":[{"refs":[{"id":"ref-for-update-the-event-map"}],"title":"6.1.2.2. The session.subscribe Command"},{"refs":[{"id":"ref-for-update-the-event-map\u2460"}],"title":"6.1.2.3. The session.unsubscribe Command"}],"url":"#update-the-event-map"},
"websocket-connection": {"dfnID":"websocket-connection","dfnText":"WebSocket connection","external":false,"refSections":[{"refs":[{"id":"ref-for-websocket-connection"},{"id":"ref-for-websocket-connection\u2460"},{"id":"ref-for-websocket-connection\u2461"},{"id":"ref-for-websocket-connection\u2462"},{"id":"ref-for-websocket-connection\u2463"},{"id":"ref-for-websocket-connection\u2464"},{"id":"ref-for-websocket-connection\u2465"},{"id":"ref-for-websocket-connection\u2466"}],"title":"4. Transport"}],"url":"#websocket-connection"},
"websocket-listener": {"dfnID":"websocket-listener","dfnText":"WebSocket listener","external":false,"refSections":[{"refs":[{"id":"ref-for-websocket-listener"},{"id":"ref-for-websocket-listener\u2460"},{"id":"ref-for-websocket-listener\u2461"},{"id":"ref-for-websocket-listener\u2462"},{"id":"ref-for-websocket-listener\u2463"},{"id":"ref-for-websocket-listener\u2464"}],"title":"4. Transport"}],"url":"#websocket-listener"},
};

document.addEventListener("DOMContentLoaded", ()=>{
    genAllDfnPanels();

    document.body.addEventListener("click", (e) => {
        // If not handled already, just hide all dfn panels.
        hideAllDfnPanels();
    });
});

window.addEventListener("resize", () => {
    // Pin any visible dfn panel
    queryAll(".dfn-panel.on, .dfn-panel.activated").forEach(el=>positionDfnPanel(el));
});

function genAllDfnPanels() {
    for(const panelData of Object.values(dfnPanelData)) {
        const dfnID = panelData.dfnID;
        const dfn = document.getElementById(dfnID);
        if(!dfn) {
            console.log(`Can't find dfn#${dfnID}.`, panelData);
            continue;
        }
        dfn.panelData = panelData;
        insertDfnPopupAction(dfn);
    }
}

function genDfnPanel(dfn, { dfnID, url, dfnText, refSections, external }) {
    const dfnPanel = mk.aside({
        class: "dfn-panel on",
        id: `infopanel-for-${dfnID}`,
        "data-for": dfnID,
        "aria-labelled-by":`infopaneltitle-for-${dfnID}`,
        },
        mk.span({id:`infopaneltitle-for-${dfnID}`, style:"display:none"},
            `Info about the '${dfnText}' ${external?"external":""} reference.`),
        mk.a({href:url, class:"dfn-link"}, url),
        refSections.length == 0 ? [] :
            mk.b({}, "Referenced in:"),
            mk.ul({},
                ...refSections.map(section=>
                    mk.li({},
                        ...section.refs.map((ref, refI)=>
                            [
                                mk.a({ href: `#${ref.id}` },
                                    (refI == 0) ? section.title : `(${refI + 1})`
                                ),
                                " ",
                            ]
                        ),
                    ),
                ),
            ),
        genLinkingSyntaxes(dfn),
    );

    dfnPanel.addEventListener('click', (event) => {
        if (event.target.nodeName == 'A') {
            scrollToTargetAndHighlight(event);
            pinDfnPanel(dfnPanel);
        }
        event.stopPropagation();
        refocusOnTarget(event);
    });
    dfnPanel.addEventListener('keydown', (event) => {
        if(event.keyCode == 27) { // Escape key
            hideDfnPanel({dfnPanel});
            event.stopPropagation();
            event.preventDefault();
        }
    });

    dfnPanel.dfn = dfn;
    dfn.dfnPanel = dfnPanel;
    return dfnPanel;
}



function hideAllDfnPanels() {
    // Delete the currently-active dfn panel.
    queryAll(".dfn-panel").forEach(dfnPanel=>hideDfnPanel({dfnPanel}));
}

function showDfnPanel(dfn) {
    hideAllDfnPanels(); // Only display one at a time.

    dfn.setAttribute("aria-expanded", "true");

    const dfnPanel = genDfnPanel(dfn, dfn.panelData);

    // Give the dfn a unique tabindex, and then
    // give all the tabbable panel bits successive indexes.
    let tabIndex = 100;
    dfn.tabIndex = tabIndex++;
    const tabbable = dfnPanel.querySelectorAll(":is(a, button)");
    for (const el of tabbable) {
        el.tabIndex = tabIndex++;
    }

    append(document.body, dfnPanel);
    positionDfnPanel(dfnPanel);
}

function positionDfnPanel(dfnPanel) {
    const dfn = dfnPanel.dfn;
    const dfnPos = getBounds(dfn);
    dfnPanel.style.top = dfnPos.bottom + "px";
    dfnPanel.style.left = dfnPos.left + "px";

    const panelPos = dfnPanel.getBoundingClientRect();
    const panelMargin = 8;
    const maxRight = document.body.parentNode.clientWidth - panelMargin;
    if (panelPos.right > maxRight) {
        const overflowAmount = panelPos.right - maxRight;
        const newLeft = Math.max(panelMargin, dfnPos.left - overflowAmount);
        dfnPanel.style.left = newLeft + "px";
    }
}

function pinDfnPanel(dfnPanel) {
    // Switch it to "activated" state, which pins it.
    dfnPanel.classList.add("activated");
    dfnPanel.style.position = "fixed";
    dfnPanel.style.left = null;
    dfnPanel.style.top = null;
}

function hideDfnPanel({dfn, dfnPanel}) {
    if(!dfnPanel) dfnPanel = dfn.dfnPanel;
    if(!dfn) dfn = dfnPanel.dfn;
    dfn.dfnPanel = undefined;
    dfnPanel.dfn = undefined;
    dfn.setAttribute("aria-expanded", "false");
    dfn.tabIndex = undefined;
    dfnPanel.remove()
}

function toggleDfnPanel(dfn) {
    if(dfn.dfnPanel) {
        hideDfnPanel(dfn);
    } else {
        showDfnPanel(dfn);
    }
}

function insertDfnPopupAction(dfn) {
    dfn.setAttribute('role', 'button');
    dfn.setAttribute('aria-expanded', 'false')
    dfn.tabIndex = 0;
    dfn.classList.add('has-dfn-panel');
    dfn.addEventListener('click', (event) => {
        toggleDfnPanel(dfn);
        event.stopPropagation();
    });
    dfn.addEventListener('keypress', (event) => {
        const kc = event.keyCode;
        // 32->Space, 13->Enter
        if(kc == 32 || kc == 13) {
            toggleDfnPanel(dfn);
            event.stopPropagation();
            event.preventDefault();
        }
    });
}

function refocusOnTarget(event) {
    const target = event.target;
    setTimeout(() => {
        // Refocus on the event.target element.
        // This is needed after browser scrolls to the destination.
        target.focus();
    });
}

// TODO: shared util
// Returns the root-level absolute position {left and top} of element.
function getBounds(el, relativeTo=document.body) {
    const relativeRect = relativeTo.getBoundingClientRect();
    const elRect = el.getBoundingClientRect();
    const top = elRect.top - relativeRect.top;
    const left = elRect.left - relativeRect.left;
    return {
        top,
        left,
        bottom: top + elRect.height,
        right: left + elRect.width,
    }
}

function scrollToTargetAndHighlight(event) {
    let hash = event.target.hash;
    if (hash) {
        hash = decodeURIComponent(hash.substring(1));
        const dest = document.getElementById(hash);
        if (dest) {
            dest.classList.add('highlighted');
            setTimeout(() => dest.classList.remove('highlighted'), 1000);
        }
    }
}

// Functions, divided by link type, that wrap an autolink's
// contents with the appropriate outer syntax.
// Alternately, a string naming another type they format
// the same as.
function needsFor(type) {
    switch(type) {
        case "descriptor":
        case "value":
        case "element-attr":
        case "attr-value":
        case "element-state":
        case "method":
        case "constructor":
        case "argument":
        case "attribute":
        case "const":
        case "dict-member":
        case "event":
        case "enum-value":
        case "stringifier":
        case "serializer":
        case "iterator":
        case "maplike":
        case "setlike":
        case "state":
        case "mode":
        case "context":
        case "facet": return true;

        default: return false;
    }
}
function refusesFor(type) {
    switch(type) {
        case "property":
        case "element":
        case "interface":
        case "namespace":
        case "callback":
        case "dictionary":
        case "enum":
        case "exception":
        case "typedef":
        case "http-header":
        case "permission": return true;

        default: return false;
    }
}
function linkFormatterFromType(type) {
    switch(type) {
        case 'scheme':
        case 'permission':
        case 'dfn': return (text) => `[=${text}=]`;

        case 'abstract-op': return (text) => `[\$${text}\$]`;

        case 'function':
        case 'at-rule':
        case 'selector':
        case 'value': return (text) => `''${text}''`;

        case 'http-header': return (text) => `[:${text}:]`;

        case 'interface':
        case 'constructor':
        case 'method':
        case 'argument':
        case 'attribute':
        case 'callback':
        case 'dictionary':
        case 'dict-member':
        case 'enum':
        case 'enum-value':
        case 'exception':
        case 'const':
        case 'typedef':
        case 'stringifier':
        case 'serializer':
        case 'iterator':
        case 'maplike':
        case 'setlike':
        case 'extended-attribute':
        case 'event':
        case 'idl': return (text) => `{{${text}}}`;

        case 'element-state':
        case 'element-attr':
        case 'attr-value':
        case 'element': return (element) => `<{${element}}>`;

        case 'grammar': return (text) => `${text} (within a <pre class=prod>)`;

        case 'type': return (text)=> `<<${text}>>`;

        case 'descriptor':
        case 'property': return (text) => `'${text}'`;

        default: return;
    };
};

function genLinkingSyntaxes(dfn) {
    if(dfn.tagName != "DFN") return;

    const type = dfn.getAttribute('data-dfn-type');
    if(!type) {
        console.log(`<dfn> doesn't have a data-dfn-type:`, dfn);
        return [];
    }

    // Return a function that wraps link text based on the type
    const linkFormatter = linkFormatterFromType(type);
    if(!linkFormatter) {
        console.log(`<dfn> has an unknown data-dfn-type:`, dfn);
        return [];
    }

    let ltAlts;
    if(dfn.hasAttribute('data-lt')) {
        ltAlts = dfn.getAttribute('data-lt')
            .split("|")
            .map(x=>x.trim());
    } else {
        ltAlts = [dfn.textContent.trim()];
    }
    if(type == "type") {
        // lt of "<foo>", but "foo" is the interior;
        // <<foo/bar>> is how you write it with a for,
        // not <foo/<bar>> or whatever.
        for(var i = 0; i < ltAlts.length; i++) {
            const lt = ltAlts[i];
            const match = /<(.*)>/.exec(lt);
            if(match) { ltAlts[i] = match[1]; }
        }
    }

    let forAlts;
    if(dfn.hasAttribute('data-dfn-for')) {
        forAlts = dfn.getAttribute('data-dfn-for')
            .split(",")
            .map(x=>x.trim());
    } else {
        forAlts = [''];
    }

    let linkingSyntaxes = [];
    if(!needsFor(type)) {
        for(const lt of ltAlts) {
            linkingSyntaxes.push(linkFormatter(lt));
        }
    }
    if(!refusesFor(type)) {
        for(const f of forAlts) {
            linkingSyntaxes.push(linkFormatter(`${f}/${ltAlts[0]}`))
        }
    }
    return [
        mk.b({}, 'Possible linking syntaxes:'),
        mk.ul({},
            ...linkingSyntaxes.map(link => {
                const copyLink = async () =>
                    await navigator.clipboard.writeText(link);
                return mk.li({},
                    mk.div({ class: 'link-item' },
                        mk.button({
                            class: 'copy-icon', title: 'Copy',
                            type: 'button',
                            _onclick: copyLink,
                            tabindex: 0,
                        }, mk.span({ class: 'icon' }) ),
                        mk.span({}, link)
                    )
                );
            })
        )
    ];
}
}
</script>
<script>/* Boilerplate: script-ref-hints */
"use strict";
{
let refsData = {
"#active-listeners": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webdriver-bidi","spec":"webdriver-bidi-1","status":"local","text":"active listeners","type":"dfn","url":"#active-listeners"},
"#browsing-context-id": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webdriver-bidi","spec":"webdriver-bidi-1","status":"local","text":"browsing context id","type":"dfn","url":"#browsing-context-id"},
"#browsing-context-tree-discarded": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webdriver-bidi","spec":"webdriver-bidi-1","status":"local","text":"browsing context tree discarded","type":"dfn","url":"#browsing-context-tree-discarded"},
"#buffer-a-log-event": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webdriver-bidi","spec":"webdriver-bidi-1","status":"local","text":"buffer a log event","type":"dfn","url":"#buffer-a-log-event"},
"#command": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webdriver-bidi","spec":"webdriver-bidi-1","status":"local","text":"command","type":"dfn","url":"#command"},
"#command-command-name": {"export":true,"for_":["command"],"level":"1","normative":true,"shortname":"webdriver-bidi","spec":"webdriver-bidi-1","status":"local","text":"command name","type":"dfn","url":"#command-command-name"},
"#command-command-parameters": {"export":true,"for_":["command"],"level":"1","normative":true,"shortname":"webdriver-bidi","spec":"webdriver-bidi-1","status":"local","text":"command parameters","type":"dfn","url":"#command-command-parameters"},
"#command-result-type": {"export":true,"for_":["command"],"level":"1","normative":true,"shortname":"webdriver-bidi","spec":"webdriver-bidi-1","status":"local","text":"result type","type":"dfn","url":"#command-result-type"},
"#command-set-of-all-command-names": {"export":true,"for_":["command"],"level":"1","normative":true,"shortname":"webdriver-bidi","spec":"webdriver-bidi-1","status":"local","text":"set of all command names","type":"dfn","url":"#command-set-of-all-command-names"},
"#console-steps": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webdriver-bidi","spec":"webdriver-bidi-1","status":"local","text":"console steps","type":"dfn","url":"#console-steps"},
"#construct-a-websocket-resource-name": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webdriver-bidi","spec":"webdriver-bidi-1","status":"local","text":"constructing a websocket resource name","type":"dfn","url":"#construct-a-websocket-resource-name"},
"#construct-a-websocket-url": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webdriver-bidi","spec":"webdriver-bidi-1","status":"local","text":"constructing a websocket url","type":"dfn","url":"#construct-a-websocket-url"},
"#current-stack-trace": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webdriver-bidi","spec":"webdriver-bidi-1","status":"local","text":"current stack trace","type":"dfn","url":"#current-stack-trace"},
"#emit-a-context-created-event": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webdriver-bidi","spec":"webdriver-bidi-1","status":"local","text":"emit a context created event","type":"dfn","url":"#emit-a-context-created-event"},
"#emit-an-event": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webdriver-bidi","spec":"webdriver-bidi-1","status":"local","text":"emit an event","type":"dfn","url":"#emit-an-event"},
"#error-reporting-steps": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webdriver-bidi","spec":"webdriver-bidi-1","status":"local","text":"error reporting steps","type":"dfn","url":"#error-reporting-steps"},
"#event": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webdriver-bidi","spec":"webdriver-bidi-1","status":"local","text":"event","type":"dfn","url":"#event"},
"#event-browsing-context-event-map": {"export":true,"for_":["event"],"level":"1","normative":true,"shortname":"webdriver-bidi","spec":"webdriver-bidi-1","status":"local","text":"browsing context event map","type":"dfn","url":"#event-browsing-context-event-map"},
"#event-enabled-browsing-contexts": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webdriver-bidi","spec":"webdriver-bidi-1","status":"local","text":"event enabled browsing contexts","type":"dfn","url":"#event-enabled-browsing-contexts"},
"#event-event-name": {"export":true,"for_":["event"],"level":"1","normative":true,"shortname":"webdriver-bidi","spec":"webdriver-bidi-1","status":"local","text":"event name","type":"dfn","url":"#event-event-name"},
"#event-event-type": {"export":true,"for_":["event"],"level":"1","normative":true,"shortname":"webdriver-bidi","spec":"webdriver-bidi-1","status":"local","text":"event type","type":"dfn","url":"#event-event-type"},
"#event-global-event-set": {"export":true,"for_":["event"],"level":"1","normative":true,"shortname":"webdriver-bidi","spec":"webdriver-bidi-1","status":"local","text":"global event set","type":"dfn","url":"#event-global-event-set"},
"#event-is-enabled": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webdriver-bidi","spec":"webdriver-bidi-1","status":"local","text":"event is enabled","type":"dfn","url":"#event-is-enabled"},
"#extension-modules": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webdriver-bidi","spec":"webdriver-bidi-1","status":"local","text":"extension modules","type":"dfn","url":"#extension-modules"},
"#get-a-browsing-context": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webdriver-bidi","spec":"webdriver-bidi-1","status":"local","text":"get a browsing context","type":"dfn","url":"#get-a-browsing-context"},
"#get-a-session-id-for-a-websocket-resource": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webdriver-bidi","spec":"webdriver-bidi-1","status":"local","text":"get a session id for a websocket resource","type":"dfn","url":"#get-a-session-id-for-a-websocket-resource"},
"#get-related-browsing-contexts": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webdriver-bidi","spec":"webdriver-bidi-1","status":"local","text":"get related browsing contexts","type":"dfn","url":"#get-related-browsing-contexts"},
"#get-the-browsing-context-info": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webdriver-bidi","spec":"webdriver-bidi-1","status":"local","text":"get the browsing context info","type":"dfn","url":"#get-the-browsing-context-info"},
"#get-the-descendent-browsing-contexts": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webdriver-bidi","spec":"webdriver-bidi-1","status":"local","text":"get the descendent browsing contexts","type":"dfn","url":"#get-the-descendent-browsing-contexts"},
"#get-the-realm-info": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webdriver-bidi","spec":"webdriver-bidi-1","status":"local","text":"get the realm info","type":"dfn","url":"#get-the-realm-info"},
"#handle-a-connection-closing": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webdriver-bidi","spec":"webdriver-bidi-1","status":"local","text":"handle a connection closing","type":"dfn","url":"#handle-a-connection-closing"},
"#handle-an-incoming-message": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webdriver-bidi","spec":"webdriver-bidi-1","status":"local","text":"handle an incoming message","type":"dfn","url":"#handle-an-incoming-message"},
"#list-of-websocket-resources": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webdriver-bidi","spec":"webdriver-bidi-1","status":"local","text":"list of websocket resources","type":"dfn","url":"#list-of-websocket-resources"},
"#listener-host": {"export":true,"for_":["listener"],"level":"1","normative":true,"shortname":"webdriver-bidi","spec":"webdriver-bidi-1","status":"local","text":"host","type":"dfn","url":"#listener-host"},
"#listener-port": {"export":true,"for_":["listener"],"level":"1","normative":true,"shortname":"webdriver-bidi","spec":"webdriver-bidi-1","status":"local","text":"port","type":"dfn","url":"#listener-port"},
"#listener-secure-flag": {"export":true,"for_":["listener"],"level":"1","normative":true,"shortname":"webdriver-bidi","spec":"webdriver-bidi-1","status":"local","text":"secure flag","type":"dfn","url":"#listener-secure-flag"},
"#local-end-definition": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webdriver-bidi","spec":"webdriver-bidi-1","status":"local","text":"local end definition","type":"dfn","url":"#local-end-definition"},
"#log-event-buffer": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webdriver-bidi","spec":"webdriver-bidi-1","status":"local","text":"log event buffer","type":"dfn","url":"#log-event-buffer"},
"#module-name": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webdriver-bidi","spec":"webdriver-bidi-1","status":"local","text":"module name","type":"dfn","url":"#module-name"},
"#object-id-for-an-object": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webdriver-bidi","spec":"webdriver-bidi-1","status":"local","text":"object id for an object","type":"dfn","url":"#object-id-for-an-object"},
"#object-id-map": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webdriver-bidi","spec":"webdriver-bidi-1","status":"local","text":"object id map","type":"dfn","url":"#object-id-map"},
"#obtain-a-set-of-event-names": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webdriver-bidi","spec":"webdriver-bidi-1","status":"local","text":"obtain a set of event names","type":"dfn","url":"#obtain-a-set-of-event-names"},
"#realm-id": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webdriver-bidi","spec":"webdriver-bidi-1","status":"local","text":"realm id","type":"dfn","url":"#realm-id"},
"#recursively-emit-context-created-events": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webdriver-bidi","spec":"webdriver-bidi-1","status":"local","text":"recursively emit context created events","type":"dfn","url":"#recursively-emit-context-created-events"},
"#remote-end-definition": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webdriver-bidi","spec":"webdriver-bidi-1","status":"local","text":"remote end definition","type":"dfn","url":"#remote-end-definition"},
"#remote-end-event-trigger": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webdriver-bidi","spec":"webdriver-bidi-1","status":"local","text":"remote end event trigger","type":"dfn","url":"#remote-end-event-trigger"},
"#remote-end-subscribe-steps": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webdriver-bidi","spec":"webdriver-bidi-1","status":"local","text":"remote end subscribe steps","type":"dfn","url":"#remote-end-subscribe-steps"},
"#respond-with-an-error": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webdriver-bidi","spec":"webdriver-bidi-1","status":"local","text":"respond with an error","type":"dfn","url":"#respond-with-an-error"},
"#serialize-as-a-list": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webdriver-bidi","spec":"webdriver-bidi-1","status":"local","text":"serialize as a list","type":"dfn","url":"#serialize-as-a-list"},
"#serialize-as-a-mapping": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webdriver-bidi","spec":"webdriver-bidi-1","status":"local","text":"serialize as a mapping","type":"dfn","url":"#serialize-as-a-mapping"},
"#serialize-as-a-remote-value": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webdriver-bidi","spec":"webdriver-bidi-1","status":"local","text":"serialize as a remote value","type":"dfn","url":"#serialize-as-a-remote-value"},
"#start-listening-for-a-websocket-connection": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webdriver-bidi","spec":"webdriver-bidi-1","status":"local","text":"start listening for a websocket connection","type":"dfn","url":"#start-listening-for-a-websocket-connection"},
"#subscribe-priority": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webdriver-bidi","spec":"webdriver-bidi-1","status":"local","text":"subscribe priority","type":"dfn","url":"#subscribe-priority"},
"#update-the-event-map": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webdriver-bidi","spec":"webdriver-bidi-1","status":"local","text":"update the event map","type":"dfn","url":"#update-the-event-map"},
"#websocket-connection": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webdriver-bidi","spec":"webdriver-bidi-1","status":"local","text":"websocket connection","type":"dfn","url":"#websocket-connection"},
"#websocket-listener": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webdriver-bidi","spec":"webdriver-bidi-1","status":"local","text":"websocket listener","type":"dfn","url":"#websocket-listener"},
"https://console.spec.whatwg.org#formatter": {"export":true,"for_":[],"level":"","normative":true,"shortname":"console","spec":"console","status":"anchor-block","text":"formatter","type":"dfn","url":"https://console.spec.whatwg.org#formatter"},
"https://console.spec.whatwg.org#formatting-specifiers": {"export":true,"for_":[],"level":"","normative":true,"shortname":"console","spec":"console","status":"anchor-block","text":"formatting specifier","type":"dfn","url":"https://console.spec.whatwg.org#formatting-specifiers"},
"https://console.spec.whatwg.org#printer": {"export":true,"for_":[],"level":"","normative":true,"shortname":"console","spec":"console","status":"anchor-block","text":"printer","type":"dfn","url":"https://console.spec.whatwg.org#printer"},
"https://console.spec.whatwg.org/#namespacedef-console": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"console","spec":"console","status":"current","text":"console","type":"namespace","url":"https://console.spec.whatwg.org/#namespacedef-console"},
"https://dom.spec.whatwg.org/#boundary-point-node": {"export":true,"for_":["boundary point"],"level":"1","normative":true,"shortname":"dom","spec":"dom","status":"current","text":"node","type":"dfn","url":"https://dom.spec.whatwg.org/#boundary-point-node"},
"https://dom.spec.whatwg.org/#concept-attribute": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"dom","spec":"dom","status":"current","text":"attribute","type":"dfn","url":"https://dom.spec.whatwg.org/#concept-attribute"},
"https://dom.spec.whatwg.org/#concept-attribute-qualified-name": {"export":true,"for_":["Attr"],"level":"1","normative":true,"shortname":"dom","spec":"dom","status":"current","text":"qualified name","type":"dfn","url":"https://dom.spec.whatwg.org/#concept-attribute-qualified-name"},
"https://dom.spec.whatwg.org/#concept-attribute-value": {"export":true,"for_":["Attr"],"level":"1","normative":true,"shortname":"dom","spec":"dom","status":"current","text":"value","type":"dfn","url":"https://dom.spec.whatwg.org/#concept-attribute-value"},
"https://dom.spec.whatwg.org/#concept-document": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"dom","spec":"dom","status":"current","text":"document","type":"dfn","url":"https://dom.spec.whatwg.org/#concept-document"},
"https://dom.spec.whatwg.org/#concept-document-url": {"export":true,"for_":["Document"],"level":"1","normative":true,"shortname":"dom","spec":"dom","status":"current","text":"url","type":"dfn","url":"https://dom.spec.whatwg.org/#concept-document-url"},
"https://dom.spec.whatwg.org/#concept-element": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"dom","spec":"dom","status":"current","text":"element","type":"dfn","url":"https://dom.spec.whatwg.org/#concept-element"},
"https://dom.spec.whatwg.org/#concept-element-attribute": {"export":true,"for_":["Element"],"level":"1","normative":true,"shortname":"dom","spec":"dom","status":"current","text":"attribute list","type":"dfn","url":"https://dom.spec.whatwg.org/#concept-element-attribute"},
"https://dom.spec.whatwg.org/#concept-element-shadow-root": {"export":true,"for_":["Element"],"level":"1","normative":true,"shortname":"dom","spec":"dom","status":"current","text":"shadow root","type":"dfn","url":"https://dom.spec.whatwg.org/#concept-element-shadow-root"},
"https://dom.spec.whatwg.org/#concept-node": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"dom","spec":"dom","status":"current","text":"nodes","type":"dfn","url":"https://dom.spec.whatwg.org/#concept-node"},
"https://dom.spec.whatwg.org/#concept-tree-child": {"export":true,"for_":["tree"],"level":"1","normative":true,"shortname":"dom","spec":"dom","status":"current","text":"children","type":"dfn","url":"https://dom.spec.whatwg.org/#concept-tree-child"},
"https://dom.spec.whatwg.org/#document": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"dom","spec":"dom","status":"current","text":"Document","type":"interface","url":"https://dom.spec.whatwg.org/#document"},
"https://drafts.css-houdini.org/css-paint-api-1/#paintworkletglobalscope": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"css-paint-api","spec":"css-paint-api-1","status":"current","text":"PaintWorkletGlobalScope","type":"interface","url":"https://drafts.css-houdini.org/css-paint-api-1/#paintworkletglobalscope"},
"https://drafts.csswg.org/css-color-3/#window": {"export":true,"for_":[],"level":"3","normative":true,"shortname":"css-color","spec":"css-color-3","status":"current","text":"window","type":"dfn","url":"https://drafts.csswg.org/css-color-3/#window"},
"https://fetch.spec.whatwg.org/#concept-connection": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"fetch","spec":"fetch","status":"current","text":"connection","type":"dfn","url":"https://fetch.spec.whatwg.org/#concept-connection"},
"https://fetch.spec.whatwg.org/#header-list-contains": {"export":true,"for_":["header list"],"level":"1","normative":true,"shortname":"fetch","spec":"fetch","status":"current","text":"contains","type":"dfn","url":"https://fetch.spec.whatwg.org/#header-list-contains"},
"https://html.spec.whatwg.org/#a-browsing-context-is-discarded": {"export":true,"for_":[],"level":"","normative":true,"shortname":"html","spec":"html","status":"anchor-block","text":"a browsing context is discarded","type":"dfn","url":"https://html.spec.whatwg.org/#a-browsing-context-is-discarded"},
"https://html.spec.whatwg.org/#bcg-remove": {"export":true,"for_":[],"level":"","normative":true,"shortname":"html","spec":"html","status":"anchor-block","text":"remove a browsing context","type":"dfn","url":"https://html.spec.whatwg.org/#bcg-remove"},
"https://html.spec.whatwg.org/#concept-document-worklet-global-scopes": {"export":true,"for_":[],"level":"","normative":true,"shortname":"html","spec":"html","status":"anchor-block","text":"worklet global scopes","type":"dfn","url":"https://html.spec.whatwg.org/#concept-document-worklet-global-scopes"},
"https://html.spec.whatwg.org/#concept-error-handled": {"export":true,"for_":[],"level":"","normative":true,"shortname":"html","spec":"html","status":"anchor-block","text":"handled","type":"dfn","url":"https://html.spec.whatwg.org/#concept-error-handled"},
"https://html.spec.whatwg.org/#creating-a-new-browsing-context": {"export":true,"for_":[],"level":"","normative":true,"shortname":"html","spec":"html","status":"anchor-block","text":"create a new browsing context","type":"dfn","url":"https://html.spec.whatwg.org/#creating-a-new-browsing-context"},
"https://html.spec.whatwg.org/#environment-settings-object's-realm": {"export":true,"for_":[],"level":"","normative":true,"shortname":"html","spec":"html","status":"anchor-block","text":"environment settings object's realm","type":"dfn","url":"https://html.spec.whatwg.org/#environment-settings-object's-realm"},
"https://html.spec.whatwg.org/#report-the-error": {"export":true,"for_":[],"level":"","normative":true,"shortname":"html","spec":"html","status":"anchor-block","text":"report an error","type":"dfn","url":"https://html.spec.whatwg.org/#report-the-error"},
"https://html.spec.whatwg.org/#session-history": {"export":true,"for_":[],"level":"","normative":true,"shortname":"html","spec":"html","status":"anchor-block","text":"session history","type":"dfn","url":"https://html.spec.whatwg.org/#session-history"},
"https://html.spec.whatwg.org/#set-up-a-window-environment-settings-object": {"export":true,"for_":[],"level":"","normative":true,"shortname":"html","spec":"html","status":"anchor-block","text":"set up a window environment settings object","type":"dfn","url":"https://html.spec.whatwg.org/#set-up-a-window-environment-settings-object"},
"https://html.spec.whatwg.org/#set-up-a-worker-environment-settings-object": {"export":true,"for_":[],"level":"","normative":true,"shortname":"html","spec":"html","status":"anchor-block","text":"set up a worker environment settings object","type":"dfn","url":"https://html.spec.whatwg.org/#set-up-a-worker-environment-settings-object"},
"https://html.spec.whatwg.org/#worker-event-loop-2": {"export":true,"for_":[],"level":"","normative":true,"shortname":"html","spec":"html","status":"anchor-block","text":"worker event loop","type":"dfn","url":"https://html.spec.whatwg.org/#worker-event-loop-2"},
"https://html.spec.whatwg.org/multipage/browsers.html#ascii-serialisation-of-an-origin": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"serialization of an origin","type":"dfn","url":"https://html.spec.whatwg.org/multipage/browsers.html#ascii-serialisation-of-an-origin"},
"https://html.spec.whatwg.org/multipage/document-lifecycle.html#unloading-document-cleanup-steps": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"unloading document cleanup steps","type":"dfn","url":"https://html.spec.whatwg.org/multipage/document-lifecycle.html#unloading-document-cleanup-steps"},
"https://html.spec.whatwg.org/multipage/document-sequences.html#browsing-context": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"browsing context","type":"dfn","url":"https://html.spec.whatwg.org/multipage/document-sequences.html#browsing-context"},
"https://html.spec.whatwg.org/multipage/document-sequences.html#concept-document-bc": {"export":true,"for_":["Document"],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"browsing context","type":"dfn","url":"https://html.spec.whatwg.org/multipage/document-sequences.html#concept-document-bc"},
"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-document": {"export":true,"for_":["navigable"],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"active document","type":"dfn","url":"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-document"},
"https://html.spec.whatwg.org/multipage/document-sequences.html#top-level-browsing-context": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"top-level browsing context","type":"dfn","url":"https://html.spec.whatwg.org/multipage/document-sequences.html#top-level-browsing-context"},
"https://html.spec.whatwg.org/multipage/nav-history-apis.html#windowproxy": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"WindowProxy","type":"interface","url":"https://html.spec.whatwg.org/multipage/nav-history-apis.html#windowproxy"},
"https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-execution-ready-flag": {"export":true,"for_":["environment"],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"execution ready flag","type":"dfn","url":"https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-execution-ready-flag"},
"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"relevant realm","type":"dfn","url":"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm"},
"https://html.spec.whatwg.org/multipage/webappapis.html#current-settings-object": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"current settings object","type":"dfn","url":"https://html.spec.whatwg.org/multipage/webappapis.html#current-settings-object"},
"https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"environment settings object","type":"dfn","url":"https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object"},
"https://html.spec.whatwg.org/multipage/webappapis.html#realm-execution-context": {"export":true,"for_":["environment settings object"],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"realm execution context","type":"dfn","url":"https://html.spec.whatwg.org/multipage/webappapis.html#realm-execution-context"},
"https://html.spec.whatwg.org/multipage/webappapis.html#responsible-event-loop": {"export":true,"for_":["environment settings object"],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"responsible event loop","type":"dfn","url":"https://html.spec.whatwg.org/multipage/webappapis.html#responsible-event-loop"},
"https://html.spec.whatwg.org/multipage/webappapis.html#settings-object": {"export":true,"for_":["script"],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"settings object","type":"dfn","url":"https://html.spec.whatwg.org/multipage/webappapis.html#settings-object"},
"https://html.spec.whatwg.org/multipage/workers.html#concept-WorkerGlobalScope-owner-set": {"export":true,"for_":["WorkerGlobalScope"],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"owner set","type":"dfn","url":"https://html.spec.whatwg.org/multipage/workers.html#concept-WorkerGlobalScope-owner-set"},
"https://html.spec.whatwg.org/multipage/workers.html#dedicatedworkerglobalscope": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"DedicatedWorkerGlobalScope","type":"interface","url":"https://html.spec.whatwg.org/multipage/workers.html#dedicatedworkerglobalscope"},
"https://html.spec.whatwg.org/multipage/workers.html#sharedworkerglobalscope": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"SharedWorkerGlobalScope","type":"interface","url":"https://html.spec.whatwg.org/multipage/workers.html#sharedworkerglobalscope"},
"https://html.spec.whatwg.org/multipage/workers.html#terminate-a-worker": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"terminate a worker","type":"dfn","url":"https://html.spec.whatwg.org/multipage/workers.html#terminate-a-worker"},
"https://html.spec.whatwg.org/multipage/workers.html#workerglobalscope": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"WorkerGlobalScope","type":"interface","url":"https://html.spec.whatwg.org/multipage/workers.html#workerglobalscope"},
"https://html.spec.whatwg.org/multipage/worklets.html#workletglobalscope": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"WorkletGlobalScope","type":"interface","url":"https://html.spec.whatwg.org/multipage/worklets.html#workletglobalscope"},
"https://infra.spec.whatwg.org/#assert": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"assert","type":"dfn","url":"https://infra.spec.whatwg.org/#assert"},
"https://infra.spec.whatwg.org/#implementation-defined": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"implementation-defined","type":"dfn","url":"https://infra.spec.whatwg.org/#implementation-defined"},
"https://infra.spec.whatwg.org/#iteration-continue": {"export":true,"for_":["iteration"],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"continue","type":"dfn","url":"https://infra.spec.whatwg.org/#iteration-continue"},
"https://infra.spec.whatwg.org/#list-clone": {"export":true,"for_":["list","stack","queue","set"],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"clone","type":"dfn","url":"https://infra.spec.whatwg.org/#list-clone"},
"https://infra.spec.whatwg.org/#list-size": {"export":true,"for_":["list","stack","queue","set"],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"size","type":"dfn","url":"https://infra.spec.whatwg.org/#list-size"},
"https://infra.spec.whatwg.org/#map-size": {"export":true,"for_":["map"],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"size","type":"dfn","url":"https://infra.spec.whatwg.org/#map-size"},
"https://infra.spec.whatwg.org/#map-sort-in-ascending-order": {"export":true,"for_":["map"],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"sort in ascending order","type":"dfn","url":"https://infra.spec.whatwg.org/#map-sort-in-ascending-order"},
"https://infra.spec.whatwg.org/#ordered-map": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"map","type":"dfn","url":"https://infra.spec.whatwg.org/#ordered-map"},
"https://infra.spec.whatwg.org/#ordered-set": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"set","type":"dfn","url":"https://infra.spec.whatwg.org/#ordered-set"},
"https://infra.spec.whatwg.org/#parse-a-json-string-to-an-infra-value": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"parse json into infra values","type":"dfn","url":"https://infra.spec.whatwg.org/#parse-a-json-string-to-an-infra-value"},
"https://infra.spec.whatwg.org/#scalar-value-string": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"scalar value string","type":"dfn","url":"https://infra.spec.whatwg.org/#scalar-value-string"},
"https://infra.spec.whatwg.org/#serialize-an-infra-value-to-json-bytes": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"serialize an infra value to json bytes","type":"dfn","url":"https://infra.spec.whatwg.org/#serialize-an-infra-value-to-json-bytes"},
"https://infra.spec.whatwg.org/#set-append": {"export":true,"for_":["set"],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"append","type":"dfn","url":"https://infra.spec.whatwg.org/#set-append"},
"https://tc39.es/ecma262/#current-realm": {"export":true,"for_":[],"level":"","normative":true,"shortname":"ecmascript","spec":"ecmascript","status":"anchor-block","text":"current realm record","type":"dfn","url":"https://tc39.es/ecma262/#current-realm"},
"https://tc39.es/ecma262/#running-execution-context": {"export":true,"for_":[],"level":"","normative":true,"shortname":"ecmascript","spec":"ecmascript","status":"anchor-block","text":"running execution context","type":"dfn","url":"https://tc39.es/ecma262/#running-execution-context"},
"https://tc39.es/ecma262/#sec-code-realms": {"export":true,"for_":[],"level":"","normative":true,"shortname":"ecmascript","spec":"ecmascript","status":"anchor-block","text":"realm","type":"dfn","url":"https://tc39.es/ecma262/#sec-code-realms"},
"https://tc39.es/ecma262/#sec-createarrayiterator": {"export":true,"for_":[],"level":"","normative":true,"shortname":"ecmascript","spec":"ecmascript","status":"anchor-block","text":"createarrayiterator","type":"dfn","url":"https://tc39.es/ecma262/#sec-createarrayiterator"},
"https://tc39.es/ecma262/#sec-createlistfromarraylike": {"export":true,"for_":[],"level":"","normative":true,"shortname":"ecmascript","spec":"ecmascript","status":"anchor-block","text":"createlistfromarraylike","type":"dfn","url":"https://tc39.es/ecma262/#sec-createlistfromarraylike"},
"https://tc39.es/ecma262/#sec-createmapiterator": {"export":true,"for_":[],"level":"","normative":true,"shortname":"ecmascript","spec":"ecmascript","status":"anchor-block","text":"createmapiterator","type":"dfn","url":"https://tc39.es/ecma262/#sec-createmapiterator"},
"https://tc39.es/ecma262/#sec-createsetiterator": {"export":true,"for_":[],"level":"","normative":true,"shortname":"ecmascript","spec":"ecmascript","status":"anchor-block","text":"createsetiterator","type":"dfn","url":"https://tc39.es/ecma262/#sec-createsetiterator"},
"https://tc39.es/ecma262/#sec-ecmascript-data-types-and-values": {"export":true,"for_":[],"level":"","normative":true,"shortname":"ecmascript","spec":"ecmascript","status":"anchor-block","text":"type","type":"dfn","url":"https://tc39.es/ecma262/#sec-ecmascript-data-types-and-values"},
"https://tc39.es/ecma262/#sec-enumerableownpropertynames": {"export":true,"for_":[],"level":"","normative":true,"shortname":"ecmascript","spec":"ecmascript","status":"anchor-block","text":"enumerableownpropertynames","type":"dfn","url":"https://tc39.es/ecma262/#sec-enumerableownpropertynames"},
"https://tc39.es/ecma262/#sec-get": {"export":true,"for_":[],"level":"","normative":true,"shortname":"ecmascript","spec":"ecmascript","status":"anchor-block","text":"get","type":"dfn","url":"https://tc39.es/ecma262/#sec-get"},
"https://tc39.es/ecma262/#sec-isarray": {"export":true,"for_":[],"level":"","normative":true,"shortname":"ecmascript","spec":"ecmascript","status":"anchor-block","text":"isarray","type":"dfn","url":"https://tc39.es/ecma262/#sec-isarray"},
"https://tc39.es/ecma262/#sec-iscallable": {"export":true,"for_":[],"level":"","normative":true,"shortname":"ecmascript","spec":"ecmascript","status":"anchor-block","text":"iscallable","type":"dfn","url":"https://tc39.es/ecma262/#sec-iscallable"},
"https://tc39.es/ecma262/#sec-ispromise": {"export":true,"for_":[],"level":"","normative":true,"shortname":"ecmascript","spec":"ecmascript","status":"anchor-block","text":"ispromise","type":"dfn","url":"https://tc39.es/ecma262/#sec-ispromise"},
"https://tc39.es/ecma262/#sec-isregexp": {"export":true,"for_":[],"level":"","normative":true,"shortname":"ecmascript","spec":"ecmascript","status":"anchor-block","text":"isregexp","type":"dfn","url":"https://tc39.es/ecma262/#sec-isregexp"},
"https://tc39.es/ecma262/#sec-object-internal-methods-and-internal-slots": {"export":true,"for_":[],"level":"","normative":true,"shortname":"ecmascript","spec":"ecmascript","status":"anchor-block","text":"internal slot","type":"dfn","url":"https://tc39.es/ecma262/#sec-object-internal-methods-and-internal-slots"},
"https://tc39.es/ecma262/#sec-primitive-value": {"export":true,"for_":[],"level":"","normative":true,"shortname":"ecmascript","spec":"ecmascript","status":"anchor-block","text":"primitive value","type":"dfn","url":"https://tc39.es/ecma262/#sec-primitive-value"},
"https://tc39.es/ecma262/#sec-time-values-and-time-range": {"export":true,"for_":[],"level":"","normative":true,"shortname":"ecmascript","spec":"ecmascript","status":"anchor-block","text":"time value","type":"dfn","url":"https://tc39.es/ecma262/#sec-time-values-and-time-range"},
"https://tc39.es/ecma262/#sec-todatestring": {"export":true,"for_":[],"level":"","normative":true,"shortname":"ecmascript","spec":"ecmascript","status":"anchor-block","text":"todatestring","type":"dfn","url":"https://tc39.es/ecma262/#sec-todatestring"},
"https://tc39.es/ecma262/#sec-tostring": {"export":true,"for_":[],"level":"","normative":true,"shortname":"ecmascript","spec":"ecmascript","status":"anchor-block","text":"tostring","type":"dfn","url":"https://tc39.es/ecma262/#sec-tostring"},
"https://tc39.es/ecma262/#thistimevalue": {"export":true,"for_":[],"level":"","normative":true,"shortname":"ecmascript","spec":"ecmascript","status":"anchor-block","text":"thistimevalue","type":"dfn","url":"https://tc39.es/ecma262/#thistimevalue"},
"https://tools.ietf.org/html/rfc6455#section-3": {"export":true,"for_":[],"level":"","normative":true,"shortname":"rfc6455","spec":"rfc6455","status":"anchor-block","text":"websocket uri","type":"dfn","url":"https://tools.ietf.org/html/rfc6455#section-3"},
"https://tools.ietf.org/html/rfc6455#section-4.1": {"export":true,"for_":[],"level":"","normative":true,"shortname":"rfc6455","spec":"rfc6455","status":"anchor-block","text":"establishes a websocket connection","type":"dfn","url":"https://tools.ietf.org/html/rfc6455#section-4.1"},
"https://tools.ietf.org/html/rfc6455#section-4.2": {"export":true,"for_":[],"level":"","normative":true,"shortname":"rfc6455","spec":"rfc6455","status":"anchor-block","text":"server-side requirements","type":"dfn","url":"https://tools.ietf.org/html/rfc6455#section-4.2"},
"https://tools.ietf.org/html/rfc6455#section-4.2.1": {"export":true,"for_":[],"level":"","normative":true,"shortname":"rfc6455","spec":"rfc6455","status":"anchor-block","text":"reading the client's opening handshake","type":"dfn","url":"https://tools.ietf.org/html/rfc6455#section-4.2.1"},
"https://tools.ietf.org/html/rfc6455#section-5.2": {"export":true,"for_":[],"level":"","normative":true,"shortname":"rfc6455","spec":"rfc6455","status":"anchor-block","text":"%x1 denotes a text frame","type":"dfn","url":"https://tools.ietf.org/html/rfc6455#section-5.2"},
"https://tools.ietf.org/html/rfc6455#section-6.1": {"export":true,"for_":[],"level":"","normative":true,"shortname":"rfc6455","spec":"rfc6455","status":"anchor-block","text":"send a websocket message","type":"dfn","url":"https://tools.ietf.org/html/rfc6455#section-6.1"},
"https://tools.ietf.org/html/rfc6455#section-6.2": {"export":true,"for_":[],"level":"","normative":true,"shortname":"rfc6455","spec":"rfc6455","status":"anchor-block","text":"a websocket message has been received","type":"dfn","url":"https://tools.ietf.org/html/rfc6455#section-6.2"},
"https://tools.ietf.org/html/rfc6455#section-7.1.3": {"export":true,"for_":[],"level":"","normative":true,"shortname":"rfc6455","spec":"rfc6455","status":"anchor-block","text":"the websocket closing handshake is started","type":"dfn","url":"https://tools.ietf.org/html/rfc6455#section-7.1.3"},
"https://tools.ietf.org/html/rfc6455#section-7.1.4": {"export":true,"for_":[],"level":"","normative":true,"shortname":"rfc6455","spec":"rfc6455","status":"anchor-block","text":"the websocket connection is closed","type":"dfn","url":"https://tools.ietf.org/html/rfc6455#section-7.1.4"},
"https://tools.ietf.org/html/rfc6455#section-7.1.7": {"export":true,"for_":[],"level":"","normative":true,"shortname":"rfc6455","spec":"rfc6455","status":"anchor-block","text":"fail the websocket connection","type":"dfn","url":"https://tools.ietf.org/html/rfc6455#section-7.1.7"},
"https://tools.ietf.org/html/rfc6455#section-7.4": {"export":true,"for_":[],"level":"","normative":true,"shortname":"rfc6455","spec":"rfc6455","status":"anchor-block","text":"status codes","type":"dfn","url":"https://tools.ietf.org/html/rfc6455#section-7.4"},
"https://tools.ietf.org/html/rfc6455#section-8.1": {"export":true,"for_":[],"level":"","normative":true,"shortname":"rfc6455","spec":"rfc6455","status":"anchor-block","text":"handling errors in utf-8-encoded data","type":"dfn","url":"https://tools.ietf.org/html/rfc6455#section-8.1"},
"https://url.spec.whatwg.org/#concept-url": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"url","spec":"url","status":"current","text":"url","type":"dfn","url":"https://url.spec.whatwg.org/#concept-url"},
"https://url.spec.whatwg.org/#concept-url-serializer": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"url","spec":"url","status":"current","text":"url serializer","type":"dfn","url":"https://url.spec.whatwg.org/#concept-url-serializer"},
"https://w3c.github.io/ServiceWorker/#serviceworkerglobalscope": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"service-workers","spec":"service-workers","status":"current","text":"ServiceWorkerGlobalScope","type":"interface","url":"https://w3c.github.io/ServiceWorker/#serviceworkerglobalscope"},
"https://w3c.github.io/webdriver/#dfn-active-session": {"export":true,"for_":[],"level":"","normative":true,"shortname":"webdriver","spec":"webdriver","status":"anchor-block","text":"active sessions","type":"dfn","url":"https://w3c.github.io/webdriver/#dfn-active-session"},
"https://w3c.github.io/webdriver/#dfn-additional-capability-deserialization-algorithm": {"export":true,"for_":[],"level":"","normative":true,"shortname":"webdriver","spec":"webdriver","status":"anchor-block","text":"additional capability deserialization algorithm","type":"dfn","url":"https://w3c.github.io/webdriver/#dfn-additional-capability-deserialization-algorithm"},
"https://w3c.github.io/webdriver/#dfn-additional-webdriver-capability": {"export":true,"for_":[],"level":"","normative":true,"shortname":"webdriver","spec":"webdriver","status":"anchor-block","text":"additional webdriver capability","type":"dfn","url":"https://w3c.github.io/webdriver/#dfn-additional-webdriver-capability"},
"https://w3c.github.io/webdriver/#dfn-capability-name": {"export":true,"for_":[],"level":"","normative":true,"shortname":"webdriver","spec":"webdriver","status":"anchor-block","text":"capability name","type":"dfn","url":"https://w3c.github.io/webdriver/#dfn-capability-name"},
"https://w3c.github.io/webdriver/#dfn-current-session": {"export":true,"for_":[],"level":"","normative":true,"shortname":"webdriver","spec":"webdriver","status":"anchor-block","text":"current session","type":"dfn","url":"https://w3c.github.io/webdriver/#dfn-current-session"},
"https://w3c.github.io/webdriver/#dfn-endpoint-node": {"export":true,"for_":[],"level":"","normative":true,"shortname":"webdriver","spec":"webdriver","status":"anchor-block","text":"endpoint node","type":"dfn","url":"https://w3c.github.io/webdriver/#dfn-endpoint-node"},
"https://w3c.github.io/webdriver/#dfn-error-code": {"export":true,"for_":[],"level":"","normative":true,"shortname":"webdriver","spec":"webdriver","status":"anchor-block","text":"error code","type":"dfn","url":"https://w3c.github.io/webdriver/#dfn-error-code"},
"https://w3c.github.io/webdriver/#dfn-errors": {"export":true,"for_":[],"level":"","normative":true,"shortname":"webdriver","spec":"webdriver","status":"anchor-block","text":"error","type":"dfn","url":"https://w3c.github.io/webdriver/#dfn-errors"},
"https://w3c.github.io/webdriver/#dfn-get-a-property": {"export":true,"for_":[],"level":"","normative":true,"shortname":"webdriver","spec":"webdriver","status":"anchor-block","text":"getting a property","type":"dfn","url":"https://w3c.github.io/webdriver/#dfn-get-a-property"},
"https://w3c.github.io/webdriver/#dfn-intermediary-node": {"export":true,"for_":[],"level":"","normative":true,"shortname":"webdriver","spec":"webdriver","status":"anchor-block","text":"intermediary node","type":"dfn","url":"https://w3c.github.io/webdriver/#dfn-intermediary-node"},
"https://w3c.github.io/webdriver/#dfn-invalid-argument": {"export":true,"for_":[],"level":"","normative":true,"shortname":"webdriver","spec":"webdriver","status":"anchor-block","text":"invalid argument","type":"dfn","url":"https://w3c.github.io/webdriver/#dfn-invalid-argument"},
"https://w3c.github.io/webdriver/#dfn-local-ends": {"export":true,"for_":[],"level":"","normative":true,"shortname":"webdriver","spec":"webdriver","status":"anchor-block","text":"local end","type":"dfn","url":"https://w3c.github.io/webdriver/#dfn-local-ends"},
"https://w3c.github.io/webdriver/#dfn-matched-capability-serialization-algorithm": {"export":true,"for_":[],"level":"","normative":true,"shortname":"webdriver","spec":"webdriver","status":"anchor-block","text":"matched capability serialization algorithm","type":"dfn","url":"https://w3c.github.io/webdriver/#dfn-matched-capability-serialization-algorithm"},
"https://w3c.github.io/webdriver/#dfn-no-such-frame": {"export":true,"for_":[],"level":"","normative":true,"shortname":"webdriver","spec":"webdriver","status":"anchor-block","text":"no such frame","type":"dfn","url":"https://w3c.github.io/webdriver/#dfn-no-such-frame"},
"https://w3c.github.io/webdriver/#dfn-remote-end-steps": {"export":true,"for_":[],"level":"","normative":true,"shortname":"webdriver","spec":"webdriver","status":"anchor-block","text":"remote end steps","type":"dfn","url":"https://w3c.github.io/webdriver/#dfn-remote-end-steps"},
"https://w3c.github.io/webdriver/#dfn-remote-ends": {"export":true,"for_":[],"level":"","normative":true,"shortname":"webdriver","spec":"webdriver","status":"anchor-block","text":"remote end","type":"dfn","url":"https://w3c.github.io/webdriver/#dfn-remote-ends"},
"https://w3c.github.io/webdriver/#dfn-session-id": {"export":true,"for_":[],"level":"","normative":true,"shortname":"webdriver","spec":"webdriver","status":"anchor-block","text":"session id","type":"dfn","url":"https://w3c.github.io/webdriver/#dfn-session-id"},
"https://w3c.github.io/webdriver/#dfn-sessions": {"export":true,"for_":[],"level":"","normative":true,"shortname":"webdriver","spec":"webdriver","status":"anchor-block","text":"session","type":"dfn","url":"https://w3c.github.io/webdriver/#dfn-sessions"},
"https://w3c.github.io/webdriver/#dfn-set-a-property": {"export":true,"for_":[],"level":"","normative":true,"shortname":"webdriver","spec":"webdriver","status":"anchor-block","text":"set a property","type":"dfn","url":"https://w3c.github.io/webdriver/#dfn-set-a-property"},
"https://w3c.github.io/webdriver/#dfn-success": {"export":true,"for_":[],"level":"","normative":true,"shortname":"webdriver","spec":"webdriver","status":"anchor-block","text":"success","type":"dfn","url":"https://w3c.github.io/webdriver/#dfn-success"},
"https://w3c.github.io/webdriver/#dfn-try": {"export":true,"for_":[],"level":"","normative":true,"shortname":"webdriver","spec":"webdriver","status":"anchor-block","text":"try","type":"dfn","url":"https://w3c.github.io/webdriver/#dfn-try"},
"https://w3c.github.io/webdriver/#dfn-unknown-command": {"export":true,"for_":[],"level":"","normative":true,"shortname":"webdriver","spec":"webdriver","status":"anchor-block","text":"unknown command","type":"dfn","url":"https://w3c.github.io/webdriver/#dfn-unknown-command"},
"https://w3c.github.io/webdriver/#dfn-web-element-reference": {"export":true,"for_":[],"level":"","normative":true,"shortname":"webdriver","spec":"webdriver","status":"anchor-block","text":"web element reference","type":"dfn","url":"https://w3c.github.io/webdriver/#dfn-web-element-reference"},
"https://w3c.github.io/webdriver/#dfn-webdriver-new-session-algorithm": {"export":true,"for_":[],"level":"","normative":true,"shortname":"webdriver","spec":"webdriver","status":"anchor-block","text":"webdriver new session algorithm","type":"dfn","url":"https://w3c.github.io/webdriver/#dfn-webdriver-new-session-algorithm"},
"https://w3c.github.io/webdriver/#dfn-window-handle": {"export":true,"for_":[],"level":"","normative":true,"shortname":"webdriver","spec":"webdriver","status":"anchor-block","text":"window handle","type":"dfn","url":"https://w3c.github.io/webdriver/#dfn-window-handle"},
"https://webaudio.github.io/web-audio-api/#AudioWorkletGlobalScope": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webaudio","spec":"webaudio","status":"current","text":"AudioWorkletGlobalScope","type":"interface","url":"https://webaudio.github.io/web-audio-api/#AudioWorkletGlobalScope"},
"https://webidl.spec.whatwg.org/#dfn-platform-object": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"platform object","type":"dfn","url":"https://webidl.spec.whatwg.org/#dfn-platform-object"},
"https://webidl.spec.whatwg.org/#dfn-return-type": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"return type","type":"dfn","url":"https://webidl.spec.whatwg.org/#dfn-return-type"},
};

function mkRefHint(link, ref) {
    const linkText = link.textContent;
    let dfnTextElements = '';
    if (ref.text != linkText) {
        dfnTextElements =
            mk.li({},
                mk.b({}, "Term: "),
                mk.span({}, ref.text)
            );
    }
    const forList = ref.for_;
    let forListElements;
    if(forList.length == 0) {
        forListElements = [];
    } else if(forList.length == 1) {
        forListElements = mk.li({},
            mk.b({}, "For: "),
            mk.span({}, forList[0]),
        );
    } else {
        forListElements = mk.li({},
            mk.b({}, "For: "),
            mk.ul({},
                ...forList.map(forItem =>
                    mk.li({},
                        mk.span({}, forItem)
                    ),
                ),
            ),
        );
    }
    const url = ref.url;
    const safeUrl = encodeURIComponent(url);
    const hintPanel = mk.aside({
        class: "ref-hint",
        id: `ref-hint-for-${safeUrl}`,
        "data-for": url,
        "aria-labelled-by": `ref-hint-for-${safeUrl}`,
    },
        mk.ul({},
            dfnTextElements,
            mk.li({},
                mk.b({}, "URL: "),
                mk.a({ href: url, class: "ref" }, url),
            ),
            mk.li({},
                mk.b({}, "Type: "),
                mk.span({}, `${ref.type}`),
            ),
            mk.li({},
                mk.b({}, "Spec: "),
                mk.span({}, `${ref.spec ? ref.spec : ''}`),
            ),
            forListElements
        ),
    );
    hintPanel.forLink = link;
    setupRefHintEventListeners(link, hintPanel);
    return hintPanel;
}

function hideAllRefHints() {
    queryAll(".ref-hint").forEach(el=>hideRefHint(el));
}

function hideRefHint(refHint) {
    const link = refHint.forLink;
    link.setAttribute("aria-expanded", "false");
    if(refHint.teardownEventListeners) {
        refHint.teardownEventListeners();
    }
    refHint.remove();
}

function showRefHint(link) {
    if(link.classList.contains("dfn-link")) return;
    const url = link.getAttribute("href");
    const ref = refsData[url];
    if(!ref) return;

    hideAllRefHints(); // Only display one at this time.

    const refHint = mkRefHint(link, ref);
    append(document.body, refHint);
    link.setAttribute("aria-expanded", "true");
    positionRefHint(refHint);
}

function setupRefHintEventListeners(link, refHint) {
    if (refHint.teardownEventListeners) return;
    // Add event handlers to hide the refHint after the user moves away
    // from both the link and refHint, if not hovering either within one second.
    let timeout = null;
    const startHidingRefHint = (event) => {
        if (timeout) {
            clearTimeout(timeout);
        }
        timeout = setTimeout(() => {
            hideRefHint(refHint);
        }, 1000);
    }
    const resetHidingRefHint = (event) => {
        if (timeout) clearTimeout(timeout);
        timeout = null;
    };
    link.addEventListener("mouseleave", startHidingRefHint);
    link.addEventListener("mouseenter", resetHidingRefHint);
    link.addEventListener("blur", startHidingRefHint);
    link.addEventListener("focus", resetHidingRefHint);
    refHint.addEventListener("mouseleave", startHidingRefHint);
    refHint.addEventListener("mouseenter", resetHidingRefHint);
    refHint.addEventListener("blur", startHidingRefHint);
    refHint.addEventListener("focus", resetHidingRefHint);

    refHint.teardownEventListeners = () => {
        // remove event listeners
        resetHidingRefHint();
        link.removeEventListener("mouseleave", startHidingRefHint);
        link.removeEventListener("mouseenter", resetHidingRefHint);
        link.removeEventListener("blur", startHidingRefHint);
        link.removeEventListener("focus", resetHidingRefHint);
        refHint.removeEventListener("mouseleave", startHidingRefHint);
        refHint.removeEventListener("mouseenter", resetHidingRefHint);
        refHint.removeEventListener("blur", startHidingRefHint);
        refHint.removeEventListener("focus", resetHidingRefHint);
    };
}

function positionRefHint(refHint) {
    const link = refHint.forLink;
    const linkPos = getBounds(link);
    refHint.style.top = linkPos.bottom + "px";
    refHint.style.left = linkPos.left + "px";

    const panelPos = refHint.getBoundingClientRect();
    const panelMargin = 8;
    const maxRight = document.body.parentNode.clientWidth - panelMargin;
    if (panelPos.right > maxRight) {
        const overflowAmount = panelPos.right - maxRight;
        const newLeft = Math.max(panelMargin, linkPos.left - overflowAmount);
        refHint.style.left = newLeft + "px";
    }
}

// TODO: shared util
// Returns the root-level absolute position {left and top} of element.
function getBounds(el, relativeTo=document.body) {
    const relativeRect = relativeTo.getBoundingClientRect();
    const elRect = el.getBoundingClientRect();
    const top = elRect.top - relativeRect.top;
    const left = elRect.left - relativeRect.left;
    return {
        top,
        left,
        bottom: top + elRect.height,
        right: left + elRect.width,
    }
}

function showRefHintListener(e) {
    // If the target isn't in a link (or is a link),
    // just ignore it.
    let link = e.target.closest("a");
    if(!link) return;

    // If the target is in a ref-hint panel
    // (aka a link in the already-open one),
    // also just ignore it.
    if(link.closest(".ref-hint")) return;

    // Otherwise, show the panel for the link.
    showRefHint(link);
}

function hideAllHintsListener(e) {
    // If the click is inside a ref-hint panel, ignore it.
    if(e.target.closest(".ref-hint")) return;
    // Otherwise, close all the current panels.
    hideAllRefHints();
}

document.addEventListener("DOMContentLoaded", () => {
    document.body.addEventListener("mousedown", showRefHintListener);
    document.body.addEventListener("focus", showRefHintListener);

    document.body.addEventListener("click", hideAllHintsListener);
});

window.addEventListener("resize", () => {
    // Hide any open ref hint.
    hideAllRefHints();
});
}
</script>
<script>/* Boilerplate: script-var-click-highlighting */
"use strict";
{
/*
Color-choosing design:

* Colors are ordered by goodness.
* On clicking a var, give it the earliest color
    with the lowest usage in the algorithm.
* On re-clicking, re-use the var's most recent color
    if that's not currently being used elsewhere.
*/

const COLOR_COUNT = 7;

document.addEventListener("click", e=>{
    if(e.target.nodeName == "VAR") {
        highlightSameAlgoVars(e.target);
    }
});

function highlightSameAlgoVars(v) {
    // Find the algorithm container.
    let algoContainer = findAlgoContainer(v);

    // Not highlighting document-global vars,
    // too likely to be unrelated.
    if(algoContainer == null) return;

    const varName = nameFromVar(v);
    if(!v.hasAttribute("data-var-color")) {
        const newColor = chooseHighlightColor(algoContainer, v);
        for(const el of algoContainer.querySelectorAll("var")) {
            if(nameFromVar(el) == varName) {
                el.setAttribute("data-var-color", newColor);
                el.setAttribute("data-var-last-color", newColor);
            }
        }
    } else {
        for(const el of algoContainer.querySelectorAll("var")) {
            if(nameFromVar(el) == varName) {
                el.removeAttribute("data-var-color");
            }
        }
    }
}
function findAlgoContainer(el) {
    while(el != document.body) {
        if(el.hasAttribute("data-algorithm")) return el;
        el = el.parentNode;
    }
    return null;
}
function nameFromVar(el) {
    return el.textContent.replace(/(\s|\xa0)+/g, " ").trim();
}
function colorCountsFromContainer(container) {
    const namesFromColor = Array.from({length:COLOR_COUNT}, x=>new Set());
    for(let v of container.querySelectorAll("var[data-var-color]")) {
        let color = +v.getAttribute("data-var-color");
        namesFromColor[color].add(nameFromVar(v));
    }

    return namesFromColor.map(x=>x.size);
}
function leastUsedColor(colors) {
    // Find the earliest color with the lowest count.
    let minCount = Infinity;
    let minColor = null;
    for(var i = 0; i < colors.length; i++) {
        if(colors[i] < minCount) {
            minColor = i;
            minCount = colors[i];
        }
    }
    return minColor;
}
function chooseHighlightColor(container, v) {
    const colorCounts = colorCountsFromContainer(container);
    if(v.hasAttribute("data-var-last-color")) {
        let color = +v.getAttribute("data-var-last-color");
        if(colorCounts[color] == 0) return color;
    }
    return leastUsedColor(colorCounts);
}
}
</script>