<!doctype html><html lang="en">
 <head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
  <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
  <title>Long Tasks API</title>
  <meta content="ED" name="w3c-status">
  <link href="https://www.w3.org/StyleSheets/TR/2021/W3C-ED" rel="stylesheet">
  <link href="https://w3c.github.io/longtasks/" rel="canonical">
  <meta content="dark light" name="color-scheme">
  <link href="https://www.w3.org/StyleSheets/TR/2021/dark.css" media="(prefers-color-scheme: dark)" rel="stylesheet" type="text/css">
<style>
dl {
    margin-left: 2em;
}
</style>
<style>/* Boilerplate: style-autolinks */
.css.css, .property.property, .descriptor.descriptor {
    color: var(--a-normal-text);
    font-size: inherit;
    font-family: inherit;
}
.css::before, .property::before, .descriptor::before {
    content: "‘";
}
.css::after, .property::after, .descriptor::after {
    content: "’";
}
.property, .descriptor {
    /* Don't wrap property and descriptor names */
    white-space: nowrap;
}
.type { /* CSS value <type> */
    font-style: italic;
}
pre .property::before, pre .property::after {
    content: "";
}
[data-link-type="property"]::before,
[data-link-type="propdesc"]::before,
[data-link-type="descriptor"]::before,
[data-link-type="value"]::before,
[data-link-type="function"]::before,
[data-link-type="at-rule"]::before,
[data-link-type="selector"]::before,
[data-link-type="maybe"]::before {
    content: "‘";
}
[data-link-type="property"]::after,
[data-link-type="propdesc"]::after,
[data-link-type="descriptor"]::after,
[data-link-type="value"]::after,
[data-link-type="function"]::after,
[data-link-type="at-rule"]::after,
[data-link-type="selector"]::after,
[data-link-type="maybe"]::after {
    content: "’";
}

[data-link-type].production::before,
[data-link-type].production::after,
.prod [data-link-type]::before,
.prod [data-link-type]::after {
    content: "";
}

[data-link-type=element],
[data-link-type=element-attr] {
    font-family: Menlo, Consolas, "DejaVu Sans Mono", monospace;
    font-size: .9em;
}
[data-link-type=element]::before { content: "<" }
[data-link-type=element]::after  { content: ">" }

[data-link-type=biblio] {
    white-space: pre;
}

@media (prefers-color-scheme: dark) {
    :root {
        --selflink-text: black;
        --selflink-bg: silver;
        --selflink-hover-text: white;
    }
}
</style>
<style>/* Boilerplate: style-colors */
/* Any --*-text not paired with a --*-bg is assumed to have a transparent bg */
:root {
    color-scheme: light dark;

    --text: black;
    --bg: white;

    --unofficial-watermark: url(https://www.w3.org/StyleSheets/TR/2016/logos/UD-watermark);

    --logo-bg: #1a5e9a;
    --logo-active-bg: #c00;
    --logo-text: white;

    --tocnav-normal-text: #707070;
    --tocnav-normal-bg: var(--bg);
    --tocnav-hover-text: var(--tocnav-normal-text);
    --tocnav-hover-bg: #f8f8f8;
    --tocnav-active-text: #c00;
    --tocnav-active-bg: var(--tocnav-normal-bg);

    --tocsidebar-text: var(--text);
    --tocsidebar-bg: #f7f8f9;
    --tocsidebar-shadow: rgba(0,0,0,.1);
    --tocsidebar-heading-text: hsla(203,20%,40%,.7);

    --toclink-text: var(--text);
    --toclink-underline: #3980b5;
    --toclink-visited-text: var(--toclink-text);
    --toclink-visited-underline: #054572;

    --heading-text: #005a9c;

    --hr-text: var(--text);

    --algo-border: #def;

    --del-text: red;
    --del-bg: transparent;
    --ins-text: #080;
    --ins-bg: transparent;

    --a-normal-text: #034575;
    --a-normal-underline: #bbb;
    --a-visited-text: var(--a-normal-text);
    --a-visited-underline: #707070;
    --a-hover-bg: rgba(75%, 75%, 75%, .25);
    --a-active-text: #c00;
    --a-active-underline: #c00;

    --blockquote-border: silver;
    --blockquote-bg: transparent;
    --blockquote-text: currentcolor;

    --issue-border: #e05252;
    --issue-bg: #fbe9e9;
    --issue-text: var(--text);
    --issueheading-text: #831616;

    --example-border: #e0cb52;
    --example-bg: #fcfaee;
    --example-text: var(--text);
    --exampleheading-text: #574b0f;

    --note-border: #52e052;
    --note-bg: #e9fbe9;
    --note-text: var(--text);
    --noteheading-text: hsl(120, 70%, 30%);
    --notesummary-underline: silver;

    --assertion-border: #aaa;
    --assertion-bg: #eee;
    --assertion-text: black;

    --advisement-border: orange;
    --advisement-bg: #fec;
    --advisement-text: var(--text);
    --advisementheading-text: #b35f00;

    --warning-border: red;
    --warning-bg: hsla(40,100%,50%,0.95);
    --warning-text: var(--text);

    --amendment-border: #330099;
    --amendment-bg: #F5F0FF;
    --amendment-text: var(--text);
    --amendmentheading-text: #220066;

    --def-border: #8ccbf2;
    --def-bg: #def;
    --def-text: var(--text);
    --defrow-border: #bbd7e9;

    --datacell-border: silver;

    --indexinfo-text: #707070;

    --indextable-hover-text: black;
    --indextable-hover-bg: #f7f8f9;

    --outdatedspec-bg: rgba(0, 0, 0, .5);
    --outdatedspec-text: black;
    --outdated-bg: maroon;
    --outdated-text: white;
    --outdated-shadow: red;

    --editedrec-bg: darkorange;
}

@media (prefers-color-scheme: dark) {
    :root {
        --text: #ddd;
        --bg: black;

        --unofficial-watermark: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='400'%3E%3Cg fill='%23100808' transform='translate(200 200) rotate(-45) translate(-200 -200)' stroke='%23100808' stroke-width='3'%3E%3Ctext x='50%25' y='220' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EUNOFFICIAL%3C/text%3E%3Ctext x='50%25' y='305' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EDRAFT%3C/text%3E%3C/g%3E%3C/svg%3E");

        --logo-bg: #1a5e9a;
        --logo-active-bg: #c00;
        --logo-text: white;

        --tocnav-normal-text: #999;
        --tocnav-normal-bg: var(--bg);
        --tocnav-hover-text: var(--tocnav-normal-text);
        --tocnav-hover-bg: #080808;
        --tocnav-active-text: #f44;
        --tocnav-active-bg: var(--tocnav-normal-bg);

        --tocsidebar-text: var(--text);
        --tocsidebar-bg: #080808;
        --tocsidebar-shadow: rgba(255,255,255,.1);
        --tocsidebar-heading-text: hsla(203,20%,40%,.7);

        --toclink-text: var(--text);
        --toclink-underline: #6af;
        --toclink-visited-text: var(--toclink-text);
        --toclink-visited-underline: #054572;

        --heading-text: #8af;

        --hr-text: var(--text);

        --algo-border: #456;

        --del-text: #f44;
        --del-bg: transparent;
        --ins-text: #4a4;
        --ins-bg: transparent;

        --a-normal-text: #6af;
        --a-normal-underline: #555;
        --a-visited-text: var(--a-normal-text);
        --a-visited-underline: var(--a-normal-underline);
        --a-hover-bg: rgba(25%, 25%, 25%, .2);
        --a-active-text: #f44;
        --a-active-underline: var(--a-active-text);

        --borderedblock-bg: rgba(255, 255, 255, .05);

        --blockquote-border: silver;
        --blockquote-bg: var(--borderedblock-bg);
        --blockquote-text: currentcolor;

        --issue-border: #e05252;
        --issue-bg: var(--borderedblock-bg);
        --issue-text: var(--text);
        --issueheading-text: hsl(0deg, 70%, 70%);

        --example-border: hsl(50deg, 90%, 60%);
        --example-bg: var(--borderedblock-bg);
        --example-text: var(--text);
        --exampleheading-text: hsl(50deg, 70%, 70%);

        --note-border: hsl(120deg, 100%, 35%);
        --note-bg: var(--borderedblock-bg);
        --note-text: var(--text);
        --noteheading-text: hsl(120, 70%, 70%);
        --notesummary-underline: silver;

        --assertion-border: #444;
        --assertion-bg: var(--borderedblock-bg);
        --assertion-text: var(--text);

        --advisement-border: orange;
        --advisement-bg: #222218;
        --advisement-text: var(--text);
        --advisementheading-text: #f84;

        --warning-border: red;
        --warning-bg: hsla(40,100%,20%,0.95);
        --warning-text: var(--text);

        --amendment-border: #330099;
        --amendment-bg: #080010;
        --amendment-text: var(--text);
        --amendmentheading-text: #cc00ff;

        --def-border: #8ccbf2;
        --def-bg: #080818;
        --def-text: var(--text);
        --defrow-border: #136;

        --datacell-border: silver;

        --indexinfo-text: #aaa;

        --indextable-hover-text: var(--text);
        --indextable-hover-bg: #181818;

        --outdatedspec-bg: rgba(255, 255, 255, .5);
        --outdatedspec-text: black;
        --outdated-bg: maroon;
        --outdated-text: white;
        --outdated-shadow: red;

        --editedrec-bg: darkorange;
    }
    /* In case a transparent-bg image doesn't expect to be on a dark bg,
       which is quite common in practice... */
    img { background: white; }
}
</style>
<style>/* Boilerplate: style-counters */
body {
    counter-reset: example figure issue;
}
.issue {
    counter-increment: issue;
}
.issue:not(.no-marker)::before {
    content: "Issue " counter(issue);
}

.example {
    counter-increment: example;
}
.example:not(.no-marker)::before {
    content: "Example " counter(example);
}
.invalid.example:not(.no-marker)::before,
.illegal.example:not(.no-marker)::before {
    content: "Invalid Example" counter(example);
}

figcaption {
    counter-increment: figure;
}
figcaption:not(.no-marker)::before {
    content: "Figure " counter(figure) " ";
}
</style>
<style>/* Boilerplate: style-dfn-panel */
:root {
    --dfnpanel-bg: #ddd;
    --dfnpanel-text: var(--text);
    --dfnpanel-target-bg: #ffc;
    --dfnpanel-target-outline: orange;
}
@media (prefers-color-scheme: dark) {
    :root {
        --dfnpanel-bg: #222;
        --dfnpanel-text: var(--text);
        --dfnpanel-target-bg: #333;
        --dfnpanel-target-outline: silver;
    }
}
.dfn-panel {
    position: absolute;
    z-index: 35;
    width: 20em;
    width: 300px;
    height: auto;
    max-height: 500px;
    overflow: auto;
    padding: 0.5em 0.75em;
    font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
    background: var(--dfnpanel-bg);
    color: var(--dfnpanel-text);
    border: outset 0.2em;
    white-space: normal; /* in case it's moved into a pre */
}
.dfn-panel:not(.on) { display: none; }
.dfn-panel * { margin: 0; padding: 0; text-indent: 0; }
.dfn-panel > b { display: block; }
.dfn-panel a { color: var(--dfnpanel-text); }
.dfn-panel a:not(:hover) { text-decoration: none !important; border-bottom: none !important; }
.dfn-panel a:focus {
    outline: 5px auto Highlight;
    outline: 5px auto -webkit-focus-ring-color;
}
.dfn-panel > b + b { margin-top: 0.25em; }
.dfn-panel ul { padding: 0 0 0 1em; list-style: none; }
.dfn-panel li a {
    max-width: calc(300px - 1.5em - 1em);
    overflow: hidden;
    text-overflow: ellipsis;
}

.dfn-panel.activated {
    display: inline-block;
    position: fixed;
    left: 8px;
    bottom: 2em;
    margin: 0 auto;
    max-width: calc(100vw - 1.5em - .4em - .5em);
    max-height: 30vh;
    transition: left 1s ease-out, bottom 1s ease-out;
}

.dfn-panel .link-item:hover {
    text-decoration: underline;
}
.dfn-panel .link-item .copy-icon {
    opacity: 0;
}
.dfn-panel .link-item:hover .copy-icon,
.dfn-panel .link-item .copy-icon:focus {
    opacity: 1;
}

.dfn-panel .copy-icon {
    display: inline-block;
    margin-right: 0.5em;
    width: 0.85em;
    height: 1em;
    border-radius: 3px;
    background-color: #ccc;
    cursor: pointer;
}

.dfn-panel .copy-icon .icon {
    width: 100%;
    height: 100%;
    background-color: #fff;
    display: flex;
    justify-content: center;
    align-items: center;
    position: relative;
}

.dfn-panel .copy-icon .icon::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    border: 1px solid black;
    background-color: #ccc;
    opacity: 0.25;
    transform: translate(3px, -3px);
}

.dfn-panel .copy-icon:active .icon::before {
    opacity: 1;
}

.dfn-paneled[role="button"] { cursor: help; }

.highlighted {
    animation: target-fade 3s;
}

@keyframes target-fade {
    from {
        background-color: var(--dfnpanel-target-bg);
        outline: 5px solid var(--dfnpanel-target-outline);
    }
    to {
        color: var(--a-normal-text);
        background-color: transparent;
        outline: transparent;
    }
}
</style>
<style>/* Boilerplate: style-idl-highlighting */
pre.idl.highlight {
    background: var(--borderedblock-bg, var(--def-bg));
}
</style>
<style>/* Boilerplate: style-issues */
a[href].issue-return {
    float: right;
    float: inline-end;
    color: var(--issueheading-text);
    font-weight: bold;
    text-decoration: none;
}
</style>
<style>/* Boilerplate: style-md-lists */
/* This is a weird hack for me not yet following the commonmark spec
   regarding paragraph and lists. */
[data-md] > :first-child {
    margin-top: 0;
}
[data-md] > :last-child {
    margin-bottom: 0;
}
</style>
<style>/* Boilerplate: style-mdn-anno */
:root {
	--mdn-bg: #EEE;
	--mdn-shadow: #999;
	--mdn-nosupport-text: #ccc;
	--mdn-pass: green;
	--mdn-fail: red;
}
@media (prefers-color-scheme: dark) {
	:root {
		--mdn-bg: #222;
		--mdn-shadow: #444;
		--mdn-nosupport-text: #666;
		--mdn-pass: #690;
		--mdn-fail: #d22;
	}
}
.mdn-anno {
	background: var(--mdn-bg, #EEE);
	border-radius: .25em;
	box-shadow: 0 0 3px var(--mdn-shadow, #999);
	color: var(--text, black);
	font: 1em sans-serif;
	hyphens: none;
	max-width: min-content;
	overflow: hidden;
	padding: 0.2em;
	position: absolute;
	right: 0.3em;
	top: auto;
	white-space: nowrap;
	word-wrap: normal;
	z-index: 8;
}
.mdn-anno.unpositioned {
	display: none;
}
.mdn-anno.overlapping-main {
	opacity: .2;
	transition: opacity .1s;
}
.mdn-anno[open] {
	opacity: 1;
	z-index: 9;
	min-width: 9em;
}
.mdn-anno:hover {
	opacity: 1;
	outline: var(--text, black) 1px solid;
}
.mdn-anno > summary {
	font-weight: normal;
	text-align: right;
	cursor: pointer;
	display: block;
}
.mdn-anno > summary > .less-than-two-engines-flag {
	color: var(--mdn-fail);
	padding-right: 2px;
}
.mdn-anno > summary > .all-engines-flag {
	color: var(--mdn-pass);
	padding-right: 2px;
}
.mdn-anno > summary > span {
	color: #fff;
	background-color: #000;
	font-weight: normal;
	font-family: zillaslab, Palatino, "Palatino Linotype", serif;
	padding: 2px 3px 0px 3px;
	line-height: 1.3em;
	vertical-align: top;
}
.mdn-anno > .feature {
	margin-top: 20px;
}
.mdn-anno > .feature:not(:first-of-type) {
	border-top: 1px solid #999;
	margin-top: 6px;
	padding-top: 2px;
}
.mdn-anno > .feature > .less-than-two-engines-text {
	color: var(--mdn-fail);
}
.mdn-anno > .feature > .all-engines-text {
	color: var(--mdn-pass);
}
.mdn-anno > .feature > p {
	font-size: .75em;
	margin-top: 6px;
	margin-bottom: 0;
}
.mdn-anno > .feature > p + p {
	margin-top: 3px;
}
.mdn-anno > .feature > .support {
	display: block;
	font-size: 0.6em;
	margin: 0;
	padding: 0;
	margin-top: 2px;
}
.mdn-anno > .feature > .support + div {
	padding-top: 0.5em;
}
.mdn-anno > .feature > .support > hr {
	display: block;
	border: none;
	border-top: 1px dotted #999;
	padding: 3px 0px 0px 0px;
	margin: 2px 3px 0px 3px;
}
.mdn-anno > .feature > .support > hr::before {
	content: "";
}
.mdn-anno > .feature > .support > span {
	padding: 0.2em 0;
	display: block;
	display: table;
}
.mdn-anno > .feature > .support > span.no {
	color: var(--mdn-nosupport-text);
	filter: grayscale(100%);
}
.mdn-anno > .feature > .support > span.no::before {
	opacity: 0.5;
}
.mdn-anno > .feature > .support > span:first-of-type {
	padding-top: 0.5em;
}
.mdn-anno > .feature > .support > span > span {
	padding: 0 0.5em;
	display: table-cell;
}
.mdn-anno > .feature > .support > span > span:first-child {
	width: 100%;
}
.mdn-anno > .feature > .support > span > span:last-child {
	width: 100%;
	white-space: pre;
	padding: 0;
}
.mdn-anno > .feature > .support > span::before {
	content: ' ';
	display: table-cell;
	min-width: 1.5em;
	height: 1.5em;
	background: no-repeat center center;
	background-size: contain;
	text-align: right;
	font-size: 0.75em;
	font-weight: bold;
}
.mdn-anno > .feature > .support > .chrome_android::before {
	background-image: url(https://resources.whatwg.org/browser-logos/chrome.svg);
}
.mdn-anno > .feature > .support > .firefox_android::before {
	background-image: url(https://resources.whatwg.org/browser-logos/firefox.png);
}
.mdn-anno > .feature > .support > .chrome::before {
	background-image: url(https://resources.whatwg.org/browser-logos/chrome.svg);
}
.mdn-anno > .feature > .support > .edge_blink::before {
	background-image: url(https://resources.whatwg.org/browser-logos/edge.svg);
}
.mdn-anno > .feature > .support > .edge::before {
	background-image: url(https://resources.whatwg.org/browser-logos/edge_legacy.svg);
}
.mdn-anno > .feature > .support > .firefox::before {
	background-image: url(https://resources.whatwg.org/browser-logos/firefox.png);
}
.mdn-anno > .feature > .support > .ie::before {
	background-image: url(https://resources.whatwg.org/browser-logos/ie.png);
}
.mdn-anno > .feature > .support > .safari_ios::before {
	background-image: url(https://resources.whatwg.org/browser-logos/safari-ios.svg);
}
.mdn-anno > .feature > .support > .nodejs::before {
	background-image: url(https://nodejs.org/static/images/favicons/favicon.ico);
}
.mdn-anno > .feature > .support > .opera_android::before {
	background-image: url(https://resources.whatwg.org/browser-logos/opera.svg);
}
.mdn-anno > .feature > .support > .opera::before {
	background-image: url(https://resources.whatwg.org/browser-logos/opera.svg);
}
.mdn-anno > .feature > .support > .safari::before {
	background-image: url(https://resources.whatwg.org/browser-logos/safari.png);
}
.mdn-anno > .feature > .support > .samsunginternet_android::before {
	background-image: url(https://resources.whatwg.org/browser-logos/samsung.svg);
}
.mdn-anno > .feature > .support > .webview_android::before {
	background-image: url(https://resources.whatwg.org/browser-logos/android-webview.png);
}
.name-slug-mismatch {
	color: red;
}
.caniuse-status:hover {
	z-index: 9;
}
/* dt, li, .issue, .note, and .example are "position: relative", so to put annotation at right margin, must move to right of containing block */;
.h-entry:not(.status-LS) dt > .mdn-anno, .h-entry:not(.status-LS) li > .mdn-anno, .h-entry:not(.status-LS) .issue > .mdn-anno, .h-entry:not(.status-LS) .note > .mdn-anno, .h-entry:not(.status-LS) .example > .mdn-anno {
	right: -6.7em;
}
.h-entry p + .mdn-anno {
	margin-top: 0;
}
 h2 + .mdn-anno.after {
	margin: -48px 0 0 0;
}
 h3 + .mdn-anno.after {
	margin: -46px 0 0 0;
}
 h4 + .mdn-anno.after {
	margin: -42px 0 0 0;
}
 h5 + .mdn-anno.after {
	margin: -40px 0 0 0;
}
 h6 + .mdn-anno.after {
	margin: -40px 0 0 0;
}
</style>
<style>/* Boilerplate: style-ref-hints */
:root {
    --ref-hint-bg: #ddd;
    --ref-hint-text: var(--text);
}
@media (prefers-color-scheme: dark) {
    :root {
        --ref-hint-bg: #222;
        --ref-hint-text: var(--text);
    }
}

.ref-hint {
    display: inline-block;
    position: absolute;
    z-index: 35;
    width: 20em;
    width: 300px;
    height: auto;
    max-height: 500px;
    overflow: auto;
    padding: 0.5em 0.5em;
    font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
    background: var(--ref-hint-bg);
    color: var(--ref-hint-text);
    border: outset 0.2em;
    white-space: normal; /* in case it's moved into a pre */
}

.ref-hint * { margin: 0; padding: 0; text-indent: 0; }

.ref-hint ul { padding: 0 0 0 1em; list-style: none; }
</style>
<style>/* Boilerplate: style-selflinks */
:root {
    --selflink-text: white;
    --selflink-bg: gray;
    --selflink-hover-text: black;
}
.heading, .issue, .note, .example, li, dt {
    position: relative;
}
a.self-link {
    position: absolute;
    top: 0;
    left: calc(-1 * (3.5rem - 26px));
    width: calc(3.5rem - 26px);
    height: 2em;
    text-align: center;
    border: none;
    transition: opacity .2s;
    opacity: .5;
}
a.self-link:hover {
    opacity: 1;
}
.heading > a.self-link {
    font-size: 83%;
}
.example > a.self-link,
.note > a.self-link,
.issue > a.self-link {
    /* These blocks are overflow:auto, so positioning outside
       doesn't work. */
    left: auto;
    right: 0;
}
li > a.self-link {
    left: calc(-1 * (3.5rem - 26px) - 2em);
}
dfn > a.self-link {
    top: auto;
    left: auto;
    opacity: 0;
    width: 1.5em;
    height: 1.5em;
    background: var(--selflink-bg);
    color: var(--selflink-text);
    font-style: normal;
    transition: opacity .2s, background-color .2s, color .2s;
}
dfn:hover > a.self-link {
    opacity: 1;
}
dfn > a.self-link:hover {
    color: var(--selflink-hover-text);
}

a.self-link::before            { content: "¶"; }
.heading > a.self-link::before { content: "§"; }
dfn > a.self-link::before      { content: "#"; }
</style>
<style>/* Boilerplate: style-syntax-highlighting */
code.highlight { padding: .1em; border-radius: .3em; }
pre.highlight, pre > code.highlight { display: block; padding: 1em; margin: .5em 0; overflow: auto; border-radius: 0; }

.highlight:not(.idl) { background: rgba(0, 0, 0, .03); }
c-[a] { color: #990055 } /* Keyword.Declaration */
c-[b] { color: #990055 } /* Keyword.Type */
c-[c] { color: #708090 } /* Comment */
c-[d] { color: #708090 } /* Comment.Multiline */
c-[e] { color: #0077aa } /* Name.Attribute */
c-[f] { color: #669900 } /* Name.Tag */
c-[g] { color: #222222 } /* Name.Variable */
c-[k] { color: #990055 } /* Keyword */
c-[l] { color: #000000 } /* Literal */
c-[m] { color: #000000 } /* Literal.Number */
c-[n] { color: #0077aa } /* Name */
c-[o] { color: #999999 } /* Operator */
c-[p] { color: #999999 } /* Punctuation */
c-[s] { color: #a67f59 } /* Literal.String */
c-[t] { color: #a67f59 } /* Literal.String.Single */
c-[u] { color: #a67f59 } /* Literal.String.Double */
c-[cp] { color: #708090 } /* Comment.Preproc */
c-[c1] { color: #708090 } /* Comment.Single */
c-[cs] { color: #708090 } /* Comment.Special */
c-[kc] { color: #990055 } /* Keyword.Constant */
c-[kn] { color: #990055 } /* Keyword.Namespace */
c-[kp] { color: #990055 } /* Keyword.Pseudo */
c-[kr] { color: #990055 } /* Keyword.Reserved */
c-[ld] { color: #000000 } /* Literal.Date */
c-[nc] { color: #0077aa } /* Name.Class */
c-[no] { color: #0077aa } /* Name.Constant */
c-[nd] { color: #0077aa } /* Name.Decorator */
c-[ni] { color: #0077aa } /* Name.Entity */
c-[ne] { color: #0077aa } /* Name.Exception */
c-[nf] { color: #0077aa } /* Name.Function */
c-[nl] { color: #0077aa } /* Name.Label */
c-[nn] { color: #0077aa } /* Name.Namespace */
c-[py] { color: #0077aa } /* Name.Property */
c-[ow] { color: #999999 } /* Operator.Word */
c-[mb] { color: #000000 } /* Literal.Number.Bin */
c-[mf] { color: #000000 } /* Literal.Number.Float */
c-[mh] { color: #000000 } /* Literal.Number.Hex */
c-[mi] { color: #000000 } /* Literal.Number.Integer */
c-[mo] { color: #000000 } /* Literal.Number.Oct */
c-[sb] { color: #a67f59 } /* Literal.String.Backtick */
c-[sc] { color: #a67f59 } /* Literal.String.Char */
c-[sd] { color: #a67f59 } /* Literal.String.Doc */
c-[se] { color: #a67f59 } /* Literal.String.Escape */
c-[sh] { color: #a67f59 } /* Literal.String.Heredoc */
c-[si] { color: #a67f59 } /* Literal.String.Interpol */
c-[sx] { color: #a67f59 } /* Literal.String.Other */
c-[sr] { color: #a67f59 } /* Literal.String.Regex */
c-[ss] { color: #a67f59 } /* Literal.String.Symbol */
c-[vc] { color: #0077aa } /* Name.Variable.Class */
c-[vg] { color: #0077aa } /* Name.Variable.Global */
c-[vi] { color: #0077aa } /* Name.Variable.Instance */
c-[il] { color: #000000 } /* Literal.Number.Integer.Long */

@media (prefers-color-scheme: dark) {
    .highlight:not(.idl) { background: rgba(255, 255, 255, .05); }

    c-[a] { color: #d33682 } /* Keyword.Declaration */
    c-[b] { color: #d33682 } /* Keyword.Type */
    c-[c] { color: #2aa198 } /* Comment */
    c-[d] { color: #2aa198 } /* Comment.Multiline */
    c-[e] { color: #268bd2 } /* Name.Attribute */
    c-[f] { color: #b58900 } /* Name.Tag */
    c-[g] { color: #cb4b16 } /* Name.Variable */
    c-[k] { color: #d33682 } /* Keyword */
    c-[l] { color: #657b83 } /* Literal */
    c-[m] { color: #657b83 } /* Literal.Number */
    c-[n] { color: #268bd2 } /* Name */
    c-[o] { color: #657b83 } /* Operator */
    c-[p] { color: #657b83 } /* Punctuation */
    c-[s] { color: #6c71c4 } /* Literal.String */
    c-[t] { color: #6c71c4 } /* Literal.String.Single */
    c-[u] { color: #6c71c4 } /* Literal.String.Double */
    c-[ch] { color: #2aa198 } /* Comment.Hashbang */
    c-[cp] { color: #2aa198 } /* Comment.Preproc */
    c-[cpf] { color: #2aa198 } /* Comment.PreprocFile */
    c-[c1] { color: #2aa198 } /* Comment.Single */
    c-[cs] { color: #2aa198 } /* Comment.Special */
    c-[kc] { color: #d33682 } /* Keyword.Constant */
    c-[kn] { color: #d33682 } /* Keyword.Namespace */
    c-[kp] { color: #d33682 } /* Keyword.Pseudo */
    c-[kr] { color: #d33682 } /* Keyword.Reserved */
    c-[ld] { color: #657b83 } /* Literal.Date */
    c-[nc] { color: #268bd2 } /* Name.Class */
    c-[no] { color: #268bd2 } /* Name.Constant */
    c-[nd] { color: #268bd2 } /* Name.Decorator */
    c-[ni] { color: #268bd2 } /* Name.Entity */
    c-[ne] { color: #268bd2 } /* Name.Exception */
    c-[nf] { color: #268bd2 } /* Name.Function */
    c-[nl] { color: #268bd2 } /* Name.Label */
    c-[nn] { color: #268bd2 } /* Name.Namespace */
    c-[py] { color: #268bd2 } /* Name.Property */
    c-[ow] { color: #657b83 } /* Operator.Word */
    c-[mb] { color: #657b83 } /* Literal.Number.Bin */
    c-[mf] { color: #657b83 } /* Literal.Number.Float */
    c-[mh] { color: #657b83 } /* Literal.Number.Hex */
    c-[mi] { color: #657b83 } /* Literal.Number.Integer */
    c-[mo] { color: #657b83 } /* Literal.Number.Oct */
    c-[sa] { color: #6c71c4 } /* Literal.String.Affix */
    c-[sb] { color: #6c71c4 } /* Literal.String.Backtick */
    c-[sc] { color: #6c71c4 } /* Literal.String.Char */
    c-[dl] { color: #6c71c4 } /* Literal.String.Delimiter */
    c-[sd] { color: #6c71c4 } /* Literal.String.Doc */
    c-[se] { color: #6c71c4 } /* Literal.String.Escape */
    c-[sh] { color: #6c71c4 } /* Literal.String.Heredoc */
    c-[si] { color: #6c71c4 } /* Literal.String.Interpol */
    c-[sx] { color: #6c71c4 } /* Literal.String.Other */
    c-[sr] { color: #6c71c4 } /* Literal.String.Regex */
    c-[ss] { color: #6c71c4 } /* Literal.String.Symbol */
    c-[fm] { color: #268bd2 } /* Name.Function.Magic */
    c-[vc] { color: #cb4b16 } /* Name.Variable.Class */
    c-[vg] { color: #cb4b16 } /* Name.Variable.Global */
    c-[vi] { color: #cb4b16 } /* Name.Variable.Instance */
    c-[vm] { color: #cb4b16 } /* Name.Variable.Magic */
    c-[il] { color: #657b83 } /* Literal.Number.Integer.Long */
}
</style>
<style>/* Boilerplate: style-var-click-highlighting */
/*
Colors were chosen in Lab using https://nixsensor.com/free-color-converter/
D50 2deg illuminant, L in [0,100], a and b in [-128, 128]
0 = lab(85,0,85)
1 = lab(85,80,30)
2 = lab(85,-40,40)
3 = lab(85,-50,0)
4 = lab(85,5,15)
5 = lab(85,-10,-50)
6 = lab(85,35,-15)

For darkmode:
0 = oklab(50%   0%  108%)
1 = oklab(50% -51%   51%)
2 = oklab(50% -64%  -20%)
3 = oklab(50%   6%   19%)
4 = oklab(50% -12%  -64%)
5 = oklab(50%  44%  -19%)  
6 = oklab(50% 102%   38%)
*/

[data-algorithm] var { cursor: pointer; }
var[data-var-color] { background-color: var(--var-bg); box-shadow: 0 0 0 2px var(--var-bg); }

var[data-var-color] { --var-bg: #F4D200; }
var[data-var-color="1"] { --var-bg: #FF87A2; }
var[data-var-color="2"] { --var-bg: #96E885; }
var[data-var-color="3"] { --var-bg: #3EEED2; }
var[data-var-color="4"] { --var-bg: #EACFB6; }
var[data-var-color="5"] { --var-bg: #82DDFF; }
var[data-var-color="6"] { --var-vg: #FFBCF2; }

@media (prefers-color-scheme: dark) {
	var[data-var-color] { --var-bg: #bc1a00; }
	var[data-var-color="1"] { --var-bg: #007f00; }
	var[data-var-color="2"] { --var-bg: #008698; }
	var[data-var-color="3"] { --var-bg: #7f5b2b; }
	var[data-var-color="4"] { --var-bg: #004df3; }
	var[data-var-color="5"] { --var-bg: #a1248a; }
	var[data-var-color="6"] { --var-vg: #ff0000; }
}
</style>
 <body class="h-entry">
  <div class="head">
   <p data-fill-with="logo"><a class="logo" href="https://www.w3.org/"> <img alt="W3C" height="48" src="https://www.w3.org/StyleSheets/TR/2021/logos/W3C" width="72"> </a> </p>
   <h1 class="p-name no-ref" id="title">Long Tasks API</h1>
   <p id="w3c-state"><a href="https://www.w3.org/standards/types#ED">Editor’s Draft</a>, <time class="dt-updated" datetime="1970-01-01">1 January 1970</time></p>
   <details open>
    <summary>More details about this document</summary>
    <div data-fill-with="spec-metadata">
     <dl>
      <dt>This version:
      <dd><a class="u-url" href="https://w3c.github.io/longtasks/">https://w3c.github.io/longtasks/</a>
      <dt>Test Suite:
      <dd><a href="http://w3c-test.org/longtask-timing/">http://w3c-test.org/longtask-timing/</a>
      <dt class="editor">Editors:
      <dd class="editor p-author h-card vcard"><a class="p-name fn u-email email" href="mailto:panicker@chromium.org">Shubhie Panicker</a> (<a class="p-org org" href="https://google.com">Google</a>)
      <dd class="editor p-author h-card vcard"><a class="p-name fn u-email email" href="mailto:igrigorik@chromium.org">Ilya Grigorik</a> (<a class="p-org org" href="https://google.com">Google</a>)
      <dd class="editor p-author h-card vcard"><a class="p-name fn u-email email" href="mailto:domenic@chromium.org">Domenic Denicola</a> (<a class="p-org org" href="https://google.com">Google</a>)
     </dl>
    </div>
   </details>
   <div data-fill-with="warning"></div>
   <p class="copyright" data-fill-with="copyright"><a href="https://www.w3.org/policies/#copyright">Copyright</a> © 1970 <a href="https://www.w3.org/">World Wide Web Consortium</a>. <abbr title="World Wide Web Consortium">W3C</abbr><sup>®</sup> <a href="https://www.w3.org/policies/#Legal_Disclaimer">liability</a>, <a href="https://www.w3.org/policies/#W3C_Trademarks">trademark</a> and <a href="https://www.w3.org/copyright/software-license/" rel="license" title="W3C Software and Document License">permissive document license</a> rules apply. </p>
   <hr title="Separator for header">
  </div>
  <div class="p-summary" data-fill-with="abstract">
   <h2 class="no-num no-toc no-ref heading settled" id="abstract"><span class="content">Abstract</span></h2>
   <p>This document defines an API that web page authors can use to detect presence of "long tasks" that monopolize the UI thread for extended periods of time and block other critical tasks from being executed - e.g. reacting to user input.</p>
  </div>
  <h2 class="no-num no-toc no-ref heading settled" id="sotd"><span class="content">Status of this document</span></h2>
  <div data-fill-with="status">
   <p> This is a public copy of the editors’ draft.
	It is provided for discussion only and may change at any moment.
	Its publication here does not imply endorsement of its contents by W3C.
	Don’t cite this document other than as work in progress. </p>
   <p><a href="https://github.com/w3c/longtasks/issues">GitHub Issues</a> are preferred for discussion of this specification. </p>
   <p>This document is governed by the <a href="https://www.w3.org/policies/process/20231103/" id="w3c_process_revision">03 November 2023 W3C Process Document</a>. </p>
   <p></p>
   <p>If you wish to make comments regarding this document, please send them to <a href="mailto:public-web-perf@w3.org?subject=%5BLongTasks%5D">public-web-perf@w3.org</a> (<a href="mailto:public-web-perf-request@w3.org?subject=subscribe">subscribe</a>, <a href="https://lists.w3.org/Archives/Public/public-web-perf/">archives</a>) with <code>[LongTasks]</code> at the start of your email’s subject.</p>
  </div>
  <div data-fill-with="at-risk"></div>
  <nav data-fill-with="table-of-contents" id="toc">
   <h2 class="no-num no-toc no-ref" id="contents">Table of Contents</h2>
   <ol class="toc" role="directory">
    <li>
     <a href="#intro"><span class="secno">1</span> <span class="content">Introduction</span></a>
     <ol class="toc">
      <li><a href="#example"><span class="secno">1.1</span> <span class="content">Usage Example</span></a>
     </ol>
    <li><a href="#sec-terminology"><span class="secno">2</span> <span class="content">Terminology</span></a>
    <li>
     <a href="#sec-longtask-timing"><span class="secno">3</span> <span class="content">Long Task Timing</span></a>
     <ol class="toc">
      <li><a href="#sec-PerformanceLongTaskTiming"><span class="secno">3.1</span> <span class="content"><code class="idl"><span>PerformanceLongTaskTiming</span></code> interface</span></a>
      <li><a href="#sec-TaskAttributionTiming"><span class="secno">3.2</span> <span class="content"><code class="idl"><span>TaskAttributionTiming</span></code> interface</span></a>
      <li><a href="#sec-PointingToCulprit"><span class="secno">3.3</span> <span class="content">Pointing to the culprit</span></a>
     </ol>
    <li>
     <a href="#sec-processing-model"><span class="secno">4</span> <span class="content">Processing model</span></a>
     <ol class="toc">
      <li><a href="#report-long-tasks"><span class="secno">4.1</span> <span class="content">Report long tasks</span></a>
     </ol>
    <li>
     <a href="#priv-sec"><span class="secno">5</span> <span class="content">Security &amp; privacy considerations</span></a>
     <ol class="toc">
      <li><a href="#what-is-exposed"><span class="secno">5.1</span> <span class="content">What is Exposed to Observers?</span></a>
      <li><a href="#attack-scenarios"><span class="secno">5.2</span> <span class="content">Attack Scenarios Considered</span></a>
     </ol>
    <li>
     <a href="#w3c-conformance"><span class="secno"></span> <span class="content">Conformance</span></a>
     <ol class="toc">
      <li><a href="#w3c-conventions"><span class="secno"></span> <span class="content">Document conventions</span></a>
      <li><a href="#w3c-conformant-algorithms"><span class="secno"></span> <span class="content">Conformant Algorithms</span></a>
     </ol>
    <li>
     <a href="#index"><span class="secno"></span> <span class="content">Index</span></a>
     <ol class="toc">
      <li><a href="#index-defined-here"><span class="secno"></span> <span class="content">Terms defined by this specification</span></a>
      <li><a href="#index-defined-elsewhere"><span class="secno"></span> <span class="content">Terms defined by reference</span></a>
     </ol>
    <li>
     <a href="#references"><span class="secno"></span> <span class="content">References</span></a>
     <ol class="toc">
      <li><a href="#normative"><span class="secno"></span> <span class="content">Normative References</span></a>
     </ol>
    <li><a href="#idl-index"><span class="secno"></span> <span class="content">IDL Index</span></a>
    <li><a href="#issues-index"><span class="secno"></span> <span class="content">Issues Index</span></a>
   </ol>
  </nav>
  <main>
   <h2 class="heading settled" data-level="1" id="intro"><span class="secno">1. </span><span class="content">Introduction</span><a class="self-link" href="#intro"></a></h2>
   <p>As the page is loading and while the user is interacting with the page afterwards, both the application and browser queue various events that are then executed by the browser -- e.g. user agent schedules input events based on user’s activity, the application schedules callbacks for requestAnimationFrame and other callbacks, etc. Once in the queue, the browser dequeues these events one-by-one and executes them.</p>
   <p>However, some tasks can take a long time (multiple frames) and if/when that happens, the UI thread may become blocked and block all other tasks as well. To the user, this is commonly visible as a "locked up" page where the browser is unable to respond to user input; this is a major source of bad user experience on the web today:</p>
   <dl>
    <dt data-md>Delayed "time to Interactive":
    <dd data-md>
     <p>while the page is loading, or even completely visually rendered, long tasks often tie up the main thread and prevent the user from interacting with the page. Poorly designed third-party content is frequently the culprit.</p>
    <dt data-md>High/variable input latency:
    <dd data-md>
     <p>critical user-interaction events (e.g. tap, click, scroll, wheel, etc.) are queued behind long tasks which yields janky and unpredictable user experience.</p>
    <dt data-md>High/variable event handling latency:
    <dd data-md>
     <p>like input, processing event callbacks (e.g. onload events, etc.) delay application updates.</p>
    <dt data-md>Janky animations and scrolling:
    <dd data-md>
     <p>some animation and scrolling interactions require coordination between compositor and main threads; if a long task is blocking the main thread it can affect responsiveness of animations and scrolling.</p>
   </dl>
   <p>Some applications (and <a href="https://en.wikipedia.org/wiki/Real_user_monitoring">RUM</a> vendors) are already attempting to identify and track cases where "long tasks" happen. For example, one known pattern is to install a ~short periodic timer and inspect the elapsed time between the successive expirations: if the elapsed time is greater than the timer period, then there is high likelihood that one or more long tasks have delayed execution of the event loop. This approach mostly works but has several bad performance implications: by polling to detect long tasks, the application prevents quiescence and long idle blocks (see requestIdleCallback); it’s bad for battery life; there is no way to know what is causing the delay (e.g. first party or third party code).</p>
   <p>The <a href="https://developers.google.com/web/fundamentals/performance/rail">RAIL</a> performance model suggests that applications should respond to user input in less than 100ms (for touch move and scrolling, the threshold is 16ms). The goal of this API is to surface notifications about tasks that may prevent the application from hitting these targets. This API surfaces tasks that take 50ms or more. A website without these tasks should respond to user input in under 100ms: it will take less than 50ms to finish the task that is being executed when the user input is received and less than 50ms to execute the task to react to such user input.</p>
   <h3 class="heading settled" data-level="1.1" id="example"><span class="secno">1.1. </span><span class="content">Usage Example</span><a class="self-link" href="#example"></a></h3>
<pre class="example highlight" id="example-872f1566"><a class="self-link" href="#example-872f1566"></a><c- a>const</c-> observer <c- o>=</c-> <c- ow>new</c-> PerformanceObserver<c- p>(</c-><c- a>function</c-><c- p>(</c->list<c- p>)</c-> <c- p>{</c->
    <c- k>for</c-> <c- p>(</c-><c- a>const</c-> entry <c- k>of</c-> list<c- p>.</c->getEntries<c- p>())</c-> <c- p>{</c->
        <c- c1>// Process long task notifications:</c->
        <c- c1>// report back for analytics and monitoring</c->
        <c- c1>// ...</c->
    <c- p>}</c->
<c- p>});</c->
<c- c1>// Register observer for previous and future long task notifications.</c->
observer<c- p>.</c->observe<c- p>({</c->type<c- o>:</c-> <c- u>"longtask"</c-><c- p>,</c-> buffered<c- o>:</c-> <c- kc>true</c-><c- p>});</c->
<c- c1>// Long script execution after this will result in queueing</c->
<c- c1>// and receiving "longtask" entries in the observer.</c->
</pre>
   <h2 class="heading settled" data-level="2" id="sec-terminology"><span class="secno">2. </span><span class="content">Terminology</span><a class="self-link" href="#sec-terminology"></a></h2>
   <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-export id="long-task">Long task</dfn> refers to any of the following occurrences whose duration exceeds 50ms:</p>
   <ul>
    <li data-md>
     <p>An event loop <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-task" id="ref-for-concept-task">task</a> plus the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#perform-a-microtask-checkpoint" id="ref-for-perform-a-microtask-checkpoint">perform a microtask checkpoint</a> that follows immediately afterwards. This captures the duration of an event loop <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-task" id="ref-for-concept-task①">task</a>, including its associated <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#microtask" id="ref-for-microtask">microtasks</a>.</p>
    <li data-md>
     <p>An <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#update-the-rendering" id="ref-for-update-the-rendering">update the rendering</a> step within the <a data-link-type="dfn">event loop processing model</a>.</p>
    <li data-md>
     <p>A pause between the last step and the next first step of the <a data-link-type="dfn">event loop processing model</a>. This captures any work that the user agent performs in its UI thread outside of the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/#event-loop" id="ref-for-event-loop">event loop</a>.</p>
   </ul>
   <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="culprit-browsing-context-container">Culprit browsing context container</dfn> refers to the <a data-link-type="dfn">browsing context container</a> (<code class="highlight"><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/iframe-embed-object.html#the-iframe-element" id="ref-for-the-iframe-element">iframe</a></code>, <code class="highlight"><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/iframe-embed-object.html#the-object-element" id="ref-for-the-object-element">object</a></code>, etc.) that is being implicated, on the whole, for a <a data-link-type="dfn" href="#long-task" id="ref-for-long-task">long task</a>.</p>
   <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="attribution">Attribution</dfn> refers to identifying the type of work (such as script, layout etc.) that contributed significantly to the long task, as well as identifying which <a data-link-type="dfn" href="#culprit-browsing-context-container" id="ref-for-culprit-browsing-context-container">culprit browsing context container</a> is responsible for that work.</p>
   <h2 class="heading settled" data-level="3" id="sec-longtask-timing"><span class="secno">3. </span><span class="content">Long Task Timing</span><a class="self-link" href="#sec-longtask-timing"></a></h2>
   <p>Long Task timing involves the following new interfaces:</p>
   <h3 class="heading settled" data-level="3.1" id="sec-PerformanceLongTaskTiming"><span class="secno">3.1. </span><span class="content"><code class="idl"><a data-link-type="idl" href="#performancelongtasktiming" id="ref-for-performancelongtasktiming">PerformanceLongTaskTiming</a></code> interface</span><a class="self-link" href="#sec-PerformanceLongTaskTiming"></a></h3>
<pre class="idl highlight def">[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed" id="ref-for-Exposed"><c- g>Exposed</c-></a>=<c- n>Window</c->]
<c- b>interface</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="interface" data-export id="performancelongtasktiming"><code class="highlight"><c- g>PerformanceLongTaskTiming</c-></code></dfn> : <a data-link-type="idl-name" href="https://w3c.github.io/performance-timeline/#the-performanceentry-interface" id="ref-for-the-performanceentry-interface"><c- n>PerformanceEntry</c-></a> {
    <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-frozen-array" id="ref-for-idl-frozen-array"><c- b>FrozenArray</c-></a>&lt;<a data-link-type="idl-name" href="#taskattributiontiming" id="ref-for-taskattributiontiming"><c- n>TaskAttributionTiming</c-></a>> <a class="idl-code" data-link-type="attribute" data-readonly data-type="FrozenArray<TaskAttributionTiming>" href="#dom-performancelongtasktiming-attribution" id="ref-for-dom-performancelongtasktiming-attribution"><c- g>attribution</c-></a>;
    [<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Default" id="ref-for-Default"><c- g>Default</c-></a>] <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-object" id="ref-for-idl-object"><c- b>object</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="PerformanceLongTaskTiming" data-dfn-type="method" data-export data-lt="toJSON()" id="dom-performancelongtasktiming-tojson"><code class="highlight"><c- g>toJSON</c-></code></dfn>();
};
</pre>
   <p>The values of the attributes of a <code class="idl"><a data-link-type="idl" href="#performancelongtasktiming" id="ref-for-performancelongtasktiming①">PerformanceLongTaskTiming</a></code> are set in the processing model in <a href="#report-long-tasks">§ 4.1 Report long tasks</a>. The following provides an informative summary of how they will be set.</p>
   <p>The <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/performance-timeline/#dom-performanceentry-name" id="ref-for-dom-performanceentry-name">name</a></code> attribute’s getter will return one of the following strings:</p>
   <dl>
    <dt data-md>"<code class="highlight"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="unknown">unknown</dfn></code>"
    <dd data-md>
     <p>The long task originated from work that the user agent performed outside of the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/#event-loop" id="ref-for-event-loop①">event loop</a>.</p>
    <dt data-md>"<code class="highlight"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="self">self</dfn></code>"
    <dd data-md>
     <p>The long task originated from an event loop <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-task" id="ref-for-concept-task②">task</a> within this <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/#browsing-context" id="ref-for-browsing-context">browsing context</a>.</p>
    <dt data-md>"<code class="highlight"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="same-origin-ancestor">same<c- o>-</c->origin<c- o>-</c->ancestor</dfn></code>"
    <dd data-md>
     <p>The long task originated from an event loop <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-task" id="ref-for-concept-task③">task</a> within a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#same-origin" id="ref-for-same-origin">same-origin</a> <a data-link-type="dfn">ancestor browsing context</a>.</p>
    <dt data-md>"<code class="highlight"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="same-origin-descendant">same<c- o>-</c->origin<c- o>-</c->descendant</dfn></code>"
    <dd data-md>
     <p>The long task originated from an event loop <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-task" id="ref-for-concept-task④">task</a> within a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#same-origin" id="ref-for-same-origin①">same-origin</a> <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/#list-of-the-descendant-browsing-contexts" id="ref-for-list-of-the-descendant-browsing-contexts">descendant browsing context</a>.</p>
    <dt data-md>"<code class="highlight"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="same-origin">same<c- o>-</c->origin</dfn></code>"
    <dd data-md>
     <p>The long task originated from an event loop <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-task" id="ref-for-concept-task⑤">task</a> within a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#same-origin" id="ref-for-same-origin②">same-origin</a> <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/#browsing-context" id="ref-for-browsing-context①">browsing context</a> that is not an ancestor or descendant.</p>
    <dt data-md>"<code class="highlight"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="cross-origin-ancestor">cross<c- o>-</c->origin<c- o>-</c->ancestor</dfn></code>"
    <dd data-md>
     <p>The long task originated from an event loop <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-task" id="ref-for-concept-task⑥">task</a> within a cross-origin <a data-link-type="dfn">ancestor browsing context</a>.</p>
    <dt data-md>"<code class="highlight"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="cross-origin-descendant">cross<c- o>-</c->origin<c- o>-</c->descendant</dfn></code>"
    <dd data-md>
     <p>The long task originated from an event loop <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-task" id="ref-for-concept-task⑦">task</a> within a cross-origin <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/#list-of-the-descendant-browsing-contexts" id="ref-for-list-of-the-descendant-browsing-contexts①">descendant browsing context</a>.</p>
    <dt data-md>"<code class="highlight"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="cross-origin-unreachable">cross<c- o>-</c->origin<c- o>-</c->unreachable</dfn></code>"
    <dd data-md>
     <p>The long task originated from an event loop <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-task" id="ref-for-concept-task⑧">task</a> within a cross-origin <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/#browsing-context" id="ref-for-browsing-context②">browsing context</a> that is not an ancestor or descendant.</p>
    <dt data-md>"<code class="highlight"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="multiple-contexts">multiple<c- o>-</c->contexts</dfn></code>"
    <dd data-md>
     <p>The long task originated from an event loop <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-task" id="ref-for-concept-task⑨">task</a> involving multiple <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/#browsing-context" id="ref-for-browsing-context③">browsing contexts</a>.</p>
   </dl>
   <p>The <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/performance-timeline/#dom-performanceentry-entrytype" id="ref-for-dom-performanceentry-entrytype">entryType</a></code> attribute’s getter will return <code class="highlight"><c- u>"longtask"</c-></code>.</p>
   <p>The <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/performance-timeline/#dom-performanceentry-starttime" id="ref-for-dom-performanceentry-starttime">startTime</a></code> attribute’s getter will return a <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/hr-time/#idl-def-domhighrestimestamp" id="ref-for-idl-def-domhighrestimestamp">DOMHighResTimeStamp</a></code> of when the task started.</p>
   <p>The <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/performance-timeline/#dom-performanceentry-duration" id="ref-for-dom-performanceentry-duration">duration</a></code> attribute’s getter will return a <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/hr-time/#idl-def-domhighrestimestamp" id="ref-for-idl-def-domhighrestimestamp①">DOMHighResTimeStamp</a></code> equal to the elapsed time between the start and end of task, with a 1 ms granularity.</p>
   <p>The <dfn class="dfn-paneled idl-code" data-dfn-for="PerformanceLongTaskTiming" data-dfn-type="attribute" data-export id="dom-performancelongtasktiming-attribution"><code class="highlight">attribution</code></dfn> attribute’s getter will return a frozen array of <code class="idl"><a data-link-type="idl" href="#taskattributiontiming" id="ref-for-taskattributiontiming①">TaskAttributionTiming</a></code> entries.</p>
   <h3 class="heading settled" data-level="3.2" id="sec-TaskAttributionTiming"><span class="secno">3.2. </span><span class="content"><code class="idl"><a data-link-type="idl" href="#taskattributiontiming" id="ref-for-taskattributiontiming②">TaskAttributionTiming</a></code> interface</span><a class="self-link" href="#sec-TaskAttributionTiming"></a></h3>
<pre class="def idl highlight">[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed" id="ref-for-Exposed①"><c- g>Exposed</c-></a>=<c- n>Window</c->]
<c- b>interface</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="interface" data-export id="taskattributiontiming"><code class="highlight"><c- g>TaskAttributionTiming</c-></code></dfn> : <a data-link-type="idl-name" href="https://w3c.github.io/performance-timeline/#the-performanceentry-interface" id="ref-for-the-performanceentry-interface①"><c- n>PerformanceEntry</c-></a> {
    <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString" id="ref-for-idl-DOMString"><c- b>DOMString</c-></a> <a class="idl-code" data-link-type="attribute" data-readonly data-type="DOMString" href="#dom-taskattributiontiming-containertype" id="ref-for-dom-taskattributiontiming-containertype"><c- g>containerType</c-></a>;
    <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString" id="ref-for-idl-DOMString①"><c- b>DOMString</c-></a> <a class="idl-code" data-link-type="attribute" data-readonly data-type="DOMString" href="#dom-taskattributiontiming-containersrc" id="ref-for-dom-taskattributiontiming-containersrc"><c- g>containerSrc</c-></a>;
    <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString" id="ref-for-idl-DOMString②"><c- b>DOMString</c-></a> <a class="idl-code" data-link-type="attribute" data-readonly data-type="DOMString" href="#dom-taskattributiontiming-containerid" id="ref-for-dom-taskattributiontiming-containerid"><c- g>containerId</c-></a>;
    <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString" id="ref-for-idl-DOMString③"><c- b>DOMString</c-></a> <a class="idl-code" data-link-type="attribute" data-readonly data-type="DOMString" href="#dom-taskattributiontiming-containername" id="ref-for-dom-taskattributiontiming-containername"><c- g>containerName</c-></a>;
    [<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Default" id="ref-for-Default①"><c- g>Default</c-></a>] <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-object" id="ref-for-idl-object①"><c- b>object</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="TaskAttributionTiming" data-dfn-type="method" data-export data-lt="toJSON()" id="dom-taskattributiontiming-tojson"><code class="highlight"><c- g>toJSON</c-></code></dfn>();
};
</pre>
   <p>The values of the attributes of a <code class="idl"><a data-link-type="idl" href="#taskattributiontiming" id="ref-for-taskattributiontiming③">TaskAttributionTiming</a></code> are set in the processing model in <a href="#report-long-tasks">§ 4.1 Report long tasks</a>. The following provides an informative summary of how they will be set.</p>
   <p>The <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/performance-timeline/#dom-performanceentry-name" id="ref-for-dom-performanceentry-name①">name</a></code> attribute’s getter will always return "<code class="highlight">unknown</code>".</p>
   <p>The <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/performance-timeline/#dom-performanceentry-entrytype" id="ref-for-dom-performanceentry-entrytype①">entryType</a></code> attribute’s getter will always return "<code class="highlight">taskattribution</code>".</p>
   <p>The <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/performance-timeline/#dom-performanceentry-starttime" id="ref-for-dom-performanceentry-starttime①">startTime</a></code> attribute’s getter will always return 0.</p>
   <p>The <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/performance-timeline/#dom-performanceentry-duration" id="ref-for-dom-performanceentry-duration①">duration</a></code> attribute’s getter will always return 0.</p>
   <p>The <dfn class="dfn-paneled idl-code" data-dfn-for="TaskAttributionTiming" data-dfn-type="attribute" data-export id="dom-taskattributiontiming-containertype"><code class="highlight">containerType</code></dfn> attribute’s getter will return the type of the <a data-link-type="dfn" href="#culprit-browsing-context-container" id="ref-for-culprit-browsing-context-container①">culprit browsing context container</a>, such as "<code class="highlight">iframe</code>", "<code class="highlight">embed</code>", or "<code class="highlight">object</code>". If no single <a data-link-type="dfn" href="#culprit-browsing-context-container" id="ref-for-culprit-browsing-context-container②">culprit browsing context container</a> is found, it will return "<code class="highlight">window</code>".</p>
   <p>The <dfn class="dfn-paneled idl-code" data-dfn-for="TaskAttributionTiming" data-dfn-type="attribute" data-export id="dom-taskattributiontiming-containername"><code class="highlight">containerName</code></dfn> attribute’s getter will return the value of the <a data-link-type="dfn" href="#culprit-browsing-context-container" id="ref-for-culprit-browsing-context-container③">container</a>’s <code class="highlight">name</code> content attribute. If no single <a data-link-type="dfn" href="#culprit-browsing-context-container" id="ref-for-culprit-browsing-context-container④">culprit browsing context container</a> is found, it will return the empty string.</p>
   <p>The <dfn class="dfn-paneled idl-code" data-dfn-for="TaskAttributionTiming" data-dfn-type="attribute" data-export id="dom-taskattributiontiming-containerid"><code class="highlight">containerId</code></dfn> attribute’s getter will return the value of the <a data-link-type="dfn" href="#culprit-browsing-context-container" id="ref-for-culprit-browsing-context-container⑤">container</a>’s <code class="highlight">id</code> content attribute. If no single <a data-link-type="dfn" href="#culprit-browsing-context-container" id="ref-for-culprit-browsing-context-container⑥">culprit browsing context container</a> is found, it will return the empty string.</p>
   <p>The <dfn class="dfn-paneled idl-code" data-dfn-for="TaskAttributionTiming" data-dfn-type="attribute" data-export id="dom-taskattributiontiming-containersrc"><code class="highlight">containerSrc</code></dfn> attribute’s getter will return the value of the <a data-link-type="dfn" href="#culprit-browsing-context-container" id="ref-for-culprit-browsing-context-container⑦">container</a>’s <code class="highlight">src</code> content attribute. If no single <a data-link-type="dfn" href="#culprit-browsing-context-container" id="ref-for-culprit-browsing-context-container⑧">culprit browsing context container</a> is found, it will return the empty string.</p>
   <h3 class="heading settled" data-level="3.3" id="sec-PointingToCulprit"><span class="secno">3.3. </span><span class="content">Pointing to the culprit</span><a class="self-link" href="#sec-PointingToCulprit"></a></h3>
   <div class="non-normative">
    <p><em>This section is non-normative.</em></p>
    <p>A <a data-link-type="dfn" href="#long-task" id="ref-for-long-task①">long task</a> can involve different types of work (such as script, layout, style etc), and it could be executed within different <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/#browsing-context" id="ref-for-browsing-context④">browsing contexts</a>, or it could be global in nature such as a long garbage collection that spans the entire <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/#integration-with-the-javascript-agent-cluster-formalism" id="ref-for-integration-with-the-javascript-agent-cluster-formalism">agent cluster</a> or <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/#unit-of-related-browsing-contexts" id="ref-for-unit-of-related-browsing-contexts">unit of related browsing contexts</a>.</p>
    <p>Thus <a data-link-type="dfn" href="#attribution" id="ref-for-attribution">attribution</a> has a couple of facets:</p>
    <ul>
     <li data-md>
      <p>Pointing to the origin of the long task and/or the overall location of the <a data-link-type="dfn" href="#culprit-browsing-context-container" id="ref-for-culprit-browsing-context-container⑨">culprit browsing context</a>: this is referred to as <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="minimal-culprit-attribution">minimal culprit attribution</dfn> and is captured in the <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/performance-timeline/#dom-performanceentry-name" id="ref-for-dom-performanceentry-name②">name</a></code> field.</p>
     <li data-md>
      <p>Pointing to the type of work involved in the <a data-link-type="dfn" href="#long-task" id="ref-for-long-task②">long task</a>, and its associated <a data-link-type="dfn" href="#culprit-browsing-context-container" id="ref-for-culprit-browsing-context-container①⓪">culprit browsing context container</a>: this is captured in <code class="idl"><a data-link-type="idl" href="#taskattributiontiming" id="ref-for-taskattributiontiming④">TaskAttributionTiming</a></code> objects in the <code class="idl"><a data-link-type="idl" href="#dom-performancelongtasktiming-attribution" id="ref-for-dom-performancelongtasktiming-attribution①">attribution</a></code> field of <code class="idl"><a data-link-type="idl" href="#performancelongtasktiming" id="ref-for-performancelongtasktiming②">PerformanceLongTaskTiming</a></code>.</p>
    </ul>
    <p>Therefore, <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/performance-timeline/#dom-performanceentry-name" id="ref-for-dom-performanceentry-name③">name</a></code> and <code class="idl"><a data-link-type="idl" href="#dom-performancelongtasktiming-attribution" id="ref-for-dom-performancelongtasktiming-attribution②">attribution</a></code> fields on <code class="idl"><a data-link-type="idl" href="#performancelongtasktiming" id="ref-for-performancelongtasktiming③">PerformanceLongTaskTiming</a></code> together paint the picture for where the blame rests for a long task.
When delivering this information the Web’s same-origin policy must be adhered to.</p>
    <p>These fields are not independent. The following gives an overview of how they are related:</p>
    <table>
     <thead>
      <tr>
       <th><code class="idl"><a data-link-type="idl" href="https://w3c.github.io/performance-timeline/#dom-performanceentry-name" id="ref-for-dom-performanceentry-name④">name</a></code>
       <th><a data-link-type="dfn" href="#culprit-browsing-context-container" id="ref-for-culprit-browsing-context-container①①">Culprit browsing context container</a> implicated by <code class="idl"><a data-link-type="idl" href="#dom-performancelongtasktiming-attribution" id="ref-for-dom-performancelongtasktiming-attribution③">attribution</a></code>
     <tbody>
      <tr>
       <td>"<code class="highlight"><a data-link-type="dfn" href="#self" id="ref-for-self">self</a></code>" 
       <td>empty 
      <tr>
       <td>"<code class="highlight"><a data-link-type="dfn" href="#same-origin-ancestor" id="ref-for-same-origin-ancestor">same<c- o>-</c->origin<c- o>-</c->ancestor</a></code>" 
       <td>same-origin culprit 
      <tr>
       <td>"<code class="highlight"><a data-link-type="dfn" href="#same-origin-descendant" id="ref-for-same-origin-descendant">same<c- o>-</c->origin<c- o>-</c->descendant</a></code>" 
       <td>same-origin culprit 
      <tr>
       <td>"<code class="highlight"><a data-link-type="dfn" href="#same-origin" id="ref-for-same-origin③">same<c- o>-</c->origin</a></code>" 
       <td>same-origin culprit 
      <tr>
       <td>"<code class="highlight"><a data-link-type="dfn" href="#cross-origin-ancestor" id="ref-for-cross-origin-ancestor">cross<c- o>-</c->origin<c- o>-</c->ancestor</a></code>" 
       <td>empty 
      <tr>
       <td>"<code class="highlight"><a data-link-type="dfn" href="#cross-origin-descendant" id="ref-for-cross-origin-descendant">cross<c- o>-</c->origin<c- o>-</c->descendant</a></code>" 
       <td>empty 
      <tr>
       <td>"<code class="highlight"><a data-link-type="dfn" href="#cross-origin-unreachable" id="ref-for-cross-origin-unreachable">cross<c- o>-</c->origin<c- o>-</c->unreachable</a></code>" 
       <td>empty 
      <tr>
       <td>"<code class="highlight"><a data-link-type="dfn" href="#multiple-contexts" id="ref-for-multiple-contexts">multiple<c- o>-</c->contexts</a></code>" 
       <td>empty 
      <tr>
       <td>"<code class="highlight"><a data-link-type="dfn" href="#unknown" id="ref-for-unknown">unknown</a></code>" 
       <td>empty 
    </table>
   </div>
   <h2 class="heading settled" data-level="4" id="sec-processing-model"><span class="secno">4. </span><span class="content">Processing model</span><a class="self-link" href="#sec-processing-model"></a></h2>
   <p class="note" role="note"><span class="marker">Note:</span> A user agent implementing the Long Tasks API would need to include <code class="highlight"><c- u>"longtask"</c-></code> in <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/performance-timeline/#supportedentrytypes-attribute" id="ref-for-supportedentrytypes-attribute">supportedEntryTypes</a></code> for <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#window" id="ref-for-window">Window</a></code> contexts.
This allows developers to detect support for long tasks.</p>
   <h3 class="heading settled" data-level="4.1" id="report-long-tasks"><span class="secno">4.1. </span><span class="content">Report long tasks</span><a class="self-link" href="#report-long-tasks"></a></h3>
   <div class="algorithm" data-algorithm="Report long tasks">
     Given <var>start time</var>, <var>end time</var>, <var>top-level browsing contexts</var>, and <var>task</var>, perform the following algorithm: 
    <ol>
     <li data-md>
      <p>If <var>end time</var> minus <var>start time</var> is less than the long tasks threshold of 50 ms, abort these steps.</p>
     <li data-md>
      <p>Let <var>destinationRealms</var> be an empty set.</p>
     <li data-md>
      <p>Determine the set of <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#sec-code-realms" id="ref-for-sec-code-realms">JavaScript Realms</a> to which reports will be delivered:</p>
      <p>For each <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#top-level-browsing-context" id="ref-for-top-level-browsing-context">top-level browsing context</a> <var>topmostBC</var> in <var>top-level browsing contexts</var>:</p>
      <ol>
       <li data-md>
        <p>Add <var>topmostBC</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#nav-document" id="ref-for-nav-document">active document</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm" id="ref-for-concept-relevant-realm">relevant Realm</a> to <var>destinationRealms</var>.</p>
       <li data-md>
        <p>Let <var>descendantBCs</var> be <var>topmostBC</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#nav-document" id="ref-for-nav-document①">active document</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/#list-of-the-descendant-browsing-contexts" id="ref-for-list-of-the-descendant-browsing-contexts②">list of the descendant browsing contexts</a>.</p>
       <li data-md>
        <p>For each <var>descendantBC</var> in <var>descendantBCs</var>, add <var>descendantBC</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#nav-document" id="ref-for-nav-document②">active document</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm" id="ref-for-concept-relevant-realm①">relevant Realm</a> to <var>destinationRealms</var>.</p>
      </ol>
     <li data-md>
      <p>A user agent may remove some <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#sec-code-realms" id="ref-for-sec-code-realms①">JavaScript Realms</a> from <var>destinationRealms</var>.</p>
    </ol>
    <p class="note" role="note"><span class="marker">Note:</span> this removal could be used to avoid reporting long tasks for <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#sec-code-realms" id="ref-for-sec-code-realms②">JavaScript Realms</a> that the user agent handles in a separate process. However, this concept is not specified precisely.</p>
    <p class="issue" id="issue-63aa4f38"><a class="self-link" href="#issue-63aa4f38"></a> there is some ongoing discussion regarding the scope of which <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#document" id="ref-for-document">Documents</a></code> gain visibility over which long tasks, so this logic could change in the future. <a href="https://github.com/w3c/longtasks/issues/75">[Issue #75]</a></p>
    <ol>
     <li data-md>
      <p>For each <var>destinationRealm</var> in <var>destinationRealms</var>:</p>
      <ol>
       <li data-md>
        <p>Let <var>name</var> be the empty string. This will be used to report <a data-link-type="dfn" href="#minimal-culprit-attribution" id="ref-for-minimal-culprit-attribution">minimal culprit attribution</a>, below.</p>
       <li data-md>
        <p>Let <var>culpritSettings</var> be <code class="highlight"><c- kc>null</c-></code>.</p>
       <li data-md>
        <p>Process <var>task</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/#script-evaluation-environment-settings-object-set" id="ref-for-script-evaluation-environment-settings-object-set">script evaluation environment settings object set</a> to determine <var>name</var> and <var>culpritSettings</var> as follows:</p>
        <ol>
         <li data-md>
          <p>If <var>task</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/#script-evaluation-environment-settings-object-set" id="ref-for-script-evaluation-environment-settings-object-set①">script evaluation environment settings object set</a> is empty: set <var>name</var> to "<code class="highlight"><a data-link-type="dfn" href="#unknown" id="ref-for-unknown①">unknown</a></code>" and <var>culpritSettings</var> to <code class="highlight"><c- kc>null</c-></code>.</p>
         <li data-md>
          <p>Otherwise, if <var>task</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/#script-evaluation-environment-settings-object-set" id="ref-for-script-evaluation-environment-settings-object-set②">script evaluation environment settings object set</a>'s length is greater than one: set <var>name</var> to "<code class="highlight"><a data-link-type="dfn" href="#multiple-contexts" id="ref-for-multiple-contexts①">multiple<c- o>-</c->contexts</a></code>" and <var>culpritSettings</var> to <code class="highlight"><c- kc>null</c-></code>.</p>
         <li data-md>
          <p>Otherwise, i.e. if <var>task</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/#script-evaluation-environment-settings-object-set" id="ref-for-script-evaluation-environment-settings-object-set③">script evaluation environment settings object set</a>'s length is one:</p>
          <ol>
           <li data-md>
            <p>Set <var>culpritSettings</var> to the single item in <var>task</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/#script-evaluation-environment-settings-object-set" id="ref-for-script-evaluation-environment-settings-object-set④">script evaluation environment settings object set</a>.</p>
           <li data-md>
            <p>Let <var>destinationSettings</var> be <var>destinationRealm</var>’s <a data-link-type="dfn">settings object</a>.</p>
           <li data-md>
            <p>Let <var>destinationOrigin</var> be <var>destinationSettings</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin" id="ref-for-concept-settings-object-origin">origin</a>.</p>
           <li data-md>
            <p>Let <var>destinationBC</var> be <var>destinationSettings</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-global" id="ref-for-concept-settings-object-global">global object</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#window-bc" id="ref-for-window-bc">browsing context</a>.</p>
           <li data-md>
            <p>Let <var>culpritBC</var> be <var>culpritSettings</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-global" id="ref-for-concept-settings-object-global①">global object</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#window-bc" id="ref-for-window-bc①">browsing context</a>.</p>
           <li data-md>
            <p class="assertion">Assert: <var>culpritBC</var> is not <code class="highlight"><c- kc>null</c-></code>.</p>
           <li data-md>
            <p>If <var>culpritSettings</var> is the same as <var>destinationSettings</var>, set <var>name</var> to "<code class="highlight"><a data-link-type="dfn" href="#self" id="ref-for-self①">self</a></code>".</p>
           <li data-md>
            <p>Otherwise, if <var>culpritSettings</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin" id="ref-for-concept-settings-object-origin①">origin</a> and <var>destinationOrigin</var> are <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#same-origin" id="ref-for-same-origin④">same origin</a>:</p>
            <ol>
             <li data-md>
              <p>If <var>destinationBC</var> is <code class="highlight"><c- kc>null</c-></code>, set <var>name</var> to "<code class="highlight"><a data-link-type="dfn" href="#same-origin" id="ref-for-same-origin⑤">same<c- o>-</c->origin</a></code>".</p>
             <li data-md>
              <p>Otherwise, if <var>culpritBC</var> is an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/#ancestor-browsing-context" id="ref-for-ancestor-browsing-context">ancestor</a> of <var>destinationBC</var>, set <var>name</var> to "<code class="highlight"><a data-link-type="dfn" href="#same-origin-ancestor" id="ref-for-same-origin-ancestor①">same<c- o>-</c->origin<c- o>-</c->ancestor</a></code>".</p>
             <li data-md>
              <p>Otherwise, if <var>destinationBC</var> is an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/#ancestor-browsing-context" id="ref-for-ancestor-browsing-context①">ancestor</a> of <var>culpritBC</var>, set <var>name</var> to "<code class="highlight"><a data-link-type="dfn" href="#same-origin-descendant" id="ref-for-same-origin-descendant①">same<c- o>-</c->origin<c- o>-</c->descendant</a></code>".</p>
             <li data-md>
              <p>Otherwise, set <var>name</var> to "<code class="highlight"><a data-link-type="dfn" href="#same-origin" id="ref-for-same-origin⑥">same<c- o>-</c->origin</a></code>".</p>
            </ol>
           <li data-md>
            <p>Otherwise:</p>
            <ol>
             <li data-md>
              <p>If <var>destinationBC</var> is <code class="highlight"><c- kc>null</c-></code>, set <var>name</var> to "<code class="highlight"><a data-link-type="dfn" href="#cross-origin-unreachable" id="ref-for-cross-origin-unreachable①">cross<c- o>-</c->origin<c- o>-</c->unreachable</a></code>".</p>
             <li data-md>
              <p>Otherwise, if <var>culpritBC</var> is an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/#ancestor-browsing-context" id="ref-for-ancestor-browsing-context②">ancestor</a> of <var>destinationBC</var>, set <var>name</var> to "<code class="highlight"><a data-link-type="dfn" href="#cross-origin-ancestor" id="ref-for-cross-origin-ancestor①">cross<c- o>-</c->origin<c- o>-</c->ancestor</a></code>" and set <var>culpritSettings</var> to <code class="highlight"><c- kc>null</c-></code>.</p>
              <p class="note" role="note"><span class="marker">NOTE:</span> this is not reported because of security. Developers should look this up themselves.</p>
             <li data-md>
              <p>Otherwise, if <var>destinationBC</var> is an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/#ancestor-browsing-context" id="ref-for-ancestor-browsing-context③">ancestor</a> of <var>culpritBC</var>, set <var>name</var> to "<code class="highlight"><a data-link-type="dfn" href="#cross-origin-descendant" id="ref-for-cross-origin-descendant①">cross<c- o>-</c->origin<c- o>-</c->descendant</a></code>".</p>
             <li data-md>
              <p>Otherwise, set <var>name</var> to "<code class="highlight"><a data-link-type="dfn" href="#cross-origin-unreachable" id="ref-for-cross-origin-unreachable②">cross<c- o>-</c->origin<c- o>-</c->unreachable</a></code>".</p>
            </ol>
          </ol>
        </ol>
       <li data-md>
        <p>Let <var>attribution</var> be a new <code class="idl"><a data-link-type="idl" href="#taskattributiontiming" id="ref-for-taskattributiontiming⑤">TaskAttributionTiming</a></code> object with <var>destinationRealm</var> and set its attributes as follows:</p>
        <ol>
         <li data-md>
          <p>Set <var>attribution</var>’s <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/performance-timeline/#dom-performanceentry-name" id="ref-for-dom-performanceentry-name⑤">name</a></code> attribute to "<code class="highlight"><a data-link-type="dfn" href="#unknown" id="ref-for-unknown②">unknown</a></code>".</p>
          <p class="note" role="note"><span class="marker">NOTE:</span> future iterations of this API will add more values to the <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/performance-timeline/#dom-performanceentry-name" id="ref-for-dom-performanceentry-name⑥">name</a></code> attribute of a <code class="idl"><a data-link-type="idl" href="#taskattributiontiming" id="ref-for-taskattributiontiming⑥">TaskAttributionTiming</a></code> object, but for now it can only be a single value.</p>
         <li data-md>
          <p>Set <var>attribution</var>’s <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/performance-timeline/#dom-performanceentry-entrytype" id="ref-for-dom-performanceentry-entrytype②">entryType</a></code> attribute to <code class="highlight"><c- u>"taskattribution"</c-></code>.</p>
         <li data-md>
          <p>Set <var>attribution</var>’s <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/performance-timeline/#dom-performanceentry-starttime" id="ref-for-dom-performanceentry-starttime②">startTime</a></code> and <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/performance-timeline/#dom-performanceentry-duration" id="ref-for-dom-performanceentry-duration②">duration</a></code> to 0.</p>
         <li data-md>
          <p>Set <var>attribution</var>’s <code class="idl"><a data-link-type="idl" href="#dom-taskattributiontiming-containertype" id="ref-for-dom-taskattributiontiming-containertype①">containerType</a></code> attribute to <code class="highlight"><c- u>"window"</c-></code>.</p>
         <li data-md>
          <p>Set <var>attribution</var>’s <code class="idl"><a data-link-type="idl" href="#dom-taskattributiontiming-containername" id="ref-for-dom-taskattributiontiming-containername①">containerName</a></code> and <code class="idl"><a data-link-type="idl" href="#dom-taskattributiontiming-containersrc" id="ref-for-dom-taskattributiontiming-containersrc①">containerSrc</a></code> attributes to the empty string.</p>
         <li data-md>
          <p>If <var>culpritSettings</var> is not <code class="highlight"><c- kc>null</c-></code>:</p>
          <ol>
           <li data-md>
            <p>Let <var>culpritBC</var> be <var>culpritSettings</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-global" id="ref-for-concept-settings-object-global②">global object</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#window-bc" id="ref-for-window-bc②">browsing context</a>.</p>
           <li data-md>
            <p class="assertion">Assert: <var>culpritBC</var> is not <code class="highlight"><c- kc>null</c-></code>.</p>
           <li data-md>
            <p>Let <var>container</var> be <var>culpritBC</var>’s <a data-link-type="dfn">browsing context container</a>.</p>
           <li data-md>
            <p class="assertion">Assert: <var>container</var> is not <code class="highlight"><c- kc>null</c-></code>.</p>
           <li data-md>
            <p>Set <var>attribution</var>’s <code class="idl"><a data-link-type="idl" href="#dom-taskattributiontiming-containerid" id="ref-for-dom-taskattributiontiming-containerid①">containerId</a></code> attribute to the value of <var>container</var>’s <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-id" id="ref-for-concept-id">ID</a>, or the empty string if the ID is unset.</p>
           <li data-md>
            <p>If <var>container</var> is an <code class="highlight"><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/iframe-embed-object.html#the-iframe-element" id="ref-for-the-iframe-element①">iframe</a></code> element:</p>
            <ol>
             <li data-md>
              <p>Set <var>attribution</var>’s <code class="idl"><a data-link-type="idl" href="#dom-taskattributiontiming-containertype" id="ref-for-dom-taskattributiontiming-containertype②">containerType</a></code> attribute to "<code class="highlight">iframe</code>".</p>
             <li data-md>
              <p>Set <var>attribution</var>’s <code class="idl"><a data-link-type="idl" href="#dom-taskattributiontiming-containername" id="ref-for-dom-taskattributiontiming-containername②">containerName</a></code> attribute to the value of <var>container</var>’s <code class="highlight"><a data-link-type="element-sub" href="https://html.spec.whatwg.org/multipage/iframe-embed-object.html#attr-iframe-name" id="ref-for-attr-iframe-name">name</a></code> content attribute, or the empty string if the attribute is absent.</p>
             <li data-md>
              <p>Set <var>attribution</var>’s <code class="idl"><a data-link-type="idl" href="#dom-taskattributiontiming-containersrc" id="ref-for-dom-taskattributiontiming-containersrc②">containerSrc</a></code> attribute to the value of <var>container</var>’s <code class="highlight"><a data-link-type="element-sub" href="https://html.spec.whatwg.org/multipage/iframe-embed-object.html#attr-iframe-src" id="ref-for-attr-iframe-src">src</a></code> content attribute, or the empty string if the attribute is absent.</p>
            </ol>
            <p class="note" role="note"><span class="marker">NOTE:</span> it is intentional that we record the frame’s <code class="highlight"><a data-link-type="element-sub" href="https://html.spec.whatwg.org/multipage/iframe-embed-object.html#attr-iframe-src" id="ref-for-attr-iframe-src①">src</a></code> attribute here, and not its current URL, as this is meant primarily to help identify frames, and allowing discovery of the current URL of a cross-origin iframe is a security problem.</p>
           <li data-md>
            <p>If <var>container</var> is a <code class="highlight"><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/obsolete.html#frame" id="ref-for-frame">frame</a></code> element:</p>
            <ol>
             <li data-md>
              <p>Set <var>attribution</var>’s <code class="idl"><a data-link-type="idl" href="#dom-taskattributiontiming-containertype" id="ref-for-dom-taskattributiontiming-containertype③">containerType</a></code> attribute to "<code class="highlight">frame</code>".</p>
             <li data-md>
              <p>Set <var>attribution</var>’s <code class="idl"><a data-link-type="idl" href="#dom-taskattributiontiming-containername" id="ref-for-dom-taskattributiontiming-containername③">containerName</a></code> attribute to the value of <var>container</var>’s <code class="highlight">name</code> content attribute, or the empty string if the attribute is absent.</p>
             <li data-md>
              <p>Set <var>attribution</var>’s <code class="idl"><a data-link-type="idl" href="#dom-taskattributiontiming-containersrc" id="ref-for-dom-taskattributiontiming-containersrc③">containerSrc</a></code> attribute to the value of <var>container</var>’s <code class="highlight">src</code> content attribute, or the empty string if the attribute is absent.</p>
            </ol>
           <li data-md>
            <p>If <var>container</var> is an <code class="highlight"><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/iframe-embed-object.html#the-object-element" id="ref-for-the-object-element①">object</a></code> element:</p>
            <ol>
             <li data-md>
              <p>Set <var>attribution</var>’s <code class="idl"><a data-link-type="idl" href="#dom-taskattributiontiming-containertype" id="ref-for-dom-taskattributiontiming-containertype④">containerType</a></code> attribute to "<code class="highlight">object</code>".</p>
             <li data-md>
              <p>Set <var>attribution</var>’s <code class="idl"><a data-link-type="idl" href="#dom-taskattributiontiming-containername" id="ref-for-dom-taskattributiontiming-containername④">containerName</a></code> attribute to the value of <var>container</var>’s <a href="https://html.spec.whatwg.org/multipage/iframe-embed-object.html#attr-object-name">name</a> content attribute, or the empty string if the attribute is absent.</p>
             <li data-md>
              <p>Set <var>attribution</var>’s <code class="idl"><a data-link-type="idl" href="#dom-taskattributiontiming-containersrc" id="ref-for-dom-taskattributiontiming-containersrc④">containerSrc</a></code> attribute to the value of <var>container</var>’s <code class="highlight"><a data-link-type="element-sub" href="https://html.spec.whatwg.org/multipage/iframe-embed-object.html#attr-object-data" id="ref-for-attr-object-data">data</a></code> content attribute, or the empty string if the attribute is absent.</p>
            </ol>
           <li data-md>
            <p>If <var>container</var> is an <code class="highlight"><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/iframe-embed-object.html#the-embed-element" id="ref-for-the-embed-element">embed</a></code> element:</p>
            <ol>
             <li data-md>
              <p>Set <var>attribution</var>’s <code class="idl"><a data-link-type="idl" href="#dom-taskattributiontiming-containertype" id="ref-for-dom-taskattributiontiming-containertype⑤">containerType</a></code> attribute to "<code class="highlight">embed</code>".</p>
             <li data-md>
              <p>Set <var>attribution</var>’s <code class="idl"><a data-link-type="idl" href="#dom-taskattributiontiming-containername" id="ref-for-dom-taskattributiontiming-containername⑤">containerName</a></code> attribute to the empty string.</p>
             <li data-md>
              <p>Set <var>attribution</var>’s <code class="idl"><a data-link-type="idl" href="#dom-taskattributiontiming-containersrc" id="ref-for-dom-taskattributiontiming-containersrc⑤">containerSrc</a></code> attribute to the value of <var>container</var>’s <code class="highlight"><a data-link-type="element-sub" href="https://html.spec.whatwg.org/multipage/iframe-embed-object.html#attr-embed-src" id="ref-for-attr-embed-src">src</a></code> content attribute, or the empty string if the attribute is absent.</p>
            </ol>
          </ol>
        </ol>
       <li data-md>
        <p>Create a new <code class="idl"><a data-link-type="idl" href="#performancelongtasktiming" id="ref-for-performancelongtasktiming④">PerformanceLongTaskTiming</a></code> object <var>newEntry</var> with <var>destinationRealm</var> and set its attributes as follows:</p>
        <ol>
         <li data-md>
          <p>Set <var>newEntry</var>’s <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/performance-timeline/#dom-performanceentry-name" id="ref-for-dom-performanceentry-name⑦">name</a></code> attribute to <var>name</var>.</p>
         <li data-md>
          <p>Set <var>newEntry</var>’s <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/performance-timeline/#dom-performanceentry-entrytype" id="ref-for-dom-performanceentry-entrytype③">entryType</a></code> attribute to "<code class="highlight">longtask</code>".</p>
         <li data-md>
          <p>Set <var>newEntry</var>’s <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/performance-timeline/#dom-performanceentry-starttime" id="ref-for-dom-performanceentry-starttime③">startTime</a></code> attribute to <var>start time</var>.</p>
         <li data-md>
          <p>Let <var>dur</var> be <var>end time</var> minus <var>start time</var>.</p>
         <li data-md>
          <p>Set <var>newEntry</var>’s <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/performance-timeline/#dom-performanceentry-duration" id="ref-for-dom-performanceentry-duration③">duration</a></code> attribute to the integer part of <var>dur</var>.</p>
         <li data-md>
          <p>If <var>attribution</var> is not <code class="highlight"><c- kc>null</c-></code>, set <var>newEntry</var>’s <code class="idl"><a data-link-type="idl" href="#dom-performancelongtasktiming-attribution" id="ref-for-dom-performancelongtasktiming-attribution④">attribution</a></code> attribute to a new frozen array containing the single value <var>attribution</var>.</p>
          <p class="note" role="note"><span class="marker">NOTE:</span> future iterations of this API will add more values to the <code class="idl"><a data-link-type="idl" href="#dom-performancelongtasktiming-attribution" id="ref-for-dom-performancelongtasktiming-attribution⑤">attribution</a></code> attribute, but for now it only contains a single value.</p>
        </ol>
       <li data-md>
        <p><a data-link-type="dfn" href="https://w3c.github.io/performance-timeline/#dfn-queue-a-performanceentry" id="ref-for-dfn-queue-a-performanceentry">Queue the PerformanceEntry</a> <var>newEntry</var>.</p>
      </ol>
    </ol>
   </div>
   <h2 class="heading settled" data-level="5" id="priv-sec"><span class="secno">5. </span><span class="content">Security &amp; privacy considerations</span><a class="self-link" href="#priv-sec"></a></h2>
   <p>Long Tasks API adheres to the same-origin policy by including origin-safe attribution information about
the source of the long task. There is a 50ms threshold for long tasks. Durations are only provided in 1 ms
granularity. Together this provides adequate protection against cross-origin leaks.</p>
   <p>The Long Tasks API provides timing information about the duration and type of tasks executed by the user,
as well as attribution such as the browsing context causing the function calls. This could enable an attacker
to perform side-channel timing attacks to guess the user’s action, or identify the user. For example, a pattern of
long script followed by a long render could be put together to guess user’s interaction with a social
widget. Detailed function call attribution would be used to determine the user’s action.</p>
   <p>While the API doesn’t introduce any new privacy attacks, it could make existing privacy attacks faster.
Mitigations for this are possible and can be implemented as needed:</p>
   <ul>
    <li data-md>
     <p>Further clamp or add random jitter to the long task duration provided by the API to make attacks harder to
exploit.</p>
    <li data-md>
     <p>Limit the number of origins for which longtasks are exposed by the API, and obfuscate the attribution of
any tasks afterwards. For instance, a page with 5 iframes could receive only attribution for tasks from 3
of those iframes, and would receive no attribution (<code class="idl"><a data-link-type="idl" href="https://w3c.github.io/performance-timeline/#dom-performanceentry-name" id="ref-for-dom-performanceentry-name⑧">name</a></code> set to <code class="highlight">unknown</code>")
for tasks from the other 2.</p>
    <li data-md>
     <p>Allow dropping the culprit/attribution information after a certain threshold. For instance, after 10 longtasks
all entries would receive no attribution and their <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/performance-timeline/#dom-performanceentry-name" id="ref-for-dom-performanceentry-name⑨">name</a></code> would be "<code class="highlight">unknown</code>".</p>
    <li data-md>
     <p>Add a built-in delay to the timing information exposed to make attacks dependent on longtask volume harder
to execute.</p>
   </ul>
   <h3 class="heading settled" data-level="5.1" id="what-is-exposed"><span class="secno">5.1. </span><span class="content">What is Exposed to Observers?</span><a class="self-link" href="#what-is-exposed"></a></h3>
   <p>All observers within the top level page (i.e. all iframes in the page and the main frame) will receive
notifications about presence of long tasks. We expose the start time of the task, its duration (with 1 ms
granularity), and a pointer to the culprit frame. This information can already be observed today, and with
higher resolution, using setTimeout. An attacker can do this by clearing everything else on the page and adding
the vulnerable cross-origin resource to ensure that delays from the setTimeout are caused by that resource.
Observers in other different pages (tabs or windows) should not receive notifications, regardless of the
architecture of the user agent.</p>
   <p>Cross origin rules for what is exposed:</p>
   <ul>
    <li data-md>
     <p>Cross-origin observers may see the direction of the culprit e.g if the culprit is a deeply nested iframe,
then the host page can see the first cross-origin between itself and the culprit.</p>
    <li data-md>
     <p>Conversely, if the culprit is the top level page, then a deeply embedded iframe can see that a longtask
occurrred in its cross-origin ancestor but does not receive any information about it.</p>
   </ul>
   <h3 class="heading settled" data-level="5.2" id="attack-scenarios"><span class="secno">5.2. </span><span class="content">Attack Scenarios Considered</span><a class="self-link" href="#attack-scenarios"></a></h3>
   <p>The following are the timing attacks considered:</p>
   <ol>
    <li data-md>
     <p><b>Traditional timing attacks</b>: using external resource load time to reveal the size of
private data. For instance the number of hidden pictures in a gallery, whether username is
valid, etc. See an <a href="http://crypto.stanford.edu/~dabo/papers/webtiming.pdf">example</a>.</p>
    <li data-md>
     <p><b>Side-channel timing attacks</b>: using time for video parsing, script parsing, App Cache reads
or Cache API (service workers) usage to uniquely identify a user, or to create a profile of the
user’s age, gender, location, and interests etc. For <a href="https://tom.vg/papers/timing-attacks_ccs2015.pdf">instance</a>, status updates from
a social network can be limited to certain demographic (eg. females of age 20-30) the file size of
the permalink page can be used to determine whether the user is in the target demographic.</p>
   </ol>
   <p>These scenarios are addressed by the 50ms threshold AND respecting cross-origin boundary i.e. not
showing task type or additional attribution to untrusted cross origin observers.</p>
  </main>
  <div data-fill-with="conformance">
   <h2 class="no-ref no-num heading settled" id="w3c-conformance"><span class="content">Conformance</span><a class="self-link" href="#w3c-conformance"></a></h2>
   <h3 class="no-ref no-num heading settled" id="w3c-conventions"><span class="content">Document conventions</span><a class="self-link" href="#w3c-conventions"></a></h3>
   <p>Conformance requirements are expressed
    with a combination of descriptive assertions
    and RFC 2119 terminology.
    The key words “MUST”, “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”, “RECOMMENDED”, “MAY”, and “OPTIONAL”
    in the normative parts of this document
    are to be interpreted as described in RFC 2119.
    However, for readability,
    these words do not appear in all uppercase letters in this specification. </p>
   <p>All of the text of this specification is normative
    except sections explicitly marked as non-normative, examples, and notes. <a data-link-type="biblio" href="#biblio-rfc2119" title="Key words for use in RFCs to Indicate Requirement Levels">[RFC2119]</a> </p>
   <p>Examples in this specification are introduced with the words “for example”
    or are set apart from the normative text
    with <code class="highlight"><c- a>class</c-><c- o>=</c-><c- u>"example"</c-></code>,
    like this: </p>
   <div class="example" id="w3c-example">
    <a class="self-link" href="#w3c-example"></a> 
    <p>This is an example of an informative example. </p>
   </div>
   <p>Informative notes begin with the word “Note”
    and are set apart from the normative text
    with <code class="highlight"><c- a>class</c-><c- o>=</c-><c- u>"note"</c-></code>,
    like this: </p>
   <p class="note" role="note">Note, this is an informative note.</p>
   <section>
    <h3 class="no-ref no-num heading settled" id="w3c-conformant-algorithms"><span class="content">Conformant Algorithms</span><a class="self-link" href="#w3c-conformant-algorithms"></a></h3>
    <p>Requirements phrased in the imperative as part of algorithms
    (such as "strip any leading space characters"
    or "return false and abort these steps")
    are to be interpreted with the meaning of the key word
    ("must", "should", "may", etc)
    used in introducing the algorithm. </p>
    <p>Conformance requirements phrased as algorithms or specific steps
    can be implemented in any manner,
    so long as the end result is equivalent.
    In particular, the algorithms defined in this specification
    are intended to be easy to understand
    and are not intended to be performant.
    Implementers are encouraged to optimize. </p>
   </section>
  </div>
  <script src="https://www.w3.org/scripts/TR/2021/fixup.js"></script>
  <h2 class="no-num no-ref heading settled" id="index"><span class="content">Index</span><a class="self-link" href="#index"></a></h2>
  <h3 class="no-num no-ref heading settled" id="index-defined-here"><span class="content">Terms defined by this specification</span><a class="self-link" href="#index-defined-here"></a></h3>
  <ul class="index">
   <li><a href="#attribution">Attribution</a><span>, in § 2</span>
   <li><a href="#dom-performancelongtasktiming-attribution">attribution</a><span>, in § 3.1</span>
   <li><a href="#dom-taskattributiontiming-containerid">containerId</a><span>, in § 3.2</span>
   <li><a href="#dom-taskattributiontiming-containername">containerName</a><span>, in § 3.2</span>
   <li><a href="#dom-taskattributiontiming-containersrc">containerSrc</a><span>, in § 3.2</span>
   <li><a href="#dom-taskattributiontiming-containertype">containerType</a><span>, in § 3.2</span>
   <li><a href="#cross-origin-ancestor">cross-origin-ancestor</a><span>, in § 3.1</span>
   <li><a href="#cross-origin-descendant">cross-origin-descendant</a><span>, in § 3.1</span>
   <li><a href="#cross-origin-unreachable">cross-origin-unreachable</a><span>, in § 3.1</span>
   <li><a href="#culprit-browsing-context-container">Culprit browsing context container</a><span>, in § 2</span>
   <li><a href="#long-task">Long task</a><span>, in § 2</span>
   <li><a href="#minimal-culprit-attribution">minimal culprit attribution</a><span>, in § 3.3</span>
   <li><a href="#multiple-contexts">multiple-contexts</a><span>, in § 3.1</span>
   <li><a href="#performancelongtasktiming">PerformanceLongTaskTiming</a><span>, in § 3.1</span>
   <li><a href="#same-origin">same-origin</a><span>, in § 3.1</span>
   <li><a href="#same-origin-ancestor">same-origin-ancestor</a><span>, in § 3.1</span>
   <li><a href="#same-origin-descendant">same-origin-descendant</a><span>, in § 3.1</span>
   <li><a href="#self">self</a><span>, in § 3.1</span>
   <li><a href="#taskattributiontiming">TaskAttributionTiming</a><span>, in § 3.2</span>
   <li>
    toJSON()
    <ul>
     <li><a href="#dom-performancelongtasktiming-tojson">method for PerformanceLongTaskTiming</a><span>, in § 3.1</span>
     <li><a href="#dom-taskattributiontiming-tojson">method for TaskAttributionTiming</a><span>, in § 3.2</span>
    </ul>
   <li><a href="#unknown">unknown</a><span>, in § 3.1</span>
  </ul>
  <h3 class="no-num no-ref heading settled" id="index-defined-elsewhere"><span class="content">Terms defined by reference</span><a class="self-link" href="#index-defined-elsewhere"></a></h3>
  <ul class="index">
   <li>
    <a data-link-type="biblio">[DOM]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="85394472">Document</span>
     <li><span class="dfn-paneled" id="6ea37aa1">id</span>
    </ul>
   <li>
    <a data-link-type="biblio">[ECMASCRIPT]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="a117ab2c">javascript realms</span>
    </ul>
   <li>
    <a data-link-type="biblio">[HR-TIME-2]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="41cd0b68">DOMHighResTimeStamp</span>
    </ul>
   <li>
    <a data-link-type="biblio">[HTML]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="5d7209e9">Window</span>
     <li><span class="dfn-paneled" id="35972864">active document</span>
     <li><span class="dfn-paneled" id="23bea91f">agent cluster</span>
     <li><span class="dfn-paneled" id="60596594">ancestor</span>
     <li><span class="dfn-paneled" id="83c1e4af">browsing context</span>
     <li><span class="dfn-paneled" id="6d88ab2e">browsing context <small>(for Window)</small></span>
     <li><span class="dfn-paneled" id="4468342f">data</span>
     <li><span class="dfn-paneled" id="49a6cb20">embed</span>
     <li><span class="dfn-paneled" id="2437ca5a">event loop</span>
     <li><span class="dfn-paneled" id="88ed8860">frame</span>
     <li><span class="dfn-paneled" id="8a30477b">global object</span>
     <li><span class="dfn-paneled" id="87fcd40c">iframe</span>
     <li><span class="dfn-paneled" id="552c9d85">list of the descendant browsing contexts</span>
     <li><span class="dfn-paneled" id="6a288f2a">microtask</span>
     <li><span class="dfn-paneled" id="aa16a049">name</span>
     <li><span class="dfn-paneled" id="99b5cef6">object</span>
     <li><span class="dfn-paneled" id="43ac8374">origin</span>
     <li><span class="dfn-paneled" id="8603b31a">perform a microtask checkpoint</span>
     <li><span class="dfn-paneled" id="5991ccfb">relevant realm</span>
     <li><span class="dfn-paneled" id="7393da89">same origin</span>
     <li><span class="dfn-paneled" id="f8c9e23a">script evaluation environment settings object set</span>
     <li><span class="dfn-paneled" id="d3143ca1">src <small>(for embed)</small></span>
     <li><span class="dfn-paneled" id="deddc6fc">src <small>(for iframe)</small></span>
     <li><span class="dfn-paneled" id="e270bd2a">task</span>
     <li><span class="dfn-paneled" id="ae2a6342">top-level browsing context</span>
     <li><span class="dfn-paneled" id="1c4b7879">unit of related browsing contexts</span>
     <li><span class="dfn-paneled" id="b815f411">update the rendering</span>
    </ul>
   <li>
    <a data-link-type="biblio">[PERFORMANCE-TIMELINE]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="df79032a">PerformanceEntry</span>
     <li><span class="dfn-paneled" id="fabd3046">duration</span>
     <li><span class="dfn-paneled" id="08a90f22">entryType</span>
     <li><span class="dfn-paneled" id="09c54b53">name</span>
     <li><span class="dfn-paneled" id="3efa5dd7">queue the performanceentry</span>
     <li><span class="dfn-paneled" id="cc7c9b78">startTime</span>
     <li><span class="dfn-paneled" id="de4bb79b">supportedEntryTypes</span>
    </ul>
   <li>
    <a data-link-type="biblio">[WEBIDL]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="8855a9aa">DOMString</span>
     <li><span class="dfn-paneled" id="f4531911">Default</span>
     <li><span class="dfn-paneled" id="889e932f">Exposed</span>
     <li><span class="dfn-paneled" id="dcf5fafa">FrozenArray</span>
     <li><span class="dfn-paneled" id="efd1ec5d">object</span>
    </ul>
  </ul>
  <h2 class="no-num no-ref heading settled" id="references"><span class="content">References</span><a class="self-link" href="#references"></a></h2>
  <h3 class="no-num no-ref heading settled" id="normative"><span class="content">Normative References</span><a class="self-link" href="#normative"></a></h3>
  <dl>
   <dt id="biblio-dom">[DOM]
   <dd>Anne van Kesteren. <a href="https://dom.spec.whatwg.org/"><cite>DOM Standard</cite></a>. Living Standard. URL: <a href="https://dom.spec.whatwg.org/">https://dom.spec.whatwg.org/</a>
   <dt id="biblio-ecmascript">[ECMASCRIPT]
   <dd><a href="https://tc39.es/ecma262/multipage/"><cite>ECMAScript Language Specification</cite></a>. URL: <a href="https://tc39.es/ecma262/multipage/">https://tc39.es/ecma262/multipage/</a>
   <dt id="biblio-hr-time-2">[HR-TIME-2]
   <dd>Ilya Grigorik. <a href="https://w3c.github.io/hr-time/"><cite>High Resolution Time Level 2</cite></a>. URL: <a href="https://w3c.github.io/hr-time/">https://w3c.github.io/hr-time/</a>
   <dt id="biblio-html">[HTML]
   <dd>Anne van Kesteren; et al. <a href="https://html.spec.whatwg.org/multipage/"><cite>HTML Standard</cite></a>. Living Standard. URL: <a href="https://html.spec.whatwg.org/multipage/">https://html.spec.whatwg.org/multipage/</a>
   <dt id="biblio-performance-timeline">[PERFORMANCE-TIMELINE]
   <dd>Nicolas Pena Moreno. <a href="https://w3c.github.io/performance-timeline/"><cite>Performance Timeline</cite></a>. URL: <a href="https://w3c.github.io/performance-timeline/">https://w3c.github.io/performance-timeline/</a>
   <dt id="biblio-rfc2119">[RFC2119]
   <dd>S. Bradner. <a href="https://datatracker.ietf.org/doc/html/rfc2119"><cite>Key words for use in RFCs to Indicate Requirement Levels</cite></a>. March 1997. Best Current Practice. URL: <a href="https://datatracker.ietf.org/doc/html/rfc2119">https://datatracker.ietf.org/doc/html/rfc2119</a>
   <dt id="biblio-webidl">[WEBIDL]
   <dd>Edgar Chen; Timothy Gu. <a href="https://webidl.spec.whatwg.org/"><cite>Web IDL Standard</cite></a>. Living Standard. URL: <a href="https://webidl.spec.whatwg.org/">https://webidl.spec.whatwg.org/</a>
  </dl>
  <h2 class="no-num no-ref heading settled" id="idl-index"><span class="content">IDL Index</span><a class="self-link" href="#idl-index"></a></h2>
<pre class="idl highlight def">[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed"><c- g>Exposed</c-></a>=<c- n>Window</c->]
<c- b>interface</c-> <a href="#performancelongtasktiming"><code class="highlight"><c- g>PerformanceLongTaskTiming</c-></code></a> : <a data-link-type="idl-name" href="https://w3c.github.io/performance-timeline/#the-performanceentry-interface"><c- n>PerformanceEntry</c-></a> {
    <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-frozen-array"><c- b>FrozenArray</c-></a>&lt;<a data-link-type="idl-name" href="#taskattributiontiming"><c- n>TaskAttributionTiming</c-></a>> <a class="idl-code" data-link-type="attribute" data-readonly data-type="FrozenArray<TaskAttributionTiming>" href="#dom-performancelongtasktiming-attribution"><c- g>attribution</c-></a>;
    [<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Default"><c- g>Default</c-></a>] <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-object"><c- b>object</c-></a> <a href="#dom-performancelongtasktiming-tojson"><code class="highlight"><c- g>toJSON</c-></code></a>();
};

[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed"><c- g>Exposed</c-></a>=<c- n>Window</c->]
<c- b>interface</c-> <a href="#taskattributiontiming"><code class="highlight"><c- g>TaskAttributionTiming</c-></code></a> : <a data-link-type="idl-name" href="https://w3c.github.io/performance-timeline/#the-performanceentry-interface"><c- n>PerformanceEntry</c-></a> {
    <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString"><c- b>DOMString</c-></a> <a class="idl-code" data-link-type="attribute" data-readonly data-type="DOMString" href="#dom-taskattributiontiming-containertype"><c- g>containerType</c-></a>;
    <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString"><c- b>DOMString</c-></a> <a class="idl-code" data-link-type="attribute" data-readonly data-type="DOMString" href="#dom-taskattributiontiming-containersrc"><c- g>containerSrc</c-></a>;
    <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString"><c- b>DOMString</c-></a> <a class="idl-code" data-link-type="attribute" data-readonly data-type="DOMString" href="#dom-taskattributiontiming-containerid"><c- g>containerId</c-></a>;
    <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString"><c- b>DOMString</c-></a> <a class="idl-code" data-link-type="attribute" data-readonly data-type="DOMString" href="#dom-taskattributiontiming-containername"><c- g>containerName</c-></a>;
    [<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Default"><c- g>Default</c-></a>] <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-object"><c- b>object</c-></a> <a href="#dom-taskattributiontiming-tojson"><code class="highlight"><c- g>toJSON</c-></code></a>();
};

</pre>
  <h2 class="no-num no-ref heading settled" id="issues-index"><span class="content">Issues Index</span><a class="self-link" href="#issues-index"></a></h2>
  <div style="counter-reset:issue">
   <div class="issue"> there is some ongoing discussion regarding the scope of which <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#document">Documents</a></code> gain visibility over which long tasks, so this logic could change in the future. <a href="https://github.com/w3c/longtasks/issues/75">[Issue #75]</a> <a class="issue-return" href="#issue-63aa4f38" title="Jump to section">↵</a></div>
  </div>
  <details class="mdn-anno unpositioned" data-anno-for="dom-performancelongtasktiming-attribution">
   <summary><b class="less-than-two-engines-flag" title="This feature is in less than two current engines.">⚠</b><span>MDN</span></summary>
   <div class="feature">
    <p><a href="https://developer.mozilla.org/en-US/docs/Web/API/PerformanceLongTaskTiming/attribution" title="The attribution readonly property of the PerformanceLongTaskTiming interface returns an array of TaskAttributionTiming objects.">PerformanceLongTaskTiming/attribution</a></p>
    <p class="less-than-two-engines-text">In only one current engine.</p>
    <div class="support">
     <span class="firefox no"><span>Firefox</span><span>None</span></span><span class="safari no"><span>Safari</span><span>None</span></span><span class="chrome yes"><span>Chrome</span><span>58+</span></span>
     <hr>
     <span class="opera no"><span>Opera</span><span>?</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span>
     <hr>
     <span class="edge no"><span>Edge (Legacy)</span><span>?</span></span><span class="ie no"><span>IE</span><span>None</span></span>
     <hr>
     <span class="firefox_android no"><span>Firefox for Android</span><span>?</span></span><span class="safari_ios no"><span>iOS Safari</span><span>?</span></span><span class="chrome_android no"><span>Chrome for Android</span><span>?</span></span><span class="webview_android no"><span>Android WebView</span><span>?</span></span><span class="samsunginternet_android no"><span>Samsung Internet</span><span>?</span></span><span class="opera_android no"><span>Opera Mobile</span><span>?</span></span>
    </div>
   </div>
  </details>
  <details class="mdn-anno unpositioned" data-anno-for="dom-performancelongtasktiming-tojson">
   <summary><b class="less-than-two-engines-flag" title="This feature is in less than two current engines.">⚠</b><span>MDN</span></summary>
   <div class="feature">
    <p><a href="https://developer.mozilla.org/en-US/docs/Web/API/PerformanceLongTaskTiming/toJSON" title="The toJSON() method of the PerformanceLongTaskTiming interface is a serializer; it returns a JSON representation of the PerformanceLongTaskTiming object.">PerformanceLongTaskTiming/toJSON</a></p>
    <p class="less-than-two-engines-text">In only one current engine.</p>
    <div class="support">
     <span class="firefox no"><span>Firefox</span><span>None</span></span><span class="safari no"><span>Safari</span><span>None</span></span><span class="chrome yes"><span>Chrome</span><span>58+</span></span>
     <hr>
     <span class="opera no"><span>Opera</span><span>?</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span>
     <hr>
     <span class="edge no"><span>Edge (Legacy)</span><span>?</span></span><span class="ie no"><span>IE</span><span>None</span></span>
     <hr>
     <span class="firefox_android no"><span>Firefox for Android</span><span>?</span></span><span class="safari_ios no"><span>iOS Safari</span><span>?</span></span><span class="chrome_android no"><span>Chrome for Android</span><span>?</span></span><span class="webview_android no"><span>Android WebView</span><span>?</span></span><span class="samsunginternet_android no"><span>Samsung Internet</span><span>?</span></span><span class="opera_android no"><span>Opera Mobile</span><span>?</span></span>
    </div>
   </div>
  </details>
  <details class="mdn-anno unpositioned" data-anno-for="sec-PerformanceLongTaskTiming">
   <summary><b class="less-than-two-engines-flag" title="This feature is in less than two current engines.">⚠</b><span>MDN</span></summary>
   <div class="feature">
    <p><a href="https://developer.mozilla.org/en-US/docs/Web/API/PerformanceLongTaskTiming" title="The PerformanceLongTaskTiming interface provides information about tasks that occupy the UI thread for 50 milliseconds or more.">PerformanceLongTaskTiming</a></p>
    <p class="less-than-two-engines-text">In only one current engine.</p>
    <div class="support">
     <span class="firefox no"><span>Firefox</span><span>None</span></span><span class="safari no"><span>Safari</span><span>None</span></span><span class="chrome yes"><span>Chrome</span><span>58+</span></span>
     <hr>
     <span class="opera no"><span>Opera</span><span>?</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span>
     <hr>
     <span class="edge no"><span>Edge (Legacy)</span><span>?</span></span><span class="ie no"><span>IE</span><span>None</span></span>
     <hr>
     <span class="firefox_android no"><span>Firefox for Android</span><span>?</span></span><span class="safari_ios no"><span>iOS Safari</span><span>?</span></span><span class="chrome_android no"><span>Chrome for Android</span><span>?</span></span><span class="webview_android no"><span>Android WebView</span><span>?</span></span><span class="samsunginternet_android no"><span>Samsung Internet</span><span>?</span></span><span class="opera_android no"><span>Opera Mobile</span><span>?</span></span>
    </div>
   </div>
  </details>
  <details class="mdn-anno unpositioned" data-anno-for="dom-taskattributiontiming-containerid">
   <summary><b class="less-than-two-engines-flag" title="This feature is in less than two current engines.">⚠</b><span>MDN</span></summary>
   <div class="feature">
    <p><a href="https://developer.mozilla.org/en-US/docs/Web/API/TaskAttributionTiming/containerId" title="The containerId readonly property of the TaskAttributionTiming interface returns the container&apos;s id attribute. A container is the iframe, embed or object etc. that is being implicated, on the whole, for a long task.">TaskAttributionTiming/containerId</a></p>
    <p class="less-than-two-engines-text">In only one current engine.</p>
    <div class="support">
     <span class="firefox no"><span>Firefox</span><span>None</span></span><span class="safari no"><span>Safari</span><span>None</span></span><span class="chrome yes"><span>Chrome</span><span>58+</span></span>
     <hr>
     <span class="opera no"><span>Opera</span><span>?</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span>
     <hr>
     <span class="edge no"><span>Edge (Legacy)</span><span>?</span></span><span class="ie no"><span>IE</span><span>None</span></span>
     <hr>
     <span class="firefox_android no"><span>Firefox for Android</span><span>?</span></span><span class="safari_ios no"><span>iOS Safari</span><span>?</span></span><span class="chrome_android no"><span>Chrome for Android</span><span>?</span></span><span class="webview_android no"><span>Android WebView</span><span>?</span></span><span class="samsunginternet_android no"><span>Samsung Internet</span><span>?</span></span><span class="opera_android no"><span>Opera Mobile</span><span>?</span></span>
    </div>
   </div>
  </details>
  <details class="mdn-anno unpositioned" data-anno-for="dom-taskattributiontiming-containername">
   <summary><b class="less-than-two-engines-flag" title="This feature is in less than two current engines.">⚠</b><span>MDN</span></summary>
   <div class="feature">
    <p><a href="https://developer.mozilla.org/en-US/docs/Web/API/TaskAttributionTiming/containerName" title="The containerName readonly property of the TaskAttributionTiming interface returns the container&apos;s name attribute. A container is the iframe, embed or object etc. that is being implicated, on the whole, for a long task.">TaskAttributionTiming/containerName</a></p>
    <p class="less-than-two-engines-text">In only one current engine.</p>
    <div class="support">
     <span class="firefox no"><span>Firefox</span><span>None</span></span><span class="safari no"><span>Safari</span><span>None</span></span><span class="chrome yes"><span>Chrome</span><span>58+</span></span>
     <hr>
     <span class="opera no"><span>Opera</span><span>?</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span>
     <hr>
     <span class="edge no"><span>Edge (Legacy)</span><span>?</span></span><span class="ie no"><span>IE</span><span>None</span></span>
     <hr>
     <span class="firefox_android no"><span>Firefox for Android</span><span>?</span></span><span class="safari_ios no"><span>iOS Safari</span><span>?</span></span><span class="chrome_android no"><span>Chrome for Android</span><span>?</span></span><span class="webview_android no"><span>Android WebView</span><span>?</span></span><span class="samsunginternet_android no"><span>Samsung Internet</span><span>?</span></span><span class="opera_android no"><span>Opera Mobile</span><span>?</span></span>
    </div>
   </div>
  </details>
  <details class="mdn-anno unpositioned" data-anno-for="dom-taskattributiontiming-containersrc">
   <summary><b class="less-than-two-engines-flag" title="This feature is in less than two current engines.">⚠</b><span>MDN</span></summary>
   <div class="feature">
    <p><a href="https://developer.mozilla.org/en-US/docs/Web/API/TaskAttributionTiming/containerSrc" title="The containerSrc readonly property of the TaskAttributionTiming interface returns the container&apos;s src attribute. A container is the iframe, embed or object etc. that is being implicated, on the whole, for a long task.">TaskAttributionTiming/containerSrc</a></p>
    <p class="less-than-two-engines-text">In only one current engine.</p>
    <div class="support">
     <span class="firefox no"><span>Firefox</span><span>None</span></span><span class="safari no"><span>Safari</span><span>None</span></span><span class="chrome yes"><span>Chrome</span><span>58+</span></span>
     <hr>
     <span class="opera no"><span>Opera</span><span>?</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span>
     <hr>
     <span class="edge no"><span>Edge (Legacy)</span><span>?</span></span><span class="ie no"><span>IE</span><span>None</span></span>
     <hr>
     <span class="firefox_android no"><span>Firefox for Android</span><span>?</span></span><span class="safari_ios no"><span>iOS Safari</span><span>?</span></span><span class="chrome_android no"><span>Chrome for Android</span><span>?</span></span><span class="webview_android no"><span>Android WebView</span><span>?</span></span><span class="samsunginternet_android no"><span>Samsung Internet</span><span>?</span></span><span class="opera_android no"><span>Opera Mobile</span><span>?</span></span>
    </div>
   </div>
  </details>
  <details class="mdn-anno unpositioned" data-anno-for="dom-taskattributiontiming-containertype">
   <summary><b class="less-than-two-engines-flag" title="This feature is in less than two current engines.">⚠</b><span>MDN</span></summary>
   <div class="feature">
    <p><a href="https://developer.mozilla.org/en-US/docs/Web/API/TaskAttributionTiming/containerType" title="The containerType readonly property of the TaskAttributionTiming interface returns the type of the container, one of iframe, embed, or object.">TaskAttributionTiming/containerType</a></p>
    <p class="less-than-two-engines-text">In only one current engine.</p>
    <div class="support">
     <span class="firefox no"><span>Firefox</span><span>None</span></span><span class="safari no"><span>Safari</span><span>None</span></span><span class="chrome yes"><span>Chrome</span><span>58+</span></span>
     <hr>
     <span class="opera no"><span>Opera</span><span>?</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span>
     <hr>
     <span class="edge no"><span>Edge (Legacy)</span><span>?</span></span><span class="ie no"><span>IE</span><span>None</span></span>
     <hr>
     <span class="firefox_android no"><span>Firefox for Android</span><span>?</span></span><span class="safari_ios no"><span>iOS Safari</span><span>?</span></span><span class="chrome_android no"><span>Chrome for Android</span><span>?</span></span><span class="webview_android no"><span>Android WebView</span><span>?</span></span><span class="samsunginternet_android no"><span>Samsung Internet</span><span>?</span></span><span class="opera_android no"><span>Opera Mobile</span><span>?</span></span>
    </div>
   </div>
  </details>
  <details class="mdn-anno unpositioned" data-anno-for="dom-taskattributiontiming-tojson">
   <summary><b class="less-than-two-engines-flag" title="This feature is in less than two current engines.">⚠</b><span>MDN</span></summary>
   <div class="feature">
    <p><a href="https://developer.mozilla.org/en-US/docs/Web/API/TaskAttributionTiming/toJSON" title="The toJSON() method of the TaskAttributionTiming interface is a serializer; it returns a JSON representation of the TaskAttributionTiming object.">TaskAttributionTiming/toJSON</a></p>
    <p class="less-than-two-engines-text">In only one current engine.</p>
    <div class="support">
     <span class="firefox no"><span>Firefox</span><span>None</span></span><span class="safari no"><span>Safari</span><span>None</span></span><span class="chrome yes"><span>Chrome</span><span>58+</span></span>
     <hr>
     <span class="opera no"><span>Opera</span><span>?</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span>
     <hr>
     <span class="edge no"><span>Edge (Legacy)</span><span>?</span></span><span class="ie no"><span>IE</span><span>None</span></span>
     <hr>
     <span class="firefox_android no"><span>Firefox for Android</span><span>?</span></span><span class="safari_ios no"><span>iOS Safari</span><span>?</span></span><span class="chrome_android no"><span>Chrome for Android</span><span>?</span></span><span class="webview_android no"><span>Android WebView</span><span>?</span></span><span class="samsunginternet_android no"><span>Samsung Internet</span><span>?</span></span><span class="opera_android no"><span>Opera Mobile</span><span>?</span></span>
    </div>
   </div>
  </details>
  <details class="mdn-anno unpositioned" data-anno-for="sec-TaskAttributionTiming">
   <summary><b class="less-than-two-engines-flag" title="This feature is in less than two current engines.">⚠</b><span>MDN</span></summary>
   <div class="feature">
    <p><a href="https://developer.mozilla.org/en-US/docs/Web/API/TaskAttributionTiming" title="The TaskAttributionTiming interface returns information about the work involved in a long task and its associate frame context. The frame context, also called the container, is the iframe, embed or object that is being implicated, on the whole, for a long task.">TaskAttributionTiming</a></p>
    <p class="less-than-two-engines-text">In only one current engine.</p>
    <div class="support">
     <span class="firefox no"><span>Firefox</span><span>None</span></span><span class="safari no"><span>Safari</span><span>None</span></span><span class="chrome yes"><span>Chrome</span><span>58+</span></span>
     <hr>
     <span class="opera no"><span>Opera</span><span>?</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span>
     <hr>
     <span class="edge no"><span>Edge (Legacy)</span><span>?</span></span><span class="ie no"><span>IE</span><span>None</span></span>
     <hr>
     <span class="firefox_android no"><span>Firefox for Android</span><span>?</span></span><span class="safari_ios no"><span>iOS Safari</span><span>?</span></span><span class="chrome_android no"><span>Chrome for Android</span><span>?</span></span><span class="webview_android no"><span>Android WebView</span><span>?</span></span><span class="samsunginternet_android no"><span>Samsung Internet</span><span>?</span></span><span class="opera_android no"><span>Opera Mobile</span><span>?</span></span>
    </div>
   </div>
  </details>
<script>/* Boilerplate: script-dom-helper */
"use strict";
function query(sel) { return document.querySelector(sel); }

function queryAll(sel) { return [...document.querySelectorAll(sel)]; }

function iter(obj) {
	if(!obj) return [];
	var it = obj[Symbol.iterator];
	if(it) return it;
	return Object.entries(obj);
}

function mk(tagname, attrs, ...children) {
	const el = document.createElement(tagname);
	for(const [k,v] of iter(attrs)) {
		if(k.slice(0,3) == "_on") {
			const eventName = k.slice(3);
			el.addEventListener(eventName, v);
		} else if(k[0] == "_") {
			// property, not attribute
			el[k.slice(1)] = v;
		} else {
			if(v === false || v == null) {
        continue;
      } else if(v === true) {
        el.setAttribute(k, "");
        continue;
      } else {
  			el.setAttribute(k, v);
      }
		}
	}
	append(el, children);
	return el;
}

/* Create shortcuts for every known HTML element */
[
  "a",
  "abbr",
  "acronym",
  "address",
  "applet",
  "area",
  "article",
  "aside",
  "audio",
  "b",
  "base",
  "basefont",
  "bdo",
  "big",
  "blockquote",
  "body",
  "br",
  "button",
  "canvas",
  "caption",
  "center",
  "cite",
  "code",
  "col",
  "colgroup",
  "datalist",
  "dd",
  "del",
  "details",
  "dfn",
  "dialog",
  "div",
  "dl",
  "dt",
  "em",
  "embed",
  "fieldset",
  "figcaption",
  "figure",
  "font",
  "footer",
  "form",
  "frame",
  "frameset",
  "head",
  "header",
  "h1",
  "h2",
  "h3",
  "h4",
  "h5",
  "h6",
  "hr",
  "html",
  "i",
  "iframe",
  "img",
  "input",
  "ins",
  "kbd",
  "label",
  "legend",
  "li",
  "link",
  "main",
  "map",
  "mark",
  "meta",
  "meter",
  "nav",
  "nobr",
  "noscript",
  "object",
  "ol",
  "optgroup",
  "option",
  "output",
  "p",
  "param",
  "pre",
  "progress",
  "q",
  "s",
  "samp",
  "script",
  "section",
  "select",
  "small",
  "source",
  "span",
  "strike",
  "strong",
  "style",
  "sub",
  "summary",
  "sup",
  "table",
  "tbody",
  "td",
  "template",
  "textarea",
  "tfoot",
  "th",
  "thead",
  "time",
  "title",
  "tr",
  "u",
  "ul",
  "var",
  "video",
  "wbr",
  "xmp",
].forEach(tagname=>{
	mk[tagname] = (...args) => mk(tagname, ...args);
});

function* nodesFromChildList(children) {
	for(const child of children.flat(Infinity)) {
		if(child instanceof Node) {
			yield child;
		} else {
			yield new Text(child);
		}
	}
}
function append(el, ...children) {
	for(const child of nodesFromChildList(children)) {
		if(el instanceof Node) el.appendChild(child);
		else el.push(child);
	}
	return el;
}

function insertAfter(el, ...children) {
	for(const child of nodesFromChildList(children)) {
		el.parentNode.insertBefore(child, el.nextSibling);
	}
	return el;
}

function clearContents(el) {
	el.innerHTML = "";
	return el;
}

function parseHTML(markup) {
	if(markup.toLowerCase().trim().indexOf('<!doctype') === 0) {
		const doc = document.implementation.createHTMLDocument("");
		doc.documentElement.innerHTML = markup;
		return doc;
	} else {
		const el = mk.template({});
		el.innerHTML = markup;
		return el.content;
	}
}</script>
<script>/* Boilerplate: script-dfn-panel */
"use strict";
{
let dfnPanelData = {
"08a90f22": {"dfnID":"08a90f22","dfnText":"entryType","external":true,"refSections":[{"refs":[{"id":"ref-for-dom-performanceentry-entrytype"}],"title":"3.1. PerformanceLongTaskTiming interface"},{"refs":[{"id":"ref-for-dom-performanceentry-entrytype\u2460"}],"title":"3.2. TaskAttributionTiming interface"},{"refs":[{"id":"ref-for-dom-performanceentry-entrytype\u2461"},{"id":"ref-for-dom-performanceentry-entrytype\u2462"}],"title":"4.1. Report long tasks"}],"url":"https://w3c.github.io/performance-timeline/#dom-performanceentry-entrytype"},
"09c54b53": {"dfnID":"09c54b53","dfnText":"name","external":true,"refSections":[{"refs":[{"id":"ref-for-dom-performanceentry-name"}],"title":"3.1. PerformanceLongTaskTiming interface"},{"refs":[{"id":"ref-for-dom-performanceentry-name\u2460"}],"title":"3.2. TaskAttributionTiming interface"},{"refs":[{"id":"ref-for-dom-performanceentry-name\u2461"},{"id":"ref-for-dom-performanceentry-name\u2462"},{"id":"ref-for-dom-performanceentry-name\u2463"}],"title":"3.3. Pointing to the culprit"},{"refs":[{"id":"ref-for-dom-performanceentry-name\u2464"},{"id":"ref-for-dom-performanceentry-name\u2465"},{"id":"ref-for-dom-performanceentry-name\u2466"}],"title":"4.1. Report long tasks"},{"refs":[{"id":"ref-for-dom-performanceentry-name\u2467"},{"id":"ref-for-dom-performanceentry-name\u2468"}],"title":"5. Security & privacy considerations"}],"url":"https://w3c.github.io/performance-timeline/#dom-performanceentry-name"},
"1c4b7879": {"dfnID":"1c4b7879","dfnText":"unit of related browsing contexts","external":true,"refSections":[{"refs":[{"id":"ref-for-unit-of-related-browsing-contexts"}],"title":"3.3. Pointing to the culprit"}],"url":"https://html.spec.whatwg.org/multipage/#unit-of-related-browsing-contexts"},
"23bea91f": {"dfnID":"23bea91f","dfnText":"agent cluster","external":true,"refSections":[{"refs":[{"id":"ref-for-integration-with-the-javascript-agent-cluster-formalism"}],"title":"3.3. Pointing to the culprit"}],"url":"https://html.spec.whatwg.org/multipage/#integration-with-the-javascript-agent-cluster-formalism"},
"2437ca5a": {"dfnID":"2437ca5a","dfnText":"event loop","external":true,"refSections":[{"refs":[{"id":"ref-for-event-loop"}],"title":"2. Terminology"},{"refs":[{"id":"ref-for-event-loop\u2460"}],"title":"3.1. PerformanceLongTaskTiming interface"}],"url":"https://html.spec.whatwg.org/multipage/#event-loop"},
"35972864": {"dfnID":"35972864","dfnText":"active document","external":true,"refSections":[{"refs":[{"id":"ref-for-nav-document"},{"id":"ref-for-nav-document\u2460"},{"id":"ref-for-nav-document\u2461"}],"title":"4.1. Report long tasks"}],"url":"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-document"},
"3efa5dd7": {"dfnID":"3efa5dd7","dfnText":"queue the performanceentry","external":true,"refSections":[{"refs":[{"id":"ref-for-dfn-queue-a-performanceentry"}],"title":"4.1. Report long tasks"}],"url":"https://w3c.github.io/performance-timeline/#dfn-queue-a-performanceentry"},
"41cd0b68": {"dfnID":"41cd0b68","dfnText":"DOMHighResTimeStamp","external":true,"refSections":[{"refs":[{"id":"ref-for-idl-def-domhighrestimestamp"},{"id":"ref-for-idl-def-domhighrestimestamp\u2460"}],"title":"3.1. PerformanceLongTaskTiming interface"}],"url":"https://w3c.github.io/hr-time/#idl-def-domhighrestimestamp"},
"43ac8374": {"dfnID":"43ac8374","dfnText":"origin","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-settings-object-origin"},{"id":"ref-for-concept-settings-object-origin\u2460"}],"title":"4.1. Report long tasks"}],"url":"https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin"},
"4468342f": {"dfnID":"4468342f","dfnText":"data","external":true,"refSections":[{"refs":[{"id":"ref-for-attr-object-data"}],"title":"4.1. Report long tasks"}],"url":"https://html.spec.whatwg.org/multipage/iframe-embed-object.html#attr-object-data"},
"49a6cb20": {"dfnID":"49a6cb20","dfnText":"embed","external":true,"refSections":[{"refs":[{"id":"ref-for-the-embed-element"}],"title":"4.1. Report long tasks"}],"url":"https://html.spec.whatwg.org/multipage/iframe-embed-object.html#the-embed-element"},
"552c9d85": {"dfnID":"552c9d85","dfnText":"list of the descendant browsing contexts","external":true,"refSections":[{"refs":[{"id":"ref-for-list-of-the-descendant-browsing-contexts"},{"id":"ref-for-list-of-the-descendant-browsing-contexts\u2460"}],"title":"3.1. PerformanceLongTaskTiming interface"},{"refs":[{"id":"ref-for-list-of-the-descendant-browsing-contexts\u2461"}],"title":"4.1. Report long tasks"}],"url":"https://html.spec.whatwg.org/multipage/#list-of-the-descendant-browsing-contexts"},
"5991ccfb": {"dfnID":"5991ccfb","dfnText":"relevant realm","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-relevant-realm"},{"id":"ref-for-concept-relevant-realm\u2460"}],"title":"4.1. Report long tasks"}],"url":"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm"},
"5d7209e9": {"dfnID":"5d7209e9","dfnText":"Window","external":true,"refSections":[{"refs":[{"id":"ref-for-window"}],"title":"4. Processing model"}],"url":"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window"},
"60596594": {"dfnID":"60596594","dfnText":"ancestor","external":true,"refSections":[{"refs":[{"id":"ref-for-ancestor-browsing-context"},{"id":"ref-for-ancestor-browsing-context\u2460"},{"id":"ref-for-ancestor-browsing-context\u2461"},{"id":"ref-for-ancestor-browsing-context\u2462"}],"title":"4.1. Report long tasks"}],"url":"https://html.spec.whatwg.org/multipage/#ancestor-browsing-context"},
"6a288f2a": {"dfnID":"6a288f2a","dfnText":"microtask","external":true,"refSections":[{"refs":[{"id":"ref-for-microtask"}],"title":"2. Terminology"}],"url":"https://html.spec.whatwg.org/multipage/webappapis.html#microtask"},
"6d88ab2e": {"dfnID":"6d88ab2e","dfnText":"browsing context (for Window)","external":true,"refSections":[{"refs":[{"id":"ref-for-window-bc"},{"id":"ref-for-window-bc\u2460"},{"id":"ref-for-window-bc\u2461"}],"title":"4.1. Report long tasks"}],"url":"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window-bc"},
"6ea37aa1": {"dfnID":"6ea37aa1","dfnText":"id","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-id"}],"title":"4.1. Report long tasks"}],"url":"https://dom.spec.whatwg.org/#concept-id"},
"7393da89": {"dfnID":"7393da89","dfnText":"same origin","external":true,"refSections":[{"refs":[{"id":"ref-for-same-origin"},{"id":"ref-for-same-origin\u2460"},{"id":"ref-for-same-origin\u2461"}],"title":"3.1. PerformanceLongTaskTiming interface"},{"refs":[{"id":"ref-for-same-origin\u2463"}],"title":"4.1. Report long tasks"}],"url":"https://html.spec.whatwg.org/multipage/browsers.html#same-origin"},
"83c1e4af": {"dfnID":"83c1e4af","dfnText":"browsing context","external":true,"refSections":[{"refs":[{"id":"ref-for-browsing-context"},{"id":"ref-for-browsing-context\u2460"},{"id":"ref-for-browsing-context\u2461"},{"id":"ref-for-browsing-context\u2462"}],"title":"3.1. PerformanceLongTaskTiming interface"},{"refs":[{"id":"ref-for-browsing-context\u2463"}],"title":"3.3. Pointing to the culprit"}],"url":"https://html.spec.whatwg.org/multipage/#browsing-context"},
"85394472": {"dfnID":"85394472","dfnText":"Document","external":true,"refSections":[{"refs":[{"id":"ref-for-document"}],"title":"4.1. Report long tasks"}],"url":"https://dom.spec.whatwg.org/#document"},
"8603b31a": {"dfnID":"8603b31a","dfnText":"perform a microtask checkpoint","external":true,"refSections":[{"refs":[{"id":"ref-for-perform-a-microtask-checkpoint"}],"title":"2. Terminology"}],"url":"https://html.spec.whatwg.org/multipage/webappapis.html#perform-a-microtask-checkpoint"},
"87fcd40c": {"dfnID":"87fcd40c","dfnText":"iframe","external":true,"refSections":[{"refs":[{"id":"ref-for-the-iframe-element"}],"title":"2. Terminology"},{"refs":[{"id":"ref-for-the-iframe-element\u2460"}],"title":"4.1. Report long tasks"}],"url":"https://html.spec.whatwg.org/multipage/iframe-embed-object.html#the-iframe-element"},
"8855a9aa": {"dfnID":"8855a9aa","dfnText":"DOMString","external":true,"refSections":[{"refs":[{"id":"ref-for-idl-DOMString"},{"id":"ref-for-idl-DOMString\u2460"},{"id":"ref-for-idl-DOMString\u2461"},{"id":"ref-for-idl-DOMString\u2462"}],"title":"3.2. TaskAttributionTiming interface"}],"url":"https://webidl.spec.whatwg.org/#idl-DOMString"},
"889e932f": {"dfnID":"889e932f","dfnText":"Exposed","external":true,"refSections":[{"refs":[{"id":"ref-for-Exposed"}],"title":"3.1. PerformanceLongTaskTiming interface"},{"refs":[{"id":"ref-for-Exposed\u2460"}],"title":"3.2. TaskAttributionTiming interface"}],"url":"https://webidl.spec.whatwg.org/#Exposed"},
"88ed8860": {"dfnID":"88ed8860","dfnText":"frame","external":true,"refSections":[{"refs":[{"id":"ref-for-frame"}],"title":"4.1. Report long tasks"}],"url":"https://html.spec.whatwg.org/multipage/obsolete.html#frame"},
"8a30477b": {"dfnID":"8a30477b","dfnText":"global object","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-settings-object-global"},{"id":"ref-for-concept-settings-object-global\u2460"},{"id":"ref-for-concept-settings-object-global\u2461"}],"title":"4.1. Report long tasks"}],"url":"https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-global"},
"99b5cef6": {"dfnID":"99b5cef6","dfnText":"object","external":true,"refSections":[{"refs":[{"id":"ref-for-the-object-element"}],"title":"2. Terminology"},{"refs":[{"id":"ref-for-the-object-element\u2460"}],"title":"4.1. Report long tasks"}],"url":"https://html.spec.whatwg.org/multipage/iframe-embed-object.html#the-object-element"},
"a117ab2c": {"dfnID":"a117ab2c","dfnText":"javascript realms","external":true,"refSections":[{"refs":[{"id":"ref-for-sec-code-realms"},{"id":"ref-for-sec-code-realms\u2460"},{"id":"ref-for-sec-code-realms\u2461"}],"title":"4.1. Report long tasks"}],"url":"https://tc39.github.io/ecma262/#sec-code-realms"},
"aa16a049": {"dfnID":"aa16a049","dfnText":"name","external":true,"refSections":[{"refs":[{"id":"ref-for-attr-iframe-name"}],"title":"4.1. Report long tasks"}],"url":"https://html.spec.whatwg.org/multipage/iframe-embed-object.html#attr-iframe-name"},
"ae2a6342": {"dfnID":"ae2a6342","dfnText":"top-level browsing context","external":true,"refSections":[{"refs":[{"id":"ref-for-top-level-browsing-context"}],"title":"4.1. Report long tasks"}],"url":"https://html.spec.whatwg.org/multipage/document-sequences.html#top-level-browsing-context"},
"attribution": {"dfnID":"attribution","dfnText":"Attribution","external":false,"refSections":[{"refs":[{"id":"ref-for-attribution"}],"title":"3.3. Pointing to the culprit"}],"url":"#attribution"},
"b815f411": {"dfnID":"b815f411","dfnText":"update the rendering","external":true,"refSections":[{"refs":[{"id":"ref-for-update-the-rendering"}],"title":"2. Terminology"}],"url":"https://html.spec.whatwg.org/multipage/webappapis.html#update-the-rendering"},
"cc7c9b78": {"dfnID":"cc7c9b78","dfnText":"startTime","external":true,"refSections":[{"refs":[{"id":"ref-for-dom-performanceentry-starttime"}],"title":"3.1. PerformanceLongTaskTiming interface"},{"refs":[{"id":"ref-for-dom-performanceentry-starttime\u2460"}],"title":"3.2. TaskAttributionTiming interface"},{"refs":[{"id":"ref-for-dom-performanceentry-starttime\u2461"},{"id":"ref-for-dom-performanceentry-starttime\u2462"}],"title":"4.1. Report long tasks"}],"url":"https://w3c.github.io/performance-timeline/#dom-performanceentry-starttime"},
"cross-origin-ancestor": {"dfnID":"cross-origin-ancestor","dfnText":"cross-origin-ancestor","external":false,"refSections":[{"refs":[{"id":"ref-for-cross-origin-ancestor"}],"title":"3.3. Pointing to the culprit"},{"refs":[{"id":"ref-for-cross-origin-ancestor\u2460"}],"title":"4.1. Report long tasks"}],"url":"#cross-origin-ancestor"},
"cross-origin-descendant": {"dfnID":"cross-origin-descendant","dfnText":"cross-origin-descendant","external":false,"refSections":[{"refs":[{"id":"ref-for-cross-origin-descendant"}],"title":"3.3. Pointing to the culprit"},{"refs":[{"id":"ref-for-cross-origin-descendant\u2460"}],"title":"4.1. Report long tasks"}],"url":"#cross-origin-descendant"},
"cross-origin-unreachable": {"dfnID":"cross-origin-unreachable","dfnText":"cross-origin-unreachable","external":false,"refSections":[{"refs":[{"id":"ref-for-cross-origin-unreachable"}],"title":"3.3. Pointing to the culprit"},{"refs":[{"id":"ref-for-cross-origin-unreachable\u2460"},{"id":"ref-for-cross-origin-unreachable\u2461"}],"title":"4.1. Report long tasks"}],"url":"#cross-origin-unreachable"},
"culprit-browsing-context-container": {"dfnID":"culprit-browsing-context-container","dfnText":"Culprit browsing context container","external":false,"refSections":[{"refs":[{"id":"ref-for-culprit-browsing-context-container"}],"title":"2. Terminology"},{"refs":[{"id":"ref-for-culprit-browsing-context-container\u2460"},{"id":"ref-for-culprit-browsing-context-container\u2461"},{"id":"ref-for-culprit-browsing-context-container\u2462"},{"id":"ref-for-culprit-browsing-context-container\u2463"},{"id":"ref-for-culprit-browsing-context-container\u2464"},{"id":"ref-for-culprit-browsing-context-container\u2465"},{"id":"ref-for-culprit-browsing-context-container\u2466"},{"id":"ref-for-culprit-browsing-context-container\u2467"}],"title":"3.2. TaskAttributionTiming interface"},{"refs":[{"id":"ref-for-culprit-browsing-context-container\u2468"},{"id":"ref-for-culprit-browsing-context-container\u2460\u24ea"},{"id":"ref-for-culprit-browsing-context-container\u2460\u2460"}],"title":"3.3. Pointing to the culprit"}],"url":"#culprit-browsing-context-container"},
"d3143ca1": {"dfnID":"d3143ca1","dfnText":"src (for embed)","external":true,"refSections":[{"refs":[{"id":"ref-for-attr-embed-src"}],"title":"4.1. Report long tasks"}],"url":"https://html.spec.whatwg.org/multipage/iframe-embed-object.html#attr-embed-src"},
"dcf5fafa": {"dfnID":"dcf5fafa","dfnText":"FrozenArray","external":true,"refSections":[{"refs":[{"id":"ref-for-idl-frozen-array"}],"title":"3.1. PerformanceLongTaskTiming interface"}],"url":"https://webidl.spec.whatwg.org/#idl-frozen-array"},
"de4bb79b": {"dfnID":"de4bb79b","dfnText":"supportedEntryTypes","external":true,"refSections":[{"refs":[{"id":"ref-for-supportedentrytypes-attribute"}],"title":"4. Processing model"}],"url":"https://w3c.github.io/performance-timeline/#supportedentrytypes-attribute"},
"deddc6fc": {"dfnID":"deddc6fc","dfnText":"src (for iframe)","external":true,"refSections":[{"refs":[{"id":"ref-for-attr-iframe-src"},{"id":"ref-for-attr-iframe-src\u2460"}],"title":"4.1. Report long tasks"}],"url":"https://html.spec.whatwg.org/multipage/iframe-embed-object.html#attr-iframe-src"},
"df79032a": {"dfnID":"df79032a","dfnText":"PerformanceEntry","external":true,"refSections":[{"refs":[{"id":"ref-for-the-performanceentry-interface"}],"title":"3.1. PerformanceLongTaskTiming interface"},{"refs":[{"id":"ref-for-the-performanceentry-interface\u2460"}],"title":"3.2. TaskAttributionTiming interface"}],"url":"https://w3c.github.io/performance-timeline/#the-performanceentry-interface"},
"dom-performancelongtasktiming-attribution": {"dfnID":"dom-performancelongtasktiming-attribution","dfnText":"attribution","external":false,"refSections":[{"refs":[{"id":"ref-for-dom-performancelongtasktiming-attribution"}],"title":"3.1. PerformanceLongTaskTiming interface"},{"refs":[{"id":"ref-for-dom-performancelongtasktiming-attribution\u2460"},{"id":"ref-for-dom-performancelongtasktiming-attribution\u2461"},{"id":"ref-for-dom-performancelongtasktiming-attribution\u2462"}],"title":"3.3. Pointing to the culprit"},{"refs":[{"id":"ref-for-dom-performancelongtasktiming-attribution\u2463"},{"id":"ref-for-dom-performancelongtasktiming-attribution\u2464"}],"title":"4.1. Report long tasks"}],"url":"#dom-performancelongtasktiming-attribution"},
"dom-performancelongtasktiming-tojson": {"dfnID":"dom-performancelongtasktiming-tojson","dfnText":"toJSON","external":false,"refSections":[],"url":"#dom-performancelongtasktiming-tojson"},
"dom-taskattributiontiming-containerid": {"dfnID":"dom-taskattributiontiming-containerid","dfnText":"containerId","external":false,"refSections":[{"refs":[{"id":"ref-for-dom-taskattributiontiming-containerid"}],"title":"3.2. TaskAttributionTiming interface"},{"refs":[{"id":"ref-for-dom-taskattributiontiming-containerid\u2460"}],"title":"4.1. Report long tasks"}],"url":"#dom-taskattributiontiming-containerid"},
"dom-taskattributiontiming-containername": {"dfnID":"dom-taskattributiontiming-containername","dfnText":"containerName","external":false,"refSections":[{"refs":[{"id":"ref-for-dom-taskattributiontiming-containername"}],"title":"3.2. TaskAttributionTiming interface"},{"refs":[{"id":"ref-for-dom-taskattributiontiming-containername\u2460"},{"id":"ref-for-dom-taskattributiontiming-containername\u2461"},{"id":"ref-for-dom-taskattributiontiming-containername\u2462"},{"id":"ref-for-dom-taskattributiontiming-containername\u2463"},{"id":"ref-for-dom-taskattributiontiming-containername\u2464"}],"title":"4.1. Report long tasks"}],"url":"#dom-taskattributiontiming-containername"},
"dom-taskattributiontiming-containersrc": {"dfnID":"dom-taskattributiontiming-containersrc","dfnText":"containerSrc","external":false,"refSections":[{"refs":[{"id":"ref-for-dom-taskattributiontiming-containersrc"}],"title":"3.2. TaskAttributionTiming interface"},{"refs":[{"id":"ref-for-dom-taskattributiontiming-containersrc\u2460"},{"id":"ref-for-dom-taskattributiontiming-containersrc\u2461"},{"id":"ref-for-dom-taskattributiontiming-containersrc\u2462"},{"id":"ref-for-dom-taskattributiontiming-containersrc\u2463"},{"id":"ref-for-dom-taskattributiontiming-containersrc\u2464"}],"title":"4.1. Report long tasks"}],"url":"#dom-taskattributiontiming-containersrc"},
"dom-taskattributiontiming-containertype": {"dfnID":"dom-taskattributiontiming-containertype","dfnText":"containerType","external":false,"refSections":[{"refs":[{"id":"ref-for-dom-taskattributiontiming-containertype"}],"title":"3.2. TaskAttributionTiming interface"},{"refs":[{"id":"ref-for-dom-taskattributiontiming-containertype\u2460"},{"id":"ref-for-dom-taskattributiontiming-containertype\u2461"},{"id":"ref-for-dom-taskattributiontiming-containertype\u2462"},{"id":"ref-for-dom-taskattributiontiming-containertype\u2463"},{"id":"ref-for-dom-taskattributiontiming-containertype\u2464"}],"title":"4.1. Report long tasks"}],"url":"#dom-taskattributiontiming-containertype"},
"dom-taskattributiontiming-tojson": {"dfnID":"dom-taskattributiontiming-tojson","dfnText":"toJSON","external":false,"refSections":[],"url":"#dom-taskattributiontiming-tojson"},
"e270bd2a": {"dfnID":"e270bd2a","dfnText":"task","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-task"},{"id":"ref-for-concept-task\u2460"}],"title":"2. Terminology"},{"refs":[{"id":"ref-for-concept-task\u2461"},{"id":"ref-for-concept-task\u2462"},{"id":"ref-for-concept-task\u2463"},{"id":"ref-for-concept-task\u2464"},{"id":"ref-for-concept-task\u2465"},{"id":"ref-for-concept-task\u2466"},{"id":"ref-for-concept-task\u2467"},{"id":"ref-for-concept-task\u2468"}],"title":"3.1. PerformanceLongTaskTiming interface"}],"url":"https://html.spec.whatwg.org/multipage/webappapis.html#concept-task"},
"efd1ec5d": {"dfnID":"efd1ec5d","dfnText":"object","external":true,"refSections":[{"refs":[{"id":"ref-for-idl-object"}],"title":"3.1. PerformanceLongTaskTiming interface"},{"refs":[{"id":"ref-for-idl-object\u2460"}],"title":"3.2. TaskAttributionTiming interface"}],"url":"https://webidl.spec.whatwg.org/#idl-object"},
"f4531911": {"dfnID":"f4531911","dfnText":"Default","external":true,"refSections":[{"refs":[{"id":"ref-for-Default"}],"title":"3.1. PerformanceLongTaskTiming interface"},{"refs":[{"id":"ref-for-Default\u2460"}],"title":"3.2. TaskAttributionTiming interface"}],"url":"https://webidl.spec.whatwg.org/#Default"},
"f8c9e23a": {"dfnID":"f8c9e23a","dfnText":"script evaluation environment settings object set","external":true,"refSections":[{"refs":[{"id":"ref-for-script-evaluation-environment-settings-object-set"},{"id":"ref-for-script-evaluation-environment-settings-object-set\u2460"},{"id":"ref-for-script-evaluation-environment-settings-object-set\u2461"},{"id":"ref-for-script-evaluation-environment-settings-object-set\u2462"},{"id":"ref-for-script-evaluation-environment-settings-object-set\u2463"}],"title":"4.1. Report long tasks"}],"url":"https://html.spec.whatwg.org/multipage/#script-evaluation-environment-settings-object-set"},
"fabd3046": {"dfnID":"fabd3046","dfnText":"duration","external":true,"refSections":[{"refs":[{"id":"ref-for-dom-performanceentry-duration"}],"title":"3.1. PerformanceLongTaskTiming interface"},{"refs":[{"id":"ref-for-dom-performanceentry-duration\u2460"}],"title":"3.2. TaskAttributionTiming interface"},{"refs":[{"id":"ref-for-dom-performanceentry-duration\u2461"},{"id":"ref-for-dom-performanceentry-duration\u2462"}],"title":"4.1. Report long tasks"}],"url":"https://w3c.github.io/performance-timeline/#dom-performanceentry-duration"},
"long-task": {"dfnID":"long-task","dfnText":"Long task","external":false,"refSections":[{"refs":[{"id":"ref-for-long-task"}],"title":"2. Terminology"},{"refs":[{"id":"ref-for-long-task\u2460"},{"id":"ref-for-long-task\u2461"}],"title":"3.3. Pointing to the culprit"}],"url":"#long-task"},
"minimal-culprit-attribution": {"dfnID":"minimal-culprit-attribution","dfnText":"minimal culprit attribution","external":false,"refSections":[{"refs":[{"id":"ref-for-minimal-culprit-attribution"}],"title":"4.1. Report long tasks"}],"url":"#minimal-culprit-attribution"},
"multiple-contexts": {"dfnID":"multiple-contexts","dfnText":"multiple-contexts","external":false,"refSections":[{"refs":[{"id":"ref-for-multiple-contexts"}],"title":"3.3. Pointing to the culprit"},{"refs":[{"id":"ref-for-multiple-contexts\u2460"}],"title":"4.1. Report long tasks"}],"url":"#multiple-contexts"},
"performancelongtasktiming": {"dfnID":"performancelongtasktiming","dfnText":"PerformanceLongTaskTiming","external":false,"refSections":[{"refs":[{"id":"ref-for-performancelongtasktiming"},{"id":"ref-for-performancelongtasktiming\u2460"}],"title":"3.1. PerformanceLongTaskTiming interface"},{"refs":[{"id":"ref-for-performancelongtasktiming\u2461"},{"id":"ref-for-performancelongtasktiming\u2462"}],"title":"3.3. Pointing to the culprit"},{"refs":[{"id":"ref-for-performancelongtasktiming\u2463"}],"title":"4.1. Report long tasks"}],"url":"#performancelongtasktiming"},
"same-origin": {"dfnID":"same-origin","dfnText":"same-origin","external":false,"refSections":[{"refs":[{"id":"ref-for-same-origin\u2462"}],"title":"3.3. Pointing to the culprit"},{"refs":[{"id":"ref-for-same-origin\u2464"},{"id":"ref-for-same-origin\u2465"}],"title":"4.1. Report long tasks"}],"url":"#same-origin"},
"same-origin-ancestor": {"dfnID":"same-origin-ancestor","dfnText":"same-origin-ancestor","external":false,"refSections":[{"refs":[{"id":"ref-for-same-origin-ancestor"}],"title":"3.3. Pointing to the culprit"},{"refs":[{"id":"ref-for-same-origin-ancestor\u2460"}],"title":"4.1. Report long tasks"}],"url":"#same-origin-ancestor"},
"same-origin-descendant": {"dfnID":"same-origin-descendant","dfnText":"same-origin-descendant","external":false,"refSections":[{"refs":[{"id":"ref-for-same-origin-descendant"}],"title":"3.3. Pointing to the culprit"},{"refs":[{"id":"ref-for-same-origin-descendant\u2460"}],"title":"4.1. Report long tasks"}],"url":"#same-origin-descendant"},
"self": {"dfnID":"self","dfnText":"self","external":false,"refSections":[{"refs":[{"id":"ref-for-self"}],"title":"3.3. Pointing to the culprit"},{"refs":[{"id":"ref-for-self\u2460"}],"title":"4.1. Report long tasks"}],"url":"#self"},
"taskattributiontiming": {"dfnID":"taskattributiontiming","dfnText":"TaskAttributionTiming","external":false,"refSections":[{"refs":[{"id":"ref-for-taskattributiontiming"},{"id":"ref-for-taskattributiontiming\u2460"}],"title":"3.1. PerformanceLongTaskTiming interface"},{"refs":[{"id":"ref-for-taskattributiontiming\u2461"},{"id":"ref-for-taskattributiontiming\u2462"}],"title":"3.2. TaskAttributionTiming interface"},{"refs":[{"id":"ref-for-taskattributiontiming\u2463"}],"title":"3.3. Pointing to the culprit"},{"refs":[{"id":"ref-for-taskattributiontiming\u2464"},{"id":"ref-for-taskattributiontiming\u2465"}],"title":"4.1. Report long tasks"}],"url":"#taskattributiontiming"},
"unknown": {"dfnID":"unknown","dfnText":"unknown","external":false,"refSections":[{"refs":[{"id":"ref-for-unknown"}],"title":"3.3. Pointing to the culprit"},{"refs":[{"id":"ref-for-unknown\u2460"},{"id":"ref-for-unknown\u2461"}],"title":"4.1. Report long tasks"}],"url":"#unknown"},
};

document.addEventListener("DOMContentLoaded", ()=>{
    genAllDfnPanels();

    document.body.addEventListener("click", (e) => {
        // If not handled already, just hide all dfn panels.
        hideAllDfnPanels();
    });
});

window.addEventListener("resize", () => {
    // Pin any visible dfn panel
    queryAll(".dfn-panel.on, .dfn-panel.activated").forEach(el=>positionDfnPanel(el));
});

function genAllDfnPanels() {
    for(const panelData of Object.values(dfnPanelData)) {
        const dfnID = panelData.dfnID;
        const dfn = document.getElementById(dfnID);
        if(!dfn) {
            console.log(`Can't find dfn#${dfnID}.`, panelData);
            continue;
        }
        dfn.panelData = panelData;
        insertDfnPopupAction(dfn);
    }
}

function genDfnPanel(dfn, { dfnID, url, dfnText, refSections, external }) {
    const dfnPanel = mk.aside({
        class: "dfn-panel on",
        id: `infopanel-for-${dfnID}`,
        "data-for": dfnID,
        "aria-labelled-by":`infopaneltitle-for-${dfnID}`,
        },
        mk.span({id:`infopaneltitle-for-${dfnID}`, style:"display:none"},
            `Info about the '${dfnText}' ${external?"external":""} reference.`),
        mk.a({href:url, class:"dfn-link"}, url),
        refSections.length == 0 ? [] :
            mk.b({}, "Referenced in:"),
            mk.ul({},
                ...refSections.map(section=>
                    mk.li({},
                        ...section.refs.map((ref, refI)=>
                            [
                                mk.a({ href: `#${ref.id}` },
                                    (refI == 0) ? section.title : `(${refI + 1})`
                                ),
                                " ",
                            ]
                        ),
                    ),
                ),
            ),
        genLinkingSyntaxes(dfn),
    );

    dfnPanel.addEventListener('click', (event) => {
        if (event.target.nodeName == 'A') {
            scrollToTargetAndHighlight(event);
            pinDfnPanel(dfnPanel);
        }
        event.stopPropagation();
        refocusOnTarget(event);
    });
    dfnPanel.addEventListener('keydown', (event) => {
        if(event.keyCode == 27) { // Escape key
            hideDfnPanel({dfnPanel});
            event.stopPropagation();
            event.preventDefault();
        }
    });

    dfnPanel.dfn = dfn;
    dfn.dfnPanel = dfnPanel;
    return dfnPanel;
}



function hideAllDfnPanels() {
    // Delete the currently-active dfn panel.
    queryAll(".dfn-panel").forEach(dfnPanel=>hideDfnPanel({dfnPanel}));
}

function showDfnPanel(dfn) {
    hideAllDfnPanels(); // Only display one at a time.

    dfn.setAttribute("aria-expanded", "true");

    const dfnPanel = genDfnPanel(dfn, dfn.panelData);

    // Give the dfn a unique tabindex, and then
    // give all the tabbable panel bits successive indexes.
    let tabIndex = 100;
    dfn.tabIndex = tabIndex++;
    const tabbable = dfnPanel.querySelectorAll(":is(a, button)");
    for (const el of tabbable) {
        el.tabIndex = tabIndex++;
    }

    append(document.body, dfnPanel);
    positionDfnPanel(dfnPanel);
}

function positionDfnPanel(dfnPanel) {
    const dfn = dfnPanel.dfn;
    const dfnPos = getBounds(dfn);
    dfnPanel.style.top = dfnPos.bottom + "px";
    dfnPanel.style.left = dfnPos.left + "px";

    const panelPos = dfnPanel.getBoundingClientRect();
    const panelMargin = 8;
    const maxRight = document.body.parentNode.clientWidth - panelMargin;
    if (panelPos.right > maxRight) {
        const overflowAmount = panelPos.right - maxRight;
        const newLeft = Math.max(panelMargin, dfnPos.left - overflowAmount);
        dfnPanel.style.left = newLeft + "px";
    }
}

function pinDfnPanel(dfnPanel) {
    // Switch it to "activated" state, which pins it.
    dfnPanel.classList.add("activated");
    dfnPanel.style.position = "fixed";
    dfnPanel.style.left = null;
    dfnPanel.style.top = null;
}

function hideDfnPanel({dfn, dfnPanel}) {
    if(!dfnPanel) dfnPanel = dfn.dfnPanel;
    if(!dfn) dfn = dfnPanel.dfn;
    dfn.dfnPanel = undefined;
    dfnPanel.dfn = undefined;
    dfn.setAttribute("aria-expanded", "false");
    dfn.tabIndex = undefined;
    dfnPanel.remove()
}

function toggleDfnPanel(dfn) {
    if(dfn.dfnPanel) {
        hideDfnPanel(dfn);
    } else {
        showDfnPanel(dfn);
    }
}

function insertDfnPopupAction(dfn) {
    dfn.setAttribute('role', 'button');
    dfn.setAttribute('aria-expanded', 'false')
    dfn.tabIndex = 0;
    dfn.classList.add('has-dfn-panel');
    dfn.addEventListener('click', (event) => {
        toggleDfnPanel(dfn);
        event.stopPropagation();
    });
    dfn.addEventListener('keypress', (event) => {
        const kc = event.keyCode;
        // 32->Space, 13->Enter
        if(kc == 32 || kc == 13) {
            toggleDfnPanel(dfn);
            event.stopPropagation();
            event.preventDefault();
        }
    });
}

function refocusOnTarget(event) {
    const target = event.target;
    setTimeout(() => {
        // Refocus on the event.target element.
        // This is needed after browser scrolls to the destination.
        target.focus();
    });
}

// TODO: shared util
// Returns the root-level absolute position {left and top} of element.
function getBounds(el, relativeTo=document.body) {
    const relativeRect = relativeTo.getBoundingClientRect();
    const elRect = el.getBoundingClientRect();
    const top = elRect.top - relativeRect.top;
    const left = elRect.left - relativeRect.left;
    return {
        top,
        left,
        bottom: top + elRect.height,
        right: left + elRect.width,
    }
}

function scrollToTargetAndHighlight(event) {
    let hash = event.target.hash;
    if (hash) {
        hash = decodeURIComponent(hash.substring(1));
        const dest = document.getElementById(hash);
        if (dest) {
            dest.classList.add('highlighted');
            setTimeout(() => dest.classList.remove('highlighted'), 1000);
        }
    }
}

// Functions, divided by link type, that wrap an autolink's
// contents with the appropriate outer syntax.
// Alternately, a string naming another type they format
// the same as.
function needsFor(type) {
    switch(type) {
        case "descriptor":
        case "value":
        case "element-attr":
        case "attr-value":
        case "element-state":
        case "method":
        case "constructor":
        case "argument":
        case "attribute":
        case "const":
        case "dict-member":
        case "event":
        case "enum-value":
        case "stringifier":
        case "serializer":
        case "iterator":
        case "maplike":
        case "setlike":
        case "state":
        case "mode":
        case "context":
        case "facet": return true;

        default: return false;
    }
}
function refusesFor(type) {
    switch(type) {
        case "property":
        case "element":
        case "interface":
        case "namespace":
        case "callback":
        case "dictionary":
        case "enum":
        case "exception":
        case "typedef":
        case "http-header":
        case "permission": return true;

        default: return false;
    }
}
function linkFormatterFromType(type) {
    switch(type) {
        case 'scheme':
        case 'permission':
        case 'dfn': return (text) => `[=${text}=]`;

        case 'abstract-op': return (text) => `[\$${text}\$]`;

        case 'function':
        case 'at-rule':
        case 'selector':
        case 'value': return (text) => `''${text}''`;

        case 'http-header': return (text) => `[:${text}:]`;

        case 'interface':
        case 'constructor':
        case 'method':
        case 'argument':
        case 'attribute':
        case 'callback':
        case 'dictionary':
        case 'dict-member':
        case 'enum':
        case 'enum-value':
        case 'exception':
        case 'const':
        case 'typedef':
        case 'stringifier':
        case 'serializer':
        case 'iterator':
        case 'maplike':
        case 'setlike':
        case 'extended-attribute':
        case 'event':
        case 'idl': return (text) => `{{${text}}}`;

        case 'element-state':
        case 'element-attr':
        case 'attr-value':
        case 'element': return (element) => `<{${element}}>`;

        case 'grammar': return (text) => `${text} (within a <pre class=prod>)`;

        case 'type': return (text)=> `<<${text}>>`;

        case 'descriptor':
        case 'property': return (text) => `'${text}'`;

        default: return;
    };
};

function genLinkingSyntaxes(dfn) {
    if(dfn.tagName != "DFN") return;

    const type = dfn.getAttribute('data-dfn-type');
    if(!type) {
        console.log(`<dfn> doesn't have a data-dfn-type:`, dfn);
        return [];
    }

    // Return a function that wraps link text based on the type
    const linkFormatter = linkFormatterFromType(type);
    if(!linkFormatter) {
        console.log(`<dfn> has an unknown data-dfn-type:`, dfn);
        return [];
    }

    let ltAlts;
    if(dfn.hasAttribute('data-lt')) {
        ltAlts = dfn.getAttribute('data-lt')
            .split("|")
            .map(x=>x.trim());
    } else {
        ltAlts = [dfn.textContent.trim()];
    }
    if(type == "type") {
        // lt of "<foo>", but "foo" is the interior;
        // <<foo/bar>> is how you write it with a for,
        // not <foo/<bar>> or whatever.
        for(var i = 0; i < ltAlts.length; i++) {
            const lt = ltAlts[i];
            const match = /<(.*)>/.exec(lt);
            if(match) { ltAlts[i] = match[1]; }
        }
    }

    let forAlts;
    if(dfn.hasAttribute('data-dfn-for')) {
        forAlts = dfn.getAttribute('data-dfn-for')
            .split(",")
            .map(x=>x.trim());
    } else {
        forAlts = [''];
    }

    let linkingSyntaxes = [];
    if(!needsFor(type)) {
        for(const lt of ltAlts) {
            linkingSyntaxes.push(linkFormatter(lt));
        }
    }
    if(!refusesFor(type)) {
        for(const f of forAlts) {
            linkingSyntaxes.push(linkFormatter(`${f}/${ltAlts[0]}`))
        }
    }
    return [
        mk.b({}, 'Possible linking syntaxes:'),
        mk.ul({},
            ...linkingSyntaxes.map(link => {
                const copyLink = async () =>
                    await navigator.clipboard.writeText(link);
                return mk.li({},
                    mk.div({ class: 'link-item' },
                        mk.button({
                            class: 'copy-icon', title: 'Copy',
                            type: 'button',
                            _onclick: copyLink,
                            tabindex: 0,
                        }, mk.span({ class: 'icon' }) ),
                        mk.span({}, link)
                    )
                );
            })
        )
    ];
}
}
</script>
<script>/* Boilerplate: script-position-annos */
"use strict";
{
function repositionAnnoPanels(){
    const panels = [...document.querySelectorAll("[data-anno-for]")];
    hydratePanels(panels);
    let vSoFar = 0;
    for(const panel of panels.sort(cmpTops)) {
        if(panel.top < vSoFar) {
            panel.top = vSoFar;
            panel.style.top = vSoFar + "px";
        }
        vSoFar = panel.top + panel.height + 15;
    }
}
function hydratePanels(panels) {
    const main = document.querySelector("main");
    let mainRect;
    if(main) mainRect = main.getBoundingClientRect();
    // First display them all, if they're not already visible.
    for(const panel of panels) {
        panel.classList.remove("unpositioned");
    }
    // Measure them all
    for(const panel of panels) {
        const dfn = document.getElementById(panel.getAttribute("data-anno-for"));
        if(!dfn) {
            console.log("Can't find the annotation panel target:", panel);
            continue;
        }
        panel.dfn = dfn;
        panel.top = window.scrollY + dfn.getBoundingClientRect().top;
        let panelRect = panel.getBoundingClientRect();
        panel.height = panelRect.height;
        if(main) {
            panel.overlappingMain = panelRect.left < mainRect.right;
        } else {
            panel.overlappingMain = false;
        }
    }
    // And finally position them
    for(const panel of panels) {
        const dfn = panel.dfn;
        if(!dfn) continue;
        panel.style.top = panel.top + "px";
        panel.classList.toggle("overlapping-main", panel.overlappingMain);
    }
}

function cmpTops(a,b) {
    return a.top - b.top;
}

window.addEventListener("load", repositionAnnoPanels);
window.addEventListener("resize", repositionAnnoPanels);
}
</script>
<script>/* Boilerplate: script-ref-hints */
"use strict";
{
let refsData = {
"#attribution": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"longtasks","spec":"longtasks-1","status":"local","text":"attribution","type":"dfn","url":"#attribution"},
"#cross-origin-ancestor": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"longtasks","spec":"longtasks-1","status":"local","text":"cross-origin-ancestor","type":"dfn","url":"#cross-origin-ancestor"},
"#cross-origin-descendant": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"longtasks","spec":"longtasks-1","status":"local","text":"cross-origin-descendant","type":"dfn","url":"#cross-origin-descendant"},
"#cross-origin-unreachable": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"longtasks","spec":"longtasks-1","status":"local","text":"cross-origin-unreachable","type":"dfn","url":"#cross-origin-unreachable"},
"#culprit-browsing-context-container": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"longtasks","spec":"longtasks-1","status":"local","text":"culprit browsing context container","type":"dfn","url":"#culprit-browsing-context-container"},
"#dom-performancelongtasktiming-attribution": {"export":true,"for_":["PerformanceLongTaskTiming"],"level":"1","normative":true,"shortname":"longtasks","spec":"longtasks-1","status":"local","text":"attribution","type":"attribute","url":"#dom-performancelongtasktiming-attribution"},
"#dom-taskattributiontiming-containerid": {"export":true,"for_":["TaskAttributionTiming"],"level":"1","normative":true,"shortname":"longtasks","spec":"longtasks-1","status":"local","text":"containerId","type":"attribute","url":"#dom-taskattributiontiming-containerid"},
"#dom-taskattributiontiming-containername": {"export":true,"for_":["TaskAttributionTiming"],"level":"1","normative":true,"shortname":"longtasks","spec":"longtasks-1","status":"local","text":"containerName","type":"attribute","url":"#dom-taskattributiontiming-containername"},
"#dom-taskattributiontiming-containersrc": {"export":true,"for_":["TaskAttributionTiming"],"level":"1","normative":true,"shortname":"longtasks","spec":"longtasks-1","status":"local","text":"containerSrc","type":"attribute","url":"#dom-taskattributiontiming-containersrc"},
"#dom-taskattributiontiming-containertype": {"export":true,"for_":["TaskAttributionTiming"],"level":"1","normative":true,"shortname":"longtasks","spec":"longtasks-1","status":"local","text":"containerType","type":"attribute","url":"#dom-taskattributiontiming-containertype"},
"#long-task": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"longtasks","spec":"longtasks-1","status":"local","text":"long task","type":"dfn","url":"#long-task"},
"#minimal-culprit-attribution": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"longtasks","spec":"longtasks-1","status":"local","text":"minimal culprit attribution","type":"dfn","url":"#minimal-culprit-attribution"},
"#multiple-contexts": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"longtasks","spec":"longtasks-1","status":"local","text":"multiple-contexts","type":"dfn","url":"#multiple-contexts"},
"#performancelongtasktiming": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"longtasks","spec":"longtasks-1","status":"local","text":"PerformanceLongTaskTiming","type":"interface","url":"#performancelongtasktiming"},
"#same-origin": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"longtasks","spec":"longtasks-1","status":"local","text":"same-origin","type":"dfn","url":"#same-origin"},
"#same-origin-ancestor": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"longtasks","spec":"longtasks-1","status":"local","text":"same-origin-ancestor","type":"dfn","url":"#same-origin-ancestor"},
"#same-origin-descendant": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"longtasks","spec":"longtasks-1","status":"local","text":"same-origin-descendant","type":"dfn","url":"#same-origin-descendant"},
"#self": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"longtasks","spec":"longtasks-1","status":"local","text":"self","type":"dfn","url":"#self"},
"#taskattributiontiming": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"longtasks","spec":"longtasks-1","status":"local","text":"TaskAttributionTiming","type":"interface","url":"#taskattributiontiming"},
"#unknown": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"longtasks","spec":"longtasks-1","status":"local","text":"unknown","type":"dfn","url":"#unknown"},
"https://dom.spec.whatwg.org/#concept-id": {"export":true,"for_":["Element"],"level":"1","normative":true,"shortname":"dom","spec":"dom","status":"current","text":"id","type":"dfn","url":"https://dom.spec.whatwg.org/#concept-id"},
"https://dom.spec.whatwg.org/#document": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"dom","spec":"dom","status":"current","text":"Document","type":"interface","url":"https://dom.spec.whatwg.org/#document"},
"https://html.spec.whatwg.org/multipage/#ancestor-browsing-context": {"export":true,"for_":[],"level":"","normative":true,"shortname":"html","spec":"html","status":"anchor-block","text":"ancestor","type":"dfn","url":"https://html.spec.whatwg.org/multipage/#ancestor-browsing-context"},
"https://html.spec.whatwg.org/multipage/#browsing-context": {"export":true,"for_":[],"level":"","normative":true,"shortname":"html","spec":"html","status":"anchor-block","text":"browsing context","type":"dfn","url":"https://html.spec.whatwg.org/multipage/#browsing-context"},
"https://html.spec.whatwg.org/multipage/#event-loop": {"export":true,"for_":[],"level":"","normative":true,"shortname":"html","spec":"html","status":"anchor-block","text":"event loop","type":"dfn","url":"https://html.spec.whatwg.org/multipage/#event-loop"},
"https://html.spec.whatwg.org/multipage/#integration-with-the-javascript-agent-cluster-formalism": {"export":true,"for_":[],"level":"","normative":true,"shortname":"html","spec":"html","status":"anchor-block","text":"agent cluster","type":"dfn","url":"https://html.spec.whatwg.org/multipage/#integration-with-the-javascript-agent-cluster-formalism"},
"https://html.spec.whatwg.org/multipage/#list-of-the-descendant-browsing-contexts": {"export":true,"for_":[],"level":"","normative":true,"shortname":"html","spec":"html","status":"anchor-block","text":"list of the descendant browsing contexts","type":"dfn","url":"https://html.spec.whatwg.org/multipage/#list-of-the-descendant-browsing-contexts"},
"https://html.spec.whatwg.org/multipage/#script-evaluation-environment-settings-object-set": {"export":true,"for_":[],"level":"","normative":true,"shortname":"html","spec":"html","status":"anchor-block","text":"script evaluation environment settings object set","type":"dfn","url":"https://html.spec.whatwg.org/multipage/#script-evaluation-environment-settings-object-set"},
"https://html.spec.whatwg.org/multipage/#unit-of-related-browsing-contexts": {"export":true,"for_":[],"level":"","normative":true,"shortname":"html","spec":"html","status":"anchor-block","text":"unit of related browsing contexts","type":"dfn","url":"https://html.spec.whatwg.org/multipage/#unit-of-related-browsing-contexts"},
"https://html.spec.whatwg.org/multipage/browsers.html#same-origin": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"same origin","type":"dfn","url":"https://html.spec.whatwg.org/multipage/browsers.html#same-origin"},
"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-document": {"export":true,"for_":["navigable"],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"active document","type":"dfn","url":"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-document"},
"https://html.spec.whatwg.org/multipage/document-sequences.html#top-level-browsing-context": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"top-level browsing context","type":"dfn","url":"https://html.spec.whatwg.org/multipage/document-sequences.html#top-level-browsing-context"},
"https://html.spec.whatwg.org/multipage/iframe-embed-object.html#attr-embed-src": {"export":true,"for_":["embed"],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"src","type":"element-attr","url":"https://html.spec.whatwg.org/multipage/iframe-embed-object.html#attr-embed-src"},
"https://html.spec.whatwg.org/multipage/iframe-embed-object.html#attr-iframe-name": {"export":true,"for_":["iframe"],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"name","type":"element-attr","url":"https://html.spec.whatwg.org/multipage/iframe-embed-object.html#attr-iframe-name"},
"https://html.spec.whatwg.org/multipage/iframe-embed-object.html#attr-iframe-src": {"export":true,"for_":["iframe"],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"src","type":"element-attr","url":"https://html.spec.whatwg.org/multipage/iframe-embed-object.html#attr-iframe-src"},
"https://html.spec.whatwg.org/multipage/iframe-embed-object.html#attr-object-data": {"export":true,"for_":["object"],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"data","type":"element-attr","url":"https://html.spec.whatwg.org/multipage/iframe-embed-object.html#attr-object-data"},
"https://html.spec.whatwg.org/multipage/iframe-embed-object.html#the-embed-element": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"embed","type":"element","url":"https://html.spec.whatwg.org/multipage/iframe-embed-object.html#the-embed-element"},
"https://html.spec.whatwg.org/multipage/iframe-embed-object.html#the-iframe-element": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"iframe","type":"element","url":"https://html.spec.whatwg.org/multipage/iframe-embed-object.html#the-iframe-element"},
"https://html.spec.whatwg.org/multipage/iframe-embed-object.html#the-object-element": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"object","type":"element","url":"https://html.spec.whatwg.org/multipage/iframe-embed-object.html#the-object-element"},
"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"Window","type":"interface","url":"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window"},
"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window-bc": {"export":true,"for_":["Window"],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"browsing context","type":"dfn","url":"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window-bc"},
"https://html.spec.whatwg.org/multipage/obsolete.html#frame": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"frame","type":"element","url":"https://html.spec.whatwg.org/multipage/obsolete.html#frame"},
"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"relevant realm","type":"dfn","url":"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm"},
"https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-global": {"export":true,"for_":["environment settings object"],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"global object","type":"dfn","url":"https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-global"},
"https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin": {"export":true,"for_":["environment settings object"],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"origin","type":"dfn","url":"https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin"},
"https://html.spec.whatwg.org/multipage/webappapis.html#concept-task": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"task","type":"dfn","url":"https://html.spec.whatwg.org/multipage/webappapis.html#concept-task"},
"https://html.spec.whatwg.org/multipage/webappapis.html#microtask": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"microtask","type":"dfn","url":"https://html.spec.whatwg.org/multipage/webappapis.html#microtask"},
"https://html.spec.whatwg.org/multipage/webappapis.html#perform-a-microtask-checkpoint": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"perform a microtask checkpoint","type":"dfn","url":"https://html.spec.whatwg.org/multipage/webappapis.html#perform-a-microtask-checkpoint"},
"https://html.spec.whatwg.org/multipage/webappapis.html#update-the-rendering": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"update the rendering","type":"dfn","url":"https://html.spec.whatwg.org/multipage/webappapis.html#update-the-rendering"},
"https://tc39.github.io/ecma262/#sec-code-realms": {"export":true,"for_":[],"level":"","normative":true,"shortname":"ecmascript","spec":"ecmascript","status":"anchor-block","text":"javascript realms","type":"dfn","url":"https://tc39.github.io/ecma262/#sec-code-realms"},
"https://w3c.github.io/hr-time/#idl-def-domhighrestimestamp": {"export":true,"for_":[],"level":"2","normative":true,"shortname":"hr-time","spec":"hr-time-2","status":"anchor-block","text":"DOMHighResTimeStamp","type":"typedef","url":"https://w3c.github.io/hr-time/#idl-def-domhighrestimestamp"},
"https://w3c.github.io/performance-timeline/#dfn-queue-a-performanceentry": {"export":true,"for_":[],"level":"2","normative":true,"shortname":"performance-timeline","spec":"performance-timeline-2","status":"anchor-block","text":"queue the performanceentry","type":"dfn","url":"https://w3c.github.io/performance-timeline/#dfn-queue-a-performanceentry"},
"https://w3c.github.io/performance-timeline/#dom-performanceentry-duration": {"export":true,"for_":["PerformanceEntry"],"level":"2","normative":true,"shortname":"performance-timeline","spec":"performance-timeline-2","status":"anchor-block","text":"duration","type":"attribute","url":"https://w3c.github.io/performance-timeline/#dom-performanceentry-duration"},
"https://w3c.github.io/performance-timeline/#dom-performanceentry-entrytype": {"export":true,"for_":["PerformanceEntry"],"level":"2","normative":true,"shortname":"performance-timeline","spec":"performance-timeline-2","status":"anchor-block","text":"entryType","type":"attribute","url":"https://w3c.github.io/performance-timeline/#dom-performanceentry-entrytype"},
"https://w3c.github.io/performance-timeline/#dom-performanceentry-name": {"export":true,"for_":["PerformanceEntry"],"level":"2","normative":true,"shortname":"performance-timeline","spec":"performance-timeline-2","status":"anchor-block","text":"name","type":"attribute","url":"https://w3c.github.io/performance-timeline/#dom-performanceentry-name"},
"https://w3c.github.io/performance-timeline/#dom-performanceentry-starttime": {"export":true,"for_":["PerformanceEntry"],"level":"2","normative":true,"shortname":"performance-timeline","spec":"performance-timeline-2","status":"anchor-block","text":"startTime","type":"attribute","url":"https://w3c.github.io/performance-timeline/#dom-performanceentry-starttime"},
"https://w3c.github.io/performance-timeline/#supportedentrytypes-attribute": {"export":true,"for_":["PerformanceObserver"],"level":"2","normative":true,"shortname":"performance-timeline","spec":"performance-timeline-2","status":"anchor-block","text":"supportedEntryTypes","type":"attribute","url":"https://w3c.github.io/performance-timeline/#supportedentrytypes-attribute"},
"https://w3c.github.io/performance-timeline/#the-performanceentry-interface": {"export":true,"for_":[],"level":"2","normative":true,"shortname":"performance-timeline","spec":"performance-timeline-2","status":"anchor-block","text":"PerformanceEntry","type":"interface","url":"https://w3c.github.io/performance-timeline/#the-performanceentry-interface"},
"https://webidl.spec.whatwg.org/#Default": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"Default","type":"extended-attribute","url":"https://webidl.spec.whatwg.org/#Default"},
"https://webidl.spec.whatwg.org/#Exposed": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"Exposed","type":"extended-attribute","url":"https://webidl.spec.whatwg.org/#Exposed"},
"https://webidl.spec.whatwg.org/#idl-DOMString": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"DOMString","type":"interface","url":"https://webidl.spec.whatwg.org/#idl-DOMString"},
"https://webidl.spec.whatwg.org/#idl-frozen-array": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"FrozenArray","type":"interface","url":"https://webidl.spec.whatwg.org/#idl-frozen-array"},
"https://webidl.spec.whatwg.org/#idl-object": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"object","type":"interface","url":"https://webidl.spec.whatwg.org/#idl-object"},
};

function mkRefHint(link, ref) {
    const linkText = link.textContent;
    let dfnTextElements = '';
    if (ref.text != linkText) {
        dfnTextElements =
            mk.li({},
                mk.b({}, "Term: "),
                mk.span({}, ref.text)
            );
    }
    const forList = ref.for_;
    let forListElements;
    if(forList.length == 0) {
        forListElements = [];
    } else if(forList.length == 1) {
        forListElements = mk.li({},
            mk.b({}, "For: "),
            mk.span({}, forList[0]),
        );
    } else {
        forListElements = mk.li({},
            mk.b({}, "For: "),
            mk.ul({},
                ...forList.map(forItem =>
                    mk.li({},
                        mk.span({}, forItem)
                    ),
                ),
            ),
        );
    }
    const url = ref.url;
    const safeUrl = encodeURIComponent(url);
    const hintPanel = mk.aside({
        class: "ref-hint",
        id: `ref-hint-for-${safeUrl}`,
        "data-for": url,
        "aria-labelled-by": `ref-hint-for-${safeUrl}`,
    },
        mk.ul({},
            dfnTextElements,
            mk.li({},
                mk.b({}, "URL: "),
                mk.a({ href: url, class: "ref" }, url),
            ),
            mk.li({},
                mk.b({}, "Type: "),
                mk.span({}, `${ref.type}`),
            ),
            mk.li({},
                mk.b({}, "Spec: "),
                mk.span({}, `${ref.spec ? ref.spec : ''}`),
            ),
            forListElements
        ),
    );
    hintPanel.forLink = link;
    setupRefHintEventListeners(link, hintPanel);
    return hintPanel;
}

function hideAllRefHints() {
    queryAll(".ref-hint").forEach(el=>hideRefHint(el));
}

function hideRefHint(refHint) {
    const link = refHint.forLink;
    link.setAttribute("aria-expanded", "false");
    if(refHint.teardownEventListeners) {
        refHint.teardownEventListeners();
    }
    refHint.remove();
}

function showRefHint(link) {
    if(link.classList.contains("dfn-link")) return;
    const url = link.getAttribute("href");
    const ref = refsData[url];
    if(!ref) return;

    hideAllRefHints(); // Only display one at this time.

    const refHint = mkRefHint(link, ref);
    append(document.body, refHint);
    link.setAttribute("aria-expanded", "true");
    positionRefHint(refHint);
}

function setupRefHintEventListeners(link, refHint) {
    if (refHint.teardownEventListeners) return;
    // Add event handlers to hide the refHint after the user moves away
    // from both the link and refHint, if not hovering either within one second.
    let timeout = null;
    const startHidingRefHint = (event) => {
        if (timeout) {
            clearTimeout(timeout);
        }
        timeout = setTimeout(() => {
            hideRefHint(refHint);
        }, 1000);
    }
    const resetHidingRefHint = (event) => {
        if (timeout) clearTimeout(timeout);
        timeout = null;
    };
    link.addEventListener("mouseleave", startHidingRefHint);
    link.addEventListener("mouseenter", resetHidingRefHint);
    link.addEventListener("blur", startHidingRefHint);
    link.addEventListener("focus", resetHidingRefHint);
    refHint.addEventListener("mouseleave", startHidingRefHint);
    refHint.addEventListener("mouseenter", resetHidingRefHint);
    refHint.addEventListener("blur", startHidingRefHint);
    refHint.addEventListener("focus", resetHidingRefHint);

    refHint.teardownEventListeners = () => {
        // remove event listeners
        resetHidingRefHint();
        link.removeEventListener("mouseleave", startHidingRefHint);
        link.removeEventListener("mouseenter", resetHidingRefHint);
        link.removeEventListener("blur", startHidingRefHint);
        link.removeEventListener("focus", resetHidingRefHint);
        refHint.removeEventListener("mouseleave", startHidingRefHint);
        refHint.removeEventListener("mouseenter", resetHidingRefHint);
        refHint.removeEventListener("blur", startHidingRefHint);
        refHint.removeEventListener("focus", resetHidingRefHint);
    };
}

function positionRefHint(refHint) {
    const link = refHint.forLink;
    const linkPos = getBounds(link);
    refHint.style.top = linkPos.bottom + "px";
    refHint.style.left = linkPos.left + "px";

    const panelPos = refHint.getBoundingClientRect();
    const panelMargin = 8;
    const maxRight = document.body.parentNode.clientWidth - panelMargin;
    if (panelPos.right > maxRight) {
        const overflowAmount = panelPos.right - maxRight;
        const newLeft = Math.max(panelMargin, linkPos.left - overflowAmount);
        refHint.style.left = newLeft + "px";
    }
}

// TODO: shared util
// Returns the root-level absolute position {left and top} of element.
function getBounds(el, relativeTo=document.body) {
    const relativeRect = relativeTo.getBoundingClientRect();
    const elRect = el.getBoundingClientRect();
    const top = elRect.top - relativeRect.top;
    const left = elRect.left - relativeRect.left;
    return {
        top,
        left,
        bottom: top + elRect.height,
        right: left + elRect.width,
    }
}

function showRefHintListener(e) {
    // If the target isn't in a link (or is a link),
    // just ignore it.
    let link = e.target.closest("a");
    if(!link) return;

    // If the target is in a ref-hint panel
    // (aka a link in the already-open one),
    // also just ignore it.
    if(link.closest(".ref-hint")) return;

    // Otherwise, show the panel for the link.
    showRefHint(link);
}

function hideAllHintsListener(e) {
    // If the click is inside a ref-hint panel, ignore it.
    if(e.target.closest(".ref-hint")) return;
    // Otherwise, close all the current panels.
    hideAllRefHints();
}

document.addEventListener("DOMContentLoaded", () => {
    document.body.addEventListener("mousedown", showRefHintListener);
    document.body.addEventListener("focus", showRefHintListener);

    document.body.addEventListener("click", hideAllHintsListener);
});

window.addEventListener("resize", () => {
    // Hide any open ref hint.
    hideAllRefHints();
});
}
</script>
<script>/* Boilerplate: script-var-click-highlighting */
"use strict";
{
/*
Color-choosing design:

* Colors are ordered by goodness.
* On clicking a var, give it the earliest color
    with the lowest usage in the algorithm.
* On re-clicking, re-use the var's most recent color
    if that's not currently being used elsewhere.
*/

const COLOR_COUNT = 7;

document.addEventListener("click", e=>{
    if(e.target.nodeName == "VAR") {
        highlightSameAlgoVars(e.target);
    }
});

function highlightSameAlgoVars(v) {
    // Find the algorithm container.
    let algoContainer = findAlgoContainer(v);

    // Not highlighting document-global vars,
    // too likely to be unrelated.
    if(algoContainer == null) return;

    const varName = nameFromVar(v);
    if(!v.hasAttribute("data-var-color")) {
        const newColor = chooseHighlightColor(algoContainer, v);
        for(const el of algoContainer.querySelectorAll("var")) {
            if(nameFromVar(el) == varName) {
                el.setAttribute("data-var-color", newColor);
                el.setAttribute("data-var-last-color", newColor);
            }
        }
    } else {
        for(const el of algoContainer.querySelectorAll("var")) {
            if(nameFromVar(el) == varName) {
                el.removeAttribute("data-var-color");
            }
        }
    }
}
function findAlgoContainer(el) {
    while(el != document.body) {
        if(el.hasAttribute("data-algorithm")) return el;
        el = el.parentNode;
    }
    return null;
}
function nameFromVar(el) {
    return el.textContent.replace(/(\s|\xa0)+/g, " ").trim();
}
function colorCountsFromContainer(container) {
    const namesFromColor = Array.from({length:COLOR_COUNT}, x=>new Set());
    for(let v of container.querySelectorAll("var[data-var-color]")) {
        let color = +v.getAttribute("data-var-color");
        namesFromColor[color].add(nameFromVar(v));
    }

    return namesFromColor.map(x=>x.size);
}
function leastUsedColor(colors) {
    // Find the earliest color with the lowest count.
    let minCount = Infinity;
    let minColor = null;
    for(var i = 0; i < colors.length; i++) {
        if(colors[i] < minCount) {
            minColor = i;
            minCount = colors[i];
        }
    }
    return minColor;
}
function chooseHighlightColor(container, v) {
    const colorCounts = colorCountsFromContainer(container);
    if(v.hasAttribute("data-var-last-color")) {
        let color = +v.getAttribute("data-var-last-color");
        if(colorCounts[color] == 0) return color;
    }
    return leastUsedColor(colorCounts);
}
}
</script>