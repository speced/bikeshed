<!doctype html><html lang="en">
 <head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
  <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
  <title>Additions to CSS Color 4</title>
  <meta content="ED" name="w3c-status">
  <link href="https://www.w3.org/StyleSheets/TR/2021/W3C-ED" rel="stylesheet">
  <link href="none" rel="canonical">
  <meta content="dark light" name="color-scheme">
  <link href="https://www.w3.org/StyleSheets/TR/2021/dark.css" media="(prefers-color-scheme: dark)" rel="stylesheet" type="text/css">
<style>/* Boilerplate: style-autolinks */
.css.css, .property.property, .descriptor.descriptor {
    color: var(--a-normal-text);
    font-size: inherit;
    font-family: inherit;
}
.css::before, .property::before, .descriptor::before {
    content: "‘";
}
.css::after, .property::after, .descriptor::after {
    content: "’";
}
.property, .descriptor {
    /* Don't wrap property and descriptor names */
    white-space: nowrap;
}
.type { /* CSS value <type> */
    font-style: italic;
}
pre .property::before, pre .property::after {
    content: "";
}
[data-link-type="property"]::before,
[data-link-type="propdesc"]::before,
[data-link-type="descriptor"]::before,
[data-link-type="value"]::before,
[data-link-type="function"]::before,
[data-link-type="at-rule"]::before,
[data-link-type="selector"]::before,
[data-link-type="maybe"]::before {
    content: "‘";
}
[data-link-type="property"]::after,
[data-link-type="propdesc"]::after,
[data-link-type="descriptor"]::after,
[data-link-type="value"]::after,
[data-link-type="function"]::after,
[data-link-type="at-rule"]::after,
[data-link-type="selector"]::after,
[data-link-type="maybe"]::after {
    content: "’";
}

[data-link-type].production::before,
[data-link-type].production::after,
.prod [data-link-type]::before,
.prod [data-link-type]::after {
    content: "";
}

[data-link-type=element],
[data-link-type=element-attr] {
    font-family: Menlo, Consolas, "DejaVu Sans Mono", monospace;
    font-size: .9em;
}
[data-link-type=element]::before { content: "<" }
[data-link-type=element]::after  { content: ">" }

[data-link-type=biblio] {
    white-space: pre;
}

@media (prefers-color-scheme: dark) {
    :root {
        --selflink-text: black;
        --selflink-bg: silver;
        --selflink-hover-text: white;
    }
}
</style>
<style>/* Boilerplate: style-colors */
/* Any --*-text not paired with a --*-bg is assumed to have a transparent bg */
:root {
    color-scheme: light dark;

    --text: black;
    --bg: white;

    --unofficial-watermark: url(https://www.w3.org/StyleSheets/TR/2016/logos/UD-watermark);

    --logo-bg: #1a5e9a;
    --logo-active-bg: #c00;
    --logo-text: white;

    --tocnav-normal-text: #707070;
    --tocnav-normal-bg: var(--bg);
    --tocnav-hover-text: var(--tocnav-normal-text);
    --tocnav-hover-bg: #f8f8f8;
    --tocnav-active-text: #c00;
    --tocnav-active-bg: var(--tocnav-normal-bg);

    --tocsidebar-text: var(--text);
    --tocsidebar-bg: #f7f8f9;
    --tocsidebar-shadow: rgba(0,0,0,.1);
    --tocsidebar-heading-text: hsla(203,20%,40%,.7);

    --toclink-text: var(--text);
    --toclink-underline: #3980b5;
    --toclink-visited-text: var(--toclink-text);
    --toclink-visited-underline: #054572;

    --heading-text: #005a9c;

    --hr-text: var(--text);

    --algo-border: #def;

    --del-text: red;
    --del-bg: transparent;
    --ins-text: #080;
    --ins-bg: transparent;

    --a-normal-text: #034575;
    --a-normal-underline: #bbb;
    --a-visited-text: var(--a-normal-text);
    --a-visited-underline: #707070;
    --a-hover-bg: rgba(75%, 75%, 75%, .25);
    --a-active-text: #c00;
    --a-active-underline: #c00;

    --blockquote-border: silver;
    --blockquote-bg: transparent;
    --blockquote-text: currentcolor;

    --issue-border: #e05252;
    --issue-bg: #fbe9e9;
    --issue-text: var(--text);
    --issueheading-text: #831616;

    --example-border: #e0cb52;
    --example-bg: #fcfaee;
    --example-text: var(--text);
    --exampleheading-text: #574b0f;

    --note-border: #52e052;
    --note-bg: #e9fbe9;
    --note-text: var(--text);
    --noteheading-text: hsl(120, 70%, 30%);
    --notesummary-underline: silver;

    --assertion-border: #aaa;
    --assertion-bg: #eee;
    --assertion-text: black;

    --advisement-border: orange;
    --advisement-bg: #fec;
    --advisement-text: var(--text);
    --advisementheading-text: #b35f00;

    --warning-border: red;
    --warning-bg: hsla(40,100%,50%,0.95);
    --warning-text: var(--text);

    --amendment-border: #330099;
    --amendment-bg: #F5F0FF;
    --amendment-text: var(--text);
    --amendmentheading-text: #220066;

    --def-border: #8ccbf2;
    --def-bg: #def;
    --def-text: var(--text);
    --defrow-border: #bbd7e9;

    --datacell-border: silver;

    --indexinfo-text: #707070;

    --indextable-hover-text: black;
    --indextable-hover-bg: #f7f8f9;

    --outdatedspec-bg: rgba(0, 0, 0, .5);
    --outdatedspec-text: black;
    --outdated-bg: maroon;
    --outdated-text: white;
    --outdated-shadow: red;

    --editedrec-bg: darkorange;
}

@media (prefers-color-scheme: dark) {
    :root {
        --text: #ddd;
        --bg: black;

        --unofficial-watermark: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='400'%3E%3Cg fill='%23100808' transform='translate(200 200) rotate(-45) translate(-200 -200)' stroke='%23100808' stroke-width='3'%3E%3Ctext x='50%25' y='220' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EUNOFFICIAL%3C/text%3E%3Ctext x='50%25' y='305' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EDRAFT%3C/text%3E%3C/g%3E%3C/svg%3E");

        --logo-bg: #1a5e9a;
        --logo-active-bg: #c00;
        --logo-text: white;

        --tocnav-normal-text: #999;
        --tocnav-normal-bg: var(--bg);
        --tocnav-hover-text: var(--tocnav-normal-text);
        --tocnav-hover-bg: #080808;
        --tocnav-active-text: #f44;
        --tocnav-active-bg: var(--tocnav-normal-bg);

        --tocsidebar-text: var(--text);
        --tocsidebar-bg: #080808;
        --tocsidebar-shadow: rgba(255,255,255,.1);
        --tocsidebar-heading-text: hsla(203,20%,40%,.7);

        --toclink-text: var(--text);
        --toclink-underline: #6af;
        --toclink-visited-text: var(--toclink-text);
        --toclink-visited-underline: #054572;

        --heading-text: #8af;

        --hr-text: var(--text);

        --algo-border: #456;

        --del-text: #f44;
        --del-bg: transparent;
        --ins-text: #4a4;
        --ins-bg: transparent;

        --a-normal-text: #6af;
        --a-normal-underline: #555;
        --a-visited-text: var(--a-normal-text);
        --a-visited-underline: var(--a-normal-underline);
        --a-hover-bg: rgba(25%, 25%, 25%, .2);
        --a-active-text: #f44;
        --a-active-underline: var(--a-active-text);

        --borderedblock-bg: rgba(255, 255, 255, .05);

        --blockquote-border: silver;
        --blockquote-bg: var(--borderedblock-bg);
        --blockquote-text: currentcolor;

        --issue-border: #e05252;
        --issue-bg: var(--borderedblock-bg);
        --issue-text: var(--text);
        --issueheading-text: hsl(0deg, 70%, 70%);

        --example-border: hsl(50deg, 90%, 60%);
        --example-bg: var(--borderedblock-bg);
        --example-text: var(--text);
        --exampleheading-text: hsl(50deg, 70%, 70%);

        --note-border: hsl(120deg, 100%, 35%);
        --note-bg: var(--borderedblock-bg);
        --note-text: var(--text);
        --noteheading-text: hsl(120, 70%, 70%);
        --notesummary-underline: silver;

        --assertion-border: #444;
        --assertion-bg: var(--borderedblock-bg);
        --assertion-text: var(--text);

        --advisement-border: orange;
        --advisement-bg: #222218;
        --advisement-text: var(--text);
        --advisementheading-text: #f84;

        --warning-border: red;
        --warning-bg: hsla(40,100%,20%,0.95);
        --warning-text: var(--text);

        --amendment-border: #330099;
        --amendment-bg: #080010;
        --amendment-text: var(--text);
        --amendmentheading-text: #cc00ff;

        --def-border: #8ccbf2;
        --def-bg: #080818;
        --def-text: var(--text);
        --defrow-border: #136;

        --datacell-border: silver;

        --indexinfo-text: #aaa;

        --indextable-hover-text: var(--text);
        --indextable-hover-bg: #181818;

        --outdatedspec-bg: rgba(255, 255, 255, .5);
        --outdatedspec-text: black;
        --outdated-bg: maroon;
        --outdated-text: white;
        --outdated-shadow: red;

        --editedrec-bg: darkorange;
    }
    /* In case a transparent-bg image doesn't expect to be on a dark bg,
       which is quite common in practice... */
    img { background: white; }
}
</style>
<style>/* Boilerplate: style-counters */
body {
    counter-reset: example figure issue;
}
.issue {
    counter-increment: issue;
}
.issue:not(.no-marker)::before {
    content: "Issue " counter(issue);
}

.example {
    counter-increment: example;
}
.example:not(.no-marker)::before {
    content: "Example " counter(example);
}
.invalid.example:not(.no-marker)::before,
.illegal.example:not(.no-marker)::before {
    content: "Invalid Example" counter(example);
}

figcaption {
    counter-increment: figure;
}
figcaption:not(.no-marker)::before {
    content: "Figure " counter(figure) " ";
}
</style>
<style>/* Boilerplate: style-dfn-panel */
:root {
    --dfnpanel-bg: #ddd;
    --dfnpanel-text: var(--text);
    --dfnpanel-target-bg: #ffc;
    --dfnpanel-target-outline: orange;
}
@media (prefers-color-scheme: dark) {
    :root {
        --dfnpanel-bg: #222;
        --dfnpanel-text: var(--text);
        --dfnpanel-target-bg: #333;
        --dfnpanel-target-outline: silver;
    }
}
.dfn-panel {
    position: absolute;
    z-index: 35;
    width: 20em;
    width: 300px;
    height: auto;
    max-height: 500px;
    overflow: auto;
    padding: 0.5em 0.75em;
    font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
    background: var(--dfnpanel-bg);
    color: var(--dfnpanel-text);
    border: outset 0.2em;
    white-space: normal; /* in case it's moved into a pre */
}
.dfn-panel:not(.on) { display: none; }
.dfn-panel * { margin: 0; padding: 0; text-indent: 0; }
.dfn-panel > b { display: block; }
.dfn-panel a { color: var(--dfnpanel-text); }
.dfn-panel a:not(:hover) { text-decoration: none !important; border-bottom: none !important; }
.dfn-panel a:focus {
    outline: 5px auto Highlight;
    outline: 5px auto -webkit-focus-ring-color;
}
.dfn-panel > b + b { margin-top: 0.25em; }
.dfn-panel ul { padding: 0 0 0 1em; list-style: none; }
.dfn-panel li a {
    max-width: calc(300px - 1.5em - 1em);
    overflow: hidden;
    text-overflow: ellipsis;
}

.dfn-panel.activated {
    display: inline-block;
    position: fixed;
    left: 8px;
    bottom: 2em;
    margin: 0 auto;
    max-width: calc(100vw - 1.5em - .4em - .5em);
    max-height: 30vh;
    transition: left 1s ease-out, bottom 1s ease-out;
}

.dfn-panel .link-item:hover {
    text-decoration: underline;
}
.dfn-panel .link-item .copy-icon {
    opacity: 0;
}
.dfn-panel .link-item:hover .copy-icon,
.dfn-panel .link-item .copy-icon:focus {
    opacity: 1;
}

.dfn-panel .copy-icon {
    display: inline-block;
    margin-right: 0.5em;
    width: 0.85em;
    height: 1em;
    border-radius: 3px;
    background-color: #ccc;
    cursor: pointer;
}

.dfn-panel .copy-icon .icon {
    width: 100%;
    height: 100%;
    background-color: #fff;
    display: flex;
    justify-content: center;
    align-items: center;
    position: relative;
}

.dfn-panel .copy-icon .icon::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    border: 1px solid black;
    background-color: #ccc;
    opacity: 0.25;
    transform: translate(3px, -3px);
}

.dfn-panel .copy-icon:active .icon::before {
    opacity: 1;
}

.dfn-paneled[role="button"] { cursor: help; }

.highlighted {
    animation: target-fade 3s;
}

@keyframes target-fade {
    from {
        background-color: var(--dfnpanel-target-bg);
        outline: 5px solid var(--dfnpanel-target-outline);
    }
    to {
        color: var(--a-normal-text);
        background-color: transparent;
        outline: transparent;
    }
}
</style>
<style>/* Boilerplate: style-issues */
a[href].issue-return {
    float: right;
    float: inline-end;
    color: var(--issueheading-text);
    font-weight: bold;
    text-decoration: none;
}
</style>
<style>/* Boilerplate: style-md-lists */
/* This is a weird hack for me not yet following the commonmark spec
   regarding paragraph and lists. */
[data-md] > :first-child {
    margin-top: 0;
}
[data-md] > :last-child {
    margin-bottom: 0;
}
</style>
<style>/* Boilerplate: style-ref-hints */
:root {
    --ref-hint-bg: #ddd;
    --ref-hint-text: var(--text);
}
@media (prefers-color-scheme: dark) {
    :root {
        --ref-hint-bg: #222;
        --ref-hint-text: var(--text);
    }
}

.ref-hint {
    display: inline-block;
    position: absolute;
    z-index: 35;
    width: 20em;
    width: 300px;
    height: auto;
    max-height: 500px;
    overflow: auto;
    padding: 0.5em 0.5em;
    font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
    background: var(--ref-hint-bg);
    color: var(--ref-hint-text);
    border: outset 0.2em;
    white-space: normal; /* in case it's moved into a pre */
}

.ref-hint * { margin: 0; padding: 0; text-indent: 0; }

.ref-hint ul { padding: 0 0 0 1em; list-style: none; }
</style>
<style>/* Boilerplate: style-selflinks */
:root {
    --selflink-text: white;
    --selflink-bg: gray;
    --selflink-hover-text: black;
}
.heading, .issue, .note, .example, li, dt {
    position: relative;
}
a.self-link {
    position: absolute;
    top: 0;
    left: calc(-1 * (3.5rem - 26px));
    width: calc(3.5rem - 26px);
    height: 2em;
    text-align: center;
    border: none;
    transition: opacity .2s;
    opacity: .5;
}
a.self-link:hover {
    opacity: 1;
}
.heading > a.self-link {
    font-size: 83%;
}
.example > a.self-link,
.note > a.self-link,
.issue > a.self-link {
    /* These blocks are overflow:auto, so positioning outside
       doesn't work. */
    left: auto;
    right: 0;
}
li > a.self-link {
    left: calc(-1 * (3.5rem - 26px) - 2em);
}
dfn > a.self-link {
    top: auto;
    left: auto;
    opacity: 0;
    width: 1.5em;
    height: 1.5em;
    background: var(--selflink-bg);
    color: var(--selflink-text);
    font-style: normal;
    transition: opacity .2s, background-color .2s, color .2s;
}
dfn:hover > a.self-link {
    opacity: 1;
}
dfn > a.self-link:hover {
    color: var(--selflink-hover-text);
}

a.self-link::before            { content: "¶"; }
.heading > a.self-link::before { content: "§"; }
dfn > a.self-link::before      { content: "#"; }
</style>
 <body class="h-entry">
  <div class="head">
   <p data-fill-with="logo"><a class="logo" href="https://www.w3.org/"> <img alt="W3C" height="48" src="https://www.w3.org/StyleSheets/TR/2021/logos/W3C" width="72"> </a> </p>
   <h1>Additions to CSS Color 4</h1>
   <p id="w3c-state"><a href="https://www.w3.org/standards/types#ED">Editor’s Draft</a>, <time class="dt-updated" datetime="1970-01-01">1 January 1970</time></p>
   <details open>
    <summary>More details about this document</summary>
    <div data-fill-with="spec-metadata">
     <dl>
      <dt>This version:
      <dd><a class="u-url" href="none">none</a>
      <dt>Feedback:
      <dd><span><a href="mailto:www-svg@w3.org?subject=%5Bsvg-color%5D%20YOUR%20TOPIC%20HERE">www-svg@w3.org</a> with subject line “<kbd>[svg-color] <i data-lt>… message topic …</i></kbd>” (<a href="http://lists.w3.org/Archives/Public/www-svg/" rel="discussion">archives</a>)</span>
      <dt class="editor">Editor:
      <dd class="editor p-author h-card vcard"><a class="p-name fn u-email email" href="mailto:chris@w3.org">Chris Lilley</a> (<span class="p-org org">W3C</span>)
     </dl>
    </div>
   </details>
   <div data-fill-with="warning"></div>
   <p class="copyright" data-fill-with="copyright"><a href="https://www.w3.org/policies/#copyright">Copyright</a> © 1970 <a href="https://www.w3.org/">World Wide Web Consortium</a>. <abbr title="World Wide Web Consortium">W3C</abbr><sup>®</sup> <a href="https://www.w3.org/policies/#Legal_Disclaimer">liability</a>, <a href="https://www.w3.org/policies/#W3C_Trademarks">trademark</a> and <a href="https://www.w3.org/copyright/software-license/" rel="license" title="W3C Software and Document License">permissive document license</a> rules apply. </p>
   <hr title="Separator for header">
  </div>
  <div class="p-summary" data-fill-with="abstract">
   <h2 class="no-num no-toc no-ref heading settled" id="abstract"><span class="content">Abstract</span></h2>
   <p>This is a temporary place for additions to CSS Colors 4 and moved from SVG2.</p>
  </div>
  <h2 class="no-num no-toc no-ref heading settled" id="sotd"><span class="content">Status of this document</span></h2>
  <div data-fill-with="status">
   <p> <em>This section describes the status of this document at the time of
	its publication. A list of
	current W3C publications and the latest revision of this technical report
	can be found in the <a href="http://www.w3.org/TR/">W3C technical reports
	index at http://www.w3.org/TR/.</a></em> </p>
   <p> This document is the 1 January 1970 <strong>Editor’s Draft</strong> of Additions to CSS Color 4. </p>
   <p> Comments on this Editor’s Draft are welcome. Comments can be sent to <a href="mailto:www-svg@w3.org?Subject=%5Bsvg-color%5D%20PUT%20SUBJECT%20HERE">www-svg@w3.org</a>,
	the public email list for issues related to vector graphics on the Web. This list is <a href="http://lists.w3.org/Archives/Public/www-svg/">archived</a> and senders must agree to have their message
	publicly archived from their first posting. To subscribe send an email to <a href="mailto:www-svg-request@w3.org?Subject=subscribe">www-svg-request@w3.org</a> with the word <code>subscribe</code> in the subject line. </p>
   <p> This document has been produced by the <a href="https://www.w3.org/groups/wg/svg">SVG Working Group</a> as part of the <a href="http://www.w3.org/Graphics/Activity">Graphics Activity</a> within the <a href="http://www.w3.org/Interaction/">W3C Interaction Domain</a>. The goals of the W3C SVG Working Group are discussed in the <a href="http://www.w3.org/2007/11/SVG_rechartering/SVG-WG-charter.html">W3C SVG Charter</a>. The W3C SVG Working Group maintains a
	public Web page, <a href="http://www.w3.org/Graphics/SVG/">http://www.w3.org/Graphics/SVG/</a>, that contains further
	background information. The authors of this document are the SVG Working Group participants. </p>
   <p> This document was produced by a group operating under
	the <a href="http://www.w3.org/Consortium/Patent-Policy/">W3C Patent Policy</a>.
	W3C maintains a <a href="http://www.w3.org/2004/01/pp-impl/19480/status" rel="disclosure">public list of any patent disclosures</a> made in connection with the deliverables of each group;
	these pages also includes instructions for disclosing a patent.
	An individual who has actual knowledge of a patent which the individual believes contains <a href="http://www.w3.org/Consortium/Patent-Policy/#def-essential">Essential Claim(s)</a> must disclose the information in accordance with <a href="http://www.w3.org/Consortium/Patent-Policy/#sec-Disclosure">section 6 of the W3C Patent Policy</a>. </p>
   <p> A list of current W3C Recommendations and other technical documents can be found at <a href="http://www.w3.org/TR/">http://www.w3.org/TR/</a>. W3C publications may be updated, replaced, or
	obsoleted by other documents at any time. </p>
   <p></p>
  </div>
  <div data-fill-with="at-risk"></div>
  <nav data-fill-with="table-of-contents" id="toc">
   <h2 class="no-num no-toc no-ref" id="contents">Table of Contents</h2>
   <ol class="toc" role="directory">
    <li><a href="#ColorIntroduction"><span class="secno">1</span> <span class="content">Introduction</span></a>
    <li><a href="#color-managed-images"><span class="secno">2</span> <span class="content">Color-managed images</span></a>
    <li>
     <a href="#Color_syntax"><span class="secno">3</span> <span class="content">Color syntax</span></a>
     <ol class="toc">
      <li><a href="#sRGBcolor"><span class="secno">3.1</span> <span class="content"> sRGB colors</span></a>
      <li><a href="#sRGBcoloralpha"><span class="secno">3.2</span> <span class="content"> sRGB colors with alpha</span></a>
      <li><a href="#icc-colors"><span class="secno">3.3</span> <span class="content"> ICC colors</span></a>
      <li><a href="#LAB"><span class="secno">3.4</span> <span class="content">LAB color</span></a>
      <li><a href="#named"><span class="secno">3.5</span> <span class="content"> ICC named color</span></a>
     </ol>
    <li>
     <a href="#Unmanaged"><span class="secno">4</span> <span class="content">Unmanaged colors</span></a>
     <ol class="toc">
      <li><a href="#device"><span class="secno">4.1</span> <span class="content"> Uncalibrated device color</span></a>
     </ol>
    <li><a href="#ColorProperty"><span class="secno">5</span> <span class="content">The effect of the <span class="property"><span class="property">color</span></span> property</span></a>
    <li>
     <a href="#ColorProfileDescriptions"><span class="secno">6</span> <span class="content">Color profile descriptions</span></a>
     <ol class="toc">
      <li><a href="#ColorProfileDescriptionsOverview"><span class="secno">6.1</span> <span class="content"> Overview of color profile descriptions</span></a>
      <li><a href="#ColorProfileAtRule"><span class="secno">6.2</span> <span class="content">The CSS <strong>@color-profile</strong> rule</span></a>
     </ol>
    <li><a href="#syntax"><span class="secno">7</span> <span class="content">Color syntax</span></a>
    <li>
     <a href="#w3c-conformance"><span class="secno"></span> <span class="content">Conformance</span></a>
     <ol class="toc">
      <li><a href="#w3c-conventions"><span class="secno"></span> <span class="content">Document conventions</span></a>
      <li><a href="#w3c-conformant-algorithms"><span class="secno"></span> <span class="content">Conformant Algorithms</span></a>
     </ol>
    <li>
     <a href="#index"><span class="secno"></span> <span class="content">Index</span></a>
     <ol class="toc">
      <li><a href="#index-defined-elsewhere"><span class="secno"></span> <span class="content">Terms defined by reference</span></a>
     </ol>
    <li>
     <a href="#references"><span class="secno"></span> <span class="content">References</span></a>
     <ol class="toc">
      <li><a href="#normative"><span class="secno"></span> <span class="content">Normative References</span></a>
     </ol>
    <li><a href="#issues-index"><span class="secno"></span> <span class="content">Issues Index</span></a>
   </ol>
  </nav>
  <main>
   <div class="annotation svg2-requirement">
    <table>
     <tbody>
      <tr>
       <th>SVG 2 Requirement:
       <td>Support color management.
      <tr>
       <th>Resolution:
       <td><a href="http://www.w3.org/2011/10/28-svg-irc#T16-52-12">SVG 2 will depend on SVG color management subject to deciding the exact conformance classes required.</a>
      <tr>
       <th>Purpose:
       <td>To align with mainstream graphcs use, allow fluorescent colors, more than 8 bit color, etc.
      <tr>
       <th>Owner:
       <td>Chris (<a href="http://www.w3.org/Graphics/SVG/WG/track/actions/3160">ACTION-3160</a>)
      <tr>
       <th>Note:
       <td>SVG color management will become a chapter in SVG 2, no longer an independent module.
    </table>
   </div>
   <div class="annotation svg2-requirement">
    <table>
     <tbody>
      <tr>
       <th>SVG 2 Requirement:
       <td>Support CSS3 Color syntax.
      <tr>
       <th>Resolution:
       <td><a href="http://www.w3.org/2011/07/29-svg-minutes.html#item08">SVG 2 will depend on CSS3 Color.</a>
      <tr>
       <th>Purpose:
       <td>To align with CSS, given CSS3 Color is widely implemented.
      <tr>
       <th>Owner:
       <td>Chris (no action)
    </table>
   </div>
   <h2 class="heading settled" data-level="1" id="ColorIntroduction"><span class="secno">1. </span><span class="content">Introduction</span><a class="self-link" href="#ColorIntroduction"></a></h2>
   <p class="normativity"><em>This introduction is informative, not normative.</em></p>
   <p>Several properties used in SVG take a color specification. Also, external media such as images or video
  contain colors.</p>
   <p>All SVG colors used as property values include a fallback specified in the sRGB color space
[<a href="refs.html#ref-SRGB">SRGB</a>]. </p>
   <p>Additionally, SVG content can specify an alternate color specification
using an ICC profile [<a href="refs.html#ref-ICC42">ICC42</a>].
If ICC-based colors are provided,
then the ICC-based color takes precedence over the sRGB color specification;
otherwise, the sRGB fallback colors will be used.
Note that, in this specification, by default color interpolation occurs in sRGB color space even if an
ICC-based color specification is provided, but this can be changed (see <a class="property css" data-link-type="property" href="https://svgwg.org/svg2-draft/painting.html#ColorInterpolationProperty" id="ref-for-ColorInterpolationProperty">color-interpolation</a>).</p>
   <div class="ready-for-wider-review">
    <h2 class="heading settled" data-level="2" id="color-managed-images"><span class="secno">2. </span><span class="content">Color-managed images</span><a class="self-link" href="#color-managed-images"></a></h2>
    <p class="note" role="note"> New in SVG 2.</p>
    <p>Implementations of SVG 2 are required to color-manage all images. The embedded profile is used. If there is no embedded profile, sRGB is assumed, for RGB images.</p>
    <p class="issue" id="issue-c7810739"><a class="self-link" href="#issue-c7810739"></a>Define processing for untagged greyscale and CMYK images. Could be a default profile, or an 'explicitly undefined' with a warning to avoid untagged non-RGB images when authoring.</p>
    <p class="issue" id="issue-cb9985c4"><a class="self-link" href="#issue-cb9985c4"></a>References to "SVG 2 User Agent" might need to be replaced
    with one of the conformance classes listed in the <a href="conform.html">Conformance</a> appendix.</p>
    <p><span class="requirement" id="assert_taggedImages">If a referenced image
    contains color profile information, a SVG 2 User Agent MUST use that profile
    to render the image.</span> <span class="requirement" id="assert_untaggedImages">Otherwise,
    if a referenced image contains no color profile information, a
    SVG 2 User Agent MUST use the sRGB profile to render the image.</span></p>
    <h2 class="heading settled" data-level="3" id="Color_syntax"><span class="secno">3. </span><span class="content">Color syntax</span><a class="self-link" href="#Color_syntax"></a></h2>
    <h3 class="heading settled" data-level="3.1" id="sRGBcolor"><span class="secno">3.1. </span><span class="content"> sRGB colors</span><a class="self-link" href="#sRGBcolor"></a></h3>
    <p class="prop-value"><a href="#color">&lt;color></a></p>
    <p>Example (these all represent the same color):</p>
    <div class="example" id="example-a7a4c930">
     <a class="self-link" href="#example-a7a4c930"></a> 
<pre>&lt;circle fill="rgb(205,133,63)"/>
&lt;circle fill="peru"/>
&lt;circle fill="rgb(80.392%, 52.157%, 24.706%)"/>
&lt;circle fill="#CD853F"/>
&lt;circle fill="hsl(30, 59%, 53%)"/></pre>
    </div>
    <p class="note" role="note"> Includes all syntactic forms supported by  SVG 1.1, adds hsl() from  [<a href="refs.html#ref-CSS3COLOR">CSS3COLOR</a>].</p>
    <p class="note" role="note">See the CSS Color Module Level 3 specification for the
      definition of the color type.
      [<a href="refs.html#ref-CSS3COLOR">CSS3COLOR</a>]</p>
    <p class="note" role="note">Must add the hsla and hsl forms.</p>
    <div class="requirement" id="assert_base_syntax">
     <p>All the syntactic forms for an sRGB color, including the full set of color keywords, shall be supported by an SVG 2 User Agent.</p>
    </div>
    <p>The rendering requirements for sRGB colors are more strict than for SVG 1.1  User Agents,
      where color management is optional.</p>
    <div class="requirement" id="assert_render_sRGB">
     <p> When an sRGB color is used - because it is the sole color specification, or in a
        permitted fallback situation - a conformant SVG 2 User Agent 
        shall render it in conformance with the ICC profile for sRGB, to obtain the
        desired color appearance. </p>
    </div>
    <p class="issue" id="issue-6389d0d5"><a class="self-link" href="#issue-6389d0d5"></a> Define 'permitted fallback situation' and link to it. </p>
    <h3 class="heading settled" data-level="3.2" id="sRGBcoloralpha"><span class="secno">3.2. </span><span class="content"> sRGB colors with alpha</span><a class="self-link" href="#sRGBcoloralpha"></a></h3>
    <p class="prop-value"><a href="#color">rgba(r, g, b, a)</a></p>
    <p>Example </p>
    <div class="example" id="example-41892b56">
     <a class="self-link" href="#example-41892b56"></a> 
<pre>&lt;circle fill="rgba(205,133,63, 0.5)"/></pre>
    </div>
    <p class="note" role="note"> New in SVG 2, added from  [<a href="refs.html#ref-CSS3COLOR">CSS3COLOR</a>].</p>
    <div class="requirement" id="assert_combine-alpha">
     <p>When an sRGB color with alpha is used in a property value,  an SVG 2 User Agent shall combine the alpha value with any separately specified alpha value that applies to that property, by multiplying the alpha values together.</p>
    </div>
    <p>Example (these render as the same color)</p>
    <div class="example" id="example-5364b3ce">
     <a class="self-link" href="#example-5364b3ce"></a> 
<pre>&lt;circle fill="rgba(205,133,63, 0.25)"/>
&lt;circle fill="rgba(205,133,63, 1.0)" fill-opacity="0.25"/>
&lt;circle fill="rgba(205,133,63, 0.5)" fill-opacity="0.5"/></pre>
    </div>
    <div class="requirement" id="assert_render_sRGB_alpha">
     <p> When an sRGB color with alpha is used - because it is the sole color specification, or in a
        permitted fallback situation - a conformant SVG 2 User Agent 
        shall render it in conformance with the ICC profile for sRGB, to obtain the
        desired color appearance. </p>
    </div>
    <h3 class="heading settled" data-level="3.3" id="icc-colors"><span class="secno">3.3. </span><span class="content"> ICC colors</span><a class="self-link" href="#icc-colors"></a></h3>
    <p class="prop-value"><a href="#fallback">&lt;fallback></a> <a href="#icccolor"> icc-color(&lt;name> [,&lt;icccolorvalue>]*)</a></p>
    <p class="issue" id="issue-457cb5a6"><a class="self-link" href="#issue-457cb5a6"></a>This grammar doesn’t match the grammar <a href="#icccolor">below</a>.  Also the ones below should
    be translated from EBNF to CSS Value syntax.</p>
    <p>Example:</p>
    <div class="example" id="example-eacf9a49">
     <a class="self-link" href="#example-eacf9a49"></a> 
<pre>&lt;style>
@color-profile {
  name: acmecmyk;
  src: url(http://printers.example.com/acmecorp/model1234);
}
&lt;/style>
&lt;circle fill="#CD853F icc-color(acmecmyk, 0.11, 0.48, 0.83, 0.00)"/></pre>
    </div>
    <p class="note" role="note">Same syntax as SVG 1.1, increased conformance requirement.</p>
    <p>SVG 2  uses the extended ICC color specification from SVG 1.1.  In SVG 1.1,  parsing the syntax was required but implementing the ICC colour itself  was optional,  as indicated by  phrases such as "If ICC-based colors are provided and the SVG user agent supports ICC color, then...". An SVG 1.1 user agent which also conforms to this specification "supports ICC color" for the purposes of conforming to SVG 1.1.</p>
    <p> As with SVG Full 1.1, SVG 2 content may specify color using an ICC profile (see
      [<a href="refs.html#ref-ICC42">ICC42</a>]); an sRGB fallback must still be provided. </p>
    <p>An SVG 2 User Agent searches the color profile description database for
      a <a href="#ColorProfileDescriptions">color profile description</a> entry whose
      name descriptor matches &lt;name> and uses the last matching entry that is found;
      painting shall be done using the given ICC color, where the comma-separated list
      (with optional white space) of <strong>&lt;icccolorvalue></strong>’s is a set
      of ICC-profile-specific color values, expressed as <a class="production css" data-link-type="type" href="https://drafts.csswg.org/css-values-4/#number-value" id="ref-for-number-value">&lt;number></a>’s
      (see <a href="#icc-colors">ICC colors</a>). If no match is
      found, then the fallback sRGB color is used. </p>
    <div class="requirement" id="assert_ICCColorPrecedence">
     <p> If ICC-based colors are provided, an SVG 2 User Agent
        MUST use the ICC-based color in preference to the sRGB fallback color,
        unless the ICC color profile cannot be used (is unavailable, malformed, or uses an unsupported profile connection
        space).</p>
    </div>
    <div class="requirement" id="assert_useICC">
     <p>When rendering, if both ICC and sRGB fallback colors are provided and the referenced ICC profile can be used, a SVG 2 User Agent MUST render using the ICC color values, using the specified ICC profile as the input profile.</p>
    </div>
    <h3 class="heading settled" data-level="3.4" id="LAB"><span class="secno">3.4. </span><span class="content">LAB color</span><a class="self-link" href="#LAB"></a></h3>
    <p class="note" role="note"> New in SVG 2.</p>
    <p class="prop-value"><a href="#fallback">&lt;fallback></a> <a href="#cielabcolor">cielab(&lt;Lightness>, &lt;a> &lt;b>)</a> | <br> <a href="#fallback">&lt;fallback></a> <a href="#cielchabcolor">cielchab(&lt;Lightness> &lt;Chroma>, &lt;Hue> )</a> </p>
    <div class="example" id="example-be4111ac">
     <a class="self-link" href="#example-be4111ac"></a> 
<pre>&lt;circle fill="#CD853F cielab(62.253188, 23.950124, 48.410653)"/>
&lt;circle fill="#CD853F cielch(62.253188, 54.011108, 63.677091)"/>
</pre>
    </div>
    <p>An SVG 2 User Agent directly uses the CIE LAB or CIE LCHab values, where the comma-separated list
      (with optional white space) of <strong>&lt;icccolorvalue></strong>’s is a set
      of Lightness, a and b or Lightness, Hue and Chroma values, expressed as <a class="css" data-link-type="type" href="https://drafts.csswg.org/css-values-4/#number-value" id="ref-for-number-value①">&lt;number></a>s. A color profile is not referenced in the SVG, although profile-based implementations may 
    choose to implement this by providing and using an LAB profile.</p>
    <p>The white point  is D50, which is the whitepoint defined by the CIE for CIELab profile connection space and the 
            whitepoint used for image editors that provide LAB functionality.
          LAB measurements relative to a different whitepoint should be adapted to D50 to be used in SVG 2; the linear Bradford chromatic adaptation transform [<a href="refs.html#ref-BRADFORD">BRADFORD</a>] is suggested for this.</p>
    <div class="requirement" id="assert_LABColorPrecedence">
     <p> If LAB-based colors are provided, an SVG 2 User Agent
        MUST use the LAB-based color in preference to the sRGB fallback color.</p>
    </div>
    <div class="requirement" id="assert_useLAB">
     <p>When rendering, if both LAB and sRGB fallback colors are provided, a SVG 2 User Agent MUST render using the ICC color values, using the specified ICC profile as the input profile.</p>
    </div>
    <p>A fallback sRGB color must still be provided, for non-color-managed user agents.</p>
    <h3 class="heading settled" data-level="3.5" id="named"><span class="secno">3.5. </span><span class="content"> ICC named color</span><a class="self-link" href="#named"></a></h3>
    <p class="note" role="note"> New in SVG 2.</p>
    <p class="prop-value"><a href="#fallback">&lt;fallback></a> <a href="#iccnamedcolor">icc-named-color(&lt;name>, &lt;namedColor>)</a></p>
    <p>Example:</p>
    <div class="example" id="example-a6f69baf">
     <a class="self-link" href="#example-a6f69baf"></a> 
<pre>&lt;style>
@color-profile {
  name: FooColors;
  src: url(http://swatches.example.com/Foo);
}
&lt;/style>
&lt;circle fill="#CD853F icc-color(FooColors, Sandy23C)"/></pre>
    </div>
    <p> SVG 2 introduces the ability to specify a color using a 'Named Color Profile'. </p>
    <p>An SVG 2 User Agent searches the color profile description database for
      a <a href="#ColorProfileDescriptions">color profile description</a> entry whose
      name descriptor matches &lt;name> and uses the last matching entry that is found;
      painting shall be done using the given ICC color, where namedColor is a
      &lt;string> indicating the named color to use.</p>
    <p class="issue" id="issue-67b7154a"><a class="self-link" href="#issue-67b7154a"></a>This might need to be an &lt;ident> rather than a &lt;string>.</p>
    <p>ICC named color profiles provide a platform- and implementation-neutral way
    to share a swatch of colors, or to use user-created names for colors.</p>
    <div class="requirement" id="assert_ICCNamedColorPrecedence">
     <p> If ICC-based named colors are provided, a conformant SVG 2 User Agent 
        MUST use the ICC-based named color in preference to the sRGB fallback
        color, unless the ICC named color profile is unavailable, malformed, or uses a profile
        connection space other than CIE XYZ or CIE LAB.</p>
    </div>
    <div class="requirement" id="assert_useICCNamed">
     <p> When an ICC named color is used, a conformant SVG 2 User Agent 
        shall render it in conformance with the specified ICC profile to obtain the
        desired color appearance.</p>
    </div>
   </div>
   <div class="ready-for-wider-review">
    <h2 class="heading settled" data-level="4" id="Unmanaged"><span class="secno">4. </span><span class="content">Unmanaged colors</span><a class="self-link" href="#Unmanaged"></a></h2>
    <h3 class="heading settled" data-level="4.1" id="device"><span class="secno">4.1. </span><span class="content"> Uncalibrated device color</span><a class="self-link" href="#device"></a></h3>
    <p class="note" role="note"> New in SVG 2.</p>
    <p class="prop-value"><a href="#fallback">&lt;fallback></a> <a href="#devicegray">device-gray(&lt;gray>)</a> | <br> <a href="#fallback">&lt;fallback></a> <a href="#devicergb">device-rgb(&lt;red> &lt;green> &lt;blue>)</a> | <br> <a href="#fallback">&lt;fallback></a> <a href="#devicecmyk">device-cmyk(&lt;cyan> &lt;magenta> &lt;yellow> 
      &lt;black>)</a> | <br> <a href="#fallback">&lt;fallback></a> <a href="#devicegray">device-nchannel(&lt;number>+)</a> | </p>
    <div class="example" id="example-a984e37e">
     <a class="self-link" href="#example-a984e37e"></a> 
<pre>&lt;circle fill="#CD853F device-cmyk(0.11, 0.48, 0.83, 0.00)"/></pre>
    </div>
    <p> SVG 2  introduces a method of specifying uncalibrated device colors. This
    is sometimes useful in print workflows, for example to produce patches of known 
    ink density used for quality control purposes. </p>
    <p>An SVG 2 User Agent which supports the indicated class of output device
    will pass the values through without color management. If the class of output device 
    (for example, cmyk) is not supported, then the fallback
    sRGB color is used. </p>
    <p> As these are uncalibrated, any interpolation or compositing occurs using the fallback
    sRGB color value.</p>
   </div>
   <div class="ready-for-wider-review">
    <h2 class="heading settled" data-level="5" id="ColorProperty"><span class="secno">5. </span><span class="content">The effect of the <span class="property"><a class="property css" data-link-type="property" href="https://drafts.csswg.org/css-color-4/#propdef-color" id="ref-for-propdef-color">color</a></span> property</span><a class="self-link" href="#ColorProperty"></a></h2>
    <p class="note" role="note">See the CSS Color Module Level 3 specification for the
definition of <a class="property css" data-link-type="property" href="https://drafts.csswg.org/css-color-4/#propdef-color" id="ref-for-propdef-color①">color</a>.
[<a href="refs.html#ref-CSS3COLOR">CSS3COLOR</a>]</p>
    <p>The <a class="property css" data-link-type="property" href="https://drafts.csswg.org/css-color-4/#propdef-color" id="ref-for-propdef-color②">color</a> property is used to provide a potential indirect value, <span class="prop-value">currentColor</span>, for the <a class="property css" data-link-type="property" href="https://drafts.fxtf.org/fill-stroke-3/#propdef-fill" id="ref-for-propdef-fill">fill</a>, <a class="property css" data-link-type="property" href="https://drafts.fxtf.org/fill-stroke-3/#propdef-stroke" id="ref-for-propdef-stroke">stroke</a>, <a class="property css" data-link-type="property">solid-color</a>, <a class="property css" data-link-type="property" href="https://svgwg.org/svg2-draft/pservers.html#StopColorProperty" id="ref-for-StopColorProperty">stop-color</a>, <a class="property css" data-link-type="property" href="https://drafts.fxtf.org/filter-effects-1/#propdef-flood-color" id="ref-for-propdef-flood-color">flood-color</a> and <a class="property css" data-link-type="property" href="https://drafts.fxtf.org/filter-effects-1/#propdef-lighting-color" id="ref-for-propdef-lighting-color">lighting-color</a> properties.  The property has no other effect
on SVG elements.</p>
    <div class="example" id="example-39699348">
     <a class="self-link" href="#example-39699348"></a> 
     <p>The following example shows how the inherited value of the <a class="property css" data-link-type="property" href="https://drafts.csswg.org/css-color-4/#propdef-color" id="ref-for-propdef-color③">color</a> property from an HTML document can be used to
  set the color of SVG text in an inline SVG fragment.</p>
<pre>&lt;!DOCTYPE html>
&lt;style>
body { color: #468; font: 16px sans-serif }
svg { border: 1px solid #888; background-color: #eee }
&lt;/style>
&lt;p>Please see the diagram below:&lt;/p>
&lt;svg width="200" height="100">
  &lt;g fill="currentColor">
    &lt;text x="70" y="55" text-anchor="end">START&lt;/text>
    &lt;text x="130" y="55">STOP&lt;/text>
    &lt;path d="M 85,45 h 25 v -5 l 10,10 -10,10 v -5 h -25 z"/>
  &lt;/g>
&lt;/svg>
</pre>
     <div class="figure">
      <div class="bordered" style="color: #468; font: 16px sans-serif; display: inline-block; text-align: left; padding: 32px 128px 32px 32px">
       <p style="margin-top: 0; margin-bottom: 1em">Please see the diagram below:</p>
       <svg height="100" style="border: 1px solid #888; background-color: #eee" width="200" xmlns="http://www.w3.org/2000/svg">
        <g fill="currentColor">
         <text text-anchor="end" x="70" y="55">START</text>
         <text x="130" y="55">STOP</text>
         <path d="M 85,45 h 25 v -5 l 10,10 -10,10 v -5 h -25 z"></path>
        </g>
       </svg>
      </div>
      <p class="caption">The text and arrow in the SVG fragment are filled
    with the same color as the inherited <a class="property css" data-link-type="property" href="https://drafts.csswg.org/css-color-4/#propdef-color" id="ref-for-propdef-color④">color</a> property.</p>
     </div>
    </div>
   </div>
   <h2 class="heading settled" data-level="6" id="ColorProfileDescriptions"><span class="secno">6. </span><span class="content">Color profile descriptions</span><a class="self-link" href="#ColorProfileDescriptions"></a></h2>
   <h3 class="heading settled" data-level="6.1" id="ColorProfileDescriptionsOverview"><span class="secno">6.1. </span><span class="content"> Overview of color profile descriptions</span><a class="self-link" href="#ColorProfileDescriptionsOverview"></a></h3>
   <p> The <a href="http://www.color.org/">International Color Consortium</a> has established
    a standard, the ICC Profile [<a href="http://www.color.org/ICC-1A_1999-04.PDF">ICC32</a>],
    for documenting the color characteristics of input and output devices. Using these
    profiles, it is possible to build a transform and correct visual data for viewing
    on different devices.</p>
   <p> A <span class="SVG-Term">color profile description</span> provides the bridge between
    an ICC profile and references to that ICC profile within SVG content. The color
    profile description is added to the user agent’s list of known color profiles and
    then used to select the relevant profile. The color profile description contains
    descriptors for the location of the color profile on the Web, a name to reference
    the profile and information about rendering intent.</p>
   <h3 class="heading settled" data-level="6.2" id="ColorProfileAtRule"><span class="secno">6.2. </span><span class="content">The CSS <strong>@color-profile</strong> rule</span><a class="self-link" href="#ColorProfileAtRule"></a></h3>
   <p>When the document is styled using CSS, the CSS <strong>@color-profile</strong> rule can be used to specify a color
profile description. The general form is:</p>
<pre>@color-profile { &lt;color-profile-description> }
</pre>
   <p>where the &lt;color-profile-description> has the form:</p>
<pre>descriptor: value;
[...]
descriptor: value;
</pre>
   <p>Each @color-profile rule specifies a value for every color
profile descriptor, either implicitly or explicitly. Those not
given explicit values in the rule take the initial value listed
with each descriptor in this specification. These descriptors
apply solely within the context of the @color-profile rule in
which they are defined, and do not apply to document language
elements. Thus, there is no notion of which elements the
descriptors apply to, or whether the values are inherited by
child elements.</p>
   <p>The following are the descriptors for a &lt;color-profile-description>:</p>
   <div class="propdef">
    <dl>
     <dt id="ColorProfileSrcProperty"><a class="self-link" href="#ColorProfileSrcProperty"></a><span class="descdef-title property"><a class="property css" data-link-type="property">src</a></span>
     <dd>
      <table class="propinfo">
       <tbody>
        <tr>
         <td><em>Values:</em>
         <td>sRGB | &lt;local-profile> | <a class="css" data-link-type="type" href="https://drafts.csswg.org/css-values-4/#url-value" id="ref-for-url-value">&lt;url></a> |
              (&lt;local-profile> <a class="css" data-link-type="type" href="https://drafts.csswg.org/css-values-4/#url-value" id="ref-for-url-value①">&lt;url></a>)
        <tr>
         <td><em>Initial:</em>
         <td>sRGB
        <tr>
         <td><em>Media:</em>
         <td>visual
      </table>
    </dl>
   </div>
   <dl>
    <dt><span class="prop-value">sRGB</span>
    <dd>The source profile is the sRGB color space. For
  consistency with <a href="http://www.w3.org/TR/2011/REC-CSS2-20110607/grammar.html#scanner">CSS lexical scanning and parsing rules</a> ([<a href="refs.html#ref-CSS21">CSS21</a>], section G.2), the keyword "sRGB" is
  case-insensitive; however, it is recommended that the mixed
  capitalization "sRGB" be used for consistency with common
  industry practice.
    <dt><span class="prop-value">&lt;local-profile></span>
    <dd>
     <p>The source profile is a locally-stored profile. The syntax
    for &lt;local-profile> is:</p>
<pre>"local(" + &lt;string> + ")"
</pre>
     <p>where &lt;string> is the profile’s unique ID as
    specified by <a href="http://www.color.org/">International
    Color Consortium</a>. (Note: Profile description fields do <em>not</em> represent a profile’s unique ID. With current
    ICC proposals, the profile’s unique ID is an MD5-encoded
    value within the profile header.)</p>
    <dt><span class="prop-value"><a class="css" data-link-type="type" href="https://drafts.csswg.org/css-values-4/#url-value" id="ref-for-url-value②">&lt;url></a></span>
    <dd>The source profile is an <a data-link-type="dfn" href="https://svgwg.org/svg2-draft/linking.html#TermURLReference" id="ref-for-TermURLReference">URL reference</a> to a color profile.
    <dt>(<span class="prop-value">&lt;local-profile> <a class="css" data-link-type="type" href="https://drafts.csswg.org/css-values-4/#url-value" id="ref-for-url-value③">&lt;url></a>)</span>
    <dd>Two profiles are specified. If &lt;local-profile>
  cannot be found on the local system, then the <a class="css" data-link-type="type" href="https://drafts.csswg.org/css-values-4/#url-value" id="ref-for-url-value④">&lt;url></a> is used.
   </dl>
   <div class="propdef">
    <dl>
     <dt id="ColorProfileNameProperty"><a class="self-link" href="#ColorProfileNameProperty"></a><span class="descdef-title property"><a class="property css" data-link-type="property">name</a></span>
     <dd>
      <table class="propinfo">
       <tbody>
        <tr>
         <td><em>Values:</em>
         <td><a class="css" data-link-type="type" href="https://drafts.csswg.org/css2/#value-def-identifier" id="ref-for-value-def-identifier">&lt;identifier></a>
        <tr>
         <td><em>Initial:</em>
         <td>undefined
        <tr>
         <td><em>Media:</em>
         <td>visual
      </table>
    </dl>
   </div>
   <dl>
    <dt><span class="prop-value"><a class="css" data-link-type="type" href="https://drafts.csswg.org/css2/#value-def-identifier" id="ref-for-value-def-identifier①">&lt;identifier></a></span>
    <dd>The name which is used as the first parameter for <span class="prop-value">icc-color</span> specifications within <a class="property css" data-link-type="property" href="https://drafts.fxtf.org/fill-stroke-3/#propdef-fill" id="ref-for-propdef-fill①">fill</a>, <a class="property css" data-link-type="property" href="https://drafts.fxtf.org/fill-stroke-3/#propdef-stroke" id="ref-for-propdef-stroke①">stroke</a>, <a class="property css" data-link-type="property" href="https://svgwg.org/svg2-draft/pservers.html#StopColorProperty" id="ref-for-StopColorProperty①">stop-color</a>, <a class="property css" data-link-type="property" href="https://drafts.fxtf.org/filter-effects-1/#propdef-flood-color" id="ref-for-propdef-flood-color①">flood-color</a> and <a class="property css" data-link-type="property" href="https://drafts.fxtf.org/filter-effects-1/#propdef-lighting-color" id="ref-for-propdef-lighting-color①">lighting-color</a> property
  values to identify the color profile to use for the ICC
  color specification.  Note that if <a class="property css" data-link-type="property">name</a> is not
  provided, it will be impossible to reference the given @color-profile
  definition.
   </dl>
   <div class="propdef">
    <dl>
     <dt id="RenderingIntentProperty"><a class="self-link" href="#RenderingIntentProperty"></a><span class="descdef-title property"><a class="property css" data-link-type="property">rendering-intent</a></span>
     <dd>
      <table class="propinfo">
       <tbody>
        <tr>
         <td><em>Values:</em>
         <td>auto | perceptual | relative-colorimetric |<br> saturation | absolute-colorimetric
        <tr>
         <td><em>Initial:</em>
         <td>auto
        <tr>
         <td><em>Media:</em>
         <td>visual
        <tr>
         <td><em><a href="animate.html#Animatable">Animatable</a>:</em>  
         <td>no
      </table>
    </dl>
   </div>
   <p>The ‘rendering-intent’ descriptor
permits the specification of a color profile rendering
intent other than the default. ‘rendering-intent’ is applicable
primarily to color profiles corresponding to CMYK color
spaces. The different options cause different methods to
be used for translating colors to the color gamut of the
target rendering device:</p>
   <dl>
    <dt><span class="prop-value">auto</span>
    <dd>
     This is the default behavior. The user agent
  determines the best intent based on the content type. 
     <div class="requirement" id="assert_renderingIntentAuto"> For image content containing an embedded profile, the User Agent MUST use the intent
      specified within the profile. Otherwise, the user agent MUST use the current profile
      and force the intent, overriding any intent that might be stored in the profile
      itself. </div>
    <dt><span class="prop-value">perceptual</span>
    <dd>
     <p>This method is often the preferred choice for images, especially when
    there are substantial differences between the source and destination
    (such as a CRT display image reproduced on a reflection print). It takes
    the colors of the source image and re-optimizes the appearance for the
    destination medium using proprietary methods. This re-optimization may
    result in colors within both the source and destination gamuts being
    changed, although perceptual transforms are supposed to maintain the
    basic artistic intent of the original in the reproduction. They will not
    attempt to correct errors in the source image. </p>
     <p class="note" role="note">With v2 ICC profiles there is no specified perceptual reference
      medium, which can cause interoperability problems. When v2 ICC profiles
      are used it may be safer to use the media-relative colorimetric
      rendering intent with black point compensation, instead of the perceptual
      rendering intent, unless the specific source and destination profiles to
      be used have been checked to ensure the combination produces the desired
      result. </p>
     <div class="requirement" id="assert_renderingIntentPerceptual"> This method SHOULD maintain relative color values among the pixels as they are mapped
      to the target device gamut. This method MAY change pixel values that were originally
      within the target device gamut, in order to avoid hue shifts and discontinuities
      and to preserve as much as possible the overall appearance of the scene. </div>
    <dt><span class="prop-value">saturation</span>
    <dd>
     <p>This option was created to preserve the relative saturation (chroma) of
    the original, and to keep solid colors pure. However, it experienced
    interoperability problems like the perceptual intent, and as solid color
    preservation is not amenable to a reference medium solution using v4
    profiles does not solve the problem. Use of this rendering intent is <em>not
      recommended</em> unless the specific source and destination profiles to be
    used have been checked to ensure the combination produces the desired
    result. </p>
     <div class="requirement" id="assert_renderingIntentSaturation"> This option SHOULD preserve the relative saturation (chroma) values of the original
      pixels. Out of gamut colors SHOULD be converted to colors that have the same saturation
      but fall just inside the gamut. </div>
    <dt><span class="prop-value">relative-colorimetric</span>
    <dd>
     <p>Media-relative colorimetric 
    is required to leave source colors that fall inside the destination
    medium gamut unchanged relative to the respective media white points.
    Source colors that are out of the destination medium gamut are mapped to
    colors on the gamut boundary using a variety of different methods.</p>
     <p class="note" role="note">Note: the media-relative colorimetric rendering intent is often used with
      black point compensation, where the source medium black point is mapped
      to the destination medium black point as well.</p>
     <div class="requirement" id="assert_renderingIntentRelativeColorimetric"> This method MUST map the source white point to the desination white point.
      If black point compensation is in use, the source black point MUST also be mapped to the destination black point.
      Adaptation algorithms SHOULD be used to adjust for the change in white point. Relative relationships of colors inside
      both source and destination gamuts SHOULD be preserved. 
      Relative relationships of colors outside the destination gamut MAY be changed. </div>
    <dt><span class="prop-value">absolute-colorimetric</span>
    <dd>
     <p>ICC-absolute colorimetric  is
    required to leave source colors that fall inside the destination medium
    gamut unchanged relative to the adopted white (a perfect reflecting
    diffuser). Source colors that are out of the destination medium gamut
    are mapped to colors on the gamut boundary using a variety of different
    methods. This method produces the most accurate color matching of
    in-gamut colors, but will result in highlight clipping if the
    destination medium white point is lower than the source medium white
    point. For this reason it is recommended for use <em>only</em> in applications
    that need exact color matching and where highlight clipping is not a
    concern. </p>
     <div class="requirement" id="assert_renderingIntentAbsoluteColorimetric"> This method MUST disable white point matching and black point matching when converting colors. </div>
      In general, this option is not recommended. 
   </dl>
   <p class="issue" id="issue-4512ce83"><a class="self-link" href="#issue-4512ce83"></a>Fallback behaviour needs to be specified, for when the
requested rendering intent does not have a corresponding table in the profile;
or when all rendering-intents are provided using the same table.</p>
   <div class="ready-for-wider-review">
    <h2 class="heading settled" data-level="7" id="syntax"><span class="secno">7. </span><span class="content">Color syntax</span><a class="self-link" href="#syntax"></a></h2>
    <p>The EBNF grammar syntax is as described in <a href="types.html#syntax">Syntax</a>.</p>
<pre><span id="DataTypeICCColor"><span id="icccolor">icccolor</span></span> ::= 
  ~"icc-color(" <a href="#name">name</a> (<a data-link-type="dfn">comma-wsp</a> <a href="#number">number</a>)+ ")" 
  
<span id="iccnamedcolor">iccnamedcolor</span> ::= 
  ~"icc-named-color(" <a href="#name">name</a> <a data-link-type="dfn">comma-wsp</a> <a href="#namedColor">namedColor</a> ")" 
  
<span id="cielabcolor">cielabcolor</span> ::=
  ~"cielab(" <a href="#lightness">lightness</a> <a data-link-type="dfn">comma-wsp</a> <a href="#a-value">a-value</a> <a data-link-type="dfn">comma-wsp</a> <a href="#b-value">b-value</a> ")" 
  
<span id="cielchabcolor">cielchabcolor</span> ::=
  ~"cielchab(" <a href="#lightness">lightness</a> <a data-link-type="dfn">comma-wsp</a> <a href="#chroma">chroma</a> <a data-link-type="dfn">comma-wsp</a> <a href="#hue">hue</a> ")" 
  
<span id="devicecolor">devicecolor</span> ::=
  <a href="#devicegray">device-gray</a> | <a href="#devicergb">devicergb</a> | <a href="#devicecmyk">devicecmyk</a> | <a href="#devicenchannel">devicenchannel</a>
  
<span id="devicegray">devicegray</span> ::=
  ~"device-gray(" <a href="#gray">gray</a> ")"
  
<span id="devicergb">devicergb</span> ::=
  ~"device-rgb(" <a href="#red">red</a> <a href="#green">green</a> <a href="#blue">blue</a> ")"
  
<span id="devicecmyk">devicecmyk</span> ::=
  ~"device-cmyk(" <a href="#cyan">cyan</a> <a href="#magenta">magenta</a> <a href="#yellow">yellow</a> <a href="#black">black</a> ")"
  
<span id="devicenchannel">devicenchannel</span> ::=
  ~"device-nchannel(" <a href="#number">number</a>+ ")"
  
<span id="name">name</span> ::=
  <a href="#namestartchar">namestartchar</a> (<a href="#namechar">namechar</a>)*
  
<span id="lightness">lightness</span> ::=
  <a href="#number">number</a>
  
<span id="a-value">a-value</span> ::=
  <a href="#number">number</a>
  
<span id="b-value">b-value</span> ::=
  <a href="#number">number</a>
  
<span id="chroma">chroma</span> ::=
  <a href="#number">number</a>
  
<span id="hue">hue</span> ::=
  <a href="#number">number</a>
  
  
<span id="gray">gray</span> ::=
  <a href="#number">number</a>
  
<span id="red">red</span> ::=
  <a href="#number">number</a>
  
<span id="green">green</span> ::=
  <a href="#number">number</a>
  
<span id="blue">blue</span> ::=
  <a href="#number">number</a>
  
<span id="cyan">cyan</span> ::=
  <a href="#number">number</a>
  
<span id="magenta">magenta</span> ::=
  <a href="#number">number</a>
  
<span id="yellow">yellow</span> ::=
  <a href="#number">number</a>
  
<span id="black">black</span> ::=
  <a href="#number">number</a>
  
<span id="namedColor">namedColor</span> ::=
  <a href="#name">name</a>
  
<span id="fallback">fallback</span> ::=
  <a href="#color">color</a>
  
<span id="color">color</span>  ::= 
  "#" <a href="#hexdigit">hexdigit</a> <a href="#hexdigit">hexdigit</a> <a href="#hexdigit">hexdigit</a> (<a href="#hexdigit">hexdigit</a> <a href="#hexdigit">hexdigit</a> <a href="#hexdigit">hexdigit</a>)?
  | ~"rgb(" <a data-link-type="dfn">wsp</a>* <a href="#integer">integer</a> <a href="#comma">comma</a> <a href="#integer">integer</a> <a href="#comma">comma</a> <a href="#integer">integer</a> <a data-link-type="dfn">wsp</a>* ")"
  | ~"rgb(" <a data-link-type="dfn">wsp</a>* <a href="#integer">integer</a> "%" <a href="#comma">comma</a> <a href="#integer">integer</a> "%" <a href="#comma">comma</a> <a href="#integer">integer</a> "%" <a data-link-type="dfn">wsp</a>* ")"
  | ~"hsl(" <a data-link-type="dfn">wsp</a>* <a href="#integer">integer</a> <a href="#comma">comma</a> <a href="#integer">integer</a> <a href="#comma">comma</a> <a href="#integer">integer</a> <a data-link-type="dfn">wsp</a>* ")"
  | ~"hsla(" <a data-link-type="dfn">wsp</a>* <a href="#integer">integer</a> <a href="#comma">comma</a> <a href="#integer">integer</a> <a href="#comma">comma</a> <a href="#integer">integer</a> <a href="#comma">comma</a> <a href="#integer">integer</a> <a data-link-type="dfn">wsp</a>* ")"
  | <a href="#color-keyword">color-keyword</a>
  
<span id="hexdigit">hexdigit</span> ::= 
  [0-9A-Fa-f]
  
<span id="number">number</span> ::= 
  <a href="#sign">sign</a>? <a href="#digit-sequence">digit-sequence</a>? "." <a href="#digit-sequence">digit-sequence</a>
  
<span id="sign">sign</span>::=
  "+" | "-"
  
<span id="integer">integer</span> ::=
  <a href="#digit-sequence">digit-sequence</a>
  
<span id="digit-sequence">digit-sequence</span> ::=
  [0-9]+
  
<span id="namestartchar">namestartchar</span> ::=
  ":" | [A-Z] | "_" | [a-z] | [#xC0-#xD6] | [#xD8-#xF6] | [
  #xF8-#x2FF] | [#x370-#x37D] | [#x37F-#x1FFF] | [#x200C-#x200D] |
  [#x2070-#x218F] | [#x2C00-#x2FEF] | [#x3001-#xD7FF] |
  [#xF900-#xFDCF] | [#xFDF0-#xFFFD] | [#x10000-#xEFFFF]
   
<span id="namechar">namechar</span> ::=
  <a href="#namestartchar">namestartchar</a> | "-" | "." | [0-9] | #xB7 | [#x0300-#x036F] |
  [#x203F-#x2040]
  
<span id="comma">comma</span> ::=
  ","
  
<span id="color-keyword">color-keyword</span> ::=
  ~"aliceblue" | ~"antiquewhite" | ~"aqua" | ~"aquamarine" | ~"azure" | ~"beige" | 
  ~"bisque" | ~"black" | ~"blanchedalmond" | ~"blue" | ~"blueviolet" | ~"brown" | 
  ~"burlywood" |~"cadetblue" | ~"chartreuse" | ~"chocolate" | ~"coral" | ~"cornflowerblue" |
  ~"cornsilk" | ~"crimson" | ~"cyan" | ~"darkblue" | ~"darkcyan" | ~"darkgoldenrod" | 
  ~"darkgray" | ~"darkgreen" | ~"darkgrey" | ~"darkkhaki" | ~"darkmagenta" | ~"darkolivegreen" | 
  ~"darkorange" | ~"darkorchid" | ~"darkred" | ~"darksalmon" | ~"darkseagreen" | ~"darkslateblue" | 
  ~"darkslategray" | ~"darkslategrey" | ~"darkturquoise" | ~"darkviolet" | ~"deeppink" | ~"deepskyblue" | 
  ~"dimgray" | ~"dimgrey" | ~"dodgerblue" | ~"firebrick" | ~"floralwhite" | ~"forestgreen" | 
  ~"fuchsia" | ~"gainsboro" | ~"ghostwhite" | ~"gold" | ~"goldenrod" | ~"gray" | 
  ~"grey" | ~"green" | ~"greenyellow" | ~"honeydew" | ~"hotpink" | ~"indianred" | 
  ~"indigo" | ~"ivory" | ~"khaki" | ~"lavender" | ~"lavenderblush" | ~"lawngreen" | 
  ~"lemonchiffon" | ~"lightblue" | ~"lightcoral" | ~"lightcyan" | ~"lightgoldenrodyellow" | ~"lightgray" | 
  ~"lightgreen" | ~"lightgrey" | ~"lightpink" | ~"lightsalmon" | ~"lightseagreen" | ~"lightskyblue" | 
  ~"lightslategray" | ~"lightslategrey" | ~"lightsteelblue" | ~"lightyellow" | ~"lime" | 
  ~"limegreen" | ~"linen" | ~"magenta" | ~"maroon" | ~"mediumaquamarine" | ~"mediumblue" | 
  ~"mediumorchid" | ~"mediumpurple" | ~"mediumseagreen" | ~"mediumslateblue" | ~"mediumspringgreen" |
  ~"mediumturquoise" | ~"mediumvioletred" | ~"midnightblue" | ~"mintcream" | ~"mistyrose" |
  ~"moccasin" | ~"navajowhite" | ~"navy" | ~"oldlace" | ~"olive" | ~"olivedrab" | ~"orange" | ~"orangered" | 
  ~"orchid" | ~"palegoldenrod" | ~"palegreen" | ~"paleturquoise" | ~"palevioletred" | ~"papayawhip" | 
  ~"peachpuff" | ~"peru" | ~"pink" | ~"plum" | ~"powderblue" | ~"purple" | 
  ~"red" | ~"rosybrown" | ~"royalblue" | ~"saddlebrown" | ~"salmon" | ~"sandybrown" | 
  ~"seagreen" | ~"seashell" | ~"sienna" | ~"silver" | ~"skyblue" | ~"slateblue" | 
  ~"slategray" | ~"slategrey" | ~"snow" | ~"springgreen" | ~"steelblue" | ~"tan" | 
  ~"teal" | ~"thistle" | ~"tomato" | ~"turquoise" | ~"violet" | ~"wheat" | 
  ~"white" | ~"whitesmoke" | ~"yellow" | ~"yellowgreen" 
</pre>
   </div>
  </main>
  <div data-fill-with="conformance">
   <h2 class="no-ref no-num heading settled" id="w3c-conformance"><span class="content">Conformance</span><a class="self-link" href="#w3c-conformance"></a></h2>
   <h3 class="no-ref no-num heading settled" id="w3c-conventions"><span class="content">Document conventions</span><a class="self-link" href="#w3c-conventions"></a></h3>
   <p>Conformance requirements are expressed
    with a combination of descriptive assertions
    and RFC 2119 terminology.
    The key words “MUST”, “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”, “RECOMMENDED”, “MAY”, and “OPTIONAL”
    in the normative parts of this document
    are to be interpreted as described in RFC 2119.
    However, for readability,
    these words do not appear in all uppercase letters in this specification. </p>
   <p>All of the text of this specification is normative
    except sections explicitly marked as non-normative, examples, and notes. <a data-link-type="biblio" href="#biblio-rfc2119" title="Key words for use in RFCs to Indicate Requirement Levels">[RFC2119]</a> </p>
   <p>Examples in this specification are introduced with the words “for example”
    or are set apart from the normative text
    with <code>class="example"</code>,
    like this: </p>
   <div class="example" id="w3c-example">
    <a class="self-link" href="#w3c-example"></a> 
    <p>This is an example of an informative example. </p>
   </div>
   <p>Informative notes begin with the word “Note”
    and are set apart from the normative text
    with <code>class="note"</code>,
    like this: </p>
   <p class="note" role="note">Note, this is an informative note.</p>
   <section>
    <h3 class="no-ref no-num heading settled" id="w3c-conformant-algorithms"><span class="content">Conformant Algorithms</span><a class="self-link" href="#w3c-conformant-algorithms"></a></h3>
    <p>Requirements phrased in the imperative as part of algorithms
    (such as "strip any leading space characters"
    or "return false and abort these steps")
    are to be interpreted with the meaning of the key word
    ("must", "should", "may", etc)
    used in introducing the algorithm. </p>
    <p>Conformance requirements phrased as algorithms or specific steps
    can be implemented in any manner,
    so long as the end result is equivalent.
    In particular, the algorithms defined in this specification
    are intended to be easy to understand
    and are not intended to be performant.
    Implementers are encouraged to optimize. </p>
   </section>
  </div>
  <script src="https://www.w3.org/scripts/TR/2021/fixup.js"></script>
  <h2 class="no-num no-ref heading settled" id="index"><span class="content">Index</span><a class="self-link" href="#index"></a></h2>
  <h3 class="no-num no-ref heading settled" id="index-defined-elsewhere"><span class="content">Terms defined by reference</span><a class="self-link" href="#index-defined-elsewhere"></a></h3>
  <ul class="index">
   <li>
    <a data-link-type="biblio">[CSS-COLOR-4]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="73ea1d43">color</span>
    </ul>
   <li>
    <a data-link-type="biblio">[CSS-VALUES-4]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="16310992">&lt;number></span>
     <li><span class="dfn-paneled" id="fa293cdd">&lt;url></span>
    </ul>
   <li>
    <a data-link-type="biblio">[CSS22]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="fe1e6dc9">&lt;identifier></span>
    </ul>
   <li>
    <a data-link-type="biblio">[FILL-STROKE-3]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="890a8358">fill</span>
     <li><span class="dfn-paneled" id="de9e224f">stroke</span>
    </ul>
   <li>
    <a data-link-type="biblio">[FILTER-EFFECTS-1]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="4aadd289">flood-color</span>
     <li><span class="dfn-paneled" id="294ef7d0">lighting-color</span>
    </ul>
   <li>
    <a data-link-type="biblio">[SVG2]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="691fe546">color-interpolation</span>
     <li><span class="dfn-paneled" id="37328630">stop-color</span>
     <li><span class="dfn-paneled" id="5711d4c1">url reference</span>
    </ul>
  </ul>
  <h2 class="no-num no-ref heading settled" id="references"><span class="content">References</span><a class="self-link" href="#references"></a></h2>
  <h3 class="no-num no-ref heading settled" id="normative"><span class="content">Normative References</span><a class="self-link" href="#normative"></a></h3>
  <dl>
   <dt id="biblio-css-color-4">[CSS-COLOR-4]
   <dd>Chris Lilley; Tab Atkins Jr.; Lea Verou. <a href="https://drafts.csswg.org/css-color-4/"><cite>CSS Color Module Level 4</cite></a>. URL: <a href="https://drafts.csswg.org/css-color-4/">https://drafts.csswg.org/css-color-4/</a>
   <dt id="biblio-css-values-4">[CSS-VALUES-4]
   <dd>Tab Atkins Jr.; Elika Etemad. <a href="https://drafts.csswg.org/css-values-4/"><cite>CSS Values and Units Module Level 4</cite></a>. URL: <a href="https://drafts.csswg.org/css-values-4/">https://drafts.csswg.org/css-values-4/</a>
   <dt id="biblio-css22">[CSS22]
   <dd>Bert Bos. <a href="https://drafts.csswg.org/css2/"><cite>Cascading Style Sheets Level 2 Revision 2 (CSS 2.2) Specification</cite></a>. URL: <a href="https://drafts.csswg.org/css2/">https://drafts.csswg.org/css2/</a>
   <dt id="biblio-fill-stroke-3">[FILL-STROKE-3]
   <dd>Elika Etemad; Tab Atkins Jr.. <a href="https://drafts.fxtf.org/fill-stroke/"><cite>CSS Fill and Stroke Module Level 3</cite></a>. URL: <a href="https://drafts.fxtf.org/fill-stroke/">https://drafts.fxtf.org/fill-stroke/</a>
   <dt id="biblio-filter-effects-1">[FILTER-EFFECTS-1]
   <dd>Dirk Schulze; Dean Jackson. <a href="https://drafts.fxtf.org/filter-effects-1/"><cite>Filter Effects Module Level 1</cite></a>. URL: <a href="https://drafts.fxtf.org/filter-effects-1/">https://drafts.fxtf.org/filter-effects-1/</a>
   <dt id="biblio-rfc2119">[RFC2119]
   <dd>S. Bradner. <a href="https://datatracker.ietf.org/doc/html/rfc2119"><cite>Key words for use in RFCs to Indicate Requirement Levels</cite></a>. March 1997. Best Current Practice. URL: <a href="https://datatracker.ietf.org/doc/html/rfc2119">https://datatracker.ietf.org/doc/html/rfc2119</a>
   <dt id="biblio-svg2">[SVG2]
   <dd>Amelia Bellamy-Royds; et al. <a href="https://svgwg.org/svg2-draft/"><cite>Scalable Vector Graphics (SVG) 2</cite></a>. URL: <a href="https://svgwg.org/svg2-draft/">https://svgwg.org/svg2-draft/</a>
  </dl>
  <h2 class="no-num no-ref heading settled" id="issues-index"><span class="content">Issues Index</span><a class="self-link" href="#issues-index"></a></h2>
  <div style="counter-reset:issue">
   <div class="issue">Define processing for untagged greyscale and CMYK images. Could be a default profile, or an 'explicitly undefined' with a warning to avoid untagged non-RGB images when authoring. <a class="issue-return" href="#issue-c7810739" title="Jump to section">↵</a></div>
   <div class="issue">References to "SVG 2 User Agent" might need to be replaced
    with one of the conformance classes listed in the <a href="conform.html">Conformance</a> appendix. <a class="issue-return" href="#issue-cb9985c4" title="Jump to section">↵</a></div>
   <div class="issue"> Define 'permitted fallback situation' and link to it. <a class="issue-return" href="#issue-6389d0d5" title="Jump to section">↵</a></div>
   <div class="issue">This grammar doesn’t match the grammar <a href="#icccolor">below</a>.  Also the ones below should
    be translated from EBNF to CSS Value syntax. <a class="issue-return" href="#issue-457cb5a6" title="Jump to section">↵</a></div>
   <div class="issue">This might need to be an &lt;ident> rather than a &lt;string>. <a class="issue-return" href="#issue-67b7154a" title="Jump to section">↵</a></div>
   <div class="issue">Fallback behaviour needs to be specified, for when the
requested rendering intent does not have a corresponding table in the profile;
or when all rendering-intents are provided using the same table. <a class="issue-return" href="#issue-4512ce83" title="Jump to section">↵</a></div>
  </div>
<script>/* Boilerplate: script-dom-helper */
"use strict";
function query(sel) { return document.querySelector(sel); }

function queryAll(sel) { return [...document.querySelectorAll(sel)]; }

function iter(obj) {
	if(!obj) return [];
	var it = obj[Symbol.iterator];
	if(it) return it;
	return Object.entries(obj);
}

function mk(tagname, attrs, ...children) {
	const el = document.createElement(tagname);
	for(const [k,v] of iter(attrs)) {
		if(k.slice(0,3) == "_on") {
			const eventName = k.slice(3);
			el.addEventListener(eventName, v);
		} else if(k[0] == "_") {
			// property, not attribute
			el[k.slice(1)] = v;
		} else {
			if(v === false || v == null) {
        continue;
      } else if(v === true) {
        el.setAttribute(k, "");
        continue;
      } else {
  			el.setAttribute(k, v);
      }
		}
	}
	append(el, children);
	return el;
}

/* Create shortcuts for every known HTML element */
[
  "a",
  "abbr",
  "acronym",
  "address",
  "applet",
  "area",
  "article",
  "aside",
  "audio",
  "b",
  "base",
  "basefont",
  "bdo",
  "big",
  "blockquote",
  "body",
  "br",
  "button",
  "canvas",
  "caption",
  "center",
  "cite",
  "code",
  "col",
  "colgroup",
  "datalist",
  "dd",
  "del",
  "details",
  "dfn",
  "dialog",
  "div",
  "dl",
  "dt",
  "em",
  "embed",
  "fieldset",
  "figcaption",
  "figure",
  "font",
  "footer",
  "form",
  "frame",
  "frameset",
  "head",
  "header",
  "h1",
  "h2",
  "h3",
  "h4",
  "h5",
  "h6",
  "hr",
  "html",
  "i",
  "iframe",
  "img",
  "input",
  "ins",
  "kbd",
  "label",
  "legend",
  "li",
  "link",
  "main",
  "map",
  "mark",
  "meta",
  "meter",
  "nav",
  "nobr",
  "noscript",
  "object",
  "ol",
  "optgroup",
  "option",
  "output",
  "p",
  "param",
  "pre",
  "progress",
  "q",
  "s",
  "samp",
  "script",
  "section",
  "select",
  "small",
  "source",
  "span",
  "strike",
  "strong",
  "style",
  "sub",
  "summary",
  "sup",
  "table",
  "tbody",
  "td",
  "template",
  "textarea",
  "tfoot",
  "th",
  "thead",
  "time",
  "title",
  "tr",
  "u",
  "ul",
  "var",
  "video",
  "wbr",
  "xmp",
].forEach(tagname=>{
	mk[tagname] = (...args) => mk(tagname, ...args);
});

function* nodesFromChildList(children) {
	for(const child of children.flat(Infinity)) {
		if(child instanceof Node) {
			yield child;
		} else {
			yield new Text(child);
		}
	}
}
function append(el, ...children) {
	for(const child of nodesFromChildList(children)) {
		if(el instanceof Node) el.appendChild(child);
		else el.push(child);
	}
	return el;
}

function insertAfter(el, ...children) {
	for(const child of nodesFromChildList(children)) {
		el.parentNode.insertBefore(child, el.nextSibling);
	}
	return el;
}

function clearContents(el) {
	el.innerHTML = "";
	return el;
}

function parseHTML(markup) {
	if(markup.toLowerCase().trim().indexOf('<!doctype') === 0) {
		const doc = document.implementation.createHTMLDocument("");
		doc.documentElement.innerHTML = markup;
		return doc;
	} else {
		const el = mk.template({});
		el.innerHTML = markup;
		return el.content;
	}
}</script>
<script>/* Boilerplate: script-dfn-panel */
"use strict";
{
let dfnPanelData = {
"16310992": {"dfnID":"16310992","dfnText":"<number>","external":true,"refSections":[{"refs":[{"id":"ref-for-number-value"}],"title":"3.3. \n      ICC colors"},{"refs":[{"id":"ref-for-number-value\u2460"}],"title":"3.4. LAB color"}],"url":"https://drafts.csswg.org/css-values-4/#number-value"},
"294ef7d0": {"dfnID":"294ef7d0","dfnText":"lighting-color","external":true,"refSections":[{"refs":[{"id":"ref-for-propdef-lighting-color"}],"title":"5. The effect of the color property"},{"refs":[{"id":"ref-for-propdef-lighting-color\u2460"}],"title":"6.2. The CSS @color-profile rule"}],"url":"https://drafts.fxtf.org/filter-effects-1/#propdef-lighting-color"},
"37328630": {"dfnID":"37328630","dfnText":"stop-color","external":true,"refSections":[{"refs":[{"id":"ref-for-StopColorProperty"}],"title":"5. The effect of the color property"},{"refs":[{"id":"ref-for-StopColorProperty\u2460"}],"title":"6.2. The CSS @color-profile rule"}],"url":"https://svgwg.org/svg2-draft/pservers.html#StopColorProperty"},
"4aadd289": {"dfnID":"4aadd289","dfnText":"flood-color","external":true,"refSections":[{"refs":[{"id":"ref-for-propdef-flood-color"}],"title":"5. The effect of the color property"},{"refs":[{"id":"ref-for-propdef-flood-color\u2460"}],"title":"6.2. The CSS @color-profile rule"}],"url":"https://drafts.fxtf.org/filter-effects-1/#propdef-flood-color"},
"5711d4c1": {"dfnID":"5711d4c1","dfnText":"url reference","external":true,"refSections":[{"refs":[{"id":"ref-for-TermURLReference"}],"title":"6.2. The CSS @color-profile rule"}],"url":"https://svgwg.org/svg2-draft/linking.html#TermURLReference"},
"691fe546": {"dfnID":"691fe546","dfnText":"color-interpolation","external":true,"refSections":[{"refs":[{"id":"ref-for-ColorInterpolationProperty"}],"title":"1. Introduction"}],"url":"https://svgwg.org/svg2-draft/painting.html#ColorInterpolationProperty"},
"73ea1d43": {"dfnID":"73ea1d43","dfnText":"color","external":true,"refSections":[{"refs":[{"id":"ref-for-propdef-color"},{"id":"ref-for-propdef-color\u2460"},{"id":"ref-for-propdef-color\u2461"},{"id":"ref-for-propdef-color\u2462"},{"id":"ref-for-propdef-color\u2463"}],"title":"5. The effect of the color property"}],"url":"https://drafts.csswg.org/css-color-4/#propdef-color"},
"890a8358": {"dfnID":"890a8358","dfnText":"fill","external":true,"refSections":[{"refs":[{"id":"ref-for-propdef-fill"}],"title":"5. The effect of the color property"},{"refs":[{"id":"ref-for-propdef-fill\u2460"}],"title":"6.2. The CSS @color-profile rule"}],"url":"https://drafts.fxtf.org/fill-stroke-3/#propdef-fill"},
"de9e224f": {"dfnID":"de9e224f","dfnText":"stroke","external":true,"refSections":[{"refs":[{"id":"ref-for-propdef-stroke"}],"title":"5. The effect of the color property"},{"refs":[{"id":"ref-for-propdef-stroke\u2460"}],"title":"6.2. The CSS @color-profile rule"}],"url":"https://drafts.fxtf.org/fill-stroke-3/#propdef-stroke"},
"fa293cdd": {"dfnID":"fa293cdd","dfnText":"<url>","external":true,"refSections":[{"refs":[{"id":"ref-for-url-value"},{"id":"ref-for-url-value\u2460"},{"id":"ref-for-url-value\u2461"},{"id":"ref-for-url-value\u2462"},{"id":"ref-for-url-value\u2463"}],"title":"6.2. The CSS @color-profile rule"}],"url":"https://drafts.csswg.org/css-values-4/#url-value"},
"fe1e6dc9": {"dfnID":"fe1e6dc9","dfnText":"<identifier>","external":true,"refSections":[{"refs":[{"id":"ref-for-value-def-identifier"},{"id":"ref-for-value-def-identifier\u2460"}],"title":"6.2. The CSS @color-profile rule"}],"url":"https://drafts.csswg.org/css2/#value-def-identifier"},
};

document.addEventListener("DOMContentLoaded", ()=>{
    genAllDfnPanels();

    document.body.addEventListener("click", (e) => {
        // If not handled already, just hide all dfn panels.
        hideAllDfnPanels();
    });
});

window.addEventListener("resize", () => {
    // Pin any visible dfn panel
    queryAll(".dfn-panel.on, .dfn-panel.activated").forEach(el=>positionDfnPanel(el));
});

function genAllDfnPanels() {
    for(const panelData of Object.values(dfnPanelData)) {
        const dfnID = panelData.dfnID;
        const dfn = document.getElementById(dfnID);
        if(!dfn) {
            console.log(`Can't find dfn#${dfnID}.`, panelData);
            continue;
        }
        dfn.panelData = panelData;
        insertDfnPopupAction(dfn);
    }
}

function genDfnPanel(dfn, { dfnID, url, dfnText, refSections, external }) {
    const dfnPanel = mk.aside({
        class: "dfn-panel on",
        id: `infopanel-for-${dfnID}`,
        "data-for": dfnID,
        "aria-labelled-by":`infopaneltitle-for-${dfnID}`,
        },
        mk.span({id:`infopaneltitle-for-${dfnID}`, style:"display:none"},
            `Info about the '${dfnText}' ${external?"external":""} reference.`),
        mk.a({href:url, class:"dfn-link"}, url),
        refSections.length == 0 ? [] :
            mk.b({}, "Referenced in:"),
            mk.ul({},
                ...refSections.map(section=>
                    mk.li({},
                        ...section.refs.map((ref, refI)=>
                            [
                                mk.a({ href: `#${ref.id}` },
                                    (refI == 0) ? section.title : `(${refI + 1})`
                                ),
                                " ",
                            ]
                        ),
                    ),
                ),
            ),
        genLinkingSyntaxes(dfn),
    );

    dfnPanel.addEventListener('click', (event) => {
        if (event.target.nodeName == 'A') {
            scrollToTargetAndHighlight(event);
            pinDfnPanel(dfnPanel);
        }
        event.stopPropagation();
        refocusOnTarget(event);
    });
    dfnPanel.addEventListener('keydown', (event) => {
        if(event.keyCode == 27) { // Escape key
            hideDfnPanel({dfnPanel});
            event.stopPropagation();
            event.preventDefault();
        }
    });

    dfnPanel.dfn = dfn;
    dfn.dfnPanel = dfnPanel;
    return dfnPanel;
}



function hideAllDfnPanels() {
    // Delete the currently-active dfn panel.
    queryAll(".dfn-panel").forEach(dfnPanel=>hideDfnPanel({dfnPanel}));
}

function showDfnPanel(dfn) {
    hideAllDfnPanels(); // Only display one at a time.

    dfn.setAttribute("aria-expanded", "true");

    const dfnPanel = genDfnPanel(dfn, dfn.panelData);

    // Give the dfn a unique tabindex, and then
    // give all the tabbable panel bits successive indexes.
    let tabIndex = 100;
    dfn.tabIndex = tabIndex++;
    const tabbable = dfnPanel.querySelectorAll(":is(a, button)");
    for (const el of tabbable) {
        el.tabIndex = tabIndex++;
    }

    append(document.body, dfnPanel);
    positionDfnPanel(dfnPanel);
}

function positionDfnPanel(dfnPanel) {
    const dfn = dfnPanel.dfn;
    const dfnPos = getBounds(dfn);
    dfnPanel.style.top = dfnPos.bottom + "px";
    dfnPanel.style.left = dfnPos.left + "px";

    const panelPos = dfnPanel.getBoundingClientRect();
    const panelMargin = 8;
    const maxRight = document.body.parentNode.clientWidth - panelMargin;
    if (panelPos.right > maxRight) {
        const overflowAmount = panelPos.right - maxRight;
        const newLeft = Math.max(panelMargin, dfnPos.left - overflowAmount);
        dfnPanel.style.left = newLeft + "px";
    }
}

function pinDfnPanel(dfnPanel) {
    // Switch it to "activated" state, which pins it.
    dfnPanel.classList.add("activated");
    dfnPanel.style.position = "fixed";
    dfnPanel.style.left = null;
    dfnPanel.style.top = null;
}

function hideDfnPanel({dfn, dfnPanel}) {
    if(!dfnPanel) dfnPanel = dfn.dfnPanel;
    if(!dfn) dfn = dfnPanel.dfn;
    dfn.dfnPanel = undefined;
    dfnPanel.dfn = undefined;
    dfn.setAttribute("aria-expanded", "false");
    dfn.tabIndex = undefined;
    dfnPanel.remove()
}

function toggleDfnPanel(dfn) {
    if(dfn.dfnPanel) {
        hideDfnPanel(dfn);
    } else {
        showDfnPanel(dfn);
    }
}

function insertDfnPopupAction(dfn) {
    dfn.setAttribute('role', 'button');
    dfn.setAttribute('aria-expanded', 'false')
    dfn.tabIndex = 0;
    dfn.classList.add('has-dfn-panel');
    dfn.addEventListener('click', (event) => {
        toggleDfnPanel(dfn);
        event.stopPropagation();
    });
    dfn.addEventListener('keypress', (event) => {
        const kc = event.keyCode;
        // 32->Space, 13->Enter
        if(kc == 32 || kc == 13) {
            toggleDfnPanel(dfn);
            event.stopPropagation();
            event.preventDefault();
        }
    });
}

function refocusOnTarget(event) {
    const target = event.target;
    setTimeout(() => {
        // Refocus on the event.target element.
        // This is needed after browser scrolls to the destination.
        target.focus();
    });
}

// TODO: shared util
// Returns the root-level absolute position {left and top} of element.
function getBounds(el, relativeTo=document.body) {
    const relativeRect = relativeTo.getBoundingClientRect();
    const elRect = el.getBoundingClientRect();
    const top = elRect.top - relativeRect.top;
    const left = elRect.left - relativeRect.left;
    return {
        top,
        left,
        bottom: top + elRect.height,
        right: left + elRect.width,
    }
}

function scrollToTargetAndHighlight(event) {
    let hash = event.target.hash;
    if (hash) {
        hash = decodeURIComponent(hash.substring(1));
        const dest = document.getElementById(hash);
        if (dest) {
            dest.classList.add('highlighted');
            setTimeout(() => dest.classList.remove('highlighted'), 1000);
        }
    }
}

// Functions, divided by link type, that wrap an autolink's
// contents with the appropriate outer syntax.
// Alternately, a string naming another type they format
// the same as.
function needsFor(type) {
    switch(type) {
        case "descriptor":
        case "value":
        case "element-attr":
        case "attr-value":
        case "element-state":
        case "method":
        case "constructor":
        case "argument":
        case "attribute":
        case "const":
        case "dict-member":
        case "event":
        case "enum-value":
        case "stringifier":
        case "serializer":
        case "iterator":
        case "maplike":
        case "setlike":
        case "state":
        case "mode":
        case "context":
        case "facet": return true;

        default: return false;
    }
}
function refusesFor(type) {
    switch(type) {
        case "property":
        case "element":
        case "interface":
        case "namespace":
        case "callback":
        case "dictionary":
        case "enum":
        case "exception":
        case "typedef":
        case "http-header":
        case "permission": return true;

        default: return false;
    }
}
function linkFormatterFromType(type) {
    switch(type) {
        case 'scheme':
        case 'permission':
        case 'dfn': return (text) => `[=${text}=]`;

        case 'abstract-op': return (text) => `[\$${text}\$]`;

        case 'function':
        case 'at-rule':
        case 'selector':
        case 'value': return (text) => `''${text}''`;

        case 'http-header': return (text) => `[:${text}:]`;

        case 'interface':
        case 'constructor':
        case 'method':
        case 'argument':
        case 'attribute':
        case 'callback':
        case 'dictionary':
        case 'dict-member':
        case 'enum':
        case 'enum-value':
        case 'exception':
        case 'const':
        case 'typedef':
        case 'stringifier':
        case 'serializer':
        case 'iterator':
        case 'maplike':
        case 'setlike':
        case 'extended-attribute':
        case 'event':
        case 'idl': return (text) => `{{${text}}}`;

        case 'element-state':
        case 'element-attr':
        case 'attr-value':
        case 'element': return (element) => `<{${element}}>`;

        case 'grammar': return (text) => `${text} (within a <pre class=prod>)`;

        case 'type': return (text)=> `<<${text}>>`;

        case 'descriptor':
        case 'property': return (text) => `'${text}'`;

        default: return;
    };
};

function genLinkingSyntaxes(dfn) {
    if(dfn.tagName != "DFN") return;

    const type = dfn.getAttribute('data-dfn-type');
    if(!type) {
        console.log(`<dfn> doesn't have a data-dfn-type:`, dfn);
        return [];
    }

    // Return a function that wraps link text based on the type
    const linkFormatter = linkFormatterFromType(type);
    if(!linkFormatter) {
        console.log(`<dfn> has an unknown data-dfn-type:`, dfn);
        return [];
    }

    let ltAlts;
    if(dfn.hasAttribute('data-lt')) {
        ltAlts = dfn.getAttribute('data-lt')
            .split("|")
            .map(x=>x.trim());
    } else {
        ltAlts = [dfn.textContent.trim()];
    }
    if(type == "type") {
        // lt of "<foo>", but "foo" is the interior;
        // <<foo/bar>> is how you write it with a for,
        // not <foo/<bar>> or whatever.
        for(var i = 0; i < ltAlts.length; i++) {
            const lt = ltAlts[i];
            const match = /<(.*)>/.exec(lt);
            if(match) { ltAlts[i] = match[1]; }
        }
    }

    let forAlts;
    if(dfn.hasAttribute('data-dfn-for')) {
        forAlts = dfn.getAttribute('data-dfn-for')
            .split(",")
            .map(x=>x.trim());
    } else {
        forAlts = [''];
    }

    let linkingSyntaxes = [];
    if(!needsFor(type)) {
        for(const lt of ltAlts) {
            linkingSyntaxes.push(linkFormatter(lt));
        }
    }
    if(!refusesFor(type)) {
        for(const f of forAlts) {
            linkingSyntaxes.push(linkFormatter(`${f}/${ltAlts[0]}`))
        }
    }
    return [
        mk.b({}, 'Possible linking syntaxes:'),
        mk.ul({},
            ...linkingSyntaxes.map(link => {
                const copyLink = async () =>
                    await navigator.clipboard.writeText(link);
                return mk.li({},
                    mk.div({ class: 'link-item' },
                        mk.button({
                            class: 'copy-icon', title: 'Copy',
                            type: 'button',
                            _onclick: copyLink,
                            tabindex: 0,
                        }, mk.span({ class: 'icon' }) ),
                        mk.span({}, link)
                    )
                );
            })
        )
    ];
}
}
</script>
<script>/* Boilerplate: script-link-titles */
"use strict";
{
let linkTitleData = {
"https://drafts.csswg.org/css-values-4/#url-value": "Expands to: local url flag",
};

function setTypeTitles() {
	for(let el of document.querySelectorAll("a[href]")) {
		if(el.href in linkTitleData && !el.hasAttribute("title")) {
			el.setAttribute("title", linkTitleData[el.href]);
		}
	}
}

document.addEventListener("DOMContentLoaded", setTypeTitles);
}
</script>
<script>/* Boilerplate: script-ref-hints */
"use strict";
{
let refsData = {
"https://drafts.csswg.org/css-color-4/#propdef-color": {"export":true,"for_":[],"level":"4","normative":true,"shortname":"css-color","spec":"css-color-4","status":"current","text":"color","type":"property","url":"https://drafts.csswg.org/css-color-4/#propdef-color"},
"https://drafts.csswg.org/css-values-4/#number-value": {"export":true,"for_":[],"level":"4","normative":true,"shortname":"css-values","spec":"css-values-4","status":"current","text":"<number>","type":"type","url":"https://drafts.csswg.org/css-values-4/#number-value"},
"https://drafts.csswg.org/css-values-4/#url-value": {"export":true,"for_":[],"level":"4","normative":true,"shortname":"css-values","spec":"css-values-4","status":"current","text":"<url>","type":"type","url":"https://drafts.csswg.org/css-values-4/#url-value"},
"https://drafts.csswg.org/css2/#value-def-identifier": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"css","spec":"css22","status":"current","text":"<identifier>","type":"type","url":"https://drafts.csswg.org/css2/#value-def-identifier"},
"https://drafts.fxtf.org/fill-stroke-3/#propdef-fill": {"export":true,"for_":[],"level":"3","normative":true,"shortname":"fill-stroke","spec":"fill-stroke-3","status":"current","text":"fill","type":"property","url":"https://drafts.fxtf.org/fill-stroke-3/#propdef-fill"},
"https://drafts.fxtf.org/fill-stroke-3/#propdef-stroke": {"export":true,"for_":[],"level":"3","normative":true,"shortname":"fill-stroke","spec":"fill-stroke-3","status":"current","text":"stroke","type":"property","url":"https://drafts.fxtf.org/fill-stroke-3/#propdef-stroke"},
"https://drafts.fxtf.org/filter-effects-1/#propdef-flood-color": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"filter-effects","spec":"filter-effects-1","status":"current","text":"flood-color","type":"property","url":"https://drafts.fxtf.org/filter-effects-1/#propdef-flood-color"},
"https://drafts.fxtf.org/filter-effects-1/#propdef-lighting-color": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"filter-effects","spec":"filter-effects-1","status":"current","text":"lighting-color","type":"property","url":"https://drafts.fxtf.org/filter-effects-1/#propdef-lighting-color"},
"https://svgwg.org/svg2-draft/linking.html#TermURLReference": {"export":true,"for_":[],"level":"2","normative":true,"shortname":"svg","spec":"svg2","status":"current","text":"url reference","type":"dfn","url":"https://svgwg.org/svg2-draft/linking.html#TermURLReference"},
"https://svgwg.org/svg2-draft/painting.html#ColorInterpolationProperty": {"export":true,"for_":[],"level":"2","normative":true,"shortname":"svg","spec":"svg2","status":"current","text":"color-interpolation","type":"property","url":"https://svgwg.org/svg2-draft/painting.html#ColorInterpolationProperty"},
"https://svgwg.org/svg2-draft/pservers.html#StopColorProperty": {"export":true,"for_":["stop"],"level":"2","normative":true,"shortname":"svg","spec":"svg2","status":"current","text":"stop-color","type":"property","url":"https://svgwg.org/svg2-draft/pservers.html#StopColorProperty"},
};

function mkRefHint(link, ref) {
    const linkText = link.textContent;
    let dfnTextElements = '';
    if (ref.text != linkText) {
        dfnTextElements =
            mk.li({},
                mk.b({}, "Term: "),
                mk.span({}, ref.text)
            );
    }
    const forList = ref.for_;
    let forListElements;
    if(forList.length == 0) {
        forListElements = [];
    } else if(forList.length == 1) {
        forListElements = mk.li({},
            mk.b({}, "For: "),
            mk.span({}, forList[0]),
        );
    } else {
        forListElements = mk.li({},
            mk.b({}, "For: "),
            mk.ul({},
                ...forList.map(forItem =>
                    mk.li({},
                        mk.span({}, forItem)
                    ),
                ),
            ),
        );
    }
    const url = ref.url;
    const safeUrl = encodeURIComponent(url);
    const hintPanel = mk.aside({
        class: "ref-hint",
        id: `ref-hint-for-${safeUrl}`,
        "data-for": url,
        "aria-labelled-by": `ref-hint-for-${safeUrl}`,
    },
        mk.ul({},
            dfnTextElements,
            mk.li({},
                mk.b({}, "URL: "),
                mk.a({ href: url, class: "ref" }, url),
            ),
            mk.li({},
                mk.b({}, "Type: "),
                mk.span({}, `${ref.type}`),
            ),
            mk.li({},
                mk.b({}, "Spec: "),
                mk.span({}, `${ref.spec ? ref.spec : ''}`),
            ),
            forListElements
        ),
    );
    hintPanel.forLink = link;
    setupRefHintEventListeners(link, hintPanel);
    return hintPanel;
}

function hideAllRefHints() {
    queryAll(".ref-hint").forEach(el=>hideRefHint(el));
}

function hideRefHint(refHint) {
    const link = refHint.forLink;
    link.setAttribute("aria-expanded", "false");
    if(refHint.teardownEventListeners) {
        refHint.teardownEventListeners();
    }
    refHint.remove();
}

function showRefHint(link) {
    if(link.classList.contains("dfn-link")) return;
    const url = link.getAttribute("href");
    const ref = refsData[url];
    if(!ref) return;

    hideAllRefHints(); // Only display one at this time.

    const refHint = mkRefHint(link, ref);
    append(document.body, refHint);
    link.setAttribute("aria-expanded", "true");
    positionRefHint(refHint);
}

function setupRefHintEventListeners(link, refHint) {
    if (refHint.teardownEventListeners) return;
    // Add event handlers to hide the refHint after the user moves away
    // from both the link and refHint, if not hovering either within one second.
    let timeout = null;
    const startHidingRefHint = (event) => {
        if (timeout) {
            clearTimeout(timeout);
        }
        timeout = setTimeout(() => {
            hideRefHint(refHint);
        }, 1000);
    }
    const resetHidingRefHint = (event) => {
        if (timeout) clearTimeout(timeout);
        timeout = null;
    };
    link.addEventListener("mouseleave", startHidingRefHint);
    link.addEventListener("mouseenter", resetHidingRefHint);
    link.addEventListener("blur", startHidingRefHint);
    link.addEventListener("focus", resetHidingRefHint);
    refHint.addEventListener("mouseleave", startHidingRefHint);
    refHint.addEventListener("mouseenter", resetHidingRefHint);
    refHint.addEventListener("blur", startHidingRefHint);
    refHint.addEventListener("focus", resetHidingRefHint);

    refHint.teardownEventListeners = () => {
        // remove event listeners
        resetHidingRefHint();
        link.removeEventListener("mouseleave", startHidingRefHint);
        link.removeEventListener("mouseenter", resetHidingRefHint);
        link.removeEventListener("blur", startHidingRefHint);
        link.removeEventListener("focus", resetHidingRefHint);
        refHint.removeEventListener("mouseleave", startHidingRefHint);
        refHint.removeEventListener("mouseenter", resetHidingRefHint);
        refHint.removeEventListener("blur", startHidingRefHint);
        refHint.removeEventListener("focus", resetHidingRefHint);
    };
}

function positionRefHint(refHint) {
    const link = refHint.forLink;
    const linkPos = getBounds(link);
    refHint.style.top = linkPos.bottom + "px";
    refHint.style.left = linkPos.left + "px";

    const panelPos = refHint.getBoundingClientRect();
    const panelMargin = 8;
    const maxRight = document.body.parentNode.clientWidth - panelMargin;
    if (panelPos.right > maxRight) {
        const overflowAmount = panelPos.right - maxRight;
        const newLeft = Math.max(panelMargin, linkPos.left - overflowAmount);
        refHint.style.left = newLeft + "px";
    }
}

// TODO: shared util
// Returns the root-level absolute position {left and top} of element.
function getBounds(el, relativeTo=document.body) {
    const relativeRect = relativeTo.getBoundingClientRect();
    const elRect = el.getBoundingClientRect();
    const top = elRect.top - relativeRect.top;
    const left = elRect.left - relativeRect.left;
    return {
        top,
        left,
        bottom: top + elRect.height,
        right: left + elRect.width,
    }
}

function showRefHintListener(e) {
    // If the target isn't in a link (or is a link),
    // just ignore it.
    let link = e.target.closest("a");
    if(!link) return;

    // If the target is in a ref-hint panel
    // (aka a link in the already-open one),
    // also just ignore it.
    if(link.closest(".ref-hint")) return;

    // Otherwise, show the panel for the link.
    showRefHint(link);
}

function hideAllHintsListener(e) {
    // If the click is inside a ref-hint panel, ignore it.
    if(e.target.closest(".ref-hint")) return;
    // Otherwise, close all the current panels.
    hideAllRefHints();
}

document.addEventListener("DOMContentLoaded", () => {
    document.body.addEventListener("mousedown", showRefHintListener);
    document.body.addEventListener("focus", showRefHintListener);

    document.body.addEventListener("click", hideAllHintsListener);
});

window.addEventListener("resize", () => {
    // Hide any open ref hint.
    hideAllRefHints();
});
}
</script>