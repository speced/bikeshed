<!doctype html><html lang="en">
 <head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
  <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
  <title>Motion Sensors Explainer</title>
  <meta content="ED" name="w3c-status">
  <link href="https://www.w3.org/StyleSheets/TR/2021/W3C-ED" rel="stylesheet">
  <link href="https://www.w3.org/TR/motion-sensors/" rel="canonical">
  <meta content="dark light" name="color-scheme">
  <link href="https://www.w3.org/StyleSheets/TR/2021/dark.css" media="(prefers-color-scheme: dark)" rel="stylesheet" type="text/css">
<style>
table {
  border-collapse: collapse;
  border-spacing: 0px;
}
table, th, td {
  padding: 5px;
  border: 1px solid black;
}
</style>
<style>/* Boilerplate: style-autolinks */
.css.css, .property.property, .descriptor.descriptor {
    color: var(--a-normal-text);
    font-size: inherit;
    font-family: inherit;
}
.css::before, .property::before, .descriptor::before {
    content: "‘";
}
.css::after, .property::after, .descriptor::after {
    content: "’";
}
.property, .descriptor {
    /* Don't wrap property and descriptor names */
    white-space: nowrap;
}
.type { /* CSS value <type> */
    font-style: italic;
}
pre .property::before, pre .property::after {
    content: "";
}
[data-link-type="property"]::before,
[data-link-type="propdesc"]::before,
[data-link-type="descriptor"]::before,
[data-link-type="value"]::before,
[data-link-type="function"]::before,
[data-link-type="at-rule"]::before,
[data-link-type="selector"]::before,
[data-link-type="maybe"]::before {
    content: "‘";
}
[data-link-type="property"]::after,
[data-link-type="propdesc"]::after,
[data-link-type="descriptor"]::after,
[data-link-type="value"]::after,
[data-link-type="function"]::after,
[data-link-type="at-rule"]::after,
[data-link-type="selector"]::after,
[data-link-type="maybe"]::after {
    content: "’";
}

[data-link-type].production::before,
[data-link-type].production::after,
.prod [data-link-type]::before,
.prod [data-link-type]::after {
    content: "";
}

[data-link-type=element],
[data-link-type=element-attr] {
    font-family: Menlo, Consolas, "DejaVu Sans Mono", monospace;
    font-size: .9em;
}
[data-link-type=element]::before { content: "<" }
[data-link-type=element]::after  { content: ">" }

[data-link-type=biblio] {
    white-space: pre;
}

@media (prefers-color-scheme: dark) {
    :root {
        --selflink-text: black;
        --selflink-bg: silver;
        --selflink-hover-text: white;
    }
}
</style>
<style>/* Boilerplate: style-colors */
/* Any --*-text not paired with a --*-bg is assumed to have a transparent bg */
:root {
    color-scheme: light dark;

    --text: black;
    --bg: white;

    --unofficial-watermark: url(https://www.w3.org/StyleSheets/TR/2016/logos/UD-watermark);

    --logo-bg: #1a5e9a;
    --logo-active-bg: #c00;
    --logo-text: white;

    --tocnav-normal-text: #707070;
    --tocnav-normal-bg: var(--bg);
    --tocnav-hover-text: var(--tocnav-normal-text);
    --tocnav-hover-bg: #f8f8f8;
    --tocnav-active-text: #c00;
    --tocnav-active-bg: var(--tocnav-normal-bg);

    --tocsidebar-text: var(--text);
    --tocsidebar-bg: #f7f8f9;
    --tocsidebar-shadow: rgba(0,0,0,.1);
    --tocsidebar-heading-text: hsla(203,20%,40%,.7);

    --toclink-text: var(--text);
    --toclink-underline: #3980b5;
    --toclink-visited-text: var(--toclink-text);
    --toclink-visited-underline: #054572;

    --heading-text: #005a9c;

    --hr-text: var(--text);

    --algo-border: #def;

    --del-text: red;
    --del-bg: transparent;
    --ins-text: #080;
    --ins-bg: transparent;

    --a-normal-text: #034575;
    --a-normal-underline: #bbb;
    --a-visited-text: var(--a-normal-text);
    --a-visited-underline: #707070;
    --a-hover-bg: rgba(75%, 75%, 75%, .25);
    --a-active-text: #c00;
    --a-active-underline: #c00;

    --blockquote-border: silver;
    --blockquote-bg: transparent;
    --blockquote-text: currentcolor;

    --issue-border: #e05252;
    --issue-bg: #fbe9e9;
    --issue-text: var(--text);
    --issueheading-text: #831616;

    --example-border: #e0cb52;
    --example-bg: #fcfaee;
    --example-text: var(--text);
    --exampleheading-text: #574b0f;

    --note-border: #52e052;
    --note-bg: #e9fbe9;
    --note-text: var(--text);
    --noteheading-text: hsl(120, 70%, 30%);
    --notesummary-underline: silver;

    --assertion-border: #aaa;
    --assertion-bg: #eee;
    --assertion-text: black;

    --advisement-border: orange;
    --advisement-bg: #fec;
    --advisement-text: var(--text);
    --advisementheading-text: #b35f00;

    --warning-border: red;
    --warning-bg: hsla(40,100%,50%,0.95);
    --warning-text: var(--text);

    --amendment-border: #330099;
    --amendment-bg: #F5F0FF;
    --amendment-text: var(--text);
    --amendmentheading-text: #220066;

    --def-border: #8ccbf2;
    --def-bg: #def;
    --def-text: var(--text);
    --defrow-border: #bbd7e9;

    --datacell-border: silver;

    --indexinfo-text: #707070;

    --indextable-hover-text: black;
    --indextable-hover-bg: #f7f8f9;

    --outdatedspec-bg: rgba(0, 0, 0, .5);
    --outdatedspec-text: black;
    --outdated-bg: maroon;
    --outdated-text: white;
    --outdated-shadow: red;

    --editedrec-bg: darkorange;
}

@media (prefers-color-scheme: dark) {
    :root {
        --text: #ddd;
        --bg: black;

        --unofficial-watermark: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='400'%3E%3Cg fill='%23100808' transform='translate(200 200) rotate(-45) translate(-200 -200)' stroke='%23100808' stroke-width='3'%3E%3Ctext x='50%25' y='220' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EUNOFFICIAL%3C/text%3E%3Ctext x='50%25' y='305' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EDRAFT%3C/text%3E%3C/g%3E%3C/svg%3E");

        --logo-bg: #1a5e9a;
        --logo-active-bg: #c00;
        --logo-text: white;

        --tocnav-normal-text: #999;
        --tocnav-normal-bg: var(--bg);
        --tocnav-hover-text: var(--tocnav-normal-text);
        --tocnav-hover-bg: #080808;
        --tocnav-active-text: #f44;
        --tocnav-active-bg: var(--tocnav-normal-bg);

        --tocsidebar-text: var(--text);
        --tocsidebar-bg: #080808;
        --tocsidebar-shadow: rgba(255,255,255,.1);
        --tocsidebar-heading-text: hsla(203,20%,40%,.7);

        --toclink-text: var(--text);
        --toclink-underline: #6af;
        --toclink-visited-text: var(--toclink-text);
        --toclink-visited-underline: #054572;

        --heading-text: #8af;

        --hr-text: var(--text);

        --algo-border: #456;

        --del-text: #f44;
        --del-bg: transparent;
        --ins-text: #4a4;
        --ins-bg: transparent;

        --a-normal-text: #6af;
        --a-normal-underline: #555;
        --a-visited-text: var(--a-normal-text);
        --a-visited-underline: var(--a-normal-underline);
        --a-hover-bg: rgba(25%, 25%, 25%, .2);
        --a-active-text: #f44;
        --a-active-underline: var(--a-active-text);

        --borderedblock-bg: rgba(255, 255, 255, .05);

        --blockquote-border: silver;
        --blockquote-bg: var(--borderedblock-bg);
        --blockquote-text: currentcolor;

        --issue-border: #e05252;
        --issue-bg: var(--borderedblock-bg);
        --issue-text: var(--text);
        --issueheading-text: hsl(0deg, 70%, 70%);

        --example-border: hsl(50deg, 90%, 60%);
        --example-bg: var(--borderedblock-bg);
        --example-text: var(--text);
        --exampleheading-text: hsl(50deg, 70%, 70%);

        --note-border: hsl(120deg, 100%, 35%);
        --note-bg: var(--borderedblock-bg);
        --note-text: var(--text);
        --noteheading-text: hsl(120, 70%, 70%);
        --notesummary-underline: silver;

        --assertion-border: #444;
        --assertion-bg: var(--borderedblock-bg);
        --assertion-text: var(--text);

        --advisement-border: orange;
        --advisement-bg: #222218;
        --advisement-text: var(--text);
        --advisementheading-text: #f84;

        --warning-border: red;
        --warning-bg: hsla(40,100%,20%,0.95);
        --warning-text: var(--text);

        --amendment-border: #330099;
        --amendment-bg: #080010;
        --amendment-text: var(--text);
        --amendmentheading-text: #cc00ff;

        --def-border: #8ccbf2;
        --def-bg: #080818;
        --def-text: var(--text);
        --defrow-border: #136;

        --datacell-border: silver;

        --indexinfo-text: #aaa;

        --indextable-hover-text: var(--text);
        --indextable-hover-bg: #181818;

        --outdatedspec-bg: rgba(255, 255, 255, .5);
        --outdatedspec-text: black;
        --outdated-bg: maroon;
        --outdated-text: white;
        --outdated-shadow: red;

        --editedrec-bg: darkorange;
    }
    /* In case a transparent-bg image doesn't expect to be on a dark bg,
       which is quite common in practice... */
    img { background: white; }
}
</style>
<style>/* Boilerplate: style-counters */
body {
    counter-reset: example figure issue;
}
.issue {
    counter-increment: issue;
}
.issue:not(.no-marker)::before {
    content: "Issue " counter(issue);
}

.example {
    counter-increment: example;
}
.example:not(.no-marker)::before {
    content: "Example " counter(example);
}
.invalid.example:not(.no-marker)::before,
.illegal.example:not(.no-marker)::before {
    content: "Invalid Example" counter(example);
}

figcaption {
    counter-increment: figure;
}
figcaption:not(.no-marker)::before {
    content: "Figure " counter(figure) " ";
}
</style>
<style>/* Boilerplate: style-dfn-panel */
:root {
    --dfnpanel-bg: #ddd;
    --dfnpanel-text: var(--text);
    --dfnpanel-target-bg: #ffc;
    --dfnpanel-target-outline: orange;
}
@media (prefers-color-scheme: dark) {
    :root {
        --dfnpanel-bg: #222;
        --dfnpanel-text: var(--text);
        --dfnpanel-target-bg: #333;
        --dfnpanel-target-outline: silver;
    }
}
.dfn-panel {
    position: absolute;
    z-index: 35;
    width: 20em;
    width: 300px;
    height: auto;
    max-height: 500px;
    overflow: auto;
    padding: 0.5em 0.75em;
    font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
    background: var(--dfnpanel-bg);
    color: var(--dfnpanel-text);
    border: outset 0.2em;
    white-space: normal; /* in case it's moved into a pre */
}
.dfn-panel:not(.on) { display: none; }
.dfn-panel * { margin: 0; padding: 0; text-indent: 0; }
.dfn-panel > b { display: block; }
.dfn-panel a { color: var(--dfnpanel-text); }
.dfn-panel a:not(:hover) { text-decoration: none !important; border-bottom: none !important; }
.dfn-panel a:focus {
    outline: 5px auto Highlight;
    outline: 5px auto -webkit-focus-ring-color;
}
.dfn-panel > b + b { margin-top: 0.25em; }
.dfn-panel ul { padding: 0 0 0 1em; list-style: none; }
.dfn-panel li a {
    max-width: calc(300px - 1.5em - 1em);
    overflow: hidden;
    text-overflow: ellipsis;
}

.dfn-panel.activated {
    display: inline-block;
    position: fixed;
    left: 8px;
    bottom: 2em;
    margin: 0 auto;
    max-width: calc(100vw - 1.5em - .4em - .5em);
    max-height: 30vh;
    transition: left 1s ease-out, bottom 1s ease-out;
}

.dfn-panel .link-item:hover {
    text-decoration: underline;
}
.dfn-panel .link-item .copy-icon {
    opacity: 0;
}
.dfn-panel .link-item:hover .copy-icon,
.dfn-panel .link-item .copy-icon:focus {
    opacity: 1;
}

.dfn-panel .copy-icon {
    display: inline-block;
    margin-right: 0.5em;
    width: 0.85em;
    height: 1em;
    border-radius: 3px;
    background-color: #ccc;
    cursor: pointer;
}

.dfn-panel .copy-icon .icon {
    width: 100%;
    height: 100%;
    background-color: #fff;
    display: flex;
    justify-content: center;
    align-items: center;
    position: relative;
}

.dfn-panel .copy-icon .icon::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    border: 1px solid black;
    background-color: #ccc;
    opacity: 0.25;
    transform: translate(3px, -3px);
}

.dfn-panel .copy-icon:active .icon::before {
    opacity: 1;
}

.dfn-paneled[role="button"] { cursor: help; }

.highlighted {
    animation: target-fade 3s;
}

@keyframes target-fade {
    from {
        background-color: var(--dfnpanel-target-bg);
        outline: 5px solid var(--dfnpanel-target-outline);
    }
    to {
        color: var(--a-normal-text);
        background-color: transparent;
        outline: transparent;
    }
}
</style>
<style>/* Boilerplate: style-issues */
a[href].issue-return {
    float: right;
    float: inline-end;
    color: var(--issueheading-text);
    font-weight: bold;
    text-decoration: none;
}
</style>
<style>/* Boilerplate: style-md-lists */
/* This is a weird hack for me not yet following the commonmark spec
   regarding paragraph and lists. */
[data-md] > :first-child {
    margin-top: 0;
}
[data-md] > :last-child {
    margin-bottom: 0;
}
</style>
<style>/* Boilerplate: style-ref-hints */
:root {
    --ref-hint-bg: #ddd;
    --ref-hint-text: var(--text);
}
@media (prefers-color-scheme: dark) {
    :root {
        --ref-hint-bg: #222;
        --ref-hint-text: var(--text);
    }
}

.ref-hint {
    display: inline-block;
    position: absolute;
    z-index: 35;
    width: 20em;
    width: 300px;
    height: auto;
    max-height: 500px;
    overflow: auto;
    padding: 0.5em 0.5em;
    font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
    background: var(--ref-hint-bg);
    color: var(--ref-hint-text);
    border: outset 0.2em;
    white-space: normal; /* in case it's moved into a pre */
}

.ref-hint * { margin: 0; padding: 0; text-indent: 0; }

.ref-hint ul { padding: 0 0 0 1em; list-style: none; }
</style>
<style>/* Boilerplate: style-selflinks */
:root {
    --selflink-text: white;
    --selflink-bg: gray;
    --selflink-hover-text: black;
}
.heading, .issue, .note, .example, li, dt {
    position: relative;
}
a.self-link {
    position: absolute;
    top: 0;
    left: calc(-1 * (3.5rem - 26px));
    width: calc(3.5rem - 26px);
    height: 2em;
    text-align: center;
    border: none;
    transition: opacity .2s;
    opacity: .5;
}
a.self-link:hover {
    opacity: 1;
}
.heading > a.self-link {
    font-size: 83%;
}
.example > a.self-link,
.note > a.self-link,
.issue > a.self-link {
    /* These blocks are overflow:auto, so positioning outside
       doesn't work. */
    left: auto;
    right: 0;
}
li > a.self-link {
    left: calc(-1 * (3.5rem - 26px) - 2em);
}
dfn > a.self-link {
    top: auto;
    left: auto;
    opacity: 0;
    width: 1.5em;
    height: 1.5em;
    background: var(--selflink-bg);
    color: var(--selflink-text);
    font-style: normal;
    transition: opacity .2s, background-color .2s, color .2s;
}
dfn:hover > a.self-link {
    opacity: 1;
}
dfn > a.self-link:hover {
    color: var(--selflink-hover-text);
}

a.self-link::before            { content: "¶"; }
.heading > a.self-link::before { content: "§"; }
dfn > a.self-link::before      { content: "#"; }
</style>
<style>/* Boilerplate: style-syntax-highlighting */
code.highlight { padding: .1em; border-radius: .3em; }
pre.highlight, pre > code.highlight { display: block; padding: 1em; margin: .5em 0; overflow: auto; border-radius: 0; }

.highlight:not(.idl) { background: rgba(0, 0, 0, .03); }
c-[a] { color: #990055 } /* Keyword.Declaration */
c-[b] { color: #990055 } /* Keyword.Type */
c-[c] { color: #708090 } /* Comment */
c-[d] { color: #708090 } /* Comment.Multiline */
c-[e] { color: #0077aa } /* Name.Attribute */
c-[f] { color: #669900 } /* Name.Tag */
c-[g] { color: #222222 } /* Name.Variable */
c-[k] { color: #990055 } /* Keyword */
c-[l] { color: #000000 } /* Literal */
c-[m] { color: #000000 } /* Literal.Number */
c-[n] { color: #0077aa } /* Name */
c-[o] { color: #999999 } /* Operator */
c-[p] { color: #999999 } /* Punctuation */
c-[s] { color: #a67f59 } /* Literal.String */
c-[t] { color: #a67f59 } /* Literal.String.Single */
c-[u] { color: #a67f59 } /* Literal.String.Double */
c-[cp] { color: #708090 } /* Comment.Preproc */
c-[c1] { color: #708090 } /* Comment.Single */
c-[cs] { color: #708090 } /* Comment.Special */
c-[kc] { color: #990055 } /* Keyword.Constant */
c-[kn] { color: #990055 } /* Keyword.Namespace */
c-[kp] { color: #990055 } /* Keyword.Pseudo */
c-[kr] { color: #990055 } /* Keyword.Reserved */
c-[ld] { color: #000000 } /* Literal.Date */
c-[nc] { color: #0077aa } /* Name.Class */
c-[no] { color: #0077aa } /* Name.Constant */
c-[nd] { color: #0077aa } /* Name.Decorator */
c-[ni] { color: #0077aa } /* Name.Entity */
c-[ne] { color: #0077aa } /* Name.Exception */
c-[nf] { color: #0077aa } /* Name.Function */
c-[nl] { color: #0077aa } /* Name.Label */
c-[nn] { color: #0077aa } /* Name.Namespace */
c-[py] { color: #0077aa } /* Name.Property */
c-[ow] { color: #999999 } /* Operator.Word */
c-[mb] { color: #000000 } /* Literal.Number.Bin */
c-[mf] { color: #000000 } /* Literal.Number.Float */
c-[mh] { color: #000000 } /* Literal.Number.Hex */
c-[mi] { color: #000000 } /* Literal.Number.Integer */
c-[mo] { color: #000000 } /* Literal.Number.Oct */
c-[sb] { color: #a67f59 } /* Literal.String.Backtick */
c-[sc] { color: #a67f59 } /* Literal.String.Char */
c-[sd] { color: #a67f59 } /* Literal.String.Doc */
c-[se] { color: #a67f59 } /* Literal.String.Escape */
c-[sh] { color: #a67f59 } /* Literal.String.Heredoc */
c-[si] { color: #a67f59 } /* Literal.String.Interpol */
c-[sx] { color: #a67f59 } /* Literal.String.Other */
c-[sr] { color: #a67f59 } /* Literal.String.Regex */
c-[ss] { color: #a67f59 } /* Literal.String.Symbol */
c-[vc] { color: #0077aa } /* Name.Variable.Class */
c-[vg] { color: #0077aa } /* Name.Variable.Global */
c-[vi] { color: #0077aa } /* Name.Variable.Instance */
c-[il] { color: #000000 } /* Literal.Number.Integer.Long */

@media (prefers-color-scheme: dark) {
    .highlight:not(.idl) { background: rgba(255, 255, 255, .05); }

    c-[a] { color: #d33682 } /* Keyword.Declaration */
    c-[b] { color: #d33682 } /* Keyword.Type */
    c-[c] { color: #2aa198 } /* Comment */
    c-[d] { color: #2aa198 } /* Comment.Multiline */
    c-[e] { color: #268bd2 } /* Name.Attribute */
    c-[f] { color: #b58900 } /* Name.Tag */
    c-[g] { color: #cb4b16 } /* Name.Variable */
    c-[k] { color: #d33682 } /* Keyword */
    c-[l] { color: #657b83 } /* Literal */
    c-[m] { color: #657b83 } /* Literal.Number */
    c-[n] { color: #268bd2 } /* Name */
    c-[o] { color: #657b83 } /* Operator */
    c-[p] { color: #657b83 } /* Punctuation */
    c-[s] { color: #6c71c4 } /* Literal.String */
    c-[t] { color: #6c71c4 } /* Literal.String.Single */
    c-[u] { color: #6c71c4 } /* Literal.String.Double */
    c-[ch] { color: #2aa198 } /* Comment.Hashbang */
    c-[cp] { color: #2aa198 } /* Comment.Preproc */
    c-[cpf] { color: #2aa198 } /* Comment.PreprocFile */
    c-[c1] { color: #2aa198 } /* Comment.Single */
    c-[cs] { color: #2aa198 } /* Comment.Special */
    c-[kc] { color: #d33682 } /* Keyword.Constant */
    c-[kn] { color: #d33682 } /* Keyword.Namespace */
    c-[kp] { color: #d33682 } /* Keyword.Pseudo */
    c-[kr] { color: #d33682 } /* Keyword.Reserved */
    c-[ld] { color: #657b83 } /* Literal.Date */
    c-[nc] { color: #268bd2 } /* Name.Class */
    c-[no] { color: #268bd2 } /* Name.Constant */
    c-[nd] { color: #268bd2 } /* Name.Decorator */
    c-[ni] { color: #268bd2 } /* Name.Entity */
    c-[ne] { color: #268bd2 } /* Name.Exception */
    c-[nf] { color: #268bd2 } /* Name.Function */
    c-[nl] { color: #268bd2 } /* Name.Label */
    c-[nn] { color: #268bd2 } /* Name.Namespace */
    c-[py] { color: #268bd2 } /* Name.Property */
    c-[ow] { color: #657b83 } /* Operator.Word */
    c-[mb] { color: #657b83 } /* Literal.Number.Bin */
    c-[mf] { color: #657b83 } /* Literal.Number.Float */
    c-[mh] { color: #657b83 } /* Literal.Number.Hex */
    c-[mi] { color: #657b83 } /* Literal.Number.Integer */
    c-[mo] { color: #657b83 } /* Literal.Number.Oct */
    c-[sa] { color: #6c71c4 } /* Literal.String.Affix */
    c-[sb] { color: #6c71c4 } /* Literal.String.Backtick */
    c-[sc] { color: #6c71c4 } /* Literal.String.Char */
    c-[dl] { color: #6c71c4 } /* Literal.String.Delimiter */
    c-[sd] { color: #6c71c4 } /* Literal.String.Doc */
    c-[se] { color: #6c71c4 } /* Literal.String.Escape */
    c-[sh] { color: #6c71c4 } /* Literal.String.Heredoc */
    c-[si] { color: #6c71c4 } /* Literal.String.Interpol */
    c-[sx] { color: #6c71c4 } /* Literal.String.Other */
    c-[sr] { color: #6c71c4 } /* Literal.String.Regex */
    c-[ss] { color: #6c71c4 } /* Literal.String.Symbol */
    c-[fm] { color: #268bd2 } /* Name.Function.Magic */
    c-[vc] { color: #cb4b16 } /* Name.Variable.Class */
    c-[vg] { color: #cb4b16 } /* Name.Variable.Global */
    c-[vi] { color: #cb4b16 } /* Name.Variable.Instance */
    c-[vm] { color: #cb4b16 } /* Name.Variable.Magic */
    c-[il] { color: #657b83 } /* Literal.Number.Integer.Long */
}
</style>
 <body class="h-entry">
  <div class="head">
   <p data-fill-with="logo"><a class="logo" href="https://www.w3.org/"> <img alt="W3C" height="48" src="https://www.w3.org/StyleSheets/TR/2021/logos/W3C" width="72"> </a> </p>
   <h1 class="p-name no-ref" id="title">Motion Sensors Explainer</h1>
   <p id="w3c-state"><a href="https://www.w3.org/standards/types/#ED">Editor’s Draft</a>, <time class="dt-updated" datetime="1970-01-01">1 January 1970</time></p>
   <details open>
    <summary>More details about this document</summary>
    <div data-fill-with="spec-metadata">
     <dl>
      <dt>This version:
      <dd><a class="u-url" href="https://w3c.github.io/motion-sensors/">https://w3c.github.io/motion-sensors/</a>
      <dt>Latest published version:
      <dd><a href="https://www.w3.org/TR/motion-sensors/">https://www.w3.org/TR/motion-sensors/</a>
      <dt>Previous Versions:
      <dd><a href="https://www.w3.org/TR/2017/NOTE-motion-sensors-20170511/" rel="prev">https://www.w3.org/TR/2017/NOTE-motion-sensors-20170511/</a>
      <dt>Version History:
      <dd><a href="https://github.com/w3c/motion-sensors/commits/gh-pages/index.bs">https://github.com/w3c/motion-sensors/commits/gh-pages/index.bs</a>
      <dt>Feedback:
      <dd><span><a href="mailto:public-device-apis@w3.org?subject=%5Bmotion-sensors%5D%20YOUR%20TOPIC%20HERE">public-device-apis@w3.org</a> with subject line “<kbd>[motion-sensors] <i data-lt>… message topic …</i></kbd>” (<a href="https://lists.w3.org/Archives/Public/public-device-apis/" rel="discussion">archives</a>)</span>
      <dt class="editor">Editors:
      <dd class="editor p-author h-card vcard" data-editor-id="57705"><a class="p-name fn u-url url" href="https://intel.com/">Kenneth Rohde Christiansen</a> (<span class="p-org org">Intel Corporation</span>)
      <dd class="editor p-author h-card vcard" data-editor-id="78335"><a class="p-name fn u-url url" href="http://intel.com/">Alexander Shalamov</a> (<span class="p-org org">Intel Corporation</span>)
      <dt>Bug Reports:
      <dd><a href="https://www.github.com/w3c/motion-sensors/issues/new">via the w3c/motion-sensors repository on GitHub</a>
     </dl>
    </div>
   </details>
   <div data-fill-with="warning"></div>
   <p class="copyright" data-fill-with="copyright"><a href="https://www.w3.org/policies/#copyright">Copyright</a> © 1970 <a href="https://www.w3.org/">World Wide Web Consortium</a>. <abbr title="World Wide Web Consortium">W3C</abbr><sup>®</sup> <a href="https://www.w3.org/policies/#Legal_Disclaimer">liability</a>, <a href="https://www.w3.org/policies/#W3C_Trademarks">trademark</a> and <a href="https://www.w3.org/copyright/software-license/" rel="license" title="W3C Software and Document License">permissive document license</a> rules apply. </p>
   <hr title="Separator for header">
  </div>
  <div class="p-summary" data-fill-with="abstract">
   <h2 class="no-num no-toc no-ref heading settled" id="abstract"><span class="content">Abstract</span></h2>
   <p>This explainer is an introduction to low-level and high-level motion sensors,
their relationship, inner workings and common use-cases. Common cases of event
filtering and sensor fusion are introduced with examples, showing how to apply
that on sensors following the Generic Sensor API specification.</p>
  </div>
  <h2 class="no-num no-toc no-ref heading settled" id="sotd"><span class="content">Status of this document</span></h2>
  <div data-fill-with="status">
   <p> This is a public copy of the editors’ draft.
	It is provided for discussion only and may change at any moment.
	Its publication here does not imply endorsement of its contents by W3C.
	Don’t cite this document other than as work in progress. </p>
   <p> If you wish to make comments regarding this document, please send them to <a href="mailto:public-device-apis@w3.org?Subject=%5Bmotion-sensors%5D%20PUT%20SUBJECT%20HERE">public-device-apis@w3.org</a> (<a href="mailto:public-device-apis-request@w3.org?subject=subscribe">subscribe</a>, <a href="https://lists.w3.org/Archives/Public/public-device-apis/">archives</a>).
	When sending e-mail,
	please put the text “motion-sensors” in the subject,
	preferably like this:
	“[motion-sensors] <em>…summary of comment…</em>”.
	All comments are welcome. </p>
   <p> This document was published by the <a href="https://www.w3.org/groups/wg/das">Devices and Sensors Working Group</a>. </p>
   <p> This document was produced by a group operating under
	the <a href="https://www.w3.org/policies/patent-policy/">W3C Patent Policy</a>.
	W3C maintains a <a href="https://www.w3.org/groups/wg/das/ipr" rel="disclosure">public list of any patent disclosures</a> made in connection with the deliverables of the group;
	that page also includes instructions for disclosing a patent.
	An individual who has actual knowledge of a patent which the individual believes contains <a href="https://www.w3.org/policies/patent-policy/#def-essential">Essential Claim(s)</a> must disclose the information in accordance with <a href="https://www.w3.org/policies/patent-policy/#sec-Disclosure">section 6 of the W3C Patent Policy</a>. </p>
   <p> This document is governed by the <a href="https://www.w3.org/policies/process/20231103/" id="w3c_process_revision">03 November 2023 W3C Process Document</a>. </p>
   <p></p>
  </div>
  <div data-fill-with="at-risk"></div>
  <nav data-fill-with="table-of-contents" id="toc">
   <h2 class="no-num no-toc no-ref" id="contents">Table of Contents</h2>
   <ol class="toc" role="directory">
    <li><a href="#intro"><span class="secno">1</span> <span class="content">Introduction</span></a>
    <li><a href="#security-and-privacy"><span class="secno">2</span> <span class="content">Security and Privacy Considerations</span></a>
    <li>
     <a href="#low-level-sensors"><span class="secno">3</span> <span class="content">Low-level Sensors</span></a>
     <ol class="toc">
      <li><a href="#accelerometer-sensor"><span class="secno">3.1</span> <span class="content">Accelerometer</span></a>
      <li><a href="#gyroscope-sensor"><span class="secno">3.2</span> <span class="content">Gyroscope</span></a>
      <li><a href="#magnetometer-sensor"><span class="secno">3.3</span> <span class="content">Magnetometer</span></a>
     </ol>
    <li>
     <a href="#highlevel-sensors"><span class="secno">4</span> <span class="content">High-level Sensors</span></a>
     <ol class="toc">
      <li><a href="#fusion-sensors"><span class="secno">4.1</span> <span class="content">Common fusion sensors</span></a>
      <li>
       <a href="#pass-filters"><span class="secno">4.2</span> <span class="content">Low and high pass filters</span></a>
       <ol class="toc">
        <li><a href="#low-pass-filters"><span class="secno">4.2.1</span> <span class="content">Low-pass filter</span></a>
        <li><a href="#high-pass-filters"><span class="secno">4.2.2</span> <span class="content">High-pass filter</span></a>
       </ol>
      <li><a href="#absolute-orientation"><span class="secno">4.3</span> <span class="content">Absolute Orientation Sensor</span></a>
      <li><a href="#geomagnetic-orientation"><span class="secno">4.4</span> <span class="content">Geomagnetic Orientation Sensor</span></a>
      <li>
       <a href="#relative-orientation"><span class="secno">4.5</span> <span class="content">Relative Orientation Sensor</span></a>
       <ol class="toc">
        <li><a href="#complementary-filters"><span class="secno">4.5.1</span> <span class="content">Complementary filter</span></a>
       </ol>
      <li><a href="#gravity-and-linear-acceleration"><span class="secno">4.6</span> <span class="content">Gravity and Linear Acceleration Sensor</span></a>
      <li><a href="#usecases-and-requirements"><span class="secno">4.7</span> <span class="content">Use Cases and Requirements</span></a>
     </ol>
    <li>
     <a href="#index"><span class="secno"></span> <span class="content">Index</span></a>
     <ol class="toc">
      <li><a href="#index-defined-here"><span class="secno"></span> <span class="content">Terms defined by this specification</span></a>
      <li><a href="#index-defined-elsewhere"><span class="secno"></span> <span class="content">Terms defined by reference</span></a>
     </ol>
    <li>
     <a href="#references"><span class="secno"></span> <span class="content">References</span></a>
     <ol class="toc">
      <li><a href="#normative"><span class="secno"></span> <span class="content">Normative References</span></a>
      <li><a href="#informative"><span class="secno"></span> <span class="content">Informative References</span></a>
     </ol>
   </ol>
  </nav>
  <main>
   <h2 class="heading settled" data-level="1" id="intro"><span class="secno">1. </span><span class="content">Introduction</span><a class="self-link" href="#intro"></a></h2>
   <p>There are a handful of different motion sensors available in modern hardware such
as phones.</p>
   <p>The motion sensors extends the Generic Sensor API <a data-link-type="biblio" href="#biblio-generic-sensor" title="Generic Sensor API">[GENERIC-SENSOR]</a> to expose
a class of low-level and fusion sensors. This document explains the relationship
between these sensors.</p>
   <p>The low-level sensors include:</p>
   <ul>
    <li data-md>
     <p><a data-link-type="dfn" href="#accelerometer" id="ref-for-accelerometer">Accelerometer</a></p>
    <li data-md>
     <p><a data-link-type="dfn" href="#gyroscope" id="ref-for-gyroscope">Gyroscope</a></p>
    <li data-md>
     <p><a data-link-type="dfn" href="#magnetometer-magnetometers" id="ref-for-magnetometer-magnetometers">Magnetometer</a></p>
   </ul>
   <p>Multiple new sensors can be created using the data from these above sensors
in different ways. These are commonly known as fusion sensors.</p>
   <h2 class="heading settled" data-level="2" id="security-and-privacy"><span class="secno">2. </span><span class="content">Security and Privacy Considerations</span><a class="self-link" href="#security-and-privacy"></a></h2>
   <p>There are no specific security and privacy considerations
beyond those described in the Generic Sensor API <a data-link-type="biblio" href="#biblio-generic-sensor" title="Generic Sensor API">[GENERIC-SENSOR]</a>.</p>
   <h2 class="heading settled" data-level="3" id="low-level-sensors"><span class="secno">3. </span><span class="content">Low-level Sensors</span><a class="self-link" href="#low-level-sensors"></a></h2>
   <h3 class="heading settled" data-level="3.1" id="accelerometer-sensor"><span class="secno">3.1. </span><span class="content">Accelerometer</span><a class="self-link" href="#accelerometer-sensor"></a></h3>
   <p>A raw <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="accelerometer">accelerometer</dfn> sensor measures changes in acceleration in 3 different
directions, but is affected by <i><a data-link-type="dfn" href="https://w3c.github.io/accelerometer#gravity" id="ref-for-gravity">gravity</a></i>. The <a data-link-type="dfn" href="https://w3c.github.io/accelerometer#accelerometer-interface" id="ref-for-accelerometer-interface">Accelerometer interface</a> is defined in <a data-link-type="biblio" href="#biblio-accelerometer" title="Accelerometer">[ACCELEROMETER]</a> specification.</p>
   <p>The <a data-link-type="dfn" href="#accelerometer" id="ref-for-accelerometer①">Accelerometer</a> sensor is an <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="inertial-frame-sensor">inertial-frame sensor</dfn>, this means that when the device
is in free fall, the acceleration is 0 m/s<sup>2</sup> in the falling direction, and
when a device is laying flat on a table, the acceleration in upwards direction will be equal
to the Earth <a data-link-type="dfn" href="https://w3c.github.io/accelerometer#gravity" id="ref-for-gravity①">gravity</a>, i.e. g ≡ 9.8 m/s<sup>2</sup> as it is measuring the force of the table
pushing the device upwards.</p>
   <p>Accelerometers are less useful by themselves and often take part in other fusion sensors,
but they do have some purposes like registering shakes, steps and the like.</p>
   <p>Often for such use-cases the developer is interested in the <a data-link-type="dfn" href="https://w3c.github.io/accelerometer#linear-acceleration" id="ref-for-linear-acceleration">linear acceleration</a> which is
the acceleration without the <a data-link-type="dfn" href="https://w3c.github.io/accelerometer#gravity" id="ref-for-gravity②">gravity</a>, called <a data-link-type="dfn" href="https://w3c.github.io/accelerometer#gravity" id="ref-for-gravity③">gravity</a> compensation
(See <a data-link-type="dfn" href="#linear-acceleration-sensor" id="ref-for-linear-acceleration-sensor">Linear Acceleration Sensor</a>); or the developer is interested in the isolated <a data-link-type="dfn" href="https://w3c.github.io/accelerometer#gravity" id="ref-for-gravity④">gravity</a>, 
in order to know the <a data-link-type="dfn" href="https://w3c.github.io/accelerometer#gravity" id="ref-for-gravity⑤">gravity</a> vector (see <a data-link-type="dfn" href="#gravity-sensor" id="ref-for-gravity-sensor">Gravity Sensor</a>), which can be useful for some
kinds of sensor fusion like creating a magnetic compass.</p>
   <p>For acceleration, you usually care about the big changes and want to avoid noise, like the <a data-link-type="dfn" href="https://w3c.github.io/accelerometer#gravity" id="ref-for-gravity⑥">gravity</a>, thus a <a data-link-type="dfn" href="#high-pass-filter" id="ref-for-high-pass-filter">high-pass filter</a> can help isolate the <a data-link-type="dfn" href="https://w3c.github.io/accelerometer#linear-acceleration" id="ref-for-linear-acceleration①">linear acceleration</a> and a <a data-link-type="dfn" href="#low-pass-filter" id="ref-for-low-pass-filter">low-pass
filter</a> can help isolate the <a data-link-type="dfn" href="https://w3c.github.io/accelerometer#gravity" id="ref-for-gravity⑦">gravity</a>. A <a data-link-type="dfn" href="#low-pass-filter" id="ref-for-low-pass-filter①">low-pass filter</a> can thus be useful for measuring a
tilt. Unfortunately, any <a data-link-type="dfn" href="#high-pass-filter" id="ref-for-high-pass-filter①">high-pass filter</a> or <a data-link-type="dfn" href="#low-pass-filter" id="ref-for-low-pass-filter②">low-pass filter</a> introduces a delay, which may or may not be
acceptable.</p>
   <p>Notice, as accelerometers report <i>acceleration</i>, you need to integrate to get <i>velocity</i>:</p>
   <p>v = ∫a×∂t</p>
   <p>And again to get <i>position</i>:</p>
   <p>x = ∫v×∂t</p>
   <p>An integral creates drift, and a double integral amplifies that:</p>
   <p>a = g×sin(θ), x = ½×at<sup>2</sup></p>
   <p>So position from an accelerometer is very imprecise and not very useful.</p>
   <h3 class="heading settled" data-level="3.2" id="gyroscope-sensor"><span class="secno">3.2. </span><span class="content">Gyroscope</span><a class="self-link" href="#gyroscope-sensor"></a></h3>
   <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="gyroscope">gyroscope</dfn> senses <i><a data-link-type="dfn" href="https://w3c.github.io/gyroscope#angular-velocity" id="ref-for-angular-velocity">angular velocity</a></i>, relative to itself, thus it measures its own rotation,
using an inertial force called the Coriolis effect. Gyroscopes oscillate at relative high frequency in
order to measure this and are thus one of the most power hungry motion sensors. This also means
that they can easily be affected by other vibrations, like a vibration (rumble) motor or speaker
on the same device. The <a data-link-type="dfn" href="https://w3c.github.io/gyroscope#gyroscope-interface" id="ref-for-gyroscope-interface">Gyroscope interface</a> is defined in <a data-link-type="biblio" href="#biblio-gyroscope" title="Gyroscope">[GYROSCOPE]</a> specification.</p>
   <p>In order to get rotation (angle) from a gyroscope, which senses <a data-link-type="dfn" href="https://w3c.github.io/gyroscope#angular-velocity" id="ref-for-angular-velocity①">angular velocity</a>, you need to
perform a single integration.</p>
   <p>f ≡ frequency</p>
   <p>∫cos(2π×ft)) = (1/(2π×f)) × sin(2π×ft)</p>
   <p>But be aware that integration turns noise into drift. As we see above, the integration gets a
1/f outside, meaning that high frequency (f) noise disappears with integration, i.e. a noise
of frequency will drop by a factor of a 100, but a very low frequency will be amplified,
meaning the gyroscope will drift over time.</p>
   <p>So in order to do it well you need to do it quickly and as you see below, we multiply with the
∂t, so any error in the reported time difference will manifest itself like the drift above.</p>
   <p>θ<sub>n</sub> = θ<sub>n-1</sub> + ω × ∂t</p>
   <p>With ω denoting the <a data-link-type="dfn" href="https://w3c.github.io/gyroscope#angular-velocity" id="ref-for-angular-velocity②">angular velocity</a> and θ, the resulting angle.</p>
   <p>Most gyroscope sensors perform <a data-link-type="dfn" href="https://w3c.github.io/sensors#calibration" id="ref-for-calibration">calibration</a> by applying some sort of <i>drift compensation</i> in hardware for known low frequency caused by adjacent hardware on the device.</p>
   <h3 class="heading settled" data-level="3.3" id="magnetometer-sensor"><span class="secno">3.3. </span><span class="content">Magnetometer</span><a class="self-link" href="#magnetometer-sensor"></a></h3>
   <p><dfn class="dfn-paneled" data-dfn-for="magnetometer" data-dfn-type="dfn" data-noexport id="magnetometer-magnetometers">Magnetometers</dfn> are <i><a data-link-type="dfn" href="https://w3c.github.io/magnetometer#magnetic-field" id="ref-for-magnetic-field">magnetic field</a> sensors</i>, which means that without
any strong magnetic influence close by, it will sense the Earth’s <a data-link-type="dfn" href="https://w3c.github.io/magnetometer#magnetic-field" id="ref-for-magnetic-field①">magnetic field</a>, which more or less points
in the direction of North, but not true North. The <a data-link-type="dfn" href="https://w3c.github.io/magnetometer#magnetometer-interface" id="ref-for-magnetometer-interface">Magnetometer interface</a> is defined in <a data-link-type="biblio" href="#biblio-magnetometer" title="Magnetometer">[MAGNETOMETER]</a> specification.</p>
   <p>As said, magnetometers are very sensitive to outside influence, like anything on a table that
has been slightly magnetized, and it is even affected by other things inside a device, though
the device manufacturer can compensate for this somewhat. In practise though, these sensors
work quite well for most common use-cases.</p>
   <p>As long as nothing that is magnetized in the surrounding is moving around, the magnetometer
readings are stable enough to be used to isolate <a data-link-type="dfn" href="https://w3c.github.io/accelerometer#gravity" id="ref-for-gravity⑧">gravity</a> as mentioned above.</p>
   <p>Magnetometer is a 3-axis sensor, which means it gives a 3D vector pointing to the strongest <a data-link-type="dfn" href="https://w3c.github.io/magnetometer#magnetic-field" id="ref-for-magnetic-field②">magnetic field</a>. It also means that it does not enforce a specific device orientation in order
to work.</p>
   <p>In order to tell how the device is being held, though, you need a <a data-link-type="dfn" href="https://w3c.github.io/accelerometer#gravity" id="ref-for-gravity⑨">gravity</a> vector, which as a bare
minimum requires an accelerometer in the case of low pass filtering, and additionally a gyroscope
if more precise readings are needed. This is called <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="tilt-compensation">tilt compensation</dfn>.</p>
   <p>The most common use-case for magnetometers are as part of sensor fusion, in order to generate an
Orientation Sensor which is stationary to the Earth plane, or a compass, which is basically the
former with corrections to the declination depending on geolocation position, such that it points
to the true North.</p>
   <h2 class="heading settled" data-level="4" id="highlevel-sensors"><span class="secno">4. </span><span class="content">High-level Sensors</span><a class="self-link" href="#highlevel-sensors"></a></h2>
   <p>As mentioned above, each sensor has its own issues, such as noise and drift, and often need some
kind of compensation using input from a different sensor. Put another way, one sensor might not
be very precise on its own, but the sum of multiple sensory input can be much more stable.</p>
   <p>Unfortunately, sensors require power, and the more sensors and the higher the measuring frequency,
higher the power consumption. The gyroscope is typically considered more power hungry than the
rest, as it needs to vibrate at a certain frequency in order to measure the <a data-link-type="dfn" href="https://w3c.github.io/gyroscope#angular-velocity" id="ref-for-angular-velocity③">angular velocity</a>.</p>
   <p>For the above reasons, it is always important to consider the minimum set of sensors which
solves a task satisfactory. As many devices today can do certain kinds of sensor fusion in
hardware, it most often makes sense to use these from a power and performance point of view.</p>
   <h3 class="heading settled" data-level="4.1" id="fusion-sensors"><span class="secno">4.1. </span><span class="content">Common fusion sensors</span><a class="self-link" href="#fusion-sensors"></a></h3>
   <p>Below is a list of fusion sensors and what sensors they usually are made up of:</p>
   <table>
    <thead>
     <tr>
      <th>Sensor type
      <th>Underlying physical sensors
    <tbody>
     <tr>
      <td><a data-link-type="dfn" href="#relative-orientation-sensor" id="ref-for-relative-orientation-sensor">Relative Orientation Sensor</a>
      <td><a data-link-type="dfn" href="#accelerometer" id="ref-for-accelerometer②">Accelerometer</a>, <a data-link-type="dfn" href="#gyroscope" id="ref-for-gyroscope①">Gyroscope</a>, MUST NOT USE <a data-link-type="dfn" href="#magnetometer-magnetometers" id="ref-for-magnetometer-magnetometers①">Magnetometer</a>
     <tr>
      <td><a data-link-type="dfn" href="#absolute-orientation-sensor" id="ref-for-absolute-orientation-sensor">Absolute Orientation Sensor</a>
      <td><a data-link-type="dfn" href="#accelerometer" id="ref-for-accelerometer③">Accelerometer</a>, <a data-link-type="dfn" href="#magnetometer-magnetometers" id="ref-for-magnetometer-magnetometers②">Magnetometer</a>, AND (when present) <a data-link-type="dfn" href="#gyroscope" id="ref-for-gyroscope②">Gyroscope</a>
     <tr>
      <td><a data-link-type="dfn" href="#geomagnetic-orientation-sensor" id="ref-for-geomagnetic-orientation-sensor">Geomagnetic Orientation Sensor</a>
      <td><a data-link-type="dfn" href="#accelerometer" id="ref-for-accelerometer④">Accelerometer</a>, <a data-link-type="dfn" href="#magnetometer-magnetometers" id="ref-for-magnetometer-magnetometers③">Magnetometer</a>, MUST NOT USE <a data-link-type="dfn" href="#gyroscope" id="ref-for-gyroscope③">Gyroscope</a>
     <tr>
      <td><a data-link-type="dfn" href="#gravity-sensor" id="ref-for-gravity-sensor①">Gravity Sensor</a>
      <td><a data-link-type="dfn" href="#accelerometer" id="ref-for-accelerometer⑤">Accelerometer</a>, <a data-link-type="dfn" href="#gyroscope" id="ref-for-gyroscope④">Gyroscope</a>
     <tr>
      <td><a data-link-type="dfn" href="#linear-acceleration-sensor" id="ref-for-linear-acceleration-sensor①">Linear Acceleration Sensor</a>
      <td><a data-link-type="dfn" href="#accelerometer" id="ref-for-accelerometer⑥">Accelerometer</a>, AND EITHER <a data-link-type="dfn" href="#gyroscope" id="ref-for-gyroscope⑤">Gyroscope</a> OR <a data-link-type="dfn" href="#magnetometer-magnetometers" id="ref-for-magnetometer-magnetometers④">Magnetometer</a>
   </table>
   <h3 class="heading settled" data-level="4.2" id="pass-filters"><span class="secno">4.2. </span><span class="content">Low and high pass filters</span><a class="self-link" href="#pass-filters"></a></h3>
   <p>As mentioned earlier, it is possible to remove noise (high or low frequency) using
low and high pass filters. As the names say, the filters let low or high frequencies
pass and thus cut of, or minimize, the effect of unwanted frequencies.</p>
   <h4 class="heading settled" data-level="4.2.1" id="low-pass-filters"><span class="secno">4.2.1. </span><span class="content">Low-pass filter</span><a class="self-link" href="#low-pass-filters"></a></h4>
   <p>A common way to create a <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="low-pass-filter">low-pass filter</dfn> is to only use a percentage of
the latest value and take the rest from the existing value. In a way this means that
the filter remembers common values and thus smoothens out uncommon values which most
often are a result of noise. As it uses a big percentage of the existing value, this
solution introduces a delay in registering the actual events.</p>
   <div class="example" id="example-f3515ccc">
    <a class="self-link" href="#example-f3515ccc"></a> 
<pre class="highlight"><c- a>class</c-> LowPassFilterData <c- p>{</c->
  <c- kr>constructor</c-><c- p>(</c->reading<c- p>,</c-> bias<c- p>)</c-> <c- p>{</c->
    Object<c- p>.</c->assign<c- p>(</c-><c- k>this</c-><c- p>,</c-> <c- p>{</c-> x<c- o>:</c-> reading<c- p>.</c->x<c- p>,</c-> y<c- o>:</c-> reading<c- p>.</c->y<c- p>,</c-> z<c- o>:</c-> reading<c- p>.</c->z <c- p>});</c->
    <c- k>this</c-><c- p>.</c->bias <c- o>=</c-> bias<c- p>;</c->
  <c- p>}</c->

  update<c- p>(</c->reading<c- p>)</c-> <c- p>{</c->
    <c- k>this</c-><c- p>.</c->x <c- o>=</c-> <c- k>this</c-><c- p>.</c->x <c- o>*</c-> <c- k>this</c-><c- p>.</c->bias <c- o>+</c-> reading<c- p>.</c->x <c- o>*</c-> <c- p>(</c-><c- mf>1</c-> <c- o>-</c-> <c- k>this</c-><c- p>.</c->bias<c- p>);</c->
    <c- k>this</c-><c- p>.</c->y <c- o>=</c-> <c- k>this</c-><c- p>.</c->y <c- o>*</c-> <c- k>this</c-><c- p>.</c->bias <c- o>+</c-> reading<c- p>.</c->y <c- o>*</c-> <c- p>(</c-><c- mf>1</c-> <c- o>-</c-> <c- k>this</c-><c- p>.</c->bias<c- p>);</c->
    <c- k>this</c-><c- p>.</c->z <c- o>=</c-> <c- k>this</c-><c- p>.</c->z <c- o>*</c-> <c- k>this</c-><c- p>.</c->bias <c- o>+</c-> reading<c- p>.</c->z <c- o>*</c-> <c- p>(</c-><c- mf>1</c-> <c- o>-</c-> <c- k>this</c-><c- p>.</c->bias<c- p>);</c->
  <c- p>}</c->
<c- p>};</c->

<c- a>const</c-> accl <c- o>=</c-> <c- ow>new</c-> Accelerometer<c- p>({</c-> frequency<c- o>:</c-> <c- mf>20</c-> <c- p>});</c->
              
<c- c1>// Isolate gravity with low-pass filter.</c->
<c- a>const</c-> filter <c- o>=</c-> <c- ow>new</c-> LowPassFilterData<c- p>(</c->accl<c- p>,</c-> <c- mf>0.8</c-><c- p>);</c->

accl<c- p>.</c->onreading <c- o>=</c-> <c- p>()</c-> <c- p>=></c-> <c- p>{</c->
  filter<c- p>.</c->update<c- p>(</c->accl<c- p>);</c-> <c- c1>// Pass latest values through filter.</c->
  console<c- p>.</c->log<c- p>(</c-><c- sb>`Isolated gravity (</c-><c- si>${</c->filter<c- p>.</c->x<c- si>}</c-><c- sb>, </c-><c- si>${</c->filter<c- p>.</c->y<c- si>}</c-><c- sb>, </c-><c- si>${</c->filter<c- p>.</c->z<c- si>}</c-><c- sb>)`</c-><c- p>);</c->
<c- p>}</c->

accl<c- p>.</c->start<c- p>();</c->
</pre>
   </div>
   <h4 class="heading settled" data-level="4.2.2" id="high-pass-filters"><span class="secno">4.2.2. </span><span class="content">High-pass filter</span><a class="self-link" href="#high-pass-filters"></a></h4>
   <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="high-pass-filter">High-pass filter</dfn> works like a <a data-link-type="dfn" href="#low-pass-filter" id="ref-for-low-pass-filter③">low-pass filter</a>, but allows only high frequencies to pass through.</p>
   <p>This can be useful to get rid of the drift which builds up over time
with <a data-link-type="dfn" href="#gyroscope" id="ref-for-gyroscope⑥">gyroscope</a> readings.</p>
   <div class="example" id="example-ab2bf684">
    <a class="self-link" href="#example-ab2bf684"></a> 
<pre class="highlight"><c- a>class</c-> HighPassFilterData <c- p>{</c->
  <c- kr>constructor</c-><c- p>(</c->reading<c- p>,</c-> cutoffFrequency<c- p>)</c-> <c- p>{</c->
    Object<c- p>.</c->assign<c- p>(</c-><c- k>this</c-><c- p>,</c-> <c- p>{</c-> x<c- o>:</c-> reading<c- p>.</c->x<c- p>,</c-> y<c- o>:</c-> reading<c- p>.</c->y<c- p>,</c-> z<c- o>:</c-> reading<c- p>.</c->z <c- p>});</c->
    <c- k>this</c-><c- p>.</c->cutoff <c- o>=</c-> cutoffFrequency<c- p>;</c->
    <c- k>this</c-><c- p>.</c->timestamp <c- o>=</c-> reading<c- p>.</c->timestamp<c- p>;</c->
  <c- p>}</c->

  update<c- p>(</c->reading<c- p>)</c-> <c- p>{</c->
    <c- a>let</c-> dt <c- o>=</c-> reading<c- p>.</c->timestamp <c- o>-</c-> <c- k>this</c-><c- p>.</c->timestamp <c- o>/</c-> <c- mf>1000</c-><c- p>;</c->
    <c- k>this</c-><c- p>.</c->timestamp <c- o>=</c-> reading<c- p>.</c->timestamp<c- p>;</c->

    <c- k>for</c-> <c- p>(</c-><c- a>let</c-> i <c- k>of</c-> <c- p>[</c-><c- u>"x"</c-><c- p>,</c-> <c- u>"y"</c-><c- p>,</c-> <c- u>"z"</c-><c- p>])</c-> <c- p>{</c->
      <c- a>let</c-> alpha <c- o>=</c-> <c- k>this</c-><c- p>.</c->cutoff <c- o>/</c-> <c- p>(</c-><c- k>this</c-><c- p>.</c->cutoff <c- o>+</c-> dt<c- p>);</c->
      <c- k>this</c-><c- p>[</c->i<c- p>]</c-> <c- o>=</c-> <c- k>this</c-><c- p>[</c->i<c- p>]</c-> <c- o>+</c-> alpha <c- o>*</c-> <c- p>(</c->reading<c- p>[</c->i<c- p>]</c-> <c- o>-</c-> <c- k>this</c-><c- p>[</c->i<c- p>]);</c->
    <c- p>}</c->
  <c- p>}</c->
<c- p>};</c->

<c- a>const</c-> gyro <c- o>=</c-> <c- ow>new</c-> Gyroscope<c- p>({</c-> frequency<c- o>:</c-> <c- mf>20</c-> <c- p>});</c->
              
<c- c1>// Remove drift with a  high pass filter.</c->
<c- a>const</c-> filter <c- o>=</c-> <c- ow>new</c-> HighPassFilterData<c- p>(</c->gyro<c- p>,</c-> <c- mf>0.8</c-><c- p>);</c->

gyro<c- p>.</c->onreading <c- o>=</c-> <c- p>()</c-> <c- p>=></c-> <c- p>{</c->
  filter<c- p>.</c->update<c- p>(</c->gyro<c- p>);</c-> <c- c1>// Pass latest values through filter.</c->
  console<c- p>.</c->log<c- p>(</c-><c- sb>`Steady gyroscope (</c-><c- si>${</c->filter<c- p>.</c->x<c- si>}</c-><c- sb>, </c-><c- si>${</c->filter<c- p>.</c->y<c- si>}</c-><c- sb>, </c-><c- si>${</c->filter<c- p>.</c->z<c- si>}</c-><c- sb>)`</c-><c- p>);</c->
<c- p>}</c->

gyro<c- p>.</c->start<c- p>();</c->
</pre>
   </div>
   <h3 class="heading settled" data-level="4.3" id="absolute-orientation"><span class="secno">4.3. </span><span class="content">Absolute Orientation Sensor</span><a class="self-link" href="#absolute-orientation"></a></h3>
   <p>As mentioned before, the <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="absolute-orientation-sensor">Absolute Orientation Sensor</dfn>, is one of the common use-cases of a <a data-link-type="dfn" href="#magnetometer-magnetometers" id="ref-for-magnetometer-magnetometers⑤">magnetometer</a>, and is a sensor representing an orientation stationary (fixed to the magnetic
field vector and <a data-link-type="dfn" href="https://w3c.github.io/accelerometer#gravity" id="ref-for-gravity①⓪">gravity</a> vector) to the Earth plane. The <a data-link-type="dfn" href="https://w3c.github.io/orientation-sensor#absoluteorientationsensor-interface" id="ref-for-absoluteorientationsensor-interface">AbsoluteOrientationSensor interface</a> is defined in <a data-link-type="biblio" href="#biblio-orientation-sensor" title="Orientation Sensor">[ORIENTATION-SENSOR]</a> specification.</p>
   <p>An absolute orientation sensor can be useful for game controls such as a ball-in-a-maze puzzle, or
for a head-mounted display where you want to be able to rotate the display and look in all
directions.</p>
   <p>As the reference frame of an absolute orientation sensor is stationary, it is not useful as a
controller for say a driving game on a phone, as it would not allow you to move around,
even slightly or slowly, without affecting your driving direction.
(See <a data-link-type="dfn" href="#relative-orientation-sensor" id="ref-for-relative-orientation-sensor①">Relative Orientation Sensor</a>).</p>
   <p>The orientation vector of the <a data-link-type="dfn" href="#absolute-orientation-sensor" id="ref-for-absolute-orientation-sensor①">Absolute Orientation Sensor</a>, can be calculated in the following way:</p>
   <p>As the <a data-link-type="dfn" href="#accelerometer" id="ref-for-accelerometer⑦">Accelerometer</a> is an <a data-link-type="dfn" href="#inertial-frame-sensor" id="ref-for-inertial-frame-sensor">inertial-frame sensor</a>, the <a data-link-type="dfn" href="https://w3c.github.io/accelerometer#gravity" id="ref-for-gravity①①">gravity</a> vector will point
towards the sky when the device is mostly stationary, and as long as the device is not in free fall,
there is enough vector length to project the <a data-link-type="dfn" href="https://w3c.github.io/magnetometer#magnetic-field" id="ref-for-magnetic-field③">magnetic field</a> vector onto the ground plane.</p>
   <p class="note" role="note"><span class="marker">Note,</span> this will fail at the magnetic poles as the <a data-link-type="dfn" href="https://w3c.github.io/magnetometer#magnetic-field" id="ref-for-magnetic-field④">magnetic field</a> vector will point mostly in
the opposite direction as the <a data-link-type="dfn" href="https://w3c.github.io/accelerometer#gravity" id="ref-for-gravity①②">gravity</a> vector and generally be very unreliable.</p>
   <p>By taking the cross product between the the <a data-link-type="dfn" href="https://w3c.github.io/magnetometer#magnetic-field" id="ref-for-magnetic-field⑤">magnetic field</a> vector and <a data-link-type="dfn" href="https://w3c.github.io/accelerometer#gravity" id="ref-for-gravity①③">gravity</a> vector
(see <a data-link-type="dfn" href="#gravity-sensor" id="ref-for-gravity-sensor②">Gravity Sensor</a>), we get a vector which points East on the ground plane, using the right hand rule.</p>
   <p>Now if we take the cross product between the <a data-link-type="dfn" href="https://w3c.github.io/accelerometer#gravity" id="ref-for-gravity①④">gravity</a> vector and the newly found East vector, the resulting
vector will point in the northern direction towards the Earth’s <a data-link-type="dfn" href="https://w3c.github.io/magnetometer#magnetic-field" id="ref-for-magnetic-field⑥">magnetic field</a>.</p>
   <p>The illustration below represents the case where the device is at rest and y-axis points towards the
North. The reading from the <a data-link-type="dfn" href="#magnetometer-magnetometers" id="ref-for-magnetometer-magnetometers⑥">Magnetometer</a> is {x: 0, y: 11, z: -16} and <a data-link-type="dfn" href="#accelerometer" id="ref-for-accelerometer⑧">Accelerometer</a> reports
{x: 0.11, y: 0.07, z: 9.81} <a data-link-type="dfn" href="https://w3c.github.io/accelerometer#acceleration" id="ref-for-acceleration">acceleration</a>. The uG is a unit vector representing the <a data-link-type="dfn" href="https://w3c.github.io/accelerometer#gravity" id="ref-for-gravity①⑤">gravity</a>,
uB represents <a data-link-type="dfn" href="https://w3c.github.io/magnetometer#magnetic-field" id="ref-for-magnetic-field⑦">magnetic field</a> vector, uE = uB × uG and points East. The uN = uG × uE points to
the northern direction.</p>
   <p><img alt="OrientationSensor fusion." src="images/orientation_fusion.png" srcset="images/orientation_fusion.svg" style="display: block;margin: auto;"></p>
   <p>That means an <a data-link-type="dfn" href="#absolute-orientation-sensor" id="ref-for-absolute-orientation-sensor②">Absolute Orientation Sensor</a> is a fusion sensor of the <a data-link-type="dfn" href="#magnetometer-magnetometers" id="ref-for-magnetometer-magnetometers⑦">Magnetometer</a> and the <a data-link-type="dfn" href="#accelerometer" id="ref-for-accelerometer⑨">Accelerometer</a>, and potentially the <a data-link-type="dfn" href="#gyroscope" id="ref-for-gyroscope⑦">Gyroscope</a> for better isolated <a data-link-type="dfn" href="https://w3c.github.io/accelerometer#gravity" id="ref-for-gravity①⑥">gravity</a> (see <a data-link-type="dfn" href="#gravity-sensor" id="ref-for-gravity-sensor③">Gravity Sensor</a>).</p>
   <h3 class="heading settled" data-level="4.4" id="geomagnetic-orientation"><span class="secno">4.4. </span><span class="content">Geomagnetic Orientation Sensor</span><a class="self-link" href="#geomagnetic-orientation"></a></h3>
   <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="geomagnetic-orientation-sensor">Geomagnetic Orientation Sensor</dfn>, is like a <a data-link-type="dfn" href="#absolute-orientation-sensor" id="ref-for-absolute-orientation-sensor③">Absolute Orientation Sensor</a>, but
doesn’t use the <a data-link-type="dfn" href="#gyroscope" id="ref-for-gyroscope⑧">Gyroscope</a> which means it uses less power. This also means that it
is more sensitive to shakes and movement.</p>
   <p>As the main use-case for a <a data-link-type="dfn" href="#geomagnetic-orientation-sensor" id="ref-for-geomagnetic-orientation-sensor①">Geomagnetic Orientation Sensor</a> is to create a compass, or use
compass direction within a mapping application, this is not much of a problem since people
usually hold the device steady for these use-cases.</p>
   <p>The actual <i>heading</i> (N, S, E, W) can be found by adjusting the rotation vector with
the local <i>declination compensation</i> calculated from the current geolocation position.</p>
   <p>As the sensor uses the <a data-link-type="dfn" href="#accelerometer" id="ref-for-accelerometer①⓪">accelerometer</a> to get a more steady heading, like when walking,
the rotation vector is projected to the plane perpendicular to the <a data-link-type="dfn" href="https://w3c.github.io/accelerometer#gravity" id="ref-for-gravity①⑦">gravity</a> vector (as isolated
from the <a data-link-type="dfn" href="#accelerometer" id="ref-for-accelerometer①①">accelerometer</a>) which more or less represents the ground plane. This also means that
if you are interested in the actual orientation of the <a data-link-type="dfn" href="https://w3c.github.io/accelerometer#gravity" id="ref-for-gravity①⑧">gravity</a> vector, then use the <a data-link-type="dfn" href="#magnetometer-magnetometers" id="ref-for-magnetometer-magnetometers⑧">magnetometer</a> directly instead.</p>
   <h3 class="heading settled" data-level="4.5" id="relative-orientation"><span class="secno">4.5. </span><span class="content">Relative Orientation Sensor</span><a class="self-link" href="#relative-orientation"></a></h3>
   <p>On most sensor hubs, <a data-link-type="dfn" href="https://w3c.github.io/accelerometer#gravity" id="ref-for-gravity①⑨">gravity</a> is isolated from the <a data-link-type="dfn" href="#accelerometer" id="ref-for-accelerometer①②">accelerometer</a> using the <a data-link-type="dfn" href="#gyroscope" id="ref-for-gyroscope⑨">gyroscope</a>,
and the <a data-link-type="dfn" href="https://w3c.github.io/accelerometer#linear-acceleration" id="ref-for-linear-acceleration②">linear acceleration</a> is isolated by removing the isolated <a data-link-type="dfn" href="https://w3c.github.io/accelerometer#gravity" id="ref-for-gravity②⓪">gravity</a>, from the <a data-link-type="dfn" href="#accelerometer" id="ref-for-accelerometer①③">accelerometer</a> values.</p>
   <p>This avoids the delay which low and high pass filters introduce.</p>
   <p>One way of doing this is using a Kalman filter or <a data-link-type="dfn" href="#complementary-filter" id="ref-for-complementary-filter">complementary filter</a>, which leads us to
the <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="relative-orientation-sensor">Relative Orientation Sensor</dfn>. As a <a data-link-type="dfn" href="#complementary-filter" id="ref-for-complementary-filter①">complementary filter</a> yields quite good
results and is easy to implement in hardware, this is a common solution.</p>
   <h4 class="heading settled" data-level="4.5.1" id="complementary-filters"><span class="secno">4.5.1. </span><span class="content">Complementary filter</span><a class="self-link" href="#complementary-filters"></a></h4>
   <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="complementary-filter">complementary filter</dfn> can be thought of as a <a data-link-type="dfn" href="#low-pass-filter" id="ref-for-low-pass-filter④">low-pass filter</a> and <a data-link-type="dfn" href="#high-pass-filter" id="ref-for-high-pass-filter②">high-pass filter</a> in one,
complementing the <a data-link-type="dfn" href="#gyroscope" id="ref-for-gyroscope①⓪">gyroscope</a> values with the <a data-link-type="dfn" href="#accelerometer" id="ref-for-accelerometer①④">accelerometer</a> values:</p>
   <p>θ<sub>n</sub> = α × (θ<sub>n-1</sub> + ω × ∂t) + (1.0 - α) × a</p>
   <p>With α being the weight constant, a the acceleration from <a data-link-type="dfn" href="#accelerometer" id="ref-for-accelerometer①⑤">accelerometer</a>, ω the <a data-link-type="dfn" href="https://w3c.github.io/gyroscope#angular-velocity" id="ref-for-angular-velocity④">angular
velocity</a> from <a data-link-type="dfn" href="#gyroscope" id="ref-for-gyroscope①①">gyroscope</a> and ∂t being the time between measurements.</p>
   <p>A common value for α is 0.98, which means that 98% of the weight lays on the <a data-link-type="dfn" href="#gyroscope" id="ref-for-gyroscope①②">gyroscope</a> measurements.</p>
   <div class="example" id="example-29d9fc78">
    <a class="self-link" href="#example-29d9fc78"></a> Manually calculate the relative orientation in Euler angles (radian) using a <a data-link-type="dfn" href="#complementary-filter" id="ref-for-complementary-filter②">complementary filter</a>. 
    <p>The <a data-link-type="dfn" href="#gyroscope" id="ref-for-gyroscope①③">gyroscope</a> measures <i><a data-link-type="dfn" href="https://w3c.github.io/gyroscope#angular-velocity" id="ref-for-angular-velocity⑤">angular velocity</a></i>, so by multiplying with the time difference,
  we get the <i>change of angle</i>. This change is always calculated relative to the current device
  position, so we need to use the <a data-link-type="dfn" href="#accelerometer" id="ref-for-accelerometer①⑥">accelerometer</a>, which includes <a data-link-type="dfn" href="https://w3c.github.io/accelerometer#gravity" id="ref-for-gravity②①">gravity</a>, to calibrate this
  to the ground plane.</p>
    <p>The values from the <a data-link-type="dfn" href="#accelerometer" id="ref-for-accelerometer①⑦">accelerometer</a> bring no information about the heading (alpha, the
  rotation around z), so we don’t include that in our alpha component. On the other hand,
  the <a data-link-type="dfn" href="#accelerometer" id="ref-for-accelerometer①⑧">accelerometer</a> (due to <a data-link-type="dfn" href="https://w3c.github.io/accelerometer#gravity" id="ref-for-gravity②②">gravity</a>) provides information on how the device is held around
  the x and y axis (beta and gamma).</p>
    <p>When there is no or little movement, the vector obtained from the <a data-link-type="dfn" href="#accelerometer" id="ref-for-accelerometer①⑨">accelerometer</a> reading will contribute more to the (alpha, beta, gamma) angles than the <a data-link-type="dfn" href="#gyroscope" id="ref-for-gyroscope①④">gyroscope</a>.</p>
    <p>As values from a steady <a data-link-type="dfn" href="#accelerometer" id="ref-for-accelerometer②⓪">accelerometer</a> represent the <a data-link-type="dfn" href="https://w3c.github.io/accelerometer#gravity" id="ref-for-gravity②③">gravity</a> vector, and we don’t
  include the z component in the alpha, the result of this is that the orientation will
  just follow the <a data-link-type="dfn" href="#gyroscope" id="ref-for-gyroscope①⑤">gyroscope</a> and be stable. But as the origin of the heading depends on 
  the device position at start this a <i>device-relative orientation sensor</i>.</p>
<pre class="highlight"><c- a>const</c-> options <c- o>=</c-> <c- p>{</c-> frequency<c- o>:</c-> <c- mf>50</c-> <c- p>};</c->

<c- a>const</c-> accl <c- o>=</c-> <c- ow>new</c-> Accelerometer<c- p>(</c->options<c- p>);</c->
<c- a>const</c-> gyro <c- o>=</c-> <c- ow>new</c-> Gyroscope<c- p>(</c->options<c- p>);</c->

<c- a>let</c-> timestamp <c- o>=</c-> <c- kc>null</c-><c- p>;</c->
<c- a>let</c-> alpha <c- o>=</c-> beta <c- o>=</c-> gamma <c- o>=</c-> <c- mf>0</c-><c- p>;</c->
<c- a>const</c-> bias <c- o>=</c-> <c- mf>0.98</c-><c- p>;</c->

gyro<c- p>.</c->onreading <c- o>=</c-> <c- p>()</c-> <c- p>=></c-> <c- p>{</c->
   <c- a>let</c-> dt <c- o>=</c-> timestamp <c- o>?</c-> <c- p>(</c->gyro<c- p>.</c->timestamp <c- o>-</c-> timestamp<c- p>)</c-> <c- o>/</c-> <c- mf>1000</c-> <c- o>:</c-> <c- mf>0</c-><c- p>;</c->
   timestamp <c- o>=</c-> gyro<c- p>.</c->timestamp<c- p>;</c->

   <c- c1>// Treat the acceleration vector as an orientation vector by normalizing it.</c->
   <c- c1>// Keep in mind that the if the device is flipped, the vector will just be</c->
   <c- c1>// pointing in the other direction, so we have no way to know from the</c->
   <c- c1>// accelerometer data which way the device is oriented.</c->
   <c- a>const</c-> norm <c- o>=</c-> Math<c- p>.</c->sqrt<c- p>(</c->accl<c- p>.</c->x <c- o>**</c-> <c- mf>2</c-> <c- o>+</c-> accl<c- p>.</c->y <c- o>**</c-> <c- mf>2</c-> <c- o>+</c-> accl<c- p>.</c->z <c- o>**</c-> <c- mf>2</c-><c- p>);</c->

   <c- c1>// As we only can cover half (PI rad) of the full spectrum (2*PI rad) we multiply</c->
   <c- c1>// the unit vector with values from [-1, 1] with PI/2, covering [-PI/2, PI/2].</c->
   <c- a>const</c-> scale <c- o>=</c-> Math<c- p>.</c->PI <c- o>/</c-> <c- mf>2</c-><c- p>;</c->

   alpha <c- o>=</c-> alpha <c- o>+</c-> gyro<c- p>.</c->z <c- o>*</c-> dt<c- p>;</c->
   beta <c- o>=</c-> bias <c- o>*</c-> <c- p>(</c->beta <c- o>+</c-> gyro<c- p>.</c->x <c- o>*</c-> dt<c- p>)</c-> <c- o>+</c-> <c- p>(</c-><c- mf>1.0</c-> <c- o>-</c-> bias<c- p>)</c-> <c- o>*</c-> <c- p>(</c->accl<c- p>.</c->x <c- o>*</c-> scale <c- o>/</c-> norm<c- p>);</c->
   gamma <c- o>=</c-> bias <c- o>*</c-> <c- p>(</c->gamma <c- o>+</c-> gyro<c- p>.</c->y <c- o>*</c-> dt<c- p>)</c-> <c- o>+</c-> <c- p>(</c-><c- mf>1.0</c-> <c- o>-</c-> bias<c- p>)</c-> <c- o>*</c-> <c- p>(</c->accl<c- p>.</c->y <c- o>*</c-> <c- o>-</c->scale <c- o>/</c-> norm<c- p>);</c->

   <c- c1>// Do something with Euler angles (alpha, beta, gamma).</c->
 <c- p>};</c->

 accl<c- p>.</c->start<c- p>();</c->
 gyro<c- p>.</c->start<c- p>();</c->
</pre>
   </div>
   <div class="example" id="example-c2e7c2b3">
    <a class="self-link" href="#example-c2e7c2b3"></a> An device-adjusting, relative orientation sensor. 
    <p>From the above example, we notice that the alpha represented the initial heading
  orientation. We also know that this heading might drift over time due to being
  based on the <a data-link-type="dfn" href="#gyroscope" id="ref-for-gyroscope①⑥">gyroscope</a>.</p>
    <p>In some situations you might want the orientation to drift towards your current
  position. This can be useful for a controller inside a virtual reality
  environment, where you want a car to follow the heading of your controller, but you
  might move and turn around while playing. That would more or less work like driving
  a real car.</p>
    <p>Changing one line in the above accomplishes that.</p>
<pre class="highlight"><c- a>const</c-> zeroBias <c- o>=</c-> <c- mf>0.02</c-><c- p>;</c->
alpha <c- o>=</c-> <c- p>(</c-><c- mf>1</c-> <c- o>-</c-> zeroBias<c- p>)</c-> <c- o>*</c-> <c- p>(</c->alpha <c- o>+</c-> gyro<c- p>.</c->z <c- o>*</c-> dt<c- p>);</c->
</pre>
    <p>With the above 2% of the alpha consists of the value 0. Thus, when the device is being
  held more or less steady, the heading will move towards 0, meaning being adjusted to
  your current device position and not positioned according to the surroundings.</p>
    <p>This example shows how useful manual fusion can be at times.</p>
   </div>
   <h3 class="heading settled" data-level="4.6" id="gravity-and-linear-acceleration"><span class="secno">4.6. </span><span class="content">Gravity and Linear Acceleration Sensor</span><a class="self-link" href="#gravity-and-linear-acceleration"></a></h3>
   <p>The <a data-link-type="dfn" href="#complementary-filter" id="ref-for-complementary-filter③">complementary filter</a> used above is quite good at isolating the <a data-link-type="dfn" href="https://w3c.github.io/accelerometer#gravity" id="ref-for-gravity②④">gravity</a>, and most sensor
hubs thus isolate <i><a data-link-type="dfn" href="https://w3c.github.io/accelerometer#gravity" id="ref-for-gravity②⑤">gravity</a></i> from the <a data-link-type="dfn" href="#accelerometer" id="ref-for-accelerometer②①">accelerometer</a> using the <a data-link-type="dfn" href="#gyroscope" id="ref-for-gyroscope①⑦">gyroscope</a>, and the <a data-link-type="dfn" href="https://w3c.github.io/accelerometer#linear-acceleration" id="ref-for-linear-acceleration③">linear acceleration</a> is isolated by removing the isolated <a data-link-type="dfn" href="https://w3c.github.io/accelerometer#gravity" id="ref-for-gravity②⑥">gravity</a>, from the <a data-link-type="dfn" href="#accelerometer" id="ref-for-accelerometer②②">accelerometer</a> values.</p>
   <p>This also means that the <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="linear-acceleration-sensor">Linear Acceleration Sensor</dfn> and the <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="gravity-sensor">Gravity Sensor</dfn> as exposed by most sensor hubs are most likely fusion sensors.</p>
   <p><a data-link-type="dfn" href="https://w3c.github.io/accelerometer#gravity" id="ref-for-gravity②⑦">Gravity</a> can also be removed from a <a data-link-type="dfn" href="#linear-acceleration-sensor" id="ref-for-linear-acceleration-sensor②">linear acceleration sensor</a> using a <a data-link-type="dfn" href="#magnetometer-magnetometers" id="ref-for-magnetometer-magnetometers⑨">magnetometer</a>,
as the <a data-link-type="dfn" href="https://w3c.github.io/magnetometer#magnetic-field" id="ref-for-magnetic-field⑧">magnetic field</a> vector is more or less stable.</p>
   <p>The <a data-link-type="dfn" href="https://w3c.github.io/accelerometer#linearaccelerationsensor-interface" id="ref-for-linearaccelerationsensor-interface">LinearAccelerationSensor interface</a> and <a data-link-type="dfn" href="https://w3c.github.io/accelerometer#gravitysensor-interface" id="ref-for-gravitysensor-interface">GravitySensor interface</a> are defined in <a data-link-type="biblio" href="#biblio-accelerometer" title="Accelerometer">[ACCELEROMETER]</a> specification.</p>
   <p class="note" role="note"><span class="marker">Note,</span> as the <a data-link-type="dfn" href="https://w3c.github.io/accelerometer#gravity" id="ref-for-gravity②⑧">gravity</a> changes with the frequency of the movements, i.e., 0 in falling direction
in free fall, you can imagine that <a data-link-type="dfn" href="https://w3c.github.io/accelerometer#linear-acceleration" id="ref-for-linear-acceleration④">linear acceleration</a> will be quite imprecise if you are
trying to detect a shake, so keep that in mind.</p>
   <h3 class="heading settled" data-level="4.7" id="usecases-and-requirements"><span class="secno">4.7. </span><span class="content">Use Cases and Requirements</span><a class="self-link" href="#usecases-and-requirements"></a></h3>
   <p>Advanced motion sensor use-cases could have requirements for accurate sensor readings, high
sampling rates at which hardware sensor operates, and reading delivery rate that is preferable
for particular application.</p>
   <p>Motion sensors can be used for variety of advanced use-cases, such as:</p>
   <ul>
    <li data-md>
     <p>Virtual and augmented reality HMD tracking <a data-link-type="biblio" href="#biblio-hmdtracking" title="Head tracking for the Oculus Rift">[HMDTRACKING]</a></p>
    <li data-md>
     <p>Sensor assisted indoor mapping and navigation <a data-link-type="biblio" href="#biblio-indoornav" title="Indoor positioning using sensor-fusion in android devices">[INDOORNAV]</a>, <a data-link-type="biblio" href="#biblio-ipin" title="Indoor positioning system based on sensor fusion for the blind and visually impaired">[IPIN]</a></p>
    <li data-md>
     <p>Photo and video capture stabilization <a data-link-type="biblio" href="#biblio-rollstabilizer" title="Digital video stabilization and rolling shutter correction using gyroscopes">[ROLLSTABILIZER]</a>, <a data-link-type="biblio" href="#biblio-videostabilizer" title="Stabilizing cell phone video using inertial measurement sensors">[VIDEOSTABILIZER]</a></p>
    <li data-md>
     <p>Games that require high-frequency sampling rates with high accuracy readings.</p>
    <li data-md>
     <p>3D scanning <a data-link-type="biblio" href="#biblio-3dscanning" title="Development of an innovative low-cost MARG sensors alignment and distortion compensation methodology for 3D scanning applications">[3DSCANNING]</a></p>
    <li data-md>
     <p>Advanced gesture recognition <a data-link-type="biblio" href="#biblio-memsgestures" title="MEMS Accelerometer Based Nonspecific-User Hand Gesture Recognition">[MEMSGESTURES]</a></p>
    <li data-md>
     <p>Step counting and monitoring of other physical activities <a data-link-type="biblio" href="#biblio-physmon" title="A Review of Accelerometry-Based Wearable Motion Detectors for Physical Activity Monitoring">[PHYSMON]</a></p>
   </ul>
   <p>The generic requirement for games or UI applications that use motion sensors is to have a new
sensor reading per rendered frame. The higher sampling rates in this case, will reduce latency,
thus improve user experience.</p>
   <p>In case of virtual reality HMD tracking, sensors might run at very high sampling rates
(up to several kHz) and minimize motion-to-photon latency by providing latest sensor reading
for every rendered frame at refresh rates of 75-120Hz.</p>
   <p>Indoor navigation or non-realtime video (image) stabilization applications could benefit from
collecting high accuracy sensor readings at high sampling rates (80-100Hz), so that data
processing algorithms have enough samples to provide accurate results.</p>
  </main>
  <script src="https://www.w3.org/scripts/TR/2021/fixup.js"></script>
  <h2 class="no-num no-ref heading settled" id="index"><span class="content">Index</span><a class="self-link" href="#index"></a></h2>
  <h3 class="no-num no-ref heading settled" id="index-defined-here"><span class="content">Terms defined by this specification</span><a class="self-link" href="#index-defined-here"></a></h3>
  <ul class="index">
   <li><a href="#absolute-orientation-sensor">Absolute Orientation Sensor</a><span>, in § 4.3</span>
   <li><a href="#accelerometer">accelerometer</a><span>, in § 3.1</span>
   <li><a href="#complementary-filter">complementary filter</a><span>, in § 4.5.1</span>
   <li><a href="#geomagnetic-orientation-sensor">Geomagnetic Orientation Sensor</a><span>, in § 4.4</span>
   <li><a href="#gravity-sensor">Gravity Sensor</a><span>, in § 4.6</span>
   <li><a href="#gyroscope">gyroscope</a><span>, in § 3.2</span>
   <li><a href="#high-pass-filter">High-pass filter</a><span>, in § 4.2.2</span>
   <li><a href="#inertial-frame-sensor">inertial-frame sensor</a><span>, in § 3.1</span>
   <li><a href="#linear-acceleration-sensor">Linear Acceleration Sensor</a><span>, in § 4.6</span>
   <li><a href="#low-pass-filter">low-pass filter</a><span>, in § 4.2.1</span>
   <li><a href="#magnetometer-magnetometers">Magnetometers</a><span>, in § 3.3</span>
   <li><a href="#relative-orientation-sensor">Relative Orientation Sensor</a><span>, in § 4.5</span>
   <li><a href="#tilt-compensation">tilt compensation</a><span>, in § 3.3</span>
  </ul>
  <h3 class="no-num no-ref heading settled" id="index-defined-elsewhere"><span class="content">Terms defined by reference</span><a class="self-link" href="#index-defined-elsewhere"></a></h3>
  <ul class="index">
   <li>
    <a data-link-type="biblio">[ACCELEROMETER]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="95f495ac">acceleration</span>
     <li><span class="dfn-paneled" id="0f6f1720">accelerometer interface</span>
     <li><span class="dfn-paneled" id="71940125">gravity</span>
     <li><span class="dfn-paneled" id="7bbb090d">gravitysensor interface</span>
     <li><span class="dfn-paneled" id="40650566">linear acceleration</span>
     <li><span class="dfn-paneled" id="61f605ab">linearaccelerationsensor interface</span>
    </ul>
   <li>
    <a data-link-type="biblio">[GENERIC-SENSOR]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="3586cb68">calibration</span>
    </ul>
   <li>
    <a data-link-type="biblio">[GYROSCOPE]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="24bb0f9e">angular velocity</span>
     <li><span class="dfn-paneled" id="4fe17af5">gyroscope interface</span>
    </ul>
   <li>
    <a data-link-type="biblio">[MAGNETOMETER]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="84d9dd12">magnetic field</span>
     <li><span class="dfn-paneled" id="9c6c688b">magnetometer interface</span>
    </ul>
   <li>
    <a data-link-type="biblio">[ORIENTATION-SENSOR]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="64411963">absoluteorientationsensor interface</span>
    </ul>
  </ul>
  <h2 class="no-num no-ref heading settled" id="references"><span class="content">References</span><a class="self-link" href="#references"></a></h2>
  <h3 class="no-num no-ref heading settled" id="normative"><span class="content">Normative References</span><a class="self-link" href="#normative"></a></h3>
  <dl>
   <dt id="biblio-accelerometer">[ACCELEROMETER]
   <dd>Anssi Kostiainen. <a href="https://w3c.github.io/accelerometer/"><cite>Accelerometer</cite></a>. URL: <a href="https://w3c.github.io/accelerometer/">https://w3c.github.io/accelerometer/</a>
   <dt id="biblio-generic-sensor">[GENERIC-SENSOR]
   <dd>Rick Waldron. <a href="https://w3c.github.io/sensors/"><cite>Generic Sensor API</cite></a>. URL: <a href="https://w3c.github.io/sensors/">https://w3c.github.io/sensors/</a>
   <dt id="biblio-gyroscope">[GYROSCOPE]
   <dd>Anssi Kostiainen. <a href="https://w3c.github.io/gyroscope/"><cite>Gyroscope</cite></a>. URL: <a href="https://w3c.github.io/gyroscope/">https://w3c.github.io/gyroscope/</a>
   <dt id="biblio-magnetometer">[MAGNETOMETER]
   <dd>Anssi Kostiainen; Rijubrata Bhaumik. <a href="https://w3c.github.io/magnetometer/"><cite>Magnetometer</cite></a>. URL: <a href="https://w3c.github.io/magnetometer/">https://w3c.github.io/magnetometer/</a>
   <dt id="biblio-orientation-sensor">[ORIENTATION-SENSOR]
   <dd>Mikhail Pozdnyakov; Alexander Shalamov; Kenneth Rohde Christiansen; Anssi Kostiainen. <a href="https://www.w3.org/TR/orientation-sensor/"><cite>Orientation Sensor</cite></a>. URL: <a href="https://www.w3.org/TR/orientation-sensor/">https://www.w3.org/TR/orientation-sensor/</a>
  </dl>
  <h3 class="no-num no-ref heading settled" id="informative"><span class="content">Informative References</span><a class="self-link" href="#informative"></a></h3>
  <dl>
   <dt id="biblio-3dscanning">[3DSCANNING]
   <dd>Grivon, Daniel, Enrico Vezzetti, and Maria Grazia Violante. <a href="http://porto.polito.it/2511714/"><cite>Development of an innovative low-cost MARG sensors alignment and distortion compensation methodology for 3D scanning applications</cite></a>. 2013. Informational. URL: <a href="http://porto.polito.it/2511714/">http://porto.polito.it/2511714/</a>
   <dt id="biblio-hmdtracking">[HMDTRACKING]
   <dd>LaValle, Steven M., et al.. <a href="http://msl.cs.illinois.edu/~lavalle/papers/LavYerKatAnt14.pdf"><cite>Head tracking for the Oculus Rift</cite></a>. 2014. Informational. URL: <a href="http://msl.cs.illinois.edu/~lavalle/papers/LavYerKatAnt14.pdf">http://msl.cs.illinois.edu/~lavalle/papers/LavYerKatAnt14.pdf</a>
   <dt id="biblio-indoornav">[INDOORNAV]
   <dd>Shala, Ubejd, and Angel Rodriguez. <a href="http://www.diva-portal.org/smash/record.jsf?pid=diva2%3A475619&amp;dswid=9050"><cite>Indoor positioning using sensor-fusion in android devices</cite></a>. 2011. Informational. URL: <a href="http://www.diva-portal.org/smash/record.jsf?pid=diva2%3A475619&amp;dswid=9050">http://www.diva-portal.org/smash/record.jsf?pid=diva2%3A475619&amp;dswid=9050</a>
   <dt id="biblio-ipin">[IPIN]
   <dd>Gallagher, Thomas, et al.. <a href="http://ieeexplore.ieee.org/abstract/document/6418882/"><cite>Indoor positioning system based on sensor fusion for the blind and visually impaired</cite></a>. 2012. Informational. URL: <a href="http://ieeexplore.ieee.org/abstract/document/6418882/">http://ieeexplore.ieee.org/abstract/document/6418882/</a>
   <dt id="biblio-memsgestures">[MEMSGESTURES]
   <dd>Xu, Ruize, Shengli Zhou, and Wen J. Li. <a href="http://ieeexplore.ieee.org/abstract/document/6009159/"><cite>MEMS Accelerometer Based Nonspecific-User Hand Gesture Recognition</cite></a>. 2012. Informational. URL: <a href="http://ieeexplore.ieee.org/abstract/document/6009159/">http://ieeexplore.ieee.org/abstract/document/6009159/</a>
   <dt id="biblio-physmon">[PHYSMON]
   <dd>Yang, Che-Chang, and Yeh-Liang Hsu. <a href="http://www.mdpi.com/1424-8220/10/8/7772/html"><cite>A Review of Accelerometry-Based Wearable Motion Detectors for Physical Activity Monitoring</cite></a>. 2010. Informational. URL: <a href="http://www.mdpi.com/1424-8220/10/8/7772/html">http://www.mdpi.com/1424-8220/10/8/7772/html</a>
   <dt id="biblio-rollstabilizer">[ROLLSTABILIZER]
   <dd>Karpenko, Alexandre, et al.. <a href="http://movement.stanford.edu/papers/stabilization/karpenko_gyro.pdf"><cite>Digital video stabilization and rolling shutter correction using gyroscopes</cite></a>. 2011. Informational. URL: <a href="http://movement.stanford.edu/papers/stabilization/karpenko_gyro.pdf">http://movement.stanford.edu/papers/stabilization/karpenko_gyro.pdf</a>
   <dt id="biblio-videostabilizer">[VIDEOSTABILIZER]
   <dd>Hanning, Gustav, et al.. <a href="http://ieeexplore.ieee.org/abstract/document/6130215/"><cite>Stabilizing cell phone video using inertial measurement sensors</cite></a>. 2011. Informational. URL: <a href="http://ieeexplore.ieee.org/abstract/document/6130215/">http://ieeexplore.ieee.org/abstract/document/6130215/</a>
  </dl>
<script>/* Boilerplate: script-dom-helper */
"use strict";
function query(sel) { return document.querySelector(sel); }

function queryAll(sel) { return [...document.querySelectorAll(sel)]; }

function iter(obj) {
	if(!obj) return [];
	var it = obj[Symbol.iterator];
	if(it) return it;
	return Object.entries(obj);
}

function mk(tagname, attrs, ...children) {
	const el = document.createElement(tagname);
	for(const [k,v] of iter(attrs)) {
		if(k.slice(0,3) == "_on") {
			const eventName = k.slice(3);
			el.addEventListener(eventName, v);
		} else if(k[0] == "_") {
			// property, not attribute
			el[k.slice(1)] = v;
		} else {
			if(v === false || v == null) {
        continue;
      } else if(v === true) {
        el.setAttribute(k, "");
        continue;
      } else {
  			el.setAttribute(k, v);
      }
		}
	}
	append(el, children);
	return el;
}

/* Create shortcuts for every known HTML element */
[
  "a",
  "abbr",
  "acronym",
  "address",
  "applet",
  "area",
  "article",
  "aside",
  "audio",
  "b",
  "base",
  "basefont",
  "bdo",
  "big",
  "blockquote",
  "body",
  "br",
  "button",
  "canvas",
  "caption",
  "center",
  "cite",
  "code",
  "col",
  "colgroup",
  "datalist",
  "dd",
  "del",
  "details",
  "dfn",
  "dialog",
  "div",
  "dl",
  "dt",
  "em",
  "embed",
  "fieldset",
  "figcaption",
  "figure",
  "font",
  "footer",
  "form",
  "frame",
  "frameset",
  "head",
  "header",
  "h1",
  "h2",
  "h3",
  "h4",
  "h5",
  "h6",
  "hr",
  "html",
  "i",
  "iframe",
  "img",
  "input",
  "ins",
  "kbd",
  "label",
  "legend",
  "li",
  "link",
  "main",
  "map",
  "mark",
  "meta",
  "meter",
  "nav",
  "nobr",
  "noscript",
  "object",
  "ol",
  "optgroup",
  "option",
  "output",
  "p",
  "param",
  "pre",
  "progress",
  "q",
  "s",
  "samp",
  "script",
  "section",
  "select",
  "small",
  "source",
  "span",
  "strike",
  "strong",
  "style",
  "sub",
  "summary",
  "sup",
  "table",
  "tbody",
  "td",
  "template",
  "textarea",
  "tfoot",
  "th",
  "thead",
  "time",
  "title",
  "tr",
  "u",
  "ul",
  "var",
  "video",
  "wbr",
  "xmp",
].forEach(tagname=>{
	mk[tagname] = (...args) => mk(tagname, ...args);
});

function* nodesFromChildList(children) {
	for(const child of children.flat(Infinity)) {
		if(child instanceof Node) {
			yield child;
		} else {
			yield new Text(child);
		}
	}
}
function append(el, ...children) {
	for(const child of nodesFromChildList(children)) {
		if(el instanceof Node) el.appendChild(child);
		else el.push(child);
	}
	return el;
}

function insertAfter(el, ...children) {
	for(const child of nodesFromChildList(children)) {
		el.parentNode.insertBefore(child, el.nextSibling);
	}
	return el;
}

function clearContents(el) {
	el.innerHTML = "";
	return el;
}

function parseHTML(markup) {
	if(markup.toLowerCase().trim().indexOf('<!doctype') === 0) {
		const doc = document.implementation.createHTMLDocument("");
		doc.documentElement.innerHTML = markup;
		return doc;
	} else {
		const el = mk.template({});
		el.innerHTML = markup;
		return el.content;
	}
}</script>
<script>/* Boilerplate: script-dfn-panel */
"use strict";
{
let dfnPanelData = {
"0f6f1720": {"dfnID":"0f6f1720","dfnText":"accelerometer interface","external":true,"refSections":[{"refs":[{"id":"ref-for-accelerometer-interface"}],"title":"3.1. Accelerometer"}],"url":"https://w3c.github.io/accelerometer#accelerometer-interface"},
"24bb0f9e": {"dfnID":"24bb0f9e","dfnText":"angular velocity","external":true,"refSections":[{"refs":[{"id":"ref-for-angular-velocity"},{"id":"ref-for-angular-velocity\u2460"},{"id":"ref-for-angular-velocity\u2461"}],"title":"3.2. Gyroscope"},{"refs":[{"id":"ref-for-angular-velocity\u2462"}],"title":"4. High-level Sensors"},{"refs":[{"id":"ref-for-angular-velocity\u2463"},{"id":"ref-for-angular-velocity\u2464"}],"title":"4.5.1. Complementary filter"}],"url":"https://w3c.github.io/gyroscope#angular-velocity"},
"3586cb68": {"dfnID":"3586cb68","dfnText":"calibration","external":true,"refSections":[{"refs":[{"id":"ref-for-calibration"}],"title":"3.2. Gyroscope"}],"url":"https://w3c.github.io/sensors#calibration"},
"40650566": {"dfnID":"40650566","dfnText":"linear acceleration","external":true,"refSections":[{"refs":[{"id":"ref-for-linear-acceleration"},{"id":"ref-for-linear-acceleration\u2460"}],"title":"3.1. Accelerometer"},{"refs":[{"id":"ref-for-linear-acceleration\u2461"}],"title":"4.5. Relative Orientation Sensor"},{"refs":[{"id":"ref-for-linear-acceleration\u2462"},{"id":"ref-for-linear-acceleration\u2463"}],"title":"4.6. Gravity and Linear Acceleration Sensor"}],"url":"https://w3c.github.io/accelerometer#linear-acceleration"},
"4fe17af5": {"dfnID":"4fe17af5","dfnText":"gyroscope interface","external":true,"refSections":[{"refs":[{"id":"ref-for-gyroscope-interface"}],"title":"3.2. Gyroscope"}],"url":"https://w3c.github.io/gyroscope#gyroscope-interface"},
"61f605ab": {"dfnID":"61f605ab","dfnText":"linearaccelerationsensor interface","external":true,"refSections":[{"refs":[{"id":"ref-for-linearaccelerationsensor-interface"}],"title":"4.6. Gravity and Linear Acceleration Sensor"}],"url":"https://w3c.github.io/accelerometer#linearaccelerationsensor-interface"},
"64411963": {"dfnID":"64411963","dfnText":"absoluteorientationsensor interface","external":true,"refSections":[{"refs":[{"id":"ref-for-absoluteorientationsensor-interface"}],"title":"4.3. Absolute Orientation Sensor"}],"url":"https://w3c.github.io/orientation-sensor#absoluteorientationsensor-interface"},
"71940125": {"dfnID":"71940125","dfnText":"gravity","external":true,"refSections":[{"refs":[{"id":"ref-for-gravity"},{"id":"ref-for-gravity\u2460"},{"id":"ref-for-gravity\u2461"},{"id":"ref-for-gravity\u2462"},{"id":"ref-for-gravity\u2463"},{"id":"ref-for-gravity\u2464"},{"id":"ref-for-gravity\u2465"},{"id":"ref-for-gravity\u2466"}],"title":"3.1. Accelerometer"},{"refs":[{"id":"ref-for-gravity\u2467"},{"id":"ref-for-gravity\u2468"}],"title":"3.3. Magnetometer"},{"refs":[{"id":"ref-for-gravity\u2460\u24ea"},{"id":"ref-for-gravity\u2460\u2460"},{"id":"ref-for-gravity\u2460\u2461"},{"id":"ref-for-gravity\u2460\u2462"},{"id":"ref-for-gravity\u2460\u2463"},{"id":"ref-for-gravity\u2460\u2464"},{"id":"ref-for-gravity\u2460\u2465"}],"title":"4.3. Absolute Orientation Sensor"},{"refs":[{"id":"ref-for-gravity\u2460\u2466"},{"id":"ref-for-gravity\u2460\u2467"}],"title":"4.4. Geomagnetic Orientation Sensor"},{"refs":[{"id":"ref-for-gravity\u2460\u2468"},{"id":"ref-for-gravity\u2461\u24ea"}],"title":"4.5. Relative Orientation Sensor"},{"refs":[{"id":"ref-for-gravity\u2461\u2460"},{"id":"ref-for-gravity\u2461\u2461"},{"id":"ref-for-gravity\u2461\u2462"}],"title":"4.5.1. Complementary filter"},{"refs":[{"id":"ref-for-gravity\u2461\u2463"},{"id":"ref-for-gravity\u2461\u2464"},{"id":"ref-for-gravity\u2461\u2465"},{"id":"ref-for-gravity\u2461\u2466"},{"id":"ref-for-gravity\u2461\u2467"}],"title":"4.6. Gravity and Linear Acceleration Sensor"}],"url":"https://w3c.github.io/accelerometer#gravity"},
"7bbb090d": {"dfnID":"7bbb090d","dfnText":"gravitysensor interface","external":true,"refSections":[{"refs":[{"id":"ref-for-gravitysensor-interface"}],"title":"4.6. Gravity and Linear Acceleration Sensor"}],"url":"https://w3c.github.io/accelerometer#gravitysensor-interface"},
"84d9dd12": {"dfnID":"84d9dd12","dfnText":"magnetic field","external":true,"refSections":[{"refs":[{"id":"ref-for-magnetic-field"},{"id":"ref-for-magnetic-field\u2460"},{"id":"ref-for-magnetic-field\u2461"}],"title":"3.3. Magnetometer"},{"refs":[{"id":"ref-for-magnetic-field\u2462"},{"id":"ref-for-magnetic-field\u2463"},{"id":"ref-for-magnetic-field\u2464"},{"id":"ref-for-magnetic-field\u2465"},{"id":"ref-for-magnetic-field\u2466"}],"title":"4.3. Absolute Orientation Sensor"},{"refs":[{"id":"ref-for-magnetic-field\u2467"}],"title":"4.6. Gravity and Linear Acceleration Sensor"}],"url":"https://w3c.github.io/magnetometer#magnetic-field"},
"95f495ac": {"dfnID":"95f495ac","dfnText":"acceleration","external":true,"refSections":[{"refs":[{"id":"ref-for-acceleration"}],"title":"4.3. Absolute Orientation Sensor"}],"url":"https://w3c.github.io/accelerometer#acceleration"},
"9c6c688b": {"dfnID":"9c6c688b","dfnText":"magnetometer interface","external":true,"refSections":[{"refs":[{"id":"ref-for-magnetometer-interface"}],"title":"3.3. Magnetometer"}],"url":"https://w3c.github.io/magnetometer#magnetometer-interface"},
"absolute-orientation-sensor": {"dfnID":"absolute-orientation-sensor","dfnText":"Absolute Orientation Sensor","external":false,"refSections":[{"refs":[{"id":"ref-for-absolute-orientation-sensor"}],"title":"4.1. Common fusion sensors"},{"refs":[{"id":"ref-for-absolute-orientation-sensor\u2460"},{"id":"ref-for-absolute-orientation-sensor\u2461"}],"title":"4.3. Absolute Orientation Sensor"},{"refs":[{"id":"ref-for-absolute-orientation-sensor\u2462"}],"title":"4.4. Geomagnetic Orientation Sensor"}],"url":"#absolute-orientation-sensor"},
"accelerometer": {"dfnID":"accelerometer","dfnText":"accelerometer","external":false,"refSections":[{"refs":[{"id":"ref-for-accelerometer"}],"title":"1. Introduction"},{"refs":[{"id":"ref-for-accelerometer\u2460"}],"title":"3.1. Accelerometer"},{"refs":[{"id":"ref-for-accelerometer\u2461"},{"id":"ref-for-accelerometer\u2462"},{"id":"ref-for-accelerometer\u2463"},{"id":"ref-for-accelerometer\u2464"},{"id":"ref-for-accelerometer\u2465"}],"title":"4.1. Common fusion sensors"},{"refs":[{"id":"ref-for-accelerometer\u2466"},{"id":"ref-for-accelerometer\u2467"},{"id":"ref-for-accelerometer\u2468"}],"title":"4.3. Absolute Orientation Sensor"},{"refs":[{"id":"ref-for-accelerometer\u2460\u24ea"},{"id":"ref-for-accelerometer\u2460\u2460"}],"title":"4.4. Geomagnetic Orientation Sensor"},{"refs":[{"id":"ref-for-accelerometer\u2460\u2461"},{"id":"ref-for-accelerometer\u2460\u2462"}],"title":"4.5. Relative Orientation Sensor"},{"refs":[{"id":"ref-for-accelerometer\u2460\u2463"},{"id":"ref-for-accelerometer\u2460\u2464"},{"id":"ref-for-accelerometer\u2460\u2465"},{"id":"ref-for-accelerometer\u2460\u2466"},{"id":"ref-for-accelerometer\u2460\u2467"},{"id":"ref-for-accelerometer\u2460\u2468"},{"id":"ref-for-accelerometer\u2461\u24ea"}],"title":"4.5.1. Complementary filter"},{"refs":[{"id":"ref-for-accelerometer\u2461\u2460"},{"id":"ref-for-accelerometer\u2461\u2461"}],"title":"4.6. Gravity and Linear Acceleration Sensor"}],"url":"#accelerometer"},
"complementary-filter": {"dfnID":"complementary-filter","dfnText":"complementary filter","external":false,"refSections":[{"refs":[{"id":"ref-for-complementary-filter"},{"id":"ref-for-complementary-filter\u2460"}],"title":"4.5. Relative Orientation Sensor"},{"refs":[{"id":"ref-for-complementary-filter\u2461"}],"title":"4.5.1. Complementary filter"},{"refs":[{"id":"ref-for-complementary-filter\u2462"}],"title":"4.6. Gravity and Linear Acceleration Sensor"}],"url":"#complementary-filter"},
"geomagnetic-orientation-sensor": {"dfnID":"geomagnetic-orientation-sensor","dfnText":"Geomagnetic Orientation Sensor","external":false,"refSections":[{"refs":[{"id":"ref-for-geomagnetic-orientation-sensor"}],"title":"4.1. Common fusion sensors"},{"refs":[{"id":"ref-for-geomagnetic-orientation-sensor\u2460"}],"title":"4.4. Geomagnetic Orientation Sensor"}],"url":"#geomagnetic-orientation-sensor"},
"gravity-sensor": {"dfnID":"gravity-sensor","dfnText":"Gravity Sensor","external":false,"refSections":[{"refs":[{"id":"ref-for-gravity-sensor"}],"title":"3.1. Accelerometer"},{"refs":[{"id":"ref-for-gravity-sensor\u2460"}],"title":"4.1. Common fusion sensors"},{"refs":[{"id":"ref-for-gravity-sensor\u2461"},{"id":"ref-for-gravity-sensor\u2462"}],"title":"4.3. Absolute Orientation Sensor"}],"url":"#gravity-sensor"},
"gyroscope": {"dfnID":"gyroscope","dfnText":"gyroscope","external":false,"refSections":[{"refs":[{"id":"ref-for-gyroscope"}],"title":"1. Introduction"},{"refs":[{"id":"ref-for-gyroscope\u2460"},{"id":"ref-for-gyroscope\u2461"},{"id":"ref-for-gyroscope\u2462"},{"id":"ref-for-gyroscope\u2463"},{"id":"ref-for-gyroscope\u2464"}],"title":"4.1. Common fusion sensors"},{"refs":[{"id":"ref-for-gyroscope\u2465"}],"title":"4.2.2. High-pass filter"},{"refs":[{"id":"ref-for-gyroscope\u2466"}],"title":"4.3. Absolute Orientation Sensor"},{"refs":[{"id":"ref-for-gyroscope\u2467"}],"title":"4.4. Geomagnetic Orientation Sensor"},{"refs":[{"id":"ref-for-gyroscope\u2468"}],"title":"4.5. Relative Orientation Sensor"},{"refs":[{"id":"ref-for-gyroscope\u2460\u24ea"},{"id":"ref-for-gyroscope\u2460\u2460"},{"id":"ref-for-gyroscope\u2460\u2461"},{"id":"ref-for-gyroscope\u2460\u2462"},{"id":"ref-for-gyroscope\u2460\u2463"},{"id":"ref-for-gyroscope\u2460\u2464"},{"id":"ref-for-gyroscope\u2460\u2465"}],"title":"4.5.1. Complementary filter"},{"refs":[{"id":"ref-for-gyroscope\u2460\u2466"}],"title":"4.6. Gravity and Linear Acceleration Sensor"}],"url":"#gyroscope"},
"high-pass-filter": {"dfnID":"high-pass-filter","dfnText":"High-pass filter","external":false,"refSections":[{"refs":[{"id":"ref-for-high-pass-filter"},{"id":"ref-for-high-pass-filter\u2460"}],"title":"3.1. Accelerometer"},{"refs":[{"id":"ref-for-high-pass-filter\u2461"}],"title":"4.5.1. Complementary filter"}],"url":"#high-pass-filter"},
"inertial-frame-sensor": {"dfnID":"inertial-frame-sensor","dfnText":"inertial-frame sensor","external":false,"refSections":[{"refs":[{"id":"ref-for-inertial-frame-sensor"}],"title":"4.3. Absolute Orientation Sensor"}],"url":"#inertial-frame-sensor"},
"linear-acceleration-sensor": {"dfnID":"linear-acceleration-sensor","dfnText":"Linear Acceleration Sensor","external":false,"refSections":[{"refs":[{"id":"ref-for-linear-acceleration-sensor"}],"title":"3.1. Accelerometer"},{"refs":[{"id":"ref-for-linear-acceleration-sensor\u2460"}],"title":"4.1. Common fusion sensors"},{"refs":[{"id":"ref-for-linear-acceleration-sensor\u2461"}],"title":"4.6. Gravity and Linear Acceleration Sensor"}],"url":"#linear-acceleration-sensor"},
"low-pass-filter": {"dfnID":"low-pass-filter","dfnText":"low-pass filter","external":false,"refSections":[{"refs":[{"id":"ref-for-low-pass-filter"},{"id":"ref-for-low-pass-filter\u2460"},{"id":"ref-for-low-pass-filter\u2461"}],"title":"3.1. Accelerometer"},{"refs":[{"id":"ref-for-low-pass-filter\u2462"}],"title":"4.2.2. High-pass filter"},{"refs":[{"id":"ref-for-low-pass-filter\u2463"}],"title":"4.5.1. Complementary filter"}],"url":"#low-pass-filter"},
"magnetometer-magnetometers": {"dfnID":"magnetometer-magnetometers","dfnText":"Magnetometers","external":false,"refSections":[{"refs":[{"id":"ref-for-magnetometer-magnetometers"}],"title":"1. Introduction"},{"refs":[{"id":"ref-for-magnetometer-magnetometers\u2460"},{"id":"ref-for-magnetometer-magnetometers\u2461"},{"id":"ref-for-magnetometer-magnetometers\u2462"},{"id":"ref-for-magnetometer-magnetometers\u2463"}],"title":"4.1. Common fusion sensors"},{"refs":[{"id":"ref-for-magnetometer-magnetometers\u2464"},{"id":"ref-for-magnetometer-magnetometers\u2465"},{"id":"ref-for-magnetometer-magnetometers\u2466"}],"title":"4.3. Absolute Orientation Sensor"},{"refs":[{"id":"ref-for-magnetometer-magnetometers\u2467"}],"title":"4.4. Geomagnetic Orientation Sensor"},{"refs":[{"id":"ref-for-magnetometer-magnetometers\u2468"}],"title":"4.6. Gravity and Linear Acceleration Sensor"}],"url":"#magnetometer-magnetometers"},
"relative-orientation-sensor": {"dfnID":"relative-orientation-sensor","dfnText":"Relative Orientation Sensor","external":false,"refSections":[{"refs":[{"id":"ref-for-relative-orientation-sensor"}],"title":"4.1. Common fusion sensors"},{"refs":[{"id":"ref-for-relative-orientation-sensor\u2460"}],"title":"4.3. Absolute Orientation Sensor"}],"url":"#relative-orientation-sensor"},
"tilt-compensation": {"dfnID":"tilt-compensation","dfnText":"tilt compensation","external":false,"refSections":[],"url":"#tilt-compensation"},
};

document.addEventListener("DOMContentLoaded", ()=>{
    genAllDfnPanels();

    document.body.addEventListener("click", (e) => {
        // If not handled already, just hide all dfn panels.
        hideAllDfnPanels();
    });
});

window.addEventListener("resize", () => {
    // Pin any visible dfn panel
    queryAll(".dfn-panel.on, .dfn-panel.activated").forEach(el=>positionDfnPanel(el));
});

function genAllDfnPanels() {
    for(const panelData of Object.values(dfnPanelData)) {
        const dfnID = panelData.dfnID;
        const dfn = document.getElementById(dfnID);
        if(!dfn) {
            console.log(`Can't find dfn#${dfnID}.`, panelData);
            continue;
        }
        dfn.panelData = panelData;
        insertDfnPopupAction(dfn);
    }
}

function genDfnPanel(dfn, { dfnID, url, dfnText, refSections, external }) {
    const dfnPanel = mk.aside({
        class: "dfn-panel on",
        id: `infopanel-for-${dfnID}`,
        "data-for": dfnID,
        "aria-labelled-by":`infopaneltitle-for-${dfnID}`,
        },
        mk.span({id:`infopaneltitle-for-${dfnID}`, style:"display:none"},
            `Info about the '${dfnText}' ${external?"external":""} reference.`),
        mk.a({href:url, class:"dfn-link"}, url),
        refSections.length == 0 ? [] :
            mk.b({}, "Referenced in:"),
            mk.ul({},
                ...refSections.map(section=>
                    mk.li({},
                        ...section.refs.map((ref, refI)=>
                            [
                                mk.a({ href: `#${ref.id}` },
                                    (refI == 0) ? section.title : `(${refI + 1})`
                                ),
                                " ",
                            ]
                        ),
                    ),
                ),
            ),
        genLinkingSyntaxes(dfn),
    );

    dfnPanel.addEventListener('click', (event) => {
        if (event.target.nodeName == 'A') {
            scrollToTargetAndHighlight(event);
            pinDfnPanel(dfnPanel);
        }
        event.stopPropagation();
        refocusOnTarget(event);
    });
    dfnPanel.addEventListener('keydown', (event) => {
        if(event.keyCode == 27) { // Escape key
            hideDfnPanel({dfnPanel});
            event.stopPropagation();
            event.preventDefault();
        }
    });

    dfnPanel.dfn = dfn;
    dfn.dfnPanel = dfnPanel;
    return dfnPanel;
}



function hideAllDfnPanels() {
    // Delete the currently-active dfn panel.
    queryAll(".dfn-panel").forEach(dfnPanel=>hideDfnPanel({dfnPanel}));
}

function showDfnPanel(dfn) {
    hideAllDfnPanels(); // Only display one at a time.

    dfn.setAttribute("aria-expanded", "true");

    const dfnPanel = genDfnPanel(dfn, dfn.panelData);

    // Give the dfn a unique tabindex, and then
    // give all the tabbable panel bits successive indexes.
    let tabIndex = 100;
    dfn.tabIndex = tabIndex++;
    const tabbable = dfnPanel.querySelectorAll(":is(a, button)");
    for (const el of tabbable) {
        el.tabIndex = tabIndex++;
    }

    append(document.body, dfnPanel);
    positionDfnPanel(dfnPanel);
}

function positionDfnPanel(dfnPanel) {
    const dfn = dfnPanel.dfn;
    const dfnPos = getBounds(dfn);
    dfnPanel.style.top = dfnPos.bottom + "px";
    dfnPanel.style.left = dfnPos.left + "px";

    const panelPos = dfnPanel.getBoundingClientRect();
    const panelMargin = 8;
    const maxRight = document.body.parentNode.clientWidth - panelMargin;
    if (panelPos.right > maxRight) {
        const overflowAmount = panelPos.right - maxRight;
        const newLeft = Math.max(panelMargin, dfnPos.left - overflowAmount);
        dfnPanel.style.left = newLeft + "px";
    }
}

function pinDfnPanel(dfnPanel) {
    // Switch it to "activated" state, which pins it.
    dfnPanel.classList.add("activated");
    dfnPanel.style.position = "fixed";
    dfnPanel.style.left = null;
    dfnPanel.style.top = null;
}

function hideDfnPanel({dfn, dfnPanel}) {
    if(!dfnPanel) dfnPanel = dfn.dfnPanel;
    if(!dfn) dfn = dfnPanel.dfn;
    dfn.dfnPanel = undefined;
    dfnPanel.dfn = undefined;
    dfn.setAttribute("aria-expanded", "false");
    dfn.tabIndex = undefined;
    dfnPanel.remove()
}

function toggleDfnPanel(dfn) {
    if(dfn.dfnPanel) {
        hideDfnPanel(dfn);
    } else {
        showDfnPanel(dfn);
    }
}

function insertDfnPopupAction(dfn) {
    dfn.setAttribute('role', 'button');
    dfn.setAttribute('aria-expanded', 'false')
    dfn.tabIndex = 0;
    dfn.classList.add('has-dfn-panel');
    dfn.addEventListener('click', (event) => {
        toggleDfnPanel(dfn);
        event.stopPropagation();
    });
    dfn.addEventListener('keypress', (event) => {
        const kc = event.keyCode;
        // 32->Space, 13->Enter
        if(kc == 32 || kc == 13) {
            toggleDfnPanel(dfn);
            event.stopPropagation();
            event.preventDefault();
        }
    });
}

function refocusOnTarget(event) {
    const target = event.target;
    setTimeout(() => {
        // Refocus on the event.target element.
        // This is needed after browser scrolls to the destination.
        target.focus();
    });
}

// TODO: shared util
// Returns the root-level absolute position {left and top} of element.
function getBounds(el, relativeTo=document.body) {
    const relativeRect = relativeTo.getBoundingClientRect();
    const elRect = el.getBoundingClientRect();
    const top = elRect.top - relativeRect.top;
    const left = elRect.left - relativeRect.left;
    return {
        top,
        left,
        bottom: top + elRect.height,
        right: left + elRect.width,
    }
}

function scrollToTargetAndHighlight(event) {
    let hash = event.target.hash;
    if (hash) {
        hash = decodeURIComponent(hash.substring(1));
        const dest = document.getElementById(hash);
        if (dest) {
            dest.classList.add('highlighted');
            setTimeout(() => dest.classList.remove('highlighted'), 1000);
        }
    }
}

// Functions, divided by link type, that wrap an autolink's
// contents with the appropriate outer syntax.
// Alternately, a string naming another type they format
// the same as.
function needsFor(type) {
    switch(type) {
        case "descriptor":
        case "value":
        case "element-attr":
        case "attr-value":
        case "element-state":
        case "method":
        case "constructor":
        case "argument":
        case "attribute":
        case "const":
        case "dict-member":
        case "event":
        case "enum-value":
        case "stringifier":
        case "serializer":
        case "iterator":
        case "maplike":
        case "setlike":
        case "state":
        case "mode":
        case "context":
        case "facet": return true;

        default: return false;
    }
}
function refusesFor(type) {
    switch(type) {
        case "property":
        case "element":
        case "interface":
        case "namespace":
        case "callback":
        case "dictionary":
        case "enum":
        case "exception":
        case "typedef":
        case "http-header":
        case "permission": return true;

        default: return false;
    }
}
function linkFormatterFromType(type) {
    switch(type) {
        case 'scheme':
        case 'permission':
        case 'dfn': return (text) => `[=${text}=]`;

        case 'abstract-op': return (text) => `[\$${text}\$]`;

        case 'function':
        case 'at-rule':
        case 'selector':
        case 'value': return (text) => `''${text}''`;

        case 'http-header': return (text) => `[:${text}:]`;

        case 'interface':
        case 'constructor':
        case 'method':
        case 'argument':
        case 'attribute':
        case 'callback':
        case 'dictionary':
        case 'dict-member':
        case 'enum':
        case 'enum-value':
        case 'exception':
        case 'const':
        case 'typedef':
        case 'stringifier':
        case 'serializer':
        case 'iterator':
        case 'maplike':
        case 'setlike':
        case 'extended-attribute':
        case 'event':
        case 'idl': return (text) => `{{${text}}}`;

        case 'element-state':
        case 'element-attr':
        case 'attr-value':
        case 'element': return (element) => `<{${element}}>`;

        case 'grammar': return (text) => `${text} (within a <pre class=prod>)`;

        case 'type': return (text)=> `<<${text}>>`;

        case 'descriptor':
        case 'property': return (text) => `'${text}'`;

        default: return;
    };
};

function genLinkingSyntaxes(dfn) {
    if(dfn.tagName != "DFN") return;

    const type = dfn.getAttribute('data-dfn-type');
    if(!type) {
        console.log(`<dfn> doesn't have a data-dfn-type:`, dfn);
        return [];
    }

    // Return a function that wraps link text based on the type
    const linkFormatter = linkFormatterFromType(type);
    if(!linkFormatter) {
        console.log(`<dfn> has an unknown data-dfn-type:`, dfn);
        return [];
    }

    let ltAlts;
    if(dfn.hasAttribute('data-lt')) {
        ltAlts = dfn.getAttribute('data-lt')
            .split("|")
            .map(x=>x.trim());
    } else {
        ltAlts = [dfn.textContent.trim()];
    }
    if(type == "type") {
        // lt of "<foo>", but "foo" is the interior;
        // <<foo/bar>> is how you write it with a for,
        // not <foo/<bar>> or whatever.
        for(var i = 0; i < ltAlts.length; i++) {
            const lt = ltAlts[i];
            const match = /<(.*)>/.exec(lt);
            if(match) { ltAlts[i] = match[1]; }
        }
    }

    let forAlts;
    if(dfn.hasAttribute('data-dfn-for')) {
        forAlts = dfn.getAttribute('data-dfn-for')
            .split(",")
            .map(x=>x.trim());
    } else {
        forAlts = [''];
    }

    let linkingSyntaxes = [];
    if(!needsFor(type)) {
        for(const lt of ltAlts) {
            linkingSyntaxes.push(linkFormatter(lt));
        }
    }
    if(!refusesFor(type)) {
        for(const f of forAlts) {
            linkingSyntaxes.push(linkFormatter(`${f}/${ltAlts[0]}`))
        }
    }
    return [
        mk.b({}, 'Possible linking syntaxes:'),
        mk.ul({},
            ...linkingSyntaxes.map(link => {
                const copyLink = async () =>
                    await navigator.clipboard.writeText(link);
                return mk.li({},
                    mk.div({ class: 'link-item' },
                        mk.button({
                            class: 'copy-icon', title: 'Copy',
                            type: 'button',
                            _onclick: copyLink,
                            tabindex: 0,
                        }, mk.span({ class: 'icon' }) ),
                        mk.span({}, link)
                    )
                );
            })
        )
    ];
}
}
</script>
<script>/* Boilerplate: script-ref-hints */
"use strict";
{
let refsData = {
"#absolute-orientation-sensor": {"export":true,"for_":[],"level":"","normative":true,"shortname":"motion-sensors","spec":"motion-sensors","status":"local","text":"absolute orientation sensor","type":"dfn","url":"#absolute-orientation-sensor"},
"#accelerometer": {"export":true,"for_":[],"level":"","normative":true,"shortname":"motion-sensors","spec":"motion-sensors","status":"local","text":"accelerometer","type":"dfn","url":"#accelerometer"},
"#complementary-filter": {"export":true,"for_":[],"level":"","normative":true,"shortname":"motion-sensors","spec":"motion-sensors","status":"local","text":"complementary filter","type":"dfn","url":"#complementary-filter"},
"#geomagnetic-orientation-sensor": {"export":true,"for_":[],"level":"","normative":true,"shortname":"motion-sensors","spec":"motion-sensors","status":"local","text":"geomagnetic orientation sensor","type":"dfn","url":"#geomagnetic-orientation-sensor"},
"#gravity-sensor": {"export":true,"for_":[],"level":"","normative":true,"shortname":"motion-sensors","spec":"motion-sensors","status":"local","text":"gravity sensor","type":"dfn","url":"#gravity-sensor"},
"#gyroscope": {"export":true,"for_":[],"level":"","normative":true,"shortname":"motion-sensors","spec":"motion-sensors","status":"local","text":"gyroscope","type":"dfn","url":"#gyroscope"},
"#high-pass-filter": {"export":true,"for_":[],"level":"","normative":true,"shortname":"motion-sensors","spec":"motion-sensors","status":"local","text":"high-pass filter","type":"dfn","url":"#high-pass-filter"},
"#inertial-frame-sensor": {"export":true,"for_":[],"level":"","normative":true,"shortname":"motion-sensors","spec":"motion-sensors","status":"local","text":"inertial-frame sensor","type":"dfn","url":"#inertial-frame-sensor"},
"#linear-acceleration-sensor": {"export":true,"for_":[],"level":"","normative":true,"shortname":"motion-sensors","spec":"motion-sensors","status":"local","text":"linear acceleration sensor","type":"dfn","url":"#linear-acceleration-sensor"},
"#low-pass-filter": {"export":true,"for_":[],"level":"","normative":true,"shortname":"motion-sensors","spec":"motion-sensors","status":"local","text":"low-pass filter","type":"dfn","url":"#low-pass-filter"},
"#magnetometer-magnetometers": {"export":true,"for_":["magnetometer"],"level":"","normative":true,"shortname":"motion-sensors","spec":"motion-sensors","status":"local","text":"magnetometers","type":"dfn","url":"#magnetometer-magnetometers"},
"#relative-orientation-sensor": {"export":true,"for_":[],"level":"","normative":true,"shortname":"motion-sensors","spec":"motion-sensors","status":"local","text":"relative orientation sensor","type":"dfn","url":"#relative-orientation-sensor"},
"https://w3c.github.io/accelerometer#acceleration": {"export":true,"for_":[],"level":"","normative":true,"shortname":"accelerometer","spec":"accelerometer","status":"anchor-block","text":"acceleration","type":"dfn","url":"https://w3c.github.io/accelerometer#acceleration"},
"https://w3c.github.io/accelerometer#accelerometer-interface": {"export":true,"for_":[],"level":"","normative":true,"shortname":"accelerometer","spec":"accelerometer","status":"anchor-block","text":"accelerometer interface","type":"dfn","url":"https://w3c.github.io/accelerometer#accelerometer-interface"},
"https://w3c.github.io/accelerometer#gravity": {"export":true,"for_":[],"level":"","normative":true,"shortname":"accelerometer","spec":"accelerometer","status":"anchor-block","text":"gravity","type":"dfn","url":"https://w3c.github.io/accelerometer#gravity"},
"https://w3c.github.io/accelerometer#gravitysensor-interface": {"export":true,"for_":[],"level":"","normative":true,"shortname":"accelerometer","spec":"accelerometer","status":"anchor-block","text":"gravitysensor interface","type":"dfn","url":"https://w3c.github.io/accelerometer#gravitysensor-interface"},
"https://w3c.github.io/accelerometer#linear-acceleration": {"export":true,"for_":[],"level":"","normative":true,"shortname":"accelerometer","spec":"accelerometer","status":"anchor-block","text":"linear acceleration","type":"dfn","url":"https://w3c.github.io/accelerometer#linear-acceleration"},
"https://w3c.github.io/accelerometer#linearaccelerationsensor-interface": {"export":true,"for_":[],"level":"","normative":true,"shortname":"accelerometer","spec":"accelerometer","status":"anchor-block","text":"linearaccelerationsensor interface","type":"dfn","url":"https://w3c.github.io/accelerometer#linearaccelerationsensor-interface"},
"https://w3c.github.io/gyroscope#angular-velocity": {"export":true,"for_":[],"level":"","normative":true,"shortname":"gyroscope","spec":"gyroscope","status":"anchor-block","text":"angular velocity","type":"dfn","url":"https://w3c.github.io/gyroscope#angular-velocity"},
"https://w3c.github.io/gyroscope#gyroscope-interface": {"export":true,"for_":[],"level":"","normative":true,"shortname":"gyroscope","spec":"gyroscope","status":"anchor-block","text":"gyroscope interface","type":"dfn","url":"https://w3c.github.io/gyroscope#gyroscope-interface"},
"https://w3c.github.io/magnetometer#magnetic-field": {"export":true,"for_":[],"level":"","normative":true,"shortname":"magnetometer","spec":"magnetometer","status":"anchor-block","text":"magnetic field","type":"dfn","url":"https://w3c.github.io/magnetometer#magnetic-field"},
"https://w3c.github.io/magnetometer#magnetometer-interface": {"export":true,"for_":[],"level":"","normative":true,"shortname":"magnetometer","spec":"magnetometer","status":"anchor-block","text":"magnetometer interface","type":"dfn","url":"https://w3c.github.io/magnetometer#magnetometer-interface"},
"https://w3c.github.io/orientation-sensor#absoluteorientationsensor-interface": {"export":true,"for_":[],"level":"","normative":true,"shortname":"orientation-sensor","spec":"orientation-sensor","status":"anchor-block","text":"absoluteorientationsensor interface","type":"dfn","url":"https://w3c.github.io/orientation-sensor#absoluteorientationsensor-interface"},
"https://w3c.github.io/sensors#calibration": {"export":true,"for_":[],"level":"","normative":true,"shortname":"generic-sensor","spec":"generic-sensor","status":"anchor-block","text":"calibration","type":"dfn","url":"https://w3c.github.io/sensors#calibration"},
};

function mkRefHint(link, ref) {
    const linkText = link.textContent;
    let dfnTextElements = '';
    if (ref.text != linkText) {
        dfnTextElements =
            mk.li({},
                mk.b({}, "Term: "),
                mk.span({}, ref.text)
            );
    }
    const forList = ref.for_;
    let forListElements;
    if(forList.length == 0) {
        forListElements = [];
    } else if(forList.length == 1) {
        forListElements = mk.li({},
            mk.b({}, "For: "),
            mk.span({}, forList[0]),
        );
    } else {
        forListElements = mk.li({},
            mk.b({}, "For: "),
            mk.ul({},
                ...forList.map(forItem =>
                    mk.li({},
                        mk.span({}, forItem)
                    ),
                ),
            ),
        );
    }
    const url = ref.url;
    const safeUrl = encodeURIComponent(url);
    const hintPanel = mk.aside({
        class: "ref-hint",
        id: `ref-hint-for-${safeUrl}`,
        "data-for": url,
        "aria-labelled-by": `ref-hint-for-${safeUrl}`,
    },
        mk.ul({},
            dfnTextElements,
            mk.li({},
                mk.b({}, "URL: "),
                mk.a({ href: url, class: "ref" }, url),
            ),
            mk.li({},
                mk.b({}, "Type: "),
                mk.span({}, `${ref.type}`),
            ),
            mk.li({},
                mk.b({}, "Spec: "),
                mk.span({}, `${ref.spec ? ref.spec : ''}`),
            ),
            forListElements
        ),
    );
    hintPanel.forLink = link;
    setupRefHintEventListeners(link, hintPanel);
    return hintPanel;
}

function hideAllRefHints() {
    queryAll(".ref-hint").forEach(el=>hideRefHint(el));
}

function hideRefHint(refHint) {
    const link = refHint.forLink;
    link.setAttribute("aria-expanded", "false");
    if(refHint.teardownEventListeners) {
        refHint.teardownEventListeners();
    }
    refHint.remove();
}

function showRefHint(link) {
    if(link.classList.contains("dfn-link")) return;
    const url = link.getAttribute("href");
    const ref = refsData[url];
    if(!ref) return;

    hideAllRefHints(); // Only display one at this time.

    const refHint = mkRefHint(link, ref);
    append(document.body, refHint);
    link.setAttribute("aria-expanded", "true");
    positionRefHint(refHint);
}

function setupRefHintEventListeners(link, refHint) {
    if (refHint.teardownEventListeners) return;
    // Add event handlers to hide the refHint after the user moves away
    // from both the link and refHint, if not hovering either within one second.
    let timeout = null;
    const startHidingRefHint = (event) => {
        if (timeout) {
            clearTimeout(timeout);
        }
        timeout = setTimeout(() => {
            hideRefHint(refHint);
        }, 1000);
    }
    const resetHidingRefHint = (event) => {
        if (timeout) clearTimeout(timeout);
        timeout = null;
    };
    link.addEventListener("mouseleave", startHidingRefHint);
    link.addEventListener("mouseenter", resetHidingRefHint);
    link.addEventListener("blur", startHidingRefHint);
    link.addEventListener("focus", resetHidingRefHint);
    refHint.addEventListener("mouseleave", startHidingRefHint);
    refHint.addEventListener("mouseenter", resetHidingRefHint);
    refHint.addEventListener("blur", startHidingRefHint);
    refHint.addEventListener("focus", resetHidingRefHint);

    refHint.teardownEventListeners = () => {
        // remove event listeners
        resetHidingRefHint();
        link.removeEventListener("mouseleave", startHidingRefHint);
        link.removeEventListener("mouseenter", resetHidingRefHint);
        link.removeEventListener("blur", startHidingRefHint);
        link.removeEventListener("focus", resetHidingRefHint);
        refHint.removeEventListener("mouseleave", startHidingRefHint);
        refHint.removeEventListener("mouseenter", resetHidingRefHint);
        refHint.removeEventListener("blur", startHidingRefHint);
        refHint.removeEventListener("focus", resetHidingRefHint);
    };
}

function positionRefHint(refHint) {
    const link = refHint.forLink;
    const linkPos = getBounds(link);
    refHint.style.top = linkPos.bottom + "px";
    refHint.style.left = linkPos.left + "px";

    const panelPos = refHint.getBoundingClientRect();
    const panelMargin = 8;
    const maxRight = document.body.parentNode.clientWidth - panelMargin;
    if (panelPos.right > maxRight) {
        const overflowAmount = panelPos.right - maxRight;
        const newLeft = Math.max(panelMargin, linkPos.left - overflowAmount);
        refHint.style.left = newLeft + "px";
    }
}

// TODO: shared util
// Returns the root-level absolute position {left and top} of element.
function getBounds(el, relativeTo=document.body) {
    const relativeRect = relativeTo.getBoundingClientRect();
    const elRect = el.getBoundingClientRect();
    const top = elRect.top - relativeRect.top;
    const left = elRect.left - relativeRect.left;
    return {
        top,
        left,
        bottom: top + elRect.height,
        right: left + elRect.width,
    }
}

function showRefHintListener(e) {
    // If the target isn't in a link (or is a link),
    // just ignore it.
    let link = e.target.closest("a");
    if(!link) return;

    // If the target is in a ref-hint panel
    // (aka a link in the already-open one),
    // also just ignore it.
    if(link.closest(".ref-hint")) return;

    // Otherwise, show the panel for the link.
    showRefHint(link);
}

function hideAllHintsListener(e) {
    // If the click is inside a ref-hint panel, ignore it.
    if(e.target.closest(".ref-hint")) return;
    // Otherwise, close all the current panels.
    hideAllRefHints();
}

document.addEventListener("DOMContentLoaded", () => {
    document.body.addEventListener("mousedown", showRefHintListener);
    document.body.addEventListener("focus", showRefHintListener);

    document.body.addEventListener("click", hideAllHintsListener);
});

window.addEventListener("resize", () => {
    // Hide any open ref hint.
    hideAllRefHints();
});
}
</script>