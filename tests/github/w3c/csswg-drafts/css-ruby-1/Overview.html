<!doctype html><html lang="en">
 <head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
  <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
  <title>CSS Ruby Annotation Layout Module Level 1</title>
  <meta content="ED" name="w3c-status">
  <link href="https://www.w3.org/StyleSheets/TR/2021/W3C-ED" rel="stylesheet">
  <link href="https://www.w3.org/TR/css-ruby-1/" rel="canonical">
  <link href="https://drafts.csswg.org/csslogo.ico" rel="icon">
  <meta content="dark light" name="color-scheme">
  <link href="https://www.w3.org/StyleSheets/TR/2021/dark.css" media="(prefers-color-scheme: dark)" rel="stylesheet" type="text/css">
<style>
  /* ASCII diagram colors */
  .base { color: blue; }
  .annot { color: red; }
  .column { color: gray; }
  .flagtxt1 { color: green; }
  .flagtxt2 { color: #ae4a00; }
  .flagbg1 { background: green; opacity: 0.3; }
  .flagbg2 { background: orange; opacity: 0.3; }
</style>
<style>/* Boilerplate: style-autolinks */
.css.css, .property.property, .descriptor.descriptor {
    color: var(--a-normal-text);
    font-size: inherit;
    font-family: inherit;
}
.css::before, .property::before, .descriptor::before {
    content: "‘";
}
.css::after, .property::after, .descriptor::after {
    content: "’";
}
.property, .descriptor {
    /* Don't wrap property and descriptor names */
    white-space: nowrap;
}
.type { /* CSS value <type> */
    font-style: italic;
}
pre .property::before, pre .property::after {
    content: "";
}
[data-link-type="property"]::before,
[data-link-type="propdesc"]::before,
[data-link-type="descriptor"]::before,
[data-link-type="value"]::before,
[data-link-type="function"]::before,
[data-link-type="at-rule"]::before,
[data-link-type="selector"]::before,
[data-link-type="maybe"]::before {
    content: "‘";
}
[data-link-type="property"]::after,
[data-link-type="propdesc"]::after,
[data-link-type="descriptor"]::after,
[data-link-type="value"]::after,
[data-link-type="function"]::after,
[data-link-type="at-rule"]::after,
[data-link-type="selector"]::after,
[data-link-type="maybe"]::after {
    content: "’";
}

[data-link-type].production::before,
[data-link-type].production::after,
.prod [data-link-type]::before,
.prod [data-link-type]::after {
    content: "";
}

[data-link-type=element],
[data-link-type=element-attr] {
    font-family: Menlo, Consolas, "DejaVu Sans Mono", monospace;
    font-size: .9em;
}
[data-link-type=element]::before { content: "<" }
[data-link-type=element]::after  { content: ">" }

[data-link-type=biblio] {
    white-space: pre;
}

@media (prefers-color-scheme: dark) {
    :root {
        --selflink-text: black;
        --selflink-bg: silver;
        --selflink-hover-text: white;
    }
}
</style>
<style>/* Boilerplate: style-colors */
/* Any --*-text not paired with a --*-bg is assumed to have a transparent bg */
:root {
    color-scheme: light dark;

    --text: black;
    --bg: white;

    --unofficial-watermark: url(https://www.w3.org/StyleSheets/TR/2016/logos/UD-watermark);

    --logo-bg: #1a5e9a;
    --logo-active-bg: #c00;
    --logo-text: white;

    --tocnav-normal-text: #707070;
    --tocnav-normal-bg: var(--bg);
    --tocnav-hover-text: var(--tocnav-normal-text);
    --tocnav-hover-bg: #f8f8f8;
    --tocnav-active-text: #c00;
    --tocnav-active-bg: var(--tocnav-normal-bg);

    --tocsidebar-text: var(--text);
    --tocsidebar-bg: #f7f8f9;
    --tocsidebar-shadow: rgba(0,0,0,.1);
    --tocsidebar-heading-text: hsla(203,20%,40%,.7);

    --toclink-text: var(--text);
    --toclink-underline: #3980b5;
    --toclink-visited-text: var(--toclink-text);
    --toclink-visited-underline: #054572;

    --heading-text: #005a9c;

    --hr-text: var(--text);

    --algo-border: #def;

    --del-text: red;
    --del-bg: transparent;
    --ins-text: #080;
    --ins-bg: transparent;

    --a-normal-text: #034575;
    --a-normal-underline: #bbb;
    --a-visited-text: var(--a-normal-text);
    --a-visited-underline: #707070;
    --a-hover-bg: rgba(75%, 75%, 75%, .25);
    --a-active-text: #c00;
    --a-active-underline: #c00;

    --blockquote-border: silver;
    --blockquote-bg: transparent;
    --blockquote-text: currentcolor;

    --issue-border: #e05252;
    --issue-bg: #fbe9e9;
    --issue-text: var(--text);
    --issueheading-text: #831616;

    --example-border: #e0cb52;
    --example-bg: #fcfaee;
    --example-text: var(--text);
    --exampleheading-text: #574b0f;

    --note-border: #52e052;
    --note-bg: #e9fbe9;
    --note-text: var(--text);
    --noteheading-text: hsl(120, 70%, 30%);
    --notesummary-underline: silver;

    --assertion-border: #aaa;
    --assertion-bg: #eee;
    --assertion-text: black;

    --advisement-border: orange;
    --advisement-bg: #fec;
    --advisement-text: var(--text);
    --advisementheading-text: #b35f00;

    --warning-border: red;
    --warning-bg: hsla(40,100%,50%,0.95);
    --warning-text: var(--text);

    --amendment-border: #330099;
    --amendment-bg: #F5F0FF;
    --amendment-text: var(--text);
    --amendmentheading-text: #220066;

    --def-border: #8ccbf2;
    --def-bg: #def;
    --def-text: var(--text);
    --defrow-border: #bbd7e9;

    --datacell-border: silver;

    --indexinfo-text: #707070;

    --indextable-hover-text: black;
    --indextable-hover-bg: #f7f8f9;

    --outdatedspec-bg: rgba(0, 0, 0, .5);
    --outdatedspec-text: black;
    --outdated-bg: maroon;
    --outdated-text: white;
    --outdated-shadow: red;

    --editedrec-bg: darkorange;
}

@media (prefers-color-scheme: dark) {
    :root {
        --text: #ddd;
        --bg: black;

        --unofficial-watermark: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='400'%3E%3Cg fill='%23100808' transform='translate(200 200) rotate(-45) translate(-200 -200)' stroke='%23100808' stroke-width='3'%3E%3Ctext x='50%25' y='220' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EUNOFFICIAL%3C/text%3E%3Ctext x='50%25' y='305' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EDRAFT%3C/text%3E%3C/g%3E%3C/svg%3E");

        --logo-bg: #1a5e9a;
        --logo-active-bg: #c00;
        --logo-text: white;

        --tocnav-normal-text: #999;
        --tocnav-normal-bg: var(--bg);
        --tocnav-hover-text: var(--tocnav-normal-text);
        --tocnav-hover-bg: #080808;
        --tocnav-active-text: #f44;
        --tocnav-active-bg: var(--tocnav-normal-bg);

        --tocsidebar-text: var(--text);
        --tocsidebar-bg: #080808;
        --tocsidebar-shadow: rgba(255,255,255,.1);
        --tocsidebar-heading-text: hsla(203,20%,40%,.7);

        --toclink-text: var(--text);
        --toclink-underline: #6af;
        --toclink-visited-text: var(--toclink-text);
        --toclink-visited-underline: #054572;

        --heading-text: #8af;

        --hr-text: var(--text);

        --algo-border: #456;

        --del-text: #f44;
        --del-bg: transparent;
        --ins-text: #4a4;
        --ins-bg: transparent;

        --a-normal-text: #6af;
        --a-normal-underline: #555;
        --a-visited-text: var(--a-normal-text);
        --a-visited-underline: var(--a-normal-underline);
        --a-hover-bg: rgba(25%, 25%, 25%, .2);
        --a-active-text: #f44;
        --a-active-underline: var(--a-active-text);

        --borderedblock-bg: rgba(255, 255, 255, .05);

        --blockquote-border: silver;
        --blockquote-bg: var(--borderedblock-bg);
        --blockquote-text: currentcolor;

        --issue-border: #e05252;
        --issue-bg: var(--borderedblock-bg);
        --issue-text: var(--text);
        --issueheading-text: hsl(0deg, 70%, 70%);

        --example-border: hsl(50deg, 90%, 60%);
        --example-bg: var(--borderedblock-bg);
        --example-text: var(--text);
        --exampleheading-text: hsl(50deg, 70%, 70%);

        --note-border: hsl(120deg, 100%, 35%);
        --note-bg: var(--borderedblock-bg);
        --note-text: var(--text);
        --noteheading-text: hsl(120, 70%, 70%);
        --notesummary-underline: silver;

        --assertion-border: #444;
        --assertion-bg: var(--borderedblock-bg);
        --assertion-text: var(--text);

        --advisement-border: orange;
        --advisement-bg: #222218;
        --advisement-text: var(--text);
        --advisementheading-text: #f84;

        --warning-border: red;
        --warning-bg: hsla(40,100%,20%,0.95);
        --warning-text: var(--text);

        --amendment-border: #330099;
        --amendment-bg: #080010;
        --amendment-text: var(--text);
        --amendmentheading-text: #cc00ff;

        --def-border: #8ccbf2;
        --def-bg: #080818;
        --def-text: var(--text);
        --defrow-border: #136;

        --datacell-border: silver;

        --indexinfo-text: #aaa;

        --indextable-hover-text: var(--text);
        --indextable-hover-bg: #181818;

        --outdatedspec-bg: rgba(255, 255, 255, .5);
        --outdatedspec-text: black;
        --outdated-bg: maroon;
        --outdated-text: white;
        --outdated-shadow: red;

        --editedrec-bg: darkorange;
    }
    /* In case a transparent-bg image doesn't expect to be on a dark bg,
       which is quite common in practice... */
    img { background: white; }
}
</style>
<style>/* Boilerplate: style-counters */
body {
    counter-reset: example figure issue;
}
.issue {
    counter-increment: issue;
}
.issue:not(.no-marker)::before {
    content: "Issue " counter(issue);
}

.example {
    counter-increment: example;
}
.example:not(.no-marker)::before {
    content: "Example " counter(example);
}
.invalid.example:not(.no-marker)::before,
.illegal.example:not(.no-marker)::before {
    content: "Invalid Example" counter(example);
}

figcaption {
    counter-increment: figure;
}
figcaption:not(.no-marker)::before {
    content: "Figure " counter(figure) " ";
}
</style>
<style>/* Boilerplate: style-dfn-panel */
:root {
    --dfnpanel-bg: #ddd;
    --dfnpanel-text: var(--text);
    --dfnpanel-target-bg: #ffc;
    --dfnpanel-target-outline: orange;
}
@media (prefers-color-scheme: dark) {
    :root {
        --dfnpanel-bg: #222;
        --dfnpanel-text: var(--text);
        --dfnpanel-target-bg: #333;
        --dfnpanel-target-outline: silver;
    }
}
.dfn-panel {
    position: absolute;
    z-index: 35;
    width: 20em;
    width: 300px;
    height: auto;
    max-height: 500px;
    overflow: auto;
    padding: 0.5em 0.75em;
    font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
    background: var(--dfnpanel-bg);
    color: var(--dfnpanel-text);
    border: outset 0.2em;
    white-space: normal; /* in case it's moved into a pre */
}
.dfn-panel:not(.on) { display: none; }
.dfn-panel * { margin: 0; padding: 0; text-indent: 0; }
.dfn-panel > b { display: block; }
.dfn-panel a { color: var(--dfnpanel-text); }
.dfn-panel a:not(:hover) { text-decoration: none !important; border-bottom: none !important; }
.dfn-panel a:focus {
    outline: 5px auto Highlight;
    outline: 5px auto -webkit-focus-ring-color;
}
.dfn-panel > b + b { margin-top: 0.25em; }
.dfn-panel ul { padding: 0 0 0 1em; list-style: none; }
.dfn-panel li a {
    max-width: calc(300px - 1.5em - 1em);
    overflow: hidden;
    text-overflow: ellipsis;
}

.dfn-panel.activated {
    display: inline-block;
    position: fixed;
    left: 8px;
    bottom: 2em;
    margin: 0 auto;
    max-width: calc(100vw - 1.5em - .4em - .5em);
    max-height: 30vh;
    transition: left 1s ease-out, bottom 1s ease-out;
}

.dfn-panel .link-item:hover {
    text-decoration: underline;
}
.dfn-panel .link-item .copy-icon {
    opacity: 0;
}
.dfn-panel .link-item:hover .copy-icon,
.dfn-panel .link-item .copy-icon:focus {
    opacity: 1;
}

.dfn-panel .copy-icon {
    display: inline-block;
    margin-right: 0.5em;
    width: 0.85em;
    height: 1em;
    border-radius: 3px;
    background-color: #ccc;
    cursor: pointer;
}

.dfn-panel .copy-icon .icon {
    width: 100%;
    height: 100%;
    background-color: #fff;
    display: flex;
    justify-content: center;
    align-items: center;
    position: relative;
}

.dfn-panel .copy-icon .icon::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    border: 1px solid black;
    background-color: #ccc;
    opacity: 0.25;
    transform: translate(3px, -3px);
}

.dfn-panel .copy-icon:active .icon::before {
    opacity: 1;
}

.dfn-paneled[role="button"] { cursor: help; }

.highlighted {
    animation: target-fade 3s;
}

@keyframes target-fade {
    from {
        background-color: var(--dfnpanel-target-bg);
        outline: 5px solid var(--dfnpanel-target-outline);
    }
    to {
        color: var(--a-normal-text);
        background-color: transparent;
        outline: transparent;
    }
}
</style>
<style>/* Boilerplate: style-issues */
a[href].issue-return {
    float: right;
    float: inline-end;
    color: var(--issueheading-text);
    font-weight: bold;
    text-decoration: none;
}
</style>
<style>/* Boilerplate: style-md-lists */
/* This is a weird hack for me not yet following the commonmark spec
   regarding paragraph and lists. */
[data-md] > :first-child {
    margin-top: 0;
}
[data-md] > :last-child {
    margin-bottom: 0;
}
</style>
<style>/* Boilerplate: style-mdn-anno */
:root {
	--mdn-bg: #EEE;
	--mdn-shadow: #999;
	--mdn-nosupport-text: #ccc;
	--mdn-pass: green;
	--mdn-fail: red;
}
@media (prefers-color-scheme: dark) {
	:root {
		--mdn-bg: #222;
		--mdn-shadow: #444;
		--mdn-nosupport-text: #666;
		--mdn-pass: #690;
		--mdn-fail: #d22;
	}
}
.mdn-anno {
	background: var(--mdn-bg, #EEE);
	border-radius: .25em;
	box-shadow: 0 0 3px var(--mdn-shadow, #999);
	color: var(--text, black);
	font: 1em sans-serif;
	hyphens: none;
	max-width: min-content;
	overflow: hidden;
	padding: 0.2em;
	position: absolute;
	right: 0.3em;
	top: auto;
	white-space: nowrap;
	word-wrap: normal;
	z-index: 8;
}
.mdn-anno.unpositioned {
	display: none;
}
.mdn-anno.overlapping-main {
	opacity: .2;
	transition: opacity .1s;
}
.mdn-anno[open] {
	opacity: 1;
	z-index: 9;
	min-width: 9em;
}
.mdn-anno:hover {
	opacity: 1;
	outline: var(--text, black) 1px solid;
}
.mdn-anno > summary {
	font-weight: normal;
	text-align: right;
	cursor: pointer;
	display: block;
}
.mdn-anno > summary > .less-than-two-engines-flag {
	color: var(--mdn-fail);
	padding-right: 2px;
}
.mdn-anno > summary > .all-engines-flag {
	color: var(--mdn-pass);
	padding-right: 2px;
}
.mdn-anno > summary > span {
	color: #fff;
	background-color: #000;
	font-weight: normal;
	font-family: zillaslab, Palatino, "Palatino Linotype", serif;
	padding: 2px 3px 0px 3px;
	line-height: 1.3em;
	vertical-align: top;
}
.mdn-anno > .feature {
	margin-top: 20px;
}
.mdn-anno > .feature:not(:first-of-type) {
	border-top: 1px solid #999;
	margin-top: 6px;
	padding-top: 2px;
}
.mdn-anno > .feature > .less-than-two-engines-text {
	color: var(--mdn-fail);
}
.mdn-anno > .feature > .all-engines-text {
	color: var(--mdn-pass);
}
.mdn-anno > .feature > p {
	font-size: .75em;
	margin-top: 6px;
	margin-bottom: 0;
}
.mdn-anno > .feature > p + p {
	margin-top: 3px;
}
.mdn-anno > .feature > .support {
	display: block;
	font-size: 0.6em;
	margin: 0;
	padding: 0;
	margin-top: 2px;
}
.mdn-anno > .feature > .support + div {
	padding-top: 0.5em;
}
.mdn-anno > .feature > .support > hr {
	display: block;
	border: none;
	border-top: 1px dotted #999;
	padding: 3px 0px 0px 0px;
	margin: 2px 3px 0px 3px;
}
.mdn-anno > .feature > .support > hr::before {
	content: "";
}
.mdn-anno > .feature > .support > span {
	padding: 0.2em 0;
	display: block;
	display: table;
}
.mdn-anno > .feature > .support > span.no {
	color: var(--mdn-nosupport-text);
	filter: grayscale(100%);
}
.mdn-anno > .feature > .support > span.no::before {
	opacity: 0.5;
}
.mdn-anno > .feature > .support > span:first-of-type {
	padding-top: 0.5em;
}
.mdn-anno > .feature > .support > span > span {
	padding: 0 0.5em;
	display: table-cell;
}
.mdn-anno > .feature > .support > span > span:first-child {
	width: 100%;
}
.mdn-anno > .feature > .support > span > span:last-child {
	width: 100%;
	white-space: pre;
	padding: 0;
}
.mdn-anno > .feature > .support > span::before {
	content: ' ';
	display: table-cell;
	min-width: 1.5em;
	height: 1.5em;
	background: no-repeat center center;
	background-size: contain;
	text-align: right;
	font-size: 0.75em;
	font-weight: bold;
}
.mdn-anno > .feature > .support > .chrome_android::before {
	background-image: url(https://resources.whatwg.org/browser-logos/chrome.svg);
}
.mdn-anno > .feature > .support > .firefox_android::before {
	background-image: url(https://resources.whatwg.org/browser-logos/firefox.png);
}
.mdn-anno > .feature > .support > .chrome::before {
	background-image: url(https://resources.whatwg.org/browser-logos/chrome.svg);
}
.mdn-anno > .feature > .support > .edge_blink::before {
	background-image: url(https://resources.whatwg.org/browser-logos/edge.svg);
}
.mdn-anno > .feature > .support > .edge::before {
	background-image: url(https://resources.whatwg.org/browser-logos/edge_legacy.svg);
}
.mdn-anno > .feature > .support > .firefox::before {
	background-image: url(https://resources.whatwg.org/browser-logos/firefox.png);
}
.mdn-anno > .feature > .support > .ie::before {
	background-image: url(https://resources.whatwg.org/browser-logos/ie.png);
}
.mdn-anno > .feature > .support > .safari_ios::before {
	background-image: url(https://resources.whatwg.org/browser-logos/safari-ios.svg);
}
.mdn-anno > .feature > .support > .nodejs::before {
	background-image: url(https://nodejs.org/static/images/favicons/favicon.ico);
}
.mdn-anno > .feature > .support > .opera_android::before {
	background-image: url(https://resources.whatwg.org/browser-logos/opera.svg);
}
.mdn-anno > .feature > .support > .opera::before {
	background-image: url(https://resources.whatwg.org/browser-logos/opera.svg);
}
.mdn-anno > .feature > .support > .safari::before {
	background-image: url(https://resources.whatwg.org/browser-logos/safari.png);
}
.mdn-anno > .feature > .support > .samsunginternet_android::before {
	background-image: url(https://resources.whatwg.org/browser-logos/samsung.svg);
}
.mdn-anno > .feature > .support > .webview_android::before {
	background-image: url(https://resources.whatwg.org/browser-logos/android-webview.png);
}
.name-slug-mismatch {
	color: red;
}
.caniuse-status:hover {
	z-index: 9;
}
/* dt, li, .issue, .note, and .example are "position: relative", so to put annotation at right margin, must move to right of containing block */;
.h-entry:not(.status-LS) dt > .mdn-anno, .h-entry:not(.status-LS) li > .mdn-anno, .h-entry:not(.status-LS) .issue > .mdn-anno, .h-entry:not(.status-LS) .note > .mdn-anno, .h-entry:not(.status-LS) .example > .mdn-anno {
	right: -6.7em;
}
.h-entry p + .mdn-anno {
	margin-top: 0;
}
 h2 + .mdn-anno.after {
	margin: -48px 0 0 0;
}
 h3 + .mdn-anno.after {
	margin: -46px 0 0 0;
}
 h4 + .mdn-anno.after {
	margin: -42px 0 0 0;
}
 h5 + .mdn-anno.after {
	margin: -40px 0 0 0;
}
 h6 + .mdn-anno.after {
	margin: -40px 0 0 0;
}
</style>
<style>/* Boilerplate: style-ref-hints */
:root {
    --ref-hint-bg: #ddd;
    --ref-hint-text: var(--text);
}
@media (prefers-color-scheme: dark) {
    :root {
        --ref-hint-bg: #222;
        --ref-hint-text: var(--text);
    }
}

.ref-hint {
    display: inline-block;
    position: absolute;
    z-index: 35;
    width: 20em;
    width: 300px;
    height: auto;
    max-height: 500px;
    overflow: auto;
    padding: 0.5em 0.5em;
    font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
    background: var(--ref-hint-bg);
    color: var(--ref-hint-text);
    border: outset 0.2em;
    white-space: normal; /* in case it's moved into a pre */
}

.ref-hint * { margin: 0; padding: 0; text-indent: 0; }

.ref-hint ul { padding: 0 0 0 1em; list-style: none; }
</style>
<style>/* Boilerplate: style-selflinks */
:root {
    --selflink-text: white;
    --selflink-bg: gray;
    --selflink-hover-text: black;
}
.heading, .issue, .note, .example, li, dt {
    position: relative;
}
a.self-link {
    position: absolute;
    top: 0;
    left: calc(-1 * (3.5rem - 26px));
    width: calc(3.5rem - 26px);
    height: 2em;
    text-align: center;
    border: none;
    transition: opacity .2s;
    opacity: .5;
}
a.self-link:hover {
    opacity: 1;
}
.heading > a.self-link {
    font-size: 83%;
}
.example > a.self-link,
.note > a.self-link,
.issue > a.self-link {
    /* These blocks are overflow:auto, so positioning outside
       doesn't work. */
    left: auto;
    right: 0;
}
li > a.self-link {
    left: calc(-1 * (3.5rem - 26px) - 2em);
}
dfn > a.self-link {
    top: auto;
    left: auto;
    opacity: 0;
    width: 1.5em;
    height: 1.5em;
    background: var(--selflink-bg);
    color: var(--selflink-text);
    font-style: normal;
    transition: opacity .2s, background-color .2s, color .2s;
}
dfn:hover > a.self-link {
    opacity: 1;
}
dfn > a.self-link:hover {
    color: var(--selflink-hover-text);
}

a.self-link::before            { content: "¶"; }
.heading > a.self-link::before { content: "§"; }
dfn > a.self-link::before      { content: "#"; }
</style>
<style>/* Boilerplate: style-syntax-highlighting */
code.highlight { padding: .1em; border-radius: .3em; }
pre.highlight, pre > code.highlight { display: block; padding: 1em; margin: .5em 0; overflow: auto; border-radius: 0; }

.highlight:not(.idl) { background: rgba(0, 0, 0, .03); }
c-[a] { color: #990055 } /* Keyword.Declaration */
c-[b] { color: #990055 } /* Keyword.Type */
c-[c] { color: #708090 } /* Comment */
c-[d] { color: #708090 } /* Comment.Multiline */
c-[e] { color: #0077aa } /* Name.Attribute */
c-[f] { color: #669900 } /* Name.Tag */
c-[g] { color: #222222 } /* Name.Variable */
c-[k] { color: #990055 } /* Keyword */
c-[l] { color: #000000 } /* Literal */
c-[m] { color: #000000 } /* Literal.Number */
c-[n] { color: #0077aa } /* Name */
c-[o] { color: #999999 } /* Operator */
c-[p] { color: #999999 } /* Punctuation */
c-[s] { color: #a67f59 } /* Literal.String */
c-[t] { color: #a67f59 } /* Literal.String.Single */
c-[u] { color: #a67f59 } /* Literal.String.Double */
c-[cp] { color: #708090 } /* Comment.Preproc */
c-[c1] { color: #708090 } /* Comment.Single */
c-[cs] { color: #708090 } /* Comment.Special */
c-[kc] { color: #990055 } /* Keyword.Constant */
c-[kn] { color: #990055 } /* Keyword.Namespace */
c-[kp] { color: #990055 } /* Keyword.Pseudo */
c-[kr] { color: #990055 } /* Keyword.Reserved */
c-[ld] { color: #000000 } /* Literal.Date */
c-[nc] { color: #0077aa } /* Name.Class */
c-[no] { color: #0077aa } /* Name.Constant */
c-[nd] { color: #0077aa } /* Name.Decorator */
c-[ni] { color: #0077aa } /* Name.Entity */
c-[ne] { color: #0077aa } /* Name.Exception */
c-[nf] { color: #0077aa } /* Name.Function */
c-[nl] { color: #0077aa } /* Name.Label */
c-[nn] { color: #0077aa } /* Name.Namespace */
c-[py] { color: #0077aa } /* Name.Property */
c-[ow] { color: #999999 } /* Operator.Word */
c-[mb] { color: #000000 } /* Literal.Number.Bin */
c-[mf] { color: #000000 } /* Literal.Number.Float */
c-[mh] { color: #000000 } /* Literal.Number.Hex */
c-[mi] { color: #000000 } /* Literal.Number.Integer */
c-[mo] { color: #000000 } /* Literal.Number.Oct */
c-[sb] { color: #a67f59 } /* Literal.String.Backtick */
c-[sc] { color: #a67f59 } /* Literal.String.Char */
c-[sd] { color: #a67f59 } /* Literal.String.Doc */
c-[se] { color: #a67f59 } /* Literal.String.Escape */
c-[sh] { color: #a67f59 } /* Literal.String.Heredoc */
c-[si] { color: #a67f59 } /* Literal.String.Interpol */
c-[sx] { color: #a67f59 } /* Literal.String.Other */
c-[sr] { color: #a67f59 } /* Literal.String.Regex */
c-[ss] { color: #a67f59 } /* Literal.String.Symbol */
c-[vc] { color: #0077aa } /* Name.Variable.Class */
c-[vg] { color: #0077aa } /* Name.Variable.Global */
c-[vi] { color: #0077aa } /* Name.Variable.Instance */
c-[il] { color: #000000 } /* Literal.Number.Integer.Long */

@media (prefers-color-scheme: dark) {
    .highlight:not(.idl) { background: rgba(255, 255, 255, .05); }

    c-[a] { color: #d33682 } /* Keyword.Declaration */
    c-[b] { color: #d33682 } /* Keyword.Type */
    c-[c] { color: #2aa198 } /* Comment */
    c-[d] { color: #2aa198 } /* Comment.Multiline */
    c-[e] { color: #268bd2 } /* Name.Attribute */
    c-[f] { color: #b58900 } /* Name.Tag */
    c-[g] { color: #cb4b16 } /* Name.Variable */
    c-[k] { color: #d33682 } /* Keyword */
    c-[l] { color: #657b83 } /* Literal */
    c-[m] { color: #657b83 } /* Literal.Number */
    c-[n] { color: #268bd2 } /* Name */
    c-[o] { color: #657b83 } /* Operator */
    c-[p] { color: #657b83 } /* Punctuation */
    c-[s] { color: #6c71c4 } /* Literal.String */
    c-[t] { color: #6c71c4 } /* Literal.String.Single */
    c-[u] { color: #6c71c4 } /* Literal.String.Double */
    c-[ch] { color: #2aa198 } /* Comment.Hashbang */
    c-[cp] { color: #2aa198 } /* Comment.Preproc */
    c-[cpf] { color: #2aa198 } /* Comment.PreprocFile */
    c-[c1] { color: #2aa198 } /* Comment.Single */
    c-[cs] { color: #2aa198 } /* Comment.Special */
    c-[kc] { color: #d33682 } /* Keyword.Constant */
    c-[kn] { color: #d33682 } /* Keyword.Namespace */
    c-[kp] { color: #d33682 } /* Keyword.Pseudo */
    c-[kr] { color: #d33682 } /* Keyword.Reserved */
    c-[ld] { color: #657b83 } /* Literal.Date */
    c-[nc] { color: #268bd2 } /* Name.Class */
    c-[no] { color: #268bd2 } /* Name.Constant */
    c-[nd] { color: #268bd2 } /* Name.Decorator */
    c-[ni] { color: #268bd2 } /* Name.Entity */
    c-[ne] { color: #268bd2 } /* Name.Exception */
    c-[nf] { color: #268bd2 } /* Name.Function */
    c-[nl] { color: #268bd2 } /* Name.Label */
    c-[nn] { color: #268bd2 } /* Name.Namespace */
    c-[py] { color: #268bd2 } /* Name.Property */
    c-[ow] { color: #657b83 } /* Operator.Word */
    c-[mb] { color: #657b83 } /* Literal.Number.Bin */
    c-[mf] { color: #657b83 } /* Literal.Number.Float */
    c-[mh] { color: #657b83 } /* Literal.Number.Hex */
    c-[mi] { color: #657b83 } /* Literal.Number.Integer */
    c-[mo] { color: #657b83 } /* Literal.Number.Oct */
    c-[sa] { color: #6c71c4 } /* Literal.String.Affix */
    c-[sb] { color: #6c71c4 } /* Literal.String.Backtick */
    c-[sc] { color: #6c71c4 } /* Literal.String.Char */
    c-[dl] { color: #6c71c4 } /* Literal.String.Delimiter */
    c-[sd] { color: #6c71c4 } /* Literal.String.Doc */
    c-[se] { color: #6c71c4 } /* Literal.String.Escape */
    c-[sh] { color: #6c71c4 } /* Literal.String.Heredoc */
    c-[si] { color: #6c71c4 } /* Literal.String.Interpol */
    c-[sx] { color: #6c71c4 } /* Literal.String.Other */
    c-[sr] { color: #6c71c4 } /* Literal.String.Regex */
    c-[ss] { color: #6c71c4 } /* Literal.String.Symbol */
    c-[fm] { color: #268bd2 } /* Name.Function.Magic */
    c-[vc] { color: #cb4b16 } /* Name.Variable.Class */
    c-[vg] { color: #cb4b16 } /* Name.Variable.Global */
    c-[vi] { color: #cb4b16 } /* Name.Variable.Instance */
    c-[vm] { color: #cb4b16 } /* Name.Variable.Magic */
    c-[il] { color: #657b83 } /* Literal.Number.Integer.Long */
}
</style>
<style>/* Boilerplate: style-wpt */
:root {
    --wpt-border: hsl(0, 0%, 60%);
    --wpt-bg: hsl(0, 0%, 95%);
    --wpt-text: var(--text);
    --wptheading-text: hsl(0, 0%, 30%);
}
@media (prefers-color-scheme: dark) {
    :root {
        --wpt-border: hsl(0, 0%, 30%);
        --wpt-bg: var(--borderedblock-bg);
        --wpt-text: var(--text);
        --wptheading-text: hsl(0, 0%, 60%);
    }
}
.wpt-tests-block {
    list-style: none;
    border-left: .5em solid var(--wpt-border);
    background: var(--wpt-bg);
    color: var(--wpt-text);
    margin: 1em auto;
    padding: .5em;
}
.wpt-tests-block summary {
    color: var(--wptheading-text);
    font-weight: normal;
    text-transform: uppercase;
}
.wpt-tests-block summary::marker{
    color: var(--wpt-border);
}
.wpt-tests-block summary:hover::marker{
    color: var(--wpt-text);
}
/*
   The only content  of a wpt test block in its closed state is the <summary>,
   which contains the word TESTS,
   and that is absolutely positioned.
   In that closed state, wpt test blocks are styled
   to have a top margin whose height is exactly equal
   to the height of the absolutely positioned <summary>,
   and no other background/padding/margin/border.
   The wpt test block elements will therefore allow the maring
   of the previous/next block elements
   to collapse through them;
   if this combined margin would be larger than its own top margin,
   it stays as is,
   and therefore the pre-existing vertical rhythm of the document is undisturbed.
   If that combined margin would be smaller, it is grown to that size.
   This means that the wpt test block ensures
   that there's always enough vertical space to insert the summary,
   without adding more than is needed.
*/
.wpt-tests-block:not([open]){
    padding: 0;
    border: none;
    background: none;
    font-size: 0.75em;
    line-height: 1;
    position: relative;
    margin: 1em 0 0;
}
.wpt-tests-block:not([open]) summary {
    position: absolute;
    right: 0;
    bottom: 0;
}
/*
   It is possible that both the last child of a block element
   and the block element itself
   would be annotated with a <wpt> block each.
   If the block element has a padding or a border,
   that's fine, but otherwise
   the bottom margin of the block and of its last child would collapse
   and both <wpt> elements would overlap, being both placed there.
   To avoid that, add 1px of padding to the <wpt> element annotating the last child
   to prevent the bottom margin of the block and of its last child from collapsing
   (and as much negative margin,
   as wel only want to prevent margin collapsing,
   but are not trying to actually take more space).
*/
.wpt-tests-block:not([open]):last-child {
    padding-bottom: 1px;
    margin-bottom: -1px;
}
/*
   Exception to the previous rule:
   don't do that in non-last list items,
   because it's not necessary,
   and would therefore consume more space than strictly needed.
   Lists must have list items as children, not <wpt> elements,
   so a <wpt> element cannot be a sibling of a list item,
   and the collision that the previous rule avoids cannot happen.
*/
li:not(:last-child) > .wpt-tests-block:not([open]):last-child,
dd:not(:last-child) > .wpt-tests-block:not([open]):last-child {
    padding-bottom: 0;
    margin-bottom: 0;
}
.wpt-tests-block:not([open]):not(:hover){
    opacity: 0.5;
}
.wpt-tests-list {
    list-style: none;
    display: grid;
    margin: 0;
    padding: 0;
    grid-template-columns: 1fr max-content auto auto;
    grid-column-gap: .5em;
}
.wpt-tests-block hr:last-child {
    display: none;
}
.wpt-test {
    display: contents;
}
.wpt-test > a {
    text-decoration: underline;
    border: none;
}
.wpt-test > .wpt-name { grid-column: 1; }
.wpt-test > .wpt-results { grid-column: 2; }
.wpt-test > .wpt-live { grid-column: 3; }
.wpt-test > .wpt-source { grid-column: 4; }

.wpt-test > .wpt-results {
    display: flex;
    gap: .1em;
}
.wpt-test .wpt-result {
    display: inline-block;
    height: 1em;
    width: 1em;
    border-radius: 50%;
    position: relative;
}
</style>
 <body class="h-entry">
  <div class="head">
   <p data-fill-with="logo"><a class="logo" href="https://www.w3.org/"> <img alt="W3C" height="48" src="https://www.w3.org/StyleSheets/TR/2021/logos/W3C" width="72"> </a> </p>
   <h1 class="p-name no-ref" id="title">CSS Ruby Annotation Layout Module Level 1</h1>
   <p id="w3c-state"><a href="https://www.w3.org/standards/types/#ED">Editor’s Draft</a>, <time class="dt-updated" datetime="1970-01-01">1 January 1970</time></p>
   <details open>
    <summary>More details about this document</summary>
    <div data-fill-with="spec-metadata">
     <dl>
      <dt>This version:
      <dd><a class="u-url" href="https://drafts.csswg.org/css-ruby-1/">https://drafts.csswg.org/css-ruby-1/</a>
      <dt>Latest published version:
      <dd><a href="https://www.w3.org/TR/css-ruby-1/">https://www.w3.org/TR/css-ruby-1/</a>
      <dt>Previous Versions:
      <dd><a href="https://www.w3.org/TR/2021/WD-css-ruby-1-20210310/" rel="prev">https://www.w3.org/TR/2021/WD-css-ruby-1-20210310/</a>
      <dd><a href="https://www.w3.org/TR/2020/WD-css-ruby-1-20200429/" rel="prev">https://www.w3.org/TR/2020/WD-css-ruby-1-20200429/</a>
      <dd><a href="https://www.w3.org/TR/2014/WD-css-ruby-1-20140805/" rel="prev">https://www.w3.org/TR/2014/WD-css-ruby-1-20140805/</a>
      <dd><a href="https://www.w3.org/TR/2013/WD-css3-ruby-20130919/" rel="prev">https://www.w3.org/TR/2013/WD-css3-ruby-20130919/</a>
      <dt>Test Suite:
      <dd><a href="https://www.w3.org/International/tests/repo/results/css-ruby">https://www.w3.org/International/tests/repo/results/css-ruby</a>
      <dt>Feedback:
      <dd><a href="https://github.com/w3c/csswg-drafts/labels/css-ruby-1">CSSWG Issues Repository</a>
      <dt class="editor">Editors:
      <dd class="editor p-author h-card vcard" data-editor-id="35400"><a class="p-name fn u-url url" href="http://fantasai.inkedblade.net/contact">Elika J. Etemad / fantasai</a> (<span class="p-org org">Invited Expert</span>)
      <dd class="editor p-author h-card vcard" data-editor-id="45369"><a class="p-name fn u-email email" href="mailto:kojiishi@gmail.com">Koji Ishii</a> (<span class="p-org org">Google</span>)
      <dd class="editor p-author h-card vcard" data-editor-id="73936"><a class="p-name fn u-url url" href="https://www.upsuper.org/">Xidorn Quan</a> (<a class="p-org org" href="https://www.mozilla.org/">Mozilla</a>)
      <dd class="editor p-author h-card vcard" data-editor-id="43241"><a class="p-name fn u-url url" href="https://florian.rivoal.net/">Florian Rivoal</a> (<span class="p-org org">Invited Expert</span>)
      <dt>Suggest an Edit for this Spec:
      <dd><a href="https://github.com/w3c/csswg-drafts/blob/main/css-ruby-1/Overview.bs">GitHub Editor</a>
     </dl>
    </div>
   </details>
   <div data-fill-with="warning"></div>
   <p class="copyright" data-fill-with="copyright"><a href="https://www.w3.org/policies/#copyright">Copyright</a> © 1970 <a href="https://www.w3.org/">World Wide Web Consortium</a>. <abbr title="World Wide Web Consortium">W3C</abbr><sup>®</sup> <a href="https://www.w3.org/policies/#Legal_Disclaimer">liability</a>, <a href="https://www.w3.org/policies/#W3C_Trademarks">trademark</a> and <a href="https://www.w3.org/copyright/software-license/" rel="license" title="W3C Software and Document License">permissive document license</a> rules apply. </p>
   <hr title="Separator for header">
  </div>
  <div class="p-summary" data-fill-with="abstract">
   <h2 class="no-num no-toc no-ref heading settled" id="abstract"><span class="content">Abstract</span></h2>
   <p>“Ruby”, a form of interlinear annotation, are short runs of text alongside the base text.
They are typically used in East Asian documents to indicate pronunciation or to provide a short annotation.
This module describes the rendering model and formatting controls related to displaying ruby annotations in CSS.</p>
    <a href="https://www.w3.org/TR/CSS/">CSS</a> is a language for describing the rendering of structured documents
(such as HTML and XML)
on screen, on paper, etc. 
  </div>
  <h2 class="no-num no-toc no-ref heading settled" id="sotd"><span class="content">Status of this document</span></h2>
  <div data-fill-with="status">
   <p> This is a public copy of the editors’ draft.
	It is provided for discussion only and may change at any moment.
	Its publication here does not imply endorsement of its contents by W3C.
	Don’t cite this document other than as work in progress. </p>
   <p>Please send feedback
	by <a href="https://github.com/w3c/csswg-drafts/issues">filing issues in GitHub</a> (preferred),
	including the spec code “css-ruby” in the title, like this:
	“[css-ruby] <i>…summary of comment…</i>”.
	All issues and comments are <a href="https://lists.w3.org/Archives/Public/public-css-archive/">archived</a>.
	Alternately, feedback can be sent to the (<a href="https://lists.w3.org/Archives/Public/www-style/">archived</a>) public mailing list <a href="mailto:www-style@w3.org?Subject=%5Bcss-ruby%5D%20PUT%20SUBJECT%20HERE">www-style@w3.org</a>. </p>
   <p>This document is governed by the <a href="https://www.w3.org/policies/process/20231103/" id="w3c_process_revision">03 November 2023 W3C Process Document</a>. </p>
   <p></p>
  </div>
  <div data-fill-with="at-risk"></div>
  <nav data-fill-with="table-of-contents" id="toc">
   <h2 class="no-num no-toc no-ref" id="contents">Table of Contents</h2>
   <ol class="toc" role="directory">
    <li>
     <a href="#intro"><span class="secno">1</span> <span class="content"> Introduction</span></a>
     <ol class="toc">
      <li><a href="#ruby-def"><span class="secno">1.1</span> <span class="content"> What is ruby?</span></a>
      <li><a href="#placement"><span class="secno">1.2</span> <span class="content"> Module interactions</span></a>
      <li><a href="#values"><span class="secno">1.3</span> <span class="content"> Value Definitions</span></a>
      <li><a href="#diagram-conventions"><span class="secno">1.4</span> <span class="content"> Diagram conventions</span></a>
     </ol>
    <li>
     <a href="#ruby-model"><span class="secno">2</span> <span class="content"> Ruby Box Model</span></a>
     <ol class="toc">
      <li>
       <a href="#ruby-display"><span class="secno">2.1</span> <span class="content"> Ruby-specific <span class="property">display</span> Values</span></a>
       <ol class="toc">
        <li><a href="#formatting-context"><span class="secno">2.1.1</span> <span class="content"> The Ruby Formatting Context</span></a>
        <li><a href="#block-ruby"><span class="secno">2.1.2</span> <span class="content"> Non-Inline Ruby</span></a>
       </ol>
      <li><a href="#box-fixup"><span class="secno">2.2</span> <span class="content"> Anonymous Ruby Box Generation</span></a>
      <li>
       <a href="#ruby-pairing"><span class="secno">2.3</span> <span class="content"> Annotation Pairing</span></a>
       <ol class="toc">
        <li><a href="#segment-pairing"><span class="secno">2.3.1</span> <span class="content"> Segment Pairing and Annotation Levels</span></a>
        <li><a href="#base-annotation-pairing"><span class="secno">2.3.2</span> <span class="content"> Unit Pairing and Spanning Annotations</span></a>
       </ol>
      <li><a href="#hiding"><span class="secno">2.4</span> <span class="content"> Hiding Annotations: <span class="css">visibility: collapse</span> and auto-hidden ruby</span></a>
      <li><a href="#white-space"><span class="secno">2.5</span> <span class="content"> White Space Collapsing</span></a>
     </ol>
    <li>
     <a href="#ruby-layout"><span class="secno">3</span> <span class="content"> Ruby Layout</span></a>
     <ol class="toc">
      <li>
       <a href="#interlinear-layout"><span class="secno">3.1</span> <span class="content"> Interlinear Ruby Layout</span></a>
       <ol class="toc">
        <li><a href="#interlinear-inline"><span class="secno">3.1.1</span> <span class="content"> Inline-axis Interlinear Layout</span></a>
        <li><a href="#interlinear-block"><span class="secno">3.1.2</span> <span class="content"> Block-axis Interlinear Layout</span></a>
       </ol>
      <li><a href="#inter-character-layout"><span class="secno">3.2</span> <span class="content"> Inter-character Ruby Layout</span></a>
      <li><a href="#box-style"><span class="secno">3.3</span> <span class="content"> Styling Ruby Boxes</span></a>
      <li>
       <a href="#line-breaks"><span class="secno">3.4</span> <span class="content"> Breaking Across Lines</span></a>
       <ol class="toc">
        <li><a href="#break-between"><span class="secno">3.4.1</span> <span class="content"> Breaking Between Bases</span></a>
        <li><a href="#break-within"><span class="secno">3.4.2</span> <span class="content"> Breaking Within Bases</span></a>
       </ol>
      <li><a href="#bidi"><span class="secno">3.5</span> <span class="content"> Bidi Reordering</span></a>
      <li><a href="#line-height"><span class="secno">3.6</span> <span class="content"> Line Spacing</span></a>
     </ol>
    <li>
     <a href="#ruby-props"><span class="secno">4</span> <span class="content"> Ruby Formatting Properties</span></a>
     <ol class="toc">
      <li><a href="#rubypos"><span class="secno">4.1</span> <span class="content"> Ruby Positioning: the <span class="property">ruby-position</span> property</span></a>
      <li><a href="#collapsed-ruby"><span class="secno">4.2</span> <span class="content"> Sharing Annotation Space: the <span class="property">ruby-merge</span> property</span></a>
      <li><a href="#ruby-align-property"><span class="secno">4.3</span> <span class="content"><span></span> Ruby Text Distribution: the <span class="property">ruby-align</span> property</span></a>
      <li><a href="#ruby-text-decoration"><span class="secno">4.4</span> <span class="content"> Ruby Text Decoration</span></a>
     </ol>
    <li>
     <a href="#edge-effects"><span class="secno">5</span> <span class="content"> Edge Effects</span></a>
     <ol class="toc">
      <li><a href="#ruby-overhang"><span class="secno">5.1</span> <span class="content"> Overhanging Ruby: the <span class="property">ruby-overhang</span> property</span></a>
      <li><a href="#line-edge"><span class="secno">5.2</span> <span class="content"> Line-edge Alignment</span></a>
     </ol>
    <li>
     <a href="#default-stylesheet"><span class="secno"></span> <span class="content"> Appendix A: Sample Style Sheets</span></a>
     <ol class="toc">
      <li><a href="#default-ua-ruby"><span class="secno"></span> <span class="content"> <span class="secno">A.1</span> Default UA Style Sheet</span></a>
      <li><a href="#default-inline"><span class="secno"></span> <span class="content"> <span class="secno">A.2</span> Inlining Ruby Annotations</span></a>
      <li><a href="#default-parens"><span class="secno"></span> <span class="content"> <span class="secno">A.3</span> Generating Parentheses</span></a>
     </ol>
    <li><a href="#glossary"><span class="secno">6</span> <span class="content"> Glossary</span></a>
    <li><a href="#acknowledgments"><span class="secno"></span> <span class="content"> Acknowledgments</span></a>
    <li>
     <a href="#changes"><span class="secno"></span> <span class="content"> Changes</span></a>
     <ol class="toc">
      <li><a href="#changes-20200429"><span class="secno"></span> <span class="content"> Changes since the 29 April 2020 WD</span></a>
      <li><a href="#changes-20140805"><span class="secno"></span> <span class="content"> Changes since the 5 August 2014 WD</span></a>
      <li><a href="#changes-20130919"><span class="secno"></span> <span class="content"> Changes since the 19 September 2013 WD</span></a>
      <li><a href="#changes-20110630"><span class="secno"></span> <span class="content"> Changes since the 30 June 2011 WD</span></a>
     </ol>
    <li>
     <a href="#w3c-conformance"><span class="secno"></span> <span class="content"> Conformance</span></a>
     <ol class="toc">
      <li><a href="#w3c-conventions"><span class="secno"></span> <span class="content"> Document conventions</span></a>
      <li><a href="#w3c-conformance-classes"><span class="secno"></span> <span class="content"> Conformance classes</span></a>
      <li>
       <a href="#w3c-partial"><span class="secno"></span> <span class="content"> Partial implementations</span></a>
       <ol class="toc">
        <li><a href="#w3c-conform-future-proofing"><span class="secno"></span> <span class="content"> Implementations of Unstable and Proprietary Features</span></a>
       </ol>
      <li><a href="#w3c-testing"><span class="secno"></span> <span class="content"> Non-experimental implementations</span></a>
     </ol>
    <li>
     <a href="#index"><span class="secno"></span> <span class="content">Index</span></a>
     <ol class="toc">
      <li><a href="#index-defined-here"><span class="secno"></span> <span class="content">Terms defined by this specification</span></a>
      <li><a href="#index-defined-elsewhere"><span class="secno"></span> <span class="content">Terms defined by reference</span></a>
     </ol>
    <li>
     <a href="#references"><span class="secno"></span> <span class="content">References</span></a>
     <ol class="toc">
      <li><a href="#normative"><span class="secno"></span> <span class="content">Normative References</span></a>
      <li><a href="#informative"><span class="secno"></span> <span class="content">Informative References</span></a>
     </ol>
    <li><a href="#property-index"><span class="secno"></span> <span class="content">Property Index</span></a>
    <li><a href="#issues-index"><span class="secno"></span> <span class="content">Issues Index</span></a>
   </ol>
  </nav>
  <main>
   <h2 class="heading settled" data-level="1" id="intro"><span class="secno">1. </span><span class="content"> Introduction</span><a class="self-link" href="#intro"></a></h2>
   <h3 class="heading settled" data-level="1.1" id="ruby-def"><span class="secno">1.1. </span><span class="content"> What is ruby?</span><a class="self-link" href="#ruby-def"></a></h3>
   <p><em>This subsection is not normative.</em></p>
   <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-export id="ruby">Ruby</dfn> is the commonly-used name for a run of text
	that appears alongside another run of text (referred to as the “base”)
	and serves as an annotation or a pronunciation guide associated with that run of text.</p>
   <figure>
     <img alt="Hiragana ruby annotations above each kanji in Japanese text" src="images/ruby-context.png"> 
    <figcaption>A run of Japanese text with phonetic ruby annotations indicating the pronunciation of each ideograph.</figcaption>
   </figure>
   <p>The following figures show two examples of Ruby,
	a simple case and one with more complicated structure.</p>
   <div class="example" id="example-43e96817">
    <a class="self-link" href="#example-43e96817"></a> In this example, a single annotation is used to annotate a base text
		consisting of multiple characters. 
    <div class="figure">
      <img alt="Example of ruby applied on top of a Japanese expression" src="images/licence.png"> 
     <p class="caption">Example of ruby used in Japanese (simple case) </p>
    </div>
    <p>In Japanese typography, this case is sometimes called
		taigo ruby (Japanese: <span lang="ja">対語ルビ</span>, i.e. per-word ruby) or group-ruby,
		because the annotation as a whole is associated
		with multi-character word (as a whole).</p>
   </div>
   <div class="example" id="example-a47d36ef">
    <a class="self-link" href="#example-a47d36ef"></a> In this second example,
		two levels of annotations are attached to the base text:
		the hiragana characters on top refer to the pronunciation of each of the base kanji characters,
		while the words “Keio” and “University” on the bottom are give the English translation. 
    <div class="figure">
      <img alt="Example showing complex ruby with annotation text over and under the base characters" src="images/ruby-univ.gif"> 
     <p class="caption">Complex ruby with annotation text over and under the base characters </p>
    </div>
    <p>Notice that to reflect the correct association
		of hiragana characters and their corresponding Kanji base characters,
		the spacing within the base-level text is adjusted.
		(This happens around the fourth Kanji character in the figure above,
		 which has a three-character phonetic gloss.)
		To avoid variable spacing of the base text in the example above,
		the hiragana annotations can be styled as a <a data-link-type="dfn" href="#merged-annotation" id="ref-for-merged-annotation">merged annotation</a>,
		which will look more like the group-ruby example earlier.
		However because the base-annotation <a data-link-type="dfn" href="#pairing" id="ref-for-pairing">pairings</a> are recorded in the ruby structure,
		if the text breaks across lines, the annotation characters will stay
		correctly paired with their respective base characters.</p>
   </div>
   <p>In HTML, ruby structure and markup to represent it is described
	in the Ruby Markup Extension specification.
	This module describes the CSS rendering model
	and formatting controls relevant to ruby layout of such markup.</p>
   <p>A more in-depth introduction to <a data-link-type="dfn" href="#ruby" id="ref-for-ruby">Ruby</a> and its formatting
	can be found in the “What is Ruby“ article <a data-link-type="biblio" href="#biblio-qa-ruby" title="What is ruby?">[QA-RUBY]</a>.
	Extensive information about the main ways <span id="ref-for-ruby①">ruby</span> has traditionally been formatted in Japanese
	can be found in JIS X-4051 <a data-link-type="biblio" href="#biblio-jis4051" title="Formatting rules for Japanese documents (『日本語文書の組版方法』).">[JIS4051]</a> (in Japanese)
	and in <a href="https://www.w3.org/TR/jlreq/#ruby_and_emphasis_dots">“Ruby and Emphasis Dots”</a> in <cite>Requirements for Japanese Text Layout</cite> <a data-link-type="biblio" href="#biblio-jlreq" title="Requirements for Japanese Text Layout 日本語組版処理の要件(日本語版)">[JLREQ]</a> (in English and Japanese); <cite>Rules for Simple Placement of Japanese Ruby</cite> <a data-link-type="biblio" href="#biblio-simple-ruby" title="Rules for Simple Placement of Japanese Ruby">[SIMPLE-RUBY]</a> also describes (in English) one possible approach for Japanese ruby formatting. <a href="https://www.w3.org/TR/clreq/#interlinear_annotations">“Interlinear annotations”</a> in <cite>Requirements for Chinese Text Layout</cite> <a data-link-type="biblio" href="#biblio-clreq" title="Requirements for Chinese Text Layout - 中文排版需求">[CLREQ]</a> describes the related practices for Chinese typography (in Chinese and English).</p>
   <h3 class="heading settled" data-level="1.2" id="placement"><span class="secno">1.2. </span><span class="content"> Module interactions</span><a class="self-link" href="#placement"></a></h3>
   <p>This module extends the inline box model of CSS Level 2 <a data-link-type="biblio" href="#biblio-css2" title="Cascading Style Sheets Level 2 Revision 1 (CSS 2.1) Specification">[CSS2]</a> to support ruby.</p>
   <p>None of the properties in this module apply to the <a class="css" data-link-type="maybe" href="https://drafts.csswg.org/css-pseudo-4/#selectordef-first-line" id="ref-for-selectordef-first-line">::first-line</a> or <a class="css" data-link-type="maybe" href="https://drafts.csswg.org/css-pseudo-4/#selectordef-first-letter" id="ref-for-selectordef-first-letter">::first-letter</a> pseudo-elements;
	however <a class="property css" data-link-type="property" href="#propdef-ruby-position" id="ref-for-propdef-ruby-position">ruby-position</a> can inherit through <span class="css" id="ref-for-selectordef-first-line①">::first-line</span> to affect
	ruby annotations on the first line.</p>
   <h3 class="heading settled" data-level="1.3" id="values"><span class="secno">1.3. </span><span class="content"> Value Definitions</span><a class="self-link" href="#values"></a></h3>
   <p>This specification follows the <a href="https://www.w3.org/TR/CSS2/about.html#property-defs">CSS property definition conventions</a> from <a data-link-type="biblio" href="#biblio-css2" title="Cascading Style Sheets Level 2 Revision 1 (CSS 2.1) Specification">[CSS2]</a> using the <a href="https://www.w3.org/TR/css-values-3/#value-defs">value definition syntax</a> from <a data-link-type="biblio" href="#biblio-css-values-3" title="CSS Values and Units Module Level 3">[CSS-VALUES-3]</a>.
	Value types not defined in this specification are defined in CSS Values &amp; Units <span title="CSS Values and Units Module Level 3">[CSS-VALUES-3]</span>.
	Combination with other CSS modules may expand the definitions of these value types.</p>
   <p>In addition to the property-specific values listed in their definitions,
	all properties defined in this specification
	also accept the <a data-link-type="dfn" href="https://drafts.csswg.org/css-values-4/#css-wide-keywords" id="ref-for-css-wide-keywords">CSS-wide keywords</a> keywords as their property value.
	For readability they have not been repeated explicitly.</p>
   <h3 class="heading settled" data-level="1.4" id="diagram-conventions"><span class="secno">1.4. </span><span class="content"> Diagram conventions</span><a class="self-link" href="#diagram-conventions"></a></h3>
   <p><em>This subsection is not normative.</em></p>
   <p>Many typographical conventions in East Asian typography depend
	on whether the character rendered is wide (CJK) or narrow (non-CJK).
	There are a number of illustrations in this document
	for which the following legend is used:</p>
   <dl>
    <dt><img alt="Symbolic wide-cell glyph representation" height="39" src="images/fullwidth.gif" width="39"> 
    <dd> Wide-cell glyph (e.g. Han) that is the <var>n</var>th character in the text run.
			They are typically sized to 50% when used as annotations. 
    <dt><img alt="Symbolic narrow-cell glyph representation" height="39" src="images/halfwidth.gif" width="19"> 
    <dd>Narrow-cell glyph (e.g. Roman) which is the <var>n</var>th glyph in the text run. 
   </dl>
   <p>The orientation which the above symbols assume in the diagrams
	corresponds to the orientation that the glyphs they represent
	are intended to assume when rendered by the user agent.
	Spacing between these characters in the diagrams is incidental,
	unless intentionally changed to make a point.</p>
   <h2 class="heading settled" data-level="2" id="ruby-model"><span class="secno">2. </span><span class="content"> Ruby Box Model</span><a class="self-link" href="#ruby-model"></a></h2>
   <p>The CSS ruby model is based on
	the <a href="https://www.w3.org/TR/html5/text-level-semantics.html#the-ruby-element">W3C HTML5 Ruby Markup</a> model
	and the <a href="https://www.w3.org/TR/ruby/">XHTML Ruby Annotation Recommendation</a> <a data-link-type="biblio" href="#biblio-ruby" title="Ruby Annotation">[RUBY]</a>.
	In this model, a ruby structure consists of
	one or more <a data-link-type="dfn" href="#ruby-base-box" id="ref-for-ruby-base-box">ruby base</a> elements representing the base (annotated) text,
	associated with one or more levels of <a data-link-type="dfn" href="#ruby-annotation-box" id="ref-for-ruby-annotation-box">ruby annotation</a> elements representing the annotations.
	The structure of ruby is similar to that of a table:
	there are “rows” (the <a data-link-type="dfn" href="#base-level" id="ref-for-base-level">base text level</a>, each <a data-link-type="dfn" href="#annotation-level" id="ref-for-annotation-level">annotation level</a>)
	and “<a data-link-type="dfn" href="#ruby-columns" id="ref-for-ruby-columns">columns</a>” (each <span id="ref-for-ruby-base-box①">ruby base</span> and its corresponding <span id="ref-for-ruby-annotation-box①">ruby annotations</span>).</p>
   <figure>
     <img alt="Ruby structure arranged as a table,
		          the first “column” containing 上 in a base box with じょう centered below in an annotation box
		          and the second “column” containing 手 in a separate base box with ず centered below in another annotation box." src="images/ruby-boxes-simple.png"> 
    <figcaption>The Japanese compound word “上手” annotated with its pronunciation “じょうず”. Each syllable is associated individually with its base character.</figcaption>
   </figure>
   <p>Sets of consecutive bases and their consecutive annotations are grouped together into <a data-link-type="dfn" href="#ruby-segments" id="ref-for-ruby-segments">ruby segments</a>.
	Within a <span id="ref-for-ruby-segments①">ruby segment</span>, a <a data-link-type="dfn" href="#ruby-annotation-box" id="ref-for-ruby-annotation-box②">ruby annotation</a> may span multiple <a data-link-type="dfn" href="#ruby-base-box" id="ref-for-ruby-base-box②">ruby bases</a>.</p>
   <figure>
     <img alt="Ruby structure arranged as a table,
		          the first “column” containing 旧 in a base box with jiù centered above in an annotation box,
		          the second “column” containing 金 in a base box with jīn centered above in an annotation box,
		          the third “column” containing 山 in a base box with .shān centered above it in an annotation box,
		          and the name San Francisco centered below the entire phrase in an annotation box that spans all three “columns”." src="images/ruby-boxes-complex.png"> 
    <figcaption>The Chinese city name “旧金山” annotated with its pronunciation in Pinyin “jiùjīnshān” and its English name “San Francisco”. Each Pinyin syllable is associated individually with its base character, however the English name is associated with the name as a whole.</figcaption>
   </figure>
   <p class="note" role="note"><span class="marker">Note:</span> In HTML, a single <code>&lt;ruby></code> element may contain multiple <a data-link-type="dfn" href="#ruby-segments" id="ref-for-ruby-segments②">ruby segments</a>.
	(In the XHTML Ruby model, a single <code>&lt;ruby></code> element can only contain one <span id="ref-for-ruby-segments③">ruby segment</span>.)</p>
   <h3 class="heading settled" data-level="2.1" id="ruby-display"><span class="secno">2.1. </span><span class="content"> Ruby-specific <a class="property css" data-link-type="property" href="https://drafts.csswg.org/css-display-4/#propdef-display" id="ref-for-propdef-display">display</a> Values</span><a class="self-link" href="#ruby-display"></a></h3>
   <p>For document languages (such as XML applications) that do not have pre-defined ruby elements,
	authors must map document language elements to ruby elements;
	this is done with the <a class="property css" data-link-type="property" href="https://drafts.csswg.org/css-display-4/#propdef-display" id="ref-for-propdef-display①">display</a> property.</p>
   <table class="def propdef partial" data-link-for-hint="display">
    <tbody>
     <tr>
      <th>Name:
      <td><a class="css" data-link-type="property" href="https://drafts.csswg.org/css-display-4/#propdef-display" id="ref-for-propdef-display②">display</a>
     <tr class="value">
      <th><a href="https://www.w3.org/TR/css-values/#value-defs">New values:</a>
      <td class="prod">ruby <a data-link-type="grammar" href="https://drafts.csswg.org/css-values-4/#comb-one" id="ref-for-comb-one">|</a> ruby-base <span id="ref-for-comb-one①">|</span> ruby-text <span id="ref-for-comb-one②">|</span> ruby-base-container <span id="ref-for-comb-one③">|</span> ruby-text-container 
   </table>
   <p>The following new <a class="property css" data-link-type="property" href="https://drafts.csswg.org/css-display-4/#propdef-display" id="ref-for-propdef-display③">display</a> values assign ruby layout roles to an arbitrary element:</p>
   <dl>
    <dt><dfn class="dfn-paneled css" data-dfn-for="display" data-dfn-type="value" data-export id="valdef-display-ruby">ruby</dfn> 
    <dd> Specifies that an element generates a <dfn class="dfn-paneled" data-dfn-for data-dfn-type="dfn" data-export data-lt="ruby container | ruby container box" id="ruby-container">ruby container box</dfn>.
			(Corresponds to HTML/XHTML <code>&lt;ruby></code> elements.) 
    <dt><dfn class="dfn-paneled css" data-dfn-for="display" data-dfn-type="value" data-export id="valdef-display-ruby-base">ruby-base</dfn> 
    <dd> Specifies that an element generates a <dfn class="dfn-paneled" data-dfn-for data-dfn-type="dfn" data-export data-lt="ruby base box | ruby base | base | base box" id="ruby-base-box">ruby base box</dfn>.
			(Corresponds to HTML/XHTML <code>&lt;rb></code> elements.) 
    <dt><dfn class="dfn-paneled css" data-dfn-for="display" data-dfn-type="value" data-export id="valdef-display-ruby-text">ruby-text</dfn> 
    <dd> Specifies that an element generates a <dfn class="dfn-paneled" data-dfn-for data-dfn-type="dfn" data-export data-lt="ruby annotation box | ruby annotation | annotation | annotation box" id="ruby-annotation-box">ruby annotation box</dfn>.
			(Corresponds to HTML/XHTML <code>&lt;rt></code> elements.) 
    <dt><dfn class="dfn-paneled css" data-dfn-for="display" data-dfn-type="value" data-export id="valdef-display-ruby-base-container">ruby-base-container</dfn> 
    <dd> Specifies that an element generates a <dfn class="dfn-paneled" data-dfn-for data-dfn-type="dfn" data-export data-local-lt="base container" data-lt="ruby base container box | ruby base container" id="ruby-base-container-box">ruby base container box</dfn>.
			(Corresponds to XHTML <code>&lt;rbc></code> elements; generated as an anonymous box in HTML.) 
    <dt><dfn class="dfn-paneled css" data-dfn-for="display" data-dfn-type="value" data-export id="valdef-display-ruby-text-container">ruby-text-container</dfn> 
    <dd> Specifies that an element generates a <dfn class="dfn-paneled" data-dfn-for data-dfn-type="dfn" data-export data-local-lt="annotation container" data-lt="ruby annotation container box | ruby annotation container" id="ruby-annotation-container-box">ruby annotation container box</dfn>.
			(Corresponds to HTML/XHTML <code>&lt;rtc></code> elements.) 
   </dl>
   <p class="advisement">Authors using a language (such as HTML)
	that supports dedicated ruby markup
	should use that markup rather than
	styling arbitrary elements (like <code>&lt;span></code>)
	with ruby <a class="property css" data-link-type="property" href="https://drafts.csswg.org/css-display-4/#propdef-display" id="ref-for-propdef-display④">display</a> values.
	Using the correct markup ensures that screen readers
	and non-CSS renderers can interpret the ruby structures. </p>
   <h4 class="heading settled" data-level="2.1.1" id="formatting-context"><span class="secno">2.1.1. </span><span class="content"> The Ruby Formatting Context</span><a class="self-link" href="#formatting-context"></a></h4>
   <p><a data-link-type="dfn" href="#ruby-container" id="ref-for-ruby-container">Ruby containers</a> are non-atomic <a data-link-type="dfn" href="https://drafts.csswg.org/css-display-4/#inline-level" id="ref-for-inline-level">inline-level</a> boxes.
	Like regular <a data-link-type="dfn" href="https://drafts.csswg.org/css-display-4/#inline-box" id="ref-for-inline-box">inline boxes</a> (see <a href="https://drafts.csswg.org/css-inline-3/#model"><cite>CSS Inline Layout 3</cite> § 2 Inline Layout Model</a>),
	they break across lines,
	and their <a data-link-type="dfn" href="https://drafts.csswg.org/css-display-4/#containing-block" id="ref-for-containing-block">containing block</a> is the nearest <a data-link-type="dfn" href="https://drafts.csswg.org/css-display-4/#block-container" id="ref-for-block-container">block container</a> ancestor.
	And just as the contents of an <span id="ref-for-inline-box①">inline box</span> participate in the same <a data-link-type="dfn" href="https://drafts.csswg.org/css-display-4/#inline-formatting-context" id="ref-for-inline-formatting-context">inline formatting context</a> that contains the <span id="ref-for-inline-box②">inline box</span> itself,
	a <span id="ref-for-ruby-container①">ruby container</span> and its base-level contents
	participate in the same <span id="ref-for-inline-formatting-context①">inline formatting context</span> that contains the <span id="ref-for-ruby-container②">ruby container</span> itself.</p>
   <p>However <a data-link-type="dfn" href="#ruby-container" id="ref-for-ruby-container③">ruby containers</a> also establish a <dfn class="dfn-paneled" data-dfn-type="dfn" data-export id="ruby-formatting-context">ruby formatting context</dfn> that builds further structure around their segment of the <a data-link-type="dfn" href="https://drafts.csswg.org/css-display-4/#inline-formatting-context" id="ref-for-inline-formatting-context②">inline formatting context</a> in order to host their annotations. <span class="note">Note: this <a data-link-type="dfn" href="https://drafts.csswg.org/css-display-4/#formatting-context" id="ref-for-formatting-context">formatting context</a> is <em>not</em> an <a data-link-type="dfn" href="https://drafts.csswg.org/css-display-4/#independent-formatting-context" id="ref-for-independent-formatting-context">independent formatting context</a>.</span> <a data-link-type="dfn" href="#ruby-base-box" id="ref-for-ruby-base-box③">Ruby bases</a>, <a data-link-type="dfn" href="#ruby-annotation-box" id="ref-for-ruby-annotation-box③">ruby annotations</a>, <a data-link-type="dfn" href="#ruby-base-container-box" id="ref-for-ruby-base-container-box">ruby base containers</a>, and <a data-link-type="dfn" href="#ruby-annotation-container-box" id="ref-for-ruby-annotation-container-box">ruby annotation containers</a> are <dfn class="dfn-paneled" data-dfn-type="dfn" data-export data-lt="internal ruby boxes|internal ruby display types" id="internal-ruby-boxes">internal ruby boxes</dfn>:
	like <a data-link-type="dfn" href="https://drafts.csswg.org/css-display-4/#internal-table-element" id="ref-for-internal-table-element">internal table elements</a>,
	they have specific roles in ruby layout,
	and participate in their <span id="ref-for-ruby-container④">ruby container</span>’s <a data-link-type="dfn" href="#ruby-formatting-context" id="ref-for-ruby-formatting-context">ruby formatting context</a>.
	In addition to their role in the <span id="ref-for-ruby-formatting-context①">ruby formatting context</span>, <span id="ref-for-ruby-base-box④">ruby bases</span> simultaneously participate
	in the same base-level <span id="ref-for-inline-formatting-context③">inline formatting context</span> as the <span id="ref-for-ruby-container⑤">ruby container</span>,
	while <span id="ref-for-ruby-annotation-box④">ruby annotations</span> participate
	in separate annotation-level <span id="ref-for-inline-formatting-context④">inline formatting contexts</span> established by the <span id="ref-for-ruby-container⑥">ruby container</span>.</p>
   <p>As with the contents of <a data-link-type="dfn" href="https://drafts.csswg.org/css-display-4/#inline-box" id="ref-for-inline-box③">inline boxes</a>,
	the <a data-link-type="dfn" href="https://drafts.csswg.org/css-display-4/#containing-block" id="ref-for-containing-block①">containing block</a> for the contents of a <a data-link-type="dfn" href="#ruby-container" id="ref-for-ruby-container⑦">ruby container</a> (and all its <a data-link-type="dfn" href="#internal-ruby-boxes" id="ref-for-internal-ruby-boxes">internal ruby boxes</a>)
	is the <span id="ref-for-containing-block②">containing block</span> of the <span id="ref-for-ruby-container⑧">ruby container</span>.
	So floats, for example, are trapped by the <span id="ref-for-ruby-container⑨">ruby container</span>’s <span id="ref-for-containing-block③">containing block</span>,
	not any of the ruby box types.</p>
   <h4 class="heading settled" data-level="2.1.2" id="block-ruby"><span class="secno">2.1.2. </span><span class="content"> Non-Inline Ruby</span><a class="self-link" href="#block-ruby"></a></h4>
   <p>If an element has an <a data-link-type="dfn" href="https://drafts.csswg.org/css-display-4/#inner-display-type" id="ref-for-inner-display-type">inner display type</a> of <a class="css" data-link-type="maybe" href="#valdef-display-ruby" id="ref-for-valdef-display-ruby">ruby</a> and an <a data-link-type="dfn" href="https://drafts.csswg.org/css-display-4/#outer-display-type" id="ref-for-outer-display-type">outer display type</a> other than <a class="css" data-link-type="maybe" href="https://drafts.csswg.org/css-display-4/#valdef-display-inline" id="ref-for-valdef-display-inline">inline</a>,
	then it generates two boxes:
	a principal box of the required <span id="ref-for-outer-display-type①">outer display type</span> type,
	and an inline-level <a data-link-type="dfn" href="#ruby-container" id="ref-for-ruby-container①⓪">ruby container</a>.
	All properties specified on the element apply to the principal box
	(and if inheritable, inherit to the <span id="ref-for-ruby-container①①">ruby container box</span>).
	This allows styling the element as a block,
	while correctly maintaining the internal ruby structure.</p>
   <p class="note" role="note"><span class="marker">Note:</span> Absolute positioning or floating an element causes its <a class="property css" data-link-type="property" href="https://drafts.csswg.org/css-display-4/#propdef-display" id="ref-for-propdef-display⑤">display</a> value
	to compute to a block-level equivalent. (See <a data-link-type="biblio" href="#biblio-css-display-3" title="CSS Display Module Level 3">[CSS-DISPLAY-3]</a> or <a data-link-type="biblio" href="#biblio-css2" title="Cascading Style Sheets Level 2 Revision 1 (CSS 2.1) Specification">[CSS2]</a> section 9.7.)
	For the <a data-link-type="dfn" href="#internal-ruby-boxes" id="ref-for-internal-ruby-boxes①">internal ruby display types</a>,
	this causes their <span class="property" id="ref-for-propdef-display⑥">display</span> value to compute to <a class="css" data-link-type="maybe" href="https://drafts.csswg.org/css-display-4/#valdef-display-block" id="ref-for-valdef-display-block">block</a>.</p>
   <h3 class="heading settled" data-level="2.2" id="box-fixup"><span class="secno">2.2. </span><span class="content"> Anonymous Ruby Box Generation</span><a class="self-link" href="#box-fixup"></a></h3>
   <p>The CSS model does not require that the document language
	include elements that correspond to each of these components.
	Missing parts of the structure are implied through the anonymous box generation rules <a href="https://www.w3.org/TR/CSS2/tables.html#anonymous-boxes">similar to those used to normalize tables</a>. <a data-link-type="biblio" href="#biblio-css2" title="Cascading Style Sheets Level 2 Revision 1 (CSS 2.1) Specification">[CSS2]</a></p>
   <ol>
    <li id="anon-gen-inlinize"><a class="self-link" href="#anon-gen-inlinize"></a><strong><a data-link-type="dfn" href="https://drafts.csswg.org/css-display-4/#inlinify" id="ref-for-inlinify">Inlinify</a> block-level boxes:</strong> Any in-flow boxes directly contained by a <a data-link-type="dfn" href="#ruby-container" id="ref-for-ruby-container①②">ruby container</a>, <a data-link-type="dfn" href="#ruby-base-container-box" id="ref-for-ruby-base-container-box①">ruby base container</a>, <a data-link-type="dfn" href="#ruby-annotation-container-box" id="ref-for-ruby-annotation-container-box①">ruby annotation container</a>, <a data-link-type="dfn" href="#ruby-base-box" id="ref-for-ruby-base-box⑤">ruby base box</a>,
			or <a data-link-type="dfn" href="#ruby-annotation-box" id="ref-for-ruby-annotation-box⑤">ruby annotation box</a> are “<a data-link-type="dfn" href="https://drafts.csswg.org/css-display-4/#inlinify" id="ref-for-inlinify①">inlinified</a>” per <a data-link-type="biblio" href="#biblio-css-display-3" title="CSS Display Module Level 3">[CSS-DISPLAY-3]</a>),
			and their <a class="property css" data-link-type="property" href="https://drafts.csswg.org/css-display-4/#propdef-display" id="ref-for-propdef-display⑦">display</a> value computed accordingly,
			so that they contain only inline-level content.
			For example,
			the <span class="property" id="ref-for-propdef-display⑧">display</span> property of an in-flow element with <span class="css" id="ref-for-propdef-display⑨">display: block</span> parented by an element with <span class="css" id="ref-for-propdef-display①⓪">display: ruby-text</span> computes to <a class="css" data-link-type="maybe" href="https://drafts.csswg.org/css-display-4/#valdef-display-inline-block" id="ref-for-valdef-display-inline-block">inline-block</a>. 
    <li id="anon-gen-anon-ruby">
     <a class="self-link" href="#anon-gen-anon-ruby"></a><strong>Generate anonymous ruby containers:</strong> Any <a href="https://www.w3.org/TR/CSS2/tables.html#anonymous-boxes">consecutive</a> sequence of
			improperly-contained <a data-link-type="dfn" href="#ruby-base-container-box" id="ref-for-ruby-base-container-box②">ruby base containers</a>, <a data-link-type="dfn" href="#ruby-annotation-container-box" id="ref-for-ruby-annotation-container-box②">ruby annotation containers</a>, <a data-link-type="dfn" href="#ruby-base-box" id="ref-for-ruby-base-box⑥">ruby bases</a>,
			and/or <a data-link-type="dfn" href="#ruby-annotation-box" id="ref-for-ruby-annotation-box⑥">ruby annotations</a> (and any intervening <a data-link-type="dfn" href="https://drafts.csswg.org/css-text-4/#white-space" id="ref-for-white-space">white space</a>)
			is wrapped in an anonymous <a data-link-type="dfn" href="#ruby-container" id="ref-for-ruby-container①③">ruby container</a>.
			For the purpose of this step: 
     <ul>
      <li>an improperly-contained <a data-link-type="dfn" href="#ruby-base-box" id="ref-for-ruby-base-box⑦">ruby base</a> is one not parented by a <a data-link-type="dfn" href="#ruby-base-container-box" id="ref-for-ruby-base-container-box③">ruby base container</a> or <a data-link-type="dfn" href="#ruby-container" id="ref-for-ruby-container①④">ruby container</a> 
      <li>an improperly-contained <a data-link-type="dfn" href="#ruby-annotation-box" id="ref-for-ruby-annotation-box⑦">ruby annotation</a> is one not parented by a <a data-link-type="dfn" href="#ruby-annotation-container-box" id="ref-for-ruby-annotation-container-box③">ruby annotation container</a> or <a data-link-type="dfn" href="#ruby-container" id="ref-for-ruby-container①⑤">ruby container</a> 
      <li> an improperly-contained <a data-link-type="dfn" href="#ruby-base-container-box" id="ref-for-ruby-base-container-box④">ruby base container</a> or <a data-link-type="dfn" href="#ruby-annotation-container-box" id="ref-for-ruby-annotation-container-box④">ruby annotation container</a> is one not parented by a <a data-link-type="dfn" href="#ruby-container" id="ref-for-ruby-container①⑥">ruby container</a> 
     </ul>
    <li id="anon-gen-bare-inlines">
     <a class="self-link" href="#anon-gen-bare-inlines"></a><strong>Wrap misparented inline-level content:</strong> Any consecutive sequence of text and inline-level boxes
			directly parented by a <a data-link-type="dfn" href="#ruby-container" id="ref-for-ruby-container①⑦">ruby container</a> or <a data-link-type="dfn" href="#ruby-base-container-box" id="ref-for-ruby-base-container-box⑤">ruby base container</a> is wrapped in an anonymous <a data-link-type="dfn" href="#ruby-base-box" id="ref-for-ruby-base-box⑧">ruby base</a>.
			Similarly, any consecutive sequence of text and inline-level boxes
			directly parented by a <a data-link-type="dfn" href="#ruby-annotation-container-box" id="ref-for-ruby-annotation-container-box⑤">ruby annotation container</a> is wrapped in an anonymous <a data-link-type="dfn" href="#ruby-annotation-box" id="ref-for-ruby-annotation-box⑧">ruby annotation</a>.
			(For this purpose, misparented <a data-link-type="dfn" href="https://drafts.csswg.org/css-display-4/#internal-table-element" id="ref-for-internal-table-element①">internal table elements</a> are treated as <a data-link-type="dfn" href="https://drafts.csswg.org/css-display-4/#inline-level" id="ref-for-inline-level①">inline-level content</a> since, being parented by ruby boxes,
			they will be ultimately wrapped by an <span id="ref-for-inline-level②">inline-level</span> <a data-link-type="dfn" href="https://drafts.csswg.org/css-tables-3/#table-wrapper-box" id="ref-for-table-wrapper-box">table wrapper box</a>.) 
     <p>However, if an anonymous box so constructed contains only <a data-link-type="dfn" href="https://drafts.csswg.org/css-text-4/#white-space" id="ref-for-white-space①">white space</a>,
			it is considered <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="intra-ruby-white-space">intra-ruby white space</dfn> and is either discarded
			or preserved
			as described below.</p>
    <li id="anon-gen-trim-space"><a class="self-link" href="#anon-gen-trim-space"></a><strong>Trim leading/trailing white space:</strong> Any <a data-link-type="dfn" href="#intra-ruby-white-space" id="ref-for-intra-ruby-white-space">intra-ruby white space</a> that is not the sole <a data-link-type="dfn" href="https://drafts.csswg.org/css-display-4/#in-flow" id="ref-for-in-flow">in-flow</a> child of its parent
			and is the first or last <span id="ref-for-in-flow①">in-flow</span> child of
			a <a data-link-type="dfn" href="#ruby-container" id="ref-for-ruby-container①⑧">ruby container</a>, <a data-link-type="dfn" href="#ruby-annotation-container-box" id="ref-for-ruby-annotation-container-box⑥">ruby annotation container</a>, or <a data-link-type="dfn" href="#ruby-base-container-box" id="ref-for-ruby-base-container-box⑥">ruby base container</a> is removed, as if it had <a class="css" data-link-type="propdesc" href="https://drafts.csswg.org/css-display-4/#propdef-display" id="ref-for-propdef-display①①">display: none</a> 
    <li id="anon-gen-discard-space">
     <a class="self-link" href="#anon-gen-discard-space"></a><strong>Remove inter-level white space:</strong> Any <a data-link-type="dfn" href="#intra-ruby-white-space" id="ref-for-intra-ruby-white-space①">intra-ruby white space</a> whose immediately adjacent <a data-link-type="dfn" href="https://drafts.csswg.org/css-display-4/#in-flow" id="ref-for-in-flow②">in-flow</a> siblings match one of the patterns below
			is <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="inter-level-white-space">inter-level white space</dfn> and is removed, as if it had <a class="css" data-link-type="propdesc" href="https://drafts.csswg.org/css-display-4/#propdef-display" id="ref-for-propdef-display①②">display: none</a>. 
     <table class="data">
      <thead>
       <tr>
        <th>Previous box 
        <th>Next box 
      <tbody>
       <tr>
        <td>any 
        <td><a data-link-type="dfn" href="#ruby-annotation-container-box" id="ref-for-ruby-annotation-container-box⑦">ruby annotation container</a> 
       <tr>
        <td>not <a data-link-type="dfn" href="#ruby-annotation-box" id="ref-for-ruby-annotation-box⑨">ruby annotation</a> 
        <td><a data-link-type="dfn" href="#ruby-annotation-box" id="ref-for-ruby-annotation-box①⓪">ruby annotation</a> 
     </table>
    <li id="anon-gen-interpret-space">
     <a class="self-link" href="#anon-gen-interpret-space"></a><strong>Interpret intra-level white space:</strong> Any <a data-link-type="dfn" href="#intra-ruby-white-space" id="ref-for-intra-ruby-white-space②">intra-ruby white space</a> box
			whose immediately adjacent <a data-link-type="dfn" href="https://drafts.csswg.org/css-display-4/#in-flow" id="ref-for-in-flow③">in-flow</a> siblings match one of the patterns below
			is assigned the box type and subtype defined in the table below: 
     <table class="data">
      <colgroup span="2">
      <colgroup span="2">
      <thead>
       <tr>
        <th>Previous box 
        <th>Next box 
        <th>Box type 
        <th>Subtype 
      <tbody>
       <tr>
        <td><a data-link-type="dfn" href="#ruby-base-box" id="ref-for-ruby-base-box⑨">ruby base</a> 
        <td><a data-link-type="dfn" href="#ruby-base-box" id="ref-for-ruby-base-box①⓪">ruby base</a> 
        <td><a data-link-type="dfn" href="#ruby-base-box" id="ref-for-ruby-base-box①①">ruby base</a> 
        <td><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="inter-base-white-space">inter-base white space</dfn> 
       <tr>
        <td><a data-link-type="dfn" href="#ruby-annotation-box" id="ref-for-ruby-annotation-box①①">ruby annotation</a> 
        <td><a data-link-type="dfn" href="#ruby-annotation-box" id="ref-for-ruby-annotation-box①②">ruby annotation</a> 
        <td><a data-link-type="dfn" href="#ruby-annotation-box" id="ref-for-ruby-annotation-box①③">ruby annotation</a> 
        <td><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="inter-annotation-white-space">inter-annotation white space</dfn> 
       <tr>
        <td><a data-link-type="dfn" href="#ruby-annotation-box" id="ref-for-ruby-annotation-box①④">ruby annotation</a> or <a data-link-type="dfn" href="#ruby-annotation-container-box" id="ref-for-ruby-annotation-container-box⑧">ruby annotation container</a> 
        <td><a data-link-type="dfn" href="#ruby-base-box" id="ref-for-ruby-base-box①②">ruby base</a> or <a data-link-type="dfn" href="#ruby-base-container-box" id="ref-for-ruby-base-container-box⑦">ruby base container</a> 
        <td rowspan="3"><a data-link-type="dfn" href="#ruby-base-box" id="ref-for-ruby-base-box①③">ruby base</a> 
        <td rowspan="3"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="inter-segment-white-space">inter-segment white space</dfn> 
       <tr>
        <td><a data-link-type="dfn" href="#ruby-base-box" id="ref-for-ruby-base-box①④">ruby base</a> or <a data-link-type="dfn" href="#ruby-base-container-box" id="ref-for-ruby-base-container-box⑧">ruby base container</a> 
        <td><a data-link-type="dfn" href="#ruby-base-container-box" id="ref-for-ruby-base-container-box⑨">ruby base container</a> 
       <tr>
        <td><a data-link-type="dfn" href="#ruby-base-container-box" id="ref-for-ruby-base-container-box①⓪">ruby base container</a> 
        <td><a data-link-type="dfn" href="#ruby-base-box" id="ref-for-ruby-base-box①⑤">ruby base</a> or <a data-link-type="dfn" href="#ruby-base-container-box" id="ref-for-ruby-base-container-box①①">ruby base container</a> 
     </table>
      The <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="intra-level-white-space">intra-level white space</dfn> boxes defined above
			are treated specially for <a data-link-type="dfn" href="#pairing" id="ref-for-pairing①">pairing</a> and layout.
			See below. 
    <li id="anon-gen-unbreak">
     <a class="self-link" href="#anon-gen-unbreak"></a><strong>Suppress line breaks:</strong> Convert all forced line breaks inside <a data-link-type="dfn" href="#ruby-annotation-box" id="ref-for-ruby-annotation-box①⑤">ruby annotations</a> (regardless of <a class="property css" data-link-type="property" href="https://drafts.csswg.org/css-text-4/#propdef-white-space" id="ref-for-propdef-white-space">white-space</a> value)
			as defined for collapsible segment breaks in <a href="https://www.w3.org/TR/css-text-3/#line-break-transform">CSS Text Level 3 § 4.1.2</a>. 
     <p class="issue" id="issue-f0987196"><a class="self-link" href="#issue-f0987196"></a> The goal of this is to simplify the layout model by suppressing any line breaks within ruby annotations.
			Alternatively we could try to define some kind of acceptable behavior for them.</p>
    <li id="anon-gen-anon-containers"><a class="self-link" href="#anon-gen-anon-containers"></a><strong>Generate anonymous level containers:</strong> Any consecutive sequence of <a data-link-type="dfn" href="#ruby-base-box" id="ref-for-ruby-base-box①⑥">ruby bases</a> and <a data-link-type="dfn" href="#inter-base-white-space" id="ref-for-inter-base-white-space">inter-base white space</a> (and not <a data-link-type="dfn" href="#inter-segment-white-space" id="ref-for-inter-segment-white-space">inter-segment white space</a>)
			not parented by a <a data-link-type="dfn" href="#ruby-base-container-box" id="ref-for-ruby-base-container-box①②">ruby base container</a> is wrapped in an anonymous <span id="ref-for-ruby-base-container-box①③">ruby base container</span>.
			Similarly, any consecutive sequence of <a data-link-type="dfn" href="#ruby-annotation-box" id="ref-for-ruby-annotation-box①⑥">ruby annotations</a> and <a data-link-type="dfn" href="#inter-annotation-white-space" id="ref-for-inter-annotation-white-space">inter-annotation white space</a> not parented by a <a data-link-type="dfn" href="#ruby-annotation-container-box" id="ref-for-ruby-annotation-container-box⑨">ruby annotation container</a> is wrapped in an anonymous <span id="ref-for-ruby-annotation-container-box①⓪">ruby annotation container</span>. 
   </ol>
   <p>Once all ruby layout structures are properly parented,
	the UA can start to associate bases with their annotations.</p>
   <p class="note" role="note"><span class="marker">Note:</span> The UA is not required to create any of these anonymous boxes
	(or the anonymous empty <a data-link-type="dfn" href="#intra-level-white-space" id="ref-for-intra-level-white-space">intra-level white space</a> boxes in <a href="#ruby-pairing">§ 2.3 Annotation Pairing</a>)
	in its internal structures,
	as long as <a data-link-type="dfn" href="#pairing" id="ref-for-pairing②">pairing</a> and layout behaves as if they existed.</p>
   <div class="example" id="example-4b85d1ff">
    <a class="self-link" href="#example-4b85d1ff"></a> The following markup diagram representing the various boxes
		shows where <a data-link-type="dfn" href="#intra-ruby-white-space" id="ref-for-intra-ruby-white-space③">intra-ruby white space</a> is preserved or discarded: 
<pre class="highlight" style="white-space: normal; overflow-wrap: break-word"><c- p>&lt;</c-><c- f>ruby</c-><c- p>></c->×<c- p>&lt;</c-><c- f>rbc</c-><c- p>></c->×<c- p>&lt;</c-><c- f>rb</c-><c- p>>&lt;/</c-><c- f>rb</c-><c- p>></c->⬕<c- p>&lt;</c-><c- f>rb</c-><c- p>>&lt;/</c-><c- f>rb</c-><c- p>></c->×<c- p>&lt;/</c-><c- f>rbc</c-><c- p>></c->☒<c- p>&lt;</c-><c- f>rtc</c-><c- p>></c->×<c- p>&lt;</c-><c- f>rt</c-><c- p>>&lt;/</c-><c- f>rt</c-><c- p>></c->⬔<c- p>&lt;</c-><c- f>rt</c-><c- p>>&lt;/</c-><c- f>rt</c-><c- p>></c->×<c- p>&lt;/</c-><c- f>rtc</c-><c- p>></c->◼<c- p>&lt;</c-><c- f>rbc</c-><c- p>></c->×<c- p>&lt;</c-><c- f>rb</c-><c- p>>&lt;/</c-><c- f>rb</c-><c- p>></c->…<c- p>&lt;/</c-><c- f>rtc</c-><c- p>></c->×<c- p>&lt;/</c-><c- f>ruby</c-><c- p>></c->
</pre>
    <p>where</p>
    <ul>
     <li data-md>
      <p>× represents <a href="#anon-gen-trim-space">discarded leading/trailing white space</a></p>
     <li data-md>
      <p>☒ represents <a href="#anon-gen-discard-space">discarded inter-level white space</a></p>
     <li data-md>
      <p>⬕ represents <a data-link-type="dfn" href="#inter-base-white-space" id="ref-for-inter-base-white-space①">inter-base white space</a></p>
     <li data-md>
      <p>⬔ represents <a data-link-type="dfn" href="#inter-annotation-white-space" id="ref-for-inter-annotation-white-space①">inter-annotation white space</a></p>
     <li data-md>
      <p>◼ represents <a data-link-type="dfn" href="#inter-segment-white-space" id="ref-for-inter-segment-white-space①">inter-segment white space</a></p>
    </ul>
   </div>
   <h3 class="heading settled" data-level="2.3" id="ruby-pairing"><span class="secno">2.3. </span><span class="content"> Annotation Pairing</span><a class="self-link" href="#ruby-pairing"></a></h3>
   <p>Annotation <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="pairing">pairing</dfn> is the process of associating <a data-link-type="dfn" href="#ruby-annotation-box" id="ref-for-ruby-annotation-box①⑦">ruby annotations</a> with <a data-link-type="dfn" href="#ruby-base-box" id="ref-for-ruby-base-box①⑦">ruby bases</a>.
	Each <span id="ref-for-ruby-annotation-box①⑧">ruby annotation</span> is associated with one or more <span id="ref-for-ruby-base-box①⑧">ruby bases</span>,
	and is said to <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="span">span</dfn> those bases.
	(A <span id="ref-for-ruby-annotation-box①⑨">ruby annotation</span> that <a data-link-type="dfn" href="#span" id="ref-for-span">spans</a> multiple bases is called
	a <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="spanning-annotation">spanning annotation</dfn>.)</p>
   <p>A <a data-link-type="dfn" href="#ruby-base-box" id="ref-for-ruby-base-box①⑨">ruby base</a> is can be associated with
	only one <a data-link-type="dfn" href="#ruby-annotation-box" id="ref-for-ruby-annotation-box②⓪">ruby annotation</a> per <a data-link-type="dfn" href="#annotation-level" id="ref-for-annotation-level①">annotation level</a>.
	However, if there are multiple <span id="ref-for-annotation-level②">annotation levels</span>,
	it can be associated with multiple <span id="ref-for-ruby-annotation-box②①">ruby annotations</span>.</p>
   <p>Once <a data-link-type="dfn" href="#pairing" id="ref-for-pairing③">pairing</a> is complete, <dfn class="dfn-paneled" data-dfn-type="dfn" data-local-lt="column" data-noexport id="ruby-columns">ruby columns</dfn> are defined,
	each represented by a single <a data-link-type="dfn" href="#ruby-base-box" id="ref-for-ruby-base-box②⓪">ruby base</a> and one <a data-link-type="dfn" href="#ruby-annotation-box" id="ref-for-ruby-annotation-box②②">ruby annotation</a> (possibly an empty, anonymous one)
	from each <a data-link-type="dfn" href="#interlinear-annotations" id="ref-for-interlinear-annotations">interlinear</a> <a data-link-type="dfn" href="#annotation-level" id="ref-for-annotation-level③">annotation level</a> in its <a data-link-type="dfn" href="#ruby-segments" id="ref-for-ruby-segments④">ruby segment</a>.</p>
   <h4 class="heading settled" data-level="2.3.1" id="segment-pairing"><span class="secno">2.3.1. </span><span class="content"> Segment Pairing and Annotation Levels</span><a class="self-link" href="#segment-pairing"></a></h4>
   <p>A ruby structure is divided into <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="ruby-segments">ruby segments</dfn>,
	each consisting of a single <a data-link-type="dfn" href="#ruby-base-container-box" id="ref-for-ruby-base-container-box①④">ruby base container</a> followed by one or more <a data-link-type="dfn" href="#ruby-annotation-container-box" id="ref-for-ruby-annotation-container-box①①">ruby annotation containers</a>.
	Each <span id="ref-for-ruby-annotation-container-box①②">ruby annotation container</span> in a <a data-link-type="dfn" href="#ruby-segments" id="ref-for-ruby-segments⑤">ruby segment</a> represents one <dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="annotation level | level" data-noexport id="annotation-level">level</dfn> of annotation for the base text:
	the first one represents the first level of annotation,
	the second one represents the second level of annotation,
	and so on.
	The <span id="ref-for-ruby-base-container-box①⑤">ruby base container</span> represents the <dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="base level | base text level" data-noexport id="base-level">base level</dfn>.
	The <span id="ref-for-ruby-base-container-box①⑥">ruby base container</span> in each segment is thus paired
	with each of the <span id="ref-for-ruby-annotation-container-box①③">ruby annotation containers</span> in that segment.</p>
   <p>In order to handle degenerate cases, some empty anonymous containers are assumed:</p>
   <ul>
    <li> If the first child of a <a data-link-type="dfn" href="#ruby-container" id="ref-for-ruby-container①⑨">ruby container</a> is a <a data-link-type="dfn" href="#ruby-annotation-container-box" id="ref-for-ruby-annotation-container-box①④">ruby annotation container</a>,
			an anonymous, empty <a data-link-type="dfn" href="#ruby-base-container-box" id="ref-for-ruby-base-container-box①⑦">ruby base container</a> is assumed to exist before it. 
    <li> Similarly, if the <a data-link-type="dfn" href="#ruby-container" id="ref-for-ruby-container②⓪">ruby container</a> contains consecutive <a data-link-type="dfn" href="#ruby-base-container-box" id="ref-for-ruby-base-container-box①⑧">ruby base containers</a>,
			anonymous, empty <a data-link-type="dfn" href="#ruby-annotation-container-box" id="ref-for-ruby-annotation-container-box①⑤">ruby annotation containers</a> are assumed to exist between them. 
   </ul>
   <p><a data-link-type="dfn" href="#inter-segment-white-space" id="ref-for-inter-segment-white-space②">Inter-segment white space</a> is effectively a <a data-link-type="dfn" href="#ruby-segments" id="ref-for-ruby-segments⑥">ruby segment</a> of its own.</p>
   <h4 class="heading settled" data-level="2.3.2" id="base-annotation-pairing"><span class="secno">2.3.2. </span><span class="content"> Unit Pairing and Spanning Annotations</span><a class="self-link" href="#base-annotation-pairing"></a></h4>
   <p>Within a <a data-link-type="dfn" href="#ruby-segments" id="ref-for-ruby-segments⑦">ruby segment</a>,
	each <a data-link-type="dfn" href="#ruby-base-box" id="ref-for-ruby-base-box②①">ruby base</a> in the <a data-link-type="dfn" href="#ruby-base-container-box" id="ref-for-ruby-base-container-box①⑨">ruby base container</a> is paired with one <a data-link-type="dfn" href="#ruby-annotation-box" id="ref-for-ruby-annotation-box②③">ruby annotation</a> from each <a data-link-type="dfn" href="#ruby-annotation-container-box" id="ref-for-ruby-annotation-container-box①⑥">ruby annotation container</a> in its <span id="ref-for-ruby-segments⑧">ruby segment</span>.</p>
   <p>If a <a data-link-type="dfn" href="#ruby-annotation-container-box" id="ref-for-ruby-annotation-container-box①⑦">ruby annotation container</a> contains only
	a single, anonymous <a data-link-type="dfn" href="#ruby-annotation-box" id="ref-for-ruby-annotation-box②④">ruby annotation</a>,
	then that <span id="ref-for-ruby-annotation-box②⑤">ruby annotation</span> is paired with (i.e. <a data-link-type="dfn" href="#span" id="ref-for-span①">spans</a> across)
	all of the <a data-link-type="dfn" href="#ruby-base-box" id="ref-for-ruby-base-box②②">ruby bases</a> in its <a data-link-type="dfn" href="#ruby-segments" id="ref-for-ruby-segments⑨">ruby segment</a>.</p>
   <p>Otherwise, each <a data-link-type="dfn" href="#ruby-annotation-box" id="ref-for-ruby-annotation-box②⑥">ruby annotation</a> is paired,
	in document order, with the corresponding <a data-link-type="dfn" href="#ruby-base-box" id="ref-for-ruby-base-box②③">ruby base</a> in that segment.
	If there are not enough <span id="ref-for-ruby-annotation-box②⑦">ruby annotations</span> in a <a data-link-type="dfn" href="#ruby-annotation-container-box" id="ref-for-ruby-annotation-container-box①⑧">ruby annotation container</a>,
	the remaining <span id="ref-for-ruby-base-box②④">ruby bases</span> are paired with anonymous empty annotations
	inserted at the end of the <span id="ref-for-ruby-annotation-container-box①⑨">ruby annotation container</span>.
	If there are not enough <span id="ref-for-ruby-base-box②⑤">ruby bases</span>,
	any remaining <span id="ref-for-ruby-annotation-box②⑧">ruby annotations</span> pair with empty, anonymous bases
	inserted at the end of the <a data-link-type="dfn" href="#ruby-base-container-box" id="ref-for-ruby-base-container-box②⓪">ruby base container</a>.</p>
   <p>If an implementation supports ruby markup with explicit spanning
	(e.g. XHTML Complex Ruby Annotations),
	it must adjust the <a data-link-type="dfn" href="#pairing" id="ref-for-pairing④">pairing</a> rules to pair <a data-link-type="dfn" href="#spanning-annotation" id="ref-for-spanning-annotation">spanning annotations</a> to their bases appropriately.</p>
   <p><a data-link-type="dfn" href="#intra-level-white-space" id="ref-for-intra-level-white-space①">Intra-level white space</a> does not participate in standard annotation <a data-link-type="dfn" href="#pairing" id="ref-for-pairing⑤">pairing</a>.
	However, if the immediately-adjacent <a data-link-type="dfn" href="#ruby-base-box" id="ref-for-ruby-base-box②⑥">ruby bases</a> or <a data-link-type="dfn" href="#ruby-annotation-box" id="ref-for-ruby-annotation-box②⑨">ruby annotations</a> are paired</p>
   <ul>
    <li> with two <a data-link-type="dfn" href="#ruby-base-box" id="ref-for-ruby-base-box②⑦">ruby bases</a> or <a data-link-type="dfn" href="#ruby-annotation-box" id="ref-for-ruby-annotation-box③⓪">annotations</a> that surround corresponding <a data-link-type="dfn" href="#intra-level-white-space" id="ref-for-intra-level-white-space②">intra-level white space</a> in another level,
			then the so-corresponding <span id="ref-for-intra-level-white-space③">intra-level white space</span> boxes are also paired. 
    <li> with a single spanning <a data-link-type="dfn" href="#ruby-annotation-box" id="ref-for-ruby-annotation-box③①">ruby annotation</a>,
			then the <a data-link-type="dfn" href="#intra-level-white-space" id="ref-for-intra-level-white-space④">intra-level white space</a> is also paired to that <span id="ref-for-ruby-annotation-box③②">ruby annotation</span> 
    <li> with two <a data-link-type="dfn" href="#ruby-base-box" id="ref-for-ruby-base-box②⑧">ruby bases</a> or <a data-link-type="dfn" href="#ruby-annotation-box" id="ref-for-ruby-annotation-box③③">annotations</a> with no intervening <a data-link-type="dfn" href="#intra-level-white-space" id="ref-for-intra-level-white-space⑤">intra-level white space</a>,
			then the <span id="ref-for-intra-level-white-space⑥">intra-level white space</span> box pairs with
			an anonymous empty <span id="ref-for-intra-level-white-space⑦">intra-level white space</span> box assumed to exist between them. 
   </ul>
   <div class="example" id="example-e7c0375d">
    <a class="self-link" href="#example-e7c0375d"></a> The following diagram shows the pairing of
		regular <a data-link-type="dfn" href="#ruby-base-box" id="ref-for-ruby-base-box②⑨">base</a> and <a data-link-type="dfn" href="#ruby-annotation-box" id="ref-for-ruby-annotation-box③④">annotation</a> boxes
		as well as the pairing of <a data-link-type="dfn" href="#intra-ruby-white-space" id="ref-for-intra-ruby-white-space④">intra-ruby white space</a> (represented as <samp>ws</samp>): 
<pre class="highlight"><span class="column">|</span><span class="annot">[</span>  s p a n n i n g   a n n o t a t i o n <span class="annot">]</span><span class="column">|</span>
<span class="column">|</span><span class="annot">[</span> a1 <span class="annot">]</span><span class="column">|</span><span class="annot">[</span>ws<span class="annot">]</span><span class="column">|</span><span class="annot">[</span> a2 <span class="annot">]</span><span class="column">|</span><span class="annot">[</span>  <span class="annot">]</span><span class="column">|</span><span class="annot">[</span> a3 <span class="annot">]</span><span class="column">|</span><span class="annot">[</span>ws<span class="annot">]</span><span class="column">|</span><span class="annot">[</span> a4 <span class="annot">]</span><span class="column">|</span>
<span class="column">|</span><span class="base">[</span> b1 <span class="base">]</span><span class="column">|</span><span class="base">[</span>ws<span class="base">]</span><span class="column">|</span><span class="base">[</span> b2 <span class="base">]</span><span class="column">|</span><span class="base">[</span>ws<span class="base">]</span><span class="column">|</span><span class="base">[</span> b3 <span class="base">]</span><span class="column">|</span><span class="base">[</span>  <span class="base">]</span><span class="column">|</span><span class="base">[</span> b4 <span class="base">]</span><span class="column">|</span>
</pre>
    <p>Blue brackets (<samp class="base">[ ]</samp>) represent <a data-link-type="dfn" href="#ruby-base-box" id="ref-for-ruby-base-box③⓪">base boxes</a>,
		red brackets (<samp class="annot">[ ]</samp>) represent <a data-link-type="dfn" href="#ruby-annotation-box" id="ref-for-ruby-annotation-box③⑤">annotation boxes</a>,
		gray bars (<samp class="column">|</samp>) represent the limits of <a data-link-type="dfn" href="#ruby-columns" id="ref-for-ruby-columns①">ruby columns</a>, <samp class="ws">[ws]</samp> represents <a data-link-type="dfn" href="#intra-ruby-white-space" id="ref-for-intra-ruby-white-space⑤">intra-ruby white space</a>,
		and <samp>[]</samp> represents an empty anonymous base or annotation
		automatcally generated to pair with <span id="ref-for-intra-ruby-white-space⑥">intra-ruby white space</span> in another level. <a data-link-type="dfn" href="#ruby-container" id="ref-for-ruby-container②①">Ruby containers</a>, <a data-link-type="dfn" href="#ruby-base-container-box" id="ref-for-ruby-base-container-box②①">base containers</a>, and <a data-link-type="dfn" href="#ruby-annotation-container-box" id="ref-for-ruby-annotation-container-box②⓪">annotation containers</a> are omitted.</p>
   </div>
   <h3 class="heading settled" data-level="2.4" id="hiding"><span class="secno">2.4. </span><span class="content"> Hiding Annotations: <a class="css" data-link-type="propdesc" href="https://drafts.csswg.org/css-display-4/#propdef-visibility" id="ref-for-propdef-visibility">visibility: collapse</a> and auto-hidden ruby</span><span id="autohide"></span><a class="self-link" href="#hiding"></a></h3>
   <p>A <a data-link-type="dfn" href="#ruby-annotation-box" id="ref-for-ruby-annotation-box③⑥">ruby annotation</a> whose <a class="property css" data-link-type="property" href="https://drafts.csswg.org/css-display-4/#propdef-visibility" id="ref-for-propdef-visibility①">visibility</a> is <a class="css" data-link-type="maybe" href="https://drafts.csswg.org/css-display-4/#valdef-visibility-collapse" id="ref-for-valdef-visibility-collapse">collapse</a> is a <dfn class="dfn-paneled" data-dfn-type="dfn" data-local-lt="hidden" data-lt="hidden annotation | hidden ruby annotation | hide" data-noexport id="hidden-annotation">hidden annotation</dfn>.
	Additionally,
	if a <span id="ref-for-ruby-annotation-box③⑦">ruby annotation</span> has the exact same text content as its base,
	it is automatically <a data-link-type="dfn" href="#hidden-annotation" id="ref-for-hidden-annotation">hidden</a> (<dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="auto-hidden | auto-hide" data-noexport id="auto-hidden">auto-hidden</dfn>)
	by the UA.</p>
   <p><a data-link-type="dfn" href="#hidden-annotation" id="ref-for-hidden-annotation①">Hiding</a> a <a data-link-type="dfn" href="#ruby-annotation-box" id="ref-for-ruby-annotation-box③⑧">ruby annotation</a> does not affect annotation <a data-link-type="dfn" href="#pairing" id="ref-for-pairing⑥">pairing</a>.
	However the <span id="ref-for-hidden-annotation②">hidden annotation</span> is not visible,
	and it has no impact on layout
	other than to separate adjacent sequences of <span id="ref-for-ruby-annotation-box③⑨">ruby annotation boxes</span> within its level,
	as if they belonged to separate segments
	and the <span id="ref-for-hidden-annotation③">hidden annotation</span>’s base were not a <a data-link-type="dfn" href="#ruby-base-box" id="ref-for-ruby-base-box③①">ruby base</a> but an intervening inline.</p>
   <div class="example" id="example-ed46b94b">
    <a class="self-link" href="#example-ed46b94b"></a> Auto-hiding allows correct inlined display of annotations
		for Japanese words that are a mix of kanji and hiragana.
		For example, the word <span lang="ja">振り仮名</span> should be inlined as 
    <p class="figure">振り仮名(ふりがな) </p>
    <p>and therefore marked up as</p>
<pre class="highlight"><c- p>&lt;</c-><c- f>ruby</c-><c- p>></c->
  <c- p>&lt;</c-><c- f>rb</c-><c- p>></c->振<c- p>&lt;/</c-><c- f>rb</c-><c- p>>&lt;</c-><c- f>rb</c-><c- p>></c->り<c- p>&lt;/</c-><c- f>rb</c-><c- p>>&lt;</c-><c- f>rb</c-><c- p>></c->仮<c- p>&lt;/</c-><c- f>rb</c-><c- p>>&lt;</c-><c- f>rb</c-><c- p>></c->名<c- p>&lt;/</c-><c- f>rb</c-><c- p>></c->
  <c- p>&lt;</c-><c- f>rp</c-><c- p>></c->(<c- p>&lt;/</c-><c- f>rp</c-><c- p>>&lt;</c-><c- f>rt</c-><c- p>></c->ふ<c- p>&lt;/</c-><c- f>rt</c-><c- p>>&lt;</c-><c- f>rt</c-><c- p>></c->り<c- p>&lt;/</c-><c- f>rt</c-><c- p>>&lt;</c-><c- f>rt</c-><c- p>></c->が<c- p>&lt;/</c-><c- f>rt</c-><c- p>>&lt;</c-><c- f>rt</c-><c- p>></c->な<c- p>&lt;/</c-><c- f>rt</c-><c- p>>&lt;</c-><c- f>rp</c-><c- p>></c->)<c- p>&lt;/</c-><c- f>rp</c-><c- p>></c->
<c- p>&lt;/</c-><c- f>ruby</c-><c- p>></c-></pre>
    <p>However, when displayed as ruby, the “り” should be hidden</p>
    <div class="figure">
      <img alt="Hiragana annotations for 振り仮名 appear, each pronunciation above its kanji base character." src="images/furigana-separate.png"> 
     <p class="caption">Hiragana ruby for 振り仮名. Notice there is no hiragana annotation above り,  since it is already in hiragana. </p>
    </div>
   </div>
   <div class="example" id="example-b948f9b9">
    <a class="self-link" href="#example-b948f9b9"></a> The Japanese word in this example is composed of three kanji characters,
		one of which is taught in first grade,
		while the other two are more advanced.
		(Characters colored to show base-pair correspondances.) 
<pre class="highlight"><c- p>&lt;</c-><c- f>ruby</c-><c- p>>&lt;</c-><c- f>rb</c-><c- p>></c->昆<c- p>&lt;</c-><c- f>rb</c-><c- p>></c->虫<c- p>&lt;</c-><c- f>rb</c-><c- p>></c->記<c- p>&lt;</c-><c- f>rt</c-><c- p>></c->こん<c- p>&lt;</c-><c- f>rt</c-> <c- e>class</c-><c- o>=</c-><c- s>easy</c-><c- p>></c->ちゅう<c- p>&lt;</c-><c- f>rt</c-><c- p>></c->き<c- p>&lt;/</c-><c- f>ruby</c-><c- p>></c->
</pre>
    <figure>
      <img alt="昆虫記, with phonetic annotations on all three characters.
			     Because the middle annotation is wider than its base,
			     space has been introduced around the base character
			     to prevent its annotation from colliding with the adjacent annotations." src="images/ruby-pairing-full.png" width="122"> 
     <figcaption>Fully annotated three-character word</figcaption>
    </figure>
    <p>Although some readers might need pronunciation guidance
		on all three characters,
		for other audiences it is more appropriate
		to hide the annotation on the easier character.
		Applying <a class="css" data-link-type="propdesc" href="https://drafts.csswg.org/css-display-4/#propdef-visibility" id="ref-for-propdef-visibility②">visibility: collapse</a> enables this hiding:</p>
    <figure>
      <img alt="昆虫記, with phonetic annotations centered over
			          the first and last characters." src="images/ruby-pairing-collapse.png" width="105"> 
     <figcaption>Middle annotation as <a class="css" data-link-type="propdesc" href="https://drafts.csswg.org/css-display-4/#propdef-visibility" id="ref-for-propdef-visibility③">visibility: collapse</a></figcaption>
    </figure>
    <p>The <a data-link-type="dfn" href="#hidden-annotation" id="ref-for-hidden-annotation④">hiding</a> behavior of <a class="css" data-link-type="propdesc" href="https://drafts.csswg.org/css-display-4/#propdef-visibility" id="ref-for-propdef-visibility④">visibility: collapse</a> differs from <span class="css" id="ref-for-propdef-visibility⑤">visibility: hidden</span>—​which makes the annotation invisible,
		but does not remove its impact on layout:</p>
    <figure>
      <img alt="昆虫記, with phonetic annotations on the first and last characters.
			     Over the second one, even though no annotation is showing,
			     space is reserved as if to hold it,
			     which pushes the base characters apart." src="images/ruby-pairing-invisible.png" width="122"> 
     <figcaption>Middle annotation as <a class="css" data-link-type="propdesc" href="https://drafts.csswg.org/css-display-4/#propdef-visibility" id="ref-for-propdef-visibility⑥">visibility: hidden</a></figcaption>
    </figure>
    <p>It also differs from <a class="css" data-link-type="propdesc" href="https://drafts.csswg.org/css-display-4/#propdef-display" id="ref-for-propdef-display①③">display: none</a> because <a class="css" data-link-type="propdesc" href="https://drafts.csswg.org/css-display-4/#propdef-visibility" id="ref-for-propdef-visibility⑦">visibility: collapse</a> preserves pairing relationships,
		whereas <span class="css" id="ref-for-propdef-display①④">display: none</span> removes the box from the tree entirely,
		disturbing the pairing of any annotations after it:</p>
    <figure>
      <img alt="昆虫記, with mispaired phonetic annotations:
			     the annotation for the second character having been removed,
			     the annotation for the third character is displayed over the second one." src="images/ruby-pairing-discard.png" width="107"> 
     <figcaption>Middle annotation as <a class="css" data-link-type="propdesc" href="https://drafts.csswg.org/css-display-4/#propdef-display" id="ref-for-propdef-display①⑤">display: none</a></figcaption>
    </figure>
   </div>
   <p>When the <a data-link-type="dfn" href="https://drafts.csswg.org/css-cascade-5/#computed-value" id="ref-for-computed-value">computed value</a> of <a class="property css" data-link-type="property" href="#propdef-ruby-merge" id="ref-for-propdef-ruby-merge">ruby-merge</a> on the <a data-link-type="dfn" href="#ruby-annotation-container-box" id="ref-for-ruby-annotation-container-box②①">annotation container</a> is <a class="css" data-link-type="maybe" href="#valdef-ruby-merge-merge" id="ref-for-valdef-ruby-merge-merge">merge</a>, <a data-link-type="dfn" href="#hidden-annotation" id="ref-for-hidden-annotation⑤">hiding</a> is disabled.
	When that value is <a class="css" data-link-type="maybe" href="#valdef-ruby-merge-auto" id="ref-for-valdef-ruby-merge-auto">auto</a>,
	the user agent may decide whether to disable <span id="ref-for-hidden-annotation⑥">hiding</span> of its annotations,
	but it is recommended to enable <span id="ref-for-hidden-annotation⑦">hiding</span> if the user agent’s layout algorithm
	produces the results similar to <a class="css" data-link-type="maybe" href="#valdef-ruby-merge-separate" id="ref-for-valdef-ruby-merge-separate">separate</a>.</p>
   <p>The content comparison for <a data-link-type="dfn" href="#auto-hidden" id="ref-for-auto-hidden">auto-hiding</a> takes place prior to white space collapsing (<a class="property css" data-link-type="property" href="https://drafts.csswg.org/css-text-4/#propdef-white-space" id="ref-for-propdef-white-space①">white-space</a>) and text transformation (<a class="property css" data-link-type="property" href="https://drafts.csswg.org/css-text-4/#propdef-text-transform" id="ref-for-propdef-text-transform">text-transform</a>)
	and ignores elements (considers only the <code>textContent</code> of the boxes).</p>
   <p class="note" role="note"><span class="marker">Note:</span> Future levels of CSS Ruby may add controls for <a data-link-type="dfn" href="#auto-hidden" id="ref-for-auto-hidden①">auto-hiding</a>,
	but in this level it is always forced.</p>
   <h3 class="heading settled" data-level="2.5" id="white-space"><span class="secno">2.5. </span><span class="content"> White Space Collapsing</span><a class="self-link" href="#white-space"></a></h3>
   <p>As discussed in <a href="#box-fixup">§ 2.2 Anonymous Ruby Box Generation</a>,
	white space within a ruby structure is <a href="#anon-gen-discard-space">discarded</a>:</p>
   <ul>
    <li>at the beginning and end of a <a data-link-type="dfn" href="#ruby-container" id="ref-for-ruby-container②②">ruby container</a>, <a data-link-type="dfn" href="#ruby-annotation-container-box" id="ref-for-ruby-annotation-container-box②②">annotation container</a>, or <a data-link-type="dfn" href="#ruby-base-container-box" id="ref-for-ruby-base-container-box②②">base container</a>, 
    <li>between a <a data-link-type="dfn" href="#ruby-base-container-box" id="ref-for-ruby-base-container-box②③">base container</a> and its following <a data-link-type="dfn" href="#ruby-annotation-container-box" id="ref-for-ruby-annotation-container-box②③">annotation container</a>, 
    <li>between <a data-link-type="dfn" href="#ruby-annotation-container-box" id="ref-for-ruby-annotation-container-box②④">annotation containers</a>. 
   </ul>
   <div class="example" id="example-6fc7b45d">
    <a class="self-link" href="#example-6fc7b45d"></a> For example, the following markup will display without any spaces: 
<pre class="highlight"><c- p>&lt;</c-><c- f>ruby</c-><c- p>></c->
  <c- p>&lt;</c-><c- f>rb</c-><c- p>></c->東<c- p>&lt;/</c-><c- f>rb</c-><c- p>>&lt;</c-><c- f>rb</c-><c- p>></c->京<c- p>&lt;/</c-><c- f>rb</c-><c- p>></c->
  <c- p>&lt;</c-><c- f>rt</c-><c- p>></c->とう<c- p>&lt;/</c-><c- f>rt</c-><c- p>>&lt;</c-><c- f>rt</c-><c- p>></c->きょう<c- p>&lt;/</c-><c- f>rt</c-><c- p>></c->
  <c- p>&lt;</c-><c- f>rtc</c-><c- p>>&lt;</c-><c- f>rt</c-><c- p>></c->Tō<c- p>&lt;/</c-><c- f>rt</c-><c- p>>&lt;</c-><c- f>rt</c-><c- p>></c->kyō<c- p>&lt;/</c-><c- f>rt</c-><c- p>>&lt;/</c-><c- f>rtc</c-><c- p>></c->
<c- p>&lt;/</c-><c- f>ruby</c-><c- p>></c-></pre>
   </div>
   <p>Between <a data-link-type="dfn" href="#ruby-segments" id="ref-for-ruby-segments①⓪">ruby segments</a>, between <a data-link-type="dfn" href="#ruby-base-box" id="ref-for-ruby-base-box③②">ruby bases</a>, and between <a data-link-type="dfn" href="#ruby-annotation-box" id="ref-for-ruby-annotation-box④⓪">ruby annotations</a>, however,
	white space is not discarded,
	and is maintained for rendering
	as <a data-link-type="dfn" href="#inter-base-white-space" id="ref-for-inter-base-white-space②">inter-base</a>, <a data-link-type="dfn" href="#inter-annotation-white-space" id="ref-for-inter-annotation-white-space②">inter-annotation</a>,
	or <a data-link-type="dfn" href="#inter-segment-white-space" id="ref-for-inter-segment-white-space③">inter-segment white space</a>.
	(See <a href="#anon-gen-interpret-space">Interpret intra-level white space</a>, above.)</p>
   <div class="example" id="example-7bca862a">
    <a class="self-link" href="#example-7bca862a"></a> The rules preserving white space allow ruby to be used with space-separated scripts such as Latin.
		For example, 
<pre class="highlight"><c- p>&lt;</c-><c- f>ruby</c-><c- p>></c->
  <c- p>&lt;</c-><c- f>rb</c-><c- p>></c->W<c- p>&lt;/</c-><c- f>rb</c-><c- p>>&lt;</c-><c- f>rb</c-><c- p>></c->W<c- p>&lt;/</c-><c- f>rb</c-><c- p>>&lt;</c-><c- f>rb</c-><c- p>></c->W<c- p>&lt;/</c-><c- f>rb</c-><c- p>></c->
  <c- p>&lt;</c-><c- f>rt</c-><c- p>></c->World<c- p>&lt;/</c-><c- f>rt</c-><c- p>></c-> <c- p>&lt;</c-><c- f>rt</c-><c- p>></c->Wide<c- p>&lt;/</c-><c- f>rt</c-><c- p>></c-> <c- p>&lt;</c-><c- f>rt</c-><c- p>></c->Web<c- p>&lt;/</c-><c- f>rt</c-><c- p>></c->
<c- p>&lt;/</c-><c- f>ruby</c-><c- p>></c-></pre>
    <p>They also ensure that annotated white space is preserved. For example,</p>
<pre class="highlight"><c- p>&lt;</c-><c- f>ruby</c-><c- p>></c->
  <c- p>&lt;</c-><c- f>rb</c-><c- p>></c->Aerith<c- p>&lt;/</c-><c- f>rb</c-><c- p>>&lt;</c-><c- f>rb</c-><c- p>></c-> <c- p>&lt;/</c-><c- f>rb</c-><c- p>>&lt;</c-><c- f>rb</c-><c- p>></c->Gainsborough<c- p>&lt;/</c-><c- f>rb</c-><c- p>></c->
  <c- p>&lt;</c-><c- f>rt</c-><c- p>></c->エアリス<c- p>&lt;/</c-><c- f>rt</c-><c- p>>&lt;</c-><c- f>rt</c-><c- p>></c->・<c- p>&lt;/</c-><c- f>rt</c-><c- p>>&lt;</c-><c- f>rt</c-><c- p>></c->ゲインズブール<c- p>&lt;/</c-><c- f>rt</c-><c- p>></c->
<c- p>&lt;/</c-><c- f>ruby</c-><c- p>></c-></pre>
   </div>
   <p>Where undiscarded white space is <a data-link-type="dfn" href="https://drafts.csswg.org/css-text-4/#collapsible-white-space" id="ref-for-collapsible-white-space">collapsible</a>,
	it will collapse across adjacent boxes in each line box
	following the standard <a href="https://www.w3.org/TR/css3-text/#white-space-rules">white space processing rules</a> <a data-link-type="biblio" href="#biblio-css-text-3" title="CSS Text Module Level 3">[CSS-TEXT-3]</a>.
	Annotations in separate <a data-link-type="dfn" href="#ruby-segments" id="ref-for-ruby-segments①①">ruby segments</a> or separated by <a data-link-type="dfn" href="#hidden-annotation" id="ref-for-hidden-annotation⑧">hidden annotations</a> are not considered adjacent;
	however all base-level content
	(including <a data-link-type="dfn" href="#ruby-position-inter-character-annotation" id="ref-for-ruby-position-inter-character-annotation">inter-character annotations</a>,
	which are treated as <a data-link-type="dfn" href="https://drafts.csswg.org/css-display-4/#atomic-inline" id="ref-for-atomic-inline">atomic inlines</a>)
	is.
	For <span id="ref-for-collapsible-white-space①">collapsible white space</span> between <span id="ref-for-ruby-segments①②">ruby segments</span> (<a data-link-type="dfn" href="#inter-segment-white-space" id="ref-for-inter-segment-white-space④">inter-segment white space</a>),
	the contextual text for determining <a href="https://drafts.csswg.org/css-text-3/#line-break-transform">segment break transformations</a> is thus given by the <a data-link-type="dfn" href="#ruby-base-box" id="ref-for-ruby-base-box③③">ruby bases</a> on either side,
	not necessarily the text on either side of the white space in source document order
	(which could include <a data-link-type="dfn" href="#interlinear-annotations" id="ref-for-interlinear-annotations①">interlinear annotations</a>).</p>
   <div class="note" role="note">
     Note: The white space processing rules
		cause a white space sequence containing a <a data-link-type="dfn" href="https://drafts.csswg.org/css-text-4/#segment-break" id="ref-for-segment-break">segment break</a> (such as a line feed)
		to <a href="https://www.w3.org/TR/css3-text/#line-break-transform">collapse to nothing</a> between Han and Kana characters.
		This means that Chinese and Japanese ruby can safely use white space for indentation of ruby markup.
		For example, the following markup will display without any spaces: 
<pre class="highlight"><c- p>&lt;</c-><c- f>ruby</c-><c- p>></c->
  屋<c- p>&lt;</c-><c- f>rt</c-><c- p>></c->おく<c- p>&lt;/</c-><c- f>rt</c-><c- p>></c->内<c- p>&lt;</c-><c- f>rt</c-><c- p>></c->ない<c- p>&lt;/</c-><c- f>rt</c-><c- p>></c->
  禁<c- p>&lt;</c-><c- f>rt</c-><c- p>></c->きん<c- p>&lt;/</c-><c- f>rt</c-><c- p>></c->煙<c- p>&lt;</c-><c- f>rt</c-><c- p>></c->えん<c- p>&lt;/</c-><c- f>rt</c-><c- p>></c->
<c- p>&lt;/</c-><c- f>ruby</c-><c- p>></c-></pre>
    <p>However, white space that does not contain a <a data-link-type="dfn" href="https://drafts.csswg.org/css-text-4/#segment-break" id="ref-for-segment-break①">segment break</a> does not collapse completely away,
		so this markup will display with a space between the first and second ruby pairs:</p>
<pre class="highlight"><c- p>&lt;</c-><c- f>ruby</c-><c- p>></c->
  屋<c- p>&lt;</c-><c- f>rt</c-><c- p>></c->おく<c- p>&lt;/</c-><c- f>rt</c-><c- p>></c->  内<c- p>&lt;</c-><c- f>rt</c-><c- p>></c->ない<c- p>&lt;/</c-><c- f>rt</c-><c- p>></c->
  禁<c- p>&lt;</c-><c- f>rt</c-><c- p>></c->きん<c- p>&lt;/</c-><c- f>rt</c-><c- p>></c->  煙<c- p>&lt;</c-><c- f>rt</c-><c- p>></c->えん<c- p>&lt;/</c-><c- f>rt</c-><c- p>></c->
<c- p>&lt;/</c-><c- f>ruby</c-><c- p>></c-></pre>
   </div>
   <h2 class="heading settled" data-level="3" id="ruby-layout"><span class="secno">3. </span><span class="content"> Ruby Layout</span><a class="self-link" href="#ruby-layout"></a></h2>
   <p>When a ruby structure is laid out,
	its <a data-link-type="dfn" href="#base-level" id="ref-for-base-level①">base level</a> is initially laid out on the line
	exactly as if its <a data-link-type="dfn" href="#ruby-base-box" id="ref-for-ruby-base-box③④">ruby bases</a> were a regular sequence of <a data-link-type="dfn" href="https://drafts.csswg.org/css-display-4/#inline-box" id="ref-for-inline-box④">inline boxes</a> and the <a data-link-type="dfn" href="#ruby-container" id="ref-for-ruby-container②③">ruby container</a> a regular <span id="ref-for-inline-box⑤">inline box</span> wrapped around it.</p>
   <p>If a <a data-link-type="dfn" href="#ruby-container" id="ref-for-ruby-container②④">ruby container</a> has any <a data-link-type="dfn" href="#ruby-position-inter-character-annotation" id="ref-for-ruby-position-inter-character-annotation①">inter-character annotations</a>,
	they are laid out into the <a data-link-type="dfn" href="#base-level" id="ref-for-base-level②">base level</a> as detailed in <a href="#inter-character-layout">§ 3.2 Inter-character Ruby Layout</a>.
	Subsequently,
	the <a data-link-type="dfn" href="#ruby-base-container-box" id="ref-for-ruby-base-container-box②④">base container</a> is sized and <a data-link-type="dfn" href="#interlinear-annotations" id="ref-for-interlinear-annotations②">interlinear annotations</a> are laid out
	as detailed in <a href="#interlinear-layout">§ 3.1 Interlinear Ruby Layout</a>.</p>
   <p>As in other CSS layout models,
	relative positioning, transforms, and other graphical effects
	apply after this layout of the boxes.</p>
   <h3 class="heading settled" data-level="3.1" id="interlinear-layout"><span class="secno">3.1. </span><span class="content"> Interlinear Ruby Layout</span><a class="self-link" href="#interlinear-layout"></a></h3>
   <p><a data-link-type="dfn" href="#interlinear-annotations" id="ref-for-interlinear-annotations③">Interlinear</a> <a data-link-type="dfn" href="#ruby-annotation-box" id="ref-for-ruby-annotation-box④①">ruby annotations</a> within a level
	are initially laid out as if they were <a data-link-type="dfn" href="https://drafts.csswg.org/css-display-4/#inline-box" id="ref-for-inline-box⑥">inline boxes</a> participating in the same <a data-link-type="dfn" href="https://drafts.csswg.org/css-display-4/#inline-formatting-context" id="ref-for-inline-formatting-context⑤">inline formatting context</a>,
	effectively establishing a <a data-link-type="dfn" href="https://drafts.csswg.org/css-inline-3/#line-box" id="ref-for-line-box">line box</a> for that <a data-link-type="dfn" href="#annotation-level" id="ref-for-annotation-level④">level</a> of annotation in the <a data-link-type="dfn" href="#ruby-container" id="ref-for-ruby-container②⑤">ruby container</a>. <span id="ref-for-ruby-annotation-box④②">Annotations</span> and <a data-link-type="dfn" href="#ruby-base-box" id="ref-for-ruby-base-box③⑤">bases</a> are aligned to each other
	by adjusting their spacing as described below.</p>
   <h4 class="heading settled" data-level="3.1.1" id="interlinear-inline"><span class="secno">3.1.1. </span><span class="content"> Inline-axis Interlinear Layout</span><a class="self-link" href="#interlinear-inline"></a></h4>
   <p>In the inline axis, <a data-link-type="dfn" href="#interlinear-annotations" id="ref-for-interlinear-annotations④">interlinear</a> <a data-link-type="dfn" href="#ruby-annotation-box" id="ref-for-ruby-annotation-box④③">ruby annotations</a> are aligned
	with respect to their <a data-link-type="dfn" href="#ruby-base-box" id="ref-for-ruby-base-box③⑥">ruby base boxes</a> in accordance with their <a data-link-type="dfn" href="#ruby-annotation-container-box" id="ref-for-ruby-annotation-container-box②⑤">annotation container</a>’s <a class="property css" data-link-type="property" href="#propdef-ruby-merge" id="ref-for-propdef-ruby-merge①">ruby-merge</a> value.</p>
   <p>When <a class="property css" data-link-type="property" href="#propdef-ruby-merge" id="ref-for-propdef-ruby-merge②">ruby-merge</a> is <a class="css" data-link-type="maybe" href="#valdef-ruby-merge-separate" id="ref-for-valdef-ruby-merge-separate①">separate</a>,
	each <a data-link-type="dfn" href="#ruby-columns" id="ref-for-ruby-columns②">ruby column</a> is sized
	to the widest content (<a data-link-type="dfn" href="#ruby-base-box" id="ref-for-ruby-base-box③⑦">ruby base</a> or <a data-link-type="dfn" href="#ruby-annotation-box" id="ref-for-ruby-annotation-box④④">ruby annotation</a>) in that <span id="ref-for-ruby-columns③">column</span>.
	In the case of <a data-link-type="dfn" href="#spanning-annotation" id="ref-for-spanning-annotation①">spanning annotations</a> (whether actually spanning or pretending to span per <span class="css" id="ref-for-propdef-ruby-merge③">ruby-merge: merge</span>),
	if the content of a <span id="ref-for-spanning-annotation②">spanning annotation</span> would be wider
	than the <span id="ref-for-ruby-columns④">columns</span> that it spans,
	then the difference is distributed equally among the spanned <span id="ref-for-ruby-columns⑤">columns</span>.
	If a <a data-link-type="dfn" href="#ruby-segments" id="ref-for-ruby-segments①③">ruby segment</a> contains multiple <span id="ref-for-spanning-annotation③">spanning annotations</span>,
	this distribution of additional space
	is performed starting with the <span id="ref-for-spanning-annotation④">spanning annotations</span> that span the least number of bases,
	and then in increasing number of bases spanned.
	Each <span id="ref-for-ruby-base-box③⑧">ruby base</span> and <span id="ref-for-ruby-annotation-box④⑤">ruby annotation</span> is then sized to exactly span its column(s).</p>
   <p class="note" role="note"><span class="marker">Note:</span> If there are multiple annotations spanning the same number of bases
	that overlap but do not coincide,
	the distribution of space is undefined.
	Note this is not possible with HTML markup,
	but can happen in markup languages with explicit spanning such as in <a data-link-type="biblio" href="#biblio-ruby" title="Ruby Annotation">[RUBY]</a>.</p>
   <p>If any <a data-link-type="dfn" href="#ruby-annotation-box" id="ref-for-ruby-annotation-box④⑥">ruby annotation</a> in an <a data-link-type="dfn" href="#ruby-annotation-container-box" id="ref-for-ruby-annotation-container-box②⑥">annotation container</a> with <a class="css" data-link-type="propdesc" href="#propdef-ruby-merge" id="ref-for-propdef-ruby-merge④">ruby-merge: auto</a> is wider than its <a data-link-type="dfn" href="#ruby-base-box" id="ref-for-ruby-base-box③⑨">base</a>,
	then <span id="ref-for-ruby-annotation-box④⑦">ruby annotations</span> in that <span id="ref-for-ruby-annotation-container-box②⑦">annotation container</span> may extend outside of their <a data-link-type="dfn" href="#ruby-columns" id="ref-for-ruby-columns⑥">column</a>(s).
	When they do, their influence on
	the measure of the <span id="ref-for-ruby-columns⑦">columns</span> they intersect
	is up to the user agent,
	provided that the <a data-link-type="dfn" href="#ruby-segments" id="ref-for-ruby-segments①④">ruby segment</a> is made wide enough to fit all its content.</p>
   <p><a data-link-type="dfn" href="#ruby-position-inter-character-annotation" id="ref-for-ruby-position-inter-character-annotation②">Inter-character</a> annotations are interleaved between columns:
	they factor into measurement of annotations that span both adjacent columns,
	but are not included in either column
	and are never affected by the sizing or positioning
	of <a data-link-type="dfn" href="#interlinear-annotations" id="ref-for-interlinear-annotations⑤">interlinear annotations</a>.</p>
   <p>Within each <a data-link-type="dfn" href="#ruby-base-box" id="ref-for-ruby-base-box④⓪">base</a> and <a data-link-type="dfn" href="#ruby-annotation-box" id="ref-for-ruby-annotation-box④⑧">annotation</a> box,
	how the extra space is distributed
	when its content is narrower than the measure of the box
	is specified by its <a class="property css" data-link-type="property" href="#propdef-ruby-align" id="ref-for-propdef-ruby-align">ruby-align</a> property.</p>
   <div class="example" id="example-476e6a05">
    <a class="self-link" href="#example-476e6a05"></a> The following diagrams illustrate these rules,
		covering typical situations
		as well as a few more complex ones.
		In each case, <a data-link-type="dfn" href="#ruby-base-box" id="ref-for-ruby-base-box④①">base boxes</a> and <a data-link-type="dfn" href="#ruby-annotation-box" id="ref-for-ruby-annotation-box④⑨">annotation boxes</a> are assumed to have <a class="css" data-link-type="propdesc" href="#propdef-ruby-align" id="ref-for-propdef-ruby-align①">ruby-align: center</a>,
		while <a data-link-type="dfn" href="#ruby-annotation-container-box" id="ref-for-ruby-annotation-container-box②⑧">annotation containers</a> are assumed to have <span class="css" id="ref-for-propdef-ruby-align②">ruby-align: space-between</span>. 
    <p>Blue brackets (<samp class="base">[ ]</samp>) represent <a data-link-type="dfn" href="#ruby-base-box" id="ref-for-ruby-base-box④②">base boxes</a>,
		red brackets (<samp class="annot">[ ]</samp>) represent <a data-link-type="dfn" href="#ruby-annotation-box" id="ref-for-ruby-annotation-box⑤⓪">annotation boxes</a>,
		and gray bars (<samp class="column">|</samp>) represent the limits of <a data-link-type="dfn" href="#ruby-columns" id="ref-for-ruby-columns⑧">ruby columns</a>. <a data-link-type="dfn" href="#ruby-container" id="ref-for-ruby-container②⑥">Ruby containers</a>, <a data-link-type="dfn" href="#ruby-base-container-box" id="ref-for-ruby-base-container-box②⑤">base containers</a>, and <a data-link-type="dfn" href="#ruby-annotation-container-box" id="ref-for-ruby-annotation-container-box②⑨">annotation containers</a> are omitted.</p>
    <dl>
     <dt id="ex-separate"><a class="self-link" href="#ex-separate"></a>Separate / non-spanning: 
     <dd>
<pre class="highlight"><span class="column">|</span><span class="annot">[</span>  a1  <span class="annot">]</span><span class="column">|</span><span class="annot">[</span>  a2  <span class="annot">]</span><span class="column">|</span><span class="annot">[</span>annotation-3<span class="annot">]</span><span class="column">|</span>
<span class="column">|</span><span class="base">[</span>base 1<span class="base">]</span><span class="column">|</span><span class="base">[</span>base 2<span class="base">]</span><span class="column">|</span><span class="base">[</span>   base 3   <span class="base">]</span><span class="column">|</span>
</pre>
      <p>Boxes within each <a data-link-type="dfn" href="#ruby-columns" id="ref-for-ruby-columns⑨">column</a> are sized to match the widest box of that <span id="ref-for-ruby-columns①⓪">column</span>.
				The value of <a class="property css" data-link-type="property" href="#propdef-ruby-align" id="ref-for-propdef-ruby-align③">ruby-align</a> on each <a data-link-type="dfn" href="#ruby-base-box" id="ref-for-ruby-base-box④③">base box</a> and <a data-link-type="dfn" href="#ruby-annotation-box" id="ref-for-ruby-annotation-box⑤①">annotation box</a> is used
				to distribute the extra space in each box.</p>
     <dt id="ex-short-span"><a class="self-link" href="#ex-short-span"></a>Spanning (short): 
     <dd>
<pre class="highlight"><span class="column">|</span><span class="annot">[</span>  a1  <span class="annot">]</span><span class="column">|</span><span class="annot">[</span>   short span  <span class="annot">]</span><span class="column">|</span>
<span class="column">|</span><span class="base">[</span>base 1<span class="base">]</span><span class="column">|</span><span class="base">[</span>base 2<span class="base">]</span><span class="column">|</span><span class="base">[</span>base 3<span class="base">]</span><span class="column">|</span>
</pre>
      <p>When a <a data-link-type="dfn" href="#spanning-annotation" id="ref-for-spanning-annotation⑤">spanning annotation</a> is shorter than the spanned <a data-link-type="dfn" href="#ruby-base-box" id="ref-for-ruby-base-box④④">bases</a>,
				there is no extra space to distribute to these <span id="ref-for-ruby-base-box④⑤">bases</span>.
				Extra space within the <span id="ref-for-spanning-annotation⑥">spanning annotation</span> is distributed according to <a class="property css" data-link-type="property" href="#propdef-ruby-align" id="ref-for-propdef-ruby-align④">ruby-align</a> on that <a data-link-type="dfn" href="#ruby-annotation-box" id="ref-for-ruby-annotation-box⑤②">annotation box</a>,
				as for non spanning ones.</p>
     <dt id="ex-long-span"><a class="self-link" href="#ex-long-span"></a>Spanning (long): 
     <dd>
<pre class="highlight"><span class="column">|</span><span class="annot">[</span>  a1  <span class="annot">]</span><span class="column">|</span><span class="annot">[</span>spanning annotation<span class="annot">]</span><span class="column">|</span>
<span class="column">|</span><span class="base">[</span>base 1<span class="base">]</span><span class="column">|</span><span class="base">[</span> base 2 <span class="base">]</span><span class="column">|</span><span class="base">[</span> base 3 <span class="base">]</span><span class="column">|</span>
</pre>
      <p>When the <a data-link-type="dfn" href="#spanning-annotation" id="ref-for-spanning-annotation⑦">spanning annotation</a> is longer than the spanned <a data-link-type="dfn" href="#ruby-base-box" id="ref-for-ruby-base-box④⑥">base boxes</a>,
				the extra space is distributed equally between them.</p>
     <dt id="ex-short-merge"><a class="self-link" href="#ex-short-merge"></a>Merged (short): 
     <dd>
<pre class="highlight"><span class="column">|</span><span class="annot">[</span>merged        annotation<span class="annot">]</span><span class="column">|</span>
<span class="column">|</span><span class="base">[</span>base 1<span class="base">]</span><span class="column">|</span><span class="base">[</span>base 2<span class="base">]</span><span class="column">|</span><span class="base">[</span>base 3<span class="base">]</span><span class="column">|</span>
</pre>
      <p>A <a data-link-type="dfn" href="#merged-annotation" id="ref-for-merged-annotation①">merged annotation</a> behaves similarly to a <a data-link-type="dfn" href="#span" id="ref-for-span②">spanning</a> one,
				except that distribution of any extra space in it
				is determined by the value of <a class="property css" data-link-type="property" href="#propdef-ruby-align" id="ref-for-propdef-ruby-align⑤">ruby-align</a> on the <a data-link-type="dfn" href="#ruby-annotation-container-box" id="ref-for-ruby-annotation-container-box③⓪">annotation container</a>,
				not on any of its <a data-link-type="dfn" href="#ruby-annotation-box" id="ref-for-ruby-annotation-box⑤③">annotation boxes</a>.</p>
     <dt id="ex-multi-level-span"><a class="self-link" href="#ex-multi-level-span"></a>Several levels, with spanning annotation: 
     <dd>
<pre class="highlight"><span class="column">|</span><span class="annot">[</span>   a1   <span class="annot">]</span><span class="column">|</span><span class="annot">[</span> annotation-2 <span class="annot">]</span><span class="column">|</span><span class="annot">[</span>   a3   <span class="annot">]</span><span class="column">|</span>
<span class="column">|</span><span class="annot">[</span>long annotation spanning all content<span class="annot">]</span><span class="column">|</span>
<span class="column">|</span><span class="base">[</span> base 1 <span class="base">]</span><span class="column">|</span><span class="base">[</span>    base 2    <span class="base">]</span><span class="column">|</span><span class="base">[</span> base 3 <span class="base">]</span><span class="column">|</span>
</pre>
<pre class="highlight"><span class="column">|</span><span class="annot">[</span>  xx  <span class="annot">]</span><span class="column">|</span><span class="annot">[</span>annotation spanning bases<span class="annot">]</span><span class="column">|</span>
<span class="column">|</span><span class="annot">[</span>  a1  <span class="annot">]</span><span class="column">|</span><span class="annot">[</span> annotation-2 <span class="annot">]</span><span class="column">|</span><span class="annot">[</span>   a3   <span class="annot">]</span><span class="column">|</span>
<span class="column">|</span><span class="base">[</span>base 1<span class="base">]</span><span class="column">|</span><span class="base">[</span>    base 2    <span class="base">]</span><span class="column">|</span><span class="base">[</span> base 3 <span class="base">]</span><span class="column">|</span>
</pre>
      <p>In these two examples with multiple <a data-link-type="dfn" href="#annotation-level" id="ref-for-annotation-level⑤">levels</a>,
				each <a data-link-type="dfn" href="#ruby-columns" id="ref-for-ruby-columns①①">column</a> is sized to its longest content,
				and <a data-link-type="dfn" href="#spanning-annotation" id="ref-for-spanning-annotation⑧">spanning annotations</a> that are still longer
				than the sum of the <span id="ref-for-ruby-columns①②">columns</span> that they span
				grow them further,
				adding to each equally.</p>
     <dt id="ex-multi-level-mutli-span"><a class="self-link" href="#ex-multi-level-mutli-span"></a>Several levels, with multiple spanning annotations: 
     <dd>
<pre class="highlight"><span class="column">|</span><span class="annot">[</span><span class="flagbg2"> </span>  xx  <span class="flagbg2"> </span><span class="annot">]</span><span class="column">|</span><span class="annot">[</span><span class="flagbg2">  </span><span class="flagtxt1">annotation spanning bases</span><span class="flagbg2">  </span><span class="annot">]</span><span class="column">|</span>
<span class="column">|</span><span class="annot">[</span><span class="flagbg2"> </span>  a1  <span class="flagbg2"> </span><span class="annot">]</span><span class="column">|</span><span class="annot">[</span><span class="flagbg2"> </span><span class="flagbg1"> </span>annotation-2<span class="flagbg1"> </span><span class="flagbg2"> </span><span class="annot">]</span><span class="column">|</span><span class="annot">[</span><span class="flagbg2"> </span><span class="flagbg1"> </span>  a3  <span class="flagbg1"> </span><span class="flagbg2"> </span><span class="annot">]</span><span class="column">|</span>
<span class="column">|</span><span class="annot">[</span><span class="flagtxt2">lengthy annotation spanning base content</span><span class="annot">]</span><span class="column">|</span>
<span class="column">|</span><span class="base">[</span><span class="flagbg2"> </span>base 1<span class="flagbg2"> </span><span class="base">]</span><span class="column">|</span><span class="base">[</span><span class="flagbg2"> </span><span class="flagbg1"> </span>   base 2   <span class="flagbg1"> </span><span class="flagbg2"> </span><span class="base">]</span><span class="column">|</span><span class="base">[</span><span class="flagbg2"> </span><span class="flagbg1"> </span>base 3<span class="flagbg1"> </span><span class="flagbg2"> </span><span class="base">]</span><span class="column">|</span>
</pre>
      <p>When there are multiple <a data-link-type="dfn" href="#spanning-annotation" id="ref-for-spanning-annotation⑨">spanning annotations</a>,
				those that span fewest <a data-link-type="dfn" href="#ruby-base-box" id="ref-for-ruby-base-box④⑦">bases</a> are processed first.
				In this case, the green one,
				which spans two bases,
				is processed before the orange one,
				which spans three.
				Changing this order would change the distribution of space.</p>
      <p>To help identify which <a data-link-type="dfn" href="#spanning-annotation" id="ref-for-spanning-annotation①⓪">spanning annotation</a> is responsible
				for which extra spacing,
				in this diagram
				the color of the text in each <span id="ref-for-spanning-annotation①①">spanning annotation</span> is matched
				with the background color of spacing it adds to other boxes.</p>
    </dl>
   </div>
   <h4 class="heading settled" data-level="3.1.2" id="interlinear-block"><span class="secno">3.1.2. </span><span class="content"> Block-axis Interlinear Layout</span><a class="self-link" href="#interlinear-block"></a></h4>
   <p class="issue" id="issue-e7399eec"><a class="self-link" href="#issue-e7399eec"></a> Define the extent to which <a class="property css" data-link-type="property" href="https://drafts.csswg.org/css-inline-3/#propdef-vertical-align" id="ref-for-propdef-vertical-align">vertical-align</a> affects these ruby boxes.
	See <a href="https://github.com/w3c/csswg-drafts/issues/4987">Issue 4987</a>.</p>
   <p>Each <a data-link-type="dfn" href="#ruby-base-container-box" id="ref-for-ruby-base-container-box②⑥">base container</a> is then sized and positioned
	to contain exactly all of its <a data-link-type="dfn" href="#ruby-base-box" id="ref-for-ruby-base-box④⑧">ruby bases</a>’ margin boxes—​and all their associated <a data-link-type="dfn" href="#ruby-position-inter-character-annotation" id="ref-for-ruby-position-inter-character-annotation③">inter-character</a> <a data-link-type="dfn" href="#ruby-annotation-box" id="ref-for-ruby-annotation-box⑤④">ruby annotation</a> margin boxes, if any—​as well as the <span id="ref-for-ruby-base-container-box②⑦">base</span> and <a data-link-type="dfn" href="#ruby-annotation-container-box" id="ref-for-ruby-annotation-container-box③①">annotation containers</a> of any descendant <a data-link-type="dfn" href="#ruby-container" id="ref-for-ruby-container②⑦">ruby containers</a> also participating in this <a data-link-type="dfn" href="https://drafts.csswg.org/css-display-4/#inline-formatting-context" id="ref-for-inline-formatting-context⑥">inline formatting context</a>.
	(If a <span id="ref-for-ruby-base-container-box②⑧">base container</span> has no <a data-link-type="dfn" href="https://drafts.csswg.org/css-display-4/#in-flow" id="ref-for-in-flow④">in-flow</a> content,
	it is sized and positioned
	as if it contained a single empty <span id="ref-for-ruby-base-box④⑨">ruby base</span>.)</p>
   <p>Each <a data-link-type="dfn" href="#interlinear-annotations" id="ref-for-interlinear-annotations⑥">interlinear</a> <a data-link-type="dfn" href="#ruby-annotation-container-box" id="ref-for-ruby-annotation-container-box③②">annotation container</a> is sized and positioned
	to contain exactly all of its <a data-link-type="dfn" href="#ruby-annotation-box" id="ref-for-ruby-annotation-box⑤⑤">ruby annotations</a>’ margin boxes
	as well as the <a data-link-type="dfn" href="#ruby-base-container-box" id="ref-for-ruby-base-container-box②⑨">base</a> and <span id="ref-for-ruby-annotation-container-box③③">annotation containers</span> of any descendant <a data-link-type="dfn" href="#ruby-container" id="ref-for-ruby-container②⑧">ruby containers</a> also participating in this <a data-link-type="dfn" href="#annotation-level" id="ref-for-annotation-level⑥">annotation level</a>’s <a data-link-type="dfn" href="https://drafts.csswg.org/css-display-4/#inline-formatting-context" id="ref-for-inline-formatting-context⑦">inline formatting context</a>.
	(If an <span id="ref-for-ruby-annotation-container-box③④">annotation container</span> has no <a data-link-type="dfn" href="https://drafts.csswg.org/css-display-4/#in-flow" id="ref-for-in-flow⑤">in-flow</a> content,
	it is sized and positioned
	as if it contained a single empty <span id="ref-for-ruby-annotation-box⑤⑥">ruby annotation</span>.)
	These <span id="ref-for-ruby-annotation-container-box③⑤">annotation containers</span> are then stacked outward
	over or under (depending on <a class="property css" data-link-type="property" href="#propdef-ruby-position" id="ref-for-propdef-ruby-position①">ruby-position</a>) their corresponding <span id="ref-for-ruby-base-container-box③⓪">base container</span>,
	without any intervening space,
	thus determining the block-axis positioning of the <span id="ref-for-ruby-annotation-box⑤⑦">ruby annotations</span> with respect to their <a data-link-type="dfn" href="#ruby-base-box" id="ref-for-ruby-base-box⑤⓪">ruby bases</a>.</p>
   <p class="issue" id="issue-ea5c17b0"><a class="self-link" href="#issue-ea5c17b0"></a> Should block-axis margins collapse?
	This makes layout more robust,
	but is inconsistent with how inlines behave along the inline-axis.</p>
   <h3 class="heading settled" data-level="3.2" id="inter-character-layout"><span class="secno">3.2. </span><span class="content"> Inter-character Ruby Layout</span><a class="self-link" href="#inter-character-layout"></a></h3>
   <p><a data-link-type="dfn" href="#ruby-position-inter-character-annotation" id="ref-for-ruby-position-inter-character-annotation④">Inter-character annotations</a> have special layout. <span id="ref-for-ruby-position-inter-character-annotation⑤">Inter-character</span> <a data-link-type="dfn" href="#ruby-annotation-box" id="ref-for-ruby-annotation-box⑤⑧">ruby annotation boxes</a> are spliced into and measured as part of the layout of the <a data-link-type="dfn" href="#base-level" id="ref-for-base-level③">base level</a>.
	Each <span id="ref-for-ruby-annotation-box⑤⑨">ruby annotation</span> is inserted to the right of the <a data-link-type="dfn" href="#ruby-base-box" id="ref-for-ruby-base-box⑤①">ruby base</a> it is paired with;
	a <a data-link-type="dfn" href="#span" id="ref-for-span③">spanning</a> <span id="ref-for-ruby-position-inter-character-annotation⑥">inter-character annotation</span> is placed after
	the rightmost of all the bases that it spans. <span id="ref-for-ruby-position-inter-character-annotation⑦">Inter-character</span> <span id="ref-for-ruby-annotation-box⑥⓪">ruby annotations</span> are laid out
	exactly like <a data-link-type="dfn" href="https://drafts.csswg.org/css-display-4/#inline-block" id="ref-for-inline-block">inline blocks</a>,
	except as described below.</p>
   <p class="note" role="note"><span class="marker">Note:</span> As per the definition of <a class="css" data-link-type="maybe" href="#valdef-ruby-position-inter-character" id="ref-for-valdef-ruby-position-inter-character">inter-character</a>, <a data-link-type="dfn" href="#ruby-position-inter-character-annotation" id="ref-for-ruby-position-inter-character-annotation⑧">inter-character annotations</a> always have a <a class="css" data-link-type="maybe" href="https://drafts.csswg.org/css-writing-modes-4/#valdef-writing-mode-vertical-rl" id="ref-for-valdef-writing-mode-vertical-rl">vertical-rl</a> <a class="property css" data-link-type="property" href="https://drafts.csswg.org/css-writing-modes-4/#propdef-writing-mode" id="ref-for-propdef-writing-mode">writing-mode</a>,
	and only exist in <a data-link-type="dfn" href="https://drafts.csswg.org/css-writing-modes-4/#horizontal-writing-mode" id="ref-for-horizontal-writing-mode">horizontal</a> <a data-link-type="dfn" href="#ruby-container" id="ref-for-ruby-container②⑨">ruby containers</a>.</p>
   <p>Each <a data-link-type="dfn" href="#ruby-annotation-box" id="ref-for-ruby-annotation-box⑥①">ruby annotation</a> is placed immediately to the right of the relevant <a data-link-type="dfn" href="#ruby-base-box" id="ref-for-ruby-base-box⑤②">ruby base</a>,
	before any <a data-link-type="dfn" href="#inter-base-white-space" id="ref-for-inter-base-white-space③">inter-base white space</a> (or <a data-link-type="dfn" href="#inter-segment-white-space" id="ref-for-inter-segment-white-space⑤">inter-segment white space</a>).
	If multiple <a data-link-type="dfn" href="#ruby-position-inter-character-annotation" id="ref-for-ruby-position-inter-character-annotation⑨">inter-character</a> <span id="ref-for-ruby-annotation-box⑥②">ruby annotation boxes</span> are placed against the same <span id="ref-for-ruby-base-box⑤③">ruby base</span>,
	their <a data-link-type="dfn" href="https://drafts.csswg.org/css-box-4/#margin-box" id="ref-for-margin-box">margin boxes</a> are stacked rightwards without intervening space,
	in increasing <a data-link-type="dfn" href="#annotation-level" id="ref-for-annotation-level⑦">level</a> order.</p>
   <p>If the <a data-link-type="dfn" href="https://drafts.csswg.org/css-sizing-3/#automatic-size" id="ref-for-automatic-size">automatic height</a> of the <a data-link-type="dfn" href="#ruby-annotation-box" id="ref-for-ruby-annotation-box⑥③">ruby annotation box</a>’s <a data-link-type="dfn" href="https://drafts.csswg.org/css-box-4/#content-area" id="ref-for-content-area">content area</a> would be shorter than the height of the <a data-link-type="dfn" href="https://drafts.csswg.org/css-box-4/#content-box" id="ref-for-content-box">content box</a> of the <a data-link-type="dfn" href="#ruby-base-box" id="ref-for-ruby-base-box⑤④">ruby base</a> after which it is placed,
	its <span id="ref-for-content-box①">content box</span> height is increased to match that height exactly.</p>
   <p>The alignment of the <a data-link-type="dfn" href="#ruby-annotation-box" id="ref-for-ruby-annotation-box⑥④">ruby annotation box</a> depends on the <a class="property css" data-link-type="property" href="#propdef-ruby-align" id="ref-for-propdef-ruby-align⑥">ruby-align</a> property on the <span id="ref-for-ruby-annotation-box⑥⑤">ruby annotation</span>:</p>
   <ul>
    <li> If <a class="property css" data-link-type="property" href="#propdef-ruby-align" id="ref-for-propdef-ruby-align⑦">ruby-align</a> is <a class="css" data-link-type="maybe" href="#valdef-ruby-align-start" id="ref-for-valdef-ruby-align-start">start</a>,
			the top edge of the <a data-link-type="dfn" href="#ruby-annotation-box" id="ref-for-ruby-annotation-box⑥⑥">ruby annotation</a>'s <a data-link-type="dfn" href="https://drafts.csswg.org/css-box-4/#content-box" id="ref-for-content-box②">content box</a> is aligned
			with the top edge of the <a data-link-type="dfn" href="#ruby-base-box" id="ref-for-ruby-base-box⑤⑤">ruby base</a>'s <span id="ref-for-content-box③">content box</span>. 
    <li> Otherwise,
				the center of the <a data-link-type="dfn" href="#ruby-annotation-box" id="ref-for-ruby-annotation-box⑥⑦">ruby annotation</a>'s <a data-link-type="dfn" href="https://drafts.csswg.org/css-box-4/#content-box" id="ref-for-content-box④">content box</a> is vertically aligned
				with the center of the <a data-link-type="dfn" href="#ruby-base-box" id="ref-for-ruby-base-box⑤⑥">ruby base</a>'s <span id="ref-for-content-box⑤">content box</span>. 
   </ul>
   <p>The <a data-link-type="dfn" href="#ruby-annotation-container-box" id="ref-for-ruby-annotation-container-box③⑥">ruby annotation container box</a> of an <a data-link-type="dfn" href="#ruby-position-inter-character-annotation" id="ref-for-ruby-position-inter-character-annotation①⓪">inter-character</a> annotation
	is sized and placed so that its content box coincides exactly with that of the <a data-link-type="dfn" href="#ruby-base-container-box" id="ref-for-ruby-base-container-box③①">ruby base container box</a>.</p>
   <p class="note" role="note"><span class="marker">Note:</span> The size and position of <a data-link-type="dfn" href="#ruby-position-inter-character-annotation" id="ref-for-ruby-position-inter-character-annotation①①">inter-character</a> <a data-link-type="dfn" href="#ruby-annotation-container-box" id="ref-for-ruby-annotation-container-box③⑦">ruby annotation container boxes</a> has no effect on layout.
	The above definition is merely so that programmatically inquiring about them
	produces deterministic results.</p>
   <p>For the purpose of <a href="#ruby-align-property">alignment</a> and column sizing (as discussed in <a href="#ruby-layout">§ 3 Ruby Layout</a>), <a data-link-type="dfn" href="#ruby-position-inter-character-annotation" id="ref-for-ruby-position-inter-character-annotation①②">inter-character</a> <a data-link-type="dfn" href="#ruby-annotation-box" id="ref-for-ruby-annotation-box⑥⑧">ruby annotations</a> are not considered
	to be part of the same <a data-link-type="dfn" href="#ruby-columns" id="ref-for-ruby-columns①③">column</a> as the base to with they are attached;
	rather, they effectively form a <span id="ref-for-ruby-columns①④">column</span> of their own.</p>
   <h3 class="heading settled" data-level="3.3" id="box-style"><span class="secno">3.3. </span><span class="content"> Styling Ruby Boxes</span><a class="self-link" href="#box-style"></a></h3>
   <p><a data-link-type="dfn" href="#ruby-base-box" id="ref-for-ruby-base-box⑤⑦">Ruby bases</a> and <a data-link-type="dfn" href="#ruby-container" id="ref-for-ruby-container③⓪">ruby containers</a> are treated as <a data-link-type="dfn" href="https://drafts.csswg.org/css-display-4/#inline-box" id="ref-for-inline-box⑦">inline boxes</a>,
	and all properties that apply to <span id="ref-for-inline-box⑧">inline boxes</span>,
	unless otherwise specified,
	also apply to them in the same way.
	However, the <a data-link-type="dfn" href="https://drafts.csswg.org/css-inline-3/#line-relative-shift-values" id="ref-for-line-relative-shift-values">line-relative shift values</a> of <a class="property css" data-link-type="property" href="https://drafts.csswg.org/css-inline-3/#propdef-vertical-align" id="ref-for-propdef-vertical-align①">vertical-align</a> (<a class="css" data-link-type="maybe" href="https://drafts.csswg.org/css-inline-3/#valdef-baseline-shift-top" id="ref-for-valdef-baseline-shift-top">top</a>, <a class="css" data-link-type="maybe" href="https://drafts.csswg.org/css-inline-3/#valdef-baseline-shift-bottom" id="ref-for-valdef-baseline-shift-bottom">bottom</a>)
	must be ignored (treated as zero).</p>
   <p>All properties that apply to <a data-link-type="dfn" href="https://drafts.csswg.org/css-display-4/#inline-box" id="ref-for-inline-box⑨">inline boxes</a>,
	unless otherwise specified,
	also apply to <a data-link-type="dfn" href="#ruby-annotation-box" id="ref-for-ruby-annotation-box⑥⑨">ruby annotations</a> in the same way,
	except <a class="property css" data-link-type="property" href="https://drafts.csswg.org/css2/#propdef-line-height" id="ref-for-propdef-line-height">line-height</a>, which does not apply.
	Also, the <a data-link-type="dfn" href="https://drafts.csswg.org/css-inline-3/#line-relative-shift-values" id="ref-for-line-relative-shift-values①">line-relative shift values</a> of <a class="property css" data-link-type="property" href="https://drafts.csswg.org/css-inline-3/#propdef-vertical-align" id="ref-for-propdef-vertical-align②">vertical-align</a> (<a class="css" data-link-type="maybe" href="https://drafts.csswg.org/css-inline-3/#valdef-baseline-shift-top" id="ref-for-valdef-baseline-shift-top①">top</a>, <a class="css" data-link-type="maybe" href="https://drafts.csswg.org/css-inline-3/#valdef-baseline-shift-bottom" id="ref-for-valdef-baseline-shift-bottom①">bottom</a>)
	must be ignored (treated as zero).</p>
   <p>Neither the <a data-link-type="dfn" href="https://drafts.csswg.org/css-box-4/#margin" id="ref-for-margin">margin</a>, <a data-link-type="dfn" href="https://drafts.csswg.org/css-box-4/#padding" id="ref-for-padding">padding</a>, <a data-link-type="dfn" href="https://drafts.csswg.org/css-box-4/#border" id="ref-for-border">border</a> properties
	nor the any properties that do not apply to <a data-link-type="dfn" href="https://drafts.csswg.org/css-display-4/#inline-box" id="ref-for-inline-box①⓪">inline boxes</a> apply to <a data-link-type="dfn" href="#ruby-base-container-box" id="ref-for-ruby-base-container-box③②">base containers</a> or <a data-link-type="dfn" href="#ruby-annotation-container-box" id="ref-for-ruby-annotation-container-box③⑧">annotation containers</a>.
	Additionally, <a class="property css" data-link-type="property" href="https://drafts.csswg.org/css2/#propdef-line-height" id="ref-for-propdef-line-height①">line-height</a> does not apply to <span id="ref-for-ruby-annotation-container-box③⑨">annotation containers</span>.</p>
   <p>The UA is not required to support
	any of the background properties or outline properties,
	or any other property that illustrates the bounds of the box
	on <a data-link-type="dfn" href="#ruby-base-container-box" id="ref-for-ruby-base-container-box③③">ruby base container boxes</a> or <a data-link-type="dfn" href="#ruby-annotation-container-box" id="ref-for-ruby-annotation-container-box④⓪">ruby annotation container boxes</a>.
	The UA may implement these boxes simply as abstractions for inheritance
	and control over the layout of their contents.</p>
   <h3 class="heading settled" data-level="3.4" id="line-breaks"><span class="secno">3.4. </span><span class="content"> Breaking Across Lines</span><a class="self-link" href="#line-breaks"></a></h3>
   <p>When there is not enough space for an entire <a data-link-type="dfn" href="#ruby-container" id="ref-for-ruby-container③①">ruby container</a> to fit on the line,
	the ruby may be broken wherever all levels simultaneously allow a break.
	(See <a href="https://drafts.csswg.org/css-text-3/#line-breaking"><cite>CSS Text 3</cite> § 5 Line Breaking and Word Boundaries</a> for details on line breaking.)
	Ruby most often breaks between base-annotation sets,
	but if the line-breaking rules allow it, can also break within a <a data-link-type="dfn" href="#ruby-base-box" id="ref-for-ruby-base-box⑤⑧">ruby base</a> (and, in parallel, its associated <a data-link-type="dfn" href="#ruby-annotation-box" id="ref-for-ruby-annotation-box⑦⓪">ruby annotation boxes</a>).</p>
   <p>Whenever ruby breaks across lines, <a data-link-type="dfn" href="#ruby-annotation-box" id="ref-for-ruby-annotation-box⑦①">ruby annotations</a> must stay
	with their respective <a data-link-type="dfn" href="#ruby-base-box" id="ref-for-ruby-base-box⑤⑨">ruby bases</a>.
	The line <em>must not</em> break between a <span id="ref-for-ruby-base-box⑥⓪">ruby base</span> and its <span id="ref-for-ruby-annotation-box⑦②">annotations</span>,
	even in the case of <a data-link-type="dfn" href="#ruby-position-inter-character-annotation" id="ref-for-ruby-position-inter-character-annotation①③">inter-character annotations</a>.</p>
   <div class="figure">
     <img alt="Diagram showing the line breaking opportunity in a &quot;Bopomofo&quot; ruby" src="images/r-break-b.gif"> 
    <p class="caption"><a class="css" data-link-type="maybe" href="#valdef-ruby-position-inter-character" id="ref-for-valdef-ruby-position-inter-character①">inter-character</a> ruby line breaking opportunity </p>
   </div>
   <p>After line-breaking,
	each fragment is <a href="#ruby-layout">laid out</a> independently,
	and <a href="#ruby-align-property">ruby alignment</a> takes place within each fragment.</p>
   <h4 class="heading settled" data-level="3.4.1" id="break-between"><span class="secno">3.4.1. </span><span class="content"> Breaking Between Bases</span><a class="self-link" href="#break-between"></a></h4>
   <p>In typical cases, <a data-link-type="dfn" href="#ruby-base-box" id="ref-for-ruby-base-box⑥①">ruby base boxes</a> and <a data-link-type="dfn" href="#ruby-annotation-box" id="ref-for-ruby-annotation-box⑦③">ruby annotation boxes</a> are styled to forbid internal line wrapping and do not contain forced breaks.
	(See <a href="#default-stylesheet">Appendix A</a>.)
	In such cases the <a data-link-type="dfn" href="#ruby-container" id="ref-for-ruby-container③②">ruby container</a> can only break between adjacent <span id="ref-for-ruby-base-box⑥②">ruby bases</span>,
	and only if no <span id="ref-for-ruby-annotation-box⑦④">ruby annotations</span> span those <span id="ref-for-ruby-base-box⑥③">ruby bases</span>.</p>
   <div class="figure">
     <img alt="Diagram showing the line breaking opportunity in a complex ruby" src="images/r-break-a.gif"> 
    <p class="caption">Ruby line breaking opportunity </p>
   </div>
   <p>Whether ruby can break between two adjacent <a data-link-type="dfn" href="#ruby-base-box" id="ref-for-ruby-base-box⑥④">ruby bases</a> is controlled by normal line-breaking rules for the base text,
	exactly as if the <span id="ref-for-ruby-base-box⑥⑤">ruby bases</span> were adjacent inline boxes.
	(The annotations are ignored when determining soft wrap opportunities for the <a data-link-type="dfn" href="#base-level" id="ref-for-base-level④">base level</a>.)</p>
   <div class="example" id="example-9780a5d8">
    <a class="self-link" href="#example-9780a5d8"></a> For example, if two adjacent ruby bases are “蝴” and “蝶”,
		the line may break between them,
		because lines are normally allowed to break between two Han characters.
		However, if <a class="property css" data-link-type="property" href="https://drafts.csswg.org/css-text-4/#propdef-word-break" id="ref-for-propdef-word-break">word-break</a> is <a class="css" data-link-type="maybe" href="https://drafts.csswg.org/css-text-4/#valdef-word-break-keep-all" id="ref-for-valdef-word-break-keep-all">keep-all</a>, that line break is forbidden. 
<pre class="highlight"><c- p>&lt;</c-><c- f>ruby</c-><c- p>></c->蝴<c- p>&lt;</c-><c- f>rt</c-><c- p>></c->hú<c- p>&lt;/</c-><c- f>rt</c-><c- p>></c->蝶<c- p>&lt;</c-><c- f>rt</c-><c- p>></c->dié<c- p>&lt;/</c-><c- f>rt</c-><c- p>></c-></pre>
   </div>
   <p>Inter-base white space is significant for evaluating line break opportunities between <a data-link-type="dfn" href="#ruby-base-box" id="ref-for-ruby-base-box⑥⑥">ruby bases</a>.
	As with white space between inlines,
	it collapses when the line breaks there,
	following the rules detailed in <a href="https://drafts.csswg.org/css-text-3/#white-space-rules"><cite>CSS Text 3</cite> § 4.1 The White Space Processing Rules</a>.
	Similarly, annotation white space is also trimmed at a line break.</p>
   <div class="example" id="example-070966be">
    <a class="self-link" href="#example-070966be"></a> For example, given the following markup: 
<pre class="highlight"><c- p>&lt;</c-><c- f>ruby</c-><c- p>>&lt;</c-><c- f>rb</c-><c- p>></c->one<c- p>&lt;/</c-><c- f>rb</c-><c- p>></c-> <c- p>&lt;</c-><c- f>rb</c-><c- p>></c->two<c- p>&lt;/</c-><c- f>rb</c-><c- p>></c-> <c- p>&lt;</c-><c- f>rt</c-><c- p>></c->1<c- p>&lt;/</c-><c- f>rt</c-><c- p>></c-> <c- p>&lt;</c-><c- f>rt</c-><c- p>></c->2<c- p>&lt;/</c-><c- f>rt</c-><c- p>>&lt;/</c-><c- f>ruby</c-><c- p>></c-></pre>
    <p>Due to the space, the line may break between “one” and “two“.
		If the line breaks there, that space—and the space between “1” and “2”—disappears,
		in accordance with standard CSS white space processing rules.</p>
   </div>
   <h4 class="heading settled" data-level="3.4.2" id="break-within"><span class="secno">3.4.2. </span><span class="content"> Breaking Within Bases</span><a class="self-link" href="#break-within"></a></h4>
   <p>For longer base texts, it is sometimes appropriate to allow breaking within a base-annotation pair.
	For example, if an English sentence is annotated with its Japanese translation,
	allowing the text to wrap allows for reasonable line breaking behavior in the paragraph.</p>
   <p class="issue" id="issue-14d7c6b1"><a class="self-link" href="#issue-14d7c6b1"></a> Insert scanned example so people don’t think this is just the ramblings of an insane spec-writer.</p>
   <p>Line-breaking within a <a data-link-type="dfn" href="#ruby-base-box" id="ref-for-ruby-base-box⑥⑦">ruby base</a> is only allowed if the <a class="property css" data-link-type="property" href="https://drafts.csswg.org/css-text-4/#propdef-white-space" id="ref-for-propdef-white-space②">white-space</a> property
	of the <span id="ref-for-ruby-base-box⑥⑧">ruby base</span> and all its parallel <a data-link-type="dfn" href="#ruby-annotation-box" id="ref-for-ruby-annotation-box⑦⑤">annotations</a> allow it,
	and there exists a <a data-link-type="dfn" href="https://drafts.csswg.org/css-text-4/#soft-wrap-opportunity" id="ref-for-soft-wrap-opportunity">soft wrap opportunity</a> <em>within</em> (i.e. not at the start or end)
	the content of each base/annotation box.
	Since there is no structural correspondence between fragments of content
	within <span id="ref-for-ruby-base-box⑥⑨">ruby bases</span> and <span id="ref-for-ruby-annotation-box⑦⑥">annotations</span>,
	the UA may break at any set of opportunities;
	but it is recommended that the UA attempt to proportionally balance
	the amount of content inside each fragment.</p>
   <p>There are no line breaking opportunities within <a data-link-type="dfn" href="#ruby-position-inter-character-annotation" id="ref-for-ruby-position-inter-character-annotation①④">inter-character annotations</a>.</p>
   <h3 class="heading settled" data-level="3.5" id="bidi"><span class="secno">3.5. </span><span class="content"> Bidi Reordering</span><a class="self-link" href="#bidi"></a></h3>
   <p>The Unicode bidirectional algorithm reorders logically-stored text for visual presentation
	when characters from scripts of opposing directionalities are mixed
	within a single paragraph.</p>
   <p>To preserve the correspondence of <a data-link-type="dfn" href="#ruby-annotation-box" id="ref-for-ruby-annotation-box⑦⑦">ruby annotations</a> to their respective <a data-link-type="dfn" href="#ruby-base-box" id="ref-for-ruby-base-box⑦⓪">ruby bases</a>,
	a few restrictions must be imposed:</p>
   <ul>
    <li>The contents of a <a data-link-type="dfn" href="#ruby-base-box" id="ref-for-ruby-base-box⑦①">ruby base</a> or <a data-link-type="dfn" href="#ruby-annotation-box" id="ref-for-ruby-annotation-box⑦⑧">ruby annotation</a> must remain contiguous. 
    <li><a data-link-type="dfn" href="#ruby-annotation-box" id="ref-for-ruby-annotation-box⑦⑨">Ruby annotations</a> must be reordered together with their <a data-link-type="dfn" href="#ruby-base-box" id="ref-for-ruby-base-box⑦②">ruby bases</a>. 
    <li>All <a data-link-type="dfn" href="#ruby-base-box" id="ref-for-ruby-base-box⑦③">ruby bases</a> spanned by a single <a data-link-type="dfn" href="#ruby-annotation-box" id="ref-for-ruby-annotation-box⑧⓪">ruby annotation</a> must remain contiguous. 
   </ul>
   <p>To this end,</p>
   <ul>
    <li>
      Bidi isolation is forced on all <a data-link-type="dfn" href="#internal-ruby-boxes" id="ref-for-internal-ruby-boxes②">internal ruby boxes</a> and the <a data-link-type="dfn" href="#ruby-container" id="ref-for-ruby-container③③">ruby container</a>:
			the <a class="css" data-link-type="maybe" href="https://drafts.csswg.org/css-writing-modes-4/#valdef-unicode-bidi-normal" id="ref-for-valdef-unicode-bidi-normal">normal</a> and <a class="css" data-link-type="maybe" href="https://drafts.csswg.org/css-writing-modes-4/#valdef-unicode-bidi-embed" id="ref-for-valdef-unicode-bidi-embed">embed</a> values of <a class="property css" data-link-type="property" href="https://drafts.csswg.org/css-writing-modes-3/#propdef-unicode-bidi" id="ref-for-propdef-unicode-bidi">unicode-bidi</a> compute to <a class="css" data-link-type="maybe" href="https://drafts.csswg.org/css-writing-modes-4/#valdef-unicode-bidi-isolate" id="ref-for-valdef-unicode-bidi-isolate">isolate</a>,
			and <a class="css" data-link-type="maybe" href="https://drafts.csswg.org/css-writing-modes-4/#valdef-unicode-bidi-bidi-override" id="ref-for-valdef-unicode-bidi-bidi-override">bidi-override</a> computes to <a class="css" data-link-type="maybe" href="https://drafts.csswg.org/css-writing-modes-4/#valdef-unicode-bidi-isolate-override" id="ref-for-valdef-unicode-bidi-isolate-override">isolate-override</a>. 
     <p class="note" role="note"><span class="marker">Note:</span> This means that implicit bidi reordering does not work across ruby bases,
			so authors will need to ensure that the <a data-link-type="dfn" href="#ruby-container" id="ref-for-ruby-container③④">ruby container</a>’s declared directionality
			does indeed match its contents.</p>
    <li> During layout, <a data-link-type="dfn" href="#ruby-segments" id="ref-for-ruby-segments①⑤">ruby segments</a> are ordered within the <a data-link-type="dfn" href="#ruby-container" id="ref-for-ruby-container③⑤">ruby container</a> by the <a class="property css" data-link-type="property" href="https://drafts.csswg.org/css-writing-modes-3/#propdef-direction" id="ref-for-propdef-direction">direction</a> property of their <span id="ref-for-ruby-container③⑥">ruby container</span>. 
    <li>
      Within a segment, <a data-link-type="dfn" href="#ruby-base-box" id="ref-for-ruby-base-box⑦④">ruby bases</a> and <a data-link-type="dfn" href="#ruby-annotation-box" id="ref-for-ruby-annotation-box⑧①">ruby annotations</a> that are not <a data-link-type="dfn" href="#merged-annotation" id="ref-for-merged-annotation②">merged</a> are ordered within their respective containers
			by the <a class="property css" data-link-type="property" href="https://drafts.csswg.org/css-writing-modes-3/#propdef-direction" id="ref-for-propdef-direction①">direction</a> property of the segment’s <a data-link-type="dfn" href="#ruby-base-container-box" id="ref-for-ruby-base-container-box③④">ruby base container</a>. <span id="ref-for-merged-annotation③">Merged annotations</span> are ordered
			by the <span class="property" id="ref-for-propdef-direction②">direction</span> property of their <a data-link-type="dfn" href="#ruby-annotation-container-box" id="ref-for-ruby-annotation-container-box④①">annotation container</a>,
			exactly as if they were a sequence of inline boxes within their <span id="ref-for-ruby-annotation-container-box④②">annotation container</span>. 
     <p class="note" role="note"><span class="marker">Note:</span> This means the <a class="property css" data-link-type="property" href="https://drafts.csswg.org/css-writing-modes-3/#propdef-direction" id="ref-for-propdef-direction③">direction</a> property on <a data-link-type="dfn" href="#ruby-annotation-container-box" id="ref-for-ruby-annotation-container-box④③">ruby annotation containers</a> is ignored for the purpose of layout of non-<a data-link-type="dfn" href="#merged-annotation" id="ref-for-merged-annotation④">merged</a> annotations.
			However, it can still inherit into the container’s children
			and thereby affect the <a data-link-type="dfn" href="https://drafts.csswg.org/css-writing-modes-4/#inline-base-direction" id="ref-for-inline-base-direction">inline base direction</a> of any <a data-link-type="dfn" href="#ruby-annotation-box" id="ref-for-ruby-annotation-box⑧②">ruby annotations</a> it contains.</p>
   </ul>
   <p>As with other inline-level content,
	the bidi reordering of <a data-link-type="dfn" href="#internal-ruby-boxes" id="ref-for-internal-ruby-boxes③">internal ruby boxes</a> happens after line-breaking
	so that content is divided across lines according to its logical order.</p>
   <p class="note" role="note"><span class="marker">Note:</span> It could be useful to adjust these rules slightly
	so that when <a class="property css" data-link-type="property" href="#propdef-ruby-merge" id="ref-for-propdef-ruby-merge⑤">ruby-merge</a> is <a class="css" data-link-type="maybe" href="#valdef-ruby-merge-merge" id="ref-for-valdef-ruby-merge-merge①">merge</a> on a particular <a data-link-type="dfn" href="#ruby-annotation-container-box" id="ref-for-ruby-annotation-container-box④④">annotation container</a>,
	bidi isolation is not forced onto the individual annotations,
	enabling them to be processed together.
	However, this would add complexity to implementations,
	which does not seem justified in the absence of demand to handle this situation.
	Anyone with a need for this to be handled
	is encouraged to contact the CSS Working Group.</p>
   <p>See <a data-link-type="biblio" href="#biblio-css3-writing-modes" title="CSS Writing Modes Level 3">[CSS3-WRITING-MODES]</a> for a more in-depth discussion of bidirectional text in CSS.</p>
   <h3 class="heading settled" data-level="3.6" id="line-height"><span class="secno">3.6. </span><span class="content"> Line Spacing</span><a class="self-link" href="#line-height"></a></h3>
   <p>The <a class="property css" data-link-type="property" href="https://drafts.csswg.org/css2/#propdef-line-height" id="ref-for-propdef-line-height②">line-height</a> property controls spacing between lines in CSS.
	When inline content on line is shorter than the <span class="property" id="ref-for-propdef-line-height③">line-height</span>,
	half-leading is added on either side of the content,
	as specified in <a href="https://drafts.csswg.org/css-inline-3/#line-height"><cite>CSS Inline Layout 3</cite> § 5 Logical Heights and Inter-line Spacing</a>.</p>
   <p>In order to ensure consistent spacing of lines,
	documents with ruby typically ensure that the <a class="property css" data-link-type="property" href="https://drafts.csswg.org/css2/#propdef-line-height" id="ref-for-propdef-line-height④">line-height</a> is large enough
	to accommodate ruby between lines of text.
	Therefore, ordinarily, <a data-link-type="dfn" href="#ruby-annotation-container-box" id="ref-for-ruby-annotation-container-box④⑤">ruby annotation containers</a> and <a data-link-type="dfn" href="#ruby-annotation-box" id="ref-for-ruby-annotation-box⑧③">ruby annotation boxes</a> do not contribute to the measured height of a line’s inline contents;
	any alignment (see <a class="property css" data-link-type="property" href="https://drafts.csswg.org/css-inline-3/#propdef-vertical-align" id="ref-for-propdef-vertical-align③">vertical-align</a>) and line-height calculations
	are performed using only the <a data-link-type="dfn" href="#ruby-base-container-box" id="ref-for-ruby-base-container-box③⑤">ruby base container</a>,
	exactly as if it were a normal inline.</p>
   <p>However, if the <a class="property css" data-link-type="property" href="https://drafts.csswg.org/css2/#propdef-line-height" id="ref-for-propdef-line-height⑤">line-height</a> specified on the <a data-link-type="dfn" href="#ruby-container" id="ref-for-ruby-container③⑦">ruby container</a> is less than the distance between
	the top of the top <a data-link-type="dfn" href="#ruby-annotation-container-box" id="ref-for-ruby-annotation-container-box④⑥">ruby annotation container</a> and the bottom of the bottom <span id="ref-for-ruby-annotation-container-box④⑦">ruby annotation container</span>,
	then additional leading is added
	on the appropriate side(s) of the <a data-link-type="dfn" href="#ruby-base-container-box" id="ref-for-ruby-base-container-box③⑥">ruby base container</a> such that if a block consisted of three lines
	each containing ruby identical to this,
	none of the <span id="ref-for-ruby-container③⑧">ruby containers</span> would overlap.</p>
   <p class="note" role="note"><span class="marker">Note:</span> This does not ensure that the <a data-link-type="dfn" href="#ruby-annotation-box" id="ref-for-ruby-annotation-box⑧④">ruby annotations</a> remain within the line box.
	It merely ensures that <em>if all lines had equal spacing</em> and equivalent amounts and positioning of <span id="ref-for-ruby-annotation-box⑧⑤">ruby annotations</span>,
	there would be enough room to avoid overlap.</p>
   <p>Authors should ensure appropriate <a class="property css" data-link-type="property" href="https://drafts.csswg.org/css2/#propdef-line-height" id="ref-for-propdef-line-height⑥">line-height</a> and <a class="property css" data-link-type="property" href="https://drafts.csswg.org/css-box-4/#propdef-padding" id="ref-for-propdef-padding">padding</a> to accommodate ruby,
	and be particularly careful at the beginning or end of a block
	and when a line contains inline-level content
	(such as images, inline blocks, or elements shifted with <a class="property css" data-link-type="property" href="https://drafts.csswg.org/css-inline-3/#propdef-vertical-align" id="ref-for-propdef-vertical-align④">vertical-align</a>)
	taller than the paragraph’s default font size.</p>
   <div class="figure">
     <img alt="The content of each line sits in the middle of its line height;
		          the additional space on each side is called half-leading.
		          Ruby fits between lines if it is smaller than twice the half-leading,
		          but this means that it occupies space belonging to the half-leading of the previous line." src="images/rlh-a.gif"> 
    <p class="caption">Ruby annotations will often overflow the line;
		authors should ensure content over/under a ruby-annotated line
		is adequately spaced to leave room for the ruby. </p>
   </div>
   <p class="note" role="note"><span class="marker">Note:</span> More control over how ruby affects alignment and line layout
	will be part of the CSS Line Layout Module Level 3.
	Note, it is currently in the exploratory stages of development;
	descriptions of new features should not yet be relied upon.</p>
   <h2 class="heading settled" data-level="4" id="ruby-props"><span class="secno">4. </span><span class="content"> Ruby Formatting Properties</span><a class="self-link" href="#ruby-props"></a></h2>
   <p>The following properties are introduced to control ruby <a href="#rubypos">positioning</a>, <a href="#collapsed-ruby">text distribution</a>,
	and <a href="#rubyalign">alignment</a>.</p>
   <h3 class="heading settled" data-level="4.1" id="rubypos"><span class="secno">4.1. </span><span class="content"> Ruby Positioning: the <a class="property css" data-link-type="property" href="#propdef-ruby-position" id="ref-for-propdef-ruby-position②">ruby-position</a> property</span><a class="self-link" href="#rubypos"></a></h3>
   <table class="def propdef" data-link-for-hint="ruby-position">
    <tbody>
     <tr>
      <th>Name:
      <td><dfn class="dfn-paneled css" data-dfn-type="property" data-export id="propdef-ruby-position">ruby-position</dfn>
     <tr class="value">
      <th><a href="https://www.w3.org/TR/css-values/#value-defs">Value:</a>
      <td class="prod">[ alternate <a data-link-type="grammar" href="https://drafts.csswg.org/css-values-4/#comb-any" id="ref-for-comb-any">||</a> [ over <a data-link-type="grammar" href="https://drafts.csswg.org/css-values-4/#comb-one" id="ref-for-comb-one④">|</a> under ] ] <span id="ref-for-comb-one⑤">|</span> inter-character 
     <tr>
      <th><a href="https://www.w3.org/TR/css-cascade/#initial-values">Initial:</a>
      <td>alternate 
     <tr>
      <th><a href="https://www.w3.org/TR/css-cascade/#applies-to">Applies to:</a>
      <td>ruby annotation containers 
     <tr>
      <th><a href="https://www.w3.org/TR/css-cascade/#inherited-property">Inherited:</a>
      <td>yes 
     <tr>
      <th><a href="https://www.w3.org/TR/css-values/#percentages">Percentages:</a>
      <td>n/a 
     <tr>
      <th><a href="https://www.w3.org/TR/css-cascade/#computed">Computed value:</a>
      <td>specified keyword 
     <tr>
      <th><a href="https://www.w3.org/TR/cssom/#serializing-css-values">Canonical order:</a>
      <td>per grammar 
     <tr>
      <th><a href="https://www.w3.org/TR/web-animations/#animation-type">Animation type:</a>
      <td>discrete 
   </table>
   <p>This property controls position of the <a data-link-type="dfn" href="#ruby-annotation-box" id="ref-for-ruby-annotation-box⑧⑥">ruby annotation</a> with respect to its base.
	Values have the following meanings:</p>
   <dl>
    <dt><dfn class="dfn-paneled css" data-dfn-for="ruby-position" data-dfn-type="value" data-export id="valdef-ruby-position-alternate">alternate</dfn> 
    <dd>
      Different <a data-link-type="dfn" href="#annotation-level" id="ref-for-annotation-level⑧">levels</a> of annotations alternate between <a class="css" data-link-type="maybe" href="#valdef-ruby-position-over" id="ref-for-valdef-ruby-position-over">over</a> and <a class="css" data-link-type="maybe" href="#valdef-ruby-position-under" id="ref-for-valdef-ruby-position-under">under</a>. 
     <p>If the <a data-link-type="dfn" href="#ruby-annotation-container-box" id="ref-for-ruby-annotation-container-box④⑧">annotation container</a> is the first <a data-link-type="dfn" href="#annotation-level" id="ref-for-annotation-level⑨">level</a> of annotation in its <a data-link-type="dfn" href="#ruby-segments" id="ref-for-ruby-segments①⑥">ruby segment</a>,
			or if all prior <span id="ref-for-annotation-level①⓪">levels</span> are <a data-link-type="dfn" href="#ruby-position-inter-character-annotation" id="ref-for-ruby-position-inter-character-annotation①⑤">inter-character</a>,
			then <a class="css" data-link-type="maybe" href="#valdef-ruby-position-alternate" id="ref-for-valdef-ruby-position-alternate">alternate</a>, either on its own or in combination with <a class="css" data-link-type="maybe" href="#valdef-ruby-position-over" id="ref-for-valdef-ruby-position-over①">over</a>,
			behaves the same as <span class="css" id="ref-for-valdef-ruby-position-over②">over</span>,
			while <span class="css" id="ref-for-valdef-ruby-position-alternate①">alternate</span> in combination with <a class="css" data-link-type="maybe" href="#valdef-ruby-position-under" id="ref-for-valdef-ruby-position-under①">under</a> behaves the same as <span class="css" id="ref-for-valdef-ruby-position-under②">under</span>.</p>
     <p>Otherwise,
			if the previous level of <a data-link-type="dfn" href="#interlinear-annotations" id="ref-for-interlinear-annotations⑦">interlinear</a> annotation is <a class="css" data-link-type="maybe" href="#valdef-ruby-position-over" id="ref-for-valdef-ruby-position-over③">over</a>, <a class="css" data-link-type="maybe" href="#valdef-ruby-position-alternate" id="ref-for-valdef-ruby-position-alternate②">alternate</a> behaves like <a class="css" data-link-type="maybe" href="#valdef-ruby-position-under" id="ref-for-valdef-ruby-position-under③">under</a>,
			and vice versa.
			(In this case, whether <span class="css" id="ref-for-valdef-ruby-position-alternate③">alternate</span> is specified alone
			or in combination with <span class="css" id="ref-for-valdef-ruby-position-over④">over</span> or <span class="css" id="ref-for-valdef-ruby-position-under④">under</span> makes no difference.)</p>
    <dt><dfn class="dfn-paneled css" data-dfn-for="ruby-position" data-dfn-type="value" data-export id="valdef-ruby-position-over">over</dfn> 
    <dd>
      The ruby annotation appears <a data-link-type="dfn" href="https://drafts.csswg.org/css-writing-modes-4/#line-over" id="ref-for-line-over">line-over</a> the base. 
     <div class="figure">
       <img alt="Diagram of ruby glyph layout in horizontal mode with ruby annotation appearing above the base" src="images/shinkansen-top.gif"> 
      <p class="caption">Ruby over Japanese base text in horizontal layout </p>
     </div>
     <div class="figure">
       <img alt="Diagram of ruby glyph layout in vertical mode with ruby annotation appearing vertically on the right of the base" src="images/shinkansen-right.gif" width="33"> 
      <p class="caption">Ruby to the right of Japanese base text in vertical layout </p>
     </div>
    <dt><dfn class="dfn-paneled css" data-dfn-for="ruby-position" data-dfn-type="value" data-export id="valdef-ruby-position-under">under</dfn> 
    <dd>
      The ruby annotation appears <a data-link-type="dfn" href="https://drafts.csswg.org/css-writing-modes-4/#line-under" id="ref-for-line-under">line-under</a> the base.
			This is a relatively rare setting used in ideographic East Asian writing systems,
			most easily found in educational text. 
     <div class="figure">
       <img alt="Diagram of ruby glyph layout in horizontal mode with ruby annotation appearing below the base" src="images/shinkansen-bottom.gif"> 
      <p class="caption">Ruby under Japanese base text in horizontal layout </p>
     </div>
     <div class="figure">
       <img alt="Diagram of ruby glyph layout in vertical mode with ruby annotation appearing vertically on the left of the base" src="images/shinkansen-left.gif"> 
      <p class="caption">Ruby to the left of Japanese base text in vertical layout </p>
     </div>
    <dt><dfn class="dfn-paneled css" data-dfn-for="ruby-position" data-dfn-type="value" data-export id="valdef-ruby-position-inter-character">inter-character</dfn>
    <dd>
      If the <a data-link-type="dfn" href="https://drafts.csswg.org/css-writing-modes-4/#writing-mode" id="ref-for-writing-mode">writing mode</a> of the enclosing <a data-link-type="dfn" href="#ruby-container" id="ref-for-ruby-container③⑨">ruby container</a> is <a data-link-type="dfn" href="https://drafts.csswg.org/css-writing-modes-4/#vertical-writing-mode" id="ref-for-vertical-writing-mode">vertical</a>,
			this value has the same effect as <a class="css" data-link-type="maybe" href="#valdef-ruby-position-over" id="ref-for-valdef-ruby-position-over⑤">over</a>. 
     <p>Otherwise, the ruby annotation becomes an <dfn class="dfn-paneled" data-dfn-for="ruby-position" data-dfn-type="dfn" data-local-lt="inter-character" data-noexport id="ruby-position-inter-character-annotation">inter-character annotation</dfn>.
			The annotation appears on the right of the base in horizontal text.
			This forces the computed value of <a class="property css" data-link-type="property" href="https://drafts.csswg.org/css-writing-modes-4/#propdef-writing-mode" id="ref-for-propdef-writing-mode①">writing-mode</a> of the <a data-link-type="dfn" href="#ruby-annotation-container-box" id="ref-for-ruby-annotation-container-box④⑨">ruby annotation container</a> to be <a class="css" data-link-type="maybe" href="https://drafts.csswg.org/css-writing-modes-4/#valdef-writing-mode-vertical-rl" id="ref-for-valdef-writing-mode-vertical-rl①">vertical-rl</a>.</p>
     <p>This value is provided for the special case of traditional Chinese
			as used especially in Taiwan:
			ruby (made of <a href="#g-bopomofo">bopomofo</a> glyphs) in that context
			appears vertically along the right side of the base glyph,
			even when the layout of the base characters is horizontal:</p>
     <div class="figure">
       <img alt="Example of Taiwanese-style ruby" src="images/bopomofo.gif"> 
      <p class="caption">“Bopomofo” ruby in traditional Chinese
					(ruby annotation shown in blue for clarity) in horizontal layout </p>
     </div>
   </dl>
   <p><a data-link-type="dfn" href="#ruby-annotation-container-box" id="ref-for-ruby-annotation-container-box⑤⓪">Annotation containers</a> that are not <a data-link-type="dfn" href="#ruby-position-inter-character-annotation" id="ref-for-ruby-position-inter-character-annotation①⑥">inter-character annotations</a> are called <dfn class="dfn-paneled" data-dfn-type="dfn" data-local-lt="interlinear" data-noexport id="interlinear-annotations">interlinear annotations</dfn>.</p>
   <p>If multiple <a data-link-type="dfn" href="#ruby-annotation-container-box" id="ref-for-ruby-annotation-container-box⑤①">ruby annotation containers</a> have the same <a class="property css" data-link-type="property" href="#propdef-ruby-position" id="ref-for-propdef-ruby-position③">ruby-position</a>,
	they stack outwards from the base text.</p>
   <h3 class="heading settled" data-level="4.2" id="collapsed-ruby"><span class="secno">4.2. </span><span class="content"> Sharing Annotation Space: the <a class="property css" data-link-type="property" href="#propdef-ruby-merge" id="ref-for-propdef-ruby-merge⑥">ruby-merge</a> property</span><a class="self-link" href="#collapsed-ruby"></a></h3>
   <table class="def propdef" data-link-for-hint="ruby-merge">
    <tbody>
     <tr>
      <th>Name:
      <td><dfn class="dfn-paneled css" data-dfn-type="property" data-export id="propdef-ruby-merge">ruby-merge</dfn>
     <tr class="value">
      <th><a href="https://www.w3.org/TR/css-values/#value-defs">Value:</a>
      <td class="prod">separate <a data-link-type="grammar" href="https://drafts.csswg.org/css-values-4/#comb-one" id="ref-for-comb-one⑥">|</a> merge <span id="ref-for-comb-one⑦">|</span> auto 
     <tr>
      <th><a href="https://www.w3.org/TR/css-cascade/#initial-values">Initial:</a>
      <td>separate 
     <tr>
      <th><a href="https://www.w3.org/TR/css-cascade/#applies-to">Applies to:</a>
      <td><a data-link-type="dfn" href="#interlinear-annotations" id="ref-for-interlinear-annotations⑧">interlinear</a> ruby annotation containers 
     <tr>
      <th><a href="https://www.w3.org/TR/css-cascade/#inherited-property">Inherited:</a>
      <td>yes 
     <tr>
      <th><a href="https://www.w3.org/TR/css-values/#percentages">Percentages:</a>
      <td>n/a 
     <tr>
      <th><a href="https://www.w3.org/TR/css-cascade/#computed">Computed value:</a>
      <td>specified keyword 
     <tr>
      <th><a href="https://www.w3.org/TR/cssom/#serializing-css-values">Canonical order:</a>
      <td>per grammar 
     <tr>
      <th><a href="https://www.w3.org/TR/web-animations/#animation-type">Animation type:</a>
      <td>by computed value type 
   </table>
   <p>This property controls how ruby annotation boxes should be rendered
	when there are more than one in a ruby container box:
	whether each pair should be kept separate,
	the annotations should be <dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="merged annotation | merged" data-noexport id="merged-annotation">merged</dfn> and rendered as a group,
	or the separation should be determined based on the space available.</p>
   <p class="note" role="note"><span class="marker">Note:</span> <a data-link-type="dfn" href="#ruby-position-inter-character-annotation" id="ref-for-ruby-position-inter-character-annotation①⑦">Inter-character annotations</a> are always separate, and this property does not apply.</p>
   <p>Possible values:</p>
   <dl>
    <dt><dfn class="dfn-paneled css" data-dfn-for="ruby-merge" data-dfn-type="value" data-export id="valdef-ruby-merge-separate">separate</dfn> 
    <dd>
      Each ruby annotation box is rendered within
			the same <a data-link-type="dfn" href="#ruby-columns" id="ref-for-ruby-columns①⑤">column</a>(s) as its corresponding base box(es),
			i.e. without overlapping adjacent bases on either side.
			This style is called “mono ruby” in <a data-link-type="biblio" href="#biblio-jlreq" title="Requirements for Japanese Text Layout 日本語組版処理の要件(日本語版)">[JLREQ]</a>. 
     <figure>
       <img alt="Extra space is added to base or annotations
				          when one of the pair is longer than the other
				          in order to keep each annotation exclusive to its own base.
				          For example, in the annotation for “上手”,
				          extra space is added around the first character
				          to accommodate its longer annotation “じょう”
				          while the shorter annotation “ず” for the second character
				          is simply positioned and aligned with respect to its base characters." src="images/ruby-mono.png"> 
      <figcaption><a class="css" data-link-type="propdesc" href="#propdef-ruby-merge" id="ref-for-propdef-ruby-merge⑦">ruby-merge: separate</a> with center alignment</figcaption>
     </figure>
     <div class="example" id="example-4b06efaa">
      <a class="self-link" href="#example-4b06efaa"></a> For example, the following two lines render the same: 
<pre class="highlight"><c- p>&lt;</c-><c- f>p</c-><c- p>>&lt;</c-><c- f>ruby</c-><c- p>></c->無<c- p>&lt;</c-><c- f>rt</c-><c- p>></c->む<c- p>&lt;/</c-><c- f>ruby</c-><c- p>>&lt;</c-><c- f>ruby</c-><c- p>></c->常<c- p>&lt;</c-><c- f>rt</c-><c- p>></c->じょう<c- p>&lt;/</c-><c- f>ruby</c-><c- p>></c->
<c- p>&lt;</c-><c- f>p</c-><c- p>>&lt;</c-><c- f>ruby</c-> <c- e>style</c-><c- o>=</c-><c- s>"ruby-merge:separate"</c-><c- p>>&lt;</c-><c- f>rb</c-><c- p>></c->無<c- p>&lt;</c-><c- f>rb</c-><c- p>></c->常<c- p>&lt;</c-><c- f>rt</c-><c- p>></c->む<c- p>&lt;</c-><c- f>rt</c-><c- p>></c->じょう<c- p>&lt;/</c-><c- f>ruby</c-><c- p>></c-></pre>
     </div>
    <dt><dfn class="dfn-paneled css" data-dfn-for="ruby-merge" data-dfn-type="value" data-export id="valdef-ruby-merge-merge">merge</dfn> 
    <dd>
      All <a data-link-type="dfn" href="#ruby-annotation-box" id="ref-for-ruby-annotation-box⑧⑦">ruby annotation boxes</a> within the same <a data-link-type="dfn" href="#ruby-segments" id="ref-for-ruby-segments①⑦">ruby segment</a> on the same line are concatenated
			as <a data-link-type="dfn" href="https://drafts.csswg.org/css-display-4/#inline-box" id="ref-for-inline-box①①">inline boxes</a> within their <a data-link-type="dfn" href="#ruby-annotation-container-box" id="ref-for-ruby-annotation-container-box⑤②">annotation container</a>,
			and laid out in a single anonymous <span id="ref-for-ruby-annotation-box⑧⑧">ruby annotation box</span> spanning all their associated <a data-link-type="dfn" href="#ruby-base-box" id="ref-for-ruby-base-box⑦⑤">ruby base boxes</a>.
			When laid out on a single line,
			this style renders similar to “group ruby” in <a data-link-type="biblio" href="#biblio-jlreq" title="Requirements for Japanese Text Layout 日本語組版処理の要件(日本語版)">[JLREQ]</a>.
			However, when it breaks across lines, <span id="ref-for-ruby-annotation-box⑧⑨">ruby annotations</span> are kept together with their respective <span id="ref-for-ruby-base-box⑦⑥">ruby bases</span>. 
     <figure>
       <img alt="The combined annotation is centered with respect to the combined base,
				          even if this would place an annotation’s content over a different base.
				          In the case of “上手”, the “う” from the first base’s annotation
				          and the “ず” from the second base’s annotation end up
				          sharing space over the second base." src="images/ruby-merge.png"> 
      <figcaption><a class="css" data-link-type="propdesc" href="#propdef-ruby-merge" id="ref-for-propdef-ruby-merge⑧">ruby-merge: merge</a> with center alignment</figcaption>
     </figure>
     <div class="example" id="example-eeb77956">
      <a class="self-link" href="#example-eeb77956"></a> The following two lines render the same
				if both characters fit on one line: 
<pre class="highlight"><c- p>&lt;</c-><c- f>p</c-><c- p>>&lt;</c-><c- f>ruby</c-><c- p>></c->無常<c- p>&lt;</c-><c- f>rt</c-><c- p>></c->むじょう<c- p>&lt;/</c-><c- f>ruby</c-><c- p>></c->
<c- p>&lt;</c-><c- f>p</c-><c- p>>&lt;</c-><c- f>ruby</c-> <c- e>style</c-><c- o>=</c-><c- s>"ruby-merge:merge"</c-><c- p>>&lt;</c-><c- f>rb</c-><c- p>></c->無<c- p>&lt;</c-><c- f>rb</c-><c- p>></c->常<c- p>&lt;</c-><c- f>rt</c-><c- p>></c->む<c- p>&lt;</c-><c- f>rt</c-><c- p>></c->じょう<c- p>&lt;/</c-><c- f>ruby</c-><c- p>></c-></pre>
      <p>However, the second one renders the same as <a class="css" data-link-type="propdesc" href="#propdef-ruby-position" id="ref-for-propdef-ruby-position④">ruby-position: separate</a> when the two bases are split across lines.</p>
     </div>
    <dt><dfn class="dfn-paneled css" data-dfn-for="ruby-merge" data-dfn-type="value" data-export id="valdef-ruby-merge-auto">auto</dfn>
    <dd>
      The user agent may use any algorithm to determine how each ruby annotation box
			is rendered to its corresponding base box,
			with the intention that if all annotations fit over their respective bases,
			the result is identical to <a class="css" data-link-type="maybe" href="#valdef-ruby-merge-separate" id="ref-for-valdef-ruby-merge-separate②">separate</a>,
			but if some annotations are wider than their bases
			the space is shared in some way
			to avoid imposing space between bases. 
     <figure>
       <img alt="If there is enough space, annotations are aligned to their bases;
				          but if there is not, then annotations can share space with adjacent annotations.
				          Thus the annotations for “上手”　share space over the second base as in the &apos;merge&apos; case,
				          but the annotations for “下手” which are one character each
				          end up rendering as for &apos;separate&apos;." src="images/ruby-jukugo.png"> 
      <figcaption><a class="css" data-link-type="propdesc" href="#propdef-ruby-merge" id="ref-for-propdef-ruby-merge⑨">ruby-merge: auto</a> with center alignment</figcaption>
     </figure>
     <div class="note" role="note">
       Note: This behavior is intended for compound words,
				see <a href="https://www.w3.org/International/questions/qa-ruby#jukugo">“Jukugo Ruby” in “What is ruby?”</a>. <a data-link-type="biblio" href="#biblio-qa-ruby" title="What is ruby?">[QA-RUBY]</a> 
      <p>There are various conventions for rendering this type of ruby,
				see <a href="https://www.w3.org/TR/simple-ruby/#placement-of-jukugo-ruby">Placement of Jukugo-ruby</a> in <a data-link-type="biblio" href="#biblio-simple-ruby" title="Rules for Simple Placement of Japanese Ruby">[SIMPLE-RUBY]</a>, <a href="https://www.w3.org/TR/jlreq/#positioning_of_jukugoruby_with_respect_to_base_characters">Positioning of Jukugo-ruby</a> in <a data-link-type="biblio" href="#biblio-jlreq" title="Requirements for Japanese Text Layout 日本語組版処理の要件(日本語版)">[JLREQ]</a>,
				and <cite>4.12.3(c) 熟語ルビの処理</cite> in <a data-link-type="biblio" href="#biblio-jisx4051" title="Line composition rules for Japanese documents.">[JISX4051]</a> for examples of varying complexity.</p>
      <p>The simplest of these is
				to render as <a class="css" data-link-type="maybe" href="#valdef-ruby-merge-separate" id="ref-for-valdef-ruby-merge-separate③">separate</a> if all ruby annotation boxes fit
				within the advances of their corresponding base boxes,
				and render as <a class="css" data-link-type="maybe" href="#valdef-ruby-merge-merge" id="ref-for-valdef-ruby-merge-merge②">merge</a> otherwise.</p>
     </div>
   </dl>
   <p class="note" role="note"><span class="marker">Note:</span> Text does not shape or form ligatures
	across <a data-link-type="dfn" href="#ruby-annotation-box" id="ref-for-ruby-annotation-box⑨⓪">ruby annotations</a> or <a data-link-type="dfn" href="#ruby-base-box" id="ref-for-ruby-base-box⑦⑦">bases</a>,
	even merged ones,
	due to <a data-link-type="dfn" href="https://w3c.github.io/i18n-glossary/#dfn-bidi-isolation" id="ref-for-dfn-bidi-isolation">bidi isolation</a>.
	See <a href="#bidi">§ 3.5 Bidi Reordering</a> and <a href="https://drafts.csswg.org/css-text-3/#boundary-shaping"><cite>CSS Text 3</cite> § 7.3 Shaping Across Element Boundaries</a>.</p>
   <h3 class="heading settled" data-level="4.3" id="ruby-align-property"><span class="secno">4.3. </span><span class="content"><span id="rubyalign"></span> Ruby Text Distribution: the <a class="property css" data-link-type="property" href="#propdef-ruby-align" id="ref-for-propdef-ruby-align⑧">ruby-align</a> property</span><a class="self-link" href="#ruby-align-property"></a></h3>
   <table class="def propdef" data-link-for-hint="ruby-align">
    <tbody>
     <tr>
      <th>Name:
      <td><dfn class="dfn-paneled css" data-dfn-type="property" data-export id="propdef-ruby-align">ruby-align</dfn>
     <tr class="value">
      <th><a href="https://www.w3.org/TR/css-values/#value-defs">Value:</a>
      <td class="prod">start <a data-link-type="grammar" href="https://drafts.csswg.org/css-values-4/#comb-one" id="ref-for-comb-one⑧">|</a> center <span id="ref-for-comb-one⑨">|</span> space-between <span id="ref-for-comb-one①⓪">|</span> space-around 
     <tr>
      <th><a href="https://www.w3.org/TR/css-cascade/#initial-values">Initial:</a>
      <td>space-around 
     <tr>
      <th><a href="https://www.w3.org/TR/css-cascade/#applies-to">Applies to:</a>
      <td>ruby bases, ruby annotations, ruby base containers, ruby annotation containers 
     <tr>
      <th><a href="https://www.w3.org/TR/css-cascade/#inherited-property">Inherited:</a>
      <td>yes 
     <tr>
      <th><a href="https://www.w3.org/TR/css-values/#percentages">Percentages:</a>
      <td>n/a 
     <tr>
      <th><a href="https://www.w3.org/TR/css-cascade/#computed">Computed value:</a>
      <td>specified keyword 
     <tr>
      <th><a href="https://www.w3.org/TR/cssom/#serializing-css-values">Canonical order:</a>
      <td>per grammar 
     <tr>
      <th><a href="https://www.w3.org/TR/web-animations/#animation-type">Animation type:</a>
      <td>by computed value type 
   </table>
   <p>This property specifies how text is distributed within the various ruby boxes
	when their contents do not exactly fill their respective boxes.
	Note that space distributed by <a class="property css" data-link-type="property" href="#propdef-ruby-align" id="ref-for-propdef-ruby-align⑨">ruby-align</a> is unrelated to, and independent of,
	any space distributed due to justification.</p>
   <p>For <a data-link-type="dfn" href="#ruby-position-inter-character-annotation" id="ref-for-ruby-position-inter-character-annotation①⑧">inter-character</a> annotations,
	this property can also affect the alignment of the box itself
	(see <a href="#inter-character-layout">§ 3.2 Inter-character Ruby Layout</a>).
	It otherwise only affects the alignment of content within the box,
	not the size or position of the box itself.</p>
   <p>Values have the following meanings:</p>
   <dl>
    <dt><dfn class="dfn-paneled css" data-dfn-for="ruby-align" data-dfn-type="value" data-export id="valdef-ruby-align-start">start</dfn>
    <dd>
      The ruby content is aligned with the start edge of its box. 
     <div class="figure">
       <img alt="Diagram of glyph layout in left aligned ruby when ruby text is shorter than base" height="91" src="images/ra-l.gif" width="145"> <img alt="Diagram of glyph layout in left aligned ruby when ruby text is longer than base" height="91" src="images/ra-l-rb.gif" width="145"> 
      <p class="caption"><a class="css" data-link-type="maybe" href="#valdef-ruby-align-start" id="ref-for-valdef-ruby-align-start①">start</a> ruby distribution </p>
     </div>
     <p class="issue" id="issue-41435749"><a class="self-link" href="#issue-41435749"></a> "Katatsuki ruby" (肩付きルビ) is close to,
			but not quite the same as,
			this <a class="css" data-link-type="maybe" href="#valdef-ruby-align-start" id="ref-for-valdef-ruby-align-start②">start</a> value.
			In particular,
			its behavior when overhanging its base
			can differ from start alignment
			depending on surrounding context,
			see <a href="https://www.w3.org/TR/jlreq/#positioning_of_monoruby_with_respect_to_base_characters">JLREQ</a>.
			Also, it’s only ever used in vertical writing,
			and the JLTF considers it not particularly important,
			so it may not be worth the effort to make this value smart enough to deal with katatsuki ruby.
			If <span class="css" id="ref-for-valdef-ruby-align-start③">start</span> is needed for some other purpose,
			we should keep it.
			Otherwise, maybe just drop it?</p>
    <dt><dfn class="dfn-paneled css" data-dfn-for="ruby-align" data-dfn-type="value" data-export id="valdef-ruby-align-center">center</dfn>
    <dd>
     The ruby content is centered within its box. 
     <div class="figure">
       <img alt="Diagram of glyph layout in center aligned ruby when ruby text is shorter than base" height="91" src="images/ra-c.gif" width="145"> <img alt="Diagram of glyph layout in center aligned ruby when ruby text is longer than base" height="91" src="images/ra-c-rb.gif" width="145"> 
      <p class="caption"><a class="css" data-link-type="maybe" href="#valdef-ruby-align-center" id="ref-for-valdef-ruby-align-center">center</a> ruby distribution </p>
     </div>
    <dt><dfn class="dfn-paneled css" data-dfn-for="ruby-align" data-dfn-type="value" data-export id="valdef-ruby-align-space-between">space-between</dfn>
    <dd>
      The ruby content expands as defined for normal text justification
			(as defined by <a class="property css" data-link-type="property" href="https://drafts.csswg.org/css-text-4/#propdef-text-justify" id="ref-for-propdef-text-justify">text-justify</a>),
			except that if there are no <a data-link-type="dfn" href="https://drafts.csswg.org/css-text-4/#justification-opportunity" id="ref-for-justification-opportunity">justification opportunities</a> the content is centered. 
     <div class="figure">
       <img alt="Diagram of glyph layout in distribute-letter aligned ruby when ruby text is shorter than base" height="91" src="images/ra-dl.gif" width="145"> <img alt="Diagram of glyph layout in distribute-letter aligned ruby when ruby text is longer than base" height="91" src="images/ra-dl-rb.gif" width="145"> 
      <p class="caption"><a class="css" data-link-type="maybe" href="#valdef-ruby-align-space-between" id="ref-for-valdef-ruby-align-space-between">space-between</a> ruby distribution </p>
     </div>
    <dt><dfn class="dfn-paneled css" data-dfn-for="ruby-align" data-dfn-type="value" data-export id="valdef-ruby-align-space-around">space-around</dfn>
    <dd>
      As for <a class="css" data-link-type="maybe" href="#valdef-ruby-align-space-between" id="ref-for-valdef-ruby-align-space-between①">space-between</a> except that there exists an extra <a data-link-type="dfn" href="https://drafts.csswg.org/css-text-4/#justification-opportunity" id="ref-for-justification-opportunity①">justification opportunities</a> whose space is distributed half before and half after the ruby content. 
     <div class="figure">
       <img alt="Diagram of glyph layout in auto aligned ruby when ruby text is shorter than base" height="91" src="images/ra-ds.gif" width="145"> <img alt="Diagram of glyph layout in auto aligned ruby when ruby text is longer than base" height="91" src="images/ra-ds-rb.gif" width="145"> 
      <p class="caption"><a class="css" data-link-type="maybe" href="#valdef-ruby-align-space-around" id="ref-for-valdef-ruby-align-space-around">space-around</a> ruby distribution </p>
     </div>
   </dl>
   <div class="example" id="example-d11a9552">
    <a class="self-link" href="#example-d11a9552"></a> Since a typical implementation will by default define <a data-link-type="dfn" href="https://drafts.csswg.org/css-text-4/#justification-opportunity" id="ref-for-justification-opportunity②">justification opportunities</a> between every adjacent pair of CJK <a data-link-type="dfn" href="https://drafts.csswg.org/css-text-3/#character" id="ref-for-character">characters</a> but not between adjacent pairs of Latin <span id="ref-for-character①">characters</span>,
		the <a class="css" data-link-type="maybe" href="#valdef-ruby-align-space-around" id="ref-for-valdef-ruby-align-space-around①">space-around</a> and <a class="css" data-link-type="maybe" href="#valdef-ruby-align-space-between" id="ref-for-valdef-ruby-align-space-between②">space-between</a> values
		will nevertheless result in narrow characters centered: 
    <div class="figure">
      <img alt="Diagram of glyph layout in auto aligned ruby when halfwidth ruby text is shorter than base" height="91" src="images/ra-c-h.gif" width="145"> <img alt="Diagram of character layout in auto aligned ruby when ruby text is longer than narrow-width base" height="91" src="images/ra-c-rb-h.gif" width="145"> 
     <p class="caption">Narrow-width ruby text in <a class="css" data-link-type="maybe" href="#valdef-ruby-align-space-around" id="ref-for-valdef-ruby-align-space-around②">space-around</a> and <a class="css" data-link-type="maybe" href="#valdef-ruby-align-space-between" id="ref-for-valdef-ruby-align-space-between③">space-between</a> ruby distribution are centered </p>
    </div>
    <p>The distribution of space can be further controlled via <a class="property css" data-link-type="property" href="https://drafts.csswg.org/css-text-4/#propdef-text-justify" id="ref-for-propdef-text-justify①">text-justify</a>. <a data-link-type="biblio" href="#biblio-css-text-3" title="CSS Text Module Level 3">[CSS-TEXT-3]</a></p>
   </div>
   <p>Content in <a data-link-type="dfn" href="#ruby-base-box" id="ref-for-ruby-base-box⑦⑧">ruby bases</a> and <a data-link-type="dfn" href="#ruby-annotation-box" id="ref-for-ruby-annotation-box⑨①">ruby annotations</a>,
	except those that span due to <a class="css" data-link-type="propdesc" href="#propdef-ruby-merge" id="ref-for-propdef-ruby-merge①⓪">ruby-merge: merge</a>,
	is aligned within its box based on the value of <a class="property css" data-link-type="property" href="#propdef-ruby-align" id="ref-for-propdef-ruby-align①⓪">ruby-align</a> on that box.
	Content in <a data-link-type="dfn" href="#merged-annotation" id="ref-for-merged-annotation⑤">merged annotations</a> is aligned within the <a data-link-type="dfn" href="#ruby-annotation-container-box" id="ref-for-ruby-annotation-container-box⑤③">ruby annotation container</a> based on the value of <span class="property" id="ref-for-propdef-ruby-align①①">ruby-align</span> on the <span id="ref-for-ruby-annotation-container-box⑤④">annotations container</span>,
	ignoring the value of <span class="property" id="ref-for-propdef-ruby-align①②">ruby-align</span> on the individual <span id="ref-for-ruby-annotation-box⑨②">ruby annotations</span>.</p>
   <p class="issue" id="issue-70e7253c"><a class="self-link" href="#issue-70e7253c"></a> What if a <a data-link-type="dfn" href="#merged-annotation" id="ref-for-merged-annotation⑥">merged annotation</a> causes the <a data-link-type="dfn" href="#ruby-segments" id="ref-for-ruby-segments①⑧">ruby segment</a> to be wider?
	Does it cause each base to grow as if it were spanning them, as currently specified?
	This does not allow e.g. centering the text in a multi-base base container
	when its merged annotation is longer.
	Instead, maybe we should allow ruby-merge to apply to base containers as well,
	but this would require us either to allow a single base to span multiple annotations
	(if the base is merged but some annotation levels are not),
	or to require that if the base is merged, then all annotation levels must be merged as well.</p>
   <p>The way content is aligned when <a class="property css" data-link-type="property" href="#propdef-ruby-merge" id="ref-for-propdef-ruby-merge①①">ruby-merge</a> is <a class="css" data-link-type="maybe" href="#valdef-ruby-merge-auto" id="ref-for-valdef-ruby-merge-auto①">auto</a> is up to the user agent,
	but must be identical to that of <span class="css" id="ref-for-propdef-ruby-merge①②">ruby-merge: separate</span> when all annotations fit over their respective bases.</p>
   <h3 class="heading settled" data-level="4.4" id="ruby-text-decoration"><span class="secno">4.4. </span><span class="content"> Ruby Text Decoration</span><a class="self-link" href="#ruby-text-decoration"></a></h3>
   <p>Text decoration does not propagate from the base text to the annotations.</p>
   <p>When text decoration is specified on an ancestor of the ruby,
	it is drawn across the entire content area of the ruby base container,
	including any extra space added on either side of the ruby base contents to accommodate long annotations.
	When text decoration is specified on a ruby base itself,
	this extra space is not decorated,
	similar to how a box’s own padding is not decorated when text decoration is specified directly on that box. <a data-link-type="biblio" href="#biblio-css3-text-decor" title="CSS Text Decoration Module Level 3">[CSS3-TEXT-DECOR]</a></p>
   <p>Text decoration may be specified directly on ruby base containers
	and ruby annotation containers:
	in such cases it is propagated to all of the container’s bases or annotations (respectively),
	and is also drawn between them for continuity.</p>
   <p>The positions of ruby annotations may be adjusted
	to avoid potential conflicts
	with overline and underline decorations applied to the base text.
	In the basic case of consistent font size and baseline alignment,
	an underline or overline is positioned
	between the <a data-link-type="dfn" href="#base-level" id="ref-for-base-level⑤">base level</a> and any annotations on that side.</p>
   <p class="issue" id="issue-c8497783"><a class="self-link" href="#issue-c8497783"></a> This section needs some clarification about
	drawing decorations between the content of adjacent bases/annotations.
	Depends on if those boxes are as wide as their <a data-link-type="dfn" href="#ruby-columns" id="ref-for-ruby-columns①⑥">column</a> or not.</p>
   <h2 class="heading settled" data-level="5" id="edge-effects"><span class="secno">5. </span><span class="content"> Edge Effects</span><a class="self-link" href="#edge-effects"></a></h2>
   <h3 class="heading settled" data-level="5.1" id="ruby-overhang"><span class="secno">5.1. </span><span class="content"> Overhanging Ruby: the <a class="property css" data-link-type="property" href="#propdef-ruby-overhang" id="ref-for-propdef-ruby-overhang">ruby-overhang</a> property</span><a class="self-link" href="#ruby-overhang"></a></h3>
   <table class="def propdef" data-link-for-hint="ruby-overhang">
    <tbody>
     <tr>
      <th>Name:
      <td><dfn class="dfn-paneled css" data-dfn-type="property" data-export id="propdef-ruby-overhang">ruby-overhang</dfn>
     <tr class="value">
      <th><a href="https://www.w3.org/TR/css-values/#value-defs">Value:</a>
      <td class="prod">auto <a data-link-type="grammar" href="https://drafts.csswg.org/css-values-4/#comb-one" id="ref-for-comb-one①①">|</a> none 
     <tr>
      <th><a href="https://www.w3.org/TR/css-cascade/#initial-values">Initial:</a>
      <td>auto 
     <tr>
      <th><a href="https://www.w3.org/TR/css-cascade/#applies-to">Applies to:</a>
      <td>ruby annotation containers 
     <tr>
      <th><a href="https://www.w3.org/TR/css-cascade/#inherited-property">Inherited:</a>
      <td>yes 
     <tr>
      <th><a href="https://www.w3.org/TR/css-values/#percentages">Percentages:</a>
      <td>n/a 
     <tr>
      <th><a href="https://www.w3.org/TR/css-cascade/#computed">Computed value:</a>
      <td>specified keyword 
     <tr>
      <th><a href="https://www.w3.org/TR/cssom/#serializing-css-values">Canonical order:</a>
      <td>per grammar 
     <tr>
      <th><a href="https://www.w3.org/TR/web-animations/#animation-type">Animation type:</a>
      <td>by computed value type 
   </table>
   <p>The <a class="property css" data-link-type="property" href="#propdef-ruby-overhang" id="ref-for-propdef-ruby-overhang①">ruby-overhang</a> property controls whether <a data-link-type="dfn" href="#ruby-annotation-box" id="ref-for-ruby-annotation-box⑨③">ruby annotations</a> may overlap adjacent text outside the <a data-link-type="dfn" href="#ruby-container" id="ref-for-ruby-container④⓪">ruby container</a>.
	Values have the following meanings:</p>
   <dl>
    <dt><dfn class="dfn-paneled css" data-dfn-for="ruby-overhang" data-dfn-type="value" data-export id="valdef-ruby-overhang-auto">auto</dfn> 
    <dd>
      When a <a data-link-type="dfn" href="#ruby-annotation-container-box" id="ref-for-ruby-annotation-container-box⑤⑤">ruby annotation container</a> is longer than
			its corresponding <a data-link-type="dfn" href="#ruby-base-container-box" id="ref-for-ruby-base-container-box③⑦">ruby base container</a>,
			the <span id="ref-for-ruby-annotation-container-box⑤⑥">ruby annotation container</span> may
			partially overlap adjacent boxes. 
     <p>Whether, how much, and under which conditions to overhang
			are determined by the UA.</p>
    <dt><dfn class="dfn-paneled css" data-dfn-for="ruby-overhang" data-dfn-type="value" data-export id="valdef-ruby-overhang-none">none</dfn> 
    <dd> A <a data-link-type="dfn" href="#ruby-annotation-container-box" id="ref-for-ruby-annotation-container-box⑤⑦">ruby annotation container</a> is never allowed
			to extend past the <span id="ref-for-ruby-annotation-container-box⑤⑧">ruby annotation container</span>. 
   </dl>
   <p>When <a data-link-type="dfn" href="#ruby-annotation-box" id="ref-for-ruby-annotation-box⑨④">ruby annotations</a> are not allowed to overhang,
	the <a data-link-type="dfn" href="#ruby-container" id="ref-for-ruby-container④①">ruby container</a> behaves like a traditional inline box,
	i.e. only its own contents are rendered within its boundaries
	and adjacent elements do not cross the box boundary:</p>
   <div class="figure">
     <img alt="Diagram showing the ruby boxes interacting with adjacent text" src="images/ro-n.gif"> 
    <p class="caption">Simple ruby whose text is not allowed to overhang adjacent text </p>
   </div>
   <p>However, if a <a data-link-type="dfn" href="#ruby-annotation-container-box" id="ref-for-ruby-annotation-container-box⑤⑨">ruby annotation container</a> is allowed to overhang,
	neighbouring content may overlap the <a data-link-type="dfn" href="#ruby-container" id="ref-for-ruby-container④②">ruby container box</a>,
	allowing its <a data-link-type="dfn" href="#ruby-annotation-box" id="ref-for-ruby-annotation-box⑨⑤">ruby annotation</a>(s) to partially render over/under
	surrounding inline-level content.
	Overhang is only allowed to the extent
	that it does not cause collisions between
	the neighboring content
	and the ruby container’s <span id="ref-for-ruby-annotation-box⑨⑥">annotation boxes</span> or its overlapped <a data-link-type="dfn" href="#ruby-base-box" id="ref-for-ruby-base-box⑦⑨">base</a>’s contents.</p>
   <div class="figure">
     <img alt="Diagram showing the ruby boxes interacting with adjacent text" src="images/ro-a.gif"> 
    <p class="caption">Simple ruby whose text is allowed to overhang adjacent text </p>
   </div>
   <p class="note" role="note"><span class="marker">Note:</span> Whether <a data-link-type="dfn" href="#ruby-annotation-box" id="ref-for-ruby-annotation-box⑨⑦">ruby annotations</a> related to a <a data-link-type="dfn" href="#ruby-base-box" id="ref-for-ruby-base-box⑧⓪">ruby base</a> can overhang another <span id="ref-for-ruby-base-box⑧①">ruby base</span> is controlled by <a class="property css" data-link-type="property" href="#propdef-ruby-merge" id="ref-for-propdef-ruby-merge①③">ruby-merge</a>.</p>
   <p>Typically,
	the alignment of the contents of the base or the annotation
	is not affected by overhanging behavior:
	alignment and space distribution (see <a class="property css" data-link-type="property" href="#propdef-ruby-align" id="ref-for-propdef-ruby-align①③">ruby-align</a>)
	is achieved the same way regardless of the overhang allowance,
	and is computed before the space available for overlap is determined.
	However, UAs may consider allowed overhang
	when determining space distribution and/or alignment of annotations and bases.</p>
   <p class="issue" id="issue-adc9f0e4"><a class="self-link" href="#issue-adc9f0e4"></a> I suspect overhanging interacts with alignment in some cases;
	might need to look into this later.</p>
   <div class="example" id="example-a7292220"><a class="self-link" href="#example-a7292220"></a> The user agent may use <a data-link-type="biblio" href="#biblio-jis4051" title="Formatting rules for Japanese documents (『日本語文書の組版方法』).">[JIS4051]</a> recommendation of
		using <a href="https://www.w3.org/TR/css-values-4/#ic"><span class="css">0.5ic</span></a> (half of a full-width character) in the annotation’s font
		as the maximum overhang length.
		Detailed rules for how ruby text can overhang adjacent characters
		for Japanese are described by <a data-link-type="biblio" href="#biblio-jlreq" title="Requirements for Japanese Text Layout 日本語組版処理の要件(日本語版)">[JLREQ]</a>. </div>
   <h3 class="heading settled" data-level="5.2" id="line-edge"><span class="secno">5.2. </span><span class="content"> Line-edge Alignment</span><a class="self-link" href="#line-edge"></a></h3>
   <p>When a <a data-link-type="dfn" href="#ruby-annotation-box" id="ref-for-ruby-annotation-box⑨⑧">ruby annotation box</a> that is longer than its <a data-link-type="dfn" href="#ruby-base-box" id="ref-for-ruby-base-box⑧②">ruby base</a> is at the start or end edge of a line,
	the user agent <em>may</em> force the side of the <span id="ref-for-ruby-annotation-box⑨⑨">ruby annotation</span> that touches the edge of the line
	to align to the corresponding edge of the base.
	This type of alignment is described by <a data-link-type="biblio" href="#biblio-jlreq" title="Requirements for Japanese Text Layout 日本語組版処理の要件(日本語版)">[JLREQ]</a>.</p>
   <p>This level of the specification does not provide a mechanism to control this behavior.</p>
   <div class="figure">
     <img alt="Diagram of glyph layout in line-edge aligned ruby when ruby text is shorter than base" src="images/ra-le-l.gif"> <img alt="Diagram of glyph layout in line-edge aligned ruby when ruby text is longer than base" src="images/ra-le-r.gif"> 
    <p class="caption">Line-edge alignment </p>
   </div>
   <h2 class="no-num heading settled" id="default-stylesheet"><span class="content"> Appendix A: Sample Style Sheets</span><a class="self-link" href="#default-stylesheet"></a></h2>
   <p><em>This section is informative.</em></p>
   <h3 class="no-num heading settled" id="default-ua-ruby"><span class="content"> <span class="secno">A.1</span> Default UA Style Sheet</span><a class="self-link" href="#default-ua-ruby"></a></h3>
   <p>The following represents a default UA style sheet
	for rendering HTML and XHTML ruby markup as ruby layout:</p>
<pre class="highlight">ruby <c- p>{</c-> <c- k>display</c-><c- p>:</c-> ruby<c- p>;</c-> <c- p>}</c->
rp   <c- p>{</c-> <c- k>display</c-><c- p>:</c-> none<c- p>;</c-> <c- p>}</c->
rbc  <c- p>{</c-> <c- k>display</c-><c- p>:</c-> ruby-base-container<c- p>;</c-> <c- p>}</c->
rtc  <c- p>{</c-> <c- k>display</c-><c- p>:</c-> ruby-text-container<c- p>;</c-> <c- p>}</c->
rb   <c- p>{</c-> <c- k>display</c-><c- p>:</c-> ruby-base<c- p>;</c-> <c- k>white-space</c-><c- p>:</c-> nowrap<c- p>;</c-> <c- p>}</c->
rt   <c- p>{</c-> <c- k>display</c-><c- p>:</c-> ruby-text<c- p>;</c-> <c- p>}</c->
ruby<c- p>,</c-> rb<c- p>,</c-> rt<c- p>,</c-> rbc<c- p>,</c-> rtc <c- p>{</c-> <c- k>unicode-bidi</c-><c- p>:</c-> isolate<c- p>;</c-> <c- p>}</c->

rtc<c- p>,</c-> rt <c- p>{</c->
  <c- k>font-variant-east-asian</c-><c- p>:</c-> ruby<c- p>;</c->  <c- c>/* See [[CSS3-FONTS]] */</c->
  text-emphasis: none<c- p>;</c->            <c- c>/* See [[CSS3-TEXT-DECOR]] */</c->
  white-space: nowrap<c- p>;</c->
  <c- k>line-height</c-><c- p>:</c-> <c- m>1</c-><c- p>;</c-> <c- p>}</c->

rtc<c- p>,</c-> <c- nf>:not</c-><c- p>(</c->rtc<c- p>)</c-> > rt <c- p>{</c->
  <c- k>font-size</c-><c- p>:</c-> <c- m>50</c-><c- k>%</c-><c- p>;</c-> <c- p>}</c->
rtc<c- nf>:lang</c-><c- p>(</c->zh-TW<c- p>),</c-> <c- nf>:not</c-><c- p>(</c->rtc<c- p>)</c-> > rt<c- nf>:lang</c-><c- p>(</c->zh-TW<c- p>)</c-> <c- p>{</c->
  <c- k>font-size</c-><c- p>:</c-> <c- m>30</c-><c- k>%</c-><c- p>;</c-> <c- p>}</c->               <c- c>/* bopomofo */</c->
</pre>
   <p class="note" role="note"><span class="marker">Note:</span> Authors should not use the above rules:
	a UA that supports ruby layout should provide these by default.</p>
   <p>UAs implementing a user-controlled “minimum font size” feature
	should consider scaling that minimum down for ruby annotations.</p>
   <h3 class="no-num heading settled" id="default-inline"><span class="content"> <span class="secno">A.2</span> Inlining Ruby Annotations</span><a class="self-link" href="#default-inline"></a></h3>
   <p>The following represents a sample style sheet
	for rendering HTML and XHTML ruby markup as inline annotations:</p>
<pre class="highlight">ruby<c- p>,</c-> rb<c- p>,</c-> rt<c- p>,</c-> rbc<c- p>,</c-> rtc<c- p>,</c-> rp <c- p>{</c->
  <c- k>display</c-><c- p>:</c-> inline<c- p>;</c-> <c- k>white-space</c-><c- p>:</c-> inherit<c- p>;</c->
  <c- k>font</c-><c- p>:</c-> inherit<c- p>;</c-> <c- k>text-emphasis</c-><c- p>:</c-> inherit<c- p>;</c-> <c- p>}</c-></pre>
   <h3 class="no-num heading settled" id="default-parens"><span class="content"> <span class="secno">A.3</span> Generating Parentheses</span><a class="self-link" href="#default-parens"></a></h3>
   <p>Unfortunately, because Selectors cannot match against text nodes,
	it’s not possible with CSS to express rules that will automatically and correctly
	add parentheses to unparenthesized ruby annotations
	for all possible ruby markup patterns in HTML.
	(This is because HTML ruby allows implying the <a data-link-type="dfn" href="#ruby-base-box" id="ref-for-ruby-base-box⑧③">ruby base</a> from raw text
	without a corresponding element.)</p>
   <p>However, these rules will add parentheses around each annotation sequence
	in cases where either <code>&lt;rb></code> or <code>&lt;rtc></code> is used rigorously:</p>
<pre class="highlight"><c- c>/* Parens around &lt;rtc> */</c->
rtc::before <c- p>{</c-> <c- k>content</c-><c- p>:</c-> <c- s>"（"</c-><c- p>;</c-> <c- p>}</c->
rtc::after  <c- p>{</c-> <c- k>content</c-><c- p>:</c-> <c- s>"）"</c-><c- p>;</c-> <c- p>}</c->

<c- c>/* Parens before first &lt;rt> not inside &lt;rtc> */</c->
rb  + rt::before<c- p>,</c->
rtc + rt::before <c- p>{</c-> <c- k>content</c-><c- p>:</c-> <c- s>"（"</c-><c- p>;</c-> <c- p>}</c->

<c- c>/* Parens after &lt;rt> not inside &lt;rtc> */</c->
rb ~ rt:last-child::after<c- p>,</c->
rt + rb::before  <c- p>{</c-> <c- k>content</c-><c- p>:</c-> <c- s>"）"</c-><c- p>;</c-> <c- p>}</c->
rt + rtc::before <c- p>{</c-> <c- k>content</c-><c- p>:</c-> <c- s>"）（"</c-><c- p>;</c-> <c- p>}</c-></pre>
   <p>Alternatively, if it is known that a purely alternating style of markup is used
	(<code class="highlight"><c- p>&lt;</c-><c- f>ruby</c-><c- p>></c->A<c- p>&lt;</c-><c- f>rt</c-><c- p>></c->a<c- p>&lt;/</c-><c- f>rt</c-><c- p>></c->B<c- p>&lt;</c-><c- f>rt</c-><c- p>></c->b<c- p>&lt;/</c-><c- f>rt</c-><c- p>></c->C<c- p>&lt;</c-><c- f>rt</c-><c- p>></c->c<c- p>&lt;/</c-><c- f>rt</c-><c- p>>&lt;</c-><c- f>ruby</c-><c- p>></c-></code>)
	where there are no adjacent ruby annotations,
	the following rules will add parentheses around each annotation:</p>
<pre class="highlight"><c- c>/* Parens around each &lt;rt> */</c->
rt::before <c- p>{</c-> <c- k>content</c-><c- p>:</c-> <c- s>"（"</c-><c- p>;</c-> <c- p>}</c->
rt::after  <c- p>{</c-> <c- k>content</c-><c- p>:</c-> <c- s>"）"</c-><c- p>;</c-> <c- p>}</c->
</pre>
   <h2 class="heading settled" data-level="6" id="glossary"><span class="secno">6. </span><span class="content"> Glossary</span><a class="self-link" href="#glossary"></a></h2>
   <dl>
    <dt id="g-bopomofo"><a class="self-link" href="#g-bopomofo"></a><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="bopomofo">Bopomofo</dfn> or <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="zhuyin-fuhao">Zhuyin Fuhao</dfn> (Chinese: <span lang="zh-Bopo">ㄅㄆㄇㄈ</span>, <span lang="zh-Hant">注音符號</span>, or <span lang="zh-Hans">注音符号</span>) 
    <dd>
     <p>37 characters and 4 tone markings used as phonetics in Chinese,
			especially standard Mandarin.
			These are often, but not exclusively, used for ruby annotations. </p>
     <div class="figure">
       <img alt="Bopomofo characters (in blue) run vertically along the right side of each Hanzi character in the horizontal text." src="images/zhuyin-example.png"> 
      <p class="caption">Example of Bopomofo used as phonetic inter-character annotations in Chinese </p>
     </div>
     <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="bopomofo-tone-marks">Bopomofo tone marks</dfn> are spacing characters that occur
			(in memory)
			at the end of each bopomofo syllable.
			They are typically displayed in a separate track
			to the right of or above the other bopomofo characters,
			and the position of the tone mark depends
			on the number of characters in the syllable.
			The neutral tone mark, however,
			is placed before (and in line with) the bopomofo, not alongside it.</p>
     <p class="note" role="note"><span class="marker">Note:</span> The user agent and font subsystem are responsible for
			ensuring the correct relative alignment and positioning of glyphs,
			including <a data-link-type="dfn" href="#bopomofo-tone-marks" id="ref-for-bopomofo-tone-marks">bopomofo tone marks</a>, when displaying text—​whether the text occurs in ruby annotations or as normal inline content.
			Such glyph placement is not a function of CSS ruby layout.</p>
    <dt id="g-hanja"><a class="self-link" href="#g-hanja"></a>Hanja (Korean: <span lang="ko">漢字</span>) 
    <dd> Subset of the Korean writing system that utilizes ideographic
			characters borrowed or adapted from the Chinese writing system.
			Also see <a href="#g-kanji">Kanji</a>. 
    <dt id="g-hiragana"><a class="self-link" href="#g-hiragana"></a>Hiragana (Japanese: <span lang="ja">平仮名</span>) 
    <dd> Japanese syllabic script, or character of that script.
			Rounded and cursive in appearance.
			Subset of the Japanese writing system,
			used together with kanji and katakana.
			In recent times,
			mostly used to write Japanese words
			when kanji are not available or appropriate,
			and word endings and particles.
			Also see <a href="#g-katakana">Katakana</a>. 
    <dt id="g-ideogram"><a class="self-link" href="#g-ideogram"></a>Ideograph 
    <dd> A character that is used to represent an idea, word, or word component,
			in contrast to a character from an alphabetic or syllabic script.
			The most well-known ideographic script is used (with some variation)
			in East Asia (China, Japan, Korea,...). 
    <dt id="g-kana"><a class="self-link" href="#g-kana"></a>Kana (Japanese: <span lang="ja">仮名</span>) 
    <dd> Collective term for hiragana and katakana. 
    <dt id="g-kanji"><a class="self-link" href="#g-kanji"></a>Kanji (Japanese: <span lang="ja">漢字</span>) 
    <dd> Japanese term for ideographs; ideographs used in Japanese.
			Subset of the Japanese writing system,
			used together with hiragana and katakana.
			Also see <a href="#g-hanja">Hanja</a>. 
    <dt id="g-katakana"><a class="self-link" href="#g-katakana"></a>Katakana (Japanese: <span lang="ja">片仮名</span>) 
    <dd> Japanese syllabic script, or character of that script.
			Angular in appearance.
			Subset of the Japanese writing system,
			used together with kanji and hiragana.
			In recent times, mainly used to write foreign words.
			Also see <a href="#g-hiragana">Hiragana</a>. 
   </dl>
   <h2 class="no-num heading settled" id="acknowledgments"><span class="content"> Acknowledgments</span><a class="self-link" href="#acknowledgments"></a></h2>
   <p>This specification would not have been possible without the help from:</p>
   <p>David Baron,
	Robin Berjon,
	Susanna Bowen,
	Stephen Deach,
	Martin Dürst,
	Hideki Hiura (<span lang="ja">樋浦 秀樹</span>),
	Masayasu Ishikawa (<span lang="ja">石川雅康</span>),
	Taichi Kawabata,
	Chris Pratley,
	Xidorn Quan,
	Takao Suzuki (<span lang="ja">鈴木 孝雄</span>),
	Frank Yung-Fong Tang,
	Chris Thrasher,
	Masafumi Yabe (<span lang="ja">家辺勝文</span>),
	Boris Zbarsky,
	Steve Zilles.</p>
   <p>Special thanks goes to the previous editors:
	Michel Suignard and Marcin Sawicki of Microsoft,
	and Richard Ishida of W3C.</p>
   <h2 class="no-num heading settled" id="changes"><span class="content"> Changes</span><a class="self-link" href="#changes"></a></h2>
   <p>This section documents the changes since previous publications.</p>
   <h3 class="heading settled" id="changes-20200429"><span class="content"> Changes since the 29 April 2020 WD</span><a class="self-link" href="#changes-20200429"></a></h3>
   <ul>
    <li>Added <a class="css" data-link-type="maybe" href="#valdef-ruby-position-alternate" id="ref-for-valdef-ruby-position-alternate④">alternate</a> keyword to <a class="property css" data-link-type="property" href="#propdef-ruby-position" id="ref-for-propdef-ruby-position⑤">ruby-position</a> and made it the <a data-link-type="dfn" href="https://drafts.csswg.org/css-cascade-5/#initial-value" id="ref-for-initial-value">initial value</a>. 
    <li>Renamed <span class="css">collapse</span> value of <a class="property css" data-link-type="property" href="#propdef-ruby-merge" id="ref-for-propdef-ruby-merge①④">ruby-merge</a> to <a class="css" data-link-type="maybe" href="#valdef-ruby-merge-merge" id="ref-for-valdef-ruby-merge-merge③">merge</a>.
			(<a href="https://github.com/w3c/csswg-drafts/issues/5004">Issue 5004</a>) 
    <li>Defined <a class="css" data-link-type="propdesc" href="https://drafts.csswg.org/css-display-4/#propdef-visibility" id="ref-for-propdef-visibility⑧">visibility: collapse</a> to explicitly <a data-link-type="dfn" href="#hidden-annotation" id="ref-for-hidden-annotation⑨">hide</a> an annotation
			the same way <a data-link-type="dfn" href="#auto-hidden" id="ref-for-auto-hidden②">auto-hidden</a> annotations are hidden.
			(<a href="https://github.com/w3c/csswg-drafts/issues/5927">Issue 5927</a>) 
    <li>Specified more precisely which properties apply to the various ruby display types
			(<a href="#box-style">§ 3.3 Styling Ruby Boxes</a>)
			and defined ruby, ruby base, and ruby annotation boxes
			to behave the same as regular <a data-link-type="dfn" href="https://drafts.csswg.org/css-display-4/#inline-box" id="ref-for-inline-box①②">inline boxes</a> except as otherwise specified.
			(<a href="https://github.com/w3c/csswg-drafts/issues/4935">Issue 4935</a>, <a href="https://github.com/w3c/csswg-drafts/issues/4936">Issue 4936</a>, <a href="https://github.com/w3c/csswg-drafts/issues/4976">Issue 4976</a>, <a href="https://github.com/w3c/csswg-drafts/issues/4979">Issue 4979</a>) 
    <li>Substantially revamped <a href="#ruby-layout">§ 3 Ruby Layout</a> to more clearly define <a data-link-type="dfn" href="#interlinear-annotations" id="ref-for-interlinear-annotations⑨">interlinear</a> and <a data-link-type="dfn" href="#ruby-position-inter-character-annotation" id="ref-for-ruby-position-inter-character-annotation①⑨">inter-character</a> ruby layout
			and their interaction with <a class="property css" data-link-type="property" href="#propdef-ruby-align" id="ref-for-propdef-ruby-align①④">ruby-align</a>. <span id="ref-for-ruby-position-inter-character-annotation②⓪">Inter-character</span> ruby is now based on <a data-link-type="dfn" href="https://drafts.csswg.org/css-display-4/#inline-block" id="ref-for-inline-block①">inline block</a> layout,
			and its interaction with <span id="ref-for-interlinear-annotations①⓪">interlinear</span> ruby
			is also now well-defined.
			Inline-axis space distribution for <span id="ref-for-interlinear-annotations①①">interlinear</span> ruby
			is now more precisely defined for spanning annotations
			(modeled on <a class="css" data-link-type="maybe" href="https://drafts.csswg.org/css-grid-2/#valdef-grid-template-columns-max-content" id="ref-for-valdef-grid-template-columns-max-content">max-content</a> grid tracks). 
    <li>Defined handling of nested ruby
			by accounting for their base and annotation containers
			in the block-axis sizing of <a data-link-type="dfn" href="#interlinear-annotations" id="ref-for-interlinear-annotations①②">interlinear</a> ruby.
			(<a href="https://github.com/w3c/csswg-drafts/issues/4986">Issue 4986</a>, <a href="https://github.com/w3c/csswg-drafts/issues/4980">Issue 4980</a>) 
    <li>Specified more precisely how <a class="property css" data-link-type="property" href="#propdef-ruby-align" id="ref-for-propdef-ruby-align①⑤">ruby-align</a> works. 
    <li>Loosened requirement that ruby overhang not affect the alignment of ruby contents,
			added requirement that it not cause ruby content to collide with adjacent content. 
    <li>Clarified interaction of bidi reordering and <a data-link-type="dfn" href="#merged-annotation" id="ref-for-merged-annotation⑦">merged annotations</a>.
			(<a href="#bidi">§ 3.5 Bidi Reordering</a>) 
    <li>Tightened up normative prose throughout. 
    <li>Improved <a href="#intro">introduction</a>, examples, and other informative text. 
   </ul>
   <p class="note" role="note"><span class="marker">Note:</span> There remain many open issues, see <a href="https://drafts.csswg.org/css-ruby-1/issues-wd-2020">Disposition of Comments</a> and the <a href="https://github.com/w3c/csswg-drafts/issues?q=is%3Aissue+label%3Acss-ruby-1">newer issues</a> tracked in GitHub.</p>
   <h3 class="heading settled" id="changes-20140805"><span class="content"> Changes since the 5 August 2014 WD</span><a class="self-link" href="#changes-20140805"></a></h3>
   <ul>
    <li>Add back <a class="css" data-link-type="propdesc" href="#propdef-ruby-overhang" id="ref-for-propdef-ruby-overhang②">ruby-overhang: auto | none</a> for basic control over ruby overhang behavior. 
    <li>Harmonize inlinification with the <a href="https://www.w3.org/TR/css-display-3/">CSS Display Module</a>. 
    <li>Allow UA to shift ruby/emphasis marks if they conflict with underlines/overlines. 
    <li>Disable auto-hiding when the computed value of <a class="property css" data-link-type="property" href="#propdef-ruby-merge" id="ref-for-propdef-ruby-merge①⑤">ruby-merge</a> is <code>collapse</code>. 
    <li>Tweak the <a href="#default-stylesheet">default style sheet</a>. 
    <li>Add section defining interaction with <a href="#ruby-text-decoration">text decoration</a>. 
    <li>Defer the <span class="css">right</span> and <span class="css">left</span> values of <a class="property css" data-link-type="property" href="#propdef-ruby-position" id="ref-for-propdef-ruby-position⑥">ruby-position</a> to the next level. 
    <li>Change ruby <a data-link-type="dfn" href="#pairing" id="ref-for-pairing⑦">pairing</a> rules to only apply spanning on anonymous annotations (i.e. content directly contained by an <code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/obsolete.html#rtc" id="ref-for-rtc">rtc</a></code>). 
    <li>Pair excess bases / annotations with auto-generated empty anonymous bases / annotations. 
    <li> Apply <a class="property css" data-link-type="property" href="#propdef-ruby-position" id="ref-for-propdef-ruby-position⑦">ruby-position</a> to <a class="css" data-link-type="maybe" href="https://drafts.csswg.org/css-pseudo-4/#selectordef-first-line" id="ref-for-selectordef-first-line②">::first-line</a>.
			(<a href="https://github.com/w3c/csswg-drafts/issues/2998">Issue 2998</a>) 
    <li>Clarify containing block of ruby boxes and contents is, as in the case of other inline boxes, the nearest block container. 
    <li>Clarify handling of misparented internal table elements. 
    <li>Trim leading/trailing white space in ruby containers, base base containers, and annotation containers to prevent it from interfering with pairing. 
    <li>Define layout effect of empty base and annotation containers. 
    <li>Disable margins, padding, and borders on ruby base containers and ruby annotation containers (but not on ruby bases and ruby annotations). 
   </ul>
   <h3 class="heading settled" id="changes-20130919"><span class="content"> Changes since the 19 September 2013 WD</span><a class="self-link" href="#changes-20130919"></a></h3>
   <ul>
    <li> Rewrite anonymous box generation rules and white space handling rules,
			defined specialized <a data-link-type="dfn" href="#pairing" id="ref-for-pairing⑧">pairing</a> of anonymous white space boxes. 
    <li> Take nested ruby handling out of <a data-link-type="dfn" href="#pairing" id="ref-for-pairing⑨">pairing</a>.
			(Will be handling it via sizing/layout.) 
    <li> Define bidi layout of ruby structures. 
   </ul>
   <h3 class="heading settled" id="changes-20110630"><span class="content"> Changes since the 30 June 2011 WD</span><a class="self-link" href="#changes-20110630"></a></h3>
   <dl>
    <dt>Remove <code>ruby-span</code> and mentions of <code>rbspan</code>. 
    <dd> Explicit spanning is not used in HTML ruby in favor of implicit spanning.
			This can’t handle some pathological double-sided spanning cases,
			but there seems to be no requirement for these at the moment.
			(For implementations that support full complex XHTML Ruby,
			they can imply spanning from the markup the same magic way
			that we handle cell spanning from tables.
			It doesn’t seem necessary to include controls this in Level 1.) 
    <dt>Defer <code>ruby-overhang</code> and <code>ruby-align: line-end</code> to Level 2. 
    <dd> It’s somewhat complicated, advanced feature.
			Proposal is to make this behavior UA-defined and provide some examples of acceptable options. 
    <dt>Close issue requesting <code>display: rp</code>: use <code>display: none</code>. 
    <dd> The Internationalization WG added an issue
			requesting a display value for <code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/text-level-semantics.html#the-rp-element" id="ref-for-the-rp-element">rp</a></code> elements.
			They’re supposed to be hidden when <code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/text-level-semantics.html#the-ruby-element" id="ref-for-the-ruby-element">ruby</a></code> is displayed as ruby.
			But this is easily accomplished already with <code>display: none</code>. 
    <dt>Change <a class="property css" data-link-type="property" href="#propdef-ruby-position" id="ref-for-propdef-ruby-position⑧">ruby-position</a> values to match <a class="property css" data-link-type="property" href="https://drafts.csswg.org/css-text-decor-4/#propdef-text-emphasis-position" id="ref-for-propdef-text-emphasis-position">text-emphasis-position</a>. 
    <dd> Other than <a class="css" data-link-type="maybe" href="#valdef-ruby-position-inter-character" id="ref-for-valdef-ruby-position-inter-character②">inter-character</a>, which we need to keep,
			it makes more sense to align ruby positions with <a class="property css" data-link-type="property" href="https://drafts.csswg.org/css-text-decor-4/#propdef-text-emphasis-position" id="ref-for-propdef-text-emphasis-position①">text-emphasis-position</a>,
			which can correctly handle various combinations of horizontal/vertical preferences. 
    <dt>Remove unused values of <a class="property css" data-link-type="property" href="#propdef-ruby-align" id="ref-for-propdef-ruby-align①⑥">ruby-align</a>. 
    <dd> <span class="css">left</span>, <span class="css">right</span>, and <span class="css">end</span> are not needed. 
    <dt> Replace <span class="css">auto</span>, <span class="css">distribute-letter</span>, and <span class="css">distribute-space</span> from <a class="property css" data-link-type="property" href="#propdef-ruby-align" id="ref-for-propdef-ruby-align①⑦">ruby-align</a> with <a class="css" data-link-type="maybe" href="#valdef-ruby-align-space-between" id="ref-for-valdef-ruby-align-space-between④">space-between</a> and <a class="css" data-link-type="maybe" href="#valdef-ruby-align-space-around" id="ref-for-valdef-ruby-align-space-around③">space-around</a>. 
    <dd> The <span class="css">auto</span> value relied on inspecting content to determine behavior;
			this can be avoided by just using <a class="css" data-link-type="maybe" href="#valdef-ruby-align-space-around" id="ref-for-valdef-ruby-align-space-around④">space-around</a> with standard justification rules
			(which allow spacing between CJK but not between Latin).
			Replaced <span class="css">distribute-letter</span> and <span class="css">distribute-space</span> with <a class="css" data-link-type="maybe" href="#valdef-ruby-align-space-between" id="ref-for-valdef-ruby-align-space-between⑤">space-between</a> and <span class="css" id="ref-for-valdef-ruby-align-space-around⑤">space-around</span> for consistency with distribution keywords in <a data-link-type="biblio" href="#biblio-css-flexbox-1" title="CSS Flexible Box Layout Module Level 1">[CSS-FLEXBOX-1]</a> and <a data-link-type="biblio" href="#biblio-css-align-3" title="CSS Box Alignment Module Level 3">[CSS-ALIGN-3]</a> and to avoid any links to the definition of <code>text-justify: distribute</code>. 
    <dt>Added <a class="property css" data-link-type="property" href="#propdef-ruby-merge" id="ref-for-propdef-ruby-merge①⑥">ruby-merge</a> property to control jukugo rendering. 
    <dd> This is a stylistic effect, not a structural one;
			the previous model assumed that it was structural
			and suggested handling it by changing markup. :( 
    <dt>Remove <span class="css">inline</span> from <a class="property css" data-link-type="property" href="#propdef-ruby-position" id="ref-for-propdef-ruby-position⑨">ruby-position</a>. 
    <dd> This is do-able via <code>display: inline</code> on all the ruby-related elements,
			see <a href="#default-inline">Appendix A</a>. 
    <dt>Added <a href="#default-stylesheet">Default Style</a> rules 
    <dd>As requested by Internationalization WG. 
    <dt>Wrote anonymous box generation rules 
    <dd> And defined <a data-link-type="dfn" href="#pairing" id="ref-for-pairing①⓪">pairing</a> of bases and annotations.
			Should now handle all the crazy proposed permutations of HTML ruby markup. 
    <dt>Defined layout of ruby 
    <dd> Defined in detail space distribution, white space handling,
			line breaking, line stacking, etc.
			Open issue left for bidi. 
   </dl>
  </main>
  <h2 class="no-ref no-num heading settled" id="w3c-conformance"><span class="content"> Conformance</span><a class="self-link" href="#w3c-conformance"></a></h2>
  <h3 class="no-ref heading settled" id="w3c-conventions"><span class="content"> Document conventions</span><a class="self-link" href="#w3c-conventions"></a></h3>
  <p>Conformance requirements are expressed with a combination of
    descriptive assertions and RFC 2119 terminology. The key words “MUST”,
    “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”,
    “RECOMMENDED”, “MAY”, and “OPTIONAL” in the normative parts of this
    document are to be interpreted as described in RFC 2119.
    However, for readability, these words do not appear in all uppercase
    letters in this specification. </p>
  <p>All of the text of this specification is normative except sections
    explicitly marked as non-normative, examples, and notes. <a data-link-type="biblio" href="#biblio-rfc2119" title="Key words for use in RFCs to Indicate Requirement Levels">[RFC2119]</a></p>
  <p>Examples in this specification are introduced with the words “for example”
    or are set apart from the normative text with <code>class="example"</code>,
    like this: </p>
  <div class="example" id="w3c-example">
   <a class="self-link" href="#w3c-example"></a> 
   <p>This is an example of an informative example.</p>
  </div>
  <p>Informative notes begin with the word “Note” and are set apart from the
    normative text with <code>class="note"</code>, like this: </p>
  <p class="note" role="note">Note, this is an informative note.</p>
  <p>Advisements are normative sections styled to evoke special attention and are
    set apart from other normative text with <code>&lt;strong class="advisement"></code>, like
    this: <strong class="advisement"> UAs MUST provide an accessible alternative. </strong></p>
  <details class="wpt-tests-block" dir="ltr" lang="en" open>
   <summary>Tests</summary>
   <p>Tests relating to the content of this specification
                     may be documented in “Tests” blocks like this one.
                     Any such block is non-normative.</p>
   <ul class="wpt-tests-list"></ul>
   <hr>
  </details>
  <h3 class="no-ref heading settled" id="w3c-conformance-classes"><span class="content"> Conformance classes</span><a class="self-link" href="#w3c-conformance-classes"></a></h3>
  <p>Conformance to this specification
    is defined for three conformance classes: </p>
  <dl>
   <dt>style sheet 
   <dd>A <a href="http://www.w3.org/TR/CSS21/conform.html#style-sheet">CSS
            style sheet</a>. 
   <dt>renderer 
   <dd>A <a href="http://www.w3.org/TR/CSS21/conform.html#user-agent">UA</a> that interprets the semantics of a style sheet and renders
            documents that use them. 
   <dt>authoring tool 
   <dd>A <a href="http://www.w3.org/TR/CSS21/conform.html#user-agent">UA</a> that writes a style sheet. 
  </dl>
  <p>A style sheet is conformant to this specification
    if all of its statements that use syntax defined in this module are valid
    according to the generic CSS grammar and the individual grammars of each
    feature defined in this module. </p>
  <p>A renderer is conformant to this specification
    if, in addition to interpreting the style sheet as defined by the
    appropriate specifications, it supports all the features defined
    by this specification by parsing them correctly
    and rendering the document accordingly. However, the inability of a
    UA to correctly render a document due to limitations of the device
    does not make the UA non-conformant. (For example, a UA is not
    required to render color on a monochrome monitor.) </p>
  <p>An authoring tool is conformant to this specification
    if it writes style sheets that are syntactically correct according to the
    generic CSS grammar and the individual grammars of each feature in
    this module, and meet all other conformance requirements of style sheets
    as described in this module. </p>
  <h3 class="no-ref heading settled" id="w3c-partial"><span class="content"> Partial implementations</span><a class="self-link" href="#w3c-partial"></a></h3>
  <p>So that authors can exploit the forward-compatible parsing rules to
    assign fallback values, CSS renderers <strong>must</strong> treat as invalid (and <a href="http://www.w3.org/TR/CSS21/conform.html#ignore">ignore
    as appropriate</a>) any at-rules, properties, property values, keywords,
    and other syntactic constructs for which they have no usable level of
    support. In particular, user agents <strong>must not</strong> selectively
    ignore unsupported component values and honor supported values in a single
    multi-value property declaration: if any value is considered invalid
    (as unsupported values must be), CSS requires that the entire declaration
    be ignored.</p>
  <h4 class="heading settled" id="w3c-conform-future-proofing"><span class="content"> Implementations of Unstable and Proprietary Features</span><a class="self-link" href="#w3c-conform-future-proofing"></a></h4>
  <p>To avoid clashes with future stable CSS features,
        the CSSWG recommends <a href="http://www.w3.org/TR/CSS/#future-proofing">following best practices</a> for the implementation of <a href="http://www.w3.org/TR/CSS/#unstable">unstable</a> features and <a href="http://www.w3.org/TR/CSS/#proprietary-extension">proprietary extensions</a> to CSS. </p>
  <h3 class="no-ref heading settled" id="w3c-testing"><span class="content"> Non-experimental implementations</span><a class="self-link" href="#w3c-testing"></a></h3>
  <p>Once a specification reaches the Candidate Recommendation stage,
    non-experimental implementations are possible, and implementors should
    release an unprefixed implementation of any CR-level feature they
    can demonstrate to be correctly implemented according to spec. </p>
  <p>To establish and maintain the interoperability of CSS across
    implementations, the CSS Working Group requests that non-experimental
    CSS renderers submit an implementation report (and, if necessary, the
    testcases used for that implementation report) to the W3C before
    releasing an unprefixed implementation of any CSS features. Testcases
    submitted to W3C are subject to review and correction by the CSS
    Working Group. </p>
  <p>Further information on submitting testcases and implementation reports
    can be found from on the CSS Working Group’s website at <a href="http://www.w3.org/Style/CSS/Test/">http://www.w3.org/Style/CSS/Test/</a>.
    Questions should be directed to the <a href="http://lists.w3.org/Archives/Public/public-css-testsuite">public-css-testsuite@w3.org</a> mailing list.</p>
  <script src="https://www.w3.org/scripts/TR/2021/fixup.js"></script>
  <h2 class="no-num no-ref heading settled" id="index"><span class="content">Index</span><a class="self-link" href="#index"></a></h2>
  <h3 class="no-num no-ref heading settled" id="index-defined-here"><span class="content">Terms defined by this specification</span><a class="self-link" href="#index-defined-here"></a></h3>
  <ul class="index">
   <li><a href="#valdef-ruby-position-alternate">alternate</a><span>, in § 4.1</span>
   <li><a href="#ruby-annotation-box">annotation</a><span>, in § 2.1</span>
   <li><a href="#ruby-annotation-box">annotation box</a><span>, in § 2.1</span>
   <li><a href="#ruby-annotation-container-box">annotation container</a><span>, in § 2.1</span>
   <li><a href="#annotation-level">annotation level</a><span>, in § 2.3.1</span>
   <li>
    auto
    <ul>
     <li><a href="#valdef-ruby-merge-auto">value for ruby-merge</a><span>, in § 4.2</span>
     <li><a href="#valdef-ruby-overhang-auto">value for ruby-overhang</a><span>, in § 5.1</span>
    </ul>
   <li><a href="#auto-hidden">auto-hidden</a><span>, in § 2.4</span>
   <li><a href="#auto-hidden">auto-hide</a><span>, in § 2.4</span>
   <li><a href="#ruby-base-box">base</a><span>, in § 2.1</span>
   <li><a href="#ruby-base-box">base box</a><span>, in § 2.1</span>
   <li><a href="#ruby-base-container-box">base container</a><span>, in § 2.1</span>
   <li><a href="#base-level">base level</a><span>, in § 2.3.1</span>
   <li><a href="#base-level">base text level</a><span>, in § 2.3.1</span>
   <li><a href="#bopomofo">Bopomofo</a><span>, in § 6</span>
   <li><a href="#bopomofo-tone-marks">Bopomofo tone marks</a><span>, in § 6</span>
   <li><a href="#valdef-ruby-align-center">center</a><span>, in § 4.3</span>
   <li><a href="#ruby-columns">column</a><span>, in § 2.3</span>
   <li><a href="#hidden-annotation">hidden</a><span>, in § 2.4</span>
   <li><a href="#hidden-annotation">hidden annotation</a><span>, in § 2.4</span>
   <li><a href="#hidden-annotation">hidden ruby annotation</a><span>, in § 2.4</span>
   <li><a href="#hidden-annotation">hide</a><span>, in § 2.4</span>
   <li><a href="#inter-annotation-white-space">inter-annotation white space</a><span>, in § 2.2</span>
   <li><a href="#inter-base-white-space">inter-base white space</a><span>, in § 2.2</span>
   <li>
    inter-character
    <ul>
     <li><a href="#ruby-position-inter-character-annotation">dfn for ruby-position</a><span>, in § 4.1</span>
     <li><a href="#valdef-ruby-position-inter-character">value for ruby-position</a><span>, in § 4.1</span>
    </ul>
   <li><a href="#ruby-position-inter-character-annotation">inter-character annotation</a><span>, in § 4.1</span>
   <li><a href="#inter-level-white-space">inter-level white space</a><span>, in § 2.2</span>
   <li><a href="#interlinear-annotations">interlinear</a><span>, in § 4.1</span>
   <li><a href="#interlinear-annotations">interlinear annotations</a><span>, in § 4.1</span>
   <li><a href="#internal-ruby-boxes">internal ruby boxes</a><span>, in § 2.1.1</span>
   <li><a href="#internal-ruby-boxes">internal ruby display types</a><span>, in § 2.1.1</span>
   <li><a href="#inter-segment-white-space">inter-segment white space</a><span>, in § 2.2</span>
   <li><a href="#intra-level-white-space">intra-level white space</a><span>, in § 2.2</span>
   <li><a href="#intra-ruby-white-space">intra-ruby white space</a><span>, in § 2.2</span>
   <li><a href="#annotation-level">level</a><span>, in § 2.3.1</span>
   <li><a href="#valdef-ruby-merge-merge">merge</a><span>, in § 4.2</span>
   <li><a href="#merged-annotation">merged</a><span>, in § 4.2</span>
   <li><a href="#merged-annotation">merged annotation</a><span>, in § 4.2</span>
   <li><a href="#valdef-ruby-overhang-none">none</a><span>, in § 5.1</span>
   <li><a href="#valdef-ruby-position-over">over</a><span>, in § 4.1</span>
   <li><a href="#pairing">pairing</a><span>, in § 2.3</span>
   <li><a href="#ruby">Ruby</a><span>, in § 1.1</span>
   <li><a href="#valdef-display-ruby">ruby</a><span>, in § 2.1</span>
   <li><a href="#propdef-ruby-align">ruby-align</a><span>, in § 4.3</span>
   <li><a href="#ruby-annotation-box">ruby annotation</a><span>, in § 2.1</span>
   <li><a href="#ruby-annotation-box">ruby annotation box</a><span>, in § 2.1</span>
   <li><a href="#ruby-annotation-container-box">ruby annotation container</a><span>, in § 2.1</span>
   <li><a href="#ruby-annotation-container-box">ruby annotation container box</a><span>, in § 2.1</span>
   <li><a href="#ruby-base-box">ruby base</a><span>, in § 2.1</span>
   <li><a href="#valdef-display-ruby-base">ruby-base</a><span>, in § 2.1</span>
   <li><a href="#ruby-base-box">ruby base box</a><span>, in § 2.1</span>
   <li><a href="#ruby-base-container-box">ruby base container</a><span>, in § 2.1</span>
   <li><a href="#valdef-display-ruby-base-container">ruby-base-container</a><span>, in § 2.1</span>
   <li><a href="#ruby-base-container-box">ruby base container box</a><span>, in § 2.1</span>
   <li><a href="#ruby-columns">ruby columns</a><span>, in § 2.3</span>
   <li><a href="#ruby-container">ruby container</a><span>, in § 2.1</span>
   <li><a href="#ruby-container">ruby container box</a><span>, in § 2.1</span>
   <li><a href="#ruby-formatting-context">ruby formatting context</a><span>, in § 2.1.1</span>
   <li><a href="#propdef-ruby-merge">ruby-merge</a><span>, in § 4.2</span>
   <li><a href="#propdef-ruby-overhang">ruby-overhang</a><span>, in § 5.1</span>
   <li><a href="#propdef-ruby-position">ruby-position</a><span>, in § 4.1</span>
   <li><a href="#ruby-segments">ruby segments</a><span>, in § 2.3.1</span>
   <li><a href="#valdef-display-ruby-text">ruby-text</a><span>, in § 2.1</span>
   <li><a href="#valdef-display-ruby-text-container">ruby-text-container</a><span>, in § 2.1</span>
   <li><a href="#valdef-ruby-merge-separate">separate</a><span>, in § 4.2</span>
   <li><a href="#valdef-ruby-align-space-around">space-around</a><span>, in § 4.3</span>
   <li><a href="#valdef-ruby-align-space-between">space-between</a><span>, in § 4.3</span>
   <li><a href="#span">span</a><span>, in § 2.3</span>
   <li><a href="#spanning-annotation">spanning annotation</a><span>, in § 2.3</span>
   <li><a href="#valdef-ruby-align-start">start</a><span>, in § 4.3</span>
   <li><a href="#valdef-ruby-position-under">under</a><span>, in § 4.1</span>
   <li><a href="#zhuyin-fuhao">Zhuyin Fuhao</a><span>, in § 6</span>
  </ul>
  <h3 class="no-num no-ref heading settled" id="index-defined-elsewhere"><span class="content">Terms defined by reference</span><a class="self-link" href="#index-defined-elsewhere"></a></h3>
  <ul class="index">
   <li>
    <a data-link-type="biblio">[CSS-BOX-4]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="6b6458ae">border</span>
     <li><span class="dfn-paneled" id="40873652">content area</span>
     <li><span class="dfn-paneled" id="46c6a718">content box</span>
     <li><span class="dfn-paneled" id="54aa64f0">margin</span>
     <li><span class="dfn-paneled" id="154375a0">margin box</span>
     <li><span class="dfn-paneled" id="b5418f3e">padding</span>
    </ul>
   <li>
    <a data-link-type="biblio">[CSS-CASCADE-5]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="9cd25054">computed value</span>
     <li><span class="dfn-paneled" id="9ea6bed2">initial value</span>
    </ul>
   <li>
    <a data-link-type="biblio">[CSS-DISPLAY-4]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="a18c5781">atomic inline</span>
     <li><span class="dfn-paneled" id="bb886fc6">block</span>
     <li><span class="dfn-paneled" id="9f3d4f17">block container</span>
     <li><span class="dfn-paneled" id="b6ed01f0">collapse</span>
     <li><span class="dfn-paneled" id="ea663a43">containing block</span>
     <li><span class="dfn-paneled" id="e7f0dd6c">display</span>
     <li><span class="dfn-paneled" id="0bc73d68">formatting context</span>
     <li><span class="dfn-paneled" id="99cabd32">in-flow</span>
     <li><span class="dfn-paneled" id="8141cabb">independent formatting context</span>
     <li><span class="dfn-paneled" id="c02f5d57">inline</span>
     <li><span class="dfn-paneled" id="fc6c8cc8">inline block</span>
     <li><span class="dfn-paneled" id="083ffe5f">inline box</span>
     <li><span class="dfn-paneled" id="b8f126f1">inline formatting context</span>
     <li><span class="dfn-paneled" id="e33664cd">inline-block</span>
     <li><span class="dfn-paneled" id="d7fa3e1c">inline-level</span>
     <li><span class="dfn-paneled" id="e77a37fc">inline-level content</span>
     <li><span class="dfn-paneled" id="f27b1fe0">inlinify</span>
     <li><span class="dfn-paneled" id="5e3e8101">inner display type</span>
     <li><span class="dfn-paneled" id="6d0d9897">internal table element</span>
     <li><span class="dfn-paneled" id="8285a4c4">outer display type</span>
     <li><span class="dfn-paneled" id="12f8fb07">visibility</span>
    </ul>
   <li>
    <a data-link-type="biblio">[CSS-GRID-2]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="b34fe2d9">max-content</span>
    </ul>
   <li>
    <a data-link-type="biblio">[CSS-INLINE-3]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="a76cd631">bottom</span>
     <li><span class="dfn-paneled" id="e34548f4">line box</span>
     <li><span class="dfn-paneled" id="4e683851">line-relative shift values</span>
     <li><span class="dfn-paneled" id="5e077028">top</span>
     <li><span class="dfn-paneled" id="e0b6ed58">vertical-align</span>
    </ul>
   <li>
    <a data-link-type="biblio">[CSS-PSEUDO-4]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="a1addf6c">::first-letter</span>
     <li><span class="dfn-paneled" id="75bfa627">::first-line</span>
    </ul>
   <li>
    <a data-link-type="biblio">[CSS-SIZING-3]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="b713cb30">automatic size</span>
    </ul>
   <li>
    <a data-link-type="biblio">[CSS-TABLES-3]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="994d0e36">table wrapper box</span>
    </ul>
   <li>
    <a data-link-type="biblio">[CSS-TEXT-3]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="0eb9789d">character</span>
    </ul>
   <li>
    <a data-link-type="biblio">[CSS-TEXT-4]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="a7adab2e">collapsible white space</span>
     <li><span class="dfn-paneled" id="c337c02f">justification opportunity</span>
     <li><span class="dfn-paneled" id="938d167b">keep-all</span>
     <li><span class="dfn-paneled" id="e6485f45">segment break</span>
     <li><span class="dfn-paneled" id="0e74a72c">soft wrap opportunity</span>
     <li><span class="dfn-paneled" id="b5c7915a">text-justify</span>
     <li><span class="dfn-paneled" id="cbc54f93">text-transform</span>
     <li><span class="dfn-paneled" id="09e0ad83">white space</span>
     <li><span class="dfn-paneled" id="6501e5b3">white-space</span>
     <li><span class="dfn-paneled" id="22bdf867">word-break</span>
    </ul>
   <li>
    <a data-link-type="biblio">[CSS-TEXT-DECOR-4]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="19119b4f">text-emphasis-position</span>
    </ul>
   <li>
    <a data-link-type="biblio">[CSS-VALUES-4]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="358fd6ff">CSS-wide keywords</span>
     <li><span class="dfn-paneled" id="6ec67710">|</span>
     <li><span class="dfn-paneled" id="8a82fda1">||</span>
    </ul>
   <li>
    <a data-link-type="biblio">[CSS-WRITING-MODES-4]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="12944ef3">bidi-override</span>
     <li><span class="dfn-paneled" id="8c122687">embed</span>
     <li><span class="dfn-paneled" id="933fdf29">horizontal writing mode</span>
     <li><span class="dfn-paneled" id="887c0c5c">inline base direction</span>
     <li><span class="dfn-paneled" id="83316a9a">isolate</span>
     <li><span class="dfn-paneled" id="c2e2c5d1">isolate-override</span>
     <li><span class="dfn-paneled" id="4dd1920b">line-over</span>
     <li><span class="dfn-paneled" id="80cc929e">line-under</span>
     <li><span class="dfn-paneled" id="13518d87">normal</span>
     <li><span class="dfn-paneled" id="09e4de67">vertical writing mode</span>
     <li><span class="dfn-paneled" id="16b64b43">vertical-rl</span>
     <li><span class="dfn-paneled" id="a73617e0">writing mode</span>
     <li><span class="dfn-paneled" id="385326d7">writing-mode</span>
    </ul>
   <li>
    <a data-link-type="biblio">[CSS22]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="ac54fbff">line-height</span>
    </ul>
   <li>
    <a data-link-type="biblio">[CSS3-WRITING-MODES]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="5bc8bd12">direction</span>
     <li><span class="dfn-paneled" id="982e17a3">unicode-bidi</span>
    </ul>
   <li>
    <a data-link-type="biblio">[HTML]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="5c5d00da">rp</span>
     <li><span class="dfn-paneled" id="0eae20f4">rtc</span>
     <li><span class="dfn-paneled" id="bda23a47">ruby</span>
    </ul>
   <li>
    <a data-link-type="biblio">[I18N-GLOSSARY]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="2ba936be">bidi isolation</span>
    </ul>
  </ul>
  <h2 class="no-num no-ref heading settled" id="references"><span class="content">References</span><a class="self-link" href="#references"></a></h2>
  <h3 class="no-num no-ref heading settled" id="normative"><span class="content">Normative References</span><a class="self-link" href="#normative"></a></h3>
  <dl>
   <dt id="biblio-css-box-4">[CSS-BOX-4]
   <dd>Elika Etemad. <a href="https://drafts.csswg.org/css-box-4/"><cite>CSS Box Model Module Level 4</cite></a>. URL: <a href="https://drafts.csswg.org/css-box-4/">https://drafts.csswg.org/css-box-4/</a>
   <dt id="biblio-css-cascade-5">[CSS-CASCADE-5]
   <dd>Elika Etemad; Miriam Suzanne; Tab Atkins Jr.. <a href="https://drafts.csswg.org/css-cascade-5/"><cite>CSS Cascading and Inheritance Level 5</cite></a>. URL: <a href="https://drafts.csswg.org/css-cascade-5/">https://drafts.csswg.org/css-cascade-5/</a>
   <dt id="biblio-css-display-3">[CSS-DISPLAY-3]
   <dd>Elika Etemad; Tab Atkins Jr.. <a href="https://drafts.csswg.org/css-display/"><cite>CSS Display Module Level 3</cite></a>. URL: <a href="https://drafts.csswg.org/css-display/">https://drafts.csswg.org/css-display/</a>
   <dt id="biblio-css-display-4">[CSS-DISPLAY-4]
   <dd><a href="https://drafts.csswg.org/css-display-4/"><cite>CSS Display Module Level 4</cite></a>. Editor's Draft. URL: <a href="https://drafts.csswg.org/css-display-4/">https://drafts.csswg.org/css-display-4/</a>
   <dt id="biblio-css-grid-2">[CSS-GRID-2]
   <dd>Tab Atkins Jr.; Elika Etemad; Rossen Atanassov. <a href="https://drafts.csswg.org/css-grid-2/"><cite>CSS Grid Layout Module Level 2</cite></a>. URL: <a href="https://drafts.csswg.org/css-grid-2/">https://drafts.csswg.org/css-grid-2/</a>
   <dt id="biblio-css-inline-3">[CSS-INLINE-3]
   <dd>Elika Etemad. <a href="https://drafts.csswg.org/css-inline-3/"><cite>CSS Inline Layout Module Level 3</cite></a>. URL: <a href="https://drafts.csswg.org/css-inline-3/">https://drafts.csswg.org/css-inline-3/</a>
   <dt id="biblio-css-pseudo-4">[CSS-PSEUDO-4]
   <dd>Daniel Glazman; Elika Etemad; Alan Stearns. <a href="https://drafts.csswg.org/css-pseudo-4/"><cite>CSS Pseudo-Elements Module Level 4</cite></a>. URL: <a href="https://drafts.csswg.org/css-pseudo-4/">https://drafts.csswg.org/css-pseudo-4/</a>
   <dt id="biblio-css-sizing-3">[CSS-SIZING-3]
   <dd>Tab Atkins Jr.; Elika Etemad. <a href="https://drafts.csswg.org/css-sizing-3/"><cite>CSS Box Sizing Module Level 3</cite></a>. URL: <a href="https://drafts.csswg.org/css-sizing-3/">https://drafts.csswg.org/css-sizing-3/</a>
   <dt id="biblio-css-tables-3">[CSS-TABLES-3]
   <dd>François Remy; Greg Whitworth; David Baron. <a href="https://drafts.csswg.org/css-tables-3/"><cite>CSS Table Module Level 3</cite></a>. URL: <a href="https://drafts.csswg.org/css-tables-3/">https://drafts.csswg.org/css-tables-3/</a>
   <dt id="biblio-css-text-3">[CSS-TEXT-3]
   <dd>Elika Etemad; Koji Ishii; Florian Rivoal. <a href="https://drafts.csswg.org/css-text-3/"><cite>CSS Text Module Level 3</cite></a>. URL: <a href="https://drafts.csswg.org/css-text-3/">https://drafts.csswg.org/css-text-3/</a>
   <dt id="biblio-css-text-4">[CSS-TEXT-4]
   <dd>Elika Etemad; et al. <a href="https://drafts.csswg.org/css-text-4/"><cite>CSS Text Module Level 4</cite></a>. URL: <a href="https://drafts.csswg.org/css-text-4/">https://drafts.csswg.org/css-text-4/</a>
   <dt id="biblio-css-text-decor-4">[CSS-TEXT-DECOR-4]
   <dd>Elika Etemad; Koji Ishii. <a href="https://drafts.csswg.org/css-text-decor-4/"><cite>CSS Text Decoration Module Level 4</cite></a>. URL: <a href="https://drafts.csswg.org/css-text-decor-4/">https://drafts.csswg.org/css-text-decor-4/</a>
   <dt id="biblio-css-values-3">[CSS-VALUES-3]
   <dd>Tab Atkins Jr.; Elika Etemad. <a href="https://drafts.csswg.org/css-values-3/"><cite>CSS Values and Units Module Level 3</cite></a>. URL: <a href="https://drafts.csswg.org/css-values-3/">https://drafts.csswg.org/css-values-3/</a>
   <dt id="biblio-css-values-4">[CSS-VALUES-4]
   <dd>Tab Atkins Jr.; Elika Etemad. <a href="https://drafts.csswg.org/css-values-4/"><cite>CSS Values and Units Module Level 4</cite></a>. URL: <a href="https://drafts.csswg.org/css-values-4/">https://drafts.csswg.org/css-values-4/</a>
   <dt id="biblio-css-writing-modes-4">[CSS-WRITING-MODES-4]
   <dd>Elika Etemad; Koji Ishii. <a href="https://drafts.csswg.org/css-writing-modes-4/"><cite>CSS Writing Modes Level 4</cite></a>. URL: <a href="https://drafts.csswg.org/css-writing-modes-4/">https://drafts.csswg.org/css-writing-modes-4/</a>
   <dt id="biblio-css2">[CSS2]
   <dd>Bert Bos; et al. <a href="https://drafts.csswg.org/css2/"><cite>Cascading Style Sheets Level 2 Revision 1 (CSS 2.1) Specification</cite></a>. URL: <a href="https://drafts.csswg.org/css2/">https://drafts.csswg.org/css2/</a>
   <dt id="biblio-css22">[CSS22]
   <dd>Bert Bos. <a href="https://drafts.csswg.org/css2/"><cite>Cascading Style Sheets Level 2 Revision 2 (CSS 2.2) Specification</cite></a>. URL: <a href="https://drafts.csswg.org/css2/">https://drafts.csswg.org/css2/</a>
   <dt id="biblio-css3-text-decor">[CSS3-TEXT-DECOR]
   <dd>Elika Etemad; Koji Ishii. <a href="https://drafts.csswg.org/css-text-decor-3/"><cite>CSS Text Decoration Module Level 3</cite></a>. URL: <a href="https://drafts.csswg.org/css-text-decor-3/">https://drafts.csswg.org/css-text-decor-3/</a>
   <dt id="biblio-css3-writing-modes">[CSS3-WRITING-MODES]
   <dd>Elika Etemad; Koji Ishii. <a href="https://drafts.csswg.org/css-writing-modes-3/"><cite>CSS Writing Modes Level 3</cite></a>. URL: <a href="https://drafts.csswg.org/css-writing-modes-3/">https://drafts.csswg.org/css-writing-modes-3/</a>
   <dt id="biblio-html">[HTML]
   <dd>Anne van Kesteren; et al. <a href="https://html.spec.whatwg.org/multipage/"><cite>HTML Standard</cite></a>. Living Standard. URL: <a href="https://html.spec.whatwg.org/multipage/">https://html.spec.whatwg.org/multipage/</a>
   <dt id="biblio-rfc2119">[RFC2119]
   <dd>S. Bradner. <a href="https://datatracker.ietf.org/doc/html/rfc2119"><cite>Key words for use in RFCs to Indicate Requirement Levels</cite></a>. March 1997. Best Current Practice. URL: <a href="https://datatracker.ietf.org/doc/html/rfc2119">https://datatracker.ietf.org/doc/html/rfc2119</a>
  </dl>
  <h3 class="no-num no-ref heading settled" id="informative"><span class="content">Informative References</span><a class="self-link" href="#informative"></a></h3>
  <dl>
   <dt id="biblio-clreq">[CLREQ]
   <dd>Fuqiao Xue; Richard Ishida. <a href="https://www.w3.org/International/clreq/"><cite>Requirements for Chinese Text Layout - 中文排版需求</cite></a>. URL: <a href="https://www.w3.org/International/clreq/">https://www.w3.org/International/clreq/</a>
   <dt id="biblio-css-align-3">[CSS-ALIGN-3]
   <dd>Elika Etemad; Tab Atkins Jr.. <a href="https://drafts.csswg.org/css-align/"><cite>CSS Box Alignment Module Level 3</cite></a>. URL: <a href="https://drafts.csswg.org/css-align/">https://drafts.csswg.org/css-align/</a>
   <dt id="biblio-css-flexbox-1">[CSS-FLEXBOX-1]
   <dd>Tab Atkins Jr.; et al. <a href="https://drafts.csswg.org/css-flexbox-1/"><cite>CSS Flexible Box Layout Module Level 1</cite></a>. URL: <a href="https://drafts.csswg.org/css-flexbox-1/">https://drafts.csswg.org/css-flexbox-1/</a>
   <dt id="biblio-i18n-glossary">[I18N-GLOSSARY]
   <dd>Richard Ishida; Addison Phillips. <a href="https://w3c.github.io/i18n-glossary/"><cite>Internationalization Glossary</cite></a>. URL: <a href="https://w3c.github.io/i18n-glossary/">https://w3c.github.io/i18n-glossary/</a>
   <dt id="biblio-jis4051">[JIS4051]
   <dd><cite>Formatting rules for Japanese documents (『日本語文書の組版方法』).</cite> Japanese Standards Association. 2004. JIS X 4051:2004. In Japanese
   <dt id="biblio-jisx4051">[JISX4051]
   <dd><cite>Line composition rules for Japanese documents.</cite> Japanese Standards Association. 1995. JIS X 4051-1995. In Japanese
   <dt id="biblio-jlreq">[JLREQ]
   <dd>Hiroyuki Chiba; et al. <a href="https://w3c.github.io/jlreq/"><cite>Requirements for Japanese Text Layout 日本語組版処理の要件(日本語版)</cite></a>. URL: <a href="https://w3c.github.io/jlreq/">https://w3c.github.io/jlreq/</a>
   <dt id="biblio-qa-ruby">[QA-RUBY]
   <dd>Richard Ishida. <a href="https://www.w3.org/International/questions/qa-ruby"><cite>What is ruby?</cite></a>. URL: <a href="https://www.w3.org/International/questions/qa-ruby">https://www.w3.org/International/questions/qa-ruby</a>
   <dt id="biblio-ruby">[RUBY]
   <dd>Marcin Sawicki; et al. <a href="https://www.w3.org/TR/ruby/"><cite>Ruby Annotation</cite></a>. 31 May 2001. REC. URL: <a href="https://www.w3.org/TR/ruby/">https://www.w3.org/TR/ruby/</a>
   <dt id="biblio-simple-ruby">[SIMPLE-RUBY]
   <dd>Florian Rivoal; Atsushi Shimono; Richard Ishida. <a href="https://w3c.github.io/simple-ruby/"><cite>Rules for Simple Placement of Japanese Ruby</cite></a>. URL: <a href="https://w3c.github.io/simple-ruby/">https://w3c.github.io/simple-ruby/</a>
  </dl>
  <h2 class="no-num no-ref heading settled" id="property-index"><span class="content">Property Index</span><a class="self-link" href="#property-index"></a></h2>
  <div class="big-element-wrapper">
   <table class="index">
    <thead>
     <tr>
      <th scope="col">Name
      <th scope="col">Value
      <th scope="col">Initial
      <th scope="col">Applies to
      <th scope="col">Inh.
      <th scope="col">%ages
      <th scope="col">Anim­ation type
      <th scope="col">Canonical order
      <th scope="col">Com­puted value
    <tbody>
     <tr>
      <th scope="row"><a class="css" data-link-type="property" href="#propdef-ruby-align" id="ref-for-propdef-ruby-align①⑧">ruby-align</a>
      <td>start | center | space-between | space-around
      <td>space-around
      <td>ruby bases, ruby annotations, ruby base containers, ruby annotation containers
      <td>yes
      <td>n/a
      <td>by computed value type
      <td>per grammar
      <td>specified keyword
     <tr>
      <th scope="row"><a class="css" data-link-type="property" href="#propdef-ruby-merge" id="ref-for-propdef-ruby-merge①⑦">ruby-merge</a>
      <td>separate | merge | auto
      <td>separate
      <td>interlinear ruby annotation containers
      <td>yes
      <td>n/a
      <td>by computed value type
      <td>per grammar
      <td>specified keyword
     <tr>
      <th scope="row"><a class="css" data-link-type="property" href="#propdef-ruby-overhang" id="ref-for-propdef-ruby-overhang③">ruby-overhang</a>
      <td>auto | none
      <td>auto
      <td>ruby annotation containers
      <td>yes
      <td>n/a
      <td>by computed value type
      <td>per grammar
      <td>specified keyword
     <tr>
      <th scope="row"><a class="css" data-link-type="property" href="#propdef-ruby-position" id="ref-for-propdef-ruby-position①⓪">ruby-position</a>
      <td>[ alternate || [ over | under ] ] | inter-character
      <td>alternate
      <td>ruby annotation containers
      <td>yes
      <td>n/a
      <td>discrete
      <td>per grammar
      <td>specified keyword
   </table>
  </div>
  <h2 class="no-num no-ref heading settled" id="issues-index"><span class="content">Issues Index</span><a class="self-link" href="#issues-index"></a></h2>
  <div style="counter-reset:issue">
   <div class="issue"> The goal of this is to simplify the layout model by suppressing any line breaks within ruby annotations.
			Alternatively we could try to define some kind of acceptable behavior for them. <a class="issue-return" href="#issue-f0987196" title="Jump to section">↵</a></div>
   <div class="issue"> Define the extent to which <a class="property css" data-link-type="property" href="https://drafts.csswg.org/css-inline-3/#propdef-vertical-align">vertical-align</a> affects these ruby boxes.
	See <a href="https://github.com/w3c/csswg-drafts/issues/4987">Issue 4987</a>. <a class="issue-return" href="#issue-e7399eec" title="Jump to section">↵</a></div>
   <div class="issue"> Should block-axis margins collapse?
	This makes layout more robust,
	but is inconsistent with how inlines behave along the inline-axis. <a class="issue-return" href="#issue-ea5c17b0" title="Jump to section">↵</a></div>
   <div class="issue"> Insert scanned example so people don’t think this is just the ramblings of an insane spec-writer. <a class="issue-return" href="#issue-14d7c6b1" title="Jump to section">↵</a></div>
   <div class="issue"> "Katatsuki ruby" (肩付きルビ) is close to,
			but not quite the same as,
			this <a class="css" data-link-type="maybe" href="#valdef-ruby-align-start">start</a> value.
			In particular,
			its behavior when overhanging its base
			can differ from start alignment
			depending on surrounding context,
			see <a href="https://www.w3.org/TR/jlreq/#positioning_of_monoruby_with_respect_to_base_characters">JLREQ</a>.
			Also, it’s only ever used in vertical writing,
			and the JLTF considers it not particularly important,
			so it may not be worth the effort to make this value smart enough to deal with katatsuki ruby.
			If <span class="css">start</span> is needed for some other purpose,
			we should keep it.
			Otherwise, maybe just drop it? <a class="issue-return" href="#issue-41435749" title="Jump to section">↵</a></div>
   <div class="issue"> What if a <a data-link-type="dfn" href="#merged-annotation">merged annotation</a> causes the <a data-link-type="dfn" href="#ruby-segments">ruby segment</a> to be wider?
	Does it cause each base to grow as if it were spanning them, as currently specified?
	This does not allow e.g. centering the text in a multi-base base container
	when its merged annotation is longer.
	Instead, maybe we should allow ruby-merge to apply to base containers as well,
	but this would require us either to allow a single base to span multiple annotations
	(if the base is merged but some annotation levels are not),
	or to require that if the base is merged, then all annotation levels must be merged as well. <a class="issue-return" href="#issue-70e7253c" title="Jump to section">↵</a></div>
   <div class="issue"> This section needs some clarification about
	drawing decorations between the content of adjacent bases/annotations.
	Depends on if those boxes are as wide as their <a data-link-type="dfn" href="#ruby-columns">column</a> or not. <a class="issue-return" href="#issue-c8497783" title="Jump to section">↵</a></div>
   <div class="issue"> I suspect overhanging interacts with alignment in some cases;
	might need to look into this later. <a class="issue-return" href="#issue-adc9f0e4" title="Jump to section">↵</a></div>
  </div>
  <details class="mdn-anno unpositioned" data-anno-for="ruby-align-property">
   <summary><b class="less-than-two-engines-flag" title="This feature is in less than two current engines.">⚠</b><span>MDN</span></summary>
   <div class="feature">
    <p><a href="https://developer.mozilla.org/en-US/docs/Web/CSS/ruby-align" title="The ruby-align CSS property defines the distribution of the different ruby elements over the base.">ruby-align</a></p>
    <p class="less-than-two-engines-text">In only one current engine.</p>
    <div class="support">
     <span class="firefox yes"><span>Firefox</span><span>38+</span></span><span class="safari no"><span>Safari</span><span>None</span></span><span class="chrome no"><span>Chrome</span><span>None</span></span>
     <hr>
     <span class="opera no"><span>Opera</span><span>?</span></span><span class="edge_blink no"><span>Edge</span><span>None</span></span>
     <hr>
     <span class="edge no"><span>Edge (Legacy)</span><span>?</span></span><span class="ie no"><span>IE</span><span>None</span></span>
     <hr>
     <span class="firefox_android no"><span>Firefox for Android</span><span>?</span></span><span class="safari_ios no"><span>iOS Safari</span><span>?</span></span><span class="chrome_android no"><span>Chrome for Android</span><span>?</span></span><span class="webview_android no"><span>Android WebView</span><span>?</span></span><span class="samsunginternet_android no"><span>Samsung Internet</span><span>?</span></span><span class="opera_android no"><span>Opera Mobile</span><span>?</span></span>
    </div>
   </div>
  </details>
  <details class="mdn-anno unpositioned" data-anno-for="rubypos">
   <summary><span>MDN</span></summary>
   <div class="feature">
    <p><a href="https://developer.mozilla.org/en-US/docs/Web/CSS/ruby-position" title="The ruby-position CSS property defines the position of a ruby element relatives to its base element. It can be positioned over the element (over), under it (under), or between the characters on their right side (inter-character).">ruby-position</a></p>
    <div class="support">
     <span class="firefox yes"><span>Firefox</span><span>38+</span></span><span class="safari no"><span>Safari</span><span>None</span></span><span class="chrome yes"><span>Chrome</span><span>84+</span></span>
     <hr>
     <span class="opera no"><span>Opera</span><span>?</span></span><span class="edge_blink yes"><span>Edge</span><span>84+</span></span>
     <hr>
     <span class="edge no"><span>Edge (Legacy)</span><span>None</span></span><span class="ie no"><span>IE</span><span>None</span></span>
     <hr>
     <span class="firefox_android no"><span>Firefox for Android</span><span>?</span></span><span class="safari_ios no"><span>iOS Safari</span><span>?</span></span><span class="chrome_android no"><span>Chrome for Android</span><span>?</span></span><span class="webview_android no"><span>Android WebView</span><span>?</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>14.0+</span></span><span class="opera_android no"><span>Opera Mobile</span><span>?</span></span>
    </div>
   </div>
  </details>
<script>/* Boilerplate: script-dom-helper */
"use strict";
function query(sel) { return document.querySelector(sel); }

function queryAll(sel) { return [...document.querySelectorAll(sel)]; }

function iter(obj) {
	if(!obj) return [];
	var it = obj[Symbol.iterator];
	if(it) return it;
	return Object.entries(obj);
}

function mk(tagname, attrs, ...children) {
	const el = document.createElement(tagname);
	for(const [k,v] of iter(attrs)) {
		if(k.slice(0,3) == "_on") {
			const eventName = k.slice(3);
			el.addEventListener(eventName, v);
		} else if(k[0] == "_") {
			// property, not attribute
			el[k.slice(1)] = v;
		} else {
			if(v === false || v == null) {
        continue;
      } else if(v === true) {
        el.setAttribute(k, "");
        continue;
      } else {
  			el.setAttribute(k, v);
      }
		}
	}
	append(el, children);
	return el;
}

/* Create shortcuts for every known HTML element */
[
  "a",
  "abbr",
  "acronym",
  "address",
  "applet",
  "area",
  "article",
  "aside",
  "audio",
  "b",
  "base",
  "basefont",
  "bdo",
  "big",
  "blockquote",
  "body",
  "br",
  "button",
  "canvas",
  "caption",
  "center",
  "cite",
  "code",
  "col",
  "colgroup",
  "datalist",
  "dd",
  "del",
  "details",
  "dfn",
  "dialog",
  "div",
  "dl",
  "dt",
  "em",
  "embed",
  "fieldset",
  "figcaption",
  "figure",
  "font",
  "footer",
  "form",
  "frame",
  "frameset",
  "head",
  "header",
  "h1",
  "h2",
  "h3",
  "h4",
  "h5",
  "h6",
  "hr",
  "html",
  "i",
  "iframe",
  "img",
  "input",
  "ins",
  "kbd",
  "label",
  "legend",
  "li",
  "link",
  "main",
  "map",
  "mark",
  "meta",
  "meter",
  "nav",
  "nobr",
  "noscript",
  "object",
  "ol",
  "optgroup",
  "option",
  "output",
  "p",
  "param",
  "pre",
  "progress",
  "q",
  "s",
  "samp",
  "script",
  "section",
  "select",
  "small",
  "source",
  "span",
  "strike",
  "strong",
  "style",
  "sub",
  "summary",
  "sup",
  "table",
  "tbody",
  "td",
  "template",
  "textarea",
  "tfoot",
  "th",
  "thead",
  "time",
  "title",
  "tr",
  "u",
  "ul",
  "var",
  "video",
  "wbr",
  "xmp",
].forEach(tagname=>{
	mk[tagname] = (...args) => mk(tagname, ...args);
});

function* nodesFromChildList(children) {
	for(const child of children.flat(Infinity)) {
		if(child instanceof Node) {
			yield child;
		} else {
			yield new Text(child);
		}
	}
}
function append(el, ...children) {
	for(const child of nodesFromChildList(children)) {
		if(el instanceof Node) el.appendChild(child);
		else el.push(child);
	}
	return el;
}

function insertAfter(el, ...children) {
	for(const child of nodesFromChildList(children)) {
		el.parentNode.insertBefore(child, el.nextSibling);
	}
	return el;
}

function clearContents(el) {
	el.innerHTML = "";
	return el;
}

function parseHTML(markup) {
	if(markup.toLowerCase().trim().indexOf('<!doctype') === 0) {
		const doc = document.implementation.createHTMLDocument("");
		doc.documentElement.innerHTML = markup;
		return doc;
	} else {
		const el = mk.template({});
		el.innerHTML = markup;
		return el.content;
	}
}</script>
<script>/* Boilerplate: script-dfn-panel */
"use strict";
{
let dfnPanelData = {
"083ffe5f": {"dfnID":"083ffe5f","dfnText":"inline box","external":true,"refSections":[{"refs":[{"id":"ref-for-inline-box"},{"id":"ref-for-inline-box\u2460"},{"id":"ref-for-inline-box\u2461"},{"id":"ref-for-inline-box\u2462"}],"title":"2.1.1. \nThe Ruby Formatting Context"},{"refs":[{"id":"ref-for-inline-box\u2463"},{"id":"ref-for-inline-box\u2464"}],"title":"3. \nRuby Layout"},{"refs":[{"id":"ref-for-inline-box\u2465"}],"title":"3.1. \nInterlinear Ruby Layout"},{"refs":[{"id":"ref-for-inline-box\u2466"},{"id":"ref-for-inline-box\u2467"},{"id":"ref-for-inline-box\u2468"},{"id":"ref-for-inline-box\u2460\u24ea"}],"title":"3.3. \nStyling Ruby Boxes"},{"refs":[{"id":"ref-for-inline-box\u2460\u2460"}],"title":"4.2. \nSharing Annotation Space: the ruby-merge property"},{"refs":[{"id":"ref-for-inline-box\u2460\u2461"}],"title":"\nChanges since the 29 April 2020 WD"}],"url":"https://drafts.csswg.org/css-display-4/#inline-box"},
"09e0ad83": {"dfnID":"09e0ad83","dfnText":"white space","external":true,"refSections":[{"refs":[{"id":"ref-for-white-space"},{"id":"ref-for-white-space\u2460"}],"title":"2.2. \nAnonymous Ruby Box Generation"}],"url":"https://drafts.csswg.org/css-text-4/#white-space"},
"09e4de67": {"dfnID":"09e4de67","dfnText":"vertical writing mode","external":true,"refSections":[{"refs":[{"id":"ref-for-vertical-writing-mode"}],"title":"4.1. \nRuby Positioning: the ruby-position property"}],"url":"https://drafts.csswg.org/css-writing-modes-4/#vertical-writing-mode"},
"0bc73d68": {"dfnID":"0bc73d68","dfnText":"formatting context","external":true,"refSections":[{"refs":[{"id":"ref-for-formatting-context"}],"title":"2.1.1. \nThe Ruby Formatting Context"}],"url":"https://drafts.csswg.org/css-display-4/#formatting-context"},
"0e74a72c": {"dfnID":"0e74a72c","dfnText":"soft wrap opportunity","external":true,"refSections":[{"refs":[{"id":"ref-for-soft-wrap-opportunity"}],"title":"3.4.2. \nBreaking Within Bases"}],"url":"https://drafts.csswg.org/css-text-4/#soft-wrap-opportunity"},
"0eae20f4": {"dfnID":"0eae20f4","dfnText":"rtc","external":true,"refSections":[{"refs":[{"id":"ref-for-rtc"}],"title":"\nChanges since the 5 August 2014 WD"}],"url":"https://html.spec.whatwg.org/multipage/obsolete.html#rtc"},
"0eb9789d": {"dfnID":"0eb9789d","dfnText":"character","external":true,"refSections":[{"refs":[{"id":"ref-for-character"},{"id":"ref-for-character\u2460"}],"title":"4.3. \nRuby Text Distribution: the ruby-align property"}],"url":"https://drafts.csswg.org/css-text-3/#character"},
"12944ef3": {"dfnID":"12944ef3","dfnText":"bidi-override","external":true,"refSections":[{"refs":[{"id":"ref-for-valdef-unicode-bidi-bidi-override"}],"title":"3.5. \nBidi Reordering"}],"url":"https://drafts.csswg.org/css-writing-modes-4/#valdef-unicode-bidi-bidi-override"},
"12f8fb07": {"dfnID":"12f8fb07","dfnText":"visibility","external":true,"refSections":[{"refs":[{"id":"ref-for-propdef-visibility"},{"id":"ref-for-propdef-visibility\u2460"},{"id":"ref-for-propdef-visibility\u2461"},{"id":"ref-for-propdef-visibility\u2462"},{"id":"ref-for-propdef-visibility\u2463"},{"id":"ref-for-propdef-visibility\u2464"},{"id":"ref-for-propdef-visibility\u2465"},{"id":"ref-for-propdef-visibility\u2466"}],"title":"2.4. \nHiding Annotations: visibility: collapse and auto-hidden ruby"},{"refs":[{"id":"ref-for-propdef-visibility\u2467"}],"title":"\nChanges since the 29 April 2020 WD"}],"url":"https://drafts.csswg.org/css-display-4/#propdef-visibility"},
"13518d87": {"dfnID":"13518d87","dfnText":"normal","external":true,"refSections":[{"refs":[{"id":"ref-for-valdef-unicode-bidi-normal"}],"title":"3.5. \nBidi Reordering"}],"url":"https://drafts.csswg.org/css-writing-modes-4/#valdef-unicode-bidi-normal"},
"154375a0": {"dfnID":"154375a0","dfnText":"margin box","external":true,"refSections":[{"refs":[{"id":"ref-for-margin-box"}],"title":"3.2. \nInter-character Ruby Layout"}],"url":"https://drafts.csswg.org/css-box-4/#margin-box"},
"16b64b43": {"dfnID":"16b64b43","dfnText":"vertical-rl","external":true,"refSections":[{"refs":[{"id":"ref-for-valdef-writing-mode-vertical-rl"}],"title":"3.2. \nInter-character Ruby Layout"},{"refs":[{"id":"ref-for-valdef-writing-mode-vertical-rl\u2460"}],"title":"4.1. \nRuby Positioning: the ruby-position property"}],"url":"https://drafts.csswg.org/css-writing-modes-4/#valdef-writing-mode-vertical-rl"},
"19119b4f": {"dfnID":"19119b4f","dfnText":"text-emphasis-position","external":true,"refSections":[{"refs":[{"id":"ref-for-propdef-text-emphasis-position"},{"id":"ref-for-propdef-text-emphasis-position\u2460"}],"title":"\nChanges since the 30 June 2011 WD"}],"url":"https://drafts.csswg.org/css-text-decor-4/#propdef-text-emphasis-position"},
"22bdf867": {"dfnID":"22bdf867","dfnText":"word-break","external":true,"refSections":[{"refs":[{"id":"ref-for-propdef-word-break"}],"title":"3.4.1. \nBreaking Between Bases"}],"url":"https://drafts.csswg.org/css-text-4/#propdef-word-break"},
"2ba936be": {"dfnID":"2ba936be","dfnText":"bidi isolation","external":true,"refSections":[{"refs":[{"id":"ref-for-dfn-bidi-isolation"}],"title":"4.2. \nSharing Annotation Space: the ruby-merge property"}],"url":"https://w3c.github.io/i18n-glossary/#dfn-bidi-isolation"},
"358fd6ff": {"dfnID":"358fd6ff","dfnText":"CSS-wide keywords","external":true,"refSections":[{"refs":[{"id":"ref-for-css-wide-keywords"}],"title":"1.3. \nValue Definitions"}],"url":"https://drafts.csswg.org/css-values-4/#css-wide-keywords"},
"385326d7": {"dfnID":"385326d7","dfnText":"writing-mode","external":true,"refSections":[{"refs":[{"id":"ref-for-propdef-writing-mode"}],"title":"3.2. \nInter-character Ruby Layout"},{"refs":[{"id":"ref-for-propdef-writing-mode\u2460"}],"title":"4.1. \nRuby Positioning: the ruby-position property"}],"url":"https://drafts.csswg.org/css-writing-modes-4/#propdef-writing-mode"},
"40873652": {"dfnID":"40873652","dfnText":"content area","external":true,"refSections":[{"refs":[{"id":"ref-for-content-area"}],"title":"3.2. \nInter-character Ruby Layout"}],"url":"https://drafts.csswg.org/css-box-4/#content-area"},
"46c6a718": {"dfnID":"46c6a718","dfnText":"content box","external":true,"refSections":[{"refs":[{"id":"ref-for-content-box"},{"id":"ref-for-content-box\u2460"},{"id":"ref-for-content-box\u2461"},{"id":"ref-for-content-box\u2462"},{"id":"ref-for-content-box\u2463"},{"id":"ref-for-content-box\u2464"}],"title":"3.2. \nInter-character Ruby Layout"}],"url":"https://drafts.csswg.org/css-box-4/#content-box"},
"4dd1920b": {"dfnID":"4dd1920b","dfnText":"line-over","external":true,"refSections":[{"refs":[{"id":"ref-for-line-over"}],"title":"4.1. \nRuby Positioning: the ruby-position property"}],"url":"https://drafts.csswg.org/css-writing-modes-4/#line-over"},
"4e683851": {"dfnID":"4e683851","dfnText":"line-relative shift values","external":true,"refSections":[{"refs":[{"id":"ref-for-line-relative-shift-values"},{"id":"ref-for-line-relative-shift-values\u2460"}],"title":"3.3. \nStyling Ruby Boxes"}],"url":"https://drafts.csswg.org/css-inline-3/#line-relative-shift-values"},
"54aa64f0": {"dfnID":"54aa64f0","dfnText":"margin","external":true,"refSections":[{"refs":[{"id":"ref-for-margin"}],"title":"3.3. \nStyling Ruby Boxes"}],"url":"https://drafts.csswg.org/css-box-4/#margin"},
"5bc8bd12": {"dfnID":"5bc8bd12","dfnText":"direction","external":true,"refSections":[{"refs":[{"id":"ref-for-propdef-direction"},{"id":"ref-for-propdef-direction\u2460"},{"id":"ref-for-propdef-direction\u2461"},{"id":"ref-for-propdef-direction\u2462"}],"title":"3.5. \nBidi Reordering"}],"url":"https://drafts.csswg.org/css-writing-modes-3/#propdef-direction"},
"5c5d00da": {"dfnID":"5c5d00da","dfnText":"rp","external":true,"refSections":[{"refs":[{"id":"ref-for-the-rp-element"}],"title":"\nChanges since the 30 June 2011 WD"}],"url":"https://html.spec.whatwg.org/multipage/text-level-semantics.html#the-rp-element"},
"5e077028": {"dfnID":"5e077028","dfnText":"top","external":true,"refSections":[{"refs":[{"id":"ref-for-valdef-baseline-shift-top"},{"id":"ref-for-valdef-baseline-shift-top\u2460"}],"title":"3.3. \nStyling Ruby Boxes"}],"url":"https://drafts.csswg.org/css-inline-3/#valdef-baseline-shift-top"},
"5e3e8101": {"dfnID":"5e3e8101","dfnText":"inner display type","external":true,"refSections":[{"refs":[{"id":"ref-for-inner-display-type"}],"title":"2.1.2. \nNon-Inline Ruby"}],"url":"https://drafts.csswg.org/css-display-4/#inner-display-type"},
"6501e5b3": {"dfnID":"6501e5b3","dfnText":"white-space","external":true,"refSections":[{"refs":[{"id":"ref-for-propdef-white-space"}],"title":"2.2. \nAnonymous Ruby Box Generation"},{"refs":[{"id":"ref-for-propdef-white-space\u2460"}],"title":"2.4. \nHiding Annotations: visibility: collapse and auto-hidden ruby"},{"refs":[{"id":"ref-for-propdef-white-space\u2461"}],"title":"3.4.2. \nBreaking Within Bases"}],"url":"https://drafts.csswg.org/css-text-4/#propdef-white-space"},
"6b6458ae": {"dfnID":"6b6458ae","dfnText":"border","external":true,"refSections":[{"refs":[{"id":"ref-for-border"}],"title":"3.3. \nStyling Ruby Boxes"}],"url":"https://drafts.csswg.org/css-box-4/#border"},
"6d0d9897": {"dfnID":"6d0d9897","dfnText":"internal table element","external":true,"refSections":[{"refs":[{"id":"ref-for-internal-table-element"}],"title":"2.1.1. \nThe Ruby Formatting Context"},{"refs":[{"id":"ref-for-internal-table-element\u2460"}],"title":"2.2. \nAnonymous Ruby Box Generation"}],"url":"https://drafts.csswg.org/css-display-4/#internal-table-element"},
"6ec67710": {"dfnID":"6ec67710","dfnText":"|","external":true,"refSections":[{"refs":[{"id":"ref-for-comb-one"},{"id":"ref-for-comb-one\u2460"},{"id":"ref-for-comb-one\u2461"},{"id":"ref-for-comb-one\u2462"}],"title":"2.1. \nRuby-specific display Values"},{"refs":[{"id":"ref-for-comb-one\u2463"},{"id":"ref-for-comb-one\u2464"}],"title":"4.1. \nRuby Positioning: the ruby-position property"},{"refs":[{"id":"ref-for-comb-one\u2465"},{"id":"ref-for-comb-one\u2466"}],"title":"4.2. \nSharing Annotation Space: the ruby-merge property"},{"refs":[{"id":"ref-for-comb-one\u2467"},{"id":"ref-for-comb-one\u2468"},{"id":"ref-for-comb-one\u2460\u24ea"}],"title":"4.3. \nRuby Text Distribution: the ruby-align property"},{"refs":[{"id":"ref-for-comb-one\u2460\u2460"}],"title":"5.1. \nOverhanging Ruby: the ruby-overhang property"}],"url":"https://drafts.csswg.org/css-values-4/#comb-one"},
"75bfa627": {"dfnID":"75bfa627","dfnText":"::first-line","external":true,"refSections":[{"refs":[{"id":"ref-for-selectordef-first-line"},{"id":"ref-for-selectordef-first-line\u2460"}],"title":"1.2. \nModule interactions"},{"refs":[{"id":"ref-for-selectordef-first-line\u2461"}],"title":"\nChanges since the 5 August 2014 WD"}],"url":"https://drafts.csswg.org/css-pseudo-4/#selectordef-first-line"},
"80cc929e": {"dfnID":"80cc929e","dfnText":"line-under","external":true,"refSections":[{"refs":[{"id":"ref-for-line-under"}],"title":"4.1. \nRuby Positioning: the ruby-position property"}],"url":"https://drafts.csswg.org/css-writing-modes-4/#line-under"},
"8141cabb": {"dfnID":"8141cabb","dfnText":"independent formatting context","external":true,"refSections":[{"refs":[{"id":"ref-for-independent-formatting-context"}],"title":"2.1.1. \nThe Ruby Formatting Context"}],"url":"https://drafts.csswg.org/css-display-4/#independent-formatting-context"},
"8285a4c4": {"dfnID":"8285a4c4","dfnText":"outer display type","external":true,"refSections":[{"refs":[{"id":"ref-for-outer-display-type"},{"id":"ref-for-outer-display-type\u2460"}],"title":"2.1.2. \nNon-Inline Ruby"}],"url":"https://drafts.csswg.org/css-display-4/#outer-display-type"},
"83316a9a": {"dfnID":"83316a9a","dfnText":"isolate","external":true,"refSections":[{"refs":[{"id":"ref-for-valdef-unicode-bidi-isolate"}],"title":"3.5. \nBidi Reordering"}],"url":"https://drafts.csswg.org/css-writing-modes-4/#valdef-unicode-bidi-isolate"},
"887c0c5c": {"dfnID":"887c0c5c","dfnText":"inline base direction","external":true,"refSections":[{"refs":[{"id":"ref-for-inline-base-direction"}],"title":"3.5. \nBidi Reordering"}],"url":"https://drafts.csswg.org/css-writing-modes-4/#inline-base-direction"},
"8a82fda1": {"dfnID":"8a82fda1","dfnText":"||","external":true,"refSections":[{"refs":[{"id":"ref-for-comb-any"}],"title":"4.1. \nRuby Positioning: the ruby-position property"}],"url":"https://drafts.csswg.org/css-values-4/#comb-any"},
"8c122687": {"dfnID":"8c122687","dfnText":"embed","external":true,"refSections":[{"refs":[{"id":"ref-for-valdef-unicode-bidi-embed"}],"title":"3.5. \nBidi Reordering"}],"url":"https://drafts.csswg.org/css-writing-modes-4/#valdef-unicode-bidi-embed"},
"933fdf29": {"dfnID":"933fdf29","dfnText":"horizontal writing mode","external":true,"refSections":[{"refs":[{"id":"ref-for-horizontal-writing-mode"}],"title":"3.2. \nInter-character Ruby Layout"}],"url":"https://drafts.csswg.org/css-writing-modes-4/#horizontal-writing-mode"},
"938d167b": {"dfnID":"938d167b","dfnText":"keep-all","external":true,"refSections":[{"refs":[{"id":"ref-for-valdef-word-break-keep-all"}],"title":"3.4.1. \nBreaking Between Bases"}],"url":"https://drafts.csswg.org/css-text-4/#valdef-word-break-keep-all"},
"982e17a3": {"dfnID":"982e17a3","dfnText":"unicode-bidi","external":true,"refSections":[{"refs":[{"id":"ref-for-propdef-unicode-bidi"}],"title":"3.5. \nBidi Reordering"}],"url":"https://drafts.csswg.org/css-writing-modes-3/#propdef-unicode-bidi"},
"994d0e36": {"dfnID":"994d0e36","dfnText":"table wrapper box","external":true,"refSections":[{"refs":[{"id":"ref-for-table-wrapper-box"}],"title":"2.2. \nAnonymous Ruby Box Generation"}],"url":"https://drafts.csswg.org/css-tables-3/#table-wrapper-box"},
"99cabd32": {"dfnID":"99cabd32","dfnText":"in-flow","external":true,"refSections":[{"refs":[{"id":"ref-for-in-flow"},{"id":"ref-for-in-flow\u2460"},{"id":"ref-for-in-flow\u2461"},{"id":"ref-for-in-flow\u2462"}],"title":"2.2. \nAnonymous Ruby Box Generation"},{"refs":[{"id":"ref-for-in-flow\u2463"},{"id":"ref-for-in-flow\u2464"}],"title":"3.1.2. \nBlock-axis Interlinear Layout"}],"url":"https://drafts.csswg.org/css-display-4/#in-flow"},
"9cd25054": {"dfnID":"9cd25054","dfnText":"computed value","external":true,"refSections":[{"refs":[{"id":"ref-for-computed-value"}],"title":"2.4. \nHiding Annotations: visibility: collapse and auto-hidden ruby"}],"url":"https://drafts.csswg.org/css-cascade-5/#computed-value"},
"9ea6bed2": {"dfnID":"9ea6bed2","dfnText":"initial value","external":true,"refSections":[{"refs":[{"id":"ref-for-initial-value"}],"title":"\nChanges since the 29 April 2020 WD"}],"url":"https://drafts.csswg.org/css-cascade-5/#initial-value"},
"9f3d4f17": {"dfnID":"9f3d4f17","dfnText":"block container","external":true,"refSections":[{"refs":[{"id":"ref-for-block-container"}],"title":"2.1.1. \nThe Ruby Formatting Context"}],"url":"https://drafts.csswg.org/css-display-4/#block-container"},
"a18c5781": {"dfnID":"a18c5781","dfnText":"atomic inline","external":true,"refSections":[{"refs":[{"id":"ref-for-atomic-inline"}],"title":"2.5. \nWhite Space Collapsing"}],"url":"https://drafts.csswg.org/css-display-4/#atomic-inline"},
"a1addf6c": {"dfnID":"a1addf6c","dfnText":"::first-letter","external":true,"refSections":[{"refs":[{"id":"ref-for-selectordef-first-letter"}],"title":"1.2. \nModule interactions"}],"url":"https://drafts.csswg.org/css-pseudo-4/#selectordef-first-letter"},
"a73617e0": {"dfnID":"a73617e0","dfnText":"writing mode","external":true,"refSections":[{"refs":[{"id":"ref-for-writing-mode"}],"title":"4.1. \nRuby Positioning: the ruby-position property"}],"url":"https://drafts.csswg.org/css-writing-modes-4/#writing-mode"},
"a76cd631": {"dfnID":"a76cd631","dfnText":"bottom","external":true,"refSections":[{"refs":[{"id":"ref-for-valdef-baseline-shift-bottom"},{"id":"ref-for-valdef-baseline-shift-bottom\u2460"}],"title":"3.3. \nStyling Ruby Boxes"}],"url":"https://drafts.csswg.org/css-inline-3/#valdef-baseline-shift-bottom"},
"a7adab2e": {"dfnID":"a7adab2e","dfnText":"collapsible white space","external":true,"refSections":[{"refs":[{"id":"ref-for-collapsible-white-space"},{"id":"ref-for-collapsible-white-space\u2460"}],"title":"2.5. \nWhite Space Collapsing"}],"url":"https://drafts.csswg.org/css-text-4/#collapsible-white-space"},
"ac54fbff": {"dfnID":"ac54fbff","dfnText":"line-height","external":true,"refSections":[{"refs":[{"id":"ref-for-propdef-line-height"},{"id":"ref-for-propdef-line-height\u2460"}],"title":"3.3. \nStyling Ruby Boxes"},{"refs":[{"id":"ref-for-propdef-line-height\u2461"},{"id":"ref-for-propdef-line-height\u2462"},{"id":"ref-for-propdef-line-height\u2463"},{"id":"ref-for-propdef-line-height\u2464"},{"id":"ref-for-propdef-line-height\u2465"}],"title":"3.6. \nLine Spacing"}],"url":"https://drafts.csswg.org/css2/#propdef-line-height"},
"annotation-level": {"dfnID":"annotation-level","dfnText":"level","external":false,"refSections":[{"refs":[{"id":"ref-for-annotation-level"}],"title":"2. \nRuby Box Model"},{"refs":[{"id":"ref-for-annotation-level\u2460"},{"id":"ref-for-annotation-level\u2461"},{"id":"ref-for-annotation-level\u2462"}],"title":"2.3. \nAnnotation Pairing"},{"refs":[{"id":"ref-for-annotation-level\u2463"}],"title":"3.1. \nInterlinear Ruby Layout"},{"refs":[{"id":"ref-for-annotation-level\u2464"}],"title":"3.1.1. \nInline-axis Interlinear Layout"},{"refs":[{"id":"ref-for-annotation-level\u2465"}],"title":"3.1.2. \nBlock-axis Interlinear Layout"},{"refs":[{"id":"ref-for-annotation-level\u2466"}],"title":"3.2. \nInter-character Ruby Layout"},{"refs":[{"id":"ref-for-annotation-level\u2467"},{"id":"ref-for-annotation-level\u2468"},{"id":"ref-for-annotation-level\u2460\u24ea"}],"title":"4.1. \nRuby Positioning: the ruby-position property"}],"url":"#annotation-level"},
"auto-hidden": {"dfnID":"auto-hidden","dfnText":"auto-hidden","external":false,"refSections":[{"refs":[{"id":"ref-for-auto-hidden"},{"id":"ref-for-auto-hidden\u2460"}],"title":"2.4. \nHiding Annotations: visibility: collapse and auto-hidden ruby"},{"refs":[{"id":"ref-for-auto-hidden\u2461"}],"title":"\nChanges since the 29 April 2020 WD"}],"url":"#auto-hidden"},
"b34fe2d9": {"dfnID":"b34fe2d9","dfnText":"max-content","external":true,"refSections":[{"refs":[{"id":"ref-for-valdef-grid-template-columns-max-content"}],"title":"\nChanges since the 29 April 2020 WD"}],"url":"https://drafts.csswg.org/css-grid-2/#valdef-grid-template-columns-max-content"},
"b5418f3e": {"dfnID":"b5418f3e","dfnText":"padding","external":true,"refSections":[{"refs":[{"id":"ref-for-propdef-padding"}],"title":"3.6. \nLine Spacing"}],"url":"https://drafts.csswg.org/css-box-4/#propdef-padding"},
"b5c7915a": {"dfnID":"b5c7915a","dfnText":"text-justify","external":true,"refSections":[{"refs":[{"id":"ref-for-propdef-text-justify"},{"id":"ref-for-propdef-text-justify\u2460"}],"title":"4.3. \nRuby Text Distribution: the ruby-align property"}],"url":"https://drafts.csswg.org/css-text-4/#propdef-text-justify"},
"b6ed01f0": {"dfnID":"b6ed01f0","dfnText":"collapse","external":true,"refSections":[{"refs":[{"id":"ref-for-valdef-visibility-collapse"}],"title":"2.4. \nHiding Annotations: visibility: collapse and auto-hidden ruby"}],"url":"https://drafts.csswg.org/css-display-4/#valdef-visibility-collapse"},
"b713cb30": {"dfnID":"b713cb30","dfnText":"automatic size","external":true,"refSections":[{"refs":[{"id":"ref-for-automatic-size"}],"title":"3.2. \nInter-character Ruby Layout"}],"url":"https://drafts.csswg.org/css-sizing-3/#automatic-size"},
"b8f126f1": {"dfnID":"b8f126f1","dfnText":"inline formatting context","external":true,"refSections":[{"refs":[{"id":"ref-for-inline-formatting-context"},{"id":"ref-for-inline-formatting-context\u2460"},{"id":"ref-for-inline-formatting-context\u2461"},{"id":"ref-for-inline-formatting-context\u2462"},{"id":"ref-for-inline-formatting-context\u2463"}],"title":"2.1.1. \nThe Ruby Formatting Context"},{"refs":[{"id":"ref-for-inline-formatting-context\u2464"}],"title":"3.1. \nInterlinear Ruby Layout"},{"refs":[{"id":"ref-for-inline-formatting-context\u2465"},{"id":"ref-for-inline-formatting-context\u2466"}],"title":"3.1.2. \nBlock-axis Interlinear Layout"}],"url":"https://drafts.csswg.org/css-display-4/#inline-formatting-context"},
"base-level": {"dfnID":"base-level","dfnText":"base level","external":false,"refSections":[{"refs":[{"id":"ref-for-base-level"}],"title":"2. \nRuby Box Model"},{"refs":[{"id":"ref-for-base-level\u2460"},{"id":"ref-for-base-level\u2461"}],"title":"3. \nRuby Layout"},{"refs":[{"id":"ref-for-base-level\u2462"}],"title":"3.2. \nInter-character Ruby Layout"},{"refs":[{"id":"ref-for-base-level\u2463"}],"title":"3.4.1. \nBreaking Between Bases"},{"refs":[{"id":"ref-for-base-level\u2464"}],"title":"4.4. \nRuby Text Decoration"}],"url":"#base-level"},
"bb886fc6": {"dfnID":"bb886fc6","dfnText":"block","external":true,"refSections":[{"refs":[{"id":"ref-for-valdef-display-block"}],"title":"2.1.2. \nNon-Inline Ruby"}],"url":"https://drafts.csswg.org/css-display-4/#valdef-display-block"},
"bda23a47": {"dfnID":"bda23a47","dfnText":"ruby","external":true,"refSections":[{"refs":[{"id":"ref-for-the-ruby-element"}],"title":"\nChanges since the 30 June 2011 WD"}],"url":"https://html.spec.whatwg.org/multipage/text-level-semantics.html#the-ruby-element"},
"bopomofo": {"dfnID":"bopomofo","dfnText":"Bopomofo","external":false,"refSections":[],"url":"#bopomofo"},
"bopomofo-tone-marks": {"dfnID":"bopomofo-tone-marks","dfnText":"Bopomofo tone marks","external":false,"refSections":[{"refs":[{"id":"ref-for-bopomofo-tone-marks"}],"title":"6. \nGlossary"}],"url":"#bopomofo-tone-marks"},
"c02f5d57": {"dfnID":"c02f5d57","dfnText":"inline","external":true,"refSections":[{"refs":[{"id":"ref-for-valdef-display-inline"}],"title":"2.1.2. \nNon-Inline Ruby"}],"url":"https://drafts.csswg.org/css-display-4/#valdef-display-inline"},
"c2e2c5d1": {"dfnID":"c2e2c5d1","dfnText":"isolate-override","external":true,"refSections":[{"refs":[{"id":"ref-for-valdef-unicode-bidi-isolate-override"}],"title":"3.5. \nBidi Reordering"}],"url":"https://drafts.csswg.org/css-writing-modes-4/#valdef-unicode-bidi-isolate-override"},
"c337c02f": {"dfnID":"c337c02f","dfnText":"justification opportunity","external":true,"refSections":[{"refs":[{"id":"ref-for-justification-opportunity"},{"id":"ref-for-justification-opportunity\u2460"},{"id":"ref-for-justification-opportunity\u2461"}],"title":"4.3. \nRuby Text Distribution: the ruby-align property"}],"url":"https://drafts.csswg.org/css-text-4/#justification-opportunity"},
"cbc54f93": {"dfnID":"cbc54f93","dfnText":"text-transform","external":true,"refSections":[{"refs":[{"id":"ref-for-propdef-text-transform"}],"title":"2.4. \nHiding Annotations: visibility: collapse and auto-hidden ruby"}],"url":"https://drafts.csswg.org/css-text-4/#propdef-text-transform"},
"d7fa3e1c": {"dfnID":"d7fa3e1c","dfnText":"inline-level","external":true,"refSections":[{"refs":[{"id":"ref-for-inline-level"}],"title":"2.1.1. \nThe Ruby Formatting Context"},{"refs":[{"id":"ref-for-inline-level\u2460"},{"id":"ref-for-inline-level\u2461"}],"title":"2.2. \nAnonymous Ruby Box Generation"}],"url":"https://drafts.csswg.org/css-display-4/#inline-level"},
"e0b6ed58": {"dfnID":"e0b6ed58","dfnText":"vertical-align","external":true,"refSections":[{"refs":[{"id":"ref-for-propdef-vertical-align"}],"title":"3.1.2. \nBlock-axis Interlinear Layout"},{"refs":[{"id":"ref-for-propdef-vertical-align\u2460"},{"id":"ref-for-propdef-vertical-align\u2461"}],"title":"3.3. \nStyling Ruby Boxes"},{"refs":[{"id":"ref-for-propdef-vertical-align\u2462"},{"id":"ref-for-propdef-vertical-align\u2463"}],"title":"3.6. \nLine Spacing"}],"url":"https://drafts.csswg.org/css-inline-3/#propdef-vertical-align"},
"e33664cd": {"dfnID":"e33664cd","dfnText":"inline-block","external":true,"refSections":[{"refs":[{"id":"ref-for-valdef-display-inline-block"}],"title":"2.2. \nAnonymous Ruby Box Generation"}],"url":"https://drafts.csswg.org/css-display-4/#valdef-display-inline-block"},
"e34548f4": {"dfnID":"e34548f4","dfnText":"line box","external":true,"refSections":[{"refs":[{"id":"ref-for-line-box"}],"title":"3.1. \nInterlinear Ruby Layout"}],"url":"https://drafts.csswg.org/css-inline-3/#line-box"},
"e6485f45": {"dfnID":"e6485f45","dfnText":"segment break","external":true,"refSections":[{"refs":[{"id":"ref-for-segment-break"},{"id":"ref-for-segment-break\u2460"}],"title":"2.5. \nWhite Space Collapsing"}],"url":"https://drafts.csswg.org/css-text-4/#segment-break"},
"e77a37fc": {"dfnID":"e77a37fc","dfnText":"inline-level content","external":true,"refSections":[{"refs":[{"id":"ref-for-inline-level"}],"title":"2.1.1. \nThe Ruby Formatting Context"},{"refs":[{"id":"ref-for-inline-level\u2460"},{"id":"ref-for-inline-level\u2461"}],"title":"2.2. \nAnonymous Ruby Box Generation"}],"url":"https://drafts.csswg.org/css-display-4/#inline-level"},
"e7f0dd6c": {"dfnID":"e7f0dd6c","dfnText":"display","external":true,"refSections":[{"refs":[{"id":"ref-for-propdef-display"},{"id":"ref-for-propdef-display\u2460"},{"id":"ref-for-propdef-display\u2461"},{"id":"ref-for-propdef-display\u2462"},{"id":"ref-for-propdef-display\u2463"}],"title":"2.1. \nRuby-specific display Values"},{"refs":[{"id":"ref-for-propdef-display\u2464"},{"id":"ref-for-propdef-display\u2465"}],"title":"2.1.2. \nNon-Inline Ruby"},{"refs":[{"id":"ref-for-propdef-display\u2466"},{"id":"ref-for-propdef-display\u2467"},{"id":"ref-for-propdef-display\u2468"},{"id":"ref-for-propdef-display\u2460\u24ea"},{"id":"ref-for-propdef-display\u2460\u2460"},{"id":"ref-for-propdef-display\u2460\u2461"}],"title":"2.2. \nAnonymous Ruby Box Generation"},{"refs":[{"id":"ref-for-propdef-display\u2460\u2462"},{"id":"ref-for-propdef-display\u2460\u2463"},{"id":"ref-for-propdef-display\u2460\u2464"}],"title":"2.4. \nHiding Annotations: visibility: collapse and auto-hidden ruby"}],"url":"https://drafts.csswg.org/css-display-4/#propdef-display"},
"ea663a43": {"dfnID":"ea663a43","dfnText":"containing block","external":true,"refSections":[{"refs":[{"id":"ref-for-containing-block"},{"id":"ref-for-containing-block\u2460"},{"id":"ref-for-containing-block\u2461"},{"id":"ref-for-containing-block\u2462"}],"title":"2.1.1. \nThe Ruby Formatting Context"}],"url":"https://drafts.csswg.org/css-display-4/#containing-block"},
"f27b1fe0": {"dfnID":"f27b1fe0","dfnText":"inlinify","external":true,"refSections":[{"refs":[{"id":"ref-for-inlinify"},{"id":"ref-for-inlinify\u2460"}],"title":"2.2. \nAnonymous Ruby Box Generation"}],"url":"https://drafts.csswg.org/css-display-4/#inlinify"},
"fc6c8cc8": {"dfnID":"fc6c8cc8","dfnText":"inline block","external":true,"refSections":[{"refs":[{"id":"ref-for-inline-block"}],"title":"3.2. \nInter-character Ruby Layout"},{"refs":[{"id":"ref-for-inline-block\u2460"}],"title":"\nChanges since the 29 April 2020 WD"}],"url":"https://drafts.csswg.org/css-display-4/#inline-block"},
"hidden-annotation": {"dfnID":"hidden-annotation","dfnText":"hidden annotation","external":false,"refSections":[{"refs":[{"id":"ref-for-hidden-annotation"},{"id":"ref-for-hidden-annotation\u2460"},{"id":"ref-for-hidden-annotation\u2461"},{"id":"ref-for-hidden-annotation\u2462"},{"id":"ref-for-hidden-annotation\u2463"},{"id":"ref-for-hidden-annotation\u2464"},{"id":"ref-for-hidden-annotation\u2465"},{"id":"ref-for-hidden-annotation\u2466"}],"title":"2.4. \nHiding Annotations: visibility: collapse and auto-hidden ruby"},{"refs":[{"id":"ref-for-hidden-annotation\u2467"}],"title":"2.5. \nWhite Space Collapsing"},{"refs":[{"id":"ref-for-hidden-annotation\u2468"}],"title":"\nChanges since the 29 April 2020 WD"}],"url":"#hidden-annotation"},
"inter-annotation-white-space": {"dfnID":"inter-annotation-white-space","dfnText":"inter-annotation white space","external":false,"refSections":[{"refs":[{"id":"ref-for-inter-annotation-white-space"},{"id":"ref-for-inter-annotation-white-space\u2460"}],"title":"2.2. \nAnonymous Ruby Box Generation"},{"refs":[{"id":"ref-for-inter-annotation-white-space\u2461"}],"title":"2.5. \nWhite Space Collapsing"}],"url":"#inter-annotation-white-space"},
"inter-base-white-space": {"dfnID":"inter-base-white-space","dfnText":"inter-base white space","external":false,"refSections":[{"refs":[{"id":"ref-for-inter-base-white-space"},{"id":"ref-for-inter-base-white-space\u2460"}],"title":"2.2. \nAnonymous Ruby Box Generation"},{"refs":[{"id":"ref-for-inter-base-white-space\u2461"}],"title":"2.5. \nWhite Space Collapsing"},{"refs":[{"id":"ref-for-inter-base-white-space\u2462"}],"title":"3.2. \nInter-character Ruby Layout"}],"url":"#inter-base-white-space"},
"inter-level-white-space": {"dfnID":"inter-level-white-space","dfnText":"inter-level white space","external":false,"refSections":[],"url":"#inter-level-white-space"},
"inter-segment-white-space": {"dfnID":"inter-segment-white-space","dfnText":"inter-segment white space","external":false,"refSections":[{"refs":[{"id":"ref-for-inter-segment-white-space"},{"id":"ref-for-inter-segment-white-space\u2460"}],"title":"2.2. \nAnonymous Ruby Box Generation"},{"refs":[{"id":"ref-for-inter-segment-white-space\u2461"}],"title":"2.3.1. \nSegment Pairing and Annotation Levels"},{"refs":[{"id":"ref-for-inter-segment-white-space\u2462"},{"id":"ref-for-inter-segment-white-space\u2463"}],"title":"2.5. \nWhite Space Collapsing"},{"refs":[{"id":"ref-for-inter-segment-white-space\u2464"}],"title":"3.2. \nInter-character Ruby Layout"}],"url":"#inter-segment-white-space"},
"interlinear-annotations": {"dfnID":"interlinear-annotations","dfnText":"interlinear annotations","external":false,"refSections":[{"refs":[{"id":"ref-for-interlinear-annotations"}],"title":"2.3. \nAnnotation Pairing"},{"refs":[{"id":"ref-for-interlinear-annotations\u2460"}],"title":"2.5. \nWhite Space Collapsing"},{"refs":[{"id":"ref-for-interlinear-annotations\u2461"}],"title":"3. \nRuby Layout"},{"refs":[{"id":"ref-for-interlinear-annotations\u2462"}],"title":"3.1. \nInterlinear Ruby Layout"},{"refs":[{"id":"ref-for-interlinear-annotations\u2463"},{"id":"ref-for-interlinear-annotations\u2464"}],"title":"3.1.1. \nInline-axis Interlinear Layout"},{"refs":[{"id":"ref-for-interlinear-annotations\u2465"}],"title":"3.1.2. \nBlock-axis Interlinear Layout"},{"refs":[{"id":"ref-for-interlinear-annotations\u2466"}],"title":"4.1. \nRuby Positioning: the ruby-position property"},{"refs":[{"id":"ref-for-interlinear-annotations\u2467"}],"title":"4.2. \nSharing Annotation Space: the ruby-merge property"},{"refs":[{"id":"ref-for-interlinear-annotations\u2468"},{"id":"ref-for-interlinear-annotations\u2460\u24ea"},{"id":"ref-for-interlinear-annotations\u2460\u2460"},{"id":"ref-for-interlinear-annotations\u2460\u2461"}],"title":"\nChanges since the 29 April 2020 WD"}],"url":"#interlinear-annotations"},
"internal-ruby-boxes": {"dfnID":"internal-ruby-boxes","dfnText":"internal ruby boxes","external":false,"refSections":[{"refs":[{"id":"ref-for-internal-ruby-boxes"}],"title":"2.1.1. \nThe Ruby Formatting Context"},{"refs":[{"id":"ref-for-internal-ruby-boxes\u2460"}],"title":"2.1.2. \nNon-Inline Ruby"},{"refs":[{"id":"ref-for-internal-ruby-boxes\u2461"},{"id":"ref-for-internal-ruby-boxes\u2462"}],"title":"3.5. \nBidi Reordering"}],"url":"#internal-ruby-boxes"},
"intra-level-white-space": {"dfnID":"intra-level-white-space","dfnText":"intra-level white space","external":false,"refSections":[{"refs":[{"id":"ref-for-intra-level-white-space"}],"title":"2.2. \nAnonymous Ruby Box Generation"},{"refs":[{"id":"ref-for-intra-level-white-space\u2460"},{"id":"ref-for-intra-level-white-space\u2461"},{"id":"ref-for-intra-level-white-space\u2462"},{"id":"ref-for-intra-level-white-space\u2463"},{"id":"ref-for-intra-level-white-space\u2464"},{"id":"ref-for-intra-level-white-space\u2465"},{"id":"ref-for-intra-level-white-space\u2466"}],"title":"2.3.2. \nUnit Pairing and Spanning Annotations"}],"url":"#intra-level-white-space"},
"intra-ruby-white-space": {"dfnID":"intra-ruby-white-space","dfnText":"intra-ruby white space","external":false,"refSections":[{"refs":[{"id":"ref-for-intra-ruby-white-space"},{"id":"ref-for-intra-ruby-white-space\u2460"},{"id":"ref-for-intra-ruby-white-space\u2461"},{"id":"ref-for-intra-ruby-white-space\u2462"}],"title":"2.2. \nAnonymous Ruby Box Generation"},{"refs":[{"id":"ref-for-intra-ruby-white-space\u2463"},{"id":"ref-for-intra-ruby-white-space\u2464"},{"id":"ref-for-intra-ruby-white-space\u2465"}],"title":"2.3.2. \nUnit Pairing and Spanning Annotations"}],"url":"#intra-ruby-white-space"},
"merged-annotation": {"dfnID":"merged-annotation","dfnText":"merged","external":false,"refSections":[{"refs":[{"id":"ref-for-merged-annotation"}],"title":"1.1. \nWhat is ruby?"},{"refs":[{"id":"ref-for-merged-annotation\u2460"}],"title":"3.1.1. \nInline-axis Interlinear Layout"},{"refs":[{"id":"ref-for-merged-annotation\u2461"},{"id":"ref-for-merged-annotation\u2462"},{"id":"ref-for-merged-annotation\u2463"}],"title":"3.5. \nBidi Reordering"},{"refs":[{"id":"ref-for-merged-annotation\u2464"},{"id":"ref-for-merged-annotation\u2465"}],"title":"4.3. \nRuby Text Distribution: the ruby-align property"},{"refs":[{"id":"ref-for-merged-annotation\u2466"}],"title":"\nChanges since the 29 April 2020 WD"}],"url":"#merged-annotation"},
"pairing": {"dfnID":"pairing","dfnText":"pairing","external":false,"refSections":[{"refs":[{"id":"ref-for-pairing"}],"title":"1.1. \nWhat is ruby?"},{"refs":[{"id":"ref-for-pairing\u2460"},{"id":"ref-for-pairing\u2461"}],"title":"2.2. \nAnonymous Ruby Box Generation"},{"refs":[{"id":"ref-for-pairing\u2462"}],"title":"2.3. \nAnnotation Pairing"},{"refs":[{"id":"ref-for-pairing\u2463"},{"id":"ref-for-pairing\u2464"}],"title":"2.3.2. \nUnit Pairing and Spanning Annotations"},{"refs":[{"id":"ref-for-pairing\u2465"}],"title":"2.4. \nHiding Annotations: visibility: collapse and auto-hidden ruby"},{"refs":[{"id":"ref-for-pairing\u2466"}],"title":"\nChanges since the 5 August 2014 WD"},{"refs":[{"id":"ref-for-pairing\u2467"},{"id":"ref-for-pairing\u2468"}],"title":"\nChanges since the 19 September 2013 WD"},{"refs":[{"id":"ref-for-pairing\u2460\u24ea"}],"title":"\nChanges since the 30 June 2011 WD"}],"url":"#pairing"},
"propdef-ruby-align": {"dfnID":"propdef-ruby-align","dfnText":"ruby-align","external":false,"refSections":[{"refs":[{"id":"ref-for-propdef-ruby-align"},{"id":"ref-for-propdef-ruby-align\u2460"},{"id":"ref-for-propdef-ruby-align\u2461"},{"id":"ref-for-propdef-ruby-align\u2462"},{"id":"ref-for-propdef-ruby-align\u2463"},{"id":"ref-for-propdef-ruby-align\u2464"}],"title":"3.1.1. \nInline-axis Interlinear Layout"},{"refs":[{"id":"ref-for-propdef-ruby-align\u2465"},{"id":"ref-for-propdef-ruby-align\u2466"}],"title":"3.2. \nInter-character Ruby Layout"},{"refs":[{"id":"ref-for-propdef-ruby-align\u2467"},{"id":"ref-for-propdef-ruby-align\u2468"},{"id":"ref-for-propdef-ruby-align\u2460\u24ea"},{"id":"ref-for-propdef-ruby-align\u2460\u2460"},{"id":"ref-for-propdef-ruby-align\u2460\u2461"}],"title":"4.3. \nRuby Text Distribution: the ruby-align property"},{"refs":[{"id":"ref-for-propdef-ruby-align\u2460\u2462"}],"title":"5.1. \nOverhanging Ruby: the ruby-overhang property"},{"refs":[{"id":"ref-for-propdef-ruby-align\u2460\u2463"},{"id":"ref-for-propdef-ruby-align\u2460\u2464"}],"title":"\nChanges since the 29 April 2020 WD"},{"refs":[{"id":"ref-for-propdef-ruby-align\u2460\u2465"},{"id":"ref-for-propdef-ruby-align\u2460\u2466"}],"title":"\nChanges since the 30 June 2011 WD"}],"url":"#propdef-ruby-align"},
"propdef-ruby-merge": {"dfnID":"propdef-ruby-merge","dfnText":"ruby-merge","external":false,"refSections":[{"refs":[{"id":"ref-for-propdef-ruby-merge"}],"title":"2.4. \nHiding Annotations: visibility: collapse and auto-hidden ruby"},{"refs":[{"id":"ref-for-propdef-ruby-merge\u2460"},{"id":"ref-for-propdef-ruby-merge\u2461"},{"id":"ref-for-propdef-ruby-merge\u2462"},{"id":"ref-for-propdef-ruby-merge\u2463"}],"title":"3.1.1. \nInline-axis Interlinear Layout"},{"refs":[{"id":"ref-for-propdef-ruby-merge\u2464"}],"title":"3.5. \nBidi Reordering"},{"refs":[{"id":"ref-for-propdef-ruby-merge\u2465"},{"id":"ref-for-propdef-ruby-merge\u2466"},{"id":"ref-for-propdef-ruby-merge\u2467"},{"id":"ref-for-propdef-ruby-merge\u2468"}],"title":"4.2. \nSharing Annotation Space: the ruby-merge property"},{"refs":[{"id":"ref-for-propdef-ruby-merge\u2460\u24ea"},{"id":"ref-for-propdef-ruby-merge\u2460\u2460"},{"id":"ref-for-propdef-ruby-merge\u2460\u2461"}],"title":"4.3. \nRuby Text Distribution: the ruby-align property"},{"refs":[{"id":"ref-for-propdef-ruby-merge\u2460\u2462"}],"title":"5.1. \nOverhanging Ruby: the ruby-overhang property"},{"refs":[{"id":"ref-for-propdef-ruby-merge\u2460\u2463"}],"title":"\nChanges since the 29 April 2020 WD"},{"refs":[{"id":"ref-for-propdef-ruby-merge\u2460\u2464"}],"title":"\nChanges since the 5 August 2014 WD"},{"refs":[{"id":"ref-for-propdef-ruby-merge\u2460\u2465"}],"title":"\nChanges since the 30 June 2011 WD"}],"url":"#propdef-ruby-merge"},
"propdef-ruby-overhang": {"dfnID":"propdef-ruby-overhang","dfnText":"ruby-overhang","external":false,"refSections":[{"refs":[{"id":"ref-for-propdef-ruby-overhang"},{"id":"ref-for-propdef-ruby-overhang\u2460"}],"title":"5.1. \nOverhanging Ruby: the ruby-overhang property"},{"refs":[{"id":"ref-for-propdef-ruby-overhang\u2461"}],"title":"\nChanges since the 5 August 2014 WD"}],"url":"#propdef-ruby-overhang"},
"propdef-ruby-position": {"dfnID":"propdef-ruby-position","dfnText":"ruby-position","external":false,"refSections":[{"refs":[{"id":"ref-for-propdef-ruby-position"}],"title":"1.2. \nModule interactions"},{"refs":[{"id":"ref-for-propdef-ruby-position\u2460"}],"title":"3.1.2. \nBlock-axis Interlinear Layout"},{"refs":[{"id":"ref-for-propdef-ruby-position\u2461"},{"id":"ref-for-propdef-ruby-position\u2462"}],"title":"4.1. \nRuby Positioning: the ruby-position property"},{"refs":[{"id":"ref-for-propdef-ruby-position\u2463"}],"title":"4.2. \nSharing Annotation Space: the ruby-merge property"},{"refs":[{"id":"ref-for-propdef-ruby-position\u2464"}],"title":"\nChanges since the 29 April 2020 WD"},{"refs":[{"id":"ref-for-propdef-ruby-position\u2465"},{"id":"ref-for-propdef-ruby-position\u2466"}],"title":"\nChanges since the 5 August 2014 WD"},{"refs":[{"id":"ref-for-propdef-ruby-position\u2467"},{"id":"ref-for-propdef-ruby-position\u2468"}],"title":"\nChanges since the 30 June 2011 WD"}],"url":"#propdef-ruby-position"},
"ruby": {"dfnID":"ruby","dfnText":"Ruby","external":false,"refSections":[{"refs":[{"id":"ref-for-ruby"},{"id":"ref-for-ruby\u2460"}],"title":"1.1. \nWhat is ruby?"}],"url":"#ruby"},
"ruby-annotation-box": {"dfnID":"ruby-annotation-box","dfnText":"ruby annotation box","external":false,"refSections":[{"refs":[{"id":"ref-for-ruby-annotation-box"},{"id":"ref-for-ruby-annotation-box\u2460"},{"id":"ref-for-ruby-annotation-box\u2461"}],"title":"2. \nRuby Box Model"},{"refs":[{"id":"ref-for-ruby-annotation-box\u2462"},{"id":"ref-for-ruby-annotation-box\u2463"}],"title":"2.1.1. \nThe Ruby Formatting Context"},{"refs":[{"id":"ref-for-ruby-annotation-box\u2464"},{"id":"ref-for-ruby-annotation-box\u2465"},{"id":"ref-for-ruby-annotation-box\u2466"},{"id":"ref-for-ruby-annotation-box\u2467"},{"id":"ref-for-ruby-annotation-box\u2468"},{"id":"ref-for-ruby-annotation-box\u2460\u24ea"},{"id":"ref-for-ruby-annotation-box\u2460\u2460"},{"id":"ref-for-ruby-annotation-box\u2460\u2461"},{"id":"ref-for-ruby-annotation-box\u2460\u2462"},{"id":"ref-for-ruby-annotation-box\u2460\u2463"},{"id":"ref-for-ruby-annotation-box\u2460\u2464"},{"id":"ref-for-ruby-annotation-box\u2460\u2465"}],"title":"2.2. \nAnonymous Ruby Box Generation"},{"refs":[{"id":"ref-for-ruby-annotation-box\u2460\u2466"},{"id":"ref-for-ruby-annotation-box\u2460\u2467"},{"id":"ref-for-ruby-annotation-box\u2460\u2468"},{"id":"ref-for-ruby-annotation-box\u2461\u24ea"},{"id":"ref-for-ruby-annotation-box\u2461\u2460"},{"id":"ref-for-ruby-annotation-box\u2461\u2461"}],"title":"2.3. \nAnnotation Pairing"},{"refs":[{"id":"ref-for-ruby-annotation-box\u2461\u2462"},{"id":"ref-for-ruby-annotation-box\u2461\u2463"},{"id":"ref-for-ruby-annotation-box\u2461\u2464"},{"id":"ref-for-ruby-annotation-box\u2461\u2465"},{"id":"ref-for-ruby-annotation-box\u2461\u2466"},{"id":"ref-for-ruby-annotation-box\u2461\u2467"},{"id":"ref-for-ruby-annotation-box\u2461\u2468"},{"id":"ref-for-ruby-annotation-box\u2462\u24ea"},{"id":"ref-for-ruby-annotation-box\u2462\u2460"},{"id":"ref-for-ruby-annotation-box\u2462\u2461"},{"id":"ref-for-ruby-annotation-box\u2462\u2462"},{"id":"ref-for-ruby-annotation-box\u2462\u2463"},{"id":"ref-for-ruby-annotation-box\u2462\u2464"}],"title":"2.3.2. \nUnit Pairing and Spanning Annotations"},{"refs":[{"id":"ref-for-ruby-annotation-box\u2462\u2465"},{"id":"ref-for-ruby-annotation-box\u2462\u2466"},{"id":"ref-for-ruby-annotation-box\u2462\u2467"},{"id":"ref-for-ruby-annotation-box\u2462\u2468"}],"title":"2.4. \nHiding Annotations: visibility: collapse and auto-hidden ruby"},{"refs":[{"id":"ref-for-ruby-annotation-box\u2463\u24ea"}],"title":"2.5. \nWhite Space Collapsing"},{"refs":[{"id":"ref-for-ruby-annotation-box\u2463\u2460"},{"id":"ref-for-ruby-annotation-box\u2463\u2461"}],"title":"3.1. \nInterlinear Ruby Layout"},{"refs":[{"id":"ref-for-ruby-annotation-box\u2463\u2462"},{"id":"ref-for-ruby-annotation-box\u2463\u2463"},{"id":"ref-for-ruby-annotation-box\u2463\u2464"},{"id":"ref-for-ruby-annotation-box\u2463\u2465"},{"id":"ref-for-ruby-annotation-box\u2463\u2466"},{"id":"ref-for-ruby-annotation-box\u2463\u2467"},{"id":"ref-for-ruby-annotation-box\u2463\u2468"},{"id":"ref-for-ruby-annotation-box\u2464\u24ea"},{"id":"ref-for-ruby-annotation-box\u2464\u2460"},{"id":"ref-for-ruby-annotation-box\u2464\u2461"},{"id":"ref-for-ruby-annotation-box\u2464\u2462"}],"title":"3.1.1. \nInline-axis Interlinear Layout"},{"refs":[{"id":"ref-for-ruby-annotation-box\u2464\u2463"},{"id":"ref-for-ruby-annotation-box\u2464\u2464"},{"id":"ref-for-ruby-annotation-box\u2464\u2465"},{"id":"ref-for-ruby-annotation-box\u2464\u2466"}],"title":"3.1.2. \nBlock-axis Interlinear Layout"},{"refs":[{"id":"ref-for-ruby-annotation-box\u2464\u2467"},{"id":"ref-for-ruby-annotation-box\u2464\u2468"},{"id":"ref-for-ruby-annotation-box\u2465\u24ea"},{"id":"ref-for-ruby-annotation-box\u2465\u2460"},{"id":"ref-for-ruby-annotation-box\u2465\u2461"},{"id":"ref-for-ruby-annotation-box\u2465\u2462"},{"id":"ref-for-ruby-annotation-box\u2465\u2463"},{"id":"ref-for-ruby-annotation-box\u2465\u2464"},{"id":"ref-for-ruby-annotation-box\u2465\u2465"},{"id":"ref-for-ruby-annotation-box\u2465\u2466"},{"id":"ref-for-ruby-annotation-box\u2465\u2467"}],"title":"3.2. \nInter-character Ruby Layout"},{"refs":[{"id":"ref-for-ruby-annotation-box\u2465\u2468"}],"title":"3.3. \nStyling Ruby Boxes"},{"refs":[{"id":"ref-for-ruby-annotation-box\u2466\u24ea"},{"id":"ref-for-ruby-annotation-box\u2466\u2460"},{"id":"ref-for-ruby-annotation-box\u2466\u2461"}],"title":"3.4. \nBreaking Across Lines"},{"refs":[{"id":"ref-for-ruby-annotation-box\u2466\u2462"},{"id":"ref-for-ruby-annotation-box\u2466\u2463"}],"title":"3.4.1. \nBreaking Between Bases"},{"refs":[{"id":"ref-for-ruby-annotation-box\u2466\u2464"},{"id":"ref-for-ruby-annotation-box\u2466\u2465"}],"title":"3.4.2. \nBreaking Within Bases"},{"refs":[{"id":"ref-for-ruby-annotation-box\u2466\u2466"},{"id":"ref-for-ruby-annotation-box\u2466\u2467"},{"id":"ref-for-ruby-annotation-box\u2466\u2468"},{"id":"ref-for-ruby-annotation-box\u2467\u24ea"},{"id":"ref-for-ruby-annotation-box\u2467\u2460"},{"id":"ref-for-ruby-annotation-box\u2467\u2461"}],"title":"3.5. \nBidi Reordering"},{"refs":[{"id":"ref-for-ruby-annotation-box\u2467\u2462"},{"id":"ref-for-ruby-annotation-box\u2467\u2463"},{"id":"ref-for-ruby-annotation-box\u2467\u2464"}],"title":"3.6. \nLine Spacing"},{"refs":[{"id":"ref-for-ruby-annotation-box\u2467\u2465"}],"title":"4.1. \nRuby Positioning: the ruby-position property"},{"refs":[{"id":"ref-for-ruby-annotation-box\u2467\u2466"},{"id":"ref-for-ruby-annotation-box\u2467\u2467"},{"id":"ref-for-ruby-annotation-box\u2467\u2468"},{"id":"ref-for-ruby-annotation-box\u2468\u24ea"}],"title":"4.2. \nSharing Annotation Space: the ruby-merge property"},{"refs":[{"id":"ref-for-ruby-annotation-box\u2468\u2460"},{"id":"ref-for-ruby-annotation-box\u2468\u2461"}],"title":"4.3. \nRuby Text Distribution: the ruby-align property"},{"refs":[{"id":"ref-for-ruby-annotation-box\u2468\u2462"},{"id":"ref-for-ruby-annotation-box\u2468\u2463"},{"id":"ref-for-ruby-annotation-box\u2468\u2464"},{"id":"ref-for-ruby-annotation-box\u2468\u2465"},{"id":"ref-for-ruby-annotation-box\u2468\u2466"}],"title":"5.1. \nOverhanging Ruby: the ruby-overhang property"},{"refs":[{"id":"ref-for-ruby-annotation-box\u2468\u2467"},{"id":"ref-for-ruby-annotation-box\u2468\u2468"}],"title":"5.2. \nLine-edge Alignment"}],"url":"#ruby-annotation-box"},
"ruby-annotation-container-box": {"dfnID":"ruby-annotation-container-box","dfnText":"ruby annotation container box","external":false,"refSections":[{"refs":[{"id":"ref-for-ruby-annotation-container-box"}],"title":"2.1.1. \nThe Ruby Formatting Context"},{"refs":[{"id":"ref-for-ruby-annotation-container-box\u2460"},{"id":"ref-for-ruby-annotation-container-box\u2461"},{"id":"ref-for-ruby-annotation-container-box\u2462"},{"id":"ref-for-ruby-annotation-container-box\u2463"},{"id":"ref-for-ruby-annotation-container-box\u2464"},{"id":"ref-for-ruby-annotation-container-box\u2465"},{"id":"ref-for-ruby-annotation-container-box\u2466"},{"id":"ref-for-ruby-annotation-container-box\u2467"},{"id":"ref-for-ruby-annotation-container-box\u2468"},{"id":"ref-for-ruby-annotation-container-box\u2460\u24ea"}],"title":"2.2. \nAnonymous Ruby Box Generation"},{"refs":[{"id":"ref-for-ruby-annotation-container-box\u2460\u2460"},{"id":"ref-for-ruby-annotation-container-box\u2460\u2461"},{"id":"ref-for-ruby-annotation-container-box\u2460\u2462"},{"id":"ref-for-ruby-annotation-container-box\u2460\u2463"},{"id":"ref-for-ruby-annotation-container-box\u2460\u2464"}],"title":"2.3.1. \nSegment Pairing and Annotation Levels"},{"refs":[{"id":"ref-for-ruby-annotation-container-box\u2460\u2465"},{"id":"ref-for-ruby-annotation-container-box\u2460\u2466"},{"id":"ref-for-ruby-annotation-container-box\u2460\u2467"},{"id":"ref-for-ruby-annotation-container-box\u2460\u2468"},{"id":"ref-for-ruby-annotation-container-box\u2461\u24ea"}],"title":"2.3.2. \nUnit Pairing and Spanning Annotations"},{"refs":[{"id":"ref-for-ruby-annotation-container-box\u2461\u2460"}],"title":"2.4. \nHiding Annotations: visibility: collapse and auto-hidden ruby"},{"refs":[{"id":"ref-for-ruby-annotation-container-box\u2461\u2461"},{"id":"ref-for-ruby-annotation-container-box\u2461\u2462"},{"id":"ref-for-ruby-annotation-container-box\u2461\u2463"}],"title":"2.5. \nWhite Space Collapsing"},{"refs":[{"id":"ref-for-ruby-annotation-container-box\u2461\u2464"},{"id":"ref-for-ruby-annotation-container-box\u2461\u2465"},{"id":"ref-for-ruby-annotation-container-box\u2461\u2466"},{"id":"ref-for-ruby-annotation-container-box\u2461\u2467"},{"id":"ref-for-ruby-annotation-container-box\u2461\u2468"},{"id":"ref-for-ruby-annotation-container-box\u2462\u24ea"}],"title":"3.1.1. \nInline-axis Interlinear Layout"},{"refs":[{"id":"ref-for-ruby-annotation-container-box\u2462\u2460"},{"id":"ref-for-ruby-annotation-container-box\u2462\u2461"},{"id":"ref-for-ruby-annotation-container-box\u2462\u2462"},{"id":"ref-for-ruby-annotation-container-box\u2462\u2463"},{"id":"ref-for-ruby-annotation-container-box\u2462\u2464"}],"title":"3.1.2. \nBlock-axis Interlinear Layout"},{"refs":[{"id":"ref-for-ruby-annotation-container-box\u2462\u2465"},{"id":"ref-for-ruby-annotation-container-box\u2462\u2466"}],"title":"3.2. \nInter-character Ruby Layout"},{"refs":[{"id":"ref-for-ruby-annotation-container-box\u2462\u2467"},{"id":"ref-for-ruby-annotation-container-box\u2462\u2468"},{"id":"ref-for-ruby-annotation-container-box\u2463\u24ea"}],"title":"3.3. \nStyling Ruby Boxes"},{"refs":[{"id":"ref-for-ruby-annotation-container-box\u2463\u2460"},{"id":"ref-for-ruby-annotation-container-box\u2463\u2461"},{"id":"ref-for-ruby-annotation-container-box\u2463\u2462"},{"id":"ref-for-ruby-annotation-container-box\u2463\u2463"}],"title":"3.5. \nBidi Reordering"},{"refs":[{"id":"ref-for-ruby-annotation-container-box\u2463\u2464"},{"id":"ref-for-ruby-annotation-container-box\u2463\u2465"},{"id":"ref-for-ruby-annotation-container-box\u2463\u2466"}],"title":"3.6. \nLine Spacing"},{"refs":[{"id":"ref-for-ruby-annotation-container-box\u2463\u2467"},{"id":"ref-for-ruby-annotation-container-box\u2463\u2468"},{"id":"ref-for-ruby-annotation-container-box\u2464\u24ea"},{"id":"ref-for-ruby-annotation-container-box\u2464\u2460"}],"title":"4.1. \nRuby Positioning: the ruby-position property"},{"refs":[{"id":"ref-for-ruby-annotation-container-box\u2464\u2461"}],"title":"4.2. \nSharing Annotation Space: the ruby-merge property"},{"refs":[{"id":"ref-for-ruby-annotation-container-box\u2464\u2462"},{"id":"ref-for-ruby-annotation-container-box\u2464\u2463"}],"title":"4.3. \nRuby Text Distribution: the ruby-align property"},{"refs":[{"id":"ref-for-ruby-annotation-container-box\u2464\u2464"},{"id":"ref-for-ruby-annotation-container-box\u2464\u2465"},{"id":"ref-for-ruby-annotation-container-box\u2464\u2466"},{"id":"ref-for-ruby-annotation-container-box\u2464\u2467"},{"id":"ref-for-ruby-annotation-container-box\u2464\u2468"}],"title":"5.1. \nOverhanging Ruby: the ruby-overhang property"}],"url":"#ruby-annotation-container-box"},
"ruby-base-box": {"dfnID":"ruby-base-box","dfnText":"ruby base box","external":false,"refSections":[{"refs":[{"id":"ref-for-ruby-base-box"},{"id":"ref-for-ruby-base-box\u2460"},{"id":"ref-for-ruby-base-box\u2461"}],"title":"2. \nRuby Box Model"},{"refs":[{"id":"ref-for-ruby-base-box\u2462"},{"id":"ref-for-ruby-base-box\u2463"}],"title":"2.1.1. \nThe Ruby Formatting Context"},{"refs":[{"id":"ref-for-ruby-base-box\u2464"},{"id":"ref-for-ruby-base-box\u2465"},{"id":"ref-for-ruby-base-box\u2466"},{"id":"ref-for-ruby-base-box\u2467"},{"id":"ref-for-ruby-base-box\u2468"},{"id":"ref-for-ruby-base-box\u2460\u24ea"},{"id":"ref-for-ruby-base-box\u2460\u2460"},{"id":"ref-for-ruby-base-box\u2460\u2461"},{"id":"ref-for-ruby-base-box\u2460\u2462"},{"id":"ref-for-ruby-base-box\u2460\u2463"},{"id":"ref-for-ruby-base-box\u2460\u2464"},{"id":"ref-for-ruby-base-box\u2460\u2465"}],"title":"2.2. \nAnonymous Ruby Box Generation"},{"refs":[{"id":"ref-for-ruby-base-box\u2460\u2466"},{"id":"ref-for-ruby-base-box\u2460\u2467"},{"id":"ref-for-ruby-base-box\u2460\u2468"},{"id":"ref-for-ruby-base-box\u2461\u24ea"}],"title":"2.3. \nAnnotation Pairing"},{"refs":[{"id":"ref-for-ruby-base-box\u2461\u2460"},{"id":"ref-for-ruby-base-box\u2461\u2461"},{"id":"ref-for-ruby-base-box\u2461\u2462"},{"id":"ref-for-ruby-base-box\u2461\u2463"},{"id":"ref-for-ruby-base-box\u2461\u2464"},{"id":"ref-for-ruby-base-box\u2461\u2465"},{"id":"ref-for-ruby-base-box\u2461\u2466"},{"id":"ref-for-ruby-base-box\u2461\u2467"},{"id":"ref-for-ruby-base-box\u2461\u2468"},{"id":"ref-for-ruby-base-box\u2462\u24ea"}],"title":"2.3.2. \nUnit Pairing and Spanning Annotations"},{"refs":[{"id":"ref-for-ruby-base-box\u2462\u2460"}],"title":"2.4. \nHiding Annotations: visibility: collapse and auto-hidden ruby"},{"refs":[{"id":"ref-for-ruby-base-box\u2462\u2461"},{"id":"ref-for-ruby-base-box\u2462\u2462"}],"title":"2.5. \nWhite Space Collapsing"},{"refs":[{"id":"ref-for-ruby-base-box\u2462\u2463"}],"title":"3. \nRuby Layout"},{"refs":[{"id":"ref-for-ruby-base-box\u2462\u2464"}],"title":"3.1. \nInterlinear Ruby Layout"},{"refs":[{"id":"ref-for-ruby-base-box\u2462\u2465"},{"id":"ref-for-ruby-base-box\u2462\u2466"},{"id":"ref-for-ruby-base-box\u2462\u2467"},{"id":"ref-for-ruby-base-box\u2462\u2468"},{"id":"ref-for-ruby-base-box\u2463\u24ea"},{"id":"ref-for-ruby-base-box\u2463\u2460"},{"id":"ref-for-ruby-base-box\u2463\u2461"},{"id":"ref-for-ruby-base-box\u2463\u2462"},{"id":"ref-for-ruby-base-box\u2463\u2463"},{"id":"ref-for-ruby-base-box\u2463\u2464"},{"id":"ref-for-ruby-base-box\u2463\u2465"},{"id":"ref-for-ruby-base-box\u2463\u2466"}],"title":"3.1.1. \nInline-axis Interlinear Layout"},{"refs":[{"id":"ref-for-ruby-base-box\u2463\u2467"},{"id":"ref-for-ruby-base-box\u2463\u2468"},{"id":"ref-for-ruby-base-box\u2464\u24ea"}],"title":"3.1.2. \nBlock-axis Interlinear Layout"},{"refs":[{"id":"ref-for-ruby-base-box\u2464\u2460"},{"id":"ref-for-ruby-base-box\u2464\u2461"},{"id":"ref-for-ruby-base-box\u2464\u2462"},{"id":"ref-for-ruby-base-box\u2464\u2463"},{"id":"ref-for-ruby-base-box\u2464\u2464"},{"id":"ref-for-ruby-base-box\u2464\u2465"}],"title":"3.2. \nInter-character Ruby Layout"},{"refs":[{"id":"ref-for-ruby-base-box\u2464\u2466"}],"title":"3.3. \nStyling Ruby Boxes"},{"refs":[{"id":"ref-for-ruby-base-box\u2464\u2467"},{"id":"ref-for-ruby-base-box\u2464\u2468"},{"id":"ref-for-ruby-base-box\u2465\u24ea"}],"title":"3.4. \nBreaking Across Lines"},{"refs":[{"id":"ref-for-ruby-base-box\u2465\u2460"},{"id":"ref-for-ruby-base-box\u2465\u2461"},{"id":"ref-for-ruby-base-box\u2465\u2462"},{"id":"ref-for-ruby-base-box\u2465\u2463"},{"id":"ref-for-ruby-base-box\u2465\u2464"},{"id":"ref-for-ruby-base-box\u2465\u2465"}],"title":"3.4.1. \nBreaking Between Bases"},{"refs":[{"id":"ref-for-ruby-base-box\u2465\u2466"},{"id":"ref-for-ruby-base-box\u2465\u2467"},{"id":"ref-for-ruby-base-box\u2465\u2468"}],"title":"3.4.2. \nBreaking Within Bases"},{"refs":[{"id":"ref-for-ruby-base-box\u2466\u24ea"},{"id":"ref-for-ruby-base-box\u2466\u2460"},{"id":"ref-for-ruby-base-box\u2466\u2461"},{"id":"ref-for-ruby-base-box\u2466\u2462"},{"id":"ref-for-ruby-base-box\u2466\u2463"}],"title":"3.5. \nBidi Reordering"},{"refs":[{"id":"ref-for-ruby-base-box\u2466\u2464"},{"id":"ref-for-ruby-base-box\u2466\u2465"},{"id":"ref-for-ruby-base-box\u2466\u2466"}],"title":"4.2. \nSharing Annotation Space: the ruby-merge property"},{"refs":[{"id":"ref-for-ruby-base-box\u2466\u2467"}],"title":"4.3. \nRuby Text Distribution: the ruby-align property"},{"refs":[{"id":"ref-for-ruby-base-box\u2466\u2468"},{"id":"ref-for-ruby-base-box\u2467\u24ea"},{"id":"ref-for-ruby-base-box\u2467\u2460"}],"title":"5.1. \nOverhanging Ruby: the ruby-overhang property"},{"refs":[{"id":"ref-for-ruby-base-box\u2467\u2461"}],"title":"5.2. \nLine-edge Alignment"},{"refs":[{"id":"ref-for-ruby-base-box\u2467\u2462"}],"title":"\nA.3 Generating Parentheses"}],"url":"#ruby-base-box"},
"ruby-base-container-box": {"dfnID":"ruby-base-container-box","dfnText":"ruby base container box","external":false,"refSections":[{"refs":[{"id":"ref-for-ruby-base-container-box"}],"title":"2.1.1. \nThe Ruby Formatting Context"},{"refs":[{"id":"ref-for-ruby-base-container-box\u2460"},{"id":"ref-for-ruby-base-container-box\u2461"},{"id":"ref-for-ruby-base-container-box\u2462"},{"id":"ref-for-ruby-base-container-box\u2463"},{"id":"ref-for-ruby-base-container-box\u2464"},{"id":"ref-for-ruby-base-container-box\u2465"},{"id":"ref-for-ruby-base-container-box\u2466"},{"id":"ref-for-ruby-base-container-box\u2467"},{"id":"ref-for-ruby-base-container-box\u2468"},{"id":"ref-for-ruby-base-container-box\u2460\u24ea"},{"id":"ref-for-ruby-base-container-box\u2460\u2460"},{"id":"ref-for-ruby-base-container-box\u2460\u2461"},{"id":"ref-for-ruby-base-container-box\u2460\u2462"}],"title":"2.2. \nAnonymous Ruby Box Generation"},{"refs":[{"id":"ref-for-ruby-base-container-box\u2460\u2463"},{"id":"ref-for-ruby-base-container-box\u2460\u2464"},{"id":"ref-for-ruby-base-container-box\u2460\u2465"},{"id":"ref-for-ruby-base-container-box\u2460\u2466"},{"id":"ref-for-ruby-base-container-box\u2460\u2467"}],"title":"2.3.1. \nSegment Pairing and Annotation Levels"},{"refs":[{"id":"ref-for-ruby-base-container-box\u2460\u2468"},{"id":"ref-for-ruby-base-container-box\u2461\u24ea"},{"id":"ref-for-ruby-base-container-box\u2461\u2460"}],"title":"2.3.2. \nUnit Pairing and Spanning Annotations"},{"refs":[{"id":"ref-for-ruby-base-container-box\u2461\u2461"},{"id":"ref-for-ruby-base-container-box\u2461\u2462"}],"title":"2.5. \nWhite Space Collapsing"},{"refs":[{"id":"ref-for-ruby-base-container-box\u2461\u2463"}],"title":"3. \nRuby Layout"},{"refs":[{"id":"ref-for-ruby-base-container-box\u2461\u2464"}],"title":"3.1.1. \nInline-axis Interlinear Layout"},{"refs":[{"id":"ref-for-ruby-base-container-box\u2461\u2465"},{"id":"ref-for-ruby-base-container-box\u2461\u2466"},{"id":"ref-for-ruby-base-container-box\u2461\u2467"},{"id":"ref-for-ruby-base-container-box\u2461\u2468"},{"id":"ref-for-ruby-base-container-box\u2462\u24ea"}],"title":"3.1.2. \nBlock-axis Interlinear Layout"},{"refs":[{"id":"ref-for-ruby-base-container-box\u2462\u2460"}],"title":"3.2. \nInter-character Ruby Layout"},{"refs":[{"id":"ref-for-ruby-base-container-box\u2462\u2461"},{"id":"ref-for-ruby-base-container-box\u2462\u2462"}],"title":"3.3. \nStyling Ruby Boxes"},{"refs":[{"id":"ref-for-ruby-base-container-box\u2462\u2463"}],"title":"3.5. \nBidi Reordering"},{"refs":[{"id":"ref-for-ruby-base-container-box\u2462\u2464"},{"id":"ref-for-ruby-base-container-box\u2462\u2465"}],"title":"3.6. \nLine Spacing"},{"refs":[{"id":"ref-for-ruby-base-container-box\u2462\u2466"}],"title":"5.1. \nOverhanging Ruby: the ruby-overhang property"}],"url":"#ruby-base-container-box"},
"ruby-columns": {"dfnID":"ruby-columns","dfnText":"ruby columns","external":false,"refSections":[{"refs":[{"id":"ref-for-ruby-columns"}],"title":"2. \nRuby Box Model"},{"refs":[{"id":"ref-for-ruby-columns\u2460"}],"title":"2.3.2. \nUnit Pairing and Spanning Annotations"},{"refs":[{"id":"ref-for-ruby-columns\u2461"},{"id":"ref-for-ruby-columns\u2462"},{"id":"ref-for-ruby-columns\u2463"},{"id":"ref-for-ruby-columns\u2464"},{"id":"ref-for-ruby-columns\u2465"},{"id":"ref-for-ruby-columns\u2466"},{"id":"ref-for-ruby-columns\u2467"},{"id":"ref-for-ruby-columns\u2468"},{"id":"ref-for-ruby-columns\u2460\u24ea"},{"id":"ref-for-ruby-columns\u2460\u2460"},{"id":"ref-for-ruby-columns\u2460\u2461"}],"title":"3.1.1. \nInline-axis Interlinear Layout"},{"refs":[{"id":"ref-for-ruby-columns\u2460\u2462"},{"id":"ref-for-ruby-columns\u2460\u2463"}],"title":"3.2. \nInter-character Ruby Layout"},{"refs":[{"id":"ref-for-ruby-columns\u2460\u2464"}],"title":"4.2. \nSharing Annotation Space: the ruby-merge property"},{"refs":[{"id":"ref-for-ruby-columns\u2460\u2465"}],"title":"4.4. \nRuby Text Decoration"}],"url":"#ruby-columns"},
"ruby-container": {"dfnID":"ruby-container","dfnText":"ruby container box","external":false,"refSections":[{"refs":[{"id":"ref-for-ruby-container"},{"id":"ref-for-ruby-container\u2460"},{"id":"ref-for-ruby-container\u2461"},{"id":"ref-for-ruby-container\u2462"},{"id":"ref-for-ruby-container\u2463"},{"id":"ref-for-ruby-container\u2464"},{"id":"ref-for-ruby-container\u2465"},{"id":"ref-for-ruby-container\u2466"},{"id":"ref-for-ruby-container\u2467"},{"id":"ref-for-ruby-container\u2468"}],"title":"2.1.1. \nThe Ruby Formatting Context"},{"refs":[{"id":"ref-for-ruby-container\u2460\u24ea"},{"id":"ref-for-ruby-container\u2460\u2460"}],"title":"2.1.2. \nNon-Inline Ruby"},{"refs":[{"id":"ref-for-ruby-container\u2460\u2461"},{"id":"ref-for-ruby-container\u2460\u2462"},{"id":"ref-for-ruby-container\u2460\u2463"},{"id":"ref-for-ruby-container\u2460\u2464"},{"id":"ref-for-ruby-container\u2460\u2465"},{"id":"ref-for-ruby-container\u2460\u2466"},{"id":"ref-for-ruby-container\u2460\u2467"}],"title":"2.2. \nAnonymous Ruby Box Generation"},{"refs":[{"id":"ref-for-ruby-container\u2460\u2468"},{"id":"ref-for-ruby-container\u2461\u24ea"}],"title":"2.3.1. \nSegment Pairing and Annotation Levels"},{"refs":[{"id":"ref-for-ruby-container\u2461\u2460"}],"title":"2.3.2. \nUnit Pairing and Spanning Annotations"},{"refs":[{"id":"ref-for-ruby-container\u2461\u2461"}],"title":"2.5. \nWhite Space Collapsing"},{"refs":[{"id":"ref-for-ruby-container\u2461\u2462"},{"id":"ref-for-ruby-container\u2461\u2463"}],"title":"3. \nRuby Layout"},{"refs":[{"id":"ref-for-ruby-container\u2461\u2464"}],"title":"3.1. \nInterlinear Ruby Layout"},{"refs":[{"id":"ref-for-ruby-container\u2461\u2465"}],"title":"3.1.1. \nInline-axis Interlinear Layout"},{"refs":[{"id":"ref-for-ruby-container\u2461\u2466"},{"id":"ref-for-ruby-container\u2461\u2467"}],"title":"3.1.2. \nBlock-axis Interlinear Layout"},{"refs":[{"id":"ref-for-ruby-container\u2461\u2468"}],"title":"3.2. \nInter-character Ruby Layout"},{"refs":[{"id":"ref-for-ruby-container\u2462\u24ea"}],"title":"3.3. \nStyling Ruby Boxes"},{"refs":[{"id":"ref-for-ruby-container\u2462\u2460"}],"title":"3.4. \nBreaking Across Lines"},{"refs":[{"id":"ref-for-ruby-container\u2462\u2461"}],"title":"3.4.1. \nBreaking Between Bases"},{"refs":[{"id":"ref-for-ruby-container\u2462\u2462"},{"id":"ref-for-ruby-container\u2462\u2463"},{"id":"ref-for-ruby-container\u2462\u2464"},{"id":"ref-for-ruby-container\u2462\u2465"}],"title":"3.5. \nBidi Reordering"},{"refs":[{"id":"ref-for-ruby-container\u2462\u2466"},{"id":"ref-for-ruby-container\u2462\u2467"}],"title":"3.6. \nLine Spacing"},{"refs":[{"id":"ref-for-ruby-container\u2462\u2468"}],"title":"4.1. \nRuby Positioning: the ruby-position property"},{"refs":[{"id":"ref-for-ruby-container\u2463\u24ea"},{"id":"ref-for-ruby-container\u2463\u2460"},{"id":"ref-for-ruby-container\u2463\u2461"}],"title":"5.1. \nOverhanging Ruby: the ruby-overhang property"}],"url":"#ruby-container"},
"ruby-formatting-context": {"dfnID":"ruby-formatting-context","dfnText":"ruby formatting context","external":false,"refSections":[{"refs":[{"id":"ref-for-ruby-formatting-context"},{"id":"ref-for-ruby-formatting-context\u2460"}],"title":"2.1.1. \nThe Ruby Formatting Context"}],"url":"#ruby-formatting-context"},
"ruby-position-inter-character-annotation": {"dfnID":"ruby-position-inter-character-annotation","dfnText":"inter-character annotation","external":false,"refSections":[{"refs":[{"id":"ref-for-ruby-position-inter-character-annotation"}],"title":"2.5. \nWhite Space Collapsing"},{"refs":[{"id":"ref-for-ruby-position-inter-character-annotation\u2460"}],"title":"3. \nRuby Layout"},{"refs":[{"id":"ref-for-ruby-position-inter-character-annotation\u2461"}],"title":"3.1.1. \nInline-axis Interlinear Layout"},{"refs":[{"id":"ref-for-ruby-position-inter-character-annotation\u2462"}],"title":"3.1.2. \nBlock-axis Interlinear Layout"},{"refs":[{"id":"ref-for-ruby-position-inter-character-annotation\u2463"},{"id":"ref-for-ruby-position-inter-character-annotation\u2464"},{"id":"ref-for-ruby-position-inter-character-annotation\u2465"},{"id":"ref-for-ruby-position-inter-character-annotation\u2466"},{"id":"ref-for-ruby-position-inter-character-annotation\u2467"},{"id":"ref-for-ruby-position-inter-character-annotation\u2468"},{"id":"ref-for-ruby-position-inter-character-annotation\u2460\u24ea"},{"id":"ref-for-ruby-position-inter-character-annotation\u2460\u2460"},{"id":"ref-for-ruby-position-inter-character-annotation\u2460\u2461"}],"title":"3.2. \nInter-character Ruby Layout"},{"refs":[{"id":"ref-for-ruby-position-inter-character-annotation\u2460\u2462"}],"title":"3.4. \nBreaking Across Lines"},{"refs":[{"id":"ref-for-ruby-position-inter-character-annotation\u2460\u2463"}],"title":"3.4.2. \nBreaking Within Bases"},{"refs":[{"id":"ref-for-ruby-position-inter-character-annotation\u2460\u2464"},{"id":"ref-for-ruby-position-inter-character-annotation\u2460\u2465"}],"title":"4.1. \nRuby Positioning: the ruby-position property"},{"refs":[{"id":"ref-for-ruby-position-inter-character-annotation\u2460\u2466"}],"title":"4.2. \nSharing Annotation Space: the ruby-merge property"},{"refs":[{"id":"ref-for-ruby-position-inter-character-annotation\u2460\u2467"}],"title":"4.3. \nRuby Text Distribution: the ruby-align property"},{"refs":[{"id":"ref-for-ruby-position-inter-character-annotation\u2460\u2468"},{"id":"ref-for-ruby-position-inter-character-annotation\u2461\u24ea"}],"title":"\nChanges since the 29 April 2020 WD"}],"url":"#ruby-position-inter-character-annotation"},
"ruby-segments": {"dfnID":"ruby-segments","dfnText":"ruby segments","external":false,"refSections":[{"refs":[{"id":"ref-for-ruby-segments"},{"id":"ref-for-ruby-segments\u2460"},{"id":"ref-for-ruby-segments\u2461"},{"id":"ref-for-ruby-segments\u2462"}],"title":"2. \nRuby Box Model"},{"refs":[{"id":"ref-for-ruby-segments\u2463"}],"title":"2.3. \nAnnotation Pairing"},{"refs":[{"id":"ref-for-ruby-segments\u2464"},{"id":"ref-for-ruby-segments\u2465"}],"title":"2.3.1. \nSegment Pairing and Annotation Levels"},{"refs":[{"id":"ref-for-ruby-segments\u2466"},{"id":"ref-for-ruby-segments\u2467"},{"id":"ref-for-ruby-segments\u2468"}],"title":"2.3.2. \nUnit Pairing and Spanning Annotations"},{"refs":[{"id":"ref-for-ruby-segments\u2460\u24ea"},{"id":"ref-for-ruby-segments\u2460\u2460"},{"id":"ref-for-ruby-segments\u2460\u2461"}],"title":"2.5. \nWhite Space Collapsing"},{"refs":[{"id":"ref-for-ruby-segments\u2460\u2462"},{"id":"ref-for-ruby-segments\u2460\u2463"}],"title":"3.1.1. \nInline-axis Interlinear Layout"},{"refs":[{"id":"ref-for-ruby-segments\u2460\u2464"}],"title":"3.5. \nBidi Reordering"},{"refs":[{"id":"ref-for-ruby-segments\u2460\u2465"}],"title":"4.1. \nRuby Positioning: the ruby-position property"},{"refs":[{"id":"ref-for-ruby-segments\u2460\u2466"}],"title":"4.2. \nSharing Annotation Space: the ruby-merge property"},{"refs":[{"id":"ref-for-ruby-segments\u2460\u2467"}],"title":"4.3. \nRuby Text Distribution: the ruby-align property"}],"url":"#ruby-segments"},
"span": {"dfnID":"span","dfnText":"span","external":false,"refSections":[{"refs":[{"id":"ref-for-span"}],"title":"2.3. \nAnnotation Pairing"},{"refs":[{"id":"ref-for-span\u2460"}],"title":"2.3.2. \nUnit Pairing and Spanning Annotations"},{"refs":[{"id":"ref-for-span\u2461"}],"title":"3.1.1. \nInline-axis Interlinear Layout"},{"refs":[{"id":"ref-for-span\u2462"}],"title":"3.2. \nInter-character Ruby Layout"}],"url":"#span"},
"spanning-annotation": {"dfnID":"spanning-annotation","dfnText":"spanning annotation","external":false,"refSections":[{"refs":[{"id":"ref-for-spanning-annotation"}],"title":"2.3.2. \nUnit Pairing and Spanning Annotations"},{"refs":[{"id":"ref-for-spanning-annotation\u2460"},{"id":"ref-for-spanning-annotation\u2461"},{"id":"ref-for-spanning-annotation\u2462"},{"id":"ref-for-spanning-annotation\u2463"},{"id":"ref-for-spanning-annotation\u2464"},{"id":"ref-for-spanning-annotation\u2465"},{"id":"ref-for-spanning-annotation\u2466"},{"id":"ref-for-spanning-annotation\u2467"},{"id":"ref-for-spanning-annotation\u2468"},{"id":"ref-for-spanning-annotation\u2460\u24ea"},{"id":"ref-for-spanning-annotation\u2460\u2460"}],"title":"3.1.1. \nInline-axis Interlinear Layout"}],"url":"#spanning-annotation"},
"valdef-display-ruby": {"dfnID":"valdef-display-ruby","dfnText":"ruby","external":false,"refSections":[{"refs":[{"id":"ref-for-valdef-display-ruby"}],"title":"2.1.2. \nNon-Inline Ruby"}],"url":"#valdef-display-ruby"},
"valdef-display-ruby-base": {"dfnID":"valdef-display-ruby-base","dfnText":"ruby-base","external":false,"refSections":[],"url":"#valdef-display-ruby-base"},
"valdef-display-ruby-base-container": {"dfnID":"valdef-display-ruby-base-container","dfnText":"ruby-base-container","external":false,"refSections":[],"url":"#valdef-display-ruby-base-container"},
"valdef-display-ruby-text": {"dfnID":"valdef-display-ruby-text","dfnText":"ruby-text","external":false,"refSections":[],"url":"#valdef-display-ruby-text"},
"valdef-display-ruby-text-container": {"dfnID":"valdef-display-ruby-text-container","dfnText":"ruby-text-container","external":false,"refSections":[],"url":"#valdef-display-ruby-text-container"},
"valdef-ruby-align-center": {"dfnID":"valdef-ruby-align-center","dfnText":"center","external":false,"refSections":[{"refs":[{"id":"ref-for-valdef-ruby-align-center"}],"title":"4.3. \nRuby Text Distribution: the ruby-align property"}],"url":"#valdef-ruby-align-center"},
"valdef-ruby-align-space-around": {"dfnID":"valdef-ruby-align-space-around","dfnText":"space-around","external":false,"refSections":[{"refs":[{"id":"ref-for-valdef-ruby-align-space-around"},{"id":"ref-for-valdef-ruby-align-space-around\u2460"},{"id":"ref-for-valdef-ruby-align-space-around\u2461"}],"title":"4.3. \nRuby Text Distribution: the ruby-align property"},{"refs":[{"id":"ref-for-valdef-ruby-align-space-around\u2462"},{"id":"ref-for-valdef-ruby-align-space-around\u2463"},{"id":"ref-for-valdef-ruby-align-space-around\u2464"}],"title":"\nChanges since the 30 June 2011 WD"}],"url":"#valdef-ruby-align-space-around"},
"valdef-ruby-align-space-between": {"dfnID":"valdef-ruby-align-space-between","dfnText":"space-between","external":false,"refSections":[{"refs":[{"id":"ref-for-valdef-ruby-align-space-between"},{"id":"ref-for-valdef-ruby-align-space-between\u2460"},{"id":"ref-for-valdef-ruby-align-space-between\u2461"},{"id":"ref-for-valdef-ruby-align-space-between\u2462"}],"title":"4.3. \nRuby Text Distribution: the ruby-align property"},{"refs":[{"id":"ref-for-valdef-ruby-align-space-between\u2463"},{"id":"ref-for-valdef-ruby-align-space-between\u2464"}],"title":"\nChanges since the 30 June 2011 WD"}],"url":"#valdef-ruby-align-space-between"},
"valdef-ruby-align-start": {"dfnID":"valdef-ruby-align-start","dfnText":"start","external":false,"refSections":[{"refs":[{"id":"ref-for-valdef-ruby-align-start"}],"title":"3.2. \nInter-character Ruby Layout"},{"refs":[{"id":"ref-for-valdef-ruby-align-start\u2460"},{"id":"ref-for-valdef-ruby-align-start\u2461"},{"id":"ref-for-valdef-ruby-align-start\u2462"}],"title":"4.3. \nRuby Text Distribution: the ruby-align property"}],"url":"#valdef-ruby-align-start"},
"valdef-ruby-merge-auto": {"dfnID":"valdef-ruby-merge-auto","dfnText":"auto","external":false,"refSections":[{"refs":[{"id":"ref-for-valdef-ruby-merge-auto"}],"title":"2.4. \nHiding Annotations: visibility: collapse and auto-hidden ruby"},{"refs":[{"id":"ref-for-valdef-ruby-merge-auto\u2460"}],"title":"4.3. \nRuby Text Distribution: the ruby-align property"}],"url":"#valdef-ruby-merge-auto"},
"valdef-ruby-merge-merge": {"dfnID":"valdef-ruby-merge-merge","dfnText":"merge","external":false,"refSections":[{"refs":[{"id":"ref-for-valdef-ruby-merge-merge"}],"title":"2.4. \nHiding Annotations: visibility: collapse and auto-hidden ruby"},{"refs":[{"id":"ref-for-valdef-ruby-merge-merge\u2460"}],"title":"3.5. \nBidi Reordering"},{"refs":[{"id":"ref-for-valdef-ruby-merge-merge\u2461"}],"title":"4.2. \nSharing Annotation Space: the ruby-merge property"},{"refs":[{"id":"ref-for-valdef-ruby-merge-merge\u2462"}],"title":"\nChanges since the 29 April 2020 WD"}],"url":"#valdef-ruby-merge-merge"},
"valdef-ruby-merge-separate": {"dfnID":"valdef-ruby-merge-separate","dfnText":"separate","external":false,"refSections":[{"refs":[{"id":"ref-for-valdef-ruby-merge-separate"}],"title":"2.4. \nHiding Annotations: visibility: collapse and auto-hidden ruby"},{"refs":[{"id":"ref-for-valdef-ruby-merge-separate\u2460"}],"title":"3.1.1. \nInline-axis Interlinear Layout"},{"refs":[{"id":"ref-for-valdef-ruby-merge-separate\u2461"},{"id":"ref-for-valdef-ruby-merge-separate\u2462"}],"title":"4.2. \nSharing Annotation Space: the ruby-merge property"}],"url":"#valdef-ruby-merge-separate"},
"valdef-ruby-overhang-auto": {"dfnID":"valdef-ruby-overhang-auto","dfnText":"auto","external":false,"refSections":[],"url":"#valdef-ruby-overhang-auto"},
"valdef-ruby-overhang-none": {"dfnID":"valdef-ruby-overhang-none","dfnText":"none","external":false,"refSections":[],"url":"#valdef-ruby-overhang-none"},
"valdef-ruby-position-alternate": {"dfnID":"valdef-ruby-position-alternate","dfnText":"alternate","external":false,"refSections":[{"refs":[{"id":"ref-for-valdef-ruby-position-alternate"},{"id":"ref-for-valdef-ruby-position-alternate\u2460"},{"id":"ref-for-valdef-ruby-position-alternate\u2461"},{"id":"ref-for-valdef-ruby-position-alternate\u2462"}],"title":"4.1. \nRuby Positioning: the ruby-position property"},{"refs":[{"id":"ref-for-valdef-ruby-position-alternate\u2463"}],"title":"\nChanges since the 29 April 2020 WD"}],"url":"#valdef-ruby-position-alternate"},
"valdef-ruby-position-inter-character": {"dfnID":"valdef-ruby-position-inter-character","dfnText":"inter-character","external":false,"refSections":[{"refs":[{"id":"ref-for-valdef-ruby-position-inter-character"}],"title":"3.2. \nInter-character Ruby Layout"},{"refs":[{"id":"ref-for-valdef-ruby-position-inter-character\u2460"}],"title":"3.4. \nBreaking Across Lines"},{"refs":[{"id":"ref-for-valdef-ruby-position-inter-character\u2461"}],"title":"\nChanges since the 30 June 2011 WD"}],"url":"#valdef-ruby-position-inter-character"},
"valdef-ruby-position-over": {"dfnID":"valdef-ruby-position-over","dfnText":"over","external":false,"refSections":[{"refs":[{"id":"ref-for-valdef-ruby-position-over"},{"id":"ref-for-valdef-ruby-position-over\u2460"},{"id":"ref-for-valdef-ruby-position-over\u2461"},{"id":"ref-for-valdef-ruby-position-over\u2462"},{"id":"ref-for-valdef-ruby-position-over\u2463"},{"id":"ref-for-valdef-ruby-position-over\u2464"}],"title":"4.1. \nRuby Positioning: the ruby-position property"}],"url":"#valdef-ruby-position-over"},
"valdef-ruby-position-under": {"dfnID":"valdef-ruby-position-under","dfnText":"under","external":false,"refSections":[{"refs":[{"id":"ref-for-valdef-ruby-position-under"},{"id":"ref-for-valdef-ruby-position-under\u2460"},{"id":"ref-for-valdef-ruby-position-under\u2461"},{"id":"ref-for-valdef-ruby-position-under\u2462"},{"id":"ref-for-valdef-ruby-position-under\u2463"}],"title":"4.1. \nRuby Positioning: the ruby-position property"}],"url":"#valdef-ruby-position-under"},
"zhuyin-fuhao": {"dfnID":"zhuyin-fuhao","dfnText":"Zhuyin Fuhao","external":false,"refSections":[],"url":"#zhuyin-fuhao"},
};

document.addEventListener("DOMContentLoaded", ()=>{
    genAllDfnPanels();

    document.body.addEventListener("click", (e) => {
        // If not handled already, just hide all dfn panels.
        hideAllDfnPanels();
    });
});

window.addEventListener("resize", () => {
    // Pin any visible dfn panel
    queryAll(".dfn-panel.on, .dfn-panel.activated").forEach(el=>positionDfnPanel(el));
});

function genAllDfnPanels() {
    for(const panelData of Object.values(dfnPanelData)) {
        const dfnID = panelData.dfnID;
        const dfn = document.getElementById(dfnID);
        if(!dfn) {
            console.log(`Can't find dfn#${dfnID}.`, panelData);
            continue;
        }
        dfn.panelData = panelData;
        insertDfnPopupAction(dfn);
    }
}

function genDfnPanel(dfn, { dfnID, url, dfnText, refSections, external }) {
    const dfnPanel = mk.aside({
        class: "dfn-panel on",
        id: `infopanel-for-${dfnID}`,
        "data-for": dfnID,
        "aria-labelled-by":`infopaneltitle-for-${dfnID}`,
        },
        mk.span({id:`infopaneltitle-for-${dfnID}`, style:"display:none"},
            `Info about the '${dfnText}' ${external?"external":""} reference.`),
        mk.a({href:url, class:"dfn-link"}, url),
        refSections.length == 0 ? [] :
            mk.b({}, "Referenced in:"),
            mk.ul({},
                ...refSections.map(section=>
                    mk.li({},
                        ...section.refs.map((ref, refI)=>
                            [
                                mk.a({ href: `#${ref.id}` },
                                    (refI == 0) ? section.title : `(${refI + 1})`
                                ),
                                " ",
                            ]
                        ),
                    ),
                ),
            ),
        genLinkingSyntaxes(dfn),
    );

    dfnPanel.addEventListener('click', (event) => {
        if (event.target.nodeName == 'A') {
            scrollToTargetAndHighlight(event);
            pinDfnPanel(dfnPanel);
        }
        event.stopPropagation();
        refocusOnTarget(event);
    });
    dfnPanel.addEventListener('keydown', (event) => {
        if(event.keyCode == 27) { // Escape key
            hideDfnPanel({dfnPanel});
            event.stopPropagation();
            event.preventDefault();
        }
    });

    dfnPanel.dfn = dfn;
    dfn.dfnPanel = dfnPanel;
    return dfnPanel;
}



function hideAllDfnPanels() {
    // Delete the currently-active dfn panel.
    queryAll(".dfn-panel").forEach(dfnPanel=>hideDfnPanel({dfnPanel}));
}

function showDfnPanel(dfn) {
    hideAllDfnPanels(); // Only display one at a time.

    dfn.setAttribute("aria-expanded", "true");

    const dfnPanel = genDfnPanel(dfn, dfn.panelData);

    // Give the dfn a unique tabindex, and then
    // give all the tabbable panel bits successive indexes.
    let tabIndex = 100;
    dfn.tabIndex = tabIndex++;
    const tabbable = dfnPanel.querySelectorAll(":is(a, button)");
    for (const el of tabbable) {
        el.tabIndex = tabIndex++;
    }

    append(document.body, dfnPanel);
    positionDfnPanel(dfnPanel);
}

function positionDfnPanel(dfnPanel) {
    const dfn = dfnPanel.dfn;
    const dfnPos = getBounds(dfn);
    dfnPanel.style.top = dfnPos.bottom + "px";
    dfnPanel.style.left = dfnPos.left + "px";

    const panelPos = dfnPanel.getBoundingClientRect();
    const panelMargin = 8;
    const maxRight = document.body.parentNode.clientWidth - panelMargin;
    if (panelPos.right > maxRight) {
        const overflowAmount = panelPos.right - maxRight;
        const newLeft = Math.max(panelMargin, dfnPos.left - overflowAmount);
        dfnPanel.style.left = newLeft + "px";
    }
}

function pinDfnPanel(dfnPanel) {
    // Switch it to "activated" state, which pins it.
    dfnPanel.classList.add("activated");
    dfnPanel.style.position = "fixed";
    dfnPanel.style.left = null;
    dfnPanel.style.top = null;
}

function hideDfnPanel({dfn, dfnPanel}) {
    if(!dfnPanel) dfnPanel = dfn.dfnPanel;
    if(!dfn) dfn = dfnPanel.dfn;
    dfn.dfnPanel = undefined;
    dfnPanel.dfn = undefined;
    dfn.setAttribute("aria-expanded", "false");
    dfn.tabIndex = undefined;
    dfnPanel.remove()
}

function toggleDfnPanel(dfn) {
    if(dfn.dfnPanel) {
        hideDfnPanel(dfn);
    } else {
        showDfnPanel(dfn);
    }
}

function insertDfnPopupAction(dfn) {
    dfn.setAttribute('role', 'button');
    dfn.setAttribute('aria-expanded', 'false')
    dfn.tabIndex = 0;
    dfn.classList.add('has-dfn-panel');
    dfn.addEventListener('click', (event) => {
        toggleDfnPanel(dfn);
        event.stopPropagation();
    });
    dfn.addEventListener('keypress', (event) => {
        const kc = event.keyCode;
        // 32->Space, 13->Enter
        if(kc == 32 || kc == 13) {
            toggleDfnPanel(dfn);
            event.stopPropagation();
            event.preventDefault();
        }
    });
}

function refocusOnTarget(event) {
    const target = event.target;
    setTimeout(() => {
        // Refocus on the event.target element.
        // This is needed after browser scrolls to the destination.
        target.focus();
    });
}

// TODO: shared util
// Returns the root-level absolute position {left and top} of element.
function getBounds(el, relativeTo=document.body) {
    const relativeRect = relativeTo.getBoundingClientRect();
    const elRect = el.getBoundingClientRect();
    const top = elRect.top - relativeRect.top;
    const left = elRect.left - relativeRect.left;
    return {
        top,
        left,
        bottom: top + elRect.height,
        right: left + elRect.width,
    }
}

function scrollToTargetAndHighlight(event) {
    let hash = event.target.hash;
    if (hash) {
        hash = decodeURIComponent(hash.substring(1));
        const dest = document.getElementById(hash);
        if (dest) {
            dest.classList.add('highlighted');
            setTimeout(() => dest.classList.remove('highlighted'), 1000);
        }
    }
}

// Functions, divided by link type, that wrap an autolink's
// contents with the appropriate outer syntax.
// Alternately, a string naming another type they format
// the same as.
function needsFor(type) {
    switch(type) {
        case "descriptor":
        case "value":
        case "element-attr":
        case "attr-value":
        case "element-state":
        case "method":
        case "constructor":
        case "argument":
        case "attribute":
        case "const":
        case "dict-member":
        case "event":
        case "enum-value":
        case "stringifier":
        case "serializer":
        case "iterator":
        case "maplike":
        case "setlike":
        case "state":
        case "mode":
        case "context":
        case "facet": return true;

        default: return false;
    }
}
function refusesFor(type) {
    switch(type) {
        case "property":
        case "element":
        case "interface":
        case "namespace":
        case "callback":
        case "dictionary":
        case "enum":
        case "exception":
        case "typedef":
        case "http-header":
        case "permission": return true;

        default: return false;
    }
}
function linkFormatterFromType(type) {
    switch(type) {
        case 'scheme':
        case 'permission':
        case 'dfn': return (text) => `[=${text}=]`;

        case 'abstract-op': return (text) => `[\$${text}\$]`;

        case 'function':
        case 'at-rule':
        case 'selector':
        case 'value': return (text) => `''${text}''`;

        case 'http-header': return (text) => `[:${text}:]`;

        case 'interface':
        case 'constructor':
        case 'method':
        case 'argument':
        case 'attribute':
        case 'callback':
        case 'dictionary':
        case 'dict-member':
        case 'enum':
        case 'enum-value':
        case 'exception':
        case 'const':
        case 'typedef':
        case 'stringifier':
        case 'serializer':
        case 'iterator':
        case 'maplike':
        case 'setlike':
        case 'extended-attribute':
        case 'event':
        case 'idl': return (text) => `{{${text}}}`;

        case 'element-state':
        case 'element-attr':
        case 'attr-value':
        case 'element': return (element) => `<{${element}}>`;

        case 'grammar': return (text) => `${text} (within a <pre class=prod>)`;

        case 'type': return (text)=> `<<${text}>>`;

        case 'descriptor':
        case 'property': return (text) => `'${text}'`;

        default: return;
    };
};

function genLinkingSyntaxes(dfn) {
    if(dfn.tagName != "DFN") return;

    const type = dfn.getAttribute('data-dfn-type');
    if(!type) {
        console.log(`<dfn> doesn't have a data-dfn-type:`, dfn);
        return [];
    }

    // Return a function that wraps link text based on the type
    const linkFormatter = linkFormatterFromType(type);
    if(!linkFormatter) {
        console.log(`<dfn> has an unknown data-dfn-type:`, dfn);
        return [];
    }

    let ltAlts;
    if(dfn.hasAttribute('data-lt')) {
        ltAlts = dfn.getAttribute('data-lt')
            .split("|")
            .map(x=>x.trim());
    } else {
        ltAlts = [dfn.textContent.trim()];
    }
    if(type == "type") {
        // lt of "<foo>", but "foo" is the interior;
        // <<foo/bar>> is how you write it with a for,
        // not <foo/<bar>> or whatever.
        for(var i = 0; i < ltAlts.length; i++) {
            const lt = ltAlts[i];
            const match = /<(.*)>/.exec(lt);
            if(match) { ltAlts[i] = match[1]; }
        }
    }

    let forAlts;
    if(dfn.hasAttribute('data-dfn-for')) {
        forAlts = dfn.getAttribute('data-dfn-for')
            .split(",")
            .map(x=>x.trim());
    } else {
        forAlts = [''];
    }

    let linkingSyntaxes = [];
    if(!needsFor(type)) {
        for(const lt of ltAlts) {
            linkingSyntaxes.push(linkFormatter(lt));
        }
    }
    if(!refusesFor(type)) {
        for(const f of forAlts) {
            linkingSyntaxes.push(linkFormatter(`${f}/${ltAlts[0]}`))
        }
    }
    return [
        mk.b({}, 'Possible linking syntaxes:'),
        mk.ul({},
            ...linkingSyntaxes.map(link => {
                const copyLink = async () =>
                    await navigator.clipboard.writeText(link);
                return mk.li({},
                    mk.div({ class: 'link-item' },
                        mk.button({
                            class: 'copy-icon', title: 'Copy',
                            type: 'button',
                            _onclick: copyLink,
                            tabindex: 0,
                        }, mk.span({ class: 'icon' }) ),
                        mk.span({}, link)
                    )
                );
            })
        )
    ];
}
}
</script>
<script>/* Boilerplate: script-position-annos */
"use strict";
{
function repositionAnnoPanels(){
    const panels = [...document.querySelectorAll("[data-anno-for]")];
    hydratePanels(panels);
    let vSoFar = 0;
    for(const panel of panels.sort(cmpTops)) {
        if(panel.top < vSoFar) {
            panel.top = vSoFar;
            panel.style.top = vSoFar + "px";
        }
        vSoFar = panel.top + panel.height + 15;
    }
}
function hydratePanels(panels) {
    const main = document.querySelector("main");
    let mainRect;
    if(main) mainRect = main.getBoundingClientRect();
    // First display them all, if they're not already visible.
    for(const panel of panels) {
        panel.classList.remove("unpositioned");
    }
    // Measure them all
    for(const panel of panels) {
        const dfn = document.getElementById(panel.getAttribute("data-anno-for"));
        if(!dfn) {
            console.log("Can't find the annotation panel target:", panel);
            continue;
        }
        panel.dfn = dfn;
        panel.top = window.scrollY + dfn.getBoundingClientRect().top;
        let panelRect = panel.getBoundingClientRect();
        panel.height = panelRect.height;
        if(main) {
            panel.overlappingMain = panelRect.left < mainRect.right;
        } else {
            panel.overlappingMain = false;
        }
    }
    // And finally position them
    for(const panel of panels) {
        const dfn = panel.dfn;
        if(!dfn) continue;
        panel.style.top = panel.top + "px";
        panel.classList.toggle("overlapping-main", panel.overlappingMain);
    }
}

function cmpTops(a,b) {
    return a.top - b.top;
}

window.addEventListener("load", repositionAnnoPanels);
window.addEventListener("resize", repositionAnnoPanels);
}
</script>
<script>/* Boilerplate: script-ref-hints */
"use strict";
{
let refsData = {
"#annotation-level": {"displayText":"annotation level","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-ruby","spec":"css-ruby-1","status":"local","text":"annotation level","type":"dfn","url":"#annotation-level"},
"#auto-hidden": {"displayText":"auto-hide","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-ruby","spec":"css-ruby-1","status":"local","text":"auto-hide","type":"dfn","url":"#auto-hidden"},
"#base-level": {"displayText":"base text level","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-ruby","spec":"css-ruby-1","status":"local","text":"base text level","type":"dfn","url":"#base-level"},
"#bopomofo-tone-marks": {"displayText":"bopomofo tone marks","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-ruby","spec":"css-ruby-1","status":"local","text":"bopomofo tone marks","type":"dfn","url":"#bopomofo-tone-marks"},
"#hidden-annotation": {"displayText":"hidden","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-ruby","spec":"css-ruby-1","status":"local","text":"hidden","type":"dfn","url":"#hidden-annotation"},
"#inter-annotation-white-space": {"displayText":"inter-annotation white space","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-ruby","spec":"css-ruby-1","status":"local","text":"inter-annotation white space","type":"dfn","url":"#inter-annotation-white-space"},
"#inter-base-white-space": {"displayText":"inter-base white space","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-ruby","spec":"css-ruby-1","status":"local","text":"inter-base white space","type":"dfn","url":"#inter-base-white-space"},
"#inter-segment-white-space": {"displayText":"inter-segment white space","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-ruby","spec":"css-ruby-1","status":"local","text":"inter-segment white space","type":"dfn","url":"#inter-segment-white-space"},
"#interlinear-annotations": {"displayText":"interlinear","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-ruby","spec":"css-ruby-1","status":"local","text":"interlinear","type":"dfn","url":"#interlinear-annotations"},
"#internal-ruby-boxes": {"displayText":"internal ruby boxes","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-ruby","spec":"css-ruby-1","status":"local","text":"internal ruby boxes","type":"dfn","url":"#internal-ruby-boxes"},
"#intra-level-white-space": {"displayText":"intra-level white space","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-ruby","spec":"css-ruby-1","status":"local","text":"intra-level white space","type":"dfn","url":"#intra-level-white-space"},
"#intra-ruby-white-space": {"displayText":"intra-ruby white space","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-ruby","spec":"css-ruby-1","status":"local","text":"intra-ruby white space","type":"dfn","url":"#intra-ruby-white-space"},
"#merged-annotation": {"displayText":"merged annotation","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-ruby","spec":"css-ruby-1","status":"local","text":"merged annotation","type":"dfn","url":"#merged-annotation"},
"#pairing": {"displayText":"pairing","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-ruby","spec":"css-ruby-1","status":"local","text":"pairing","type":"dfn","url":"#pairing"},
"#propdef-ruby-align": {"displayText":"ruby-align","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-ruby","spec":"css-ruby-1","status":"local","text":"ruby-align","type":"property","url":"#propdef-ruby-align"},
"#propdef-ruby-merge": {"displayText":"ruby-merge","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-ruby","spec":"css-ruby-1","status":"local","text":"ruby-merge","type":"property","url":"#propdef-ruby-merge"},
"#propdef-ruby-overhang": {"displayText":"ruby-overhang","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-ruby","spec":"css-ruby-1","status":"local","text":"ruby-overhang","type":"property","url":"#propdef-ruby-overhang"},
"#propdef-ruby-position": {"displayText":"ruby-position","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-ruby","spec":"css-ruby-1","status":"local","text":"ruby-position","type":"property","url":"#propdef-ruby-position"},
"#ruby": {"displayText":"ruby","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-ruby","spec":"css-ruby-1","status":"local","text":"ruby","type":"dfn","url":"#ruby"},
"#ruby-annotation-box": {"displayText":"ruby annotation","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-ruby","spec":"css-ruby-1","status":"local","text":"ruby annotation","type":"dfn","url":"#ruby-annotation-box"},
"#ruby-annotation-container-box": {"displayText":"ruby annotation container","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-ruby","spec":"css-ruby-1","status":"local","text":"ruby annotation container","type":"dfn","url":"#ruby-annotation-container-box"},
"#ruby-base-box": {"displayText":"ruby base","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-ruby","spec":"css-ruby-1","status":"local","text":"ruby base","type":"dfn","url":"#ruby-base-box"},
"#ruby-base-container-box": {"displayText":"ruby base container","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-ruby","spec":"css-ruby-1","status":"local","text":"ruby base container","type":"dfn","url":"#ruby-base-container-box"},
"#ruby-columns": {"displayText":"column","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-ruby","spec":"css-ruby-1","status":"local","text":"column","type":"dfn","url":"#ruby-columns"},
"#ruby-container": {"displayText":"ruby container","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-ruby","spec":"css-ruby-1","status":"local","text":"ruby container","type":"dfn","url":"#ruby-container"},
"#ruby-formatting-context": {"displayText":"ruby formatting context","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-ruby","spec":"css-ruby-1","status":"local","text":"ruby formatting context","type":"dfn","url":"#ruby-formatting-context"},
"#ruby-position-inter-character-annotation": {"displayText":"inter-character annotation","export":true,"for_":["ruby-position"],"level":"1","normative":true,"shortname":"css-ruby","spec":"css-ruby-1","status":"local","text":"inter-character annotation","type":"dfn","url":"#ruby-position-inter-character-annotation"},
"#ruby-segments": {"displayText":"ruby segments","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-ruby","spec":"css-ruby-1","status":"local","text":"ruby segments","type":"dfn","url":"#ruby-segments"},
"#span": {"displayText":"span","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-ruby","spec":"css-ruby-1","status":"local","text":"span","type":"dfn","url":"#span"},
"#spanning-annotation": {"displayText":"spanning annotation","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-ruby","spec":"css-ruby-1","status":"local","text":"spanning annotation","type":"dfn","url":"#spanning-annotation"},
"#valdef-display-ruby": {"displayText":"ruby","export":true,"for_":["display"],"level":"1","normative":true,"shortname":"css-ruby","spec":"css-ruby-1","status":"local","text":"ruby","type":"value","url":"#valdef-display-ruby"},
"#valdef-ruby-align-center": {"displayText":"center","export":true,"for_":["ruby-align"],"level":"1","normative":true,"shortname":"css-ruby","spec":"css-ruby-1","status":"local","text":"center","type":"value","url":"#valdef-ruby-align-center"},
"#valdef-ruby-align-space-around": {"displayText":"space-around","export":true,"for_":["ruby-align"],"level":"1","normative":true,"shortname":"css-ruby","spec":"css-ruby-1","status":"local","text":"space-around","type":"value","url":"#valdef-ruby-align-space-around"},
"#valdef-ruby-align-space-between": {"displayText":"space-between","export":true,"for_":["ruby-align"],"level":"1","normative":true,"shortname":"css-ruby","spec":"css-ruby-1","status":"local","text":"space-between","type":"value","url":"#valdef-ruby-align-space-between"},
"#valdef-ruby-align-start": {"displayText":"start","export":true,"for_":["ruby-align"],"level":"1","normative":true,"shortname":"css-ruby","spec":"css-ruby-1","status":"local","text":"start","type":"value","url":"#valdef-ruby-align-start"},
"#valdef-ruby-merge-auto": {"displayText":"auto","export":true,"for_":["ruby-merge"],"level":"1","normative":true,"shortname":"css-ruby","spec":"css-ruby-1","status":"local","text":"auto","type":"value","url":"#valdef-ruby-merge-auto"},
"#valdef-ruby-merge-merge": {"displayText":"merge","export":true,"for_":["ruby-merge"],"level":"1","normative":true,"shortname":"css-ruby","spec":"css-ruby-1","status":"local","text":"merge","type":"value","url":"#valdef-ruby-merge-merge"},
"#valdef-ruby-merge-separate": {"displayText":"separate","export":true,"for_":["ruby-merge"],"level":"1","normative":true,"shortname":"css-ruby","spec":"css-ruby-1","status":"local","text":"separate","type":"value","url":"#valdef-ruby-merge-separate"},
"#valdef-ruby-position-alternate": {"displayText":"alternate","export":true,"for_":["ruby-position"],"level":"1","normative":true,"shortname":"css-ruby","spec":"css-ruby-1","status":"local","text":"alternate","type":"value","url":"#valdef-ruby-position-alternate"},
"#valdef-ruby-position-inter-character": {"displayText":"inter-character","export":true,"for_":["ruby-position"],"level":"1","normative":true,"shortname":"css-ruby","spec":"css-ruby-1","status":"local","text":"inter-character","type":"value","url":"#valdef-ruby-position-inter-character"},
"#valdef-ruby-position-over": {"displayText":"over","export":true,"for_":["ruby-position"],"level":"1","normative":true,"shortname":"css-ruby","spec":"css-ruby-1","status":"local","text":"over","type":"value","url":"#valdef-ruby-position-over"},
"#valdef-ruby-position-under": {"displayText":"under","export":true,"for_":["ruby-position"],"level":"1","normative":true,"shortname":"css-ruby","spec":"css-ruby-1","status":"local","text":"under","type":"value","url":"#valdef-ruby-position-under"},
"https://drafts.csswg.org/css-box-4/#border": {"displayText":"border","export":true,"for_":[],"level":"4","normative":true,"shortname":"css-box","spec":"css-box-4","status":"current","text":"border","type":"dfn","url":"https://drafts.csswg.org/css-box-4/#border"},
"https://drafts.csswg.org/css-box-4/#content-area": {"displayText":"content area","export":true,"for_":[],"level":"4","normative":true,"shortname":"css-box","spec":"css-box-4","status":"current","text":"content area","type":"dfn","url":"https://drafts.csswg.org/css-box-4/#content-area"},
"https://drafts.csswg.org/css-box-4/#content-box": {"displayText":"content box","export":true,"for_":[],"level":"4","normative":true,"shortname":"css-box","spec":"css-box-4","status":"current","text":"content box","type":"dfn","url":"https://drafts.csswg.org/css-box-4/#content-box"},
"https://drafts.csswg.org/css-box-4/#margin": {"displayText":"margin","export":true,"for_":[],"level":"4","normative":true,"shortname":"css-box","spec":"css-box-4","status":"current","text":"margin","type":"dfn","url":"https://drafts.csswg.org/css-box-4/#margin"},
"https://drafts.csswg.org/css-box-4/#margin-box": {"displayText":"margin box","export":true,"for_":[],"level":"4","normative":true,"shortname":"css-box","spec":"css-box-4","status":"current","text":"margin box","type":"dfn","url":"https://drafts.csswg.org/css-box-4/#margin-box"},
"https://drafts.csswg.org/css-box-4/#padding": {"displayText":"padding","export":true,"for_":[],"level":"4","normative":true,"shortname":"css-box","spec":"css-box-4","status":"current","text":"padding","type":"dfn","url":"https://drafts.csswg.org/css-box-4/#padding"},
"https://drafts.csswg.org/css-box-4/#propdef-padding": {"displayText":"padding","export":true,"for_":[],"level":"4","normative":true,"shortname":"css-box","spec":"css-box-4","status":"current","text":"padding","type":"property","url":"https://drafts.csswg.org/css-box-4/#propdef-padding"},
"https://drafts.csswg.org/css-cascade-5/#computed-value": {"displayText":"computed value","export":true,"for_":[],"level":"5","normative":true,"shortname":"css-cascade","spec":"css-cascade-5","status":"current","text":"computed value","type":"dfn","url":"https://drafts.csswg.org/css-cascade-5/#computed-value"},
"https://drafts.csswg.org/css-cascade-5/#initial-value": {"displayText":"initial value","export":true,"for_":[],"level":"5","normative":true,"shortname":"css-cascade","spec":"css-cascade-5","status":"current","text":"initial value","type":"dfn","url":"https://drafts.csswg.org/css-cascade-5/#initial-value"},
"https://drafts.csswg.org/css-display-4/#atomic-inline": {"displayText":"atomic inline","export":true,"for_":[],"level":"4","normative":true,"shortname":"css-display","spec":"css-display-4","status":"current","text":"atomic inline","type":"dfn","url":"https://drafts.csswg.org/css-display-4/#atomic-inline"},
"https://drafts.csswg.org/css-display-4/#block-container": {"displayText":"block container","export":true,"for_":[],"level":"4","normative":true,"shortname":"css-display","spec":"css-display-4","status":"current","text":"block container","type":"dfn","url":"https://drafts.csswg.org/css-display-4/#block-container"},
"https://drafts.csswg.org/css-display-4/#containing-block": {"displayText":"containing block","export":true,"for_":[],"level":"4","normative":true,"shortname":"css-display","spec":"css-display-4","status":"current","text":"containing block","type":"dfn","url":"https://drafts.csswg.org/css-display-4/#containing-block"},
"https://drafts.csswg.org/css-display-4/#formatting-context": {"displayText":"formatting context","export":true,"for_":[],"level":"4","normative":true,"shortname":"css-display","spec":"css-display-4","status":"current","text":"formatting context","type":"dfn","url":"https://drafts.csswg.org/css-display-4/#formatting-context"},
"https://drafts.csswg.org/css-display-4/#in-flow": {"displayText":"in-flow","export":true,"for_":[],"level":"4","normative":true,"shortname":"css-display","spec":"css-display-4","status":"current","text":"in-flow","type":"dfn","url":"https://drafts.csswg.org/css-display-4/#in-flow"},
"https://drafts.csswg.org/css-display-4/#independent-formatting-context": {"displayText":"independent formatting context","export":true,"for_":[],"level":"4","normative":true,"shortname":"css-display","spec":"css-display-4","status":"current","text":"independent formatting context","type":"dfn","url":"https://drafts.csswg.org/css-display-4/#independent-formatting-context"},
"https://drafts.csswg.org/css-display-4/#inline-block": {"displayText":"inline block","export":true,"for_":[],"level":"4","normative":true,"shortname":"css-display","spec":"css-display-4","status":"current","text":"inline block","type":"dfn","url":"https://drafts.csswg.org/css-display-4/#inline-block"},
"https://drafts.csswg.org/css-display-4/#inline-box": {"displayText":"inline box","export":true,"for_":[],"level":"4","normative":true,"shortname":"css-display","spec":"css-display-4","status":"current","text":"inline box","type":"dfn","url":"https://drafts.csswg.org/css-display-4/#inline-box"},
"https://drafts.csswg.org/css-display-4/#inline-formatting-context": {"displayText":"inline formatting context","export":true,"for_":[],"level":"4","normative":true,"shortname":"css-display","spec":"css-display-4","status":"current","text":"inline formatting context","type":"dfn","url":"https://drafts.csswg.org/css-display-4/#inline-formatting-context"},
"https://drafts.csswg.org/css-display-4/#inline-level": {"displayText":"inline-level","export":true,"for_":[],"level":"4","normative":true,"shortname":"css-display","spec":"css-display-4","status":"current","text":"inline-level","type":"dfn","url":"https://drafts.csswg.org/css-display-4/#inline-level"},
"https://drafts.csswg.org/css-display-4/#inlinify": {"displayText":"inlinify","export":true,"for_":[],"level":"4","normative":true,"shortname":"css-display","spec":"css-display-4","status":"current","text":"inlinify","type":"dfn","url":"https://drafts.csswg.org/css-display-4/#inlinify"},
"https://drafts.csswg.org/css-display-4/#inner-display-type": {"displayText":"inner display type","export":true,"for_":[],"level":"4","normative":true,"shortname":"css-display","spec":"css-display-4","status":"current","text":"inner display type","type":"dfn","url":"https://drafts.csswg.org/css-display-4/#inner-display-type"},
"https://drafts.csswg.org/css-display-4/#internal-table-element": {"displayText":"internal table element","export":true,"for_":[],"level":"4","normative":true,"shortname":"css-display","spec":"css-display-4","status":"current","text":"internal table element","type":"dfn","url":"https://drafts.csswg.org/css-display-4/#internal-table-element"},
"https://drafts.csswg.org/css-display-4/#outer-display-type": {"displayText":"outer display type","export":true,"for_":[],"level":"4","normative":true,"shortname":"css-display","spec":"css-display-4","status":"current","text":"outer display type","type":"dfn","url":"https://drafts.csswg.org/css-display-4/#outer-display-type"},
"https://drafts.csswg.org/css-display-4/#propdef-display": {"displayText":"display","export":true,"for_":[],"level":"4","normative":true,"shortname":"css-display","spec":"css-display-4","status":"current","text":"display","type":"property","url":"https://drafts.csswg.org/css-display-4/#propdef-display"},
"https://drafts.csswg.org/css-display-4/#propdef-visibility": {"displayText":"visibility","export":true,"for_":[],"level":"4","normative":true,"shortname":"css-display","spec":"css-display-4","status":"current","text":"visibility","type":"property","url":"https://drafts.csswg.org/css-display-4/#propdef-visibility"},
"https://drafts.csswg.org/css-display-4/#valdef-display-block": {"displayText":"block","export":true,"for_":["display","<display-outside>"],"level":"4","normative":true,"shortname":"css-display","spec":"css-display-4","status":"current","text":"block","type":"value","url":"https://drafts.csswg.org/css-display-4/#valdef-display-block"},
"https://drafts.csswg.org/css-display-4/#valdef-display-inline": {"displayText":"inline","export":true,"for_":["display","<display-outside>"],"level":"4","normative":true,"shortname":"css-display","spec":"css-display-4","status":"current","text":"inline","type":"value","url":"https://drafts.csswg.org/css-display-4/#valdef-display-inline"},
"https://drafts.csswg.org/css-display-4/#valdef-display-inline-block": {"displayText":"inline-block","export":true,"for_":["display","<display-legacy>"],"level":"4","normative":true,"shortname":"css-display","spec":"css-display-4","status":"current","text":"inline-block","type":"value","url":"https://drafts.csswg.org/css-display-4/#valdef-display-inline-block"},
"https://drafts.csswg.org/css-display-4/#valdef-visibility-collapse": {"displayText":"collapse","export":true,"for_":["visibility"],"level":"4","normative":true,"shortname":"css-display","spec":"css-display-4","status":"current","text":"collapse","type":"value","url":"https://drafts.csswg.org/css-display-4/#valdef-visibility-collapse"},
"https://drafts.csswg.org/css-grid-2/#valdef-grid-template-columns-max-content": {"displayText":"max-content","export":true,"for_":["grid-template-columns","grid-template-rows"],"level":"2","normative":true,"shortname":"css-grid","spec":"css-grid-2","status":"current","text":"max-content","type":"value","url":"https://drafts.csswg.org/css-grid-2/#valdef-grid-template-columns-max-content"},
"https://drafts.csswg.org/css-inline-3/#line-box": {"displayText":"line box","export":true,"for_":[],"level":"3","normative":true,"shortname":"css-inline","spec":"css-inline-3","status":"current","text":"line box","type":"dfn","url":"https://drafts.csswg.org/css-inline-3/#line-box"},
"https://drafts.csswg.org/css-inline-3/#line-relative-shift-values": {"displayText":"line-relative shift values","export":false,"for_":[],"level":"3","normative":true,"shortname":"css-inline","spec":"css-inline-3","status":"current","text":"line-relative shift values","type":"dfn","url":"https://drafts.csswg.org/css-inline-3/#line-relative-shift-values"},
"https://drafts.csswg.org/css-inline-3/#propdef-vertical-align": {"displayText":"vertical-align","export":true,"for_":[],"level":"3","normative":true,"shortname":"css-inline","spec":"css-inline-3","status":"current","text":"vertical-align","type":"property","url":"https://drafts.csswg.org/css-inline-3/#propdef-vertical-align"},
"https://drafts.csswg.org/css-inline-3/#valdef-baseline-shift-bottom": {"displayText":"bottom","export":true,"for_":["baseline-shift","vertical-align"],"level":"3","normative":true,"shortname":"css-inline","spec":"css-inline-3","status":"current","text":"bottom","type":"value","url":"https://drafts.csswg.org/css-inline-3/#valdef-baseline-shift-bottom"},
"https://drafts.csswg.org/css-inline-3/#valdef-baseline-shift-top": {"displayText":"top","export":true,"for_":["baseline-shift","vertical-align"],"level":"3","normative":true,"shortname":"css-inline","spec":"css-inline-3","status":"current","text":"top","type":"value","url":"https://drafts.csswg.org/css-inline-3/#valdef-baseline-shift-top"},
"https://drafts.csswg.org/css-pseudo-4/#selectordef-first-letter": {"displayText":"::first-letter","export":true,"for_":[],"level":"4","normative":true,"shortname":"css-pseudo","spec":"css-pseudo-4","status":"current","text":"::first-letter","type":"selector","url":"https://drafts.csswg.org/css-pseudo-4/#selectordef-first-letter"},
"https://drafts.csswg.org/css-pseudo-4/#selectordef-first-line": {"displayText":"::first-line","export":true,"for_":[],"level":"4","normative":true,"shortname":"css-pseudo","spec":"css-pseudo-4","status":"current","text":"::first-line","type":"selector","url":"https://drafts.csswg.org/css-pseudo-4/#selectordef-first-line"},
"https://drafts.csswg.org/css-sizing-3/#automatic-size": {"displayText":"automatic size","export":true,"for_":[],"level":"3","normative":true,"shortname":"css-sizing","spec":"css-sizing-3","status":"current","text":"automatic size","type":"dfn","url":"https://drafts.csswg.org/css-sizing-3/#automatic-size"},
"https://drafts.csswg.org/css-tables-3/#table-wrapper-box": {"displayText":"table wrapper box","export":true,"for_":[],"level":"3","normative":true,"shortname":"css-tables","spec":"css-tables-3","status":"current","text":"table wrapper box","type":"dfn","url":"https://drafts.csswg.org/css-tables-3/#table-wrapper-box"},
"https://drafts.csswg.org/css-text-3/#character": {"displayText":"character","export":true,"for_":[],"level":"3","normative":true,"shortname":"css-text","spec":"css-text-3","status":"current","text":"character","type":"dfn","url":"https://drafts.csswg.org/css-text-3/#character"},
"https://drafts.csswg.org/css-text-4/#collapsible-white-space": {"displayText":"collapsible white space","export":true,"for_":[],"level":"4","normative":true,"shortname":"css-text","spec":"css-text-4","status":"current","text":"collapsible white space","type":"dfn","url":"https://drafts.csswg.org/css-text-4/#collapsible-white-space"},
"https://drafts.csswg.org/css-text-4/#justification-opportunity": {"displayText":"justification opportunity","export":true,"for_":[],"level":"4","normative":true,"shortname":"css-text","spec":"css-text-4","status":"current","text":"justification opportunity","type":"dfn","url":"https://drafts.csswg.org/css-text-4/#justification-opportunity"},
"https://drafts.csswg.org/css-text-4/#propdef-text-justify": {"displayText":"text-justify","export":true,"for_":[],"level":"4","normative":true,"shortname":"css-text","spec":"css-text-4","status":"current","text":"text-justify","type":"property","url":"https://drafts.csswg.org/css-text-4/#propdef-text-justify"},
"https://drafts.csswg.org/css-text-4/#propdef-text-transform": {"displayText":"text-transform","export":true,"for_":[],"level":"4","normative":true,"shortname":"css-text","spec":"css-text-4","status":"current","text":"text-transform","type":"property","url":"https://drafts.csswg.org/css-text-4/#propdef-text-transform"},
"https://drafts.csswg.org/css-text-4/#propdef-white-space": {"displayText":"white-space","export":true,"for_":[],"level":"4","normative":true,"shortname":"css-text","spec":"css-text-4","status":"current","text":"white-space","type":"property","url":"https://drafts.csswg.org/css-text-4/#propdef-white-space"},
"https://drafts.csswg.org/css-text-4/#propdef-word-break": {"displayText":"word-break","export":true,"for_":[],"level":"4","normative":true,"shortname":"css-text","spec":"css-text-4","status":"current","text":"word-break","type":"property","url":"https://drafts.csswg.org/css-text-4/#propdef-word-break"},
"https://drafts.csswg.org/css-text-4/#segment-break": {"displayText":"segment break","export":true,"for_":[],"level":"4","normative":true,"shortname":"css-text","spec":"css-text-4","status":"current","text":"segment break","type":"dfn","url":"https://drafts.csswg.org/css-text-4/#segment-break"},
"https://drafts.csswg.org/css-text-4/#soft-wrap-opportunity": {"displayText":"soft wrap opportunity","export":true,"for_":[],"level":"4","normative":true,"shortname":"css-text","spec":"css-text-4","status":"current","text":"soft wrap opportunity","type":"dfn","url":"https://drafts.csswg.org/css-text-4/#soft-wrap-opportunity"},
"https://drafts.csswg.org/css-text-4/#valdef-word-break-keep-all": {"displayText":"keep-all","export":true,"for_":["word-break"],"level":"4","normative":true,"shortname":"css-text","spec":"css-text-4","status":"current","text":"keep-all","type":"value","url":"https://drafts.csswg.org/css-text-4/#valdef-word-break-keep-all"},
"https://drafts.csswg.org/css-text-4/#white-space": {"displayText":"white space","export":true,"for_":[],"level":"4","normative":true,"shortname":"css-text","spec":"css-text-4","status":"current","text":"white space","type":"dfn","url":"https://drafts.csswg.org/css-text-4/#white-space"},
"https://drafts.csswg.org/css-text-decor-4/#propdef-text-emphasis-position": {"displayText":"text-emphasis-position","export":true,"for_":[],"level":"4","normative":true,"shortname":"css-text-decor","spec":"css-text-decor-4","status":"current","text":"text-emphasis-position","type":"property","url":"https://drafts.csswg.org/css-text-decor-4/#propdef-text-emphasis-position"},
"https://drafts.csswg.org/css-values-4/#comb-any": {"displayText":"||","export":true,"for_":[],"level":"4","normative":true,"shortname":"css-values","spec":"css-values-4","status":"current","text":"||","type":"grammar","url":"https://drafts.csswg.org/css-values-4/#comb-any"},
"https://drafts.csswg.org/css-values-4/#comb-one": {"displayText":"|","export":true,"for_":[],"level":"4","normative":true,"shortname":"css-values","spec":"css-values-4","status":"current","text":"|","type":"grammar","url":"https://drafts.csswg.org/css-values-4/#comb-one"},
"https://drafts.csswg.org/css-values-4/#css-wide-keywords": {"displayText":"CSS-wide keywords","export":true,"for_":[],"level":"4","normative":true,"shortname":"css-values","spec":"css-values-4","status":"current","text":"css-wide keywords","type":"dfn","url":"https://drafts.csswg.org/css-values-4/#css-wide-keywords"},
"https://drafts.csswg.org/css-writing-modes-3/#propdef-direction": {"displayText":"direction","export":true,"for_":[],"level":"3","normative":true,"shortname":"css-writing-modes","spec":"css-writing-modes-3","status":"current","text":"direction","type":"property","url":"https://drafts.csswg.org/css-writing-modes-3/#propdef-direction"},
"https://drafts.csswg.org/css-writing-modes-3/#propdef-unicode-bidi": {"displayText":"unicode-bidi","export":true,"for_":[],"level":"3","normative":true,"shortname":"css-writing-modes","spec":"css-writing-modes-3","status":"current","text":"unicode-bidi","type":"property","url":"https://drafts.csswg.org/css-writing-modes-3/#propdef-unicode-bidi"},
"https://drafts.csswg.org/css-writing-modes-4/#horizontal-writing-mode": {"displayText":"horizontal writing mode","export":true,"for_":[],"level":"4","normative":true,"shortname":"css-writing-modes","spec":"css-writing-modes-4","status":"current","text":"horizontal writing mode","type":"dfn","url":"https://drafts.csswg.org/css-writing-modes-4/#horizontal-writing-mode"},
"https://drafts.csswg.org/css-writing-modes-4/#inline-base-direction": {"displayText":"inline base direction","export":true,"for_":[],"level":"4","normative":true,"shortname":"css-writing-modes","spec":"css-writing-modes-4","status":"current","text":"inline base direction","type":"dfn","url":"https://drafts.csswg.org/css-writing-modes-4/#inline-base-direction"},
"https://drafts.csswg.org/css-writing-modes-4/#line-over": {"displayText":"line-over","export":true,"for_":[],"level":"4","normative":true,"shortname":"css-writing-modes","spec":"css-writing-modes-4","status":"current","text":"line-over","type":"dfn","url":"https://drafts.csswg.org/css-writing-modes-4/#line-over"},
"https://drafts.csswg.org/css-writing-modes-4/#line-under": {"displayText":"line-under","export":true,"for_":[],"level":"4","normative":true,"shortname":"css-writing-modes","spec":"css-writing-modes-4","status":"current","text":"line-under","type":"dfn","url":"https://drafts.csswg.org/css-writing-modes-4/#line-under"},
"https://drafts.csswg.org/css-writing-modes-4/#propdef-writing-mode": {"displayText":"writing-mode","export":true,"for_":[],"level":"4","normative":true,"shortname":"css-writing-modes","spec":"css-writing-modes-4","status":"current","text":"writing-mode","type":"property","url":"https://drafts.csswg.org/css-writing-modes-4/#propdef-writing-mode"},
"https://drafts.csswg.org/css-writing-modes-4/#valdef-unicode-bidi-bidi-override": {"displayText":"bidi-override","export":true,"for_":["unicode-bidi"],"level":"4","normative":true,"shortname":"css-writing-modes","spec":"css-writing-modes-4","status":"current","text":"bidi-override","type":"value","url":"https://drafts.csswg.org/css-writing-modes-4/#valdef-unicode-bidi-bidi-override"},
"https://drafts.csswg.org/css-writing-modes-4/#valdef-unicode-bidi-embed": {"displayText":"embed","export":true,"for_":["unicode-bidi"],"level":"4","normative":true,"shortname":"css-writing-modes","spec":"css-writing-modes-4","status":"current","text":"embed","type":"value","url":"https://drafts.csswg.org/css-writing-modes-4/#valdef-unicode-bidi-embed"},
"https://drafts.csswg.org/css-writing-modes-4/#valdef-unicode-bidi-isolate": {"displayText":"isolate","export":true,"for_":["unicode-bidi"],"level":"4","normative":true,"shortname":"css-writing-modes","spec":"css-writing-modes-4","status":"current","text":"isolate","type":"value","url":"https://drafts.csswg.org/css-writing-modes-4/#valdef-unicode-bidi-isolate"},
"https://drafts.csswg.org/css-writing-modes-4/#valdef-unicode-bidi-isolate-override": {"displayText":"isolate-override","export":true,"for_":["unicode-bidi"],"level":"4","normative":true,"shortname":"css-writing-modes","spec":"css-writing-modes-4","status":"current","text":"isolate-override","type":"value","url":"https://drafts.csswg.org/css-writing-modes-4/#valdef-unicode-bidi-isolate-override"},
"https://drafts.csswg.org/css-writing-modes-4/#valdef-unicode-bidi-normal": {"displayText":"normal","export":true,"for_":["unicode-bidi"],"level":"4","normative":true,"shortname":"css-writing-modes","spec":"css-writing-modes-4","status":"current","text":"normal","type":"value","url":"https://drafts.csswg.org/css-writing-modes-4/#valdef-unicode-bidi-normal"},
"https://drafts.csswg.org/css-writing-modes-4/#valdef-writing-mode-vertical-rl": {"displayText":"vertical-rl","export":true,"for_":["writing-mode"],"level":"4","normative":true,"shortname":"css-writing-modes","spec":"css-writing-modes-4","status":"current","text":"vertical-rl","type":"value","url":"https://drafts.csswg.org/css-writing-modes-4/#valdef-writing-mode-vertical-rl"},
"https://drafts.csswg.org/css-writing-modes-4/#vertical-writing-mode": {"displayText":"vertical writing mode","export":true,"for_":[],"level":"4","normative":true,"shortname":"css-writing-modes","spec":"css-writing-modes-4","status":"current","text":"vertical writing mode","type":"dfn","url":"https://drafts.csswg.org/css-writing-modes-4/#vertical-writing-mode"},
"https://drafts.csswg.org/css-writing-modes-4/#writing-mode": {"displayText":"writing mode","export":true,"for_":[],"level":"4","normative":true,"shortname":"css-writing-modes","spec":"css-writing-modes-4","status":"current","text":"writing mode","type":"dfn","url":"https://drafts.csswg.org/css-writing-modes-4/#writing-mode"},
"https://drafts.csswg.org/css2/#propdef-line-height": {"displayText":"line-height","export":true,"for_":[],"level":"1","normative":true,"shortname":"css","spec":"css22","status":"current","text":"line-height","type":"property","url":"https://drafts.csswg.org/css2/#propdef-line-height"},
"https://html.spec.whatwg.org/multipage/obsolete.html#rtc": {"displayText":"rtc","export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"rtc","type":"element","url":"https://html.spec.whatwg.org/multipage/obsolete.html#rtc"},
"https://html.spec.whatwg.org/multipage/text-level-semantics.html#the-rp-element": {"displayText":"rp","export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"rp","type":"element","url":"https://html.spec.whatwg.org/multipage/text-level-semantics.html#the-rp-element"},
"https://html.spec.whatwg.org/multipage/text-level-semantics.html#the-ruby-element": {"displayText":"ruby","export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"ruby","type":"element","url":"https://html.spec.whatwg.org/multipage/text-level-semantics.html#the-ruby-element"},
"https://w3c.github.io/i18n-glossary/#dfn-bidi-isolation": {"displayText":"bidi isolation","export":true,"for_":[],"level":"1","normative":false,"shortname":"i18n-glossary","spec":"i18n-glossary","status":"current","text":"bidi isolation","type":"dfn","url":"https://w3c.github.io/i18n-glossary/#dfn-bidi-isolation"},
};

function mkRefHint(link, ref) {
    const linkText = link.textContent;
    let dfnTextElements = '';
    if (ref.displayText.toLowerCase() != linkText.toLowerCase()) {
        // Give the original term if it's being displayed in a different way.
        // But allow casing differences, they're insignificant.
        dfnTextElements =
            mk.li({},
                mk.b({}, "Term: "),
                mk.span({}, ref.displayText)
            );
    }
    const forList = ref.for_;
    let forListElements;
    if(forList.length == 0) {
        forListElements = [];
    } else if(forList.length == 1) {
        forListElements = mk.li({},
            mk.b({}, "For: "),
            mk.span({}, forList[0]),
        );
    } else {
        forListElements = mk.li({},
            mk.b({}, "For: "),
            mk.ul({},
                ...forList.map(forItem =>
                    mk.li({},
                        mk.span({}, forItem)
                    ),
                ),
            ),
        );
    }
    const url = ref.url;
    const safeUrl = encodeURIComponent(url);
    const hintPanel = mk.aside({
        class: "ref-hint",
        id: `ref-hint-for-${safeUrl}`,
        "data-for": url,
        "aria-labelled-by": `ref-hint-for-${safeUrl}`,
    },
        mk.ul({},
            dfnTextElements,
            mk.li({},
                mk.b({}, "URL: "),
                mk.a({ href: url, class: "ref" }, url),
            ),
            mk.li({},
                mk.b({}, "Type: "),
                mk.span({}, `${ref.type}`),
            ),
            mk.li({},
                mk.b({}, "Spec: "),
                mk.span({}, `${ref.spec ? ref.spec : ''}`),
            ),
            forListElements
        ),
    );
    hintPanel.forLink = link;
    setupRefHintEventListeners(link, hintPanel);
    return hintPanel;
}

function hideAllRefHints() {
    queryAll(".ref-hint").forEach(el=>hideRefHint(el));
}

function hideRefHint(refHint) {
    const link = refHint.forLink;
    link.setAttribute("aria-expanded", "false");
    if(refHint.teardownEventListeners) {
        refHint.teardownEventListeners();
    }
    refHint.remove();
}

function showRefHint(link) {
    if(link.classList.contains("dfn-link")) return;
    const url = link.getAttribute("href");
    const ref = refsData[url];
    if(!ref) return;

    hideAllRefHints(); // Only display one at this time.

    const refHint = mkRefHint(link, ref);
    append(document.body, refHint);
    link.setAttribute("aria-expanded", "true");
    positionRefHint(refHint);
}

function setupRefHintEventListeners(link, refHint) {
    if (refHint.teardownEventListeners) return;
    // Add event handlers to hide the refHint after the user moves away
    // from both the link and refHint, if not hovering either within one second.
    let timeout = null;
    const startHidingRefHint = (event) => {
        if (timeout) {
            clearTimeout(timeout);
        }
        timeout = setTimeout(() => {
            hideRefHint(refHint);
        }, 1000);
    }
    const resetHidingRefHint = (event) => {
        if (timeout) clearTimeout(timeout);
        timeout = null;
    };
    link.addEventListener("mouseleave", startHidingRefHint);
    link.addEventListener("mouseenter", resetHidingRefHint);
    link.addEventListener("blur", startHidingRefHint);
    link.addEventListener("focus", resetHidingRefHint);
    refHint.addEventListener("mouseleave", startHidingRefHint);
    refHint.addEventListener("mouseenter", resetHidingRefHint);
    refHint.addEventListener("blur", startHidingRefHint);
    refHint.addEventListener("focus", resetHidingRefHint);

    refHint.teardownEventListeners = () => {
        // remove event listeners
        resetHidingRefHint();
        link.removeEventListener("mouseleave", startHidingRefHint);
        link.removeEventListener("mouseenter", resetHidingRefHint);
        link.removeEventListener("blur", startHidingRefHint);
        link.removeEventListener("focus", resetHidingRefHint);
        refHint.removeEventListener("mouseleave", startHidingRefHint);
        refHint.removeEventListener("mouseenter", resetHidingRefHint);
        refHint.removeEventListener("blur", startHidingRefHint);
        refHint.removeEventListener("focus", resetHidingRefHint);
    };
}

function positionRefHint(refHint) {
    const link = refHint.forLink;
    const linkPos = getBounds(link);
    refHint.style.top = linkPos.bottom + "px";
    refHint.style.left = linkPos.left + "px";

    const panelPos = refHint.getBoundingClientRect();
    const panelMargin = 8;
    const maxRight = document.body.parentNode.clientWidth - panelMargin;
    if (panelPos.right > maxRight) {
        const overflowAmount = panelPos.right - maxRight;
        const newLeft = Math.max(panelMargin, linkPos.left - overflowAmount);
        refHint.style.left = newLeft + "px";
    }
}

// TODO: shared util
// Returns the root-level absolute position {left and top} of element.
function getBounds(el, relativeTo=document.body) {
    const relativeRect = relativeTo.getBoundingClientRect();
    const elRect = el.getBoundingClientRect();
    const top = elRect.top - relativeRect.top;
    const left = elRect.left - relativeRect.left;
    return {
        top,
        left,
        bottom: top + elRect.height,
        right: left + elRect.width,
    }
}

function showRefHintListener(e) {
    // If the target isn't in a link (or is a link),
    // just ignore it.
    let link = e.target.closest("a");
    if(!link) return;

    // If the target is in a ref-hint panel
    // (aka a link in the already-open one),
    // also just ignore it.
    if(link.closest(".ref-hint")) return;

    // Otherwise, show the panel for the link.
    showRefHint(link);
}

function hideAllHintsListener(e) {
    // If the click is inside a ref-hint panel, ignore it.
    if(e.target.closest(".ref-hint")) return;
    // Otherwise, close all the current panels.
    hideAllRefHints();
}

document.addEventListener("DOMContentLoaded", () => {
    document.body.addEventListener("mousedown", showRefHintListener);
    document.body.addEventListener("focus", showRefHintListener);

    document.body.addEventListener("click", hideAllHintsListener);
});

window.addEventListener("resize", () => {
    // Hide any open ref hint.
    hideAllRefHints();
});
}
</script>