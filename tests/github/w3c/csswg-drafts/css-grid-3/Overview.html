<!doctype html><html lang="en">
 <head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
  <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
  <title>CSS Grid Layout Module Level 3</title>
  <meta content="ED" name="w3c-status">
  <link href="https://www.w3.org/StyleSheets/TR/2021/W3C-ED" rel="stylesheet">
  <link href="https://drafts.csswg.org/css-grid-3/" rel="canonical">
  <link href="https://drafts.csswg.org/csslogo.ico" rel="icon">
  <meta content="dark light" name="color-scheme">
  <link href="https://www.w3.org/StyleSheets/TR/2021/dark.css" media="(prefers-color-scheme: dark)" rel="stylesheet" type="text/css">
<style>/* Boilerplate: style-autolinks */
.css.css, .property.property, .descriptor.descriptor {
    color: var(--a-normal-text);
    font-size: inherit;
    font-family: inherit;
}
.css::before, .property::before, .descriptor::before {
    content: "‘";
}
.css::after, .property::after, .descriptor::after {
    content: "’";
}
.property, .descriptor {
    /* Don't wrap property and descriptor names */
    white-space: nowrap;
}
.type { /* CSS value <type> */
    font-style: italic;
}
pre .property::before, pre .property::after {
    content: "";
}
[data-link-type="property"]::before,
[data-link-type="propdesc"]::before,
[data-link-type="descriptor"]::before,
[data-link-type="value"]::before,
[data-link-type="function"]::before,
[data-link-type="at-rule"]::before,
[data-link-type="selector"]::before,
[data-link-type="maybe"]::before {
    content: "‘";
}
[data-link-type="property"]::after,
[data-link-type="propdesc"]::after,
[data-link-type="descriptor"]::after,
[data-link-type="value"]::after,
[data-link-type="function"]::after,
[data-link-type="at-rule"]::after,
[data-link-type="selector"]::after,
[data-link-type="maybe"]::after {
    content: "’";
}

[data-link-type].production::before,
[data-link-type].production::after,
.prod [data-link-type]::before,
.prod [data-link-type]::after {
    content: "";
}

[data-link-type=element],
[data-link-type=element-attr] {
    font-family: Menlo, Consolas, "DejaVu Sans Mono", monospace;
    font-size: .9em;
}
[data-link-type=element]::before { content: "<" }
[data-link-type=element]::after  { content: ">" }

[data-link-type=biblio] {
    white-space: pre;
}

@media (prefers-color-scheme: dark) {
    :root {
        --selflink-text: black;
        --selflink-bg: silver;
        --selflink-hover-text: white;
    }
}
</style>
<style>/* Boilerplate: style-colors */
/* Any --*-text not paired with a --*-bg is assumed to have a transparent bg */
:root {
    color-scheme: light dark;

    --text: black;
    --bg: white;

    --unofficial-watermark: url(https://www.w3.org/StyleSheets/TR/2016/logos/UD-watermark);

    --logo-bg: #1a5e9a;
    --logo-active-bg: #c00;
    --logo-text: white;

    --tocnav-normal-text: #707070;
    --tocnav-normal-bg: var(--bg);
    --tocnav-hover-text: var(--tocnav-normal-text);
    --tocnav-hover-bg: #f8f8f8;
    --tocnav-active-text: #c00;
    --tocnav-active-bg: var(--tocnav-normal-bg);

    --tocsidebar-text: var(--text);
    --tocsidebar-bg: #f7f8f9;
    --tocsidebar-shadow: rgba(0,0,0,.1);
    --tocsidebar-heading-text: hsla(203,20%,40%,.7);

    --toclink-text: var(--text);
    --toclink-underline: #3980b5;
    --toclink-visited-text: var(--toclink-text);
    --toclink-visited-underline: #054572;

    --heading-text: #005a9c;

    --hr-text: var(--text);

    --algo-border: #def;

    --del-text: red;
    --del-bg: transparent;
    --ins-text: #080;
    --ins-bg: transparent;

    --a-normal-text: #034575;
    --a-normal-underline: #bbb;
    --a-visited-text: var(--a-normal-text);
    --a-visited-underline: #707070;
    --a-hover-bg: rgba(75%, 75%, 75%, .25);
    --a-active-text: #c00;
    --a-active-underline: #c00;

    --blockquote-border: silver;
    --blockquote-bg: transparent;
    --blockquote-text: currentcolor;

    --issue-border: #e05252;
    --issue-bg: #fbe9e9;
    --issue-text: var(--text);
    --issueheading-text: #831616;

    --example-border: #e0cb52;
    --example-bg: #fcfaee;
    --example-text: var(--text);
    --exampleheading-text: #574b0f;

    --note-border: #52e052;
    --note-bg: #e9fbe9;
    --note-text: var(--text);
    --noteheading-text: hsl(120, 70%, 30%);
    --notesummary-underline: silver;

    --assertion-border: #aaa;
    --assertion-bg: #eee;
    --assertion-text: black;

    --advisement-border: orange;
    --advisement-bg: #fec;
    --advisement-text: var(--text);
    --advisementheading-text: #b35f00;

    --warning-border: red;
    --warning-bg: hsla(40,100%,50%,0.95);
    --warning-text: var(--text);

    --amendment-border: #330099;
    --amendment-bg: #F5F0FF;
    --amendment-text: var(--text);
    --amendmentheading-text: #220066;

    --def-border: #8ccbf2;
    --def-bg: #def;
    --def-text: var(--text);
    --defrow-border: #bbd7e9;

    --datacell-border: silver;

    --indexinfo-text: #707070;

    --indextable-hover-text: black;
    --indextable-hover-bg: #f7f8f9;

    --outdatedspec-bg: rgba(0, 0, 0, .5);
    --outdatedspec-text: black;
    --outdated-bg: maroon;
    --outdated-text: white;
    --outdated-shadow: red;

    --editedrec-bg: darkorange;
}

@media (prefers-color-scheme: dark) {
    :root {
        --text: #ddd;
        --bg: black;

        --unofficial-watermark: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='400'%3E%3Cg fill='%23100808' transform='translate(200 200) rotate(-45) translate(-200 -200)' stroke='%23100808' stroke-width='3'%3E%3Ctext x='50%25' y='220' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EUNOFFICIAL%3C/text%3E%3Ctext x='50%25' y='305' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EDRAFT%3C/text%3E%3C/g%3E%3C/svg%3E");

        --logo-bg: #1a5e9a;
        --logo-active-bg: #c00;
        --logo-text: white;

        --tocnav-normal-text: #999;
        --tocnav-normal-bg: var(--bg);
        --tocnav-hover-text: var(--tocnav-normal-text);
        --tocnav-hover-bg: #080808;
        --tocnav-active-text: #f44;
        --tocnav-active-bg: var(--tocnav-normal-bg);

        --tocsidebar-text: var(--text);
        --tocsidebar-bg: #080808;
        --tocsidebar-shadow: rgba(255,255,255,.1);
        --tocsidebar-heading-text: hsla(203,20%,40%,.7);

        --toclink-text: var(--text);
        --toclink-underline: #6af;
        --toclink-visited-text: var(--toclink-text);
        --toclink-visited-underline: #054572;

        --heading-text: #8af;

        --hr-text: var(--text);

        --algo-border: #456;

        --del-text: #f44;
        --del-bg: transparent;
        --ins-text: #4a4;
        --ins-bg: transparent;

        --a-normal-text: #6af;
        --a-normal-underline: #555;
        --a-visited-text: var(--a-normal-text);
        --a-visited-underline: var(--a-normal-underline);
        --a-hover-bg: rgba(25%, 25%, 25%, .2);
        --a-active-text: #f44;
        --a-active-underline: var(--a-active-text);

        --borderedblock-bg: rgba(255, 255, 255, .05);

        --blockquote-border: silver;
        --blockquote-bg: var(--borderedblock-bg);
        --blockquote-text: currentcolor;

        --issue-border: #e05252;
        --issue-bg: var(--borderedblock-bg);
        --issue-text: var(--text);
        --issueheading-text: hsl(0deg, 70%, 70%);

        --example-border: hsl(50deg, 90%, 60%);
        --example-bg: var(--borderedblock-bg);
        --example-text: var(--text);
        --exampleheading-text: hsl(50deg, 70%, 70%);

        --note-border: hsl(120deg, 100%, 35%);
        --note-bg: var(--borderedblock-bg);
        --note-text: var(--text);
        --noteheading-text: hsl(120, 70%, 70%);
        --notesummary-underline: silver;

        --assertion-border: #444;
        --assertion-bg: var(--borderedblock-bg);
        --assertion-text: var(--text);

        --advisement-border: orange;
        --advisement-bg: #222218;
        --advisement-text: var(--text);
        --advisementheading-text: #f84;

        --warning-border: red;
        --warning-bg: hsla(40,100%,20%,0.95);
        --warning-text: var(--text);

        --amendment-border: #330099;
        --amendment-bg: #080010;
        --amendment-text: var(--text);
        --amendmentheading-text: #cc00ff;

        --def-border: #8ccbf2;
        --def-bg: #080818;
        --def-text: var(--text);
        --defrow-border: #136;

        --datacell-border: silver;

        --indexinfo-text: #aaa;

        --indextable-hover-text: var(--text);
        --indextable-hover-bg: #181818;

        --outdatedspec-bg: rgba(255, 255, 255, .5);
        --outdatedspec-text: black;
        --outdated-bg: maroon;
        --outdated-text: white;
        --outdated-shadow: red;

        --editedrec-bg: darkorange;
    }
    /* In case a transparent-bg image doesn't expect to be on a dark bg,
       which is quite common in practice... */
    img { background: white; }
}
</style>
<style>/* Boilerplate: style-counters */
body {
    counter-reset: example figure issue;
}
.issue {
    counter-increment: issue;
}
.issue:not(.no-marker)::before {
    content: "Issue " counter(issue);
}

.example {
    counter-increment: example;
}
.example:not(.no-marker)::before {
    content: "Example " counter(example);
}
.invalid.example:not(.no-marker)::before,
.illegal.example:not(.no-marker)::before {
    content: "Invalid Example" counter(example);
}

figcaption {
    counter-increment: figure;
}
figcaption:not(.no-marker)::before {
    content: "Figure " counter(figure) " ";
}
</style>
<style>/* Boilerplate: style-dfn-panel */
:root {
    --dfnpanel-bg: #ddd;
    --dfnpanel-text: var(--text);
    --dfnpanel-target-bg: #ffc;
    --dfnpanel-target-outline: orange;
}
@media (prefers-color-scheme: dark) {
    :root {
        --dfnpanel-bg: #222;
        --dfnpanel-text: var(--text);
        --dfnpanel-target-bg: #333;
        --dfnpanel-target-outline: silver;
    }
}
.dfn-panel {
    position: absolute;
    z-index: 35;
    width: 20em;
    width: 300px;
    height: auto;
    max-height: 500px;
    overflow: auto;
    padding: 0.5em 0.75em;
    font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
    background: var(--dfnpanel-bg);
    color: var(--dfnpanel-text);
    border: outset 0.2em;
    white-space: normal; /* in case it's moved into a pre */
}
.dfn-panel:not(.on) { display: none; }
.dfn-panel * { margin: 0; padding: 0; text-indent: 0; }
.dfn-panel > b { display: block; }
.dfn-panel a { color: var(--dfnpanel-text); }
.dfn-panel a:not(:hover) { text-decoration: none !important; border-bottom: none !important; }
.dfn-panel a:focus {
    outline: 5px auto Highlight;
    outline: 5px auto -webkit-focus-ring-color;
}
.dfn-panel > b + b { margin-top: 0.25em; }
.dfn-panel ul { padding: 0 0 0 1em; list-style: none; }
.dfn-panel li a {
    max-width: calc(300px - 1.5em - 1em);
    overflow: hidden;
    text-overflow: ellipsis;
}

.dfn-panel.activated {
    display: inline-block;
    position: fixed;
    left: 8px;
    bottom: 2em;
    margin: 0 auto;
    max-width: calc(100vw - 1.5em - .4em - .5em);
    max-height: 30vh;
    transition: left 1s ease-out, bottom 1s ease-out;
}

.dfn-panel .link-item:hover {
    text-decoration: underline;
}
.dfn-panel .link-item .copy-icon {
    opacity: 0;
}
.dfn-panel .link-item:hover .copy-icon,
.dfn-panel .link-item .copy-icon:focus {
    opacity: 1;
}

.dfn-panel .copy-icon {
    display: inline-block;
    margin-right: 0.5em;
    width: 0.85em;
    height: 1em;
    border-radius: 3px;
    background-color: #ccc;
    cursor: pointer;
}

.dfn-panel .copy-icon .icon {
    width: 100%;
    height: 100%;
    background-color: #fff;
    display: flex;
    justify-content: center;
    align-items: center;
    position: relative;
}

.dfn-panel .copy-icon .icon::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    border: 1px solid black;
    background-color: #ccc;
    opacity: 0.25;
    transform: translate(3px, -3px);
}

.dfn-panel .copy-icon:active .icon::before {
    opacity: 1;
}

.dfn-paneled[role="button"] { cursor: help; }

.highlighted {
    animation: target-fade 3s;
}

@keyframes target-fade {
    from {
        background-color: var(--dfnpanel-target-bg);
        outline: 5px solid var(--dfnpanel-target-outline);
    }
    to {
        color: var(--a-normal-text);
        background-color: transparent;
        outline: transparent;
    }
}
</style>
<style>/* Boilerplate: style-issues */
a[href].issue-return {
    float: right;
    float: inline-end;
    color: var(--issueheading-text);
    font-weight: bold;
    text-decoration: none;
}
</style>
<style>/* Boilerplate: style-md-lists */
/* This is a weird hack for me not yet following the commonmark spec
   regarding paragraph and lists. */
[data-md] > :first-child {
    margin-top: 0;
}
[data-md] > :last-child {
    margin-bottom: 0;
}
</style>
<style>/* Boilerplate: style-mdn-anno */
:root {
	--mdn-bg: #EEE;
	--mdn-shadow: #999;
	--mdn-nosupport-text: #ccc;
	--mdn-pass: green;
	--mdn-fail: red;
}
@media (prefers-color-scheme: dark) {
	:root {
		--mdn-bg: #222;
		--mdn-shadow: #444;
		--mdn-nosupport-text: #666;
		--mdn-pass: #690;
		--mdn-fail: #d22;
	}
}
.mdn-anno {
	background: var(--mdn-bg, #EEE);
	border-radius: .25em;
	box-shadow: 0 0 3px var(--mdn-shadow, #999);
	color: var(--text, black);
	font: 1em sans-serif;
	hyphens: none;
	max-width: min-content;
	overflow: hidden;
	padding: 0.2em;
	position: absolute;
	right: 0.3em;
	top: auto;
	white-space: nowrap;
	word-wrap: normal;
	z-index: 8;
}
.mdn-anno.unpositioned {
	display: none;
}
.mdn-anno.overlapping-main {
	opacity: .2;
	transition: opacity .1s;
}
.mdn-anno[open] {
	opacity: 1;
	z-index: 9;
	min-width: 9em;
}
.mdn-anno:hover {
	opacity: 1;
	outline: var(--text, black) 1px solid;
}
.mdn-anno > summary {
	font-weight: normal;
	text-align: right;
	cursor: pointer;
	display: block;
}
.mdn-anno > summary > .less-than-two-engines-flag {
	color: var(--mdn-fail);
	padding-right: 2px;
}
.mdn-anno > summary > .all-engines-flag {
	color: var(--mdn-pass);
	padding-right: 2px;
}
.mdn-anno > summary > span {
	color: #fff;
	background-color: #000;
	font-weight: normal;
	font-family: zillaslab, Palatino, "Palatino Linotype", serif;
	padding: 2px 3px 0px 3px;
	line-height: 1.3em;
	vertical-align: top;
}
.mdn-anno > .feature {
	margin-top: 20px;
}
.mdn-anno > .feature:not(:first-of-type) {
	border-top: 1px solid #999;
	margin-top: 6px;
	padding-top: 2px;
}
.mdn-anno > .feature > .less-than-two-engines-text {
	color: var(--mdn-fail);
}
.mdn-anno > .feature > .all-engines-text {
	color: var(--mdn-pass);
}
.mdn-anno > .feature > p {
	font-size: .75em;
	margin-top: 6px;
	margin-bottom: 0;
}
.mdn-anno > .feature > p + p {
	margin-top: 3px;
}
.mdn-anno > .feature > .support {
	display: block;
	font-size: 0.6em;
	margin: 0;
	padding: 0;
	margin-top: 2px;
}
.mdn-anno > .feature > .support + div {
	padding-top: 0.5em;
}
.mdn-anno > .feature > .support > hr {
	display: block;
	border: none;
	border-top: 1px dotted #999;
	padding: 3px 0px 0px 0px;
	margin: 2px 3px 0px 3px;
}
.mdn-anno > .feature > .support > hr::before {
	content: "";
}
.mdn-anno > .feature > .support > span {
	padding: 0.2em 0;
	display: block;
	display: table;
}
.mdn-anno > .feature > .support > span.no {
	color: var(--mdn-nosupport-text);
	filter: grayscale(100%);
}
.mdn-anno > .feature > .support > span.no::before {
	opacity: 0.5;
}
.mdn-anno > .feature > .support > span:first-of-type {
	padding-top: 0.5em;
}
.mdn-anno > .feature > .support > span > span {
	padding: 0 0.5em;
	display: table-cell;
}
.mdn-anno > .feature > .support > span > span:first-child {
	width: 100%;
}
.mdn-anno > .feature > .support > span > span:last-child {
	width: 100%;
	white-space: pre;
	padding: 0;
}
.mdn-anno > .feature > .support > span::before {
	content: ' ';
	display: table-cell;
	min-width: 1.5em;
	height: 1.5em;
	background: no-repeat center center;
	background-size: contain;
	text-align: right;
	font-size: 0.75em;
	font-weight: bold;
}
.mdn-anno > .feature > .support > .chrome_android::before {
	background-image: url(https://resources.whatwg.org/browser-logos/chrome.svg);
}
.mdn-anno > .feature > .support > .firefox_android::before {
	background-image: url(https://resources.whatwg.org/browser-logos/firefox.png);
}
.mdn-anno > .feature > .support > .chrome::before {
	background-image: url(https://resources.whatwg.org/browser-logos/chrome.svg);
}
.mdn-anno > .feature > .support > .edge_blink::before {
	background-image: url(https://resources.whatwg.org/browser-logos/edge.svg);
}
.mdn-anno > .feature > .support > .edge::before {
	background-image: url(https://resources.whatwg.org/browser-logos/edge_legacy.svg);
}
.mdn-anno > .feature > .support > .firefox::before {
	background-image: url(https://resources.whatwg.org/browser-logos/firefox.png);
}
.mdn-anno > .feature > .support > .ie::before {
	background-image: url(https://resources.whatwg.org/browser-logos/ie.png);
}
.mdn-anno > .feature > .support > .safari_ios::before {
	background-image: url(https://resources.whatwg.org/browser-logos/safari-ios.svg);
}
.mdn-anno > .feature > .support > .nodejs::before {
	background-image: url(https://nodejs.org/static/images/favicons/favicon.ico);
}
.mdn-anno > .feature > .support > .opera_android::before {
	background-image: url(https://resources.whatwg.org/browser-logos/opera.svg);
}
.mdn-anno > .feature > .support > .opera::before {
	background-image: url(https://resources.whatwg.org/browser-logos/opera.svg);
}
.mdn-anno > .feature > .support > .safari::before {
	background-image: url(https://resources.whatwg.org/browser-logos/safari.png);
}
.mdn-anno > .feature > .support > .samsunginternet_android::before {
	background-image: url(https://resources.whatwg.org/browser-logos/samsung.svg);
}
.mdn-anno > .feature > .support > .webview_android::before {
	background-image: url(https://resources.whatwg.org/browser-logos/android-webview.png);
}
.name-slug-mismatch {
	color: red;
}
.caniuse-status:hover {
	z-index: 9;
}
/* dt, li, .issue, .note, and .example are "position: relative", so to put annotation at right margin, must move to right of containing block */;
.h-entry:not(.status-LS) dt > .mdn-anno, .h-entry:not(.status-LS) li > .mdn-anno, .h-entry:not(.status-LS) .issue > .mdn-anno, .h-entry:not(.status-LS) .note > .mdn-anno, .h-entry:not(.status-LS) .example > .mdn-anno {
	right: -6.7em;
}
.h-entry p + .mdn-anno {
	margin-top: 0;
}
 h2 + .mdn-anno.after {
	margin: -48px 0 0 0;
}
 h3 + .mdn-anno.after {
	margin: -46px 0 0 0;
}
 h4 + .mdn-anno.after {
	margin: -42px 0 0 0;
}
 h5 + .mdn-anno.after {
	margin: -40px 0 0 0;
}
 h6 + .mdn-anno.after {
	margin: -40px 0 0 0;
}
</style>
<style>/* Boilerplate: style-ref-hints */
:root {
    --ref-hint-bg: #ddd;
    --ref-hint-text: var(--text);
}
@media (prefers-color-scheme: dark) {
    :root {
        --ref-hint-bg: #222;
        --ref-hint-text: var(--text);
    }
}

.ref-hint {
    display: inline-block;
    position: absolute;
    z-index: 35;
    width: 20em;
    width: 300px;
    height: auto;
    max-height: 500px;
    overflow: auto;
    padding: 0.5em 0.5em;
    font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
    background: var(--ref-hint-bg);
    color: var(--ref-hint-text);
    border: outset 0.2em;
    white-space: normal; /* in case it's moved into a pre */
}

.ref-hint * { margin: 0; padding: 0; text-indent: 0; }

.ref-hint ul { padding: 0 0 0 1em; list-style: none; }
</style>
<style>/* Boilerplate: style-selflinks */
:root {
    --selflink-text: white;
    --selflink-bg: gray;
    --selflink-hover-text: black;
}
.heading, .issue, .note, .example, li, dt {
    position: relative;
}
a.self-link {
    position: absolute;
    top: 0;
    left: calc(-1 * (3.5rem - 26px));
    width: calc(3.5rem - 26px);
    height: 2em;
    text-align: center;
    border: none;
    transition: opacity .2s;
    opacity: .5;
}
a.self-link:hover {
    opacity: 1;
}
.heading > a.self-link {
    font-size: 83%;
}
.example > a.self-link,
.note > a.self-link,
.issue > a.self-link {
    /* These blocks are overflow:auto, so positioning outside
       doesn't work. */
    left: auto;
    right: 0;
}
li > a.self-link {
    left: calc(-1 * (3.5rem - 26px) - 2em);
}
dfn > a.self-link {
    top: auto;
    left: auto;
    opacity: 0;
    width: 1.5em;
    height: 1.5em;
    background: var(--selflink-bg);
    color: var(--selflink-text);
    font-style: normal;
    transition: opacity .2s, background-color .2s, color .2s;
}
dfn:hover > a.self-link {
    opacity: 1;
}
dfn > a.self-link:hover {
    color: var(--selflink-hover-text);
}

a.self-link::before            { content: "¶"; }
.heading > a.self-link::before { content: "§"; }
dfn > a.self-link::before      { content: "#"; }
</style>
<style>/* Boilerplate: style-syntax-highlighting */
code.highlight { padding: .1em; border-radius: .3em; }
pre.highlight, pre > code.highlight { display: block; padding: 1em; margin: .5em 0; overflow: auto; border-radius: 0; }

.highlight:not(.idl) { background: rgba(0, 0, 0, .03); }
c-[a] { color: #990055 } /* Keyword.Declaration */
c-[b] { color: #990055 } /* Keyword.Type */
c-[c] { color: #708090 } /* Comment */
c-[d] { color: #708090 } /* Comment.Multiline */
c-[e] { color: #0077aa } /* Name.Attribute */
c-[f] { color: #669900 } /* Name.Tag */
c-[g] { color: #222222 } /* Name.Variable */
c-[k] { color: #990055 } /* Keyword */
c-[l] { color: #000000 } /* Literal */
c-[m] { color: #000000 } /* Literal.Number */
c-[n] { color: #0077aa } /* Name */
c-[o] { color: #999999 } /* Operator */
c-[p] { color: #999999 } /* Punctuation */
c-[s] { color: #a67f59 } /* Literal.String */
c-[t] { color: #a67f59 } /* Literal.String.Single */
c-[u] { color: #a67f59 } /* Literal.String.Double */
c-[cp] { color: #708090 } /* Comment.Preproc */
c-[c1] { color: #708090 } /* Comment.Single */
c-[cs] { color: #708090 } /* Comment.Special */
c-[kc] { color: #990055 } /* Keyword.Constant */
c-[kn] { color: #990055 } /* Keyword.Namespace */
c-[kp] { color: #990055 } /* Keyword.Pseudo */
c-[kr] { color: #990055 } /* Keyword.Reserved */
c-[ld] { color: #000000 } /* Literal.Date */
c-[nc] { color: #0077aa } /* Name.Class */
c-[no] { color: #0077aa } /* Name.Constant */
c-[nd] { color: #0077aa } /* Name.Decorator */
c-[ni] { color: #0077aa } /* Name.Entity */
c-[ne] { color: #0077aa } /* Name.Exception */
c-[nf] { color: #0077aa } /* Name.Function */
c-[nl] { color: #0077aa } /* Name.Label */
c-[nn] { color: #0077aa } /* Name.Namespace */
c-[py] { color: #0077aa } /* Name.Property */
c-[ow] { color: #999999 } /* Operator.Word */
c-[mb] { color: #000000 } /* Literal.Number.Bin */
c-[mf] { color: #000000 } /* Literal.Number.Float */
c-[mh] { color: #000000 } /* Literal.Number.Hex */
c-[mi] { color: #000000 } /* Literal.Number.Integer */
c-[mo] { color: #000000 } /* Literal.Number.Oct */
c-[sb] { color: #a67f59 } /* Literal.String.Backtick */
c-[sc] { color: #a67f59 } /* Literal.String.Char */
c-[sd] { color: #a67f59 } /* Literal.String.Doc */
c-[se] { color: #a67f59 } /* Literal.String.Escape */
c-[sh] { color: #a67f59 } /* Literal.String.Heredoc */
c-[si] { color: #a67f59 } /* Literal.String.Interpol */
c-[sx] { color: #a67f59 } /* Literal.String.Other */
c-[sr] { color: #a67f59 } /* Literal.String.Regex */
c-[ss] { color: #a67f59 } /* Literal.String.Symbol */
c-[vc] { color: #0077aa } /* Name.Variable.Class */
c-[vg] { color: #0077aa } /* Name.Variable.Global */
c-[vi] { color: #0077aa } /* Name.Variable.Instance */
c-[il] { color: #000000 } /* Literal.Number.Integer.Long */

@media (prefers-color-scheme: dark) {
    .highlight:not(.idl) { background: rgba(255, 255, 255, .05); }

    c-[a] { color: #d33682 } /* Keyword.Declaration */
    c-[b] { color: #d33682 } /* Keyword.Type */
    c-[c] { color: #2aa198 } /* Comment */
    c-[d] { color: #2aa198 } /* Comment.Multiline */
    c-[e] { color: #268bd2 } /* Name.Attribute */
    c-[f] { color: #b58900 } /* Name.Tag */
    c-[g] { color: #cb4b16 } /* Name.Variable */
    c-[k] { color: #d33682 } /* Keyword */
    c-[l] { color: #657b83 } /* Literal */
    c-[m] { color: #657b83 } /* Literal.Number */
    c-[n] { color: #268bd2 } /* Name */
    c-[o] { color: #657b83 } /* Operator */
    c-[p] { color: #657b83 } /* Punctuation */
    c-[s] { color: #6c71c4 } /* Literal.String */
    c-[t] { color: #6c71c4 } /* Literal.String.Single */
    c-[u] { color: #6c71c4 } /* Literal.String.Double */
    c-[ch] { color: #2aa198 } /* Comment.Hashbang */
    c-[cp] { color: #2aa198 } /* Comment.Preproc */
    c-[cpf] { color: #2aa198 } /* Comment.PreprocFile */
    c-[c1] { color: #2aa198 } /* Comment.Single */
    c-[cs] { color: #2aa198 } /* Comment.Special */
    c-[kc] { color: #d33682 } /* Keyword.Constant */
    c-[kn] { color: #d33682 } /* Keyword.Namespace */
    c-[kp] { color: #d33682 } /* Keyword.Pseudo */
    c-[kr] { color: #d33682 } /* Keyword.Reserved */
    c-[ld] { color: #657b83 } /* Literal.Date */
    c-[nc] { color: #268bd2 } /* Name.Class */
    c-[no] { color: #268bd2 } /* Name.Constant */
    c-[nd] { color: #268bd2 } /* Name.Decorator */
    c-[ni] { color: #268bd2 } /* Name.Entity */
    c-[ne] { color: #268bd2 } /* Name.Exception */
    c-[nf] { color: #268bd2 } /* Name.Function */
    c-[nl] { color: #268bd2 } /* Name.Label */
    c-[nn] { color: #268bd2 } /* Name.Namespace */
    c-[py] { color: #268bd2 } /* Name.Property */
    c-[ow] { color: #657b83 } /* Operator.Word */
    c-[mb] { color: #657b83 } /* Literal.Number.Bin */
    c-[mf] { color: #657b83 } /* Literal.Number.Float */
    c-[mh] { color: #657b83 } /* Literal.Number.Hex */
    c-[mi] { color: #657b83 } /* Literal.Number.Integer */
    c-[mo] { color: #657b83 } /* Literal.Number.Oct */
    c-[sa] { color: #6c71c4 } /* Literal.String.Affix */
    c-[sb] { color: #6c71c4 } /* Literal.String.Backtick */
    c-[sc] { color: #6c71c4 } /* Literal.String.Char */
    c-[dl] { color: #6c71c4 } /* Literal.String.Delimiter */
    c-[sd] { color: #6c71c4 } /* Literal.String.Doc */
    c-[se] { color: #6c71c4 } /* Literal.String.Escape */
    c-[sh] { color: #6c71c4 } /* Literal.String.Heredoc */
    c-[si] { color: #6c71c4 } /* Literal.String.Interpol */
    c-[sx] { color: #6c71c4 } /* Literal.String.Other */
    c-[sr] { color: #6c71c4 } /* Literal.String.Regex */
    c-[ss] { color: #6c71c4 } /* Literal.String.Symbol */
    c-[fm] { color: #268bd2 } /* Name.Function.Magic */
    c-[vc] { color: #cb4b16 } /* Name.Variable.Class */
    c-[vg] { color: #cb4b16 } /* Name.Variable.Global */
    c-[vi] { color: #cb4b16 } /* Name.Variable.Instance */
    c-[vm] { color: #cb4b16 } /* Name.Variable.Magic */
    c-[il] { color: #657b83 } /* Literal.Number.Integer.Long */
}
</style>
<style>/* Boilerplate: style-wpt */
:root {
    --wpt-border: hsl(0, 0%, 60%);
    --wpt-bg: hsl(0, 0%, 95%);
    --wpt-text: var(--text);
    --wptheading-text: hsl(0, 0%, 30%);
}
@media (prefers-color-scheme: dark) {
    :root {
        --wpt-border: hsl(0, 0%, 30%);
        --wpt-bg: var(--borderedblock-bg);
        --wpt-text: var(--text);
        --wptheading-text: hsl(0, 0%, 60%);
    }
}
.wpt-tests-block {
    list-style: none;
    border-left: .5em solid var(--wpt-border);
    background: var(--wpt-bg);
    color: var(--wpt-text);
    margin: 1em auto;
    padding: .5em;
}
.wpt-tests-block summary {
    color: var(--wptheading-text);
    font-weight: normal;
    text-transform: uppercase;
}
.wpt-tests-block summary::marker{
    color: var(--wpt-border);
}
.wpt-tests-block summary:hover::marker{
    color: var(--wpt-text);
}
/*
   The only content  of a wpt test block in its closed state is the <summary>,
   which contains the word TESTS,
   and that is absolutely positioned.
   In that closed state, wpt test blocks are styled
   to have a top margin whose height is exactly equal
   to the height of the absolutely positioned <summary>,
   and no other background/padding/margin/border.
   The wpt test block elements will therefore allow the maring
   of the previous/next block elements
   to collapse through them;
   if this combined margin would be larger than its own top margin,
   it stays as is,
   and therefore the pre-existing vertical rhythm of the document is undisturbed.
   If that combined margin would be smaller, it is grown to that size.
   This means that the wpt test block ensures
   that there's always enough vertical space to insert the summary,
   without adding more than is needed.
*/
.wpt-tests-block:not([open]){
    padding: 0;
    border: none;
    background: none;
    font-size: 0.75em;
    line-height: 1;
    position: relative;
    margin: 1em 0 0;
}
.wpt-tests-block:not([open]) summary {
    position: absolute;
    right: 0;
    bottom: 0;
}
/*
   It is possible that both the last child of a block element
   and the block element itself
   would be annotated with a <wpt> block each.
   If the block element has a padding or a border,
   that's fine, but otherwise
   the bottom margin of the block and of its last child would collapse
   and both <wpt> elements would overlap, being both placed there.
   To avoid that, add 1px of padding to the <wpt> element annotating the last child
   to prevent the bottom margin of the block and of its last child from collapsing
   (and as much negative margin,
   as wel only want to prevent margin collapsing,
   but are not trying to actually take more space).
*/
.wpt-tests-block:not([open]):last-child {
    padding-bottom: 1px;
    margin-bottom: -1px;
}
/*
   Exception to the previous rule:
   don't do that in non-last list items,
   because it's not necessary,
   and would therefore consume more space than strictly needed.
   Lists must have list items as children, not <wpt> elements,
   so a <wpt> element cannot be a sibling of a list item,
   and the collision that the previous rule avoids cannot happen.
*/
li:not(:last-child) > .wpt-tests-block:not([open]):last-child,
dd:not(:last-child) > .wpt-tests-block:not([open]):last-child {
    padding-bottom: 0;
    margin-bottom: 0;
}
.wpt-tests-block:not([open]):not(:hover){
    opacity: 0.5;
}
.wpt-tests-list {
    list-style: none;
    display: grid;
    margin: 0;
    padding: 0;
    grid-template-columns: 1fr max-content auto auto;
    grid-column-gap: .5em;
}
.wpt-tests-block hr:last-child {
    display: none;
}
.wpt-test {
    display: contents;
}
.wpt-test > a {
    text-decoration: underline;
    border: none;
}
.wpt-test > .wpt-name { grid-column: 1; }
.wpt-test > .wpt-results { grid-column: 2; }
.wpt-test > .wpt-live { grid-column: 3; }
.wpt-test > .wpt-source { grid-column: 4; }

.wpt-test > .wpt-results {
    display: flex;
    gap: .1em;
}
.wpt-test .wpt-result {
    display: inline-block;
    height: 1em;
    width: 1em;
    border-radius: 50%;
    position: relative;
}
</style>
 <body class="h-entry">
  <div class="head">
   <p data-fill-with="logo"><a class="logo" href="https://www.w3.org/"> <img alt="W3C" height="48" src="https://www.w3.org/StyleSheets/TR/2021/logos/W3C" width="72"> </a> </p>
   <h1 class="p-name no-ref" id="title">CSS Grid Layout Module Level 3</h1>
   <p id="w3c-state"><a href="https://www.w3.org/standards/types#ED">Editor’s Draft</a>, <time class="dt-updated" datetime="1970-01-01">1 January 1970</time></p>
   <details open>
    <summary>More details about this document</summary>
    <div data-fill-with="spec-metadata">
     <dl>
      <dt>This version:
      <dd><a class="u-url" href="https://drafts.csswg.org/css-grid-3/">https://drafts.csswg.org/css-grid-3/</a>
      <dt>Issue Tracking:
      <dd><a href="https://github.com/w3c/csswg-drafts/labels/css-grid-3">CSSWG Issues Repository</a>
      <dt class="editor">Editors:
      <dd class="editor p-author h-card vcard" data-editor-id="42199"><a class="p-name fn u-url url" href="http://www.xanthir.com/contact/">Tab Atkins Jr.</a> (<span class="p-org org">Google</span>)
      <dd class="editor p-author h-card vcard" data-editor-id="35400"><a class="p-name fn u-url url" href="http://fantasai.inkedblade.net/contact">Elika J. Etemad / fantasai</a> (<span class="p-org org">Invited Expert</span>)
      <dd class="editor p-author h-card vcard"><a class="p-name fn u-email email" href="mailto:mailto:mats@mozilla.com">Mats Palmgren</a> (<span class="p-org org">Mozilla</span>)
      <dd class="editor p-author h-card vcard"><a class="p-name fn u-url url" href="http://jensimmons.com/">Jen Simmons</a> (<span class="p-org org">Apple</span>)
      <dt>Suggest an Edit for this Spec:
      <dd><a href="https://github.com/w3c/csswg-drafts/blob/main/css-grid-3/Overview.bs">GitHub Editor</a>
     </dl>
    </div>
   </details>
   <div data-fill-with="warning"></div>
   <p class="copyright" data-fill-with="copyright"><a href="https://www.w3.org/policies/#copyright">Copyright</a> © 1970 <a href="https://www.w3.org/">World Wide Web Consortium</a>. <abbr title="World Wide Web Consortium">W3C</abbr><sup>®</sup> <a href="https://www.w3.org/policies/#Legal_Disclaimer">liability</a>, <a href="https://www.w3.org/policies/#W3C_Trademarks">trademark</a> and <a href="https://www.w3.org/copyright/software-license/" rel="license" title="W3C Software and Document License">permissive document license</a> rules apply. </p>
   <hr title="Separator for header">
  </div>
  <div class="p-summary" data-fill-with="abstract">
   <h2 class="no-num no-toc no-ref heading settled" id="abstract"><span class="content">Abstract</span></h2>
   <p>This module introduces masonry layout as an additional layout mode for <a href="https://www.w3.org/TR/css-grid-2/">CSS Grid</a> containers.</p>
    <a href="https://www.w3.org/TR/CSS/">CSS</a> is a language for describing the rendering of structured documents
(such as HTML and XML)
on screen, on paper, etc. 
  </div>
  <h2 class="no-num no-toc no-ref heading settled" id="sotd"><span class="content">Status of this document</span></h2>
  <div data-fill-with="status">
   <p> This is a public copy of the editors’ draft.
	It is provided for discussion only and may change at any moment.
	Its publication here does not imply endorsement of its contents by W3C.
	Don’t cite this document other than as work in progress. </p>
   <p>Please send feedback
	by <a href="https://github.com/w3c/csswg-drafts/issues">filing issues in GitHub</a> (preferred),
	including the spec code “css-grid” in the title, like this:
	“[css-grid] <i>…summary of comment…</i>”.
	All issues and comments are <a href="https://lists.w3.org/Archives/Public/public-css-archive/">archived</a>.
	Alternately, feedback can be sent to the (<a href="https://lists.w3.org/Archives/Public/www-style/">archived</a>) public mailing list <a href="mailto:www-style@w3.org?Subject=%5Bcss-grid%5D%20PUT%20SUBJECT%20HERE">www-style@w3.org</a>. </p>
   <p>This document is governed by the <a href="https://www.w3.org/policies/process/20231103/" id="w3c_process_revision">03 November 2023 W3C Process Document</a>. </p>
   <p></p>
  </div>
  <div data-fill-with="at-risk"></div>
  <nav data-fill-with="table-of-contents" id="toc">
   <h2 class="no-num no-toc no-ref" id="contents">Table of Contents</h2>
   <ol class="toc" role="directory">
    <li>
     <a href="#intro"><span class="secno">1</span> <span class="content"> Introduction</span></a>
     <ol class="toc">
      <li><a href="#background"><span class="secno">1.1</span> <span class="content"> Background and Motivation</span></a>
      <li><a href="#values"><span class="secno">1.2</span> <span class="content"> Value Definitions</span></a>
     </ol>
    <li>
     <a href="#masonry-layout"><span class="secno">2</span> <span class="content"> Masonry Layout</span></a>
     <ol class="toc">
      <li><a href="#line-name-resolution"><span class="secno">2.1</span> <span class="content"> Line Name Resolution</span></a>
      <li><a href="#grid-item-placement"><span class="secno">2.2</span> <span class="content"> Grid Item Placement</span></a>
      <li>
       <a href="#track-sizing"><span class="secno">2.3</span> <span class="content"> Grid Axis Track Sizing</span></a>
       <ol class="toc">
        <li><a href="#repeat-auto-fit"><span class="secno">2.3.1</span> <span class="content"> repeat(auto-fit)</span></a>
       </ol>
      <li><a href="#masonry-layout-algorithm"><span class="secno">2.4</span> <span class="content"> Masonry Layout Algorithm</span></a>
      <li><a href="#masonry-auto-flow"><span class="secno">2.5</span> <span class="content"> The <span class="css">masonry-auto-flow</span> Property</span></a>
     </ol>
    <li><a href="#containing-block"><span class="secno">3</span> <span class="content"> Containing Block</span></a>
    <li><a href="#implicit-grid"><span class="secno">4</span> <span class="content"> The Implicit Grid </span></a>
    <li><a href="#intrinsic-sizes"><span class="secno">5</span> <span class="content"> Sizing Grid Containers</span></a>
    <li>
     <a href="#alignment"><span class="secno">6</span> <span class="content"> Alignment and Spacing</span></a>
     <ol class="toc">
      <li><a href="#tracks-alignment"><span class="secno">6.1</span> <span class="content"> The <span class="css">align-tracks</span> and <span class="css">justify-tracks</span> Properties </span></a>
      <li><a href="#masonry-axis-stretch-alignment"><span class="secno">6.2</span> <span class="content"> Stretch Alignment in the Masonry Axis</span></a>
      <li><a href="#masonry-axis-alignment"><span class="secno">6.3</span> <span class="content"> Individual Track Alignment in the Masonry Axis</span></a>
      <li><a href="#masonry-axis-baseline-alignment"><span class="secno">6.4</span> <span class="content"> Baseline Alignment in the Masonry Axis</span></a>
     </ol>
    <li>
     <a href="#pagination"><span class="secno">7</span> <span class="content"> Fragmentation</span></a>
     <ol class="toc">
      <li><a href="#masonry-axis-pagination"><span class="secno">7.1</span> <span class="content"> Fragmentation in the Masonry Axis</span></a>
      <li><a href="#grid-axis-pagination"><span class="secno">7.2</span> <span class="content"> Fragmentation in the Grid Axis</span></a>
     </ol>
    <li><a href="#subgrids"><span class="secno">8</span> <span class="content"> Subgrids</span></a>
    <li><a href="#abspos"><span class="secno">9</span> <span class="content"> Absolute Positioning</span></a>
    <li><a href="#performance-notes"><span class="secno">10</span> <span class="content"> Performance Notes</span></a>
    <li><a href="#graceful-degradation"><span class="secno">11</span> <span class="content"> Graceful Degradation</span></a>
    <li><a href="#acknowledgements"><span class="secno">12</span> <span class="content"> Acknowledgements</span></a>
    <li>
     <a href="#w3c-conformance"><span class="secno"></span> <span class="content"> Conformance</span></a>
     <ol class="toc">
      <li><a href="#w3c-conventions"><span class="secno"></span> <span class="content"> Document conventions</span></a>
      <li><a href="#w3c-conformance-classes"><span class="secno"></span> <span class="content"> Conformance classes</span></a>
      <li>
       <a href="#w3c-partial"><span class="secno"></span> <span class="content"> Partial implementations</span></a>
       <ol class="toc">
        <li><a href="#w3c-conform-future-proofing"><span class="secno"></span> <span class="content"> Implementations of Unstable and Proprietary Features</span></a>
       </ol>
      <li><a href="#w3c-testing"><span class="secno"></span> <span class="content"> Non-experimental implementations</span></a>
     </ol>
    <li>
     <a href="#index"><span class="secno"></span> <span class="content">Index</span></a>
     <ol class="toc">
      <li><a href="#index-defined-here"><span class="secno"></span> <span class="content">Terms defined by this specification</span></a>
      <li><a href="#index-defined-elsewhere"><span class="secno"></span> <span class="content">Terms defined by reference</span></a>
     </ol>
    <li>
     <a href="#references"><span class="secno"></span> <span class="content">References</span></a>
     <ol class="toc">
      <li><a href="#normative"><span class="secno"></span> <span class="content">Normative References</span></a>
      <li><a href="#informative"><span class="secno"></span> <span class="content">Informative References</span></a>
     </ol>
    <li><a href="#property-index"><span class="secno"></span> <span class="content">Property Index</span></a>
    <li><a href="#issues-index"><span class="secno"></span> <span class="content">Issues Index</span></a>
   </ol>
  </nav>
  <main>
   <h2 class="heading settled" data-level="1" id="intro"><span class="secno">1. </span><span class="content"> Introduction</span><a class="self-link" href="#intro"></a></h2>
   <p><em>This section is not normative.</em></p>
   <p>Grid Layout is a layout model for CSS that has powerful abilities to control the sizing and positioning of boxes and their contents. Grid Layout is optimized for 2-dimensional layouts: those in which alignment of content is desired in both dimensions.</p>
   <figure>
     <img alt="An example of grid layout:
	     two rows of items,
	     the first being four items — the last of which spans both rows,
	     and the second being two items — the first of which spans the first two columns — plus the spanned item from the first row." src="images/grid-layout.png"> 
    <figcaption>Representative Grid layout example</figcaption>
   </figure>
   <p>Although many layouts can be expressed with regular Grid Layout, restricting items into a grid in both axes also makes it impossible to express some common layouts on the Web.</p>
   <p>This module defines a layout system that removes that restriction so that items can be placed into Grid-like tracks in just one of the axes, while stacking them one after another in the other axis.  Items are placed into the column (or row) with the most remaining space based on the layout size of the items placed so far.  This module also extends <a href="https://www.w3.org/TR/css-grid-2/">CSS Grid</a> with this new grid item placement strategy and <a href="https://drafts.csswg.org/css-align">CSS Box Alignment</a> with new alignment features.</p>
   <h3 class="heading settled" data-level="1.1" id="background"><span class="secno">1.1. </span><span class="content"> Background and Motivation</span><a class="self-link" href="#background"></a></h3>
   <p>Masonry layout is a common Web design pattern where a number of items — commonly images or short article summaries — are placed one by one into columns, in a way that loosely resembles stone masonry. Unlike <a href="https://drafts.csswg.org/css-multicol-1/">regular multi-column layout</a>, where items are placed vertically in the first column until they must spill over to the second column, masonry layout selects a column for each new item such that it is generally closer to the top of the layout than items placed later.</p>
   <p>The Pinterest search results page exemplifies this layout:</p>
   <figure>
     <img alt="An example of masonry layout:
	     four columns of items,
	     each item is placed into the column with the smallest height so far." src="images/pinterest.png"> 
    <figcaption>Representative masonry layout example</figcaption>
   </figure>
   <p>Here, each item has a different height (depending on the content and the width of the column), and inspecting the DOM reveals (as the visual content itself gives no indication of ordering) that each item has been placed into the column with the smallest height so far.</p>
   <p>This layout superficially looks similar to multi-column layout; but it has the advantage that scrolling down will naturally lead to "later" items in the layout (that is, those less relevant in the search results).</p>
   <p>It’s not possible to achieve this layout using earlier CSS layout models, unless you know up-front how tall each item will be, or use JavaScript for content measurement or placement.</p>
   <h3 class="heading settled" data-level="1.2" id="values"><span class="secno">1.2. </span><span class="content"> Value Definitions</span><a class="self-link" href="#values"></a></h3>
   <p>This specification follows the <a href="https://www.w3.org/TR/CSS2/about.html#property-defs">CSS property definition conventions</a> from <a data-link-type="biblio" href="#biblio-css2" title="Cascading Style Sheets Level 2 Revision 1 (CSS 2.1) Specification">[CSS2]</a> using the <a href="https://www.w3.org/TR/css-values-3/#value-defs">value definition syntax</a> from <a data-link-type="biblio" href="#biblio-css-values-3" title="CSS Values and Units Module Level 3">[CSS-VALUES-3]</a>.
	Value types not defined in this specification are defined in CSS Values &amp; Units <span title="CSS Values and Units Module Level 3">[CSS-VALUES-3]</span>.
	Combination with other CSS modules may expand the definitions of these value types.</p>
   <p>In addition to the property-specific values listed in their definitions,
	all properties defined in this specification
	also accept the <a data-link-type="dfn" href="https://drafts.csswg.org/css-values-4/#css-wide-keywords" id="ref-for-css-wide-keywords">CSS-wide keywords</a> as their property value.
	For readability they have not been repeated explicitly.</p>
   <h2 class="heading settled" data-level="2" id="masonry-layout"><span class="secno">2. </span><span class="content"> Masonry Layout</span><a class="self-link" href="#masonry-layout"></a></h2>
   <p>Masonry layout is supported for <a data-link-type="dfn" href="https://drafts.csswg.org/css-grid-2/#grid-container" id="ref-for-grid-container">grid containers</a> by specifying the value <span class="css">masonry</span> for one of its axes.  This axis is called the <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="masonry-axis">masonry axis</dfn>, and the other axis is called the <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="grid-axis">grid axis</dfn>.</p>
   <table class="def propdef partial" data-link-for-hint="grid-template-columns">
    <tbody>
     <tr>
      <th>Name:
      <td><a class="css" data-link-type="property" href="https://drafts.csswg.org/css-grid-2/#propdef-grid-template-columns" id="ref-for-propdef-grid-template-columns">grid-template-columns</a>, <a class="css" data-link-type="property" href="https://drafts.csswg.org/css-grid-2/#propdef-grid-template-rows" id="ref-for-propdef-grid-template-rows">grid-template-rows</a>
     <tr class="value">
      <th><a href="https://www.w3.org/TR/css-values/#value-defs">New values:</a>
      <td class="prod">masonry
     <tr>
      <th><a href="https://www.w3.org/TR/css-cascade/#initial-values">Initial:</a>
      <td>none
     <tr>
      <th><a href="https://www.w3.org/TR/css-cascade/#applies-to">Applies to:</a>
      <td><a data-link-type="dfn" href="https://drafts.csswg.org/css-grid-2/#grid-container" id="ref-for-grid-container①">grid containers</a>
     <tr>
      <th><a href="https://www.w3.org/TR/css-cascade/#inherited-property">Inherited:</a>
      <td>no
     <tr>
      <th><a href="https://www.w3.org/TR/css-values/#percentages">Percentages:</a>
      <td>refer to corresponding dimension of the content area
     <tr>
      <th><a href="https://www.w3.org/TR/css-cascade/#computed">Computed value:</a>
      <td>the keyword <a class="css" data-link-type="maybe" href="https://drafts.csswg.org/css-grid-2/#valdef-grid-template-rows-none" id="ref-for-valdef-grid-template-rows-none">none</a> or the keyword <span class="css">masonry</span> or a <a href="https://drafts.csswg.org/css-grid-2/#computed-track-list">computed track list</a>
     <tr>
      <th><a href="https://www.w3.org/TR/web-animations/#animation-type">Animation type:</a>
      <td>see <a href="https://drafts.csswg.org/css-grid-2/#propdef-grid-template-columns" id="ef6f06610">CSS Grid</a>
   </table>
   <p>This allows us to use the full power of <a href="https://www.w3.org/TR/css-grid-2/">CSS Grid</a> in the <a data-link-type="dfn" href="#grid-axis" id="ref-for-grid-axis">grid axis</a>.  Line names and track sizes can be specified and <a data-link-type="dfn" href="https://drafts.csswg.org/css-grid-2/#grid-item" id="ref-for-grid-item">grid items</a> can be placed into the tracks and span them using <a class="property css" data-link-type="property" href="https://drafts.csswg.org/css-grid-2/#propdef-grid-column" id="ref-for-propdef-grid-column">grid-column</a> / <a class="property css" data-link-type="property" href="https://drafts.csswg.org/css-grid-2/#propdef-grid-row" id="ref-for-propdef-grid-row">grid-row</a> as usual.  The <a href="https://drafts.csswg.org/css-align">CSS Box Alignment</a> properties work the same as in a regular <a data-link-type="dfn" href="https://drafts.csswg.org/css-grid-2/#grid-container" id="ref-for-grid-container②">grid container</a> in this axis.  In the <a data-link-type="dfn" href="#masonry-axis" id="ref-for-masonry-axis">masonry axis</a> however, items are laid out one after another using the <a href="#masonry-layout-algorithm">§ 2.4 Masonry Layout Algorithm</a>.</p>
   <div class="example" id="example-1f001e34">
    <a class="self-link" href="#example-1f001e34"></a> Here’s a masonry layout <a href="examples/pinterest-with-span.html">example</a> demonstrating placed and spanning items: 
    <figure>
      <img src="images/example-pinterest-with-span.png"> 
     <figcaption>Rendering of the example above.</figcaption>
    </figure>
   </div>
   <p>Subgrid <a data-link-type="dfn" href="https://drafts.csswg.org/css-grid-2/#grid-item" id="ref-for-grid-item①">grid items</a> are supported, but subgridding only occurs in the <a data-link-type="dfn" href="https://drafts.csswg.org/css-grid-2/#grid-container" id="ref-for-grid-container③">grid container’s</a> <a data-link-type="dfn" href="#grid-axis" id="ref-for-grid-axis①">grid axis</a>; see <a href="#subgrids">§ 8 Subgrids</a> for details.</p>
   <p>If <span class="css">masonry</span> is specified for both <span class="css">grid-template-columns</span> and <span class="css">grid-template-rows</span>, then the used value for <span class="css">grid-template-columns</span> is <a class="css" data-link-type="maybe" href="https://drafts.csswg.org/css-grid-2/#valdef-grid-template-rows-none" id="ref-for-valdef-grid-template-rows-none①">none</a>, and thus the inline axis will be the <a data-link-type="dfn" href="#grid-axis" id="ref-for-grid-axis②">grid axis</a>.</p>
   <p><a data-link-type="dfn" href="https://drafts.csswg.org/css-grid-2/#grid-item" id="ref-for-grid-item②">Grid items</a> are formed and <a data-link-type="dfn" href="https://drafts.csswg.org/css-display-4/#blockify" id="ref-for-blockify">blockified</a> exactly the same as in a regular <a data-link-type="dfn" href="https://drafts.csswg.org/css-grid-2/#grid-container" id="ref-for-grid-container④">grid container</a>.</p>
   <p>All CSS properties work the same as in a regular <a data-link-type="dfn" href="https://drafts.csswg.org/css-grid-2/#grid-container" id="ref-for-grid-container⑤">grid container</a> unless otherwise specified by this specification.  For example, <span class="css">order</span> can be used to specify a different layout order for the items.</p>
   <h3 class="heading settled" data-level="2.1" id="line-name-resolution"><span class="secno">2.1. </span><span class="content"> Line Name Resolution</span><a class="self-link" href="#line-name-resolution"></a></h3>
   <p><a data-link-type="dfn" href="https://drafts.csswg.org/css-grid-2/#grid-item" id="ref-for-grid-item③">Grid item</a> line name resolution works the same as if <span class="css">masonry</span> were replaced with <a class="css" data-link-type="maybe" href="https://drafts.csswg.org/css-grid-2/#valdef-grid-template-rows-none" id="ref-for-valdef-grid-template-rows-none②">none</a>, i.e. line names are resolved <em>in both axes</em>.  The <a href="https://drafts.csswg.org/css-grid-2/#line-placement">line name resolution</a> works exactly is in <a href="https://www.w3.org/TR/css-grid-2/">CSS Grid</a>.</p>
   <h3 class="heading settled" data-level="2.2" id="grid-item-placement"><span class="secno">2.2. </span><span class="content"> Grid Item Placement</span><a class="self-link" href="#grid-item-placement"></a></h3>
   <p><a data-link-type="dfn" href="https://drafts.csswg.org/css-grid-2/#grid-item" id="ref-for-grid-item④">Grid items</a> are placed using these steps:</p>
   <ol>
    <li>Place the items as if the <a data-link-type="dfn" href="#masonry-axis" id="ref-for-masonry-axis①">masonry axis</a> had <a class="css" data-link-type="maybe" href="https://drafts.csswg.org/css-grid-2/#valdef-grid-template-rows-none" id="ref-for-valdef-grid-template-rows-none③">none</a> specified in that axis. 
    <li>For any items that were placed at the first (hypothetical) implicit line in the <a data-link-type="dfn" href="#masonry-axis" id="ref-for-masonry-axis②">masonry axis</a> in step 1, those items keep their placement in both axes as their final placement. They will be laid out first in each <a data-link-type="dfn" href="#grid-axis" id="ref-for-grid-axis③">grid axis</a> track and their <span id="ref-for-grid-axis④">grid axis</span> placement is considered definite henceforth. All other items ignore their placement from step 1.  Any item with a specified definite placement in the <span id="ref-for-masonry-axis③">masonry axis</span> that doesn’t result in it being placed at the first implicit line in the <span id="ref-for-masonry-axis④">masonry axis</span> will be treated as having <a class="property css" data-link-type="property">auto</a>-placement in that axis. 
    <li>Place items using the <a href="#masonry-layout-algorithm">Masonry layout algorithm</a> below. 
   </ol>
   <p>(The reason for step 1 above is to determine which items contribute to intrinsic track sizing in the <a data-link-type="dfn" href="#grid-axis" id="ref-for-grid-axis⑤">grid axis</a>; see <a href="#track-sizing">§ 2.3 Grid Axis Track Sizing</a> below.)</p>
   <h3 class="heading settled" data-level="2.3" id="track-sizing"><span class="secno">2.3. </span><span class="content"> Grid Axis Track Sizing</span><a class="self-link" href="#track-sizing"></a></h3>
   <p>Track sizing works the same as in <a href="https://drafts.csswg.org/css-grid-2/#algo-track-sizing">CSS Grid</a>, except that that the algorithm is run only with the subset of items that have a known <a data-link-type="dfn" href="#grid-axis" id="ref-for-grid-axis⑥">grid axis</a> placement.  This subset contains the items placed at the first implicit line in the <a data-link-type="dfn" href="#masonry-axis" id="ref-for-masonry-axis⑤">masonry axis</a> in <a href="#grid-item-placement">Grid Item Placement</a> above, plus the items that have a specified definite placement in the <span id="ref-for-grid-axis⑦">grid axis</span>, plus the items that span all <span id="ref-for-grid-axis⑧">grid axis</span> tracks (which obviously will be placed at the first implicit line since there is no other way to place them).  Other items will be placed in the <span id="ref-for-grid-axis⑨">grid axis</span> by the <a href="#masonry-layout-algorithm">§ 2.4 Masonry Layout Algorithm</a> below and don’t contribute to intrinsic track sizing (because that would create circular dependencies).</p>
   <h4 class="heading settled" data-level="2.3.1" id="repeat-auto-fit"><span class="secno">2.3.1. </span><span class="content"> repeat(auto-fit)</span><a class="self-link" href="#repeat-auto-fit"></a></h4>
   <p><span class="css">repeat(auto-fit)</span> behaves as <span class="css">repeat(auto-fill)</span> when the other axis is a <a data-link-type="dfn" href="#masonry-axis" id="ref-for-masonry-axis⑥">masonry axis</a>.  The reason for this is that <span class="css">auto</span>-placed items depend on the layout size of their siblings.  Removing empty tracks after layout wouldn’t be possible in most cases since it might affect any intrinsic track sizes.  Even if all track sizes are definite, the containing block size could change for grid-aligned absolutely-positioned descendants.  This makes <span class="css">repeat(auto-fit)</span> impossible to support in a grid container with masonry layout.</p>
   <h3 class="heading settled" data-level="2.4" id="masonry-layout-algorithm"><span class="secno">2.4. </span><span class="content"> Masonry Layout Algorithm</span><a class="self-link" href="#masonry-layout-algorithm"></a></h3>
   <p>Items are placed in <a href="https://drafts.csswg.org/css-flexbox-1/#order-modified-document-order">order-modified document order</a>, but items with a definite placement are placed before items with an indefinite position (as in regular grid layout). For each of the tracks in the <a data-link-type="dfn" href="#grid-axis" id="ref-for-grid-axis①⓪">grid axis</a>, keep a <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="running-position">running position</dfn> initialized to zero. For each item placed at the first implicit line in the <a data-link-type="dfn" href="#masonry-axis" id="ref-for-masonry-axis⑦">masonry axis</a> in <a href="#grid-item-placement">Grid Item Placement</a> step 1 above:</p>
   <ol>
    <li>Position the item at the content edge of the grid container in the <a data-link-type="dfn" href="#masonry-axis" id="ref-for-masonry-axis⑧">masonry axis</a> and at its start track in the <a data-link-type="dfn" href="#grid-axis" id="ref-for-grid-axis①①">grid axis</a>.
    <li>Calculate the size of the <a href="#containing-block">containing block</a> and then layout the item.  Then, calculate its resulting margin-box in the <a data-link-type="dfn" href="#masonry-axis" id="ref-for-masonry-axis⑨">masonry axis</a>. Set the <a data-link-type="dfn" href="#running-position" id="ref-for-running-position">running position</a> of the <a data-link-type="dfn" href="#grid-axis" id="ref-for-grid-axis①②">grid axis</a> tracks the item spans to the maximum of <code>margin-box-end + grid-gap</code> and the current <span id="ref-for-running-position①">running position</span> of those tracks.
   </ol>
   <p class="note" role="note"><span class="marker">Note:</span> This means that items with a definite placement at line 1 in the <a data-link-type="dfn" href="#masonry-axis" id="ref-for-masonry-axis①⓪">masonry axis</a> by <a href="#grid-item-placement">Grid Item Placement</a> step 1 can be made to intentionally overlap.</p>
   <p>The remaining items get their final placement using the following steps:</p>
   <ol>
    <li>
     If the item has an indefinite placement in the <a data-link-type="dfn" href="#grid-axis" id="ref-for-grid-axis①③">grid axis</a>, then resolve its definite placement in the <span id="ref-for-grid-axis①④">grid axis</span> using these substeps: 
     <ol>
      <li>Starting at the first <a data-link-type="dfn" href="#grid-axis" id="ref-for-grid-axis①⑤">grid axis</a> line in the implicit grid...
      <li>Find the largest <a data-link-type="dfn" href="#running-position" id="ref-for-running-position②">running position</a> of the <a data-link-type="dfn" href="#grid-axis" id="ref-for-grid-axis①⑥">grid axis</a> tracks that the item would span if it were placed at this line, and call this position <code>max_pos</code>.
      <li>Increment the line number and repeat step 2 until the item would no longer fit inside the grid.
      <li>Pick the line that resulted in the smallest <code>max_pos</code> as the item’s definite placement in the <a data-link-type="dfn" href="#grid-axis" id="ref-for-grid-axis①⑦">grid axis</a>.
     </ol>
      Otherwise, a definite placement in the <span id="ref-for-grid-axis①⑧">grid axis</span> is honored the same as in a regular grid. 
    <li>Position the item at its <a data-link-type="dfn" href="#grid-axis" id="ref-for-grid-axis①⑨">grid axis</a> start track and the maximum of the <a data-link-type="dfn" href="#running-position" id="ref-for-running-position③">running position</a>s of the tracks it spans. 
    <li>Calculate the size of the item’s <a href="#containing-block">containing block</a> and then layout the item. Then calculate its resulting margin-box in the <a data-link-type="dfn" href="#masonry-axis" id="ref-for-masonry-axis①①">masonry axis</a>. Set the <a data-link-type="dfn" href="#running-position" id="ref-for-running-position④">running position</a> of the <a data-link-type="dfn" href="#grid-axis" id="ref-for-grid-axis②⓪">grid axis</a> tracks the item spans to <code>max_pos + margin-box-end + grid-gap</code>. 
   </ol>
   <h3 class="heading settled" data-level="2.5" id="masonry-auto-flow"><span class="secno">2.5. </span><span class="content"> The <span class="css">masonry-auto-flow</span> Property</span><a class="self-link" href="#masonry-auto-flow"></a></h3>
   <p>The <a href="#masonry-layout-algorithm">§ 2.4 Masonry Layout Algorithm</a> above can be modified in two ways, using the new <a class="property css" data-link-type="property" href="#propdef-masonry-auto-flow" id="ref-for-propdef-masonry-auto-flow">masonry-auto-flow</a> property:</p>
   <table class="def propdef" data-link-for-hint="masonry-auto-flow">
    <tbody>
     <tr>
      <th>Name:
      <td><dfn class="dfn-paneled css" data-dfn-type="property" data-export id="propdef-masonry-auto-flow">masonry-auto-flow</dfn>
     <tr class="value">
      <th><a href="https://www.w3.org/TR/css-values/#value-defs">Value:</a>
      <td class="prod">[ pack <a data-link-type="grammar" href="https://drafts.csswg.org/css-values-4/#comb-one" id="ref-for-comb-one">|</a> next ] <a data-link-type="grammar" href="https://drafts.csswg.org/css-values-4/#comb-any" id="ref-for-comb-any">||</a> [definite-first <span id="ref-for-comb-one①">|</span> ordered ]
     <tr>
      <th><a href="https://www.w3.org/TR/css-cascade/#initial-values">Initial:</a>
      <td>pack
     <tr>
      <th><a href="https://www.w3.org/TR/css-cascade/#applies-to">Applies to:</a>
      <td><a data-link-type="dfn" href="https://drafts.csswg.org/css-grid-2/#grid-container" id="ref-for-grid-container⑥">grid containers</a> with masonry layout
     <tr>
      <th><a href="https://www.w3.org/TR/css-cascade/#inherited-property">Inherited:</a>
      <td>no
     <tr>
      <th><a href="https://www.w3.org/TR/css-values/#percentages">Percentages:</a>
      <td>n/a
     <tr>
      <th><a href="https://www.w3.org/TR/css-cascade/#computed">Computed value:</a>
      <td>specified keyword(s)
     <tr>
      <th><a href="https://www.w3.org/TR/cssom/#serializing-css-values">Canonical order:</a>
      <td>per grammar
     <tr>
      <th><a href="https://www.w3.org/TR/web-animations/#animation-type">Animation type:</a>
      <td>discrete
   </table>
   <p>First, picking definite items first for placement can be inhibited by specifying the <span class="css">ordered</span> keyword so that a plain <a href="https://drafts.csswg.org/css-flexbox-1/#order-modified-document-order">order-modified document order</a> is used instead.  Second, instead of placing the items in the track(s) with the most remaining space as described above we can place them one after another in the <a data-link-type="dfn" href="#grid-axis" id="ref-for-grid-axis②①">grid axis</a> by specifying the <span class="css">next</span> keyword, for <a href="examples/masonry-auto-flow-next.html">example</a>:</p>
   <div class="example" id="example-be4288db">
    <a class="self-link" href="#example-be4288db"></a> 
<pre class="language-css highlight">&lt;style>
.grid <c- p>{</c->
  <c- k>display</c-><c- p>:</c-> inline-grid<c- p>;</c->
  <c- k>grid</c-><c- p>:</c-> masonry / <c- nf>repeat</c-><c- p>(</c-><c- m>3</c-><c- p>,</c-> <c- m>2</c-><c- k>ch</c-><c- p>);</c->
  <c- k>border</c-><c- p>:</c-> <c- m>1</c-><c- k>px</c-> solid<c- p>;</c->
  <c- k>masonry-auto-flow</c-><c- p>:</c-> next<c- p>;</c->
<c- p>}</c->

item <c- p>{</c-> <c- k>background</c-><c- p>:</c-> silver <c- p>}</c->
item<c- nf>:nth-child</c-><c- p>(</c-><c- m>2</c-><c- k>n</c-><c- m>+1</c-><c- p>)</c-> <c- p>{</c->
  <c- k>background</c-><c- p>:</c-> pink<c- p>;</c->
  <c- k>height</c-><c- p>:</c-> <c- m>4</c-><c- k>em</c-><c- p>;</c->
<c- p>}</c->
&lt;/style>
</pre>
<pre class="language-html highlight"><c- p>&lt;</c-><c- f>div</c-> <c- e>class</c-><c- o>=</c-><c- s>"grid"</c-><c- p>></c->
  <c- p>&lt;</c-><c- f>item</c-><c- p>></c->1<c- p>&lt;/</c-><c- f>item</c-><c- p>></c->
  <c- p>&lt;</c-><c- f>item</c-><c- p>></c->2<c- p>&lt;/</c-><c- f>item</c-><c- p>></c->
  <c- p>&lt;</c-><c- f>item</c-><c- p>></c->3<c- p>&lt;/</c-><c- f>item</c-><c- p>></c->
  <c- p>&lt;</c-><c- f>item</c-><c- p>></c->4<c- p>&lt;/</c-><c- f>item</c-><c- p>></c->
<c- p>&lt;/</c-><c- f>div</c-><c- p>></c->
</pre>
    <figure>
      <img src="images/grid-auto-flow-example-1.png"> 
     <figcaption>Rendering of the <a class="css" data-link-type="propdesc" href="#propdef-masonry-auto-flow" id="ref-for-propdef-masonry-auto-flow①">masonry-auto-flow: next</a> example above.</figcaption>
    </figure>
    <p>(Without <a class="css" data-link-type="propdesc" href="#propdef-masonry-auto-flow" id="ref-for-propdef-masonry-auto-flow②">masonry-auto-flow: next</a>, item 4 would be placed below item 2.)</p>
   </div>
   <h2 class="heading settled" data-level="3" id="containing-block"><span class="secno">3. </span><span class="content"> Containing Block</span><a class="self-link" href="#containing-block"></a></h2>
   <p>The <a data-link-type="dfn" href="https://drafts.csswg.org/css-display-4/#containing-block" id="ref-for-containing-block">containing block</a> for a <a data-link-type="dfn" href="https://drafts.csswg.org/css-grid-2/#grid-item" id="ref-for-grid-item⑤">grid item</a> is formed by its <a data-link-type="dfn" href="https://drafts.csswg.org/css-grid-2/#grid-area" id="ref-for-grid-area">grid area</a> in the <a data-link-type="dfn" href="#grid-axis" id="ref-for-grid-axis②②">grid axis</a> and the grid container’s content-box in the <a data-link-type="dfn" href="#masonry-axis" id="ref-for-masonry-axis①②">masonry axis</a>.</p>
   <h2 class="heading settled" data-level="4" id="implicit-grid"><span class="secno">4. </span><span class="content"> The Implicit Grid </span><a class="self-link" href="#implicit-grid"></a></h2>
    The <a data-link-type="dfn" href="https://drafts.csswg.org/css-grid-2/#implicit-grid" id="ref-for-implicit-grid">implicit grid</a> is formed in the same way as for a regular grid container.  However, it’s only used in the <a data-link-type="dfn" href="#grid-axis" id="ref-for-grid-axis②③">grid axis</a>.  The flow axis specified by <span class="css">grid-auto-flow</span> is ignored — items are always placed by filling the <span id="ref-for-grid-axis②④">grid axis</span> (though note that the <span class="css">grid-auto-flow</span> property’s <a class="css" data-link-type="maybe" href="https://drafts.csswg.org/css-grid-2/#valdef-grid-auto-flow-dense" id="ref-for-valdef-grid-auto-flow-dense">dense</a> keyword does have an effect in determining which items end up at line 1 in the <a data-link-type="dfn" href="#masonry-axis" id="ref-for-masonry-axis①③">masonry axis</a>, in <a href="#grid-item-placement">§ 2.2 Grid Item Placement</a> step 1). <span class="css">direction:rtl</span> reverses the grid if the inline-axis is the <span id="ref-for-grid-axis②⑤">grid axis</span> (as usual for a regular grid container) and it makes items flow from right to left if the inline-axis is the <span id="ref-for-masonry-axis①④">masonry axis</span>. 
   <div class="example" id="example-de83ba08">
    <a class="self-link" href="#example-de83ba08"></a> Here’s a simple <a href="examples/rtl-grid-axis.html">example</a> using <a class="css" data-link-type="propdesc" href="https://drafts.csswg.org/css-writing-modes-3/#propdef-direction" id="ref-for-propdef-direction">direction: rtl</a> in the <a data-link-type="dfn" href="#grid-axis" id="ref-for-grid-axis②⑥">grid axis</a>: 
<pre class="language-css highlight">&lt;style>
.grid <c- p>{</c->
  <c- k>display</c-><c- p>:</c-> inline-grid<c- p>;</c->
  <c- k>direction</c-><c- p>:</c-> rtl<c- p>;</c->
  <c- k>grid</c-><c- p>:</c-> masonry / <c- nf>repeat</c-><c- p>(</c-><c- m>4</c-><c- p>,</c-> <c- m>2</c-><c- k>ch</c-><c- p>);</c->
  <c- k>border</c-><c- p>:</c-> <c- m>1</c-><c- k>px</c-> solid<c- p>;</c->
<c- p>}</c->

item <c- p>{</c-> <c- k>background</c-><c- p>:</c-> silver <c- p>}</c->
item<c- nf>:nth-child</c-><c- p>(</c-><c- m>2</c-><c- k>n</c-><c- m>+1</c-><c- p>)</c-> <c- p>{</c->
  <c- k>background</c-><c- p>:</c-> pink<c- p>;</c->
  <c- k>height</c-><c- p>:</c-> <c- m>4</c-><c- k>em</c-><c- p>;</c->
<c- p>}</c->
&lt;/style>
</pre>
<pre class="language-html highlight"><c- p>&lt;</c-><c- f>div</c-> <c- e>class</c-><c- o>=</c-><c- s>"grid"</c-><c- p>></c->
  <c- p>&lt;</c-><c- f>item</c-><c- p>></c->1<c- p>&lt;/</c-><c- f>item</c-><c- p>></c->
  <c- p>&lt;</c-><c- f>item</c-> <c- e>style</c-><c- o>=</c-><c- s>"grid-column:span 2"</c-><c- p>></c->2<c- p>&lt;/</c-><c- f>item</c-><c- p>></c->
  <c- p>&lt;</c-><c- f>item</c-><c- p>></c->3<c- p>&lt;/</c-><c- f>item</c-><c- p>></c->
  <c- p>&lt;</c-><c- f>item</c-><c- p>></c->4<c- p>&lt;/</c-><c- f>item</c-><c- p>></c->
<c- p>&lt;/</c-><c- f>div</c-><c- p>></c->
</pre>
    <figure>
      <img src="images/rtl-grid-axis.png"> 
     <figcaption>Rendering of the <a class="css" data-link-type="propdesc" href="https://drafts.csswg.org/css-writing-modes-3/#propdef-direction" id="ref-for-propdef-direction①">direction: rtl</a> example above.</figcaption>
    </figure>
   </div>
   <div class="example" id="example-7150e913">
    <a class="self-link" href="#example-7150e913"></a> Here’s a simple <a href="examples/rtl-masonry-axis.html">example</a> using <a class="css" data-link-type="propdesc" href="https://drafts.csswg.org/css-writing-modes-3/#propdef-direction" id="ref-for-propdef-direction②">direction: rtl</a> in the <a data-link-type="dfn" href="#masonry-axis" id="ref-for-masonry-axis①⑤">masonry axis</a>: 
<pre class="language-css highlight">&lt;style>
.grid <c- p>{</c->
  <c- k>display</c-><c- p>:</c-> inline-grid<c- p>;</c->
  <c- k>direction</c-><c- p>:</c-> rtl<c- p>;</c->
  <c- k>width</c-><c- p>:</c-> <c- m>10</c-><c- k>ch</c-><c- p>;</c->
  <c- k>column-gap</c-><c- p>:</c-> <c- m>1</c-><c- k>ch</c-><c- p>;</c->
  <c- k>grid</c-><c- p>:</c-> <c- nf>repeat</c-><c- p>(</c-><c- m>4</c-><c- p>,</c-> <c- m>2</c-><c- k>em</c-><c- p>)</c-> / masonry<c- p>;</c->
  <c- k>border</c-><c- p>:</c-> <c- m>1</c-><c- k>px</c-> solid<c- p>;</c->
<c- p>}</c->

item <c- p>{</c-> <c- k>background</c-><c- p>:</c-> silver <c- p>}</c->
item<c- nf>:nth-child</c-><c- p>(</c-><c- m>2</c-><c- k>n</c-><c- m>+1</c-><c- p>)</c-> <c- p>{</c->
  <c- k>background</c-><c- p>:</c-> pink<c- p>;</c->
  <c- k>width</c-><c- p>:</c-> <c- m>4</c-><c- k>ch</c-><c- p>;</c->
<c- p>}</c->
&lt;/style>
</pre>
<pre class="language-html highlight"><c- p>&lt;</c-><c- f>div</c-> <c- e>class</c-><c- o>=</c-><c- s>"grid"</c-><c- p>></c->
  <c- p>&lt;</c-><c- f>item</c-><c- p>></c->1<c- p>&lt;/</c-><c- f>item</c-><c- p>></c->
  <c- p>&lt;</c-><c- f>item</c-> <c- e>style</c-><c- o>=</c-><c- s>"grid-row:span 2"</c-><c- p>></c->2<c- p>&lt;/</c-><c- f>item</c-><c- p>></c->
  <c- p>&lt;</c-><c- f>item</c-><c- p>></c->3<c- p>&lt;/</c-><c- f>item</c-><c- p>></c->
  <c- p>&lt;</c-><c- f>item</c-><c- p>></c->4<c- p>&lt;/</c-><c- f>item</c-><c- p>></c->
<c- p>&lt;/</c-><c- f>div</c-><c- p>></c->
</pre>
    <figure>
      <img src="images/rtl-masonry-axis.png"> 
     <figcaption>Rendering of the <a class="css" data-link-type="propdesc" href="https://drafts.csswg.org/css-writing-modes-3/#propdef-direction" id="ref-for-propdef-direction③">direction: rtl</a> example above.</figcaption>
    </figure>
   </div>
   <h2 class="heading settled" data-level="5" id="intrinsic-sizes"><span class="secno">5. </span><span class="content"> Sizing Grid Containers</span><a class="self-link" href="#intrinsic-sizes"></a></h2>
   <p><a href="https://drafts.csswg.org/css-grid-2/#intrinsic-sizes">Sizing Grid Containers</a> works the same as for regular <a data-link-type="dfn" href="https://drafts.csswg.org/css-grid-2/#grid-container" id="ref-for-grid-container⑦">grid containers</a> but with the following addendum for the <a data-link-type="dfn" href="#masonry-axis" id="ref-for-masonry-axis①⑥">masonry axis</a>: The <a data-link-type="dfn" href="https://drafts.csswg.org/css-sizing-3/#max-content" id="ref-for-max-content">max-content size</a> (<a data-link-type="dfn" href="https://drafts.csswg.org/css-sizing-3/#min-content" id="ref-for-min-content">min-content size</a>) of a grid container in the <span id="ref-for-masonry-axis①⑦">masonry axis</span> is the largest distance between the <span id="ref-for-grid-container⑧">grid container’s</span> content-box start edge and the maximum margin-box end of all the items, when sized under a <a data-link-type="dfn" href="https://drafts.csswg.org/css-sizing-3/#max-content-constraint" id="ref-for-max-content-constraint">max-content constraint</a> (<a data-link-type="dfn" href="https://drafts.csswg.org/css-sizing-3/#min-content-constraint" id="ref-for-min-content-constraint">min-content constraint</a>).</p>
   <div class="example" id="example-759140be">
    <a class="self-link" href="#example-759140be"></a> Here’s a simple <a href="examples/grid-intrinsic-sizing-example-1.html">example</a>: 
<pre class="language-css highlight">&lt;style>
.grid <c- p>{</c->
  <c- k>display</c-><c- p>:</c-> inline-grid<c- p>;</c->
  <c- k>grid</c-><c- p>:</c-> masonry / <c- m>50</c-><c- k>px</c-> <c- m>100</c-><c- k>px</c-> auto<c- p>;</c->
  <c- k>grid-gap</c-><c- p>:</c-> <c- m>10</c-><c- k>px</c-><c- p>;</c->
  <c- k>border</c-><c- p>:</c-> <c- m>1</c-><c- k>px</c-> solid<c- p>;</c->
<c- p>}</c->
item <c- p>{</c-> <c- k>background</c-><c- p>:</c-> silver<c- p>;</c-> <c- k>margin</c-><c- p>:</c-> <c- m>5</c-><c- k>px</c-><c- p>;</c-> <c- p>}</c->
&lt;/style>
</pre>
<pre class="language-html highlight"><c- p>&lt;</c-><c- f>div</c-> <c- e>class</c-><c- o>=</c-><c- s>"grid"</c-><c- p>></c->
  <c- p>&lt;</c-><c- f>item</c-> <c- e>style</c-><c- o>=</c-><c- s>"border:10px solid"</c-><c- p>></c->1<c- p>&lt;/</c-><c- f>item</c-><c- p>></c->
  <c- p>&lt;</c-><c- f>item</c-><c- p>></c->2<c- p>&lt;/</c-><c- f>item</c-><c- p>></c->
  <c- p>&lt;</c-><c- f>item</c-><c- p>></c->3<c- p>&lt;/</c-><c- f>item</c-><c- p>></c->
  <c- p>&lt;</c-><c- f>item</c-> <c- e>style</c-><c- o>=</c-><c- s>"height:50px"</c-><c- p>></c->4<c- p>&lt;/</c-><c- f>item</c-><c- p>></c->
  <c- p>&lt;</c-><c- f>item</c-><c- p>></c->5<c- p>&lt;/</c-><c- f>item</c-><c- p>></c->
  <c- p>&lt;</c-><c- f>item</c-><c- p>></c->6<c- p>&lt;/</c-><c- f>item</c-><c- p>></c->
<c- p>&lt;/</c-><c- f>div</c-><c- p>></c->
</pre>
    <figure>
      <img src="images/grid-intrinsic-sizing-example-1.png"> 
     <figcaption>Rendering of the grid container intrinsic sizing example above.</figcaption>
    </figure>
   </div>
   <h2 class="heading settled" data-level="6" id="alignment"><span class="secno">6. </span><span class="content"> Alignment and Spacing</span><a class="self-link" href="#alignment"></a></h2>
   <p><a href="https://www.w3.org/TR/css-grid-2/#gutters">Gutters</a> are supported in both axes. In the <a data-link-type="dfn" href="#masonry-axis" id="ref-for-masonry-axis①⑧">masonry axis</a>, the gap is applied between the margin boxes of each pair of adjacent items.  Margins do not collapse in either axis.</p>
   <p>In the <a data-link-type="dfn" href="#grid-axis" id="ref-for-grid-axis②⑦">grid axis</a>, <a href="https://drafts.csswg.org/css-grid-2/#alignment">alignment</a> works the same as in a regular <a data-link-type="dfn" href="https://drafts.csswg.org/css-grid-2/#grid-container" id="ref-for-grid-container⑨">grid container</a>.</p>
   <p>In the <a data-link-type="dfn" href="#masonry-axis" id="ref-for-masonry-axis①⑨">masonry axis</a>, <a href="https://drafts.csswg.org/css-align/#content-distribution">content-distribution</a> is applied to the content as a whole, similarly to how it behaves in block containers.  More specifically, the <a data-link-type="dfn" href="https://drafts.csswg.org/css-align-3/#alignment-subject" id="ref-for-alignment-subject">alignment subject</a> is the <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="masonry-box">masonry box</dfn>, which is the area between the content-box edge of the <a data-link-type="dfn" href="https://drafts.csswg.org/css-grid-2/#grid-container" id="ref-for-grid-container①⓪">grid container</a> and the margin-box end edge of the item that is the furthest away in the <span id="ref-for-masonry-axis②⓪">masonry axis</span>, as indicated by the dashed border here:</p>
   <figure>
     <img src="images/masonry-box.png"> 
    <figcaption> The extent of the <a data-link-type="dfn" href="#masonry-box" id="ref-for-masonry-box">masonry box</a> is indicated by the dashed border.
		(Note that item 1 has a 5px bottom margin here.) </figcaption>
   </figure>
   <p>Note that there is only ever one <a data-link-type="dfn" href="https://drafts.csswg.org/css-align-3/#alignment-subject" id="ref-for-alignment-subject①">alignment subject</a> for these properties in the <a data-link-type="dfn" href="#masonry-axis" id="ref-for-masonry-axis②①">masonry axis</a>, so the unique <a class="property css" data-link-type="property" href="https://drafts.csswg.org/css-align-3/#propdef-align-content" id="ref-for-propdef-align-content">align-content</a> / <a class="property css" data-link-type="property" href="https://drafts.csswg.org/css-align-3/#propdef-justify-content" id="ref-for-propdef-justify-content">justify-content</a> values boil down to <a class="css" data-link-type="maybe" href="https://drafts.csswg.org/css-align-3/#valdef-self-position-start" id="ref-for-valdef-self-position-start">start</a>, <a class="css" data-link-type="maybe" href="https://drafts.csswg.org/css-align-3/#valdef-self-position-center" id="ref-for-valdef-self-position-center">center</a>, <a class="css" data-link-type="maybe" href="https://drafts.csswg.org/css-align-3/#valdef-self-position-end" id="ref-for-valdef-self-position-end">end</a>, <a class="css" data-link-type="maybe" href="https://drafts.csswg.org/css-align-3/#valdef-align-content-stretch" id="ref-for-valdef-align-content-stretch">stretch</a> and <a data-link-type="dfn" href="https://drafts.csswg.org/css-align-3/#baseline-alignment" id="ref-for-baseline-alignment">baseline alignment</a>. (<a class="css" data-link-type="maybe" href="https://drafts.csswg.org/css-align-3/#valdef-justify-content-normal" id="ref-for-valdef-justify-content-normal">normal</a> behaves as <span class="css" id="ref-for-valdef-align-content-stretch①">stretch</span> as usual for <a data-link-type="dfn" href="https://drafts.csswg.org/css-grid-2/#grid-container" id="ref-for-grid-container①①">grid containers</a>).  In the figure above, the <span id="ref-for-grid-container①②">grid container</span> has <span class="css" id="ref-for-propdef-align-content①">align-content: start</span>; but if <span class="css">align-content</span> were at its default <a class="css" data-link-type="maybe" href="https://drafts.csswg.org/css-align-3/#valdef-align-self-normal" id="ref-for-valdef-align-self-normal">normal</a> value, then the <a data-link-type="dfn" href="#masonry-box" id="ref-for-masonry-box①">masonry box</a> would fill the <span id="ref-for-grid-container①③">grid container</span>'s content box, due to being stretched.  Moreover: if the grid items overflowed the <span id="ref-for-grid-container①④">grid container</span>'s content box in the masonry axis, then the masonry box would be larger than the <span id="ref-for-grid-container①⑤">grid container</span>'s content box.</p>
   <h3 class="heading settled" data-level="6.1" id="tracks-alignment"><span class="secno">6.1. </span><span class="content"> The <span class="css">align-tracks</span> and <span class="css">justify-tracks</span> Properties </span><a class="self-link" href="#tracks-alignment"></a></h3>
   <p>This specification adds two new properties to align the items in the <a data-link-type="dfn" href="#masonry-axis" id="ref-for-masonry-axis②②">masonry axis</a> for each individual <a data-link-type="dfn" href="#grid-axis" id="ref-for-grid-axis②⑧">grid axis</a> track:</p>
   <table class="def propdef" data-link-for-hint="align-tracks">
    <tbody>
     <tr>
      <th>Name:
      <td><dfn class="dfn-paneled css" data-dfn-type="property" data-export id="propdef-align-tracks">align-tracks</dfn>
     <tr class="value">
      <th><a href="https://www.w3.org/TR/css-values/#value-defs">Value:</a>
      <td class="prod">[normal <a data-link-type="grammar" href="https://drafts.csswg.org/css-values-4/#comb-one" id="ref-for-comb-one②">|</a> <a class="production css" data-link-type="type" href="https://drafts.csswg.org/css-align-3/#typedef-baseline-position" id="ref-for-typedef-baseline-position">&lt;baseline-position></a> <span id="ref-for-comb-one③">|</span> <a class="production css" data-link-type="type" href="https://drafts.csswg.org/css-align-3/#typedef-content-distribution" id="ref-for-typedef-content-distribution">&lt;content-distribution></a> <span id="ref-for-comb-one④">|</span> <a class="production css" data-link-type="type" href="https://drafts.csswg.org/css-align-3/#typedef-overflow-position" id="ref-for-typedef-overflow-position">&lt;overflow-position></a><a data-link-type="grammar" href="https://drafts.csswg.org/css-values-4/#mult-opt" id="ref-for-mult-opt">?</a> <a class="production css" data-link-type="type" href="https://drafts.csswg.org/css-align-3/#typedef-content-position" id="ref-for-typedef-content-position">&lt;content-position></a>]<a data-link-type="grammar" href="https://drafts.csswg.org/css-values-4/#mult-comma" id="ref-for-mult-comma">#</a>
     <tr>
      <th><a href="https://www.w3.org/TR/css-cascade/#initial-values">Initial:</a>
      <td>normal
     <tr>
      <th><a href="https://www.w3.org/TR/css-cascade/#applies-to">Applies to:</a>
      <td><a data-link-type="dfn" href="https://drafts.csswg.org/css-grid-2/#grid-container" id="ref-for-grid-container①⑥">grid containers</a> with masonry layout in their block axis
     <tr>
      <th><a href="https://www.w3.org/TR/css-cascade/#inherited-property">Inherited:</a>
      <td>no
     <tr>
      <th><a href="https://www.w3.org/TR/css-values/#percentages">Percentages:</a>
      <td>n/a
     <tr>
      <th><a href="https://www.w3.org/TR/css-cascade/#computed">Computed value:</a>
      <td>specified keyword(s)
     <tr>
      <th><a href="https://www.w3.org/TR/cssom/#serializing-css-values">Canonical order:</a>
      <td>per grammar
     <tr>
      <th><a href="https://www.w3.org/TR/web-animations/#animation-type">Animation type:</a>
      <td>discrete
   </table>
   <table class="def propdef" data-link-for-hint="justify-tracks">
    <tbody>
     <tr>
      <th>Name:
      <td><dfn class="dfn-paneled css" data-dfn-type="property" data-export id="propdef-justify-tracks">justify-tracks</dfn>
     <tr class="value">
      <th><a href="https://www.w3.org/TR/css-values/#value-defs">Value:</a>
      <td class="prod">[normal <a data-link-type="grammar" href="https://drafts.csswg.org/css-values-4/#comb-one" id="ref-for-comb-one⑤">|</a> <a class="production css" data-link-type="type" href="https://drafts.csswg.org/css-align-3/#typedef-content-distribution" id="ref-for-typedef-content-distribution①">&lt;content-distribution></a> <span id="ref-for-comb-one⑥">|</span> <a class="production css" data-link-type="type" href="https://drafts.csswg.org/css-align-3/#typedef-overflow-position" id="ref-for-typedef-overflow-position①">&lt;overflow-position></a><a data-link-type="grammar" href="https://drafts.csswg.org/css-values-4/#mult-opt" id="ref-for-mult-opt①">?</a> [ <a class="production css" data-link-type="type" href="https://drafts.csswg.org/css-align-3/#typedef-content-position" id="ref-for-typedef-content-position①">&lt;content-position></a> <span id="ref-for-comb-one⑦">|</span> left <span id="ref-for-comb-one⑧">|</span> right ] ]<a data-link-type="grammar" href="https://drafts.csswg.org/css-values-4/#mult-comma" id="ref-for-mult-comma①">#</a>
     <tr>
      <th><a href="https://www.w3.org/TR/css-cascade/#initial-values">Initial:</a>
      <td>normal
     <tr>
      <th><a href="https://www.w3.org/TR/css-cascade/#applies-to">Applies to:</a>
      <td><a data-link-type="dfn" href="https://drafts.csswg.org/css-grid-2/#grid-container" id="ref-for-grid-container①⑦">grid containers</a> with masonry layout in their inline axis
     <tr>
      <th><a href="https://www.w3.org/TR/css-cascade/#inherited-property">Inherited:</a>
      <td>no
     <tr>
      <th><a href="https://www.w3.org/TR/css-values/#percentages">Percentages:</a>
      <td>n/a
     <tr>
      <th><a href="https://www.w3.org/TR/css-cascade/#computed">Computed value:</a>
      <td>specified keyword(s)
     <tr>
      <th><a href="https://www.w3.org/TR/cssom/#serializing-css-values">Canonical order:</a>
      <td>per grammar
     <tr>
      <th><a href="https://www.w3.org/TR/web-animations/#animation-type">Animation type:</a>
      <td>discrete
   </table>
   <p class="note" role="note"><span class="marker">Note:</span> These values are the same as for <a class="property css" data-link-type="property" href="https://drafts.csswg.org/css-align-3/#propdef-align-content" id="ref-for-propdef-align-content②">align-content</a> / <a class="property css" data-link-type="property" href="https://drafts.csswg.org/css-align-3/#propdef-justify-content" id="ref-for-propdef-justify-content①">justify-content</a>, but here we accept multiple values in a comma-separated list.</p>
   <p>Unlike <a class="property css" data-link-type="property" href="https://drafts.csswg.org/css-align-3/#propdef-align-content" id="ref-for-propdef-align-content③">align-content</a> / <a class="property css" data-link-type="property" href="https://drafts.csswg.org/css-align-3/#propdef-justify-content" id="ref-for-propdef-justify-content②">justify-content</a>, <span class="css">normal</span> behaves as <span class="css">start</span> for these properties.  So the default rendering is the expected packed masonry layout as shown in the top left corner in the example below.  When multiple values are specified, the first track in the <a data-link-type="dfn" href="#grid-axis" id="ref-for-grid-axis②⑨">grid axis</a> uses the first value, the second track uses the second value, etc.  If there are fewer values than tracks, then the last value is used for the remaining tracks.  If there are more values than tracks, then the remaining values have no effect on the rendering.</p>
   <div class="example" id="example-9dcbe46d">
    <a class="self-link" href="#example-9dcbe46d"></a> Here’s a <a href="examples/align-tracks-example-1.html">testcase</a> that demonstrates a few <a class="property css" data-link-type="property" href="#propdef-align-tracks" id="ref-for-propdef-align-tracks">align-tracks</a> alignment possibilities. 
    <figure>
      <img src="images/align-tracks-example-1.png"> 
     <figcaption> The rendering of the <span class="css">align-tracks</span> example above. </figcaption>
    </figure>
   </div>
   <h3 class="heading settled" data-level="6.2" id="masonry-axis-stretch-alignment"><span class="secno">6.2. </span><span class="content"> Stretch Alignment in the Masonry Axis</span><a class="self-link" href="#masonry-axis-stretch-alignment"></a></h3>
   <p><span class="css">stretch</span> will stretch the items in the <a data-link-type="dfn" href="#masonry-axis" id="ref-for-masonry-axis②③">masonry axis</a> for each track separately, to fill the grid container’s content-box.  Any item can opt out from stretching by setting <span class="css">align-self</span> / <span class="css">justify-self</span> to something other than <a class="css" data-link-type="maybe" href="https://drafts.csswg.org/css-align-3/#valdef-align-self-normal" id="ref-for-valdef-align-self-normal①">normal</a> or <a class="css" data-link-type="maybe" href="https://drafts.csswg.org/css-align-3/#valdef-align-self-stretch" id="ref-for-valdef-align-self-stretch">stretch</a> in the relevant axis.  A stretched item with an <a data-link-type="dfn" href="https://drafts.csswg.org/css-sizing-3/#indefinite" id="ref-for-indefinite">indefinite size</a> in the <span id="ref-for-masonry-axis②④">masonry axis</span> will stretch its content-box size, but only up to its <a data-link-type="dfn" href="https://drafts.csswg.org/css-sizing-3/#max-width" id="ref-for-max-width">max size</a>. An item with a <a data-link-type="dfn" href="https://drafts.csswg.org/css-sizing-3/#definite" id="ref-for-definite">definite size</a> and an <span class="css">auto</span> margin in the <span id="ref-for-masonry-axis②⑤">masonry axis</span> will stretch by increasing <span class="css">auto</span> margin(s).  Otherwise, the item doesn’t stretch.</p>
   <div class="example" id="example-5beb250c">
    <a class="self-link" href="#example-5beb250c"></a> Here’s a <a href="examples/align-tracks-example-2.html">testcase</a> that demonstrates stretching items in the <a data-link-type="dfn" href="#masonry-axis" id="ref-for-masonry-axis②⑥">masonry axis</a>. 
    <figure>
     <video controls src="images/align-tracks-example-2.webm"></video>
     <figcaption> Visualization of the <a class="css" data-link-type="propdesc" href="#propdef-align-tracks" id="ref-for-propdef-align-tracks①">align-tracks: stretch</a> example above. </figcaption>
    </figure>
    <p>Only the purple items have <a class="css" data-link-type="maybe" href="https://drafts.csswg.org/css-sizing-3/#valdef-width-auto" id="ref-for-valdef-width-auto">auto</a> height, so they are the ones that may grow by default.  A few items worth noting: item 4 has <a class="css" data-link-type="propdesc" href="https://drafts.csswg.org/css-sizing-3/#propdef-max-height" id="ref-for-propdef-max-height">max-height: 40px</a> so it only grows up to that size and then the other items in its track picks up the remaining size. Item 16 opts out from resizing by setting <a class="css" data-link-type="propdesc" href="https://drafts.csswg.org/css-align-3/#propdef-align-self" id="ref-for-propdef-align-self">align-self: end</a>. Item 18 has <a class="css" data-link-type="propdesc" href="https://drafts.csswg.org/css-logical-1/#propdef-margin-block" id="ref-for-propdef-margin-block">margin-block: auto</a> so it’s centered in its allotted space instead of growing. Item 20 has <a class="css" data-link-type="propdesc" href="https://drafts.csswg.org/css-box-4/#propdef-margin-top" id="ref-for-propdef-margin-top">margin-top: auto</a> so it’s aligned to the end while its top-margin grows.</p>
   </div>
   <div class="example" id="example-9a8520b9">
    <a class="self-link" href="#example-9a8520b9"></a> Here’s the corresponding <a href="examples/justify-tracks-example-1.html">testcase</a> with a masonry inline-axis instead. 
    <figure>
     <video controls src="images/justify-tracks-example-1.webm"></video>
     <figcaption> Visualization of the <a class="css" data-link-type="propdesc" href="#propdef-justify-tracks" id="ref-for-propdef-justify-tracks">justify-tracks: stretch</a> example above. </figcaption>
    </figure>
   </div>
   <h3 class="heading settled" data-level="6.3" id="masonry-axis-alignment"><span class="secno">6.3. </span><span class="content"> Individual Track Alignment in the Masonry Axis</span><a class="self-link" href="#masonry-axis-alignment"></a></h3>
   <p><span class="css">align-tracks</span> / <span class="css">justify-tracks</span> values can be specified per track.</p>
   <div class="example" id="example-560e1945">
    <a class="self-link" href="#example-560e1945"></a> Here’s an <a href="examples/masonry-axis-alignment-1.html">example</a> to illustrate this. Note that this example’s <a class="property css" data-link-type="property" href="#propdef-align-tracks" id="ref-for-propdef-align-tracks②">align-tracks</a> value intentionally has one value less than the number of tracks to illustrate that the remaining track(s) use the last value (i.e. the right-most track also uses <span class="css">space-evenly</span>). (<span class="css">baseline</span> values are also supported but excluded in this test, see <a href="#masonry-axis-baseline-alignment">§ 6.4 Baseline Alignment in the Masonry Axis</a> for a description how that works with examples.) 
    <figure>
      <img src="images/masonry-axis-alignment-1.png"> 
     <figcaption> Rendering of the <span class="css">align-tracks</span> alignment example above. </figcaption>
    </figure>
   </div>
   <h3 class="heading settled" data-level="6.4" id="masonry-axis-baseline-alignment"><span class="secno">6.4. </span><span class="content"> Baseline Alignment in the Masonry Axis</span><a class="self-link" href="#masonry-axis-baseline-alignment"></a></h3>
   <p>Item <a data-link-type="dfn" href="https://drafts.csswg.org/css-align-3/#baseline-alignment" id="ref-for-baseline-alignment①">baseline alignment</a> inside the <a data-link-type="dfn" href="#grid-axis" id="ref-for-grid-axis③⓪">grid axis</a> tracks works as usual for a regular <a data-link-type="dfn" href="https://drafts.csswg.org/css-grid-2/#grid-container" id="ref-for-grid-container①⑧">grid container</a>, and the grid container’s baseline is determined the same as for a regular grid container in that axis.</p>
   <p><a data-link-type="dfn" href="https://drafts.csswg.org/css-align-3/#baseline-alignment" id="ref-for-baseline-alignment②">Baseline alignment</a> is supported also in the <a data-link-type="dfn" href="#masonry-axis" id="ref-for-masonry-axis②⑦">masonry axis</a>, on the first and last item in each track (but not on items "in the middle" of the track). Only tracks with the <a class="property css" data-link-type="property" href="#propdef-align-tracks" id="ref-for-propdef-align-tracks③">align-tracks</a> / <a class="property css" data-link-type="property" href="#propdef-justify-tracks" id="ref-for-propdef-justify-tracks①">justify-tracks</a> values <span class="css">start</span>, <span class="css">end</span> or <span class="css">stretch</span> support baseline alignment. There are four different sets of <a data-link-type="dfn" href="https://drafts.csswg.org/css-align-3/#baseline-sharing-group" id="ref-for-baseline-sharing-group">baseline-sharing groups</a>:</p>
   <ol>
    <li>the first item in each <span class="css">start</span> track + the first item in each <span class="css">stretch</span> track 
    <li>the last item in each <span class="css">start</span> track 
    <li>the first item in each <span class="css">end</span> track 
    <li>the last item in each <span class="css">end</span> track + the last item in each <span class="css">stretch</span> track 
   </ol>
   <p>Each of those sets can have a <a data-link-type="dfn" href="https://drafts.csswg.org/css-align-3/#first-baseline-set" id="ref-for-first-baseline-set">first baseline set</a> and a <a data-link-type="dfn" href="https://drafts.csswg.org/css-align-3/#last-baseline-set" id="ref-for-last-baseline-set">last baseline set</a>, resulting in eight unique baseline sets in the <a data-link-type="dfn" href="#masonry-axis" id="ref-for-masonry-axis②⑧">masonry axis</a>.</p>
   <p class="issue" id="issue-0877829d"><a class="self-link" href="#issue-0877829d"></a> specify how the grid container’s first(last) baseline in the <a data-link-type="dfn" href="#masonry-axis" id="ref-for-masonry-axis②⑨">masonry axis</a> is determined</p>
   <div class="example" id="example-ec1263df">
    <a class="self-link" href="#example-ec1263df"></a> Here’s an <a href="examples/masonry-axis-baseline-alignment-1.html">example</a> illustrating all eight possibilities.
(The example uses two separate <a data-link-type="dfn" href="https://drafts.csswg.org/css-grid-2/#grid-container" id="ref-for-grid-container①⑨">grid containers</a> to illustrate the first ("F") and last ("L") baseline sets to avoid cluttering the illustration, but it is possible to use all eight sets in the same container.)  The aligned baselines are indicated with red color.  Note that the tracks that are attached to the end side of the <a data-link-type="dfn" href="#masonry-box" id="ref-for-masonry-box②">masonry box</a> adjust the padding (or margin in the case of <a class="property css" data-link-type="property" href="https://drafts.csswg.org/css-align-3/#propdef-align-self" id="ref-for-propdef-align-self①">align-self</a>) on the end side, whereas tracks attached to the start side adjust the start padding/margin. (only <a class="property css" data-link-type="property" href="https://drafts.csswg.org/css-align-3/#propdef-align-content" id="ref-for-propdef-align-content④">align-content</a> is used in this example, which adjusts the padding, since it’s easier to see the baseline adjustment. <span class="property" id="ref-for-propdef-align-self②">align-self</span> can also be used, or a mix of the two, as usual.) 
    <figure>
      <img src="images/masonry-axis-baseline-alignment-1.png"> 
     <figcaption> The rendering of the example above. </figcaption>
    </figure>
   </div>
   <p class="issue" id="issue-7304afcc"><a class="self-link" href="#issue-7304afcc"></a> this needs more details about edge cases, caveat about misalignment in stretch, etc</p>
   <p><strong class="advisement"> Authors are advised to be careful with using alignment values other than <span class="css">start</span> when some items span more than one track, because it’s easy to cause items to unintentionally overlap in this case.</strong></p>
   <p class="issue" id="issue-2abb2fa3"><a class="self-link" href="#issue-2abb2fa3"></a> maybe we can make stretch alignment (at least) smarter so that we avoid overlapping spanning items in a few more cases that would be useful to authors?</p>
   <h2 class="heading settled" data-level="7" id="pagination"><span class="secno">7. </span><span class="content"> Fragmentation</span><a class="self-link" href="#pagination"></a></h2>
   <h3 class="heading settled" data-level="7.1" id="masonry-axis-pagination"><span class="secno">7.1. </span><span class="content"> Fragmentation in the Masonry Axis</span><a class="self-link" href="#masonry-axis-pagination"></a></h3>
   <p>Each <a data-link-type="dfn" href="#grid-axis" id="ref-for-grid-axis③①">grid axis</a> track is fragmented independently in the <a data-link-type="dfn" href="#masonry-axis" id="ref-for-masonry-axis③⓪">masonry axis</a>.  If a <a data-link-type="dfn" href="https://drafts.csswg.org/css-grid-2/#grid-item" id="ref-for-grid-item⑥">grid item</a> is fragmented, or has a <a data-link-type="dfn" href="https://drafts.csswg.org/css-break-4/#forced-break" id="ref-for-forced-break">forced break</a> before/after it, then the <a data-link-type="dfn" href="#running-position" id="ref-for-running-position⑤">running position</a> for the tracks that it spans in the <span id="ref-for-grid-axis③②">grid axis</span> are set to the size of the <a data-link-type="dfn" href="https://drafts.csswg.org/css-break-4/#fragmentainer" id="ref-for-fragmentainer">fragmentainer</a> so that no further items will be placed in those tracks.  An item that is split into multiple fragments retains its placement in the <span id="ref-for-grid-axis③③">grid axis</span> for all its fragments.  A grid item that is pushed, however, is placed again by the next grid container fragment.  Placement continues until all items are placed or pushed to a new fragment.</p>
   <div class="example" id="example-b489c79e">
    <a class="self-link" href="#example-b489c79e"></a> Here’s an <a href="examples/fragmentation-block-axis-example.html">example</a> illustrating fragmentation of a grid with masonry layout in its block-axis. It renders like this: 
    <figure style="max-width:100%">
     <video controls src="images/fragmentation-block-axis-example.webm" style="max-width:100%"></video>
     <figcaption> Visualization of fragmentation in a block-axis masonry layout. </figcaption>
    </figure>
   </div>
   <h3 class="heading settled" data-level="7.2" id="grid-axis-pagination"><span class="secno">7.2. </span><span class="content"> Fragmentation in the Grid Axis</span><a class="self-link" href="#grid-axis-pagination"></a></h3>
   <p>Fragmentation in the <a data-link-type="dfn" href="#grid-axis" id="ref-for-grid-axis③④">grid axis</a> with masonry layout in the other axis is also supported. In this case the fragmentation behaves more like in a regular <a data-link-type="dfn" href="https://drafts.csswg.org/css-grid-2/#grid-container" id="ref-for-grid-container②⓪">grid container</a>; however, there’s a separate step to determine which <a data-link-type="dfn">grid-axis</a> track each item is placed into, before fragmentation occurs.</p>
   <div class="example" id="example-740b4428">
    <a class="self-link" href="#example-740b4428"></a> Here’s an <a href="examples/fragmentation-inline-axis-example.html">example</a> illustrating fragmentation of a grid with masonry layout in its inline-axis. In this case the breaks occurs between the <a data-link-type="dfn">grid-axis</a> rows.  It renders like this: 
    <figure style="max-width:100%">
     <video controls src="images/fragmentation-inline-axis-example.webm" style="max-width:100%"></video>
     <figcaption> Visualization of fragmentation in the block-axis with inline-axis masonry layout. </figcaption>
    </figure>
   </div>
   <h2 class="heading settled" data-level="8" id="subgrids"><span class="secno">8. </span><span class="content"> Subgrids</span><a class="self-link" href="#subgrids"></a></h2>
   <p>Masonry layout is supported in <a data-link-type="dfn" href="https://drafts.csswg.org/css-grid-2/#subgrid" id="ref-for-subgrid">subgrids</a> (e.g. <a class="css" data-link-type="propdesc" href="https://drafts.csswg.org/css-grid-2/#propdef-grid" id="ref-for-propdef-grid">grid: subgrid / masonry</a>), and grids that use masonry can have subgrids as children.  However, only a parent grid axis can be subgridded in the normal sense.  A subgrid axis with a parent <a data-link-type="dfn" href="#masonry-axis" id="ref-for-masonry-axis③①">masonry axis</a> will behave as <span class="css">masonry</span>, unless the subgrid’s other axis is also <span class="css">masonry</span> in which case it behaves as <span class="css">none</span> (because a <a data-link-type="dfn" href="https://drafts.csswg.org/css-grid-2/#grid-container" id="ref-for-grid-container②①">grid container</a> can only have one <span id="ref-for-masonry-axis③②">masonry axis</span>). <span class="css">auto</span>-placed subgrids don’t inherit any line names from their parent grid, because that would make the placement of the subgrid’s grid items dependent on layout results; but the subgrid’s tracks are still aligned to the parent’s tracks as usual.  Here’s a subgrid <a href="examples/subgrid-example-1.html">example</a>:</p>
   <div class="example" id="example-5da4ab29">
    <a class="self-link" href="#example-5da4ab29"></a> 
<pre class="language-css highlight">&lt;style>
.grid <c- p>{</c->
  <c- k>display</c-><c- p>:</c-> inline-grid<c- p>;</c->
  <c- k>grid</c-><c- p>:</c-> auto auto <c- m>100</c-><c- k>px</c-> / masonry<c- p>;</c->
  <c- k>align-content</c-><c- p>:</c-> center<c- p>;</c->
  <c- k>height</c-><c- p>:</c-> <c- m>300</c-><c- k>px</c-><c- p>;</c->
  <c- k>border</c-><c- p>:</c-> <c- m>1</c-><c- k>px</c-> solid<c- p>;</c->
<c- p>}</c->

.grid > * <c- p>{</c->
  <c- k>margin</c-><c- p>:</c-> <c- m>5</c-><c- k>px</c-><c- p>;</c->
  <c- k>background</c-><c- p>:</c-> silver<c- p>;</c->
<c- p>}</c->
.grid > <c- nf>:nth-child</c-><c- p>(</c-><c- m>2</c-><c- k>n</c-><c- p>)</c-> <c- p>{</c->
  <c- k>background</c-><c- p>:</c-> pink<c- p>;</c->
<c- p>}</c->

.grid subgrid <c- p>{</c->
  <c- k>display</c-><c- p>:</c-> grid<c- p>;</c->
  <c- k>grid</c-><c- p>:</c-> subgrid / subgrid<c- p>;</c->
  <c- k>grid-row</c-><c- p>:</c-> <c- m>2</c-> / span <c- m>2</c-><c- p>;</c->
  <c- k>grid-gap</c-><c- p>:</c-> <c- m>30</c-><c- k>px</c-><c- p>;</c->
<c- p>}</c->
.grid subgrid > * <c- p>{</c-> <c- k>background</c-><c- p>:</c-> cyan<c- p>;</c-> <c- p>}</c->
&lt;/style>
</pre>
<pre class="language-html highlight"><c- p>&lt;</c-><c- f>div</c-> <c- e>class</c-><c- o>=</c-><c- s>"grid"</c-><c- p>></c->
  <c- p>&lt;</c-><c- f>item</c-><c- p>></c->1<c- p>&lt;/</c-><c- f>item</c-><c- p>></c->
  <c- p>&lt;</c-><c- f>item</c-><c- p>></c->2<c- p>&lt;/</c-><c- f>item</c-><c- p>></c->
  <c- p>&lt;</c-><c- f>item</c-><c- p>></c->3<c- p>&lt;/</c-><c- f>item</c-><c- p>></c->
  <c- p>&lt;</c-><c- f>subgrid</c-><c- p>></c->
    <c- p>&lt;</c-><c- f>item</c-> <c- e>style</c-><c- o>=</c-><c- s>"height:100px"</c-><c- p>></c->subgrid.1<c- p>&lt;/</c-><c- f>item</c-><c- p>></c->
    <c- p>&lt;</c-><c- f>item</c-><c- p>></c->sub.2<c- p>&lt;/</c-><c- f>item</c-><c- p>></c->
    <c- p>&lt;</c-><c- f>item</c-><c- p>></c->s.3<c- p>&lt;/</c-><c- f>item</c-><c- p>></c->
  <c- p>&lt;/</c-><c- f>subgrid</c-><c- p>></c->
  <c- p>&lt;</c-><c- f>item</c-><c- p>></c->4<c- p>&lt;/</c-><c- f>item</c-><c- p>></c->
  <c- p>&lt;</c-><c- f>item</c-><c- p>></c->5<c- p>&lt;/</c-><c- f>item</c-><c- p>></c->
  <c- p>&lt;</c-><c- f>item</c-> <c- e>style</c-><c- o>=</c-><c- s>"width: 80px"</c-><c- p>></c->6<c- p>&lt;/</c-><c- f>item</c-><c- p>></c->
  <c- p>&lt;</c-><c- f>item</c-><c- p>></c->7<c- p>&lt;/</c-><c- f>item</c-><c- p>></c->
<c- p>&lt;/</c-><c- f>div</c-><c- p>></c->
</pre>
    <figure>
      <img src="images/subgrid-example-1.png"> 
     <figcaption> The rendering of the subgrid example above. </figcaption>
    </figure>
    <p>Note how the subgrid’s first item ("subgrid.1") contributes to the intrinsic size of the 2nd row in the parent grid.  This is possible since the subgrid specified a definite placement so we know which tracks it will occupy.  Note also that trying to subgrid the parent’s <a data-link-type="dfn" href="#masonry-axis" id="ref-for-masonry-axis③③">masonry axis</a> results in the subgrid getting masonry layout in its inline-axis.</p>
   </div>
   <h2 class="heading settled" data-level="9" id="abspos"><span class="secno">9. </span><span class="content"> Absolute Positioning</span><a class="self-link" href="#abspos"></a></h2>
   <p><a href="https://drafts.csswg.org/css-grid/#abspos-items">Grid-aligned absolute-positioned descendants</a> are supported.  In the <a data-link-type="dfn" href="#masonry-axis" id="ref-for-masonry-axis③④">masonry axis</a>, all <a data-link-type="dfn" href="https://drafts.csswg.org/css-grid-2/#grid-position" id="ref-for-grid-position">grid positions</a> except line 1 are treated as <a class="property css" data-link-type="property">auto</a>. Line 1 in the <span id="ref-for-masonry-axis③⑤">masonry axis</span> corresponds to the start of the <a data-link-type="dfn" href="#masonry-box" id="ref-for-masonry-box③">masonry box</a> (which is usually also the content-box start edge) and <span class="property">auto</span> uses the <a data-link-type="dfn" href="https://drafts.csswg.org/css-grid-2/#grid-container" id="ref-for-grid-container②②">grid container</a> padding edge as usual. The <a data-link-type="dfn" href="https://drafts.csswg.org/css-display-4/#containing-block" id="ref-for-containing-block①">containing block</a> is the extent of the tracks the item spans in the <a data-link-type="dfn" href="#grid-axis" id="ref-for-grid-axis③⑤">grid axis</a> and the position of line 1 and the padding-box edge in the <span id="ref-for-masonry-axis③⑥">masonry axis</span>.</p>
   <p class="issue" id="issue-7bbe63a7"><a class="self-link" href="#issue-7bbe63a7"></a> It might be useful to define a static position in the <a data-link-type="dfn" href="#masonry-axis" id="ref-for-masonry-axis③⑦">masonry axis</a>. Maybe it could defined as the max (or min?) current <a data-link-type="dfn" href="#running-position" id="ref-for-running-position⑥">running position</a> of the <a data-link-type="dfn">grid-axis</a> tracks at that point?  Or the end of the item before it?</p>
   <p class="issue" id="issue-b2e5048b"><a class="self-link" href="#issue-b2e5048b"></a> It would also be useful to be able to align the <a data-link-type="dfn" href="#masonry-box" id="ref-for-masonry-box④">masonry box</a> end edge somehow, but for that we need a way to address the <a href="https://github.com/w3c/csswg-drafts/issues/2402">end line in an implicit grid</a>, or could we just use any non-auto line number other than 1 to indicate the end line given that we don’t really have any lines in this axis other than line 1?</p>
   <h2 class="heading settled" data-level="10" id="performance-notes"><span class="secno">10. </span><span class="content"> Performance Notes</span><a class="self-link" href="#performance-notes"></a></h2>
   <p>In general, masonry layout should have significantly better performance than the equivalent regular (2-axis) grid layout, particularly when the <a data-link-type="dfn" href="#masonry-axis" id="ref-for-masonry-axis③⑧">masonry axis</a> is the block-axis since the intrinsic sizing of grid rows is typically quite expensive. Any intrinsic track sizing in the <a data-link-type="dfn" href="#grid-axis" id="ref-for-grid-axis③⑥">grid axis</a> should be cheaper too, because, typically, only a subset of items contribute to the intrinsic sizing in a masonry layout, contrary to a 2-axis grid where all items spanning an intrinsically-sized track contribute. That said, <span class="css">align-tracks: stretch</span> specifically adds a cost proportionate to the number of items that are resized. (Note that <span class="css">stretch</span> isn’t the default value for these properties though.) Stretched items do a second layout with the new size (when it actually changed) so this can be costly if there are a huge amount of stretched items that each contains a lot of content. Especially nested stretched masonry layouts should be avoided unless they are small/trivial.</p>
   <p><strong class="advisement"> This can be ameliorated by the author by opting out from the stretching on most items though, e.g. specifying <span class="css">align-items:start</span> and then opting in for just a few items with <span class="css">align-self:stretch</span> to let those items fill the <a data-link-type="dfn" href="#masonry-axis" id="ref-for-masonry-axis③⑨">masonry axis</a>. Other <a class="property css" data-link-type="property" href="#propdef-justify-tracks" id="ref-for-propdef-justify-tracks②">justify-tracks</a> / <a class="property css" data-link-type="property" href="#propdef-align-tracks" id="ref-for-propdef-align-tracks④">align-tracks</a> values such as <a class="css" data-link-type="maybe" href="https://drafts.csswg.org/css-align-3/#valdef-self-position-center" id="ref-for-valdef-self-position-center①">center</a>, <a class="css" data-link-type="maybe" href="https://drafts.csswg.org/css-align-3/#valdef-self-position-end" id="ref-for-valdef-self-position-end①">end</a> and '<a class="production css" data-link-type="type" href="https://drafts.csswg.org/css-align-3/#typedef-content-distribution" id="ref-for-typedef-content-distribution②">&lt;content-distribution></a>' (other than <a class="css" data-link-type="maybe" href="https://drafts.csswg.org/css-align-3/#valdef-align-self-stretch" id="ref-for-valdef-align-self-stretch①">stretch</a>) shouldn’t be a problem though since they just reposition the items which is fast. (This performance analysis is from a Gecko perspective, but I suspect there’s some truth to it for other layout engines as well.)</strong></p>
   <h2 class="heading settled" data-level="11" id="graceful-degradation"><span class="secno">11. </span><span class="content"> Graceful Degradation</span><a class="self-link" href="#graceful-degradation"></a></h2>
   <p>Typically, a masonry design can be expected to degrade quite nicely in a UA that supports Grid layout but not masonry layout if the <a class="property css" data-link-type="property" href="https://drafts.csswg.org/css-grid-2/#propdef-grid" id="ref-for-propdef-grid①">grid</a>/<a class="property css" data-link-type="property" href="https://drafts.csswg.org/css-grid-2/#propdef-grid-template" id="ref-for-propdef-grid-template">grid-template</a> shorthands are avoided and the longhands are used instead. e.g.</p>
<pre class="language-css highlight"><c- k>grid-template-rows</c-><c- p>:</c-> masonry<c- p>;</c-> <c- c>/* ignored by UAs that don't support it */</c->
grid-template-columns: <c- m>150</c-><c- k>px</c-> <c- m>100</c-><c- k>px</c-> <c- m>50</c-><c- k>px</c-><c- p>;</c->
</pre>
   <div class="example" id="example-c14bcfdc">
    <a class="self-link" href="#example-c14bcfdc"></a> Here’s an <a href="examples/graceful-degradation-example.html">example</a> to illustrate this. It’s a layout with three columns, but will have "more gaps" in the block-axis if the UA doesn’t support masonry layout.  Here’s what it looks like with Masonry support for comparison: 
    <figure>
     <video controls src="images/graceful-degradation-example.webm"></video>
     <figcaption> Rendering of the example in a UA with Masonry support. </figcaption>
    </figure>
   </div>
   <h2 class="heading settled" data-level="12" id="acknowledgements"><span class="secno">12. </span><span class="content"> Acknowledgements</span><a class="self-link" href="#acknowledgements"></a></h2>
   <p>Thanks goes to Cameron McCormack who wrote a masonry layout explainer document (from which I lifted the Background chapter) and presented it to the CSSWG.  Thanks also to everyone who provided feedback on the <a href="https://github.com/w3c/csswg-drafts/issues/4650">initial proposal</a> for this feature.</p>
  </main>
  <h2 class="no-ref no-num heading settled" id="w3c-conformance"><span class="content"> Conformance</span><a class="self-link" href="#w3c-conformance"></a></h2>
  <h3 class="no-ref heading settled" id="w3c-conventions"><span class="content"> Document conventions</span><a class="self-link" href="#w3c-conventions"></a></h3>
  <p>Conformance requirements are expressed with a combination of
    descriptive assertions and RFC 2119 terminology. The key words “MUST”,
    “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”,
    “RECOMMENDED”, “MAY”, and “OPTIONAL” in the normative parts of this
    document are to be interpreted as described in RFC 2119.
    However, for readability, these words do not appear in all uppercase
    letters in this specification. </p>
  <p>All of the text of this specification is normative except sections
    explicitly marked as non-normative, examples, and notes. <a data-link-type="biblio" href="#biblio-rfc2119" title="Key words for use in RFCs to Indicate Requirement Levels">[RFC2119]</a></p>
  <p>Examples in this specification are introduced with the words “for example”
    or are set apart from the normative text with <code>class="example"</code>,
    like this: </p>
  <div class="example" id="w3c-example">
   <a class="self-link" href="#w3c-example"></a> 
   <p>This is an example of an informative example.</p>
  </div>
  <p>Informative notes begin with the word “Note” and are set apart from the
    normative text with <code>class="note"</code>, like this: </p>
  <p class="note" role="note">Note, this is an informative note.</p>
  <p>Advisements are normative sections styled to evoke special attention and are
    set apart from other normative text with <code>&lt;strong class="advisement"></code>, like
    this: <strong class="advisement"> UAs MUST provide an accessible alternative. </strong></p>
  <details class="wpt-tests-block" dir="ltr" lang="en" open>
   <summary>Tests</summary>
   <p>Tests relating to the content of this specification
                     may be documented in “Tests” blocks like this one.
                     Any such block is non-normative.</p>
   <ul class="wpt-tests-list"></ul>
   <hr>
  </details>
  <h3 class="no-ref heading settled" id="w3c-conformance-classes"><span class="content"> Conformance classes</span><a class="self-link" href="#w3c-conformance-classes"></a></h3>
  <p>Conformance to this specification
    is defined for three conformance classes: </p>
  <dl>
   <dt>style sheet 
   <dd>A <a href="http://www.w3.org/TR/CSS21/conform.html#style-sheet">CSS
            style sheet</a>. 
   <dt>renderer 
   <dd>A <a href="http://www.w3.org/TR/CSS21/conform.html#user-agent">UA</a> that interprets the semantics of a style sheet and renders
            documents that use them. 
   <dt>authoring tool 
   <dd>A <a href="http://www.w3.org/TR/CSS21/conform.html#user-agent">UA</a> that writes a style sheet. 
  </dl>
  <p>A style sheet is conformant to this specification
    if all of its statements that use syntax defined in this module are valid
    according to the generic CSS grammar and the individual grammars of each
    feature defined in this module. </p>
  <p>A renderer is conformant to this specification
    if, in addition to interpreting the style sheet as defined by the
    appropriate specifications, it supports all the features defined
    by this specification by parsing them correctly
    and rendering the document accordingly. However, the inability of a
    UA to correctly render a document due to limitations of the device
    does not make the UA non-conformant. (For example, a UA is not
    required to render color on a monochrome monitor.) </p>
  <p>An authoring tool is conformant to this specification
    if it writes style sheets that are syntactically correct according to the
    generic CSS grammar and the individual grammars of each feature in
    this module, and meet all other conformance requirements of style sheets
    as described in this module. </p>
  <h3 class="no-ref heading settled" id="w3c-partial"><span class="content"> Partial implementations</span><a class="self-link" href="#w3c-partial"></a></h3>
  <p>So that authors can exploit the forward-compatible parsing rules to
    assign fallback values, CSS renderers <strong>must</strong> treat as invalid (and <a href="http://www.w3.org/TR/CSS21/conform.html#ignore">ignore
    as appropriate</a>) any at-rules, properties, property values, keywords,
    and other syntactic constructs for which they have no usable level of
    support. In particular, user agents <strong>must not</strong> selectively
    ignore unsupported component values and honor supported values in a single
    multi-value property declaration: if any value is considered invalid
    (as unsupported values must be), CSS requires that the entire declaration
    be ignored.</p>
  <h4 class="heading settled" id="w3c-conform-future-proofing"><span class="content"> Implementations of Unstable and Proprietary Features</span><a class="self-link" href="#w3c-conform-future-proofing"></a></h4>
  <p>To avoid clashes with future stable CSS features,
        the CSSWG recommends <a href="http://www.w3.org/TR/CSS/#future-proofing">following best practices</a> for the implementation of <a href="http://www.w3.org/TR/CSS/#unstable">unstable</a> features and <a href="http://www.w3.org/TR/CSS/#proprietary-extension">proprietary extensions</a> to CSS. </p>
  <h3 class="no-ref heading settled" id="w3c-testing"><span class="content"> Non-experimental implementations</span><a class="self-link" href="#w3c-testing"></a></h3>
  <p>Once a specification reaches the Candidate Recommendation stage,
    non-experimental implementations are possible, and implementors should
    release an unprefixed implementation of any CR-level feature they
    can demonstrate to be correctly implemented according to spec. </p>
  <p>To establish and maintain the interoperability of CSS across
    implementations, the CSS Working Group requests that non-experimental
    CSS renderers submit an implementation report (and, if necessary, the
    testcases used for that implementation report) to the W3C before
    releasing an unprefixed implementation of any CSS features. Testcases
    submitted to W3C are subject to review and correction by the CSS
    Working Group. </p>
  <p>Further information on submitting testcases and implementation reports
    can be found from on the CSS Working Group’s website at <a href="http://www.w3.org/Style/CSS/Test/">http://www.w3.org/Style/CSS/Test/</a>.
    Questions should be directed to the <a href="http://lists.w3.org/Archives/Public/public-css-testsuite">public-css-testsuite@w3.org</a> mailing list.</p>
  <script src="https://www.w3.org/scripts/TR/2021/fixup.js"></script>
  <h2 class="no-num no-ref heading settled" id="index"><span class="content">Index</span><a class="self-link" href="#index"></a></h2>
  <h3 class="no-num no-ref heading settled" id="index-defined-here"><span class="content">Terms defined by this specification</span><a class="self-link" href="#index-defined-here"></a></h3>
  <ul class="index">
   <li><a href="#propdef-align-tracks">align-tracks</a><span>, in § 6.1</span>
   <li><a href="#grid-axis">grid axis</a><span>, in § 2</span>
   <li><a href="#propdef-justify-tracks">justify-tracks</a><span>, in § 6.1</span>
   <li><a href="#propdef-masonry-auto-flow">masonry-auto-flow</a><span>, in § 2.5</span>
   <li><a href="#masonry-axis">masonry axis</a><span>, in § 2</span>
   <li><a href="#masonry-box">masonry box</a><span>, in § 6</span>
   <li><a href="#running-position">running position</a><span>, in § 2.4</span>
  </ul>
  <h3 class="no-num no-ref heading settled" id="index-defined-elsewhere"><span class="content">Terms defined by reference</span><a class="self-link" href="#index-defined-elsewhere"></a></h3>
  <ul class="index">
   <li>
    <a data-link-type="biblio">[CSS-ALIGN-3]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="e3346911">&lt;baseline-position></span>
     <li><span class="dfn-paneled" id="69b01b6e">&lt;content-distribution></span>
     <li><span class="dfn-paneled" id="aadd356f">&lt;content-position></span>
     <li><span class="dfn-paneled" id="5d275b21">&lt;overflow-position></span>
     <li><span class="dfn-paneled" id="ce1c3a64">align-content</span>
     <li><span class="dfn-paneled" id="48350e83">align-self</span>
     <li><span class="dfn-paneled" id="d15331bf">alignment subject</span>
     <li><span class="dfn-paneled" id="8e662436">baseline alignment</span>
     <li><span class="dfn-paneled" id="80175c82">baseline-sharing group</span>
     <li><span class="dfn-paneled" id="4bc11993">center</span>
     <li><span class="dfn-paneled" id="2acd09de">end</span>
     <li><span class="dfn-paneled" id="e0975054">first baseline set</span>
     <li><span class="dfn-paneled" id="75f6cfb6">justify-content</span>
     <li><span class="dfn-paneled" id="c8322a15">last baseline set</span>
     <li><span class="dfn-paneled" id="9f890aae">normal <small>(for align-self)</small></span>
     <li><span class="dfn-paneled" id="eb309e21">normal <small>(for justify-content)</small></span>
     <li><span class="dfn-paneled" id="b8850feb">start</span>
     <li><span class="dfn-paneled" id="9fe435f5">stretch <small>(for align-content)</small></span>
     <li><span class="dfn-paneled" id="b1a75fe8">stretch <small>(for align-self)</small></span>
    </ul>
   <li>
    <a data-link-type="biblio">[CSS-BOX-4]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="00140718">margin-top</span>
    </ul>
   <li>
    <a data-link-type="biblio">[CSS-BREAK-4]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="b8c7a216">forced break</span>
     <li><span class="dfn-paneled" id="5d82066a">fragmentainer</span>
    </ul>
   <li>
    <a data-link-type="biblio">[CSS-DISPLAY-4]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="1a548a6a">blockify</span>
     <li><span class="dfn-paneled" id="ea663a43">containing block</span>
    </ul>
   <li>
    <a data-link-type="biblio">[CSS-GRID-2]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="736dfced">dense</span>
     <li><span class="dfn-paneled" id="f3917b3e">grid</span>
     <li><span class="dfn-paneled" id="e3ccce60">grid area</span>
     <li><span class="dfn-paneled" id="f005b2f6">grid container</span>
     <li><span class="dfn-paneled" id="1044d688">grid item</span>
     <li><span class="dfn-paneled" id="b98c5f6c">grid position</span>
     <li><span class="dfn-paneled" id="58d94cb8">grid-column</span>
     <li><span class="dfn-paneled" id="a1432810">grid-row</span>
     <li><span class="dfn-paneled" id="df6c9896">grid-template</span>
     <li><span class="dfn-paneled" id="e0f38f8e">grid-template-columns</span>
     <li><span class="dfn-paneled" id="b47c7071">grid-template-rows</span>
     <li><span class="dfn-paneled" id="fdb725d6">implicit grid</span>
     <li><span class="dfn-paneled" id="842c0376">none</span>
     <li><span class="dfn-paneled" id="c6c2ab78">subgrid</span>
    </ul>
   <li>
    <a data-link-type="biblio">[CSS-LOGICAL-1]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="78a34e77">margin-block</span>
    </ul>
   <li>
    <a data-link-type="biblio">[CSS-SIZING-3]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="0e5cedd7">auto</span>
     <li><span class="dfn-paneled" id="61fd6018">definite size</span>
     <li><span class="dfn-paneled" id="57e29492">indefinite size</span>
     <li><span class="dfn-paneled" id="bb16e9a6">max size</span>
     <li><span class="dfn-paneled" id="0bd2791e">max-content constraint</span>
     <li><span class="dfn-paneled" id="26a40c98">max-content size</span>
     <li><span class="dfn-paneled" id="9e39189b">max-height</span>
     <li><span class="dfn-paneled" id="6dc3914f">min-content constraint</span>
     <li><span class="dfn-paneled" id="3f0db204">min-content size</span>
    </ul>
   <li>
    <a data-link-type="biblio">[CSS-VALUES-4]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="68487d22">#</span>
     <li><span class="dfn-paneled" id="537cf076">?</span>
     <li><span class="dfn-paneled" id="358fd6ff">css-wide keywords</span>
     <li><span class="dfn-paneled" id="6ec67710">|</span>
     <li><span class="dfn-paneled" id="8a82fda1">||</span>
    </ul>
   <li>
    <a data-link-type="biblio">[CSS-WRITING-MODES-3]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="5bc8bd12">direction</span>
    </ul>
  </ul>
  <h2 class="no-num no-ref heading settled" id="references"><span class="content">References</span><a class="self-link" href="#references"></a></h2>
  <h3 class="no-num no-ref heading settled" id="normative"><span class="content">Normative References</span><a class="self-link" href="#normative"></a></h3>
  <dl>
   <dt id="biblio-css-align-3">[CSS-ALIGN-3]
   <dd>Elika Etemad; Tab Atkins Jr.. <a href="https://drafts.csswg.org/css-align/"><cite>CSS Box Alignment Module Level 3</cite></a>. URL: <a href="https://drafts.csswg.org/css-align/">https://drafts.csswg.org/css-align/</a>
   <dt id="biblio-css-break-4">[CSS-BREAK-4]
   <dd>Rossen Atanassov; Elika Etemad. <a href="https://drafts.csswg.org/css-break-4/"><cite>CSS Fragmentation Module Level 4</cite></a>. URL: <a href="https://drafts.csswg.org/css-break-4/">https://drafts.csswg.org/css-break-4/</a>
   <dt id="biblio-css-display-4">[CSS-DISPLAY-4]
   <dd><a href="https://drafts.csswg.org/css-display-4/"><cite>CSS Display Module Level 4</cite></a>. Editor's Draft. URL: <a href="https://drafts.csswg.org/css-display-4/">https://drafts.csswg.org/css-display-4/</a>
   <dt id="biblio-css-grid-2">[CSS-GRID-2]
   <dd>Tab Atkins Jr.; Elika Etemad; Rossen Atanassov. <a href="https://drafts.csswg.org/css-grid-2/"><cite>CSS Grid Layout Module Level 2</cite></a>. URL: <a href="https://drafts.csswg.org/css-grid-2/">https://drafts.csswg.org/css-grid-2/</a>
   <dt id="biblio-css-sizing-3">[CSS-SIZING-3]
   <dd>Tab Atkins Jr.; Elika Etemad. <a href="https://drafts.csswg.org/css-sizing-3/"><cite>CSS Box Sizing Module Level 3</cite></a>. URL: <a href="https://drafts.csswg.org/css-sizing-3/">https://drafts.csswg.org/css-sizing-3/</a>
   <dt id="biblio-css-values-3">[CSS-VALUES-3]
   <dd>Tab Atkins Jr.; Elika Etemad. <a href="https://drafts.csswg.org/css-values-3/"><cite>CSS Values and Units Module Level 3</cite></a>. URL: <a href="https://drafts.csswg.org/css-values-3/">https://drafts.csswg.org/css-values-3/</a>
   <dt id="biblio-css-values-4">[CSS-VALUES-4]
   <dd>Tab Atkins Jr.; Elika Etemad. <a href="https://drafts.csswg.org/css-values-4/"><cite>CSS Values and Units Module Level 4</cite></a>. URL: <a href="https://drafts.csswg.org/css-values-4/">https://drafts.csswg.org/css-values-4/</a>
   <dt id="biblio-css2">[CSS2]
   <dd>Bert Bos; et al. <a href="https://drafts.csswg.org/css2/"><cite>Cascading Style Sheets Level 2 Revision 1 (CSS 2.1) Specification</cite></a>. URL: <a href="https://drafts.csswg.org/css2/">https://drafts.csswg.org/css2/</a>
   <dt id="biblio-rfc2119">[RFC2119]
   <dd>S. Bradner. <a href="https://datatracker.ietf.org/doc/html/rfc2119"><cite>Key words for use in RFCs to Indicate Requirement Levels</cite></a>. March 1997. Best Current Practice. URL: <a href="https://datatracker.ietf.org/doc/html/rfc2119">https://datatracker.ietf.org/doc/html/rfc2119</a>
  </dl>
  <h3 class="no-num no-ref heading settled" id="informative"><span class="content">Informative References</span><a class="self-link" href="#informative"></a></h3>
  <dl>
   <dt id="biblio-css-box-4">[CSS-BOX-4]
   <dd>Elika Etemad. <a href="https://drafts.csswg.org/css-box-4/"><cite>CSS Box Model Module Level 4</cite></a>. URL: <a href="https://drafts.csswg.org/css-box-4/">https://drafts.csswg.org/css-box-4/</a>
   <dt id="biblio-css-logical-1">[CSS-LOGICAL-1]
   <dd>Rossen Atanassov; Elika Etemad. <a href="https://drafts.csswg.org/css-logical-1/"><cite>CSS Logical Properties and Values Level 1</cite></a>. URL: <a href="https://drafts.csswg.org/css-logical-1/">https://drafts.csswg.org/css-logical-1/</a>
   <dt id="biblio-css-writing-modes-3">[CSS-WRITING-MODES-3]
   <dd>Elika Etemad; Koji Ishii. <a href="https://drafts.csswg.org/css-writing-modes-3/"><cite>CSS Writing Modes Level 3</cite></a>. URL: <a href="https://drafts.csswg.org/css-writing-modes-3/">https://drafts.csswg.org/css-writing-modes-3/</a>
  </dl>
  <h2 class="no-num no-ref heading settled" id="property-index"><span class="content">Property Index</span><a class="self-link" href="#property-index"></a></h2>
  <div class="big-element-wrapper">
   <table class="index">
    <thead>
     <tr>
      <th scope="col">Name
      <th scope="col">Value
      <th scope="col">Initial
      <th scope="col">Applies to
      <th scope="col">Inh.
      <th scope="col">%ages
      <th scope="col">Anim­ation type
      <th scope="col">Canonical order
      <th scope="col">Com­puted value
    <tbody>
     <tr>
      <th scope="row"><a class="css" data-link-type="property" href="#propdef-align-tracks" id="ref-for-propdef-align-tracks⑤">align-tracks</a>
      <td>[normal | &lt;baseline-position> | &lt;content-distribution> | &lt;overflow-position>? &lt;content-position>]#
      <td>normal
      <td>grid containers with masonry layout in their block axis
      <td>no
      <td>n/a
      <td>discrete
      <td>per grammar
      <td>specified keyword(s)
     <tr>
      <th scope="row"><a class="css" data-link-type="property" href="#propdef-justify-tracks" id="ref-for-propdef-justify-tracks③">justify-tracks</a>
      <td>[normal | &lt;content-distribution> | &lt;overflow-position>? [ &lt;content-position> | left | right ] ]#
      <td>normal
      <td>grid containers with masonry layout in their inline axis
      <td>no
      <td>n/a
      <td>discrete
      <td>per grammar
      <td>specified keyword(s)
     <tr>
      <th scope="row"><a class="css" data-link-type="property" href="#propdef-masonry-auto-flow" id="ref-for-propdef-masonry-auto-flow③">masonry-auto-flow</a>
      <td>[ pack | next ] || [definite-first | ordered ]
      <td>pack
      <td>grid containers with masonry layout
      <td>no
      <td>n/a
      <td>discrete
      <td>per grammar
      <td>specified keyword(s)
   </table>
  </div>
  <h2 class="no-num no-ref heading settled" id="issues-index"><span class="content">Issues Index</span><a class="self-link" href="#issues-index"></a></h2>
  <div style="counter-reset:issue">
   <div class="issue"> specify how the grid container’s first(last) baseline in the <a data-link-type="dfn" href="#masonry-axis">masonry axis</a> is determined <a class="issue-return" href="#issue-0877829d" title="Jump to section">↵</a></div>
   <div class="issue"> this needs more details about edge cases, caveat about misalignment in stretch, etc <a class="issue-return" href="#issue-7304afcc" title="Jump to section">↵</a></div>
   <div class="issue"> maybe we can make stretch alignment (at least) smarter so that we avoid overlapping spanning items in a few more cases that would be useful to authors? <a class="issue-return" href="#issue-2abb2fa3" title="Jump to section">↵</a></div>
   <div class="issue"> It might be useful to define a static position in the <a data-link-type="dfn" href="#masonry-axis">masonry axis</a>. Maybe it could defined as the max (or min?) current <a data-link-type="dfn" href="#running-position">running position</a> of the <a data-link-type="dfn">grid-axis</a> tracks at that point?  Or the end of the item before it? <a class="issue-return" href="#issue-7bbe63a7" title="Jump to section">↵</a></div>
   <div class="issue"> It would also be useful to be able to align the <a data-link-type="dfn" href="#masonry-box">masonry box</a> end edge somehow, but for that we need a way to address the <a href="https://github.com/w3c/csswg-drafts/issues/2402">end line in an implicit grid</a>, or could we just use any non-auto line number other than 1 to indicate the end line given that we don’t really have any lines in this axis other than line 1? <a class="issue-return" href="#issue-b2e5048b" title="Jump to section">↵</a></div>
  </div>
  <details class="mdn-anno unpositioned" data-anno-for="tracks-alignment">
   <summary><b class="less-than-two-engines-flag" title="This feature is in less than two current engines.">⚠</b><span>MDN</span></summary>
   <div class="feature">
    <p><a href="https://developer.mozilla.org/en-US/docs/Web/CSS/align-tracks" title="The align-tracks CSS property sets the alignment in the masonry axis for grid containers that have masonry in their block axis.">align-tracks</a></p>
    <p class="less-than-two-engines-text">In only one current engine.</p>
    <div class="support">
     <span class="firefox yes"><span>Firefox</span><span title="Requires setting a user preference or runtime flag.">🔰 77+</span></span><span class="safari no"><span>Safari</span><span>None</span></span><span class="chrome no"><span>Chrome</span><span>None</span></span>
     <hr>
     <span class="opera no"><span>Opera</span><span>?</span></span><span class="edge_blink no"><span>Edge</span><span>None</span></span>
     <hr>
     <span class="edge no"><span>Edge (Legacy)</span><span>?</span></span><span class="ie no"><span>IE</span><span>None</span></span>
     <hr>
     <span class="firefox_android no"><span>Firefox for Android</span><span>?</span></span><span class="safari_ios no"><span>iOS Safari</span><span>?</span></span><span class="chrome_android no"><span>Chrome for Android</span><span>?</span></span><span class="webview_android no"><span>Android WebView</span><span>?</span></span><span class="samsunginternet_android no"><span>Samsung Internet</span><span>?</span></span><span class="opera_android no"><span>Opera Mobile</span><span>?</span></span>
    </div>
   </div>
   <div class="feature">
    <p><a href="https://developer.mozilla.org/en-US/docs/Web/CSS/justify-tracks" title="The justify-tracks CSS property sets the alignment in the masonry axis for grid containers that have masonry in their inline axis.">justify-tracks</a></p>
    <p class="less-than-two-engines-text">In only one current engine.</p>
    <div class="support">
     <span class="firefox yes"><span>Firefox</span><span title="Requires setting a user preference or runtime flag.">🔰 77+</span></span><span class="safari no"><span>Safari</span><span>None</span></span><span class="chrome no"><span>Chrome</span><span>None</span></span>
     <hr>
     <span class="opera no"><span>Opera</span><span>?</span></span><span class="edge_blink no"><span>Edge</span><span>None</span></span>
     <hr>
     <span class="edge no"><span>Edge (Legacy)</span><span>?</span></span><span class="ie no"><span>IE</span><span>None</span></span>
     <hr>
     <span class="firefox_android no"><span>Firefox for Android</span><span>?</span></span><span class="safari_ios no"><span>iOS Safari</span><span>?</span></span><span class="chrome_android no"><span>Chrome for Android</span><span>?</span></span><span class="webview_android no"><span>Android WebView</span><span>?</span></span><span class="samsunginternet_android no"><span>Samsung Internet</span><span>?</span></span><span class="opera_android no"><span>Opera Mobile</span><span>?</span></span>
    </div>
   </div>
  </details>
  <details class="mdn-anno unpositioned" data-anno-for="masonry-layout">
   <summary><span>MDN</span></summary>
   <div class="feature">
    <p><a href="https://developer.mozilla.org/en-US/docs/Web/CSS/grid-template-columns" title="The grid-template-columns CSS property defines the line names and track sizing functions of the grid columns.">grid-template-columns</a></p>
    <p class="all-engines-text">In all current engines.</p>
    <div class="support">
     <span class="firefox yes"><span>Firefox</span><span>52+</span></span><span class="safari yes"><span>Safari</span><span>10.1+</span></span><span class="chrome yes"><span>Chrome</span><span>57+</span></span>
     <hr>
     <span class="opera no"><span>Opera</span><span>?</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span>
     <hr>
     <span class="edge yes"><span>Edge (Legacy)</span><span>16+</span></span><span class="ie no"><span>IE</span><span>None</span></span>
     <hr>
     <span class="firefox_android no"><span>Firefox for Android</span><span>?</span></span><span class="safari_ios no"><span>iOS Safari</span><span>?</span></span><span class="chrome_android no"><span>Chrome for Android</span><span>?</span></span><span class="webview_android no"><span>Android WebView</span><span>?</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>6.0+</span></span><span class="opera_android no"><span>Opera Mobile</span><span>?</span></span>
    </div>
   </div>
   <div class="feature">
    <p><a href="https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_Grid_Layout/Masonry_Layout" title="Level 3 of the CSS grid layout specification includes a masonry value for grid-template-columns and grid-template-rows. This guide details what masonry layout is and how to use it.">CSS_Grid_Layout/Masonry_Layout</a></p>
    <div class="support">
     <span class="firefox yes"><span>Firefox</span><span title="Requires setting a user preference or runtime flag.">🔰 77+</span></span><span class="safari yes"><span>Safari</span><span>preview+</span></span><span class="chrome no"><span>Chrome</span><span>None</span></span>
     <hr>
     <span class="opera no"><span>Opera</span><span>?</span></span><span class="edge_blink no"><span>Edge</span><span>None</span></span>
     <hr>
     <span class="edge no"><span>Edge (Legacy)</span><span>?</span></span><span class="ie no"><span>IE</span><span>None</span></span>
     <hr>
     <span class="firefox_android no"><span>Firefox for Android</span><span>?</span></span><span class="safari_ios no"><span>iOS Safari</span><span>?</span></span><span class="chrome_android no"><span>Chrome for Android</span><span>?</span></span><span class="webview_android no"><span>Android WebView</span><span>?</span></span><span class="samsunginternet_android no"><span>Samsung Internet</span><span>?</span></span><span class="opera_android no"><span>Opera Mobile</span><span>?</span></span>
    </div>
   </div>
   <div class="feature">
    <p><a href="https://developer.mozilla.org/en-US/docs/Web/CSS/grid-template-rows" title="The grid-template-rows CSS property defines the line names and track sizing functions of the grid rows.">grid-template-rows</a></p>
    <p class="all-engines-text">In all current engines.</p>
    <div class="support">
     <span class="firefox yes"><span>Firefox</span><span>52+</span></span><span class="safari yes"><span>Safari</span><span>10.1+</span></span><span class="chrome yes"><span>Chrome</span><span>57+</span></span>
     <hr>
     <span class="opera no"><span>Opera</span><span>?</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span>
     <hr>
     <span class="edge yes"><span>Edge (Legacy)</span><span>16+</span></span><span class="ie no"><span>IE</span><span>None</span></span>
     <hr>
     <span class="firefox_android no"><span>Firefox for Android</span><span>?</span></span><span class="safari_ios no"><span>iOS Safari</span><span>?</span></span><span class="chrome_android no"><span>Chrome for Android</span><span>?</span></span><span class="webview_android no"><span>Android WebView</span><span>?</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>6.0+</span></span><span class="opera_android no"><span>Opera Mobile</span><span>?</span></span>
    </div>
   </div>
  </details>
  <details class="mdn-anno unpositioned" data-anno-for="masonry-auto-flow">
   <summary><b class="less-than-two-engines-flag" title="This feature is in less than two current engines.">⚠</b><span>MDN</span></summary>
   <div class="feature">
    <p><a href="https://developer.mozilla.org/en-US/docs/Web/CSS/masonry-auto-flow" title="The masonry-auto-flow CSS property modifies how items are placed when using masonry in CSS Grid Layout.">masonry-auto-flow</a></p>
    <p class="less-than-two-engines-text">In only one current engine.</p>
    <div class="support">
     <span class="firefox no"><span>Firefox</span><span>None</span></span><span class="safari yes"><span>Safari</span><span>preview+</span></span><span class="chrome no"><span>Chrome</span><span>None</span></span>
     <hr>
     <span class="opera no"><span>Opera</span><span>?</span></span><span class="edge_blink no"><span>Edge</span><span>None</span></span>
     <hr>
     <span class="edge no"><span>Edge (Legacy)</span><span>?</span></span><span class="ie no"><span>IE</span><span>None</span></span>
     <hr>
     <span class="firefox_android no"><span>Firefox for Android</span><span>?</span></span><span class="safari_ios no"><span>iOS Safari</span><span>?</span></span><span class="chrome_android no"><span>Chrome for Android</span><span>?</span></span><span class="webview_android no"><span>Android WebView</span><span>?</span></span><span class="samsunginternet_android no"><span>Samsung Internet</span><span>?</span></span><span class="opera_android no"><span>Opera Mobile</span><span>?</span></span>
    </div>
   </div>
  </details>
<script>/* Boilerplate: script-dom-helper */
"use strict";
function query(sel) { return document.querySelector(sel); }

function queryAll(sel) { return [...document.querySelectorAll(sel)]; }

function iter(obj) {
	if(!obj) return [];
	var it = obj[Symbol.iterator];
	if(it) return it;
	return Object.entries(obj);
}

function mk(tagname, attrs, ...children) {
	const el = document.createElement(tagname);
	for(const [k,v] of iter(attrs)) {
		if(k.slice(0,3) == "_on") {
			const eventName = k.slice(3);
			el.addEventListener(eventName, v);
		} else if(k[0] == "_") {
			// property, not attribute
			el[k.slice(1)] = v;
		} else {
			if(v === false || v == null) {
        continue;
      } else if(v === true) {
        el.setAttribute(k, "");
        continue;
      } else {
  			el.setAttribute(k, v);
      }
		}
	}
	append(el, children);
	return el;
}

/* Create shortcuts for every known HTML element */
[
  "a",
  "abbr",
  "acronym",
  "address",
  "applet",
  "area",
  "article",
  "aside",
  "audio",
  "b",
  "base",
  "basefont",
  "bdo",
  "big",
  "blockquote",
  "body",
  "br",
  "button",
  "canvas",
  "caption",
  "center",
  "cite",
  "code",
  "col",
  "colgroup",
  "datalist",
  "dd",
  "del",
  "details",
  "dfn",
  "dialog",
  "div",
  "dl",
  "dt",
  "em",
  "embed",
  "fieldset",
  "figcaption",
  "figure",
  "font",
  "footer",
  "form",
  "frame",
  "frameset",
  "head",
  "header",
  "h1",
  "h2",
  "h3",
  "h4",
  "h5",
  "h6",
  "hr",
  "html",
  "i",
  "iframe",
  "img",
  "input",
  "ins",
  "kbd",
  "label",
  "legend",
  "li",
  "link",
  "main",
  "map",
  "mark",
  "meta",
  "meter",
  "nav",
  "nobr",
  "noscript",
  "object",
  "ol",
  "optgroup",
  "option",
  "output",
  "p",
  "param",
  "pre",
  "progress",
  "q",
  "s",
  "samp",
  "script",
  "section",
  "select",
  "small",
  "source",
  "span",
  "strike",
  "strong",
  "style",
  "sub",
  "summary",
  "sup",
  "table",
  "tbody",
  "td",
  "template",
  "textarea",
  "tfoot",
  "th",
  "thead",
  "time",
  "title",
  "tr",
  "u",
  "ul",
  "var",
  "video",
  "wbr",
  "xmp",
].forEach(tagname=>{
	mk[tagname] = (...args) => mk(tagname, ...args);
});

function* nodesFromChildList(children) {
	for(const child of children.flat(Infinity)) {
		if(child instanceof Node) {
			yield child;
		} else {
			yield new Text(child);
		}
	}
}
function append(el, ...children) {
	for(const child of nodesFromChildList(children)) {
		if(el instanceof Node) el.appendChild(child);
		else el.push(child);
	}
	return el;
}

function insertAfter(el, ...children) {
	for(const child of nodesFromChildList(children)) {
		el.parentNode.insertBefore(child, el.nextSibling);
	}
	return el;
}

function clearContents(el) {
	el.innerHTML = "";
	return el;
}

function parseHTML(markup) {
	if(markup.toLowerCase().trim().indexOf('<!doctype') === 0) {
		const doc = document.implementation.createHTMLDocument("");
		doc.documentElement.innerHTML = markup;
		return doc;
	} else {
		const el = mk.template({});
		el.innerHTML = markup;
		return el.content;
	}
}</script>
<script>/* Boilerplate: script-dfn-panel */
"use strict";
{
let dfnPanelData = {
"00140718": {"dfnID":"00140718","dfnText":"margin-top","external":true,"refSections":[{"refs":[{"id":"ref-for-propdef-margin-top"}],"title":"6.2. \nStretch Alignment in the Masonry Axis"}],"url":"https://drafts.csswg.org/css-box-4/#propdef-margin-top"},
"0bd2791e": {"dfnID":"0bd2791e","dfnText":"max-content constraint","external":true,"refSections":[{"refs":[{"id":"ref-for-max-content-constraint"}],"title":"5. \nSizing Grid Containers"}],"url":"https://drafts.csswg.org/css-sizing-3/#max-content-constraint"},
"0e5cedd7": {"dfnID":"0e5cedd7","dfnText":"auto","external":true,"refSections":[{"refs":[{"id":"ref-for-valdef-width-auto"}],"title":"6.2. \nStretch Alignment in the Masonry Axis"}],"url":"https://drafts.csswg.org/css-sizing-3/#valdef-width-auto"},
"1044d688": {"dfnID":"1044d688","dfnText":"grid item","external":true,"refSections":[{"refs":[{"id":"ref-for-grid-item"},{"id":"ref-for-grid-item\u2460"},{"id":"ref-for-grid-item\u2461"}],"title":"2. \nMasonry Layout"},{"refs":[{"id":"ref-for-grid-item\u2462"}],"title":"2.1. \nLine Name Resolution"},{"refs":[{"id":"ref-for-grid-item\u2463"}],"title":"2.2. \nGrid Item Placement"},{"refs":[{"id":"ref-for-grid-item\u2464"}],"title":"3. \nContaining Block"},{"refs":[{"id":"ref-for-grid-item\u2465"}],"title":"7.1. \nFragmentation in the Masonry Axis"}],"url":"https://drafts.csswg.org/css-grid-2/#grid-item"},
"1a548a6a": {"dfnID":"1a548a6a","dfnText":"blockify","external":true,"refSections":[{"refs":[{"id":"ref-for-blockify"}],"title":"2. \nMasonry Layout"}],"url":"https://drafts.csswg.org/css-display-4/#blockify"},
"26a40c98": {"dfnID":"26a40c98","dfnText":"max-content size","external":true,"refSections":[{"refs":[{"id":"ref-for-max-content"}],"title":"5. \nSizing Grid Containers"}],"url":"https://drafts.csswg.org/css-sizing-3/#max-content"},
"2acd09de": {"dfnID":"2acd09de","dfnText":"end","external":true,"refSections":[{"refs":[{"id":"ref-for-valdef-self-position-end"}],"title":"6. \nAlignment and Spacing"},{"refs":[{"id":"ref-for-valdef-self-position-end\u2460"}],"title":"10. \nPerformance Notes"}],"url":"https://drafts.csswg.org/css-align-3/#valdef-self-position-end"},
"358fd6ff": {"dfnID":"358fd6ff","dfnText":"css-wide keywords","external":true,"refSections":[{"refs":[{"id":"ref-for-css-wide-keywords"}],"title":"1.2. \nValue Definitions"}],"url":"https://drafts.csswg.org/css-values-4/#css-wide-keywords"},
"3f0db204": {"dfnID":"3f0db204","dfnText":"min-content size","external":true,"refSections":[{"refs":[{"id":"ref-for-min-content"}],"title":"5. \nSizing Grid Containers"}],"url":"https://drafts.csswg.org/css-sizing-3/#min-content"},
"48350e83": {"dfnID":"48350e83","dfnText":"align-self","external":true,"refSections":[{"refs":[{"id":"ref-for-propdef-align-self"}],"title":"6.2. \nStretch Alignment in the Masonry Axis"},{"refs":[{"id":"ref-for-propdef-align-self\u2460"},{"id":"ref-for-propdef-align-self\u2461"}],"title":"6.4. \nBaseline Alignment in the Masonry Axis"}],"url":"https://drafts.csswg.org/css-align-3/#propdef-align-self"},
"4bc11993": {"dfnID":"4bc11993","dfnText":"center","external":true,"refSections":[{"refs":[{"id":"ref-for-valdef-self-position-center"}],"title":"6. \nAlignment and Spacing"},{"refs":[{"id":"ref-for-valdef-self-position-center\u2460"}],"title":"10. \nPerformance Notes"}],"url":"https://drafts.csswg.org/css-align-3/#valdef-self-position-center"},
"537cf076": {"dfnID":"537cf076","dfnText":"?","external":true,"refSections":[{"refs":[{"id":"ref-for-mult-opt"},{"id":"ref-for-mult-opt\u2460"}],"title":"6.1. \nThe align-tracks and justify-tracks Properties\n"}],"url":"https://drafts.csswg.org/css-values-4/#mult-opt"},
"57e29492": {"dfnID":"57e29492","dfnText":"indefinite size","external":true,"refSections":[{"refs":[{"id":"ref-for-indefinite"}],"title":"6.2. \nStretch Alignment in the Masonry Axis"}],"url":"https://drafts.csswg.org/css-sizing-3/#indefinite"},
"58d94cb8": {"dfnID":"58d94cb8","dfnText":"grid-column","external":true,"refSections":[{"refs":[{"id":"ref-for-propdef-grid-column"}],"title":"2. \nMasonry Layout"}],"url":"https://drafts.csswg.org/css-grid-2/#propdef-grid-column"},
"5bc8bd12": {"dfnID":"5bc8bd12","dfnText":"direction","external":true,"refSections":[{"refs":[{"id":"ref-for-propdef-direction"},{"id":"ref-for-propdef-direction\u2460"},{"id":"ref-for-propdef-direction\u2461"},{"id":"ref-for-propdef-direction\u2462"}],"title":"4. \nThe Implicit Grid\n"}],"url":"https://drafts.csswg.org/css-writing-modes-3/#propdef-direction"},
"5d275b21": {"dfnID":"5d275b21","dfnText":"<overflow-position>","external":true,"refSections":[{"refs":[{"id":"ref-for-typedef-overflow-position"},{"id":"ref-for-typedef-overflow-position\u2460"}],"title":"6.1. \nThe align-tracks and justify-tracks Properties\n"}],"url":"https://drafts.csswg.org/css-align-3/#typedef-overflow-position"},
"5d82066a": {"dfnID":"5d82066a","dfnText":"fragmentainer","external":true,"refSections":[{"refs":[{"id":"ref-for-fragmentainer"}],"title":"7.1. \nFragmentation in the Masonry Axis"}],"url":"https://drafts.csswg.org/css-break-4/#fragmentainer"},
"61fd6018": {"dfnID":"61fd6018","dfnText":"definite size","external":true,"refSections":[{"refs":[{"id":"ref-for-definite"}],"title":"6.2. \nStretch Alignment in the Masonry Axis"}],"url":"https://drafts.csswg.org/css-sizing-3/#definite"},
"68487d22": {"dfnID":"68487d22","dfnText":"#","external":true,"refSections":[{"refs":[{"id":"ref-for-mult-comma"},{"id":"ref-for-mult-comma\u2460"}],"title":"6.1. \nThe align-tracks and justify-tracks Properties\n"}],"url":"https://drafts.csswg.org/css-values-4/#mult-comma"},
"69b01b6e": {"dfnID":"69b01b6e","dfnText":"<content-distribution>","external":true,"refSections":[{"refs":[{"id":"ref-for-typedef-content-distribution"},{"id":"ref-for-typedef-content-distribution\u2460"}],"title":"6.1. \nThe align-tracks and justify-tracks Properties\n"},{"refs":[{"id":"ref-for-typedef-content-distribution\u2461"}],"title":"10. \nPerformance Notes"}],"url":"https://drafts.csswg.org/css-align-3/#typedef-content-distribution"},
"6dc3914f": {"dfnID":"6dc3914f","dfnText":"min-content constraint","external":true,"refSections":[{"refs":[{"id":"ref-for-min-content-constraint"}],"title":"5. \nSizing Grid Containers"}],"url":"https://drafts.csswg.org/css-sizing-3/#min-content-constraint"},
"6ec67710": {"dfnID":"6ec67710","dfnText":"|","external":true,"refSections":[{"refs":[{"id":"ref-for-comb-one"},{"id":"ref-for-comb-one\u2460"}],"title":"2.5. \nThe masonry-auto-flow Property"},{"refs":[{"id":"ref-for-comb-one\u2461"},{"id":"ref-for-comb-one\u2462"},{"id":"ref-for-comb-one\u2463"},{"id":"ref-for-comb-one\u2464"},{"id":"ref-for-comb-one\u2465"},{"id":"ref-for-comb-one\u2466"},{"id":"ref-for-comb-one\u2467"}],"title":"6.1. \nThe align-tracks and justify-tracks Properties\n"}],"url":"https://drafts.csswg.org/css-values-4/#comb-one"},
"736dfced": {"dfnID":"736dfced","dfnText":"dense","external":true,"refSections":[{"refs":[{"id":"ref-for-valdef-grid-auto-flow-dense"}],"title":"4. \nThe Implicit Grid\n"}],"url":"https://drafts.csswg.org/css-grid-2/#valdef-grid-auto-flow-dense"},
"75f6cfb6": {"dfnID":"75f6cfb6","dfnText":"justify-content","external":true,"refSections":[{"refs":[{"id":"ref-for-propdef-justify-content"}],"title":"6. \nAlignment and Spacing"},{"refs":[{"id":"ref-for-propdef-justify-content\u2460"},{"id":"ref-for-propdef-justify-content\u2461"}],"title":"6.1. \nThe align-tracks and justify-tracks Properties\n"}],"url":"https://drafts.csswg.org/css-align-3/#propdef-justify-content"},
"78a34e77": {"dfnID":"78a34e77","dfnText":"margin-block","external":true,"refSections":[{"refs":[{"id":"ref-for-propdef-margin-block"}],"title":"6.2. \nStretch Alignment in the Masonry Axis"}],"url":"https://drafts.csswg.org/css-logical-1/#propdef-margin-block"},
"80175c82": {"dfnID":"80175c82","dfnText":"baseline-sharing group","external":true,"refSections":[{"refs":[{"id":"ref-for-baseline-sharing-group"}],"title":"6.4. \nBaseline Alignment in the Masonry Axis"}],"url":"https://drafts.csswg.org/css-align-3/#baseline-sharing-group"},
"842c0376": {"dfnID":"842c0376","dfnText":"none","external":true,"refSections":[{"refs":[{"id":"ref-for-valdef-grid-template-rows-none"},{"id":"ref-for-valdef-grid-template-rows-none\u2460"}],"title":"2. \nMasonry Layout"},{"refs":[{"id":"ref-for-valdef-grid-template-rows-none\u2461"}],"title":"2.1. \nLine Name Resolution"},{"refs":[{"id":"ref-for-valdef-grid-template-rows-none\u2462"}],"title":"2.2. \nGrid Item Placement"}],"url":"https://drafts.csswg.org/css-grid-2/#valdef-grid-template-rows-none"},
"8a82fda1": {"dfnID":"8a82fda1","dfnText":"||","external":true,"refSections":[{"refs":[{"id":"ref-for-comb-any"}],"title":"2.5. \nThe masonry-auto-flow Property"}],"url":"https://drafts.csswg.org/css-values-4/#comb-any"},
"8e662436": {"dfnID":"8e662436","dfnText":"baseline alignment","external":true,"refSections":[{"refs":[{"id":"ref-for-baseline-alignment"}],"title":"6. \nAlignment and Spacing"},{"refs":[{"id":"ref-for-baseline-alignment\u2460"},{"id":"ref-for-baseline-alignment\u2461"}],"title":"6.4. \nBaseline Alignment in the Masonry Axis"}],"url":"https://drafts.csswg.org/css-align-3/#baseline-alignment"},
"9e39189b": {"dfnID":"9e39189b","dfnText":"max-height","external":true,"refSections":[{"refs":[{"id":"ref-for-propdef-max-height"}],"title":"6.2. \nStretch Alignment in the Masonry Axis"}],"url":"https://drafts.csswg.org/css-sizing-3/#propdef-max-height"},
"9f890aae": {"dfnID":"9f890aae","dfnText":"normal (for align-self)","external":true,"refSections":[{"refs":[{"id":"ref-for-valdef-align-self-normal"}],"title":"6. \nAlignment and Spacing"},{"refs":[{"id":"ref-for-valdef-align-self-normal\u2460"}],"title":"6.2. \nStretch Alignment in the Masonry Axis"}],"url":"https://drafts.csswg.org/css-align-3/#valdef-align-self-normal"},
"9fe435f5": {"dfnID":"9fe435f5","dfnText":"stretch (for align-content)","external":true,"refSections":[{"refs":[{"id":"ref-for-valdef-align-content-stretch"},{"id":"ref-for-valdef-align-content-stretch\u2460"}],"title":"6. \nAlignment and Spacing"}],"url":"https://drafts.csswg.org/css-align-3/#valdef-align-content-stretch"},
"a1432810": {"dfnID":"a1432810","dfnText":"grid-row","external":true,"refSections":[{"refs":[{"id":"ref-for-propdef-grid-row"}],"title":"2. \nMasonry Layout"}],"url":"https://drafts.csswg.org/css-grid-2/#propdef-grid-row"},
"aadd356f": {"dfnID":"aadd356f","dfnText":"<content-position>","external":true,"refSections":[{"refs":[{"id":"ref-for-typedef-content-position"},{"id":"ref-for-typedef-content-position\u2460"}],"title":"6.1. \nThe align-tracks and justify-tracks Properties\n"}],"url":"https://drafts.csswg.org/css-align-3/#typedef-content-position"},
"b1a75fe8": {"dfnID":"b1a75fe8","dfnText":"stretch (for align-self)","external":true,"refSections":[{"refs":[{"id":"ref-for-valdef-align-self-stretch"}],"title":"6.2. \nStretch Alignment in the Masonry Axis"},{"refs":[{"id":"ref-for-valdef-align-self-stretch\u2460"}],"title":"10. \nPerformance Notes"}],"url":"https://drafts.csswg.org/css-align-3/#valdef-align-self-stretch"},
"b47c7071": {"dfnID":"b47c7071","dfnText":"grid-template-rows","external":true,"refSections":[{"refs":[{"id":"ref-for-propdef-grid-template-rows"}],"title":"2. \nMasonry Layout"}],"url":"https://drafts.csswg.org/css-grid-2/#propdef-grid-template-rows"},
"b8850feb": {"dfnID":"b8850feb","dfnText":"start","external":true,"refSections":[{"refs":[{"id":"ref-for-valdef-self-position-start"}],"title":"6. \nAlignment and Spacing"}],"url":"https://drafts.csswg.org/css-align-3/#valdef-self-position-start"},
"b8c7a216": {"dfnID":"b8c7a216","dfnText":"forced break","external":true,"refSections":[{"refs":[{"id":"ref-for-forced-break"}],"title":"7.1. \nFragmentation in the Masonry Axis"}],"url":"https://drafts.csswg.org/css-break-4/#forced-break"},
"b98c5f6c": {"dfnID":"b98c5f6c","dfnText":"grid position","external":true,"refSections":[{"refs":[{"id":"ref-for-grid-position"}],"title":"9. \nAbsolute Positioning"}],"url":"https://drafts.csswg.org/css-grid-2/#grid-position"},
"bb16e9a6": {"dfnID":"bb16e9a6","dfnText":"max size","external":true,"refSections":[{"refs":[{"id":"ref-for-max-width"}],"title":"6.2. \nStretch Alignment in the Masonry Axis"}],"url":"https://drafts.csswg.org/css-sizing-3/#max-width"},
"c6c2ab78": {"dfnID":"c6c2ab78","dfnText":"subgrid","external":true,"refSections":[{"refs":[{"id":"ref-for-subgrid"}],"title":"8. \nSubgrids"}],"url":"https://drafts.csswg.org/css-grid-2/#subgrid"},
"c8322a15": {"dfnID":"c8322a15","dfnText":"last baseline set","external":true,"refSections":[{"refs":[{"id":"ref-for-last-baseline-set"}],"title":"6.4. \nBaseline Alignment in the Masonry Axis"}],"url":"https://drafts.csswg.org/css-align-3/#last-baseline-set"},
"ce1c3a64": {"dfnID":"ce1c3a64","dfnText":"align-content","external":true,"refSections":[{"refs":[{"id":"ref-for-propdef-align-content"},{"id":"ref-for-propdef-align-content\u2460"}],"title":"6. \nAlignment and Spacing"},{"refs":[{"id":"ref-for-propdef-align-content\u2461"},{"id":"ref-for-propdef-align-content\u2462"}],"title":"6.1. \nThe align-tracks and justify-tracks Properties\n"},{"refs":[{"id":"ref-for-propdef-align-content\u2463"}],"title":"6.4. \nBaseline Alignment in the Masonry Axis"}],"url":"https://drafts.csswg.org/css-align-3/#propdef-align-content"},
"d15331bf": {"dfnID":"d15331bf","dfnText":"alignment subject","external":true,"refSections":[{"refs":[{"id":"ref-for-alignment-subject"},{"id":"ref-for-alignment-subject\u2460"}],"title":"6. \nAlignment and Spacing"}],"url":"https://drafts.csswg.org/css-align-3/#alignment-subject"},
"df6c9896": {"dfnID":"df6c9896","dfnText":"grid-template","external":true,"refSections":[{"refs":[{"id":"ref-for-propdef-grid-template"}],"title":"11. \nGraceful Degradation"}],"url":"https://drafts.csswg.org/css-grid-2/#propdef-grid-template"},
"e0975054": {"dfnID":"e0975054","dfnText":"first baseline set","external":true,"refSections":[{"refs":[{"id":"ref-for-first-baseline-set"}],"title":"6.4. \nBaseline Alignment in the Masonry Axis"}],"url":"https://drafts.csswg.org/css-align-3/#first-baseline-set"},
"e0f38f8e": {"dfnID":"e0f38f8e","dfnText":"grid-template-columns","external":true,"refSections":[{"refs":[{"id":"ref-for-propdef-grid-template-columns"},{"id":"ef6f06610"}],"title":"2. \nMasonry Layout"}],"url":"https://drafts.csswg.org/css-grid-2/#propdef-grid-template-columns"},
"e3346911": {"dfnID":"e3346911","dfnText":"<baseline-position>","external":true,"refSections":[{"refs":[{"id":"ref-for-typedef-baseline-position"}],"title":"6.1. \nThe align-tracks and justify-tracks Properties\n"}],"url":"https://drafts.csswg.org/css-align-3/#typedef-baseline-position"},
"e3ccce60": {"dfnID":"e3ccce60","dfnText":"grid area","external":true,"refSections":[{"refs":[{"id":"ref-for-grid-area"}],"title":"3. \nContaining Block"}],"url":"https://drafts.csswg.org/css-grid-2/#grid-area"},
"ea663a43": {"dfnID":"ea663a43","dfnText":"containing block","external":true,"refSections":[{"refs":[{"id":"ref-for-containing-block"}],"title":"3. \nContaining Block"},{"refs":[{"id":"ref-for-containing-block\u2460"}],"title":"9. \nAbsolute Positioning"}],"url":"https://drafts.csswg.org/css-display-4/#containing-block"},
"eb309e21": {"dfnID":"eb309e21","dfnText":"normal (for justify-content)","external":true,"refSections":[{"refs":[{"id":"ref-for-valdef-justify-content-normal"}],"title":"6. \nAlignment and Spacing"}],"url":"https://drafts.csswg.org/css-align-3/#valdef-justify-content-normal"},
"f005b2f6": {"dfnID":"f005b2f6","dfnText":"grid container","external":true,"refSections":[{"refs":[{"id":"ref-for-grid-container"},{"id":"ref-for-grid-container\u2460"},{"id":"ref-for-grid-container\u2461"},{"id":"ref-for-grid-container\u2462"},{"id":"ref-for-grid-container\u2463"},{"id":"ref-for-grid-container\u2464"}],"title":"2. \nMasonry Layout"},{"refs":[{"id":"ref-for-grid-container\u2465"}],"title":"2.5. \nThe masonry-auto-flow Property"},{"refs":[{"id":"ref-for-grid-container\u2466"},{"id":"ref-for-grid-container\u2467"}],"title":"5. \nSizing Grid Containers"},{"refs":[{"id":"ref-for-grid-container\u2468"},{"id":"ref-for-grid-container\u2460\u24ea"},{"id":"ref-for-grid-container\u2460\u2460"},{"id":"ref-for-grid-container\u2460\u2461"},{"id":"ref-for-grid-container\u2460\u2462"},{"id":"ref-for-grid-container\u2460\u2463"},{"id":"ref-for-grid-container\u2460\u2464"}],"title":"6. \nAlignment and Spacing"},{"refs":[{"id":"ref-for-grid-container\u2460\u2465"},{"id":"ref-for-grid-container\u2460\u2466"}],"title":"6.1. \nThe align-tracks and justify-tracks Properties\n"},{"refs":[{"id":"ref-for-grid-container\u2460\u2467"},{"id":"ref-for-grid-container\u2460\u2468"}],"title":"6.4. \nBaseline Alignment in the Masonry Axis"},{"refs":[{"id":"ref-for-grid-container\u2461\u24ea"}],"title":"7.2. \nFragmentation in the Grid Axis"},{"refs":[{"id":"ref-for-grid-container\u2461\u2460"}],"title":"8. \nSubgrids"},{"refs":[{"id":"ref-for-grid-container\u2461\u2461"}],"title":"9. \nAbsolute Positioning"}],"url":"https://drafts.csswg.org/css-grid-2/#grid-container"},
"f3917b3e": {"dfnID":"f3917b3e","dfnText":"grid","external":true,"refSections":[{"refs":[{"id":"ref-for-propdef-grid"}],"title":"8. \nSubgrids"},{"refs":[{"id":"ref-for-propdef-grid\u2460"}],"title":"11. \nGraceful Degradation"}],"url":"https://drafts.csswg.org/css-grid-2/#propdef-grid"},
"fdb725d6": {"dfnID":"fdb725d6","dfnText":"implicit grid","external":true,"refSections":[{"refs":[{"id":"ref-for-implicit-grid"}],"title":"4. \nThe Implicit Grid\n"}],"url":"https://drafts.csswg.org/css-grid-2/#implicit-grid"},
"grid-axis": {"dfnID":"grid-axis","dfnText":"grid axis","external":false,"refSections":[{"refs":[{"id":"ref-for-grid-axis"},{"id":"ref-for-grid-axis\u2460"},{"id":"ref-for-grid-axis\u2461"}],"title":"2. \nMasonry Layout"},{"refs":[{"id":"ref-for-grid-axis\u2462"},{"id":"ref-for-grid-axis\u2463"},{"id":"ref-for-grid-axis\u2464"}],"title":"2.2. \nGrid Item Placement"},{"refs":[{"id":"ref-for-grid-axis\u2465"},{"id":"ref-for-grid-axis\u2466"},{"id":"ref-for-grid-axis\u2467"},{"id":"ref-for-grid-axis\u2468"}],"title":"2.3. \nGrid Axis Track Sizing"},{"refs":[{"id":"ref-for-grid-axis\u2460\u24ea"},{"id":"ref-for-grid-axis\u2460\u2460"},{"id":"ref-for-grid-axis\u2460\u2461"},{"id":"ref-for-grid-axis\u2460\u2462"},{"id":"ref-for-grid-axis\u2460\u2463"},{"id":"ref-for-grid-axis\u2460\u2464"},{"id":"ref-for-grid-axis\u2460\u2465"},{"id":"ref-for-grid-axis\u2460\u2466"},{"id":"ref-for-grid-axis\u2460\u2467"},{"id":"ref-for-grid-axis\u2460\u2468"},{"id":"ref-for-grid-axis\u2461\u24ea"}],"title":"2.4. \nMasonry Layout Algorithm"},{"refs":[{"id":"ref-for-grid-axis\u2461\u2460"}],"title":"2.5. \nThe masonry-auto-flow Property"},{"refs":[{"id":"ref-for-grid-axis\u2461\u2461"}],"title":"3. \nContaining Block"},{"refs":[{"id":"ref-for-grid-axis\u2461\u2462"},{"id":"ref-for-grid-axis\u2461\u2463"},{"id":"ref-for-grid-axis\u2461\u2464"},{"id":"ref-for-grid-axis\u2461\u2465"}],"title":"4. \nThe Implicit Grid\n"},{"refs":[{"id":"ref-for-grid-axis\u2461\u2466"}],"title":"6. \nAlignment and Spacing"},{"refs":[{"id":"ref-for-grid-axis\u2461\u2467"},{"id":"ref-for-grid-axis\u2461\u2468"}],"title":"6.1. \nThe align-tracks and justify-tracks Properties\n"},{"refs":[{"id":"ref-for-grid-axis\u2462\u24ea"}],"title":"6.4. \nBaseline Alignment in the Masonry Axis"},{"refs":[{"id":"ref-for-grid-axis\u2462\u2460"},{"id":"ref-for-grid-axis\u2462\u2461"},{"id":"ref-for-grid-axis\u2462\u2462"}],"title":"7.1. \nFragmentation in the Masonry Axis"},{"refs":[{"id":"ref-for-grid-axis\u2462\u2463"}],"title":"7.2. \nFragmentation in the Grid Axis"},{"refs":[{"id":"ref-for-grid-axis\u2462\u2464"}],"title":"9. \nAbsolute Positioning"},{"refs":[{"id":"ref-for-grid-axis\u2462\u2465"}],"title":"10. \nPerformance Notes"}],"url":"#grid-axis"},
"masonry-axis": {"dfnID":"masonry-axis","dfnText":"masonry axis","external":false,"refSections":[{"refs":[{"id":"ref-for-masonry-axis"}],"title":"2. \nMasonry Layout"},{"refs":[{"id":"ref-for-masonry-axis\u2460"},{"id":"ref-for-masonry-axis\u2461"},{"id":"ref-for-masonry-axis\u2462"},{"id":"ref-for-masonry-axis\u2463"}],"title":"2.2. \nGrid Item Placement"},{"refs":[{"id":"ref-for-masonry-axis\u2464"}],"title":"2.3. \nGrid Axis Track Sizing"},{"refs":[{"id":"ref-for-masonry-axis\u2465"}],"title":"2.3.1. \nrepeat(auto-fit)"},{"refs":[{"id":"ref-for-masonry-axis\u2466"},{"id":"ref-for-masonry-axis\u2467"},{"id":"ref-for-masonry-axis\u2468"},{"id":"ref-for-masonry-axis\u2460\u24ea"},{"id":"ref-for-masonry-axis\u2460\u2460"}],"title":"2.4. \nMasonry Layout Algorithm"},{"refs":[{"id":"ref-for-masonry-axis\u2460\u2461"}],"title":"3. \nContaining Block"},{"refs":[{"id":"ref-for-masonry-axis\u2460\u2462"},{"id":"ref-for-masonry-axis\u2460\u2463"},{"id":"ref-for-masonry-axis\u2460\u2464"}],"title":"4. \nThe Implicit Grid\n"},{"refs":[{"id":"ref-for-masonry-axis\u2460\u2465"},{"id":"ref-for-masonry-axis\u2460\u2466"}],"title":"5. \nSizing Grid Containers"},{"refs":[{"id":"ref-for-masonry-axis\u2460\u2467"},{"id":"ref-for-masonry-axis\u2460\u2468"},{"id":"ref-for-masonry-axis\u2461\u24ea"},{"id":"ref-for-masonry-axis\u2461\u2460"}],"title":"6. \nAlignment and Spacing"},{"refs":[{"id":"ref-for-masonry-axis\u2461\u2461"}],"title":"6.1. \nThe align-tracks and justify-tracks Properties\n"},{"refs":[{"id":"ref-for-masonry-axis\u2461\u2462"},{"id":"ref-for-masonry-axis\u2461\u2463"},{"id":"ref-for-masonry-axis\u2461\u2464"},{"id":"ref-for-masonry-axis\u2461\u2465"}],"title":"6.2. \nStretch Alignment in the Masonry Axis"},{"refs":[{"id":"ref-for-masonry-axis\u2461\u2466"},{"id":"ref-for-masonry-axis\u2461\u2467"},{"id":"ref-for-masonry-axis\u2461\u2468"}],"title":"6.4. \nBaseline Alignment in the Masonry Axis"},{"refs":[{"id":"ref-for-masonry-axis\u2462\u24ea"}],"title":"7.1. \nFragmentation in the Masonry Axis"},{"refs":[{"id":"ref-for-masonry-axis\u2462\u2460"},{"id":"ref-for-masonry-axis\u2462\u2461"},{"id":"ref-for-masonry-axis\u2462\u2462"}],"title":"8. \nSubgrids"},{"refs":[{"id":"ref-for-masonry-axis\u2462\u2463"},{"id":"ref-for-masonry-axis\u2462\u2464"},{"id":"ref-for-masonry-axis\u2462\u2465"},{"id":"ref-for-masonry-axis\u2462\u2466"}],"title":"9. \nAbsolute Positioning"},{"refs":[{"id":"ref-for-masonry-axis\u2462\u2467"},{"id":"ref-for-masonry-axis\u2462\u2468"}],"title":"10. \nPerformance Notes"}],"url":"#masonry-axis"},
"masonry-box": {"dfnID":"masonry-box","dfnText":"masonry box","external":false,"refSections":[{"refs":[{"id":"ref-for-masonry-box"},{"id":"ref-for-masonry-box\u2460"}],"title":"6. \nAlignment and Spacing"},{"refs":[{"id":"ref-for-masonry-box\u2461"}],"title":"6.4. \nBaseline Alignment in the Masonry Axis"},{"refs":[{"id":"ref-for-masonry-box\u2462"},{"id":"ref-for-masonry-box\u2463"}],"title":"9. \nAbsolute Positioning"}],"url":"#masonry-box"},
"propdef-align-tracks": {"dfnID":"propdef-align-tracks","dfnText":"align-tracks","external":false,"refSections":[{"refs":[{"id":"ref-for-propdef-align-tracks"}],"title":"6.1. \nThe align-tracks and justify-tracks Properties\n"},{"refs":[{"id":"ref-for-propdef-align-tracks\u2460"}],"title":"6.2. \nStretch Alignment in the Masonry Axis"},{"refs":[{"id":"ref-for-propdef-align-tracks\u2461"}],"title":"6.3. \nIndividual Track Alignment in the Masonry Axis"},{"refs":[{"id":"ref-for-propdef-align-tracks\u2462"}],"title":"6.4. \nBaseline Alignment in the Masonry Axis"},{"refs":[{"id":"ref-for-propdef-align-tracks\u2463"}],"title":"10. \nPerformance Notes"}],"url":"#propdef-align-tracks"},
"propdef-justify-tracks": {"dfnID":"propdef-justify-tracks","dfnText":"justify-tracks","external":false,"refSections":[{"refs":[{"id":"ref-for-propdef-justify-tracks"}],"title":"6.2. \nStretch Alignment in the Masonry Axis"},{"refs":[{"id":"ref-for-propdef-justify-tracks\u2460"}],"title":"6.4. \nBaseline Alignment in the Masonry Axis"},{"refs":[{"id":"ref-for-propdef-justify-tracks\u2461"}],"title":"10. \nPerformance Notes"}],"url":"#propdef-justify-tracks"},
"propdef-masonry-auto-flow": {"dfnID":"propdef-masonry-auto-flow","dfnText":"masonry-auto-flow","external":false,"refSections":[{"refs":[{"id":"ref-for-propdef-masonry-auto-flow"},{"id":"ref-for-propdef-masonry-auto-flow\u2460"},{"id":"ref-for-propdef-masonry-auto-flow\u2461"}],"title":"2.5. \nThe masonry-auto-flow Property"}],"url":"#propdef-masonry-auto-flow"},
"running-position": {"dfnID":"running-position","dfnText":"running position","external":false,"refSections":[{"refs":[{"id":"ref-for-running-position"},{"id":"ref-for-running-position\u2460"},{"id":"ref-for-running-position\u2461"},{"id":"ref-for-running-position\u2462"},{"id":"ref-for-running-position\u2463"}],"title":"2.4. \nMasonry Layout Algorithm"},{"refs":[{"id":"ref-for-running-position\u2464"}],"title":"7.1. \nFragmentation in the Masonry Axis"},{"refs":[{"id":"ref-for-running-position\u2465"}],"title":"9. \nAbsolute Positioning"}],"url":"#running-position"},
};

document.addEventListener("DOMContentLoaded", ()=>{
    genAllDfnPanels();

    document.body.addEventListener("click", (e) => {
        // If not handled already, just hide all dfn panels.
        hideAllDfnPanels();
    });
});

window.addEventListener("resize", () => {
    // Pin any visible dfn panel
    queryAll(".dfn-panel.on, .dfn-panel.activated").forEach(el=>positionDfnPanel(el));
});

function genAllDfnPanels() {
    for(const panelData of Object.values(dfnPanelData)) {
        const dfnID = panelData.dfnID;
        const dfn = document.getElementById(dfnID);
        if(!dfn) {
            console.log(`Can't find dfn#${dfnID}.`, panelData);
            continue;
        }
        dfn.panelData = panelData;
        insertDfnPopupAction(dfn);
    }
}

function genDfnPanel(dfn, { dfnID, url, dfnText, refSections, external }) {
    const dfnPanel = mk.aside({
        class: "dfn-panel on",
        id: `infopanel-for-${dfnID}`,
        "data-for": dfnID,
        "aria-labelled-by":`infopaneltitle-for-${dfnID}`,
        },
        mk.span({id:`infopaneltitle-for-${dfnID}`, style:"display:none"},
            `Info about the '${dfnText}' ${external?"external":""} reference.`),
        mk.a({href:url, class:"dfn-link"}, url),
        refSections.length == 0 ? [] :
            mk.b({}, "Referenced in:"),
            mk.ul({},
                ...refSections.map(section=>
                    mk.li({},
                        ...section.refs.map((ref, refI)=>
                            [
                                mk.a({ href: `#${ref.id}` },
                                    (refI == 0) ? section.title : `(${refI + 1})`
                                ),
                                " ",
                            ]
                        ),
                    ),
                ),
            ),
        genLinkingSyntaxes(dfn),
    );

    dfnPanel.addEventListener('click', (event) => {
        if (event.target.nodeName == 'A') {
            scrollToTargetAndHighlight(event);
            pinDfnPanel(dfnPanel);
        }
        event.stopPropagation();
        refocusOnTarget(event);
    });
    dfnPanel.addEventListener('keydown', (event) => {
        if(event.keyCode == 27) { // Escape key
            hideDfnPanel({dfnPanel});
            event.stopPropagation();
            event.preventDefault();
        }
    });

    dfnPanel.dfn = dfn;
    dfn.dfnPanel = dfnPanel;
    return dfnPanel;
}



function hideAllDfnPanels() {
    // Delete the currently-active dfn panel.
    queryAll(".dfn-panel").forEach(dfnPanel=>hideDfnPanel({dfnPanel}));
}

function showDfnPanel(dfn) {
    hideAllDfnPanels(); // Only display one at a time.

    dfn.setAttribute("aria-expanded", "true");

    const dfnPanel = genDfnPanel(dfn, dfn.panelData);

    // Give the dfn a unique tabindex, and then
    // give all the tabbable panel bits successive indexes.
    let tabIndex = 100;
    dfn.tabIndex = tabIndex++;
    const tabbable = dfnPanel.querySelectorAll(":is(a, button)");
    for (const el of tabbable) {
        el.tabIndex = tabIndex++;
    }

    append(document.body, dfnPanel);
    positionDfnPanel(dfnPanel);
}

function positionDfnPanel(dfnPanel) {
    const dfn = dfnPanel.dfn;
    const dfnPos = getBounds(dfn);
    dfnPanel.style.top = dfnPos.bottom + "px";
    dfnPanel.style.left = dfnPos.left + "px";

    const panelPos = dfnPanel.getBoundingClientRect();
    const panelMargin = 8;
    const maxRight = document.body.parentNode.clientWidth - panelMargin;
    if (panelPos.right > maxRight) {
        const overflowAmount = panelPos.right - maxRight;
        const newLeft = Math.max(panelMargin, dfnPos.left - overflowAmount);
        dfnPanel.style.left = newLeft + "px";
    }
}

function pinDfnPanel(dfnPanel) {
    // Switch it to "activated" state, which pins it.
    dfnPanel.classList.add("activated");
    dfnPanel.style.position = "fixed";
    dfnPanel.style.left = null;
    dfnPanel.style.top = null;
}

function hideDfnPanel({dfn, dfnPanel}) {
    if(!dfnPanel) dfnPanel = dfn.dfnPanel;
    if(!dfn) dfn = dfnPanel.dfn;
    dfn.dfnPanel = undefined;
    dfnPanel.dfn = undefined;
    dfn.setAttribute("aria-expanded", "false");
    dfn.tabIndex = undefined;
    dfnPanel.remove()
}

function toggleDfnPanel(dfn) {
    if(dfn.dfnPanel) {
        hideDfnPanel(dfn);
    } else {
        showDfnPanel(dfn);
    }
}

function insertDfnPopupAction(dfn) {
    dfn.setAttribute('role', 'button');
    dfn.setAttribute('aria-expanded', 'false')
    dfn.tabIndex = 0;
    dfn.classList.add('has-dfn-panel');
    dfn.addEventListener('click', (event) => {
        toggleDfnPanel(dfn);
        event.stopPropagation();
    });
    dfn.addEventListener('keypress', (event) => {
        const kc = event.keyCode;
        // 32->Space, 13->Enter
        if(kc == 32 || kc == 13) {
            toggleDfnPanel(dfn);
            event.stopPropagation();
            event.preventDefault();
        }
    });
}

function refocusOnTarget(event) {
    const target = event.target;
    setTimeout(() => {
        // Refocus on the event.target element.
        // This is needed after browser scrolls to the destination.
        target.focus();
    });
}

// TODO: shared util
// Returns the root-level absolute position {left and top} of element.
function getBounds(el, relativeTo=document.body) {
    const relativeRect = relativeTo.getBoundingClientRect();
    const elRect = el.getBoundingClientRect();
    const top = elRect.top - relativeRect.top;
    const left = elRect.left - relativeRect.left;
    return {
        top,
        left,
        bottom: top + elRect.height,
        right: left + elRect.width,
    }
}

function scrollToTargetAndHighlight(event) {
    let hash = event.target.hash;
    if (hash) {
        hash = decodeURIComponent(hash.substring(1));
        const dest = document.getElementById(hash);
        if (dest) {
            dest.classList.add('highlighted');
            setTimeout(() => dest.classList.remove('highlighted'), 1000);
        }
    }
}

// Functions, divided by link type, that wrap an autolink's
// contents with the appropriate outer syntax.
// Alternately, a string naming another type they format
// the same as.
function needsFor(type) {
    switch(type) {
        case "descriptor":
        case "value":
        case "element-attr":
        case "attr-value":
        case "element-state":
        case "method":
        case "constructor":
        case "argument":
        case "attribute":
        case "const":
        case "dict-member":
        case "event":
        case "enum-value":
        case "stringifier":
        case "serializer":
        case "iterator":
        case "maplike":
        case "setlike":
        case "state":
        case "mode":
        case "context":
        case "facet": return true;

        default: return false;
    }
}
function refusesFor(type) {
    switch(type) {
        case "property":
        case "element":
        case "interface":
        case "namespace":
        case "callback":
        case "dictionary":
        case "enum":
        case "exception":
        case "typedef":
        case "http-header":
        case "permission": return true;

        default: return false;
    }
}
function linkFormatterFromType(type) {
    switch(type) {
        case 'scheme':
        case 'permission':
        case 'dfn': return (text) => `[=${text}=]`;

        case 'abstract-op': return (text) => `[\$${text}\$]`;

        case 'function':
        case 'at-rule':
        case 'selector':
        case 'value': return (text) => `''${text}''`;

        case 'http-header': return (text) => `[:${text}:]`;

        case 'interface':
        case 'constructor':
        case 'method':
        case 'argument':
        case 'attribute':
        case 'callback':
        case 'dictionary':
        case 'dict-member':
        case 'enum':
        case 'enum-value':
        case 'exception':
        case 'const':
        case 'typedef':
        case 'stringifier':
        case 'serializer':
        case 'iterator':
        case 'maplike':
        case 'setlike':
        case 'extended-attribute':
        case 'event':
        case 'idl': return (text) => `{{${text}}}`;

        case 'element-state':
        case 'element-attr':
        case 'attr-value':
        case 'element': return (element) => `<{${element}}>`;

        case 'grammar': return (text) => `${text} (within a <pre class=prod>)`;

        case 'type': return (text)=> `<<${text}>>`;

        case 'descriptor':
        case 'property': return (text) => `'${text}'`;

        default: return;
    };
};

function genLinkingSyntaxes(dfn) {
    if(dfn.tagName != "DFN") return;

    const type = dfn.getAttribute('data-dfn-type');
    if(!type) {
        console.log(`<dfn> doesn't have a data-dfn-type:`, dfn);
        return [];
    }

    // Return a function that wraps link text based on the type
    const linkFormatter = linkFormatterFromType(type);
    if(!linkFormatter) {
        console.log(`<dfn> has an unknown data-dfn-type:`, dfn);
        return [];
    }

    let ltAlts;
    if(dfn.hasAttribute('data-lt')) {
        ltAlts = dfn.getAttribute('data-lt')
            .split("|")
            .map(x=>x.trim());
    } else {
        ltAlts = [dfn.textContent.trim()];
    }
    if(type == "type") {
        // lt of "<foo>", but "foo" is the interior;
        // <<foo/bar>> is how you write it with a for,
        // not <foo/<bar>> or whatever.
        for(var i = 0; i < ltAlts.length; i++) {
            const lt = ltAlts[i];
            const match = /<(.*)>/.exec(lt);
            if(match) { ltAlts[i] = match[1]; }
        }
    }

    let forAlts;
    if(dfn.hasAttribute('data-dfn-for')) {
        forAlts = dfn.getAttribute('data-dfn-for')
            .split(",")
            .map(x=>x.trim());
    } else {
        forAlts = [''];
    }

    let linkingSyntaxes = [];
    if(!needsFor(type)) {
        for(const lt of ltAlts) {
            linkingSyntaxes.push(linkFormatter(lt));
        }
    }
    if(!refusesFor(type)) {
        for(const f of forAlts) {
            linkingSyntaxes.push(linkFormatter(`${f}/${ltAlts[0]}`))
        }
    }
    return [
        mk.b({}, 'Possible linking syntaxes:'),
        mk.ul({},
            ...linkingSyntaxes.map(link => {
                const copyLink = async () =>
                    await navigator.clipboard.writeText(link);
                return mk.li({},
                    mk.div({ class: 'link-item' },
                        mk.button({
                            class: 'copy-icon', title: 'Copy',
                            type: 'button',
                            _onclick: copyLink,
                            tabindex: 0,
                        }, mk.span({ class: 'icon' }) ),
                        mk.span({}, link)
                    )
                );
            })
        )
    ];
}
}
</script>
<script>/* Boilerplate: script-link-titles */
"use strict";
{
let linkTitleData = {
"https://drafts.csswg.org/css-align-3/#typedef-baseline-position": "Expands to: baseline | first | last",
"https://drafts.csswg.org/css-align-3/#typedef-content-distribution": "Expands to: space-around | space-between | space-evenly | stretch",
"https://drafts.csswg.org/css-align-3/#typedef-content-position": "Expands to: center | end | flex-end | flex-start | start",
"https://drafts.csswg.org/css-align-3/#typedef-overflow-position": "Expands to: safe | unsafe",
};

function setTypeTitles() {
	for(let el of document.querySelectorAll("a[href]")) {
		if(el.href in linkTitleData && !el.hasAttribute("title")) {
			el.setAttribute("title", linkTitleData[el.href]);
		}
	}
}

document.addEventListener("DOMContentLoaded", setTypeTitles);
}
</script>
<script>/* Boilerplate: script-position-annos */
"use strict";
{
function repositionAnnoPanels(){
    const panels = [...document.querySelectorAll("[data-anno-for]")];
    hydratePanels(panels);
    let vSoFar = 0;
    for(const panel of panels.sort(cmpTops)) {
        if(panel.top < vSoFar) {
            panel.top = vSoFar;
            panel.style.top = vSoFar + "px";
        }
        vSoFar = panel.top + panel.height + 15;
    }
}
function hydratePanels(panels) {
    const main = document.querySelector("main");
    let mainRect;
    if(main) mainRect = main.getBoundingClientRect();
    // First display them all, if they're not already visible.
    for(const panel of panels) {
        panel.classList.remove("unpositioned");
    }
    // Measure them all
    for(const panel of panels) {
        const dfn = document.getElementById(panel.getAttribute("data-anno-for"));
        if(!dfn) {
            console.log("Can't find the annotation panel target:", panel);
            continue;
        }
        panel.dfn = dfn;
        panel.top = window.scrollY + dfn.getBoundingClientRect().top;
        let panelRect = panel.getBoundingClientRect();
        panel.height = panelRect.height;
        if(main) {
            panel.overlappingMain = panelRect.left < mainRect.right;
        } else {
            panel.overlappingMain = false;
        }
    }
    // And finally position them
    for(const panel of panels) {
        const dfn = panel.dfn;
        if(!dfn) continue;
        panel.style.top = panel.top + "px";
        panel.classList.toggle("overlapping-main", panel.overlappingMain);
    }
}

function cmpTops(a,b) {
    return a.top - b.top;
}

window.addEventListener("load", repositionAnnoPanels);
window.addEventListener("resize", repositionAnnoPanels);
}
</script>
<script>/* Boilerplate: script-ref-hints */
"use strict";
{
let refsData = {
"#grid-axis": {"export":true,"for_":[],"level":"3","normative":true,"shortname":"css-grid","spec":"css-grid-3","status":"local","text":"grid axis","type":"dfn","url":"#grid-axis"},
"#masonry-axis": {"export":true,"for_":[],"level":"3","normative":true,"shortname":"css-grid","spec":"css-grid-3","status":"local","text":"masonry axis","type":"dfn","url":"#masonry-axis"},
"#masonry-box": {"export":true,"for_":[],"level":"3","normative":true,"shortname":"css-grid","spec":"css-grid-3","status":"local","text":"masonry box","type":"dfn","url":"#masonry-box"},
"#propdef-align-tracks": {"export":true,"for_":[],"level":"3","normative":true,"shortname":"css-grid","spec":"css-grid-3","status":"local","text":"align-tracks","type":"property","url":"#propdef-align-tracks"},
"#propdef-justify-tracks": {"export":true,"for_":[],"level":"3","normative":true,"shortname":"css-grid","spec":"css-grid-3","status":"local","text":"justify-tracks","type":"property","url":"#propdef-justify-tracks"},
"#propdef-masonry-auto-flow": {"export":true,"for_":[],"level":"3","normative":true,"shortname":"css-grid","spec":"css-grid-3","status":"local","text":"masonry-auto-flow","type":"property","url":"#propdef-masonry-auto-flow"},
"#running-position": {"export":true,"for_":[],"level":"3","normative":true,"shortname":"css-grid","spec":"css-grid-3","status":"local","text":"running position","type":"dfn","url":"#running-position"},
"https://drafts.csswg.org/css-align-3/#alignment-subject": {"export":true,"for_":[],"level":"3","normative":true,"shortname":"css-align","spec":"css-align-3","status":"current","text":"alignment subject","type":"dfn","url":"https://drafts.csswg.org/css-align-3/#alignment-subject"},
"https://drafts.csswg.org/css-align-3/#baseline-alignment": {"export":true,"for_":[],"level":"3","normative":true,"shortname":"css-align","spec":"css-align-3","status":"current","text":"baseline alignment","type":"dfn","url":"https://drafts.csswg.org/css-align-3/#baseline-alignment"},
"https://drafts.csswg.org/css-align-3/#baseline-sharing-group": {"export":true,"for_":[],"level":"3","normative":true,"shortname":"css-align","spec":"css-align-3","status":"current","text":"baseline-sharing group","type":"dfn","url":"https://drafts.csswg.org/css-align-3/#baseline-sharing-group"},
"https://drafts.csswg.org/css-align-3/#first-baseline-set": {"export":true,"for_":[],"level":"3","normative":true,"shortname":"css-align","spec":"css-align-3","status":"current","text":"first baseline set","type":"dfn","url":"https://drafts.csswg.org/css-align-3/#first-baseline-set"},
"https://drafts.csswg.org/css-align-3/#last-baseline-set": {"export":true,"for_":[],"level":"3","normative":true,"shortname":"css-align","spec":"css-align-3","status":"current","text":"last baseline set","type":"dfn","url":"https://drafts.csswg.org/css-align-3/#last-baseline-set"},
"https://drafts.csswg.org/css-align-3/#propdef-align-content": {"export":true,"for_":[],"level":"3","normative":true,"shortname":"css-align","spec":"css-align-3","status":"current","text":"align-content","type":"property","url":"https://drafts.csswg.org/css-align-3/#propdef-align-content"},
"https://drafts.csswg.org/css-align-3/#propdef-align-self": {"export":true,"for_":[],"level":"3","normative":true,"shortname":"css-align","spec":"css-align-3","status":"current","text":"align-self","type":"property","url":"https://drafts.csswg.org/css-align-3/#propdef-align-self"},
"https://drafts.csswg.org/css-align-3/#propdef-justify-content": {"export":true,"for_":[],"level":"3","normative":true,"shortname":"css-align","spec":"css-align-3","status":"current","text":"justify-content","type":"property","url":"https://drafts.csswg.org/css-align-3/#propdef-justify-content"},
"https://drafts.csswg.org/css-align-3/#typedef-baseline-position": {"export":true,"for_":[],"level":"3","normative":true,"shortname":"css-align","spec":"css-align-3","status":"current","text":"<baseline-position>","type":"type","url":"https://drafts.csswg.org/css-align-3/#typedef-baseline-position"},
"https://drafts.csswg.org/css-align-3/#typedef-content-distribution": {"export":true,"for_":[],"level":"3","normative":true,"shortname":"css-align","spec":"css-align-3","status":"current","text":"<content-distribution>","type":"type","url":"https://drafts.csswg.org/css-align-3/#typedef-content-distribution"},
"https://drafts.csswg.org/css-align-3/#typedef-content-position": {"export":true,"for_":[],"level":"3","normative":true,"shortname":"css-align","spec":"css-align-3","status":"current","text":"<content-position>","type":"type","url":"https://drafts.csswg.org/css-align-3/#typedef-content-position"},
"https://drafts.csswg.org/css-align-3/#typedef-overflow-position": {"export":true,"for_":[],"level":"3","normative":true,"shortname":"css-align","spec":"css-align-3","status":"current","text":"<overflow-position>","type":"type","url":"https://drafts.csswg.org/css-align-3/#typedef-overflow-position"},
"https://drafts.csswg.org/css-align-3/#valdef-align-content-stretch": {"export":true,"for_":["align-content","justify-content","<content-distribution>"],"level":"3","normative":true,"shortname":"css-align","spec":"css-align-3","status":"current","text":"stretch","type":"value","url":"https://drafts.csswg.org/css-align-3/#valdef-align-content-stretch"},
"https://drafts.csswg.org/css-align-3/#valdef-align-self-normal": {"export":true,"for_":["align-self"],"level":"3","normative":true,"shortname":"css-align","spec":"css-align-3","status":"current","text":"normal","type":"value","url":"https://drafts.csswg.org/css-align-3/#valdef-align-self-normal"},
"https://drafts.csswg.org/css-align-3/#valdef-align-self-stretch": {"export":true,"for_":["align-self"],"level":"3","normative":true,"shortname":"css-align","spec":"css-align-3","status":"current","text":"stretch","type":"value","url":"https://drafts.csswg.org/css-align-3/#valdef-align-self-stretch"},
"https://drafts.csswg.org/css-align-3/#valdef-justify-content-normal": {"export":true,"for_":["justify-content","align-content"],"level":"3","normative":true,"shortname":"css-align","spec":"css-align-3","status":"current","text":"normal","type":"value","url":"https://drafts.csswg.org/css-align-3/#valdef-justify-content-normal"},
"https://drafts.csswg.org/css-align-3/#valdef-self-position-center": {"export":true,"for_":["<self-position>","<content-position>","justify-self","align-self","justify-content","align-content"],"level":"3","normative":true,"shortname":"css-align","spec":"css-align-3","status":"current","text":"center","type":"value","url":"https://drafts.csswg.org/css-align-3/#valdef-self-position-center"},
"https://drafts.csswg.org/css-align-3/#valdef-self-position-end": {"export":true,"for_":["<self-position>","<content-position>","justify-self","align-self","justify-content","align-content"],"level":"3","normative":true,"shortname":"css-align","spec":"css-align-3","status":"current","text":"end","type":"value","url":"https://drafts.csswg.org/css-align-3/#valdef-self-position-end"},
"https://drafts.csswg.org/css-align-3/#valdef-self-position-start": {"export":true,"for_":["<self-position>","<content-position>","justify-self","align-self","justify-content","align-content"],"level":"3","normative":true,"shortname":"css-align","spec":"css-align-3","status":"current","text":"start","type":"value","url":"https://drafts.csswg.org/css-align-3/#valdef-self-position-start"},
"https://drafts.csswg.org/css-box-4/#propdef-margin-top": {"export":true,"for_":[],"level":"4","normative":true,"shortname":"css-box","spec":"css-box-4","status":"current","text":"margin-top","type":"property","url":"https://drafts.csswg.org/css-box-4/#propdef-margin-top"},
"https://drafts.csswg.org/css-break-4/#forced-break": {"export":true,"for_":[],"level":"4","normative":true,"shortname":"css-break","spec":"css-break-4","status":"current","text":"forced break","type":"dfn","url":"https://drafts.csswg.org/css-break-4/#forced-break"},
"https://drafts.csswg.org/css-break-4/#fragmentainer": {"export":true,"for_":[],"level":"4","normative":true,"shortname":"css-break","spec":"css-break-4","status":"current","text":"fragmentainer","type":"dfn","url":"https://drafts.csswg.org/css-break-4/#fragmentainer"},
"https://drafts.csswg.org/css-display-4/#blockify": {"export":true,"for_":[],"level":"4","normative":true,"shortname":"css-display","spec":"css-display-4","status":"current","text":"blockify","type":"dfn","url":"https://drafts.csswg.org/css-display-4/#blockify"},
"https://drafts.csswg.org/css-display-4/#containing-block": {"export":true,"for_":[],"level":"4","normative":true,"shortname":"css-display","spec":"css-display-4","status":"current","text":"containing block","type":"dfn","url":"https://drafts.csswg.org/css-display-4/#containing-block"},
"https://drafts.csswg.org/css-grid-2/#grid-area": {"export":true,"for_":[],"level":"2","normative":true,"shortname":"css-grid","spec":"css-grid-2","status":"current","text":"grid area","type":"dfn","url":"https://drafts.csswg.org/css-grid-2/#grid-area"},
"https://drafts.csswg.org/css-grid-2/#grid-container": {"export":true,"for_":[],"level":"2","normative":true,"shortname":"css-grid","spec":"css-grid-2","status":"current","text":"grid container","type":"dfn","url":"https://drafts.csswg.org/css-grid-2/#grid-container"},
"https://drafts.csswg.org/css-grid-2/#grid-item": {"export":true,"for_":[],"level":"2","normative":true,"shortname":"css-grid","spec":"css-grid-2","status":"current","text":"grid item","type":"dfn","url":"https://drafts.csswg.org/css-grid-2/#grid-item"},
"https://drafts.csswg.org/css-grid-2/#grid-position": {"export":true,"for_":[],"level":"2","normative":true,"shortname":"css-grid","spec":"css-grid-2","status":"current","text":"grid position","type":"dfn","url":"https://drafts.csswg.org/css-grid-2/#grid-position"},
"https://drafts.csswg.org/css-grid-2/#implicit-grid": {"export":true,"for_":[],"level":"2","normative":true,"shortname":"css-grid","spec":"css-grid-2","status":"current","text":"implicit grid","type":"dfn","url":"https://drafts.csswg.org/css-grid-2/#implicit-grid"},
"https://drafts.csswg.org/css-grid-2/#propdef-grid": {"export":true,"for_":[],"level":"2","normative":true,"shortname":"css-grid","spec":"css-grid-2","status":"current","text":"grid","type":"property","url":"https://drafts.csswg.org/css-grid-2/#propdef-grid"},
"https://drafts.csswg.org/css-grid-2/#propdef-grid-column": {"export":true,"for_":[],"level":"2","normative":true,"shortname":"css-grid","spec":"css-grid-2","status":"current","text":"grid-column","type":"property","url":"https://drafts.csswg.org/css-grid-2/#propdef-grid-column"},
"https://drafts.csswg.org/css-grid-2/#propdef-grid-row": {"export":true,"for_":[],"level":"2","normative":true,"shortname":"css-grid","spec":"css-grid-2","status":"current","text":"grid-row","type":"property","url":"https://drafts.csswg.org/css-grid-2/#propdef-grid-row"},
"https://drafts.csswg.org/css-grid-2/#propdef-grid-template": {"export":true,"for_":[],"level":"2","normative":true,"shortname":"css-grid","spec":"css-grid-2","status":"current","text":"grid-template","type":"property","url":"https://drafts.csswg.org/css-grid-2/#propdef-grid-template"},
"https://drafts.csswg.org/css-grid-2/#propdef-grid-template-columns": {"export":true,"for_":[],"level":"2","normative":true,"shortname":"css-grid","spec":"css-grid-2","status":"current","text":"grid-template-columns","type":"property","url":"https://drafts.csswg.org/css-grid-2/#propdef-grid-template-columns"},
"https://drafts.csswg.org/css-grid-2/#propdef-grid-template-rows": {"export":true,"for_":[],"level":"2","normative":true,"shortname":"css-grid","spec":"css-grid-2","status":"current","text":"grid-template-rows","type":"property","url":"https://drafts.csswg.org/css-grid-2/#propdef-grid-template-rows"},
"https://drafts.csswg.org/css-grid-2/#subgrid": {"export":true,"for_":[],"level":"2","normative":true,"shortname":"css-grid","spec":"css-grid-2","status":"current","text":"subgrid","type":"dfn","url":"https://drafts.csswg.org/css-grid-2/#subgrid"},
"https://drafts.csswg.org/css-grid-2/#valdef-grid-auto-flow-dense": {"export":true,"for_":["grid-auto-flow"],"level":"2","normative":true,"shortname":"css-grid","spec":"css-grid-2","status":"current","text":"dense","type":"value","url":"https://drafts.csswg.org/css-grid-2/#valdef-grid-auto-flow-dense"},
"https://drafts.csswg.org/css-grid-2/#valdef-grid-template-rows-none": {"export":true,"for_":["grid-template-rows","grid-template-columns"],"level":"2","normative":true,"shortname":"css-grid","spec":"css-grid-2","status":"current","text":"none","type":"value","url":"https://drafts.csswg.org/css-grid-2/#valdef-grid-template-rows-none"},
"https://drafts.csswg.org/css-logical-1/#propdef-margin-block": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"css-logical","spec":"css-logical-1","status":"current","text":"margin-block","type":"property","url":"https://drafts.csswg.org/css-logical-1/#propdef-margin-block"},
"https://drafts.csswg.org/css-sizing-3/#definite": {"export":true,"for_":[],"level":"3","normative":true,"shortname":"css-sizing","spec":"css-sizing-3","status":"current","text":"definite size","type":"dfn","url":"https://drafts.csswg.org/css-sizing-3/#definite"},
"https://drafts.csswg.org/css-sizing-3/#indefinite": {"export":true,"for_":[],"level":"3","normative":true,"shortname":"css-sizing","spec":"css-sizing-3","status":"current","text":"indefinite size","type":"dfn","url":"https://drafts.csswg.org/css-sizing-3/#indefinite"},
"https://drafts.csswg.org/css-sizing-3/#max-content": {"export":true,"for_":[],"level":"3","normative":true,"shortname":"css-sizing","spec":"css-sizing-3","status":"current","text":"max-content size","type":"dfn","url":"https://drafts.csswg.org/css-sizing-3/#max-content"},
"https://drafts.csswg.org/css-sizing-3/#max-content-constraint": {"export":true,"for_":[],"level":"3","normative":true,"shortname":"css-sizing","spec":"css-sizing-3","status":"current","text":"max-content constraint","type":"dfn","url":"https://drafts.csswg.org/css-sizing-3/#max-content-constraint"},
"https://drafts.csswg.org/css-sizing-3/#max-width": {"export":true,"for_":[],"level":"3","normative":true,"shortname":"css-sizing","spec":"css-sizing-3","status":"current","text":"max size","type":"dfn","url":"https://drafts.csswg.org/css-sizing-3/#max-width"},
"https://drafts.csswg.org/css-sizing-3/#min-content": {"export":true,"for_":[],"level":"3","normative":true,"shortname":"css-sizing","spec":"css-sizing-3","status":"current","text":"min-content size","type":"dfn","url":"https://drafts.csswg.org/css-sizing-3/#min-content"},
"https://drafts.csswg.org/css-sizing-3/#min-content-constraint": {"export":true,"for_":[],"level":"3","normative":true,"shortname":"css-sizing","spec":"css-sizing-3","status":"current","text":"min-content constraint","type":"dfn","url":"https://drafts.csswg.org/css-sizing-3/#min-content-constraint"},
"https://drafts.csswg.org/css-sizing-3/#propdef-max-height": {"export":true,"for_":[],"level":"3","normative":true,"shortname":"css-sizing","spec":"css-sizing-3","status":"current","text":"max-height","type":"property","url":"https://drafts.csswg.org/css-sizing-3/#propdef-max-height"},
"https://drafts.csswg.org/css-sizing-3/#valdef-width-auto": {"export":true,"for_":["width","height","min-width","min-height"],"level":"3","normative":true,"shortname":"css-sizing","spec":"css-sizing-3","status":"current","text":"auto","type":"value","url":"https://drafts.csswg.org/css-sizing-3/#valdef-width-auto"},
"https://drafts.csswg.org/css-values-4/#comb-any": {"export":true,"for_":[],"level":"4","normative":true,"shortname":"css-values","spec":"css-values-4","status":"current","text":"||","type":"grammar","url":"https://drafts.csswg.org/css-values-4/#comb-any"},
"https://drafts.csswg.org/css-values-4/#comb-one": {"export":true,"for_":[],"level":"4","normative":true,"shortname":"css-values","spec":"css-values-4","status":"current","text":"|","type":"grammar","url":"https://drafts.csswg.org/css-values-4/#comb-one"},
"https://drafts.csswg.org/css-values-4/#css-wide-keywords": {"export":true,"for_":[],"level":"4","normative":true,"shortname":"css-values","spec":"css-values-4","status":"current","text":"css-wide keywords","type":"dfn","url":"https://drafts.csswg.org/css-values-4/#css-wide-keywords"},
"https://drafts.csswg.org/css-values-4/#mult-comma": {"export":true,"for_":[],"level":"4","normative":true,"shortname":"css-values","spec":"css-values-4","status":"current","text":"#","type":"grammar","url":"https://drafts.csswg.org/css-values-4/#mult-comma"},
"https://drafts.csswg.org/css-values-4/#mult-opt": {"export":true,"for_":[],"level":"4","normative":true,"shortname":"css-values","spec":"css-values-4","status":"current","text":"?","type":"grammar","url":"https://drafts.csswg.org/css-values-4/#mult-opt"},
"https://drafts.csswg.org/css-writing-modes-3/#propdef-direction": {"export":true,"for_":[],"level":"3","normative":true,"shortname":"css-writing-modes","spec":"css-writing-modes-3","status":"current","text":"direction","type":"property","url":"https://drafts.csswg.org/css-writing-modes-3/#propdef-direction"},
};

function mkRefHint(link, ref) {
    const linkText = link.textContent;
    let dfnTextElements = '';
    if (ref.text != linkText) {
        dfnTextElements =
            mk.li({},
                mk.b({}, "Term: "),
                mk.span({}, ref.text)
            );
    }
    const forList = ref.for_;
    let forListElements;
    if(forList.length == 0) {
        forListElements = [];
    } else if(forList.length == 1) {
        forListElements = mk.li({},
            mk.b({}, "For: "),
            mk.span({}, forList[0]),
        );
    } else {
        forListElements = mk.li({},
            mk.b({}, "For: "),
            mk.ul({},
                ...forList.map(forItem =>
                    mk.li({},
                        mk.span({}, forItem)
                    ),
                ),
            ),
        );
    }
    const url = ref.url;
    const safeUrl = encodeURIComponent(url);
    const hintPanel = mk.aside({
        class: "ref-hint",
        id: `ref-hint-for-${safeUrl}`,
        "data-for": url,
        "aria-labelled-by": `ref-hint-for-${safeUrl}`,
    },
        mk.ul({},
            dfnTextElements,
            mk.li({},
                mk.b({}, "URL: "),
                mk.a({ href: url, class: "ref" }, url),
            ),
            mk.li({},
                mk.b({}, "Type: "),
                mk.span({}, `${ref.type}`),
            ),
            mk.li({},
                mk.b({}, "Spec: "),
                mk.span({}, `${ref.spec ? ref.spec : ''}`),
            ),
            forListElements
        ),
    );
    hintPanel.forLink = link;
    setupRefHintEventListeners(link, hintPanel);
    return hintPanel;
}

function hideAllRefHints() {
    queryAll(".ref-hint").forEach(el=>hideRefHint(el));
}

function hideRefHint(refHint) {
    const link = refHint.forLink;
    link.setAttribute("aria-expanded", "false");
    if(refHint.teardownEventListeners) {
        refHint.teardownEventListeners();
    }
    refHint.remove();
}

function showRefHint(link) {
    if(link.classList.contains("dfn-link")) return;
    const url = link.getAttribute("href");
    const ref = refsData[url];
    if(!ref) return;

    hideAllRefHints(); // Only display one at this time.

    const refHint = mkRefHint(link, ref);
    append(document.body, refHint);
    link.setAttribute("aria-expanded", "true");
    positionRefHint(refHint);
}

function setupRefHintEventListeners(link, refHint) {
    if (refHint.teardownEventListeners) return;
    // Add event handlers to hide the refHint after the user moves away
    // from both the link and refHint, if not hovering either within one second.
    let timeout = null;
    const startHidingRefHint = (event) => {
        if (timeout) {
            clearTimeout(timeout);
        }
        timeout = setTimeout(() => {
            hideRefHint(refHint);
        }, 1000);
    }
    const resetHidingRefHint = (event) => {
        if (timeout) clearTimeout(timeout);
        timeout = null;
    };
    link.addEventListener("mouseleave", startHidingRefHint);
    link.addEventListener("mouseenter", resetHidingRefHint);
    link.addEventListener("blur", startHidingRefHint);
    link.addEventListener("focus", resetHidingRefHint);
    refHint.addEventListener("mouseleave", startHidingRefHint);
    refHint.addEventListener("mouseenter", resetHidingRefHint);
    refHint.addEventListener("blur", startHidingRefHint);
    refHint.addEventListener("focus", resetHidingRefHint);

    refHint.teardownEventListeners = () => {
        // remove event listeners
        resetHidingRefHint();
        link.removeEventListener("mouseleave", startHidingRefHint);
        link.removeEventListener("mouseenter", resetHidingRefHint);
        link.removeEventListener("blur", startHidingRefHint);
        link.removeEventListener("focus", resetHidingRefHint);
        refHint.removeEventListener("mouseleave", startHidingRefHint);
        refHint.removeEventListener("mouseenter", resetHidingRefHint);
        refHint.removeEventListener("blur", startHidingRefHint);
        refHint.removeEventListener("focus", resetHidingRefHint);
    };
}

function positionRefHint(refHint) {
    const link = refHint.forLink;
    const linkPos = getBounds(link);
    refHint.style.top = linkPos.bottom + "px";
    refHint.style.left = linkPos.left + "px";

    const panelPos = refHint.getBoundingClientRect();
    const panelMargin = 8;
    const maxRight = document.body.parentNode.clientWidth - panelMargin;
    if (panelPos.right > maxRight) {
        const overflowAmount = panelPos.right - maxRight;
        const newLeft = Math.max(panelMargin, linkPos.left - overflowAmount);
        refHint.style.left = newLeft + "px";
    }
}

// TODO: shared util
// Returns the root-level absolute position {left and top} of element.
function getBounds(el, relativeTo=document.body) {
    const relativeRect = relativeTo.getBoundingClientRect();
    const elRect = el.getBoundingClientRect();
    const top = elRect.top - relativeRect.top;
    const left = elRect.left - relativeRect.left;
    return {
        top,
        left,
        bottom: top + elRect.height,
        right: left + elRect.width,
    }
}

function showRefHintListener(e) {
    // If the target isn't in a link (or is a link),
    // just ignore it.
    let link = e.target.closest("a");
    if(!link) return;

    // If the target is in a ref-hint panel
    // (aka a link in the already-open one),
    // also just ignore it.
    if(link.closest(".ref-hint")) return;

    // Otherwise, show the panel for the link.
    showRefHint(link);
}

function hideAllHintsListener(e) {
    // If the click is inside a ref-hint panel, ignore it.
    if(e.target.closest(".ref-hint")) return;
    // Otherwise, close all the current panels.
    hideAllRefHints();
}

document.addEventListener("DOMContentLoaded", () => {
    document.body.addEventListener("mousedown", showRefHintListener);
    document.body.addEventListener("focus", showRefHintListener);

    document.body.addEventListener("click", hideAllHintsListener);
});

window.addEventListener("resize", () => {
    // Hide any open ref hint.
    hideAllRefHints();
});
}
</script>