<!doctype html><html lang="en">
 <head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
  <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
  <title>CSS Exclusions Module Level 1</title>
  <meta content="ED" name="w3c-status">
  <link href="https://www.w3.org/StyleSheets/TR/2021/W3C-ED" rel="stylesheet">
  <link href="https://www.w3.org/TR/css3-exclusions/" rel="canonical">
  <link href="https://drafts.csswg.org/csslogo.ico" rel="icon">
  <meta content="dark light" name="color-scheme">
  <link href="https://www.w3.org/StyleSheets/TR/2021/dark.css" media="(prefers-color-scheme: dark)" rel="stylesheet" type="text/css">
<style type="text/css">
  .singleImgExample {
    display: block;
    margin: auto;
  }

  .example-table {
    table-layout: fixed;
    width: 100%;
  }

  .example-table tr td img {
    width: 90%;
  }
</style>
<style>/* Boilerplate: style-autolinks */
.css.css, .property.property, .descriptor.descriptor {
    color: var(--a-normal-text);
    font-size: inherit;
    font-family: inherit;
}
.css::before, .property::before, .descriptor::before {
    content: "‘";
}
.css::after, .property::after, .descriptor::after {
    content: "’";
}
.property, .descriptor {
    /* Don't wrap property and descriptor names */
    white-space: nowrap;
}
.type { /* CSS value <type> */
    font-style: italic;
}
pre .property::before, pre .property::after {
    content: "";
}
[data-link-type="property"]::before,
[data-link-type="propdesc"]::before,
[data-link-type="descriptor"]::before,
[data-link-type="value"]::before,
[data-link-type="function"]::before,
[data-link-type="at-rule"]::before,
[data-link-type="selector"]::before,
[data-link-type="maybe"]::before {
    content: "‘";
}
[data-link-type="property"]::after,
[data-link-type="propdesc"]::after,
[data-link-type="descriptor"]::after,
[data-link-type="value"]::after,
[data-link-type="function"]::after,
[data-link-type="at-rule"]::after,
[data-link-type="selector"]::after,
[data-link-type="maybe"]::after {
    content: "’";
}

[data-link-type].production::before,
[data-link-type].production::after,
.prod [data-link-type]::before,
.prod [data-link-type]::after {
    content: "";
}

[data-link-type=element],
[data-link-type=element-attr] {
    font-family: Menlo, Consolas, "DejaVu Sans Mono", monospace;
    font-size: .9em;
}
[data-link-type=element]::before { content: "<" }
[data-link-type=element]::after  { content: ">" }

[data-link-type=biblio] {
    white-space: pre;
}

@media (prefers-color-scheme: dark) {
    :root {
        --selflink-text: black;
        --selflink-bg: silver;
        --selflink-hover-text: white;
    }
}
</style>
<style>/* Boilerplate: style-colors */
/* Any --*-text not paired with a --*-bg is assumed to have a transparent bg */
:root {
    color-scheme: light dark;

    --text: black;
    --bg: white;

    --unofficial-watermark: url(https://www.w3.org/StyleSheets/TR/2016/logos/UD-watermark);

    --logo-bg: #1a5e9a;
    --logo-active-bg: #c00;
    --logo-text: white;

    --tocnav-normal-text: #707070;
    --tocnav-normal-bg: var(--bg);
    --tocnav-hover-text: var(--tocnav-normal-text);
    --tocnav-hover-bg: #f8f8f8;
    --tocnav-active-text: #c00;
    --tocnav-active-bg: var(--tocnav-normal-bg);

    --tocsidebar-text: var(--text);
    --tocsidebar-bg: #f7f8f9;
    --tocsidebar-shadow: rgba(0,0,0,.1);
    --tocsidebar-heading-text: hsla(203,20%,40%,.7);

    --toclink-text: var(--text);
    --toclink-underline: #3980b5;
    --toclink-visited-text: var(--toclink-text);
    --toclink-visited-underline: #054572;

    --heading-text: #005a9c;

    --hr-text: var(--text);

    --algo-border: #def;

    --del-text: red;
    --del-bg: transparent;
    --ins-text: #080;
    --ins-bg: transparent;

    --a-normal-text: #034575;
    --a-normal-underline: #bbb;
    --a-visited-text: var(--a-normal-text);
    --a-visited-underline: #707070;
    --a-hover-bg: rgba(75%, 75%, 75%, .25);
    --a-active-text: #c00;
    --a-active-underline: #c00;

    --blockquote-border: silver;
    --blockquote-bg: transparent;
    --blockquote-text: currentcolor;

    --issue-border: #e05252;
    --issue-bg: #fbe9e9;
    --issue-text: var(--text);
    --issueheading-text: #831616;

    --example-border: #e0cb52;
    --example-bg: #fcfaee;
    --example-text: var(--text);
    --exampleheading-text: #574b0f;

    --note-border: #52e052;
    --note-bg: #e9fbe9;
    --note-text: var(--text);
    --noteheading-text: hsl(120, 70%, 30%);
    --notesummary-underline: silver;

    --assertion-border: #aaa;
    --assertion-bg: #eee;
    --assertion-text: black;

    --advisement-border: orange;
    --advisement-bg: #fec;
    --advisement-text: var(--text);
    --advisementheading-text: #b35f00;

    --warning-border: red;
    --warning-bg: hsla(40,100%,50%,0.95);
    --warning-text: var(--text);

    --amendment-border: #330099;
    --amendment-bg: #F5F0FF;
    --amendment-text: var(--text);
    --amendmentheading-text: #220066;

    --def-border: #8ccbf2;
    --def-bg: #def;
    --def-text: var(--text);
    --defrow-border: #bbd7e9;

    --datacell-border: silver;

    --indexinfo-text: #707070;

    --indextable-hover-text: black;
    --indextable-hover-bg: #f7f8f9;

    --outdatedspec-bg: rgba(0, 0, 0, .5);
    --outdatedspec-text: black;
    --outdated-bg: maroon;
    --outdated-text: white;
    --outdated-shadow: red;

    --editedrec-bg: darkorange;
}

@media (prefers-color-scheme: dark) {
    :root {
        --text: #ddd;
        --bg: black;

        --unofficial-watermark: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='400'%3E%3Cg fill='%23100808' transform='translate(200 200) rotate(-45) translate(-200 -200)' stroke='%23100808' stroke-width='3'%3E%3Ctext x='50%25' y='220' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EUNOFFICIAL%3C/text%3E%3Ctext x='50%25' y='305' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EDRAFT%3C/text%3E%3C/g%3E%3C/svg%3E");

        --logo-bg: #1a5e9a;
        --logo-active-bg: #c00;
        --logo-text: white;

        --tocnav-normal-text: #999;
        --tocnav-normal-bg: var(--bg);
        --tocnav-hover-text: var(--tocnav-normal-text);
        --tocnav-hover-bg: #080808;
        --tocnav-active-text: #f44;
        --tocnav-active-bg: var(--tocnav-normal-bg);

        --tocsidebar-text: var(--text);
        --tocsidebar-bg: #080808;
        --tocsidebar-shadow: rgba(255,255,255,.1);
        --tocsidebar-heading-text: hsla(203,20%,40%,.7);

        --toclink-text: var(--text);
        --toclink-underline: #6af;
        --toclink-visited-text: var(--toclink-text);
        --toclink-visited-underline: #054572;

        --heading-text: #8af;

        --hr-text: var(--text);

        --algo-border: #456;

        --del-text: #f44;
        --del-bg: transparent;
        --ins-text: #4a4;
        --ins-bg: transparent;

        --a-normal-text: #6af;
        --a-normal-underline: #555;
        --a-visited-text: var(--a-normal-text);
        --a-visited-underline: var(--a-normal-underline);
        --a-hover-bg: rgba(25%, 25%, 25%, .2);
        --a-active-text: #f44;
        --a-active-underline: var(--a-active-text);

        --borderedblock-bg: rgba(255, 255, 255, .05);

        --blockquote-border: silver;
        --blockquote-bg: var(--borderedblock-bg);
        --blockquote-text: currentcolor;

        --issue-border: #e05252;
        --issue-bg: var(--borderedblock-bg);
        --issue-text: var(--text);
        --issueheading-text: hsl(0deg, 70%, 70%);

        --example-border: hsl(50deg, 90%, 60%);
        --example-bg: var(--borderedblock-bg);
        --example-text: var(--text);
        --exampleheading-text: hsl(50deg, 70%, 70%);

        --note-border: hsl(120deg, 100%, 35%);
        --note-bg: var(--borderedblock-bg);
        --note-text: var(--text);
        --noteheading-text: hsl(120, 70%, 70%);
        --notesummary-underline: silver;

        --assertion-border: #444;
        --assertion-bg: var(--borderedblock-bg);
        --assertion-text: var(--text);

        --advisement-border: orange;
        --advisement-bg: #222218;
        --advisement-text: var(--text);
        --advisementheading-text: #f84;

        --warning-border: red;
        --warning-bg: hsla(40,100%,20%,0.95);
        --warning-text: var(--text);

        --amendment-border: #330099;
        --amendment-bg: #080010;
        --amendment-text: var(--text);
        --amendmentheading-text: #cc00ff;

        --def-border: #8ccbf2;
        --def-bg: #080818;
        --def-text: var(--text);
        --defrow-border: #136;

        --datacell-border: silver;

        --indexinfo-text: #aaa;

        --indextable-hover-text: var(--text);
        --indextable-hover-bg: #181818;

        --outdatedspec-bg: rgba(255, 255, 255, .5);
        --outdatedspec-text: black;
        --outdated-bg: maroon;
        --outdated-text: white;
        --outdated-shadow: red;

        --editedrec-bg: darkorange;
    }
    /* In case a transparent-bg image doesn't expect to be on a dark bg,
       which is quite common in practice... */
    img { background: white; }
}
</style>
<style>/* Boilerplate: style-counters */
body {
    counter-reset: example figure issue;
}
.issue {
    counter-increment: issue;
}
.issue:not(.no-marker)::before {
    content: "Issue " counter(issue);
}

.example {
    counter-increment: example;
}
.example:not(.no-marker)::before {
    content: "Example " counter(example);
}
.invalid.example:not(.no-marker)::before,
.illegal.example:not(.no-marker)::before {
    content: "Invalid Example" counter(example);
}

figcaption {
    counter-increment: figure;
}
figcaption:not(.no-marker)::before {
    content: "Figure " counter(figure) " ";
}
</style>
<style>/* Boilerplate: style-dfn-panel */
:root {
    --dfnpanel-bg: #ddd;
    --dfnpanel-text: var(--text);
    --dfnpanel-target-bg: #ffc;
    --dfnpanel-target-outline: orange;
}
@media (prefers-color-scheme: dark) {
    :root {
        --dfnpanel-bg: #222;
        --dfnpanel-text: var(--text);
        --dfnpanel-target-bg: #333;
        --dfnpanel-target-outline: silver;
    }
}
.dfn-panel {
    position: absolute;
    z-index: 35;
    width: 20em;
    width: 300px;
    height: auto;
    max-height: 500px;
    overflow: auto;
    padding: 0.5em 0.75em;
    font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
    background: var(--dfnpanel-bg);
    color: var(--dfnpanel-text);
    border: outset 0.2em;
    white-space: normal; /* in case it's moved into a pre */
}
.dfn-panel:not(.on) { display: none; }
.dfn-panel * { margin: 0; padding: 0; text-indent: 0; }
.dfn-panel > b { display: block; }
.dfn-panel a { color: var(--dfnpanel-text); }
.dfn-panel a:not(:hover) { text-decoration: none !important; border-bottom: none !important; }
.dfn-panel a:focus {
    outline: 5px auto Highlight;
    outline: 5px auto -webkit-focus-ring-color;
}
.dfn-panel > b + b { margin-top: 0.25em; }
.dfn-panel ul { padding: 0 0 0 1em; list-style: none; }
.dfn-panel li a {
    max-width: calc(300px - 1.5em - 1em);
    overflow: hidden;
    text-overflow: ellipsis;
}

.dfn-panel.activated {
    display: inline-block;
    position: fixed;
    left: 8px;
    bottom: 2em;
    margin: 0 auto;
    max-width: calc(100vw - 1.5em - .4em - .5em);
    max-height: 30vh;
    transition: left 1s ease-out, bottom 1s ease-out;
}

.dfn-panel .link-item:hover {
    text-decoration: underline;
}
.dfn-panel .link-item .copy-icon {
    opacity: 0;
}
.dfn-panel .link-item:hover .copy-icon,
.dfn-panel .link-item .copy-icon:focus {
    opacity: 1;
}

.dfn-panel .copy-icon {
    display: inline-block;
    margin-right: 0.5em;
    width: 0.85em;
    height: 1em;
    border-radius: 3px;
    background-color: #ccc;
    cursor: pointer;
}

.dfn-panel .copy-icon .icon {
    width: 100%;
    height: 100%;
    background-color: #fff;
    display: flex;
    justify-content: center;
    align-items: center;
    position: relative;
}

.dfn-panel .copy-icon .icon::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    border: 1px solid black;
    background-color: #ccc;
    opacity: 0.25;
    transform: translate(3px, -3px);
}

.dfn-panel .copy-icon:active .icon::before {
    opacity: 1;
}

.dfn-paneled[role="button"] { cursor: help; }

.highlighted {
    animation: target-fade 3s;
}

@keyframes target-fade {
    from {
        background-color: var(--dfnpanel-target-bg);
        outline: 5px solid var(--dfnpanel-target-outline);
    }
    to {
        color: var(--a-normal-text);
        background-color: transparent;
        outline: transparent;
    }
}
</style>
<style>/* Boilerplate: style-issues */
a[href].issue-return {
    float: right;
    float: inline-end;
    color: var(--issueheading-text);
    font-weight: bold;
    text-decoration: none;
}
</style>
<style>/* Boilerplate: style-md-lists */
/* This is a weird hack for me not yet following the commonmark spec
   regarding paragraph and lists. */
[data-md] > :first-child {
    margin-top: 0;
}
[data-md] > :last-child {
    margin-bottom: 0;
}
</style>
<style>/* Boilerplate: style-ref-hints */
:root {
    --ref-hint-bg: #ddd;
    --ref-hint-text: var(--text);
}
@media (prefers-color-scheme: dark) {
    :root {
        --ref-hint-bg: #222;
        --ref-hint-text: var(--text);
    }
}

.ref-hint {
    display: inline-block;
    position: absolute;
    z-index: 35;
    width: 20em;
    width: 300px;
    height: auto;
    max-height: 500px;
    overflow: auto;
    padding: 0.5em 0.5em;
    font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
    background: var(--ref-hint-bg);
    color: var(--ref-hint-text);
    border: outset 0.2em;
    white-space: normal; /* in case it's moved into a pre */
}

.ref-hint * { margin: 0; padding: 0; text-indent: 0; }

.ref-hint ul { padding: 0 0 0 1em; list-style: none; }
</style>
<style>/* Boilerplate: style-selflinks */
:root {
    --selflink-text: white;
    --selflink-bg: gray;
    --selflink-hover-text: black;
}
.heading, .issue, .note, .example, li, dt {
    position: relative;
}
a.self-link {
    position: absolute;
    top: 0;
    left: calc(-1 * (3.5rem - 26px));
    width: calc(3.5rem - 26px);
    height: 2em;
    text-align: center;
    border: none;
    transition: opacity .2s;
    opacity: .5;
}
a.self-link:hover {
    opacity: 1;
}
.heading > a.self-link {
    font-size: 83%;
}
.example > a.self-link,
.note > a.self-link,
.issue > a.self-link {
    /* These blocks are overflow:auto, so positioning outside
       doesn't work. */
    left: auto;
    right: 0;
}
li > a.self-link {
    left: calc(-1 * (3.5rem - 26px) - 2em);
}
dfn > a.self-link {
    top: auto;
    left: auto;
    opacity: 0;
    width: 1.5em;
    height: 1.5em;
    background: var(--selflink-bg);
    color: var(--selflink-text);
    font-style: normal;
    transition: opacity .2s, background-color .2s, color .2s;
}
dfn:hover > a.self-link {
    opacity: 1;
}
dfn > a.self-link:hover {
    color: var(--selflink-hover-text);
}

a.self-link::before            { content: "¶"; }
.heading > a.self-link::before { content: "§"; }
dfn > a.self-link::before      { content: "#"; }
</style>
<style>/* Boilerplate: style-wpt */
:root {
    --wpt-border: hsl(0, 0%, 60%);
    --wpt-bg: hsl(0, 0%, 95%);
    --wpt-text: var(--text);
    --wptheading-text: hsl(0, 0%, 30%);
}
@media (prefers-color-scheme: dark) {
    :root {
        --wpt-border: hsl(0, 0%, 30%);
        --wpt-bg: var(--borderedblock-bg);
        --wpt-text: var(--text);
        --wptheading-text: hsl(0, 0%, 60%);
    }
}
.wpt-tests-block {
    list-style: none;
    border-left: .5em solid var(--wpt-border);
    background: var(--wpt-bg);
    color: var(--wpt-text);
    margin: 1em auto;
    padding: .5em;
}
.wpt-tests-block summary {
    color: var(--wptheading-text);
    font-weight: normal;
    text-transform: uppercase;
}
.wpt-tests-block summary::marker{
    color: var(--wpt-border);
}
.wpt-tests-block summary:hover::marker{
    color: var(--wpt-text);
}
/*
   The only content  of a wpt test block in its closed state is the <summary>,
   which contains the word TESTS,
   and that is absolutely positioned.
   In that closed state, wpt test blocks are styled
   to have a top margin whose height is exactly equal
   to the height of the absolutely positioned <summary>,
   and no other background/padding/margin/border.
   The wpt test block elements will therefore allow the maring
   of the previous/next block elements
   to collapse through them;
   if this combined margin would be larger than its own top margin,
   it stays as is,
   and therefore the pre-existing vertical rhythm of the document is undisturbed.
   If that combined margin would be smaller, it is grown to that size.
   This means that the wpt test block ensures
   that there's always enough vertical space to insert the summary,
   without adding more than is needed.
*/
.wpt-tests-block:not([open]){
    padding: 0;
    border: none;
    background: none;
    font-size: 0.75em;
    line-height: 1;
    position: relative;
    margin: 1em 0 0;
}
.wpt-tests-block:not([open]) summary {
    position: absolute;
    right: 0;
    bottom: 0;
}
/*
   It is possible that both the last child of a block element
   and the block element itself
   would be annotated with a <wpt> block each.
   If the block element has a padding or a border,
   that's fine, but otherwise
   the bottom margin of the block and of its last child would collapse
   and both <wpt> elements would overlap, being both placed there.
   To avoid that, add 1px of padding to the <wpt> element annotating the last child
   to prevent the bottom margin of the block and of its last child from collapsing
   (and as much negative margin,
   as wel only want to prevent margin collapsing,
   but are not trying to actually take more space).
*/
.wpt-tests-block:not([open]):last-child {
    padding-bottom: 1px;
    margin-bottom: -1px;
}
/*
   Exception to the previous rule:
   don't do that in non-last list items,
   because it's not necessary,
   and would therefore consume more space than strictly needed.
   Lists must have list items as children, not <wpt> elements,
   so a <wpt> element cannot be a sibling of a list item,
   and the collision that the previous rule avoids cannot happen.
*/
li:not(:last-child) > .wpt-tests-block:not([open]):last-child,
dd:not(:last-child) > .wpt-tests-block:not([open]):last-child {
    padding-bottom: 0;
    margin-bottom: 0;
}
.wpt-tests-block:not([open]):not(:hover){
    opacity: 0.5;
}
.wpt-tests-list {
    list-style: none;
    display: grid;
    margin: 0;
    padding: 0;
    grid-template-columns: 1fr max-content auto auto;
    grid-column-gap: .5em;
}
.wpt-tests-block hr:last-child {
    display: none;
}
.wpt-test {
    display: contents;
}
.wpt-test > a {
    text-decoration: underline;
    border: none;
}
.wpt-test > .wpt-name { grid-column: 1; }
.wpt-test > .wpt-results { grid-column: 2; }
.wpt-test > .wpt-live { grid-column: 3; }
.wpt-test > .wpt-source { grid-column: 4; }

.wpt-test > .wpt-results {
    display: flex;
    gap: .1em;
}
.wpt-test .wpt-result {
    display: inline-block;
    height: 1em;
    width: 1em;
    border-radius: 50%;
    position: relative;
}
</style>
 <body class="h-entry">
  <div class="head">
   <p data-fill-with="logo"><a class="logo" href="https://www.w3.org/"> <img alt="W3C" height="48" src="https://www.w3.org/StyleSheets/TR/2021/logos/W3C" width="72"> </a> </p>
   <h1 class="p-name no-ref" id="title">CSS Exclusions Module Level 1</h1>
   <p id="w3c-state"><a href="https://www.w3.org/standards/types#ED">Editor’s Draft</a>, <time class="dt-updated" datetime="1970-01-01">1 January 1970</time></p>
   <details open>
    <summary>More details about this document</summary>
    <div data-fill-with="spec-metadata">
     <dl>
      <dt>This version:
      <dd><a class="u-url" href="https://drafts.csswg.org/css-exclusions/">https://drafts.csswg.org/css-exclusions/</a>
      <dt>Latest published version:
      <dd><a href="https://www.w3.org/TR/css3-exclusions/">https://www.w3.org/TR/css3-exclusions/</a>
      <dt>Previous Versions:
      <dd><a href="https://www.w3.org/TR/2015/WD-css3-exclusions-20150115/" rel="prev">https://www.w3.org/TR/2015/WD-css3-exclusions-20150115/</a>
      <dd><a href="https://www.w3.org/TR/2013/WD-css3-exclusions-20130528/" rel="prev">https://www.w3.org/TR/2013/WD-css3-exclusions-20130528/</a>
      <dt>Feedback:
      <dd><a href="https://github.com/w3c/csswg-drafts/labels/css-exclusions-1">CSSWG Issues Repository</a>
      <dt class="editor">Editors:
      <dd class="editor p-author h-card vcard" data-editor-id="49885"><a class="p-name fn u-email email" href="mailto:ratan@microsoft.com">Rossen Atanassov</a> (<span class="p-org org">Microsoft</span>)
      <dd class="editor p-author h-card vcard"><a class="p-name fn u-email email" href="mailto:vhardy@adobe.com">Vincent Hardy</a> (<span class="p-org org">Adobe</span>)
      <dd class="editor p-author h-card vcard" data-editor-id="46659"><a class="p-name fn u-email email" href="mailto:astearns@adobe.com">Alan Stearns</a> (<span class="p-org org">Adobe</span>)
      <dt>Suggest an Edit for this Spec:
      <dd><a href="https://github.com/w3c/csswg-drafts/blob/main/css-exclusions-1/Overview.bs">GitHub Editor</a>
      <dt>Issues list:
      <dd><a href="https://www.w3.org/Bugs/Public/buglist.cgi?query_format=advanced&amp;product=CSS&amp;component=Exclusions&amp;resolution=---&amp;cmdtype=doit">in Bugzilla</a>
      <dt>Test Suite:
      <dd><a href="http://test.csswg.org/suites/css3-exclusions/nightly-unstable/">http://test.csswg.org/suites/css3-exclusions/nightly-unstable/</a>
     </dl>
    </div>
   </details>
   <div data-fill-with="warning"></div>
   <p class="copyright" data-fill-with="copyright"><a href="https://www.w3.org/policies/#copyright">Copyright</a> © 1970 <a href="https://www.w3.org/">World Wide Web Consortium</a>. <abbr title="World Wide Web Consortium">W3C</abbr><sup>®</sup> <a href="https://www.w3.org/policies/#Legal_Disclaimer">liability</a>, <a href="https://www.w3.org/policies/#W3C_Trademarks">trademark</a> and <a href="https://www.w3.org/copyright/software-license/" rel="license" title="W3C Software and Document License">permissive document license</a> rules apply. </p>
   <hr title="Separator for header">
  </div>
  <div class="p-summary" data-fill-with="abstract">
   <h2 class="no-num no-toc no-ref heading settled" id="abstract"><span class="content">Abstract</span></h2>
   <p>CSS Exclusions define arbitrary areas around which inline content (<a data-link-type="biblio" href="#biblio-css21" title="Cascading Style Sheets Level 2 Revision 1 (CSS 2.1) Specification">[CSS21]</a>) can flow. CSS Exclusions can be defined on any CSS block-level elements. CSS Exclusions extend the notion of content wrapping previously limited to floats.</p>
    <a href="https://www.w3.org/TR/CSS/">CSS</a> is a language for describing the rendering of structured documents
(such as HTML and XML)
on screen, on paper, etc. 
  </div>
  <h2 class="no-num no-toc no-ref heading settled" id="sotd"><span class="content">Status of this document</span></h2>
  <div data-fill-with="status">
   <p> This is a public copy of the editors’ draft.
	It is provided for discussion only and may change at any moment.
	Its publication here does not imply endorsement of its contents by W3C.
	Don’t cite this document other than as work in progress. </p>
   <p>Please send feedback
	by <a href="https://github.com/w3c/csswg-drafts/issues">filing issues in GitHub</a> (preferred),
	including the spec code “css-exclusions” in the title, like this:
	“[css-exclusions] <i>…summary of comment…</i>”.
	All issues and comments are <a href="https://lists.w3.org/Archives/Public/public-css-archive/">archived</a>.
	Alternately, feedback can be sent to the (<a href="https://lists.w3.org/Archives/Public/www-style/">archived</a>) public mailing list <a href="mailto:www-style@w3.org?Subject=%5Bcss-exclusions%5D%20PUT%20SUBJECT%20HERE">www-style@w3.org</a>. </p>
   <p>This document is governed by the <a href="https://www.w3.org/policies/process/20231103/" id="w3c_process_revision">03 November 2023 W3C Process Document</a>. </p>
   <p></p>
  </div>
  <div data-fill-with="at-risk"></div>
  <nav data-fill-with="table-of-contents" id="toc">
   <h2 class="no-num no-toc no-ref" id="contents">Table of Contents</h2>
   <ol class="toc" role="directory">
    <li>
     <a href="#intro"><span class="secno">1</span> <span class="content"> Introduction</span></a>
     <ol class="toc">
      <li><a href="#values"><span class="secno">1.1</span> <span class="content"> Value Definitions</span></a>
     </ol>
    <li><a href="#terms"><span class="secno">2</span> <span class="content"> Terminology</span></a>
    <li>
     <a href="#exclusions"><span class="secno">3</span> <span class="content"> Exclusions</span></a>
     <ol class="toc">
      <li>
       <a href="#declaring-exclusions"><span class="secno">3.1</span> <span class="content"> Declaring exclusions</span></a>
       <ol class="toc">
        <li><a href="#wrap-flow-property"><span class="secno">3.1.1</span> <span class="content"> The <span class="property">wrap-flow</span> property</span></a>
       </ol>
      <li><a href="#scope-and-effect-of-exclusions"><span class="secno">3.2</span> <span class="content"> Scope and effect of exclusions</span></a>
      <li>
       <a href="#propagation-of-exclusions"><span class="secno">3.3</span> <span class="content"> Propagation of Exclusions</span></a>
       <ol class="toc">
        <li><a href="#wrap-through-property"><span class="secno">3.3.1</span> <span class="content"> The <span class="property">wrap-through</span> Property</span></a>
       </ol>
      <li><a href="#exclusions-order"><span class="secno">3.4</span> <span class="content"> Exclusions order</span></a>
      <li>
       <a href="#exclusions-processing-model"><span class="secno">3.5</span> <span class="content"> Processing model</span></a>
       <ol class="toc">
        <li><a href="#exclusions-processing-model-description"><span class="secno">3.5.1</span> <span class="content"> Description</span></a>
        <li><a href="#step-1"><span class="secno">3.5.2</span> <span class="content"> Step 1: resolve exclusion boxes belonging to each <span>wrapping context</span></span></a>
        <li><a href="#step-2"><span class="secno">3.5.3</span> <span class="content"> Step 2: resolve wrapping contexts and lay out containing blocks</span></a>
        <li><a href="#step-2-A"><span class="secno">3.5.4</span> <span class="content"> Step 2-A: resolve the position and size of exclusion boxes</span></a>
        <li><a href="#step-2-B"><span class="secno">3.5.5</span> <span class="content"> Step 2-B: lay out containing block applying wrapping</span></a>
        <li>
         <a href="#processing-model-example"><span class="secno">3.5.6</span> <span class="content"> Processing Model Example</span></a>
         <ol class="toc">
          <li><a href="#example-step-1"><span class="secno">3.5.6.1</span> <span class="content"> Step 1: resolve exclusion boxes belonging to each <span>wrapping context</span></span></a>
          <li>
           <a href="#example-step-2"><span class="secno">3.5.6.2</span> <span class="content"> Step 2: resolve wrapping contexts and lay out containing blocks</span></a>
           <ol class="toc">
            <li><a href="#example-resolving-rwc-1"><span class="secno">3.5.6.2.1</span> <span class="content"> Resolving RWC-1</span></a>
            <li><a href="#example-resolving-rwc-2"><span class="secno">3.5.6.2.2</span> <span class="content"> Resolving RWC-2</span></a>
           </ol>
         </ol>
       </ol>
      <li>
       <a href="#floats-and-exclusions"><span class="secno">3.6</span> <span class="content"> Floats and exclusions</span></a>
       <ol class="toc">
        <li><a href="#floats-and-exclusions-similarities"><span class="secno">3.6.1</span> <span class="content"> Similarities</span></a>
        <li><a href="#floats-and-exclusions-differences"><span class="secno">3.6.2</span> <span class="content"> Differences</span></a>
        <li>
         <a href="#floats-interop"><span class="secno">3.6.3</span> <span class="content"> Interoperability</span></a>
         <ol class="toc">
          <li><a href="#effect-of-floats-on-exclusions"><span class="secno">3.6.3.1</span> <span class="content"> Effect of floats on exclusions</span></a>
          <li><a href="#effect-of-exclusions-on-floats"><span class="secno">3.6.3.2</span> <span class="content"> Effect of exclusions on floats</span></a>
         </ol>
       </ol>
     </ol>
    <li><a href="#acks"><span class="secno"></span> <span class="content"> Acknowledgments</span></a>
    <li>
     <a href="#changes"><span class="secno"></span> <span class="content">Changes</span></a>
     <ol class="toc">
      <li><a href="#recent-changes"><span class="secno"></span> <span class="content"> Changes from the <span>15 January 2015 Working Draft</span></span></a>
      <li><a href="#changes-2013"><span class="secno"></span> <span class="content"> Changes from the <span>28 May 2013 Working Draft</span></span></a>
      <li><a href="#changes-2012"><span class="secno"></span> <span class="content"> Changes from the <span>3 May 2012 Working Draft</span></span></a>
     </ol>
    <li>
     <a href="#w3c-conformance"><span class="secno"></span> <span class="content"> Conformance</span></a>
     <ol class="toc">
      <li><a href="#w3c-conventions"><span class="secno"></span> <span class="content"> Document conventions</span></a>
      <li><a href="#w3c-conformance-classes"><span class="secno"></span> <span class="content"> Conformance classes</span></a>
      <li>
       <a href="#w3c-partial"><span class="secno"></span> <span class="content"> Partial implementations</span></a>
       <ol class="toc">
        <li><a href="#w3c-conform-future-proofing"><span class="secno"></span> <span class="content"> Implementations of Unstable and Proprietary Features</span></a>
       </ol>
      <li><a href="#w3c-testing"><span class="secno"></span> <span class="content"> Non-experimental implementations</span></a>
     </ol>
    <li>
     <a href="#index"><span class="secno"></span> <span class="content">Index</span></a>
     <ol class="toc">
      <li><a href="#index-defined-here"><span class="secno"></span> <span class="content">Terms defined by this specification</span></a>
      <li><a href="#index-defined-elsewhere"><span class="secno"></span> <span class="content">Terms defined by reference</span></a>
     </ol>
    <li>
     <a href="#references"><span class="secno"></span> <span class="content">References</span></a>
     <ol class="toc">
      <li><a href="#normative"><span class="secno"></span> <span class="content">Normative References</span></a>
      <li><a href="#informative"><span class="secno"></span> <span class="content">Informative References</span></a>
     </ol>
    <li><a href="#property-index"><span class="secno"></span> <span class="content">Property Index</span></a>
    <li><a href="#issues-index"><span class="secno"></span> <span class="content">Issues Index</span></a>
   </ol>
  </nav>
  <main>
   <h2 class="heading settled" data-level="1" id="intro"><span class="secno">1. </span><span class="content"> Introduction</span><a class="self-link" href="#intro"></a></h2>
   <p><em>This section is not normative.</em></p>
   <p>This specification defines features that allow inline flow
  content to wrap around outside the <span>exclusion area</span> of elements.</p>
   <h3 class="heading settled" data-level="1.1" id="values"><span class="secno">1.1. </span><span class="content"> Value Definitions</span><a class="self-link" href="#values"></a></h3>
   <p>This specification follows the <a href="https://www.w3.org/TR/CSS2/about.html#property-defs">CSS property definition conventions</a> from <a data-link-type="biblio" href="#biblio-css21" title="Cascading Style Sheets Level 2 Revision 1 (CSS 2.1) Specification">[CSS2]</a> using the <a href="https://www.w3.org/TR/css-values-3/#value-defs">value definition syntax</a> from <a data-link-type="biblio" href="#biblio-css-values-3" title="CSS Values and Units Module Level 3">[CSS-VALUES-3]</a>.
  Value types not defined in this specification are defined in CSS Values &amp; Units <span title="CSS Values and Units Module Level 3">[CSS-VALUES-3]</span>.
  Combination with other CSS modules may expand the definitions of these value types.</p>
   <p>In addition to the property-specific values listed in their definitions,
  all properties defined in this specification
  also accept the <a data-link-type="dfn" href="https://drafts.csswg.org/css-values-4/#css-wide-keywords" id="ref-for-css-wide-keywords">CSS-wide keywords</a> as their property value.
  For readability they have not been repeated explicitly.</p>
   <h2 class="heading settled" data-level="2" id="terms"><span class="secno">2. </span><span class="content"> Terminology</span><a class="self-link" href="#terms"></a></h2>
   <dl>
    <dt><dfn class="dfn-paneled" data-dfn-type="dfn" data-export id="exclusion-box">Exclusion box</dfn> 
    <dd> A <a href="https://www.w3.org/TR/css3-box/">box</a> (<a data-link-type="biblio" href="#biblio-css3box" title="CSS Box Model Module Level 3">[CSS3BOX]</a>) that defines
      an <span>exclusion area</span> for other boxes. The <a class="property css" data-link-type="property" href="#propdef-wrap-flow" id="ref-for-propdef-wrap-flow">wrap-flow</a> property is
      used to make an element’s generated box an exclusion box. An exclusion box
      contributes its <span>exclusion area</span> to its <a href="https://www.w3.org/TR/CSS2/visudet.html#containing-block-details">containing block’s</a> <span>wrapping context</span>. An element with a <span class="css">float</span> computed value other
      than <a class="css" data-link-type="maybe" href="https://drafts.csswg.org/css-page-floats-3/#valdef-float-none" id="ref-for-valdef-float-none">none</a> does not become an exclusion. 
    <dt><dfn class="dfn-paneled" data-dfn-type="dfn" data-export id="exclusion-area">Exclusion area</dfn> 
    <dd>
      The area used for excluding inline flow content around an exclusion box. The <span>exclusion area</span> is equivalent to the <a data-link-type="dfn" href="https://drafts.csswg.org/css-box-4/#border-box" id="ref-for-border-box">border box</a> for an exclusion box. 
     <p class="note" role="note"> If a user agent implements both CSS Exclusions and CSS Shapes, the
        shape-outside property defines the exclusion area instead of the border box. </p>
    <dt><dfn class="dfn-paneled" data-dfn-type="dfn" data-export id="exclusion-element">Exclusion element</dfn> 
    <dd> An <span>exclusion element</span> is a block-level element which is not a float
      and generates an <span>exclusion box</span>. An element generates an exclusion
      box when its <span class="css">wrap-flow</span> property’s computed value is not <a class="css" data-link-type="maybe" href="#valdef-wrap-flow-auto" id="ref-for-valdef-wrap-flow-auto">auto</a>. 
    <dt><dfn class="dfn-paneled" data-dfn-type="dfn" data-export id="wrapping-context">Wrapping context</dfn> 
    <dd>
      The <span>wrapping context</span> of a box is a collection of <span>exclusion
      areas</span> contributed by its associated <span>exclusion boxes</span>.
      During layout, a box wraps its inline flow content in the <code>wrapping area</code> that corresponds to the subtraction of its <span>wrapping context</span> from
      its own <span>content area</span>. 
     <p>A box inherits its <a href="https://www.w3.org/TR/CSS2/visudet.html#containing-block-details">containing block’s</a> <span>wrapping context</span> unless it specifically
      resets it using the <a class="property css" data-link-type="property" href="#propdef-wrap-through" id="ref-for-propdef-wrap-through">wrap-through</a> property.</p>
    <dt><dfn class="dfn-paneled" data-dfn-type="dfn" data-export id="content-area">Content area</dfn> 
    <dd> The <a data-link-type="dfn" href="#content-area" id="ref-for-content-area">content area</a> is normally used for layout of the inline flow content of a box. 
    <dt><dfn class="dfn-paneled" data-dfn-type="dfn" data-export id="wrapping-area">Wrapping area</dfn> 
    <dd> The area used for layout of inline flow content of a box affected by a <span>wrapping context</span>, defined by subtracting the <span>wrapping
      context</span> from its <span>content area</span>. 
    <dt><dfn class="dfn-paneled" data-dfn-type="dfn" data-export id="outside">Outside</dfn> and <dfn class="dfn-paneled" data-dfn-type="dfn" data-export id="inside">inside</dfn> 
    <dd> In this specification, <a data-link-type="dfn" href="#outside" id="ref-for-outside">outside</a> refers to DOM content that is not a descendant
      of an element while <a data-link-type="dfn" href="#inside" id="ref-for-inside">inside</a> refers to the element’s descendants. 
   </dl>
   <h2 class="heading settled" data-level="3" id="exclusions"><span class="secno">3. </span><span class="content"> Exclusions</span><a class="self-link" href="#exclusions"></a></h2>
   <p>Exclusion elements define <span>exclusion areas</span> that contribute to their
  containing block’s <span>wrapping context</span>. As a consequence, exclusions
  impact the layout of their containing block’s descendants.</p>
   <p>Elements lay out their inline content in their <span>content area</span> and wrap
  around the <span>exclusion areas</span> in their associated <span>wrapping
  context</span>. If the element is itself an exclusion, it does not wrap around
  its own exclusion area and the impact of other exclusions on other exclusions
  is controlled by the <a class="property css" data-link-type="property" href="https://www.w3.org/TR/CSS21/visuren.html#propdef-z-index" id="ref-for-propdef-z-index">z-index</a> property as explained in the
  'exclusions order' section.</p>
   <h3 class="heading settled" data-level="3.1" id="declaring-exclusions"><span class="secno">3.1. </span><span class="content"> Declaring exclusions</span><a class="self-link" href="#declaring-exclusions"></a></h3>
   <p>An element becomes an exclusion when its <a class="property css" data-link-type="property" href="#propdef-wrap-flow" id="ref-for-propdef-wrap-flow①">wrap-flow</a> property has a computed
  value other than <a class="css" data-link-type="maybe" href="#valdef-wrap-flow-auto" id="ref-for-valdef-wrap-flow-auto①">auto</a>.</p>
   <h4 class="heading settled" data-level="3.1.1" id="wrap-flow-property"><span class="secno">3.1.1. </span><span class="content"> The <a class="property css" data-link-type="property" href="#propdef-wrap-flow" id="ref-for-propdef-wrap-flow②">wrap-flow</a> property</span><a class="self-link" href="#wrap-flow-property"></a></h4>
   <table class="def propdef" data-link-for-hint="wrap-flow">
    <tbody>
     <tr>
      <th>Name:
      <td><dfn class="dfn-paneled css" data-dfn-type="property" data-export id="propdef-wrap-flow">wrap-flow</dfn>
     <tr class="value">
      <th><a href="https://www.w3.org/TR/css-values/#value-defs">Value:</a>
      <td class="prod">auto <a data-link-type="grammar" href="https://drafts.csswg.org/css-values-4/#comb-one" id="ref-for-comb-one">|</a> both <span id="ref-for-comb-one①">|</span> start <span id="ref-for-comb-one②">|</span> end <span id="ref-for-comb-one③">|</span> minimum <span id="ref-for-comb-one④">|</span> maximum <span id="ref-for-comb-one⑤">|</span> clear 
     <tr>
      <th><a href="https://www.w3.org/TR/css-cascade/#initial-values">Initial:</a>
      <td>auto 
     <tr>
      <th><a href="https://www.w3.org/TR/css-cascade/#applies-to">Applies to:</a>
      <td>block-level elements. 
     <tr>
      <th><a href="https://www.w3.org/TR/css-cascade/#inherited-property">Inherited:</a>
      <td>no 
     <tr>
      <th><a href="https://www.w3.org/TR/css-values/#percentages">Percentages:</a>
      <td>N/A 
     <tr>
      <th><a href="https://www.w3.org/TR/css-cascade/#computed">Computed value:</a>
      <td>as specified except for element’s whose <a class="property css" data-link-type="property" href="https://drafts.csswg.org/css2/#propdef-float" id="ref-for-propdef-float">float</a> computed value is not <a class="css" data-link-type="maybe" href="https://drafts.csswg.org/css-page-floats-3/#valdef-float-none" id="ref-for-valdef-float-none①">none</a>, in which case the computed value is <a class="css" data-link-type="maybe" href="#valdef-wrap-flow-auto" id="ref-for-valdef-wrap-flow-auto②">auto</a>. 
     <tr>
      <th><a href="https://www.w3.org/TR/cssom/#serializing-css-values">Canonical order:</a>
      <td>per grammar 
   </table>
   <p>The values of this property have the following meanings:</p>
   <dl>
    <dt><dfn class="dfn-paneled css" data-dfn-for="wrap-flow" data-dfn-type="value" data-export id="valdef-wrap-flow-auto">auto</dfn> 
    <dd> No exclusion is created. Inline flow content interacts with the element
        as usual. In particular, if the element is a <a href="https://www.w3.org/TR/CSS2/visuren.html#floats">float</a> (see <a data-link-type="biblio" href="#biblio-css21" title="Cascading Style Sheets Level 2 Revision 1 (CSS 2.1) Specification">[CSS21]</a>), the behavior is unchanged. 
    <dt><dfn class="dfn-paneled css" data-dfn-for="wrap-flow" data-dfn-type="value" data-export id="valdef-wrap-flow-both">both</dfn> 
    <dd> Inline flow content can flow on all sides of the exclusion. 
    <dt><dfn class="dfn-paneled css" data-dfn-for="wrap-flow" data-dfn-type="value" data-export id="valdef-wrap-flow-start">start</dfn> 
    <dd> Inline flow content can flow around the start edge of the <span>exclusion
        area</span> but must leave the area next to the end edge of the exclusion
        empty. 
    <dt><dfn class="dfn-paneled css" data-dfn-for="wrap-flow" data-dfn-type="value" data-export id="valdef-wrap-flow-end">end</dfn> 
    <dd> Inline flow content can flow around the end edge of the <span>exclusion area</span> but must leave the area next to the start edge
        of the exclusion empty. 
    <dt><dfn class="dfn-paneled css" data-dfn-for="wrap-flow" data-dfn-type="value" data-export id="valdef-wrap-flow-minimum">minimum</dfn> 
    <dd> Inline flow content can flow around the edge of the exclusion with the
        smallest available space within the flow content’s containing block, and
        must leave the other edge of the exclusion empty. 
    <dt><dfn class="dfn-paneled css" data-dfn-for="wrap-flow" data-dfn-type="value" data-export id="valdef-wrap-flow-maximum">maximum</dfn> 
    <dd> Inline flow content can flow around the edge of the exclusion with the
        largest available space within the flow content’s containing block, and
        must leave the other edge of the exclusion empty. 
    <dt><dfn class="dfn-paneled css" data-dfn-for="wrap-flow" data-dfn-type="value" data-export id="valdef-wrap-flow-clear">clear</dfn> 
    <dd> Inline flow content can only flow before and after the exclusion in the
        flow content’s block direction and must leave the areas next to the start
        and end edges of the exclusion empty. 
   </dl>
   <p>If the property’s computed value is <a class="css" data-link-type="maybe" href="#valdef-wrap-flow-auto" id="ref-for-valdef-wrap-flow-auto③">auto</a>, the element does not become an <span>exclusion</span>.</p>
   <p>Otherwise, a computed <a class="property css" data-link-type="property" href="#propdef-wrap-flow" id="ref-for-propdef-wrap-flow③">wrap-flow</a> property value of <a class="css" data-link-type="maybe" href="#valdef-wrap-flow-both" id="ref-for-valdef-wrap-flow-both">both</a>, <a class="css" data-link-type="maybe" href="#valdef-wrap-flow-start" id="ref-for-valdef-wrap-flow-start">start</a>, <a class="css" data-link-type="maybe" href="#valdef-wrap-flow-end" id="ref-for-valdef-wrap-flow-end">end</a>, <a class="css" data-link-type="maybe" href="#valdef-wrap-flow-minimum" id="ref-for-valdef-wrap-flow-minimum">minimum</a>, <a class="css" data-link-type="maybe" href="#valdef-wrap-flow-maximum" id="ref-for-valdef-wrap-flow-maximum">maximum</a> or <a class="css" data-link-type="maybe" href="#valdef-wrap-flow-clear" id="ref-for-valdef-wrap-flow-clear">clear</a> on an  element makes that element an <a data-link-type="dfn" href="#exclusion-element" id="ref-for-exclusion-element">exclusion element</a>. It’s <a data-link-type="dfn" href="#exclusion-area" id="ref-for-exclusion-area">exclusion area</a> is contributed
  to its containing block’s <a data-link-type="dfn" href="#wrapping-context" id="ref-for-wrapping-context">wrapping context</a>, causing the containing
  block’s descendants to wrap around its <span id="ref-for-exclusion-area①">exclusion area</span>.</p>
   <figure>
     <img alt="LTR text wrapping on left edge, RTL text wrapping on right edge, and vertical text wrapping on top edge." src="images/exclusion-writing-modes.png" style="width: 70%"> 
    <figcaption>Exclusion with <a class="property css" data-link-type="property" href="#propdef-wrap-flow" id="ref-for-propdef-wrap-flow④">wrap-flow</a>: <a class="css" data-link-type="maybe" href="#valdef-wrap-flow-start" id="ref-for-valdef-wrap-flow-start①">start</a> interacting with various
    writing modes.</figcaption>
   </figure>
   <p>Determining the relevant edges of the exclusion depends on the <a href="https://www.w3.org/TR/css3-writing-modes/#text-flow">writing mode</a> <a data-link-type="biblio" href="#biblio-css3-writing-modes" title="CSS Writing Modes Level 3">[CSS3-WRITING-MODES]</a> of the content wrapping around the 'exclusion area'.</p>
   <p>An <a data-link-type="dfn" href="#exclusion-element" id="ref-for-exclusion-element①">exclusion element</a> establishes a new <a href>block formatting
  context</a> (see <a data-link-type="biblio" href="#biblio-css21" title="Cascading Style Sheets Level 2 Revision 1 (CSS 2.1) Specification">[CSS21]</a>) for its content.</p>
   <figure>
     <img alt="General illustration showing how exclusions combine" src="images/exclusions-illustration.png" style="width: 70%"> 
    <figcaption>Combining exclusions</figcaption>
   </figure>
   <p>The above figure illustrates how exclusions are combined. The outermost box
  represents an element’s content box. The A, B, C and D darker gray boxes
  represent exclusions in the element’s <a data-link-type="dfn" href="#wrapping-context" id="ref-for-wrapping-context①">wrapping context</a>.
  A, B, C and D have their respective <a class="property css" data-link-type="property" href="#propdef-wrap-flow" id="ref-for-propdef-wrap-flow⑤">wrap-flow</a> computed to <a class="css" data-link-type="maybe" href="#valdef-wrap-flow-both" id="ref-for-valdef-wrap-flow-both①">both</a>, <a class="css" data-link-type="maybe" href="#valdef-wrap-flow-start" id="ref-for-valdef-wrap-flow-start②">start</a>, <a class="css" data-link-type="maybe" href="#valdef-wrap-flow-end" id="ref-for-valdef-wrap-flow-end①">end</a> and <a class="css" data-link-type="maybe" href="#valdef-wrap-flow-clear" id="ref-for-valdef-wrap-flow-clear①">clear</a> respectively. The lighter gray areas show the additional areas
  that are excluded for inline layout as a result of the <span class="property" id="ref-for-propdef-wrap-flow⑥">wrap-flow</span> value.
  For example, the area to the right of B cannot be used for inline layout
  of left-to-right writing mode content because the <span class="property" id="ref-for-propdef-wrap-flow⑦">wrap-flow</span> for B is <span class="css" id="ref-for-valdef-wrap-flow-start③">start</span>.</p>
   <p>The background blue area shows what areas are available for a left-to-right
  writing mode element’s inline content layout.
  All areas represented with a light or dark shade of gray are not available for
  (left-to-right writing mode) inline content layout.</p>
   <div class="example" id="example-9c1936a4">
    <a class="self-link" href="#example-9c1936a4"></a> The <a class="property css" data-link-type="property" href="#propdef-wrap-flow" id="ref-for-propdef-wrap-flow⑧">wrap-flow</a> property values applied to exclusions as grid items. 
<pre>&lt;div id="grid">
    &lt;div id="top-right" class="exclusion">&lt;/div>
    &lt;div id="bottom-left" class="exclusion">&lt;/div>
    &lt;div id="content">Lorem ipsum…&lt;/div>
&lt;/div>

&lt;style type="text/css">
#grid {
    width: 30em;
    height: 30em;
    display: grid;
    grid-columns: 25% 25% 25% 25%;
    grid-rows: 25% 25% 25% 25%;

#top-right {
    grid-column: 3;
    grid-row: 2;
}

#bottom-left {
    grid-column: 2;
    grid-row: 3;
}

.exclusion {
    wrap-flow: &lt;see below>
}

#content {
    grid-row: 1;
    grid-row-span: 4;
    grid-column: 1;
    grid-column-span: 4;
}
&lt;/style>
</pre>
    <p>The following figures illustrate the visual rendering for different values
  of the <a class="property css" data-link-type="property" href="#propdef-wrap-flow" id="ref-for-propdef-wrap-flow⑨">wrap-flow</a> property. The gray grid lines are marking the grid cells
  and the blue area is the exclusion box (positioned by the grid).</p>
    <table class="example-table">
     <tbody>
      <tr>
       <td><code class="html">.exclusion{ wrap-flow: auto; }</code>
       <td><code class="html">.exclusion{ wrap-flow: both; }</code>
      <tr>
       <td><img alt="Example rendering for wrap-side: auto" src="images/exclusion_wrap_side_auto.png">
       <td><img alt="Example rendering for wrap-side: both" src="images/exclusion_wrap_side_both.png">
      <tr>
       <td><code class="html">.exclusion{ wrap-flow: start; }</code>
       <td><code class="html">.exclusion{ wrap-flow: end; }</code>
      <tr>
       <td><img alt="Example rendering for wrap-side: start" src="images/exclusion_wrap_side_left.png">
       <td><img alt="Example rendering for wrap-side: end" src="images/exclusion_wrap_side_right.png">
      <tr>
       <td><code class="html">.exclusion{ wrap-flow: minimum; }</code>
       <td><code class="html">.exclusion{ wrap-flow: maximum; }</code>
      <tr>
       <td><img alt="Example rendering for wrap-side: minimum" src="images/exclusion_wrap_side_minimum.png">
       <td><img alt="Example rendering for wrap-side: maximum" src="images/exclusion_wrap_side_maximum.png">
      <tr>
       <td><code class="html">.exclusion{ wrap-flow: clear; }</code>
       <td>
      <tr>
       <td><img alt="Example rendering for wrap-side: clear" src="images/exclusion_wrap_side_clear.png">
       <td>
    </table>
   </div>
   <h3 class="heading settled" data-level="3.2" id="scope-and-effect-of-exclusions"><span class="secno">3.2. </span><span class="content"> Scope and effect of exclusions</span><a class="self-link" href="#scope-and-effect-of-exclusions"></a></h3>
   <p>An <span>exclusion</span> affects the inline flow content descended from the
  exclusion’s containing block (defined in <a href="https://www.w3.org/TR/CSS2/visudet.html#containing-block-details">CSS 2.1 10.1</a>) and that of all descendant
  elements of the same containing block. All inline flow content inside the
  containing block of the exclusions is affected. To stop the effect of exclusions
  defined outside an element, the <a class="property css" data-link-type="property" href="#propdef-wrap-through" id="ref-for-propdef-wrap-through①">wrap-through</a> property can be used
  (see the <a href="#propagation-of-exclusions">propagation of exclusions</a> section below).</p>
   <p>As a reminder, for exclusions with <a class="property css" data-link-type="property" href="https://drafts.csswg.org/css-position-3/#propdef-position" id="ref-for-propdef-position">position</a>:<a class="css" data-link-type="maybe" href="https://drafts.csswg.org/css-position-3/#valdef-position-fixed" id="ref-for-valdef-position-fixed">fixed</a>, the containing block
  is established by the root element.</p>
   <h3 class="heading settled" data-level="3.3" id="propagation-of-exclusions"><span class="secno">3.3. </span><span class="content"> Propagation of Exclusions</span><a class="self-link" href="#propagation-of-exclusions"></a></h3>
   <p>By default, an element inherits its parent <a data-link-type="dfn" href="#wrapping-context" id="ref-for-wrapping-context②">wrapping context</a>. In other
  words it is subject to the exclusions defined <a data-link-type="dfn" href="#outside" id="ref-for-outside①">outside</a> the element.</p>
   <p>Setting the <a class="property css" data-link-type="property" href="#propdef-wrap-through" id="ref-for-propdef-wrap-through②">wrap-through</a> property to <a class="css" data-link-type="maybe" href="#valdef-wrap-through-none" id="ref-for-valdef-wrap-through-none">none</a> prevents an
  element from inheriting its parent <a data-link-type="dfn" href="#wrapping-context" id="ref-for-wrapping-context③">wrapping context</a>. In other words,
  exclusions defined <a class="css" data-link-type="maybe" href="https://drafts.csswg.org/css-anchor-position-1/#valdef-anchor-outside" id="ref-for-valdef-anchor-outside">outside</a> the element, have not effect on the element’s
  children layout.</p>
   <p class="note" role="note"> Exclusions defined by an element’s descendants still contribute to their
    containing block’s <a data-link-type="dfn" href="#wrapping-context" id="ref-for-wrapping-context④">wrapping context</a>. If that containing block is a
    child of an element with <a class="property css" data-link-type="property" href="#propdef-wrap-through" id="ref-for-propdef-wrap-through③">wrap-through</a> computes to <a class="css" data-link-type="maybe" href="#valdef-wrap-through-none" id="ref-for-valdef-wrap-through-none①">none</a>,
    or the element itself, then exclusion still have an effect on the children
    of that containing block element. </p>
   <h4 class="heading settled" data-level="3.3.1" id="wrap-through-property"><span class="secno">3.3.1. </span><span class="content"> The <a class="property css" data-link-type="property" href="#propdef-wrap-through" id="ref-for-propdef-wrap-through④">wrap-through</a> Property</span><a class="self-link" href="#wrap-through-property"></a></h4>
   <table class="def propdef" data-link-for-hint="wrap-through">
    <tbody>
     <tr>
      <th>Name:
      <td><dfn class="dfn-paneled css" data-dfn-type="property" data-export id="propdef-wrap-through">wrap-through</dfn>
     <tr class="value">
      <th><a href="https://www.w3.org/TR/css-values/#value-defs">Value:</a>
      <td class="prod">wrap <a data-link-type="grammar" href="https://drafts.csswg.org/css-values-4/#comb-one" id="ref-for-comb-one⑥">|</a> none
     <tr>
      <th><a href="https://www.w3.org/TR/css-cascade/#initial-values">Initial:</a>
      <td>wrap
     <tr>
      <th><a href="https://www.w3.org/TR/css-cascade/#applies-to">Applies to:</a>
      <td>block-level elements
     <tr>
      <th><a href="https://www.w3.org/TR/css-cascade/#inherited-property">Inherited:</a>
      <td>no
     <tr>
      <th><a href="https://www.w3.org/TR/css-values/#percentages">Percentages:</a>
      <td>N/A
     <tr>
      <th><a href="https://www.w3.org/TR/css-cascade/#computed">Computed value:</a>
      <td>as specified
     <tr>
      <th><a href="https://www.w3.org/TR/cssom/#serializing-css-values">Canonical order:</a>
      <td>per grammar
   </table>
   <p>The values of this property have the following meanings:</p>
   <dl>
    <dt><dfn class="dfn-paneled css" data-dfn-for="wrap-through" data-dfn-type="value" data-export id="valdef-wrap-through-wrap">wrap</dfn>
    <dd> The element inherits its parent node’s <a data-link-type="dfn" href="#wrapping-context" id="ref-for-wrapping-context⑤">wrapping context</a>. Its descendant
    inline content wraps around exclusions defined <a data-link-type="dfn" href="#outside" id="ref-for-outside②">outside</a> the element. 
    <dt><dfn class="dfn-paneled css" data-dfn-for="wrap-through" data-dfn-type="value" data-export id="valdef-wrap-through-none">none</dfn>
    <dd> The element does not inherit its parent node’s <a data-link-type="dfn" href="#wrapping-context" id="ref-for-wrapping-context⑥">wrapping context</a>. Its
    descendants are only subject to exclusion areas defined <a data-link-type="dfn" href="#inside" id="ref-for-inside①">inside</a> the element. 
   </dl>
   <div class="example" id="example-50273d4a">
    <a class="self-link" href="#example-50273d4a"></a> Using the <a class="property css" data-link-type="property" href="#propdef-wrap-through" id="ref-for-propdef-wrap-through⑤">wrap-through</a> property to control the effect of exclusions. 
<pre><code class="html">
&lt;style type="text/css">
    #grid {
        display: grid;
        grid-columns: 25% 50% 25%;
        grid-rows: 25% 25% 25% 25%;
    }

    #exclusion {
        grid-row: 2;
        grid-row-span: 2;
        grid-column: 2;
        wrap-flow: &lt;see below>
    }

    #rowA, #rowB {
        grid-row-span: 2;
        grid-column: 1;
        grid-column-span: 3;
    }

    #rowA {
        grid-row: 1;
    }

    #rowB {
        grid-row: 3;
    }
    &lt;/style>

&lt;style type="text/css">
    .exclusion  {
      wrap-flow: both;
      position: absolute;
      left: 20%;
      top: 20%;
      width: 50%;
      height: 50%;
      background-color: rgba(220, 230, 242, 0.5);
    }
&lt;/style>

&lt;div id="grid">
    &lt;div class=”exclusion”>&lt;/div>
    &lt;div id="rowA" style=”wrap-through: wrap;”> Lorem ipsum dolor sit amet...&lt;/div>
    &lt;div id="rowB" style=”wrap-through: none;”> Lorem ipsum dolor sit amet...&lt;/div>
&lt;/div>
</code></pre>
    <p><img alt="Example rendering of wrap-through: wrap | none" class="singleImgExample" src="images/exclusion_wrap_through.png" style="max-width:40%"></p>
   </div>
   <h3 class="heading settled" data-level="3.4" id="exclusions-order"><span class="secno">3.4. </span><span class="content"> Exclusions order</span><a class="self-link" href="#exclusions-order"></a></h3>
   <p>Exclusions follow the painting order (See <a data-link-type="biblio" href="#biblio-css21" title="Cascading Style Sheets Level 2 Revision 1 (CSS 2.1) Specification">[CSS21]</a> Appendix E). Exclusions are
  applied in reverse to the document order in which they are defined. The last exclusion
  appears on top of all other exclusion, thus it affects the inline flow content of
  all other preceding exclusions or elements descendant of the same containing block.
  The <a class="property css" data-link-type="property" href="https://www.w3.org/TR/CSS21/visuren.html#propdef-z-index" id="ref-for-propdef-z-index①">z-index</a> property can be used to change the ordering of <a href="https://www.w3.org/TR/CSS2/visuren.html#choose-position">positioned</a> exclusion
  boxes (see <span title="Cascading Style Sheets Level 2 Revision 1 (CSS 2.1) Specification">[CSS21]</span>). Statically positioned exclusions are not affected by the <span class="property" id="ref-for-propdef-z-index②">z-index</span> property and thus follow the painting order.</p>
   <div class="example" id="example-d42a15a1">
    <a class="self-link" href="#example-d42a15a1"></a> 
    <p>Ordering of exclusions.</p>
<pre><code class="html">&lt;style type="text/css">
    .exclusion  {
      wrap-flow: both;
      position: absolute;
      width: 200px;
    }
    .topleft {
      top: 10px;
      left: 10px;
      background-color: lightblue;
    }
    .middle {
      top: 90px;
      left: 90px;
      background-color: lightgreen;
    }
    .bottomright {
      top: 170px;
      left: 170px;
      background-color: pink;
    }
&lt;/style>

&lt;div class="exclusion topleft">
    The top left div...
&lt;/div>
&lt;div class="exclusion middle">
    The middle div...
&lt;/div>
&lt;div class="exclusion bottomright">
    The bottom right div...
&lt;/div>
</code></pre>
    <table class="example-table">
     <tbody>
      <tr>
       <td style="width:50%"><code class="html">.middle { z-index: auto; }</code>
       <td style="width:50%"><code class="html">.middle { z-index: 1; }</code>
      <tr>
       <td><img alt="Example rendering of default exclusion ordering." class="singleImgExample" src="images/exclusion_ordering.png">
       <td><img alt="Example rendering of default exclusion ordering." class="singleImgExample" src="images/exclusion_ordering_z_order.png">
    </table>
   </div>
   <div class="issue-marker wrapper">
    <div class="issue-marker">
      <a href="https://www.w3.org/Bugs/Public/show_bug.cgi?id=15183">Issue-15183</a> 
     <div class="issue-details">
      <p class="short-desc">Is the CSS exclusions processing model incorrect?</p>
     </div>
    </div>
   </div>
   <div class="issue" id="issue-5c31dc98">
    <a class="self-link" href="#issue-5c31dc98"></a> 
    <p>The current draft provides a model for exclusions
  without a collision-avoidance model.
  The existing exclusion model in CSS uses floats,
  which have both exclusion and collision-avoidance behavior.
  Concerns have been raised that allowing exclusions
  without collision avoidance could be harmful,
  particularly with absolutely-positioned elements.
  Three options should be considered:</p>
    <ol>
     <li>Allow exclusions in positioning schemes
      with no collision avoidance.
     <li>Disallow exclusions in positioning schemes
      with no collision avoidance.
     <li>Define collision-avoidance behavior
      for positioning schemes without it,
      and use this behavior by default with exclusions.
    </ol>
   </div>
   <h3 class="heading settled" data-level="3.5" id="exclusions-processing-model"><span class="secno">3.5. </span><span class="content"> Processing model</span><a class="self-link" href="#exclusions-processing-model"></a></h3>
   <h4 class="heading settled" data-level="3.5.1" id="exclusions-processing-model-description"><span class="secno">3.5.1. </span><span class="content"> Description</span><a class="self-link" href="#exclusions-processing-model-description"></a></h4>
   <p>Applying exclusions is a two-step process:</p>
   <ul>
    <li><strong>Step 1</strong>: resolve exclusion boxes belonging to each <a data-link-type="dfn" href="#wrapping-context" id="ref-for-wrapping-context⑦">wrapping context</a> 
    <li>
     <strong>Step 2</strong>: resolve each <a data-link-type="dfn" href="#wrapping-context" id="ref-for-wrapping-context⑧">wrapping context</a> and lay out
  each containing block in turn: 
     <ul>
      <li><strong>Step 2-A</strong>: resolve the position and size of exclusion
    boxes 
      <li><strong>Step 2-B</strong>: lay out containing block, wrapping around
    each <a data-link-type="dfn" href="#exclusion-area" id="ref-for-exclusion-area②">exclusion area</a> 
     </ul>
   </ul>
   <h4 class="heading settled" data-level="3.5.2" id="step-1"><span class="secno">3.5.2. </span><span class="content"> Step 1: resolve exclusion boxes belonging to each <a data-link-type="dfn" href="#wrapping-context" id="ref-for-wrapping-context⑨">wrapping context</a></span><a class="self-link" href="#step-1"></a></h4>
   <p>In this step, the user agent determines which <a href="https://www.w3.org/TR/CSS2/visudet.html#containing-block-details">containing block</a> each <a data-link-type="dfn" href="#exclusion-area" id="ref-for-exclusion-area③">exclusion area</a> belongs to. This is a simple step, based on the definition of containing
  blocks and elements with a computed value for <a class="property css" data-link-type="property" href="#propdef-wrap-flow" id="ref-for-propdef-wrap-flow①⓪">wrap-flow</a> that is not <code class="css">auto</code>.</p>
   <h4 class="heading settled" data-level="3.5.3" id="step-2"><span class="secno">3.5.3. </span><span class="content"> Step 2: resolve wrapping contexts and lay out containing blocks</span><a class="self-link" href="#step-2"></a></h4>
   <p>In this step, starting from the top of the <a href="https://www.w3.org/TR/CSS2/visuren.html#z-index">rendering tree</a> (see <a data-link-type="biblio" href="#biblio-css21" title="Cascading Style Sheets Level 2 Revision 1 (CSS 2.1) Specification">[CSS21]</a>), the agent processes each
  containing block in two sub-steps.</p>
   <h4 class="heading settled" data-level="3.5.4" id="step-2-A"><span class="secno">3.5.4. </span><span class="content"> Step 2-A: resolve the position and size of exclusion boxes</span><a class="self-link" href="#step-2-A"></a></h4>
   <p>Resolving the position and size of <a data-link-type="dfn" href="#exclusion-box" id="ref-for-exclusion-box">exclusion boxes</a> in the <a data-link-type="dfn" href="#wrapping-context" id="ref-for-wrapping-context①⓪">wrapping
  context</a> may or may not require a layout. For example, if an <span id="ref-for-exclusion-box①">exclusion
  box</span> is absolutely positioned and sized, a layout may not be needed to
  resolve its position and size. In other situations, laying out the containing
  block’s content is required.</p>
   <p>When a layout is required, it is carried out without applying any <a data-link-type="dfn" href="#exclusion-area" id="ref-for-exclusion-area④">exclusion
  area</a>. In other words, the containing block is laid out without a <a data-link-type="dfn" href="#wrapping-context" id="ref-for-wrapping-context①①">wrapping context</a>.</p>
   <p>Step 2-A yields a position and size for all <a data-link-type="dfn" href="#exclusion-box" id="ref-for-exclusion-box②">exclusion boxes</a> in the <a data-link-type="dfn" href="#wrapping-context" id="ref-for-wrapping-context①②">wrapping context</a>. Each exclusion box is processed in turn, starting from
  the top-most, and each <a data-link-type="dfn" href="#exclusion-area" id="ref-for-exclusion-area⑤">exclusion area</a> is computed and contributed to the <a href="https://www.w3.org/TR/CSS2/visudet.html#containing-block-details">containing
  block’s</a> <span id="ref-for-wrapping-context①③">wrapping context</span>.</p>
   <p>Scrolling is ignored in this step when resolving the position and size of <a class="property css" data-link-type="property" href="https://drafts.csswg.org/css-position-3/#propdef-position" id="ref-for-propdef-position①">position</a>: <a class="css" data-link-type="maybe" href="https://drafts.csswg.org/css-position-3/#valdef-position-fixed" id="ref-for-valdef-position-fixed①">fixed</a> <a data-link-type="dfn" href="#exclusion-box" id="ref-for-exclusion-box③">exclusion boxes</a>.</p>
   <p>Once the <a href="https://www.w3.org/TR/CSS2/visudet.html#containing-block-details">containing block’s</a> <a data-link-type="dfn" href="#wrapping-context" id="ref-for-wrapping-context①④">wrapping context</a> is computed, all <a data-link-type="dfn" href="#exclusion-box" id="ref-for-exclusion-box④">exclusion boxes</a> in
  that <span id="ref-for-wrapping-context①⑤">wrapping context</span> are removed from the normal flow.</p>
   <h4 class="heading settled" data-level="3.5.5" id="step-2-B"><span class="secno">3.5.5. </span><span class="content"> Step 2-B: lay out containing block applying wrapping</span><a class="self-link" href="#step-2-B"></a></h4>
   <p>Finally, the content of the containing block is laid out, with the inline content
wrapping around the <a data-link-type="dfn" href="#wrapping-context" id="ref-for-wrapping-context①⑥">wrapping context</a>’s <a data-link-type="dfn" href="#exclusion-area" id="ref-for-exclusion-area⑥">exclusion area</a>.</p>
   <p>When the containing block itself is an <a data-link-type="dfn" href="#exclusion-box" id="ref-for-exclusion-box⑤">exclusion box</a>, then rules on <a href="#exclusions-order">exclusions order</a> define which exclusions affect
  the inline and descendant content of the box.</p>
   <h4 class="heading settled" data-level="3.5.6" id="processing-model-example"><span class="secno">3.5.6. </span><span class="content"> Processing Model Example</span><a class="self-link" href="#processing-model-example"></a></h4>
   <p>This section illustrates the exclusions processing model with an example.
  It is meant to be simple. Yet, it contains enough complexity to address the
  issues of layout dependencies and re-layout.</p>
   <p>The code snippet in the following example has two exclusions affecting the
  document’s inline content.</p>
   <div class="example" id="example-09557e3c">
    <a class="self-link" href="#example-09557e3c"></a> 
<pre class="html">&lt;html>&lt;style>
#d1 {
    position:relative;
    height: auto;
    color: #46A4E9;
    border: 1px solid gray;
}

#e1 {
    wrap-flow: both;
    position: absolute;
    left: 50%;
    top: 50%;
    width: 40%;
    height: 40%;
    border: 1px solid red;
    margin-left: -20%;
    margin-top: -20%;
}

#d2 {
    position: static;
    width: 100%;
    height: auto;
    color: #808080;
}

#e2 {
    wrap-flow: both;
    position: absolute;
    right: 5ex;
    top: 1em;
    width: 12ex;
    height: 10em;
    border: 1px solid lime;
}
&lt;/style>
&lt;body>
    &lt;div id="d1">
        Lorem ipsusm ...
        &lt;p id="e1">&lt;/p>
    &lt;/div>
    &lt;div id="d2">
        Lorem ipsusm ...
        &lt;p id="e2" >&lt;/p>
    &lt;/div>
&lt;/body>
&lt;/html></pre>
   </div>
   <p>The following figures illustrate:</p>
   <ul>
    <li>the document’s DOM tree 
    <li>the layout tree of generated block boxes 
   </ul>
   <figure>
     <img alt="DOM tree nodes" src="images/processing-model-example-dom.svg" width="200"> 
    <figcaption>DOM tree</figcaption>
   </figure>
   <figure>
     <img alt="Layout tree boxes" src="images/processing-model-example-layout-tree.svg" width="350"> 
    <figcaption>Layout tree of generated block boxes</figcaption>
   </figure>
   <h5 class="heading settled" data-level="3.5.6.1" id="example-step-1"><span class="secno">3.5.6.1. </span><span class="content"> Step 1: resolve exclusion boxes belonging to each <a data-link-type="dfn" href="#wrapping-context" id="ref-for-wrapping-context①⑦">wrapping context</a></span><a class="self-link" href="#example-step-1"></a></h5>
   <p>The figures illustrate how the boxes corresponding to the element sometimes
  have a different containment hierarchy in the layout tree than in the DOM tree.
  For example, the box generated by <code class="idl">e1</code> is positioned in
  its containing block’s box, which is the <code class="idl">d1-box</code>, because <code class="idl">e1</code> is absolutely positioned and <code class="idl">d1</code> is relatively positioned. However, while <code class="idl">e2</code> is also absolutely
  positioned, its containing block is the initial containing block (ICB). See the
  section 10.1 of the CSS 2.1 specification (<a data-link-type="biblio" href="#biblio-css21" title="Cascading Style Sheets Level 2 Revision 1 (CSS 2.1) Specification">[CSS21]</a>) for details.</p>
   <p>As a result of the computation of containing blocks for the tree, the boxes
  belonging to the <a data-link-type="dfn" href="#wrapping-context" id="ref-for-wrapping-context①⑧">wrapping context</a>s of all the elements can be determined:</p>
   <ul>
    <li>The <a data-link-type="dfn" href="#wrapping-context" id="ref-for-wrapping-context①⑨">wrapping context</a> for the html element contains the <code class="idl">e2</code> box: WC-1 (Wrapping Context 1) 
    <li>The <a data-link-type="dfn" href="#wrapping-context" id="ref-for-wrapping-context②⓪">wrapping context</a> for the body element inherits the html
    element’s <span id="ref-for-wrapping-context②①">wrapping context</span>: WC-1 
    <li>The <a data-link-type="dfn" href="#wrapping-context" id="ref-for-wrapping-context②②">wrapping context</a> for <code class="idl">d1</code> inherits the
    body element’s <span id="ref-for-wrapping-context②③">wrapping context</span> and adds the <code class="idl">e1-box</code> to it. So the wrapping context is made of both the <code class="idl">e1-box</code> and the <code class="idl">e2-box</code>:
    WC-2
    <li>The <a data-link-type="dfn" href="#wrapping-context" id="ref-for-wrapping-context②④">wrapping context</a> for <code class="idl">d2</code> inherits the
    body element’s <span id="ref-for-wrapping-context②⑤">wrapping context</span>: WC-1 
   </ul>
   <h5 class="heading settled" data-level="3.5.6.2" id="example-step-2"><span class="secno">3.5.6.2. </span><span class="content"> Step 2: resolve wrapping contexts and lay out containing blocks</span><a class="self-link" href="#example-step-2"></a></h5>
   <p>In this step, each containing block is processed in turn. For each containing
  block, we (conceptually) go through two phases:</p>
   <ol>
    <li>resolve the <a data-link-type="dfn" href="#wrapping-context" id="ref-for-wrapping-context②⑥">wrapping context</a>: resolve the position and size of its
  exclusions 
    <li>lay out the containing block 
   </ol>
   <p>In our example, this breaks down to:</p>
   <ol>
    <li>resolve the position and size of the exclusions belonging to WC-1:
    RWC-1 (Resolved Wrapping Context 1). 
    <li>
     lay out the initial containing block (i.e., lay out its content): 
     <ol>
      <li>resolve the html element’s <a data-link-type="dfn" href="#wrapping-context" id="ref-for-wrapping-context②⑦">wrapping context</a>: RWC-1 
      <li>
       lay out the html element: 
       <ol>
        <li>resolve the body element’s <a data-link-type="dfn" href="#wrapping-context" id="ref-for-wrapping-context②⑧">wrapping context</a>: RWC-1 
        <li>
         lay out the body element: 
         <ol>
          <li>resolve the <code class="idl">d1</code> element’s <a data-link-type="dfn" href="#wrapping-context" id="ref-for-wrapping-context②⑨">wrapping
              context</a>: RWC-2 
          <li>lay out the <code class="idl">d1</code> element 
          <li>resolve the <code class="idl">d2</code> element’s <a data-link-type="dfn" href="#wrapping-context" id="ref-for-wrapping-context③⓪">wrapping
              context</a>: RWC-1 
          <li>lay out the <code class="idl">d2</code> element 
         </ol>
       </ol>
     </ol>
   </ol>
   <h6 class="heading settled" data-level="3.5.6.2.1" id="example-resolving-rwc-1"><span class="secno">3.5.6.2.1. </span><span class="content"> Resolving RWC-1</span><a class="self-link" href="#example-resolving-rwc-1"></a></h6>
   <p>The top-most <a data-link-type="dfn" href="#wrapping-context" id="ref-for-wrapping-context③①">wrapping context</a> in the layout tree contains the <code class="idl">e2</code> exclusion. Its position and size needs to be
  resolved. In general, computing an exclusion’s position and size may or may
  not require laying out other content. In this example, no content needs to be
  laid out to resolve the <code class="idl">e2</code> exclusion’s position
  because it is absolutely positioned and its size can be resolved without
  layout either. At this point, RWC-1 is resolved and can be used when laying
  inline content out.</p>
   <p></p>
   <h6 class="heading settled" data-level="3.5.6.2.2" id="example-resolving-rwc-2"><span class="secno">3.5.6.2.2. </span><span class="content"> Resolving RWC-2</span><a class="self-link" href="#example-resolving-rwc-2"></a></h6>
   <p>The process is similar: the position of the <code class="idl">e1</code> exclusion needs to be resolved. Again, resolving the exclusion’s position and
  size may require processing the containing block (d1 here). It is the case here
  because the size and position of <code class="idl">e1</code> depend on
  resolving the percentage lengths. The percentages are relative to the size of <code class="idl">d1</code>’s box. As a result, in order to resolve a size for <code class="idl">d1</code>’s box, a first layout of <code class="idl">d1</code> is done without any <a data-link-type="dfn" href="#wrapping-context" id="ref-for-wrapping-context③②">wrapping context</a> (i.e., no exclusions applied).
  The layout yields a position and size for <code class="idl">e1</code>’s box.</p>
   <p>At this point, RWC-2 is resolved because the position and size of both e1 and
  e2 are resolved.</p>
   <p class="note" role="note">The important aspect of the above processing example is that
  once an element’s <a data-link-type="dfn" href="#wrapping-context" id="ref-for-wrapping-context③③">wrapping context</a> is resolved (by resolving its
  exclusions' position and size), the position and size of the exclusions are
  not re-processed if the element’s size changes between the layout that may be
  done without considering any <span id="ref-for-wrapping-context③④">wrapping context</span> (as for RWC-2) and the
  layout done with the resolved <span id="ref-for-wrapping-context③⑤">wrapping context</span>. This is what breaks the
  possible circular dependency between the resolution of <span id="ref-for-wrapping-context③⑥">wrapping context</span>s
  and the layout of containing blocks.</p>
   <h3 class="heading settled" data-level="3.6" id="floats-and-exclusions"><span class="secno">3.6. </span><span class="content"> Floats and exclusions</span><a class="self-link" href="#floats-and-exclusions"></a></h3>
   <h4 class="heading settled" data-level="3.6.1" id="floats-and-exclusions-similarities"><span class="secno">3.6.1. </span><span class="content"> Similarities</span><a class="self-link" href="#floats-and-exclusions-similarities"></a></h4>
   <p>There are similarities between floats and exclusions in that inline content
  wraps around floats and also wraps around <span>exclusion areas</span>. However,
  there are very significant differences.</p>
   <h4 class="heading settled" data-level="3.6.2" id="floats-and-exclusions-differences"><span class="secno">3.6.2. </span><span class="content"> Differences</span><a class="self-link" href="#floats-and-exclusions-differences"></a></h4>
   <ul>
    <li><strong>scope</strong>. While floats apply to content that follows in the
    document, exclusions apply to content in their containing block. 
    <li><strong>positioning</strong>. Floats are part of the inline flow and <a class="property css" data-link-type="property" href="https://drafts.csswg.org/css2/#propdef-float" id="ref-for-propdef-float①">float</a> on the line box. Authors can control how the floats move on the line
    box, to the right or to the left. By contrast, exclusions can be positioned
    using any positioning scheme such as grid layout (<a data-link-type="biblio" href="#biblio-css3-grid-layout" title="CSS Grid Layout Module Level 1">[CSS3-GRID-LAYOUT]</a>),
    flexible box (<a data-link-type="biblio" href="#biblio-css3-flexbox" title="CSS Flexible Box Layout Module Level 1">[CSS3-FLEXBOX]</a>) or any other CSS positioning scheme. 
    <li><strong>separation of concerns</strong>. Making an element a float
    determines both its positioning scheme and its effect on inline content.
    Making an element an exclusion only determines its impact on inline content
    and does not impose constraints on its positioning method. 
   </ul>
   <h4 class="heading settled" data-level="3.6.3" id="floats-interop"><span class="secno">3.6.3. </span><span class="content"> Interoperability</span><a class="self-link" href="#floats-interop"></a></h4>
   <h5 class="heading settled" data-level="3.6.3.1" id="effect-of-floats-on-exclusions"><span class="secno">3.6.3.1. </span><span class="content"> Effect of floats on exclusions</span><a class="self-link" href="#effect-of-floats-on-exclusions"></a></h5>
   <p>Floats have an effect on the positioning of exclusions and the layout of their
  inline content. For example, if an exclusion is an inline-box which happens to
  be on the same line as a float, its position, as computed in <a href="#step-2-A">Step 2-A</a> will be impacted by the float, as is any other
  inline content.</p>
   <h5 class="heading settled" data-level="3.6.3.2" id="effect-of-exclusions-on-floats"><span class="secno">3.6.3.2. </span><span class="content"> Effect of exclusions on floats</span><a class="self-link" href="#effect-of-exclusions-on-floats"></a></h5>
   <p>Exclusions have an effect on the positioning of floats as they have an effect
  on inline content. Therefore, in <a href="#step-2-B">Step 2-B</a>, floats will
  avoid <a data-link-type="dfn" href="#exclusion-area" id="ref-for-exclusion-area⑦">exclusion areas</a>.</p>
   <h2 class="no-num heading settled" id="acks"><span class="content"> Acknowledgments</span><a class="self-link" href="#acks"></a></h2>
   <p>This specification is made possible by input from
  Andrei Bucur,
  Alexandru Chiculita,
  Arron Eicholz,
  Daniel Glazman,
  Arno Gourdol,
  Chris Jones,
  Bem Jones-Bey,
  Marcus Mielke,
  Alex Mogilevsky,
  Hans Muller,
  Mihnea Ovidenie,
  Virgil Palanciuc,
  Florian Rivoal,
  Peter Sorotokin,
  Bear Travis,
  Eugene Veselov,
  Stephen Zilles
  and the CSS Working Group members.</p>
   <h2 class="no-num heading settled" id="changes"><span class="content">Changes</span><a class="self-link" href="#changes"></a></h2>
   <h3 class="no-num heading settled" id="recent-changes"><span class="content"> Changes from the <a href="https://www.w3.org/TR/2015/WD-css3-exclusions-20150115/">15 January 2015 Working Draft</a></span><a class="self-link" href="#recent-changes"></a></h3>
   <h3 class="no-num heading settled" id="changes-2013"><span class="content"> Changes from the <a href="https://www.w3.org/TR/2013/WD-css3-exclusions-20130528/">28 May 2013 Working Draft</a></span><a class="self-link" href="#changes-2013"></a></h3>
   <ul>
    <li>Editorial fixes. 
   </ul>
   <h3 class="no-num heading settled" id="changes-2012"><span class="content"> Changes from the <a href="https://www.w3.org/TR/2012/WD-css3-exclusions-20120503/">3 May 2012 Working Draft</a></span><a class="self-link" href="#changes-2012"></a></h3>
   <ul>
    <li>Split Exclusions from Shapes. 
    <li>Improved exclusion order example. 
    <li>Editorial and markup fixes. 
    <li>See also the Changes section of <a href="https://www.w3.org/TR/css-shapes/#20120503">CSS Shapes</a>. 
   </ul>
  </main>
  <h2 class="no-ref no-num heading settled" id="w3c-conformance"><span class="content"> Conformance</span><a class="self-link" href="#w3c-conformance"></a></h2>
  <h3 class="no-ref heading settled" id="w3c-conventions"><span class="content"> Document conventions</span><a class="self-link" href="#w3c-conventions"></a></h3>
  <p>Conformance requirements are expressed with a combination of
    descriptive assertions and RFC 2119 terminology. The key words “MUST”,
    “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”,
    “RECOMMENDED”, “MAY”, and “OPTIONAL” in the normative parts of this
    document are to be interpreted as described in RFC 2119.
    However, for readability, these words do not appear in all uppercase
    letters in this specification. </p>
  <p>All of the text of this specification is normative except sections
    explicitly marked as non-normative, examples, and notes. <a data-link-type="biblio" href="#biblio-rfc2119" title="Key words for use in RFCs to Indicate Requirement Levels">[RFC2119]</a></p>
  <p>Examples in this specification are introduced with the words “for example”
    or are set apart from the normative text with <code>class="example"</code>,
    like this: </p>
  <div class="example" id="w3c-example">
   <a class="self-link" href="#w3c-example"></a> 
   <p>This is an example of an informative example.</p>
  </div>
  <p>Informative notes begin with the word “Note” and are set apart from the
    normative text with <code>class="note"</code>, like this: </p>
  <p class="note" role="note">Note, this is an informative note.</p>
  <p>Advisements are normative sections styled to evoke special attention and are
    set apart from other normative text with <code>&lt;strong class="advisement"></code>, like
    this: <strong class="advisement"> UAs MUST provide an accessible alternative. </strong></p>
  <details class="wpt-tests-block" dir="ltr" lang="en" open>
   <summary>Tests</summary>
   <p>Tests relating to the content of this specification
                     may be documented in “Tests” blocks like this one.
                     Any such block is non-normative.</p>
   <ul class="wpt-tests-list"></ul>
   <hr>
  </details>
  <h3 class="no-ref heading settled" id="w3c-conformance-classes"><span class="content"> Conformance classes</span><a class="self-link" href="#w3c-conformance-classes"></a></h3>
  <p>Conformance to this specification
    is defined for three conformance classes: </p>
  <dl>
   <dt>style sheet 
   <dd>A <a href="http://www.w3.org/TR/CSS21/conform.html#style-sheet">CSS
            style sheet</a>. 
   <dt>renderer 
   <dd>A <a href="http://www.w3.org/TR/CSS21/conform.html#user-agent">UA</a> that interprets the semantics of a style sheet and renders
            documents that use them. 
   <dt>authoring tool 
   <dd>A <a href="http://www.w3.org/TR/CSS21/conform.html#user-agent">UA</a> that writes a style sheet. 
  </dl>
  <p>A style sheet is conformant to this specification
    if all of its statements that use syntax defined in this module are valid
    according to the generic CSS grammar and the individual grammars of each
    feature defined in this module. </p>
  <p>A renderer is conformant to this specification
    if, in addition to interpreting the style sheet as defined by the
    appropriate specifications, it supports all the features defined
    by this specification by parsing them correctly
    and rendering the document accordingly. However, the inability of a
    UA to correctly render a document due to limitations of the device
    does not make the UA non-conformant. (For example, a UA is not
    required to render color on a monochrome monitor.) </p>
  <p>An authoring tool is conformant to this specification
    if it writes style sheets that are syntactically correct according to the
    generic CSS grammar and the individual grammars of each feature in
    this module, and meet all other conformance requirements of style sheets
    as described in this module. </p>
  <h3 class="no-ref heading settled" id="w3c-partial"><span class="content"> Partial implementations</span><a class="self-link" href="#w3c-partial"></a></h3>
  <p>So that authors can exploit the forward-compatible parsing rules to
    assign fallback values, CSS renderers <strong>must</strong> treat as invalid (and <a href="http://www.w3.org/TR/CSS21/conform.html#ignore">ignore
    as appropriate</a>) any at-rules, properties, property values, keywords,
    and other syntactic constructs for which they have no usable level of
    support. In particular, user agents <strong>must not</strong> selectively
    ignore unsupported component values and honor supported values in a single
    multi-value property declaration: if any value is considered invalid
    (as unsupported values must be), CSS requires that the entire declaration
    be ignored.</p>
  <h4 class="heading settled" id="w3c-conform-future-proofing"><span class="content"> Implementations of Unstable and Proprietary Features</span><a class="self-link" href="#w3c-conform-future-proofing"></a></h4>
  <p>To avoid clashes with future stable CSS features,
        the CSSWG recommends <a href="http://www.w3.org/TR/CSS/#future-proofing">following best practices</a> for the implementation of <a href="http://www.w3.org/TR/CSS/#unstable">unstable</a> features and <a href="http://www.w3.org/TR/CSS/#proprietary-extension">proprietary extensions</a> to CSS. </p>
  <h3 class="no-ref heading settled" id="w3c-testing"><span class="content"> Non-experimental implementations</span><a class="self-link" href="#w3c-testing"></a></h3>
  <p>Once a specification reaches the Candidate Recommendation stage,
    non-experimental implementations are possible, and implementors should
    release an unprefixed implementation of any CR-level feature they
    can demonstrate to be correctly implemented according to spec. </p>
  <p>To establish and maintain the interoperability of CSS across
    implementations, the CSS Working Group requests that non-experimental
    CSS renderers submit an implementation report (and, if necessary, the
    testcases used for that implementation report) to the W3C before
    releasing an unprefixed implementation of any CSS features. Testcases
    submitted to W3C are subject to review and correction by the CSS
    Working Group. </p>
  <p>Further information on submitting testcases and implementation reports
    can be found from on the CSS Working Group’s website at <a href="http://www.w3.org/Style/CSS/Test/">http://www.w3.org/Style/CSS/Test/</a>.
    Questions should be directed to the <a href="http://lists.w3.org/Archives/Public/public-css-testsuite">public-css-testsuite@w3.org</a> mailing list.</p>
  <script src="https://www.w3.org/scripts/TR/2021/fixup.js"></script>
  <h2 class="no-num no-ref heading settled" id="index"><span class="content">Index</span><a class="self-link" href="#index"></a></h2>
  <h3 class="no-num no-ref heading settled" id="index-defined-here"><span class="content">Terms defined by this specification</span><a class="self-link" href="#index-defined-here"></a></h3>
  <ul class="index">
   <li><a href="#valdef-wrap-flow-auto">auto</a><span>, in § 3.1.1</span>
   <li><a href="#valdef-wrap-flow-both">both</a><span>, in § 3.1.1</span>
   <li><a href="#valdef-wrap-flow-clear">clear</a><span>, in § 3.1.1</span>
   <li><a href="#content-area">Content area</a><span>, in § 2</span>
   <li><a href="#valdef-wrap-flow-end">end</a><span>, in § 3.1.1</span>
   <li><a href="#exclusion-area">Exclusion area</a><span>, in § 2</span>
   <li><a href="#exclusion-box">Exclusion box</a><span>, in § 2</span>
   <li><a href="#exclusion-element">Exclusion element</a><span>, in § 2</span>
   <li><a href="#inside">inside</a><span>, in § 2</span>
   <li><a href="#valdef-wrap-flow-maximum">maximum</a><span>, in § 3.1.1</span>
   <li><a href="#valdef-wrap-flow-minimum">minimum</a><span>, in § 3.1.1</span>
   <li><a href="#valdef-wrap-through-none">none</a><span>, in § 3.3.1</span>
   <li><a href="#outside">Outside</a><span>, in § 2</span>
   <li><a href="#valdef-wrap-flow-start">start</a><span>, in § 3.1.1</span>
   <li><a href="#valdef-wrap-through-wrap">wrap</a><span>, in § 3.3.1</span>
   <li><a href="#propdef-wrap-flow">wrap-flow</a><span>, in § 3.1.1</span>
   <li><a href="#wrapping-area">Wrapping area</a><span>, in § 2</span>
   <li><a href="#wrapping-context">Wrapping context</a><span>, in § 2</span>
   <li><a href="#propdef-wrap-through">wrap-through</a><span>, in § 3.3.1</span>
  </ul>
  <h3 class="no-num no-ref heading settled" id="index-defined-elsewhere"><span class="content">Terms defined by reference</span><a class="self-link" href="#index-defined-elsewhere"></a></h3>
  <ul class="index">
   <li>
    <a data-link-type="biblio">[CSS-ANCHOR-POSITION-1]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="8ff3565c">outside</span>
    </ul>
   <li>
    <a data-link-type="biblio">[CSS-BOX-4]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="f598742d">border box</span>
    </ul>
   <li>
    <a data-link-type="biblio">[CSS-PAGE-FLOATS-3]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="7b16d6ab">none</span>
    </ul>
   <li>
    <a data-link-type="biblio">[CSS-POSITION-3]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="b7221005">fixed</span>
     <li><span class="dfn-paneled" id="b8a0ba74">position</span>
    </ul>
   <li>
    <a data-link-type="biblio">[CSS-VALUES-4]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="358fd6ff">css-wide keywords</span>
     <li><span class="dfn-paneled" id="6ec67710">|</span>
    </ul>
   <li>
    <a data-link-type="biblio">[CSS21]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="5455396f">z-index</span>
    </ul>
   <li>
    <a data-link-type="biblio">[CSS22]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="0570259e">float</span>
    </ul>
  </ul>
  <h2 class="no-num no-ref heading settled" id="references"><span class="content">References</span><a class="self-link" href="#references"></a></h2>
  <h3 class="no-num no-ref heading settled" id="normative"><span class="content">Normative References</span><a class="self-link" href="#normative"></a></h3>
  <dl>
   <dt id="biblio-css-anchor-position-1">[CSS-ANCHOR-POSITION-1]
   <dd>Tab Atkins Jr.; Elika Etemad; Ian Kilpatrick. <a href="https://drafts.csswg.org/css-anchor-position-1/"><cite>CSS Anchor Positioning</cite></a>. URL: <a href="https://drafts.csswg.org/css-anchor-position-1/">https://drafts.csswg.org/css-anchor-position-1/</a>
   <dt id="biblio-css-box-4">[CSS-BOX-4]
   <dd>Elika Etemad. <a href="https://drafts.csswg.org/css-box-4/"><cite>CSS Box Model Module Level 4</cite></a>. URL: <a href="https://drafts.csswg.org/css-box-4/">https://drafts.csswg.org/css-box-4/</a>
   <dt id="biblio-css-page-floats-3">[CSS-PAGE-FLOATS-3]
   <dd>Johannes Wilm. <a href="https://drafts.csswg.org/css-page-floats/"><cite>CSS Page Floats</cite></a>. URL: <a href="https://drafts.csswg.org/css-page-floats/">https://drafts.csswg.org/css-page-floats/</a>
   <dt id="biblio-css-position-3">[CSS-POSITION-3]
   <dd>Elika Etemad; Tab Atkins Jr.. <a href="https://drafts.csswg.org/css-position-3/"><cite>CSS Positioned Layout Module Level 3</cite></a>. URL: <a href="https://drafts.csswg.org/css-position-3/">https://drafts.csswg.org/css-position-3/</a>
   <dt id="biblio-css-values-3">[CSS-VALUES-3]
   <dd>Tab Atkins Jr.; Elika Etemad. <a href="https://drafts.csswg.org/css-values-3/"><cite>CSS Values and Units Module Level 3</cite></a>. URL: <a href="https://drafts.csswg.org/css-values-3/">https://drafts.csswg.org/css-values-3/</a>
   <dt id="biblio-css-values-4">[CSS-VALUES-4]
   <dd>Tab Atkins Jr.; Elika Etemad. <a href="https://drafts.csswg.org/css-values-4/"><cite>CSS Values and Units Module Level 4</cite></a>. URL: <a href="https://drafts.csswg.org/css-values-4/">https://drafts.csswg.org/css-values-4/</a>
   <dt id="biblio-css21">[CSS21]
   <dd>Bert Bos; et al. <a href="https://drafts.csswg.org/css2/"><cite>Cascading Style Sheets Level 2 Revision 1 (CSS 2.1) Specification</cite></a>. URL: <a href="https://drafts.csswg.org/css2/">https://drafts.csswg.org/css2/</a>
   <dt id="biblio-css22">[CSS22]
   <dd>Bert Bos. <a href="https://drafts.csswg.org/css2/"><cite>Cascading Style Sheets Level 2 Revision 2 (CSS 2.2) Specification</cite></a>. URL: <a href="https://drafts.csswg.org/css2/">https://drafts.csswg.org/css2/</a>
   <dt id="biblio-css3-writing-modes">[CSS3-WRITING-MODES]
   <dd>Elika Etemad; Koji Ishii. <a href="https://drafts.csswg.org/css-writing-modes-3/"><cite>CSS Writing Modes Level 3</cite></a>. URL: <a href="https://drafts.csswg.org/css-writing-modes-3/">https://drafts.csswg.org/css-writing-modes-3/</a>
   <dt id="biblio-css3box">[CSS3BOX]
   <dd>Elika Etemad. <a href="https://drafts.csswg.org/css-box-3/"><cite>CSS Box Model Module Level 3</cite></a>. URL: <a href="https://drafts.csswg.org/css-box-3/">https://drafts.csswg.org/css-box-3/</a>
   <dt id="biblio-rfc2119">[RFC2119]
   <dd>S. Bradner. <a href="https://datatracker.ietf.org/doc/html/rfc2119"><cite>Key words for use in RFCs to Indicate Requirement Levels</cite></a>. March 1997. Best Current Practice. URL: <a href="https://datatracker.ietf.org/doc/html/rfc2119">https://datatracker.ietf.org/doc/html/rfc2119</a>
  </dl>
  <h3 class="no-num no-ref heading settled" id="informative"><span class="content">Informative References</span><a class="self-link" href="#informative"></a></h3>
  <dl>
   <dt id="biblio-css3-flexbox">[CSS3-FLEXBOX]
   <dd>Tab Atkins Jr.; et al. <a href="https://drafts.csswg.org/css-flexbox-1/"><cite>CSS Flexible Box Layout Module Level 1</cite></a>. URL: <a href="https://drafts.csswg.org/css-flexbox-1/">https://drafts.csswg.org/css-flexbox-1/</a>
   <dt id="biblio-css3-grid-layout">[CSS3-GRID-LAYOUT]
   <dd>Tab Atkins Jr.; et al. <a href="https://drafts.csswg.org/css-grid/"><cite>CSS Grid Layout Module Level 1</cite></a>. URL: <a href="https://drafts.csswg.org/css-grid/">https://drafts.csswg.org/css-grid/</a>
  </dl>
  <h2 class="no-num no-ref heading settled" id="property-index"><span class="content">Property Index</span><a class="self-link" href="#property-index"></a></h2>
  <div class="big-element-wrapper">
   <table class="index">
    <thead>
     <tr>
      <th scope="col">Name
      <th scope="col">Value
      <th scope="col">Initial
      <th scope="col">Applies to
      <th scope="col">Inh.
      <th scope="col">%ages
      <th scope="col">Canonical order
      <th scope="col">Com­puted value
    <tbody>
     <tr>
      <th scope="row"><a class="css" data-link-type="property" href="#propdef-wrap-flow" id="ref-for-propdef-wrap-flow①①">wrap-flow</a>
      <td>auto | both | start | end | minimum | maximum | clear
      <td>auto
      <td>block-level elements.
      <td>no
      <td>N/A
      <td>per grammar
      <td>as specified except for element’s whose float computed value is not none, in which case the computed value is auto.
     <tr>
      <th scope="row"><a class="css" data-link-type="property" href="#propdef-wrap-through" id="ref-for-propdef-wrap-through⑥">wrap-through</a>
      <td>wrap | none
      <td>wrap
      <td>block-level elements
      <td>no
      <td>N/A
      <td>per grammar
      <td>as specified
   </table>
  </div>
  <h2 class="no-num no-ref heading settled" id="issues-index"><span class="content">Issues Index</span><a class="self-link" href="#issues-index"></a></h2>
  <div style="counter-reset:issue">
   <div class="issue">
    <p>The current draft provides a model for exclusions
  without a collision-avoidance model.
  The existing exclusion model in CSS uses floats,
  which have both exclusion and collision-avoidance behavior.
  Concerns have been raised that allowing exclusions
  without collision avoidance could be harmful,
  particularly with absolutely-positioned elements.
  Three options should be considered:</p>
    <ol>
     <li>Allow exclusions in positioning schemes
      with no collision avoidance.
     <li>Disallow exclusions in positioning schemes
      with no collision avoidance.
     <li>Define collision-avoidance behavior
      for positioning schemes without it,
      and use this behavior by default with exclusions.
    </ol>
     <a class="issue-return" href="#issue-5c31dc98" title="Jump to section">↵</a>
   </div>
  </div>
<script>/* Boilerplate: script-dom-helper */
"use strict";
function query(sel) { return document.querySelector(sel); }

function queryAll(sel) { return [...document.querySelectorAll(sel)]; }

function iter(obj) {
	if(!obj) return [];
	var it = obj[Symbol.iterator];
	if(it) return it;
	return Object.entries(obj);
}

function mk(tagname, attrs, ...children) {
	const el = document.createElement(tagname);
	for(const [k,v] of iter(attrs)) {
		if(k.slice(0,3) == "_on") {
			const eventName = k.slice(3);
			el.addEventListener(eventName, v);
		} else if(k[0] == "_") {
			// property, not attribute
			el[k.slice(1)] = v;
		} else {
			if(v === false || v == null) {
        continue;
      } else if(v === true) {
        el.setAttribute(k, "");
        continue;
      } else {
  			el.setAttribute(k, v);
      }
		}
	}
	append(el, children);
	return el;
}

/* Create shortcuts for every known HTML element */
[
  "a",
  "abbr",
  "acronym",
  "address",
  "applet",
  "area",
  "article",
  "aside",
  "audio",
  "b",
  "base",
  "basefont",
  "bdo",
  "big",
  "blockquote",
  "body",
  "br",
  "button",
  "canvas",
  "caption",
  "center",
  "cite",
  "code",
  "col",
  "colgroup",
  "datalist",
  "dd",
  "del",
  "details",
  "dfn",
  "dialog",
  "div",
  "dl",
  "dt",
  "em",
  "embed",
  "fieldset",
  "figcaption",
  "figure",
  "font",
  "footer",
  "form",
  "frame",
  "frameset",
  "head",
  "header",
  "h1",
  "h2",
  "h3",
  "h4",
  "h5",
  "h6",
  "hr",
  "html",
  "i",
  "iframe",
  "img",
  "input",
  "ins",
  "kbd",
  "label",
  "legend",
  "li",
  "link",
  "main",
  "map",
  "mark",
  "meta",
  "meter",
  "nav",
  "nobr",
  "noscript",
  "object",
  "ol",
  "optgroup",
  "option",
  "output",
  "p",
  "param",
  "pre",
  "progress",
  "q",
  "s",
  "samp",
  "script",
  "section",
  "select",
  "small",
  "source",
  "span",
  "strike",
  "strong",
  "style",
  "sub",
  "summary",
  "sup",
  "table",
  "tbody",
  "td",
  "template",
  "textarea",
  "tfoot",
  "th",
  "thead",
  "time",
  "title",
  "tr",
  "u",
  "ul",
  "var",
  "video",
  "wbr",
  "xmp",
].forEach(tagname=>{
	mk[tagname] = (...args) => mk(tagname, ...args);
});

function* nodesFromChildList(children) {
	for(const child of children.flat(Infinity)) {
		if(child instanceof Node) {
			yield child;
		} else {
			yield new Text(child);
		}
	}
}
function append(el, ...children) {
	for(const child of nodesFromChildList(children)) {
		if(el instanceof Node) el.appendChild(child);
		else el.push(child);
	}
	return el;
}

function insertAfter(el, ...children) {
	for(const child of nodesFromChildList(children)) {
		el.parentNode.insertBefore(child, el.nextSibling);
	}
	return el;
}

function clearContents(el) {
	el.innerHTML = "";
	return el;
}

function parseHTML(markup) {
	if(markup.toLowerCase().trim().indexOf('<!doctype') === 0) {
		const doc = document.implementation.createHTMLDocument("");
		doc.documentElement.innerHTML = markup;
		return doc;
	} else {
		const el = mk.template({});
		el.innerHTML = markup;
		return el.content;
	}
}</script>
<script>/* Boilerplate: script-dfn-panel */
"use strict";
{
let dfnPanelData = {
"0570259e": {"dfnID":"0570259e","dfnText":"float","external":true,"refSections":[{"refs":[{"id":"ref-for-propdef-float"}],"title":"3.1.1. \nThe wrap-flow property"},{"refs":[{"id":"ref-for-propdef-float\u2460"}],"title":"3.6.2. \nDifferences"}],"url":"https://drafts.csswg.org/css2/#propdef-float"},
"358fd6ff": {"dfnID":"358fd6ff","dfnText":"css-wide keywords","external":true,"refSections":[{"refs":[{"id":"ref-for-css-wide-keywords"}],"title":"1.1. \nValue Definitions"}],"url":"https://drafts.csswg.org/css-values-4/#css-wide-keywords"},
"5455396f": {"dfnID":"5455396f","dfnText":"z-index","external":true,"refSections":[{"refs":[{"id":"ref-for-propdef-z-index"}],"title":"3. \nExclusions"},{"refs":[{"id":"ref-for-propdef-z-index\u2460"},{"id":"ref-for-propdef-z-index\u2461"}],"title":"3.4. \nExclusions order"}],"url":"https://www.w3.org/TR/CSS21/visuren.html#propdef-z-index"},
"6ec67710": {"dfnID":"6ec67710","dfnText":"|","external":true,"refSections":[{"refs":[{"id":"ref-for-comb-one"},{"id":"ref-for-comb-one\u2460"},{"id":"ref-for-comb-one\u2461"},{"id":"ref-for-comb-one\u2462"},{"id":"ref-for-comb-one\u2463"},{"id":"ref-for-comb-one\u2464"}],"title":"3.1.1. \nThe wrap-flow property"},{"refs":[{"id":"ref-for-comb-one\u2465"}],"title":"3.3.1. \nThe wrap-through Property"}],"url":"https://drafts.csswg.org/css-values-4/#comb-one"},
"7b16d6ab": {"dfnID":"7b16d6ab","dfnText":"none","external":true,"refSections":[{"refs":[{"id":"ref-for-valdef-float-none"}],"title":"2. \nTerminology"},{"refs":[{"id":"ref-for-valdef-float-none\u2460"}],"title":"3.1.1. \nThe wrap-flow property"}],"url":"https://drafts.csswg.org/css-page-floats-3/#valdef-float-none"},
"8ff3565c": {"dfnID":"8ff3565c","dfnText":"outside","external":true,"refSections":[{"refs":[{"id":"ref-for-valdef-anchor-outside"}],"title":"3.3. \nPropagation of Exclusions"}],"url":"https://drafts.csswg.org/css-anchor-position-1/#valdef-anchor-outside"},
"b7221005": {"dfnID":"b7221005","dfnText":"fixed","external":true,"refSections":[{"refs":[{"id":"ref-for-valdef-position-fixed"}],"title":"3.2. \nScope and effect of exclusions"},{"refs":[{"id":"ref-for-valdef-position-fixed\u2460"}],"title":"3.5.4. \nStep 2-A: resolve the position and size of exclusion boxes"}],"url":"https://drafts.csswg.org/css-position-3/#valdef-position-fixed"},
"b8a0ba74": {"dfnID":"b8a0ba74","dfnText":"position","external":true,"refSections":[{"refs":[{"id":"ref-for-propdef-position"}],"title":"3.2. \nScope and effect of exclusions"},{"refs":[{"id":"ref-for-propdef-position\u2460"}],"title":"3.5.4. \nStep 2-A: resolve the position and size of exclusion boxes"}],"url":"https://drafts.csswg.org/css-position-3/#propdef-position"},
"content-area": {"dfnID":"content-area","dfnText":"Content area","external":false,"refSections":[{"refs":[{"id":"ref-for-content-area"}],"title":"2. \nTerminology"}],"url":"#content-area"},
"exclusion-area": {"dfnID":"exclusion-area","dfnText":"Exclusion area","external":false,"refSections":[{"refs":[{"id":"ref-for-exclusion-area"},{"id":"ref-for-exclusion-area\u2460"}],"title":"3.1.1. \nThe wrap-flow property"},{"refs":[{"id":"ref-for-exclusion-area\u2461"}],"title":"3.5.1. \nDescription"},{"refs":[{"id":"ref-for-exclusion-area\u2462"}],"title":"3.5.2. \nStep 1: resolve exclusion boxes belonging to each wrapping context"},{"refs":[{"id":"ref-for-exclusion-area\u2463"},{"id":"ref-for-exclusion-area\u2464"}],"title":"3.5.4. \nStep 2-A: resolve the position and size of exclusion boxes"},{"refs":[{"id":"ref-for-exclusion-area\u2465"}],"title":"3.5.5. \nStep 2-B: lay out containing block applying wrapping"},{"refs":[{"id":"ref-for-exclusion-area\u2466"}],"title":"3.6.3.2. \nEffect of exclusions on floats"}],"url":"#exclusion-area"},
"exclusion-box": {"dfnID":"exclusion-box","dfnText":"Exclusion box","external":false,"refSections":[{"refs":[{"id":"ref-for-exclusion-box"},{"id":"ref-for-exclusion-box\u2460"},{"id":"ref-for-exclusion-box\u2461"},{"id":"ref-for-exclusion-box\u2462"},{"id":"ref-for-exclusion-box\u2463"}],"title":"3.5.4. \nStep 2-A: resolve the position and size of exclusion boxes"},{"refs":[{"id":"ref-for-exclusion-box\u2464"}],"title":"3.5.5. \nStep 2-B: lay out containing block applying wrapping"}],"url":"#exclusion-box"},
"exclusion-element": {"dfnID":"exclusion-element","dfnText":"Exclusion element","external":false,"refSections":[{"refs":[{"id":"ref-for-exclusion-element"},{"id":"ref-for-exclusion-element\u2460"}],"title":"3.1.1. \nThe wrap-flow property"}],"url":"#exclusion-element"},
"f598742d": {"dfnID":"f598742d","dfnText":"border box","external":true,"refSections":[{"refs":[{"id":"ref-for-border-box"}],"title":"2. \nTerminology"}],"url":"https://drafts.csswg.org/css-box-4/#border-box"},
"inside": {"dfnID":"inside","dfnText":"inside","external":false,"refSections":[{"refs":[{"id":"ref-for-inside"}],"title":"2. \nTerminology"},{"refs":[{"id":"ref-for-inside\u2460"}],"title":"3.3.1. \nThe wrap-through Property"}],"url":"#inside"},
"outside": {"dfnID":"outside","dfnText":"Outside","external":false,"refSections":[{"refs":[{"id":"ref-for-outside"}],"title":"2. \nTerminology"},{"refs":[{"id":"ref-for-outside\u2460"}],"title":"3.3. \nPropagation of Exclusions"},{"refs":[{"id":"ref-for-outside\u2461"}],"title":"3.3.1. \nThe wrap-through Property"}],"url":"#outside"},
"propdef-wrap-flow": {"dfnID":"propdef-wrap-flow","dfnText":"wrap-flow","external":false,"refSections":[{"refs":[{"id":"ref-for-propdef-wrap-flow"}],"title":"2. \nTerminology"},{"refs":[{"id":"ref-for-propdef-wrap-flow\u2460"}],"title":"3.1. \nDeclaring exclusions"},{"refs":[{"id":"ref-for-propdef-wrap-flow\u2461"},{"id":"ref-for-propdef-wrap-flow\u2462"},{"id":"ref-for-propdef-wrap-flow\u2463"},{"id":"ref-for-propdef-wrap-flow\u2464"},{"id":"ref-for-propdef-wrap-flow\u2465"},{"id":"ref-for-propdef-wrap-flow\u2466"},{"id":"ref-for-propdef-wrap-flow\u2467"},{"id":"ref-for-propdef-wrap-flow\u2468"}],"title":"3.1.1. \nThe wrap-flow property"},{"refs":[{"id":"ref-for-propdef-wrap-flow\u2460\u24ea"}],"title":"3.5.2. \nStep 1: resolve exclusion boxes belonging to each wrapping context"}],"url":"#propdef-wrap-flow"},
"propdef-wrap-through": {"dfnID":"propdef-wrap-through","dfnText":"wrap-through","external":false,"refSections":[{"refs":[{"id":"ref-for-propdef-wrap-through"}],"title":"2. \nTerminology"},{"refs":[{"id":"ref-for-propdef-wrap-through\u2460"}],"title":"3.2. \nScope and effect of exclusions"},{"refs":[{"id":"ref-for-propdef-wrap-through\u2461"},{"id":"ref-for-propdef-wrap-through\u2462"}],"title":"3.3. \nPropagation of Exclusions"},{"refs":[{"id":"ref-for-propdef-wrap-through\u2463"},{"id":"ref-for-propdef-wrap-through\u2464"}],"title":"3.3.1. \nThe wrap-through Property"}],"url":"#propdef-wrap-through"},
"valdef-wrap-flow-auto": {"dfnID":"valdef-wrap-flow-auto","dfnText":"auto","external":false,"refSections":[{"refs":[{"id":"ref-for-valdef-wrap-flow-auto"}],"title":"2. \nTerminology"},{"refs":[{"id":"ref-for-valdef-wrap-flow-auto\u2460"}],"title":"3.1. \nDeclaring exclusions"},{"refs":[{"id":"ref-for-valdef-wrap-flow-auto\u2461"},{"id":"ref-for-valdef-wrap-flow-auto\u2462"}],"title":"3.1.1. \nThe wrap-flow property"}],"url":"#valdef-wrap-flow-auto"},
"valdef-wrap-flow-both": {"dfnID":"valdef-wrap-flow-both","dfnText":"both","external":false,"refSections":[{"refs":[{"id":"ref-for-valdef-wrap-flow-both"},{"id":"ref-for-valdef-wrap-flow-both\u2460"}],"title":"3.1.1. \nThe wrap-flow property"}],"url":"#valdef-wrap-flow-both"},
"valdef-wrap-flow-clear": {"dfnID":"valdef-wrap-flow-clear","dfnText":"clear","external":false,"refSections":[{"refs":[{"id":"ref-for-valdef-wrap-flow-clear"},{"id":"ref-for-valdef-wrap-flow-clear\u2460"}],"title":"3.1.1. \nThe wrap-flow property"}],"url":"#valdef-wrap-flow-clear"},
"valdef-wrap-flow-end": {"dfnID":"valdef-wrap-flow-end","dfnText":"end","external":false,"refSections":[{"refs":[{"id":"ref-for-valdef-wrap-flow-end"},{"id":"ref-for-valdef-wrap-flow-end\u2460"}],"title":"3.1.1. \nThe wrap-flow property"}],"url":"#valdef-wrap-flow-end"},
"valdef-wrap-flow-maximum": {"dfnID":"valdef-wrap-flow-maximum","dfnText":"maximum","external":false,"refSections":[{"refs":[{"id":"ref-for-valdef-wrap-flow-maximum"}],"title":"3.1.1. \nThe wrap-flow property"}],"url":"#valdef-wrap-flow-maximum"},
"valdef-wrap-flow-minimum": {"dfnID":"valdef-wrap-flow-minimum","dfnText":"minimum","external":false,"refSections":[{"refs":[{"id":"ref-for-valdef-wrap-flow-minimum"}],"title":"3.1.1. \nThe wrap-flow property"}],"url":"#valdef-wrap-flow-minimum"},
"valdef-wrap-flow-start": {"dfnID":"valdef-wrap-flow-start","dfnText":"start","external":false,"refSections":[{"refs":[{"id":"ref-for-valdef-wrap-flow-start"},{"id":"ref-for-valdef-wrap-flow-start\u2460"},{"id":"ref-for-valdef-wrap-flow-start\u2461"},{"id":"ref-for-valdef-wrap-flow-start\u2462"}],"title":"3.1.1. \nThe wrap-flow property"}],"url":"#valdef-wrap-flow-start"},
"valdef-wrap-through-none": {"dfnID":"valdef-wrap-through-none","dfnText":"none","external":false,"refSections":[{"refs":[{"id":"ref-for-valdef-wrap-through-none"},{"id":"ref-for-valdef-wrap-through-none\u2460"}],"title":"3.3. \nPropagation of Exclusions"}],"url":"#valdef-wrap-through-none"},
"valdef-wrap-through-wrap": {"dfnID":"valdef-wrap-through-wrap","dfnText":"wrap","external":false,"refSections":[],"url":"#valdef-wrap-through-wrap"},
"wrapping-area": {"dfnID":"wrapping-area","dfnText":"Wrapping area","external":false,"refSections":[],"url":"#wrapping-area"},
"wrapping-context": {"dfnID":"wrapping-context","dfnText":"Wrapping context","external":false,"refSections":[{"refs":[{"id":"ref-for-wrapping-context"},{"id":"ref-for-wrapping-context\u2460"}],"title":"3.1.1. \nThe wrap-flow property"},{"refs":[{"id":"ref-for-wrapping-context\u2461"},{"id":"ref-for-wrapping-context\u2462"},{"id":"ref-for-wrapping-context\u2463"}],"title":"3.3. \nPropagation of Exclusions"},{"refs":[{"id":"ref-for-wrapping-context\u2464"},{"id":"ref-for-wrapping-context\u2465"}],"title":"3.3.1. \nThe wrap-through Property"},{"refs":[{"id":"ref-for-wrapping-context\u2466"},{"id":"ref-for-wrapping-context\u2467"}],"title":"3.5.1. \nDescription"},{"refs":[{"id":"ref-for-wrapping-context\u2468"}],"title":"3.5.2. \nStep 1: resolve exclusion boxes belonging to each wrapping context"},{"refs":[{"id":"ref-for-wrapping-context\u2460\u24ea"},{"id":"ref-for-wrapping-context\u2460\u2460"},{"id":"ref-for-wrapping-context\u2460\u2461"},{"id":"ref-for-wrapping-context\u2460\u2462"},{"id":"ref-for-wrapping-context\u2460\u2463"},{"id":"ref-for-wrapping-context\u2460\u2464"}],"title":"3.5.4. \nStep 2-A: resolve the position and size of exclusion boxes"},{"refs":[{"id":"ref-for-wrapping-context\u2460\u2465"}],"title":"3.5.5. \nStep 2-B: lay out containing block applying wrapping"},{"refs":[{"id":"ref-for-wrapping-context\u2460\u2466"},{"id":"ref-for-wrapping-context\u2460\u2467"},{"id":"ref-for-wrapping-context\u2460\u2468"},{"id":"ref-for-wrapping-context\u2461\u24ea"},{"id":"ref-for-wrapping-context\u2461\u2460"},{"id":"ref-for-wrapping-context\u2461\u2461"},{"id":"ref-for-wrapping-context\u2461\u2462"},{"id":"ref-for-wrapping-context\u2461\u2463"},{"id":"ref-for-wrapping-context\u2461\u2464"}],"title":"3.5.6.1. \nStep 1: resolve exclusion boxes belonging to each wrapping context"},{"refs":[{"id":"ref-for-wrapping-context\u2461\u2465"},{"id":"ref-for-wrapping-context\u2461\u2466"},{"id":"ref-for-wrapping-context\u2461\u2467"},{"id":"ref-for-wrapping-context\u2461\u2468"},{"id":"ref-for-wrapping-context\u2462\u24ea"}],"title":"3.5.6.2. \nStep 2: resolve wrapping contexts and lay out containing blocks"},{"refs":[{"id":"ref-for-wrapping-context\u2462\u2460"}],"title":"3.5.6.2.1. \nResolving RWC-1"},{"refs":[{"id":"ref-for-wrapping-context\u2462\u2461"},{"id":"ref-for-wrapping-context\u2462\u2462"},{"id":"ref-for-wrapping-context\u2462\u2463"},{"id":"ref-for-wrapping-context\u2462\u2464"},{"id":"ref-for-wrapping-context\u2462\u2465"}],"title":"3.5.6.2.2. \nResolving RWC-2"}],"url":"#wrapping-context"},
};

document.addEventListener("DOMContentLoaded", ()=>{
    genAllDfnPanels();

    document.body.addEventListener("click", (e) => {
        // If not handled already, just hide all dfn panels.
        hideAllDfnPanels();
    });
});

window.addEventListener("resize", () => {
    // Pin any visible dfn panel
    queryAll(".dfn-panel.on, .dfn-panel.activated").forEach(el=>positionDfnPanel(el));
});

function genAllDfnPanels() {
    for(const panelData of Object.values(dfnPanelData)) {
        const dfnID = panelData.dfnID;
        const dfn = document.getElementById(dfnID);
        if(!dfn) {
            console.log(`Can't find dfn#${dfnID}.`, panelData);
            continue;
        }
        dfn.panelData = panelData;
        insertDfnPopupAction(dfn);
    }
}

function genDfnPanel(dfn, { dfnID, url, dfnText, refSections, external }) {
    const dfnPanel = mk.aside({
        class: "dfn-panel on",
        id: `infopanel-for-${dfnID}`,
        "data-for": dfnID,
        "aria-labelled-by":`infopaneltitle-for-${dfnID}`,
        },
        mk.span({id:`infopaneltitle-for-${dfnID}`, style:"display:none"},
            `Info about the '${dfnText}' ${external?"external":""} reference.`),
        mk.a({href:url, class:"dfn-link"}, url),
        refSections.length == 0 ? [] :
            mk.b({}, "Referenced in:"),
            mk.ul({},
                ...refSections.map(section=>
                    mk.li({},
                        ...section.refs.map((ref, refI)=>
                            [
                                mk.a({ href: `#${ref.id}` },
                                    (refI == 0) ? section.title : `(${refI + 1})`
                                ),
                                " ",
                            ]
                        ),
                    ),
                ),
            ),
        genLinkingSyntaxes(dfn),
    );

    dfnPanel.addEventListener('click', (event) => {
        if (event.target.nodeName == 'A') {
            scrollToTargetAndHighlight(event);
            pinDfnPanel(dfnPanel);
        }
        event.stopPropagation();
        refocusOnTarget(event);
    });
    dfnPanel.addEventListener('keydown', (event) => {
        if(event.keyCode == 27) { // Escape key
            hideDfnPanel({dfnPanel});
            event.stopPropagation();
            event.preventDefault();
        }
    });

    dfnPanel.dfn = dfn;
    dfn.dfnPanel = dfnPanel;
    return dfnPanel;
}



function hideAllDfnPanels() {
    // Delete the currently-active dfn panel.
    queryAll(".dfn-panel").forEach(dfnPanel=>hideDfnPanel({dfnPanel}));
}

function showDfnPanel(dfn) {
    hideAllDfnPanels(); // Only display one at a time.

    dfn.setAttribute("aria-expanded", "true");

    const dfnPanel = genDfnPanel(dfn, dfn.panelData);

    // Give the dfn a unique tabindex, and then
    // give all the tabbable panel bits successive indexes.
    let tabIndex = 100;
    dfn.tabIndex = tabIndex++;
    const tabbable = dfnPanel.querySelectorAll(":is(a, button)");
    for (const el of tabbable) {
        el.tabIndex = tabIndex++;
    }

    append(document.body, dfnPanel);
    positionDfnPanel(dfnPanel);
}

function positionDfnPanel(dfnPanel) {
    const dfn = dfnPanel.dfn;
    const dfnPos = getBounds(dfn);
    dfnPanel.style.top = dfnPos.bottom + "px";
    dfnPanel.style.left = dfnPos.left + "px";

    const panelPos = dfnPanel.getBoundingClientRect();
    const panelMargin = 8;
    const maxRight = document.body.parentNode.clientWidth - panelMargin;
    if (panelPos.right > maxRight) {
        const overflowAmount = panelPos.right - maxRight;
        const newLeft = Math.max(panelMargin, dfnPos.left - overflowAmount);
        dfnPanel.style.left = newLeft + "px";
    }
}

function pinDfnPanel(dfnPanel) {
    // Switch it to "activated" state, which pins it.
    dfnPanel.classList.add("activated");
    dfnPanel.style.position = "fixed";
    dfnPanel.style.left = null;
    dfnPanel.style.top = null;
}

function hideDfnPanel({dfn, dfnPanel}) {
    if(!dfnPanel) dfnPanel = dfn.dfnPanel;
    if(!dfn) dfn = dfnPanel.dfn;
    dfn.dfnPanel = undefined;
    dfnPanel.dfn = undefined;
    dfn.setAttribute("aria-expanded", "false");
    dfn.tabIndex = undefined;
    dfnPanel.remove()
}

function toggleDfnPanel(dfn) {
    if(dfn.dfnPanel) {
        hideDfnPanel(dfn);
    } else {
        showDfnPanel(dfn);
    }
}

function insertDfnPopupAction(dfn) {
    dfn.setAttribute('role', 'button');
    dfn.setAttribute('aria-expanded', 'false')
    dfn.tabIndex = 0;
    dfn.classList.add('has-dfn-panel');
    dfn.addEventListener('click', (event) => {
        toggleDfnPanel(dfn);
        event.stopPropagation();
    });
    dfn.addEventListener('keypress', (event) => {
        const kc = event.keyCode;
        // 32->Space, 13->Enter
        if(kc == 32 || kc == 13) {
            toggleDfnPanel(dfn);
            event.stopPropagation();
            event.preventDefault();
        }
    });
}

function refocusOnTarget(event) {
    const target = event.target;
    setTimeout(() => {
        // Refocus on the event.target element.
        // This is needed after browser scrolls to the destination.
        target.focus();
    });
}

// TODO: shared util
// Returns the root-level absolute position {left and top} of element.
function getBounds(el, relativeTo=document.body) {
    const relativeRect = relativeTo.getBoundingClientRect();
    const elRect = el.getBoundingClientRect();
    const top = elRect.top - relativeRect.top;
    const left = elRect.left - relativeRect.left;
    return {
        top,
        left,
        bottom: top + elRect.height,
        right: left + elRect.width,
    }
}

function scrollToTargetAndHighlight(event) {
    let hash = event.target.hash;
    if (hash) {
        hash = decodeURIComponent(hash.substring(1));
        const dest = document.getElementById(hash);
        if (dest) {
            dest.classList.add('highlighted');
            setTimeout(() => dest.classList.remove('highlighted'), 1000);
        }
    }
}

// Functions, divided by link type, that wrap an autolink's
// contents with the appropriate outer syntax.
// Alternately, a string naming another type they format
// the same as.
function needsFor(type) {
    switch(type) {
        case "descriptor":
        case "value":
        case "element-attr":
        case "attr-value":
        case "element-state":
        case "method":
        case "constructor":
        case "argument":
        case "attribute":
        case "const":
        case "dict-member":
        case "event":
        case "enum-value":
        case "stringifier":
        case "serializer":
        case "iterator":
        case "maplike":
        case "setlike":
        case "state":
        case "mode":
        case "context":
        case "facet": return true;

        default: return false;
    }
}
function refusesFor(type) {
    switch(type) {
        case "property":
        case "element":
        case "interface":
        case "namespace":
        case "callback":
        case "dictionary":
        case "enum":
        case "exception":
        case "typedef":
        case "http-header":
        case "permission": return true;

        default: return false;
    }
}
function linkFormatterFromType(type) {
    switch(type) {
        case 'scheme':
        case 'permission':
        case 'dfn': return (text) => `[=${text}=]`;

        case 'abstract-op': return (text) => `[\$${text}\$]`;

        case 'function':
        case 'at-rule':
        case 'selector':
        case 'value': return (text) => `''${text}''`;

        case 'http-header': return (text) => `[:${text}:]`;

        case 'interface':
        case 'constructor':
        case 'method':
        case 'argument':
        case 'attribute':
        case 'callback':
        case 'dictionary':
        case 'dict-member':
        case 'enum':
        case 'enum-value':
        case 'exception':
        case 'const':
        case 'typedef':
        case 'stringifier':
        case 'serializer':
        case 'iterator':
        case 'maplike':
        case 'setlike':
        case 'extended-attribute':
        case 'event':
        case 'idl': return (text) => `{{${text}}}`;

        case 'element-state':
        case 'element-attr':
        case 'attr-value':
        case 'element': return (element) => `<{${element}}>`;

        case 'grammar': return (text) => `${text} (within a <pre class=prod>)`;

        case 'type': return (text)=> `<<${text}>>`;

        case 'descriptor':
        case 'property': return (text) => `'${text}'`;

        default: return;
    };
};

function genLinkingSyntaxes(dfn) {
    if(dfn.tagName != "DFN") return;

    const type = dfn.getAttribute('data-dfn-type');
    if(!type) {
        console.log(`<dfn> doesn't have a data-dfn-type:`, dfn);
        return [];
    }

    // Return a function that wraps link text based on the type
    const linkFormatter = linkFormatterFromType(type);
    if(!linkFormatter) {
        console.log(`<dfn> has an unknown data-dfn-type:`, dfn);
        return [];
    }

    let ltAlts;
    if(dfn.hasAttribute('data-lt')) {
        ltAlts = dfn.getAttribute('data-lt')
            .split("|")
            .map(x=>x.trim());
    } else {
        ltAlts = [dfn.textContent.trim()];
    }
    if(type == "type") {
        // lt of "<foo>", but "foo" is the interior;
        // <<foo/bar>> is how you write it with a for,
        // not <foo/<bar>> or whatever.
        for(var i = 0; i < ltAlts.length; i++) {
            const lt = ltAlts[i];
            const match = /<(.*)>/.exec(lt);
            if(match) { ltAlts[i] = match[1]; }
        }
    }

    let forAlts;
    if(dfn.hasAttribute('data-dfn-for')) {
        forAlts = dfn.getAttribute('data-dfn-for')
            .split(",")
            .map(x=>x.trim());
    } else {
        forAlts = [''];
    }

    let linkingSyntaxes = [];
    if(!needsFor(type)) {
        for(const lt of ltAlts) {
            linkingSyntaxes.push(linkFormatter(lt));
        }
    }
    if(!refusesFor(type)) {
        for(const f of forAlts) {
            linkingSyntaxes.push(linkFormatter(`${f}/${ltAlts[0]}`))
        }
    }
    return [
        mk.b({}, 'Possible linking syntaxes:'),
        mk.ul({},
            ...linkingSyntaxes.map(link => {
                const copyLink = async () =>
                    await navigator.clipboard.writeText(link);
                return mk.li({},
                    mk.div({ class: 'link-item' },
                        mk.button({
                            class: 'copy-icon', title: 'Copy',
                            type: 'button',
                            _onclick: copyLink,
                            tabindex: 0,
                        }, mk.span({ class: 'icon' }) ),
                        mk.span({}, link)
                    )
                );
            })
        )
    ];
}
}
</script>
<script>/* Boilerplate: script-ref-hints */
"use strict";
{
let refsData = {
"#content-area": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"css-exclusions","spec":"css-exclusions-1","status":"local","text":"content area","type":"dfn","url":"#content-area"},
"#exclusion-area": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"css-exclusions","spec":"css-exclusions-1","status":"local","text":"exclusion area","type":"dfn","url":"#exclusion-area"},
"#exclusion-box": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"css-exclusions","spec":"css-exclusions-1","status":"local","text":"exclusion box","type":"dfn","url":"#exclusion-box"},
"#exclusion-element": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"css-exclusions","spec":"css-exclusions-1","status":"local","text":"exclusion element","type":"dfn","url":"#exclusion-element"},
"#inside": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"css-exclusions","spec":"css-exclusions-1","status":"local","text":"inside","type":"dfn","url":"#inside"},
"#outside": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"css-exclusions","spec":"css-exclusions-1","status":"local","text":"outside","type":"dfn","url":"#outside"},
"#propdef-wrap-flow": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"css-exclusions","spec":"css-exclusions-1","status":"local","text":"wrap-flow","type":"property","url":"#propdef-wrap-flow"},
"#propdef-wrap-through": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"css-exclusions","spec":"css-exclusions-1","status":"local","text":"wrap-through","type":"property","url":"#propdef-wrap-through"},
"#valdef-wrap-flow-auto": {"export":true,"for_":["wrap-flow"],"level":"1","normative":true,"shortname":"css-exclusions","spec":"css-exclusions-1","status":"local","text":"auto","type":"value","url":"#valdef-wrap-flow-auto"},
"#valdef-wrap-flow-both": {"export":true,"for_":["wrap-flow"],"level":"1","normative":true,"shortname":"css-exclusions","spec":"css-exclusions-1","status":"local","text":"both","type":"value","url":"#valdef-wrap-flow-both"},
"#valdef-wrap-flow-clear": {"export":true,"for_":["wrap-flow"],"level":"1","normative":true,"shortname":"css-exclusions","spec":"css-exclusions-1","status":"local","text":"clear","type":"value","url":"#valdef-wrap-flow-clear"},
"#valdef-wrap-flow-end": {"export":true,"for_":["wrap-flow"],"level":"1","normative":true,"shortname":"css-exclusions","spec":"css-exclusions-1","status":"local","text":"end","type":"value","url":"#valdef-wrap-flow-end"},
"#valdef-wrap-flow-maximum": {"export":true,"for_":["wrap-flow"],"level":"1","normative":true,"shortname":"css-exclusions","spec":"css-exclusions-1","status":"local","text":"maximum","type":"value","url":"#valdef-wrap-flow-maximum"},
"#valdef-wrap-flow-minimum": {"export":true,"for_":["wrap-flow"],"level":"1","normative":true,"shortname":"css-exclusions","spec":"css-exclusions-1","status":"local","text":"minimum","type":"value","url":"#valdef-wrap-flow-minimum"},
"#valdef-wrap-flow-start": {"export":true,"for_":["wrap-flow"],"level":"1","normative":true,"shortname":"css-exclusions","spec":"css-exclusions-1","status":"local","text":"start","type":"value","url":"#valdef-wrap-flow-start"},
"#valdef-wrap-through-none": {"export":true,"for_":["wrap-through"],"level":"1","normative":true,"shortname":"css-exclusions","spec":"css-exclusions-1","status":"local","text":"none","type":"value","url":"#valdef-wrap-through-none"},
"#wrapping-context": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"css-exclusions","spec":"css-exclusions-1","status":"local","text":"wrapping context","type":"dfn","url":"#wrapping-context"},
"https://drafts.csswg.org/css-anchor-position-1/#valdef-anchor-outside": {"export":true,"for_":["anchor()"],"level":"1","normative":true,"shortname":"css-anchor-position","spec":"css-anchor-position-1","status":"current","text":"outside","type":"value","url":"https://drafts.csswg.org/css-anchor-position-1/#valdef-anchor-outside"},
"https://drafts.csswg.org/css-box-4/#border-box": {"export":true,"for_":[],"level":"4","normative":true,"shortname":"css-box","spec":"css-box-4","status":"current","text":"border box","type":"dfn","url":"https://drafts.csswg.org/css-box-4/#border-box"},
"https://drafts.csswg.org/css-page-floats-3/#valdef-float-none": {"export":true,"for_":["float"],"level":"3","normative":true,"shortname":"css-page-floats","spec":"css-page-floats-3","status":"current","text":"none","type":"value","url":"https://drafts.csswg.org/css-page-floats-3/#valdef-float-none"},
"https://drafts.csswg.org/css-position-3/#propdef-position": {"export":true,"for_":[],"level":"3","normative":true,"shortname":"css-position","spec":"css-position-3","status":"current","text":"position","type":"property","url":"https://drafts.csswg.org/css-position-3/#propdef-position"},
"https://drafts.csswg.org/css-position-3/#valdef-position-fixed": {"export":true,"for_":["position"],"level":"3","normative":true,"shortname":"css-position","spec":"css-position-3","status":"current","text":"fixed","type":"value","url":"https://drafts.csswg.org/css-position-3/#valdef-position-fixed"},
"https://drafts.csswg.org/css-values-4/#comb-one": {"export":true,"for_":[],"level":"4","normative":true,"shortname":"css-values","spec":"css-values-4","status":"current","text":"|","type":"grammar","url":"https://drafts.csswg.org/css-values-4/#comb-one"},
"https://drafts.csswg.org/css-values-4/#css-wide-keywords": {"export":true,"for_":[],"level":"4","normative":true,"shortname":"css-values","spec":"css-values-4","status":"current","text":"css-wide keywords","type":"dfn","url":"https://drafts.csswg.org/css-values-4/#css-wide-keywords"},
"https://drafts.csswg.org/css2/#propdef-float": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"css","spec":"css22","status":"current","text":"float","type":"property","url":"https://drafts.csswg.org/css2/#propdef-float"},
"https://www.w3.org/TR/CSS21/visuren.html#propdef-z-index": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"css","spec":"css2","status":"current","text":"z-index","type":"property","url":"https://www.w3.org/TR/CSS21/visuren.html#propdef-z-index"},
};

function mkRefHint(link, ref) {
    const linkText = link.textContent;
    let dfnTextElements = '';
    if (ref.text != linkText) {
        dfnTextElements =
            mk.li({},
                mk.b({}, "Term: "),
                mk.span({}, ref.text)
            );
    }
    const forList = ref.for_;
    let forListElements;
    if(forList.length == 0) {
        forListElements = [];
    } else if(forList.length == 1) {
        forListElements = mk.li({},
            mk.b({}, "For: "),
            mk.span({}, forList[0]),
        );
    } else {
        forListElements = mk.li({},
            mk.b({}, "For: "),
            mk.ul({},
                ...forList.map(forItem =>
                    mk.li({},
                        mk.span({}, forItem)
                    ),
                ),
            ),
        );
    }
    const url = ref.url;
    const safeUrl = encodeURIComponent(url);
    const hintPanel = mk.aside({
        class: "ref-hint",
        id: `ref-hint-for-${safeUrl}`,
        "data-for": url,
        "aria-labelled-by": `ref-hint-for-${safeUrl}`,
    },
        mk.ul({},
            dfnTextElements,
            mk.li({},
                mk.b({}, "URL: "),
                mk.a({ href: url, class: "ref" }, url),
            ),
            mk.li({},
                mk.b({}, "Type: "),
                mk.span({}, `${ref.type}`),
            ),
            mk.li({},
                mk.b({}, "Spec: "),
                mk.span({}, `${ref.spec ? ref.spec : ''}`),
            ),
            forListElements
        ),
    );
    hintPanel.forLink = link;
    setupRefHintEventListeners(link, hintPanel);
    return hintPanel;
}

function hideAllRefHints() {
    queryAll(".ref-hint").forEach(el=>hideRefHint(el));
}

function hideRefHint(refHint) {
    const link = refHint.forLink;
    link.setAttribute("aria-expanded", "false");
    if(refHint.teardownEventListeners) {
        refHint.teardownEventListeners();
    }
    refHint.remove();
}

function showRefHint(link) {
    if(link.classList.contains("dfn-link")) return;
    const url = link.getAttribute("href");
    const ref = refsData[url];
    if(!ref) return;

    hideAllRefHints(); // Only display one at this time.

    const refHint = mkRefHint(link, ref);
    append(document.body, refHint);
    link.setAttribute("aria-expanded", "true");
    positionRefHint(refHint);
}

function setupRefHintEventListeners(link, refHint) {
    if (refHint.teardownEventListeners) return;
    // Add event handlers to hide the refHint after the user moves away
    // from both the link and refHint, if not hovering either within one second.
    let timeout = null;
    const startHidingRefHint = (event) => {
        if (timeout) {
            clearTimeout(timeout);
        }
        timeout = setTimeout(() => {
            hideRefHint(refHint);
        }, 1000);
    }
    const resetHidingRefHint = (event) => {
        if (timeout) clearTimeout(timeout);
        timeout = null;
    };
    link.addEventListener("mouseleave", startHidingRefHint);
    link.addEventListener("mouseenter", resetHidingRefHint);
    link.addEventListener("blur", startHidingRefHint);
    link.addEventListener("focus", resetHidingRefHint);
    refHint.addEventListener("mouseleave", startHidingRefHint);
    refHint.addEventListener("mouseenter", resetHidingRefHint);
    refHint.addEventListener("blur", startHidingRefHint);
    refHint.addEventListener("focus", resetHidingRefHint);

    refHint.teardownEventListeners = () => {
        // remove event listeners
        resetHidingRefHint();
        link.removeEventListener("mouseleave", startHidingRefHint);
        link.removeEventListener("mouseenter", resetHidingRefHint);
        link.removeEventListener("blur", startHidingRefHint);
        link.removeEventListener("focus", resetHidingRefHint);
        refHint.removeEventListener("mouseleave", startHidingRefHint);
        refHint.removeEventListener("mouseenter", resetHidingRefHint);
        refHint.removeEventListener("blur", startHidingRefHint);
        refHint.removeEventListener("focus", resetHidingRefHint);
    };
}

function positionRefHint(refHint) {
    const link = refHint.forLink;
    const linkPos = getBounds(link);
    refHint.style.top = linkPos.bottom + "px";
    refHint.style.left = linkPos.left + "px";

    const panelPos = refHint.getBoundingClientRect();
    const panelMargin = 8;
    const maxRight = document.body.parentNode.clientWidth - panelMargin;
    if (panelPos.right > maxRight) {
        const overflowAmount = panelPos.right - maxRight;
        const newLeft = Math.max(panelMargin, linkPos.left - overflowAmount);
        refHint.style.left = newLeft + "px";
    }
}

// TODO: shared util
// Returns the root-level absolute position {left and top} of element.
function getBounds(el, relativeTo=document.body) {
    const relativeRect = relativeTo.getBoundingClientRect();
    const elRect = el.getBoundingClientRect();
    const top = elRect.top - relativeRect.top;
    const left = elRect.left - relativeRect.left;
    return {
        top,
        left,
        bottom: top + elRect.height,
        right: left + elRect.width,
    }
}

function showRefHintListener(e) {
    // If the target isn't in a link (or is a link),
    // just ignore it.
    let link = e.target.closest("a");
    if(!link) return;

    // If the target is in a ref-hint panel
    // (aka a link in the already-open one),
    // also just ignore it.
    if(link.closest(".ref-hint")) return;

    // Otherwise, show the panel for the link.
    showRefHint(link);
}

function hideAllHintsListener(e) {
    // If the click is inside a ref-hint panel, ignore it.
    if(e.target.closest(".ref-hint")) return;
    // Otherwise, close all the current panels.
    hideAllRefHints();
}

document.addEventListener("DOMContentLoaded", () => {
    document.body.addEventListener("mousedown", showRefHintListener);
    document.body.addEventListener("focus", showRefHintListener);

    document.body.addEventListener("click", hideAllHintsListener);
});

window.addEventListener("resize", () => {
    // Hide any open ref hint.
    hideAllRefHints();
});
}
</script>