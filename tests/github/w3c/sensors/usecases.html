<!doctype html><html lang="en">
 <head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
  <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
  <title>Sensor Use Cases</title>
  <meta content="NOTE" name="w3c-status">
  <link href="https://www.w3.org/StyleSheets/TR/2021/W3C-NOTE" rel="stylesheet">
  <link href="https://www.w3.org/2008/site/images/favicon.ico" rel="icon">
  <link href="http://www.w3.org/TR/generic-sensor-usecases/" rel="canonical">
<style>/* style-autolinks */
.css.css, .property.property, .descriptor.descriptor {
    color: var(--a-normal-text);
    font-size: inherit;
    font-family: inherit;
}
.css::before, .property::before, .descriptor::before {
    content: "‘";
}
.css::after, .property::after, .descriptor::after {
    content: "’";
}
.property, .descriptor {
    /* Don't wrap property and descriptor names */
    white-space: nowrap;
}
.type { /* CSS value <type> */
    font-style: italic;
}
pre .property::before, pre .property::after {
    content: "";
}
[data-link-type="property"]::before,
[data-link-type="propdesc"]::before,
[data-link-type="descriptor"]::before,
[data-link-type="value"]::before,
[data-link-type="function"]::before,
[data-link-type="at-rule"]::before,
[data-link-type="selector"]::before,
[data-link-type="maybe"]::before {
    content: "‘";
}
[data-link-type="property"]::after,
[data-link-type="propdesc"]::after,
[data-link-type="descriptor"]::after,
[data-link-type="value"]::after,
[data-link-type="function"]::after,
[data-link-type="at-rule"]::after,
[data-link-type="selector"]::after,
[data-link-type="maybe"]::after {
    content: "’";
}

[data-link-type].production::before,
[data-link-type].production::after,
.prod [data-link-type]::before,
.prod [data-link-type]::after {
    content: "";
}

[data-link-type=element],
[data-link-type=element-attr] {
    font-family: Menlo, Consolas, "DejaVu Sans Mono", monospace;
    font-size: .9em;
}
[data-link-type=element]::before { content: "<" }
[data-link-type=element]::after  { content: ">" }

[data-link-type=biblio] {
    white-space: pre;
}
</style>
<style>/* style-counters */
body {
    counter-reset: example figure issue;
}
.issue {
    counter-increment: issue;
}
.issue:not(.no-marker)::before {
    content: "Issue " counter(issue);
}

.example {
    counter-increment: example;
}
.example:not(.no-marker)::before {
    content: "Example " counter(example);
}
.invalid.example:not(.no-marker)::before,
.illegal.example:not(.no-marker)::before {
    content: "Invalid Example" counter(example);
}

figcaption {
    counter-increment: figure;
}
figcaption:not(.no-marker)::before {
    content: "Figure " counter(figure) " ";
}
</style>
<style>/* style-dfn-panel */
:root {
    --dfnpanel-bg: #ddd;
    --dfnpanel-text: var(--text);
}
.dfn-panel {
    position: absolute;
    z-index: 35;
    width: 20em;
    min-width: min-content;
    max-width: 300px;
    height: auto;
    max-height: 500px;
    overflow: auto;
    padding: 0.5em 0.75em;
    font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
    background: var(--dfnpanel-bg);
    color: var(--dfnpanel-text);
    border: outset 0.2em;
    white-space: normal; /* in case it's moved into a pre */
}
.dfn-panel:not(.on) { display: none; }
.dfn-panel * { margin: 0; padding: 0; text-indent: 0; }
.dfn-panel > b { display: block; }
.dfn-panel a { color: var(--dfnpanel-text); }
.dfn-panel a:not(:hover) { text-decoration: none !important; border-bottom: none !important; }
.dfn-panel > b + b { margin-top: 0.25em; }
.dfn-panel ul { padding: 0; }
.dfn-panel li { list-style: inside; }
.dfn-panel.activated {
    display: inline-block;
    position: fixed;
    left: .5em;
    bottom: 2em;
    margin: 0 auto;
    max-width: calc(100vw - 1.5em - .4em - .5em);
    max-height: 30vh;
}

.dfn-paneled { cursor: pointer; }
</style>
<style>/* style-issues */
a[href].issue-return {
    float: right;
    float: inline-end;
    color: var(--issueheading-text);
    font-weight: bold;
    text-decoration: none;
}
</style>
<style>/* style-md-lists */
/* This is a weird hack for me not yet following the commonmark spec
   regarding paragraph and lists. */
[data-md] > :first-child {
    margin-top: 0;
}
[data-md] > :last-child {
    margin-bottom: 0;
}
</style>
<style>/* style-selflinks */

:root {
    --selflink-text: white;
    --selflink-bg: gray;
    --selflink-hover-text: black;
}
.heading, .issue, .note, .example, li, dt {
    position: relative;
}
a.self-link {
    position: absolute;
    top: 0;
    left: calc(-1 * (3.5rem - 26px));
    width: calc(3.5rem - 26px);
    height: 2em;
    text-align: center;
    border: none;
    transition: opacity .2s;
    opacity: .5;
}
a.self-link:hover {
    opacity: 1;
}
.heading > a.self-link {
    font-size: 83%;
}
.example > a.self-link,
.note > a.self-link,
.issue > a.self-link {
    /* These blocks are overflow:auto, so positioning outside
       doesn't work. */
    left: auto;
    right: 0;
}
li > a.self-link {
    left: calc(-1 * (3.5rem - 26px) - 2em);
}
dfn > a.self-link {
    top: auto;
    left: auto;
    opacity: 0;
    width: 1.5em;
    height: 1.5em;
    background: var(--selflink-bg);
    color: var(--selflink-text);
    font-style: normal;
    transition: opacity .2s, background-color .2s, color .2s;
}
dfn:hover > a.self-link {
    opacity: 1;
}
dfn > a.self-link:hover {
    color: var(--selflink-hover-text);
}

a.self-link::before            { content: "¶"; }
.heading > a.self-link::before { content: "§"; }
dfn > a.self-link::before      { content: "#"; }
</style>
<style>/* style-syntax-highlighting */

code.highlight { padding: .1em; border-radius: .3em; }
pre.highlight, pre > code.highlight { display: block; padding: 1em; margin: .5em 0; overflow: auto; border-radius: 0; }

.highlight:not(.idl) { background: rgba(0, 0, 0, .03); }
c-[a] { color: #990055 } /* Keyword.Declaration */
c-[b] { color: #990055 } /* Keyword.Type */
c-[c] { color: #708090 } /* Comment */
c-[d] { color: #708090 } /* Comment.Multiline */
c-[e] { color: #0077aa } /* Name.Attribute */
c-[f] { color: #669900 } /* Name.Tag */
c-[g] { color: #222222 } /* Name.Variable */
c-[k] { color: #990055 } /* Keyword */
c-[l] { color: #000000 } /* Literal */
c-[m] { color: #000000 } /* Literal.Number */
c-[n] { color: #0077aa } /* Name */
c-[o] { color: #999999 } /* Operator */
c-[p] { color: #999999 } /* Punctuation */
c-[s] { color: #a67f59 } /* Literal.String */
c-[t] { color: #a67f59 } /* Literal.String.Single */
c-[u] { color: #a67f59 } /* Literal.String.Double */
c-[cp] { color: #708090 } /* Comment.Preproc */
c-[c1] { color: #708090 } /* Comment.Single */
c-[cs] { color: #708090 } /* Comment.Special */
c-[kc] { color: #990055 } /* Keyword.Constant */
c-[kn] { color: #990055 } /* Keyword.Namespace */
c-[kp] { color: #990055 } /* Keyword.Pseudo */
c-[kr] { color: #990055 } /* Keyword.Reserved */
c-[ld] { color: #000000 } /* Literal.Date */
c-[nc] { color: #0077aa } /* Name.Class */
c-[no] { color: #0077aa } /* Name.Constant */
c-[nd] { color: #0077aa } /* Name.Decorator */
c-[ni] { color: #0077aa } /* Name.Entity */
c-[ne] { color: #0077aa } /* Name.Exception */
c-[nf] { color: #0077aa } /* Name.Function */
c-[nl] { color: #0077aa } /* Name.Label */
c-[nn] { color: #0077aa } /* Name.Namespace */
c-[py] { color: #0077aa } /* Name.Property */
c-[ow] { color: #999999 } /* Operator.Word */
c-[mb] { color: #000000 } /* Literal.Number.Bin */
c-[mf] { color: #000000 } /* Literal.Number.Float */
c-[mh] { color: #000000 } /* Literal.Number.Hex */
c-[mi] { color: #000000 } /* Literal.Number.Integer */
c-[mo] { color: #000000 } /* Literal.Number.Oct */
c-[sb] { color: #a67f59 } /* Literal.String.Backtick */
c-[sc] { color: #a67f59 } /* Literal.String.Char */
c-[sd] { color: #a67f59 } /* Literal.String.Doc */
c-[se] { color: #a67f59 } /* Literal.String.Escape */
c-[sh] { color: #a67f59 } /* Literal.String.Heredoc */
c-[si] { color: #a67f59 } /* Literal.String.Interpol */
c-[sx] { color: #a67f59 } /* Literal.String.Other */
c-[sr] { color: #a67f59 } /* Literal.String.Regex */
c-[ss] { color: #a67f59 } /* Literal.String.Symbol */
c-[vc] { color: #0077aa } /* Name.Variable.Class */
c-[vg] { color: #0077aa } /* Name.Variable.Global */
c-[vi] { color: #0077aa } /* Name.Variable.Instance */
c-[il] { color: #000000 } /* Literal.Number.Integer.Long */
</style>
 <body class="h-entry">
  <div class="head">
   <p data-fill-with="logo"><a class="logo" href="https://www.w3.org/"> <img alt="W3C" height="48" src="https://www.w3.org/StyleSheets/TR/2021/logos/W3C" width="72"> </a> </p>
   <h1 class="p-name no-ref" id="title">Sensor Use Cases</h1>
   <p id="w3c-state"><a href="https://www.w3.org/standards/types#NOTE">W3C Group Note</a>, <time class="dt-updated" datetime="1970-01-01">1 January 1970</time></p>
   <details open>
    <summary>More details about this document</summary>
    <div data-fill-with="spec-metadata">
     <dl>
      <dt>This version:
      <dd><a class="u-url" href="https://www.w3.org/TR/1970/NOTE-generic-sensor-usecases-19700101/">https://www.w3.org/TR/1970/NOTE-generic-sensor-usecases-19700101/</a>
      <dt>Latest published version:
      <dd><a href="http://www.w3.org/TR/generic-sensor-usecases/">http://www.w3.org/TR/generic-sensor-usecases/</a>
      <dt>Editor's Draft:
      <dd><a href="https://w3c.github.io/sensors/usecases">https://w3c.github.io/sensors/usecases</a>
      <dt>History:
      <dd><a class="u-url" href="https://www.w3.org/standards/history/generic-sensor-usecases">https://www.w3.org/standards/history/generic-sensor-usecases</a>
      <dt>Feedback:
      <dd><span><a href="mailto:public-device-apis@w3.org?subject=%5Bgeneric-sensor-usecases%5D%20YOUR%20TOPIC%20HERE">public-device-apis@w3.org</a> with subject line “<kbd>[generic-sensor-usecases] <i data-lt>… message topic …</i></kbd>” (<a href="https://lists.w3.org/Archives/Public/public-device-apis/" rel="discussion">archives</a>)</span>
      <dt class="editor">Editors:
      <dd class="editor p-author h-card vcard" data-editor-id="50572"><span class="p-name fn">Rick Waldron</span> (<span class="p-org org">Bocoup, formerly on behalf of JS Foundation</span>)
      <dd class="editor p-author h-card vcard" data-editor-id="78325"><a class="p-name fn u-url url" href="https://intel.com/">Mikhail Pozdnyakov</a> (<span class="p-org org">Intel Corporation</span>)
      <dd class="editor p-author h-card vcard" data-editor-id="78335"><a class="p-name fn u-url url" href="https://intel.com/">Alexander Shalamov</a> (<span class="p-org org">Intel Corporation</span>)
      <dt class="editor">Former Editor:
      <dd class="editor p-author h-card vcard" data-editor-id="60809"><a class="p-name fn u-url url" href="http://tobie.me">Tobie Langel</a> (<span class="p-org org">Codespeaks, formerly on behalf of Intel Corporation</span>) <a class="u-email email" href="mailto:tobie@codespeaks.com">tobie@codespeaks.com</a>
      <dt>Bug Reports:
      <dd><a href="https://www.github.com/w3c/sensors/issues/new">via the w3c/sensors repository on GitHub</a>
      <dt>Issue Tracking:
      <dd><a href="https://github.com/w3c/sensors/milestones/Level%201">Level 1 Issues</a>
     </dl>
    </div>
   </details>
   <div data-fill-with="warning"></div>
   <p class="copyright" data-fill-with="copyright"><a href="https://www.w3.org/Consortium/Legal/ipr-notice#Copyright">Copyright</a> © 1970 <a href="https://www.w3.org/"><abbr title="World Wide Web Consortium">W3C</abbr></a><sup>®</sup> (<a href="https://www.csail.mit.edu/"><abbr title="Massachusetts Institute of Technology">MIT</abbr></a>, <a href="https://www.ercim.eu/"><abbr title="European Research Consortium for Informatics and Mathematics">ERCIM</abbr></a>, <a href="https://www.keio.ac.jp/">Keio</a>, <a href="https://ev.buaa.edu.cn/">Beihang</a>). W3C <a href="https://www.w3.org/Consortium/Legal/ipr-notice#Legal_Disclaimer">liability</a>, <a href="https://www.w3.org/Consortium/Legal/ipr-notice#W3C_Trademarks">trademark</a> and <a href="https://www.w3.org/Consortium/Legal/2015/copyright-software-and-document" rel="license">permissive document license</a> rules apply. </p>
   <hr title="Separator for header">
  </div>
  <div class="p-summary" data-fill-with="abstract">
   <h2 class="no-num no-toc no-ref heading settled" id="abstract"><span class="content">Abstract</span></h2>
   <p>This document lists use cases for sensor data exposed to the Open Web Platform along with code examples of how Web developers ("authors" in spec speech) would listen to sensor data and use it within their application-level code.</p>
  </div>
  <h2 class="no-num no-toc no-ref heading settled" id="sotd"><span class="content">Status of this document</span></h2>
  <div data-fill-with="status">
   <p></p>
  </div>
  <div data-fill-with="at-risk"></div>
  <nav data-fill-with="table-of-contents" id="toc">
   <h2 class="no-num no-toc no-ref" id="contents">Table of Contents</h2>
   <ol class="toc" role="directory">
    <li><a href="#intro"><span class="secno">1</span> <span class="content">Introduction</span></a>
    <li>
     <a href="#usecases-and-requirements"><span class="secno">2</span> <span class="content">Use Cases and requirements</span></a>
     <ol class="toc">
      <li><a href="#environmental-sensors"><span class="secno">2.1</span> <span class="content">Environmental sensors</span></a>
      <li><a href="#inertial-sensors"><span class="secno">2.2</span> <span class="content">Inertial sensors</span></a>
      <li><a href="#fusion-sensors"><span class="secno">2.3</span> <span class="content">Fusion sensors</span></a>
      <li><a href="#custom-fusion-sensors"><span class="secno">2.4</span> <span class="content">Creating custom fusion sensors</span></a>
      <li><a href="#trigger-sensors"><span class="secno">2.5</span> <span class="content">Trigger sensors</span></a>
     </ol>
    <li>
     <a href="#index"><span class="secno"></span> <span class="content">Index</span></a>
     <ol class="toc">
      <li><a href="#index-defined-elsewhere"><span class="secno"></span> <span class="content">Terms defined by reference</span></a>
     </ol>
    <li>
     <a href="#references"><span class="secno"></span> <span class="content">References</span></a>
     <ol class="toc">
      <li><a href="#normative"><span class="secno"></span> <span class="content">Normative References</span></a>
     </ol>
   </ol>
  </nav>
  <main>
   <h2 class="heading settled" data-level="1" id="intro"><span class="secno">1. </span><span class="content">Introduction</span><a class="self-link" href="#intro"></a></h2>
   <p>The Generic Sensor API provides generic interfaces for accessing sensors. The purpose of this
document is to collect use cases, requirements, references to applicable documents and concrete
sensor specifications in order to provide input for Generic Sensor API improvements.</p>
   <h2 class="heading settled" data-level="2" id="usecases-and-requirements"><span class="secno">2. </span><span class="content">Use Cases and requirements</span><a class="self-link" href="#usecases-and-requirements"></a></h2>
   <p>The use cases and requirements for the sensors differ from one application to another. In this
section, sensors are grouped into categories that represent particular set of common use cases.</p>
   <h3 class="heading settled" data-level="2.1" id="environmental-sensors"><span class="secno">2.1. </span><span class="content">Environmental sensors</span><a class="self-link" href="#environmental-sensors"></a></h3>
   <p>This group of sensors measure physical properties of the environment they are in. For example,
sensors that measure barometric air pressure, humidity, ambient light, ambient air temperature,
etc., belong to this group.</p>
   <p>Environmental sensors might be used in applications like: home automation, accessibility, personal
weather forecast, sport and fitness monitoring. Additional use cases and requirements can be found
from corresponding environmental sensors that are based on Generic Sensor API:</p>
   <ul>
    <li data-md>
     <p><a data-link-type="dfn" href="https://w3c.github.io/ambient-light#usecases-requirements" id="ref-for-usecases-requirements">Ambient light sensor</a></p>
    <li data-md>
     <p><a data-link-type="dfn" href="https://w3c.github.io/proximity#proximity-sensor-interface" id="ref-for-proximity-sensor-interface">Proximity sensor</a></p>
    <li data-md>
     <p><a data-link-type="dfn" href="https://w3c.github.io/magnetometer#usecases-and-requirements" id="ref-for-usecases-and-requirements"> Magnetometer</a></p>
   </ul>
   <h3 class="heading settled" data-level="2.2" id="inertial-sensors"><span class="secno">2.2. </span><span class="content">Inertial sensors</span><a class="self-link" href="#inertial-sensors"></a></h3>
   <p>This group of sensors is based on inertia and relevant measuring concepts. Usually, inertial
sensors are part of IMU (Inertial Measurements Unit) that measure <a data-link-type="dfn" href="https://w3c.github.io/accelerometer#acceleration" id="ref-for-acceleration">acceleration</a> using <a data-link-type="dfn" href="https://w3c.github.io/accelerometer#accelerometer-interface" id="ref-for-accelerometer-interface">accelerometer</a> and <a data-link-type="dfn" href="https://w3c.github.io/gyroscope#angular-velocity" id="ref-for-angular-velocity">rotational rate</a> using <a data-link-type="dfn" href="https://w3c.github.io/gyroscope#gyroscope-interface" id="ref-for-gyroscope-interface">gyroscope</a>. <a data-link-type="dfn" href="https://w3c.github.io/magnetometer#magnetometer-interface" id="ref-for-magnetometer-interface">Magnetometer</a> might be part of IMU and
provide data to calculate heading reference and/or <a data-link-type="dfn" href="https://w3c.github.io/gyroscope#gyroscope-interface" id="ref-for-gyroscope-interface①">gyroscope</a> drift correction.</p>
   <p>Inertial sensors enable various use cases, such as: virtual and augmented reality, immersive gaming,
activity recognition, sport and fitness monitoring, 3D scanning, indoor navigation and mapping.
The <a data-link-type="dfn" href="https://w3c.github.io/motion-sensors#usecases-and-requirements" id="ref-for-usecases-and-requirements①">motion sensors explainer</a> has extensive list of use cases and references to applicable
scientific papers.</p>
   <p>The following inertial sensors are based on Generic Sensor API:</p>
   <ul>
    <li data-md>
     <p><a data-link-type="dfn" href="https://w3c.github.io/accelerometer#accelerometer-interface" id="ref-for-accelerometer-interface①">Accelerometer</a></p>
    <li data-md>
     <p><a data-link-type="dfn" href="https://w3c.github.io/gyroscope#gyroscope-interface" id="ref-for-gyroscope-interface②">Gyroscope</a></p>
   </ul>
   <h3 class="heading settled" data-level="2.3" id="fusion-sensors"><span class="secno">2.3. </span><span class="content">Fusion sensors</span><a class="self-link" href="#fusion-sensors"></a></h3>
   <p>This group of sensors provide measurements that are 'fused together' by fusion algorithm. The
fusion algorithms might require data from one or multiple sources. For example, the data
provided by the relative orientation sensor can be fused from <a data-link-type="dfn" href="https://w3c.github.io/accelerometer#accelerometer-interface" id="ref-for-accelerometer-interface②">accelerometer</a> or be a combination
of <a data-link-type="dfn" href="https://w3c.github.io/accelerometer#accelerometer-interface" id="ref-for-accelerometer-interface③">accelerometer</a> and <a data-link-type="dfn" href="https://w3c.github.io/gyroscope#gyroscope-interface" id="ref-for-gyroscope-interface③">gyroscope</a> data. The most common use cases for fusion sensors can be found in
the <a data-link-type="dfn" href="https://w3c.github.io/motion-sensors#usecases-and-requirements" id="ref-for-usecases-and-requirements②">motion sensors explainer</a> document.</p>
   <p>The following fusion sensors are based on Generic Sensor API:</p>
   <ul>
    <li data-md>
     <p><a data-link-type="dfn" href="https://w3c.github.io/orientation-sensor#absoluteorientationsensor-interface" id="ref-for-absoluteorientationsensor-interface">Absolute orientation sensor</a></p>
    <li data-md>
     <p><a data-link-type="dfn" href="https://w3c.github.io/orientation-sensor#relativeorientationsensor-interface" id="ref-for-relativeorientationsensor-interface">Relative orientation sensor</a></p>
    <li data-md>
     <p><a data-link-type="dfn" href="https://w3c.github.io/accelerometer#linearaccelerationsensor-interface" id="ref-for-linearaccelerationsensor-interface">Linear acceleration sensor</a></p>
    <li data-md>
     <p><a data-link-type="dfn" href="https://w3c.github.io/accelerometer#gravitysensor-interface" id="ref-for-gravitysensor-interface">Gravity sensor</a></p>
   </ul>
   <p class="note" role="note"><span class="marker">Note:</span> The <a data-link-type="dfn" href="https://w3c.github.io/magnetometer#magnetometer-interface" id="ref-for-magnetometer-interface①">Magnetometer</a> is often used to improve integrity of the data provided by <a data-link-type="dfn" href="https://w3c.github.io/accelerometer#accelerometer-interface" id="ref-for-accelerometer-interface④">accelerometer</a> and/or <a data-link-type="dfn" href="https://w3c.github.io/gyroscope#gyroscope-interface" id="ref-for-gyroscope-interface④">gyroscope</a>, as well as for establishing frame of reference based on
Earth’s coordinate system.</p>
   <h3 class="heading settled" data-level="2.4" id="custom-fusion-sensors"><span class="secno">2.4. </span><span class="content">Creating custom fusion sensors</span><a class="self-link" href="#custom-fusion-sensors"></a></h3>
   <p>The web applications might require data that is not provided by the UA. Generic Sensor API allows
implementation of custom fusion sensors that may fulfill special use cases.</p>
   <p class="issue" id="issue-f96e1b22"><a class="self-link" href="#issue-f96e1b22"></a> We might need to think about opening this as an improvement for Generic Sensor API.
Interface that will take fusion algorithm and as a result, provide new sensor property and/or
modify <code>onreading</code> behavior. This will enable implementation of various sensors, like:
SimpleOrientation, FreeFall, Pedometer, Compass  or simple <a href="#trigger-sensors"> trigger sensors</a>.</p>
   <p>In cases when web application requires additional functionality from the concrete sensor, extension
of the base sensor interface might be the simplest solution.</p>
   <div class="example" id="example-92e5182d">
    <a class="self-link" href="#example-92e5182d"></a> In this example, we create a simple linear free fall detection sensor. 
<pre class="highlight"><c- a>class</c-> FreeFallSensor <c- k>extends</c-> Accelerometer <c- p>{</c->
    set onreading<c- p>(</c->func<c- p>)</c-> <c- p>{</c->
        <c- k>super</c-><c- p>.</c->onreading <c- o>=</c-> <c- p>()</c-> <c- p>=></c-> <c- p>{</c->
            <c- a>let</c-> isFalling <c- o>=</c-> Math<c- p>.</c->hypot<c- p>(</c-><c- k>super</c-><c- p>.</c->x<c- p>,</c-> <c- k>super</c-><c- p>.</c->y<c- p>,</c-> <c- k>super</c-><c- p>.</c->z<c- p>)</c-> <c- o>&lt;</c-> <c- mf>0.5</c-><c- p>;</c->
            <c- k>if</c-> <c- p>(</c-><c- k>this</c-><c- p>.</c->inFreeFall_ <c- o>!=</c-> isFalling<c- p>)</c-> <c- p>{</c->
                <c- k>this</c-><c- p>.</c->inFreeFall_ <c- o>=</c->  isFalling<c- p>;</c->
                func<c- p>();</c->
            <c- p>}</c->
        <c- p>}</c->
    <c- p>}</c->

    get inFreeFall<c- p>()</c-> <c- p>{</c->
        <c- k>return</c-> <c- k>this</c-><c- p>.</c->inFreeFall_<c- p>;</c->
    <c- p>}</c->
<c- p>}</c->
</pre>
   </div>
   <p>When the web application requires measurements that are fused from multiple sensor sources,
simple aggregation pattern may be used.</p>
   <div class="example" id="example-8caf49fa">
    <a class="self-link" href="#example-8caf49fa"></a> In this simplified example, we define <code>FusionSensor</code> class that aggregates multiple
    sources and provides fused data. 
<pre class="highlight"><c- a>class</c-> FusionSensor <c- p>{</c->
    <c- kr>constructor</c-><c- p>(</c->sensors<c- p>,</c-> algorithm<c- p>)</c-> <c- p>{</c->
        <c- k>this</c-><c- p>.</c->sensors_ <c- o>=</c-> sensors<c- p>;</c->
        <c- k>this</c-><c- p>.</c->algorithm_ <c- o>=</c-> algorithm<c- p>.</c->bind<c- p>(</c-><c- k>this</c-><c- p>);</c->
    <c- p>}</c->

    start<c- p>()</c-> <c- p>{</c->
        <c- k>this</c-><c- p>.</c->sensors_<c- p>.</c->map<c- p>(</c->sensor <c- p>=></c-> sensor<c- p>.</c->start<c- p>());</c->
    <c- p>}</c->

    stop<c- p>()</c->  <c- p>{</c->
        <c- k>this</c-><c- p>.</c->sensors_<c- p>.</c->map<c- p>(</c->sensor <c- p>=></c-> sensor<c- p>.</c->stop<c- p>());</c->
    <c- p>}</c->

    set onreading<c- p>(</c->func<c- p>)</c-> <c- p>{</c->
        <c- k>this</c-><c- p>.</c->sensors_<c- p>.</c->map<c- p>(</c->sensor <c- p>=></c-> <c- p>{</c->
            sensor<c- p>.</c->onreading <c- o>=</c-> <c- p>()</c-> <c- p>=></c-> <c- p>{</c->
                <c- k>this</c-><c- p>.</c->fusedReading_ <c- o>=</c-> <c- k>this</c-><c- p>.</c->algorithm_<c- p>(</c->sensor<c- p>,</c-> <c- k>this</c-><c- p>.</c->sensors_<c- p>);</c->
                func<c- p>();</c->
            <c- p>}</c->
        <c- p>});</c->
    <c- p>}</c->

    get fusedReading<c- p>()</c-> <c- p>{</c->
        <c- k>return</c-> <c- k>this</c-><c- p>.</c->fusedReading_<c- p>;</c->
    <c- p>}</c->
<c- p>}</c->

<c- c1>// Stateful algorithm that finds brightest spot during calibration phase and uses</c->
<c- c1>// it as a fixed frame of reference to calculate relative orientation from brightest</c->
<c- c1>// light source.</c->
<c- a>let</c-> custom_algo <c- o>=</c-> <c- p>(</c->changed_source<c- p>,</c-> all_sources<c- p>)</c-> <c- p>=></c-> <c- p>{</c-> <c- k>return</c-> <c- ow>new</c-> DOMMatrix<c- p>();</c-> <c- p>}</c->
<c- a>let</c-> source_sensors <c- o>=</c-> <c- p>[</c-><c- ow>new</c-> Accelerometer<c- p>(),</c-> <c- ow>new</c-> Gyroscope<c- p>(),</c-> <c- ow>new</c-> AmbientLightSensor<c- p>()];</c->
<c- a>let</c-> sensor <c- o>=</c-> <c- ow>new</c-> FusionSensor<c- p>(</c->source_sensors<c- p>,</c-> custom_algo<c- p>);</c->
sensor<c- p>.</c->onreading <c- o>=</c-> <c- p>()</c-> <c- p>=></c-> <c- p>{</c-> console<c- p>.</c->log<c- p>(</c->JSON<c- p>.</c->stringify<c- p>(</c->sensor<c- p>.</c->fusedReading<c- p>));</c-> <c- p>}</c->
sensor<c- p>.</c->start<c- p>();</c->
</pre>
   </div>
   <h3 class="heading settled" data-level="2.5" id="trigger-sensors"><span class="secno">2.5. </span><span class="content">Trigger sensors</span><a class="self-link" href="#trigger-sensors"></a></h3>
   <p class="issue" id="issue-4af7337d"><a class="self-link" href="#issue-4af7337d"></a> This group of sensors may not need frequency. The HW will just fire interrupt to
signal about the change. If trigger sensor functionality is provided by e.g., <a data-link-type="dfn" href="https://w3c.github.io/accelerometer#accelerometer-interface" id="ref-for-accelerometer-interface⑤">accelerometer</a>,
sensor would be operating in special low-power mode.</p>
   <p>For the purpose of this document, trigger sensors group is characterised by the simplicity
of the hardware, limited sensor configuration capabilities, special mode of operation or
notification mechanism for the new sensor readings. For example, reed switch or hall effect sensors
that will trigger hardware interrupt and provide one bit reading data (on / off).</p>
   <p>The following list of sensors might be a good example of trigger sensors:</p>
   <ul>
    <li data-md>
     <p>Reed switch and hall effect sensors</p>
    <li data-md>
     <p>Significant motion, no motion, tap, flat, free fall, low-g and high-g sensors</p>
    <li data-md>
     <p>Laser or infrared switch sensors</p>
   </ul>
  </main>
<script src="https://www.w3.org/scripts/TR/2021/fixup.js"></script>
  <h2 class="no-num no-ref heading settled" id="index"><span class="content">Index</span><a class="self-link" href="#index"></a></h2>
  <aside aria-labelledby="infopaneltitle-for-cdbee37a361d878d169f1ad4ca3547d9" class="dfn-panel" data-for="cdbee37a361d878d169f1ad4ca3547d9" id="infopanel-for-cdbee37a361d878d169f1ad4ca3547d9">
   <span id="infopaneltitle-for-cdbee37a361d878d169f1ad4ca3547d9" style="display:none">Info about the 'acceleration' external reference.</span><a href="https://w3c.github.io/accelerometer#acceleration">https://w3c.github.io/accelerometer#acceleration</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-acceleration">2.2. Inertial sensors</a>
   </ul>
  </aside>
  <aside aria-labelledby="infopaneltitle-for-e91a8b5a204c8d9e391a3477dbeee2b6" class="dfn-panel" data-for="e91a8b5a204c8d9e391a3477dbeee2b6" id="infopanel-for-e91a8b5a204c8d9e391a3477dbeee2b6">
   <span id="infopaneltitle-for-e91a8b5a204c8d9e391a3477dbeee2b6" style="display:none">Info about the 'accelerometer' external reference.</span><a href="https://w3c.github.io/accelerometer#accelerometer-interface">https://w3c.github.io/accelerometer#accelerometer-interface</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-accelerometer-interface">2.2. Inertial sensors</a> <a href="#ref-for-accelerometer-interface①">(2)</a>
    <li><a href="#ref-for-accelerometer-interface②">2.3. Fusion sensors</a> <a href="#ref-for-accelerometer-interface③">(2)</a> <a href="#ref-for-accelerometer-interface④">(3)</a>
    <li><a href="#ref-for-accelerometer-interface⑤">2.5. Trigger sensors</a>
   </ul>
  </aside>
  <aside aria-labelledby="infopaneltitle-for-b0acdc913a4ac8876ff6cd50f2a7bf69" class="dfn-panel" data-for="b0acdc913a4ac8876ff6cd50f2a7bf69" id="infopanel-for-b0acdc913a4ac8876ff6cd50f2a7bf69">
   <span id="infopaneltitle-for-b0acdc913a4ac8876ff6cd50f2a7bf69" style="display:none">Info about the 'gravity sensor' external reference.</span><a href="https://w3c.github.io/accelerometer#gravitysensor-interface">https://w3c.github.io/accelerometer#gravitysensor-interface</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-gravitysensor-interface">2.3. Fusion sensors</a>
   </ul>
  </aside>
  <aside aria-labelledby="infopaneltitle-for-9e8c4dbe21c606284667a1a7de99c872" class="dfn-panel" data-for="9e8c4dbe21c606284667a1a7de99c872" id="infopanel-for-9e8c4dbe21c606284667a1a7de99c872">
   <span id="infopaneltitle-for-9e8c4dbe21c606284667a1a7de99c872" style="display:none">Info about the 'linear acceleration sensor' external reference.</span><a href="https://w3c.github.io/accelerometer#linearaccelerationsensor-interface">https://w3c.github.io/accelerometer#linearaccelerationsensor-interface</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-linearaccelerationsensor-interface">2.3. Fusion sensors</a>
   </ul>
  </aside>
  <aside aria-labelledby="infopaneltitle-for-fd42c82018d3dad909bed71a8de988a9" class="dfn-panel" data-for="fd42c82018d3dad909bed71a8de988a9" id="infopanel-for-fd42c82018d3dad909bed71a8de988a9">
   <span id="infopaneltitle-for-fd42c82018d3dad909bed71a8de988a9" style="display:none">Info about the 'ambient light sensor' external reference.</span><a href="https://w3c.github.io/ambient-light#usecases-requirements">https://w3c.github.io/ambient-light#usecases-requirements</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-usecases-requirements">2.1. Environmental sensors</a>
   </ul>
  </aside>
  <aside aria-labelledby="infopaneltitle-for-a7f3f6aca181e95f5e61929a70798d0f" class="dfn-panel" data-for="a7f3f6aca181e95f5e61929a70798d0f" id="infopanel-for-a7f3f6aca181e95f5e61929a70798d0f">
   <span id="infopaneltitle-for-a7f3f6aca181e95f5e61929a70798d0f" style="display:none">Info about the 'gyroscope' external reference.</span><a href="https://w3c.github.io/gyroscope#gyroscope-interface">https://w3c.github.io/gyroscope#gyroscope-interface</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-gyroscope-interface">2.2. Inertial sensors</a> <a href="#ref-for-gyroscope-interface①">(2)</a> <a href="#ref-for-gyroscope-interface②">(3)</a>
    <li><a href="#ref-for-gyroscope-interface③">2.3. Fusion sensors</a> <a href="#ref-for-gyroscope-interface④">(2)</a>
   </ul>
  </aside>
  <aside aria-labelledby="infopaneltitle-for-573695bbcda4fe634e60cb8bae38046d" class="dfn-panel" data-for="573695bbcda4fe634e60cb8bae38046d" id="infopanel-for-573695bbcda4fe634e60cb8bae38046d">
   <span id="infopaneltitle-for-573695bbcda4fe634e60cb8bae38046d" style="display:none">Info about the 'rotational rate' external reference.</span><a href="https://w3c.github.io/gyroscope#angular-velocity">https://w3c.github.io/gyroscope#angular-velocity</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-angular-velocity">2.2. Inertial sensors</a>
   </ul>
  </aside>
  <aside aria-labelledby="infopaneltitle-for-23007486fbe8ca6091f576a3b7cb7ce8" class="dfn-panel" data-for="23007486fbe8ca6091f576a3b7cb7ce8" id="infopanel-for-23007486fbe8ca6091f576a3b7cb7ce8">
   <span id="infopaneltitle-for-23007486fbe8ca6091f576a3b7cb7ce8" style="display:none">Info about the 'magnetometer' external reference.</span><a href="https://w3c.github.io/magnetometer#magnetometer-interface">https://w3c.github.io/magnetometer#magnetometer-interface</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-magnetometer-interface">2.2. Inertial sensors</a>
    <li><a href="#ref-for-magnetometer-interface①">2.3. Fusion sensors</a>
   </ul>
  </aside>
  <aside aria-labelledby="infopaneltitle-for-4889b1733ed988a2e5d7de9158baa626" class="dfn-panel" data-for="4889b1733ed988a2e5d7de9158baa626" id="infopanel-for-4889b1733ed988a2e5d7de9158baa626">
   <span id="infopaneltitle-for-4889b1733ed988a2e5d7de9158baa626" style="display:none">Info about the 'magnetometer use cases' external reference.</span><a href="https://w3c.github.io/magnetometer#usecases-and-requirements">https://w3c.github.io/magnetometer#usecases-and-requirements</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-usecases-and-requirements">2.1. Environmental sensors</a>
   </ul>
  </aside>
  <aside aria-labelledby="infopaneltitle-for-518234d0da8be62338c7608baf85caed" class="dfn-panel" data-for="518234d0da8be62338c7608baf85caed" id="infopanel-for-518234d0da8be62338c7608baf85caed">
   <span id="infopaneltitle-for-518234d0da8be62338c7608baf85caed" style="display:none">Info about the 'motion sensors explainer' external reference.</span><a href="https://w3c.github.io/motion-sensors#usecases-and-requirements">https://w3c.github.io/motion-sensors#usecases-and-requirements</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-usecases-and-requirements①">2.2. Inertial sensors</a>
    <li><a href="#ref-for-usecases-and-requirements②">2.3. Fusion sensors</a>
   </ul>
  </aside>
  <aside aria-labelledby="infopaneltitle-for-e185e4226e2b06e04913a22d0195ec90" class="dfn-panel" data-for="e185e4226e2b06e04913a22d0195ec90" id="infopanel-for-e185e4226e2b06e04913a22d0195ec90">
   <span id="infopaneltitle-for-e185e4226e2b06e04913a22d0195ec90" style="display:none">Info about the 'absolute orientation sensor' external reference.</span><a href="https://w3c.github.io/orientation-sensor#absoluteorientationsensor-interface">https://w3c.github.io/orientation-sensor#absoluteorientationsensor-interface</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-absoluteorientationsensor-interface">2.3. Fusion sensors</a>
   </ul>
  </aside>
  <aside aria-labelledby="infopaneltitle-for-58566ebbf9545fb8054c7047d6ac3831" class="dfn-panel" data-for="58566ebbf9545fb8054c7047d6ac3831" id="infopanel-for-58566ebbf9545fb8054c7047d6ac3831">
   <span id="infopaneltitle-for-58566ebbf9545fb8054c7047d6ac3831" style="display:none">Info about the 'relative orientation sensor' external reference.</span><a href="https://w3c.github.io/orientation-sensor#relativeorientationsensor-interface">https://w3c.github.io/orientation-sensor#relativeorientationsensor-interface</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-relativeorientationsensor-interface">2.3. Fusion sensors</a>
   </ul>
  </aside>
  <aside aria-labelledby="infopaneltitle-for-464692d4e8b9fb5c150e00c27018826f" class="dfn-panel" data-for="464692d4e8b9fb5c150e00c27018826f" id="infopanel-for-464692d4e8b9fb5c150e00c27018826f">
   <span id="infopaneltitle-for-464692d4e8b9fb5c150e00c27018826f" style="display:none">Info about the 'proximity sensor' external reference.</span><a href="https://w3c.github.io/proximity#proximity-sensor-interface">https://w3c.github.io/proximity#proximity-sensor-interface</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-proximity-sensor-interface">2.1. Environmental sensors</a>
   </ul>
  </aside>
  <h3 class="no-num no-ref heading settled" id="index-defined-elsewhere"><span class="content">Terms defined by reference</span><a class="self-link" href="#index-defined-elsewhere"></a></h3>
  <ul class="index">
   <li>
    <a data-link-type="biblio">[ACCELEROMETER]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="cdbee37a361d878d169f1ad4ca3547d9">acceleration</span>
     <li><span class="dfn-paneled" id="e91a8b5a204c8d9e391a3477dbeee2b6">accelerometer</span>
     <li><span class="dfn-paneled" id="b0acdc913a4ac8876ff6cd50f2a7bf69">gravity sensor</span>
     <li><span class="dfn-paneled" id="9e8c4dbe21c606284667a1a7de99c872">linear acceleration sensor</span>
    </ul>
   <li>
    <a data-link-type="biblio">[AMBIENT-LIGHT]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="fd42c82018d3dad909bed71a8de988a9">ambient light sensor</span>
    </ul>
   <li>
    <a data-link-type="biblio">[GYROSCOPE]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="a7f3f6aca181e95f5e61929a70798d0f">gyroscope</span>
     <li><span class="dfn-paneled" id="573695bbcda4fe634e60cb8bae38046d">rotational rate</span>
    </ul>
   <li>
    <a data-link-type="biblio">[MAGNETOMETER]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="23007486fbe8ca6091f576a3b7cb7ce8">magnetometer</span>
     <li><span class="dfn-paneled" id="4889b1733ed988a2e5d7de9158baa626">magnetometer use cases</span>
    </ul>
   <li>
    <a data-link-type="biblio">[MOTION-SENSORS]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="518234d0da8be62338c7608baf85caed">motion sensors explainer</span>
    </ul>
   <li>
    <a data-link-type="biblio">[ORIENTATION-SENSOR]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="e185e4226e2b06e04913a22d0195ec90">absolute orientation sensor</span>
     <li><span class="dfn-paneled" id="58566ebbf9545fb8054c7047d6ac3831">relative orientation sensor</span>
    </ul>
   <li>
    <a data-link-type="biblio">[PROXIMITY]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="464692d4e8b9fb5c150e00c27018826f">proximity sensor</span>
    </ul>
  </ul>
  <h2 class="no-num no-ref heading settled" id="references"><span class="content">References</span><a class="self-link" href="#references"></a></h2>
  <h3 class="no-num no-ref heading settled" id="normative"><span class="content">Normative References</span><a class="self-link" href="#normative"></a></h3>
  <dl>
   <dt id="biblio-accelerometer">[ACCELEROMETER]
   <dd>Anssi Kostiainen. <a href="https://www.w3.org/TR/accelerometer/"><cite>Accelerometer</cite></a>. 18 October 2022. CR. URL: <a href="https://www.w3.org/TR/accelerometer/">https://www.w3.org/TR/accelerometer/</a>
   <dt id="biblio-ambient-light">[AMBIENT-LIGHT]
   <dd>Anssi Kostiainen; Rijubrata Bhaumik. <a href="https://www.w3.org/TR/ambient-light/"><cite>Ambient Light Sensor</cite></a>. 18 October 2022. WD. URL: <a href="https://www.w3.org/TR/ambient-light/">https://www.w3.org/TR/ambient-light/</a>
   <dt id="biblio-gyroscope">[GYROSCOPE]
   <dd>Anssi Kostiainen. <a href="https://www.w3.org/TR/gyroscope/"><cite>Gyroscope</cite></a>. 7 December 2021. CR. URL: <a href="https://www.w3.org/TR/gyroscope/">https://www.w3.org/TR/gyroscope/</a>
   <dt id="biblio-magnetometer">[MAGNETOMETER]
   <dd>Anssi Kostiainen; Rijubrata Bhaumik. <a href="https://www.w3.org/TR/magnetometer/"><cite>Magnetometer</cite></a>. 7 December 2021. WD. URL: <a href="https://www.w3.org/TR/magnetometer/">https://www.w3.org/TR/magnetometer/</a>
   <dt id="biblio-motion-sensors">[MOTION-SENSORS]
   <dd>Kenneth Christiansen; Alexander Shalamov. <a href="https://www.w3.org/TR/motion-sensors/"><cite>Motion Sensors Explainer</cite></a>. 30 August 2017. NOTE. URL: <a href="https://www.w3.org/TR/motion-sensors/">https://www.w3.org/TR/motion-sensors/</a>
   <dt id="biblio-orientation-sensor">[ORIENTATION-SENSOR]
   <dd>Kenneth Christiansen; et al. <a href="https://www.w3.org/TR/orientation-sensor/"><cite>Orientation Sensor</cite></a>. 2 September 2021. WD. URL: <a href="https://www.w3.org/TR/orientation-sensor/">https://www.w3.org/TR/orientation-sensor/</a>
   <dt id="biblio-proximity">[PROXIMITY]
   <dd>Anssi Kostiainen; Rijubrata Bhaumik. <a href="https://www.w3.org/TR/proximity/"><cite>Proximity Sensor</cite></a>. 3 September 2021. WD. URL: <a href="https://www.w3.org/TR/proximity/">https://www.w3.org/TR/proximity/</a>
  </dl>
<script>/* script-dfn-panel */
"use strict";
{
    function queryAll(sel) {
        return [].slice.call(document.querySelectorAll(sel));
    }

    // Add popup behavior to all dfns to show the corresponding dfn-panel.
    var dfns = document.querySelectorAll('.dfn-paneled');
    for (let dfn of dfns) { insertDfnPopupAction(dfn); }

    document.body.addEventListener("click", (e) => {
        // If not handled already, just hide all dfn panels.
        hideAllDfnPanels();
    });

    function hideAllDfnPanels() {
        // Turn off any currently "on" or "activated" panels.
        queryAll(".dfn-panel.on, .dfn-panel.activated").forEach(el=>hideDfnPanel(el));
    }

    function showDfnPanel(dfnPanel, dfn) {
        hideAllDfnPanels(); // Only display one at this time.
        dfn.setAttribute("aria-expanded", "true");
        dfnPanel.classList.add("on");
        dfnPanel.style.left = "5px";
        dfnPanel.style.top = "0px";
        const panelRect = dfnPanel.getBoundingClientRect();
        const panelWidth = panelRect.right - panelRect.left;
        if (panelRect.right > document.body.scrollWidth) {
            // Panel's overflowing the screen.
            // Just drop it below the dfn and flip it rightward instead.
            // This still wont' fix things if the screen is *really* wide,
            // but fixing that's a lot harder without 'anchor()'.
            dfnPanel.style.top = "1.5em";
            dfnPanel.style.left = "auto";
            dfnPanel.style.right = "0px";
        }
    }

    function pinDfnPanel(dfnPanel) {
        // Switch it to "activated" state, which pins it.
        dfnPanel.classList.add("activated");
        dfnPanel.style.left = null;
        dfnPanel.style.top = null;
    }

    function hideDfnPanel(dfnPanel, dfn) {
        if(!dfn) {
            dfn = document.getElementById(dfnPanel.getAttribute("data-for"));
        }
        dfn.setAttribute("aria-expanded", "false")
        dfnPanel.classList.remove("on");
        dfnPanel.classList.remove("activated");
    }

    function toggleDfnPanel(dfnPanel, dfn) {
        if(dfnPanel.classList.contains("on")) {
            hideDfnPanel(dfnPanel, dfn);
        } else {
            showDfnPanel(dfnPanel, dfn);
        }
    }

    function insertDfnPopupAction(dfn) {
        // Find dfn panel
        const dfnPanel = document.querySelector(`.dfn-panel[data-for='${dfn.id}']`);
        if (dfnPanel) {
            const panelWrapper = document.createElement('span');
            panelWrapper.appendChild(dfnPanel);
            panelWrapper.style.position = "relative";
            panelWrapper.style.height = "0px";
            dfn.insertAdjacentElement("afterend", panelWrapper);
            dfn.setAttribute('role', 'button');
            dfn.setAttribute('aria-expanded', 'false')
            dfn.tabIndex = 0;
            dfn.classList.add('has-dfn-panel');
            dfn.addEventListener('click', (event) => {
                showDfnPanel(dfnPanel, dfn);
                event.stopPropagation();
            });
            dfn.addEventListener('keypress', (event) => {
                const kc = event.keyCode;
                // 32->Space, 13->Enter
                if(kc == 32 || kc == 13) {
                    toggleDfnPanel(dfnPanel, dfn);
                    event.stopPropagation();
                    event.preventDefault();
                }
            });

            dfnPanel.addEventListener('click', (event) => {
                pinDfnPanel(dfnPanel);
                event.stopPropagation();
            });

            dfnPanel.addEventListener('keydown', (event) => {
                if(event.keyCode == 27) { // Escape key
                    hideDfnPanel(dfnPanel, dfn);
                    event.stopPropagation();
                    event.preventDefault();
                }
            })

        } else {
            console.log("Couldn't find .dfn-panel[data-for='" + dfn.id + "']");
        }
    }
}
</script>