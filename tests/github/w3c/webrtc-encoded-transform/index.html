<!doctype html><html lang="en">
 <head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
  <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
  <title>WebRTC Encoded Transform</title>
  <meta content="ED" name="w3c-status">
  <link href="https://www.w3.org/StyleSheets/TR/2021/W3C-ED" rel="stylesheet">
  <link href="https://w3c.github.io/webrtc-encoded-transform/" rel="canonical">
  <meta content="dark light" name="color-scheme">
  <link href="https://www.w3.org/StyleSheets/TR/2021/dark.css" media="(prefers-color-scheme: dark)" rel="stylesheet" type="text/css">
<style>/* Boilerplate: style-autolinks */
.css.css, .property.property, .descriptor.descriptor {
    color: var(--a-normal-text);
    font-size: inherit;
    font-family: inherit;
}
.css::before, .property::before, .descriptor::before {
    content: "‘";
}
.css::after, .property::after, .descriptor::after {
    content: "’";
}
.property, .descriptor {
    /* Don't wrap property and descriptor names */
    white-space: nowrap;
}
.type { /* CSS value <type> */
    font-style: italic;
}
pre .property::before, pre .property::after {
    content: "";
}
[data-link-type="property"]::before,
[data-link-type="propdesc"]::before,
[data-link-type="descriptor"]::before,
[data-link-type="value"]::before,
[data-link-type="function"]::before,
[data-link-type="at-rule"]::before,
[data-link-type="selector"]::before,
[data-link-type="maybe"]::before {
    content: "‘";
}
[data-link-type="property"]::after,
[data-link-type="propdesc"]::after,
[data-link-type="descriptor"]::after,
[data-link-type="value"]::after,
[data-link-type="function"]::after,
[data-link-type="at-rule"]::after,
[data-link-type="selector"]::after,
[data-link-type="maybe"]::after {
    content: "’";
}

[data-link-type].production::before,
[data-link-type].production::after,
.prod [data-link-type]::before,
.prod [data-link-type]::after {
    content: "";
}

[data-link-type=element],
[data-link-type=element-attr] {
    font-family: Menlo, Consolas, "DejaVu Sans Mono", monospace;
    font-size: .9em;
}
[data-link-type=element]::before { content: "<" }
[data-link-type=element]::after  { content: ">" }

[data-link-type=biblio] {
    white-space: pre;
}

@media (prefers-color-scheme: dark) {
    :root {
        --selflink-text: black;
        --selflink-bg: silver;
        --selflink-hover-text: white;
    }
}
</style>
<style>/* Boilerplate: style-colors */
/* Any --*-text not paired with a --*-bg is assumed to have a transparent bg */
:root {
    color-scheme: light dark;

    --text: black;
    --bg: white;

    --unofficial-watermark: url(https://www.w3.org/StyleSheets/TR/2016/logos/UD-watermark);

    --logo-bg: #1a5e9a;
    --logo-active-bg: #c00;
    --logo-text: white;

    --tocnav-normal-text: #707070;
    --tocnav-normal-bg: var(--bg);
    --tocnav-hover-text: var(--tocnav-normal-text);
    --tocnav-hover-bg: #f8f8f8;
    --tocnav-active-text: #c00;
    --tocnav-active-bg: var(--tocnav-normal-bg);

    --tocsidebar-text: var(--text);
    --tocsidebar-bg: #f7f8f9;
    --tocsidebar-shadow: rgba(0,0,0,.1);
    --tocsidebar-heading-text: hsla(203,20%,40%,.7);

    --toclink-text: var(--text);
    --toclink-underline: #3980b5;
    --toclink-visited-text: var(--toclink-text);
    --toclink-visited-underline: #054572;

    --heading-text: #005a9c;

    --hr-text: var(--text);

    --algo-border: #def;

    --del-text: red;
    --del-bg: transparent;
    --ins-text: #080;
    --ins-bg: transparent;

    --a-normal-text: #034575;
    --a-normal-underline: #bbb;
    --a-visited-text: var(--a-normal-text);
    --a-visited-underline: #707070;
    --a-hover-bg: rgba(75%, 75%, 75%, .25);
    --a-active-text: #c00;
    --a-active-underline: #c00;

    --blockquote-border: silver;
    --blockquote-bg: transparent;
    --blockquote-text: currentcolor;

    --issue-border: #e05252;
    --issue-bg: #fbe9e9;
    --issue-text: var(--text);
    --issueheading-text: #831616;

    --example-border: #e0cb52;
    --example-bg: #fcfaee;
    --example-text: var(--text);
    --exampleheading-text: #574b0f;

    --note-border: #52e052;
    --note-bg: #e9fbe9;
    --note-text: var(--text);
    --noteheading-text: hsl(120, 70%, 30%);
    --notesummary-underline: silver;

    --assertion-border: #aaa;
    --assertion-bg: #eee;
    --assertion-text: black;

    --advisement-border: orange;
    --advisement-bg: #fec;
    --advisement-text: var(--text);
    --advisementheading-text: #b35f00;

    --warning-border: red;
    --warning-bg: hsla(40,100%,50%,0.95);
    --warning-text: var(--text);

    --amendment-border: #330099;
    --amendment-bg: #F5F0FF;
    --amendment-text: var(--text);
    --amendmentheading-text: #220066;

    --def-border: #8ccbf2;
    --def-bg: #def;
    --def-text: var(--text);
    --defrow-border: #bbd7e9;

    --datacell-border: silver;

    --indexinfo-text: #707070;

    --indextable-hover-text: black;
    --indextable-hover-bg: #f7f8f9;

    --outdatedspec-bg: rgba(0, 0, 0, .5);
    --outdatedspec-text: black;
    --outdated-bg: maroon;
    --outdated-text: white;
    --outdated-shadow: red;

    --editedrec-bg: darkorange;
}

@media (prefers-color-scheme: dark) {
    :root {
        --text: #ddd;
        --bg: black;

        --unofficial-watermark: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='400'%3E%3Cg fill='%23100808' transform='translate(200 200) rotate(-45) translate(-200 -200)' stroke='%23100808' stroke-width='3'%3E%3Ctext x='50%25' y='220' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EUNOFFICIAL%3C/text%3E%3Ctext x='50%25' y='305' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EDRAFT%3C/text%3E%3C/g%3E%3C/svg%3E");

        --logo-bg: #1a5e9a;
        --logo-active-bg: #c00;
        --logo-text: white;

        --tocnav-normal-text: #999;
        --tocnav-normal-bg: var(--bg);
        --tocnav-hover-text: var(--tocnav-normal-text);
        --tocnav-hover-bg: #080808;
        --tocnav-active-text: #f44;
        --tocnav-active-bg: var(--tocnav-normal-bg);

        --tocsidebar-text: var(--text);
        --tocsidebar-bg: #080808;
        --tocsidebar-shadow: rgba(255,255,255,.1);
        --tocsidebar-heading-text: hsla(203,20%,40%,.7);

        --toclink-text: var(--text);
        --toclink-underline: #6af;
        --toclink-visited-text: var(--toclink-text);
        --toclink-visited-underline: #054572;

        --heading-text: #8af;

        --hr-text: var(--text);

        --algo-border: #456;

        --del-text: #f44;
        --del-bg: transparent;
        --ins-text: #4a4;
        --ins-bg: transparent;

        --a-normal-text: #6af;
        --a-normal-underline: #555;
        --a-visited-text: var(--a-normal-text);
        --a-visited-underline: var(--a-normal-underline);
        --a-hover-bg: rgba(25%, 25%, 25%, .2);
        --a-active-text: #f44;
        --a-active-underline: var(--a-active-text);

        --borderedblock-bg: rgba(255, 255, 255, .05);

        --blockquote-border: silver;
        --blockquote-bg: var(--borderedblock-bg);
        --blockquote-text: currentcolor;

        --issue-border: #e05252;
        --issue-bg: var(--borderedblock-bg);
        --issue-text: var(--text);
        --issueheading-text: hsl(0deg, 70%, 70%);

        --example-border: hsl(50deg, 90%, 60%);
        --example-bg: var(--borderedblock-bg);
        --example-text: var(--text);
        --exampleheading-text: hsl(50deg, 70%, 70%);

        --note-border: hsl(120deg, 100%, 35%);
        --note-bg: var(--borderedblock-bg);
        --note-text: var(--text);
        --noteheading-text: hsl(120, 70%, 70%);
        --notesummary-underline: silver;

        --assertion-border: #444;
        --assertion-bg: var(--borderedblock-bg);
        --assertion-text: var(--text);

        --advisement-border: orange;
        --advisement-bg: #222218;
        --advisement-text: var(--text);
        --advisementheading-text: #f84;

        --warning-border: red;
        --warning-bg: hsla(40,100%,20%,0.95);
        --warning-text: var(--text);

        --amendment-border: #330099;
        --amendment-bg: #080010;
        --amendment-text: var(--text);
        --amendmentheading-text: #cc00ff;

        --def-border: #8ccbf2;
        --def-bg: #080818;
        --def-text: var(--text);
        --defrow-border: #136;

        --datacell-border: silver;

        --indexinfo-text: #aaa;

        --indextable-hover-text: var(--text);
        --indextable-hover-bg: #181818;

        --outdatedspec-bg: rgba(255, 255, 255, .5);
        --outdatedspec-text: black;
        --outdated-bg: maroon;
        --outdated-text: white;
        --outdated-shadow: red;

        --editedrec-bg: darkorange;
    }
    /* In case a transparent-bg image doesn't expect to be on a dark bg,
       which is quite common in practice... */
    img { background: white; }
}
</style>
<style>/* Boilerplate: style-counters */
body {
    counter-reset: example figure issue;
}
.issue {
    counter-increment: issue;
}
.issue:not(.no-marker)::before {
    content: "Issue " counter(issue);
}

.example {
    counter-increment: example;
}
.example:not(.no-marker)::before {
    content: "Example " counter(example);
}
.invalid.example:not(.no-marker)::before,
.illegal.example:not(.no-marker)::before {
    content: "Invalid Example" counter(example);
}

figcaption {
    counter-increment: figure;
}
figcaption:not(.no-marker)::before {
    content: "Figure " counter(figure) " ";
}
</style>
<style>/* Boilerplate: style-dfn-panel */
:root {
    --dfnpanel-bg: #ddd;
    --dfnpanel-text: var(--text);
    --dfnpanel-target-bg: #ffc;
    --dfnpanel-target-outline: orange;
}
@media (prefers-color-scheme: dark) {
    :root {
        --dfnpanel-bg: #222;
        --dfnpanel-text: var(--text);
        --dfnpanel-target-bg: #333;
        --dfnpanel-target-outline: silver;
    }
}
.dfn-panel {
    position: absolute;
    z-index: 35;
    width: 20em;
    width: 300px;
    height: auto;
    max-height: 500px;
    overflow: auto;
    padding: 0.5em 0.75em;
    font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
    background: var(--dfnpanel-bg);
    color: var(--dfnpanel-text);
    border: outset 0.2em;
    white-space: normal; /* in case it's moved into a pre */
}
.dfn-panel:not(.on) { display: none; }
.dfn-panel * { margin: 0; padding: 0; text-indent: 0; }
.dfn-panel > b { display: block; }
.dfn-panel a { color: var(--dfnpanel-text); }
.dfn-panel a:not(:hover) { text-decoration: none !important; border-bottom: none !important; }
.dfn-panel a:focus {
    outline: 5px auto Highlight;
    outline: 5px auto -webkit-focus-ring-color;
}
.dfn-panel > b + b { margin-top: 0.25em; }
.dfn-panel ul { padding: 0 0 0 1em; list-style: none; }
.dfn-panel li a {
    max-width: calc(300px - 1.5em - 1em);
    overflow: hidden;
    text-overflow: ellipsis;
}

.dfn-panel.activated {
    display: inline-block;
    position: fixed;
    left: 8px;
    bottom: 2em;
    margin: 0 auto;
    max-width: calc(100vw - 1.5em - .4em - .5em);
    max-height: 30vh;
    transition: left 1s ease-out, bottom 1s ease-out;
}

.dfn-panel .link-item:hover {
    text-decoration: underline;
}
.dfn-panel .link-item .copy-icon {
    opacity: 0;
}
.dfn-panel .link-item:hover .copy-icon,
.dfn-panel .link-item .copy-icon:focus {
    opacity: 1;
}

.dfn-panel .copy-icon {
    display: inline-block;
    margin-right: 0.5em;
    width: 0.85em;
    height: 1em;
    border-radius: 3px;
    background-color: #ccc;
    cursor: pointer;
}

.dfn-panel .copy-icon .icon {
    width: 100%;
    height: 100%;
    background-color: #fff;
    display: flex;
    justify-content: center;
    align-items: center;
    position: relative;
}

.dfn-panel .copy-icon .icon::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    border: 1px solid black;
    background-color: #ccc;
    opacity: 0.25;
    transform: translate(3px, -3px);
}

.dfn-panel .copy-icon:active .icon::before {
    opacity: 1;
}

.dfn-paneled[role="button"] { cursor: help; }

.highlighted {
    animation: target-fade 3s;
}

@keyframes target-fade {
    from {
        background-color: var(--dfnpanel-target-bg);
        outline: 5px solid var(--dfnpanel-target-outline);
    }
    to {
        color: var(--a-normal-text);
        background-color: transparent;
        outline: transparent;
    }
}
</style>
<style>/* Boilerplate: style-idl-highlighting */
pre.idl.highlight {
    background: var(--borderedblock-bg, var(--def-bg));
}
</style>
<style>/* Boilerplate: style-issues */
a[href].issue-return {
    float: right;
    float: inline-end;
    color: var(--issueheading-text);
    font-weight: bold;
    text-decoration: none;
}
</style>
<style>/* Boilerplate: style-md-lists */
/* This is a weird hack for me not yet following the commonmark spec
   regarding paragraph and lists. */
[data-md] > :first-child {
    margin-top: 0;
}
[data-md] > :last-child {
    margin-bottom: 0;
}
</style>
<style>/* Boilerplate: style-ref-hints */
:root {
    --ref-hint-bg: #ddd;
    --ref-hint-text: var(--text);
}
@media (prefers-color-scheme: dark) {
    :root {
        --ref-hint-bg: #222;
        --ref-hint-text: var(--text);
    }
}

.ref-hint {
    display: inline-block;
    position: absolute;
    z-index: 35;
    width: 20em;
    width: 300px;
    height: auto;
    max-height: 500px;
    overflow: auto;
    padding: 0.5em 0.5em;
    font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
    background: var(--ref-hint-bg);
    color: var(--ref-hint-text);
    border: outset 0.2em;
    white-space: normal; /* in case it's moved into a pre */
}

.ref-hint * { margin: 0; padding: 0; text-indent: 0; }

.ref-hint ul { padding: 0 0 0 1em; list-style: none; }
</style>
<style>/* Boilerplate: style-selflinks */
:root {
    --selflink-text: white;
    --selflink-bg: gray;
    --selflink-hover-text: black;
}
.heading, .issue, .note, .example, li, dt {
    position: relative;
}
a.self-link {
    position: absolute;
    top: 0;
    left: calc(-1 * (3.5rem - 26px));
    width: calc(3.5rem - 26px);
    height: 2em;
    text-align: center;
    border: none;
    transition: opacity .2s;
    opacity: .5;
}
a.self-link:hover {
    opacity: 1;
}
.heading > a.self-link {
    font-size: 83%;
}
.example > a.self-link,
.note > a.self-link,
.issue > a.self-link {
    /* These blocks are overflow:auto, so positioning outside
       doesn't work. */
    left: auto;
    right: 0;
}
li > a.self-link {
    left: calc(-1 * (3.5rem - 26px) - 2em);
}
dfn > a.self-link {
    top: auto;
    left: auto;
    opacity: 0;
    width: 1.5em;
    height: 1.5em;
    background: var(--selflink-bg);
    color: var(--selflink-text);
    font-style: normal;
    transition: opacity .2s, background-color .2s, color .2s;
}
dfn:hover > a.self-link {
    opacity: 1;
}
dfn > a.self-link:hover {
    color: var(--selflink-hover-text);
}

a.self-link::before            { content: "¶"; }
.heading > a.self-link::before { content: "§"; }
dfn > a.self-link::before      { content: "#"; }
</style>
<style>/* Boilerplate: style-syntax-highlighting */
code.highlight { padding: .1em; border-radius: .3em; }
pre.highlight, pre > code.highlight { display: block; padding: 1em; margin: .5em 0; overflow: auto; border-radius: 0; }

.highlight:not(.idl) { background: rgba(0, 0, 0, .03); }
c-[a] { color: #990055 } /* Keyword.Declaration */
c-[b] { color: #990055 } /* Keyword.Type */
c-[c] { color: #708090 } /* Comment */
c-[d] { color: #708090 } /* Comment.Multiline */
c-[e] { color: #0077aa } /* Name.Attribute */
c-[f] { color: #669900 } /* Name.Tag */
c-[g] { color: #222222 } /* Name.Variable */
c-[k] { color: #990055 } /* Keyword */
c-[l] { color: #000000 } /* Literal */
c-[m] { color: #000000 } /* Literal.Number */
c-[n] { color: #0077aa } /* Name */
c-[o] { color: #999999 } /* Operator */
c-[p] { color: #999999 } /* Punctuation */
c-[s] { color: #a67f59 } /* Literal.String */
c-[t] { color: #a67f59 } /* Literal.String.Single */
c-[u] { color: #a67f59 } /* Literal.String.Double */
c-[cp] { color: #708090 } /* Comment.Preproc */
c-[c1] { color: #708090 } /* Comment.Single */
c-[cs] { color: #708090 } /* Comment.Special */
c-[kc] { color: #990055 } /* Keyword.Constant */
c-[kn] { color: #990055 } /* Keyword.Namespace */
c-[kp] { color: #990055 } /* Keyword.Pseudo */
c-[kr] { color: #990055 } /* Keyword.Reserved */
c-[ld] { color: #000000 } /* Literal.Date */
c-[nc] { color: #0077aa } /* Name.Class */
c-[no] { color: #0077aa } /* Name.Constant */
c-[nd] { color: #0077aa } /* Name.Decorator */
c-[ni] { color: #0077aa } /* Name.Entity */
c-[ne] { color: #0077aa } /* Name.Exception */
c-[nf] { color: #0077aa } /* Name.Function */
c-[nl] { color: #0077aa } /* Name.Label */
c-[nn] { color: #0077aa } /* Name.Namespace */
c-[py] { color: #0077aa } /* Name.Property */
c-[ow] { color: #999999 } /* Operator.Word */
c-[mb] { color: #000000 } /* Literal.Number.Bin */
c-[mf] { color: #000000 } /* Literal.Number.Float */
c-[mh] { color: #000000 } /* Literal.Number.Hex */
c-[mi] { color: #000000 } /* Literal.Number.Integer */
c-[mo] { color: #000000 } /* Literal.Number.Oct */
c-[sb] { color: #a67f59 } /* Literal.String.Backtick */
c-[sc] { color: #a67f59 } /* Literal.String.Char */
c-[sd] { color: #a67f59 } /* Literal.String.Doc */
c-[se] { color: #a67f59 } /* Literal.String.Escape */
c-[sh] { color: #a67f59 } /* Literal.String.Heredoc */
c-[si] { color: #a67f59 } /* Literal.String.Interpol */
c-[sx] { color: #a67f59 } /* Literal.String.Other */
c-[sr] { color: #a67f59 } /* Literal.String.Regex */
c-[ss] { color: #a67f59 } /* Literal.String.Symbol */
c-[vc] { color: #0077aa } /* Name.Variable.Class */
c-[vg] { color: #0077aa } /* Name.Variable.Global */
c-[vi] { color: #0077aa } /* Name.Variable.Instance */
c-[il] { color: #000000 } /* Literal.Number.Integer.Long */

@media (prefers-color-scheme: dark) {
    .highlight:not(.idl) { background: rgba(255, 255, 255, .05); }

    c-[a] { color: #d33682 } /* Keyword.Declaration */
    c-[b] { color: #d33682 } /* Keyword.Type */
    c-[c] { color: #2aa198 } /* Comment */
    c-[d] { color: #2aa198 } /* Comment.Multiline */
    c-[e] { color: #268bd2 } /* Name.Attribute */
    c-[f] { color: #b58900 } /* Name.Tag */
    c-[g] { color: #cb4b16 } /* Name.Variable */
    c-[k] { color: #d33682 } /* Keyword */
    c-[l] { color: #657b83 } /* Literal */
    c-[m] { color: #657b83 } /* Literal.Number */
    c-[n] { color: #268bd2 } /* Name */
    c-[o] { color: #657b83 } /* Operator */
    c-[p] { color: #657b83 } /* Punctuation */
    c-[s] { color: #6c71c4 } /* Literal.String */
    c-[t] { color: #6c71c4 } /* Literal.String.Single */
    c-[u] { color: #6c71c4 } /* Literal.String.Double */
    c-[ch] { color: #2aa198 } /* Comment.Hashbang */
    c-[cp] { color: #2aa198 } /* Comment.Preproc */
    c-[cpf] { color: #2aa198 } /* Comment.PreprocFile */
    c-[c1] { color: #2aa198 } /* Comment.Single */
    c-[cs] { color: #2aa198 } /* Comment.Special */
    c-[kc] { color: #d33682 } /* Keyword.Constant */
    c-[kn] { color: #d33682 } /* Keyword.Namespace */
    c-[kp] { color: #d33682 } /* Keyword.Pseudo */
    c-[kr] { color: #d33682 } /* Keyword.Reserved */
    c-[ld] { color: #657b83 } /* Literal.Date */
    c-[nc] { color: #268bd2 } /* Name.Class */
    c-[no] { color: #268bd2 } /* Name.Constant */
    c-[nd] { color: #268bd2 } /* Name.Decorator */
    c-[ni] { color: #268bd2 } /* Name.Entity */
    c-[ne] { color: #268bd2 } /* Name.Exception */
    c-[nf] { color: #268bd2 } /* Name.Function */
    c-[nl] { color: #268bd2 } /* Name.Label */
    c-[nn] { color: #268bd2 } /* Name.Namespace */
    c-[py] { color: #268bd2 } /* Name.Property */
    c-[ow] { color: #657b83 } /* Operator.Word */
    c-[mb] { color: #657b83 } /* Literal.Number.Bin */
    c-[mf] { color: #657b83 } /* Literal.Number.Float */
    c-[mh] { color: #657b83 } /* Literal.Number.Hex */
    c-[mi] { color: #657b83 } /* Literal.Number.Integer */
    c-[mo] { color: #657b83 } /* Literal.Number.Oct */
    c-[sa] { color: #6c71c4 } /* Literal.String.Affix */
    c-[sb] { color: #6c71c4 } /* Literal.String.Backtick */
    c-[sc] { color: #6c71c4 } /* Literal.String.Char */
    c-[dl] { color: #6c71c4 } /* Literal.String.Delimiter */
    c-[sd] { color: #6c71c4 } /* Literal.String.Doc */
    c-[se] { color: #6c71c4 } /* Literal.String.Escape */
    c-[sh] { color: #6c71c4 } /* Literal.String.Heredoc */
    c-[si] { color: #6c71c4 } /* Literal.String.Interpol */
    c-[sx] { color: #6c71c4 } /* Literal.String.Other */
    c-[sr] { color: #6c71c4 } /* Literal.String.Regex */
    c-[ss] { color: #6c71c4 } /* Literal.String.Symbol */
    c-[fm] { color: #268bd2 } /* Name.Function.Magic */
    c-[vc] { color: #cb4b16 } /* Name.Variable.Class */
    c-[vg] { color: #cb4b16 } /* Name.Variable.Global */
    c-[vi] { color: #cb4b16 } /* Name.Variable.Instance */
    c-[vm] { color: #cb4b16 } /* Name.Variable.Magic */
    c-[il] { color: #657b83 } /* Literal.Number.Integer.Long */
}
</style>
 <body class="h-entry">
  <div class="head">
   <p data-fill-with="logo"><a class="logo" href="https://www.w3.org/"> <img alt="W3C" height="48" src="https://www.w3.org/StyleSheets/TR/2021/logos/W3C" width="72"> </a> </p>
   <h1 class="p-name no-ref" id="title">WebRTC Encoded Transform</h1>
   <p id="w3c-state"><a href="https://www.w3.org/standards/types#ED">Editor’s Draft</a>, <time class="dt-updated" datetime="1970-01-01">1 January 1970</time></p>
   <details open>
    <summary>More details about this document</summary>
    <div data-fill-with="spec-metadata">
     <dl>
      <dt>This version:
      <dd><a class="u-url" href="https://w3c.github.io/webrtc-encoded-transform/">https://w3c.github.io/webrtc-encoded-transform/</a>
      <dt>Feedback:
      <dd><span><a href="mailto:public-webrtc@w3.org?subject=%5Bwebrtc-encoded-transform%5D%20YOUR%20TOPIC%20HERE">public-webrtc@w3.org</a> with subject line “<kbd>[webrtc-encoded-transform] <i data-lt>… message topic …</i></kbd>” (<a href="https://lists.w3.org/Archives/Public/public-webrtc/" rel="discussion">archives</a>)</span>
      <dt class="editor">Editors:
      <dd class="editor p-author h-card vcard"><a class="p-name fn u-email email" href="mailto:hta@google.com">Harald Alvestrand</a> (<a class="p-org org" href="https://google.com">Google</a>)
      <dd class="editor p-author h-card vcard"><a class="p-name fn u-email email" href="mailto:guidou@google.com">Guido Urdaneta</a> (<a class="p-org org" href="https://google.com">Google</a>)
      <dd class="editor p-author h-card vcard"><a class="p-name fn u-email email" href="mailto:youenn@apple.com">Youenn Fablet</a> (<a class="p-org org" href="https://www.apple.com">Apple</a>)
     </dl>
    </div>
   </details>
   <div data-fill-with="warning"></div>
   <p class="copyright" data-fill-with="copyright"><a href="https://www.w3.org/policies/#copyright">Copyright</a> © 1970 <a href="https://www.w3.org/">World Wide Web Consortium</a>. <abbr title="World Wide Web Consortium">W3C</abbr><sup>®</sup> <a href="https://www.w3.org/policies/#Legal_Disclaimer">liability</a>, <a href="https://www.w3.org/policies/#W3C_Trademarks">trademark</a> and <a href="https://www.w3.org/copyright/software-license/" rel="license" title="W3C Software and Document License">permissive document license</a> rules apply. </p>
   <hr title="Separator for header">
  </div>
  <div class="p-summary" data-fill-with="abstract">
   <h2 class="no-num no-toc no-ref heading settled" id="abstract"><span class="content">Abstract</span></h2>
   <p>This API defines an API surface for manipulating the bits on <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/mediacapture-main/#dom-mediastreamtrack" id="ref-for-dom-mediastreamtrack">MediaStreamTrack</a></code>s being sent via an <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webrtc-pc/#dom-rtcpeerconnection" id="ref-for-dom-rtcpeerconnection">RTCPeerConnection</a></code>.</p>
  </div>
  <h2 class="no-num no-toc no-ref heading settled" id="sotd"><span class="content">Status of this document</span></h2>
  <div data-fill-with="status">
   <p> This is a public copy of the editors’ draft.
	It is provided for discussion only and may change at any moment.
	Its publication here does not imply endorsement of its contents by W3C.
	Don’t cite this document other than as work in progress. </p>
   <p> If you wish to make comments regarding this document, please send them to <a href="mailto:public-webrtc@w3.org?Subject=%5Bwebrtc-encoded-transform%5D%20PUT%20SUBJECT%20HERE">public-webrtc@w3.org</a> (<a href="mailto:public-webrtc-request@w3.org?subject=subscribe">subscribe</a>, <a href="https://lists.w3.org/Archives/Public/public-webrtc/">archives</a>).
	When sending e-mail,
	please put the text “webrtc-encoded-transform” in the subject,
	preferably like this:
	“[webrtc-encoded-transform] <em>…summary of comment…</em>”.
	All comments are welcome. </p>
   <p> This document was produced by the <a href="https://www.w3.org/groups/wg/webrtc">Web Real-Time Communications Working Group</a>. </p>
   <p> This document was produced by a group operating under
	the <a href="https://www.w3.org/policies/patent-policy/">W3C Patent Policy</a>.
	W3C maintains a <a href="https://www.w3.org/2004/01/pp-impl/47318/status" rel="disclosure">public list of any patent disclosures</a> made in connection with the deliverables of the group;
	that page also includes instructions for disclosing a patent.
	An individual who has actual knowledge of a patent which the individual believes contains <a href="https://www.w3.org/policies/patent-policy/#def-essential">Essential Claim(s)</a> must disclose the information in accordance with <a href="https://www.w3.org/policies/patent-policy/#sec-Disclosure">section 6 of the W3C Patent Policy</a>. </p>
   <p> This document is governed by the <a href="https://www.w3.org/policies/process/20231103/" id="w3c_process_revision">03 November 2023 W3C Process Document</a>. </p>
   <p></p>
  </div>
  <div data-fill-with="at-risk"></div>
  <nav data-fill-with="table-of-contents" id="toc">
   <h2 class="no-num no-toc no-ref" id="contents">Table of Contents</h2>
   <ol class="toc" role="directory">
    <li><a href="#introduction"><span class="secno">1</span> <span class="content">Introduction</span></a>
    <li><a href="#terminology"><span class="secno">2</span> <span class="content">Terminology</span></a>
    <li>
     <a href="#specification"><span class="secno">3</span> <span class="content">Specification</span></a>
     <ol class="toc">
      <li>
       <a href="#operation"><span class="secno">3.1</span> <span class="content">Extension operation</span></a>
       <ol class="toc">
        <li><a href="#stream-creation"><span class="secno">3.1.1</span> <span class="content">Stream creation</span></a>
        <li><a href="#stream-processing"><span class="secno">3.1.2</span> <span class="content">Stream processing</span></a>
       </ol>
      <li><a href="#attribute"><span class="secno">3.2</span> <span class="content">Extension attribute</span></a>
     </ol>
    <li>
     <a href="#sframe"><span class="secno">4</span> <span class="content">SFrameTransform</span></a>
     <ol class="toc">
      <li><a href="#sframe-transform-algorithm"><span class="secno">4.1</span> <span class="content">Algorithm</span></a>
      <li><a href="#sframe-transform-methods"><span class="secno">4.2</span> <span class="content">Methods</span></a>
     </ol>
    <li>
     <a href="#scriptTransform"><span class="secno">5</span> <span class="content">RTCRtpScriptTransform</span></a>
     <ol class="toc">
      <li><a href="#RTCRtpScriptTransform-operations"><span class="secno">5.1</span> <span class="content">Operations</span></a>
      <li><a href="#RTCRtpScriptTransformer-attributes"><span class="secno">5.2</span> <span class="content">Attributes</span></a>
     </ol>
    <li><a href="#privacy"><span class="secno">6</span> <span class="content">Privacy and security considerations</span></a>
    <li><a href="#examples"><span class="secno">7</span> <span class="content">Examples</span></a>
    <li>
     <a href="#w3c-conformance"><span class="secno"></span> <span class="content">Conformance</span></a>
     <ol class="toc">
      <li><a href="#w3c-conventions"><span class="secno"></span> <span class="content">Document conventions</span></a>
      <li><a href="#w3c-conformant-algorithms"><span class="secno"></span> <span class="content">Conformant Algorithms</span></a>
     </ol>
    <li>
     <a href="#index"><span class="secno"></span> <span class="content">Index</span></a>
     <ol class="toc">
      <li><a href="#index-defined-here"><span class="secno"></span> <span class="content">Terms defined by this specification</span></a>
      <li><a href="#index-defined-elsewhere"><span class="secno"></span> <span class="content">Terms defined by reference</span></a>
     </ol>
    <li>
     <a href="#references"><span class="secno"></span> <span class="content">References</span></a>
     <ol class="toc">
      <li><a href="#normative"><span class="secno"></span> <span class="content">Normative References</span></a>
      <li><a href="#informative"><span class="secno"></span> <span class="content">Informative References</span></a>
     </ol>
    <li><a href="#idl-index"><span class="secno"></span> <span class="content">IDL Index</span></a>
   </ol>
  </nav>
  <main>
   <h2 class="heading settled" data-level="1" id="introduction"><span class="secno">1. </span><span class="content">Introduction</span><a class="self-link" href="#introduction"></a></h2>
   <p>The <a data-link-type="biblio" href="#biblio-webrtc-nv-use-cases" title="WebRTC Extended Use Cases">[WEBRTC-NV-USE-CASES]</a> document describes several functions that
can only be achieved by access to media (requirements N20-N22),
including, but not limited to:</p>
   <ul>
    <li data-md>
     <p>Funny Hats</p>
    <li data-md>
     <p>Machine Learning</p>
    <li data-md>
     <p>Virtual Reality Gaming</p>
   </ul>
   <p>These use cases further require that processing can be done in worker
threads (requirement N23-N24).</p>
   <p>Furthermore, the "trusted JavaScript cloud conferencing" use case
requires such processing to be done on encoded media, not just the raw
media.</p>
   <p>This specification gives an interface inspired by <a data-link-type="biblio" href="#biblio-web-codecs" title="Web Codecs explainer">[WEB-CODECS]</a> to
provide access to such functionality while retaining the setup flow of
RTCPeerConnection.</p>
   <p>This iteration of the specification provides access to encoded media,
which is the output of the encoder part of a codec and the input to the
decoder part of a codec.</p>
   <h2 class="heading settled" data-level="2" id="terminology"><span class="secno">2. </span><span class="content">Terminology</span><a class="self-link" href="#terminology"></a></h2>
   <h2 class="heading settled" data-level="3" id="specification"><span class="secno">3. </span><span class="content">Specification</span><a class="self-link" href="#specification"></a></h2>
   <p>The Streams definition doesn’t use WebIDL much, but the WebRTC spec does.
This specification shows the IDL extensions for WebRTC.</p>
   <p>It uses an extension to RTCConfiguration in order to notify the <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webrtc-pc/#dom-rtcpeerconnection" id="ref-for-dom-rtcpeerconnection①">RTCPeerConnection</a></code> that insertable streams will be used, and uses
an additional API on <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webrtc-pc/#dom-rtcrtpsender" id="ref-for-dom-rtcrtpsender">RTCRtpSender</a></code> and <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webrtc-pc/#dom-rtcrtpreceiver" id="ref-for-dom-rtcrtpreceiver">RTCRtpReceiver</a></code> to
insert the processing into the pipeline.</p>
<pre class="idl highlight def">// New dictionary
<c- b>dictionary</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="dictionary" data-export id="dictdef-rtcinsertablestreams"><code><c- g>RTCInsertableStreams</c-></code></dfn> {
    <a data-link-type="idl-name" href="https://streams.spec.whatwg.org/#readablestream" id="ref-for-readablestream"><c- n>ReadableStream</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="RTCInsertableStreams" data-dfn-type="dict-member" data-export data-type="ReadableStream" id="dom-rtcinsertablestreams-readable"><code><c- g>readable</c-></code></dfn>;
    <a data-link-type="idl-name" href="https://streams.spec.whatwg.org/#writablestream" id="ref-for-writablestream"><c- n>WritableStream</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="RTCInsertableStreams" data-dfn-type="dict-member" data-export data-type="WritableStream" id="dom-rtcinsertablestreams-writable"><code><c- g>writable</c-></code></dfn>;
};

// New fields in RTCConfiguration
<c- b>partial</c-> <c- b>dictionary</c-> <a class="idl-code" data-link-type="dictionary" href="https://w3c.github.io/webrtc-pc/#dom-rtcconfiguration" id="ref-for-dom-rtcconfiguration"><c- g>RTCConfiguration</c-></a> {
    <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-boolean" id="ref-for-idl-boolean"><c- b>boolean</c-></a> <dfn class="dfn-paneled idl-code" data-default="false" data-dfn-for="RTCConfiguration" data-dfn-type="dict-member" data-export data-type="boolean" id="dom-rtcconfiguration-encodedinsertablestreams"><code><c- g>encodedInsertableStreams</c-></code></dfn> = <c- b>false</c->;
};

<c- b>typedef</c-> (<a data-link-type="idl-name" href="#sframetransform" id="ref-for-sframetransform"><c- n>SFrameTransform</c-></a> <c- b>or</c-> <a data-link-type="idl-name" href="#rtcrtpscripttransform" id="ref-for-rtcrtpscripttransform"><c- n>RTCRtpScriptTransform</c-></a>) <dfn class="dfn-paneled idl-code" data-dfn-type="typedef" data-export id="typedefdef-rtcrtptransform"><code><c- g>RTCRtpTransform</c-></code></dfn>;

// New methods for RTCRtpSender and RTCRtpReceiver
<c- b>partial</c-> <c- b>interface</c-> <a class="idl-code" data-link-type="interface" href="https://w3c.github.io/webrtc-pc/#dom-rtcrtpsender" id="ref-for-dom-rtcrtpsender①"><c- g>RTCRtpSender</c-></a> {
    <a data-link-type="idl-name" href="#dictdef-rtcinsertablestreams" id="ref-for-dictdef-rtcinsertablestreams"><c- n>RTCInsertableStreams</c-></a> <a class="idl-code" data-link-type="method" href="#dom-rtcrtpsender-createencodedstreams" id="ref-for-dom-rtcrtpsender-createencodedstreams"><c- g>createEncodedStreams</c-></a>();
    <c- b>attribute</c-> <a data-link-type="idl-name" href="#typedefdef-rtcrtptransform" id="ref-for-typedefdef-rtcrtptransform"><c- n>RTCRtpTransform</c-></a>? <a class="idl-code" data-link-type="attribute" data-type="RTCRtpTransform?" href="#dom-rtcrtpsender-transform" id="ref-for-dom-rtcrtpsender-transform"><c- g>transform</c-></a>;
};

<c- b>partial</c-> <c- b>interface</c-> <a class="idl-code" data-link-type="interface" href="https://w3c.github.io/webrtc-pc/#dom-rtcrtpreceiver" id="ref-for-dom-rtcrtpreceiver①"><c- g>RTCRtpReceiver</c-></a> {
    <a data-link-type="idl-name" href="#dictdef-rtcinsertablestreams" id="ref-for-dictdef-rtcinsertablestreams①"><c- n>RTCInsertableStreams</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="RTCRtpReceiver" data-dfn-type="method" data-export data-lt="createEncodedStreams()" id="dom-rtcrtpreceiver-createencodedstreams"><code><c- g>createEncodedStreams</c-></code></dfn>();
    <c- b>attribute</c-> <a data-link-type="idl-name" href="#typedefdef-rtcrtptransform" id="ref-for-typedefdef-rtcrtptransform①"><c- n>RTCRtpTransform</c-></a>? <a class="idl-code" data-link-type="attribute" data-type="RTCRtpTransform?" href="#dom-rtcrtpsender-transform" id="ref-for-dom-rtcrtpsender-transform①"><c- g>transform</c-></a>;
};
</pre>
   <h3 class="heading settled" data-level="3.1" id="operation"><span class="secno">3.1. </span><span class="content">Extension operation</span><a class="self-link" href="#operation"></a></h3>
   <p>At the time when a codec is initialized as part of the encoder, and the
corresponding flag is set in the <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webrtc-pc/#dom-rtcpeerconnection" id="ref-for-dom-rtcpeerconnection②">RTCPeerConnection</a></code>'s <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webrtc-pc/#dom-rtcconfiguration" id="ref-for-dom-rtcconfiguration①">RTCConfiguration</a></code> argument, ensure that the codec is disabled and produces no output.</p>
   <h4 class="heading settled" data-level="3.1.1" id="stream-creation"><span class="secno">3.1.1. </span><span class="content">Stream creation</span><a class="self-link" href="#stream-creation"></a></h4>
   <p>At construction of each <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webrtc-pc/#dom-rtcrtpsender" id="ref-for-dom-rtcrtpsender②">RTCRtpSender</a></code> or <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webrtc-pc/#dom-rtcrtpreceiver" id="ref-for-dom-rtcrtpreceiver②">RTCRtpReceiver</a></code>, run the following steps:</p>
   <ol>
    <li data-md>
     <p>Initialize <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this">this</a>.<code>[[Streams]]</code> to null.</p>
    <li data-md>
     <p>Initialize <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this①">this</a>.<code>[[transform]]</code> to null.</p>
    <li data-md>
     <p>Initialize <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this②">this</a>.<code>[[readable]]</code> to a new <code class="idl"><a data-link-type="idl" href="https://streams.spec.whatwg.org/#readablestream" id="ref-for-readablestream①">ReadableStream</a></code>.</p>
    <li data-md>
     <p><a data-link-type="dfn" href="https://streams.spec.whatwg.org/#readablestream-set-up" id="ref-for-readablestream-set-up">Set up</a> <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this③">this</a>.<code>[[readable]]</code>. <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this④">this</a>.<code>[[readable]]</code> is provided frames using the <a data-link-type="dfn" href="#readencodeddata" id="ref-for-readencodeddata">readEncodedData</a> algorithm given <var>this</var> as parameter.</p>
    <li data-md>
     <p>Set <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this⑤">this</a>.<code>[[readable]]</code>.<code>[[owner]]</code> to <var>this</var>.</p>
    <li data-md>
     <p>Initialize <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this⑥">this</a>.<code>[[writable]]</code> to a new <code class="idl"><a data-link-type="idl" href="https://streams.spec.whatwg.org/#writablestream" id="ref-for-writablestream①">WritableStream</a></code>.</p>
    <li data-md>
     <p><a data-link-type="dfn" href="https://streams.spec.whatwg.org/#writablestream-set-up" id="ref-for-writablestream-set-up">Set up</a> <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this⑦">this</a>.<code>[[writable]]</code> with its <a data-link-type="dfn" href="https://streams.spec.whatwg.org/#writablestream-set-up-writealgorithm" id="ref-for-writablestream-set-up-writealgorithm">writeAlgorithm</a> set to <a data-link-type="dfn" href="#writeencodeddata" id="ref-for-writeencodeddata">writeEncodedData</a> given <var>this</var> as parameter.</p>
    <li data-md>
     <p>Set <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this⑧">this</a>.<code>[[writable]]</code>.<code>[[owner]]</code> to <var>this</var>.</p>
    <li data-md>
     <p>Initialize <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this⑨">this</a>.<code>[[pipeToController]]</code> to null.</p>
    <li data-md>
     <p>Initialize <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this①⓪">this</a>.<code>[[lastReceivedFrameTimestamp]]</code> to zero.</p>
    <li data-md>
     <p>If the <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webrtc-pc/#dom-rtcpeerconnection" id="ref-for-dom-rtcpeerconnection③">RTCPeerConnection</a></code>'s configuration does not have <code class="idl"><a data-link-type="idl" href="#dom-rtcconfiguration-encodedinsertablestreams" id="ref-for-dom-rtcconfiguration-encodedinsertablestreams">encodedInsertableStreams</a></code> set to "true", <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task" id="ref-for-queue-a-task">queue a task</a> to run the following steps:</p>
     <ol>
      <li data-md>
       <p>If <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this①①">this</a>.<code>[[pipeToController]]</code> is not null, abort these steps.</p>
      <li data-md>
       <p>Set <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this①②">this</a>.<code>[[pipeToController]]</code> to a new <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#abortcontroller" id="ref-for-abortcontroller">AbortController</a></code>.</p>
      <li data-md>
       <p>Call <a href="https://streams.spec.whatwg.org/#readable-stream-pipe-to">pipeTo</a> with <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this①③">this</a>.<code>[[readable]]</code>, <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this①④">this</a>.<code>[[writable]]</code>, preventClose equal to true, preventAbort equal to true, preventCancel equal to true and <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this①⑤">this</a>.<code>[[pipeToController]]</code>.signal.</p>
     </ol>
   </ol>
   <p>The <dfn class="dfn-paneled idl-code" data-dfn-for="RTCRtpSender" data-dfn-type="method" data-export id="dom-rtcrtpsender-createencodedstreams"><code>createEncodedStreams()</code></dfn> method steps are:</p>
   <ol>
    <li data-md>
     <p>If the <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webrtc-pc/#dom-rtcpeerconnection" id="ref-for-dom-rtcpeerconnection④">RTCPeerConnection</a></code>'s configuration does not have <code class="idl"><a data-link-type="idl" href="#dom-rtcconfiguration-encodedinsertablestreams" id="ref-for-dom-rtcconfiguration-encodedinsertablestreams①">encodedInsertableStreams</a></code> set to "true", throw an "<code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#invalidaccesserror" id="ref-for-invalidaccesserror">InvalidAccessError</a></code>" <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException">DOMException</a></code> and abort these steps.</p>
    <li data-md>
     <p>If the data source does not permit access, throw an "<code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#invalidaccesserror" id="ref-for-invalidaccesserror①">InvalidAccessError</a></code>" <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException①">DOMException</a></code> and abort these steps.</p>
    <li data-md>
     <p>If <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this①⑥">this</a>.<code>[[Streams]]</code> is not null, throw an "<code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#invalidaccesserror" id="ref-for-invalidaccesserror②">InvalidAccessError</a></code>" <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException②">DOMException</a></code>.</p>
    <li data-md>
     <p>If <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this①⑦">this</a>.<code>[[pipeToController]]</code> is not null, throw an "<code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#invalidaccesserror" id="ref-for-invalidaccesserror③">InvalidAccessError</a></code>" <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException③">DOMException</a></code>.</p>
    <li data-md>
     <p>Set <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this①⑧">this</a>.<code>[[Streams]]</code> to an <code class="idl"><a data-link-type="idl" href="#dictdef-rtcinsertablestreams" id="ref-for-dictdef-rtcinsertablestreams②">RTCInsertableStreams</a></code> object.</p>
    <li data-md>
     <p>Set <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this①⑨">this</a>.<code>[[Streams]]</code>.<code class="idl"><a data-link-type="idl" href="#dom-rtcinsertablestreams-readable" id="ref-for-dom-rtcinsertablestreams-readable">readable</a></code> to <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this②⓪">this</a>.<code>[[readable]]</code>.</p>
    <li data-md>
     <p>Set <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this②①">this</a>.<code>[[Streams]]</code>.<code class="idl"><a data-link-type="idl" href="#dom-rtcinsertablestreams-writable" id="ref-for-dom-rtcinsertablestreams-writable">writable</a></code> to <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this②②">this</a>.<code>[[writable]]</code>.</p>
    <li data-md>
     <p>Enable the encoded data source.</p>
    <li data-md>
     <p>Return <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this②③">this</a>.<code>[[Streams]]</code>.</p>
   </ol>
   <h4 class="heading settled" data-level="3.1.2" id="stream-processing"><span class="secno">3.1.2. </span><span class="content">Stream processing</span><a class="self-link" href="#stream-processing"></a></h4>
   <p>The <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="readencodeddata">readEncodedData</dfn> algorithm is given a <var>rtcObject</var> as parameter. It is defined by running the following steps:</p>
   <ol>
    <li data-md>
     <p>Wait for a frame to be produced by <var>rtcObject</var>’s encoder if it is a <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webrtc-pc/#dom-rtcrtpsender" id="ref-for-dom-rtcrtpsender③">RTCRtpSender</a></code> or <var>rtcObject</var>’s packetizer if it is a <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webrtc-pc/#dom-rtcrtpreceiver" id="ref-for-dom-rtcrtpreceiver③">RTCRtpReceiver</a></code>.</p>
    <li data-md>
     <p>Let <var>frame</var> be the newly produced frame.</p>
    <li data-md>
     <p>Set <var>frame</var>.<code>[[owner]]</code> to <var>rtcObject</var>.</p>
    <li data-md>
     <p><a data-link-type="dfn" href="https://streams.spec.whatwg.org/#readablestream-enqueue" id="ref-for-readablestream-enqueue">Enqueue</a> <var>frame</var> in <var>rtcObject</var>.<code>[[readable]]</code>.</p>
   </ol>
   <p>The <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="writeencodeddata">writeEncodedData</dfn> algorithm is given a <var>rtcObject</var> as parameter and a <var>frame</var> as input. It is defined by running the following steps:</p>
   <ol>
    <li data-md>
     <p>If <var>frame</var>.<code>[[owner]]</code> is not equal to <var>rtcObject</var>, abort these steps and return <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#a-promise-resolved-with" id="ref-for-a-promise-resolved-with">a promise resolved with</a> undefined. A processor cannot create frames, or move frames between streams.</p>
    <li data-md>
     <p>If the <var>frame</var>’s <code class="idl"><a data-link-type="idl" href="#dom-rtcencodedvideoframe-timestamp" id="ref-for-dom-rtcencodedvideoframe-timestamp">timestamp</a></code> is equal to or larger than <var>rtcObject</var>.<code>[[lastReceivedFrameTimestamp]]</code>, abort these steps and return <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#a-promise-resolved-with" id="ref-for-a-promise-resolved-with①">a promise resolved with</a> undefined. A processor cannot reorder frames, although it may delay them or drop them.</p>
    <li data-md>
     <p>Set <var>rtcObject</var>.<code>[[lastReceivedFrameTimestamp]]</code> to the <var>frame</var>’s <code class="idl"><a data-link-type="idl" href="#dom-rtcencodedvideoframe-timestamp" id="ref-for-dom-rtcencodedvideoframe-timestamp①">timestamp</a></code>.</p>
    <li data-md>
     <p>Enqueue the frame for processing as if it came directly from the encoded data source, by running one of the following steps:</p>
     <ul>
      <li data-md>
       <p>If <var>rtcObject</var> is a <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webrtc-pc/#dom-rtcrtpsender" id="ref-for-dom-rtcrtpsender④">RTCRtpSender</a></code>, enqueue it to <var>rtcObject</var>’s packetizer, to be processed <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel" id="ref-for-in-parallel">in parallel</a>.</p>
      <li data-md>
       <p>If <var>rtcObject</var> is a <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webrtc-pc/#dom-rtcrtpreceiver" id="ref-for-dom-rtcrtpreceiver④">RTCRtpReceiver</a></code>, enqueue it to <var>rtcObject</var>’s decoder, to be processed <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel" id="ref-for-in-parallel①">in parallel</a>.</p>
     </ul>
    <li data-md>
     <p>Return <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#a-promise-resolved-with" id="ref-for-a-promise-resolved-with②">a promise resolved with</a> undefined.</p>
   </ol>
   <h3 class="heading settled" data-level="3.2" id="attribute"><span class="secno">3.2. </span><span class="content">Extension attribute</span><a class="self-link" href="#attribute"></a></h3>
   <p>A RTCRtpTransform has two private slots called <code>[[readable]]</code> and <code>[[writable]]</code>.</p>
   <p>The <dfn class="dfn-paneled idl-code" data-dfn-for="RTCRtpSender,RTCRtpReceiver" data-dfn-type="attribute" data-export id="dom-rtcrtpsender-transform"><code>transform</code></dfn> getter steps are:</p>
   <ol>
    <li data-md>
     <p>Return <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this②④">this</a>.<code>[[transform]]</code>.</p>
   </ol>
   <p>The <code>transform</code> setter steps are:</p>
   <ol start="2">
    <li data-md>
     <p>Let <var>transform</var> be the argument to the setter.</p>
    <li data-md>
     <p>Let <var>checkedTransform</var> set to <var>transform</var> if it is not null or to an <a data-link-type="dfn" href="https://streams.spec.whatwg.org/#identity-transform-stream" id="ref-for-identity-transform-stream">identity transform stream</a> otherwise.</p>
    <li data-md>
     <p>Let <var>reader</var> be the result of <a data-link-type="dfn" href="https://streams.spec.whatwg.org/#readablestream-get-a-reader" id="ref-for-readablestream-get-a-reader">getting a reader</a> for <var>checkedTransform</var>.<code>[[readable]]</code>.</p>
    <li data-md>
     <p>Let <var>writer</var> be the result of <a data-link-type="dfn" href="https://streams.spec.whatwg.org/#writablestream-get-a-writer" id="ref-for-writablestream-get-a-writer">getting a writer</a> for <var>checkedTransform</var>.<code>[[writable]]</code>.</p>
    <li data-md>
     <p>Initialize <var>newPipeToController</var> to a new <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#abortcontroller" id="ref-for-abortcontroller①">AbortController</a></code>.</p>
    <li data-md>
     <p>If <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this②⑤">this</a>.<code>[[pipeToController]]</code> is not null, run the following steps:</p>
     <ol>
      <li data-md>
       <p><a data-link-type="dfn" href="https://dom.spec.whatwg.org/#abortsignal-add" id="ref-for-abortsignal-add">Add</a> the <a data-link-type="dfn" href="#chain-transform-algorithm" id="ref-for-chain-transform-algorithm">chain transform algorithm</a> to <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this②⑥">this</a>.<code>[[pipeToController]]</code>.signal.</p>
      <li data-md>
       <p><a data-link-type="dfn">signal abort</a> <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this②⑦">this</a>.<code>[[pipeToController]]</code>.signal.</p>
     </ol>
    <li data-md>
     <p>Else, run the <a data-link-type="dfn" href="#chain-transform-algorithm" id="ref-for-chain-transform-algorithm①">chain transform algorithm</a> steps.</p>
    <li data-md>
     <p>Set <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this②⑧">this</a>.<code>[[pipeToController]]</code> to <var>newPipeToController</var>.</p>
    <li data-md>
     <p>Set <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this②⑨">this</a>.<code>[[transform]]</code> to <var>transform</var>.</p>
   </ol>
   <p>The <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="chain-transform-algorithm">chain transform algorithm</dfn> steps are defined as:</p>
   <ol>
    <li data-md>
     <p>If <var>newPipeToController</var>’s <a data-link-type="dfn">aborted flag</a> is true, abort these steps.</p>
    <li data-md>
     <p><a data-link-type="dfn" href="https://streams.spec.whatwg.org/#readablestreamdefaultreader-release" id="ref-for-readablestreamdefaultreader-release">Release</a> <var>reader</var>.</p>
    <li data-md>
     <p><a data-link-type="dfn" href="https://streams.spec.whatwg.org/#writablestreamdefaultwriter-release" id="ref-for-writablestreamdefaultwriter-release">Release</a> <var>writer</var>.</p>
    <li data-md>
     <p>Assert that <var>newPipeToController</var> is the same object as <var>rtcObject</var>.<code>[[pipeToController]]</code>.</p>
    <li data-md>
     <p>Call <a href="https://streams.spec.whatwg.org/#readable-stream-pipe-to">pipeTo</a> with <var>rtcObject</var>.<code>[[readable]]</code>, <var>checkedTransform</var>.<code>[[writable]]</code>, preventClose equal to false, preventAbort equal to false, preventCancel equal to true and <var>newPipeToController</var>.signal.</p>
    <li data-md>
     <p>Call <a href="https://streams.spec.whatwg.org/#readable-stream-pipe-to">pipeTo</a> with <var>checkedTransform</var>.<code>[[readable]]</code>, <var>rtcObject</var>.<code>[[writable]]</code>, preventClose equal to true, preventAbort equal to true, preventCancel equal to false and <var>newPipeToController</var>.signal.</p>
   </ol>
   <p>This algorithm is defined so that transforms can be updated dynamically.
There is no guarantee on which frame will happen the switch from the previous transform to the new transform.</p>
   <p>If a web application sets the transform synchronously at creation of the <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webrtc-pc/#dom-rtcrtpsender" id="ref-for-dom-rtcrtpsender⑤">RTCRtpSender</a></code> (for instance when calling addTrack), the transform will receive the first frame generated by the <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webrtc-pc/#dom-rtcrtpsender" id="ref-for-dom-rtcrtpsender⑥">RTCRtpSender</a></code>'s encoder.
Similarly, if a web application sets the transform synchronously at creation of the <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webrtc-pc/#dom-rtcrtpreceiver" id="ref-for-dom-rtcrtpreceiver⑤">RTCRtpReceiver</a></code> (for instance when calling addTrack, or at track event handler), the transform will receive the first full frame generated by the <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webrtc-pc/#dom-rtcrtpreceiver" id="ref-for-dom-rtcrtpreceiver⑥">RTCRtpReceiver</a></code>'s packetizer.</p>
   <h2 class="heading settled" data-level="4" id="sframe"><span class="secno">4. </span><span class="content">SFrameTransform</span><a class="self-link" href="#sframe"></a></h2>
<pre class="idl highlight def"><c- b>enum</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="enum" data-export id="enumdef-sframetransformrole"><code><c- g>SFrameTransformRole</c-></code></dfn> {
    <dfn class="dfn-paneled idl-code" data-dfn-for="SFrameTransformRole" data-dfn-type="enum-value" data-export id="dom-sframetransformrole-encrypt"><code><c- s>"encrypt"</c-></code></dfn>,
    <dfn class="dfn-paneled idl-code" data-dfn-for="SFrameTransformRole" data-dfn-type="enum-value" data-export id="dom-sframetransformrole-decrypt"><code><c- s>"decrypt"</c-></code></dfn>
};

<c- b>dictionary</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="dictionary" data-export id="dictdef-sframetransformoptions"><code><c- g>SFrameTransformOptions</c-></code></dfn> {
    <a data-link-type="idl-name" href="#enumdef-sframetransformrole" id="ref-for-enumdef-sframetransformrole"><c- n>SFrameTransformRole</c-></a> <dfn class="dfn-paneled idl-code" data-default="&quot;encrypt&quot;" data-dfn-for="SFrameTransformOptions" data-dfn-type="dict-member" data-export data-type="SFrameTransformRole" id="dom-sframetransformoptions-role"><code><c- g>role</c-></code></dfn> = "encrypt";
};

<c- b>typedef</c-> [<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#EnforceRange" id="ref-for-EnforceRange"><c- g>EnforceRange</c-></a>] <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-unsigned-long-long" id="ref-for-idl-unsigned-long-long"><c- b>unsigned</c-> <c- b>long</c-> <c- b>long</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-type="typedef" data-export id="typedefdef-smallcryptokeyid"><code><c- g>SmallCryptoKeyID</c-></code></dfn>;
<c- b>typedef</c-> (<a data-link-type="idl-name" href="#typedefdef-smallcryptokeyid" id="ref-for-typedefdef-smallcryptokeyid"><c- n>SmallCryptoKeyID</c-></a> <c- b>or</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-bigint" id="ref-for-idl-bigint"><c- b>bigint</c-></a>) <dfn class="dfn-paneled idl-code" data-dfn-type="typedef" data-export id="typedefdef-cryptokeyid"><code><c- g>CryptoKeyID</c-></code></dfn>;

[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed" id="ref-for-Exposed"><c- g>Exposed</c-></a>=(<c- n>Window</c->,<c- n>DedicatedWorker</c->)]
<c- b>interface</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="interface" data-export id="sframetransform"><code><c- g>SFrameTransform</c-></code></dfn> {
    <a class="idl-code" data-link-type="constructor" href="#dom-sframetransform-sframetransform" id="ref-for-dom-sframetransform-sframetransform"><c- g>constructor</c-></a>(<c- b>optional</c-> <a data-link-type="idl-name" href="#dictdef-sframetransformoptions" id="ref-for-dictdef-sframetransformoptions"><c- n>SFrameTransformOptions</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="SFrameTransform/SFrameTransform(options), SFrameTransform/constructor(options), SFrameTransform/SFrameTransform(), SFrameTransform/constructor()" data-dfn-type="argument" data-export id="dom-sframetransform-sframetransform-options-options"><code><c- g>options</c-></code></dfn> = {});
    <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise" id="ref-for-idl-promise"><c- b>Promise</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-undefined" id="ref-for-idl-undefined"><c- b>undefined</c-></a>> <a class="idl-code" data-link-type="method" href="#dom-sframetransform-setencryptionkey" id="ref-for-dom-sframetransform-setencryptionkey"><c- g>setEncryptionKey</c-></a>(<a data-link-type="idl-name" href="https://w3c.github.io/webcrypto/#dfn-CryptoKey" id="ref-for-dfn-CryptoKey"><c- n>CryptoKey</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="SFrameTransform/setEncryptionKey(key, keyID), SFrameTransform/setEncryptionKey(key)" data-dfn-type="argument" data-export id="dom-sframetransform-setencryptionkey-key-keyid-key"><code><c- g>key</c-></code></dfn>, <c- b>optional</c-> <a data-link-type="idl-name" href="#typedefdef-cryptokeyid" id="ref-for-typedefdef-cryptokeyid"><c- n>CryptoKeyID</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="SFrameTransform/setEncryptionKey(key, keyID), SFrameTransform/setEncryptionKey(key)" data-dfn-type="argument" data-export id="dom-sframetransform-setencryptionkey-key-keyid-keyid"><code><c- g>keyID</c-></code></dfn>);
};
<a data-link-type="idl-name" href="#sframetransform" id="ref-for-sframetransform①"><c- n>SFrameTransform</c-></a> <c- b>includes</c-> <a data-link-type="idl-name" href="https://streams.spec.whatwg.org/#generictransformstream" id="ref-for-generictransformstream"><c- n>GenericTransformStream</c-></a>;
</pre>
   <p>The <dfn class="dfn-paneled idl-code" data-dfn-for="SFrameTransform" data-dfn-type="constructor" data-export data-lt="SFrameTransform(options)|constructor(options)|SFrameTransform()|constructor()" id="dom-sframetransform-sframetransform"><code>new SFrameTransform(<var>options</var>)</code></dfn> constructor steps are:</p>
   <ol>
    <li data-md>
     <p>Let <var>transformAlgorithm</var> be an algorithm which takes a <var>frame</var> as input and runs the <a href="#sframe-transform-algorithm">SFrame transform algorithm</a> with <var>this</var> and <var>frame</var>.</p>
    <li data-md>
     <p>Set <var>this</var>.<code>[[transform]]</code> to a new <code class="idl"><a data-link-type="idl" href="https://streams.spec.whatwg.org/#transformstream" id="ref-for-transformstream">TransformStream</a></code>.</p>
    <li data-md>
     <p><a data-link-type="dfn" href="https://streams.spec.whatwg.org/#readablestream-set-up" id="ref-for-readablestream-set-up①">Set up</a> <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this③⓪">this</a>.<code>[[transform]]</code> with <a data-link-type="dfn" href="https://streams.spec.whatwg.org/#transformstream-set-up-transformalgorithm" id="ref-for-transformstream-set-up-transformalgorithm">transformAlgorithm</a> set to <var>transformAlgorithm</var>.</p>
    <li data-md>
     <p>Let <var>options</var> be the method’s first argument.</p>
    <li data-md>
     <p>Set <var>this</var>.<code>[[role]]</code> to <var>options</var>["<code class="idl"><a data-link-type="idl" href="#dom-sframetransformoptions-role" id="ref-for-dom-sframetransformoptions-role">role</a></code>"].</p>
    <li data-md>
     <p>Set <var>this</var>.<code>[[readable]]</code> to <var>this</var>.<code>[[transform]]</code>.<code>[[readable]]</code>.</p>
    <li data-md>
     <p>Set <var>this</var>.<code>[[writable]]</code> to <var>this</var>.<code>[[transform]]</code>.<code>[[writable]]</code>.</p>
   </ol>
   <h3 class="heading settled" data-level="4.1" id="sframe-transform-algorithm"><span class="secno">4.1. </span><span class="content">Algorithm</span><a class="self-link" href="#sframe-transform-algorithm"></a></h3>
   <p>The SFrame transform algorithm, given <var>sframe</var> as a SFrameTransform object and <var>frame</var>, runs these steps:</p>
   <ol>
    <li data-md>
     <p>Let <var>role</var> be <var>sframe</var>.<code>[[role]]</code>.</p>
    <li data-md>
     <p>If <var>frame</var>.<code>[[owner]]</code> is a <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webrtc-pc/#dom-rtcrtpsender" id="ref-for-dom-rtcrtpsender⑦">RTCRtpSender</a></code>, set <var>role</var> to 'encrypt'.</p>
    <li data-md>
     <p>If <var>frame</var>.<code>[[owner]]</code> is a <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webrtc-pc/#dom-rtcrtpreceiver" id="ref-for-dom-rtcrtpreceiver⑦">RTCRtpReceiver</a></code>, set <var>role</var> to 'decrypt'.</p>
    <li data-md>
     <p>Let <var>data</var> be undefined.</p>
    <li data-md>
     <p>If <var>frame</var> is a <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#BufferSource" id="ref-for-BufferSource">BufferSource</a></code>, set <var>data</var> to <var>frame</var>.</p>
    <li data-md>
     <p>If <var>frame</var> is a <code class="idl"><a data-link-type="idl" href="#rtcencodedaudioframe" id="ref-for-rtcencodedaudioframe">RTCEncodedAudioFrame</a></code>, set <var>data</var> to <var>frame</var>.<code class="idl"><a data-link-type="idl" href="#dom-rtcencodedaudioframe-data" id="ref-for-dom-rtcencodedaudioframe-data">data</a></code></p>
    <li data-md>
     <p>If <var>frame</var> is a <code class="idl"><a data-link-type="idl" href="#rtcencodedvideoframe" id="ref-for-rtcencodedvideoframe">RTCEncodedVideoFrame</a></code>, set <var>data</var> to <var>frame</var>.<code class="idl"><a data-link-type="idl" href="#dom-rtcencodedvideoframe-data" id="ref-for-dom-rtcencodedvideoframe-data">data</a></code></p>
    <li data-md>
     <p>If <var>data</var> is undefined, abort these steps.</p>
    <li data-md>
     <p>Let <var>buffer</var> be the result of running the SFrame algorithm with <var>data</var> and <var>role</var> as parameters. This algorithm is defined by the <a href="https://datatracker.ietf.org/doc/draft-omara-sframe/">SFrame specification</a> and returns an <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-ArrayBuffer" id="ref-for-idl-ArrayBuffer">ArrayBuffer</a></code>.</p>
    <li data-md>
     <p>If <var>frame</var> is a <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#BufferSource" id="ref-for-BufferSource①">BufferSource</a></code>, set <var>frame</var> to <var>buffer</var>.</p>
    <li data-md>
     <p>If <var>frame</var> is a <code class="idl"><a data-link-type="idl" href="#rtcencodedaudioframe" id="ref-for-rtcencodedaudioframe①">RTCEncodedAudioFrame</a></code>, set <var>frame</var>.<code class="idl"><a data-link-type="idl" href="#dom-rtcencodedaudioframe-data" id="ref-for-dom-rtcencodedaudioframe-data①">data</a></code> to <var>buffer</var>.</p>
    <li data-md>
     <p>If <var>frame</var> is a <code class="idl"><a data-link-type="idl" href="#rtcencodedvideoframe" id="ref-for-rtcencodedvideoframe①">RTCEncodedVideoFrame</a></code>, set <var>frame</var>.<code class="idl"><a data-link-type="idl" href="#dom-rtcencodedvideoframe-data" id="ref-for-dom-rtcencodedvideoframe-data①">data</a></code> to <var>buffer</var>.</p>
    <li data-md>
     <p><a data-link-type="dfn" href="https://streams.spec.whatwg.org/#readablestream-enqueue" id="ref-for-readablestream-enqueue①">Enqueue</a> <var>frame</var> in <var>sframe</var>.<code>[[transform]]</code>.</p>
   </ol>
   <h3 class="heading settled" data-level="4.2" id="sframe-transform-methods"><span class="secno">4.2. </span><span class="content">Methods</span><a class="self-link" href="#sframe-transform-methods"></a></h3>
    The <dfn class="dfn-paneled idl-code" data-dfn-for="SFrameTransform" data-dfn-type="method" data-export data-lt="setEncryptionKey(key, keyID)|setEncryptionKey(key)" id="dom-sframetransform-setencryptionkey"><code>setEncryptionKey(<var>key</var>, <var>keyID</var>)</code></dfn> method steps are: 
   <ol>
    <li data-md>
     <p>Let <var>promise</var> be <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#a-new-promise" id="ref-for-a-new-promise">a new promise</a>.</p>
    <li data-md>
     <p>If <var>keyID</var> is a <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-bigint" id="ref-for-idl-bigint①">bigint</a></code> which cannot be represented as a integer between 0 and 2<sup>64</sup>-1 inclusive, <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#reject" id="ref-for-reject">reject</a> <var>promise</var> with a <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#exceptiondef-rangeerror" id="ref-for-exceptiondef-rangeerror">RangeError</a></code> exception.</p>
    <li data-md>
     <p>Otherwise, <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel" id="ref-for-in-parallel②">in parallel</a>, run the following steps:</p>
     <ol>
      <li data-md>
       <p>Set <var>key</var> with its optional <var>keyID</var> as key material to use for the SFrame transform algorithm, as defined by the <a href="https://datatracker.ietf.org/doc/draft-omara-sframe/">SFrame specification</a>.</p>
      <li data-md>
       <p>If setting the key material fails, <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#reject" id="ref-for-reject①">reject</a> <var>promise</var> with an <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#invalidmodificationerror" id="ref-for-invalidmodificationerror">InvalidModificationError</a></code> exception and abort these steps.</p>
      <li data-md>
       <p><a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#resolve" id="ref-for-resolve">Resolve</a> <var>promise</var> with undefined.</p>
     </ol>
    <li data-md>
     <p>Return <var>promise</var>.</p>
   </ol>
   <h2 class="heading settled" data-level="5" id="scriptTransform"><span class="secno">5. </span><span class="content">RTCRtpScriptTransform</span><a class="self-link" href="#scriptTransform"></a></h2>
<pre class="idl highlight def">// New enum for video frame types. Will eventually re-use the equivalent defined
// by WebCodecs.
<c- b>enum</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="enum" data-export id="enumdef-rtcencodedvideoframetype"><code><c- g>RTCEncodedVideoFrameType</c-></code></dfn> {
    <dfn class="dfn-paneled idl-code" data-dfn-for="RTCEncodedVideoFrameType" data-dfn-type="enum-value" data-export id="dom-rtcencodedvideoframetype-empty"><code><c- s>"empty"</c-></code></dfn>,
    <dfn class="dfn-paneled idl-code" data-dfn-for="RTCEncodedVideoFrameType" data-dfn-type="enum-value" data-export id="dom-rtcencodedvideoframetype-key"><code><c- s>"key"</c-></code></dfn>,
    <dfn class="dfn-paneled idl-code" data-dfn-for="RTCEncodedVideoFrameType" data-dfn-type="enum-value" data-export id="dom-rtcencodedvideoframetype-delta"><code><c- s>"delta"</c-></code></dfn>,
};

<c- b>dictionary</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="dictionary" data-export id="dictdef-rtcencodedvideoframemetadata"><code><c- g>RTCEncodedVideoFrameMetadata</c-></code></dfn> {
    <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-long-long" id="ref-for-idl-long-long"><c- b>long</c-> <c- b>long</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="RTCEncodedVideoFrameMetadata" data-dfn-type="dict-member" data-export data-type="long long" id="dom-rtcencodedvideoframemetadata-frameid"><code><c- g>frameId</c-></code></dfn>;
    <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#idl-sequence" id="ref-for-idl-sequence"><c- b>sequence</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-long-long" id="ref-for-idl-long-long①"><c- b>long</c-> <c- b>long</c-></a>> <dfn class="dfn-paneled idl-code" data-dfn-for="RTCEncodedVideoFrameMetadata" data-dfn-type="dict-member" data-export data-type="sequence<long long>" id="dom-rtcencodedvideoframemetadata-dependencies"><code><c- g>dependencies</c-></code></dfn>;
    <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-unsigned-short" id="ref-for-idl-unsigned-short"><c- b>unsigned</c-> <c- b>short</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="RTCEncodedVideoFrameMetadata" data-dfn-type="dict-member" data-export data-type="unsigned short" id="dom-rtcencodedvideoframemetadata-width"><code><c- g>width</c-></code></dfn>;
    <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-unsigned-short" id="ref-for-idl-unsigned-short①"><c- b>unsigned</c-> <c- b>short</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="RTCEncodedVideoFrameMetadata" data-dfn-type="dict-member" data-export data-type="unsigned short" id="dom-rtcencodedvideoframemetadata-height"><code><c- g>height</c-></code></dfn>;
    <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-long" id="ref-for-idl-long"><c- b>long</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="RTCEncodedVideoFrameMetadata" data-dfn-type="dict-member" data-export data-type="long" id="dom-rtcencodedvideoframemetadata-spatialindex"><code><c- g>spatialIndex</c-></code></dfn>;
    <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-long" id="ref-for-idl-long①"><c- b>long</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="RTCEncodedVideoFrameMetadata" data-dfn-type="dict-member" data-export data-type="long" id="dom-rtcencodedvideoframemetadata-temporalindex"><code><c- g>temporalIndex</c-></code></dfn>;
    <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-long" id="ref-for-idl-long②"><c- b>long</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="RTCEncodedVideoFrameMetadata" data-dfn-type="dict-member" data-export data-type="long" id="dom-rtcencodedvideoframemetadata-synchronizationsource"><code><c- g>synchronizationSource</c-></code></dfn>;
    <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#idl-sequence" id="ref-for-idl-sequence①"><c- b>sequence</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-long" id="ref-for-idl-long③"><c- b>long</c-></a>> <dfn class="dfn-paneled idl-code" data-dfn-for="RTCEncodedVideoFrameMetadata" data-dfn-type="dict-member" data-export data-type="sequence<long>" id="dom-rtcencodedvideoframemetadata-contributingsources"><code><c- g>contributingSources</c-></code></dfn>;
};

// New interfaces to define encoded video and audio frames. Will eventually
// re-use or extend the equivalent defined in WebCodecs.
[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed" id="ref-for-Exposed①"><c- g>Exposed</c-></a>=(<c- n>Window</c->,<c- n>DedicatedWorker</c->)]
<c- b>interface</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="interface" data-export id="rtcencodedvideoframe"><code><c- g>RTCEncodedVideoFrame</c-></code></dfn> {
    <c- b>readonly</c-> <c- b>attribute</c-> <a data-link-type="idl-name" href="#enumdef-rtcencodedvideoframetype" id="ref-for-enumdef-rtcencodedvideoframetype"><c- n>RTCEncodedVideoFrameType</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="RTCEncodedVideoFrame" data-dfn-type="attribute" data-export data-readonly data-type="RTCEncodedVideoFrameType" id="dom-rtcencodedvideoframe-type"><code><c- g>type</c-></code></dfn>;
    <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-unsigned-long-long" id="ref-for-idl-unsigned-long-long①"><c- b>unsigned</c-> <c- b>long</c-> <c- b>long</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="RTCEncodedVideoFrame" data-dfn-type="attribute" data-export data-readonly data-type="unsigned long long" id="dom-rtcencodedvideoframe-timestamp"><code><c- g>timestamp</c-></code></dfn>;
    <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-ArrayBuffer" id="ref-for-idl-ArrayBuffer①"><c- b>ArrayBuffer</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="RTCEncodedVideoFrame" data-dfn-type="attribute" data-export data-type="ArrayBuffer" id="dom-rtcencodedvideoframe-data"><code><c- g>data</c-></code></dfn>;
    <a data-link-type="idl-name" href="#dictdef-rtcencodedvideoframemetadata" id="ref-for-dictdef-rtcencodedvideoframemetadata"><c- n>RTCEncodedVideoFrameMetadata</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="RTCEncodedVideoFrame" data-dfn-type="method" data-export data-lt="getMetadata()" id="dom-rtcencodedvideoframe-getmetadata"><code><c- g>getMetadata</c-></code></dfn>();
};

<c- b>dictionary</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="dictionary" data-export id="dictdef-rtcencodedaudioframemetadata"><code><c- g>RTCEncodedAudioFrameMetadata</c-></code></dfn> {
    <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-long" id="ref-for-idl-long④"><c- b>long</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="RTCEncodedAudioFrameMetadata" data-dfn-type="dict-member" data-export data-type="long" id="dom-rtcencodedaudioframemetadata-synchronizationsource"><code><c- g>synchronizationSource</c-></code></dfn>;
    <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#idl-sequence" id="ref-for-idl-sequence②"><c- b>sequence</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-long" id="ref-for-idl-long⑤"><c- b>long</c-></a>> <dfn class="dfn-paneled idl-code" data-dfn-for="RTCEncodedAudioFrameMetadata" data-dfn-type="dict-member" data-export data-type="sequence<long>" id="dom-rtcencodedaudioframemetadata-contributingsources"><code><c- g>contributingSources</c-></code></dfn>;
};

[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed" id="ref-for-Exposed②"><c- g>Exposed</c-></a>=(<c- n>Window</c->,<c- n>DedicatedWorker</c->)]
<c- b>interface</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="interface" data-export id="rtcencodedaudioframe"><code><c- g>RTCEncodedAudioFrame</c-></code></dfn> {
    <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-unsigned-long-long" id="ref-for-idl-unsigned-long-long②"><c- b>unsigned</c-> <c- b>long</c-> <c- b>long</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="RTCEncodedAudioFrame" data-dfn-type="attribute" data-export data-readonly data-type="unsigned long long" id="dom-rtcencodedaudioframe-timestamp"><code><c- g>timestamp</c-></code></dfn>;
    <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-ArrayBuffer" id="ref-for-idl-ArrayBuffer②"><c- b>ArrayBuffer</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="RTCEncodedAudioFrame" data-dfn-type="attribute" data-export data-type="ArrayBuffer" id="dom-rtcencodedaudioframe-data"><code><c- g>data</c-></code></dfn>;
    <a data-link-type="idl-name" href="#dictdef-rtcencodedaudioframemetadata" id="ref-for-dictdef-rtcencodedaudioframemetadata"><c- n>RTCEncodedAudioFrameMetadata</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="RTCEncodedAudioFrame" data-dfn-type="method" data-export data-lt="getMetadata()" id="dom-rtcencodedaudioframe-getmetadata"><code><c- g>getMetadata</c-></code></dfn>();
};


// New interfaces to expose JavaScript-based transforms.

[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed" id="ref-for-Exposed③"><c- g>Exposed</c-></a>=<c- n>DedicatedWorker</c->]
<c- b>interface</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="interface" data-export id="rtctransformevent"><code><c- g>RTCTransformEvent</c-></code></dfn> : <a data-link-type="idl-name" href="https://dom.spec.whatwg.org/#event" id="ref-for-event"><c- n>Event</c-></a> {
    <c- b>readonly</c-> <c- b>attribute</c-> <a data-link-type="idl-name" href="#rtcrtpscripttransformer" id="ref-for-rtcrtpscripttransformer"><c- n>RTCRtpScriptTransformer</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="RTCTransformEvent" data-dfn-type="attribute" data-export data-readonly data-type="RTCRtpScriptTransformer" id="dom-rtctransformevent-transformer"><code><c- g>transformer</c-></code></dfn>;
};

<c- b>partial</c-> <c- b>interface</c-> <a class="idl-code" data-link-type="interface" href="https://html.spec.whatwg.org/multipage/workers.html#dedicatedworkerglobalscope" id="ref-for-dedicatedworkerglobalscope"><c- g>DedicatedWorkerGlobalScope</c-></a> {
    <c- b>attribute</c-> <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler" id="ref-for-eventhandler"><c- n>EventHandler</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="DedicatedWorkerGlobalScope" data-dfn-type="attribute" data-export data-type="EventHandler" id="dom-dedicatedworkerglobalscope-onrtctransform"><code><c- g>onrtctransform</c-></code></dfn>;
};

[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed" id="ref-for-Exposed④"><c- g>Exposed</c-></a>=<c- n>DedicatedWorker</c->]
<c- b>interface</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="interface" data-export id="rtcrtpscripttransformer"><code><c- g>RTCRtpScriptTransformer</c-></code></dfn> {
    <c- b>readonly</c-> <c- b>attribute</c-> <a data-link-type="idl-name" href="https://streams.spec.whatwg.org/#readablestream" id="ref-for-readablestream②"><c- n>ReadableStream</c-></a> <a class="idl-code" data-link-type="attribute" data-readonly data-type="ReadableStream" href="#dom-rtcrtpscripttransformer-readable" id="ref-for-dom-rtcrtpscripttransformer-readable"><c- g>readable</c-></a>;
    <c- b>readonly</c-> <c- b>attribute</c-> <a data-link-type="idl-name" href="https://streams.spec.whatwg.org/#writablestream" id="ref-for-writablestream②"><c- n>WritableStream</c-></a> <a class="idl-code" data-link-type="attribute" data-readonly data-type="WritableStream" href="#dom-rtcrtpscripttransformer-writable" id="ref-for-dom-rtcrtpscripttransformer-writable"><c- g>writable</c-></a>;
    <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-any" id="ref-for-idl-any"><c- b>any</c-></a> <a class="idl-code" data-link-type="attribute" data-readonly data-type="any" href="#dom-rtcrtpscripttransformer-options" id="ref-for-dom-rtcrtpscripttransformer-options"><c- g>options</c-></a>;
};

[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed" id="ref-for-Exposed⑤"><c- g>Exposed</c-></a>=<c- n>Window</c->]
<c- b>interface</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="interface" data-export id="rtcrtpscripttransform"><code><c- g>RTCRtpScriptTransform</c-></code></dfn> {
    <a class="idl-code" data-link-type="constructor" href="#dom-rtcrtpscripttransform-rtcrtpscripttransform" id="ref-for-dom-rtcrtpscripttransform-rtcrtpscripttransform"><c- g>constructor</c-></a>(<a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/workers.html#worker" id="ref-for-worker"><c- n>Worker</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="RTCRtpScriptTransform/RTCRtpScriptTransform(worker, options, transfer), RTCRtpScriptTransform/constructor(worker, options, transfer), RTCRtpScriptTransform/RTCRtpScriptTransform(worker, options), RTCRtpScriptTransform/constructor(worker, options), RTCRtpScriptTransform/RTCRtpScriptTransform(worker), RTCRtpScriptTransform/constructor(worker)" data-dfn-type="argument" data-export id="dom-rtcrtpscripttransform-rtcrtpscripttransform-worker-options-transfer-worker"><code><c- g>worker</c-></code></dfn>, <c- b>optional</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-any" id="ref-for-idl-any①"><c- b>any</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="RTCRtpScriptTransform/RTCRtpScriptTransform(worker, options, transfer), RTCRtpScriptTransform/constructor(worker, options, transfer), RTCRtpScriptTransform/RTCRtpScriptTransform(worker, options), RTCRtpScriptTransform/constructor(worker, options), RTCRtpScriptTransform/RTCRtpScriptTransform(worker), RTCRtpScriptTransform/constructor(worker)" data-dfn-type="argument" data-export id="dom-rtcrtpscripttransform-rtcrtpscripttransform-worker-options-transfer-options"><code><c- g>options</c-></code></dfn>, <c- b>optional</c-> <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#idl-sequence" id="ref-for-idl-sequence③"><c- b>sequence</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-object" id="ref-for-idl-object"><c- b>object</c-></a>> <dfn class="dfn-paneled idl-code" data-dfn-for="RTCRtpScriptTransform/RTCRtpScriptTransform(worker, options, transfer), RTCRtpScriptTransform/constructor(worker, options, transfer), RTCRtpScriptTransform/RTCRtpScriptTransform(worker, options), RTCRtpScriptTransform/constructor(worker, options), RTCRtpScriptTransform/RTCRtpScriptTransform(worker), RTCRtpScriptTransform/constructor(worker)" data-dfn-type="argument" data-export id="dom-rtcrtpscripttransform-rtcrtpscripttransform-worker-options-transfer-transfer"><code><c- g>transfer</c-></code></dfn>);
};
</pre>
   <h3 class="heading settled" data-level="5.1" id="RTCRtpScriptTransform-operations"><span class="secno">5.1. </span><span class="content">Operations</span><a class="self-link" href="#RTCRtpScriptTransform-operations"></a></h3>
   <p>The <dfn class="dfn-paneled idl-code" data-dfn-for="RTCRtpScriptTransform" data-dfn-type="constructor" data-export data-lt="RTCRtpScriptTransform(worker, options, transfer)|constructor(worker, options, transfer)|RTCRtpScriptTransform(worker, options)|constructor(worker, options)|RTCRtpScriptTransform(worker)|constructor(worker)" id="dom-rtcrtpscripttransform-rtcrtpscripttransform"><code>new RTCRtpScriptTransform(<var>worker</var>, <var>options</var>, <var>transfer</var>)</code></dfn> constructor steps are:</p>
   <ol>
    <li data-md>
     <p>Set <var>t1</var> to an <a data-link-type="dfn" href="https://streams.spec.whatwg.org/#identity-transform-stream" id="ref-for-identity-transform-stream①">identity transform stream</a>.</p>
    <li data-md>
     <p>Set <var>t2</var> to an <a data-link-type="dfn" href="https://streams.spec.whatwg.org/#identity-transform-stream" id="ref-for-identity-transform-stream②">identity transform stream</a>.</p>
    <li data-md>
     <p>Set <var>this</var>.<code>[[writable]]</code> to <var>t1</var>.<code>[[writable]]</code>.</p>
    <li data-md>
     <p>Set <var>this</var>.<code>[[readable]]</code> to <var>t2</var>.<code>[[readable]]</code>.</p>
    <li data-md>
     <p>Let <var>serializedOptions</var> be the result of <a data-link-type="abstract-op" href="https://html.spec.whatwg.org/multipage/structured-data.html#structuredserializewithtransfer" id="ref-for-structuredserializewithtransfer">StructuredSerializeWithTransfer</a>(<var>options</var>, <var>transfer</var>).</p>
    <li data-md>
     <p>Let <var>serializedReadable</var> be the result of <a data-link-type="abstract-op" href="https://html.spec.whatwg.org/multipage/structured-data.html#structuredserializewithtransfer" id="ref-for-structuredserializewithtransfer①">StructuredSerializeWithTransfer</a>(<var>t1</var>.<code>[[readable]]</code>, « <var>t1</var>.<code>[[readable]]</code> »).</p>
    <li data-md>
     <p>Let <var>serializedWritable</var> be the result of <a data-link-type="abstract-op" href="https://html.spec.whatwg.org/multipage/structured-data.html#structuredserializewithtransfer" id="ref-for-structuredserializewithtransfer②">StructuredSerializeWithTransfer</a>(<var>t2</var>.<code>[[writable]]</code>, « <var>t2</var>.<code>[[writable]]</code> »).</p>
    <li data-md>
     <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task" id="ref-for-queue-a-task①">Queue a task</a> on the DOM manipulation <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#task-source" id="ref-for-task-source">task source</a> <var>worker</var>’s global scope to run the following steps:</p>
     <ol>
      <li data-md>
       <p>Let <var>transformerOptions</var> be the result of <a data-link-type="abstract-op" href="https://html.spec.whatwg.org/multipage/structured-data.html#structureddeserialize" id="ref-for-structureddeserialize">StructuredDeserialize</a>(<var>serializedOptions</var>, the current Realm).</p>
      <li data-md>
       <p>Let <var>readable</var> be the result of <a data-link-type="abstract-op" href="https://html.spec.whatwg.org/multipage/structured-data.html#structureddeserialize" id="ref-for-structureddeserialize①">StructuredDeserialize</a>(<var>serializedReadable</var>, the current Realm).</p>
      <li data-md>
       <p>Let <var>writable</var> be the result of <a data-link-type="abstract-op" href="https://html.spec.whatwg.org/multipage/structured-data.html#structureddeserialize" id="ref-for-structureddeserialize②">StructuredDeserialize</a>(<var>serializedWritable</var>, the current Realm).</p>
      <li data-md>
       <p>Let <var>transformer</var> be a new <code class="idl"><a data-link-type="idl" href="#rtcrtpscripttransformer" id="ref-for-rtcrtpscripttransformer①">RTCRtpScriptTransformer</a></code>.</p>
      <li data-md>
       <p>Set <var>transformer</var>.<code>[[options]]</code> to <var>transformerOptions</var>.</p>
      <li data-md>
       <p>Set <var>transformer</var>.<code>[[readable]]</code> to <var>readable</var>.</p>
      <li data-md>
       <p>Set <var>transformer</var>.<code>[[writable]]</code> to <var>writable</var>.</p>
      <li data-md>
       <p>Let <var>event</var> be the result of <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-event-create" id="ref-for-concept-event-create">creating an event</a> with <code class="idl"><a data-link-type="idl" href="#rtctransformevent" id="ref-for-rtctransformevent">RTCTransformEvent</a></code>.</p>
      <li data-md>
       <p>Set <var>event</var>.type attribute to "rtctransform".</p>
      <li data-md>
       <p>Set <var>event</var>.transformer to <var>transformer</var>.</p>
      <li data-md>
       <p>Dispatch <var>event</var> on <var>worker</var>’s global scope.</p>
     </ol>
   </ol>
   <p>// FIXME: Describe error handling (worker closing flag true at RTCRtpScriptTransform creation time. And worker being terminated while transform is processing data).</p>
   <h3 class="heading settled" data-level="5.2" id="RTCRtpScriptTransformer-attributes"><span class="secno">5.2. </span><span class="content">Attributes</span><a class="self-link" href="#RTCRtpScriptTransformer-attributes"></a></h3>
   <p>A RTCRtpScriptTransformer has three private slots called <code>[[options]]</code>, <code>[[readable]]</code> and <code>[[writable]]</code>.</p>
   <p>The <dfn class="dfn-paneled idl-code" data-dfn-for="RTCRtpScriptTransformer" data-dfn-type="attribute" data-export id="dom-rtcrtpscripttransformer-options"><code>options</code></dfn> getter steps are:</p>
   <ol>
    <li data-md>
     <p>Return <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this③①">this</a>.<code>[[options]]</code>.</p>
   </ol>
   <p>The <dfn class="dfn-paneled idl-code" data-dfn-for="RTCRtpScriptTransformer" data-dfn-type="attribute" data-export id="dom-rtcrtpscripttransformer-readable"><code>readable</code></dfn> getter steps are:</p>
   <ol>
    <li data-md>
     <p>Return <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this③②">this</a>.<code>[[readable]]</code>.</p>
   </ol>
   <p>The <dfn class="dfn-paneled idl-code" data-dfn-for="RTCRtpScriptTransformer" data-dfn-type="attribute" data-export id="dom-rtcrtpscripttransformer-writable"><code>writable</code></dfn> getter steps are:</p>
   <ol>
    <li data-md>
     <p>Return <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this③③">this</a>.<code>[[writable]]</code>.</p>
   </ol>
   <h2 class="heading settled" data-level="6" id="privacy"><span class="secno">6. </span><span class="content">Privacy and security considerations</span><a class="self-link" href="#privacy"></a></h2>
   <p>This API gives Javascript access to the content of media streams. This
is also available from other sources, such as Canvas and WebAudio.</p>
   <p>However, streams that are isolated (as specified in <a data-link-type="biblio" href="#biblio-webrtc-identity" title="Identity for WebRTC 1.0">[WEBRTC-IDENTITY]</a>) or tainted with another origin, cannot be
accessed using this API, since that would break the isolation rule.</p>
   <p>The API will allow access to some aspects of timing information that are
otherwise unavailable, which allows some fingerprinting surface.</p>
   <h2 class="heading settled" data-level="7" id="examples"><span class="secno">7. </span><span class="content">Examples</span><a class="self-link" href="#examples"></a></h2>
   <p>See the <a href="https://github.com/w3c/webrtc-encoded-transform/blob/master/explainer.md#code-examples">explainer document</a>.</p>
  </main>
  <div data-fill-with="conformance">
   <h2 class="no-ref no-num heading settled" id="w3c-conformance"><span class="content">Conformance</span><a class="self-link" href="#w3c-conformance"></a></h2>
   <h3 class="no-ref no-num heading settled" id="w3c-conventions"><span class="content">Document conventions</span><a class="self-link" href="#w3c-conventions"></a></h3>
   <p>Conformance requirements are expressed
    with a combination of descriptive assertions
    and RFC 2119 terminology.
    The key words “MUST”, “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”, “RECOMMENDED”, “MAY”, and “OPTIONAL”
    in the normative parts of this document
    are to be interpreted as described in RFC 2119.
    However, for readability,
    these words do not appear in all uppercase letters in this specification. </p>
   <p>All of the text of this specification is normative
    except sections explicitly marked as non-normative, examples, and notes. <a data-link-type="biblio" href="#biblio-rfc2119" title="Key words for use in RFCs to Indicate Requirement Levels">[RFC2119]</a> </p>
   <p>Examples in this specification are introduced with the words “for example”
    or are set apart from the normative text
    with <code>class="example"</code>,
    like this: </p>
   <div class="example" id="w3c-example">
    <a class="self-link" href="#w3c-example"></a> 
    <p>This is an example of an informative example. </p>
   </div>
   <p>Informative notes begin with the word “Note”
    and are set apart from the normative text
    with <code>class="note"</code>,
    like this: </p>
   <p class="note" role="note">Note, this is an informative note.</p>
   <section>
    <h3 class="no-ref no-num heading settled" id="w3c-conformant-algorithms"><span class="content">Conformant Algorithms</span><a class="self-link" href="#w3c-conformant-algorithms"></a></h3>
    <p>Requirements phrased in the imperative as part of algorithms
    (such as "strip any leading space characters"
    or "return false and abort these steps")
    are to be interpreted with the meaning of the key word
    ("must", "should", "may", etc)
    used in introducing the algorithm. </p>
    <p>Conformance requirements phrased as algorithms or specific steps
    can be implemented in any manner,
    so long as the end result is equivalent.
    In particular, the algorithms defined in this specification
    are intended to be easy to understand
    and are not intended to be performant.
    Implementers are encouraged to optimize. </p>
   </section>
  </div>
  <script src="https://www.w3.org/scripts/TR/2021/fixup.js"></script>
  <h2 class="no-num no-ref heading settled" id="index"><span class="content">Index</span><a class="self-link" href="#index"></a></h2>
  <h3 class="no-num no-ref heading settled" id="index-defined-here"><span class="content">Terms defined by this specification</span><a class="self-link" href="#index-defined-here"></a></h3>
  <ul class="index">
   <li><a href="#chain-transform-algorithm">chain transform algorithm</a><span>, in § 3.2</span>
   <li><a href="#dom-sframetransform-sframetransform">constructor()</a><span>, in § 4</span>
   <li><a href="#dom-sframetransform-sframetransform">constructor(options)</a><span>, in § 4</span>
   <li><a href="#dom-rtcrtpscripttransform-rtcrtpscripttransform">constructor(worker)</a><span>, in § 5.1</span>
   <li><a href="#dom-rtcrtpscripttransform-rtcrtpscripttransform">constructor(worker, options)</a><span>, in § 5.1</span>
   <li><a href="#dom-rtcrtpscripttransform-rtcrtpscripttransform">constructor(worker, options, transfer)</a><span>, in § 5.1</span>
   <li>
    contributingSources
    <ul>
     <li><a href="#dom-rtcencodedaudioframemetadata-contributingsources">dict-member for RTCEncodedAudioFrameMetadata</a><span>, in § 5</span>
     <li><a href="#dom-rtcencodedvideoframemetadata-contributingsources">dict-member for RTCEncodedVideoFrameMetadata</a><span>, in § 5</span>
    </ul>
   <li>
    createEncodedStreams()
    <ul>
     <li><a href="#dom-rtcrtpreceiver-createencodedstreams">method for RTCRtpReceiver</a><span>, in § 3</span>
     <li><a href="#dom-rtcrtpsender-createencodedstreams">method for RTCRtpSender</a><span>, in § 3.1.1</span>
    </ul>
   <li><a href="#typedefdef-cryptokeyid">CryptoKeyID</a><span>, in § 4</span>
   <li>
    data
    <ul>
     <li><a href="#dom-rtcencodedaudioframe-data">attribute for RTCEncodedAudioFrame</a><span>, in § 5</span>
     <li><a href="#dom-rtcencodedvideoframe-data">attribute for RTCEncodedVideoFrame</a><span>, in § 5</span>
    </ul>
   <li><a href="#dom-sframetransformrole-decrypt">"decrypt"</a><span>, in § 4</span>
   <li><a href="#dom-rtcencodedvideoframetype-delta">"delta"</a><span>, in § 5</span>
   <li><a href="#dom-rtcencodedvideoframemetadata-dependencies">dependencies</a><span>, in § 5</span>
   <li><a href="#dom-rtcencodedvideoframetype-empty">"empty"</a><span>, in § 5</span>
   <li><a href="#dom-rtcconfiguration-encodedinsertablestreams">encodedInsertableStreams</a><span>, in § 3</span>
   <li><a href="#dom-sframetransformrole-encrypt">"encrypt"</a><span>, in § 4</span>
   <li><a href="#dom-rtcencodedvideoframemetadata-frameid">frameId</a><span>, in § 5</span>
   <li>
    getMetadata()
    <ul>
     <li><a href="#dom-rtcencodedaudioframe-getmetadata">method for RTCEncodedAudioFrame</a><span>, in § 5</span>
     <li><a href="#dom-rtcencodedvideoframe-getmetadata">method for RTCEncodedVideoFrame</a><span>, in § 5</span>
    </ul>
   <li><a href="#dom-rtcencodedvideoframemetadata-height">height</a><span>, in § 5</span>
   <li><a href="#dom-rtcencodedvideoframetype-key">"key"</a><span>, in § 5</span>
   <li><a href="#dom-dedicatedworkerglobalscope-onrtctransform">onrtctransform</a><span>, in § 5</span>
   <li><a href="#dom-rtcrtpscripttransformer-options">options</a><span>, in § 5.2</span>
   <li>
    readable
    <ul>
     <li><a href="#dom-rtcrtpscripttransformer-readable">attribute for RTCRtpScriptTransformer</a><span>, in § 5.2</span>
     <li><a href="#dom-rtcinsertablestreams-readable">dict-member for RTCInsertableStreams</a><span>, in § 3</span>
    </ul>
   <li><a href="#readencodeddata">readEncodedData</a><span>, in § 3.1.2</span>
   <li><a href="#dom-sframetransformoptions-role">role</a><span>, in § 4</span>
   <li><a href="#rtcencodedaudioframe">RTCEncodedAudioFrame</a><span>, in § 5</span>
   <li><a href="#dictdef-rtcencodedaudioframemetadata">RTCEncodedAudioFrameMetadata</a><span>, in § 5</span>
   <li><a href="#rtcencodedvideoframe">RTCEncodedVideoFrame</a><span>, in § 5</span>
   <li><a href="#dictdef-rtcencodedvideoframemetadata">RTCEncodedVideoFrameMetadata</a><span>, in § 5</span>
   <li><a href="#enumdef-rtcencodedvideoframetype">RTCEncodedVideoFrameType</a><span>, in § 5</span>
   <li><a href="#dictdef-rtcinsertablestreams">RTCInsertableStreams</a><span>, in § 3</span>
   <li><a href="#rtcrtpscripttransform">RTCRtpScriptTransform</a><span>, in § 5</span>
   <li><a href="#rtcrtpscripttransformer">RTCRtpScriptTransformer</a><span>, in § 5</span>
   <li><a href="#dom-rtcrtpscripttransform-rtcrtpscripttransform">RTCRtpScriptTransform(worker)</a><span>, in § 5.1</span>
   <li><a href="#dom-rtcrtpscripttransform-rtcrtpscripttransform">RTCRtpScriptTransform(worker, options)</a><span>, in § 5.1</span>
   <li><a href="#dom-rtcrtpscripttransform-rtcrtpscripttransform">RTCRtpScriptTransform(worker, options, transfer)</a><span>, in § 5.1</span>
   <li><a href="#typedefdef-rtcrtptransform">RTCRtpTransform</a><span>, in § 3</span>
   <li><a href="#rtctransformevent">RTCTransformEvent</a><span>, in § 5</span>
   <li><a href="#dom-sframetransform-setencryptionkey">setEncryptionKey(key)</a><span>, in § 4.2</span>
   <li><a href="#dom-sframetransform-setencryptionkey">setEncryptionKey(key, keyID)</a><span>, in § 4.2</span>
   <li><a href="#sframetransform">SFrameTransform</a><span>, in § 4</span>
   <li><a href="#dom-sframetransform-sframetransform">SFrameTransform()</a><span>, in § 4</span>
   <li><a href="#dom-sframetransform-sframetransform">SFrameTransform(options)</a><span>, in § 4</span>
   <li><a href="#dictdef-sframetransformoptions">SFrameTransformOptions</a><span>, in § 4</span>
   <li><a href="#enumdef-sframetransformrole">SFrameTransformRole</a><span>, in § 4</span>
   <li><a href="#typedefdef-smallcryptokeyid">SmallCryptoKeyID</a><span>, in § 4</span>
   <li><a href="#dom-rtcencodedvideoframemetadata-spatialindex">spatialIndex</a><span>, in § 5</span>
   <li>
    synchronizationSource
    <ul>
     <li><a href="#dom-rtcencodedaudioframemetadata-synchronizationsource">dict-member for RTCEncodedAudioFrameMetadata</a><span>, in § 5</span>
     <li><a href="#dom-rtcencodedvideoframemetadata-synchronizationsource">dict-member for RTCEncodedVideoFrameMetadata</a><span>, in § 5</span>
    </ul>
   <li><a href="#dom-rtcencodedvideoframemetadata-temporalindex">temporalIndex</a><span>, in § 5</span>
   <li>
    timestamp
    <ul>
     <li><a href="#dom-rtcencodedaudioframe-timestamp">attribute for RTCEncodedAudioFrame</a><span>, in § 5</span>
     <li><a href="#dom-rtcencodedvideoframe-timestamp">attribute for RTCEncodedVideoFrame</a><span>, in § 5</span>
    </ul>
   <li><a href="#dom-rtcrtpsender-transform">transform</a><span>, in § 3.2</span>
   <li><a href="#dom-rtctransformevent-transformer">transformer</a><span>, in § 5</span>
   <li><a href="#dom-rtcencodedvideoframe-type">type</a><span>, in § 5</span>
   <li><a href="#dom-rtcencodedvideoframemetadata-width">width</a><span>, in § 5</span>
   <li>
    writable
    <ul>
     <li><a href="#dom-rtcrtpscripttransformer-writable">attribute for RTCRtpScriptTransformer</a><span>, in § 5.2</span>
     <li><a href="#dom-rtcinsertablestreams-writable">dict-member for RTCInsertableStreams</a><span>, in § 3</span>
    </ul>
   <li><a href="#writeencodeddata">writeEncodedData</a><span>, in § 3.1.2</span>
  </ul>
  <h3 class="no-num no-ref heading settled" id="index-defined-elsewhere"><span class="content">Terms defined by reference</span><a class="self-link" href="#index-defined-elsewhere"></a></h3>
  <ul class="index">
   <li>
    <a data-link-type="biblio">[DOM]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="2e66eaf1">AbortController</span>
     <li><span class="dfn-paneled" id="129bdae8">Event</span>
     <li><span class="dfn-paneled" id="87bc23a5">add</span>
     <li><span class="dfn-paneled" id="8abfc3b6">creating an event</span>
    </ul>
   <li>
    <a data-link-type="biblio">[HTML]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="b8308563">DedicatedWorkerGlobalScope</span>
     <li><span class="dfn-paneled" id="f0951476">EventHandler</span>
     <li><span class="dfn-paneled" id="0800bdf4">StructuredDeserialize</span>
     <li><span class="dfn-paneled" id="9da834a1">StructuredSerializeWithTransfer</span>
     <li><span class="dfn-paneled" id="bfc1c271">Worker</span>
     <li><span class="dfn-paneled" id="a72449dd">in parallel</span>
     <li><span class="dfn-paneled" id="9a517a7d">queue a task</span>
     <li><span class="dfn-paneled" id="c3b2d08c">task source</span>
    </ul>
   <li>
    <a data-link-type="biblio">[MEDIACAPTURE-STREAMS]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="bc1e4fa1">MediaStreamTrack</span>
    </ul>
   <li>
    <a data-link-type="biblio">[STREAMS]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="d61c5cab">GenericTransformStream</span>
     <li><span class="dfn-paneled" id="59ed4e57">ReadableStream</span>
     <li><span class="dfn-paneled" id="47e93e3e">TransformStream</span>
     <li><span class="dfn-paneled" id="59dc45b5">WritableStream</span>
     <li><span class="dfn-paneled" id="6b6bb798">enqueue</span>
     <li><span class="dfn-paneled" id="bf6531af">getting a reader</span>
     <li><span class="dfn-paneled" id="f4acb816">getting a writer</span>
     <li><span class="dfn-paneled" id="03c3f3ed">identity transform stream</span>
     <li><span class="dfn-paneled" id="b21c2abd">release <small>(for ReadableStreamDefaultReader)</small></span>
     <li><span class="dfn-paneled" id="a307241e">release <small>(for WritableStreamDefaultWriter)</small></span>
     <li><span class="dfn-paneled" id="d438bc09">set up <small>(for ReadableStream)</small></span>
     <li><span class="dfn-paneled" id="3dc81766">set up <small>(for WritableStream)</small></span>
     <li><span class="dfn-paneled" id="c7574ff1">transformalgorithm</span>
     <li><span class="dfn-paneled" id="d04a8309">writealgorithm</span>
    </ul>
   <li>
    <a data-link-type="biblio">[WebCryptoAPI]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="5fc623fc">CryptoKey</span>
    </ul>
   <li>
    <a data-link-type="biblio">[WEBIDL]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="2f8afbfe">ArrayBuffer</span>
     <li><span class="dfn-paneled" id="3aff2fb3">BufferSource</span>
     <li><span class="dfn-paneled" id="dca2de17">DOMException</span>
     <li><span class="dfn-paneled" id="c01cbda0">EnforceRange</span>
     <li><span class="dfn-paneled" id="889e932f">Exposed</span>
     <li><span class="dfn-paneled" id="37afd48d">InvalidAccessError</span>
     <li><span class="dfn-paneled" id="cae6bf57">InvalidModificationError</span>
     <li><span class="dfn-paneled" id="bdbd19d1">Promise</span>
     <li><span class="dfn-paneled" id="ec878a66">RangeError</span>
     <li><span class="dfn-paneled" id="dacde8b5">a new promise</span>
     <li><span class="dfn-paneled" id="8f5c2179">a promise resolved with</span>
     <li><span class="dfn-paneled" id="6c6b1005">any</span>
     <li><span class="dfn-paneled" id="bdcd112d">bigint</span>
     <li><span class="dfn-paneled" id="5372cca8">boolean</span>
     <li><span class="dfn-paneled" id="f8de33a3">long</span>
     <li><span class="dfn-paneled" id="9aeb0a82">long long</span>
     <li><span class="dfn-paneled" id="efd1ec5d">object</span>
     <li><span class="dfn-paneled" id="b262501e">reject</span>
     <li><span class="dfn-paneled" id="3b90bdcd">resolve</span>
     <li><span class="dfn-paneled" id="9cce47fd">sequence</span>
     <li><span class="dfn-paneled" id="4013a022">this</span>
     <li><span class="dfn-paneled" id="5f90bbfb">undefined</span>
     <li><span class="dfn-paneled" id="f14b47b8">unsigned long long</span>
     <li><span class="dfn-paneled" id="450958f7">unsigned short</span>
    </ul>
   <li>
    <a data-link-type="biblio">[WEBRTC]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="c891de74">RTCConfiguration</span>
     <li><span class="dfn-paneled" id="7c983b6d">RTCPeerConnection</span>
     <li><span class="dfn-paneled" id="e4db230f">RTCRtpReceiver</span>
     <li><span class="dfn-paneled" id="b161d57f">RTCRtpSender</span>
    </ul>
  </ul>
  <h2 class="no-num no-ref heading settled" id="references"><span class="content">References</span><a class="self-link" href="#references"></a></h2>
  <h3 class="no-num no-ref heading settled" id="normative"><span class="content">Normative References</span><a class="self-link" href="#normative"></a></h3>
  <dl>
   <dt id="biblio-dom">[DOM]
   <dd>Anne van Kesteren. <a href="https://dom.spec.whatwg.org/"><cite>DOM Standard</cite></a>. Living Standard. URL: <a href="https://dom.spec.whatwg.org/">https://dom.spec.whatwg.org/</a>
   <dt id="biblio-html">[HTML]
   <dd>Anne van Kesteren; et al. <a href="https://html.spec.whatwg.org/multipage/"><cite>HTML Standard</cite></a>. Living Standard. URL: <a href="https://html.spec.whatwg.org/multipage/">https://html.spec.whatwg.org/multipage/</a>
   <dt id="biblio-mediacapture-streams">[MEDIACAPTURE-STREAMS]
   <dd>Cullen Jennings; et al. <a href="https://w3c.github.io/mediacapture-main/"><cite>Media Capture and Streams</cite></a>. URL: <a href="https://w3c.github.io/mediacapture-main/">https://w3c.github.io/mediacapture-main/</a>
   <dt id="biblio-rfc2119">[RFC2119]
   <dd>S. Bradner. <a href="https://datatracker.ietf.org/doc/html/rfc2119"><cite>Key words for use in RFCs to Indicate Requirement Levels</cite></a>. March 1997. Best Current Practice. URL: <a href="https://datatracker.ietf.org/doc/html/rfc2119">https://datatracker.ietf.org/doc/html/rfc2119</a>
   <dt id="biblio-streams">[STREAMS]
   <dd>Adam Rice; et al. <a href="https://streams.spec.whatwg.org/"><cite>Streams Standard</cite></a>. Living Standard. URL: <a href="https://streams.spec.whatwg.org/">https://streams.spec.whatwg.org/</a>
   <dt id="biblio-webcryptoapi">[WebCryptoAPI]
   <dd>Mark Watson. <a href="https://w3c.github.io/webcrypto/"><cite>Web Cryptography API</cite></a>. URL: <a href="https://w3c.github.io/webcrypto/">https://w3c.github.io/webcrypto/</a>
   <dt id="biblio-webidl">[WEBIDL]
   <dd>Edgar Chen; Timothy Gu. <a href="https://webidl.spec.whatwg.org/"><cite>Web IDL Standard</cite></a>. Living Standard. URL: <a href="https://webidl.spec.whatwg.org/">https://webidl.spec.whatwg.org/</a>
   <dt id="biblio-webrtc">[WEBRTC]
   <dd>Cullen Jennings; et al. <a href="https://w3c.github.io/webrtc-pc/"><cite>WebRTC: Real-Time Communication in Browsers</cite></a>. URL: <a href="https://w3c.github.io/webrtc-pc/">https://w3c.github.io/webrtc-pc/</a>
  </dl>
  <h3 class="no-num no-ref heading settled" id="informative"><span class="content">Informative References</span><a class="self-link" href="#informative"></a></h3>
  <dl>
   <dt id="biblio-web-codecs">[WEB-CODECS]
   <dd><a href="https://github.com/WICG/web-codecs/blob/master/explainer.md"><cite>Web Codecs explainer</cite></a>. URL: <a href="https://github.com/WICG/web-codecs/blob/master/explainer.md">https://github.com/WICG/web-codecs/blob/master/explainer.md</a>
   <dt id="biblio-webrtc-identity">[WEBRTC-IDENTITY]
   <dd>Cullen Jennings; Martin Thomson. <a href="https://w3c.github.io/webrtc-identity/"><cite>Identity for WebRTC 1.0</cite></a>. URL: <a href="https://w3c.github.io/webrtc-identity/">https://w3c.github.io/webrtc-identity/</a>
   <dt id="biblio-webrtc-nv-use-cases">[WEBRTC-NV-USE-CASES]
   <dd>Bernard Aboba. <a href="https://w3c.github.io/webrtc-nv-use-cases/"><cite>WebRTC Extended Use Cases</cite></a>. URL: <a href="https://w3c.github.io/webrtc-nv-use-cases/">https://w3c.github.io/webrtc-nv-use-cases/</a>
  </dl>
  <h2 class="no-num no-ref heading settled" id="idl-index"><span class="content">IDL Index</span><a class="self-link" href="#idl-index"></a></h2>
<pre class="idl highlight def">// New dictionary
<c- b>dictionary</c-> <a href="#dictdef-rtcinsertablestreams"><code><c- g>RTCInsertableStreams</c-></code></a> {
    <a data-link-type="idl-name" href="https://streams.spec.whatwg.org/#readablestream"><c- n>ReadableStream</c-></a> <a data-type="ReadableStream" href="#dom-rtcinsertablestreams-readable"><code><c- g>readable</c-></code></a>;
    <a data-link-type="idl-name" href="https://streams.spec.whatwg.org/#writablestream"><c- n>WritableStream</c-></a> <a data-type="WritableStream" href="#dom-rtcinsertablestreams-writable"><code><c- g>writable</c-></code></a>;
};

// New fields in RTCConfiguration
<c- b>partial</c-> <c- b>dictionary</c-> <a class="idl-code" data-link-type="dictionary" href="https://w3c.github.io/webrtc-pc/#dom-rtcconfiguration"><c- g>RTCConfiguration</c-></a> {
    <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-boolean"><c- b>boolean</c-></a> <a data-default="false" data-type="boolean" href="#dom-rtcconfiguration-encodedinsertablestreams"><code><c- g>encodedInsertableStreams</c-></code></a> = <c- b>false</c->;
};

<c- b>typedef</c-> (<a data-link-type="idl-name" href="#sframetransform"><c- n>SFrameTransform</c-></a> <c- b>or</c-> <a data-link-type="idl-name" href="#rtcrtpscripttransform"><c- n>RTCRtpScriptTransform</c-></a>) <a href="#typedefdef-rtcrtptransform"><code><c- g>RTCRtpTransform</c-></code></a>;

// New methods for RTCRtpSender and RTCRtpReceiver
<c- b>partial</c-> <c- b>interface</c-> <a class="idl-code" data-link-type="interface" href="https://w3c.github.io/webrtc-pc/#dom-rtcrtpsender"><c- g>RTCRtpSender</c-></a> {
    <a data-link-type="idl-name" href="#dictdef-rtcinsertablestreams"><c- n>RTCInsertableStreams</c-></a> <a class="idl-code" data-link-type="method" href="#dom-rtcrtpsender-createencodedstreams"><c- g>createEncodedStreams</c-></a>();
    <c- b>attribute</c-> <a data-link-type="idl-name" href="#typedefdef-rtcrtptransform"><c- n>RTCRtpTransform</c-></a>? <a class="idl-code" data-link-type="attribute" data-type="RTCRtpTransform?" href="#dom-rtcrtpsender-transform"><c- g>transform</c-></a>;
};

<c- b>partial</c-> <c- b>interface</c-> <a class="idl-code" data-link-type="interface" href="https://w3c.github.io/webrtc-pc/#dom-rtcrtpreceiver"><c- g>RTCRtpReceiver</c-></a> {
    <a data-link-type="idl-name" href="#dictdef-rtcinsertablestreams"><c- n>RTCInsertableStreams</c-></a> <a href="#dom-rtcrtpreceiver-createencodedstreams"><code><c- g>createEncodedStreams</c-></code></a>();
    <c- b>attribute</c-> <a data-link-type="idl-name" href="#typedefdef-rtcrtptransform"><c- n>RTCRtpTransform</c-></a>? <a class="idl-code" data-link-type="attribute" data-type="RTCRtpTransform?" href="#dom-rtcrtpsender-transform"><c- g>transform</c-></a>;
};

<c- b>enum</c-> <a href="#enumdef-sframetransformrole"><code><c- g>SFrameTransformRole</c-></code></a> {
    <a href="#dom-sframetransformrole-encrypt"><code><c- s>"encrypt"</c-></code></a>,
    <a href="#dom-sframetransformrole-decrypt"><code><c- s>"decrypt"</c-></code></a>
};

<c- b>dictionary</c-> <a href="#dictdef-sframetransformoptions"><code><c- g>SFrameTransformOptions</c-></code></a> {
    <a data-link-type="idl-name" href="#enumdef-sframetransformrole"><c- n>SFrameTransformRole</c-></a> <a data-default="&quot;encrypt&quot;" data-type="SFrameTransformRole" href="#dom-sframetransformoptions-role"><code><c- g>role</c-></code></a> = "encrypt";
};

<c- b>typedef</c-> [<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#EnforceRange"><c- g>EnforceRange</c-></a>] <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-unsigned-long-long"><c- b>unsigned</c-> <c- b>long</c-> <c- b>long</c-></a> <a href="#typedefdef-smallcryptokeyid"><code><c- g>SmallCryptoKeyID</c-></code></a>;
<c- b>typedef</c-> (<a data-link-type="idl-name" href="#typedefdef-smallcryptokeyid"><c- n>SmallCryptoKeyID</c-></a> <c- b>or</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-bigint"><c- b>bigint</c-></a>) <a href="#typedefdef-cryptokeyid"><code><c- g>CryptoKeyID</c-></code></a>;

[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed"><c- g>Exposed</c-></a>=(<c- n>Window</c->,<c- n>DedicatedWorker</c->)]
<c- b>interface</c-> <a href="#sframetransform"><code><c- g>SFrameTransform</c-></code></a> {
    <a class="idl-code" data-link-type="constructor" href="#dom-sframetransform-sframetransform"><c- g>constructor</c-></a>(<c- b>optional</c-> <a data-link-type="idl-name" href="#dictdef-sframetransformoptions"><c- n>SFrameTransformOptions</c-></a> <a href="#dom-sframetransform-sframetransform-options-options"><code><c- g>options</c-></code></a> = {});
    <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise"><c- b>Promise</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-undefined"><c- b>undefined</c-></a>> <a class="idl-code" data-link-type="method" href="#dom-sframetransform-setencryptionkey"><c- g>setEncryptionKey</c-></a>(<a data-link-type="idl-name" href="https://w3c.github.io/webcrypto/#dfn-CryptoKey"><c- n>CryptoKey</c-></a> <a href="#dom-sframetransform-setencryptionkey-key-keyid-key"><code><c- g>key</c-></code></a>, <c- b>optional</c-> <a data-link-type="idl-name" href="#typedefdef-cryptokeyid"><c- n>CryptoKeyID</c-></a> <a href="#dom-sframetransform-setencryptionkey-key-keyid-keyid"><code><c- g>keyID</c-></code></a>);
};
<a data-link-type="idl-name" href="#sframetransform"><c- n>SFrameTransform</c-></a> <c- b>includes</c-> <a data-link-type="idl-name" href="https://streams.spec.whatwg.org/#generictransformstream"><c- n>GenericTransformStream</c-></a>;

// New enum for video frame types. Will eventually re-use the equivalent defined
// by WebCodecs.
<c- b>enum</c-> <a href="#enumdef-rtcencodedvideoframetype"><code><c- g>RTCEncodedVideoFrameType</c-></code></a> {
    <a href="#dom-rtcencodedvideoframetype-empty"><code><c- s>"empty"</c-></code></a>,
    <a href="#dom-rtcencodedvideoframetype-key"><code><c- s>"key"</c-></code></a>,
    <a href="#dom-rtcencodedvideoframetype-delta"><code><c- s>"delta"</c-></code></a>,
};

<c- b>dictionary</c-> <a href="#dictdef-rtcencodedvideoframemetadata"><code><c- g>RTCEncodedVideoFrameMetadata</c-></code></a> {
    <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-long-long"><c- b>long</c-> <c- b>long</c-></a> <a data-type="long long" href="#dom-rtcencodedvideoframemetadata-frameid"><code><c- g>frameId</c-></code></a>;
    <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#idl-sequence"><c- b>sequence</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-long-long"><c- b>long</c-> <c- b>long</c-></a>> <a data-type="sequence<long long>" href="#dom-rtcencodedvideoframemetadata-dependencies"><code><c- g>dependencies</c-></code></a>;
    <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-unsigned-short"><c- b>unsigned</c-> <c- b>short</c-></a> <a data-type="unsigned short" href="#dom-rtcencodedvideoframemetadata-width"><code><c- g>width</c-></code></a>;
    <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-unsigned-short"><c- b>unsigned</c-> <c- b>short</c-></a> <a data-type="unsigned short" href="#dom-rtcencodedvideoframemetadata-height"><code><c- g>height</c-></code></a>;
    <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-long"><c- b>long</c-></a> <a data-type="long" href="#dom-rtcencodedvideoframemetadata-spatialindex"><code><c- g>spatialIndex</c-></code></a>;
    <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-long"><c- b>long</c-></a> <a data-type="long" href="#dom-rtcencodedvideoframemetadata-temporalindex"><code><c- g>temporalIndex</c-></code></a>;
    <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-long"><c- b>long</c-></a> <a data-type="long" href="#dom-rtcencodedvideoframemetadata-synchronizationsource"><code><c- g>synchronizationSource</c-></code></a>;
    <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#idl-sequence"><c- b>sequence</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-long"><c- b>long</c-></a>> <a data-type="sequence<long>" href="#dom-rtcencodedvideoframemetadata-contributingsources"><code><c- g>contributingSources</c-></code></a>;
};

// New interfaces to define encoded video and audio frames. Will eventually
// re-use or extend the equivalent defined in WebCodecs.
[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed"><c- g>Exposed</c-></a>=(<c- n>Window</c->,<c- n>DedicatedWorker</c->)]
<c- b>interface</c-> <a href="#rtcencodedvideoframe"><code><c- g>RTCEncodedVideoFrame</c-></code></a> {
    <c- b>readonly</c-> <c- b>attribute</c-> <a data-link-type="idl-name" href="#enumdef-rtcencodedvideoframetype"><c- n>RTCEncodedVideoFrameType</c-></a> <a data-readonly data-type="RTCEncodedVideoFrameType" href="#dom-rtcencodedvideoframe-type"><code><c- g>type</c-></code></a>;
    <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-unsigned-long-long"><c- b>unsigned</c-> <c- b>long</c-> <c- b>long</c-></a> <a data-readonly data-type="unsigned long long" href="#dom-rtcencodedvideoframe-timestamp"><code><c- g>timestamp</c-></code></a>;
    <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-ArrayBuffer"><c- b>ArrayBuffer</c-></a> <a data-type="ArrayBuffer" href="#dom-rtcencodedvideoframe-data"><code><c- g>data</c-></code></a>;
    <a data-link-type="idl-name" href="#dictdef-rtcencodedvideoframemetadata"><c- n>RTCEncodedVideoFrameMetadata</c-></a> <a href="#dom-rtcencodedvideoframe-getmetadata"><code><c- g>getMetadata</c-></code></a>();
};

<c- b>dictionary</c-> <a href="#dictdef-rtcencodedaudioframemetadata"><code><c- g>RTCEncodedAudioFrameMetadata</c-></code></a> {
    <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-long"><c- b>long</c-></a> <a data-type="long" href="#dom-rtcencodedaudioframemetadata-synchronizationsource"><code><c- g>synchronizationSource</c-></code></a>;
    <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#idl-sequence"><c- b>sequence</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-long"><c- b>long</c-></a>> <a data-type="sequence<long>" href="#dom-rtcencodedaudioframemetadata-contributingsources"><code><c- g>contributingSources</c-></code></a>;
};

[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed"><c- g>Exposed</c-></a>=(<c- n>Window</c->,<c- n>DedicatedWorker</c->)]
<c- b>interface</c-> <a href="#rtcencodedaudioframe"><code><c- g>RTCEncodedAudioFrame</c-></code></a> {
    <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-unsigned-long-long"><c- b>unsigned</c-> <c- b>long</c-> <c- b>long</c-></a> <a data-readonly data-type="unsigned long long" href="#dom-rtcencodedaudioframe-timestamp"><code><c- g>timestamp</c-></code></a>;
    <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-ArrayBuffer"><c- b>ArrayBuffer</c-></a> <a data-type="ArrayBuffer" href="#dom-rtcencodedaudioframe-data"><code><c- g>data</c-></code></a>;
    <a data-link-type="idl-name" href="#dictdef-rtcencodedaudioframemetadata"><c- n>RTCEncodedAudioFrameMetadata</c-></a> <a href="#dom-rtcencodedaudioframe-getmetadata"><code><c- g>getMetadata</c-></code></a>();
};


// New interfaces to expose JavaScript-based transforms.

[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed"><c- g>Exposed</c-></a>=<c- n>DedicatedWorker</c->]
<c- b>interface</c-> <a href="#rtctransformevent"><code><c- g>RTCTransformEvent</c-></code></a> : <a data-link-type="idl-name" href="https://dom.spec.whatwg.org/#event"><c- n>Event</c-></a> {
    <c- b>readonly</c-> <c- b>attribute</c-> <a data-link-type="idl-name" href="#rtcrtpscripttransformer"><c- n>RTCRtpScriptTransformer</c-></a> <a data-readonly data-type="RTCRtpScriptTransformer" href="#dom-rtctransformevent-transformer"><code><c- g>transformer</c-></code></a>;
};

<c- b>partial</c-> <c- b>interface</c-> <a class="idl-code" data-link-type="interface" href="https://html.spec.whatwg.org/multipage/workers.html#dedicatedworkerglobalscope"><c- g>DedicatedWorkerGlobalScope</c-></a> {
    <c- b>attribute</c-> <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler"><c- n>EventHandler</c-></a> <a data-type="EventHandler" href="#dom-dedicatedworkerglobalscope-onrtctransform"><code><c- g>onrtctransform</c-></code></a>;
};

[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed"><c- g>Exposed</c-></a>=<c- n>DedicatedWorker</c->]
<c- b>interface</c-> <a href="#rtcrtpscripttransformer"><code><c- g>RTCRtpScriptTransformer</c-></code></a> {
    <c- b>readonly</c-> <c- b>attribute</c-> <a data-link-type="idl-name" href="https://streams.spec.whatwg.org/#readablestream"><c- n>ReadableStream</c-></a> <a class="idl-code" data-link-type="attribute" data-readonly data-type="ReadableStream" href="#dom-rtcrtpscripttransformer-readable"><c- g>readable</c-></a>;
    <c- b>readonly</c-> <c- b>attribute</c-> <a data-link-type="idl-name" href="https://streams.spec.whatwg.org/#writablestream"><c- n>WritableStream</c-></a> <a class="idl-code" data-link-type="attribute" data-readonly data-type="WritableStream" href="#dom-rtcrtpscripttransformer-writable"><c- g>writable</c-></a>;
    <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-any"><c- b>any</c-></a> <a class="idl-code" data-link-type="attribute" data-readonly data-type="any" href="#dom-rtcrtpscripttransformer-options"><c- g>options</c-></a>;
};

[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed"><c- g>Exposed</c-></a>=<c- n>Window</c->]
<c- b>interface</c-> <a href="#rtcrtpscripttransform"><code><c- g>RTCRtpScriptTransform</c-></code></a> {
    <a class="idl-code" data-link-type="constructor" href="#dom-rtcrtpscripttransform-rtcrtpscripttransform"><c- g>constructor</c-></a>(<a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/workers.html#worker"><c- n>Worker</c-></a> <a href="#dom-rtcrtpscripttransform-rtcrtpscripttransform-worker-options-transfer-worker"><code><c- g>worker</c-></code></a>, <c- b>optional</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-any"><c- b>any</c-></a> <a href="#dom-rtcrtpscripttransform-rtcrtpscripttransform-worker-options-transfer-options"><code><c- g>options</c-></code></a>, <c- b>optional</c-> <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#idl-sequence"><c- b>sequence</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-object"><c- b>object</c-></a>> <a href="#dom-rtcrtpscripttransform-rtcrtpscripttransform-worker-options-transfer-transfer"><code><c- g>transfer</c-></code></a>);
};

</pre>
<script>/* Boilerplate: script-dom-helper */
"use strict";
function query(sel) { return document.querySelector(sel); }

function queryAll(sel) { return [...document.querySelectorAll(sel)]; }

function iter(obj) {
	if(!obj) return [];
	var it = obj[Symbol.iterator];
	if(it) return it;
	return Object.entries(obj);
}

function mk(tagname, attrs, ...children) {
	const el = document.createElement(tagname);
	for(const [k,v] of iter(attrs)) {
		if(k.slice(0,3) == "_on") {
			const eventName = k.slice(3);
			el.addEventListener(eventName, v);
		} else if(k[0] == "_") {
			// property, not attribute
			el[k.slice(1)] = v;
		} else {
			if(v === false || v == null) {
        continue;
      } else if(v === true) {
        el.setAttribute(k, "");
        continue;
      } else {
  			el.setAttribute(k, v);
      }
		}
	}
	append(el, children);
	return el;
}

/* Create shortcuts for every known HTML element */
[
  "a",
  "abbr",
  "acronym",
  "address",
  "applet",
  "area",
  "article",
  "aside",
  "audio",
  "b",
  "base",
  "basefont",
  "bdo",
  "big",
  "blockquote",
  "body",
  "br",
  "button",
  "canvas",
  "caption",
  "center",
  "cite",
  "code",
  "col",
  "colgroup",
  "datalist",
  "dd",
  "del",
  "details",
  "dfn",
  "dialog",
  "div",
  "dl",
  "dt",
  "em",
  "embed",
  "fieldset",
  "figcaption",
  "figure",
  "font",
  "footer",
  "form",
  "frame",
  "frameset",
  "head",
  "header",
  "h1",
  "h2",
  "h3",
  "h4",
  "h5",
  "h6",
  "hr",
  "html",
  "i",
  "iframe",
  "img",
  "input",
  "ins",
  "kbd",
  "label",
  "legend",
  "li",
  "link",
  "main",
  "map",
  "mark",
  "meta",
  "meter",
  "nav",
  "nobr",
  "noscript",
  "object",
  "ol",
  "optgroup",
  "option",
  "output",
  "p",
  "param",
  "pre",
  "progress",
  "q",
  "s",
  "samp",
  "script",
  "section",
  "select",
  "small",
  "source",
  "span",
  "strike",
  "strong",
  "style",
  "sub",
  "summary",
  "sup",
  "table",
  "tbody",
  "td",
  "template",
  "textarea",
  "tfoot",
  "th",
  "thead",
  "time",
  "title",
  "tr",
  "u",
  "ul",
  "var",
  "video",
  "wbr",
  "xmp",
].forEach(tagname=>{
	mk[tagname] = (...args) => mk(tagname, ...args);
});

function* nodesFromChildList(children) {
	for(const child of children.flat(Infinity)) {
		if(child instanceof Node) {
			yield child;
		} else {
			yield new Text(child);
		}
	}
}
function append(el, ...children) {
	for(const child of nodesFromChildList(children)) {
		if(el instanceof Node) el.appendChild(child);
		else el.push(child);
	}
	return el;
}

function insertAfter(el, ...children) {
	for(const child of nodesFromChildList(children)) {
		el.parentNode.insertBefore(child, el.nextSibling);
	}
	return el;
}

function clearContents(el) {
	el.innerHTML = "";
	return el;
}

function parseHTML(markup) {
	if(markup.toLowerCase().trim().indexOf('<!doctype') === 0) {
		const doc = document.implementation.createHTMLDocument("");
		doc.documentElement.innerHTML = markup;
		return doc;
	} else {
		const el = mk.template({});
		el.innerHTML = markup;
		return el.content;
	}
}</script>
<script>/* Boilerplate: script-dfn-panel */
"use strict";
{
let dfnPanelData = {
"03c3f3ed": {"dfnID":"03c3f3ed","dfnText":"identity transform stream","external":true,"refSections":[{"refs":[{"id":"ref-for-identity-transform-stream"}],"title":"3.2. Extension attribute"},{"refs":[{"id":"ref-for-identity-transform-stream\u2460"},{"id":"ref-for-identity-transform-stream\u2461"}],"title":"5.1. Operations"}],"url":"https://streams.spec.whatwg.org/#identity-transform-stream"},
"0800bdf4": {"dfnID":"0800bdf4","dfnText":"StructuredDeserialize","external":true,"refSections":[{"refs":[{"id":"ref-for-structureddeserialize"},{"id":"ref-for-structureddeserialize\u2460"},{"id":"ref-for-structureddeserialize\u2461"}],"title":"5.1. Operations"}],"url":"https://html.spec.whatwg.org/multipage/structured-data.html#structureddeserialize"},
"129bdae8": {"dfnID":"129bdae8","dfnText":"Event","external":true,"refSections":[{"refs":[{"id":"ref-for-event"}],"title":"5. RTCRtpScriptTransform"}],"url":"https://dom.spec.whatwg.org/#event"},
"2e66eaf1": {"dfnID":"2e66eaf1","dfnText":"AbortController","external":true,"refSections":[{"refs":[{"id":"ref-for-abortcontroller"}],"title":"3.1.1. Stream creation"},{"refs":[{"id":"ref-for-abortcontroller\u2460"}],"title":"3.2. Extension attribute"}],"url":"https://dom.spec.whatwg.org/#abortcontroller"},
"2f8afbfe": {"dfnID":"2f8afbfe","dfnText":"ArrayBuffer","external":true,"refSections":[{"refs":[{"id":"ref-for-idl-ArrayBuffer"}],"title":"4.1. Algorithm"},{"refs":[{"id":"ref-for-idl-ArrayBuffer\u2460"},{"id":"ref-for-idl-ArrayBuffer\u2461"}],"title":"5. RTCRtpScriptTransform"}],"url":"https://webidl.spec.whatwg.org/#idl-ArrayBuffer"},
"37afd48d": {"dfnID":"37afd48d","dfnText":"InvalidAccessError","external":true,"refSections":[{"refs":[{"id":"ref-for-invalidaccesserror"},{"id":"ref-for-invalidaccesserror\u2460"},{"id":"ref-for-invalidaccesserror\u2461"},{"id":"ref-for-invalidaccesserror\u2462"}],"title":"3.1.1. Stream creation"}],"url":"https://webidl.spec.whatwg.org/#invalidaccesserror"},
"3aff2fb3": {"dfnID":"3aff2fb3","dfnText":"BufferSource","external":true,"refSections":[{"refs":[{"id":"ref-for-BufferSource"},{"id":"ref-for-BufferSource\u2460"}],"title":"4.1. Algorithm"}],"url":"https://webidl.spec.whatwg.org/#BufferSource"},
"3b90bdcd": {"dfnID":"3b90bdcd","dfnText":"resolve","external":true,"refSections":[{"refs":[{"id":"ref-for-resolve"}],"title":"4.2. Methods"}],"url":"https://webidl.spec.whatwg.org/#resolve"},
"3dc81766": {"dfnID":"3dc81766","dfnText":"set up (for WritableStream)","external":true,"refSections":[{"refs":[{"id":"ref-for-writablestream-set-up"}],"title":"3.1.1. Stream creation"}],"url":"https://streams.spec.whatwg.org/#writablestream-set-up"},
"4013a022": {"dfnID":"4013a022","dfnText":"this","external":true,"refSections":[{"refs":[{"id":"ref-for-this"},{"id":"ref-for-this\u2460"},{"id":"ref-for-this\u2461"},{"id":"ref-for-this\u2462"},{"id":"ref-for-this\u2463"},{"id":"ref-for-this\u2464"},{"id":"ref-for-this\u2465"},{"id":"ref-for-this\u2466"},{"id":"ref-for-this\u2467"},{"id":"ref-for-this\u2468"},{"id":"ref-for-this\u2460\u24ea"},{"id":"ref-for-this\u2460\u2460"},{"id":"ref-for-this\u2460\u2461"},{"id":"ref-for-this\u2460\u2462"},{"id":"ref-for-this\u2460\u2463"},{"id":"ref-for-this\u2460\u2464"},{"id":"ref-for-this\u2460\u2465"},{"id":"ref-for-this\u2460\u2466"},{"id":"ref-for-this\u2460\u2467"},{"id":"ref-for-this\u2460\u2468"},{"id":"ref-for-this\u2461\u24ea"},{"id":"ref-for-this\u2461\u2460"},{"id":"ref-for-this\u2461\u2461"},{"id":"ref-for-this\u2461\u2462"}],"title":"3.1.1. Stream creation"},{"refs":[{"id":"ref-for-this\u2461\u2463"},{"id":"ref-for-this\u2461\u2464"},{"id":"ref-for-this\u2461\u2465"},{"id":"ref-for-this\u2461\u2466"},{"id":"ref-for-this\u2461\u2467"},{"id":"ref-for-this\u2461\u2468"}],"title":"3.2. Extension attribute"},{"refs":[{"id":"ref-for-this\u2462\u24ea"}],"title":"4. SFrameTransform"},{"refs":[{"id":"ref-for-this\u2462\u2460"},{"id":"ref-for-this\u2462\u2461"},{"id":"ref-for-this\u2462\u2462"}],"title":"5.2. Attributes"}],"url":"https://webidl.spec.whatwg.org/#this"},
"450958f7": {"dfnID":"450958f7","dfnText":"unsigned short","external":true,"refSections":[{"refs":[{"id":"ref-for-idl-unsigned-short"},{"id":"ref-for-idl-unsigned-short\u2460"}],"title":"5. RTCRtpScriptTransform"}],"url":"https://webidl.spec.whatwg.org/#idl-unsigned-short"},
"47e93e3e": {"dfnID":"47e93e3e","dfnText":"TransformStream","external":true,"refSections":[{"refs":[{"id":"ref-for-transformstream"}],"title":"4. SFrameTransform"}],"url":"https://streams.spec.whatwg.org/#transformstream"},
"5372cca8": {"dfnID":"5372cca8","dfnText":"boolean","external":true,"refSections":[{"refs":[{"id":"ref-for-idl-boolean"}],"title":"3. Specification"}],"url":"https://webidl.spec.whatwg.org/#idl-boolean"},
"59dc45b5": {"dfnID":"59dc45b5","dfnText":"WritableStream","external":true,"refSections":[{"refs":[{"id":"ref-for-writablestream"}],"title":"3. Specification"},{"refs":[{"id":"ref-for-writablestream\u2460"}],"title":"3.1.1. Stream creation"},{"refs":[{"id":"ref-for-writablestream\u2461"}],"title":"5. RTCRtpScriptTransform"}],"url":"https://streams.spec.whatwg.org/#writablestream"},
"59ed4e57": {"dfnID":"59ed4e57","dfnText":"ReadableStream","external":true,"refSections":[{"refs":[{"id":"ref-for-readablestream"}],"title":"3. Specification"},{"refs":[{"id":"ref-for-readablestream\u2460"}],"title":"3.1.1. Stream creation"},{"refs":[{"id":"ref-for-readablestream\u2461"}],"title":"5. RTCRtpScriptTransform"}],"url":"https://streams.spec.whatwg.org/#readablestream"},
"5f90bbfb": {"dfnID":"5f90bbfb","dfnText":"undefined","external":true,"refSections":[{"refs":[{"id":"ref-for-idl-undefined"}],"title":"4. SFrameTransform"}],"url":"https://webidl.spec.whatwg.org/#idl-undefined"},
"5fc623fc": {"dfnID":"5fc623fc","dfnText":"CryptoKey","external":true,"refSections":[{"refs":[{"id":"ref-for-dfn-CryptoKey"}],"title":"4. SFrameTransform"}],"url":"https://w3c.github.io/webcrypto/#dfn-CryptoKey"},
"6b6bb798": {"dfnID":"6b6bb798","dfnText":"enqueue","external":true,"refSections":[{"refs":[{"id":"ref-for-readablestream-enqueue"}],"title":"3.1.2. Stream processing"},{"refs":[{"id":"ref-for-readablestream-enqueue\u2460"}],"title":"4.1. Algorithm"}],"url":"https://streams.spec.whatwg.org/#readablestream-enqueue"},
"6c6b1005": {"dfnID":"6c6b1005","dfnText":"any","external":true,"refSections":[{"refs":[{"id":"ref-for-idl-any"},{"id":"ref-for-idl-any\u2460"}],"title":"5. RTCRtpScriptTransform"}],"url":"https://webidl.spec.whatwg.org/#idl-any"},
"7c983b6d": {"dfnID":"7c983b6d","dfnText":"RTCPeerConnection","external":true,"refSections":[{"refs":[{"id":"ref-for-dom-rtcpeerconnection"}],"title":"Unnumbered Section"},{"refs":[{"id":"ref-for-dom-rtcpeerconnection\u2460"}],"title":"3. Specification"},{"refs":[{"id":"ref-for-dom-rtcpeerconnection\u2461"}],"title":"3.1. Extension operation"},{"refs":[{"id":"ref-for-dom-rtcpeerconnection\u2462"},{"id":"ref-for-dom-rtcpeerconnection\u2463"}],"title":"3.1.1. Stream creation"}],"url":"https://w3c.github.io/webrtc-pc/#dom-rtcpeerconnection"},
"87bc23a5": {"dfnID":"87bc23a5","dfnText":"add","external":true,"refSections":[{"refs":[{"id":"ref-for-abortsignal-add"}],"title":"3.2. Extension attribute"}],"url":"https://dom.spec.whatwg.org/#abortsignal-add"},
"889e932f": {"dfnID":"889e932f","dfnText":"Exposed","external":true,"refSections":[{"refs":[{"id":"ref-for-Exposed"}],"title":"4. SFrameTransform"},{"refs":[{"id":"ref-for-Exposed\u2460"},{"id":"ref-for-Exposed\u2461"},{"id":"ref-for-Exposed\u2462"},{"id":"ref-for-Exposed\u2463"},{"id":"ref-for-Exposed\u2464"}],"title":"5. RTCRtpScriptTransform"}],"url":"https://webidl.spec.whatwg.org/#Exposed"},
"8abfc3b6": {"dfnID":"8abfc3b6","dfnText":"creating an event","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-event-create"}],"title":"5.1. Operations"}],"url":"https://dom.spec.whatwg.org/#concept-event-create"},
"8f5c2179": {"dfnID":"8f5c2179","dfnText":"a promise resolved with","external":true,"refSections":[{"refs":[{"id":"ref-for-a-promise-resolved-with"},{"id":"ref-for-a-promise-resolved-with\u2460"},{"id":"ref-for-a-promise-resolved-with\u2461"}],"title":"3.1.2. Stream processing"}],"url":"https://webidl.spec.whatwg.org/#a-promise-resolved-with"},
"9a517a7d": {"dfnID":"9a517a7d","dfnText":"queue a task","external":true,"refSections":[{"refs":[{"id":"ref-for-queue-a-task"}],"title":"3.1.1. Stream creation"},{"refs":[{"id":"ref-for-queue-a-task\u2460"}],"title":"5.1. Operations"}],"url":"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task"},
"9aeb0a82": {"dfnID":"9aeb0a82","dfnText":"long long","external":true,"refSections":[{"refs":[{"id":"ref-for-idl-long-long"},{"id":"ref-for-idl-long-long\u2460"}],"title":"5. RTCRtpScriptTransform"}],"url":"https://webidl.spec.whatwg.org/#idl-long-long"},
"9cce47fd": {"dfnID":"9cce47fd","dfnText":"sequence","external":true,"refSections":[{"refs":[{"id":"ref-for-idl-sequence"},{"id":"ref-for-idl-sequence\u2460"},{"id":"ref-for-idl-sequence\u2461"},{"id":"ref-for-idl-sequence\u2462"}],"title":"5. RTCRtpScriptTransform"}],"url":"https://webidl.spec.whatwg.org/#idl-sequence"},
"9da834a1": {"dfnID":"9da834a1","dfnText":"StructuredSerializeWithTransfer","external":true,"refSections":[{"refs":[{"id":"ref-for-structuredserializewithtransfer"},{"id":"ref-for-structuredserializewithtransfer\u2460"},{"id":"ref-for-structuredserializewithtransfer\u2461"}],"title":"5.1. Operations"}],"url":"https://html.spec.whatwg.org/multipage/structured-data.html#structuredserializewithtransfer"},
"a307241e": {"dfnID":"a307241e","dfnText":"release (for WritableStreamDefaultWriter)","external":true,"refSections":[{"refs":[{"id":"ref-for-writablestreamdefaultwriter-release"}],"title":"3.2. Extension attribute"}],"url":"https://streams.spec.whatwg.org/#writablestreamdefaultwriter-release"},
"a72449dd": {"dfnID":"a72449dd","dfnText":"in parallel","external":true,"refSections":[{"refs":[{"id":"ref-for-in-parallel"},{"id":"ref-for-in-parallel\u2460"}],"title":"3.1.2. Stream processing"},{"refs":[{"id":"ref-for-in-parallel\u2461"}],"title":"4.2. Methods"}],"url":"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel"},
"b161d57f": {"dfnID":"b161d57f","dfnText":"RTCRtpSender","external":true,"refSections":[{"refs":[{"id":"ref-for-dom-rtcrtpsender"},{"id":"ref-for-dom-rtcrtpsender\u2460"}],"title":"3. Specification"},{"refs":[{"id":"ref-for-dom-rtcrtpsender\u2461"}],"title":"3.1.1. Stream creation"},{"refs":[{"id":"ref-for-dom-rtcrtpsender\u2462"},{"id":"ref-for-dom-rtcrtpsender\u2463"}],"title":"3.1.2. Stream processing"},{"refs":[{"id":"ref-for-dom-rtcrtpsender\u2464"},{"id":"ref-for-dom-rtcrtpsender\u2465"}],"title":"3.2. Extension attribute"},{"refs":[{"id":"ref-for-dom-rtcrtpsender\u2466"}],"title":"4.1. Algorithm"}],"url":"https://w3c.github.io/webrtc-pc/#dom-rtcrtpsender"},
"b21c2abd": {"dfnID":"b21c2abd","dfnText":"release (for ReadableStreamDefaultReader)","external":true,"refSections":[{"refs":[{"id":"ref-for-readablestreamdefaultreader-release"}],"title":"3.2. Extension attribute"}],"url":"https://streams.spec.whatwg.org/#readablestreamdefaultreader-release"},
"b262501e": {"dfnID":"b262501e","dfnText":"reject","external":true,"refSections":[{"refs":[{"id":"ref-for-reject"},{"id":"ref-for-reject\u2460"}],"title":"4.2. Methods"}],"url":"https://webidl.spec.whatwg.org/#reject"},
"b8308563": {"dfnID":"b8308563","dfnText":"DedicatedWorkerGlobalScope","external":true,"refSections":[{"refs":[{"id":"ref-for-dedicatedworkerglobalscope"}],"title":"5. RTCRtpScriptTransform"}],"url":"https://html.spec.whatwg.org/multipage/workers.html#dedicatedworkerglobalscope"},
"bc1e4fa1": {"dfnID":"bc1e4fa1","dfnText":"MediaStreamTrack","external":true,"refSections":[{"refs":[{"id":"ref-for-dom-mediastreamtrack"}],"title":"Unnumbered Section"}],"url":"https://w3c.github.io/mediacapture-main/#dom-mediastreamtrack"},
"bdbd19d1": {"dfnID":"bdbd19d1","dfnText":"Promise","external":true,"refSections":[{"refs":[{"id":"ref-for-idl-promise"}],"title":"4. SFrameTransform"}],"url":"https://webidl.spec.whatwg.org/#idl-promise"},
"bdcd112d": {"dfnID":"bdcd112d","dfnText":"bigint","external":true,"refSections":[{"refs":[{"id":"ref-for-idl-bigint"}],"title":"4. SFrameTransform"},{"refs":[{"id":"ref-for-idl-bigint\u2460"}],"title":"4.2. Methods"}],"url":"https://webidl.spec.whatwg.org/#idl-bigint"},
"bf6531af": {"dfnID":"bf6531af","dfnText":"getting a reader","external":true,"refSections":[{"refs":[{"id":"ref-for-readablestream-get-a-reader"}],"title":"3.2. Extension attribute"}],"url":"https://streams.spec.whatwg.org/#readablestream-get-a-reader"},
"bfc1c271": {"dfnID":"bfc1c271","dfnText":"Worker","external":true,"refSections":[{"refs":[{"id":"ref-for-worker"}],"title":"5. RTCRtpScriptTransform"}],"url":"https://html.spec.whatwg.org/multipage/workers.html#worker"},
"c01cbda0": {"dfnID":"c01cbda0","dfnText":"EnforceRange","external":true,"refSections":[{"refs":[{"id":"ref-for-EnforceRange"}],"title":"4. SFrameTransform"}],"url":"https://webidl.spec.whatwg.org/#EnforceRange"},
"c3b2d08c": {"dfnID":"c3b2d08c","dfnText":"task source","external":true,"refSections":[{"refs":[{"id":"ref-for-task-source"}],"title":"5.1. Operations"}],"url":"https://html.spec.whatwg.org/multipage/webappapis.html#task-source"},
"c7574ff1": {"dfnID":"c7574ff1","dfnText":"transformalgorithm","external":true,"refSections":[{"refs":[{"id":"ref-for-transformstream-set-up-transformalgorithm"}],"title":"4. SFrameTransform"}],"url":"https://streams.spec.whatwg.org/#transformstream-set-up-transformalgorithm"},
"c891de74": {"dfnID":"c891de74","dfnText":"RTCConfiguration","external":true,"refSections":[{"refs":[{"id":"ref-for-dom-rtcconfiguration"}],"title":"3. Specification"},{"refs":[{"id":"ref-for-dom-rtcconfiguration\u2460"}],"title":"3.1. Extension operation"}],"url":"https://w3c.github.io/webrtc-pc/#dom-rtcconfiguration"},
"cae6bf57": {"dfnID":"cae6bf57","dfnText":"InvalidModificationError","external":true,"refSections":[{"refs":[{"id":"ref-for-invalidmodificationerror"}],"title":"4.2. Methods"}],"url":"https://webidl.spec.whatwg.org/#invalidmodificationerror"},
"chain-transform-algorithm": {"dfnID":"chain-transform-algorithm","dfnText":"chain transform algorithm","external":false,"refSections":[{"refs":[{"id":"ref-for-chain-transform-algorithm"},{"id":"ref-for-chain-transform-algorithm\u2460"}],"title":"3.2. Extension attribute"}],"url":"#chain-transform-algorithm"},
"d04a8309": {"dfnID":"d04a8309","dfnText":"writealgorithm","external":true,"refSections":[{"refs":[{"id":"ref-for-writablestream-set-up-writealgorithm"}],"title":"3.1.1. Stream creation"}],"url":"https://streams.spec.whatwg.org/#writablestream-set-up-writealgorithm"},
"d438bc09": {"dfnID":"d438bc09","dfnText":"set up (for ReadableStream)","external":true,"refSections":[{"refs":[{"id":"ref-for-readablestream-set-up"}],"title":"3.1.1. Stream creation"},{"refs":[{"id":"ref-for-readablestream-set-up\u2460"}],"title":"4. SFrameTransform"}],"url":"https://streams.spec.whatwg.org/#readablestream-set-up"},
"d61c5cab": {"dfnID":"d61c5cab","dfnText":"GenericTransformStream","external":true,"refSections":[{"refs":[{"id":"ref-for-generictransformstream"}],"title":"4. SFrameTransform"}],"url":"https://streams.spec.whatwg.org/#generictransformstream"},
"dacde8b5": {"dfnID":"dacde8b5","dfnText":"a new promise","external":true,"refSections":[{"refs":[{"id":"ref-for-a-new-promise"}],"title":"4.2. Methods"}],"url":"https://webidl.spec.whatwg.org/#a-new-promise"},
"dca2de17": {"dfnID":"dca2de17","dfnText":"DOMException","external":true,"refSections":[{"refs":[{"id":"ref-for-idl-DOMException"},{"id":"ref-for-idl-DOMException\u2460"},{"id":"ref-for-idl-DOMException\u2461"},{"id":"ref-for-idl-DOMException\u2462"}],"title":"3.1.1. Stream creation"}],"url":"https://webidl.spec.whatwg.org/#idl-DOMException"},
"dictdef-rtcencodedaudioframemetadata": {"dfnID":"dictdef-rtcencodedaudioframemetadata","dfnText":"RTCEncodedAudioFrameMetadata","external":false,"refSections":[{"refs":[{"id":"ref-for-dictdef-rtcencodedaudioframemetadata"}],"title":"5. RTCRtpScriptTransform"}],"url":"#dictdef-rtcencodedaudioframemetadata"},
"dictdef-rtcencodedvideoframemetadata": {"dfnID":"dictdef-rtcencodedvideoframemetadata","dfnText":"RTCEncodedVideoFrameMetadata","external":false,"refSections":[{"refs":[{"id":"ref-for-dictdef-rtcencodedvideoframemetadata"}],"title":"5. RTCRtpScriptTransform"}],"url":"#dictdef-rtcencodedvideoframemetadata"},
"dictdef-rtcinsertablestreams": {"dfnID":"dictdef-rtcinsertablestreams","dfnText":"RTCInsertableStreams","external":false,"refSections":[{"refs":[{"id":"ref-for-dictdef-rtcinsertablestreams"},{"id":"ref-for-dictdef-rtcinsertablestreams\u2460"}],"title":"3. Specification"},{"refs":[{"id":"ref-for-dictdef-rtcinsertablestreams\u2461"}],"title":"3.1.1. Stream creation"}],"url":"#dictdef-rtcinsertablestreams"},
"dictdef-sframetransformoptions": {"dfnID":"dictdef-sframetransformoptions","dfnText":"SFrameTransformOptions","external":false,"refSections":[{"refs":[{"id":"ref-for-dictdef-sframetransformoptions"}],"title":"4. SFrameTransform"}],"url":"#dictdef-sframetransformoptions"},
"dom-dedicatedworkerglobalscope-onrtctransform": {"dfnID":"dom-dedicatedworkerglobalscope-onrtctransform","dfnText":"onrtctransform","external":false,"refSections":[],"url":"#dom-dedicatedworkerglobalscope-onrtctransform"},
"dom-rtcconfiguration-encodedinsertablestreams": {"dfnID":"dom-rtcconfiguration-encodedinsertablestreams","dfnText":"encodedInsertableStreams","external":false,"refSections":[{"refs":[{"id":"ref-for-dom-rtcconfiguration-encodedinsertablestreams"},{"id":"ref-for-dom-rtcconfiguration-encodedinsertablestreams\u2460"}],"title":"3.1.1. Stream creation"}],"url":"#dom-rtcconfiguration-encodedinsertablestreams"},
"dom-rtcencodedaudioframe-data": {"dfnID":"dom-rtcencodedaudioframe-data","dfnText":"data","external":false,"refSections":[{"refs":[{"id":"ref-for-dom-rtcencodedaudioframe-data"},{"id":"ref-for-dom-rtcencodedaudioframe-data\u2460"}],"title":"4.1. Algorithm"}],"url":"#dom-rtcencodedaudioframe-data"},
"dom-rtcencodedaudioframe-getmetadata": {"dfnID":"dom-rtcencodedaudioframe-getmetadata","dfnText":"getMetadata","external":false,"refSections":[],"url":"#dom-rtcencodedaudioframe-getmetadata"},
"dom-rtcencodedaudioframe-timestamp": {"dfnID":"dom-rtcencodedaudioframe-timestamp","dfnText":"timestamp","external":false,"refSections":[],"url":"#dom-rtcencodedaudioframe-timestamp"},
"dom-rtcencodedaudioframemetadata-contributingsources": {"dfnID":"dom-rtcencodedaudioframemetadata-contributingsources","dfnText":"contributingSources","external":false,"refSections":[],"url":"#dom-rtcencodedaudioframemetadata-contributingsources"},
"dom-rtcencodedaudioframemetadata-synchronizationsource": {"dfnID":"dom-rtcencodedaudioframemetadata-synchronizationsource","dfnText":"synchronizationSource","external":false,"refSections":[],"url":"#dom-rtcencodedaudioframemetadata-synchronizationsource"},
"dom-rtcencodedvideoframe-data": {"dfnID":"dom-rtcencodedvideoframe-data","dfnText":"data","external":false,"refSections":[{"refs":[{"id":"ref-for-dom-rtcencodedvideoframe-data"},{"id":"ref-for-dom-rtcencodedvideoframe-data\u2460"}],"title":"4.1. Algorithm"}],"url":"#dom-rtcencodedvideoframe-data"},
"dom-rtcencodedvideoframe-getmetadata": {"dfnID":"dom-rtcencodedvideoframe-getmetadata","dfnText":"getMetadata","external":false,"refSections":[],"url":"#dom-rtcencodedvideoframe-getmetadata"},
"dom-rtcencodedvideoframe-timestamp": {"dfnID":"dom-rtcencodedvideoframe-timestamp","dfnText":"timestamp","external":false,"refSections":[{"refs":[{"id":"ref-for-dom-rtcencodedvideoframe-timestamp"},{"id":"ref-for-dom-rtcencodedvideoframe-timestamp\u2460"}],"title":"3.1.2. Stream processing"}],"url":"#dom-rtcencodedvideoframe-timestamp"},
"dom-rtcencodedvideoframe-type": {"dfnID":"dom-rtcencodedvideoframe-type","dfnText":"type","external":false,"refSections":[],"url":"#dom-rtcencodedvideoframe-type"},
"dom-rtcencodedvideoframemetadata-contributingsources": {"dfnID":"dom-rtcencodedvideoframemetadata-contributingsources","dfnText":"contributingSources","external":false,"refSections":[],"url":"#dom-rtcencodedvideoframemetadata-contributingsources"},
"dom-rtcencodedvideoframemetadata-dependencies": {"dfnID":"dom-rtcencodedvideoframemetadata-dependencies","dfnText":"dependencies","external":false,"refSections":[],"url":"#dom-rtcencodedvideoframemetadata-dependencies"},
"dom-rtcencodedvideoframemetadata-frameid": {"dfnID":"dom-rtcencodedvideoframemetadata-frameid","dfnText":"frameId","external":false,"refSections":[],"url":"#dom-rtcencodedvideoframemetadata-frameid"},
"dom-rtcencodedvideoframemetadata-height": {"dfnID":"dom-rtcencodedvideoframemetadata-height","dfnText":"height","external":false,"refSections":[],"url":"#dom-rtcencodedvideoframemetadata-height"},
"dom-rtcencodedvideoframemetadata-spatialindex": {"dfnID":"dom-rtcencodedvideoframemetadata-spatialindex","dfnText":"spatialIndex","external":false,"refSections":[],"url":"#dom-rtcencodedvideoframemetadata-spatialindex"},
"dom-rtcencodedvideoframemetadata-synchronizationsource": {"dfnID":"dom-rtcencodedvideoframemetadata-synchronizationsource","dfnText":"synchronizationSource","external":false,"refSections":[],"url":"#dom-rtcencodedvideoframemetadata-synchronizationsource"},
"dom-rtcencodedvideoframemetadata-temporalindex": {"dfnID":"dom-rtcencodedvideoframemetadata-temporalindex","dfnText":"temporalIndex","external":false,"refSections":[],"url":"#dom-rtcencodedvideoframemetadata-temporalindex"},
"dom-rtcencodedvideoframemetadata-width": {"dfnID":"dom-rtcencodedvideoframemetadata-width","dfnText":"width","external":false,"refSections":[],"url":"#dom-rtcencodedvideoframemetadata-width"},
"dom-rtcencodedvideoframetype-delta": {"dfnID":"dom-rtcencodedvideoframetype-delta","dfnText":"\"delta\"","external":false,"refSections":[],"url":"#dom-rtcencodedvideoframetype-delta"},
"dom-rtcencodedvideoframetype-empty": {"dfnID":"dom-rtcencodedvideoframetype-empty","dfnText":"\"empty\"","external":false,"refSections":[],"url":"#dom-rtcencodedvideoframetype-empty"},
"dom-rtcencodedvideoframetype-key": {"dfnID":"dom-rtcencodedvideoframetype-key","dfnText":"\"key\"","external":false,"refSections":[],"url":"#dom-rtcencodedvideoframetype-key"},
"dom-rtcinsertablestreams-readable": {"dfnID":"dom-rtcinsertablestreams-readable","dfnText":"readable","external":false,"refSections":[{"refs":[{"id":"ref-for-dom-rtcinsertablestreams-readable"}],"title":"3.1.1. Stream creation"}],"url":"#dom-rtcinsertablestreams-readable"},
"dom-rtcinsertablestreams-writable": {"dfnID":"dom-rtcinsertablestreams-writable","dfnText":"writable","external":false,"refSections":[{"refs":[{"id":"ref-for-dom-rtcinsertablestreams-writable"}],"title":"3.1.1. Stream creation"}],"url":"#dom-rtcinsertablestreams-writable"},
"dom-rtcrtpreceiver-createencodedstreams": {"dfnID":"dom-rtcrtpreceiver-createencodedstreams","dfnText":"createEncodedStreams","external":false,"refSections":[],"url":"#dom-rtcrtpreceiver-createencodedstreams"},
"dom-rtcrtpscripttransform-rtcrtpscripttransform": {"dfnID":"dom-rtcrtpscripttransform-rtcrtpscripttransform","dfnText":"new RTCRtpScriptTransform(worker, options, transfer)","external":false,"refSections":[{"refs":[{"id":"ref-for-dom-rtcrtpscripttransform-rtcrtpscripttransform"}],"title":"5. RTCRtpScriptTransform"}],"url":"#dom-rtcrtpscripttransform-rtcrtpscripttransform"},
"dom-rtcrtpscripttransform-rtcrtpscripttransform-worker-options-transfer-options": {"dfnID":"dom-rtcrtpscripttransform-rtcrtpscripttransform-worker-options-transfer-options","dfnText":"options","external":false,"refSections":[],"url":"#dom-rtcrtpscripttransform-rtcrtpscripttransform-worker-options-transfer-options"},
"dom-rtcrtpscripttransform-rtcrtpscripttransform-worker-options-transfer-transfer": {"dfnID":"dom-rtcrtpscripttransform-rtcrtpscripttransform-worker-options-transfer-transfer","dfnText":"transfer","external":false,"refSections":[],"url":"#dom-rtcrtpscripttransform-rtcrtpscripttransform-worker-options-transfer-transfer"},
"dom-rtcrtpscripttransform-rtcrtpscripttransform-worker-options-transfer-worker": {"dfnID":"dom-rtcrtpscripttransform-rtcrtpscripttransform-worker-options-transfer-worker","dfnText":"worker","external":false,"refSections":[],"url":"#dom-rtcrtpscripttransform-rtcrtpscripttransform-worker-options-transfer-worker"},
"dom-rtcrtpscripttransformer-options": {"dfnID":"dom-rtcrtpscripttransformer-options","dfnText":"options","external":false,"refSections":[{"refs":[{"id":"ref-for-dom-rtcrtpscripttransformer-options"}],"title":"5. RTCRtpScriptTransform"}],"url":"#dom-rtcrtpscripttransformer-options"},
"dom-rtcrtpscripttransformer-readable": {"dfnID":"dom-rtcrtpscripttransformer-readable","dfnText":"readable","external":false,"refSections":[{"refs":[{"id":"ref-for-dom-rtcrtpscripttransformer-readable"}],"title":"5. RTCRtpScriptTransform"}],"url":"#dom-rtcrtpscripttransformer-readable"},
"dom-rtcrtpscripttransformer-writable": {"dfnID":"dom-rtcrtpscripttransformer-writable","dfnText":"writable","external":false,"refSections":[{"refs":[{"id":"ref-for-dom-rtcrtpscripttransformer-writable"}],"title":"5. RTCRtpScriptTransform"}],"url":"#dom-rtcrtpscripttransformer-writable"},
"dom-rtcrtpsender-createencodedstreams": {"dfnID":"dom-rtcrtpsender-createencodedstreams","dfnText":"createEncodedStreams()","external":false,"refSections":[{"refs":[{"id":"ref-for-dom-rtcrtpsender-createencodedstreams"}],"title":"3. Specification"}],"url":"#dom-rtcrtpsender-createencodedstreams"},
"dom-rtcrtpsender-transform": {"dfnID":"dom-rtcrtpsender-transform","dfnText":"transform","external":false,"refSections":[{"refs":[{"id":"ref-for-dom-rtcrtpsender-transform"},{"id":"ref-for-dom-rtcrtpsender-transform\u2460"}],"title":"3. Specification"}],"url":"#dom-rtcrtpsender-transform"},
"dom-rtctransformevent-transformer": {"dfnID":"dom-rtctransformevent-transformer","dfnText":"transformer","external":false,"refSections":[],"url":"#dom-rtctransformevent-transformer"},
"dom-sframetransform-setencryptionkey": {"dfnID":"dom-sframetransform-setencryptionkey","dfnText":"setEncryptionKey(key, keyID)","external":false,"refSections":[{"refs":[{"id":"ref-for-dom-sframetransform-setencryptionkey"}],"title":"4. SFrameTransform"}],"url":"#dom-sframetransform-setencryptionkey"},
"dom-sframetransform-setencryptionkey-key-keyid-key": {"dfnID":"dom-sframetransform-setencryptionkey-key-keyid-key","dfnText":"key","external":false,"refSections":[],"url":"#dom-sframetransform-setencryptionkey-key-keyid-key"},
"dom-sframetransform-setencryptionkey-key-keyid-keyid": {"dfnID":"dom-sframetransform-setencryptionkey-key-keyid-keyid","dfnText":"keyID","external":false,"refSections":[],"url":"#dom-sframetransform-setencryptionkey-key-keyid-keyid"},
"dom-sframetransform-sframetransform": {"dfnID":"dom-sframetransform-sframetransform","dfnText":"new SFrameTransform(options)","external":false,"refSections":[{"refs":[{"id":"ref-for-dom-sframetransform-sframetransform"}],"title":"4. SFrameTransform"}],"url":"#dom-sframetransform-sframetransform"},
"dom-sframetransform-sframetransform-options-options": {"dfnID":"dom-sframetransform-sframetransform-options-options","dfnText":"options","external":false,"refSections":[],"url":"#dom-sframetransform-sframetransform-options-options"},
"dom-sframetransformoptions-role": {"dfnID":"dom-sframetransformoptions-role","dfnText":"role","external":false,"refSections":[{"refs":[{"id":"ref-for-dom-sframetransformoptions-role"}],"title":"4. SFrameTransform"}],"url":"#dom-sframetransformoptions-role"},
"dom-sframetransformrole-decrypt": {"dfnID":"dom-sframetransformrole-decrypt","dfnText":"\"decrypt\"","external":false,"refSections":[],"url":"#dom-sframetransformrole-decrypt"},
"dom-sframetransformrole-encrypt": {"dfnID":"dom-sframetransformrole-encrypt","dfnText":"\"encrypt\"","external":false,"refSections":[],"url":"#dom-sframetransformrole-encrypt"},
"e4db230f": {"dfnID":"e4db230f","dfnText":"RTCRtpReceiver","external":true,"refSections":[{"refs":[{"id":"ref-for-dom-rtcrtpreceiver"},{"id":"ref-for-dom-rtcrtpreceiver\u2460"}],"title":"3. Specification"},{"refs":[{"id":"ref-for-dom-rtcrtpreceiver\u2461"}],"title":"3.1.1. Stream creation"},{"refs":[{"id":"ref-for-dom-rtcrtpreceiver\u2462"},{"id":"ref-for-dom-rtcrtpreceiver\u2463"}],"title":"3.1.2. Stream processing"},{"refs":[{"id":"ref-for-dom-rtcrtpreceiver\u2464"},{"id":"ref-for-dom-rtcrtpreceiver\u2465"}],"title":"3.2. Extension attribute"},{"refs":[{"id":"ref-for-dom-rtcrtpreceiver\u2466"}],"title":"4.1. Algorithm"}],"url":"https://w3c.github.io/webrtc-pc/#dom-rtcrtpreceiver"},
"ec878a66": {"dfnID":"ec878a66","dfnText":"RangeError","external":true,"refSections":[{"refs":[{"id":"ref-for-exceptiondef-rangeerror"}],"title":"4.2. Methods"}],"url":"https://webidl.spec.whatwg.org/#exceptiondef-rangeerror"},
"efd1ec5d": {"dfnID":"efd1ec5d","dfnText":"object","external":true,"refSections":[{"refs":[{"id":"ref-for-idl-object"}],"title":"5. RTCRtpScriptTransform"}],"url":"https://webidl.spec.whatwg.org/#idl-object"},
"enumdef-rtcencodedvideoframetype": {"dfnID":"enumdef-rtcencodedvideoframetype","dfnText":"RTCEncodedVideoFrameType","external":false,"refSections":[{"refs":[{"id":"ref-for-enumdef-rtcencodedvideoframetype"}],"title":"5. RTCRtpScriptTransform"}],"url":"#enumdef-rtcencodedvideoframetype"},
"enumdef-sframetransformrole": {"dfnID":"enumdef-sframetransformrole","dfnText":"SFrameTransformRole","external":false,"refSections":[{"refs":[{"id":"ref-for-enumdef-sframetransformrole"}],"title":"4. SFrameTransform"}],"url":"#enumdef-sframetransformrole"},
"f0951476": {"dfnID":"f0951476","dfnText":"EventHandler","external":true,"refSections":[{"refs":[{"id":"ref-for-eventhandler"}],"title":"5. RTCRtpScriptTransform"}],"url":"https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler"},
"f14b47b8": {"dfnID":"f14b47b8","dfnText":"unsigned long long","external":true,"refSections":[{"refs":[{"id":"ref-for-idl-unsigned-long-long"}],"title":"4. SFrameTransform"},{"refs":[{"id":"ref-for-idl-unsigned-long-long\u2460"},{"id":"ref-for-idl-unsigned-long-long\u2461"}],"title":"5. RTCRtpScriptTransform"}],"url":"https://webidl.spec.whatwg.org/#idl-unsigned-long-long"},
"f4acb816": {"dfnID":"f4acb816","dfnText":"getting a writer","external":true,"refSections":[{"refs":[{"id":"ref-for-writablestream-get-a-writer"}],"title":"3.2. Extension attribute"}],"url":"https://streams.spec.whatwg.org/#writablestream-get-a-writer"},
"f8de33a3": {"dfnID":"f8de33a3","dfnText":"long","external":true,"refSections":[{"refs":[{"id":"ref-for-idl-long"},{"id":"ref-for-idl-long\u2460"},{"id":"ref-for-idl-long\u2461"},{"id":"ref-for-idl-long\u2462"},{"id":"ref-for-idl-long\u2463"},{"id":"ref-for-idl-long\u2464"}],"title":"5. RTCRtpScriptTransform"}],"url":"https://webidl.spec.whatwg.org/#idl-long"},
"readencodeddata": {"dfnID":"readencodeddata","dfnText":"readEncodedData","external":false,"refSections":[{"refs":[{"id":"ref-for-readencodeddata"}],"title":"3.1.1. Stream creation"}],"url":"#readencodeddata"},
"rtcencodedaudioframe": {"dfnID":"rtcencodedaudioframe","dfnText":"RTCEncodedAudioFrame","external":false,"refSections":[{"refs":[{"id":"ref-for-rtcencodedaudioframe"},{"id":"ref-for-rtcencodedaudioframe\u2460"}],"title":"4.1. Algorithm"}],"url":"#rtcencodedaudioframe"},
"rtcencodedvideoframe": {"dfnID":"rtcencodedvideoframe","dfnText":"RTCEncodedVideoFrame","external":false,"refSections":[{"refs":[{"id":"ref-for-rtcencodedvideoframe"},{"id":"ref-for-rtcencodedvideoframe\u2460"}],"title":"4.1. Algorithm"}],"url":"#rtcencodedvideoframe"},
"rtcrtpscripttransform": {"dfnID":"rtcrtpscripttransform","dfnText":"RTCRtpScriptTransform","external":false,"refSections":[{"refs":[{"id":"ref-for-rtcrtpscripttransform"}],"title":"3. Specification"}],"url":"#rtcrtpscripttransform"},
"rtcrtpscripttransformer": {"dfnID":"rtcrtpscripttransformer","dfnText":"RTCRtpScriptTransformer","external":false,"refSections":[{"refs":[{"id":"ref-for-rtcrtpscripttransformer"}],"title":"5. RTCRtpScriptTransform"},{"refs":[{"id":"ref-for-rtcrtpscripttransformer\u2460"}],"title":"5.1. Operations"}],"url":"#rtcrtpscripttransformer"},
"rtctransformevent": {"dfnID":"rtctransformevent","dfnText":"RTCTransformEvent","external":false,"refSections":[{"refs":[{"id":"ref-for-rtctransformevent"}],"title":"5.1. Operations"}],"url":"#rtctransformevent"},
"sframetransform": {"dfnID":"sframetransform","dfnText":"SFrameTransform","external":false,"refSections":[{"refs":[{"id":"ref-for-sframetransform"}],"title":"3. Specification"},{"refs":[{"id":"ref-for-sframetransform\u2460"}],"title":"4. SFrameTransform"}],"url":"#sframetransform"},
"typedefdef-cryptokeyid": {"dfnID":"typedefdef-cryptokeyid","dfnText":"CryptoKeyID","external":false,"refSections":[{"refs":[{"id":"ref-for-typedefdef-cryptokeyid"}],"title":"4. SFrameTransform"}],"url":"#typedefdef-cryptokeyid"},
"typedefdef-rtcrtptransform": {"dfnID":"typedefdef-rtcrtptransform","dfnText":"RTCRtpTransform","external":false,"refSections":[{"refs":[{"id":"ref-for-typedefdef-rtcrtptransform"},{"id":"ref-for-typedefdef-rtcrtptransform\u2460"}],"title":"3. Specification"}],"url":"#typedefdef-rtcrtptransform"},
"typedefdef-smallcryptokeyid": {"dfnID":"typedefdef-smallcryptokeyid","dfnText":"SmallCryptoKeyID","external":false,"refSections":[{"refs":[{"id":"ref-for-typedefdef-smallcryptokeyid"}],"title":"4. SFrameTransform"}],"url":"#typedefdef-smallcryptokeyid"},
"writeencodeddata": {"dfnID":"writeencodeddata","dfnText":"writeEncodedData","external":false,"refSections":[{"refs":[{"id":"ref-for-writeencodeddata"}],"title":"3.1.1. Stream creation"}],"url":"#writeencodeddata"},
};

document.addEventListener("DOMContentLoaded", ()=>{
    genAllDfnPanels();

    document.body.addEventListener("click", (e) => {
        // If not handled already, just hide all dfn panels.
        hideAllDfnPanels();
    });
});

window.addEventListener("resize", () => {
    // Pin any visible dfn panel
    queryAll(".dfn-panel.on, .dfn-panel.activated").forEach(el=>positionDfnPanel(el));
});

function genAllDfnPanels() {
    for(const panelData of Object.values(dfnPanelData)) {
        const dfnID = panelData.dfnID;
        const dfn = document.getElementById(dfnID);
        if(!dfn) {
            console.log(`Can't find dfn#${dfnID}.`, panelData);
            continue;
        }
        dfn.panelData = panelData;
        insertDfnPopupAction(dfn);
    }
}

function genDfnPanel(dfn, { dfnID, url, dfnText, refSections, external }) {
    const dfnPanel = mk.aside({
        class: "dfn-panel on",
        id: `infopanel-for-${dfnID}`,
        "data-for": dfnID,
        "aria-labelled-by":`infopaneltitle-for-${dfnID}`,
        },
        mk.span({id:`infopaneltitle-for-${dfnID}`, style:"display:none"},
            `Info about the '${dfnText}' ${external?"external":""} reference.`),
        mk.a({href:url, class:"dfn-link"}, url),
        refSections.length == 0 ? [] :
            mk.b({}, "Referenced in:"),
            mk.ul({},
                ...refSections.map(section=>
                    mk.li({},
                        ...section.refs.map((ref, refI)=>
                            [
                                mk.a({ href: `#${ref.id}` },
                                    (refI == 0) ? section.title : `(${refI + 1})`
                                ),
                                " ",
                            ]
                        ),
                    ),
                ),
            ),
        genLinkingSyntaxes(dfn),
    );

    dfnPanel.addEventListener('click', (event) => {
        if (event.target.nodeName == 'A') {
            scrollToTargetAndHighlight(event);
            pinDfnPanel(dfnPanel);
        }
        event.stopPropagation();
        refocusOnTarget(event);
    });
    dfnPanel.addEventListener('keydown', (event) => {
        if(event.keyCode == 27) { // Escape key
            hideDfnPanel({dfnPanel});
            event.stopPropagation();
            event.preventDefault();
        }
    });

    dfnPanel.dfn = dfn;
    dfn.dfnPanel = dfnPanel;
    return dfnPanel;
}



function hideAllDfnPanels() {
    // Delete the currently-active dfn panel.
    queryAll(".dfn-panel").forEach(dfnPanel=>hideDfnPanel({dfnPanel}));
}

function showDfnPanel(dfn) {
    hideAllDfnPanels(); // Only display one at a time.

    dfn.setAttribute("aria-expanded", "true");

    const dfnPanel = genDfnPanel(dfn, dfn.panelData);

    // Give the dfn a unique tabindex, and then
    // give all the tabbable panel bits successive indexes.
    let tabIndex = 100;
    dfn.tabIndex = tabIndex++;
    const tabbable = dfnPanel.querySelectorAll(":is(a, button)");
    for (const el of tabbable) {
        el.tabIndex = tabIndex++;
    }

    append(document.body, dfnPanel);
    positionDfnPanel(dfnPanel);
}

function positionDfnPanel(dfnPanel) {
    const dfn = dfnPanel.dfn;
    const dfnPos = getBounds(dfn);
    dfnPanel.style.top = dfnPos.bottom + "px";
    dfnPanel.style.left = dfnPos.left + "px";

    const panelPos = dfnPanel.getBoundingClientRect();
    const panelMargin = 8;
    const maxRight = document.body.parentNode.clientWidth - panelMargin;
    if (panelPos.right > maxRight) {
        const overflowAmount = panelPos.right - maxRight;
        const newLeft = Math.max(panelMargin, dfnPos.left - overflowAmount);
        dfnPanel.style.left = newLeft + "px";
    }
}

function pinDfnPanel(dfnPanel) {
    // Switch it to "activated" state, which pins it.
    dfnPanel.classList.add("activated");
    dfnPanel.style.position = "fixed";
    dfnPanel.style.left = null;
    dfnPanel.style.top = null;
}

function hideDfnPanel({dfn, dfnPanel}) {
    if(!dfnPanel) dfnPanel = dfn.dfnPanel;
    if(!dfn) dfn = dfnPanel.dfn;
    dfn.dfnPanel = undefined;
    dfnPanel.dfn = undefined;
    dfn.setAttribute("aria-expanded", "false");
    dfn.tabIndex = undefined;
    dfnPanel.remove()
}

function toggleDfnPanel(dfn) {
    if(dfn.dfnPanel) {
        hideDfnPanel(dfn);
    } else {
        showDfnPanel(dfn);
    }
}

function insertDfnPopupAction(dfn) {
    dfn.setAttribute('role', 'button');
    dfn.setAttribute('aria-expanded', 'false')
    dfn.tabIndex = 0;
    dfn.classList.add('has-dfn-panel');
    dfn.addEventListener('click', (event) => {
        toggleDfnPanel(dfn);
        event.stopPropagation();
    });
    dfn.addEventListener('keypress', (event) => {
        const kc = event.keyCode;
        // 32->Space, 13->Enter
        if(kc == 32 || kc == 13) {
            toggleDfnPanel(dfn);
            event.stopPropagation();
            event.preventDefault();
        }
    });
}

function refocusOnTarget(event) {
    const target = event.target;
    setTimeout(() => {
        // Refocus on the event.target element.
        // This is needed after browser scrolls to the destination.
        target.focus();
    });
}

// TODO: shared util
// Returns the root-level absolute position {left and top} of element.
function getBounds(el, relativeTo=document.body) {
    const relativeRect = relativeTo.getBoundingClientRect();
    const elRect = el.getBoundingClientRect();
    const top = elRect.top - relativeRect.top;
    const left = elRect.left - relativeRect.left;
    return {
        top,
        left,
        bottom: top + elRect.height,
        right: left + elRect.width,
    }
}

function scrollToTargetAndHighlight(event) {
    let hash = event.target.hash;
    if (hash) {
        hash = decodeURIComponent(hash.substring(1));
        const dest = document.getElementById(hash);
        if (dest) {
            dest.classList.add('highlighted');
            setTimeout(() => dest.classList.remove('highlighted'), 1000);
        }
    }
}

// Functions, divided by link type, that wrap an autolink's
// contents with the appropriate outer syntax.
// Alternately, a string naming another type they format
// the same as.
function needsFor(type) {
    switch(type) {
        case "descriptor":
        case "value":
        case "element-attr":
        case "attr-value":
        case "element-state":
        case "method":
        case "constructor":
        case "argument":
        case "attribute":
        case "const":
        case "dict-member":
        case "event":
        case "enum-value":
        case "stringifier":
        case "serializer":
        case "iterator":
        case "maplike":
        case "setlike":
        case "state":
        case "mode":
        case "context":
        case "facet": return true;

        default: return false;
    }
}
function refusesFor(type) {
    switch(type) {
        case "property":
        case "element":
        case "interface":
        case "namespace":
        case "callback":
        case "dictionary":
        case "enum":
        case "exception":
        case "typedef":
        case "http-header":
        case "permission": return true;

        default: return false;
    }
}
function linkFormatterFromType(type) {
    switch(type) {
        case 'scheme':
        case 'permission':
        case 'dfn': return (text) => `[=${text}=]`;

        case 'abstract-op': return (text) => `[\$${text}\$]`;

        case 'function':
        case 'at-rule':
        case 'selector':
        case 'value': return (text) => `''${text}''`;

        case 'http-header': return (text) => `[:${text}:]`;

        case 'interface':
        case 'constructor':
        case 'method':
        case 'argument':
        case 'attribute':
        case 'callback':
        case 'dictionary':
        case 'dict-member':
        case 'enum':
        case 'enum-value':
        case 'exception':
        case 'const':
        case 'typedef':
        case 'stringifier':
        case 'serializer':
        case 'iterator':
        case 'maplike':
        case 'setlike':
        case 'extended-attribute':
        case 'event':
        case 'idl': return (text) => `{{${text}}}`;

        case 'element-state':
        case 'element-attr':
        case 'attr-value':
        case 'element': return (element) => `<{${element}}>`;

        case 'grammar': return (text) => `${text} (within a <pre class=prod>)`;

        case 'type': return (text)=> `<<${text}>>`;

        case 'descriptor':
        case 'property': return (text) => `'${text}'`;

        default: return;
    };
};

function genLinkingSyntaxes(dfn) {
    if(dfn.tagName != "DFN") return;

    const type = dfn.getAttribute('data-dfn-type');
    if(!type) {
        console.log(`<dfn> doesn't have a data-dfn-type:`, dfn);
        return [];
    }

    // Return a function that wraps link text based on the type
    const linkFormatter = linkFormatterFromType(type);
    if(!linkFormatter) {
        console.log(`<dfn> has an unknown data-dfn-type:`, dfn);
        return [];
    }

    let ltAlts;
    if(dfn.hasAttribute('data-lt')) {
        ltAlts = dfn.getAttribute('data-lt')
            .split("|")
            .map(x=>x.trim());
    } else {
        ltAlts = [dfn.textContent.trim()];
    }
    if(type == "type") {
        // lt of "<foo>", but "foo" is the interior;
        // <<foo/bar>> is how you write it with a for,
        // not <foo/<bar>> or whatever.
        for(var i = 0; i < ltAlts.length; i++) {
            const lt = ltAlts[i];
            const match = /<(.*)>/.exec(lt);
            if(match) { ltAlts[i] = match[1]; }
        }
    }

    let forAlts;
    if(dfn.hasAttribute('data-dfn-for')) {
        forAlts = dfn.getAttribute('data-dfn-for')
            .split(",")
            .map(x=>x.trim());
    } else {
        forAlts = [''];
    }

    let linkingSyntaxes = [];
    if(!needsFor(type)) {
        for(const lt of ltAlts) {
            linkingSyntaxes.push(linkFormatter(lt));
        }
    }
    if(!refusesFor(type)) {
        for(const f of forAlts) {
            linkingSyntaxes.push(linkFormatter(`${f}/${ltAlts[0]}`))
        }
    }
    return [
        mk.b({}, 'Possible linking syntaxes:'),
        mk.ul({},
            ...linkingSyntaxes.map(link => {
                const copyLink = async () =>
                    await navigator.clipboard.writeText(link);
                return mk.li({},
                    mk.div({ class: 'link-item' },
                        mk.button({
                            class: 'copy-icon', title: 'Copy',
                            type: 'button',
                            _onclick: copyLink,
                            tabindex: 0,
                        }, mk.span({ class: 'icon' }) ),
                        mk.span({}, link)
                    )
                );
            })
        )
    ];
}
}
</script>
<script>/* Boilerplate: script-ref-hints */
"use strict";
{
let refsData = {
"#chain-transform-algorithm": {"export":true,"for_":[],"level":"","normative":true,"shortname":"webrtc-encoded-transform","spec":"webrtc-encoded-transform","status":"local","text":"chain transform algorithm","type":"dfn","url":"#chain-transform-algorithm"},
"#dictdef-rtcencodedaudioframemetadata": {"export":true,"for_":[],"level":"","normative":true,"shortname":"webrtc-encoded-transform","spec":"webrtc-encoded-transform","status":"local","text":"RTCEncodedAudioFrameMetadata","type":"dictionary","url":"#dictdef-rtcencodedaudioframemetadata"},
"#dictdef-rtcencodedvideoframemetadata": {"export":true,"for_":[],"level":"","normative":true,"shortname":"webrtc-encoded-transform","spec":"webrtc-encoded-transform","status":"local","text":"RTCEncodedVideoFrameMetadata","type":"dictionary","url":"#dictdef-rtcencodedvideoframemetadata"},
"#dictdef-rtcinsertablestreams": {"export":true,"for_":[],"level":"","normative":true,"shortname":"webrtc-encoded-transform","spec":"webrtc-encoded-transform","status":"local","text":"RTCInsertableStreams","type":"dictionary","url":"#dictdef-rtcinsertablestreams"},
"#dictdef-sframetransformoptions": {"export":true,"for_":[],"level":"","normative":true,"shortname":"webrtc-encoded-transform","spec":"webrtc-encoded-transform","status":"local","text":"SFrameTransformOptions","type":"dictionary","url":"#dictdef-sframetransformoptions"},
"#dom-rtcconfiguration-encodedinsertablestreams": {"export":true,"for_":["RTCConfiguration"],"level":"","normative":true,"shortname":"webrtc-encoded-transform","spec":"webrtc-encoded-transform","status":"local","text":"encodedInsertableStreams","type":"dict-member","url":"#dom-rtcconfiguration-encodedinsertablestreams"},
"#dom-rtcencodedaudioframe-data": {"export":true,"for_":["RTCEncodedAudioFrame"],"level":"","normative":true,"shortname":"webrtc-encoded-transform","spec":"webrtc-encoded-transform","status":"local","text":"data","type":"attribute","url":"#dom-rtcencodedaudioframe-data"},
"#dom-rtcencodedvideoframe-data": {"export":true,"for_":["RTCEncodedVideoFrame"],"level":"","normative":true,"shortname":"webrtc-encoded-transform","spec":"webrtc-encoded-transform","status":"local","text":"data","type":"attribute","url":"#dom-rtcencodedvideoframe-data"},
"#dom-rtcencodedvideoframe-timestamp": {"export":true,"for_":["RTCEncodedVideoFrame"],"level":"","normative":true,"shortname":"webrtc-encoded-transform","spec":"webrtc-encoded-transform","status":"local","text":"timestamp","type":"attribute","url":"#dom-rtcencodedvideoframe-timestamp"},
"#dom-rtcinsertablestreams-readable": {"export":true,"for_":["RTCInsertableStreams"],"level":"","normative":true,"shortname":"webrtc-encoded-transform","spec":"webrtc-encoded-transform","status":"local","text":"readable","type":"dict-member","url":"#dom-rtcinsertablestreams-readable"},
"#dom-rtcinsertablestreams-writable": {"export":true,"for_":["RTCInsertableStreams"],"level":"","normative":true,"shortname":"webrtc-encoded-transform","spec":"webrtc-encoded-transform","status":"local","text":"writable","type":"dict-member","url":"#dom-rtcinsertablestreams-writable"},
"#dom-rtcrtpscripttransform-rtcrtpscripttransform": {"export":true,"for_":["RTCRtpScriptTransform"],"level":"","normative":true,"shortname":"webrtc-encoded-transform","spec":"webrtc-encoded-transform","status":"local","text":"RTCRtpScriptTransform(worker, options)","type":"constructor","url":"#dom-rtcrtpscripttransform-rtcrtpscripttransform"},
"#dom-rtcrtpscripttransformer-options": {"export":true,"for_":["RTCRtpScriptTransformer"],"level":"","normative":true,"shortname":"webrtc-encoded-transform","spec":"webrtc-encoded-transform","status":"local","text":"options","type":"attribute","url":"#dom-rtcrtpscripttransformer-options"},
"#dom-rtcrtpscripttransformer-readable": {"export":true,"for_":["RTCRtpScriptTransformer"],"level":"","normative":true,"shortname":"webrtc-encoded-transform","spec":"webrtc-encoded-transform","status":"local","text":"readable","type":"attribute","url":"#dom-rtcrtpscripttransformer-readable"},
"#dom-rtcrtpscripttransformer-writable": {"export":true,"for_":["RTCRtpScriptTransformer"],"level":"","normative":true,"shortname":"webrtc-encoded-transform","spec":"webrtc-encoded-transform","status":"local","text":"writable","type":"attribute","url":"#dom-rtcrtpscripttransformer-writable"},
"#dom-rtcrtpsender-createencodedstreams": {"export":true,"for_":["RTCRtpSender"],"level":"","normative":true,"shortname":"webrtc-encoded-transform","spec":"webrtc-encoded-transform","status":"local","text":"createEncodedStreams()","type":"method","url":"#dom-rtcrtpsender-createencodedstreams"},
"#dom-rtcrtpsender-transform": {"export":true,"for_":["RTCRtpReceiver","RTCRtpSender"],"level":"","normative":true,"shortname":"webrtc-encoded-transform","spec":"webrtc-encoded-transform","status":"local","text":"transform","type":"attribute","url":"#dom-rtcrtpsender-transform"},
"#dom-sframetransform-setencryptionkey": {"export":true,"for_":["SFrameTransform"],"level":"","normative":true,"shortname":"webrtc-encoded-transform","spec":"webrtc-encoded-transform","status":"local","text":"setEncryptionKey(key, keyID)","type":"method","url":"#dom-sframetransform-setencryptionkey"},
"#dom-sframetransform-sframetransform": {"export":true,"for_":["SFrameTransform"],"level":"","normative":true,"shortname":"webrtc-encoded-transform","spec":"webrtc-encoded-transform","status":"local","text":"SFrameTransform(options)","type":"constructor","url":"#dom-sframetransform-sframetransform"},
"#dom-sframetransformoptions-role": {"export":true,"for_":["SFrameTransformOptions"],"level":"","normative":true,"shortname":"webrtc-encoded-transform","spec":"webrtc-encoded-transform","status":"local","text":"role","type":"dict-member","url":"#dom-sframetransformoptions-role"},
"#enumdef-rtcencodedvideoframetype": {"export":true,"for_":[],"level":"","normative":true,"shortname":"webrtc-encoded-transform","spec":"webrtc-encoded-transform","status":"local","text":"RTCEncodedVideoFrameType","type":"enum","url":"#enumdef-rtcencodedvideoframetype"},
"#enumdef-sframetransformrole": {"export":true,"for_":[],"level":"","normative":true,"shortname":"webrtc-encoded-transform","spec":"webrtc-encoded-transform","status":"local","text":"SFrameTransformRole","type":"enum","url":"#enumdef-sframetransformrole"},
"#readencodeddata": {"export":true,"for_":[],"level":"","normative":true,"shortname":"webrtc-encoded-transform","spec":"webrtc-encoded-transform","status":"local","text":"readencodeddata","type":"dfn","url":"#readencodeddata"},
"#rtcencodedaudioframe": {"export":true,"for_":[],"level":"","normative":true,"shortname":"webrtc-encoded-transform","spec":"webrtc-encoded-transform","status":"local","text":"RTCEncodedAudioFrame","type":"interface","url":"#rtcencodedaudioframe"},
"#rtcencodedvideoframe": {"export":true,"for_":[],"level":"","normative":true,"shortname":"webrtc-encoded-transform","spec":"webrtc-encoded-transform","status":"local","text":"RTCEncodedVideoFrame","type":"interface","url":"#rtcencodedvideoframe"},
"#rtcrtpscripttransform": {"export":true,"for_":[],"level":"","normative":true,"shortname":"webrtc-encoded-transform","spec":"webrtc-encoded-transform","status":"local","text":"RTCRtpScriptTransform","type":"interface","url":"#rtcrtpscripttransform"},
"#rtcrtpscripttransformer": {"export":true,"for_":[],"level":"","normative":true,"shortname":"webrtc-encoded-transform","spec":"webrtc-encoded-transform","status":"local","text":"RTCRtpScriptTransformer","type":"interface","url":"#rtcrtpscripttransformer"},
"#rtctransformevent": {"export":true,"for_":[],"level":"","normative":true,"shortname":"webrtc-encoded-transform","spec":"webrtc-encoded-transform","status":"local","text":"RTCTransformEvent","type":"interface","url":"#rtctransformevent"},
"#sframetransform": {"export":true,"for_":[],"level":"","normative":true,"shortname":"webrtc-encoded-transform","spec":"webrtc-encoded-transform","status":"local","text":"SFrameTransform","type":"interface","url":"#sframetransform"},
"#typedefdef-cryptokeyid": {"export":true,"for_":[],"level":"","normative":true,"shortname":"webrtc-encoded-transform","spec":"webrtc-encoded-transform","status":"local","text":"CryptoKeyID","type":"typedef","url":"#typedefdef-cryptokeyid"},
"#typedefdef-rtcrtptransform": {"export":true,"for_":[],"level":"","normative":true,"shortname":"webrtc-encoded-transform","spec":"webrtc-encoded-transform","status":"local","text":"RTCRtpTransform","type":"typedef","url":"#typedefdef-rtcrtptransform"},
"#typedefdef-smallcryptokeyid": {"export":true,"for_":[],"level":"","normative":true,"shortname":"webrtc-encoded-transform","spec":"webrtc-encoded-transform","status":"local","text":"SmallCryptoKeyID","type":"typedef","url":"#typedefdef-smallcryptokeyid"},
"#writeencodeddata": {"export":true,"for_":[],"level":"","normative":true,"shortname":"webrtc-encoded-transform","spec":"webrtc-encoded-transform","status":"local","text":"writeencodeddata","type":"dfn","url":"#writeencodeddata"},
"https://dom.spec.whatwg.org/#abortcontroller": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"dom","spec":"dom","status":"current","text":"AbortController","type":"interface","url":"https://dom.spec.whatwg.org/#abortcontroller"},
"https://dom.spec.whatwg.org/#abortsignal-add": {"export":true,"for_":["AbortSignal"],"level":"1","normative":true,"shortname":"dom","spec":"dom","status":"current","text":"add","type":"dfn","url":"https://dom.spec.whatwg.org/#abortsignal-add"},
"https://dom.spec.whatwg.org/#concept-event-create": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"dom","spec":"dom","status":"current","text":"creating an event","type":"dfn","url":"https://dom.spec.whatwg.org/#concept-event-create"},
"https://dom.spec.whatwg.org/#event": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"dom","spec":"dom","status":"current","text":"Event","type":"interface","url":"https://dom.spec.whatwg.org/#event"},
"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"in parallel","type":"dfn","url":"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel"},
"https://html.spec.whatwg.org/multipage/structured-data.html#structureddeserialize": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"StructuredDeserialize","type":"abstract-op","url":"https://html.spec.whatwg.org/multipage/structured-data.html#structureddeserialize"},
"https://html.spec.whatwg.org/multipage/structured-data.html#structuredserializewithtransfer": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"StructuredSerializeWithTransfer","type":"abstract-op","url":"https://html.spec.whatwg.org/multipage/structured-data.html#structuredserializewithtransfer"},
"https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"EventHandler","type":"typedef","url":"https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler"},
"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"queue a task","type":"dfn","url":"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task"},
"https://html.spec.whatwg.org/multipage/webappapis.html#task-source": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"task source","type":"dfn","url":"https://html.spec.whatwg.org/multipage/webappapis.html#task-source"},
"https://html.spec.whatwg.org/multipage/workers.html#dedicatedworkerglobalscope": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"DedicatedWorkerGlobalScope","type":"interface","url":"https://html.spec.whatwg.org/multipage/workers.html#dedicatedworkerglobalscope"},
"https://html.spec.whatwg.org/multipage/workers.html#worker": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"Worker","type":"interface","url":"https://html.spec.whatwg.org/multipage/workers.html#worker"},
"https://streams.spec.whatwg.org/#generictransformstream": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"streams","spec":"streams","status":"current","text":"GenericTransformStream","type":"interface","url":"https://streams.spec.whatwg.org/#generictransformstream"},
"https://streams.spec.whatwg.org/#identity-transform-stream": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"streams","spec":"streams","status":"current","text":"identity transform stream","type":"dfn","url":"https://streams.spec.whatwg.org/#identity-transform-stream"},
"https://streams.spec.whatwg.org/#readablestream": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"streams","spec":"streams","status":"current","text":"ReadableStream","type":"interface","url":"https://streams.spec.whatwg.org/#readablestream"},
"https://streams.spec.whatwg.org/#readablestream-enqueue": {"export":true,"for_":["ReadableStream"],"level":"1","normative":true,"shortname":"streams","spec":"streams","status":"current","text":"enqueue","type":"dfn","url":"https://streams.spec.whatwg.org/#readablestream-enqueue"},
"https://streams.spec.whatwg.org/#readablestream-get-a-reader": {"export":true,"for_":["ReadableStream"],"level":"1","normative":true,"shortname":"streams","spec":"streams","status":"current","text":"getting a reader","type":"dfn","url":"https://streams.spec.whatwg.org/#readablestream-get-a-reader"},
"https://streams.spec.whatwg.org/#readablestream-set-up": {"export":true,"for_":["ReadableStream"],"level":"1","normative":true,"shortname":"streams","spec":"streams","status":"current","text":"set up","type":"dfn","url":"https://streams.spec.whatwg.org/#readablestream-set-up"},
"https://streams.spec.whatwg.org/#readablestreamdefaultreader-release": {"export":true,"for_":["ReadableStreamDefaultReader"],"level":"1","normative":true,"shortname":"streams","spec":"streams","status":"current","text":"release","type":"dfn","url":"https://streams.spec.whatwg.org/#readablestreamdefaultreader-release"},
"https://streams.spec.whatwg.org/#transformstream": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"streams","spec":"streams","status":"current","text":"TransformStream","type":"interface","url":"https://streams.spec.whatwg.org/#transformstream"},
"https://streams.spec.whatwg.org/#transformstream-set-up-transformalgorithm": {"export":true,"for_":["TransformStream/set up"],"level":"1","normative":true,"shortname":"streams","spec":"streams","status":"current","text":"transformalgorithm","type":"dfn","url":"https://streams.spec.whatwg.org/#transformstream-set-up-transformalgorithm"},
"https://streams.spec.whatwg.org/#writablestream": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"streams","spec":"streams","status":"current","text":"WritableStream","type":"interface","url":"https://streams.spec.whatwg.org/#writablestream"},
"https://streams.spec.whatwg.org/#writablestream-get-a-writer": {"export":true,"for_":["WritableStream"],"level":"1","normative":true,"shortname":"streams","spec":"streams","status":"current","text":"getting a writer","type":"dfn","url":"https://streams.spec.whatwg.org/#writablestream-get-a-writer"},
"https://streams.spec.whatwg.org/#writablestream-set-up": {"export":true,"for_":["WritableStream"],"level":"1","normative":true,"shortname":"streams","spec":"streams","status":"current","text":"set up","type":"dfn","url":"https://streams.spec.whatwg.org/#writablestream-set-up"},
"https://streams.spec.whatwg.org/#writablestream-set-up-writealgorithm": {"export":true,"for_":["WritableStream/set up"],"level":"1","normative":true,"shortname":"streams","spec":"streams","status":"current","text":"writealgorithm","type":"dfn","url":"https://streams.spec.whatwg.org/#writablestream-set-up-writealgorithm"},
"https://streams.spec.whatwg.org/#writablestreamdefaultwriter-release": {"export":true,"for_":["WritableStreamDefaultWriter"],"level":"1","normative":true,"shortname":"streams","spec":"streams","status":"current","text":"release","type":"dfn","url":"https://streams.spec.whatwg.org/#writablestreamdefaultwriter-release"},
"https://w3c.github.io/mediacapture-main/#dom-mediastreamtrack": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"mediacapture-streams","spec":"mediacapture-streams","status":"current","text":"MediaStreamTrack","type":"interface","url":"https://w3c.github.io/mediacapture-main/#dom-mediastreamtrack"},
"https://w3c.github.io/webcrypto/#dfn-CryptoKey": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webcryptoapi","spec":"webcryptoapi","status":"current","text":"CryptoKey","type":"interface","url":"https://w3c.github.io/webcrypto/#dfn-CryptoKey"},
"https://w3c.github.io/webrtc-pc/#dom-rtcconfiguration": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webrtc","spec":"webrtc","status":"current","text":"RTCConfiguration","type":"dictionary","url":"https://w3c.github.io/webrtc-pc/#dom-rtcconfiguration"},
"https://w3c.github.io/webrtc-pc/#dom-rtcpeerconnection": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webrtc","spec":"webrtc","status":"current","text":"RTCPeerConnection","type":"interface","url":"https://w3c.github.io/webrtc-pc/#dom-rtcpeerconnection"},
"https://w3c.github.io/webrtc-pc/#dom-rtcrtpreceiver": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webrtc","spec":"webrtc","status":"current","text":"RTCRtpReceiver","type":"interface","url":"https://w3c.github.io/webrtc-pc/#dom-rtcrtpreceiver"},
"https://w3c.github.io/webrtc-pc/#dom-rtcrtpsender": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webrtc","spec":"webrtc","status":"current","text":"RTCRtpSender","type":"interface","url":"https://w3c.github.io/webrtc-pc/#dom-rtcrtpsender"},
"https://webidl.spec.whatwg.org/#BufferSource": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"BufferSource","type":"typedef","url":"https://webidl.spec.whatwg.org/#BufferSource"},
"https://webidl.spec.whatwg.org/#EnforceRange": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"EnforceRange","type":"extended-attribute","url":"https://webidl.spec.whatwg.org/#EnforceRange"},
"https://webidl.spec.whatwg.org/#Exposed": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"Exposed","type":"extended-attribute","url":"https://webidl.spec.whatwg.org/#Exposed"},
"https://webidl.spec.whatwg.org/#a-new-promise": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"a new promise","type":"dfn","url":"https://webidl.spec.whatwg.org/#a-new-promise"},
"https://webidl.spec.whatwg.org/#a-promise-resolved-with": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"a promise resolved with","type":"dfn","url":"https://webidl.spec.whatwg.org/#a-promise-resolved-with"},
"https://webidl.spec.whatwg.org/#exceptiondef-rangeerror": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"RangeError","type":"exception","url":"https://webidl.spec.whatwg.org/#exceptiondef-rangeerror"},
"https://webidl.spec.whatwg.org/#idl-ArrayBuffer": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"ArrayBuffer","type":"interface","url":"https://webidl.spec.whatwg.org/#idl-ArrayBuffer"},
"https://webidl.spec.whatwg.org/#idl-DOMException": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"DOMException","type":"interface","url":"https://webidl.spec.whatwg.org/#idl-DOMException"},
"https://webidl.spec.whatwg.org/#idl-any": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"any","type":"interface","url":"https://webidl.spec.whatwg.org/#idl-any"},
"https://webidl.spec.whatwg.org/#idl-bigint": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"bigint","type":"interface","url":"https://webidl.spec.whatwg.org/#idl-bigint"},
"https://webidl.spec.whatwg.org/#idl-boolean": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"boolean","type":"interface","url":"https://webidl.spec.whatwg.org/#idl-boolean"},
"https://webidl.spec.whatwg.org/#idl-long": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"long","type":"interface","url":"https://webidl.spec.whatwg.org/#idl-long"},
"https://webidl.spec.whatwg.org/#idl-long-long": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"long long","type":"interface","url":"https://webidl.spec.whatwg.org/#idl-long-long"},
"https://webidl.spec.whatwg.org/#idl-object": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"object","type":"interface","url":"https://webidl.spec.whatwg.org/#idl-object"},
"https://webidl.spec.whatwg.org/#idl-promise": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"Promise","type":"interface","url":"https://webidl.spec.whatwg.org/#idl-promise"},
"https://webidl.spec.whatwg.org/#idl-sequence": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"sequence","type":"dfn","url":"https://webidl.spec.whatwg.org/#idl-sequence"},
"https://webidl.spec.whatwg.org/#idl-undefined": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"undefined","type":"interface","url":"https://webidl.spec.whatwg.org/#idl-undefined"},
"https://webidl.spec.whatwg.org/#idl-unsigned-long-long": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"unsigned long long","type":"interface","url":"https://webidl.spec.whatwg.org/#idl-unsigned-long-long"},
"https://webidl.spec.whatwg.org/#idl-unsigned-short": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"unsigned short","type":"interface","url":"https://webidl.spec.whatwg.org/#idl-unsigned-short"},
"https://webidl.spec.whatwg.org/#invalidaccesserror": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"InvalidAccessError","type":"exception","url":"https://webidl.spec.whatwg.org/#invalidaccesserror"},
"https://webidl.spec.whatwg.org/#invalidmodificationerror": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"InvalidModificationError","type":"exception","url":"https://webidl.spec.whatwg.org/#invalidmodificationerror"},
"https://webidl.spec.whatwg.org/#reject": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"reject","type":"dfn","url":"https://webidl.spec.whatwg.org/#reject"},
"https://webidl.spec.whatwg.org/#resolve": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"resolve","type":"dfn","url":"https://webidl.spec.whatwg.org/#resolve"},
"https://webidl.spec.whatwg.org/#this": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"this","type":"dfn","url":"https://webidl.spec.whatwg.org/#this"},
};

function mkRefHint(link, ref) {
    const linkText = link.textContent;
    let dfnTextElements = '';
    if (ref.text != linkText) {
        dfnTextElements =
            mk.li({},
                mk.b({}, "Term: "),
                mk.span({}, ref.text)
            );
    }
    const forList = ref.for_;
    let forListElements;
    if(forList.length == 0) {
        forListElements = [];
    } else if(forList.length == 1) {
        forListElements = mk.li({},
            mk.b({}, "For: "),
            mk.span({}, forList[0]),
        );
    } else {
        forListElements = mk.li({},
            mk.b({}, "For: "),
            mk.ul({},
                ...forList.map(forItem =>
                    mk.li({},
                        mk.span({}, forItem)
                    ),
                ),
            ),
        );
    }
    const url = ref.url;
    const safeUrl = encodeURIComponent(url);
    const hintPanel = mk.aside({
        class: "ref-hint",
        id: `ref-hint-for-${safeUrl}`,
        "data-for": url,
        "aria-labelled-by": `ref-hint-for-${safeUrl}`,
    },
        mk.ul({},
            dfnTextElements,
            mk.li({},
                mk.b({}, "URL: "),
                mk.a({ href: url, class: "ref" }, url),
            ),
            mk.li({},
                mk.b({}, "Type: "),
                mk.span({}, `${ref.type}`),
            ),
            mk.li({},
                mk.b({}, "Spec: "),
                mk.span({}, `${ref.spec ? ref.spec : ''}`),
            ),
            forListElements
        ),
    );
    hintPanel.forLink = link;
    setupRefHintEventListeners(link, hintPanel);
    return hintPanel;
}

function hideAllRefHints() {
    queryAll(".ref-hint").forEach(el=>hideRefHint(el));
}

function hideRefHint(refHint) {
    const link = refHint.forLink;
    link.setAttribute("aria-expanded", "false");
    if(refHint.teardownEventListeners) {
        refHint.teardownEventListeners();
    }
    refHint.remove();
}

function showRefHint(link) {
    if(link.classList.contains("dfn-link")) return;
    const url = link.getAttribute("href");
    const ref = refsData[url];
    if(!ref) return;

    hideAllRefHints(); // Only display one at this time.

    const refHint = mkRefHint(link, ref);
    append(document.body, refHint);
    link.setAttribute("aria-expanded", "true");
    positionRefHint(refHint);
}

function setupRefHintEventListeners(link, refHint) {
    if (refHint.teardownEventListeners) return;
    // Add event handlers to hide the refHint after the user moves away
    // from both the link and refHint, if not hovering either within one second.
    let timeout = null;
    const startHidingRefHint = (event) => {
        if (timeout) {
            clearTimeout(timeout);
        }
        timeout = setTimeout(() => {
            hideRefHint(refHint);
        }, 1000);
    }
    const resetHidingRefHint = (event) => {
        if (timeout) clearTimeout(timeout);
        timeout = null;
    };
    link.addEventListener("mouseleave", startHidingRefHint);
    link.addEventListener("mouseenter", resetHidingRefHint);
    link.addEventListener("blur", startHidingRefHint);
    link.addEventListener("focus", resetHidingRefHint);
    refHint.addEventListener("mouseleave", startHidingRefHint);
    refHint.addEventListener("mouseenter", resetHidingRefHint);
    refHint.addEventListener("blur", startHidingRefHint);
    refHint.addEventListener("focus", resetHidingRefHint);

    refHint.teardownEventListeners = () => {
        // remove event listeners
        resetHidingRefHint();
        link.removeEventListener("mouseleave", startHidingRefHint);
        link.removeEventListener("mouseenter", resetHidingRefHint);
        link.removeEventListener("blur", startHidingRefHint);
        link.removeEventListener("focus", resetHidingRefHint);
        refHint.removeEventListener("mouseleave", startHidingRefHint);
        refHint.removeEventListener("mouseenter", resetHidingRefHint);
        refHint.removeEventListener("blur", startHidingRefHint);
        refHint.removeEventListener("focus", resetHidingRefHint);
    };
}

function positionRefHint(refHint) {
    const link = refHint.forLink;
    const linkPos = getBounds(link);
    refHint.style.top = linkPos.bottom + "px";
    refHint.style.left = linkPos.left + "px";

    const panelPos = refHint.getBoundingClientRect();
    const panelMargin = 8;
    const maxRight = document.body.parentNode.clientWidth - panelMargin;
    if (panelPos.right > maxRight) {
        const overflowAmount = panelPos.right - maxRight;
        const newLeft = Math.max(panelMargin, linkPos.left - overflowAmount);
        refHint.style.left = newLeft + "px";
    }
}

// TODO: shared util
// Returns the root-level absolute position {left and top} of element.
function getBounds(el, relativeTo=document.body) {
    const relativeRect = relativeTo.getBoundingClientRect();
    const elRect = el.getBoundingClientRect();
    const top = elRect.top - relativeRect.top;
    const left = elRect.left - relativeRect.left;
    return {
        top,
        left,
        bottom: top + elRect.height,
        right: left + elRect.width,
    }
}

function showRefHintListener(e) {
    // If the target isn't in a link (or is a link),
    // just ignore it.
    let link = e.target.closest("a");
    if(!link) return;

    // If the target is in a ref-hint panel
    // (aka a link in the already-open one),
    // also just ignore it.
    if(link.closest(".ref-hint")) return;

    // Otherwise, show the panel for the link.
    showRefHint(link);
}

function hideAllHintsListener(e) {
    // If the click is inside a ref-hint panel, ignore it.
    if(e.target.closest(".ref-hint")) return;
    // Otherwise, close all the current panels.
    hideAllRefHints();
}

document.addEventListener("DOMContentLoaded", () => {
    document.body.addEventListener("mousedown", showRefHintListener);
    document.body.addEventListener("focus", showRefHintListener);

    document.body.addEventListener("click", hideAllHintsListener);
});

window.addEventListener("resize", () => {
    // Hide any open ref hint.
    hideAllRefHints();
});
}
</script>