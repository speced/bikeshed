<!doctype html><html lang="en">
 <head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
  <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
  <title>Payment Method Manifest</title>
  <meta content="ED" name="w3c-status">
  <link href="https://www.w3.org/TR/payment-method-manifest/" rel="canonical">
  <meta content="dark light" name="color-scheme">
<style>/* Boilerplate: style-autolinks */
.css.css, .property.property, .descriptor.descriptor {
    color: var(--a-normal-text);
    font-size: inherit;
    font-family: inherit;
}
.css::before, .property::before, .descriptor::before {
    content: "‘";
}
.css::after, .property::after, .descriptor::after {
    content: "’";
}
.property, .descriptor {
    /* Don't wrap property and descriptor names */
    white-space: nowrap;
}
.type { /* CSS value <type> */
    font-style: italic;
}
pre .property::before, pre .property::after {
    content: "";
}
[data-link-type="property"]::before,
[data-link-type="propdesc"]::before,
[data-link-type="descriptor"]::before,
[data-link-type="value"]::before,
[data-link-type="function"]::before,
[data-link-type="at-rule"]::before,
[data-link-type="selector"]::before,
[data-link-type="maybe"]::before {
    content: "‘";
}
[data-link-type="property"]::after,
[data-link-type="propdesc"]::after,
[data-link-type="descriptor"]::after,
[data-link-type="value"]::after,
[data-link-type="function"]::after,
[data-link-type="at-rule"]::after,
[data-link-type="selector"]::after,
[data-link-type="maybe"]::after {
    content: "’";
}

[data-link-type].production::before,
[data-link-type].production::after,
.prod [data-link-type]::before,
.prod [data-link-type]::after {
    content: "";
}

[data-link-type=element],
[data-link-type=element-attr] {
    font-family: Menlo, Consolas, "DejaVu Sans Mono", monospace;
    font-size: .9em;
}
[data-link-type=element]::before { content: "<" }
[data-link-type=element]::after  { content: ">" }

[data-link-type=biblio] {
    white-space: pre;
}

@media (prefers-color-scheme: dark) {
    :root {
        --selflink-text: black;
        --selflink-bg: silver;
        --selflink-hover-text: white;
    }
}
</style>
<style>/* Boilerplate: style-colors */
/* Any --*-text not paired with a --*-bg is assumed to have a transparent bg */
:root {
    color-scheme: light dark;

    --text: black;
    --bg: white;

    --unofficial-watermark: url(https://www.w3.org/StyleSheets/TR/2016/logos/UD-watermark);

    --logo-bg: #1a5e9a;
    --logo-active-bg: #c00;
    --logo-text: white;

    --tocnav-normal-text: #707070;
    --tocnav-normal-bg: var(--bg);
    --tocnav-hover-text: var(--tocnav-normal-text);
    --tocnav-hover-bg: #f8f8f8;
    --tocnav-active-text: #c00;
    --tocnav-active-bg: var(--tocnav-normal-bg);

    --tocsidebar-text: var(--text);
    --tocsidebar-bg: #f7f8f9;
    --tocsidebar-shadow: rgba(0,0,0,.1);
    --tocsidebar-heading-text: hsla(203,20%,40%,.7);

    --toclink-text: var(--text);
    --toclink-underline: #3980b5;
    --toclink-visited-text: var(--toclink-text);
    --toclink-visited-underline: #054572;

    --heading-text: #005a9c;

    --hr-text: var(--text);

    --algo-border: #def;

    --del-text: red;
    --del-bg: transparent;
    --ins-text: #080;
    --ins-bg: transparent;

    --a-normal-text: #034575;
    --a-normal-underline: #bbb;
    --a-visited-text: var(--a-normal-text);
    --a-visited-underline: #707070;
    --a-hover-bg: rgba(75%, 75%, 75%, .25);
    --a-active-text: #c00;
    --a-active-underline: #c00;

    --blockquote-border: silver;
    --blockquote-bg: transparent;
    --blockquote-text: currentcolor;

    --issue-border: #e05252;
    --issue-bg: #fbe9e9;
    --issue-text: var(--text);
    --issueheading-text: #831616;

    --example-border: #e0cb52;
    --example-bg: #fcfaee;
    --example-text: var(--text);
    --exampleheading-text: #574b0f;

    --note-border: #52e052;
    --note-bg: #e9fbe9;
    --note-text: var(--text);
    --noteheading-text: hsl(120, 70%, 30%);
    --notesummary-underline: silver;

    --assertion-border: #aaa;
    --assertion-bg: #eee;
    --assertion-text: black;

    --advisement-border: orange;
    --advisement-bg: #fec;
    --advisement-text: var(--text);
    --advisementheading-text: #b35f00;

    --warning-border: red;
    --warning-bg: hsla(40,100%,50%,0.95);
    --warning-text: var(--text);

    --amendment-border: #330099;
    --amendment-bg: #F5F0FF;
    --amendment-text: var(--text);
    --amendmentheading-text: #220066;

    --def-border: #8ccbf2;
    --def-bg: #def;
    --def-text: var(--text);
    --defrow-border: #bbd7e9;

    --datacell-border: silver;

    --indexinfo-text: #707070;

    --indextable-hover-text: black;
    --indextable-hover-bg: #f7f8f9;

    --outdatedspec-bg: rgba(0, 0, 0, .5);
    --outdatedspec-text: black;
    --outdated-bg: maroon;
    --outdated-text: white;
    --outdated-shadow: red;

    --editedrec-bg: darkorange;
}

@media (prefers-color-scheme: dark) {
    :root {
        --text: #ddd;
        --bg: black;

        --unofficial-watermark: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='400'%3E%3Cg fill='%23100808' transform='translate(200 200) rotate(-45) translate(-200 -200)' stroke='%23100808' stroke-width='3'%3E%3Ctext x='50%25' y='220' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EUNOFFICIAL%3C/text%3E%3Ctext x='50%25' y='305' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EDRAFT%3C/text%3E%3C/g%3E%3C/svg%3E");

        --logo-bg: #1a5e9a;
        --logo-active-bg: #c00;
        --logo-text: white;

        --tocnav-normal-text: #999;
        --tocnav-normal-bg: var(--bg);
        --tocnav-hover-text: var(--tocnav-normal-text);
        --tocnav-hover-bg: #080808;
        --tocnav-active-text: #f44;
        --tocnav-active-bg: var(--tocnav-normal-bg);

        --tocsidebar-text: var(--text);
        --tocsidebar-bg: #080808;
        --tocsidebar-shadow: rgba(255,255,255,.1);
        --tocsidebar-heading-text: hsla(203,20%,40%,.7);

        --toclink-text: var(--text);
        --toclink-underline: #6af;
        --toclink-visited-text: var(--toclink-text);
        --toclink-visited-underline: #054572;

        --heading-text: #8af;

        --hr-text: var(--text);

        --algo-border: #456;

        --del-text: #f44;
        --del-bg: transparent;
        --ins-text: #4a4;
        --ins-bg: transparent;

        --a-normal-text: #6af;
        --a-normal-underline: #555;
        --a-visited-text: var(--a-normal-text);
        --a-visited-underline: var(--a-normal-underline);
        --a-hover-bg: rgba(25%, 25%, 25%, .2);
        --a-active-text: #f44;
        --a-active-underline: var(--a-active-text);

        --borderedblock-bg: rgba(255, 255, 255, .05);

        --blockquote-border: silver;
        --blockquote-bg: var(--borderedblock-bg);
        --blockquote-text: currentcolor;

        --issue-border: #e05252;
        --issue-bg: var(--borderedblock-bg);
        --issue-text: var(--text);
        --issueheading-text: hsl(0deg, 70%, 70%);

        --example-border: hsl(50deg, 90%, 60%);
        --example-bg: var(--borderedblock-bg);
        --example-text: var(--text);
        --exampleheading-text: hsl(50deg, 70%, 70%);

        --note-border: hsl(120deg, 100%, 35%);
        --note-bg: var(--borderedblock-bg);
        --note-text: var(--text);
        --noteheading-text: hsl(120, 70%, 70%);
        --notesummary-underline: silver;

        --assertion-border: #444;
        --assertion-bg: var(--borderedblock-bg);
        --assertion-text: var(--text);

        --advisement-border: orange;
        --advisement-bg: #222218;
        --advisement-text: var(--text);
        --advisementheading-text: #f84;

        --warning-border: red;
        --warning-bg: hsla(40,100%,20%,0.95);
        --warning-text: var(--text);

        --amendment-border: #330099;
        --amendment-bg: #080010;
        --amendment-text: var(--text);
        --amendmentheading-text: #cc00ff;

        --def-border: #8ccbf2;
        --def-bg: #080818;
        --def-text: var(--text);
        --defrow-border: #136;

        --datacell-border: silver;

        --indexinfo-text: #aaa;

        --indextable-hover-text: var(--text);
        --indextable-hover-bg: #181818;

        --outdatedspec-bg: rgba(255, 255, 255, .5);
        --outdatedspec-text: black;
        --outdated-bg: maroon;
        --outdated-text: white;
        --outdated-shadow: red;

        --editedrec-bg: darkorange;
    }
    /* In case a transparent-bg image doesn't expect to be on a dark bg,
       which is quite common in practice... */
    img { background: white; }
}
</style>
<style>/* Boilerplate: style-counters */
body {
    counter-reset: example figure issue;
}
.issue {
    counter-increment: issue;
}
.issue:not(.no-marker)::before {
    content: "Issue " counter(issue);
}

.example {
    counter-increment: example;
}
.example:not(.no-marker)::before {
    content: "Example " counter(example);
}
.invalid.example:not(.no-marker)::before,
.illegal.example:not(.no-marker)::before {
    content: "Invalid Example" counter(example);
}

figcaption {
    counter-increment: figure;
}
figcaption:not(.no-marker)::before {
    content: "Figure " counter(figure) " ";
}
</style>
<style>/* Boilerplate: style-dfn-panel */
:root {
    --dfnpanel-bg: #ddd;
    --dfnpanel-text: var(--text);
    --dfnpanel-target-bg: #ffc;
    --dfnpanel-target-outline: orange;
}
@media (prefers-color-scheme: dark) {
    :root {
        --dfnpanel-bg: #222;
        --dfnpanel-text: var(--text);
        --dfnpanel-target-bg: #333;
        --dfnpanel-target-outline: silver;
    }
}
.dfn-panel {
    position: absolute;
    z-index: 35;
    width: 20em;
    width: 300px;
    height: auto;
    max-height: 500px;
    overflow: auto;
    padding: 0.5em 0.75em;
    font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
    background: var(--dfnpanel-bg);
    color: var(--dfnpanel-text);
    border: outset 0.2em;
    white-space: normal; /* in case it's moved into a pre */
}
.dfn-panel:not(.on) { display: none; }
.dfn-panel * { margin: 0; padding: 0; text-indent: 0; }
.dfn-panel > b { display: block; }
.dfn-panel a { color: var(--dfnpanel-text); }
.dfn-panel a:not(:hover) { text-decoration: none !important; border-bottom: none !important; }
.dfn-panel a:focus {
    outline: 5px auto Highlight;
    outline: 5px auto -webkit-focus-ring-color;
}
.dfn-panel > b + b { margin-top: 0.25em; }
.dfn-panel ul { padding: 0 0 0 1em; list-style: none; }
.dfn-panel li a {
    max-width: calc(300px - 1.5em - 1em);
    overflow: hidden;
    text-overflow: ellipsis;
}

.dfn-panel.activated {
    display: inline-block;
    position: fixed;
    left: 8px;
    bottom: 2em;
    margin: 0 auto;
    max-width: calc(100vw - 1.5em - .4em - .5em);
    max-height: 30vh;
    transition: left 1s ease-out, bottom 1s ease-out;
}

.dfn-panel .link-item:hover {
    text-decoration: underline;
}
.dfn-panel .link-item .copy-icon {
    opacity: 0;
}
.dfn-panel .link-item:hover .copy-icon,
.dfn-panel .link-item .copy-icon:focus {
    opacity: 1;
}

.dfn-panel .copy-icon {
    display: inline-block;
    margin-right: 0.5em;
    width: 0.85em;
    height: 1em;
    border-radius: 3px;
    background-color: #ccc;
    cursor: pointer;
}

.dfn-panel .copy-icon .icon {
    width: 100%;
    height: 100%;
    background-color: #fff;
    display: flex;
    justify-content: center;
    align-items: center;
    position: relative;
}

.dfn-panel .copy-icon .icon::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    border: 1px solid black;
    background-color: #ccc;
    opacity: 0.25;
    transform: translate(3px, -3px);
}

.dfn-panel .copy-icon:active .icon::before {
    opacity: 1;
}

.dfn-paneled[role="button"] { cursor: help; }

.highlighted {
    animation: target-fade 3s;
}

@keyframes target-fade {
    from {
        background-color: var(--dfnpanel-target-bg);
        outline: 5px solid var(--dfnpanel-target-outline);
    }
    to {
        color: var(--a-normal-text);
        background-color: transparent;
        outline: transparent;
    }
}
</style>
<style>/* Boilerplate: style-issues */
a[href].issue-return {
    float: right;
    float: inline-end;
    color: var(--issueheading-text);
    font-weight: bold;
    text-decoration: none;
}
</style>
<style>/* Boilerplate: style-md-lists */
/* This is a weird hack for me not yet following the commonmark spec
   regarding paragraph and lists. */
[data-md] > :first-child {
    margin-top: 0;
}
[data-md] > :last-child {
    margin-bottom: 0;
}
</style>
<style>/* Boilerplate: style-ref-hints */
:root {
    --ref-hint-bg: #ddd;
    --ref-hint-text: var(--text);
}
@media (prefers-color-scheme: dark) {
    :root {
        --ref-hint-bg: #222;
        --ref-hint-text: var(--text);
    }
}

.ref-hint {
    display: inline-block;
    position: absolute;
    z-index: 35;
    width: 20em;
    width: 300px;
    height: auto;
    max-height: 500px;
    overflow: auto;
    padding: 0.5em 0.5em;
    font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
    background: var(--ref-hint-bg);
    color: var(--ref-hint-text);
    border: outset 0.2em;
    white-space: normal; /* in case it's moved into a pre */
}

.ref-hint * { margin: 0; padding: 0; text-indent: 0; }

.ref-hint ul { padding: 0 0 0 1em; list-style: none; }
</style>
<style>/* Boilerplate: style-selflinks */
:root {
    --selflink-text: white;
    --selflink-bg: gray;
    --selflink-hover-text: black;
}
.heading, .issue, .note, .example, li, dt {
    position: relative;
}
a.self-link {
    position: absolute;
    top: 0;
    left: calc(-1 * (3.5rem - 26px));
    width: calc(3.5rem - 26px);
    height: 2em;
    text-align: center;
    border: none;
    transition: opacity .2s;
    opacity: .5;
}
a.self-link:hover {
    opacity: 1;
}
.heading > a.self-link {
    font-size: 83%;
}
.example > a.self-link,
.note > a.self-link,
.issue > a.self-link {
    /* These blocks are overflow:auto, so positioning outside
       doesn't work. */
    left: auto;
    right: 0;
}
li > a.self-link {
    left: calc(-1 * (3.5rem - 26px) - 2em);
}
dfn > a.self-link {
    top: auto;
    left: auto;
    opacity: 0;
    width: 1.5em;
    height: 1.5em;
    background: var(--selflink-bg);
    color: var(--selflink-text);
    font-style: normal;
    transition: opacity .2s, background-color .2s, color .2s;
}
dfn:hover > a.self-link {
    opacity: 1;
}
dfn > a.self-link:hover {
    color: var(--selflink-hover-text);
}

a.self-link::before            { content: "¶"; }
.heading > a.self-link::before { content: "§"; }
dfn > a.self-link::before      { content: "#"; }
</style>
<style>/* Boilerplate: style-syntax-highlighting */
code.highlight { padding: .1em; border-radius: .3em; }
pre.highlight, pre > code.highlight { display: block; padding: 1em; margin: .5em 0; overflow: auto; border-radius: 0; }

.highlight:not(.idl) { background: rgba(0, 0, 0, .03); }
c-[a] { color: #990055 } /* Keyword.Declaration */
c-[b] { color: #990055 } /* Keyword.Type */
c-[c] { color: #708090 } /* Comment */
c-[d] { color: #708090 } /* Comment.Multiline */
c-[e] { color: #0077aa } /* Name.Attribute */
c-[f] { color: #669900 } /* Name.Tag */
c-[g] { color: #222222 } /* Name.Variable */
c-[k] { color: #990055 } /* Keyword */
c-[l] { color: #000000 } /* Literal */
c-[m] { color: #000000 } /* Literal.Number */
c-[n] { color: #0077aa } /* Name */
c-[o] { color: #999999 } /* Operator */
c-[p] { color: #999999 } /* Punctuation */
c-[s] { color: #a67f59 } /* Literal.String */
c-[t] { color: #a67f59 } /* Literal.String.Single */
c-[u] { color: #a67f59 } /* Literal.String.Double */
c-[cp] { color: #708090 } /* Comment.Preproc */
c-[c1] { color: #708090 } /* Comment.Single */
c-[cs] { color: #708090 } /* Comment.Special */
c-[kc] { color: #990055 } /* Keyword.Constant */
c-[kn] { color: #990055 } /* Keyword.Namespace */
c-[kp] { color: #990055 } /* Keyword.Pseudo */
c-[kr] { color: #990055 } /* Keyword.Reserved */
c-[ld] { color: #000000 } /* Literal.Date */
c-[nc] { color: #0077aa } /* Name.Class */
c-[no] { color: #0077aa } /* Name.Constant */
c-[nd] { color: #0077aa } /* Name.Decorator */
c-[ni] { color: #0077aa } /* Name.Entity */
c-[ne] { color: #0077aa } /* Name.Exception */
c-[nf] { color: #0077aa } /* Name.Function */
c-[nl] { color: #0077aa } /* Name.Label */
c-[nn] { color: #0077aa } /* Name.Namespace */
c-[py] { color: #0077aa } /* Name.Property */
c-[ow] { color: #999999 } /* Operator.Word */
c-[mb] { color: #000000 } /* Literal.Number.Bin */
c-[mf] { color: #000000 } /* Literal.Number.Float */
c-[mh] { color: #000000 } /* Literal.Number.Hex */
c-[mi] { color: #000000 } /* Literal.Number.Integer */
c-[mo] { color: #000000 } /* Literal.Number.Oct */
c-[sb] { color: #a67f59 } /* Literal.String.Backtick */
c-[sc] { color: #a67f59 } /* Literal.String.Char */
c-[sd] { color: #a67f59 } /* Literal.String.Doc */
c-[se] { color: #a67f59 } /* Literal.String.Escape */
c-[sh] { color: #a67f59 } /* Literal.String.Heredoc */
c-[si] { color: #a67f59 } /* Literal.String.Interpol */
c-[sx] { color: #a67f59 } /* Literal.String.Other */
c-[sr] { color: #a67f59 } /* Literal.String.Regex */
c-[ss] { color: #a67f59 } /* Literal.String.Symbol */
c-[vc] { color: #0077aa } /* Name.Variable.Class */
c-[vg] { color: #0077aa } /* Name.Variable.Global */
c-[vi] { color: #0077aa } /* Name.Variable.Instance */
c-[il] { color: #000000 } /* Literal.Number.Integer.Long */

@media (prefers-color-scheme: dark) {
    .highlight:not(.idl) { background: rgba(255, 255, 255, .05); }

    c-[a] { color: #d33682 } /* Keyword.Declaration */
    c-[b] { color: #d33682 } /* Keyword.Type */
    c-[c] { color: #2aa198 } /* Comment */
    c-[d] { color: #2aa198 } /* Comment.Multiline */
    c-[e] { color: #268bd2 } /* Name.Attribute */
    c-[f] { color: #b58900 } /* Name.Tag */
    c-[g] { color: #cb4b16 } /* Name.Variable */
    c-[k] { color: #d33682 } /* Keyword */
    c-[l] { color: #657b83 } /* Literal */
    c-[m] { color: #657b83 } /* Literal.Number */
    c-[n] { color: #268bd2 } /* Name */
    c-[o] { color: #657b83 } /* Operator */
    c-[p] { color: #657b83 } /* Punctuation */
    c-[s] { color: #6c71c4 } /* Literal.String */
    c-[t] { color: #6c71c4 } /* Literal.String.Single */
    c-[u] { color: #6c71c4 } /* Literal.String.Double */
    c-[ch] { color: #2aa198 } /* Comment.Hashbang */
    c-[cp] { color: #2aa198 } /* Comment.Preproc */
    c-[cpf] { color: #2aa198 } /* Comment.PreprocFile */
    c-[c1] { color: #2aa198 } /* Comment.Single */
    c-[cs] { color: #2aa198 } /* Comment.Special */
    c-[kc] { color: #d33682 } /* Keyword.Constant */
    c-[kn] { color: #d33682 } /* Keyword.Namespace */
    c-[kp] { color: #d33682 } /* Keyword.Pseudo */
    c-[kr] { color: #d33682 } /* Keyword.Reserved */
    c-[ld] { color: #657b83 } /* Literal.Date */
    c-[nc] { color: #268bd2 } /* Name.Class */
    c-[no] { color: #268bd2 } /* Name.Constant */
    c-[nd] { color: #268bd2 } /* Name.Decorator */
    c-[ni] { color: #268bd2 } /* Name.Entity */
    c-[ne] { color: #268bd2 } /* Name.Exception */
    c-[nf] { color: #268bd2 } /* Name.Function */
    c-[nl] { color: #268bd2 } /* Name.Label */
    c-[nn] { color: #268bd2 } /* Name.Namespace */
    c-[py] { color: #268bd2 } /* Name.Property */
    c-[ow] { color: #657b83 } /* Operator.Word */
    c-[mb] { color: #657b83 } /* Literal.Number.Bin */
    c-[mf] { color: #657b83 } /* Literal.Number.Float */
    c-[mh] { color: #657b83 } /* Literal.Number.Hex */
    c-[mi] { color: #657b83 } /* Literal.Number.Integer */
    c-[mo] { color: #657b83 } /* Literal.Number.Oct */
    c-[sa] { color: #6c71c4 } /* Literal.String.Affix */
    c-[sb] { color: #6c71c4 } /* Literal.String.Backtick */
    c-[sc] { color: #6c71c4 } /* Literal.String.Char */
    c-[dl] { color: #6c71c4 } /* Literal.String.Delimiter */
    c-[sd] { color: #6c71c4 } /* Literal.String.Doc */
    c-[se] { color: #6c71c4 } /* Literal.String.Escape */
    c-[sh] { color: #6c71c4 } /* Literal.String.Heredoc */
    c-[si] { color: #6c71c4 } /* Literal.String.Interpol */
    c-[sx] { color: #6c71c4 } /* Literal.String.Other */
    c-[sr] { color: #6c71c4 } /* Literal.String.Regex */
    c-[ss] { color: #6c71c4 } /* Literal.String.Symbol */
    c-[fm] { color: #268bd2 } /* Name.Function.Magic */
    c-[vc] { color: #cb4b16 } /* Name.Variable.Class */
    c-[vg] { color: #cb4b16 } /* Name.Variable.Global */
    c-[vi] { color: #cb4b16 } /* Name.Variable.Instance */
    c-[vm] { color: #cb4b16 } /* Name.Variable.Magic */
    c-[il] { color: #657b83 } /* Literal.Number.Integer.Long */
}
</style>
  <link href="https://www.w3.org/StyleSheets/TR/2021/W3C-ED" rel="stylesheet">
  <link href="https://www.w3.org/StyleSheets/TR/2021/dark.css" media="(prefers-color-scheme: dark)" rel="stylesheet" type="text/css">
 <body class="h-entry">
  <div class="head">
   <p data-fill-with="logo"><a class="logo" href="https://www.w3.org/"> <img alt="W3C" height="48" src="https://www.w3.org/StyleSheets/TR/2021/logos/W3C" width="72"> </a> </p>
   <h1 class="p-name no-ref" id="title">Payment Method Manifest</h1>
   <p id="w3c-state"><a href="https://www.w3.org/standards/types#ED">Editor’s Draft</a>, <time class="dt-updated" datetime="1970-01-01">1 January 1970</time></p>
   <details open>
    <summary>More details about this document</summary>
    <div data-fill-with="spec-metadata">
     <dl>
      <dt>This version:
      <dd><a class="u-url" href="https://w3c.github.io/payment-method-manifest/">https://w3c.github.io/payment-method-manifest/</a>
      <dt>Latest published version:
      <dd><a href="https://www.w3.org/TR/payment-method-manifest/">https://www.w3.org/TR/payment-method-manifest/</a>
      <dt class="editor">Editors:
      <dd class="editor p-author h-card vcard"><span class="p-name fn">Dapeng Liu</span> (<span class="p-org org">Alibaba</span>)
      <dd class="editor p-author h-card vcard" data-editor-id="52873"><a class="p-name fn u-url url" href="https://domenic.me/">Domenic Denicola</a> (<a class="p-org org" href="https://www.google.com/">Google</a>) <a class="u-email email" href="mailto:d@domenic.me">d@domenic.me</a>
      <dd class="editor p-author h-card vcard" data-editor-id="76588"><span class="p-name fn">Zach Koch</span> (<a class="p-org org" href="https://www.google.com/">Google</a>)
     </dl>
    </div>
   </details>
   <div data-fill-with="warning"></div>
   <p class="copyright" data-fill-with="copyright"><a href="https://www.w3.org/policies/#copyright">Copyright</a> © 1970 <a href="https://www.w3.org/">World Wide Web Consortium</a>. <abbr title="World Wide Web Consortium">W3C</abbr><sup>®</sup> <a href="https://www.w3.org/policies/#Legal_Disclaimer">liability</a>, <a href="https://www.w3.org/policies/#W3C_Trademarks">trademark</a> and <a href="https://www.w3.org/copyright/software-license/" rel="license" title="W3C Software and Document License">permissive document license</a> rules apply. </p>
   <hr title="Separator for header">
  </div>
  <div class="p-summary" data-fill-with="abstract">
   <h2 class="no-num no-toc no-ref heading settled" id="abstract"><span class="content">Abstract</span></h2>
   <p>This specification defines the machine-readable manifest file, known as a <dfn class="dfn-paneled" data-dfn-type="dfn" data-export id="payment-method-manifest">payment method manifest</dfn>, describing how a <a data-link-type="dfn" href="https://w3c.github.io/payment-request/#dfn-payment-method" id="ref-for-dfn-payment-method">payment method</a> participates in the Web Payments ecosystem, and how such files are to be used.</p>
  </div>
  <h2 class="no-num no-toc no-ref heading settled" id="sotd"><span class="content">Status of this document</span></h2>
  <div data-fill-with="status">
   <p></p>
  </div>
  <div data-fill-with="at-risk"></div>
  <nav data-fill-with="table-of-contents" id="toc">
   <h2 class="no-num no-toc no-ref" id="contents">Table of Contents</h2>
   <ol class="toc" role="directory">
    <li>
     <a href="#introduction"><span class="secno">1</span> <span class="content">Introduction</span></a>
     <ol class="toc">
      <li><a href="#use-cases"><span class="secno">1.1</span> <span class="content">Use cases</span></a>
      <li><a href="#accessing"><span class="secno">1.2</span> <span class="content">Accessing the manifest</span></a>
      <li><a href="#manifest-example"><span class="secno">1.3</span> <span class="content">Example manifest file</span></a>
     </ol>
    <li><a href="#format"><span class="secno">2</span> <span class="content">Manifest format</span></a>
    <li>
     <a href="#processing-model"><span class="secno">3</span> <span class="content">Processing model</span></a>
     <ol class="toc">
      <li><a href="#monkeypatch"><span class="secno">3.1</span> <span class="content">Modifications to <cite>Payment Request API</cite></span></a>
      <li><a href="#ingest"><span class="secno">3.2</span> <span class="content">Ingesting payment method manifests</span></a>
      <li><a href="#fetch-pmm"><span class="secno">3.3</span> <span class="content">Fetching payment method manifests</span></a>
      <li><a href="#validate-and-parse"><span class="secno">3.4</span> <span class="content">Validating and parsing payment method manifests</span></a>
      <li><a href="#fetch-wam"><span class="secno">3.5</span> <span class="content">Fetching web app manifests</span></a>
     </ol>
    <li>
     <a href="#security"><span class="secno">4</span> <span class="content">Security and privacy considerations</span></a>
     <ol class="toc">
      <li><a href="#revealing-to-providers"><span class="secno">4.1</span> <span class="content">Revealing user activity to payment providers</span></a>
      <li><a href="#development-environments"><span class="secno">4.2</span> <span class="content">Considerations for development environments</span></a>
      <li><a href="#matching-payment-apps"><span class="secno">4.3</span> <span class="content">Matching payment apps</span></a>
     </ol>
    <li>
     <a href="#iana"><span class="secno">5</span> <span class="content">IANA considerations</span></a>
     <ol class="toc">
      <li><a href="#payment-method-manifest-link"><span class="secno">5.1</span> <span class="content">The <code>payment-method-manifest</code> link relation</span></a>
     </ol>
    <li><a href="#acknowledgments"><span class="secno"></span> <span class="content">Acknowledgments</span></a>
    <li>
     <a href="#w3c-conformance"><span class="secno"></span> <span class="content">Conformance</span></a>
     <ol class="toc">
      <li><a href="#w3c-conventions"><span class="secno"></span> <span class="content">Document conventions</span></a>
      <li><a href="#w3c-conformant-algorithms"><span class="secno"></span> <span class="content">Conformant Algorithms</span></a>
     </ol>
    <li>
     <a href="#index"><span class="secno"></span> <span class="content">Index</span></a>
     <ol class="toc">
      <li><a href="#index-defined-here"><span class="secno"></span> <span class="content">Terms defined by this specification</span></a>
      <li><a href="#index-defined-elsewhere"><span class="secno"></span> <span class="content">Terms defined by reference</span></a>
     </ol>
    <li>
     <a href="#references"><span class="secno"></span> <span class="content">References</span></a>
     <ol class="toc">
      <li><a href="#normative"><span class="secno"></span> <span class="content">Normative References</span></a>
      <li><a href="#informative"><span class="secno"></span> <span class="content">Informative References</span></a>
     </ol>
   </ol>
  </nav>
  <main>
   <div class="non-normative">
    <h2 class="heading settled" data-level="1" id="introduction"><span class="secno">1. </span><span class="content">Introduction</span><a class="self-link" href="#introduction"></a></h2>
    <p><em>This section and its sub-sections are non-normative.</em></p>
    <h3 class="heading settled" data-level="1.1" id="use-cases"><span class="secno">1.1. </span><span class="content">Use cases</span><a class="self-link" href="#use-cases"></a></h3>
    <p>This specification intends to address the following use cases:</p>
    <ul>
     <li data-md>
      <p>The owner of a <a data-link-type="dfn" href="https://w3c.github.io/payment-request/#dfn-payment-method" id="ref-for-dfn-payment-method①">payment method</a> wishes to authorize only certain parties to distribute <a data-link-type="dfn" href="https://w3c.github.io/payment-request/#dfn-payment-apps" id="ref-for-dfn-payment-apps">payment apps</a> that are capable of implementing the payment method. In this use case, the
browser helps to ensure that for that payment method, the user can only invoke payment apps from
parties authorized by the owner of the payment method.</p>
     <li data-md>
      <p>In addition, the owner of a <a data-link-type="dfn" href="https://w3c.github.io/payment-request/#dfn-payment-method" id="ref-for-dfn-payment-method②">payment method</a> wishes to confirm the authenticity of a
particular payment app (e.g., via a digital signature for that app).</p>
     <li data-md>
      <p>When the user has not yet installed a <a data-link-type="dfn" href="https://w3c.github.io/payment-request/#dfn-payment-apps" id="ref-for-dfn-payment-apps①">payment app</a> for a <a data-link-type="dfn" href="https://w3c.github.io/payment-request/#dfn-payment-method" id="ref-for-dfn-payment-method③">payment method</a>, the user agent
can provide an improved user experience for procuring one.</p>
    </ul>
    <p>This is accomplished via the requirement that every <a data-link-type="dfn" href="https://w3c.github.io/payment-request/#dfn-payment-method" id="ref-for-dfn-payment-method④">payment method</a> whose <a data-link-type="dfn" href="https://w3c.github.io/payment-method-id/#dfn-payment-method-identifiers" id="ref-for-dfn-payment-method-identifiers">identifier</a> is <a data-link-type="dfn" href="https://w3c.github.io/payment-method-id/#dfn-url-based-payment-method-identifiers" id="ref-for-dfn-url-based-payment-method-identifiers">URL-based</a> will
provide a <a data-link-type="dfn" href="#payment-method-manifest" id="ref-for-payment-method-manifest">payment method manifest</a> file in JSON format containing two key pieces of information:</p>
    <ul>
     <li data-md>
      <p>any default <a data-link-type="dfn" href="https://w3c.github.io/payment-request/#dfn-payment-apps" id="ref-for-dfn-payment-apps②">payment apps</a> that are associated with this <a data-link-type="dfn" href="https://w3c.github.io/payment-request/#dfn-payment-method" id="ref-for-dfn-payment-method⑤">payment method</a>, referenced as <a data-link-type="dfn" href="https://url.spec.whatwg.org/#absolute-url-string" id="ref-for-absolute-url-string">absolute-URL strings</a> giving the <a data-link-type="dfn" href="https://www.w3.org/TR/appmanifest/#dfn-manifest-url" id="ref-for-dfn-manifest-url">URL</a> of their <a data-link-type="dfn" href="https://www.w3.org/TR/appmanifest/#dfn-manifest" id="ref-for-dfn-manifest">web app manifests</a>; and</p>
     <li data-md>
      <p>any other <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin" id="ref-for-concept-origin">origins</a> that are permitted to return payment credentials for this <a data-link-type="dfn" href="https://w3c.github.io/payment-request/#dfn-payment-method" id="ref-for-dfn-payment-method⑥">payment method</a>.</p>
    </ul>
    <h3 class="heading settled" data-level="1.2" id="accessing"><span class="secno">1.2. </span><span class="content">Accessing the manifest</span><a class="self-link" href="#accessing"></a></h3>
    <p>The machine-readable <a data-link-type="dfn" href="#payment-method-manifest" id="ref-for-payment-method-manifest①">payment method manifest</a> might be found either directly at the <a data-link-type="dfn" href="https://w3c.github.io/payment-method-id/#dfn-payment-method-identifiers" id="ref-for-dfn-payment-method-identifiers①">payment method identifier</a> URL, or in a location indicated indirectly by following a HTTP
`<code>Link</code>` header from that URL. <a data-link-type="biblio" href="#biblio-rfc8288" title="Web Linking">[RFC8288]</a></p>
    <p>This potential indirection allows the use of generic, human-readable URLs (such as
"<code>https://alicepay.com/</code>") to serve as <a data-link-type="dfn" href="https://w3c.github.io/payment-method-id/#dfn-payment-method-identifiers" id="ref-for-dfn-payment-method-identifiers②">payment method identifiers</a>, while still
locating the actual <a data-link-type="dfn" href="#payment-method-manifest" id="ref-for-payment-method-manifest②">payment method manifest</a> at a different URL.</p>
    <p>For an example <a data-link-type="dfn" href="https://w3c.github.io/payment-request/#dfn-payment-method" id="ref-for-dfn-payment-method⑦">payment method</a> AlicePay, with <a data-link-type="dfn" href="https://w3c.github.io/payment-method-id/#dfn-payment-method-identifiers" id="ref-for-dfn-payment-method-identifiers③">payment method identifier</a> "<code>https://alicepay.com/</code>", a user agent would issue a GET request to that <a data-link-type="dfn" href="https://w3c.github.io/payment-method-id/#dfn-payment-method-identifiers" id="ref-for-dfn-payment-method-identifiers④">payment method identifier</a> URL as follows:</p>
<pre>GET / HTTP/2
Host: alicepay.com
User-Agent: Mellblomenator/9000
</pre>
    <p>The server could then either respond with</p>
<pre>HTTP/2 204
Link: &lt;/pay/payment-manifest.json>; rel="payment-method-manifest"
</pre>
    <p>to redirect the user agent to "<code>https://alicepay.com/pay/payment-manifest.json</code>", or
could respond with the JSON contents of the payment method manifest directly in a <code>200</code>-status response.</p>
    <h3 class="heading settled" data-level="1.3" id="manifest-example"><span class="secno">1.3. </span><span class="content">Example manifest file</span><a class="self-link" href="#manifest-example"></a></h3>
    <p>Continuing our example from <a href="#accessing">§ 1.2 Accessing the manifest</a>, the AlicePay <a data-link-type="dfn" href="https://w3c.github.io/payment-request/#dfn-payment-method" id="ref-for-dfn-payment-method⑧">payment method</a> could provide the
following <a data-link-type="dfn" href="#payment-method-manifest" id="ref-for-payment-method-manifest③">payment method manifest</a> file at <code>https://alicepay.com/pay/payment-manifest.json</code>:</p>
<pre class="highlight"><c- p>{</c->
  <c- f>"default_applications"</c-><c- p>:</c-> <c- p>[</c-><c- u>"app/webappmanifest.json"</c-><c- p>],</c->
  <c- f>"supported_origins"</c-><c- p>:</c-> <c- p>[</c->
    <c- u>"https://bobpay.xyz"</c-><c- p>,</c->
    <c- u>"https://alicepay.friendsofalice.example"</c->
  <c- p>]</c->
<c- p>}</c->
</pre>
    <p>This indicates that, if the user agent does not have a <a data-link-type="dfn" href="https://w3c.github.io/payment-request/#dfn-payment-apps" id="ref-for-dfn-payment-apps③">payment app</a> for AlicePay installed, it
can locate one by consulting the <a data-link-type="dfn" href="https://www.w3.org/TR/appmanifest/#dfn-manifest" id="ref-for-dfn-manifest①">web app manifest</a> at
"<code>https://alicepay.com/pay/app/webappmanifest.json</code>".</p>
    <p>It also indicates that, apart from this default payment app, AlicePay also allows <a data-link-type="dfn" href="https://w3c.github.io/payment-request/#dfn-payment-apps" id="ref-for-dfn-payment-apps④">payment apps</a> hosted at the two indicated <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin" id="ref-for-concept-origin①">origins</a> to be used for AlicePay. This means that if the user agent
ever encounters payment apps hosted at those origins claiming support for AlicePay, it can allow
them to act as payment apps for the AlicePay <a data-link-type="dfn" href="https://w3c.github.io/payment-request/#dfn-payment-method" id="ref-for-dfn-payment-method⑨">payment method</a>.</p>
    <p>The manifest file could also omit the "<code>supported_origins</code>" key, if no third-party <a data-link-type="dfn" href="https://w3c.github.io/payment-request/#dfn-payment-apps" id="ref-for-dfn-payment-apps⑤">payment apps</a> are supported for the <a data-link-type="dfn" href="https://w3c.github.io/payment-request/#dfn-payment-method" id="ref-for-dfn-payment-method①⓪">payment method</a> in question.</p>
   </div>
   <h2 class="heading settled" data-level="2" id="format"><span class="secno">2. </span><span class="content">Manifest format</span><a class="self-link" href="#format"></a></h2>
   <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-export data-local-lt="valid|validity" id="valid-payment-method-manifest">valid payment method manifest</dfn> file is a <a data-link-type="dfn" href="https://encoding.spec.whatwg.org/#utf-8" id="ref-for-utf-8">UTF-8</a> encoded file containing contents parseable as a JSON object. The resulting JSON object must contain
at most two items, with the possible keys "<code>default_applications</code>" and
"<code>supported_origins</code>".</p>
   <p>The value of the <code>default_applications</code> key, if present, must be a non-empty JSON array.
Each item in the array must be a <a data-link-type="dfn" href="https://url.spec.whatwg.org/#valid-url-string" id="ref-for-valid-url-string">valid URL string</a> such that the resulting <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url" id="ref-for-concept-url">URL</a>'s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-scheme" id="ref-for-concept-url-scheme">scheme</a>, when parsed against the URL of the payment method manifest, is "<code>https</code>".</p>
   <p>The value of the <code>supported_origins</code> key, if present, must be a non-empty JSON array.
Each item in the array must be an <a data-link-type="dfn" href="https://url.spec.whatwg.org/#absolute-url-string" id="ref-for-absolute-url-string①">absolute-URL string</a> that represents an HTTPS <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin" id="ref-for-concept-origin②">origin</a>. Formally, the string must be equal to
the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#ascii-serialisation-of-an-origin" id="ref-for-ascii-serialisation-of-an-origin">serialization</a> of the resulting parsed <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url" id="ref-for-concept-url①">URL</a>'s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-origin" id="ref-for-concept-url-origin">origin</a>.</p>
   <p>Web developers must ensure that all of their <a data-link-type="dfn" href="#payment-method-manifest" id="ref-for-payment-method-manifest④">payment method manifests</a> are <a data-link-type="dfn" href="#valid-payment-method-manifest" id="ref-for-valid-payment-method-manifest">valid</a>.</p>
   <p class="note" role="note">As with all conformance requirements on the contents of files, these are
web-developer facing, and not implementer-facing. The exact processing model (given in <a href="#processing-model">§ 3 Processing model</a>) governs how implementers process all <a data-link-type="dfn" href="#payment-method-manifest" id="ref-for-payment-method-manifest⑤">payment method manifest</a> files,
including invalid ones.</p>
   <div class="example" id="example-invalid-manifest">
    <a class="self-link" href="#example-invalid-manifest"></a> The following <a data-link-type="dfn" href="#payment-method-manifest" id="ref-for-payment-method-manifest⑥">payment method manifest</a> is not <a data-link-type="dfn" href="#valid-payment-method-manifest" id="ref-for-valid-payment-method-manifest①">valid</a>, but the currently-specified processing
  model algorithms will still accept it: 
<pre class="highlight"><c- p>{</c->
  <c- f>"default_applications"</c-><c- p>:</c-> <c- p>[</c-><c- u>"app/webappmanifest.json"</c-><c- p>],</c->
  <c- f>"created_by"</c-><c- p>:</c-> <c- u>"Alice"</c-><c- p>,</c->
  <c- f>"created_in"</c-><c- p>:</c-> <c- u>"Wonderland"</c->
<c- p>}</c->
</pre>
    <p>This could change in the future, for example if the processing model later expands to define a
  meaning for a new standard "<code>created_by</code>" key that requires it to be an object instead
  of a string. To avoid situations like this, web developers are best served by ensuring <a data-link-type="dfn" href="#valid-payment-method-manifest" id="ref-for-valid-payment-method-manifest②">validity</a> of their <a data-link-type="dfn" href="#payment-method-manifest" id="ref-for-payment-method-manifest⑦">payment method manifests</a>, and thus avoiding any unpleasant surprises.</p>
   </div>
   <h2 class="heading settled" data-level="3" id="processing-model"><span class="secno">3. </span><span class="content">Processing model</span><a class="self-link" href="#processing-model"></a></h2>
   <h3 class="heading settled" data-level="3.1" id="monkeypatch"><span class="secno">3.1. </span><span class="content">Modifications to <cite>Payment Request API</cite></span><a class="self-link" href="#monkeypatch"></a></h3>
   <p>This specification integrates with the rest of the Payment Request ecosystem by modifying the <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/payment-request/#dfn-paymentrequest-paymentrequest" id="ref-for-dfn-paymentrequest-paymentrequest">PaymentRequest(methodData, details, options)</a></code> constructor. It adds the following
steps, before the algorithm completes and returns the newly-constructed <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/payment-request/#dom-paymentrequest" id="ref-for-dom-paymentrequest">PaymentRequest</a></code> object.
In what follows, let <var>request</var> be the <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/payment-request/#dom-paymentrequest" id="ref-for-dom-paymentrequest①">PaymentRequest</a></code> instance being constructed. <a data-link-type="biblio" href="#biblio-payment-request" title="Payment Request API">[PAYMENT-REQUEST]</a></p>
   <ol>
    <li data-md>
     <p>Let <var>identifiers</var> be a list consisting of the first <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#struct-item" id="ref-for-struct-item">item</a> of each pair in <var>request</var>.<a data-link-type="dfn" href="https://w3c.github.io/payment-request/#dfn-serializedmethoddata" id="ref-for-dfn-serializedmethoddata">[[serializedMethodData]]</a>.</p>
    <li data-md>
     <p>Let <var>client</var> be the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#current-settings-object" id="ref-for-current-settings-object">current settings object</a>.</p>
    <li data-md>
     <p><a data-link-type="dfn" href="#ingest-payment-method-manifests" id="ref-for-ingest-payment-method-manifests">Ingest payment method manifests</a> given <var>identifiers</var> and <var>client</var>.</p>
   </ol>
   <p>These steps are what kicks off the whole process. The rest of <a href="#processing-model">§ 3 Processing model</a> is concerned
with defining how this process eventually leads to new <a data-link-type="dfn" href="https://w3c.github.io/payment-request/#dfn-payment-apps" id="ref-for-dfn-payment-apps⑥">payment apps</a> being available for the
user.</p>
   <p class="issue" id="issue-0f30c96f"><a class="self-link" href="#issue-0f30c96f"></a> As this specification gains multi-implementer interest, we anticipate moving this section
into the <cite>Payment Request API</cite> specification itself, instead of maintaining a monkeypatch
here.</p>
   <h3 class="heading settled" data-level="3.2" id="ingest"><span class="secno">3.2. </span><span class="content">Ingesting payment method manifests</span><a class="self-link" href="#ingest"></a></h3>
   <p>Given a list of <a data-link-type="dfn" href="https://w3c.github.io/payment-method-id/#dfn-payment-method-identifiers" id="ref-for-dfn-payment-method-identifiers⑤">payment method identifiers</a> <var>identifiers</var>, as well as an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object" id="ref-for-environment-settings-object">environment settings object</a> <var>client</var>, the user agent may run the following steps, to <dfn class="dfn-paneled" data-dfn-type="dfn" data-export id="ingest-payment-method-manifests">ingest payment method manifests</dfn>:</p>
   <ol>
    <li data-md>
     <p><a data-link-type="dfn" href="#fetch-payment-method-manifests" id="ref-for-fetch-payment-method-manifests">Fetch payment method manifests</a>, given <var>identifiers</var> and <var>client</var>, and wait for this to
 asynchronously complete with <var>manifestsMap</var>. If the result is failure, return.</p>
    <li data-md>
     <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-iterate" id="ref-for-list-iterate">For each</a> <var>identifierURL</var> → (<var>responseURL</var>, <var>manifest</var>) of <var>manifestsMap</var>:</p>
     <ol>
      <li data-md>
       <p>Let <var>parsed</var> be the result of <a data-link-type="dfn" href="#validate-and-parse-the-payment-method-manifest" id="ref-for-validate-and-parse-the-payment-method-manifest">validating and parsing</a> <var>manifest</var> given <var>responseURL</var>. If this returns failure, <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue" id="ref-for-iteration-continue">continue</a>.</p>
      <li data-md>
       <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-iterate" id="ref-for-list-iterate①">For each</a> <var>webAppManifestURL</var> in <var>parsed</var>’s <a data-link-type="dfn" href="#parsed-payment-method-manifest-default-applications" id="ref-for-parsed-payment-method-manifest-default-applications">default
 applications</a>:</p>
       <ol>
        <li data-md>
         <p><a data-link-type="dfn" href="#fetch-the-web-app-manifest-for-a-default-payment-app" id="ref-for-fetch-the-web-app-manifest-for-a-default-payment-app">Fetch the web app manifest</a> at <var>webAppManifestURL</var> given <var>identifierURL</var> and <var>client</var>, and wait for it to asynchronously
 complete with <var>webAppManifestString</var>. If the result is failure, <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue" id="ref-for-iteration-continue①">continue</a>.</p>
        <li data-md>
         <p>Let <var>webAppManifest</var> be the result of running the <a data-link-type="dfn" href="https://www.w3.org/TR/appmanifest/#dfn-processing-a-manifest" id="ref-for-dfn-processing-a-manifest">steps for processing a web app manifest</a> given <var>webAppManifestString</var>.</p>
         <p class="note" role="note">The <a data-link-type="dfn" href="https://www.w3.org/TR/appmanifest/#dfn-processing-a-manifest" id="ref-for-dfn-processing-a-manifest①">steps for processing a web app manifest</a> are very forgiving and will
 return empty objects or objects missing crucial fields instead of failing. User agents will
 need to separately validate the <a data-link-type="dfn" href="https://www.w3.org/TR/appmanifest/#dfn-processed-manifest" id="ref-for-dfn-processed-manifest">processed web app manifest</a> to ensure it contains enough
 data for their purposes in the next step.</p>
        <li data-md>
         <p>In a user-agent-specific way, use the resulting <a data-link-type="dfn" href="https://www.w3.org/TR/appmanifest/#dfn-processed-manifest" id="ref-for-dfn-processed-manifest①">processed web app manifest</a> <var>webAppManifest</var> to install any applicable <a data-link-type="dfn" href="https://w3c.github.io/payment-request/#dfn-payment-apps" id="ref-for-dfn-payment-apps⑦">payment apps</a> for the <a data-link-type="dfn" href="https://w3c.github.io/payment-request/#dfn-payment-method" id="ref-for-dfn-payment-method①①">payment method</a> identified by <var>identifier</var>.</p>
         <p class="note" role="note">In the future, the plan is for there to be a user-agent-independent way to
 use the resulting <a data-link-type="dfn" href="https://www.w3.org/TR/appmanifest/#dfn-processed-manifest" id="ref-for-dfn-processed-manifest②">processed web app manifest</a>, by consulting its <code>serviceworker</code> field and using that to install a web-based <a data-link-type="dfn" href="https://w3c.github.io/payment-request/#dfn-payment-apps" id="ref-for-dfn-payment-apps⑧">payment app</a> conforming to the <cite>Payment Handler API</cite> specification. <a data-link-type="biblio" href="#biblio-payment-handler" title="Payment Handler API">[PAYMENT-HANDLER]</a></p>
       </ol>
      <li data-md>
       <p>Associate the <a data-link-type="dfn" href="#parsed-payment-method-manifest-supported-origins" id="ref-for-parsed-payment-method-manifest-supported-origins">supported origins</a> to <var>identifier</var> so that the
 user agent can use it in the future to determine what third-party <a data-link-type="dfn" href="https://w3c.github.io/payment-request/#dfn-payment-apps" id="ref-for-dfn-payment-apps⑨">payment apps</a> can be
 displayed for the <a data-link-type="dfn" href="https://w3c.github.io/payment-request/#dfn-payment-method" id="ref-for-dfn-payment-method①②">payment method</a> identified by <var>identifier</var>.</p>
     </ol>
   </ol>
   <h3 class="heading settled" data-level="3.3" id="fetch-pmm"><span class="secno">3.3. </span><span class="content">Fetching payment method manifests</span><a class="self-link" href="#fetch-pmm"></a></h3>
   <p>To <dfn class="dfn-paneled" data-dfn-type="dfn" data-export id="fetch-payment-method-manifests">fetch payment method manifests</dfn>, given a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list">list</a> of <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#string" id="ref-for-string">JavaScript strings</a> <var>supportedMethods</var> and an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object" id="ref-for-environment-settings-object①">environment settings object</a> <var>client</var>, perform the following steps.
This algorithm will asynchronously complete with a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map" id="ref-for-ordered-map">map</a> (possibly empty) from <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url" id="ref-for-concept-url②">URLs</a> to
(<a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url" id="ref-for-concept-url③">URL</a>, <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte-sequence" id="ref-for-byte-sequence">byte sequence</a>) <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#tuple" id="ref-for-tuple">tuples</a>, mapping <a data-link-type="dfn" href="https://w3c.github.io/payment-method-id/#dfn-payment-method-identifiers" id="ref-for-dfn-payment-method-identifiers⑥">payment method identifiers</a> to the <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url" id="ref-for-concept-url④">URL</a> and
contents of the corresponding manifest.</p>
   <ol>
    <li data-md>
     <p>Let <var>identifierURLs</var> be an empty <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list①">list</a>.</p>
    <li data-md>
     <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-iterate" id="ref-for-list-iterate②">For each</a> <var>string</var> of <var>supportedMethods</var>:</p>
     <ol>
      <li data-md>
       <p>Let <var>identifierURL</var> be the result of <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-basic-url-parser" id="ref-for-concept-basic-url-parser">basic URL parsing</a> <var>string</var>. If the
 result is failure, <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue" id="ref-for-iteration-continue②">continue</a>.</p>
       <p class="note" role="note">The result will be failure for any <a data-link-type="dfn" href="https://w3c.github.io/payment-method-id/#dfn-payment-method-identifiers" id="ref-for-dfn-payment-method-identifiers⑦">payment method identifier</a> that is not a <a data-link-type="dfn" href="https://w3c.github.io/payment-method-id/#dfn-url-based-payment-method-identifiers" id="ref-for-dfn-url-based-payment-method-identifiers①">URL-based payment method identifier</a>, i.e. for a <a data-link-type="dfn" href="https://w3c.github.io/payment-method-id/#dfn-standardized-payment-method-identifiers" id="ref-for-dfn-standardized-payment-method-identifiers">standardized payment method identifier</a>.</p>
      <li data-md>
       <p>If <a data-link-type="dfn" href="https://w3c.github.io/payment-method-id/#dfn-validate-a-url-based-payment-method-identifier" id="ref-for-dfn-validate-a-url-based-payment-method-identifier">validating</a> <var>identifierURL</var> returns false, <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue" id="ref-for-iteration-continue③">continue</a>.</p>
      <li data-md>
       <p>Optionally, <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue" id="ref-for-iteration-continue④">continue</a>.</p>
       <p class="note" role="note">This step allows implementations to skip any of the provided <a data-link-type="dfn" href="https://w3c.github.io/payment-method-id/#dfn-payment-method-identifiers" id="ref-for-dfn-payment-method-identifiers⑧">payment method
 identifiers</a> for user-agent-specific reasons. <a href="#security">§ 4 Security and privacy considerations</a> discusses some reasons why user
 agents might prefer to only ingest certain identifiers.</p>
      <li data-md>
       <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-append" id="ref-for-list-append">Append</a> <var>identifierURL</var> to <var>identifierURLs</var>.</p>
     </ol>
    <li data-md>
     <p>Let <var>manifestsMap</var> be an empty <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map" id="ref-for-ordered-map①">map</a>.</p>
    <li data-md>
     <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-iterate" id="ref-for-list-iterate③">For each</a> <var>identifierURL</var> of <var>identifierURLs</var>:</p>
     <ol>
      <li data-md>
       <p>Let <var>manifestURLString</var> be null.</p>
      <li data-md>
       <p>Let <var>identifierRequest</var> be a new <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request" id="ref-for-concept-request">request</a> whose <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-method" id="ref-for-concept-request-method">method</a> is `<code>GET</code>`, <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-url" id="ref-for-concept-request-url">url</a> is <var>identifierURL</var>, <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-client" id="ref-for-concept-request-client">client</a> is <var>client</var>, <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-mode" id="ref-for-concept-request-mode">mode</a> is
 "<code>cors</code>", <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-credentials-mode" id="ref-for-concept-request-credentials-mode">credentials mode</a> is "<code>omit</code>", <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-redirect-mode" id="ref-for-concept-request-redirect-mode">redirect mode</a> is "<code>error</code>", and <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-referrer-policy" id="ref-for-concept-request-referrer-policy">referrer policy</a> is
 "<code>strict-origin-when-cross-origin</code>".</p>
      <li data-md>
       <p><a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-fetch" id="ref-for-concept-fetch">Fetch</a> <var>identifierRequest</var>.</p>
       <p>To <a data-link-type="dfn">process response</a> with the <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response" id="ref-for-concept-response">response</a> <var>identifierResponse</var>:</p>
       <ol>
        <li data-md>
         <p>If <var>identifierResponse</var> is a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-network-error" id="ref-for-concept-network-error">network error</a> or <var>identifierResponse</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-status" id="ref-for-concept-response-status">status</a> is not an <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#ok-status" id="ref-for-ok-status">ok status</a>, <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue" id="ref-for-iteration-continue⑤">continue</a>.</p>
        <li data-md>
         <p>Let <var>linkHeaders</var> be the result of <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#extract-header-list-values" id="ref-for-extract-header-list-values">extracting header list values</a> given `<code>Link</code>` and <var>identifierResponse</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-header-list" id="ref-for-concept-response-header-list">header list</a>.</p>
        <li data-md>
         <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-iterate" id="ref-for-list-iterate④">For each</a> <var>linkHeader</var> of <var>linkHeaders</var>:</p>
         <ol>
          <li data-md>
           <p>Parse <var>linkHeader</var> according to the <code>link-value</code> production. If it cannot be
 parsed, <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue" id="ref-for-iteration-continue⑥">continue</a>. <a data-link-type="biblio" href="#biblio-rfc8288" title="Web Linking">[RFC8288]</a></p>
          <li data-md>
           <p>If the parsed header contains a parameter whose name is an <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ascii-case-insensitive" id="ref-for-ascii-case-insensitive">ASCII case-insensitive</a> match
 for the string "<code>rel</code>" and whose value is an <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ascii-case-insensitive" id="ref-for-ascii-case-insensitive①">ASCII case-insensitive</a> match
 for the string "<code>payment-method-manifest</code>", then set <var>manifestURLString</var> to the
 string given by the <code>URI-Reference</code> production in the parsed header, and <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-break" id="ref-for-iteration-break">break</a>.</p>
         </ol>
        <li data-md>
         <p>If <var>manifestURLString</var> is not null, then:</p>
         <ol>
          <li data-md>
           <p><a data-link-type="dfn">Terminate</a> the ongoing fetch of <var>identifierRequest</var> (since the <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-body" id="ref-for-concept-response-body">body</a> will not be needed).</p>
          <li data-md>
           <p>Let <var>manifestURL</var> be the result of <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-basic-url-parser" id="ref-for-concept-basic-url-parser①">basic URL parsing</a> <var>manifestURLString</var> with base URL given by <var>identifierResponse</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-url" id="ref-for-concept-response-url">url</a>. If the
 result is failure, <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue" id="ref-for-iteration-continue⑦">continue</a>.</p>
          <li data-md>
           <p>If <var>manifestURL</var>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-scheme" id="ref-for-concept-url-scheme①">scheme</a> is not "<code>https</code>", <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue" id="ref-for-iteration-continue⑧">continue</a>.</p>
          <li data-md>
           <p>Let <var>manifestRequest</var> be a new <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request" id="ref-for-concept-request①">request</a> whose <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-url" id="ref-for-concept-request-url①">url</a> is <var>manifestURL</var>, <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-client" id="ref-for-concept-request-client①">client</a> is <var>client</var>, <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-referrer" id="ref-for-concept-request-referrer">referrer</a> is <var>identifierResponse</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-url" id="ref-for-concept-response-url①">url</a>, <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-mode" id="ref-for-concept-request-mode①">mode</a> is "<code>cors</code>", <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-credentials-mode" id="ref-for-concept-request-credentials-mode①">credentials mode</a> is
 "<code>omit</code>", and <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-redirect-mode" id="ref-for-concept-request-redirect-mode①">redirect mode</a> is "<code>error</code>".</p>
          <li data-md>
           <p><a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-fetch" id="ref-for-concept-fetch①">Fetch</a> <var>manifestRequest</var>. To <a data-link-type="dfn">process response end-of-body</a> with the <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response" id="ref-for-concept-response①">response</a> <var>manifestResponse</var>:</p>
           <ol>
            <li data-md>
             <p>If <var>manifestResponse</var> is a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-network-error" id="ref-for-concept-network-error①">network error</a> or <var>manifestResponse</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-status" id="ref-for-concept-response-status①">status</a> is not an <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#ok-status" id="ref-for-ok-status①">ok status</a>, <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue" id="ref-for-iteration-continue⑨">continue</a>.</p>
            <li data-md>
             <p>Let <var>body</var> be <var>manifestResponse</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-body" id="ref-for-concept-response-body①">body</a>.</p>
            <li data-md>
             <p>If <var>body</var> is null, <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue" id="ref-for-iteration-continue①⓪">continue</a>.</p>
            <li data-md>
             <p>Let <var>reader</var> be the result of <a data-link-type="dfn" href="https://streams.spec.whatwg.org/#readablestream-get-a-reader" id="ref-for-readablestream-get-a-reader">getting a reader</a> from <var>body</var>.</p>
            <li data-md>
             <p>Let <var>promise</var> be the result of <a data-link-type="dfn">reading all bytes</a> from <var>body</var> with <var>reader</var>.</p>
            <li data-md>
             <p><a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#upon-fulfillment" id="ref-for-upon-fulfillment">Upon fulfillment</a> of <var>promise</var> with a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte-sequence" id="ref-for-byte-sequence①">byte sequence</a> <var>bytes</var>, <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-set" id="ref-for-map-set">set</a> <var>manifestsMap</var>[<var>identifierURL</var>] to (<var>response</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-url" id="ref-for-concept-response-url②">URL</a>, <var>bytes</var>).</p>
           </ol>
         </ol>
       </ol>
       <p>To <a data-link-type="dfn">process response end-of-body</a> with the <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response" id="ref-for-concept-response②">response</a> <var>identifierResponse</var>:</p>
       <ol>
        <li data-md>
         <p>If <var>manifestURLString</var> is not null, <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue" id="ref-for-iteration-continue①①">continue</a>.</p>
        <li data-md>
         <p>Let <var>body</var> be <var>identifierResponse</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-body" id="ref-for-concept-response-body②">body</a>.</p>
        <li data-md>
         <p>If <var>body</var> is null, <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue" id="ref-for-iteration-continue①②">continue</a>.</p>
        <li data-md>
         <p>Let <var>reader</var> be the result of <a data-link-type="dfn" href="https://streams.spec.whatwg.org/#readablestream-get-a-reader" id="ref-for-readablestream-get-a-reader①">getting a reader</a> from <var>body</var>.</p>
        <li data-md>
         <p>Let <var>promise</var> be the result of <a data-link-type="dfn">reading all bytes</a> from <var>body</var> with <var>reader</var>.</p>
        <li data-md>
         <p><a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#upon-fulfillment" id="ref-for-upon-fulfillment①">Upon fulfillment</a> of <var>promise</var> with a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte-sequence" id="ref-for-byte-sequence②">byte sequence</a> <var>bytes</var>, <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-set" id="ref-for-map-set①">set</a> <var>manifestsMap</var>[<var>identifierURL</var>] to (<var>identifierResponse</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-url" id="ref-for-concept-response-url③">URL</a>, <var>bytes</var>).</p>
       </ol>
     </ol>
    <li data-md>
     <p>Once all ongoing <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-fetch" id="ref-for-concept-fetch②">fetch</a> algorithms initiated by the above steps are complete, including the
 specified <a data-link-type="dfn">process response</a> and <a data-link-type="dfn">process response end-of-body</a> steps, asynchronously
 complete this algorithm with <var>manifestsMap</var>.</p>
   </ol>
   <h3 class="heading settled" data-level="3.4" id="validate-and-parse"><span class="secno">3.4. </span><span class="content">Validating and parsing payment method manifests</span><a class="self-link" href="#validate-and-parse"></a></h3>
   <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-export id="parsed-payment-method-manifest">parsed payment method manifest</dfn> is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#struct" id="ref-for-struct">struct</a> containing two fields:</p>
   <dl>
    <dt data-md><dfn class="dfn-paneled" data-dfn-for="parsed payment method manifest" data-dfn-type="dfn" data-export id="parsed-payment-method-manifest-default-applications">default applications</dfn>
    <dd data-md>
     <p>An <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-set" id="ref-for-ordered-set">ordered set</a> of <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url" id="ref-for-concept-url⑤">URLs</a>, possibly empty</p>
    <dt data-md><dfn class="dfn-paneled" data-dfn-for="parsed payment method manifest" data-dfn-type="dfn" data-export id="parsed-payment-method-manifest-supported-origins">supported origins</dfn>
    <dd data-md>
     <p>An <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-set" id="ref-for-ordered-set①">ordered set</a> of <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin" id="ref-for-concept-origin③">origins</a></p>
   </dl>
   <p>To <dfn class="dfn-paneled" data-dfn-type="dfn" data-export data-lt="validate and parse the payment method manifest" id="validate-and-parse-the-payment-method-manifest">validate and parse</dfn> a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte-sequence" id="ref-for-byte-sequence③">byte sequence</a> <var>bytes</var> purporting to contain a payment method manifest, given a <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url" id="ref-for-concept-url⑥">URL</a> <var>url</var>,
perform the following steps. The result will either be a <a data-link-type="dfn" href="#parsed-payment-method-manifest" id="ref-for-parsed-payment-method-manifest">parsed payment method manifest</a>, or
failure.</p>
   <ol>
    <li data-md>
     <p>Let <var>string</var> be the result of <a data-link-type="dfn" href="https://encoding.spec.whatwg.org/#utf-8-decode" id="ref-for-utf-8-decode">UTF-8 decoding</a> <var>bytes</var>.</p>
    <li data-md>
     <p>Let <var>parsed</var> be the result of <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#parse-a-json-string-to-an-infra-value" id="ref-for-parse-a-json-string-to-an-infra-value">parsing JSON into Infra values</a> given <var>string</var>. If this throws an exception, return failure.</p>
    <li data-md>
     <p>If <var>parsed</var> is not an <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map" id="ref-for-ordered-map②">ordered map</a>, return failure.</p>
    <li data-md>
     <p>Let <var>defaultApps</var> be an empty <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-set" id="ref-for-ordered-set②">ordered set</a>.</p>
    <li data-md>
     <p>If <var>parsed</var>["<code>default_applications</code>"] <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-exists" id="ref-for-map-exists">exists</a>:</p>
     <ol>
      <li data-md>
       <p>Let <var>defaultAppsValue</var> be <var>parsed</var>["<code>default_applications</code>"].</p>
      <li data-md>
       <p>If <var>defaultAppsValue</var> is not a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list②">list</a>, return failure.</p>
      <li data-md>
       <p>If the <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-size" id="ref-for-list-size">size</a> of <var>defaultAppsValue</var> is 0, return failure.</p>
      <li data-md>
       <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-iterate" id="ref-for-list-iterate⑤">For each</a> <var>defaultApp</var> in <var>defaultAppsValue</var>:</p>
       <ol>
        <li data-md>
         <p>If <var>defaultApp</var> is not a string, return failure.</p>
        <li data-md>
         <p>Let <var>defaultAppURL</var> be the result of <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-basic-url-parser" id="ref-for-concept-basic-url-parser②">basic URL parsing</a> <var>defaultApp</var>, given the base URL <var>url</var>. If the result is failure, return failure.</p>
        <li data-md>
         <p>If <var>defaultAppURL</var>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-scheme" id="ref-for-concept-url-scheme②">scheme</a> is not "<code>https</code>", return failure.</p>
        <li data-md>
         <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#set-append" id="ref-for-set-append">Append</a> <var>defaultAppURL</var> to <var>defaultApps</var>.</p>
       </ol>
     </ol>
    <li data-md>
     <p>Let <var>supportedOrigins</var> be an empty <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-set" id="ref-for-ordered-set③">ordered set</a>.</p>
    <li data-md>
     <p>If <var>parsed</var>["<code>supported_origins</code>"] <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-exists" id="ref-for-map-exists①">exists</a>:</p>
     <ol>
      <li data-md>
       <p>Let <var>supportedOriginsValue</var> be <var>parsed</var>["<code>supported_origins</code>"].</p>
      <li data-md>
       <p>If <var>supportedOriginsValue</var> is not a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list③">list</a>, return failure.</p>
      <li data-md>
       <p>If the <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-size" id="ref-for-list-size①">size</a> of <var>supportedOriginsValue</var> is 0, return failure.</p>
      <li data-md>
       <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-iterate" id="ref-for-list-iterate⑥">For each</a> <var>supportedOrigin</var> in <var>supportedOriginsValue</var>:</p>
       <ol>
        <li data-md>
         <p>If <var>supportedOrigin</var> is not a string, return failure.</p>
        <li data-md>
         <p>Let <var>supportedOriginURL</var> be the result of <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-basic-url-parser" id="ref-for-concept-basic-url-parser③">basic URL parsing</a> <var>supportedOrigin</var>. If the result is failure, return failure.</p>
        <li data-md>
         <p>If <var>supportedOriginURL</var>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-scheme" id="ref-for-concept-url-scheme③">scheme</a> is not "<code>https</code>", return failure.</p>
        <li data-md>
         <p>If <var>supportedOriginURL</var>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-username" id="ref-for-concept-url-username">username</a> or <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-password" id="ref-for-concept-url-password">password</a> are not the empty string,
return failure.</p>
        <li data-md>
         <p>If <var>supportedOriginURL</var>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-path" id="ref-for-concept-url-path">path</a>'s <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-size" id="ref-for-list-size②">size</a> is not 0, return failure.</p>
        <li data-md>
         <p>If <var>supportedOriginURL</var>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-query" id="ref-for-concept-url-query">query</a> or <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-fragment" id="ref-for-concept-url-fragment">fragment</a> are not null, return failure.</p>
        <li data-md>
         <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#set-append" id="ref-for-set-append①">Append</a> <var>supportedOriginURL</var>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-origin" id="ref-for-concept-url-origin①">origin</a> to <var>supportedOrigins</var>.</p>
       </ol>
     </ol>
    <li data-md>
     <p>Return a new <a data-link-type="dfn" href="#parsed-payment-method-manifest" id="ref-for-parsed-payment-method-manifest①">parsed payment method manifest</a> with <a data-link-type="dfn" href="#parsed-payment-method-manifest-default-applications" id="ref-for-parsed-payment-method-manifest-default-applications①">default applications</a> given by <var>defaultApps</var> and <a data-link-type="dfn" href="#parsed-payment-method-manifest-supported-origins" id="ref-for-parsed-payment-method-manifest-supported-origins①">supported origins</a> given by <var>supportedOrigins</var>.</p>
   </ol>
   <div class="note" role="note">
     Empty arrays for "<code>default_applications</code>" or "<code>supported_origins</code>"
  will cause parsing to fail. That is, this is not a <a data-link-type="dfn" href="#valid-payment-method-manifest" id="ref-for-valid-payment-method-manifest③">valid payment method manifest</a>, and will
  be rejected by the above algorithm: 
<pre class="highlight"><c- p>{</c->
  <c- f>"default_applications"</c-><c- p>:</c-> <c- p>[</c-><c- u>"https://alicepay.com/pay/app/webappmanifest.json"</c-><c- p>],</c->
  <c- f>"supported_origins"</c-><c- p>:</c-> <c- p>[]</c->
<c- p>}</c->
</pre>
   </div>
   <h3 class="heading settled" data-level="3.5" id="fetch-wam"><span class="secno">3.5. </span><span class="content">Fetching web app manifests</span><a class="self-link" href="#fetch-wam"></a></h3>
   <p>Because the determination of <a data-link-type="dfn" href="https://w3c.github.io/payment-request/#dfn-payment-apps" id="ref-for-dfn-payment-apps①⓪">payment apps</a> happens independent of any embedding HTML document,
the procedure for obtaining a <a data-link-type="dfn" href="https://www.w3.org/TR/appmanifest/#dfn-manifest" id="ref-for-dfn-manifest②">web app manifest</a> that gives information about a default payment
app is different from the usual <a data-link-type="dfn" href="https://www.w3.org/TR/appmanifest/#dfn-obtaining-the-manifest" id="ref-for-dfn-obtaining-the-manifest">steps for obtaining a web app manifest</a>.</p>
   <p>To <dfn class="dfn-paneled" data-dfn-type="dfn" data-export id="fetch-the-web-app-manifest-for-a-default-payment-app">fetch the web app manifest for a default payment app</dfn>, given a <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url" id="ref-for-concept-url⑦">URL</a> <var>url</var>, a
URL <var>referrer</var>, and an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object" id="ref-for-environment-settings-object②">environment settings object</a> <var>client</var>, perform the following steps. This
algorithm will asynchronously complete with either a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#scalar-value-string" id="ref-for-scalar-value-string">scalar value string</a> or failure.</p>
   <ol>
    <li data-md>
     <p>Let <var>request</var> be a new <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request" id="ref-for-concept-request②">request</a> whose <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-url" id="ref-for-concept-request-url②">url</a> is <var>url</var>, <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-client" id="ref-for-concept-request-client②">client</a> is <var>client</var>, <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-referrer" id="ref-for-concept-request-referrer①">referrer</a> is <var>referrer</var>, <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-mode" id="ref-for-concept-request-mode②">mode</a> is "<code>cors</code>", <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-credentials-mode" id="ref-for-concept-request-credentials-mode②">credentials mode</a> is "<code>omit</code>", and <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-redirect-mode" id="ref-for-concept-request-redirect-mode②">redirect mode</a> is
 "<code>error</code>".</p>
    <li data-md>
     <p><a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-fetch" id="ref-for-concept-fetch③">Fetch</a> <var>request</var>. To <a data-link-type="dfn">process response end-of-body</a> with the <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response" id="ref-for-concept-response③">response</a> <var>response</var>:</p>
     <ol>
      <li data-md>
       <p>If <var>response</var> is a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-network-error" id="ref-for-concept-network-error②">network error</a> or <var>response</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-status" id="ref-for-concept-response-status②">status</a> is not an <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#ok-status" id="ref-for-ok-status②">ok status</a>, asynchronously complete this algorithm with failure.</p>
      <li data-md>
       <p>Let <var>body</var> be <var>response</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-body" id="ref-for-concept-response-body③">body</a>.</p>
      <li data-md>
       <p>If <var>body</var> is null, asynchronously complete this algorithm with failure.</p>
      <li data-md>
       <p>Let <var>reader</var> be the result of <a data-link-type="dfn" href="https://streams.spec.whatwg.org/#readablestream-get-a-reader" id="ref-for-readablestream-get-a-reader②">getting a reader</a> from <var>body</var>.</p>
      <li data-md>
       <p>Let <var>promise</var> be the result of <a data-link-type="dfn">reading all bytes</a> from <var>body</var> with <var>reader</var>.</p>
      <li data-md>
       <p><a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#upon-fulfillment" id="ref-for-upon-fulfillment②">Upon fulfillment</a> of <var>promise</var> with a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte-sequence" id="ref-for-byte-sequence④">byte sequence</a> <var>bytes</var>, asynchronously complete
  this algorithm with the result of <a data-link-type="dfn" href="https://encoding.spec.whatwg.org/#utf-8-decode" id="ref-for-utf-8-decode①">UTF-8 decoding</a> <var>bytes</var>.</p>
      <li data-md>
       <p><a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#upon-rejection" id="ref-for-upon-rejection">Upon rejection</a> of <var>promise</var>, asynchronously complete this algorithm with failure.</p>
     </ol>
   </ol>
   <h2 class="heading settled" data-level="4" id="security"><span class="secno">4. </span><span class="content">Security and privacy considerations</span><a class="self-link" href="#security"></a></h2>
   <h3 class="heading settled" data-level="4.1" id="revealing-to-providers"><span class="secno">4.1. </span><span class="content">Revealing user activity to payment providers</span><a class="self-link" href="#revealing-to-providers"></a></h3>
   <p><a data-link-type="dfn" href="#ingest-payment-method-manifests" id="ref-for-ingest-payment-method-manifests①">Ingesting payment method manifests</a> might reveal information
to a payment service about the activity of an end user. For example, a <a data-link-type="dfn" href="https://w3c.github.io/payment-request/#dfn-payment-method" id="ref-for-dfn-payment-method①③">payment method</a> that is
only supported on one website might allow that payment provider to discover the IP addresses of
users who visit that website.</p>
   <p>One way to mitigate this is to <a data-link-type="dfn" href="#fetch-payment-method-manifests" id="ref-for-fetch-payment-method-manifests①">fetch the manifests</a> only for the <a data-link-type="dfn" href="https://w3c.github.io/payment-request/#dfn-payment-apps" id="ref-for-dfn-payment-apps①①">payment apps</a> that the user has installed or has explicitly expressed interest in. This confines
the risk to only sharing the user’s IP address with those parties.</p>
   <p>Another important mitigation is already built in to the spec, by setting the appropriate <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-referrer-policy" id="ref-for-concept-request-referrer-policy①">referrer policy</a> and <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-referrer" id="ref-for-concept-request-referrer②">referrer</a> on the various fetches performed here. These
requirements ensure that only the server that controls the <a data-link-type="dfn" href="https://w3c.github.io/payment-method-id/#dfn-url-based-payment-method-identifiers" id="ref-for-dfn-url-based-payment-method-identifiers②">identifier URL</a> will see the user’s activity, and even then will only see the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin" id="ref-for-concept-origin④">origin</a> of the web page that is creating the <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/payment-request/#dom-paymentrequest" id="ref-for-dom-paymentrequest②">PaymentRequest</a></code> object (instead of seeing the full URL).</p>
   <h3 class="heading settled" data-level="4.2" id="development-environments"><span class="secno">4.2. </span><span class="content">Considerations for development environments</span><a class="self-link" href="#development-environments"></a></h3>
   <p>In development situations, a user agent might lower the security requirements of this specification
to ease testing. For example, the requirements in the <a data-link-type="dfn" href="#fetch-payment-method-manifests" id="ref-for-fetch-payment-method-manifests②">fetch payment method manifests</a> and <a data-link-type="dfn" href="#validate-and-parse-the-payment-method-manifest" id="ref-for-validate-and-parse-the-payment-method-manifest①">validate and parse the payment method manifest</a> algorithms requiring a "<code>https</code>" <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-scheme" id="ref-for-concept-url-scheme④">scheme</a> might be dropped in a development environment. In such situations, the user agent is
intentionally not complying with this specification, and should notify the user of the reduced
security.</p>
   <h3 class="heading settled" data-level="4.3" id="matching-payment-apps"><span class="secno">4.3. </span><span class="content">Matching payment apps</span><a class="self-link" href="#matching-payment-apps"></a></h3>
   <p class="issue" id="issue-d41d8cd9"><a class="self-link" href="#issue-d41d8cd9"></a> <a href="https://github.com/w3c/payment-method-manifest/issues/11">[Issue #11]</a></p>
   <h2 class="heading settled" data-level="5" id="iana"><span class="secno">5. </span><span class="content">IANA considerations</span><a class="self-link" href="#iana"></a></h2>
   <h3 class="heading settled" data-level="5.1" id="payment-method-manifest-link"><span class="secno">5.1. </span><span class="content">The <code>payment-method-manifest</code> link relation</span><a class="self-link" href="#payment-method-manifest-link"></a></h3>
   <p>This registration is for community review and will be submitted to the IESG for review, approval,
and registration with IANA.</p>
   <dl>
    <dt data-md>Relation name
    <dd data-md>
     <p>payment-method-manifest</p>
    <dt data-md>Description
    <dd data-md>
     <p>Links to a payment method manifest, which describes a specific <a data-link-type="dfn" href="https://w3c.github.io/payment-request/#dfn-payment-method" id="ref-for-dfn-payment-method①④">payment method</a> within the Web
 Payments ecosystem.</p>
    <dt data-md>Reference
    <dd data-md>
     <p><a href="https://w3c.github.io/payment-method-manifest/">https://w3c.github.io/payment-method-manifest/</a></p>
    <dt data-md>Notes
    <dd data-md>
     <p>See <a href="#fetch-pmm">§ 3.3 Fetching payment method manifests</a> for the specific manner in which such links are expected to be fetched, and <a href="#ingest">§ 3.2 Ingesting payment method manifests</a> for the larger context in which they are used.</p>
   </dl>
   <h2 class="no-num heading settled" id="acknowledgments"><span class="content">Acknowledgments</span><a class="self-link" href="#acknowledgments"></a></h2>
   <p><a href="#processing-model">§ 3 Processing model</a> is based heavily on algorithms originally outlined by Rouslan Solomakhin.</p>
   <p>Thanks to
Andrew Betts,
Anne van Kesteren,
Ian Jacobs,
L. David Baron,
Marcos Cáceres, and
Rouslan Solomakhin for their contributions to making this specification awesome!</p>
  </main>
  <div data-fill-with="conformance">
   <h2 class="no-ref no-num heading settled" id="w3c-conformance"><span class="content">Conformance</span><a class="self-link" href="#w3c-conformance"></a></h2>
   <h3 class="no-ref no-num heading settled" id="w3c-conventions"><span class="content">Document conventions</span><a class="self-link" href="#w3c-conventions"></a></h3>
   <p>Conformance requirements are expressed
    with a combination of descriptive assertions
    and RFC 2119 terminology.
    The key words “MUST”, “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”, “RECOMMENDED”, “MAY”, and “OPTIONAL”
    in the normative parts of this document
    are to be interpreted as described in RFC 2119.
    However, for readability,
    these words do not appear in all uppercase letters in this specification. </p>
   <p>All of the text of this specification is normative
    except sections explicitly marked as non-normative, examples, and notes. <a data-link-type="biblio" href="#biblio-rfc2119" title="Key words for use in RFCs to Indicate Requirement Levels">[RFC2119]</a> </p>
   <p>Examples in this specification are introduced with the words “for example”
    or are set apart from the normative text
    with <code>class="example"</code>,
    like this: </p>
   <div class="example" id="w3c-example">
    <a class="self-link" href="#w3c-example"></a> 
    <p>This is an example of an informative example. </p>
   </div>
   <p>Informative notes begin with the word “Note”
    and are set apart from the normative text
    with <code>class="note"</code>,
    like this: </p>
   <p class="note" role="note">Note, this is an informative note.</p>
   <section>
    <h3 class="no-ref no-num heading settled" id="w3c-conformant-algorithms"><span class="content">Conformant Algorithms</span><a class="self-link" href="#w3c-conformant-algorithms"></a></h3>
    <p>Requirements phrased in the imperative as part of algorithms
    (such as "strip any leading space characters"
    or "return false and abort these steps")
    are to be interpreted with the meaning of the key word
    ("must", "should", "may", etc)
    used in introducing the algorithm. </p>
    <p>Conformance requirements phrased as algorithms or specific steps
    can be implemented in any manner,
    so long as the end result is equivalent.
    In particular, the algorithms defined in this specification
    are intended to be easy to understand
    and are not intended to be performant.
    Implementers are encouraged to optimize. </p>
   </section>
  </div>
  <script src="https://www.w3.org/scripts/TR/2021/fixup.js"></script>
  <h2 class="no-num no-ref heading settled" id="index"><span class="content">Index</span><a class="self-link" href="#index"></a></h2>
  <h3 class="no-num no-ref heading settled" id="index-defined-here"><span class="content">Terms defined by this specification</span><a class="self-link" href="#index-defined-here"></a></h3>
  <ul class="index">
   <li><a href="#parsed-payment-method-manifest-default-applications">default applications</a><span>, in § 3.4</span>
   <li><a href="#fetch-payment-method-manifests">fetch payment method manifests</a><span>, in § 3.3</span>
   <li><a href="#fetch-the-web-app-manifest-for-a-default-payment-app">fetch the web app manifest for a default payment app</a><span>, in § 3.5</span>
   <li><a href="#ingest-payment-method-manifests">ingest payment method manifests</a><span>, in § 3.2</span>
   <li><a href="#parsed-payment-method-manifest">parsed payment method manifest</a><span>, in § 3.4</span>
   <li><a href="#payment-method-manifest">payment method manifest</a><span>, in § Unnumbered section</span>
   <li><a href="#parsed-payment-method-manifest-supported-origins">supported origins</a><span>, in § 3.4</span>
   <li><a href="#valid-payment-method-manifest">valid</a><span>, in § 2</span>
   <li><a href="#validate-and-parse-the-payment-method-manifest">validate and parse the payment method manifest</a><span>, in § 3.4</span>
   <li><a href="#valid-payment-method-manifest">validity</a><span>, in § 2</span>
   <li><a href="#valid-payment-method-manifest">valid payment method manifest</a><span>, in § 2</span>
  </ul>
  <h3 class="no-num no-ref heading settled" id="index-defined-elsewhere"><span class="content">Terms defined by reference</span><a class="self-link" href="#index-defined-elsewhere"></a></h3>
  <ul class="index">
   <li>
    <a data-link-type="biblio">[APPMANIFEST]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="4aff89a3">processed web app manifest</span>
     <li><span class="dfn-paneled" id="4d540443">steps for obtaining a web app manifest</span>
     <li><span class="dfn-paneled" id="5b59a696">steps for processing a web app manifest</span>
     <li><span class="dfn-paneled" id="2d6020a8">url</span>
     <li><span class="dfn-paneled" id="6723bdad">web app manifest</span>
    </ul>
   <li>
    <a data-link-type="biblio">[ENCODING]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="bffb633e">utf-8</span>
     <li><span class="dfn-paneled" id="b0fcb8d7">utf-8 decode</span>
    </ul>
   <li>
    <a data-link-type="biblio">[FETCH]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="81a76425">body</span>
     <li><span class="dfn-paneled" id="857d5516">client</span>
     <li><span class="dfn-paneled" id="902380f7">credentials mode</span>
     <li><span class="dfn-paneled" id="61025082">extract header list values</span>
     <li><span class="dfn-paneled" id="a33db89a">fetch</span>
     <li><span class="dfn-paneled" id="f7b00a8b">header list</span>
     <li><span class="dfn-paneled" id="50b05fad">method</span>
     <li><span class="dfn-paneled" id="cb98f71f">mode</span>
     <li><span class="dfn-paneled" id="eb1b1af3">network error</span>
     <li><span class="dfn-paneled" id="a27468c5">ok status</span>
     <li><span class="dfn-paneled" id="64b62ea0">redirect mode</span>
     <li><span class="dfn-paneled" id="358f1dbd">referrer</span>
     <li><span class="dfn-paneled" id="07582c28">referrer policy</span>
     <li><span class="dfn-paneled" id="55213b5b">request</span>
     <li><span class="dfn-paneled" id="ee7bba09">response</span>
     <li><span class="dfn-paneled" id="a1d47575">status</span>
     <li><span class="dfn-paneled" id="dc1cd39b">url <small>(for request)</small></span>
     <li><span class="dfn-paneled" id="3268a8eb">url <small>(for response)</small></span>
    </ul>
   <li>
    <a data-link-type="biblio">[HTML]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="12b8dfc0">current settings object</span>
     <li><span class="dfn-paneled" id="3e12e042">environment settings object</span>
     <li><span class="dfn-paneled" id="086e3aff">origin</span>
     <li><span class="dfn-paneled" id="dae0bfde">serialization of an origin</span>
    </ul>
   <li>
    <a data-link-type="biblio">[INFRA]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="53275e46">append <small>(for list)</small></span>
     <li><span class="dfn-paneled" id="a3b18719">append <small>(for set)</small></span>
     <li><span class="dfn-paneled" id="7f9469b5">ascii case-insensitive</span>
     <li><span class="dfn-paneled" id="7b0d918d">break</span>
     <li><span class="dfn-paneled" id="3de9e659">byte sequence</span>
     <li><span class="dfn-paneled" id="f937b7b6">continue</span>
     <li><span class="dfn-paneled" id="1243a891">exist</span>
     <li><span class="dfn-paneled" id="16d07e10">for each</span>
     <li><span class="dfn-paneled" id="c88f3887">item</span>
     <li><span class="dfn-paneled" id="b38d7ca1">javascript string</span>
     <li><span class="dfn-paneled" id="649608b9">list</span>
     <li><span class="dfn-paneled" id="3fca5a9e">map</span>
     <li><span class="dfn-paneled" id="84b454ff">ordered map</span>
     <li><span class="dfn-paneled" id="692595fe">ordered set</span>
     <li><span class="dfn-paneled" id="8e8decb4">parse json into infra values</span>
     <li><span class="dfn-paneled" id="762869d3">scalar value string</span>
     <li><span class="dfn-paneled" id="0e6b2056">set</span>
     <li><span class="dfn-paneled" id="0204d188">size</span>
     <li><span class="dfn-paneled" id="984221ca">struct</span>
     <li><span class="dfn-paneled" id="0e8de730">tuple</span>
    </ul>
   <li>
    <a data-link-type="biblio">[PAYMENT-METHOD-ID]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="1394891f">payment method identifier</span>
     <li><span class="dfn-paneled" id="a8389e54">standardized payment method identifier</span>
     <li><span class="dfn-paneled" id="120fe263">url-based payment method identifier</span>
     <li><span class="dfn-paneled" id="70b9716d">validate a url-based payment method identifier</span>
    </ul>
   <li>
    <a data-link-type="biblio">[PAYMENT-REQUEST]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="f679a0bc">PaymentRequest</span>
     <li><span class="dfn-paneled" id="e0f06068">PaymentRequest(methodData, details, options)</span>
     <li><span class="dfn-paneled" id="621925c8">[[serializedmethoddata]]</span>
     <li><span class="dfn-paneled" id="57def0af">payment app</span>
     <li><span class="dfn-paneled" id="75f46ef4">payment method</span>
    </ul>
   <li>
    <a data-link-type="biblio">[STREAMS]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="ef28f15d">get a reader</span>
    </ul>
   <li>
    <a data-link-type="biblio">[URL]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="22ece843">absolute-url string</span>
     <li><span class="dfn-paneled" id="9ed8b710">basic url parser</span>
     <li><span class="dfn-paneled" id="ed948033">fragment</span>
     <li><span class="dfn-paneled" id="959ad97b">origin</span>
     <li><span class="dfn-paneled" id="a1288f2a">password</span>
     <li><span class="dfn-paneled" id="c0868016">path</span>
     <li><span class="dfn-paneled" id="3ab2ec8b">query</span>
     <li><span class="dfn-paneled" id="3a711be7">scheme</span>
     <li><span class="dfn-paneled" id="dcffbccd">url</span>
     <li><span class="dfn-paneled" id="218c9455">username</span>
     <li><span class="dfn-paneled" id="05af0c3f">valid url string</span>
    </ul>
   <li>
    <a data-link-type="biblio">[WEBIDL]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="24bd7d25">upon fulfillment</span>
     <li><span class="dfn-paneled" id="f14ed351">upon rejection</span>
    </ul>
  </ul>
  <h2 class="no-num no-ref heading settled" id="references"><span class="content">References</span><a class="self-link" href="#references"></a></h2>
  <h3 class="no-num no-ref heading settled" id="normative"><span class="content">Normative References</span><a class="self-link" href="#normative"></a></h3>
  <dl>
   <dt id="biblio-appmanifest">[APPMANIFEST]
   <dd>Marcos Caceres; et al. <a href="https://w3c.github.io/manifest/"><cite>Web Application Manifest</cite></a>. URL: <a href="https://w3c.github.io/manifest/">https://w3c.github.io/manifest/</a>
   <dt id="biblio-encoding">[ENCODING]
   <dd>Anne van Kesteren. <a href="https://encoding.spec.whatwg.org/"><cite>Encoding Standard</cite></a>. Living Standard. URL: <a href="https://encoding.spec.whatwg.org/">https://encoding.spec.whatwg.org/</a>
   <dt id="biblio-fetch">[FETCH]
   <dd>Anne van Kesteren. <a href="https://fetch.spec.whatwg.org/"><cite>Fetch Standard</cite></a>. Living Standard. URL: <a href="https://fetch.spec.whatwg.org/">https://fetch.spec.whatwg.org/</a>
   <dt id="biblio-html">[HTML]
   <dd>Anne van Kesteren; et al. <a href="https://html.spec.whatwg.org/multipage/"><cite>HTML Standard</cite></a>. Living Standard. URL: <a href="https://html.spec.whatwg.org/multipage/">https://html.spec.whatwg.org/multipage/</a>
   <dt id="biblio-infra">[INFRA]
   <dd>Anne van Kesteren; Domenic Denicola. <a href="https://infra.spec.whatwg.org/"><cite>Infra Standard</cite></a>. Living Standard. URL: <a href="https://infra.spec.whatwg.org/">https://infra.spec.whatwg.org/</a>
   <dt id="biblio-payment-method-id">[PAYMENT-METHOD-ID]
   <dd>Marcos Caceres. <a href="https://w3c.github.io/payment-method-id/"><cite>Payment Method Identifiers</cite></a>. URL: <a href="https://w3c.github.io/payment-method-id/">https://w3c.github.io/payment-method-id/</a>
   <dt id="biblio-payment-request">[PAYMENT-REQUEST]
   <dd>Marcos Caceres; Rouslan Solomakhin; Ian Jacobs. <a href="https://w3c.github.io/payment-request/"><cite>Payment Request API</cite></a>. URL: <a href="https://w3c.github.io/payment-request/">https://w3c.github.io/payment-request/</a>
   <dt id="biblio-rfc2119">[RFC2119]
   <dd>S. Bradner. <a href="https://datatracker.ietf.org/doc/html/rfc2119"><cite>Key words for use in RFCs to Indicate Requirement Levels</cite></a>. March 1997. Best Current Practice. URL: <a href="https://datatracker.ietf.org/doc/html/rfc2119">https://datatracker.ietf.org/doc/html/rfc2119</a>
   <dt id="biblio-rfc8288">[RFC8288]
   <dd>M. Nottingham. <a href="https://httpwg.org/specs/rfc8288.html"><cite>Web Linking</cite></a>. October 2017. Proposed Standard. URL: <a href="https://httpwg.org/specs/rfc8288.html">https://httpwg.org/specs/rfc8288.html</a>
   <dt id="biblio-streams">[STREAMS]
   <dd>Adam Rice; et al. <a href="https://streams.spec.whatwg.org/"><cite>Streams Standard</cite></a>. Living Standard. URL: <a href="https://streams.spec.whatwg.org/">https://streams.spec.whatwg.org/</a>
   <dt id="biblio-url">[URL]
   <dd>Anne van Kesteren. <a href="https://url.spec.whatwg.org/"><cite>URL Standard</cite></a>. Living Standard. URL: <a href="https://url.spec.whatwg.org/">https://url.spec.whatwg.org/</a>
   <dt id="biblio-webidl">[WEBIDL]
   <dd>Edgar Chen; Timothy Gu. <a href="https://webidl.spec.whatwg.org/"><cite>Web IDL Standard</cite></a>. Living Standard. URL: <a href="https://webidl.spec.whatwg.org/">https://webidl.spec.whatwg.org/</a>
  </dl>
  <h3 class="no-num no-ref heading settled" id="informative"><span class="content">Informative References</span><a class="self-link" href="#informative"></a></h3>
  <dl>
   <dt id="biblio-payment-handler">[PAYMENT-HANDLER]
   <dd>Adrian Hope-Bailie; et al. <a href="https://w3c.github.io/payment-handler/"><cite>Payment Handler API</cite></a>. URL: <a href="https://w3c.github.io/payment-handler/">https://w3c.github.io/payment-handler/</a>
  </dl>
<script>/* Boilerplate: script-dom-helper */
"use strict";
function query(sel) { return document.querySelector(sel); }

function queryAll(sel) { return [...document.querySelectorAll(sel)]; }

function iter(obj) {
	if(!obj) return [];
	var it = obj[Symbol.iterator];
	if(it) return it;
	return Object.entries(obj);
}

function mk(tagname, attrs, ...children) {
	const el = document.createElement(tagname);
	for(const [k,v] of iter(attrs)) {
		if(k.slice(0,3) == "_on") {
			const eventName = k.slice(3);
			el.addEventListener(eventName, v);
		} else if(k[0] == "_") {
			// property, not attribute
			el[k.slice(1)] = v;
		} else {
			if(v === false || v == null) {
        continue;
      } else if(v === true) {
        el.setAttribute(k, "");
        continue;
      } else {
  			el.setAttribute(k, v);
      }
		}
	}
	append(el, children);
	return el;
}

/* Create shortcuts for every known HTML element */
[
  "a",
  "abbr",
  "acronym",
  "address",
  "applet",
  "area",
  "article",
  "aside",
  "audio",
  "b",
  "base",
  "basefont",
  "bdo",
  "big",
  "blockquote",
  "body",
  "br",
  "button",
  "canvas",
  "caption",
  "center",
  "cite",
  "code",
  "col",
  "colgroup",
  "datalist",
  "dd",
  "del",
  "details",
  "dfn",
  "dialog",
  "div",
  "dl",
  "dt",
  "em",
  "embed",
  "fieldset",
  "figcaption",
  "figure",
  "font",
  "footer",
  "form",
  "frame",
  "frameset",
  "head",
  "header",
  "h1",
  "h2",
  "h3",
  "h4",
  "h5",
  "h6",
  "hr",
  "html",
  "i",
  "iframe",
  "img",
  "input",
  "ins",
  "kbd",
  "label",
  "legend",
  "li",
  "link",
  "main",
  "map",
  "mark",
  "meta",
  "meter",
  "nav",
  "nobr",
  "noscript",
  "object",
  "ol",
  "optgroup",
  "option",
  "output",
  "p",
  "param",
  "pre",
  "progress",
  "q",
  "s",
  "samp",
  "script",
  "section",
  "select",
  "small",
  "source",
  "span",
  "strike",
  "strong",
  "style",
  "sub",
  "summary",
  "sup",
  "table",
  "tbody",
  "td",
  "template",
  "textarea",
  "tfoot",
  "th",
  "thead",
  "time",
  "title",
  "tr",
  "u",
  "ul",
  "var",
  "video",
  "wbr",
  "xmp",
].forEach(tagname=>{
	mk[tagname] = (...args) => mk(tagname, ...args);
});

function* nodesFromChildList(children) {
	for(const child of children.flat(Infinity)) {
		if(child instanceof Node) {
			yield child;
		} else {
			yield new Text(child);
		}
	}
}
function append(el, ...children) {
	for(const child of nodesFromChildList(children)) {
		if(el instanceof Node) el.appendChild(child);
		else el.push(child);
	}
	return el;
}

function insertAfter(el, ...children) {
	for(const child of nodesFromChildList(children)) {
		el.parentNode.insertBefore(child, el.nextSibling);
	}
	return el;
}

function clearContents(el) {
	el.innerHTML = "";
	return el;
}

function parseHTML(markup) {
	if(markup.toLowerCase().trim().indexOf('<!doctype') === 0) {
		const doc = document.implementation.createHTMLDocument("");
		doc.documentElement.innerHTML = markup;
		return doc;
	} else {
		const el = mk.template({});
		el.innerHTML = markup;
		return el.content;
	}
}</script>
<script>/* Boilerplate: script-dfn-panel */
"use strict";
{
let dfnPanelData = {
"0204d188": {"dfnID":"0204d188","dfnText":"size","external":true,"refSections":[{"refs":[{"id":"ref-for-list-size"},{"id":"ref-for-list-size\u2460"},{"id":"ref-for-list-size\u2461"}],"title":"3.4. Validating and parsing payment method manifests"}],"url":"https://infra.spec.whatwg.org/#list-size"},
"05af0c3f": {"dfnID":"05af0c3f","dfnText":"valid url string","external":true,"refSections":[{"refs":[{"id":"ref-for-valid-url-string"}],"title":"2. Manifest format"}],"url":"https://url.spec.whatwg.org/#valid-url-string"},
"07582c28": {"dfnID":"07582c28","dfnText":"referrer policy","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-request-referrer-policy"}],"title":"3.3. Fetching payment method manifests"},{"refs":[{"id":"ref-for-concept-request-referrer-policy\u2460"}],"title":"4.1. Revealing user activity to payment providers"}],"url":"https://fetch.spec.whatwg.org/#concept-request-referrer-policy"},
"086e3aff": {"dfnID":"086e3aff","dfnText":"origin","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-origin"}],"title":"1.1. Use cases"},{"refs":[{"id":"ref-for-concept-origin\u2460"}],"title":"1.3. Example manifest file"},{"refs":[{"id":"ref-for-concept-origin\u2461"}],"title":"2. Manifest format"},{"refs":[{"id":"ref-for-concept-origin\u2462"}],"title":"3.4. Validating and parsing payment method manifests"},{"refs":[{"id":"ref-for-concept-origin\u2463"}],"title":"4.1. Revealing user activity to payment providers"}],"url":"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin"},
"0e6b2056": {"dfnID":"0e6b2056","dfnText":"set","external":true,"refSections":[{"refs":[{"id":"ref-for-map-set"},{"id":"ref-for-map-set\u2460"}],"title":"3.3. Fetching payment method manifests"}],"url":"https://infra.spec.whatwg.org/#map-set"},
"0e8de730": {"dfnID":"0e8de730","dfnText":"tuple","external":true,"refSections":[{"refs":[{"id":"ref-for-tuple"}],"title":"3.3. Fetching payment method manifests"}],"url":"https://infra.spec.whatwg.org/#tuple"},
"120fe263": {"dfnID":"120fe263","dfnText":"url-based payment method identifier","external":true,"refSections":[{"refs":[{"id":"ref-for-dfn-url-based-payment-method-identifiers"}],"title":"1.1. Use cases"},{"refs":[{"id":"ref-for-dfn-url-based-payment-method-identifiers\u2460"}],"title":"3.3. Fetching payment method manifests"},{"refs":[{"id":"ref-for-dfn-url-based-payment-method-identifiers\u2461"}],"title":"4.1. Revealing user activity to payment providers"}],"url":"https://w3c.github.io/payment-method-id/#dfn-url-based-payment-method-identifiers"},
"1243a891": {"dfnID":"1243a891","dfnText":"exist","external":true,"refSections":[{"refs":[{"id":"ref-for-map-exists"},{"id":"ref-for-map-exists\u2460"}],"title":"3.4. Validating and parsing payment method manifests"}],"url":"https://infra.spec.whatwg.org/#map-exists"},
"12b8dfc0": {"dfnID":"12b8dfc0","dfnText":"current settings object","external":true,"refSections":[{"refs":[{"id":"ref-for-current-settings-object"}],"title":"3.1. Modifications to Payment Request API"}],"url":"https://html.spec.whatwg.org/multipage/webappapis.html#current-settings-object"},
"1394891f": {"dfnID":"1394891f","dfnText":"payment method identifier","external":true,"refSections":[{"refs":[{"id":"ref-for-dfn-payment-method-identifiers"}],"title":"1.1. Use cases"},{"refs":[{"id":"ref-for-dfn-payment-method-identifiers\u2460"},{"id":"ref-for-dfn-payment-method-identifiers\u2461"},{"id":"ref-for-dfn-payment-method-identifiers\u2462"},{"id":"ref-for-dfn-payment-method-identifiers\u2463"}],"title":"1.2. Accessing the manifest"},{"refs":[{"id":"ref-for-dfn-payment-method-identifiers\u2464"}],"title":"3.2. Ingesting payment method manifests"},{"refs":[{"id":"ref-for-dfn-payment-method-identifiers\u2465"},{"id":"ref-for-dfn-payment-method-identifiers\u2466"},{"id":"ref-for-dfn-payment-method-identifiers\u2467"}],"title":"3.3. Fetching payment method manifests"}],"url":"https://w3c.github.io/payment-method-id/#dfn-payment-method-identifiers"},
"16d07e10": {"dfnID":"16d07e10","dfnText":"for each","external":true,"refSections":[{"refs":[{"id":"ref-for-list-iterate"},{"id":"ref-for-list-iterate\u2460"}],"title":"3.2. Ingesting payment method manifests"},{"refs":[{"id":"ref-for-list-iterate\u2461"},{"id":"ref-for-list-iterate\u2462"},{"id":"ref-for-list-iterate\u2463"}],"title":"3.3. Fetching payment method manifests"},{"refs":[{"id":"ref-for-list-iterate\u2464"},{"id":"ref-for-list-iterate\u2465"}],"title":"3.4. Validating and parsing payment method manifests"}],"url":"https://infra.spec.whatwg.org/#list-iterate"},
"218c9455": {"dfnID":"218c9455","dfnText":"username","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-url-username"}],"title":"3.4. Validating and parsing payment method manifests"}],"url":"https://url.spec.whatwg.org/#concept-url-username"},
"22ece843": {"dfnID":"22ece843","dfnText":"absolute-url string","external":true,"refSections":[{"refs":[{"id":"ref-for-absolute-url-string"}],"title":"1.1. Use cases"},{"refs":[{"id":"ref-for-absolute-url-string\u2460"}],"title":"2. Manifest format"}],"url":"https://url.spec.whatwg.org/#absolute-url-string"},
"24bd7d25": {"dfnID":"24bd7d25","dfnText":"upon fulfillment","external":true,"refSections":[{"refs":[{"id":"ref-for-upon-fulfillment"},{"id":"ref-for-upon-fulfillment\u2460"}],"title":"3.3. Fetching payment method manifests"},{"refs":[{"id":"ref-for-upon-fulfillment\u2461"}],"title":"3.5. Fetching web app manifests"}],"url":"https://webidl.spec.whatwg.org/#upon-fulfillment"},
"2d6020a8": {"dfnID":"2d6020a8","dfnText":"url","external":true,"refSections":[{"refs":[{"id":"ref-for-dfn-manifest-url"}],"title":"1.1. Use cases"}],"url":"https://www.w3.org/TR/appmanifest/#dfn-manifest-url"},
"3268a8eb": {"dfnID":"3268a8eb","dfnText":"url (for response)","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-response-url"},{"id":"ref-for-concept-response-url\u2460"},{"id":"ref-for-concept-response-url\u2461"},{"id":"ref-for-concept-response-url\u2462"}],"title":"3.3. Fetching payment method manifests"}],"url":"https://fetch.spec.whatwg.org/#concept-response-url"},
"358f1dbd": {"dfnID":"358f1dbd","dfnText":"referrer","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-request-referrer"}],"title":"3.3. Fetching payment method manifests"},{"refs":[{"id":"ref-for-concept-request-referrer\u2460"}],"title":"3.5. Fetching web app manifests"},{"refs":[{"id":"ref-for-concept-request-referrer\u2461"}],"title":"4.1. Revealing user activity to payment providers"}],"url":"https://fetch.spec.whatwg.org/#concept-request-referrer"},
"3a711be7": {"dfnID":"3a711be7","dfnText":"scheme","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-url-scheme"}],"title":"2. Manifest format"},{"refs":[{"id":"ref-for-concept-url-scheme\u2460"}],"title":"3.3. Fetching payment method manifests"},{"refs":[{"id":"ref-for-concept-url-scheme\u2461"},{"id":"ref-for-concept-url-scheme\u2462"}],"title":"3.4. Validating and parsing payment method manifests"},{"refs":[{"id":"ref-for-concept-url-scheme\u2463"}],"title":"4.2. Considerations for development environments"}],"url":"https://url.spec.whatwg.org/#concept-url-scheme"},
"3ab2ec8b": {"dfnID":"3ab2ec8b","dfnText":"query","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-url-query"}],"title":"3.4. Validating and parsing payment method manifests"}],"url":"https://url.spec.whatwg.org/#concept-url-query"},
"3de9e659": {"dfnID":"3de9e659","dfnText":"byte sequence","external":true,"refSections":[{"refs":[{"id":"ref-for-byte-sequence"},{"id":"ref-for-byte-sequence\u2460"},{"id":"ref-for-byte-sequence\u2461"}],"title":"3.3. Fetching payment method manifests"},{"refs":[{"id":"ref-for-byte-sequence\u2462"}],"title":"3.4. Validating and parsing payment method manifests"},{"refs":[{"id":"ref-for-byte-sequence\u2463"}],"title":"3.5. Fetching web app manifests"}],"url":"https://infra.spec.whatwg.org/#byte-sequence"},
"3e12e042": {"dfnID":"3e12e042","dfnText":"environment settings object","external":true,"refSections":[{"refs":[{"id":"ref-for-environment-settings-object"}],"title":"3.2. Ingesting payment method manifests"},{"refs":[{"id":"ref-for-environment-settings-object\u2460"}],"title":"3.3. Fetching payment method manifests"},{"refs":[{"id":"ref-for-environment-settings-object\u2461"}],"title":"3.5. Fetching web app manifests"}],"url":"https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object"},
"3fca5a9e": {"dfnID":"3fca5a9e","dfnText":"map","external":true,"refSections":[{"refs":[{"id":"ref-for-ordered-map"},{"id":"ref-for-ordered-map\u2460"}],"title":"3.3. Fetching payment method manifests"},{"refs":[{"id":"ref-for-ordered-map\u2461"}],"title":"3.4. Validating and parsing payment method manifests"}],"url":"https://infra.spec.whatwg.org/#ordered-map"},
"4aff89a3": {"dfnID":"4aff89a3","dfnText":"processed web app manifest","external":true,"refSections":[{"refs":[{"id":"ref-for-dfn-processed-manifest"},{"id":"ref-for-dfn-processed-manifest\u2460"},{"id":"ref-for-dfn-processed-manifest\u2461"}],"title":"3.2. Ingesting payment method manifests"}],"url":"https://www.w3.org/TR/appmanifest/#dfn-processed-manifest"},
"4d540443": {"dfnID":"4d540443","dfnText":"steps for obtaining a web app manifest","external":true,"refSections":[{"refs":[{"id":"ref-for-dfn-obtaining-the-manifest"}],"title":"3.5. Fetching web app manifests"}],"url":"https://www.w3.org/TR/appmanifest/#dfn-obtaining-the-manifest"},
"50b05fad": {"dfnID":"50b05fad","dfnText":"method","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-request-method"}],"title":"3.3. Fetching payment method manifests"}],"url":"https://fetch.spec.whatwg.org/#concept-request-method"},
"53275e46": {"dfnID":"53275e46","dfnText":"append (for list)","external":true,"refSections":[{"refs":[{"id":"ref-for-list-append"}],"title":"3.3. Fetching payment method manifests"}],"url":"https://infra.spec.whatwg.org/#list-append"},
"55213b5b": {"dfnID":"55213b5b","dfnText":"request","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-request"},{"id":"ref-for-concept-request\u2460"}],"title":"3.3. Fetching payment method manifests"},{"refs":[{"id":"ref-for-concept-request\u2461"}],"title":"3.5. Fetching web app manifests"}],"url":"https://fetch.spec.whatwg.org/#concept-request"},
"57def0af": {"dfnID":"57def0af","dfnText":"payment app","external":true,"refSections":[{"refs":[{"id":"ref-for-dfn-payment-apps"},{"id":"ref-for-dfn-payment-apps\u2460"},{"id":"ref-for-dfn-payment-apps\u2461"}],"title":"1.1. Use cases"},{"refs":[{"id":"ref-for-dfn-payment-apps\u2462"},{"id":"ref-for-dfn-payment-apps\u2463"},{"id":"ref-for-dfn-payment-apps\u2464"}],"title":"1.3. Example manifest file"},{"refs":[{"id":"ref-for-dfn-payment-apps\u2465"}],"title":"3.1. Modifications to Payment Request API"},{"refs":[{"id":"ref-for-dfn-payment-apps\u2466"},{"id":"ref-for-dfn-payment-apps\u2467"},{"id":"ref-for-dfn-payment-apps\u2468"}],"title":"3.2. Ingesting payment method manifests"},{"refs":[{"id":"ref-for-dfn-payment-apps\u2460\u24ea"}],"title":"3.5. Fetching web app manifests"},{"refs":[{"id":"ref-for-dfn-payment-apps\u2460\u2460"}],"title":"4.1. Revealing user activity to payment providers"}],"url":"https://w3c.github.io/payment-request/#dfn-payment-apps"},
"5b59a696": {"dfnID":"5b59a696","dfnText":"steps for processing a web app manifest","external":true,"refSections":[{"refs":[{"id":"ref-for-dfn-processing-a-manifest"},{"id":"ref-for-dfn-processing-a-manifest\u2460"}],"title":"3.2. Ingesting payment method manifests"}],"url":"https://www.w3.org/TR/appmanifest/#dfn-processing-a-manifest"},
"61025082": {"dfnID":"61025082","dfnText":"extract header list values","external":true,"refSections":[{"refs":[{"id":"ref-for-extract-header-list-values"}],"title":"3.3. Fetching payment method manifests"}],"url":"https://fetch.spec.whatwg.org/#extract-header-list-values"},
"621925c8": {"dfnID":"621925c8","dfnText":"[[serializedmethoddata]]","external":true,"refSections":[{"refs":[{"id":"ref-for-dfn-serializedmethoddata"}],"title":"3.1. Modifications to Payment Request API"}],"url":"https://w3c.github.io/payment-request/#dfn-serializedmethoddata"},
"649608b9": {"dfnID":"649608b9","dfnText":"list","external":true,"refSections":[{"refs":[{"id":"ref-for-list"},{"id":"ref-for-list\u2460"}],"title":"3.3. Fetching payment method manifests"},{"refs":[{"id":"ref-for-list\u2461"},{"id":"ref-for-list\u2462"}],"title":"3.4. Validating and parsing payment method manifests"}],"url":"https://infra.spec.whatwg.org/#list"},
"64b62ea0": {"dfnID":"64b62ea0","dfnText":"redirect mode","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-request-redirect-mode"},{"id":"ref-for-concept-request-redirect-mode\u2460"}],"title":"3.3. Fetching payment method manifests"},{"refs":[{"id":"ref-for-concept-request-redirect-mode\u2461"}],"title":"3.5. Fetching web app manifests"}],"url":"https://fetch.spec.whatwg.org/#concept-request-redirect-mode"},
"6723bdad": {"dfnID":"6723bdad","dfnText":"web app manifest","external":true,"refSections":[{"refs":[{"id":"ref-for-dfn-manifest"}],"title":"1.1. Use cases"},{"refs":[{"id":"ref-for-dfn-manifest\u2460"}],"title":"1.3. Example manifest file"},{"refs":[{"id":"ref-for-dfn-manifest\u2461"}],"title":"3.5. Fetching web app manifests"}],"url":"https://www.w3.org/TR/appmanifest/#dfn-manifest"},
"692595fe": {"dfnID":"692595fe","dfnText":"ordered set","external":true,"refSections":[{"refs":[{"id":"ref-for-ordered-set"},{"id":"ref-for-ordered-set\u2460"},{"id":"ref-for-ordered-set\u2461"},{"id":"ref-for-ordered-set\u2462"}],"title":"3.4. Validating and parsing payment method manifests"}],"url":"https://infra.spec.whatwg.org/#ordered-set"},
"70b9716d": {"dfnID":"70b9716d","dfnText":"validate a url-based payment method identifier","external":true,"refSections":[{"refs":[{"id":"ref-for-dfn-validate-a-url-based-payment-method-identifier"}],"title":"3.3. Fetching payment method manifests"}],"url":"https://w3c.github.io/payment-method-id/#dfn-validate-a-url-based-payment-method-identifier"},
"75f46ef4": {"dfnID":"75f46ef4","dfnText":"payment method","external":true,"refSections":[{"refs":[{"id":"ref-for-dfn-payment-method"}],"title":"Unnumbered Section"},{"refs":[{"id":"ref-for-dfn-payment-method\u2460"},{"id":"ref-for-dfn-payment-method\u2461"},{"id":"ref-for-dfn-payment-method\u2462"},{"id":"ref-for-dfn-payment-method\u2463"},{"id":"ref-for-dfn-payment-method\u2464"},{"id":"ref-for-dfn-payment-method\u2465"}],"title":"1.1. Use cases"},{"refs":[{"id":"ref-for-dfn-payment-method\u2466"}],"title":"1.2. Accessing the manifest"},{"refs":[{"id":"ref-for-dfn-payment-method\u2467"},{"id":"ref-for-dfn-payment-method\u2468"},{"id":"ref-for-dfn-payment-method\u2460\u24ea"}],"title":"1.3. Example manifest file"},{"refs":[{"id":"ref-for-dfn-payment-method\u2460\u2460"},{"id":"ref-for-dfn-payment-method\u2460\u2461"}],"title":"3.2. Ingesting payment method manifests"},{"refs":[{"id":"ref-for-dfn-payment-method\u2460\u2462"}],"title":"4.1. Revealing user activity to payment providers"},{"refs":[{"id":"ref-for-dfn-payment-method\u2460\u2463"}],"title":"5.1. The payment-method-manifest link relation"}],"url":"https://w3c.github.io/payment-request/#dfn-payment-method"},
"762869d3": {"dfnID":"762869d3","dfnText":"scalar value string","external":true,"refSections":[{"refs":[{"id":"ref-for-scalar-value-string"}],"title":"3.5. Fetching web app manifests"}],"url":"https://infra.spec.whatwg.org/#scalar-value-string"},
"7b0d918d": {"dfnID":"7b0d918d","dfnText":"break","external":true,"refSections":[{"refs":[{"id":"ref-for-iteration-break"}],"title":"3.3. Fetching payment method manifests"}],"url":"https://infra.spec.whatwg.org/#iteration-break"},
"7f9469b5": {"dfnID":"7f9469b5","dfnText":"ascii case-insensitive","external":true,"refSections":[{"refs":[{"id":"ref-for-ascii-case-insensitive"},{"id":"ref-for-ascii-case-insensitive\u2460"}],"title":"3.3. Fetching payment method manifests"}],"url":"https://infra.spec.whatwg.org/#ascii-case-insensitive"},
"81a76425": {"dfnID":"81a76425","dfnText":"body","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-response-body"},{"id":"ref-for-concept-response-body\u2460"},{"id":"ref-for-concept-response-body\u2461"}],"title":"3.3. Fetching payment method manifests"},{"refs":[{"id":"ref-for-concept-response-body\u2462"}],"title":"3.5. Fetching web app manifests"}],"url":"https://fetch.spec.whatwg.org/#concept-response-body"},
"84b454ff": {"dfnID":"84b454ff","dfnText":"ordered map","external":true,"refSections":[{"refs":[{"id":"ref-for-ordered-map"},{"id":"ref-for-ordered-map\u2460"}],"title":"3.3. Fetching payment method manifests"},{"refs":[{"id":"ref-for-ordered-map\u2461"}],"title":"3.4. Validating and parsing payment method manifests"}],"url":"https://infra.spec.whatwg.org/#ordered-map"},
"857d5516": {"dfnID":"857d5516","dfnText":"client","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-request-client"},{"id":"ref-for-concept-request-client\u2460"}],"title":"3.3. Fetching payment method manifests"},{"refs":[{"id":"ref-for-concept-request-client\u2461"}],"title":"3.5. Fetching web app manifests"}],"url":"https://fetch.spec.whatwg.org/#concept-request-client"},
"8e8decb4": {"dfnID":"8e8decb4","dfnText":"parse json into infra values","external":true,"refSections":[{"refs":[{"id":"ref-for-parse-a-json-string-to-an-infra-value"}],"title":"3.4. Validating and parsing payment method manifests"}],"url":"https://infra.spec.whatwg.org/#parse-a-json-string-to-an-infra-value"},
"902380f7": {"dfnID":"902380f7","dfnText":"credentials mode","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-request-credentials-mode"},{"id":"ref-for-concept-request-credentials-mode\u2460"}],"title":"3.3. Fetching payment method manifests"},{"refs":[{"id":"ref-for-concept-request-credentials-mode\u2461"}],"title":"3.5. Fetching web app manifests"}],"url":"https://fetch.spec.whatwg.org/#concept-request-credentials-mode"},
"959ad97b": {"dfnID":"959ad97b","dfnText":"origin","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-url-origin"}],"title":"2. Manifest format"},{"refs":[{"id":"ref-for-concept-url-origin\u2460"}],"title":"3.4. Validating and parsing payment method manifests"}],"url":"https://url.spec.whatwg.org/#concept-url-origin"},
"984221ca": {"dfnID":"984221ca","dfnText":"struct","external":true,"refSections":[{"refs":[{"id":"ref-for-struct"}],"title":"3.4. Validating and parsing payment method manifests"}],"url":"https://infra.spec.whatwg.org/#struct"},
"9ed8b710": {"dfnID":"9ed8b710","dfnText":"basic url parser","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-basic-url-parser"},{"id":"ref-for-concept-basic-url-parser\u2460"}],"title":"3.3. Fetching payment method manifests"},{"refs":[{"id":"ref-for-concept-basic-url-parser\u2461"},{"id":"ref-for-concept-basic-url-parser\u2462"}],"title":"3.4. Validating and parsing payment method manifests"}],"url":"https://url.spec.whatwg.org/#concept-basic-url-parser"},
"a1288f2a": {"dfnID":"a1288f2a","dfnText":"password","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-url-password"}],"title":"3.4. Validating and parsing payment method manifests"}],"url":"https://url.spec.whatwg.org/#concept-url-password"},
"a1d47575": {"dfnID":"a1d47575","dfnText":"status","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-response-status"},{"id":"ref-for-concept-response-status\u2460"}],"title":"3.3. Fetching payment method manifests"},{"refs":[{"id":"ref-for-concept-response-status\u2461"}],"title":"3.5. Fetching web app manifests"}],"url":"https://fetch.spec.whatwg.org/#concept-response-status"},
"a27468c5": {"dfnID":"a27468c5","dfnText":"ok status","external":true,"refSections":[{"refs":[{"id":"ref-for-ok-status"},{"id":"ref-for-ok-status\u2460"}],"title":"3.3. Fetching payment method manifests"},{"refs":[{"id":"ref-for-ok-status\u2461"}],"title":"3.5. Fetching web app manifests"}],"url":"https://fetch.spec.whatwg.org/#ok-status"},
"a33db89a": {"dfnID":"a33db89a","dfnText":"fetch","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-fetch"},{"id":"ref-for-concept-fetch\u2460"},{"id":"ref-for-concept-fetch\u2461"}],"title":"3.3. Fetching payment method manifests"},{"refs":[{"id":"ref-for-concept-fetch\u2462"}],"title":"3.5. Fetching web app manifests"}],"url":"https://fetch.spec.whatwg.org/#concept-fetch"},
"a3b18719": {"dfnID":"a3b18719","dfnText":"append (for set)","external":true,"refSections":[{"refs":[{"id":"ref-for-set-append"},{"id":"ref-for-set-append\u2460"}],"title":"3.4. Validating and parsing payment method manifests"}],"url":"https://infra.spec.whatwg.org/#set-append"},
"a8389e54": {"dfnID":"a8389e54","dfnText":"standardized payment method identifier","external":true,"refSections":[{"refs":[{"id":"ref-for-dfn-standardized-payment-method-identifiers"}],"title":"3.3. Fetching payment method manifests"}],"url":"https://w3c.github.io/payment-method-id/#dfn-standardized-payment-method-identifiers"},
"b0fcb8d7": {"dfnID":"b0fcb8d7","dfnText":"utf-8 decode","external":true,"refSections":[{"refs":[{"id":"ref-for-utf-8-decode"}],"title":"3.4. Validating and parsing payment method manifests"},{"refs":[{"id":"ref-for-utf-8-decode\u2460"}],"title":"3.5. Fetching web app manifests"}],"url":"https://encoding.spec.whatwg.org/#utf-8-decode"},
"b38d7ca1": {"dfnID":"b38d7ca1","dfnText":"javascript string","external":true,"refSections":[{"refs":[{"id":"ref-for-string"}],"title":"3.3. Fetching payment method manifests"}],"url":"https://infra.spec.whatwg.org/#string"},
"bffb633e": {"dfnID":"bffb633e","dfnText":"utf-8","external":true,"refSections":[{"refs":[{"id":"ref-for-utf-8"}],"title":"2. Manifest format"}],"url":"https://encoding.spec.whatwg.org/#utf-8"},
"c0868016": {"dfnID":"c0868016","dfnText":"path","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-url-path"}],"title":"3.4. Validating and parsing payment method manifests"}],"url":"https://url.spec.whatwg.org/#concept-url-path"},
"c88f3887": {"dfnID":"c88f3887","dfnText":"item","external":true,"refSections":[{"refs":[{"id":"ref-for-struct-item"}],"title":"3.1. Modifications to Payment Request API"}],"url":"https://infra.spec.whatwg.org/#struct-item"},
"cb98f71f": {"dfnID":"cb98f71f","dfnText":"mode","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-request-mode"},{"id":"ref-for-concept-request-mode\u2460"}],"title":"3.3. Fetching payment method manifests"},{"refs":[{"id":"ref-for-concept-request-mode\u2461"}],"title":"3.5. Fetching web app manifests"}],"url":"https://fetch.spec.whatwg.org/#concept-request-mode"},
"dae0bfde": {"dfnID":"dae0bfde","dfnText":"serialization of an origin","external":true,"refSections":[{"refs":[{"id":"ref-for-ascii-serialisation-of-an-origin"}],"title":"2. Manifest format"}],"url":"https://html.spec.whatwg.org/multipage/browsers.html#ascii-serialisation-of-an-origin"},
"dc1cd39b": {"dfnID":"dc1cd39b","dfnText":"url (for request)","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-request-url"},{"id":"ref-for-concept-request-url\u2460"}],"title":"3.3. Fetching payment method manifests"},{"refs":[{"id":"ref-for-concept-request-url\u2461"}],"title":"3.5. Fetching web app manifests"}],"url":"https://fetch.spec.whatwg.org/#concept-request-url"},
"dcffbccd": {"dfnID":"dcffbccd","dfnText":"url","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-url"},{"id":"ref-for-concept-url\u2460"}],"title":"2. Manifest format"},{"refs":[{"id":"ref-for-concept-url\u2461"},{"id":"ref-for-concept-url\u2462"},{"id":"ref-for-concept-url\u2463"}],"title":"3.3. Fetching payment method manifests"},{"refs":[{"id":"ref-for-concept-url\u2464"},{"id":"ref-for-concept-url\u2465"}],"title":"3.4. Validating and parsing payment method manifests"},{"refs":[{"id":"ref-for-concept-url\u2466"}],"title":"3.5. Fetching web app manifests"}],"url":"https://url.spec.whatwg.org/#concept-url"},
"e0f06068": {"dfnID":"e0f06068","dfnText":"PaymentRequest(methodData, details, options)","external":true,"refSections":[{"refs":[{"id":"ref-for-dfn-paymentrequest-paymentrequest"}],"title":"3.1. Modifications to Payment Request API"}],"url":"https://w3c.github.io/payment-request/#dfn-paymentrequest-paymentrequest"},
"eb1b1af3": {"dfnID":"eb1b1af3","dfnText":"network error","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-network-error"},{"id":"ref-for-concept-network-error\u2460"}],"title":"3.3. Fetching payment method manifests"},{"refs":[{"id":"ref-for-concept-network-error\u2461"}],"title":"3.5. Fetching web app manifests"}],"url":"https://fetch.spec.whatwg.org/#concept-network-error"},
"ed948033": {"dfnID":"ed948033","dfnText":"fragment","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-url-fragment"}],"title":"3.4. Validating and parsing payment method manifests"}],"url":"https://url.spec.whatwg.org/#concept-url-fragment"},
"ee7bba09": {"dfnID":"ee7bba09","dfnText":"response","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-response"},{"id":"ref-for-concept-response\u2460"},{"id":"ref-for-concept-response\u2461"}],"title":"3.3. Fetching payment method manifests"},{"refs":[{"id":"ref-for-concept-response\u2462"}],"title":"3.5. Fetching web app manifests"}],"url":"https://fetch.spec.whatwg.org/#concept-response"},
"ef28f15d": {"dfnID":"ef28f15d","dfnText":"get a reader","external":true,"refSections":[{"refs":[{"id":"ref-for-readablestream-get-a-reader"},{"id":"ref-for-readablestream-get-a-reader\u2460"}],"title":"3.3. Fetching payment method manifests"},{"refs":[{"id":"ref-for-readablestream-get-a-reader\u2461"}],"title":"3.5. Fetching web app manifests"}],"url":"https://streams.spec.whatwg.org/#readablestream-get-a-reader"},
"f14ed351": {"dfnID":"f14ed351","dfnText":"upon rejection","external":true,"refSections":[{"refs":[{"id":"ref-for-upon-rejection"}],"title":"3.5. Fetching web app manifests"}],"url":"https://webidl.spec.whatwg.org/#upon-rejection"},
"f679a0bc": {"dfnID":"f679a0bc","dfnText":"PaymentRequest","external":true,"refSections":[{"refs":[{"id":"ref-for-dom-paymentrequest"},{"id":"ref-for-dom-paymentrequest\u2460"}],"title":"3.1. Modifications to Payment Request API"},{"refs":[{"id":"ref-for-dom-paymentrequest\u2461"}],"title":"4.1. Revealing user activity to payment providers"}],"url":"https://w3c.github.io/payment-request/#dom-paymentrequest"},
"f7b00a8b": {"dfnID":"f7b00a8b","dfnText":"header list","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-response-header-list"}],"title":"3.3. Fetching payment method manifests"}],"url":"https://fetch.spec.whatwg.org/#concept-response-header-list"},
"f937b7b6": {"dfnID":"f937b7b6","dfnText":"continue","external":true,"refSections":[{"refs":[{"id":"ref-for-iteration-continue"},{"id":"ref-for-iteration-continue\u2460"}],"title":"3.2. Ingesting payment method manifests"},{"refs":[{"id":"ref-for-iteration-continue\u2461"},{"id":"ref-for-iteration-continue\u2462"},{"id":"ref-for-iteration-continue\u2463"},{"id":"ref-for-iteration-continue\u2464"},{"id":"ref-for-iteration-continue\u2465"},{"id":"ref-for-iteration-continue\u2466"},{"id":"ref-for-iteration-continue\u2467"},{"id":"ref-for-iteration-continue\u2468"},{"id":"ref-for-iteration-continue\u2460\u24ea"},{"id":"ref-for-iteration-continue\u2460\u2460"},{"id":"ref-for-iteration-continue\u2460\u2461"}],"title":"3.3. Fetching payment method manifests"}],"url":"https://infra.spec.whatwg.org/#iteration-continue"},
"fetch-payment-method-manifests": {"dfnID":"fetch-payment-method-manifests","dfnText":"fetch payment method manifests","external":false,"refSections":[{"refs":[{"id":"ref-for-fetch-payment-method-manifests"}],"title":"3.2. Ingesting payment method manifests"},{"refs":[{"id":"ref-for-fetch-payment-method-manifests\u2460"}],"title":"4.1. Revealing user activity to payment providers"},{"refs":[{"id":"ref-for-fetch-payment-method-manifests\u2461"}],"title":"4.2. Considerations for development environments"}],"url":"#fetch-payment-method-manifests"},
"fetch-the-web-app-manifest-for-a-default-payment-app": {"dfnID":"fetch-the-web-app-manifest-for-a-default-payment-app","dfnText":"fetch the web app manifest for a default payment app","external":false,"refSections":[{"refs":[{"id":"ref-for-fetch-the-web-app-manifest-for-a-default-payment-app"}],"title":"3.2. Ingesting payment method manifests"}],"url":"#fetch-the-web-app-manifest-for-a-default-payment-app"},
"ingest-payment-method-manifests": {"dfnID":"ingest-payment-method-manifests","dfnText":"ingest payment method manifests","external":false,"refSections":[{"refs":[{"id":"ref-for-ingest-payment-method-manifests"}],"title":"3.1. Modifications to Payment Request API"},{"refs":[{"id":"ref-for-ingest-payment-method-manifests\u2460"}],"title":"4.1. Revealing user activity to payment providers"}],"url":"#ingest-payment-method-manifests"},
"parsed-payment-method-manifest": {"dfnID":"parsed-payment-method-manifest","dfnText":"parsed payment method manifest","external":false,"refSections":[{"refs":[{"id":"ref-for-parsed-payment-method-manifest"},{"id":"ref-for-parsed-payment-method-manifest\u2460"}],"title":"3.4. Validating and parsing payment method manifests"}],"url":"#parsed-payment-method-manifest"},
"parsed-payment-method-manifest-default-applications": {"dfnID":"parsed-payment-method-manifest-default-applications","dfnText":"default applications","external":false,"refSections":[{"refs":[{"id":"ref-for-parsed-payment-method-manifest-default-applications"}],"title":"3.2. Ingesting payment method manifests"},{"refs":[{"id":"ref-for-parsed-payment-method-manifest-default-applications\u2460"}],"title":"3.4. Validating and parsing payment method manifests"}],"url":"#parsed-payment-method-manifest-default-applications"},
"parsed-payment-method-manifest-supported-origins": {"dfnID":"parsed-payment-method-manifest-supported-origins","dfnText":"supported origins","external":false,"refSections":[{"refs":[{"id":"ref-for-parsed-payment-method-manifest-supported-origins"}],"title":"3.2. Ingesting payment method manifests"},{"refs":[{"id":"ref-for-parsed-payment-method-manifest-supported-origins\u2460"}],"title":"3.4. Validating and parsing payment method manifests"}],"url":"#parsed-payment-method-manifest-supported-origins"},
"payment-method-manifest": {"dfnID":"payment-method-manifest","dfnText":"payment method manifest","external":false,"refSections":[{"refs":[{"id":"ref-for-payment-method-manifest"}],"title":"1.1. Use cases"},{"refs":[{"id":"ref-for-payment-method-manifest\u2460"},{"id":"ref-for-payment-method-manifest\u2461"}],"title":"1.2. Accessing the manifest"},{"refs":[{"id":"ref-for-payment-method-manifest\u2462"}],"title":"1.3. Example manifest file"},{"refs":[{"id":"ref-for-payment-method-manifest\u2463"},{"id":"ref-for-payment-method-manifest\u2464"},{"id":"ref-for-payment-method-manifest\u2465"},{"id":"ref-for-payment-method-manifest\u2466"}],"title":"2. Manifest format"}],"url":"#payment-method-manifest"},
"valid-payment-method-manifest": {"dfnID":"valid-payment-method-manifest","dfnText":"valid payment method manifest","external":false,"refSections":[{"refs":[{"id":"ref-for-valid-payment-method-manifest"},{"id":"ref-for-valid-payment-method-manifest\u2460"},{"id":"ref-for-valid-payment-method-manifest\u2461"}],"title":"2. Manifest format"},{"refs":[{"id":"ref-for-valid-payment-method-manifest\u2462"}],"title":"3.4. Validating and parsing payment method manifests"}],"url":"#valid-payment-method-manifest"},
"validate-and-parse-the-payment-method-manifest": {"dfnID":"validate-and-parse-the-payment-method-manifest","dfnText":"validate and parse","external":false,"refSections":[{"refs":[{"id":"ref-for-validate-and-parse-the-payment-method-manifest"}],"title":"3.2. Ingesting payment method manifests"},{"refs":[{"id":"ref-for-validate-and-parse-the-payment-method-manifest\u2460"}],"title":"4.2. Considerations for development environments"}],"url":"#validate-and-parse-the-payment-method-manifest"},
};

document.addEventListener("DOMContentLoaded", ()=>{
    genAllDfnPanels();

    document.body.addEventListener("click", (e) => {
        // If not handled already, just hide all dfn panels.
        hideAllDfnPanels();
    });
});

window.addEventListener("resize", () => {
    // Pin any visible dfn panel
    queryAll(".dfn-panel.on, .dfn-panel.activated").forEach(el=>positionDfnPanel(el));
});

function genAllDfnPanels() {
    for(const panelData of Object.values(dfnPanelData)) {
        const dfnID = panelData.dfnID;
        const dfn = document.getElementById(dfnID);
        if(!dfn) {
            console.log(`Can't find dfn#${dfnID}.`, panelData);
            continue;
        }
        dfn.panelData = panelData;
        insertDfnPopupAction(dfn);
    }
}

function genDfnPanel(dfn, { dfnID, url, dfnText, refSections, external }) {
    const dfnPanel = mk.aside({
        class: "dfn-panel on",
        id: `infopanel-for-${dfnID}`,
        "data-for": dfnID,
        "aria-labelled-by":`infopaneltitle-for-${dfnID}`,
        },
        mk.span({id:`infopaneltitle-for-${dfnID}`, style:"display:none"},
            `Info about the '${dfnText}' ${external?"external":""} reference.`),
        mk.a({href:url, class:"dfn-link"}, url),
        refSections.length == 0 ? [] :
            mk.b({}, "Referenced in:"),
            mk.ul({},
                ...refSections.map(section=>
                    mk.li({},
                        ...section.refs.map((ref, refI)=>
                            [
                                mk.a({ href: `#${ref.id}` },
                                    (refI == 0) ? section.title : `(${refI + 1})`
                                ),
                                " ",
                            ]
                        ),
                    ),
                ),
            ),
        genLinkingSyntaxes(dfn),
    );

    dfnPanel.addEventListener('click', (event) => {
        if (event.target.nodeName == 'A') {
            scrollToTargetAndHighlight(event);
            pinDfnPanel(dfnPanel);
        }
        event.stopPropagation();
        refocusOnTarget(event);
    });
    dfnPanel.addEventListener('keydown', (event) => {
        if(event.keyCode == 27) { // Escape key
            hideDfnPanel({dfnPanel});
            event.stopPropagation();
            event.preventDefault();
        }
    });

    dfnPanel.dfn = dfn;
    dfn.dfnPanel = dfnPanel;
    return dfnPanel;
}



function hideAllDfnPanels() {
    // Delete the currently-active dfn panel.
    queryAll(".dfn-panel").forEach(dfnPanel=>hideDfnPanel({dfnPanel}));
}

function showDfnPanel(dfn) {
    hideAllDfnPanels(); // Only display one at a time.

    dfn.setAttribute("aria-expanded", "true");

    const dfnPanel = genDfnPanel(dfn, dfn.panelData);

    // Give the dfn a unique tabindex, and then
    // give all the tabbable panel bits successive indexes.
    let tabIndex = 100;
    dfn.tabIndex = tabIndex++;
    const tabbable = dfnPanel.querySelectorAll(":is(a, button)");
    for (const el of tabbable) {
        el.tabIndex = tabIndex++;
    }

    append(document.body, dfnPanel);
    positionDfnPanel(dfnPanel);
}

function positionDfnPanel(dfnPanel) {
    const dfn = dfnPanel.dfn;
    const dfnPos = getBounds(dfn);
    dfnPanel.style.top = dfnPos.bottom + "px";
    dfnPanel.style.left = dfnPos.left + "px";

    const panelPos = dfnPanel.getBoundingClientRect();
    const panelMargin = 8;
    const maxRight = document.body.parentNode.clientWidth - panelMargin;
    if (panelPos.right > maxRight) {
        const overflowAmount = panelPos.right - maxRight;
        const newLeft = Math.max(panelMargin, dfnPos.left - overflowAmount);
        dfnPanel.style.left = newLeft + "px";
    }
}

function pinDfnPanel(dfnPanel) {
    // Switch it to "activated" state, which pins it.
    dfnPanel.classList.add("activated");
    dfnPanel.style.position = "fixed";
    dfnPanel.style.left = null;
    dfnPanel.style.top = null;
}

function hideDfnPanel({dfn, dfnPanel}) {
    if(!dfnPanel) dfnPanel = dfn.dfnPanel;
    if(!dfn) dfn = dfnPanel.dfn;
    dfn.dfnPanel = undefined;
    dfnPanel.dfn = undefined;
    dfn.setAttribute("aria-expanded", "false");
    dfn.tabIndex = undefined;
    dfnPanel.remove()
}

function toggleDfnPanel(dfn) {
    if(dfn.dfnPanel) {
        hideDfnPanel(dfn);
    } else {
        showDfnPanel(dfn);
    }
}

function insertDfnPopupAction(dfn) {
    dfn.setAttribute('role', 'button');
    dfn.setAttribute('aria-expanded', 'false')
    dfn.tabIndex = 0;
    dfn.classList.add('has-dfn-panel');
    dfn.addEventListener('click', (event) => {
        toggleDfnPanel(dfn);
        event.stopPropagation();
    });
    dfn.addEventListener('keypress', (event) => {
        const kc = event.keyCode;
        // 32->Space, 13->Enter
        if(kc == 32 || kc == 13) {
            toggleDfnPanel(dfn);
            event.stopPropagation();
            event.preventDefault();
        }
    });
}

function refocusOnTarget(event) {
    const target = event.target;
    setTimeout(() => {
        // Refocus on the event.target element.
        // This is needed after browser scrolls to the destination.
        target.focus();
    });
}

// TODO: shared util
// Returns the root-level absolute position {left and top} of element.
function getBounds(el, relativeTo=document.body) {
    const relativeRect = relativeTo.getBoundingClientRect();
    const elRect = el.getBoundingClientRect();
    const top = elRect.top - relativeRect.top;
    const left = elRect.left - relativeRect.left;
    return {
        top,
        left,
        bottom: top + elRect.height,
        right: left + elRect.width,
    }
}

function scrollToTargetAndHighlight(event) {
    let hash = event.target.hash;
    if (hash) {
        hash = decodeURIComponent(hash.substring(1));
        const dest = document.getElementById(hash);
        if (dest) {
            dest.classList.add('highlighted');
            setTimeout(() => dest.classList.remove('highlighted'), 1000);
        }
    }
}

// Functions, divided by link type, that wrap an autolink's
// contents with the appropriate outer syntax.
// Alternately, a string naming another type they format
// the same as.
function needsFor(type) {
    switch(type) {
        case "descriptor":
        case "value":
        case "element-attr":
        case "attr-value":
        case "element-state":
        case "method":
        case "constructor":
        case "argument":
        case "attribute":
        case "const":
        case "dict-member":
        case "event":
        case "enum-value":
        case "stringifier":
        case "serializer":
        case "iterator":
        case "maplike":
        case "setlike":
        case "state":
        case "mode":
        case "context":
        case "facet": return true;

        default: return false;
    }
}
function refusesFor(type) {
    switch(type) {
        case "property":
        case "element":
        case "interface":
        case "namespace":
        case "callback":
        case "dictionary":
        case "enum":
        case "exception":
        case "typedef":
        case "http-header":
        case "permission": return true;

        default: return false;
    }
}
function linkFormatterFromType(type) {
    switch(type) {
        case 'scheme':
        case 'permission':
        case 'dfn': return (text) => `[=${text}=]`;

        case 'abstract-op': return (text) => `[\$${text}\$]`;

        case 'function':
        case 'at-rule':
        case 'selector':
        case 'value': return (text) => `''${text}''`;

        case 'http-header': return (text) => `[:${text}:]`;

        case 'interface':
        case 'constructor':
        case 'method':
        case 'argument':
        case 'attribute':
        case 'callback':
        case 'dictionary':
        case 'dict-member':
        case 'enum':
        case 'enum-value':
        case 'exception':
        case 'const':
        case 'typedef':
        case 'stringifier':
        case 'serializer':
        case 'iterator':
        case 'maplike':
        case 'setlike':
        case 'extended-attribute':
        case 'event':
        case 'idl': return (text) => `{{${text}}}`;

        case 'element-state':
        case 'element-attr':
        case 'attr-value':
        case 'element': return (element) => `<{${element}}>`;

        case 'grammar': return (text) => `${text} (within a <pre class=prod>)`;

        case 'type': return (text)=> `<<${text}>>`;

        case 'descriptor':
        case 'property': return (text) => `'${text}'`;

        default: return;
    };
};

function genLinkingSyntaxes(dfn) {
    if(dfn.tagName != "DFN") return;

    const type = dfn.getAttribute('data-dfn-type');
    if(!type) {
        console.log(`<dfn> doesn't have a data-dfn-type:`, dfn);
        return [];
    }

    // Return a function that wraps link text based on the type
    const linkFormatter = linkFormatterFromType(type);
    if(!linkFormatter) {
        console.log(`<dfn> has an unknown data-dfn-type:`, dfn);
        return [];
    }

    let ltAlts;
    if(dfn.hasAttribute('data-lt')) {
        ltAlts = dfn.getAttribute('data-lt')
            .split("|")
            .map(x=>x.trim());
    } else {
        ltAlts = [dfn.textContent.trim()];
    }
    if(type == "type") {
        // lt of "<foo>", but "foo" is the interior;
        // <<foo/bar>> is how you write it with a for,
        // not <foo/<bar>> or whatever.
        for(var i = 0; i < ltAlts.length; i++) {
            const lt = ltAlts[i];
            const match = /<(.*)>/.exec(lt);
            if(match) { ltAlts[i] = match[1]; }
        }
    }

    let forAlts;
    if(dfn.hasAttribute('data-dfn-for')) {
        forAlts = dfn.getAttribute('data-dfn-for')
            .split(",")
            .map(x=>x.trim());
    } else {
        forAlts = [''];
    }

    let linkingSyntaxes = [];
    if(!needsFor(type)) {
        for(const lt of ltAlts) {
            linkingSyntaxes.push(linkFormatter(lt));
        }
    }
    if(!refusesFor(type)) {
        for(const f of forAlts) {
            linkingSyntaxes.push(linkFormatter(`${f}/${ltAlts[0]}`))
        }
    }
    return [
        mk.b({}, 'Possible linking syntaxes:'),
        mk.ul({},
            ...linkingSyntaxes.map(link => {
                const copyLink = async () =>
                    await navigator.clipboard.writeText(link);
                return mk.li({},
                    mk.div({ class: 'link-item' },
                        mk.button({
                            class: 'copy-icon', title: 'Copy',
                            type: 'button',
                            _onclick: copyLink,
                            tabindex: 0,
                        }, mk.span({ class: 'icon' }) ),
                        mk.span({}, link)
                    )
                );
            })
        )
    ];
}
}
</script>
<script>/* Boilerplate: script-ref-hints */
"use strict";
{
let refsData = {
"#fetch-payment-method-manifests": {"export":true,"for_":[],"level":"","normative":true,"shortname":"payment-method-manifest","spec":"payment-method-manifest","status":"local","text":"fetch payment method manifests","type":"dfn","url":"#fetch-payment-method-manifests"},
"#fetch-the-web-app-manifest-for-a-default-payment-app": {"export":true,"for_":[],"level":"","normative":true,"shortname":"payment-method-manifest","spec":"payment-method-manifest","status":"local","text":"fetch the web app manifest for a default payment app","type":"dfn","url":"#fetch-the-web-app-manifest-for-a-default-payment-app"},
"#ingest-payment-method-manifests": {"export":true,"for_":[],"level":"","normative":true,"shortname":"payment-method-manifest","spec":"payment-method-manifest","status":"local","text":"ingest payment method manifests","type":"dfn","url":"#ingest-payment-method-manifests"},
"#parsed-payment-method-manifest": {"export":true,"for_":[],"level":"","normative":true,"shortname":"payment-method-manifest","spec":"payment-method-manifest","status":"local","text":"parsed payment method manifest","type":"dfn","url":"#parsed-payment-method-manifest"},
"#parsed-payment-method-manifest-default-applications": {"export":true,"for_":["parsed payment method manifest"],"level":"","normative":true,"shortname":"payment-method-manifest","spec":"payment-method-manifest","status":"local","text":"default applications","type":"dfn","url":"#parsed-payment-method-manifest-default-applications"},
"#parsed-payment-method-manifest-supported-origins": {"export":true,"for_":["parsed payment method manifest"],"level":"","normative":true,"shortname":"payment-method-manifest","spec":"payment-method-manifest","status":"local","text":"supported origins","type":"dfn","url":"#parsed-payment-method-manifest-supported-origins"},
"#payment-method-manifest": {"export":true,"for_":[],"level":"","normative":true,"shortname":"payment-method-manifest","spec":"payment-method-manifest","status":"local","text":"payment method manifest","type":"dfn","url":"#payment-method-manifest"},
"#valid-payment-method-manifest": {"export":true,"for_":[],"level":"","normative":true,"shortname":"payment-method-manifest","spec":"payment-method-manifest","status":"local","text":"valid","type":"dfn","url":"#valid-payment-method-manifest"},
"#validate-and-parse-the-payment-method-manifest": {"export":true,"for_":[],"level":"","normative":true,"shortname":"payment-method-manifest","spec":"payment-method-manifest","status":"local","text":"validate and parse the payment method manifest","type":"dfn","url":"#validate-and-parse-the-payment-method-manifest"},
"https://encoding.spec.whatwg.org/#utf-8": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"encoding","spec":"encoding","status":"current","text":"utf-8","type":"dfn","url":"https://encoding.spec.whatwg.org/#utf-8"},
"https://encoding.spec.whatwg.org/#utf-8-decode": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"encoding","spec":"encoding","status":"current","text":"utf-8 decode","type":"dfn","url":"https://encoding.spec.whatwg.org/#utf-8-decode"},
"https://fetch.spec.whatwg.org/#concept-fetch": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"fetch","spec":"fetch","status":"current","text":"fetch","type":"dfn","url":"https://fetch.spec.whatwg.org/#concept-fetch"},
"https://fetch.spec.whatwg.org/#concept-network-error": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"fetch","spec":"fetch","status":"current","text":"network error","type":"dfn","url":"https://fetch.spec.whatwg.org/#concept-network-error"},
"https://fetch.spec.whatwg.org/#concept-request": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"fetch","spec":"fetch","status":"current","text":"request","type":"dfn","url":"https://fetch.spec.whatwg.org/#concept-request"},
"https://fetch.spec.whatwg.org/#concept-request-client": {"export":true,"for_":["request"],"level":"1","normative":true,"shortname":"fetch","spec":"fetch","status":"current","text":"client","type":"dfn","url":"https://fetch.spec.whatwg.org/#concept-request-client"},
"https://fetch.spec.whatwg.org/#concept-request-credentials-mode": {"export":true,"for_":["request"],"level":"1","normative":true,"shortname":"fetch","spec":"fetch","status":"current","text":"credentials mode","type":"dfn","url":"https://fetch.spec.whatwg.org/#concept-request-credentials-mode"},
"https://fetch.spec.whatwg.org/#concept-request-method": {"export":true,"for_":["request"],"level":"1","normative":true,"shortname":"fetch","spec":"fetch","status":"current","text":"method","type":"dfn","url":"https://fetch.spec.whatwg.org/#concept-request-method"},
"https://fetch.spec.whatwg.org/#concept-request-mode": {"export":true,"for_":["request"],"level":"1","normative":true,"shortname":"fetch","spec":"fetch","status":"current","text":"mode","type":"dfn","url":"https://fetch.spec.whatwg.org/#concept-request-mode"},
"https://fetch.spec.whatwg.org/#concept-request-redirect-mode": {"export":true,"for_":["request"],"level":"1","normative":true,"shortname":"fetch","spec":"fetch","status":"current","text":"redirect mode","type":"dfn","url":"https://fetch.spec.whatwg.org/#concept-request-redirect-mode"},
"https://fetch.spec.whatwg.org/#concept-request-referrer": {"export":true,"for_":["request"],"level":"1","normative":true,"shortname":"fetch","spec":"fetch","status":"current","text":"referrer","type":"dfn","url":"https://fetch.spec.whatwg.org/#concept-request-referrer"},
"https://fetch.spec.whatwg.org/#concept-request-referrer-policy": {"export":true,"for_":["request"],"level":"1","normative":true,"shortname":"fetch","spec":"fetch","status":"current","text":"referrer policy","type":"dfn","url":"https://fetch.spec.whatwg.org/#concept-request-referrer-policy"},
"https://fetch.spec.whatwg.org/#concept-request-url": {"export":true,"for_":["request"],"level":"1","normative":true,"shortname":"fetch","spec":"fetch","status":"current","text":"url","type":"dfn","url":"https://fetch.spec.whatwg.org/#concept-request-url"},
"https://fetch.spec.whatwg.org/#concept-response": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"fetch","spec":"fetch","status":"current","text":"response","type":"dfn","url":"https://fetch.spec.whatwg.org/#concept-response"},
"https://fetch.spec.whatwg.org/#concept-response-body": {"export":true,"for_":["response"],"level":"1","normative":true,"shortname":"fetch","spec":"fetch","status":"current","text":"body","type":"dfn","url":"https://fetch.spec.whatwg.org/#concept-response-body"},
"https://fetch.spec.whatwg.org/#concept-response-header-list": {"export":true,"for_":["response"],"level":"1","normative":true,"shortname":"fetch","spec":"fetch","status":"current","text":"header list","type":"dfn","url":"https://fetch.spec.whatwg.org/#concept-response-header-list"},
"https://fetch.spec.whatwg.org/#concept-response-status": {"export":true,"for_":["response"],"level":"1","normative":true,"shortname":"fetch","spec":"fetch","status":"current","text":"status","type":"dfn","url":"https://fetch.spec.whatwg.org/#concept-response-status"},
"https://fetch.spec.whatwg.org/#concept-response-url": {"export":true,"for_":["response"],"level":"1","normative":true,"shortname":"fetch","spec":"fetch","status":"current","text":"url","type":"dfn","url":"https://fetch.spec.whatwg.org/#concept-response-url"},
"https://fetch.spec.whatwg.org/#extract-header-list-values": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"fetch","spec":"fetch","status":"current","text":"extract header list values","type":"dfn","url":"https://fetch.spec.whatwg.org/#extract-header-list-values"},
"https://fetch.spec.whatwg.org/#ok-status": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"fetch","spec":"fetch","status":"current","text":"ok status","type":"dfn","url":"https://fetch.spec.whatwg.org/#ok-status"},
"https://html.spec.whatwg.org/multipage/browsers.html#ascii-serialisation-of-an-origin": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"serialization of an origin","type":"dfn","url":"https://html.spec.whatwg.org/multipage/browsers.html#ascii-serialisation-of-an-origin"},
"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"origin","type":"dfn","url":"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin"},
"https://html.spec.whatwg.org/multipage/webappapis.html#current-settings-object": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"current settings object","type":"dfn","url":"https://html.spec.whatwg.org/multipage/webappapis.html#current-settings-object"},
"https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"environment settings object","type":"dfn","url":"https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object"},
"https://infra.spec.whatwg.org/#ascii-case-insensitive": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"ascii case-insensitive","type":"dfn","url":"https://infra.spec.whatwg.org/#ascii-case-insensitive"},
"https://infra.spec.whatwg.org/#byte-sequence": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"byte sequence","type":"dfn","url":"https://infra.spec.whatwg.org/#byte-sequence"},
"https://infra.spec.whatwg.org/#iteration-break": {"export":true,"for_":["iteration"],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"break","type":"dfn","url":"https://infra.spec.whatwg.org/#iteration-break"},
"https://infra.spec.whatwg.org/#iteration-continue": {"export":true,"for_":["iteration"],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"continue","type":"dfn","url":"https://infra.spec.whatwg.org/#iteration-continue"},
"https://infra.spec.whatwg.org/#list": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"list","type":"dfn","url":"https://infra.spec.whatwg.org/#list"},
"https://infra.spec.whatwg.org/#list-append": {"export":true,"for_":["list"],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"append","type":"dfn","url":"https://infra.spec.whatwg.org/#list-append"},
"https://infra.spec.whatwg.org/#list-iterate": {"export":true,"for_":["list","set"],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"for each","type":"dfn","url":"https://infra.spec.whatwg.org/#list-iterate"},
"https://infra.spec.whatwg.org/#list-size": {"export":true,"for_":["list","stack","queue","set"],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"size","type":"dfn","url":"https://infra.spec.whatwg.org/#list-size"},
"https://infra.spec.whatwg.org/#map-exists": {"export":true,"for_":["map"],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"exist","type":"dfn","url":"https://infra.spec.whatwg.org/#map-exists"},
"https://infra.spec.whatwg.org/#map-set": {"export":true,"for_":["map"],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"set","type":"dfn","url":"https://infra.spec.whatwg.org/#map-set"},
"https://infra.spec.whatwg.org/#ordered-map": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"map","type":"dfn","url":"https://infra.spec.whatwg.org/#ordered-map"},
"https://infra.spec.whatwg.org/#ordered-set": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"ordered set","type":"dfn","url":"https://infra.spec.whatwg.org/#ordered-set"},
"https://infra.spec.whatwg.org/#parse-a-json-string-to-an-infra-value": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"parse json into infra values","type":"dfn","url":"https://infra.spec.whatwg.org/#parse-a-json-string-to-an-infra-value"},
"https://infra.spec.whatwg.org/#scalar-value-string": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"scalar value string","type":"dfn","url":"https://infra.spec.whatwg.org/#scalar-value-string"},
"https://infra.spec.whatwg.org/#set-append": {"export":true,"for_":["set"],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"append","type":"dfn","url":"https://infra.spec.whatwg.org/#set-append"},
"https://infra.spec.whatwg.org/#string": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"javascript string","type":"dfn","url":"https://infra.spec.whatwg.org/#string"},
"https://infra.spec.whatwg.org/#struct": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"struct","type":"dfn","url":"https://infra.spec.whatwg.org/#struct"},
"https://infra.spec.whatwg.org/#struct-item": {"export":true,"for_":["struct","tuple"],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"item","type":"dfn","url":"https://infra.spec.whatwg.org/#struct-item"},
"https://infra.spec.whatwg.org/#tuple": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"tuple","type":"dfn","url":"https://infra.spec.whatwg.org/#tuple"},
"https://streams.spec.whatwg.org/#readablestream-get-a-reader": {"export":true,"for_":["ReadableStream"],"level":"1","normative":true,"shortname":"streams","spec":"streams","status":"current","text":"get a reader","type":"dfn","url":"https://streams.spec.whatwg.org/#readablestream-get-a-reader"},
"https://url.spec.whatwg.org/#absolute-url-string": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"url","spec":"url","status":"current","text":"absolute-url string","type":"dfn","url":"https://url.spec.whatwg.org/#absolute-url-string"},
"https://url.spec.whatwg.org/#concept-basic-url-parser": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"url","spec":"url","status":"current","text":"basic url parser","type":"dfn","url":"https://url.spec.whatwg.org/#concept-basic-url-parser"},
"https://url.spec.whatwg.org/#concept-url": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"url","spec":"url","status":"current","text":"url","type":"dfn","url":"https://url.spec.whatwg.org/#concept-url"},
"https://url.spec.whatwg.org/#concept-url-fragment": {"export":true,"for_":["url"],"level":"1","normative":true,"shortname":"url","spec":"url","status":"current","text":"fragment","type":"dfn","url":"https://url.spec.whatwg.org/#concept-url-fragment"},
"https://url.spec.whatwg.org/#concept-url-origin": {"export":true,"for_":["url"],"level":"1","normative":true,"shortname":"url","spec":"url","status":"current","text":"origin","type":"dfn","url":"https://url.spec.whatwg.org/#concept-url-origin"},
"https://url.spec.whatwg.org/#concept-url-password": {"export":true,"for_":["url"],"level":"1","normative":true,"shortname":"url","spec":"url","status":"current","text":"password","type":"dfn","url":"https://url.spec.whatwg.org/#concept-url-password"},
"https://url.spec.whatwg.org/#concept-url-path": {"export":true,"for_":["url"],"level":"1","normative":true,"shortname":"url","spec":"url","status":"current","text":"path","type":"dfn","url":"https://url.spec.whatwg.org/#concept-url-path"},
"https://url.spec.whatwg.org/#concept-url-query": {"export":true,"for_":["url"],"level":"1","normative":true,"shortname":"url","spec":"url","status":"current","text":"query","type":"dfn","url":"https://url.spec.whatwg.org/#concept-url-query"},
"https://url.spec.whatwg.org/#concept-url-scheme": {"export":true,"for_":["url"],"level":"1","normative":true,"shortname":"url","spec":"url","status":"current","text":"scheme","type":"dfn","url":"https://url.spec.whatwg.org/#concept-url-scheme"},
"https://url.spec.whatwg.org/#concept-url-username": {"export":true,"for_":["url"],"level":"1","normative":true,"shortname":"url","spec":"url","status":"current","text":"username","type":"dfn","url":"https://url.spec.whatwg.org/#concept-url-username"},
"https://url.spec.whatwg.org/#valid-url-string": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"url","spec":"url","status":"current","text":"valid url string","type":"dfn","url":"https://url.spec.whatwg.org/#valid-url-string"},
"https://w3c.github.io/payment-method-id/#dfn-payment-method-identifiers": {"export":true,"for_":[],"level":"","normative":true,"shortname":"payment-method-id","spec":"payment-method-id","status":"anchor-block","text":"payment method identifier","type":"dfn","url":"https://w3c.github.io/payment-method-id/#dfn-payment-method-identifiers"},
"https://w3c.github.io/payment-method-id/#dfn-standardized-payment-method-identifiers": {"export":true,"for_":[],"level":"","normative":true,"shortname":"payment-method-id","spec":"payment-method-id","status":"anchor-block","text":"standardized payment method identifier","type":"dfn","url":"https://w3c.github.io/payment-method-id/#dfn-standardized-payment-method-identifiers"},
"https://w3c.github.io/payment-method-id/#dfn-url-based-payment-method-identifiers": {"export":true,"for_":[],"level":"","normative":true,"shortname":"payment-method-id","spec":"payment-method-id","status":"anchor-block","text":"url-based payment method identifier","type":"dfn","url":"https://w3c.github.io/payment-method-id/#dfn-url-based-payment-method-identifiers"},
"https://w3c.github.io/payment-method-id/#dfn-validate-a-url-based-payment-method-identifier": {"export":true,"for_":[],"level":"","normative":true,"shortname":"payment-method-id","spec":"payment-method-id","status":"anchor-block","text":"validate a url-based payment method identifier","type":"dfn","url":"https://w3c.github.io/payment-method-id/#dfn-validate-a-url-based-payment-method-identifier"},
"https://w3c.github.io/payment-request/#dfn-payment-apps": {"export":true,"for_":[],"level":"","normative":true,"shortname":"payment-request","spec":"payment-request","status":"anchor-block","text":"payment app","type":"dfn","url":"https://w3c.github.io/payment-request/#dfn-payment-apps"},
"https://w3c.github.io/payment-request/#dfn-payment-method": {"export":true,"for_":[],"level":"","normative":true,"shortname":"payment-request","spec":"payment-request","status":"anchor-block","text":"payment method","type":"dfn","url":"https://w3c.github.io/payment-request/#dfn-payment-method"},
"https://w3c.github.io/payment-request/#dfn-paymentrequest-paymentrequest": {"export":true,"for_":["PaymentRequest"],"level":"","normative":true,"shortname":"payment-request","spec":"payment-request","status":"anchor-block","text":"PaymentRequest(methodData, details, options)","type":"constructor","url":"https://w3c.github.io/payment-request/#dfn-paymentrequest-paymentrequest"},
"https://w3c.github.io/payment-request/#dfn-serializedmethoddata": {"export":true,"for_":[],"level":"","normative":true,"shortname":"payment-request","spec":"payment-request","status":"anchor-block","text":"[[serializedmethoddata]]","type":"dfn","url":"https://w3c.github.io/payment-request/#dfn-serializedmethoddata"},
"https://w3c.github.io/payment-request/#dom-paymentrequest": {"export":true,"for_":[],"level":"","normative":true,"shortname":"payment-request","spec":"payment-request","status":"anchor-block","text":"PaymentRequest","type":"interface","url":"https://w3c.github.io/payment-request/#dom-paymentrequest"},
"https://webidl.spec.whatwg.org/#upon-fulfillment": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"upon fulfillment","type":"dfn","url":"https://webidl.spec.whatwg.org/#upon-fulfillment"},
"https://webidl.spec.whatwg.org/#upon-rejection": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"upon rejection","type":"dfn","url":"https://webidl.spec.whatwg.org/#upon-rejection"},
"https://www.w3.org/TR/appmanifest/#dfn-manifest": {"export":true,"for_":[],"level":"","normative":true,"shortname":"appmanifest","spec":"appmanifest","status":"anchor-block","text":"web app manifest","type":"dfn","url":"https://www.w3.org/TR/appmanifest/#dfn-manifest"},
"https://www.w3.org/TR/appmanifest/#dfn-manifest-url": {"export":true,"for_":["web app manifest"],"level":"","normative":true,"shortname":"appmanifest","spec":"appmanifest","status":"anchor-block","text":"url","type":"dfn","url":"https://www.w3.org/TR/appmanifest/#dfn-manifest-url"},
"https://www.w3.org/TR/appmanifest/#dfn-obtaining-the-manifest": {"export":true,"for_":[],"level":"","normative":true,"shortname":"appmanifest","spec":"appmanifest","status":"anchor-block","text":"steps for obtaining a web app manifest","type":"dfn","url":"https://www.w3.org/TR/appmanifest/#dfn-obtaining-the-manifest"},
"https://www.w3.org/TR/appmanifest/#dfn-processed-manifest": {"export":true,"for_":[],"level":"","normative":true,"shortname":"appmanifest","spec":"appmanifest","status":"anchor-block","text":"processed web app manifest","type":"dfn","url":"https://www.w3.org/TR/appmanifest/#dfn-processed-manifest"},
"https://www.w3.org/TR/appmanifest/#dfn-processing-a-manifest": {"export":true,"for_":[],"level":"","normative":true,"shortname":"appmanifest","spec":"appmanifest","status":"anchor-block","text":"steps for processing a web app manifest","type":"dfn","url":"https://www.w3.org/TR/appmanifest/#dfn-processing-a-manifest"},
};

function mkRefHint(link, ref) {
    const linkText = link.textContent;
    let dfnTextElements = '';
    if (ref.text != linkText) {
        dfnTextElements =
            mk.li({},
                mk.b({}, "Term: "),
                mk.span({}, ref.text)
            );
    }
    const forList = ref.for_;
    let forListElements;
    if(forList.length == 0) {
        forListElements = [];
    } else if(forList.length == 1) {
        forListElements = mk.li({},
            mk.b({}, "For: "),
            mk.span({}, forList[0]),
        );
    } else {
        forListElements = mk.li({},
            mk.b({}, "For: "),
            mk.ul({},
                ...forList.map(forItem =>
                    mk.li({},
                        mk.span({}, forItem)
                    ),
                ),
            ),
        );
    }
    const url = ref.url;
    const safeUrl = encodeURIComponent(url);
    const hintPanel = mk.aside({
        class: "ref-hint",
        id: `ref-hint-for-${safeUrl}`,
        "data-for": url,
        "aria-labelled-by": `ref-hint-for-${safeUrl}`,
    },
        mk.ul({},
            dfnTextElements,
            mk.li({},
                mk.b({}, "URL: "),
                mk.a({ href: url, class: "ref" }, url),
            ),
            mk.li({},
                mk.b({}, "Type: "),
                mk.span({}, `${ref.type}`),
            ),
            mk.li({},
                mk.b({}, "Spec: "),
                mk.span({}, `${ref.spec ? ref.spec : ''}`),
            ),
            forListElements
        ),
    );
    hintPanel.forLink = link;
    setupRefHintEventListeners(link, hintPanel);
    return hintPanel;
}

function hideAllRefHints() {
    queryAll(".ref-hint").forEach(el=>hideRefHint(el));
}

function hideRefHint(refHint) {
    const link = refHint.forLink;
    link.setAttribute("aria-expanded", "false");
    if(refHint.teardownEventListeners) {
        refHint.teardownEventListeners();
    }
    refHint.remove();
}

function showRefHint(link) {
    if(link.classList.contains("dfn-link")) return;
    const url = link.getAttribute("href");
    const ref = refsData[url];
    if(!ref) return;

    hideAllRefHints(); // Only display one at this time.

    const refHint = mkRefHint(link, ref);
    append(document.body, refHint);
    link.setAttribute("aria-expanded", "true");
    positionRefHint(refHint);
}

function setupRefHintEventListeners(link, refHint) {
    if (refHint.teardownEventListeners) return;
    // Add event handlers to hide the refHint after the user moves away
    // from both the link and refHint, if not hovering either within one second.
    let timeout = null;
    const startHidingRefHint = (event) => {
        if (timeout) {
            clearTimeout(timeout);
        }
        timeout = setTimeout(() => {
            hideRefHint(refHint);
        }, 1000);
    }
    const resetHidingRefHint = (event) => {
        if (timeout) clearTimeout(timeout);
        timeout = null;
    };
    link.addEventListener("mouseleave", startHidingRefHint);
    link.addEventListener("mouseenter", resetHidingRefHint);
    link.addEventListener("blur", startHidingRefHint);
    link.addEventListener("focus", resetHidingRefHint);
    refHint.addEventListener("mouseleave", startHidingRefHint);
    refHint.addEventListener("mouseenter", resetHidingRefHint);
    refHint.addEventListener("blur", startHidingRefHint);
    refHint.addEventListener("focus", resetHidingRefHint);

    refHint.teardownEventListeners = () => {
        // remove event listeners
        resetHidingRefHint();
        link.removeEventListener("mouseleave", startHidingRefHint);
        link.removeEventListener("mouseenter", resetHidingRefHint);
        link.removeEventListener("blur", startHidingRefHint);
        link.removeEventListener("focus", resetHidingRefHint);
        refHint.removeEventListener("mouseleave", startHidingRefHint);
        refHint.removeEventListener("mouseenter", resetHidingRefHint);
        refHint.removeEventListener("blur", startHidingRefHint);
        refHint.removeEventListener("focus", resetHidingRefHint);
    };
}

function positionRefHint(refHint) {
    const link = refHint.forLink;
    const linkPos = getBounds(link);
    refHint.style.top = linkPos.bottom + "px";
    refHint.style.left = linkPos.left + "px";

    const panelPos = refHint.getBoundingClientRect();
    const panelMargin = 8;
    const maxRight = document.body.parentNode.clientWidth - panelMargin;
    if (panelPos.right > maxRight) {
        const overflowAmount = panelPos.right - maxRight;
        const newLeft = Math.max(panelMargin, linkPos.left - overflowAmount);
        refHint.style.left = newLeft + "px";
    }
}

// TODO: shared util
// Returns the root-level absolute position {left and top} of element.
function getBounds(el, relativeTo=document.body) {
    const relativeRect = relativeTo.getBoundingClientRect();
    const elRect = el.getBoundingClientRect();
    const top = elRect.top - relativeRect.top;
    const left = elRect.left - relativeRect.left;
    return {
        top,
        left,
        bottom: top + elRect.height,
        right: left + elRect.width,
    }
}

function showRefHintListener(e) {
    // If the target isn't in a link (or is a link),
    // just ignore it.
    let link = e.target.closest("a");
    if(!link) return;

    // If the target is in a ref-hint panel
    // (aka a link in the already-open one),
    // also just ignore it.
    if(link.closest(".ref-hint")) return;

    // Otherwise, show the panel for the link.
    showRefHint(link);
}

function hideAllHintsListener(e) {
    // If the click is inside a ref-hint panel, ignore it.
    if(e.target.closest(".ref-hint")) return;
    // Otherwise, close all the current panels.
    hideAllRefHints();
}

document.addEventListener("DOMContentLoaded", () => {
    document.body.addEventListener("mousedown", showRefHintListener);
    document.body.addEventListener("focus", showRefHintListener);

    document.body.addEventListener("click", hideAllHintsListener);
});

window.addEventListener("resize", () => {
    // Hide any open ref hint.
    hideAllRefHints();
});
}
</script>