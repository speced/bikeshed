<!doctype html><html lang="en">
 <head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
  <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
  <title>Document Policy</title>
  <link href="https://www.w3.org/StyleSheets/TR/2016/W3C-ED" rel="stylesheet">
  <link href="https://w3c.github.io/webappsec-feature-policy/document-policy.html" rel="canonical">
<style>/* style-autolinks */

.css.css, .property.property, .descriptor.descriptor {
    color: var(--a-normal-text);
    font-size: inherit;
    font-family: inherit;
}
.css::before, .property::before, .descriptor::before {
    content: "‘";
}
.css::after, .property::after, .descriptor::after {
    content: "’";
}
.property, .descriptor {
    /* Don't wrap property and descriptor names */
    white-space: nowrap;
}
.type { /* CSS value <type> */
    font-style: italic;
}
pre .property::before, pre .property::after {
    content: "";
}
[data-link-type="property"]::before,
[data-link-type="propdesc"]::before,
[data-link-type="descriptor"]::before,
[data-link-type="value"]::before,
[data-link-type="function"]::before,
[data-link-type="at-rule"]::before,
[data-link-type="selector"]::before,
[data-link-type="maybe"]::before {
    content: "‘";
}
[data-link-type="property"]::after,
[data-link-type="propdesc"]::after,
[data-link-type="descriptor"]::after,
[data-link-type="value"]::after,
[data-link-type="function"]::after,
[data-link-type="at-rule"]::after,
[data-link-type="selector"]::after,
[data-link-type="maybe"]::after {
    content: "’";
}

[data-link-type].production::before,
[data-link-type].production::after,
.prod [data-link-type]::before,
.prod [data-link-type]::after {
    content: "";
}

[data-link-type=element],
[data-link-type=element-attr] {
    font-family: Menlo, Consolas, "DejaVu Sans Mono", monospace;
    font-size: .9em;
}
[data-link-type=element]::before { content: "<" }
[data-link-type=element]::after  { content: ">" }

[data-link-type=biblio] {
    white-space: pre;
}</style>
<style>/* style-colors */

/* Any --*-text not paired with a --*-bg is assumed to have a transparent bg */
:root {
    color-scheme: light dark;

    --text: black;
    --bg: white;

    --unofficial-watermark: url(https://www.w3.org/StyleSheets/TR/2016/logos/UD-watermark);

    --logo-bg: #1a5e9a;
    --logo-active-bg: #c00;
    --logo-text: white;

    --tocnav-normal-text: #707070;
    --tocnav-normal-bg: var(--bg);
    --tocnav-hover-text: var(--tocnav-normal-text);
    --tocnav-hover-bg: #f8f8f8;
    --tocnav-active-text: #c00;
    --tocnav-active-bg: var(--tocnav-normal-bg);

    --tocsidebar-text: var(--text);
    --tocsidebar-bg: #f7f8f9;
    --tocsidebar-shadow: rgba(0,0,0,.1);
    --tocsidebar-heading-text: hsla(203,20%,40%,.7);

    --toclink-text: var(--text);
    --toclink-underline: #3980b5;
    --toclink-visited-text: var(--toclink-text);
    --toclink-visited-underline: #054572;

    --heading-text: #005a9c;

    --hr-text: var(--text);

    --algo-border: #def;

    --del-text: red;
    --del-bg: transparent;
    --ins-text: #080;
    --ins-bg: transparent;

    --a-normal-text: #034575;
    --a-normal-underline: #707070;
    --a-visited-text: var(--a-normal-text);
    --a-visited-underline: #bbb;
    --a-hover-bg: rgba(75%, 75%, 75%, .25);
    --a-active-text: #c00;
    --a-active-underline: #c00;

    --blockquote-border: silver;
    --blockquote-bg: transparent;
    --blockquote-text: currentcolor;

    --issue-border: #e05252;
    --issue-bg: #fbe9e9;
    --issue-text: var(--text);
    --issueheading-text: #831616;

    --example-border: #e0cb52;
    --example-bg: #fcfaee;
    --example-text: var(--text);
    --exampleheading-text: #574b0f;

    --note-border: #52e052;
    --note-bg: #e9fbe9;
    --note-text: var(--text);
    --noteheading-text: hsl(120, 70%, 30%);
    --notesummary-underline: silver;

    --assertion-border: #aaa;
    --assertion-bg: #eee;
    --assertion-text: black;

    --advisement-border: orange;
    --advisement-bg: #fec;
    --advisement-text: var(--text);
    --advisementheading-text: #b35f00;

    --warning-border: red;
    --warning-bg: hsla(40,100%,50%,0.95);
    --warning-text: var(--text);

    --amendment-border: #330099;
    --amendment-bg: #F5F0FF;
    --amendment-text: var(--text);
    --amendmentheading-text: #220066;

    --def-border: #8ccbf2;
    --def-bg: #def;
    --def-text: var(--text);
    --defrow-border: #bbd7e9;

    --datacell-border: silver;

    --indexinfo-text: #707070;

    --indextable-hover-text: black;
    --indextable-hover-bg: #f7f8f9;

    --outdatedspec-bg: rgba(0, 0, 0, .5);
    --outdatedspec-text: black;
    --outdated-bg: maroon;
    --outdated-text: white;
    --outdated-shadow: red;

    --editedrec-bg: darkorange;
}</style>
<style>/* style-counters */

body {
    counter-reset: example figure issue;
}
.issue {
    counter-increment: issue;
}
.issue:not(.no-marker)::before {
    content: "Issue " counter(issue);
}

.example {
    counter-increment: example;
}
.example:not(.no-marker)::before {
    content: "Example " counter(example);
}
.invalid.example:not(.no-marker)::before,
.illegal.example:not(.no-marker)::before {
    content: "Invalid Example" counter(example);
}

figcaption {
    counter-increment: figure;
}
figcaption:not(.no-marker)::before {
    content: "Figure " counter(figure) " ";
}</style>
<style>/* style-dfn-panel */

:root {
    --dfnpanel-bg: #ddd;
    --dfnpanel-text: var(--text);
}
.dfn-panel {
    position: absolute;
    z-index: 35;
    height: auto;
    width: -webkit-fit-content;
    width: fit-content;
    max-width: 300px;
    max-height: 500px;
    overflow: auto;
    padding: 0.5em 0.75em;
    font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
    background: var(--dfnpanel-bg);
    color: var(--dfnpanel-text);
    border: outset 0.2em;
}
.dfn-panel:not(.on) { display: none; }
.dfn-panel * { margin: 0; padding: 0; text-indent: 0; }
.dfn-panel > b { display: block; }
.dfn-panel a { color: var(--dfnpanel-text); }
.dfn-panel a:not(:hover) { text-decoration: none !important; border-bottom: none !important; }
.dfn-panel > b + b { margin-top: 0.25em; }
.dfn-panel ul { padding: 0; }
.dfn-panel li { list-style: inside; }
.dfn-panel.activated {
    display: inline-block;
    position: fixed;
    left: .5em;
    bottom: 2em;
    margin: 0 auto;
    max-width: calc(100vw - 1.5em - .4em - .5em);
    max-height: 30vh;
}

.dfn-paneled { cursor: pointer; }
</style>
<style>/* style-md-lists */

/* This is a weird hack for me not yet following the commonmark spec
   regarding paragraph and lists. */
[data-md] > :first-child {
    margin-top: 0;
}
[data-md] > :last-child {
    margin-bottom: 0;
}</style>
<style>/* style-selflinks */

:root {
    --selflink-text: white;
    --selflink-bg: gray;
    --selflink-hover-text: black;
}
.heading, .issue, .note, .example, li, dt {
    position: relative;
}
a.self-link {
    position: absolute;
    top: 0;
    left: calc(-1 * (3.5rem - 26px));
    width: calc(3.5rem - 26px);
    height: 2em;
    text-align: center;
    border: none;
    transition: opacity .2s;
    opacity: .5;
}
a.self-link:hover {
    opacity: 1;
}
.heading > a.self-link {
    font-size: 83%;
}
li > a.self-link {
    left: calc(-1 * (3.5rem - 26px) - 2em);
}
dfn > a.self-link {
    top: auto;
    left: auto;
    opacity: 0;
    width: 1.5em;
    height: 1.5em;
    background: var(--selflink-bg);
    color: var(--selflink-text);
    font-style: normal;
    transition: opacity .2s, background-color .2s, color .2s;
}
dfn:hover > a.self-link {
    opacity: 1;
}
dfn > a.self-link:hover {
    color: var(--selflink-hover-text);
}

a.self-link::before            { content: "¶"; }
.heading > a.self-link::before { content: "§"; }
dfn > a.self-link::before      { content: "#"; }
</style>
<style>/* style-var-click-highlighting */

    var { cursor: pointer; }
    var.selected0 { background-color: #F4D200; box-shadow: 0 0 0 2px #F4D200; }
    var.selected1 { background-color: #FF87A2; box-shadow: 0 0 0 2px #FF87A2; }
    var.selected2 { background-color: #96E885; box-shadow: 0 0 0 2px #96E885; }
    var.selected3 { background-color: #3EEED2; box-shadow: 0 0 0 2px #3EEED2; }
    var.selected4 { background-color: #EACFB6; box-shadow: 0 0 0 2px #EACFB6; }
    var.selected5 { background-color: #82DDFF; box-shadow: 0 0 0 2px #82DDFF; }
    var.selected6 { background-color: #FFBCF2; box-shadow: 0 0 0 2px #FFBCF2; }
    </style>
<style>/* style-darkmode */

@media (prefers-color-scheme: dark) {
    :root {
        --text: #ddd;
        --bg: black;

        --unofficial-watermark: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='400'%3E%3Cg fill='%23100808' transform='translate(200 200) rotate(-45) translate(-200 -200)' stroke='%23100808' stroke-width='3'%3E%3Ctext x='50%25' y='220' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EUNOFFICIAL%3C/text%3E%3Ctext x='50%25' y='305' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EDRAFT%3C/text%3E%3C/g%3E%3C/svg%3E");

        --logo-bg: #1a5e9a;
        --logo-active-bg: #c00;
        --logo-text: white;

        --tocnav-normal-text: #999;
        --tocnav-normal-bg: var(--bg);
        --tocnav-hover-text: var(--tocnav-normal-text);
        --tocnav-hover-bg: #080808;
        --tocnav-active-text: #f44;
        --tocnav-active-bg: var(--tocnav-normal-bg);

        --tocsidebar-text: var(--text);
        --tocsidebar-bg: #080808;
        --tocsidebar-shadow: rgba(255,255,255,.1);
        --tocsidebar-heading-text: hsla(203,20%,40%,.7);

        --toclink-text: var(--text);
        --toclink-underline: #6af;
        --toclink-visited-text: var(--toclink-text);
        --toclink-visited-underline: #054572;

        --heading-text: #8af;

        --hr-text: var(--text);

        --algo-border: #456;

        --del-text: #f44;
        --del-bg: transparent;
        --ins-text: #4a4;
        --ins-bg: transparent;

        --a-normal-text: #6af;
        --a-normal-underline: #555;
        --a-visited-text: var(--a-normal-text);
        --a-visited-underline: var(--a-normal-underline);
        --a-hover-bg: rgba(25%, 25%, 25%, .2);
        --a-active-text: #f44;
        --a-active-underline: var(--a-active-text);

        --borderedblock-bg: rgba(255, 255, 255, .05);

        --blockquote-border: silver;
        --blockquote-bg: var(--borderedblock-bg);
        --blockquote-text: currentcolor;

        --issue-border: #e05252;
        --issue-bg: var(--borderedblock-bg);
        --issue-text: var(--text);
        --issueheading-text: hsl(0deg, 70%, 70%);

        --example-border: hsl(50deg, 90%, 60%);
        --example-bg: var(--borderedblock-bg);
        --example-text: var(--text);
        --exampleheading-text: hsl(50deg, 70%, 70%);

        --note-border: hsl(120deg, 100%, 35%);
        --note-bg: var(--borderedblock-bg);
        --note-text: var(--text);
        --noteheading-text: hsl(120, 70%, 70%);
        --notesummary-underline: silver;

        --assertion-border: #444;
        --assertion-bg: var(--borderedblock-bg);
        --assertion-text: var(--text);

        --advisement-border: orange;
        --advisement-bg: #222218;
        --advisement-text: var(--text);
        --advisementheading-text: #f84;

        --warning-border: red;
        --warning-bg: hsla(40,100%,20%,0.95);
        --warning-text: var(--text);

        --amendment-border: #330099;
        --amendment-bg: #080010;
        --amendment-text: var(--text);
        --amendmentheading-text: #cc00ff;

        --def-border: #8ccbf2;
        --def-bg: #080818;
        --def-text: var(--text);
        --defrow-border: #136;

        --datacell-border: silver;

        --indexinfo-text: #aaa;

        --indextable-hover-text: var(--text);
        --indextable-hover-bg: #181818;

        --outdatedspec-bg: rgba(255, 255, 255, .5);
        --outdatedspec-text: black;
        --outdated-bg: maroon;
        --outdated-text: white;
        --outdated-shadow: red;

        --editedrec-bg: darkorange;
    }
    /* In case a transparent-bg image doesn't expect to be on a dark bg,
       which is quite common in practice... */
    img { background: white; }
}
@media (prefers-color-scheme: dark) {
    :root {
        --selflink-text: black;
        --selflink-bg: silver;
        --selflink-hover-text: white;
    }
}

@media (prefers-color-scheme: dark) {
    :root {
        --dfnpanel-bg: #222;
        --dfnpanel-text: var(--text);
    }
}</style>
 <body class="h-entry">
  <div class="head">
   <p data-fill-with="logo"><a class="logo" href="https://www.w3.org/"> <img alt="W3C" height="48" src="https://www.w3.org/StyleSheets/TR/2016/logos/W3C" width="72"> </a> </p>
   <h1 class="p-name no-ref" id="title">Document Policy</h1>
   <h2 class="no-num no-toc no-ref heading settled" id="subtitle"><span class="content">Editor’s Draft, <time class="dt-updated" datetime="1970-01-01">1 January 1970</time></span></h2>
   <div data-fill-with="spec-metadata">
    <dl>
     <dt>This version:
     <dd><a class="u-url" href="https://w3c.github.io/webappsec-feature-policy/document-policy.html">https://w3c.github.io/webappsec-feature-policy/document-policy.html</a>
     <dt>Feedback:
     <dd><span><a href="mailto:public-webappsec@w3.org?subject=%5Bdocument-policy%5D%20YOUR%20TOPIC%20HERE">public-webappsec@w3.org</a> with subject line “<kbd>[document-policy] <i data-lt>… message topic …</i></kbd>” (<a href="https://lists.w3.org/Archives/Public/public-webappsec/" rel="discussion">archives</a>)</span>
     <dt class="editor">Editor:
     <dd class="editor p-author h-card vcard"><a class="p-name fn u-email email" href="mailto:iclelland@google.com">Ian Clelland</a> (<span class="p-org org">Google</span>)
    </dl>
   </div>
   <div data-fill-with="warning"></div>
   <p class="copyright" data-fill-with="copyright"><a href="https://www.w3.org/Consortium/Legal/ipr-notice#Copyright">Copyright</a> © 1970 <a href="https://www.w3.org/"><abbr title="World Wide Web Consortium">W3C</abbr></a><sup>®</sup> (<a href="https://www.csail.mit.edu/"><abbr title="Massachusetts Institute of Technology">MIT</abbr></a>, <a href="https://www.ercim.eu/"><abbr title="European Research Consortium for Informatics and Mathematics">ERCIM</abbr></a>, <a href="https://www.keio.ac.jp/">Keio</a>, <a href="https://ev.buaa.edu.cn/">Beihang</a>). W3C <a href="https://www.w3.org/Consortium/Legal/ipr-notice#Legal_Disclaimer">liability</a>, <a href="https://www.w3.org/Consortium/Legal/ipr-notice#W3C_Trademarks">trademark</a> and <a href="https://www.w3.org/Consortium/Legal/copyright-documents">document use</a> rules apply. </p>
   <hr title="Separator for header">
  </div>
  <div class="p-summary" data-fill-with="abstract">
   <h2 class="no-num no-toc no-ref heading settled" id="abstract"><span class="content">Abstract</span></h2>
   <p>This specification defines a mechanism that allows developers to ...</p>
  </div>
  <h2 class="no-num no-toc no-ref heading settled" id="status"><span class="content">Status of this document</span></h2>
  <div data-fill-with="status">
   <p> This is a public copy of the editors’ draft.
	It is provided for discussion only and may change at any moment.
	Its publication here does not imply endorsement of its contents by W3C.
	Don’t cite this document other than as work in progress. </p>
   <p> <strong>Changes to this document may be tracked at <a href="https://github.com/w3c/webappsec">https://github.com/w3c/webappsec</a>.</strong> </p>
   <p> The (<a href="https://lists.w3.org/Archives/Public/public-webappsec/">archived</a>) public mailing list <a href="mailto:public-webappsec@w3.org?Subject=%5Bdocument-policy%5D%20PUT%20SUBJECT%20HERE">public-webappsec@w3.org</a> (see <a href="https://www.w3.org/Mail/Request">instructions</a>)
	is preferred for discussion of this specification.
	When sending e-mail,
	please put the text “document-policy” in the subject,
	preferably like this:
	“[document-policy] <em>…summary of comment…</em>” </p>
   <p> This document was produced by the <a href="https://www.w3.org/2011/webappsec/">Web Application Security Working Group</a>. </p>
   <p> This document was produced by a group operating under
	the <a href="https://www.w3.org/Consortium/Patent-Policy-20170801/">W3C Patent Policy</a>.
	W3C maintains a <a href="https://www.w3.org/2004/01/pp-impl/49309/status" rel="disclosure">public list of any patent disclosures</a> made in connection with the deliverables of the group;
	that page also includes instructions for disclosing a patent.
	An individual who has actual knowledge of a patent which the individual believes contains <a href="https://www.w3.org/Consortium/Patent-Policy-20170801/#def-essential">Essential Claim(s)</a> must disclose the information in accordance with <a href="https://www.w3.org/Consortium/Patent-Policy-20170801/#sec-Disclosure">section 6 of the W3C Patent Policy</a>. </p>
   <p> This document is governed by the <a href="https://www.w3.org/2020/Process-20200915/" id="w3c_process_revision">15 September 2020 W3C Process Document</a>. </p>
   <p></p>
  </div>
  <div data-fill-with="at-risk"></div>
  <nav data-fill-with="table-of-contents" id="toc">
   <h2 class="no-num no-toc no-ref" id="contents">Table of Contents</h2>
   <ol class="toc" role="directory">
    <li><a href="#introduction"><span class="secno">1</span> <span class="content">Introduction</span></a>
    <li><a href="#examples"><span class="secno">2</span> <span class="content">Examples #</span></a>
    <li>
     <a href="#other-and-related-mechanisms"><span class="secno">3</span> <span class="content">Other and related mechanisms</span></a>
     <ol class="toc">
      <li><a href="#relation-to-feature-policy"><span class="secno">3.1</span> <span class="content">Relation to Feature Policy</span></a>
      <li><a href="#relation-to-csp"><span class="secno">3.2</span> <span class="content">Relation to Content Security Policy</span></a>
      <li><a href="#relation-to-sandboxing"><span class="secno">3.3</span> <span class="content">Relation to Sandboxing</span></a>
     </ol>
    <li>
     <a href="#framework"><span class="secno">4</span> <span class="content">Framework</span></a>
     <ol class="toc">
      <li>
       <a href="#features"><span class="secno">4.1</span> <span class="content">Features</span></a>
       <ol class="toc">
        <li><a href="#directives"><span class="secno">4.1.1</span> <span class="content">Directives</span></a>
       </ol>
      <li><a href="#policies"><span class="secno">4.2</span> <span class="content">Policies</span></a>
      <li><a href="#values"><span class="secno">4.3</span> <span class="content">Values</span></a>
      <li><a href="#default-values"><span class="secno">4.4</span> <span class="content">Default Values</span></a>
     </ol>
    <li><a href="#serialization"><span class="secno">5</span> <span class="content">Required Policy Serialization</span></a>
    <li>
     <a href="#reporting"><span class="secno">6</span> <span class="content">Reporting</span></a>
     <ol class="toc">
      <li>
       <a href="#configure-reporting"><span class="secno">6.1</span> <span class="content">Configuring in-document reporting</span></a>
       <ol class="toc">
        <li><a href="#report-to-parameter"><span class="secno">6.1.1</span> <span class="content">The "report-to" parameter</span></a>
        <li><a href="#reporting-default"><span class="secno">6.1.2</span> <span class="content">Setting the default reporting endpoint</span></a>
        <li><a href="#reporting-disable"><span class="secno">6.1.3</span> <span class="content">Disabling reporting for a feature</span></a>
       </ol>
      <li><a href="#report-only"><span class="secno">6.2</span> <span class="content">Report-only mode</span></a>
     </ol>
    <li>
     <a href="#delivery"><span class="secno">7</span> <span class="content">Delivery</span></a>
     <ol class="toc">
      <li>
       <a href="#policies-as-structured-headers"><span class="secno">7.1</span> <span class="content">Policies as Structured Headers</span></a>
       <ol class="toc">
        <li><a href="#boolean-valued-features"><span class="secno">7.1.1</span> <span class="content">Boolean-valued features</span></a>
        <li><a href="#integer-valued-features"><span class="secno">7.1.2</span> <span class="content">Integer-valued features</span></a>
        <li><a href="#float-valued-features"><span class="secno">7.1.3</span> <span class="content">Float-valued features</span></a>
        <li><a href="#enum-valued-features"><span class="secno">7.1.4</span> <span class="content">Enum-valued features</span></a>
       </ol>
      <li>
       <a href="#http-headers"><span class="secno">7.2</span> <span class="content">HTTP Headers</span></a>
       <ol class="toc">
        <li><a href="#document-policy-http-header"><span class="secno">7.2.1</span> <span class="content">Document-Policy</span></a>
        <li><a href="#document-policy-report-only-http-header"><span class="secno">7.2.2</span> <span class="content">Document-Policy-Report-Only</span></a>
        <li><a href="#require-document-policy-http-header"><span class="secno">7.2.3</span> <span class="content">Require-Document-Policy</span></a>
        <li><a href="#sec-required-document-policy-http-header"><span class="secno">7.2.4</span> <span class="content">Sec-Required-Document-Policy</span></a>
       </ol>
      <li><a href="#iframe-policy-attribute"><span class="secno">7.3</span> <span class="content">The <code>policy</code> attribute of the <code>iframe</code> element</span></a>
     </ol>
    <li>
     <a href="#integrations"><span class="secno">8</span> <span class="content">Integrations</span></a>
     <ol class="toc">
      <li><a href="#integration-with-html"><span class="secno">8.1</span> <span class="content">Integration with HTML</span></a>
      <li><a href="#integration-with-fetch"><span class="secno">8.2</span> <span class="content">Integration with Fetch</span></a>
     </ol>
    <li>
     <a href="#algorithms"><span class="secno">9</span> <span class="content">Algorithms</span></a>
     <ol class="toc">
      <li><a href="#algo-is-policy-compatible"><span class="secno">9.1</span> <span class="content"><span>Is policy compatible</span>?</span></a>
      <li><a href="#algo-process-response-policy"><span class="secno">9.2</span> <span class="content"><span>Process response policy</span></span></a>
      <li><a href="#algo-parse-document-policy"><span class="secno">9.3</span> <span class="content"><span>Parse document policy</span></span></a>
      <li><a href="#algo-serialize-required-policy"><span class="secno">9.4</span> <span class="content"><span>Serialize required policy</span></span></a>
      <li><a href="#algo-create-for-browsingcontext"><span class="secno">9.5</span> <span class="content"><span>Create a required policy for a browsing context</span></span></a>
      <li><a href="#algo-create-document-policy"><span class="secno">9.6</span> <span class="content"><span>Create a document Policy for a browsing context from response</span></span></a>
      <li><a href="#algo-should-reponse-to-request-be-blocked"><span class="secno">9.7</span> <span class="content"><span>Should response to request be blocked due to document policy</span>?</span></a>
      <li><a href="#algo-get-policy-value"><span class="secno">9.8</span> <span class="content"><span>Get policy value for feature in document</span></span></a>
      <li><a href="#algo-determine-compatibility"><span class="secno">9.9</span> <span class="content"><span>Determine compatibility of value with policy for feature</span></span></a>
      <li><a href="#algo-is-value-compatible-or-report"><span class="secno">9.10</span> <span class="content"><span>Determine if value is compatible with policy for feature or report</span></span></a>
      <li><a href="#algo-is-value-compatible"><span class="secno">9.11</span> <span class="content"><span>Determine if value is compatible with policy for feature</span></span></a>
     </ol>
    <li><a href="#iana-considerations"><span class="secno">10</span> <span class="content">IANA Considerations</span></a>
    <li>
     <a href="#privacy-and-security"><span class="secno">11</span> <span class="content">Privacy and Security</span></a>
     <ol class="toc">
      <li><a href="#exposure-of-cross-origin-behavior"><span class="secno">11.1</span> <span class="content">Exposure of cross-origin behavior {#exposure-of-cross-origin-behavior}</span></a>
      <li><a href="#unanticipated-behavior-changes"><span class="secno">11.2</span> <span class="content">Unanticipated behavior changes</span></a>
      <li><a href="#advertisement-of-required-policy"><span class="secno">11.3</span> <span class="content">Advertisement of required policy</span></a>
     </ol>
    <li>
     <a href="#conformance"><span class="secno"></span> <span class="content">Conformance</span></a>
     <ol class="toc">
      <li><a href="#conventions"><span class="secno"></span> <span class="content">Document conventions</span></a>
      <li><a href="#conformant-algorithms"><span class="secno"></span> <span class="content">Conformant Algorithms</span></a>
     </ol>
    <li>
     <a href="#index"><span class="secno"></span> <span class="content">Index</span></a>
     <ol class="toc">
      <li><a href="#index-defined-here"><span class="secno"></span> <span class="content">Terms defined by this specification</span></a>
      <li><a href="#index-defined-elsewhere"><span class="secno"></span> <span class="content">Terms defined by reference</span></a>
     </ol>
    <li>
     <a href="#references"><span class="secno"></span> <span class="content">References</span></a>
     <ol class="toc">
      <li><a href="#normative"><span class="secno"></span> <span class="content">Normative References</span></a>
      <li><a href="#informative"><span class="secno"></span> <span class="content">Informative References</span></a>
     </ol>
   </ol>
  </nav>
  <main>
   <section>
    <h2 class="heading settled" data-level="1" id="introduction"><span class="secno">1. </span><span class="content">Introduction</span><a class="self-link" href="#introduction"></a></h2>
    <p>This document defines <em>Document Policy</em>, which is a framework for
  designing configurable features as part of the web platform, and for allowing
  web developers to configure those features as part of their site deployment.</p>
   </section>
   <section>
    <h2 class="heading settled" data-level="2" id="examples"><span class="secno">2. </span><span class="content">Examples #</span><a class="self-link" href="#examples"></a></h2>
    <p>Needs new examples. For now, see explainer.</p>
   </section>
   <section>
    <h2 class="heading settled" data-level="3" id="other-and-related-mechanisms"><span class="secno">3. </span><span class="content">Other and related mechanisms</span><a class="self-link" href="#other-and-related-mechanisms"></a></h2>
    <p>Document Policy is similar in scope to some existing mechanisms for document
  configuration, though there are significant differences from each.</p>
    <section>
     <h3 class="heading settled" data-level="3.1" id="relation-to-feature-policy"><span class="secno">3.1. </span><span class="content">Relation to Feature Policy</span><a class="self-link" href="#relation-to-feature-policy"></a></h3>
     <p>Feature Policy <a data-link-type="biblio" href="#biblio-feature-policy">[FEATURE-POLICY]</a> is another mechanism which allows authors
    to configure features in documents, and is similar in scope, though it uses
    a different inheritance mechanism, which makes it more suitable for certain
    types of features, separate from those which are suitable for control by
    document policy.</p>
     <p>Historically, document policy was created as a response to a number of
    proposed feature additions to feature policy, which either didn’t quite fit
    the existing 'feature' model, or required significant additional complexity
    to be added to the feature policy spec. This included features with
    parameters, features with optional inheritance into subframes, and features
    which would inherit differently in popups than in other top-level browsing
    contexts.</p>
     <p>Those features are now proposed to be covered by document policy, and
    feature policy is used for features where delegation is the primary concern.
    Feature policy features are boolean-valued (either enabled or disabled), can
    never be re-enabled in a child frame if disabled in parent, and generally
    follow the model of "available in top-level browsing contexts and their
    same-origin children; must be delegated to cross-origin frames."</p>
     <p>In contrast, features controlled by document policy may take parameters, and
    those parameters may have unrelated values in different frames (constraining
    a feature in a parent frame does not necessarily constrain its child
    frames.)</p>
    </section>
    <section>
     <h3 class="heading settled" data-level="3.2" id="relation-to-csp"><span class="secno">3.2. </span><span class="content">Relation to Content Security Policy</span><a class="self-link" href="#relation-to-csp"></a></h3>
     <p>Content-Security-Policy <a data-link-type="biblio" href="#biblio-csp">[CSP]</a> also configures 'features' in documents,
    although it is primarily concerned with the origin of resources in a page,
    rather than controlling what those resources can do once loaded.</p>
     <p>CSP also provides a different mechanism for setting sandbox flags on a
    document, through the <em>sandbox</em> directive. If sandbox flags are moved
    to document policy, then this may be redundant, as the two headers may
    encode identical information.</p>
     <p>CSP-Embedded-Enforcement introduced a model for forcing a policy to be
    adhered to by child documents, and for rejecting non-conforming documents as
    network errors during Fetch. This model is adopted by document policy for
    the required policy mechanism.</p>
    </section>
    <section>
     <h3 class="heading settled" data-level="3.3" id="relation-to-sandboxing"><span class="secno">3.3. </span><span class="content">Relation to Sandboxing</span><a class="self-link" href="#relation-to-sandboxing"></a></h3>
     <p>Iframe sandboxing is another mechanism for controlling features in
    documents, and behaves in a very similar manner to document policy’s
    required policies: disabling a feature is something that can be imposed on
    a frame, and affects all content loaded into that frame.</p>
     <p>The features which are controlled by the iframe sandbox attribute could be
    expressed very naturally with document policy.</p>
     <p>One key difference between iframe sandboxing and document policy is that all
    sandbox features are applied by default when the 'sandbox' attribute is used
    on a frame, and must be re-enabled one-by-one. This makes it very difficult
    to extend the sandboxing model with new features, as any additions will
    immediately affect all existing sandboxed content. Additionally, there is no
    mechanism for the origin server to know that its content will be sandboxed,
    so it is difficult to add new sandbox features which could potentially alter
    control flow in a sandboxed document, as this could introduce new security
    vulnerabilities in existing content.</p>
    </section>
   </section>
   <section>
    <h2 class="heading settled" data-level="4" id="framework"><span class="secno">4. </span><span class="content">Framework</span><a class="self-link" href="#framework"></a></h2>
    <section>
     <h3 class="heading settled" data-level="4.1" id="features"><span class="secno">4.1. </span><span class="content">Features</span><a class="self-link" href="#features"></a></h3>
     <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-export data-lt="document policy feature" id="document-policy-feature">feature</dfn> is
    defined by</p>
     <ul>
      <li data-md>
       <p>A name, which is a token,</p>
      <li data-md>
       <p>A value type, which is either <code>boolean</code>, <code>integer</code>, <code>float</code>, or <code>enum</code>,</p>
      <li data-md>
       <p>A value range, which is a subset of the possible values for the feature’s
type, and</p>
      <li data-md>
       <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="default-value">default value</dfn>, which is an element of the feature’s value
range.</p>
      <li data-md>
       <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="requires-acknowledgment">requires acknowledgment</dfn> flag, which is either <code>yes</code> or <code>no</code>.</p>
     </ul>
     <div class="informative"> When introducing a new feature, the default value should be chosen
    carefully, with highest consideration given to web compatibility. When no
    explicit policy has been declared for a document, the default value will be
    in effect. </div>
    </section>
    <section>
     <h4 class="heading settled" data-level="4.1.1" id="directives"><span class="secno">4.1.1. </span><span class="content">Directives</span><a class="self-link" href="#directives"></a></h4>
     <p>A <dfn data-dfn-type="dfn" data-export data-lt="document policy directive" id="document-policy-directive">directive<a class="self-link" href="#document-policy-directive"></a></dfn> is an
    element of a <a data-link-type="dfn" href="#document-policy" id="ref-for-document-policy">document policy</a>, and consists of a <a data-link-type="dfn" href="#directive-name" id="ref-for-directive-name">directive name</a> and optional parameters.</p>
     <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="directive-name">directive name</dfn> may be one of:</p>
     <ul>
      <li data-md>
       <p>A <a data-link-type="dfn" href="#document-policy-feature" id="ref-for-document-policy-feature">document policy feature</a> name,</p>
      <li data-md>
       <p>A <a data-link-type="dfn" href="#document-policy-feature" id="ref-for-document-policy-feature①">document policy feature</a> name, prefixed by "no-", if it is the
name of a boolean feature, or</p>
      <li data-md>
       <p>The token "<code>*</code>".</p>
     </ul>
     <p>Directive parameters are defined per-directive.</p>
    </section>
    <section>
     <h3 class="heading settled" data-level="4.2" id="policies"><span class="secno">4.2. </span><span class="content">Policies</span><a class="self-link" href="#policies"></a></h3>
     <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="document-policy">document policy</dfn> is an ordered map from <a data-link-type="dfn" href="https://w3c.github.io/webappsec-permissions-policy/#policy-controlled-feature" id="ref-for-policy-controlled-feature">features</a> to <a data-link-type="dfn" href="#policy-configuration" id="ref-for-policy-configuration">policy
    configurations</a></p>
     <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="policy-configuration">policy configuration</dfn> is a tuple consisting of a <dfn class="dfn-paneled" data-dfn-for="policy configuration" data-dfn-type="dfn" data-noexport id="policy-configuration-value">value</dfn> and a <dfn class="dfn-paneled" data-dfn-for="policy configuration" data-dfn-type="dfn" data-noexport id="policy-configuration-reporting-endpoint">reporting endpoint</dfn>, which is a string, and
    which may be null.</p>
     <p>A <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#browsing-context" id="ref-for-browsing-context">browsing context</a> has a <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="required-document-policy">required document policy</dfn>, which
    is a <a data-link-type="dfn" href="#document-policy" id="ref-for-document-policy①">document policy</a>. A <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#browsing-context" id="ref-for-browsing-context①">browsing context</a> with a null <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#opener-browsing-context" id="ref-for-opener-browsing-context">opener
    browsing context</a> has an empty <a data-link-type="dfn" href="#required-document-policy" id="ref-for-required-document-policy">required document policy</a>.</p>
     <p>A <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#browsing-context" id="ref-for-browsing-context②">browsing context</a> has a <dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="nested context required document policy" data-noexport id="nested-context-required-document-policy">nested context required document
    policy</dfn>, which is a <a data-link-type="dfn" href="#document-policy" id="ref-for-document-policy②">document policy</a>.</p>
     <p>A <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-document" id="ref-for-concept-document">Document</a> has a <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="declared-document-policy">declared document policy</dfn>, which is a <a data-link-type="dfn" href="#document-policy" id="ref-for-document-policy③">document policy</a>.</p>
     <p>A <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-document" id="ref-for-concept-document①">Document</a> has a <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="report-only-document-policy">report-only document policy</dfn>, which is a <a data-link-type="dfn" href="#document-policy" id="ref-for-document-policy④">document policy</a>.</p>
    </section>
    <section>
     <h3 class="heading settled" data-level="4.3" id="values"><span class="secno">4.3. </span><span class="content">Values</span><a class="self-link" href="#values"></a></h3>
     <ul>
      <li data-md>
       <p>Policies have values for features</p>
      <li data-md>
       <p>Values have domains</p>
      <li data-md>
       <p>Domains have ordering</p>
      <li data-md>
       <p>Examples: positive ints, floats, bools, enums</p>
     </ul>
    </section>
    <section>
     <h3 class="heading settled" data-level="4.4" id="default-values"><span class="secno">4.4. </span><span class="content">Default Values</span><a class="self-link" href="#default-values"></a></h3>
     <ul>
      <li data-md>
       <p>features have default values.</p>
      <li data-md>
       <p>(Non-normative) Defaults are chosen for web compatibility.</p>
     </ul>
    </section>
   </section>
   <section>
    <h2 class="heading settled" data-level="5" id="serialization"><span class="secno">5. </span><span class="content">Required Policy Serialization</span><a class="self-link" href="#serialization"></a></h2>
    <section>
     <ul>
      <li data-md>
       <p>Explain here how required policies are <dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="serialized document policy" data-noexport id="serialized-document-policy">serialized</dfn> as structured
headers.</p>
      <li data-md>
       <p>Ensure that there is a canonical form (for compat testing).</p>
     </ul>
    </section>
   </section>
   <section>
    <h2 class="heading settled" data-level="6" id="reporting"><span class="secno">6. </span><span class="content">Reporting</span><a class="self-link" href="#reporting"></a></h2>
    <p>A site deploying a document policy may want to know if any of the policies
  which are set on its pages are violated. For instance, a site which sets a
  policy requiring all images to be match the size of their containers may want
  to be alerted if a new developer or CMS inserts oversized images into content.
  Similarly, a site which deploys a policy which restricts the use of the <code>document.write</code> API may want to receive reports if a script is ever imported
  which uses it.</p>
    <p>This section defines a mechanism for reporting such violations using the
  Reporting API. <a data-link-type="biblio" href="#biblio-reporting">[REPORTING]</a></p>
    <p>A site may also want to test out a policy in real-world situations before
  enforcing it. This section also defines a "Report-only" mode, where the user
  agent can watch for situations which would be policy violations and report on
  them, without enforcing the policy. This allows site owners to work to drive
  the real-world violation count down to an acceptable level before actually
  deploying the policy.</p>
    <p>Reporting is only possible from the page which configures the policy. It is
  not possible to receive reports from a nested page which violates a required
  policy.</p>
    <p>"Violation" is defined per-feature, but should always reflect an action of the
  web developer, rather than the user directly.</p>
    <p>This implies that not all policies can be reported on. There is a class of
  feature whose settings cannot be said to be "violated" in any meaningful way
  by markup, or by script actions. A hypothetical feature which disabled text
  entry in form fields, for instance, could be enforced by the user agent, but
  if a user were to try to type in those fields, causing enforcement to be
  required, that would not represent a violation of the policy, and should not
  be reported.</p>
    <section>
     <h3 class="heading settled" data-level="6.1" id="configure-reporting"><span class="secno">6.1. </span><span class="content">Configuring in-document reporting</span><a class="self-link" href="#configure-reporting"></a></h3>
     <h4 class="heading settled" data-level="6.1.1" id="report-to-parameter"><span class="secno">6.1.1. </span><span class="content">The "report-to" parameter</span><a class="self-link" href="#report-to-parameter"></a></h4>
     <p>Any directive can include a parameter named <code>report-to</code>, which names a
    reporting <a data-link-type="dfn" href="https://w3c.github.io/reporting/#endpoint" id="ref-for-endpoint">endpoint</a> to which violation reports for that feature will
    be sent.</p>
     <p>Example:</p>
<pre>    Document-Policy: something;f=1.0;report-to=endpoint1, no-something-else;report-to=endpoint2
</pre>
     <h4 class="heading settled" data-level="6.1.2" id="reporting-default"><span class="secno">6.1.2. </span><span class="content">Setting the default reporting endpoint</span><a class="self-link" href="#reporting-default"></a></h4>
     <p>If violations for many or all features should be sent to the same endpoint,
    then it may be easier to define a single default <a data-link-type="dfn" href="https://w3c.github.io/reporting/#endpoint" id="ref-for-endpoint①">endpoint</a>. This can
    be defined by a parameter on the special token <code>*</code>. If a default <a data-link-type="dfn" href="https://w3c.github.io/reporting/#endpoint" id="ref-for-endpoint②">endpoint</a> is provided, then unless otherwise specified, all violation
    reports will be sent to that named endpoint. If a feature also specifies its
    own endpoint, with the <code>report-to</code> parameter, then reports will go to that
    endpoint instead. (Reports are not sent to both endpoints.)</p>
     <p>Example:</p>
<pre>    Document-Policy: something;f=1.0, no-something-else, *;report-to=endpoint
</pre>
     <h4 class="heading settled" data-level="6.1.3" id="reporting-disable"><span class="secno">6.1.3. </span><span class="content">Disabling reporting for a feature</span><a class="self-link" href="#reporting-disable"></a></h4>
     <p>If a default endpoint has been specified, then it may be necessary to
    disable reporting for specific features. This can be done by specifying the
    special endpoint name <code>none</code> as the value for the <code>report-to</code> parameter.
    This will override the default endpoint and disable reporting for that
    feature.</p>
     <p>Example:</p>
<pre>    Document-Policy: something;f=1.0;report-to=none, no-something-else,
                     *;report-to=endpoiont
</pre>
    </section>
    <section>
     <h3 class="heading settled" data-level="6.2" id="report-only"><span class="secno">6.2. </span><span class="content">Report-only mode</span><a class="self-link" href="#report-only"></a></h3>
     <p>A document policy can be a "report-only" policy. Report-only policies are
    specified with a <code>Document-Policy-Report-Only</code> header. Violations of a
    report-only policy are reported on, exactly as an enforcing policy, but they
    do not cause any other action to be taken by the user agent.</p>
     <p>Document-Policy-Report-Only</p>
     <p>The <code>report-to</code> directive parameter should be used with directives in this
    header, or else they will have no effect at all.</p>
     <p>Document-Policy-Report-Only: something;f=1.0;report-to=endpoint, no-something-else;report-to=endpoint2</p>
    </section>
   </section>
   <section>
    <h2 class="heading settled" data-level="7" id="delivery"><span class="secno">7. </span><span class="content">Delivery</span><a class="self-link" href="#delivery"></a></h2>
    <section>
     <h3 class="heading settled" data-level="7.1" id="policies-as-structured-headers"><span class="secno">7.1. </span><span class="content">Policies as Structured Headers</span><a class="self-link" href="#policies-as-structured-headers"></a></h3>
     <p>Policies are represented in HTTP headers and in HTML attributes as the
    serialization of an sh-list structure. The list members are tokens, each
    corresponding to a <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="policy-directive">policy directive</dfn>. Each token may take a single
    parameter; the details of the parameter name and allowed values are
    determined by the value type of the feature which the token names.</p>
     <h4 class="heading settled" data-level="7.1.1" id="boolean-valued-features"><span class="secno">7.1.1. </span><span class="content">Boolean-valued features</span><a class="self-link" href="#boolean-valued-features"></a></h4>
     <p>Boolean-valued features do not take any parameters. They may be expressed in
    headers by simply naming them, to enable the feature, or naming them with a
    prefix of 'no-', to disable the feature.</p>
     <p>Examples:</p>
     <ul>
      <li data-md>
       <p><code>boolean-feature</code></p>
      <li data-md>
       <p><code>no-boolean-feature</code></p>
     </ul>
     <h4 class="heading settled" data-level="7.1.2" id="integer-valued-features"><span class="secno">7.1.2. </span><span class="content">Integer-valued features</span><a class="self-link" href="#integer-valued-features"></a></h4>
     <p>Integer-valued features should have a single parameter, whose name is
    defined by the feature, and whose value should be an Integer. The range of
    Integers allowed should be defined by the feature.</p>
     <p>Examples:</p>
     <ul>
      <li data-md>
       <p><code>integer-feature;p=2</code></p>
     </ul>
     <h4 class="heading settled" data-level="7.1.3" id="float-valued-features"><span class="secno">7.1.3. </span><span class="content">Float-valued features</span><a class="self-link" href="#float-valued-features"></a></h4>
     <p>Float-valued features should have a single parameter, whose name is defined
    by the feature, and whose value should be a Float. The range of Floats
    allowed should be defined by the feature.</p>
     <p>Examples:</p>
     <ul>
      <li data-md>
       <p><code>float-feature;q=-0.2</code></p>
     </ul>
     <h4 class="heading settled" data-level="7.1.4" id="enum-valued-features"><span class="secno">7.1.4. </span><span class="content">Enum-valued features</span><a class="self-link" href="#enum-valued-features"></a></h4>
     <p>Enum-valued features should take a parameter with no value. The allowed
    values for the enum should be used as the parameter name.</p>
     <p>Examples:</p>
     <ul>
      <li data-md>
       <p><code>enum-feature;state</code></p>
     </ul>
    </section>
    <section>
     <h3 class="heading settled" data-level="7.2" id="http-headers"><span class="secno">7.2. </span><span class="content">HTTP Headers</span><a class="self-link" href="#http-headers"></a></h3>
     <section>
      <h4 class="heading settled" data-level="7.2.1" id="document-policy-http-header"><span class="secno">7.2.1. </span><span class="content">Document-Policy</span><a class="self-link" href="#document-policy-http-header"></a></h4>
      <p>The `<dfn data-dfn-type="http-header" data-export id="document-policy-header"><code>Document-Policy</code><a class="self-link" href="#document-policy-header"></a></dfn>` HTTP
    header can be used in the <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-response" id="ref-for-concept-response-response">response</a> (server to client) to communicate the <a data-link-type="dfn" href="#document-policy" id="ref-for-document-policy⑤">document policy</a> that should be enforced by the client.</p>
      <p>The <code>Document-Policy</code> header is a Structured Header. Its value
    must be a list. Its ABNF is:</p>
      <p>Document-Policy = sh-list</p>
      <p>Each list element must be a token. If the token does not name a supported
    feature or pseudo-feature, (or a supported boolean feature prefixed by
    "no-",) then the list element will be ignored by the processing steps.</p>
     </section>
     <section>
      <h4 class="heading settled" data-level="7.2.2" id="document-policy-report-only-http-header"><span class="secno">7.2.2. </span><span class="content">Document-Policy-Report-Only</span><a class="self-link" href="#document-policy-report-only-http-header"></a></h4>
      <p>The `<dfn data-dfn-type="http-header" data-export id="document-policy-report-only-header"><code>Document-Policy-Report-Only</code><a class="self-link" href="#document-policy-report-only-header"></a></dfn>`
    HTTP header can be used in the <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-response" id="ref-for-concept-response-response①">response</a> (server to client) to configure
    the <a data-link-type="dfn" href="#report-only-document-policy" id="ref-for-report-only-document-policy">report-only document policy</a> for the document.</p>
      <p>The <code>Document-Policy-Report-Only</code> header is a Structured Header.
    Its value must be a list. It has exactly the same syntax as the <code>Document-Policy</code> header.</p>
     </section>
     <section>
      <h4 class="heading settled" data-level="7.2.3" id="require-document-policy-http-header"><span class="secno">7.2.3. </span><span class="content">Require-Document-Policy</span><a class="self-link" href="#require-document-policy-http-header"></a></h4>
      <p>The `<dfn data-dfn-type="http-header" data-export id="require-document-policy-header"><code>Require-Document-Policy</code><a class="self-link" href="#require-document-policy-header"></a></dfn>`
    HTTP header field is a response header which is used to communicate to the
    client the minimum <a data-link-type="dfn" href="#required-document-policy" id="ref-for-required-document-policy①">required document policy</a> to apply to all nested
    content.</p>
      <p>The <code>Require-Document-Policy</code> header is a Structured Header list, with
    exactly the same syntax as the <code>Document-Policy</code> header.</p>
     </section>
     <section>
      <h4 class="heading settled" data-level="7.2.4" id="sec-required-document-policy-http-header"><span class="secno">7.2.4. </span><span class="content">Sec-Required-Document-Policy</span><a class="self-link" href="#sec-required-document-policy-http-header"></a></h4>
      <p>The `<dfn data-dfn-type="http-header" data-export id="sec-required-document-policy-header"><code>Sec-Required-Document-Policy</code><a class="self-link" href="#sec-required-document-policy-header"></a></dfn>`
    HTTP header field is a request header which is used to communicate to the
    server the <a data-link-type="dfn" href="#document-policy" id="ref-for-document-policy⑥">document policy</a> which must be sent with the document
    returned with the request.</p>
      <p>The header’s value is the <a href="#serialization">§ 5 Required Policy Serialization</a> of one or more <a data-link-type="dfn" href="#policy-directive" id="ref-for-policy-directive">policy directive</a>s</p>
     </section>
    </section>
    <section>
     <h3 class="heading settled" data-level="7.3" id="iframe-policy-attribute"><span class="secno">7.3. </span><span class="content">The <code>policy</code> attribute of the <code>iframe</code> element</span><a class="self-link" href="#iframe-policy-attribute"></a></h3>
     <p><code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/iframe-embed-object.html#the-iframe-element" id="ref-for-the-iframe-element">iframe</a></code> elements have a "<code>policy</code>" attribute, which contains a required
    policy directive (SH format).</p>
    </section>
   </section>
   <section>
    <h2 class="heading settled" data-level="8" id="integrations"><span class="secno">8. </span><span class="content">Integrations</span><a class="self-link" href="#integrations"></a></h2>
    <p>If a frame has a required policy, then that policy must be advertised in the
  request header for any outgoing document requests, to inform the server of the
  policy which will be applied to the document by the user agent. This allows
  the server to alter the representation which is returned, to conform to that
  policy.</p>
    <p>In the case where a required policy request header is present, the response
  must contain a compatible document policy header, or the fetch will fail.</p>
    <section>
     <h3 class="heading settled" data-level="8.1" id="integration-with-html"><span class="secno">8.1. </span><span class="content">Integration with HTML</span><a class="self-link" href="#integration-with-html"></a></h3>
     <p>The following changes should be incorporated into <a data-link-type="biblio" href="#biblio-html">[HTML]</a>:</p>
     <ul>
      <li data-md>
       <p><code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/iframe-embed-object.html#the-iframe-element" id="ref-for-the-iframe-element①">iframe</a></code> elements should have the following IDL added:</p>
     </ul>
<pre>        [CEReactions] attribute DOMString policy;
</pre>
     <ul>
      <li data-md>
       <p>The iframe policy attribute should be defined as follows:</p>
       <ul>
        <li data-md>
         <p>The <code>policy</code> attribute, when specified, adds a <a data-link-type="dfn" href="#required-document-policy" id="ref-for-required-document-policy②">required document
policy</a> to the <code>iframe</code>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#nested-browsing-context" id="ref-for-nested-browsing-context">nested browsing context</a>, when it is
initialized. Its value must be a <a data-link-type="dfn" href="#serialized-document-policy" id="ref-for-serialized-document-policy">serialized document policy</a>.</p>
       </ul>
      <li data-md>
       <p>In <a href="https://html.spec.whatwg.org/multipage/dom.html#the-document-object">HTML 5 §3.1.1 The Document object</a>, add the following line:</p>
       <ul>
        <li data-md>
         <p>The <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-document" id="ref-for-concept-document②">Document</a> has a <b>document policy</b>, which is a <a data-link-type="dfn" href="#document-policy" id="ref-for-document-policy⑦">document
policy</a>, which is initially empty.</p>
       </ul>
      <li data-md>
       <p>In the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#creating-a-new-browsing-context" id="ref-for-creating-a-new-browsing-context">creating a new browsing context</a> algorithm:</p>
       <ul>
        <li data-md>
         <p>Add the following step after step 5:</p>
         <ol start="6">
          <li data-md>
           <p>Set <var>browsingContext</var>’s <a data-link-type="dfn" href="#required-document-policy" id="ref-for-required-document-policy③">required document
policy</a> to the result of <a data-link-type="dfn" href="#create-for-browsingcontext" id="ref-for-create-for-browsingcontext">creating a required policy for a
browsing context</a> <var>browsingContext</var>.</p>
         </ol>
        <li data-md>
         <p>Change step 9 (renumbered now to 10) to read:</p>
         <ol start="10">
          <li data-md>
           <p>Let <var>document</var> be a new <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-document" id="ref-for-concept-document③">Document</a>, marked as
an <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#html-document" id="ref-for-html-document">HTML document</a> in <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-document-quirks" id="ref-for-concept-document-quirks">quirks mode</a>, whose <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-document-content-type" id="ref-for-concept-document-content-type">content
type</a> is <code>"text/html"</code>, <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#concept-request-origin" id="ref-for-concept-request-origin">origin</a> is <var>origin</var>, <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/origin.html#active-sandboxing-flag-set" id="ref-for-active-sandboxing-flag-set">active sandboxing flag set</a> is <var>sandboxFlags</var>, <a data-link-type="dfn">feature policy</a> is <var>feature policy</var>, document
policy is identical to <var>browsingContext</var>’s <a data-link-type="dfn" href="#required-document-policy" id="ref-for-required-document-policy④">required
document policy</a>, and which is both ready for post-load tasks and
completely loaded immediately.</p>
         </ol>
       </ul>
      <li data-md>
       <p>In the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#process-a-navigate-fetch" id="ref-for-process-a-navigate-fetch">process a navigate fetch</a> algorithm:</p>
       <ul>
        <li data-md>
         <p>Add the following step after step 5:</p>
         <ol start="6">
          <li data-md>
           <p>Set <var>request</var>’s <a data-link-type="dfn" href="#required-document-policy" id="ref-for-required-document-policy⑤">required document policy</a> to <var>browsingContext</var>’s <a data-link-type="dfn" href="#required-document-policy" id="ref-for-required-document-policy⑥">required document policy</a>.</p>
         </ol>
       </ul>
      <li data-md>
       <p>In the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#initialise-the-document-object" id="ref-for-initialise-the-document-object">initialise the document object</a> algorithm:</p>
       <ul>
        <li data-md>
         <p>Add the following step after step 3:</p>
         <ol start="4">
          <li data-md>
           <p>Let <var>documentPolicy</var> be the result of <a data-link-type="dfn" href="#create-document-policy" id="ref-for-create-document-policy">creating a document policy</a> for <var>browsingContext</var> from <var>response</var>.</p>
         </ol>
        <li data-md>
         <p>Change step 6 (renumbered now to 7) to read:</p>
         <ol start="7">
          <li data-md>
           <p>Let <var>document</var> be a new Document, whose type is <var>type</var>, content type is <var>contentType</var>,
origin is <var>origin</var>, feature policy is <var>featurePolicy</var>, active sandboxing flag set is <var>finalSandboxFlags</var>, and document policy is <var>documentPolicy</var>.</p>
         </ol>
       </ul>
     </ul>
    </section>
    <section>
     <h3 class="heading settled" data-level="8.2" id="integration-with-fetch"><span class="secno">8.2. </span><span class="content">Integration with Fetch</span><a class="self-link" href="#integration-with-fetch"></a></h3>
     <p>The following changes should be incorporated into <a data-link-type="biblio" href="#biblio-fetch">[FETCH]</a>:</p>
     <ul>
      <li data-md>
       <p>In <a href="https://fetch.spec.whatwg.org/#requests">Fetch Standard §2.2.5 Requests</a>, add the following:</p>
       <ul>
        <li data-md>
         <p>A <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-request" id="ref-for-concept-request-request">request</a> has an associated <dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="request-required-document-policy" data-noexport id="request-required-document-policy">required document
policy</dfn>, which is a <a data-link-type="dfn" href="#document-policy" id="ref-for-document-policy⑧">document policy</a>. Unless otherwise
stated, it is null.</p>
       </ul>
      <li data-md>
       <p>In <a href="https://fetch.spec.whatwg.org/#http-network-or-cache-fetch">Fetch Standard §4.5 HTTP-network-or-cache fetch</a>, after step 15, insert the
following:</p>
       <ol>
        <li data-md>
         <p>If <var>httpRequest</var> has a <a data-link-type="dfn" href="#request-required-document-policy" id="ref-for-request-required-document-policy">required document policy</a>,
then</p>
         <ol>
          <li data-md>
           <p>Let <var>serializedRequiredPolicy</var> be the result of calling <a data-link-type="dfn" href="#serialize-required-policy" id="ref-for-serialize-required-policy">Serialize
 Required Policy</a> on <var>httpRequest</var>’s <a data-link-type="dfn" href="#request-required-document-policy" id="ref-for-request-required-document-policy①">required document
 policy</a>.</p>
          <li data-md>
           <p>Append <code>Sec-Required-Document-Policy</code>/<var>serializedRequiredPolicy</var> to <var>httpRequest</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-header-list" id="ref-for-concept-request-header-list">header list</a>.</p>
         </ol>
       </ol>
      <li data-md>
       <p>In <a href="https://fetch.spec.whatwg.org/#main-fetch">Fetch Standard §4.1 Main fetch</a>, add the following algorithm to the list of
algorithms in step 11:</p>
       <ul>
        <li data-md>
         <p><a data-link-type="dfn" href="#should-response-to-request-be-blocked-due-to-document-policy" id="ref-for-should-response-to-request-be-blocked-due-to-document-policy">should <var>internalResponse</var> to <var>request</var> be
blocked due to document policy</a></p>
       </ul>
      <li data-md>
       <p>Add the following algorithm to <a href="https://fetch.spec.whatwg.org/#terminology-headers">Fetch Standard §2.2.2 Headers</a>:</p>
       <ul>
        <li data-md>
         <p>To <dfn data-dfn-type="dfn" data-export id="get-and-parse-a-structured-header">get and parse a structured header<a class="self-link" href="#get-and-parse-a-structured-header"></a></dfn> <var>name</var> as <var>type</var> from <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-headers-header-list" id="ref-for-concept-headers-header-list">header list</a> <var>list</var>, run these steps:</p>
         <ol>
          <li data-md>
           <p>Let <var>input</var> be the result of getting <var>name</var> from <var>list</var>.</p>
          <li data-md>
           <p>If <var>input</var> is null, then return null.</p>
          <li data-md>
           <p>Let <var>value</var> be the result of running the <a href="https://tools.ietf.org/html/draft-ietf-httpbis-header-structure-14#section-4.2">Parsing
 Header Fields into Structured Headers</a> algorithm with <var>input</var> as <var>input_string</var> and <var>type</var> as <var>header_type</var>. <a data-link-type="biblio" href="#biblio-header-structure">[HEADER-STRUCTURE]</a></p>
          <li data-md>
           <p>If the previous step fails, return null.</p>
          <li data-md>
           <p>Return <var>value</var>.</p>
         </ol>
       </ul>
     </ul>
    </section>
   </section>
   <section>
    <h2 class="heading settled" data-level="9" id="algorithms"><span class="secno">9. </span><span class="content">Algorithms</span><a class="self-link" href="#algorithms"></a></h2>
    <section>
     <h3 class="heading settled" data-level="9.1" id="algo-is-policy-compatible"><span class="secno">9.1. </span><span class="content"><dfn class="dfn-paneled" data-dfn-type="dfn" data-export id="is-policy-compatible">Is policy compatible</dfn>?</span><a class="self-link" href="#algo-is-policy-compatible"></a></h3>
     <div class="algorithm" data-algorithm="is-policy-compatible">
       Given a <a data-link-type="dfn" href="#required-document-policy" id="ref-for-required-document-policy⑦">required document policy</a> <var>requiredPolicy</var> and a <a data-link-type="dfn" href="#declared-document-policy" id="ref-for-declared-document-policy">declared
    document policy</a> <var>declaredPolicy</var>, this algorithm returns true if <var>declaredPolicy</var> is compatible with <var>requiredPolicy</var>, or false otherwise. 
      <ol>
       <li data-md>
        <p>For each <var>feature</var> → <var>value</var> in <var>requiredPolicy</var>:</p>
        <ol>
         <li data-md>
          <p>If <var>feature</var>’s <a data-link-type="dfn" href="#requires-acknowledgment" id="ref-for-requires-acknowledgment">requires acknowledgment</a> flag is <code>no</code>, then
  continue.</p>
         <li data-md>
          <p>If <var>declaredPolicy</var>[<var>feature</var>] does not exist, then return false.</p>
         <li data-md>
          <p>If <var>value</var> is stricter than <var>declaredPolicy</var>[<var>feature</var>], then return
  false.</p>
        </ol>
       <li data-md>
        <p>Return true.</p>
      </ol>
     </div>
    </section>
    <section>
     <h3 class="heading settled" data-level="9.2" id="algo-process-response-policy"><span class="secno">9.2. </span><span class="content"><dfn class="dfn-paneled" data-dfn-type="dfn" data-export id="process-response-policy">Process response policy</dfn></span><a class="self-link" href="#algo-process-response-policy"></a></h3>
     <div class="algorithm" data-algorithm="process-response-policy">
       Given a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-response" id="ref-for-concept-response-response②">response</a> (<var>response</var>), this algorithm returns a <a data-link-type="dfn" href="#declared-document-policy" id="ref-for-declared-document-policy①">declared
    document policy</a>. 
      <ol>
       <li data-md>
        <p>Abort these steps if <var>response</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-header-list" id="ref-for-concept-response-header-list">header list</a> does
  not contain a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-header" id="ref-for-concept-header">header</a> whose <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-header-name" id="ref-for-concept-header-name">name</a> is
  "<code>Document-Policy</code>".</p>
       <li data-md>
        <p>Let <var>header</var> be the concatenation of the <a data-link-type="dfn" href="#policy-configuration-value" id="ref-for-policy-configuration-value">value</a>s of all <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-header" id="ref-for-concept-header①">header</a> fields in <var>response</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-header-list" id="ref-for-concept-response-header-list①">header list</a> whose name is
  "<code>Document-Policy</code>", separated by U+002C (,) (according to
  [RFC7230, 3.2.2]).</p>
       <li data-md>
        <p>Let <var>document policy</var> be the result of executing <a data-link-type="dfn" href="#parse-document-policy" id="ref-for-parse-document-policy">Parse document
  policy</a> on <var>header</var>.</p>
       <li data-md>
        <p>Return <var>document policy</var>.</p>
      </ol>
     </div>
    </section>
    <section>
     <h3 class="heading settled" data-level="9.3" id="algo-parse-document-policy"><span class="secno">9.3. </span><span class="content"><dfn class="dfn-paneled" data-dfn-type="dfn" data-export id="parse-document-policy">Parse document policy</dfn></span><a class="self-link" href="#algo-parse-document-policy"></a></h3>
     <div class="algorithm" data-algorithm="parse-document-policy">
       Given a string (<var>policyString</var>), this algorithm returns a <a data-link-type="dfn" href="#document-policy" id="ref-for-document-policy⑨">document
    policy</a>, if it can be parsed as one, or else fails. 
      <ol>
       <li data-md>
        <p>Let <var>policy</var> be a new ordered map.</p>
       <li data-md>
        <p>Let <var>defaultEndpoint</var> be a new string, set to null.</p>
       <li data-md>
        <p>Let <var>list</var> be the result of parsing <var>policyString</var> as a list.</p>
       <li data-md>
        <p>If parsing fails, then fail.</p>
       <li data-md>
        <p>For each <var>element</var> in <var>list</var>,</p>
        <ol>
         <li data-md>
          <p>If <var>element</var> is not a token, then fail.</p>
         <li data-md>
          <p>Let <var>currentEndpoint</var> be a new string, set to null.</p>
         <li data-md>
          <p>If <var>element</var>["report-to"] exists, and is a string, then:</p>
          <ol>
           <li data-md>
            <p>Set <var>currentEndpoint</var> to the value of <var>element</var>["report-to"].</p>
           <li data-md>
            <p>Remove <var>element</var>["report-to"].</p>
          </ol>
         <li data-md>
          <p>If <var>element</var> is the string "<code>*</code>", then:</p>
          <ol>
           <li data-md>
            <p>Set <var>defaultEndpoint</var> to <var>currentEndpoint</var>.</p>
          </ol>
         <li data-md>
          <p>Otherwise, if <var>element</var> is the name of a supported feature which is a
boolean feature, then:</p>
          <ol>
           <li data-md>
            <p>If <var>element</var> has any associated parameters, then fail.</p>
           <li data-md>
            <p>Let <var>feature</var> be the supported feature with name <var>element</var>.</p>
           <li data-md>
            <p>If <var>policy</var>[<var>feature</var>] exists, then continue with the next <var>element</var>.</p>
           <li data-md>
            <p>Set <var>policy</var>[<var>feature</var>] to a new boolean <a data-link-type="dfn" href="#policy-configuration" id="ref-for-policy-configuration①">policy
configuration</a> with <a data-link-type="dfn" href="#policy-configuration-value" id="ref-for-policy-configuration-value①">value</a> true, and <a data-link-type="dfn" href="#policy-configuration-reporting-endpoint" id="ref-for-policy-configuration-reporting-endpoint">reporting endpoint</a> <var>currentEndpoint</var>.</p>
           <li data-md>
            <p>Continue with the next <var>element</var>.</p>
          </ol>
         <li data-md>
          <p>Otherwise, if <var>element</var> begins with the string <code>"no-"</code>, and the
remaining characters match the name of a supported feature which is a
boolean feature, then:</p>
          <ol>
           <li data-md>
            <p>If <var>element</var> has any associated parameters, then fail.</p>
           <li data-md>
            <p>Let <var>elementName</var> be the substring of <var>element</var> after the prefix <code>"no-"</code>.</p>
           <li data-md>
            <p>Let <var>feature</var> be the supported feature with name <var>elementName</var>.</p>
           <li data-md>
            <p>If <var>policy</var>[<var>feature</var>] exists, then continue with the next <var>element</var>.</p>
           <li data-md>
            <p>Set <var>policy</var>[<var>feature</var>] to a new boolean <a data-link-type="dfn" href="#policy-configuration" id="ref-for-policy-configuration②">policy
configuration</a> with <a data-link-type="dfn" href="#policy-configuration-value" id="ref-for-policy-configuration-value②">value</a> false, and <a data-link-type="dfn" href="#policy-configuration-reporting-endpoint" id="ref-for-policy-configuration-reporting-endpoint①">reporting endpoint</a> <var>currentEndpoint</var>.</p>
           <li data-md>
            <p>Continue with the next <var>element</var>.</p>
          </ol>
         <li data-md>
          <p>Otherwise, if <var>element</var> is the name of a supported feature, then:</p>
          <ol>
           <li data-md>
            <p>If <var>element</var> does not have exactly one parameter, then fail.</p>
           <li data-md>
            <p>Let <var>feature</var> be the supported feature with name <var>element</var>.</p>
           <li data-md>
            <p>If <var>policy</var>[<var>feature</var>] exists, then continue with the next <var>element</var>.</p>
           <li data-md>
            <p>If <var>feature</var> is an enum-valued feature, then</p>
            <ol>
             <li data-md>
              <p>If <var>element</var>’s parameter has a value, then fail.</p>
             <li data-md>
              <p>Let <var>value</var> be the name of <var>element</var>’s parameter.</p>
             <li data-md>
              <p>If <var>value</var> is not the name of one of <var>feature</var>s allowed
  enum values, then fail.</p>
             <li data-md>
              <p>Set <var>policy</var>[<var>feature</var>] to a new enum <a data-link-type="dfn" href="#policy-configuration" id="ref-for-policy-configuration③">policy
configuration</a> with <a data-link-type="dfn" href="#policy-configuration-value" id="ref-for-policy-configuration-value③">value</a> <var>value</var>, and <a data-link-type="dfn" href="#policy-configuration-reporting-endpoint" id="ref-for-policy-configuration-reporting-endpoint②">reporting endpoint</a> <var>currentEndpoint</var>.</p>
             <li data-md>
              <p>Continue with the next <var>element</var>.</p>
            </ol>
           <li data-md>
            <p>If <var>element</var>’s parameter’s name does not match <var>feature</var>’s
parameter name, then fail.</p>
           <li data-md>
            <p>Let <var>value</var> be the value of <var>element</var>’s parameter.</p>
           <li data-md>
            <p>If <var>feature</var> is an integer-valued feature, then</p>
            <ol>
             <li data-md>
              <p>If <var>value</var> is not an integer, then fail.</p>
             <li data-md>
              <p>If <var>value</var> is not in <var>feature</var>’s range, then fail.</p>
             <li data-md>
              <p>Set <var>policy</var>[<var>feature</var>] to a new integer <a data-link-type="dfn" href="#policy-configuration" id="ref-for-policy-configuration④">policy
configuration</a> with <a data-link-type="dfn" href="#policy-configuration-value" id="ref-for-policy-configuration-value④">value</a> <var>value</var>, and <a data-link-type="dfn" href="#policy-configuration-reporting-endpoint" id="ref-for-policy-configuration-reporting-endpoint③">reporting endpoint</a> <var>currentEndpoint</var>.</p>
             <li data-md>
              <p>Continue with the next <var>element</var>.</p>
            </ol>
           <li data-md>
            <p>If <var>feature</var> is an float-valued feature, then</p>
            <ol>
             <li data-md>
              <p>If <var>value</var> is not a float, then fail.</p>
             <li data-md>
              <p>If <var>value</var> is not in <var>feature</var>’s range, then fail.</p>
             <li data-md>
              <p>Set <var>policy</var>[<var>feature</var>] to a new float <a data-link-type="dfn" href="#policy-configuration" id="ref-for-policy-configuration⑤">policy
configuration</a> with <a data-link-type="dfn" href="#policy-configuration-value" id="ref-for-policy-configuration-value⑤">value</a> <var>value</var>, and <a data-link-type="dfn" href="#policy-configuration-reporting-endpoint" id="ref-for-policy-configuration-reporting-endpoint④">reporting endpoint</a> <var>currentEndpoint</var>.</p>
             <li data-md>
              <p>Continue with the next <var>element</var>.</p>
            </ol>
          </ol>
        </ol>
       <li data-md>
        <p>For each <var>feature</var> → <var>config</var> in <var>policy</var>,</p>
        <ol>
         <li data-md>
          <p>If <var>config</var> does not have a <a data-link-type="dfn" href="#policy-configuration-reporting-endpoint" id="ref-for-policy-configuration-reporting-endpoint⑤">reporting
endpoint</a>, set <var>config</var>’s <a data-link-type="dfn" href="#policy-configuration-reporting-endpoint" id="ref-for-policy-configuration-reporting-endpoint⑥">reporting endpoint</a> to <var>defaultEndpoint</var>.</p>
        </ol>
       <li data-md>
        <p>Return <var>policy</var>.</p>
      </ol>
     </div>
    </section>
    <section>
     <h3 class="heading settled" data-level="9.4" id="algo-serialize-required-policy"><span class="secno">9.4. </span><span class="content"><dfn class="dfn-paneled" data-dfn-type="dfn" data-export id="serialize-required-policy">Serialize required policy</dfn></span><a class="self-link" href="#algo-serialize-required-policy"></a></h3>
     <div class="algorithm" data-algorithm="serialize-required-policy">
       Given a <a data-link-type="dfn" href="#document-policy" id="ref-for-document-policy①⓪">document policy</a> (<var>requiredPolicy</var>), this algorithm returns a
    string which represents the canonical serialization of the policy. 
      <ol>
       <li data-md>
        <p>Let <var>list</var> be an empty sh-list</p>
       <li data-md>
        <p>Let <var>features</var> be the keys of <var>requiredPolicy</var></p>
       <li data-md>
        <p>Sort <var>features</var> by the name of each element, in ASCII order.</p>
       <li data-md>
        <p>For each <var>feature</var> in <var>features</var>:</p>
        <ol>
         <li data-md>
          <p>If <var>feature</var> is a boolean-valued feature, then</p>
          <ol>
           <li data-md>
            <p>If <var>requiredPolicy</var>[<var>feature</var>] is true, append <var>feature</var>’s name
to <var>list</var>.</p>
           <li data-md>
            <p>Otherwise, append the sh-token formed by concatenating the string <code>"no-"</code> and <var>feature</var>’s name to <var>list</var>.</p>
          </ol>
         <li data-md>
          <p>Otherwise, if <var>feature</var> is an enum-valued feature, then</p>
          <ol>
           <li data-md>
            <p>Let <var>value</var> be <var>requiredPolicy</var>[<var>feature</var>].</p>
           <li data-md>
            <p>Let <var>param</var> be a parameter with param-name <var>value</var> and with no
param-value.</p>
           <li data-md>
            <p>Append an sh-item which is an sh-token formed from <var>feature</var>’s
name, with the single parameter <var>param</var>, to <var>list</var>.</p>
          </ol>
         <li data-md>
          <p>Otherwise,</p>
          <ol>
           <li data-md>
            <p>Let <var>value</var> be <var>requiredPolicy</var>[<var>feature</var>].</p>
           <li data-md>
            <p>Let <var>param</var> be a parameter with param-name being <var>feature</var>’s
parameter name, and with param-value <var>value</var>.</p>
           <li data-md>
            <p>Append an sh-item which is an sh-token formed from <var>feature</var>’s
name, with the single parameter <var>param</var>, to <var>list</var>.</p>
          </ol>
        </ol>
       <li data-md>
        <p>Return the serialization of <var>list</var>.</p>
      </ol>
     </div>
    </section>
    <section>
     <h3 class="heading settled" data-level="9.5" id="algo-create-for-browsingcontext"><span class="secno">9.5. </span><span class="content"><dfn class="dfn-paneled" data-dfn-type="dfn" data-export data-lt="create-for-browsingcontext" id="create-for-browsingcontext">Create a required policy for a browsing context</dfn></span><a class="self-link" href="#algo-create-for-browsingcontext"></a></h3>
     <div class="algorithm" data-algorithm="create-for-browsingcontext">
       Given a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#browsing-context" id="ref-for-browsing-context③">browsing context</a> (<var>browsingContext</var>), this algorithm returns
    a new <a data-link-type="dfn" href="#document-policy" id="ref-for-document-policy①①">Document Policy</a>. 
      <ol>
       <li data-md>
        <p>If <var>browsingContext</var> is a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#nested-browsing-context" id="ref-for-nested-browsing-context①">nested browsing context</a>, then</p>
        <ol>
         <li data-md>
          <p>Let <var>requiredPolicy</var> be a clone of <var>browsingContext</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#browsing-context-container" id="ref-for-browsing-context-container">browsing
  context container</a>’s <a data-link-type="dfn" href="#nested-context-required-document-policy" id="ref-for-nested-context-required-document-policy">nested context required document
  policy</a>.</p>
         <li data-md>
          <p>If <var>browsingContext</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#browsing-context-container" id="ref-for-browsing-context-container①">browsing context container</a> has a
  "policy" attribute, then</p>
          <ol>
           <li data-md>
            <p>Let <var>containerPolicy</var> be the result of parsing the attribute</p>
           <li data-md>
            <p>For each <var>feature</var> -> <var>value</var> in <var>containerPolicy</var>:</p>
            <ol>
             <li data-md>
              <p>If <var>requiredPolicy</var>[<var>feature</var>] does not exist, or if <var>value</var> is stricter than <var>requiredPolicy</var>[<var>feature</var>], then set <var>requiredPolicy</var>[<var>feature</var>] to <var>value</var>.</p>
            </ol>
          </ol>
        </ol>
       <li data-md>
        <p>Otherwise, let <var>requiredPolicy</var> be a new ordered map.</p>
       <li data-md>
        <p>return <var>requiredPolicy</var>.</p>
      </ol>
     </div>
    </section>
    <section>
     <h3 class="heading settled" data-level="9.6" id="algo-create-document-policy"><span class="secno">9.6. </span><span class="content"><dfn class="dfn-paneled" data-dfn-type="dfn" data-export data-lt="create-document-policy" id="create-document-policy">Create a document Policy for a browsing context from response</dfn></span><a class="self-link" href="#algo-create-document-policy"></a></h3>
     <div class="algorithm" data-algorithm="create-document-policy">
       Given a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#browsing-context" id="ref-for-browsing-context④">browsing context</a> (<var>browsingContext</var>) and a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-response" id="ref-for-concept-response-response③">response</a> (<var>response</var>), this algorithm returns a new <a data-link-type="dfn" href="#document-policy" id="ref-for-document-policy①②">Document Policy</a>. 
      <ol>
       <li data-md>
        <p>Let <var>requiredPolicy</var> be the result of running <a data-link-type="dfn" href="#create-for-browsingcontext" id="ref-for-create-for-browsingcontext①">Create a required policy for a
  browsing context</a> given <var>browsingContext</var>.</p>
       <li data-md>
        <p>Let <var>declaredPolicy</var> be the result of running <a data-link-type="dfn" href="#process-response-policy" id="ref-for-process-response-policy">Process response
  policy</a> on <var>response</var>.</p>
       <li data-md>
        <p>If <var>declaredPolicy</var> is <a href="#is-policy-compatible" id="ref-for-is-policy-compatible">compatible</a> with <var>requiredPolicy</var>, then return <var>declaredPolicy</var>.</p>
       <li data-md>
        <p>Throw an exception.</p>
      </ol>
     </div>
    </section>
    <section>
     <h3 class="heading settled" data-level="9.7" id="algo-should-reponse-to-request-be-blocked"><span class="secno">9.7. </span><span class="content"><dfn class="dfn-paneled" data-dfn-type="dfn" data-export id="should-response-to-request-be-blocked-due-to-document-policy">Should response to request be blocked due to document policy</dfn>?</span><a class="self-link" href="#algo-should-reponse-to-request-be-blocked"></a></h3>
     <div class="algorithm" data-algorithm="should-response-to-request-be-blocked">
       Given a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-request" id="ref-for-concept-request-request①">request</a> (<var>request</var>) and a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-response" id="ref-for-concept-response-response④">response</a> (<var>response</var>) to
       that request, this algorithm returns "blocked" if the response is not
       compatible with the request’s required policy, or "valid" otherwise. 
      <ol>
       <li data-md>
        <p>If <var>request</var> has a <a data-link-type="dfn" href="#request-required-document-policy" id="ref-for-request-required-document-policy②">required document
 policy</a>, then</p>
        <ol>
         <li data-md>
          <p>Let <var>documentPolicy</var> be the result of getting and parsing the
 structured header <code>Document-Policy</code> as "list" from <var>response</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-header-list" id="ref-for-concept-response-header-list②">header list</a>.</p>
         <li data-md>
          <p>If <var>documentPolicy</var> is not <a data-link-type="dfn" href="#is-policy-compatible" id="ref-for-is-policy-compatible①">compatible</a> with <var>request</var>’s <a data-link-type="dfn" href="#request-required-document-policy" id="ref-for-request-required-document-policy③">required document
 policy</a>, return "blocked".</p>
         <li data-md>
          <p>Return "valid".</p>
        </ol>
      </ol>
     </div>
    </section>
    <section>
     <h3 class="heading settled" data-level="9.8" id="algo-get-policy-value"><span class="secno">9.8. </span><span class="content"><dfn data-dfn-type="dfn" data-export data-lt="get-policy-value" id="get-policy-value">Get policy value for feature in document<a class="self-link" href="#get-policy-value"></a></dfn></span><a class="self-link" href="#algo-get-policy-value"></a></h3>
     <div class="algorithm" data-algorithm="get-policy-value">
       Given a feature (<var>feature</var>) and a <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#document" id="ref-for-document">Document</a></code> object (<var>document</var>), this
    algorithm returns the value for <var>feature</var> in <var>document</var>’s <a data-link-type="dfn" href="#document-policy" id="ref-for-document-policy①③">document
    policy</a>. 
      <ol>
       <li data-md>
        <p>Let <var>policy</var> be <var>document</var>’s <a data-link-type="dfn" href="#document-policy" id="ref-for-document-policy①④">Document Policy</a>.</p>
       <li data-md>
        <p>If <var>policy</var>[<var>feature</var>] exists, return its <a data-link-type="dfn" href="#policy-configuration-value" id="ref-for-policy-configuration-value⑥">value</a>.</p>
       <li data-md>
        <p>Return <var>feature</var>’s <a data-link-type="dfn" href="#default-value" id="ref-for-default-value">default value</a>.</p>
      </ol>
     </div>
    </section>
    <section>
     <h3 class="heading settled" data-level="9.9" id="algo-determine-compatibility"><span class="secno">9.9. </span><span class="content"><dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="determine-compatibility" data-noexport id="determine-compatibility">Determine compatibility of value with policy for feature</dfn></span><a class="self-link" href="#algo-determine-compatibility"></a></h3>
     <div class="algorithm" data-algorithm="determine-compatibility">
       Given a value (<var>value</var>), a feature (<var>feature</var>) and a <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#document" id="ref-for-document①">Document</a></code> object
    (<var>document</var>), this algorithm returns a tuple consisting of: 
      <ul>
       <li data-md>
        <p>An action, which is either "compatible" or "incompatible", depending on
whether <var>value</var> is compatible with <var>document</var>’s <a data-link-type="dfn" href="#document-policy" id="ref-for-document-policy①⑤">document policy</a>,</p>
       <li data-md>
        <p>A reporting endpoint name, which will be null if <var>value</var> is compatible
with both <var>document</var>’s <a data-link-type="dfn" href="#document-policy" id="ref-for-document-policy①⑥">document policy</a> and its <a data-link-type="dfn" href="#report-only-document-policy" id="ref-for-report-only-document-policy①">report-only
document policy</a>, or if reporting is not configured for <var>feature</var>, or
else will be the name of the <a data-link-type="dfn" href="https://w3c.github.io/reporting/#endpoint" id="ref-for-endpoint③">reporting endpoint</a> to
which a violation report should be sent.</p>
      </ul>
      <p>Note that if the enforcing policy is stricter than the report-only policy,
    then the report-only policy will not be checked.</p>
      <ol>
       <li data-md>
        <p>Let <var>policy</var> be <var>document</var>’s <a data-link-type="dfn" href="#document-policy" id="ref-for-document-policy①⑦">Document Policy</a>.</p>
       <li data-md>
        <p>Let <var>policyConfig</var> be <var>policy</var>[<var>feature</var>], if it exists, or a tuple
consisting of <var>feature</var>’s <a data-link-type="dfn" href="#default-value" id="ref-for-default-value①">default value</a> and null, otherwise.</p>
       <li data-md>
        <p>Let <var>policyValue</var> and <var>reporting endpoint</var> be the elements of <var>policyConfig</var></p>
       <li data-md>
        <p>If <var>policyValue</var> is stricter than <var>value</var>, then return a tuple
consisting of "incompatible" and <var>reporting endpoint</var>.</p>
       <li data-md>
        <p>Let <var>report-only policy</var> be <var>document</var>’s <a data-link-type="dfn" href="#report-only-document-policy" id="ref-for-report-only-document-policy②">report-only document
policy</a>,</p>
       <li data-md>
        <p>Let <var>report-only policyConfig</var> be <var>report-only policy</var>[<var>feature</var>], if
it exists, or a tuple consisting of <var>feature</var>’s <a data-link-type="dfn" href="#default-value" id="ref-for-default-value②">default value</a> and
null, otherwise.</p>
       <li data-md>
        <p>Set <var>policyValue</var> and <var>reporting endpoint</var> to the elements of <var>report-only policyConfig</var></p>
       <li data-md>
        <p>If <var>policyValue</var> is stricter than <var>value</var>, then return a tuple
consisting of "compatible" and <var>reporting endpoint</var>.</p>
       <li data-md>
        <p>Return ("compatible", null).</p>
      </ol>
     </div>
    </section>
    <section>
     <h3 class="heading settled" data-level="9.10" id="algo-is-value-compatible-or-report"><span class="secno">9.10. </span><span class="content"><dfn data-dfn-type="dfn" data-export data-lt="is-value-compatible-or-report" id="is-value-compatible-or-report">Determine if value is compatible with policy for feature or report<a class="self-link" href="#is-value-compatible-or-report"></a></dfn></span><a class="self-link" href="#algo-is-value-compatible-or-report"></a></h3>
     <div class="algorithm" data-algorithm="is-value-compatible-or-report">
       Given a value (<var>value</var>), a feature (<var>feature</var>) and a <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#document" id="ref-for-document②">Document</a></code> object
    (<var>document</var>), this algorithm returns "compatible" if <var>value</var> is compatible
    with <var>document</var>’s <a data-link-type="dfn" href="#document-policy" id="ref-for-document-policy①⑧">document policy</a>, or else "incompatible". It will
    also queue a report if reporting has been configured. 
      <ol>
       <li data-md>
        <p>Let (<var>action</var>, <var>reporting endpoint</var>) be the result of calling <a data-link-type="dfn" href="#determine-compatibility" id="ref-for-determine-compatibility">determine-compatibility</a> with <var>value</var>, <var>feature</var> and <var>document</var>.</p>
       <li data-md>
        <p>If <var>reporting endpoint</var> is not null,</p>
        <ol>
         <li data-md>
          <p>Let <var>body</var> be a new ECMAScript object with the following properties: <a data-link-type="biblio" href="#biblio-ecma-262">[ECMA-262]</a></p>
          <dl>
           <dt data-md>featureId
           <dd data-md>
            <p>feature’s string representation.</p>
           <dt data-md>sourceFile
           <dd data-md>
            <p>null</p>
           <dt data-md>lineNumber
           <dd data-md>
            <p>null</p>
           <dt data-md>columnNumber
           <dd data-md>
            <p>null</p>
           <dt data-md>disposition
           <dd data-md>
            <p>"enforce", if <var>action</var> is "incompatible", or else "report".</p>
          </dl>
         <li data-md>
          <p>If the user agent is currently executing script, and can extract the
source file’s URL, line number, and column number from settings, then
set <var>body</var>’s sourceFile, lineNumber, and columnNumber accordingly.</p>
         <li data-md>
          <p>Let <var>settings</var> be <var>document</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object" id="ref-for-environment-settings-object">environment settings object</a>.</p>
         <li data-md>
          <p>Execute <a href="https://w3c.github.io/reporting/#queue-report">Reporting API §2.3 Queue data as type for destination</a> with <var>body</var>, "document-policy-violation", <var>reporting endpoint</var> and <var>settings</var>.</p>
        </ol>
       <li data-md>
        <p>Return <var>action</var>.</p>
      </ol>
     </div>
    </section>
    <section>
     <h3 class="heading settled" data-level="9.11" id="algo-is-value-compatible"><span class="secno">9.11. </span><span class="content"><dfn data-dfn-type="dfn" data-export data-lt="is-value-compatible" id="is-value-compatible">Determine if value is compatible with policy for feature<a class="self-link" href="#is-value-compatible"></a></dfn></span><a class="self-link" href="#algo-is-value-compatible"></a></h3>
     <div class="algorithm" data-algorithm="is-value-compatible">
       Given a value (<var>value</var>), a feature (<var>feature</var>) and a <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#document" id="ref-for-document③">Document</a></code> object
    (<var>document</var>), this algorithm returns "compatible" if <var>value</var> is compatible
    with <var>document</var>’s <a data-link-type="dfn" href="#document-policy" id="ref-for-document-policy①⑨">document policy</a>, or else "incompatible". 
      <ol>
       <li data-md>
        <p>Let (<var>action</var>, <var>reporting endpoint</var>) be the result of
calling <a data-link-type="dfn" href="#determine-compatibility" id="ref-for-determine-compatibility①">determine-compatibility</a> with <var>value</var>, <var>feature</var> and <var>document</var>.</p>
       <li data-md>
        <p>Return <var>action</var>.</p>
      </ol>
     </div>
    </section>
   </section>
   <section>
    <h2 class="heading settled" data-level="10" id="iana-considerations"><span class="secno">10. </span><span class="content">IANA Considerations</span><a class="self-link" href="#iana-considerations"></a></h2>
    <p>The permanent message header field registry should be updated with the
  following registrations <a data-link-type="biblio" href="#biblio-rfc3864">[RFC3864]</a>:</p>
    <dl>
     <dt>Header field name
     <dd>Document-Policy
     <dt>Applicable protocol
     <dd>http
     <dt>Status
     <dd>standard
     <dt>Author/Change controller
     <dd>W3C
     <dt>Specification document
     <dd> <a href>Document Policy API</a> 
    </dl>
    <dl>
     <dt>Header field name
     <dd>Require-Document-Policy
     <dt>Applicable protocol
     <dd>http
     <dt>Status
     <dd>standard
     <dt>Author/Change controller
     <dd>W3C
     <dt>Specification document
     <dd> <a href>Document Policy API</a> 
    </dl>
    <dl>
     <dt>Header field name
     <dd>Sec-Required-Document-Policy
     <dt>Applicable protocol
     <dd>http
     <dt>Status
     <dd>standard
     <dt>Author/Change controller
     <dd>W3C
     <dt>Specification document
     <dd> <a href>Document Policy API</a> 
    </dl>
   </section>
   <section class="informative" id="privacy">
    <h2 class="heading settled" data-level="11" id="privacy-and-security"><span class="secno">11. </span><span class="content">Privacy and Security</span><a class="self-link" href="#privacy-and-security"></a></h2>
    <p>This specification standardizes a mechanism for an embedding page to set a
  policy which will be enforced on an embedded page. When explicit
  acknowledgment of a required policy is not required, similar to iframe <code><a data-link-type="element-sub" href="https://html.spec.whatwg.org/multipage/iframe-embed-object.html#attr-iframe-sandbox" id="ref-for-attr-iframe-sandbox">sandbox</a></code>, this means that behaviors of existing features may be
  changed in published web sites, by embedding them in another document with an
  appropriate required policy.</p>
    <p>As such, the biggest privacy and security concerns are:</p>
    <ul>
     <li data-md>
      <p>Exposure of behavior in a cross-origin subframe to its embedder.</p>
     <li data-md>
      <p>Unanticipated behavior changes in subframes controlled by the embedder.</p>
    </ul>
    <p>To a degree, these concerns are already present in the web platform, and this
  specification attempts to at least not make them needlessly worse.</p>
    <p>Security and privacy issues may also be caused by the design of individual
  features, so care must be taken when integrating with this specification. This
  section attempts to provide some guidance as to what kinds of behaviors could
  cause such issues.</p>
    <h3 class="heading settled" data-level="11.1" id="exposure-of-cross-origin-behavior"><span class="secno">11.1. </span><span class="content">Exposure of cross-origin behavior {#exposure-of-cross-origin-behavior}</span><a class="self-link" href="#exposure-of-cross-origin-behavior"></a></h3>
    <p>Features should be designed such that a violation of the policy in a
  framed document is not observable by documents in other frames. For instance,
  a hypothetical feature which caused a event to be fired in the embedding
  document if it is used while disabled by policy, could be used to extract
  information about the state of an embedded document. If the feature is known
  only to be used while a user is logged in to the site, for instance, then the
  embedder could disable that feature for the frame, and then listen for the
  resulting events to determine whether or not the user is logged in.</p>
    <h3 class="heading settled" data-level="11.2" id="unanticipated-behavior-changes"><span class="secno">11.2. </span><span class="content">Unanticipated behavior changes</span><a class="self-link" href="#unanticipated-behavior-changes"></a></h3>
    <p>Document policy grants a document the ability to control which features will
  and will not be availble in a subframe at the time it is loaded. When a
  feature represents an existing, long-standing behavior of the web platform,
  this may mean that existing published content on the web was not written with
  the expectation that a particular API could fail.</p>
    <p>This is very similar to the existing iframe sandboxing mechanism, where
  behaviour can be changed without the explicit consent of the embedded page,
  but it is not clear that is always safe.</p>
    <p>When considering placing such a feature under policy control, standards
  authors are strongly encouraged to require opt-in by the embedded document.
  This means that existing content will not be allowed to be loaded in a context
  where that behaviour is changed, until it is configured to recognize and
  accept the policy.</p>
    <h3 class="heading settled" data-level="11.3" id="advertisement-of-required-policy"><span class="secno">11.3. </span><span class="content">Advertisement of required policy</span><a class="self-link" href="#advertisement-of-required-policy"></a></h3>
    <p>As a mitigation to the behaviour change problem discussed above, requests for
  embedded content in a frame with a required policy will be sent with an HTTP
  header detailing the policy requirements. This header is visible to origin
  servers, and its contents may reveal details about the embedder page.
  Embedders should be aware of this when choosing to require a policy on their
  embedded content.</p>
   </section>
  </main>
  <h2 class="no-ref no-num heading settled" id="conformance"><span class="content">Conformance</span><a class="self-link" href="#conformance"></a></h2>
  <h3 class="no-ref no-num heading settled" id="conventions"><span class="content">Document conventions</span><a class="self-link" href="#conventions"></a></h3>
  <p>Conformance requirements are expressed with a combination of
    descriptive assertions and RFC 2119 terminology. The key words “MUST”,
    “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”,
    “RECOMMENDED”, “MAY”, and “OPTIONAL” in the normative parts of this
    document are to be interpreted as described in RFC 2119.
    However, for readability, these words do not appear in all uppercase
    letters in this specification. </p>
  <p>All of the text of this specification is normative except sections
    explicitly marked as non-normative, examples, and notes. <a data-link-type="biblio" href="#biblio-rfc2119">[RFC2119]</a></p>
  <p>Examples in this specification are introduced with the words “for example”
    or are set apart from the normative text with <code>class="example"</code>,
    like this: </p>
  <div class="example" id="example-ae2b6bc0">
   <a class="self-link" href="#example-ae2b6bc0"></a> 
   <p>This is an example of an informative example.</p>
  </div>
  <p>Informative notes begin with the word “Note” and are set apart from the
    normative text with <code>class="note"</code>, like this: </p>
  <p class="note" role="note">Note, this is an informative note.</p>
  <h3 class="no-ref no-num heading settled" id="conformant-algorithms"><span class="content">Conformant Algorithms</span><a class="self-link" href="#conformant-algorithms"></a></h3>
  <p>Requirements phrased in the imperative as part of algorithms (such as
    "strip any leading space characters" or "return false and abort these
    steps") are to be interpreted with the meaning of the key word ("must",
    "should", "may", etc) used in introducing the algorithm.</p>
  <p>Conformance requirements phrased as algorithms or specific steps can be
    implemented in any manner, so long as the end result is equivalent. In
    particular, the algorithms defined in this specification are intended to
    be easy to understand and are not intended to be performant. Implementers
    are encouraged to optimize.</p>
<script src="https://www.w3.org/scripts/TR/2016/fixup.js"></script>
  <h2 class="no-num no-ref heading settled" id="index"><span class="content">Index</span><a class="self-link" href="#index"></a></h2>
  <h3 class="no-num no-ref heading settled" id="index-defined-here"><span class="content">Terms defined by this specification</span><a class="self-link" href="#index-defined-here"></a></h3>
  <ul class="index">
   <li><a href="#create-document-policy">create-document-policy</a><span>, in §9.6</span>
   <li><a href="#create-for-browsingcontext">create-for-browsingcontext</a><span>, in §9.5</span>
   <li><a href="#declared-document-policy">declared document policy</a><span>, in §4.2</span>
   <li><a href="#default-value">default value</a><span>, in §4.1</span>
   <li><a href="#determine-compatibility">determine-compatibility</a><span>, in §9.9</span>
   <li><a href="#directive-name">directive name</a><span>, in §4.1.1</span>
   <li><a href="#document-policy">document policy</a><span>, in §4.2</span>
   <li><a href="#document-policy-header">Document-Policy</a><span>, in §7.2.1</span>
   <li><a href="#document-policy-directive">document policy directive</a><span>, in §4.1.1</span>
   <li><a href="#document-policy-feature">document policy feature</a><span>, in §4.1</span>
   <li><a href="#document-policy-report-only-header">Document-Policy-Report-Only</a><span>, in §7.2.2</span>
   <li><a href="#get-and-parse-a-structured-header">get and parse a structured header</a><span>, in §8.2</span>
   <li><a href="#get-policy-value">get-policy-value</a><span>, in §9.8</span>
   <li><a href="#is-policy-compatible">Is policy compatible</a><span>, in §9.1</span>
   <li><a href="#is-value-compatible">is-value-compatible</a><span>, in §9.11</span>
   <li><a href="#is-value-compatible-or-report">is-value-compatible-or-report</a><span>, in §9.10</span>
   <li><a href="#nested-context-required-document-policy">nested context required document policy</a><span>, in §4.2</span>
   <li><a href="#parse-document-policy">Parse document policy</a><span>, in §9.3</span>
   <li><a href="#policy-configuration">policy configuration</a><span>, in §4.2</span>
   <li><a href="#policy-directive">policy directive</a><span>, in §7.1</span>
   <li><a href="#process-response-policy">Process response policy</a><span>, in §9.2</span>
   <li><a href="#policy-configuration-reporting-endpoint">reporting endpoint</a><span>, in §4.2</span>
   <li><a href="#report-only-document-policy">report-only document policy</a><span>, in §4.2</span>
   <li><a href="#request-required-document-policy">request-required-document-policy</a><span>, in §8.2</span>
   <li><a href="#required-document-policy">required document policy</a><span>, in §4.2</span>
   <li><a href="#require-document-policy-header">Require-Document-Policy</a><span>, in §7.2.3</span>
   <li><a href="#requires-acknowledgment">requires acknowledgment</a><span>, in §4.1</span>
   <li><a href="#sec-required-document-policy-header">Sec-Required-Document-Policy</a><span>, in §7.2.4</span>
   <li><a href="#serialized-document-policy">serialized document policy</a><span>, in §5</span>
   <li><a href="#serialize-required-policy">Serialize required policy</a><span>, in §9.4</span>
   <li><a href="#should-response-to-request-be-blocked-due-to-document-policy">Should response to request be blocked due to document policy</a><span>, in §9.7</span>
   <li><a href="#policy-configuration-value">value</a><span>, in §4.2</span>
  </ul>
  <aside class="dfn-panel" data-for="term-for-document">
   <a href="https://dom.spec.whatwg.org/#document">https://dom.spec.whatwg.org/#document</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-document">9.8. Get policy value for feature in document</a>
    <li><a href="#ref-for-document①">9.9. Determine compatibility of value with policy for feature</a>
    <li><a href="#ref-for-document②">9.10. Determine if value is compatible with policy for feature or report</a>
    <li><a href="#ref-for-document③">9.11. Determine if value is compatible with policy for feature</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-document-content-type">
   <a href="https://dom.spec.whatwg.org/#concept-document-content-type">https://dom.spec.whatwg.org/#concept-document-content-type</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-document-content-type">8.1. Integration with HTML</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-document">
   <a href="https://dom.spec.whatwg.org/#concept-document">https://dom.spec.whatwg.org/#concept-document</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-document">4.2. Policies</a> <a href="#ref-for-concept-document①">(2)</a>
    <li><a href="#ref-for-concept-document②">8.1. Integration with HTML</a> <a href="#ref-for-concept-document③">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-html-document">
   <a href="https://dom.spec.whatwg.org/#html-document">https://dom.spec.whatwg.org/#html-document</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-html-document">8.1. Integration with HTML</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-document-quirks">
   <a href="https://dom.spec.whatwg.org/#concept-document-quirks">https://dom.spec.whatwg.org/#concept-document-quirks</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-document-quirks">8.1. Integration with HTML</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-policy-controlled-feature">
   <a href="https://w3c.github.io/webappsec-permissions-policy/#policy-controlled-feature">https://w3c.github.io/webappsec-permissions-policy/#policy-controlled-feature</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-policy-controlled-feature">4.2. Policies</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-header">
   <a href="https://fetch.spec.whatwg.org/#concept-header">https://fetch.spec.whatwg.org/#concept-header</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-header">9.2. Process response policy</a> <a href="#ref-for-concept-header①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-response-header-list">
   <a href="https://fetch.spec.whatwg.org/#concept-response-header-list">https://fetch.spec.whatwg.org/#concept-response-header-list</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-response-header-list">9.2. Process response policy</a> <a href="#ref-for-concept-response-header-list①">(2)</a>
    <li><a href="#ref-for-concept-response-header-list②">9.7. Should response to request be blocked due to document policy?</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-header-name">
   <a href="https://fetch.spec.whatwg.org/#concept-header-name">https://fetch.spec.whatwg.org/#concept-header-name</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-header-name">9.2. Process response policy</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-request-request">
   <a href="https://fetch.spec.whatwg.org/#concept-request-request">https://fetch.spec.whatwg.org/#concept-request-request</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-request-request">8.2. Integration with Fetch</a>
    <li><a href="#ref-for-concept-request-request①">9.7. Should response to request be blocked due to document policy?</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-response-response">
   <a href="https://fetch.spec.whatwg.org/#concept-response-response">https://fetch.spec.whatwg.org/#concept-response-response</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-response-response">7.2.1. Document-Policy</a>
    <li><a href="#ref-for-concept-response-response①">7.2.2. Document-Policy-Report-Only</a>
    <li><a href="#ref-for-concept-response-response②">9.2. Process response policy</a>
    <li><a href="#ref-for-concept-response-response③">9.6. Create a document Policy for a browsing context from response</a>
    <li><a href="#ref-for-concept-response-response④">9.7. Should response to request be blocked due to document policy?</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-active-sandboxing-flag-set">
   <a href="https://html.spec.whatwg.org/multipage/origin.html#active-sandboxing-flag-set">https://html.spec.whatwg.org/multipage/origin.html#active-sandboxing-flag-set</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-active-sandboxing-flag-set">8.1. Integration with HTML</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-browsing-context">
   <a href="https://html.spec.whatwg.org/multipage/browsers.html#browsing-context">https://html.spec.whatwg.org/multipage/browsers.html#browsing-context</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-browsing-context">4.2. Policies</a> <a href="#ref-for-browsing-context①">(2)</a> <a href="#ref-for-browsing-context②">(3)</a>
    <li><a href="#ref-for-browsing-context③">9.5. Create a required policy for a browsing context</a>
    <li><a href="#ref-for-browsing-context④">9.6. Create a document Policy for a browsing context from response</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-browsing-context-container">
   <a href="https://html.spec.whatwg.org/multipage/browsers.html#browsing-context-container">https://html.spec.whatwg.org/multipage/browsers.html#browsing-context-container</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-browsing-context-container">9.5. Create a required policy for a browsing context</a> <a href="#ref-for-browsing-context-container①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-creating-a-new-browsing-context">
   <a href="https://html.spec.whatwg.org/multipage/browsers.html#creating-a-new-browsing-context">https://html.spec.whatwg.org/multipage/browsers.html#creating-a-new-browsing-context</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-creating-a-new-browsing-context">8.1. Integration with HTML</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-environment-settings-object">
   <a href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object">https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-environment-settings-object">9.10. Determine if value is compatible with policy for feature or report</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-the-iframe-element">
   <a href="https://html.spec.whatwg.org/multipage/iframe-embed-object.html#the-iframe-element">https://html.spec.whatwg.org/multipage/iframe-embed-object.html#the-iframe-element</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-the-iframe-element">7.3. The policy attribute of the iframe element</a>
    <li><a href="#ref-for-the-iframe-element①">8.1. Integration with HTML</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-initialise-the-document-object">
   <a href="https://html.spec.whatwg.org/multipage/browsers.html#initialise-the-document-object">https://html.spec.whatwg.org/multipage/browsers.html#initialise-the-document-object</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-initialise-the-document-object">8.1. Integration with HTML</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-nested-browsing-context">
   <a href="https://html.spec.whatwg.org/multipage/browsers.html#nested-browsing-context">https://html.spec.whatwg.org/multipage/browsers.html#nested-browsing-context</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-nested-browsing-context">8.1. Integration with HTML</a>
    <li><a href="#ref-for-nested-browsing-context①">9.5. Create a required policy for a browsing context</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-opener-browsing-context">
   <a href="https://html.spec.whatwg.org/multipage/browsers.html#opener-browsing-context">https://html.spec.whatwg.org/multipage/browsers.html#opener-browsing-context</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-opener-browsing-context">4.2. Policies</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-request-origin">
   <a href="https://html.spec.whatwg.org/multipage/infrastructure.html#concept-request-origin">https://html.spec.whatwg.org/multipage/infrastructure.html#concept-request-origin</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-request-origin">8.1. Integration with HTML</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-process-a-navigate-fetch">
   <a href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#process-a-navigate-fetch">https://html.spec.whatwg.org/multipage/browsing-the-web.html#process-a-navigate-fetch</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-process-a-navigate-fetch">8.1. Integration with HTML</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-attr-iframe-sandbox">
   <a href="https://html.spec.whatwg.org/multipage/iframe-embed-object.html#attr-iframe-sandbox">https://html.spec.whatwg.org/multipage/iframe-embed-object.html#attr-iframe-sandbox</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-attr-iframe-sandbox">11. Privacy and Security</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-endpoint">
   <a href="https://w3c.github.io/reporting/#endpoint">https://w3c.github.io/reporting/#endpoint</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-endpoint">6.1.1. The "report-to" parameter</a>
    <li><a href="#ref-for-endpoint①">6.1.2. Setting the default reporting endpoint</a> <a href="#ref-for-endpoint②">(2)</a>
    <li><a href="#ref-for-endpoint③">9.9. Determine compatibility of value with policy for feature</a>
   </ul>
  </aside>
  <h3 class="no-num no-ref heading settled" id="index-defined-elsewhere"><span class="content">Terms defined by reference</span><a class="self-link" href="#index-defined-elsewhere"></a></h3>
  <ul class="index">
   <li>
    <a data-link-type="biblio">[DOM]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-document">Document</span>
     <li><span class="dfn-paneled" id="term-for-concept-document-content-type">content type</span>
     <li><span class="dfn-paneled" id="term-for-concept-document">document</span>
     <li><span class="dfn-paneled" id="term-for-html-document">html document</span>
     <li><span class="dfn-paneled" id="term-for-concept-document-quirks">quirks mode</span>
    </ul>
   <li>
    <a data-link-type="biblio">[FEATURE-POLICY]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-policy-controlled-feature">policy-controlled feature</span>
    </ul>
   <li>
    <a data-link-type="biblio">[FETCH]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-concept-header">header</span>
     <li><span class="dfn-paneled" id="term-for-concept-response-header-list">header list <small>(for response)</small></span>
     <li><span class="dfn-paneled" id="term-for-concept-header-name">name</span>
     <li><span class="dfn-paneled" id="term-for-concept-request-request">request</span>
     <li><span class="dfn-paneled" id="term-for-concept-response-response">response</span>
    </ul>
   <li>
    <a data-link-type="biblio">[HTML]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-active-sandboxing-flag-set">active sandboxing flag set</span>
     <li><span class="dfn-paneled" id="term-for-browsing-context">browsing context</span>
     <li><span class="dfn-paneled" id="term-for-browsing-context-container">browsing context container</span>
     <li><span class="dfn-paneled" id="term-for-creating-a-new-browsing-context">creating a new browsing context</span>
     <li><span class="dfn-paneled" id="term-for-environment-settings-object">environment settings object</span>
     <li><span class="dfn-paneled" id="term-for-the-iframe-element">iframe</span>
     <li><span class="dfn-paneled" id="term-for-initialise-the-document-object">initialise the document object</span>
     <li><span class="dfn-paneled" id="term-for-nested-browsing-context">nested browsing context</span>
     <li><span class="dfn-paneled" id="term-for-opener-browsing-context">opener browsing context</span>
     <li><span class="dfn-paneled" id="term-for-concept-request-origin">origin</span>
     <li><span class="dfn-paneled" id="term-for-process-a-navigate-fetch">process a navigate fetch</span>
     <li><span class="dfn-paneled" id="term-for-attr-iframe-sandbox">sandbox</span>
    </ul>
   <li>
    <a data-link-type="biblio">[REPORTING]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-endpoint">endpoint</span>
    </ul>
  </ul>
  <h2 class="no-num no-ref heading settled" id="references"><span class="content">References</span><a class="self-link" href="#references"></a></h2>
  <h3 class="no-num no-ref heading settled" id="normative"><span class="content">Normative References</span><a class="self-link" href="#normative"></a></h3>
  <dl>
   <dt id="biblio-dom">[DOM]
   <dd>Anne van Kesteren. <a href="https://dom.spec.whatwg.org/">DOM Standard</a>. Living Standard. URL: <a href="https://dom.spec.whatwg.org/">https://dom.spec.whatwg.org/</a>
   <dt id="biblio-feature-policy">[FEATURE-POLICY]
   <dd>Ian Clelland. <a href="https://www.w3.org/TR/permissions-policy-1/">Permissions Policy</a>. 16 July 2020. WD. URL: <a href="https://www.w3.org/TR/permissions-policy-1/">https://www.w3.org/TR/permissions-policy-1/</a>
   <dt id="biblio-fetch">[FETCH]
   <dd>Anne van Kesteren. <a href="https://fetch.spec.whatwg.org/">Fetch Standard</a>. Living Standard. URL: <a href="https://fetch.spec.whatwg.org/">https://fetch.spec.whatwg.org/</a>
   <dt id="biblio-header-structure">[HEADER-STRUCTURE]
   <dd>Mark Nottingham; Poul-Henning Kamp. <a href="https://tools.ietf.org/html/draft-ietf-httpbis-header-structure-14">Structured Headers for HTTP</a>. Draft. URL: <a href="https://tools.ietf.org/html/draft-ietf-httpbis-header-structure-14">https://tools.ietf.org/html/draft-ietf-httpbis-header-structure-14</a>
   <dt id="biblio-html">[HTML]
   <dd>Anne van Kesteren; et al. <a href="https://html.spec.whatwg.org/multipage/">HTML Standard</a>. Living Standard. URL: <a href="https://html.spec.whatwg.org/multipage/">https://html.spec.whatwg.org/multipage/</a>
   <dt id="biblio-reporting">[REPORTING]
   <dd>Douglas Creager; et al. <a href="https://www.w3.org/TR/reporting-1/">Reporting API</a>. 25 September 2018. WD. URL: <a href="https://www.w3.org/TR/reporting-1/">https://www.w3.org/TR/reporting-1/</a>
   <dt id="biblio-rfc2119">[RFC2119]
   <dd>S. Bradner. <a href="https://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>. March 1997. Best Current Practice. URL: <a href="https://tools.ietf.org/html/rfc2119">https://tools.ietf.org/html/rfc2119</a>
   <dt id="biblio-rfc3864">[RFC3864]
   <dd>G. Klyne; M. Nottingham; J. Mogul. <a href="https://tools.ietf.org/html/rfc3864">Registration Procedures for Message Header Fields</a>. September 2004. Best Current Practice. URL: <a href="https://tools.ietf.org/html/rfc3864">https://tools.ietf.org/html/rfc3864</a>
  </dl>
  <h3 class="no-num no-ref heading settled" id="informative"><span class="content">Informative References</span><a class="self-link" href="#informative"></a></h3>
  <dl>
   <dt id="biblio-csp">[CSP]
   <dd>Mike West. <a href="https://www.w3.org/TR/CSP3/">Content Security Policy Level 3</a>. 15 October 2018. WD. URL: <a href="https://www.w3.org/TR/CSP3/">https://www.w3.org/TR/CSP3/</a>
   <dt id="biblio-ecma-262">[ECMA-262]
   <dd><a href="https://tc39.es/ecma262/">ECMAScript Language Specification</a>. URL: <a href="https://tc39.es/ecma262/">https://tc39.es/ecma262/</a>
  </dl>
  <aside class="dfn-panel" data-for="document-policy-feature">
   <b><a href="#document-policy-feature">#document-policy-feature</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-document-policy-feature">4.1.1. Directives</a> <a href="#ref-for-document-policy-feature①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="default-value">
   <b><a href="#default-value">#default-value</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-default-value">9.8. Get policy value for feature in document</a>
    <li><a href="#ref-for-default-value①">9.9. Determine compatibility of value with policy for feature</a> <a href="#ref-for-default-value②">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="requires-acknowledgment">
   <b><a href="#requires-acknowledgment">#requires-acknowledgment</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-requires-acknowledgment">9.1. Is policy compatible?</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="directive-name">
   <b><a href="#directive-name">#directive-name</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-directive-name">4.1.1. Directives</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="document-policy">
   <b><a href="#document-policy">#document-policy</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-document-policy">4.1.1. Directives</a>
    <li><a href="#ref-for-document-policy①">4.2. Policies</a> <a href="#ref-for-document-policy②">(2)</a> <a href="#ref-for-document-policy③">(3)</a> <a href="#ref-for-document-policy④">(4)</a>
    <li><a href="#ref-for-document-policy⑤">7.2.1. Document-Policy</a>
    <li><a href="#ref-for-document-policy⑥">7.2.4. Sec-Required-Document-Policy</a>
    <li><a href="#ref-for-document-policy⑦">8.1. Integration with HTML</a>
    <li><a href="#ref-for-document-policy⑧">8.2. Integration with Fetch</a>
    <li><a href="#ref-for-document-policy⑨">9.3. Parse document policy</a>
    <li><a href="#ref-for-document-policy①⓪">9.4. Serialize required policy</a>
    <li><a href="#ref-for-document-policy①①">9.5. Create a required policy for a browsing context</a>
    <li><a href="#ref-for-document-policy①②">9.6. Create a document Policy for a browsing context from response</a>
    <li><a href="#ref-for-document-policy①③">9.8. Get policy value for feature in document</a> <a href="#ref-for-document-policy①④">(2)</a>
    <li><a href="#ref-for-document-policy①⑤">9.9. Determine compatibility of value with policy for feature</a> <a href="#ref-for-document-policy①⑥">(2)</a> <a href="#ref-for-document-policy①⑦">(3)</a>
    <li><a href="#ref-for-document-policy①⑧">9.10. Determine if value is compatible with policy for feature or report</a>
    <li><a href="#ref-for-document-policy①⑨">9.11. Determine if value is compatible with policy for feature</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="policy-configuration">
   <b><a href="#policy-configuration">#policy-configuration</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-policy-configuration">4.2. Policies</a>
    <li><a href="#ref-for-policy-configuration①">9.3. Parse document policy</a> <a href="#ref-for-policy-configuration②">(2)</a> <a href="#ref-for-policy-configuration③">(3)</a> <a href="#ref-for-policy-configuration④">(4)</a> <a href="#ref-for-policy-configuration⑤">(5)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="policy-configuration-value">
   <b><a href="#policy-configuration-value">#policy-configuration-value</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-policy-configuration-value">9.2. Process response policy</a>
    <li><a href="#ref-for-policy-configuration-value①">9.3. Parse document policy</a> <a href="#ref-for-policy-configuration-value②">(2)</a> <a href="#ref-for-policy-configuration-value③">(3)</a> <a href="#ref-for-policy-configuration-value④">(4)</a> <a href="#ref-for-policy-configuration-value⑤">(5)</a>
    <li><a href="#ref-for-policy-configuration-value⑥">9.8. Get policy value for feature in document</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="policy-configuration-reporting-endpoint">
   <b><a href="#policy-configuration-reporting-endpoint">#policy-configuration-reporting-endpoint</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-policy-configuration-reporting-endpoint">9.3. Parse document policy</a> <a href="#ref-for-policy-configuration-reporting-endpoint①">(2)</a> <a href="#ref-for-policy-configuration-reporting-endpoint②">(3)</a> <a href="#ref-for-policy-configuration-reporting-endpoint③">(4)</a> <a href="#ref-for-policy-configuration-reporting-endpoint④">(5)</a> <a href="#ref-for-policy-configuration-reporting-endpoint⑤">(6)</a> <a href="#ref-for-policy-configuration-reporting-endpoint⑥">(7)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="required-document-policy">
   <b><a href="#required-document-policy">#required-document-policy</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-required-document-policy">4.2. Policies</a>
    <li><a href="#ref-for-required-document-policy①">7.2.3. Require-Document-Policy</a>
    <li><a href="#ref-for-required-document-policy②">8.1. Integration with HTML</a> <a href="#ref-for-required-document-policy③">(2)</a> <a href="#ref-for-required-document-policy④">(3)</a> <a href="#ref-for-required-document-policy⑤">(4)</a> <a href="#ref-for-required-document-policy⑥">(5)</a>
    <li><a href="#ref-for-required-document-policy⑦">9.1. Is policy compatible?</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="nested-context-required-document-policy">
   <b><a href="#nested-context-required-document-policy">#nested-context-required-document-policy</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-nested-context-required-document-policy">9.5. Create a required policy for a browsing context</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="declared-document-policy">
   <b><a href="#declared-document-policy">#declared-document-policy</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-declared-document-policy">9.1. Is policy compatible?</a>
    <li><a href="#ref-for-declared-document-policy①">9.2. Process response policy</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="report-only-document-policy">
   <b><a href="#report-only-document-policy">#report-only-document-policy</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-report-only-document-policy">7.2.2. Document-Policy-Report-Only</a>
    <li><a href="#ref-for-report-only-document-policy①">9.9. Determine compatibility of value with policy for feature</a> <a href="#ref-for-report-only-document-policy②">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="serialized-document-policy">
   <b><a href="#serialized-document-policy">#serialized-document-policy</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-serialized-document-policy">8.1. Integration with HTML</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="policy-directive">
   <b><a href="#policy-directive">#policy-directive</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-policy-directive">7.2.4. Sec-Required-Document-Policy</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="request-required-document-policy">
   <b><a href="#request-required-document-policy">#request-required-document-policy</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-request-required-document-policy">8.2. Integration with Fetch</a> <a href="#ref-for-request-required-document-policy①">(2)</a>
    <li><a href="#ref-for-request-required-document-policy②">9.7. Should response to request be blocked due to document policy?</a> <a href="#ref-for-request-required-document-policy③">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="is-policy-compatible">
   <b><a href="#is-policy-compatible">#is-policy-compatible</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-is-policy-compatible">9.6. Create a document Policy for a browsing context from response</a>
    <li><a href="#ref-for-is-policy-compatible">9.7. Should response to request be blocked due to document policy?</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="process-response-policy">
   <b><a href="#process-response-policy">#process-response-policy</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-process-response-policy">9.6. Create a document Policy for a browsing context from response</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="parse-document-policy">
   <b><a href="#parse-document-policy">#parse-document-policy</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-parse-document-policy">9.2. Process response policy</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="serialize-required-policy">
   <b><a href="#serialize-required-policy">#serialize-required-policy</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-serialize-required-policy">8.2. Integration with Fetch</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="create-for-browsingcontext">
   <b><a href="#create-for-browsingcontext">#create-for-browsingcontext</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-create-for-browsingcontext">8.1. Integration with HTML</a>
    <li><a href="#ref-for-create-for-browsingcontext①">9.6. Create a document Policy for a browsing context from response</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="create-document-policy">
   <b><a href="#create-document-policy">#create-document-policy</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-create-document-policy">8.1. Integration with HTML</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="should-response-to-request-be-blocked-due-to-document-policy">
   <b><a href="#should-response-to-request-be-blocked-due-to-document-policy">#should-response-to-request-be-blocked-due-to-document-policy</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-should-response-to-request-be-blocked-due-to-document-policy">8.2. Integration with Fetch</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="determine-compatibility">
   <b><a href="#determine-compatibility">#determine-compatibility</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-determine-compatibility">9.10. Determine if value is compatible with policy for feature or report</a>
    <li><a href="#ref-for-determine-compatibility①">9.11. Determine if value is compatible with policy for feature</a>
   </ul>
  </aside>
<script>/* script-dfn-panel */

document.body.addEventListener("click", function(e) {
    var queryAll = function(sel) { return [].slice.call(document.querySelectorAll(sel)); }
    // Find the dfn element or panel, if any, that was clicked on.
    var el = e.target;
    var target;
    var hitALink = false;
    while(el.parentElement) {
        if(el.tagName == "A") {
            // Clicking on a link in a <dfn> shouldn't summon the panel
            hitALink = true;
        }
        if(el.classList.contains("dfn-paneled")) {
            target = "dfn";
            break;
        }
        if(el.classList.contains("dfn-panel")) {
            target = "dfn-panel";
            break;
        }
        el = el.parentElement;
    }
    if(target != "dfn-panel") {
        // Turn off any currently "on" or "activated" panels.
        queryAll(".dfn-panel.on, .dfn-panel.activated").forEach(function(el){
            el.classList.remove("on");
            el.classList.remove("activated");
        });
    }
    if(target == "dfn" && !hitALink) {
        // open the panel
        var dfnPanel = document.querySelector(".dfn-panel[data-for='" + el.id + "']");
        if(dfnPanel) {
            dfnPanel.classList.add("on");
            var rect = el.getBoundingClientRect();
            dfnPanel.style.left = window.scrollX + rect.right + 5 + "px";
            dfnPanel.style.top = window.scrollY + rect.top + "px";
            var panelRect = dfnPanel.getBoundingClientRect();
            var panelWidth = panelRect.right - panelRect.left;
            if(panelRect.right > document.body.scrollWidth && (rect.left - (panelWidth + 5)) > 0) {
                // Reposition, because the panel is overflowing
                dfnPanel.style.left = window.scrollX + rect.left - (panelWidth + 5) + "px";
            }
        } else {
            console.log("Couldn't find .dfn-panel[data-for='" + el.id + "']");
        }
    } else if(target == "dfn-panel") {
        // Switch it to "activated" state, which pins it.
        el.classList.add("activated");
        el.style.left = null;
        el.style.top = null;
    }

});
</script>
<script>/* script-var-click-highlighting */

    document.addEventListener("click", e=>{
        if(e.target.nodeName == "VAR") {
            highlightSameAlgoVars(e.target);
        }
    });
    {
        const indexCounts = new Map();
        const indexNames = new Map();
        function highlightSameAlgoVars(v) {
            // Find the algorithm container.
            let algoContainer = null;
            let searchEl = v;
            while(algoContainer == null && searchEl != document.body) {
                searchEl = searchEl.parentNode;
                if(searchEl.hasAttribute("data-algorithm")) {
                    algoContainer = searchEl;
                }
            }

            // Not highlighting document-global vars,
            // too likely to be unrelated.
            if(algoContainer == null) return;

            const algoName = algoContainer.getAttribute("data-algorithm");
            const varName = getVarName(v);
            const addClass = !v.classList.contains("selected");
            let highlightClass = null;
            if(addClass) {
                const index = chooseHighlightIndex(algoName, varName);
                indexCounts.get(algoName)[index] += 1;
                indexNames.set(algoName+"///"+varName, index);
                highlightClass = nameFromIndex(index);
            } else {
                const index = previousHighlightIndex(algoName, varName);
                indexCounts.get(algoName)[index] -= 1;
                highlightClass = nameFromIndex(index);
            }

            // Find all same-name vars, and toggle their class appropriately.
            for(const el of algoContainer.querySelectorAll("var")) {
                if(getVarName(el) == varName) {
                    el.classList.toggle("selected", addClass);
                    el.classList.toggle(highlightClass, addClass);
                }
            }
        }
        function getVarName(el) {
            return el.textContent.replace(/(\s|\xa0)+/, " ").trim();
        }
        function chooseHighlightIndex(algoName, varName) {
            let indexes = null;
            if(indexCounts.has(algoName)) {
                indexes = indexCounts.get(algoName);
            } else {
                // 7 classes right now
                indexes = [0,0,0,0,0,0,0];
                indexCounts.set(algoName, indexes);
            }

            // If the element was recently unclicked,
            // *and* that color is still unclaimed,
            // give it back the same color.
            const lastIndex = previousHighlightIndex(algoName, varName);
            if(indexes[lastIndex] === 0) return lastIndex;

            // Find the earliest index with the lowest count.
            const minCount = Math.min.apply(null, indexes);
            let index = null;
            for(var i = 0; i < indexes.length; i++) {
                if(indexes[i] == minCount) {
                    return i;
                }
            }
        }
        function previousHighlightIndex(algoName, varName) {
            return indexNames.get(algoName+"///"+varName);
        }
        function nameFromIndex(index) {
            return "selected" + index;
        }
    }
    </script>