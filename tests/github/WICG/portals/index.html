<!doctype html><html lang="en">
 <head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
  <title>Portals</title>
  <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
  <link href="https://www.w3.org/StyleSheets/TR/2021/cg-draft" rel="stylesheet">
  <link href="https://wicg.github.io/portals/" rel="canonical">
  <meta content="dark light" name="color-scheme">
  <link href="https://www.w3.org/StyleSheets/TR/2021/dark.css" media="(prefers-color-scheme: dark)" rel="stylesheet" type="text/css">
<style>/* Boilerplate: style-autolinks */
.css.css, .property.property, .descriptor.descriptor {
    color: var(--a-normal-text);
    font-size: inherit;
    font-family: inherit;
}
.css::before, .property::before, .descriptor::before {
    content: "‘";
}
.css::after, .property::after, .descriptor::after {
    content: "’";
}
.property, .descriptor {
    /* Don't wrap property and descriptor names */
    white-space: nowrap;
}
.type { /* CSS value <type> */
    font-style: italic;
}
pre .property::before, pre .property::after {
    content: "";
}
[data-link-type="property"]::before,
[data-link-type="propdesc"]::before,
[data-link-type="descriptor"]::before,
[data-link-type="value"]::before,
[data-link-type="function"]::before,
[data-link-type="at-rule"]::before,
[data-link-type="selector"]::before,
[data-link-type="maybe"]::before {
    content: "‘";
}
[data-link-type="property"]::after,
[data-link-type="propdesc"]::after,
[data-link-type="descriptor"]::after,
[data-link-type="value"]::after,
[data-link-type="function"]::after,
[data-link-type="at-rule"]::after,
[data-link-type="selector"]::after,
[data-link-type="maybe"]::after {
    content: "’";
}

[data-link-type].production::before,
[data-link-type].production::after,
.prod [data-link-type]::before,
.prod [data-link-type]::after {
    content: "";
}

[data-link-type=element],
[data-link-type=element-attr] {
    font-family: Menlo, Consolas, "DejaVu Sans Mono", monospace;
    font-size: .9em;
}
[data-link-type=element]::before { content: "<" }
[data-link-type=element]::after  { content: ">" }

[data-link-type=biblio] {
    white-space: pre;
}

@media (prefers-color-scheme: dark) {
    :root {
        --selflink-text: black;
        --selflink-bg: silver;
        --selflink-hover-text: white;
    }
}
</style>
<style>/* Boilerplate: style-colors */
/* Any --*-text not paired with a --*-bg is assumed to have a transparent bg */
:root {
    color-scheme: light dark;

    --text: black;
    --bg: white;

    --unofficial-watermark: url(https://www.w3.org/StyleSheets/TR/2016/logos/UD-watermark);

    --logo-bg: #1a5e9a;
    --logo-active-bg: #c00;
    --logo-text: white;

    --tocnav-normal-text: #707070;
    --tocnav-normal-bg: var(--bg);
    --tocnav-hover-text: var(--tocnav-normal-text);
    --tocnav-hover-bg: #f8f8f8;
    --tocnav-active-text: #c00;
    --tocnav-active-bg: var(--tocnav-normal-bg);

    --tocsidebar-text: var(--text);
    --tocsidebar-bg: #f7f8f9;
    --tocsidebar-shadow: rgba(0,0,0,.1);
    --tocsidebar-heading-text: hsla(203,20%,40%,.7);

    --toclink-text: var(--text);
    --toclink-underline: #3980b5;
    --toclink-visited-text: var(--toclink-text);
    --toclink-visited-underline: #054572;

    --heading-text: #005a9c;

    --hr-text: var(--text);

    --algo-border: #def;

    --del-text: red;
    --del-bg: transparent;
    --ins-text: #080;
    --ins-bg: transparent;

    --a-normal-text: #034575;
    --a-normal-underline: #bbb;
    --a-visited-text: var(--a-normal-text);
    --a-visited-underline: #707070;
    --a-hover-bg: rgba(75%, 75%, 75%, .25);
    --a-active-text: #c00;
    --a-active-underline: #c00;

    --blockquote-border: silver;
    --blockquote-bg: transparent;
    --blockquote-text: currentcolor;

    --issue-border: #e05252;
    --issue-bg: #fbe9e9;
    --issue-text: var(--text);
    --issueheading-text: #831616;

    --example-border: #e0cb52;
    --example-bg: #fcfaee;
    --example-text: var(--text);
    --exampleheading-text: #574b0f;

    --note-border: #52e052;
    --note-bg: #e9fbe9;
    --note-text: var(--text);
    --noteheading-text: hsl(120, 70%, 30%);
    --notesummary-underline: silver;

    --assertion-border: #aaa;
    --assertion-bg: #eee;
    --assertion-text: black;

    --advisement-border: orange;
    --advisement-bg: #fec;
    --advisement-text: var(--text);
    --advisementheading-text: #b35f00;

    --warning-border: red;
    --warning-bg: hsla(40,100%,50%,0.95);
    --warning-text: var(--text);

    --amendment-border: #330099;
    --amendment-bg: #F5F0FF;
    --amendment-text: var(--text);
    --amendmentheading-text: #220066;

    --def-border: #8ccbf2;
    --def-bg: #def;
    --def-text: var(--text);
    --defrow-border: #bbd7e9;

    --datacell-border: silver;

    --indexinfo-text: #707070;

    --indextable-hover-text: black;
    --indextable-hover-bg: #f7f8f9;

    --outdatedspec-bg: rgba(0, 0, 0, .5);
    --outdatedspec-text: black;
    --outdated-bg: maroon;
    --outdated-text: white;
    --outdated-shadow: red;

    --editedrec-bg: darkorange;
}

@media (prefers-color-scheme: dark) {
    :root {
        --text: #ddd;
        --bg: black;

        --unofficial-watermark: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='400'%3E%3Cg fill='%23100808' transform='translate(200 200) rotate(-45) translate(-200 -200)' stroke='%23100808' stroke-width='3'%3E%3Ctext x='50%25' y='220' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EUNOFFICIAL%3C/text%3E%3Ctext x='50%25' y='305' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EDRAFT%3C/text%3E%3C/g%3E%3C/svg%3E");

        --logo-bg: #1a5e9a;
        --logo-active-bg: #c00;
        --logo-text: white;

        --tocnav-normal-text: #999;
        --tocnav-normal-bg: var(--bg);
        --tocnav-hover-text: var(--tocnav-normal-text);
        --tocnav-hover-bg: #080808;
        --tocnav-active-text: #f44;
        --tocnav-active-bg: var(--tocnav-normal-bg);

        --tocsidebar-text: var(--text);
        --tocsidebar-bg: #080808;
        --tocsidebar-shadow: rgba(255,255,255,.1);
        --tocsidebar-heading-text: hsla(203,20%,40%,.7);

        --toclink-text: var(--text);
        --toclink-underline: #6af;
        --toclink-visited-text: var(--toclink-text);
        --toclink-visited-underline: #054572;

        --heading-text: #8af;

        --hr-text: var(--text);

        --algo-border: #456;

        --del-text: #f44;
        --del-bg: transparent;
        --ins-text: #4a4;
        --ins-bg: transparent;

        --a-normal-text: #6af;
        --a-normal-underline: #555;
        --a-visited-text: var(--a-normal-text);
        --a-visited-underline: var(--a-normal-underline);
        --a-hover-bg: rgba(25%, 25%, 25%, .2);
        --a-active-text: #f44;
        --a-active-underline: var(--a-active-text);

        --borderedblock-bg: rgba(255, 255, 255, .05);

        --blockquote-border: silver;
        --blockquote-bg: var(--borderedblock-bg);
        --blockquote-text: currentcolor;

        --issue-border: #e05252;
        --issue-bg: var(--borderedblock-bg);
        --issue-text: var(--text);
        --issueheading-text: hsl(0deg, 70%, 70%);

        --example-border: hsl(50deg, 90%, 60%);
        --example-bg: var(--borderedblock-bg);
        --example-text: var(--text);
        --exampleheading-text: hsl(50deg, 70%, 70%);

        --note-border: hsl(120deg, 100%, 35%);
        --note-bg: var(--borderedblock-bg);
        --note-text: var(--text);
        --noteheading-text: hsl(120, 70%, 70%);
        --notesummary-underline: silver;

        --assertion-border: #444;
        --assertion-bg: var(--borderedblock-bg);
        --assertion-text: var(--text);

        --advisement-border: orange;
        --advisement-bg: #222218;
        --advisement-text: var(--text);
        --advisementheading-text: #f84;

        --warning-border: red;
        --warning-bg: hsla(40,100%,20%,0.95);
        --warning-text: var(--text);

        --amendment-border: #330099;
        --amendment-bg: #080010;
        --amendment-text: var(--text);
        --amendmentheading-text: #cc00ff;

        --def-border: #8ccbf2;
        --def-bg: #080818;
        --def-text: var(--text);
        --defrow-border: #136;

        --datacell-border: silver;

        --indexinfo-text: #aaa;

        --indextable-hover-text: var(--text);
        --indextable-hover-bg: #181818;

        --outdatedspec-bg: rgba(255, 255, 255, .5);
        --outdatedspec-text: black;
        --outdated-bg: maroon;
        --outdated-text: white;
        --outdated-shadow: red;

        --editedrec-bg: darkorange;
    }
    /* In case a transparent-bg image doesn't expect to be on a dark bg,
       which is quite common in practice... */
    img { background: white; }
}
</style>
<style>/* Boilerplate: style-counters */
body {
    counter-reset: example figure issue;
}
.issue {
    counter-increment: issue;
}
.issue:not(.no-marker)::before {
    content: "Issue " counter(issue);
}

.example {
    counter-increment: example;
}
.example:not(.no-marker)::before {
    content: "Example " counter(example);
}
.invalid.example:not(.no-marker)::before,
.illegal.example:not(.no-marker)::before {
    content: "Invalid Example" counter(example);
}

figcaption {
    counter-increment: figure;
}
figcaption:not(.no-marker)::before {
    content: "Figure " counter(figure) " ";
}
</style>
<style>/* Boilerplate: style-dfn-panel */
:root {
    --dfnpanel-bg: #ddd;
    --dfnpanel-text: var(--text);
    --dfnpanel-target-bg: #ffc;
    --dfnpanel-target-outline: orange;
}
@media (prefers-color-scheme: dark) {
    :root {
        --dfnpanel-bg: #222;
        --dfnpanel-text: var(--text);
        --dfnpanel-target-bg: #333;
        --dfnpanel-target-outline: silver;
    }
}
.dfn-panel {
    position: absolute;
    z-index: 35;
    width: 20em;
    width: 300px;
    height: auto;
    max-height: 500px;
    overflow: auto;
    padding: 0.5em 0.75em;
    font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
    background: var(--dfnpanel-bg);
    color: var(--dfnpanel-text);
    border: outset 0.2em;
    white-space: normal; /* in case it's moved into a pre */
}
.dfn-panel:not(.on) { display: none; }
.dfn-panel * { margin: 0; padding: 0; text-indent: 0; }
.dfn-panel > b { display: block; }
.dfn-panel a { color: var(--dfnpanel-text); }
.dfn-panel a:not(:hover) { text-decoration: none !important; border-bottom: none !important; }
.dfn-panel a:focus {
    outline: 5px auto Highlight;
    outline: 5px auto -webkit-focus-ring-color;
}
.dfn-panel > b + b { margin-top: 0.25em; }
.dfn-panel ul { padding: 0 0 0 1em; list-style: none; }
.dfn-panel li a {
    max-width: calc(300px - 1.5em - 1em);
    overflow: hidden;
    text-overflow: ellipsis;
}

.dfn-panel.activated {
    display: inline-block;
    position: fixed;
    left: 8px;
    bottom: 2em;
    margin: 0 auto;
    max-width: calc(100vw - 1.5em - .4em - .5em);
    max-height: 30vh;
    transition: left 1s ease-out, bottom 1s ease-out;
}

.dfn-panel .link-item:hover {
    text-decoration: underline;
}
.dfn-panel .link-item .copy-icon {
    opacity: 0;
}
.dfn-panel .link-item:hover .copy-icon,
.dfn-panel .link-item .copy-icon:focus {
    opacity: 1;
}

.dfn-panel .copy-icon {
    display: inline-block;
    margin-right: 0.5em;
    width: 0.85em;
    height: 1em;
    border-radius: 3px;
    background-color: #ccc;
    cursor: pointer;
}

.dfn-panel .copy-icon .icon {
    width: 100%;
    height: 100%;
    background-color: #fff;
    display: flex;
    justify-content: center;
    align-items: center;
    position: relative;
}

.dfn-panel .copy-icon .icon::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    border: 1px solid black;
    background-color: #ccc;
    opacity: 0.25;
    transform: translate(3px, -3px);
}

.dfn-panel .copy-icon:active .icon::before {
    opacity: 1;
}

.dfn-paneled[role="button"] { cursor: help; }

.highlighted {
    animation: target-fade 3s;
}

@keyframes target-fade {
    from {
        background-color: var(--dfnpanel-target-bg);
        outline: 5px solid var(--dfnpanel-target-outline);
    }
    to {
        color: var(--a-normal-text);
        background-color: transparent;
        outline: transparent;
    }
}
</style>
<style>/* Boilerplate: style-idl-highlighting */
pre.idl.highlight {
    background: var(--borderedblock-bg, var(--def-bg));
}
</style>
<style>/* Boilerplate: style-issues */
a[href].issue-return {
    float: right;
    float: inline-end;
    color: var(--issueheading-text);
    font-weight: bold;
    text-decoration: none;
}
</style>
<style>/* Boilerplate: style-md-lists */
/* This is a weird hack for me not yet following the commonmark spec
   regarding paragraph and lists. */
[data-md] > :first-child {
    margin-top: 0;
}
[data-md] > :last-child {
    margin-bottom: 0;
}
</style>
<style>/* Boilerplate: style-mdn-anno */
:root {
	--mdn-bg: #EEE;
	--mdn-shadow: #999;
	--mdn-nosupport-text: #ccc;
	--mdn-pass: green;
	--mdn-fail: red;
}
@media (prefers-color-scheme: dark) {
	:root {
		--mdn-bg: #222;
		--mdn-shadow: #444;
		--mdn-nosupport-text: #666;
		--mdn-pass: #690;
		--mdn-fail: #d22;
	}
}
.mdn-anno {
	background: var(--mdn-bg, #EEE);
	border-radius: .25em;
	box-shadow: 0 0 3px var(--mdn-shadow, #999);
	color: var(--text, black);
	font: 1em sans-serif;
	hyphens: none;
	max-width: min-content;
	overflow: hidden;
	padding: 0.2em;
	position: absolute;
	right: 0.3em;
	top: auto;
	white-space: nowrap;
	word-wrap: normal;
	z-index: 8;
}
.mdn-anno.unpositioned {
	display: none;
}
.mdn-anno.overlapping-main {
	opacity: .2;
	transition: opacity .1s;
}
.mdn-anno[open] {
	opacity: 1;
	z-index: 9;
	min-width: 9em;
}
.mdn-anno:hover {
	opacity: 1;
	outline: var(--text, black) 1px solid;
}
.mdn-anno > summary {
	font-weight: normal;
	text-align: right;
	cursor: pointer;
	display: block;
}
.mdn-anno > summary > .less-than-two-engines-flag {
	color: var(--mdn-fail);
	padding-right: 2px;
}
.mdn-anno > summary > .all-engines-flag {
	color: var(--mdn-pass);
	padding-right: 2px;
}
.mdn-anno > summary > span {
	color: #fff;
	background-color: #000;
	font-weight: normal;
	font-family: zillaslab, Palatino, "Palatino Linotype", serif;
	padding: 2px 3px 0px 3px;
	line-height: 1.3em;
	vertical-align: top;
}
.mdn-anno > .feature {
	margin-top: 20px;
}
.mdn-anno > .feature:not(:first-of-type) {
	border-top: 1px solid #999;
	margin-top: 6px;
	padding-top: 2px;
}
.mdn-anno > .feature > .less-than-two-engines-text {
	color: var(--mdn-fail);
}
.mdn-anno > .feature > .all-engines-text {
	color: var(--mdn-pass);
}
.mdn-anno > .feature > p {
	font-size: .75em;
	margin-top: 6px;
	margin-bottom: 0;
}
.mdn-anno > .feature > p + p {
	margin-top: 3px;
}
.mdn-anno > .feature > .support {
	display: block;
	font-size: 0.6em;
	margin: 0;
	padding: 0;
	margin-top: 2px;
}
.mdn-anno > .feature > .support + div {
	padding-top: 0.5em;
}
.mdn-anno > .feature > .support > hr {
	display: block;
	border: none;
	border-top: 1px dotted #999;
	padding: 3px 0px 0px 0px;
	margin: 2px 3px 0px 3px;
}
.mdn-anno > .feature > .support > hr::before {
	content: "";
}
.mdn-anno > .feature > .support > span {
	padding: 0.2em 0;
	display: block;
	display: table;
}
.mdn-anno > .feature > .support > span.no {
	color: var(--mdn-nosupport-text);
	filter: grayscale(100%);
}
.mdn-anno > .feature > .support > span.no::before {
	opacity: 0.5;
}
.mdn-anno > .feature > .support > span:first-of-type {
	padding-top: 0.5em;
}
.mdn-anno > .feature > .support > span > span {
	padding: 0 0.5em;
	display: table-cell;
}
.mdn-anno > .feature > .support > span > span:first-child {
	width: 100%;
}
.mdn-anno > .feature > .support > span > span:last-child {
	width: 100%;
	white-space: pre;
	padding: 0;
}
.mdn-anno > .feature > .support > span::before {
	content: ' ';
	display: table-cell;
	min-width: 1.5em;
	height: 1.5em;
	background: no-repeat center center;
	background-size: contain;
	text-align: right;
	font-size: 0.75em;
	font-weight: bold;
}
.mdn-anno > .feature > .support > .chrome_android::before {
	background-image: url(https://resources.whatwg.org/browser-logos/chrome.svg);
}
.mdn-anno > .feature > .support > .firefox_android::before {
	background-image: url(https://resources.whatwg.org/browser-logos/firefox.png);
}
.mdn-anno > .feature > .support > .chrome::before {
	background-image: url(https://resources.whatwg.org/browser-logos/chrome.svg);
}
.mdn-anno > .feature > .support > .edge_blink::before {
	background-image: url(https://resources.whatwg.org/browser-logos/edge.svg);
}
.mdn-anno > .feature > .support > .edge::before {
	background-image: url(https://resources.whatwg.org/browser-logos/edge_legacy.svg);
}
.mdn-anno > .feature > .support > .firefox::before {
	background-image: url(https://resources.whatwg.org/browser-logos/firefox.png);
}
.mdn-anno > .feature > .support > .ie::before {
	background-image: url(https://resources.whatwg.org/browser-logos/ie.png);
}
.mdn-anno > .feature > .support > .safari_ios::before {
	background-image: url(https://resources.whatwg.org/browser-logos/safari-ios.svg);
}
.mdn-anno > .feature > .support > .nodejs::before {
	background-image: url(https://nodejs.org/static/images/favicons/favicon.ico);
}
.mdn-anno > .feature > .support > .opera_android::before {
	background-image: url(https://resources.whatwg.org/browser-logos/opera.svg);
}
.mdn-anno > .feature > .support > .opera::before {
	background-image: url(https://resources.whatwg.org/browser-logos/opera.svg);
}
.mdn-anno > .feature > .support > .safari::before {
	background-image: url(https://resources.whatwg.org/browser-logos/safari.png);
}
.mdn-anno > .feature > .support > .samsunginternet_android::before {
	background-image: url(https://resources.whatwg.org/browser-logos/samsung.svg);
}
.mdn-anno > .feature > .support > .webview_android::before {
	background-image: url(https://resources.whatwg.org/browser-logos/android-webview.png);
}
.name-slug-mismatch {
	color: red;
}
.caniuse-status:hover {
	z-index: 9;
}
/* dt, li, .issue, .note, and .example are "position: relative", so to put annotation at right margin, must move to right of containing block */;
.h-entry:not(.status-LS) dt > .mdn-anno, .h-entry:not(.status-LS) li > .mdn-anno, .h-entry:not(.status-LS) .issue > .mdn-anno, .h-entry:not(.status-LS) .note > .mdn-anno, .h-entry:not(.status-LS) .example > .mdn-anno {
	right: -6.7em;
}
.h-entry p + .mdn-anno {
	margin-top: 0;
}
 h2 + .mdn-anno.after {
	margin: -48px 0 0 0;
}
 h3 + .mdn-anno.after {
	margin: -46px 0 0 0;
}
 h4 + .mdn-anno.after {
	margin: -42px 0 0 0;
}
 h5 + .mdn-anno.after {
	margin: -40px 0 0 0;
}
 h6 + .mdn-anno.after {
	margin: -40px 0 0 0;
}
</style>
<style>/* Boilerplate: style-ref-hints */
:root {
    --ref-hint-bg: #ddd;
    --ref-hint-text: var(--text);
}
@media (prefers-color-scheme: dark) {
    :root {
        --ref-hint-bg: #222;
        --ref-hint-text: var(--text);
    }
}

.ref-hint {
    display: inline-block;
    position: absolute;
    z-index: 35;
    width: 20em;
    width: 300px;
    height: auto;
    max-height: 500px;
    overflow: auto;
    padding: 0.5em 0.5em;
    font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
    background: var(--ref-hint-bg);
    color: var(--ref-hint-text);
    border: outset 0.2em;
    white-space: normal; /* in case it's moved into a pre */
}

.ref-hint * { margin: 0; padding: 0; text-indent: 0; }

.ref-hint ul { padding: 0 0 0 1em; list-style: none; }
</style>
<style>/* Boilerplate: style-selflinks */
:root {
    --selflink-text: white;
    --selflink-bg: gray;
    --selflink-hover-text: black;
}
.heading, .issue, .note, .example, li, dt {
    position: relative;
}
a.self-link {
    position: absolute;
    top: 0;
    left: calc(-1 * (3.5rem - 26px));
    width: calc(3.5rem - 26px);
    height: 2em;
    text-align: center;
    border: none;
    transition: opacity .2s;
    opacity: .5;
}
a.self-link:hover {
    opacity: 1;
}
.heading > a.self-link {
    font-size: 83%;
}
.example > a.self-link,
.note > a.self-link,
.issue > a.self-link {
    /* These blocks are overflow:auto, so positioning outside
       doesn't work. */
    left: auto;
    right: 0;
}
li > a.self-link {
    left: calc(-1 * (3.5rem - 26px) - 2em);
}
dfn > a.self-link {
    top: auto;
    left: auto;
    opacity: 0;
    width: 1.5em;
    height: 1.5em;
    background: var(--selflink-bg);
    color: var(--selflink-text);
    font-style: normal;
    transition: opacity .2s, background-color .2s, color .2s;
}
dfn:hover > a.self-link {
    opacity: 1;
}
dfn > a.self-link:hover {
    color: var(--selflink-hover-text);
}

a.self-link::before            { content: "¶"; }
.heading > a.self-link::before { content: "§"; }
dfn > a.self-link::before      { content: "#"; }
</style>
<style>/* Boilerplate: style-syntax-highlighting */
code.highlight { padding: .1em; border-radius: .3em; }
pre.highlight, pre > code.highlight { display: block; padding: 1em; margin: .5em 0; overflow: auto; border-radius: 0; }

.highlight:not(.idl) { background: rgba(0, 0, 0, .03); }
c-[a] { color: #990055 } /* Keyword.Declaration */
c-[b] { color: #990055 } /* Keyword.Type */
c-[c] { color: #708090 } /* Comment */
c-[d] { color: #708090 } /* Comment.Multiline */
c-[e] { color: #0077aa } /* Name.Attribute */
c-[f] { color: #669900 } /* Name.Tag */
c-[g] { color: #222222 } /* Name.Variable */
c-[k] { color: #990055 } /* Keyword */
c-[l] { color: #000000 } /* Literal */
c-[m] { color: #000000 } /* Literal.Number */
c-[n] { color: #0077aa } /* Name */
c-[o] { color: #999999 } /* Operator */
c-[p] { color: #999999 } /* Punctuation */
c-[s] { color: #a67f59 } /* Literal.String */
c-[t] { color: #a67f59 } /* Literal.String.Single */
c-[u] { color: #a67f59 } /* Literal.String.Double */
c-[cp] { color: #708090 } /* Comment.Preproc */
c-[c1] { color: #708090 } /* Comment.Single */
c-[cs] { color: #708090 } /* Comment.Special */
c-[kc] { color: #990055 } /* Keyword.Constant */
c-[kn] { color: #990055 } /* Keyword.Namespace */
c-[kp] { color: #990055 } /* Keyword.Pseudo */
c-[kr] { color: #990055 } /* Keyword.Reserved */
c-[ld] { color: #000000 } /* Literal.Date */
c-[nc] { color: #0077aa } /* Name.Class */
c-[no] { color: #0077aa } /* Name.Constant */
c-[nd] { color: #0077aa } /* Name.Decorator */
c-[ni] { color: #0077aa } /* Name.Entity */
c-[ne] { color: #0077aa } /* Name.Exception */
c-[nf] { color: #0077aa } /* Name.Function */
c-[nl] { color: #0077aa } /* Name.Label */
c-[nn] { color: #0077aa } /* Name.Namespace */
c-[py] { color: #0077aa } /* Name.Property */
c-[ow] { color: #999999 } /* Operator.Word */
c-[mb] { color: #000000 } /* Literal.Number.Bin */
c-[mf] { color: #000000 } /* Literal.Number.Float */
c-[mh] { color: #000000 } /* Literal.Number.Hex */
c-[mi] { color: #000000 } /* Literal.Number.Integer */
c-[mo] { color: #000000 } /* Literal.Number.Oct */
c-[sb] { color: #a67f59 } /* Literal.String.Backtick */
c-[sc] { color: #a67f59 } /* Literal.String.Char */
c-[sd] { color: #a67f59 } /* Literal.String.Doc */
c-[se] { color: #a67f59 } /* Literal.String.Escape */
c-[sh] { color: #a67f59 } /* Literal.String.Heredoc */
c-[si] { color: #a67f59 } /* Literal.String.Interpol */
c-[sx] { color: #a67f59 } /* Literal.String.Other */
c-[sr] { color: #a67f59 } /* Literal.String.Regex */
c-[ss] { color: #a67f59 } /* Literal.String.Symbol */
c-[vc] { color: #0077aa } /* Name.Variable.Class */
c-[vg] { color: #0077aa } /* Name.Variable.Global */
c-[vi] { color: #0077aa } /* Name.Variable.Instance */
c-[il] { color: #000000 } /* Literal.Number.Integer.Long */

@media (prefers-color-scheme: dark) {
    .highlight:not(.idl) { background: rgba(255, 255, 255, .05); }

    c-[a] { color: #d33682 } /* Keyword.Declaration */
    c-[b] { color: #d33682 } /* Keyword.Type */
    c-[c] { color: #2aa198 } /* Comment */
    c-[d] { color: #2aa198 } /* Comment.Multiline */
    c-[e] { color: #268bd2 } /* Name.Attribute */
    c-[f] { color: #b58900 } /* Name.Tag */
    c-[g] { color: #cb4b16 } /* Name.Variable */
    c-[k] { color: #d33682 } /* Keyword */
    c-[l] { color: #657b83 } /* Literal */
    c-[m] { color: #657b83 } /* Literal.Number */
    c-[n] { color: #268bd2 } /* Name */
    c-[o] { color: #657b83 } /* Operator */
    c-[p] { color: #657b83 } /* Punctuation */
    c-[s] { color: #6c71c4 } /* Literal.String */
    c-[t] { color: #6c71c4 } /* Literal.String.Single */
    c-[u] { color: #6c71c4 } /* Literal.String.Double */
    c-[ch] { color: #2aa198 } /* Comment.Hashbang */
    c-[cp] { color: #2aa198 } /* Comment.Preproc */
    c-[cpf] { color: #2aa198 } /* Comment.PreprocFile */
    c-[c1] { color: #2aa198 } /* Comment.Single */
    c-[cs] { color: #2aa198 } /* Comment.Special */
    c-[kc] { color: #d33682 } /* Keyword.Constant */
    c-[kn] { color: #d33682 } /* Keyword.Namespace */
    c-[kp] { color: #d33682 } /* Keyword.Pseudo */
    c-[kr] { color: #d33682 } /* Keyword.Reserved */
    c-[ld] { color: #657b83 } /* Literal.Date */
    c-[nc] { color: #268bd2 } /* Name.Class */
    c-[no] { color: #268bd2 } /* Name.Constant */
    c-[nd] { color: #268bd2 } /* Name.Decorator */
    c-[ni] { color: #268bd2 } /* Name.Entity */
    c-[ne] { color: #268bd2 } /* Name.Exception */
    c-[nf] { color: #268bd2 } /* Name.Function */
    c-[nl] { color: #268bd2 } /* Name.Label */
    c-[nn] { color: #268bd2 } /* Name.Namespace */
    c-[py] { color: #268bd2 } /* Name.Property */
    c-[ow] { color: #657b83 } /* Operator.Word */
    c-[mb] { color: #657b83 } /* Literal.Number.Bin */
    c-[mf] { color: #657b83 } /* Literal.Number.Float */
    c-[mh] { color: #657b83 } /* Literal.Number.Hex */
    c-[mi] { color: #657b83 } /* Literal.Number.Integer */
    c-[mo] { color: #657b83 } /* Literal.Number.Oct */
    c-[sa] { color: #6c71c4 } /* Literal.String.Affix */
    c-[sb] { color: #6c71c4 } /* Literal.String.Backtick */
    c-[sc] { color: #6c71c4 } /* Literal.String.Char */
    c-[dl] { color: #6c71c4 } /* Literal.String.Delimiter */
    c-[sd] { color: #6c71c4 } /* Literal.String.Doc */
    c-[se] { color: #6c71c4 } /* Literal.String.Escape */
    c-[sh] { color: #6c71c4 } /* Literal.String.Heredoc */
    c-[si] { color: #6c71c4 } /* Literal.String.Interpol */
    c-[sx] { color: #6c71c4 } /* Literal.String.Other */
    c-[sr] { color: #6c71c4 } /* Literal.String.Regex */
    c-[ss] { color: #6c71c4 } /* Literal.String.Symbol */
    c-[fm] { color: #268bd2 } /* Name.Function.Magic */
    c-[vc] { color: #cb4b16 } /* Name.Variable.Class */
    c-[vg] { color: #cb4b16 } /* Name.Variable.Global */
    c-[vi] { color: #cb4b16 } /* Name.Variable.Instance */
    c-[vm] { color: #cb4b16 } /* Name.Variable.Magic */
    c-[il] { color: #657b83 } /* Literal.Number.Integer.Long */
}
</style>
<style>/* Boilerplate: style-var-click-highlighting */
/*
Colors were chosen in Lab using https://nixsensor.com/free-color-converter/
D50 2deg illuminant, L in [0,100], a and b in [-128, 128]
0 = lab(85,0,85)
1 = lab(85,80,30)
2 = lab(85,-40,40)
3 = lab(85,-50,0)
4 = lab(85,5,15)
5 = lab(85,-10,-50)
6 = lab(85,35,-15)

For darkmode:
0 = oklab(50%   0%  108%)
1 = oklab(50% -51%   51%)
2 = oklab(50% -64%  -20%)
3 = oklab(50%   6%   19%)
4 = oklab(50% -12%  -64%)
5 = oklab(50%  44%  -19%)  
6 = oklab(50% 102%   38%)
*/

[data-algorithm] var { cursor: pointer; }
var[data-var-color] { background-color: var(--var-bg); box-shadow: 0 0 0 2px var(--var-bg); }

var[data-var-color] { --var-bg: #F4D200; }
var[data-var-color="1"] { --var-bg: #FF87A2; }
var[data-var-color="2"] { --var-bg: #96E885; }
var[data-var-color="3"] { --var-bg: #3EEED2; }
var[data-var-color="4"] { --var-bg: #EACFB6; }
var[data-var-color="5"] { --var-bg: #82DDFF; }
var[data-var-color="6"] { --var-vg: #FFBCF2; }

@media (prefers-color-scheme: dark) {
	var[data-var-color] { --var-bg: #bc1a00; }
	var[data-var-color="1"] { --var-bg: #007f00; }
	var[data-var-color="2"] { --var-bg: #008698; }
	var[data-var-color="3"] { --var-bg: #7f5b2b; }
	var[data-var-color="4"] { --var-bg: #004df3; }
	var[data-var-color="5"] { --var-bg: #a1248a; }
	var[data-var-color="6"] { --var-vg: #ff0000; }
}
</style>
<style>/* Boilerplate: style-wpt */
:root {
    --wpt-border: hsl(0, 0%, 60%);
    --wpt-bg: hsl(0, 0%, 95%);
    --wpt-text: var(--text);
    --wptheading-text: hsl(0, 0%, 30%);
}
@media (prefers-color-scheme: dark) {
    :root {
        --wpt-border: hsl(0, 0%, 30%);
        --wpt-bg: var(--borderedblock-bg);
        --wpt-text: var(--text);
        --wptheading-text: hsl(0, 0%, 60%);
    }
}
.wpt-tests-block {
    list-style: none;
    border-left: .5em solid var(--wpt-border);
    background: var(--wpt-bg);
    color: var(--wpt-text);
    margin: 1em auto;
    padding: .5em;
}
.wpt-tests-block summary {
    color: var(--wptheading-text);
    font-weight: normal;
    text-transform: uppercase;
}
.wpt-tests-block summary::marker{
    color: var(--wpt-border);
}
.wpt-tests-block summary:hover::marker{
    color: var(--wpt-text);
}
/*
   The only content  of a wpt test block in its closed state is the <summary>,
   which contains the word TESTS,
   and that is absolutely positioned.
   In that closed state, wpt test blocks are styled
   to have a top margin whose height is exactly equal
   to the height of the absolutely positioned <summary>,
   and no other background/padding/margin/border.
   The wpt test block elements will therefore allow the maring
   of the previous/next block elements
   to collapse through them;
   if this combined margin would be larger than its own top margin,
   it stays as is,
   and therefore the pre-existing vertical rhythm of the document is undisturbed.
   If that combined margin would be smaller, it is grown to that size.
   This means that the wpt test block ensures
   that there's always enough vertical space to insert the summary,
   without adding more than is needed.
*/
.wpt-tests-block:not([open]){
    padding: 0;
    border: none;
    background: none;
    font-size: 0.75em;
    line-height: 1;
    position: relative;
    margin: 1em 0 0;
}
.wpt-tests-block:not([open]) summary {
    position: absolute;
    right: 0;
    bottom: 0;
}
/*
   It is possible that both the last child of a block element
   and the block element itself
   would be annotated with a <wpt> block each.
   If the block element has a padding or a border,
   that's fine, but otherwise
   the bottom margin of the block and of its last child would collapse
   and both <wpt> elements would overlap, being both placed there.
   To avoid that, add 1px of padding to the <wpt> element annotating the last child
   to prevent the bottom margin of the block and of its last child from collapsing
   (and as much negative margin,
   as wel only want to prevent margin collapsing,
   but are not trying to actually take more space).
*/
.wpt-tests-block:not([open]):last-child {
    padding-bottom: 1px;
    margin-bottom: -1px;
}
/*
   Exception to the previous rule:
   don't do that in non-last list items,
   because it's not necessary,
   and would therefore consume more space than strictly needed.
   Lists must have list items as children, not <wpt> elements,
   so a <wpt> element cannot be a sibling of a list item,
   and the collision that the previous rule avoids cannot happen.
*/
li:not(:last-child) > .wpt-tests-block:not([open]):last-child,
dd:not(:last-child) > .wpt-tests-block:not([open]):last-child {
    padding-bottom: 0;
    margin-bottom: 0;
}
.wpt-tests-block:not([open]):not(:hover){
    opacity: 0.5;
}
.wpt-tests-list {
    list-style: none;
    display: grid;
    margin: 0;
    padding: 0;
    grid-template-columns: 1fr max-content auto auto;
    grid-column-gap: .5em;
}
.wpt-tests-block hr:last-child {
    display: none;
}
.wpt-test {
    display: contents;
}
.wpt-test > a {
    text-decoration: underline;
    border: none;
}
.wpt-test > .wpt-name { grid-column: 1; }
.wpt-test > .wpt-results { grid-column: 2; }
.wpt-test > .wpt-live { grid-column: 3; }
.wpt-test > .wpt-source { grid-column: 4; }

.wpt-test > .wpt-results {
    display: flex;
    gap: .1em;
}
.wpt-test .wpt-result {
    display: inline-block;
    height: 1em;
    width: 1em;
    border-radius: 50%;
    position: relative;
}
</style>
 <body class="h-entry">
  <div class="head">
   <p data-fill-with="logo"><a class="logo" href="https://www.w3.org/"> <img alt="W3C" height="48" src="https://www.w3.org/StyleSheets/TR/2021/logos/W3C" width="72"> </a> </p>
   <h1 class="p-name no-ref" id="title">Portals</h1>
   <p id="w3c-state"><a href="https://www.w3.org/standards/types#CG-DRAFT">Draft Community Group Report</a>, <time class="dt-updated" datetime="1970-01-01">1 January 1970</time></p>
   <div data-fill-with="spec-metadata">
    <dl>
     <dt>This version:
     <dd><a class="u-url" href="https://wicg.github.io/portals/">https://wicg.github.io/portals/</a>
     <dt class="editor">Editors:
     <dd class="editor p-author h-card vcard"><a class="p-name fn u-email email" href="mailto:jbroman@chromium.org">Jeremy Roman</a> (<span class="p-org org">Google</span>)
     <dd class="editor p-author h-card vcard"><a class="p-name fn u-email email" href="mailto:lfg@chromium.org">Lucas Gadani</a> (<span class="p-org org">Google</span>)
     <dt>Test Suite:
     <dd class="wpt-overview"><a href="https://wpt.fyi/results/portals/">https://wpt.fyi/results/portals/</a>
    </dl>
   </div>
   <div data-fill-with="warning"></div>
   <p class="copyright" data-fill-with="copyright"><a href="http://www.w3.org/Consortium/Legal/ipr-notice#Copyright">Copyright</a> © 1970 the Contributors to the Portals Specification, published by the <a href="https://www.w3.org/community/wicg/">Web Platform Incubator Community Group</a> under the <a href="https://www.w3.org/community/about/agreements/cla/">W3C Community Contributor License Agreement (CLA)</a>.
A human-readable <a href="http://www.w3.org/community/about/agreements/cla-deed/">summary</a> is available. </p>
   <hr title="Separator for header">
  </div>
  <div class="p-summary" data-fill-with="abstract">
   <h2 class="no-num no-toc no-ref heading settled" id="abstract"><span class="content">Abstract</span></h2>
   <p>This specification defines a mechanism that allows for rendering of, and seamless navigation to, embedded content.</p>
  </div>
  <div data-fill-with="at-risk"></div>
  <h2 class="no-num no-toc no-ref heading settled" id="status"><span class="content">Status of this document</span></h2>
  <div data-fill-with="status">
   <p> This specification was published by the <a href="https://www.w3.org/community/wicg/">Web Platform Incubator Community Group</a>.
  It is not a W3C Standard nor is it on the W3C Standards Track.

  Please note that under the <a href="https://www.w3.org/community/about/agreements/cla/">W3C Community Contributor License Agreement (CLA)</a> there is a limited opt-out and other conditions apply.

  Learn more about <a href="http://www.w3.org/community/">W3C Community and Business Groups</a>. </p>
   <p></p>
  </div>
  <div data-fill-with="at-risk"></div>
  <nav data-fill-with="table-of-contents" id="toc">
   <h2 class="no-num no-toc no-ref" id="contents">Table of Contents</h2>
   <ol class="toc" role="directory">
    <li><a href="#intro"><span class="secno">1</span> <span class="content">Introduction</span></a>
    <li><a href="#concepts"><span class="secno">2</span> <span class="content">Portal browsing contexts</span></a>
    <li>
     <a href="#the-portal-element"><span class="secno">3</span> <span class="content">The <code>portal</code> element</span></a>
     <ol class="toc">
      <li><a href="#the-portalhost-interface"><span class="secno">3.1</span> <span class="content">Portal hosts</span></a>
      <li><a href="#the-portalactivateevent-interface"><span class="secno">3.2</span> <span class="content">The <code>PortalActivateEvent</code> interface</span></a>
     </ol>
    <li>
     <a href="#miscellaneous-extensions"><span class="secno">4</span> <span class="content">Miscellaneous HTML updates</span></a>
     <ol class="toc">
      <li><a href="#patch-messageevent"><span class="secno">4.1</span> <span class="content">The <code class="idl"><span>MessageEvent</span></code> interface</span></a>
      <li><a href="#patch-event-handlers"><span class="secno">4.2</span> <span class="content">Event handlers</span></a>
      <li><a href="#patch-window-apis"><span class="secno">4.3</span> <span class="content">APIs for creating and navigating browsing contexts by name</span></a>
      <li><a href="#patch-navigation"><span class="secno">4.4</span> <span class="content">Navigation</span></a>
      <li><a href="#patch-downloading"><span class="secno">4.5</span> <span class="content">Downloading resources</span></a>
     </ol>
    <li>
     <a href="#other-spec-updates"><span class="secno">5</span> <span class="content">Updates to other specifications</span></a>
     <ol class="toc">
      <li>
       <a href="#csp"><span class="secno">5.1</span> <span class="content">Content Security Policy</span></a>
       <ol class="toc">
        <li>
         <a href="#portal-src-directive"><span class="secno">5.1.1</span> <span class="content"><code>portal-src</code></span></a>
         <ol class="toc">
          <li><a href="#portal-src-pre-request"><span class="secno">5.1.1.1</span> <span class="content"><code>portal-src</code> Pre-request check</span></a>
          <li><a href="#portal-src-post-request"><span class="secno">5.1.1.2</span> <span class="content"><code>portal-src</code> Post-request check</span></a>
         </ol>
        <li><a href="#default-src-patch"><span class="secno">5.1.2</span> <span class="content"><code>default-src</code></span></a>
        <li><a href="#directive-fallback-list-patch"><span class="secno">5.1.3</span> <span class="content">Get fetch directive fallback list</span></a>
       </ol>
      <li><a href="#fetch-metadata"><span class="secno">5.2</span> <span class="content">Fetch Metadata Request Headers</span></a>
     </ol>
    <li>
     <a href="#security-considerations"><span class="secno">6</span> <span class="content">Security Considerations</span></a>
     <ol class="toc">
      <li><a href="#security-overview"><span class="secno">6.1</span> <span class="content">Overview</span></a>
     </ol>
    <li><a href="#untriaged-tests"><span class="secno">7</span> <span class="content">Untriaged tests</span></a>
    <li>
     <a href="#w3c-conformance"><span class="secno"></span> <span class="content">Conformance</span></a>
     <ol class="toc">
      <li><a href="#w3c-conventions"><span class="secno"></span> <span class="content">Document conventions</span></a>
      <li><a href="#w3c-conformant-algorithms"><span class="secno"></span> <span class="content">Conformant Algorithms</span></a>
     </ol>
    <li>
     <a href="#index"><span class="secno"></span> <span class="content">Index</span></a>
     <ol class="toc">
      <li><a href="#index-defined-here"><span class="secno"></span> <span class="content">Terms defined by this specification</span></a>
      <li><a href="#index-defined-elsewhere"><span class="secno"></span> <span class="content">Terms defined by reference</span></a>
     </ol>
    <li>
     <a href="#references"><span class="secno"></span> <span class="content">References</span></a>
     <ol class="toc">
      <li><a href="#normative"><span class="secno"></span> <span class="content">Normative References</span></a>
      <li><a href="#informative"><span class="secno"></span> <span class="content">Informative References</span></a>
     </ol>
    <li><a href="#idl-index"><span class="secno"></span> <span class="content">IDL Index</span></a>
    <li><a href="#issues-index"><span class="secno"></span> <span class="content">Issues Index</span></a>
   </ol>
  </nav>
  <main>
   <details class="annoying-warning">
    <summary>This spec is behind the explainer</summary>
    <p>This specification document has not yet been updated to reflect the 2020-04 updates to <a href="https://github.com/WICG/portals#readme">the explainer</a>. We’ll fix that as soon as we
  can, but please be aware that there are probably contradictions, and the explainer should be taken
  as more authoritative for the time being.</p>
   </details>
   <section class="non-normative">
    <h2 class="heading settled" data-level="1" id="intro"><span class="secno">1. </span><span class="content">Introduction</span><a class="self-link" href="#intro"></a></h2>
    <p><em>This section is non-normative.</em></p>
    <p>This specification extends <a data-link-type="biblio" href="#biblio-html" title="HTML Standard">[HTML]</a> to define a new kind of <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#top-level-browsing-context" id="ref-for-top-level-browsing-context">top-level browsing context</a>,
  which can be embedded in another document, and a mechanism for replacing the contents of another
  top-level browsing context with the previously embedded context.</p>
    <p>It is structured as a series of patches to HTML and other specifications, with each major section
  indicating where each it would be placed in the event of eventual graduation from incubation.</p>
    <p>See also the <a href="https://github.com/WICG/portals">explainer</a> for more background and
  motivation.</p>
   </section>
   <section>
    <h2 class="heading settled" data-level="2" id="concepts"><span class="secno">2. </span><span class="content">Portal browsing contexts</span><a class="self-link" href="#concepts"></a></h2>
    <p><em>The following section would be added as a new sub-section of <a data-link-type="biblio" href="#biblio-html" title="HTML Standard">[HTML]</a>'s <a href="https://html.spec.whatwg.org/#windows">Browsing contexts</a> section.</em></p>
    <p>Every <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#browsing-context" id="ref-for-browsing-context">browsing context</a> has a <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="portal-state">portal state</dfn>, which may be "<code>none</code>" (the default), "<code>portal</code>" or "<code>orphaned</code>".
  A <a data-link-type="dfn">nested browsing context</a> always has the <a data-link-type="dfn" href="#portal-state" id="ref-for-portal-state">portal state</a> "<code>none</code>".</p>
    <div class="note" role="note">
      Briefly, these correspond to: 
     <ul>
      <li data-md>
       <p>"<code>portal</code>": top-level browsing contexts embedded in a <code><a data-link-type="element" href="#elementdef-portal" id="ref-for-elementdef-portal">portal</a></code> element</p>
      <li data-md>
       <p>"<code>orphaned</code>": top-level browsing contexts which have run <code class="idl"><a data-link-type="idl" href="#dom-htmlportalelement-activate" id="ref-for-dom-htmlportalelement-activate">activate</a></code> but have not (yet) been <a data-link-type="dfn" href="#adopt-the-predecessor-browsing-context" id="ref-for-adopt-the-predecessor-browsing-context">adopted</a></p>
      <li data-md>
       <p>"<code>none</code>": all other browsing contexts</p>
     </ul>
     <p><img alt="Diagram of portal state transitions" src="portals-state-transitions.svg" style="width: 100%"></p>
     <p>A top-level "<code>none</code>" context can become "<code>orphaned</code>" by <a data-link-type="dfn" href="#activate-a-portal-browsing-context" id="ref-for-activate-a-portal-browsing-context">activating</a> another context. An "<code>orphaned</code>" context can be <a data-link-type="dfn" href="#adopt-the-predecessor-browsing-context" id="ref-for-adopt-the-predecessor-browsing-context①">adopted</a> to
    become a "<code>portal</code>" context. A "<code>portal</code>" context can become a "<code>none</code>" context by being <a data-link-type="dfn" href="#activate-a-portal-browsing-context" id="ref-for-activate-a-portal-browsing-context①">activated</a> by its <a data-link-type="dfn" href="#host-browsing-context" id="ref-for-host-browsing-context">host browsing context</a>.</p>
     <p>A browsing context can be <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/window-object.html#close-a-browsing-context" id="ref-for-close-a-browsing-context">closed</a> while in any of these states.</p>
    </div>
    <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="portal-browsing-context">portal browsing context</dfn> is a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#browsing-context" id="ref-for-browsing-context①">browsing context</a> whose <a data-link-type="dfn" href="#portal-state" id="ref-for-portal-state①">portal state</a> is "<code>portal</code>".</p>
    <p>The <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="host-element">host element</dfn> of a <a data-link-type="dfn" href="#portal-browsing-context" id="ref-for-portal-browsing-context">portal browsing context</a> is a <code><a data-link-type="element" href="#elementdef-portal" id="ref-for-elementdef-portal①">portal</a></code> element which embeds its rendered output and receives messages sent from the
  portal browsing context.</p>
    <div class="note" role="note"> A <code><a data-link-type="element" href="#elementdef-portal" id="ref-for-elementdef-portal②">portal</a></code> element may only be a <a data-link-type="dfn" href="#host-element" id="ref-for-host-element">host element</a> while it is <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#browsing-context-connected" id="ref-for-browsing-context-connected">browsing-context connected</a> or during the dispatch of the <code class="idl"><a class="idl-code" data-link-type="event" href="#eventdef-window-portalactivate" id="ref-for-eventdef-window-portalactivate">portalactivate</a></code> event from which it was obtained
    using <code class="idl"><a data-link-type="idl" href="#dom-portalactivateevent-adoptpredecessor" id="ref-for-dom-portalactivateevent-adoptpredecessor">adoptPredecessor()</a></code>. </div>
    <p>The <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="host-browsing-context">host browsing context</dfn> of a <a data-link-type="dfn" href="#portal-browsing-context" id="ref-for-portal-browsing-context①">portal browsing context</a> is its <a data-link-type="dfn" href="#host-element" id="ref-for-host-element①">host element</a>'s <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-node-document" id="ref-for-concept-node-document">node document</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#browsing-context" id="ref-for-browsing-context②">browsing context</a>.</p>
    <p>The <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="portal-task-source">portal task source</dfn> is a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#task-source" id="ref-for-task-source">task source</a> used for tasks related to the
  portal lifecycle and communication between a <a data-link-type="dfn" href="#portal-browsing-context" id="ref-for-portal-browsing-context②">portal browsing context</a> and its <a data-link-type="dfn" href="#host-browsing-context" id="ref-for-host-browsing-context①">host browsing context</a>.</p>
    <section class="algorithm" data-algorithm="portal-browsing-context-activate">
      To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="activate-a-portal-browsing-context">activate a portal browsing context</dfn> <var>successorBrowsingContext</var> in
    place of <var>predecessorBrowsingContext</var> with <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin" id="ref-for-concept-origin">origin</a> <var>sourceOrigin</var>, optional data <var>serializeWithTransferResult</var>, and optional promise <var>promise</var>, run the following steps <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel" id="ref-for-in-parallel">in parallel</a>: 
     <ol>
      <li data-md>
       <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#assert" id="ref-for-assert">Assert</a>: The <a data-link-type="dfn" href="#portal-state" id="ref-for-portal-state②">portal state</a> of <var>predecessorBrowsingContext</var> is "<code>none</code>".</p>
      <li data-md>
       <p>If <var>successorBrowsingContext</var>’s only entry in its <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/history.html#session-history" id="ref-for-session-history">session history</a> is the initial <code>about:blank</code> <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#document" id="ref-for-document">Document</a></code>, then wait until either this is no longer true, or <var>successorBrowsingContext</var>’s <a data-link-type="dfn" href="#host-element" id="ref-for-host-element②">host element</a> becomes null.</p>
       <p class="note" role="note">This means that the initial load is still happening in <var>successorBrowsingContext</var>. We wait for it to complete, either successfully or
unsuccessfully, before continuing.</p>
      <li data-md>
       <p>If <var>successorBrowsingContext</var>’s <a data-link-type="dfn" href="#host-element" id="ref-for-host-element③">host element</a> is null, then:</p>
       <ol>
        <li data-md>
         <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task" id="ref-for-queue-a-global-task">Queue a global task</a> on the <a data-link-type="dfn" href="#portal-task-source" id="ref-for-portal-task-source">portal task source</a> given <var>predecessorBrowsingContext</var>’s <a data-link-type="dfn">active window</a> to <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#reject" id="ref-for-reject">reject</a> <var>promise</var> with an "<code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#invalidstateerror" id="ref-for-invalidstateerror">InvalidStateError</a></code>" <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException">DOMException</a></code>.</p>
        <li data-md>
         <p>Return.</p>
       </ol>
      <li data-md>
       <p>Set the <a data-link-type="dfn" href="#host-element" id="ref-for-host-element④">host element</a> of <var>successorBrowsingContext</var> to null.</p>
       <p>User agents <em>should</em>, however, attempt to preserve the rendering of the
guest browsing context until <var>predecessorBrowsingContext</var> has been replaced
with <var>successorBrowsingContext</var> in the rendering.</p>
       <p class="note" role="note"><span class="marker">Note:</span> This is intended to avoid a visual glitch, such as a "white flash", where
the guest browsing context briefly disappears.</p>
      <li data-md>
       <p>Set the <a data-link-type="dfn" href="#portal-state" id="ref-for-portal-state③">portal state</a> of <var>predecessorBrowsingContext</var> to "<code>orphaned</code>".</p>
      <li data-md>
       <p>Update the user interface to replace <var>predecessorBrowsingContext</var> with <var>successorBrowsingContext</var> (e.g., by updating the tab/window contents and browser chrome).</p>
      <li data-md>
       <p>Let <var>successorWindow</var> be <var>successorBrowsingContext</var>’s associated <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#windowproxy" id="ref-for-windowproxy">WindowProxy</a></code>'s [[Window]] internal slot value.</p>
      <li data-md>
       <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task" id="ref-for-queue-a-global-task①">Queue a global task</a> on the <a data-link-type="dfn" href="#portal-task-source" id="ref-for-portal-task-source①">portal task source</a> given <var>successorWindow</var> to run the
following steps:</p>
       <ol>
        <li data-md>
         <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#assert" id="ref-for-assert①">Assert</a>: The <a data-link-type="dfn" href="#portal-state" id="ref-for-portal-state④">portal state</a> of <var>successorBrowsingContext</var> is "<code>portal</code>".</p>
        <li data-md>
         <p>Set the <a data-link-type="dfn" href="#portal-state" id="ref-for-portal-state⑤">portal state</a> of <var>successorBrowsingContext</var> to "<code>none</code>".</p>
        <li data-md>
         <p>Let <var>targetRealm</var> be <var>successorWindow</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-global-object-realm" id="ref-for-concept-global-object-realm">realm</a>.</p>
        <li data-md>
         <p>Let <var>dataClone</var> be null.</p>
        <li data-md>
         <p>If <var>serializeWithTransferResult</var> is given and <var>successorBrowsingContext</var>’s <a data-link-type="dfn">active document</a>'s <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-document-origin" id="ref-for-concept-document-origin">origin</a> is <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#same-origin" id="ref-for-same-origin">same origin</a> with <var>sourceOrigin</var>, then:</p>
         <ol>
          <li data-md>
           <p>Let <var>deserializeRecord</var> be <a data-link-type="abstract-op" href="https://html.spec.whatwg.org/multipage/structured-data.html#structureddeserializewithtransfer" id="ref-for-structureddeserializewithtransfer">StructuredDeserializeWithTransfer</a>(<var>serializeWithTransferResult</var>, <var>targetRealm</var>),
and set <var>dataClone</var> to <var>deserializeRecord</var>.[[Deserialized]].</p>
           <p>If this throws an exception, catch it and do nothing.</p>
         </ol>
        <li data-md>
         <p>Let <var>event</var> be the result of <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-event-create" id="ref-for-concept-event-create">creating an event</a> using <code class="idl"><a data-link-type="idl" href="#portalactivateevent" id="ref-for-portalactivateevent">PortalActivateEvent</a></code> and <var>targetRealm</var>.</p>
        <li data-md>
         <p>Initialize <var>event</var>’s <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#dom-event-type" id="ref-for-dom-event-type">type</a></code> attribute to <code class="idl"><a class="idl-code" data-link-type="event" href="#eventdef-window-portalactivate" id="ref-for-eventdef-window-portalactivate①">portalactivate</a></code>.</p>
        <li data-md>
         <p>Initialize <var>event</var>’s <code class="idl"><a data-link-type="idl" href="#dom-portalactivateevent-data" id="ref-for-dom-portalactivateevent-data">data</a></code> attribute to <var>dataClone</var>.</p>
        <li data-md>
         <p>Set <var>event</var>’s <a data-link-type="dfn" href="#portalactivateevent-predecessor-browsing-context" id="ref-for-portalactivateevent-predecessor-browsing-context">predecessor browsing context</a> to <var>predecessorBrowsingContext</var>.</p>
        <li data-md>
         <p>Set <var>event</var>’s <a data-link-type="dfn" href="#portalactivateevent-successor-window" id="ref-for-portalactivateevent-successor-window">successor window</a> to <var>successorWindow</var>.</p>
        <li data-md>
         <p>Set <var>event</var>’s <a data-link-type="dfn" href="#portalactivateevent-activation-promise" id="ref-for-portalactivateevent-activation-promise">activation promise</a> to <var>promise</var>, if it is given, and null otherwise.</p>
        <li data-md>
         <p><a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-event-dispatch" id="ref-for-concept-event-dispatch">Dispatch</a> <var>event</var> to <var>successorWindow</var>.</p>
        <li data-md>
         <p>Let <var>adoptedPredecessorElement</var> be <var>event</var>’s <a data-link-type="dfn" href="#portalactivateevent-adopted-predecessor-element" id="ref-for-portalactivateevent-adopted-predecessor-element">adopted predecessor element</a>.</p>
        <li data-md>
         <p>If <var>adoptedPredecessorElement</var> is not null, then:</p>
         <ol>
          <li data-md>
           <p>Set <var>adoptedPredecessorElement</var>’s <a data-link-type="dfn" href="#htmlportalelement-just-adopted-flag" id="ref-for-htmlportalelement-just-adopted-flag">just-adopted flag</a> to false.</p>
          <li data-md>
           <p>If <var>adoptedPredecessorElement</var> <a data-link-type="dfn" href="#may-have-a-guest-browsing-context" id="ref-for-may-have-a-guest-browsing-context">may not have a guest browsing context</a> and
its <a data-link-type="dfn" href="#htmlportalelement-guest-browsing-context" id="ref-for-htmlportalelement-guest-browsing-context">guest browsing context</a> is not null, then <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/window-object.html#a-browsing-context-is-discarded" id="ref-for-a-browsing-context-is-discarded">discard</a> it.</p>
           <div class="note" role="note">
             This unceremoniously <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/window-object.html#a-browsing-context-is-discarded" id="ref-for-a-browsing-context-is-discarded①">discards</a> the browsing context, as if the element had been removed from
  the document after previously being attached. This is
  distinct from the case where the predecessor was never
  adopted, below, which <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/window-object.html#close-a-browsing-context" id="ref-for-close-a-browsing-context①">closes</a> the
  browsing context. Closing <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#unload-a-document" id="ref-for-unload-a-document">unloads</a> the predecessor’s
  document, somewhat similarly to if it had performed an ordinary
  navigation. 
            <p>Typically authors would not call <code class="idl"><a data-link-type="idl" href="#dom-portalactivateevent-adoptpredecessor" id="ref-for-dom-portalactivateevent-adoptpredecessor①">adoptPredecessor()</a></code> unless they intend
  to insert it into the document before the <a data-link-type="dfn" href="#htmlportalelement-just-adopted-flag" id="ref-for-htmlportalelement-just-adopted-flag①">just-adopted flag</a> becomes false.</p>
           </div>
         </ol>
        <li data-md>
         <p>Otherwise:</p>
         <ol>
          <li data-md>
           <p>If <var>promise</var> is given, <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task" id="ref-for-queue-a-global-task②">queue a global task</a> on the <a data-link-type="dfn" href="#portal-task-source" id="ref-for-portal-task-source②">portal task source</a> given <var>predecessorBrowsingContext</var>’s <a data-link-type="dfn">active window</a> to resolve <var>promise</var> with undefined.</p>
          <li data-md>
           <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/window-object.html#close-a-browsing-context" id="ref-for-close-a-browsing-context②">Close</a> <var>predecessorBrowsingContext</var>.</p>
           <p>The user agent <em>should not</em> ask the user for confirmation during the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#prompt-to-unload-a-document" id="ref-for-prompt-to-unload-a-document">prompt to unload</a> step (and so the browsing context should be <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/window-object.html#a-browsing-context-is-discarded" id="ref-for-a-browsing-context-is-discarded②">discarded</a>).</p>
           <div class="note" role="note"> Authors should not expect the <code class="idl"><a class="idl-code" data-link-type="event" href="https://html.spec.whatwg.org/multipage/indices.html#event-unload" id="ref-for-event-unload">unload</a></code> event
  to be dispatched consistently following portal activation. In
  addition to adoption of the predecessor, where the predecessor
  would not be <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#unload-a-document" id="ref-for-unload-a-document①">unloaded</a> at all, the predecessor could
  also enter bfcache (back forward cache) where the unload event
  would not be dispatched. </div>
           <div class="issue" id="issue-c722a2b5"><a class="self-link" href="#issue-c722a2b5"></a> Determine how to treat unload/beforeunload handlers. See <a href="https://github.com/WICG/portals/issues/225">issue #225</a> for discussion. </div>
         </ol>
       </ol>
     </ol>
    </section>
    <details class="wpt-tests-block" dir="ltr" lang="en" open>
     <summary>Tests</summary>
     <ul class="wpt-tests-list">
      <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/portals/portal-activate-event.html" title="portals/portal-activate-event.html">portal-activate-event.html</a> <a class="wpt-live" href="http://wpt.live/portals/portal-activate-event.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/portals/portal-activate-event.html"><small>(source)</small></a>
      <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/portals/portals-host-hidden-after-activation.html" title="portals/portals-host-hidden-after-activation.html">portals-host-hidden-after-activation.html</a> <a class="wpt-live" href="http://wpt.live/portals/portals-host-hidden-after-activation.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/portals/portals-host-hidden-after-activation.html"><small>(source)</small></a>
     </ul>
    </details>
    <div class="issue" id="issue-b49e4903"><a class="self-link" href="#issue-b49e4903"></a> In the case that structured deserialization throws, it may be useful to do something else to indicate it,
    rather than simply providing null data. </div>
    <div class="issue" id="issue-0d72b101"><a class="self-link" href="#issue-0d72b101"></a> We need to specify how the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/history.html#session-history" id="ref-for-session-history①">session history</a> of each browsing context is
    affected by activation, and supply non-normative text that explains how
    these histories are expected to be presented to the user. </div>
    <section class="algorithm" data-algorithm="portal-browsing-context-adopt-predecessor">
      To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="adopt-the-predecessor-browsing-context">adopt the predecessor browsing context</dfn> <var>predecessorBrowsingContext</var> in <var>successorWindow</var>, run the following steps: 
     <ol>
      <li data-md>
       <p>Let <var>document</var> be the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window" id="ref-for-concept-document-window">document</a> of <var>successorWindow</var>.</p>
      <li data-md>
       <p>Let <var>portalElement</var> be the result of <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-create-element" id="ref-for-concept-create-element">creating an element</a> given <var>document</var>, <code>portal</code>, and the <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#html-namespace" id="ref-for-html-namespace">HTML namespace</a>.</p>
      <li data-md>
       <p>Set <var>portalElement</var>’s <a data-link-type="dfn" href="#htmlportalelement-just-adopted-flag" id="ref-for-htmlportalelement-just-adopted-flag②">just-adopted flag</a> to true.</p>
      <li data-md>
       <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#assert" id="ref-for-assert②">Assert</a>: <var>portalElement</var> is an <code class="idl"><a data-link-type="idl" href="#htmlportalelement" id="ref-for-htmlportalelement">HTMLPortalElement</a></code>.</p>
      <li data-md>
       <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task" id="ref-for-queue-a-global-task③">Queue a global task</a> on the <a data-link-type="dfn" href="#portal-task-source" id="ref-for-portal-task-source③">portal task source</a> given <var>predecessorBrowsingContext</var>’s <a data-link-type="dfn">active window</a> to run the following steps:</p>
       <ol>
        <li data-md>
         <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#assert" id="ref-for-assert③">Assert</a>: The <a data-link-type="dfn" href="#portal-state" id="ref-for-portal-state⑥">portal state</a> of <var>predecessorBrowsingContext</var> is "<code>orphaned</code>".</p>
        <li data-md>
         <p>Set the <a data-link-type="dfn" href="#portal-state" id="ref-for-portal-state⑦">portal state</a> of <var>predecessorBrowsingContext</var> to "<code>portal</code>", and
set the <a data-link-type="dfn" href="#host-element" id="ref-for-host-element⑤">host element</a> of <var>predecessorBrowsingContext</var> to <var>portalElement</var>.</p>
       </ol>
      <li data-md>
       <p>Return <var>portalElement</var>.</p>
     </ol>
    </section>
    <div class="note" role="note">
      Since the task to set the <a data-link-type="dfn" href="#portal-state" id="ref-for-portal-state⑧">portal state</a>, and thus expose the <code class="idl"><a data-link-type="idl" href="#portalhost" id="ref-for-portalhost">PortalHost</a></code> object, is queued first, and from the same <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#task-source" id="ref-for-task-source①">task source</a>,
    it is exposed at the time the <a data-link-type="dfn" href="#portalactivateevent-activation-promise" id="ref-for-portalactivateevent-activation-promise①">activation promise</a> returned from <code class="idl"><a data-link-type="idl" href="#dom-htmlportalelement-activate" id="ref-for-dom-htmlportalelement-activate①">activate(options)</a></code> is resolved. 
<pre class="highlight"><c- c1>// In the successor document.</c->
onportalactivate <c- o>=</c-> event <c- p>=></c-> <c- p>{</c->
  <c- c1>// The predecessor document is adopted into a &lt;portal> element...</c->
  document<c- p>.</c->body<c- p>.</c->appendChild<c- p>(</c->event<c- p>.</c->adoptPredecessor<c- p>());</c->
<c- p>});</c->

<c- c1>// In the predecessor document.</c->
portalElement<c- p>.</c->activate<c- p>().</c->then<c- p>(()</c-> <c- p>=></c-> <c- p>{</c->
  <c- c1>// ...and it is guaranteed to observe that change by the time the</c->
  <c- c1>// activation promise resolves.</c->
  console<c- p>.</c->assert<c- p>(</c->window<c- p>.</c->portalHost <c- ow>instanceof</c-> PortalHost<c- p>);</c->
<c- p>});</c->
</pre>
    </div>
   </section>
   <section>
    <h2 class="heading settled" data-level="3" id="the-portal-element"><span class="secno">3. </span><span class="content">The <code>portal</code> element</span><a class="self-link" href="#the-portal-element"></a></h2>
    <p><em>The following section would be added as a new subsection of <a data-link-type="biblio" href="#biblio-html" title="HTML Standard">[HTML]</a>'s <a href="https://html.spec.whatwg.org/#embedded-content">Embedded content</a> section.</em></p>
    <p>A <dfn class="dfn-paneled" data-dfn-type="element" data-export id="elementdef-portal"><code>portal</code></dfn> element allows for a <a data-link-type="dfn" href="#portal-browsing-context" id="ref-for-portal-browsing-context③">portal browsing context</a> to be embedded in an HTML document.</p>
    <details class="wpt-tests-block" dir="ltr" lang="en" open>
     <summary>Tests</summary>
     <ul class="wpt-tests-list">
      <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/portals/portals-rendering.html" title="portals/portals-rendering.html">portals-rendering.html</a> <a class="wpt-live" href="http://wpt.live/portals/portals-rendering.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/portals/portals-rendering.html"><small>(source)</small></a>
     </ul>
    </details>
    <p>A <code><a data-link-type="element" href="#elementdef-portal" id="ref-for-elementdef-portal③">portal</a></code> element <var>portalElement</var> has a <dfn class="dfn-paneled" data-dfn-for="HTMLPortalElement" data-dfn-type="dfn" data-lt="guest browsing context" data-noexport id="htmlportalelement-guest-browsing-context">guest
  browsing context</dfn>, which is the <a data-link-type="dfn" href="#portal-browsing-context" id="ref-for-portal-browsing-context④">portal browsing context</a> whose <a data-link-type="dfn" href="#host-element" id="ref-for-host-element⑥">host
  element</a> is <var>portalElement</var>, or null if no such browsing context exists.</p>
    <p>A <code><a data-link-type="element" href="#elementdef-portal" id="ref-for-elementdef-portal④">portal</a></code> element has a <dfn class="dfn-paneled" data-dfn-for="HTMLPortalElement" data-dfn-type="dfn" data-lt="just-adopted flag" data-noexport id="htmlportalelement-just-adopted-flag">just-adopted
  flag</dfn>, which is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#boolean" id="ref-for-boolean">boolean</a> and is initially false. It is set during
  dispatch of the <code class="idl"><a class="idl-code" data-link-type="event" href="#eventdef-window-portalactivate" id="ref-for-eventdef-window-portalactivate②">portalactivate</a></code> event.</p>
    <p>The <dfn class="dfn-paneled" data-dfn-for="portal" data-dfn-type="element-attr" data-export id="element-attrdef-portal-src"><code>src</code></dfn> attribute gives the <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url" id="ref-for-concept-url">URL</a> of a
  page that the <a data-link-type="dfn" href="#htmlportalelement-guest-browsing-context" id="ref-for-htmlportalelement-guest-browsing-context①">guest browsing context</a> is to contain. The attribute, if
  present, must be a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/urls-and-fetching.html#valid-non-empty-url-potentially-surrounded-by-spaces" id="ref-for-valid-non-empty-url-potentially-surrounded-by-spaces">valid non-empty URL potentially surrounded by spaces</a>.</p>
    <p>The <dfn class="dfn-paneled" data-dfn-for="portal" data-dfn-type="element-attr" data-export id="element-attrdef-portal-referrerpolicy"><code>referrerpolicy</code></dfn> attribute is a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/urls-and-fetching.html#referrer-policy-attribute" id="ref-for-referrer-policy-attribute">referrer policy attribute</a>.
  Its purpose is to set the <a data-link-type="dfn" href="https://w3c.github.io/webappsec-referrer-policy/#referrer-policy" id="ref-for-referrer-policy">referrer policy</a> used when <a data-link-type="dfn" href="#set-the-source-url-of-a-portal-element" id="ref-for-set-the-source-url-of-a-portal-element">setting the source URL of a portal element</a>. <a data-link-type="biblio" href="#biblio-referrer-policy" title="Referrer Policy">[REFERRER-POLICY]</a></p>
    <p class="note" role="note"> A <code><a data-link-type="element" href="#elementdef-portal" id="ref-for-elementdef-portal⑤">portal</a></code> is similar to an <code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/iframe-embed-object.html#the-iframe-element" id="ref-for-the-iframe-element">iframe</a></code>, in that it allows another
    browsing context to be embedded.  However, the <a data-link-type="dfn" href="#portal-browsing-context" id="ref-for-portal-browsing-context⑤">portal browsing context</a> hosted by a <code><a data-link-type="element" href="#elementdef-portal" id="ref-for-elementdef-portal⑥">portal</a></code> is part of a separate <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#browsing-context-group" id="ref-for-browsing-context-group">browsing context group</a>,
    and thus a separate <a data-link-type="dfn" href="http://tc39.github.io/ecma262/#sec-agents" id="ref-for-sec-agents">agent</a>.  The user agent therefore uses a
    separate <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-agent-event-loop" id="ref-for-concept-agent-event-loop">event loop</a> for the browsing contexts, even if they are <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#same-origin-domain" id="ref-for-same-origin-domain">same
    origin-domain</a>. </p>
<pre class="idl highlight def">[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed" id="ref-for-Exposed"><c- g>Exposed</c-></a>=<c- n>Window</c->, <a class="idl-code" data-link-type="extended-attribute" href="https://html.spec.whatwg.org/multipage/dom.html#htmlconstructor" id="ref-for-htmlconstructor"><c- g>HTMLConstructor</c-></a>]
<c- b>interface</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="interface" data-export id="htmlportalelement"><code><c- g>HTMLPortalElement</c-></code></dfn> : <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/dom.html#htmlelement" id="ref-for-htmlelement"><c- n>HTMLElement</c-></a> {
    [<a class="idl-code" data-link-type="extended-attribute" href="https://html.spec.whatwg.org/multipage/custom-elements.html#cereactions" id="ref-for-cereactions"><c- g>CEReactions</c-></a>] <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-USVString" id="ref-for-idl-USVString"><c- b>USVString</c-></a> <a class="idl-code" data-link-type="attribute" data-type="USVString" href="#dom-htmlportalelement-src" id="ref-for-dom-htmlportalelement-src"><c- g>src</c-></a>;
    [<a class="idl-code" data-link-type="extended-attribute" href="https://html.spec.whatwg.org/multipage/custom-elements.html#cereactions" id="ref-for-cereactions①"><c- g>CEReactions</c-></a>] <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString" id="ref-for-idl-DOMString"><c- b>DOMString</c-></a> <a class="idl-code" data-link-type="attribute" data-type="DOMString" href="#dom-htmlportalelement-referrerpolicy" id="ref-for-dom-htmlportalelement-referrerpolicy"><c- g>referrerPolicy</c-></a>;

    [<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#NewObject" id="ref-for-NewObject"><c- g>NewObject</c-></a>] <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise" id="ref-for-idl-promise"><c- b>Promise</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-undefined" id="ref-for-idl-undefined"><c- b>undefined</c-></a>> <a class="idl-code" data-link-type="method" href="#dom-htmlportalelement-activate" id="ref-for-dom-htmlportalelement-activate②"><c- g>activate</c-></a>(<c- b>optional</c-> <a data-link-type="idl-name" href="#dictdef-portalactivateoptions" id="ref-for-dictdef-portalactivateoptions"><c- n>PortalActivateOptions</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="HTMLPortalElement/activate(options), HTMLPortalElement/activate()" data-dfn-type="argument" data-export id="dom-htmlportalelement-activate-options-options"><code><c- g>options</c-></code></dfn> = {});
    <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-undefined" id="ref-for-idl-undefined①"><c- b>undefined</c-></a> <a class="idl-code" data-link-type="method" href="#dom-htmlportalelement-postmessage" id="ref-for-dom-htmlportalelement-postmessage"><c- g>postMessage</c-></a>(<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-any" id="ref-for-idl-any"><c- b>any</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="HTMLPortalElement/postMessage(message, options), HTMLPortalElement/postMessage(message)" data-dfn-type="argument" data-export id="dom-htmlportalelement-postmessage-message-options-message"><code><c- g>message</c-></code></dfn>, <c- b>optional</c-> <a data-link-type="idl-name"><c- n>PostMessageOptions</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="HTMLPortalElement/postMessage(message, options), HTMLPortalElement/postMessage(message)" data-dfn-type="argument" data-export id="dom-htmlportalelement-postmessage-message-options-options"><code><c- g>options</c-></code></dfn> = {});

    <c- b>attribute</c-> <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler" id="ref-for-eventhandler"><c- n>EventHandler</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="HTMLPortalElement" data-dfn-type="attribute" data-export data-type="EventHandler" id="dom-htmlportalelement-onmessage"><code><c- g>onmessage</c-></code></dfn>;
    <c- b>attribute</c-> <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler" id="ref-for-eventhandler①"><c- n>EventHandler</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="HTMLPortalElement" data-dfn-type="attribute" data-export data-type="EventHandler" id="dom-htmlportalelement-onmessageerror"><code><c- g>onmessageerror</c-></code></dfn>;
};

<c- b>dictionary</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="dictionary" data-export id="dictdef-portalactivateoptions"><code><c- g>PortalActivateOptions</c-></code></dfn> : <a data-link-type="idl-name"><c- n>PostMessageOptions</c-></a> {
    <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-any" id="ref-for-idl-any①"><c- b>any</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="PortalActivateOptions" data-dfn-type="dict-member" data-export data-type="any" id="dom-portalactivateoptions-data"><code><c- g>data</c-></code></dfn>;
};
</pre>
    <details class="wpt-tests-block" dir="ltr" lang="en" open>
     <summary>Tests</summary>
     <ul class="wpt-tests-list">
      <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/portals/portals-api.html" title="portals/portals-api.html">portals-api.html</a> <a class="wpt-live" href="http://wpt.live/portals/portals-api.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/portals/portals-api.html"><small>(source)</small></a>
     </ul>
    </details>
    <p>The <dfn class="dfn-paneled idl-code" data-dfn-for="HTMLPortalElement" data-dfn-type="attribute" data-export id="dom-htmlportalelement-src"><code>src</code></dfn> IDL attribute must <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/common-dom-interfaces.html#reflect" id="ref-for-reflect">reflect</a> the <code><a data-link-type="element-sub" href="#element-attrdef-portal-src" id="ref-for-element-attrdef-portal-src">src</a></code> content attribute.</p>
    <p>The <dfn class="dfn-paneled idl-code" data-dfn-for="HTMLPortalElement" data-dfn-type="attribute" data-export id="dom-htmlportalelement-referrerpolicy"><code>referrerPolicy</code></dfn> IDL attribute must <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/common-dom-interfaces.html#reflect" id="ref-for-reflect①">reflect</a> the <code><a data-link-type="element-sub" href="#element-attrdef-portal-referrerpolicy" id="ref-for-element-attrdef-portal-referrerpolicy">referrerpolicy</a></code> content attribute, <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/common-dom-interfaces.html#limited-to-only-known-values" id="ref-for-limited-to-only-known-values">limited to only known values</a>.</p>
    <section class="algorithm" data-algorithm="htmlportalelement-activate">
      The <dfn class="dfn-paneled idl-code" data-dfn-for="HTMLPortalElement" data-dfn-type="method" data-export data-lt="activate(options)|activate()" id="dom-htmlportalelement-activate"><code>activate(<var>options</var>)</code></dfn> method <em>must</em> run these steps: 
     <ol>
      <li data-md>
       <p>Let <var>portalBrowsingContext</var> be the <a data-link-type="dfn" href="#htmlportalelement-guest-browsing-context" id="ref-for-htmlportalelement-guest-browsing-context②">guest browsing context</a> of <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this">this</a>.</p>
      <li data-md>
       <p>If <var>portalBrowsingContext</var> is null, throw an "<code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#invalidstateerror" id="ref-for-invalidstateerror①">InvalidStateError</a></code>" <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException①">DOMException</a></code>.</p>
       <details class="wpt-tests-block" dir="ltr" lang="en" open>
        <summary>Tests</summary>
        <ul class="wpt-tests-list">
         <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/portals/portals-activate-no-browsing-context.html" title="portals/portals-activate-no-browsing-context.html">portals-activate-no-browsing-context.html</a> <a class="wpt-live" href="http://wpt.live/portals/portals-activate-no-browsing-context.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/portals/portals-activate-no-browsing-context.html"><small>(source)</small></a>
        </ul>
       </details>
      <li data-md>
       <p>Let <var>predecessorBrowsingContext</var> be the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#concept-document-bc" id="ref-for-concept-document-bc">browsing context</a> of <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this①">this</a>'s <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-node-document" id="ref-for-concept-node-document①">node document</a>.</p>
      <li data-md>
       <p>If <var>predecessorBrowsingContext</var> is null, throw an "<code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#invalidstateerror" id="ref-for-invalidstateerror②">InvalidStateError</a></code>" <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException②">DOMException</a></code>.</p>
      <li data-md>
       <p>If the <a data-link-type="dfn" href="#portal-state" id="ref-for-portal-state⑨">portal state</a> of <var>predecessorBrowsingContext</var> is not "<code>none</code>",
throw an "<code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#invalidstateerror" id="ref-for-invalidstateerror③">InvalidStateError</a></code>" <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException③">DOMException</a></code>.</p>
       <p class="note" role="note"><span class="marker">Note:</span> This means that a <code><a data-link-type="element" href="#elementdef-portal" id="ref-for-elementdef-portal⑦">portal</a></code> element inside a <a data-link-type="dfn" href="#portal-browsing-context" id="ref-for-portal-browsing-context⑥">portal browsing context</a> cannot be activated.</p>
      <li data-md>
       <p>Let <var>serializeWithTransferResult</var> be <a data-link-type="abstract-op" href="https://html.spec.whatwg.org/multipage/structured-data.html#structuredserializewithtransfer" id="ref-for-structuredserializewithtransfer">StructuredSerializeWithTransfer</a>(<var>options</var>["<code class="idl"><a data-link-type="idl" href="#dom-portalactivateoptions-data" id="ref-for-dom-portalactivateoptions-data">data</a></code>"], <var>options</var>["<code class="idl"><a data-link-type="idl">transfer</a></code>"]).
Rethrow any exceptions.</p>
      <li data-md>
       <p>Let <var>promise</var> be a new <a data-link-type="dfn" href="http://tc39.github.io/ecma262/#sec-promise-objects" id="ref-for-sec-promise-objects">promise</a>.</p>
      <li data-md>
       <p>Let <var>sourceOrigin</var> be <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this②">this</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object" id="ref-for-relevant-settings-object">relevant settings object</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin" id="ref-for-concept-settings-object-origin">origin</a>.</p>
      <li data-md>
       <p>Run the steps to <a data-link-type="dfn" href="#activate-a-portal-browsing-context" id="ref-for-activate-a-portal-browsing-context②">activate</a> <var>portalBrowsingContext</var> in place of <var>predecessorBrowsingContext</var> with <var>sourceOrigin</var>, <var>serializeWithTransferResult</var>,
and <var>promise</var>.</p>
      <li data-md>
       <p>Return <var>promise</var>.</p>
     </ol>
     <details class="wpt-tests-block" dir="ltr" lang="en" open>
      <summary>Tests</summary>
      <ul class="wpt-tests-list">
       <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/portals/portal-activate-data.html" title="portals/portal-activate-data.html">portal-activate-data.html</a> <a class="wpt-live" href="http://wpt.live/portals/portal-activate-data.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/portals/portal-activate-data.html"><small>(source)</small></a>
       <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/portals/portals-activate-inside-iframe.html" title="portals/portals-activate-inside-iframe.html">portals-activate-inside-iframe.html</a> <a class="wpt-live" href="http://wpt.live/portals/portals-activate-inside-iframe.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/portals/portals-activate-inside-iframe.html"><small>(source)</small></a>
       <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/portals/portals-activate-inside-portal.html" title="portals/portals-activate-inside-portal.html">portals-activate-inside-portal.html</a> <a class="wpt-live" href="http://wpt.live/portals/portals-activate-inside-portal.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/portals/portals-activate-inside-portal.html"><small>(source)</small></a>
       <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/portals/portals-activate-resolution.html" title="portals/portals-activate-resolution.html">portals-activate-resolution.html</a> <a class="wpt-live" href="http://wpt.live/portals/portals-activate-resolution.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/portals/portals-activate-resolution.html"><small>(source)</small></a>
       <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/portals/portals-activate-twice.html" title="portals/portals-activate-twice.html">portals-activate-twice.html</a> <a class="wpt-live" href="http://wpt.live/portals/portals-activate-twice.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/portals/portals-activate-twice.html"><small>(source)</small></a>
      </ul>
     </details>
    </section>
    <section class="algorithm" data-algorithm="htmlportalelement-postmessage">
      The <dfn class="dfn-paneled idl-code" data-dfn-for="HTMLPortalElement" data-dfn-type="method" data-export data-lt="postMessage(message, options)|postMessage(message)" id="dom-htmlportalelement-postmessage"><code>postMessage(<var>message</var>, <var>options</var>)</code></dfn> method <em>must</em> run these steps: 
     <ol>
      <li data-md>
       <p>Let <var>portalBrowsingContext</var> be the <a data-link-type="dfn" href="#htmlportalelement-guest-browsing-context" id="ref-for-htmlportalelement-guest-browsing-context③">guest browsing context</a> of <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this③">this</a>.</p>
      <li data-md>
       <p>If <var>portalBrowsingContext</var> is null, throw an "<code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#invalidstateerror" id="ref-for-invalidstateerror④">InvalidStateError</a></code>" <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException④">DOMException</a></code>.</p>
      <li data-md>
       <p>Let <var>sourceOrigin</var> be <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this④">this</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object" id="ref-for-relevant-settings-object①">relevant settings object</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin" id="ref-for-concept-settings-object-origin①">origin</a>.</p>
      <li data-md>
       <p>Let <var>transfer</var> be <var>options</var>["<code class="idl"><a data-link-type="idl">transfer</a></code>"].</p>
      <li data-md>
       <p>Let <var>serializeWithTransferResult</var> be <a data-link-type="abstract-op" href="https://html.spec.whatwg.org/multipage/structured-data.html#structuredserializewithtransfer" id="ref-for-structuredserializewithtransfer①">StructuredSerializeWithTransfer</a>(<var>message</var>, <var>transfer</var>). Rethrow any exceptions.</p>
      <li data-md>
       <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task" id="ref-for-queue-a-global-task④">Queue a global task</a> on the <a data-link-type="dfn" href="#portal-task-source" id="ref-for-portal-task-source④">portal task source</a> given <var>portalBrowsingContext</var>’s <a data-link-type="dfn">active
window</a> to run the following steps:</p>
       <ol>
        <li data-md>
         <p>If <var>portalBrowsingContext</var>’s <a data-link-type="dfn">active document</a>'s <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-document-origin" id="ref-for-concept-document-origin①">origin</a> is not <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#same-origin" id="ref-for-same-origin①">same origin</a> with <var>sourceOrigin</var>, then abort these steps.</p>
        <li data-md>
         <p>Let <var>origin</var> be the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#ascii-serialisation-of-an-origin" id="ref-for-ascii-serialisation-of-an-origin">serialization</a> of <var>sourceOrigin</var>.</p>
        <li data-md>
         <p>Let <var>targetWindow</var> be <var>portalBrowsingContext</var>’s associated <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#windowproxy" id="ref-for-windowproxy①">WindowProxy</a></code>'s [[Window]] internal slot value.</p>
        <li data-md>
         <p>Let <var>portalHost</var> be the <var>targetWindow</var>’s <a data-link-type="dfn" href="#portal-host-object" id="ref-for-portal-host-object">portal host object</a>.</p>
        <li data-md>
         <p>Let <var>targetRealm</var> be the <var>targetWindow</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-global-object-realm" id="ref-for-concept-global-object-realm①">realm</a>.</p>
        <li data-md>
         <p>Let <var>deserializeRecord</var> be <a data-link-type="abstract-op" href="https://html.spec.whatwg.org/multipage/structured-data.html#structureddeserializewithtransfer" id="ref-for-structureddeserializewithtransfer①">StructuredDeserializeWithTransfer</a>(<var>serializeWithTransferResult</var>, <var>targetRealm</var>).</p>
         <p>If this throws an exception, catch it, <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-event-fire" id="ref-for-concept-event-fire">fire an event</a> named <code class="idl"><a class="idl-code" data-link-type="event" href="#eventdef-portalhost-messageerror" id="ref-for-eventdef-portalhost-messageerror">messageerror</a></code> at <var>portalHost</var> using <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/comms.html#messageevent" id="ref-for-messageevent">MessageEvent</a></code> with the <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/comms.html#dom-messageevent-origin" id="ref-for-dom-messageevent-origin">origin</a></code> attribute initialized to <var>origin</var> and the <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/comms.html#dom-messageevent-source" id="ref-for-dom-messageevent-source">source</a></code> attribute initialized to <var>portalHost</var>,
then abort these steps.</p>
        <li data-md>
         <p>Let <var>messageClone</var> be <var>deserializeRecord</var>.[[Deserialized]].</p>
        <li data-md>
         <p>Let <var>newPorts</var> be a new <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#dfn-frozen-array-type" id="ref-for-dfn-frozen-array-type">frozen array</a> consisting of all <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/web-messaging.html#messageport" id="ref-for-messageport">MessagePort</a></code> objects in <var>deserializeRecord</var>.[[TransferredValues]], if any, maintaining their relative order.</p>
        <li data-md>
         <p><a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-event-fire" id="ref-for-concept-event-fire①">Fire an event</a> named <code class="idl"><a class="idl-code" data-link-type="event" href="#eventdef-portalhost-message" id="ref-for-eventdef-portalhost-message">message</a></code> at <var>portalHost</var> using <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/comms.html#messageevent" id="ref-for-messageevent①">MessageEvent</a></code>, with the <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/comms.html#dom-messageevent-origin" id="ref-for-dom-messageevent-origin①">origin</a></code> attribute
initialized to <var>origin</var>, the <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/comms.html#dom-messageevent-source" id="ref-for-dom-messageevent-source①">source</a></code> attribute initialized to <var>portalHost</var>, the <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/comms.html#dom-messageevent-data" id="ref-for-dom-messageevent-data">data</a></code> attribute
initialized to <var>messageClone</var>, and the <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/comms.html#dom-messageevent-ports" id="ref-for-dom-messageevent-ports">ports</a></code> attribute initialized to <var>newPorts</var>.</p>
       </ol>
     </ol>
     <details class="wpt-tests-block" dir="ltr" lang="en" open>
      <summary>Tests</summary>
      <ul class="wpt-tests-list">
       <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/portals/portals-post-message.sub.html" title="portals/portals-post-message.sub.html">portals-post-message.sub.html</a> <a class="wpt-live" href="http://wpt.live/portals/portals-post-message.sub.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/portals/portals-post-message.sub.html"><small>(source)</small></a>
      </ul>
     </details>
    </section>
    <section class="algorithm" data-algorithm="htmlportalelement-may-have-guest-browsing-context">
      To determine whether a <code><a data-link-type="element" href="#elementdef-portal" id="ref-for-elementdef-portal⑧">portal</a></code> element <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="may-have-a-guest-browsing-context">may have a guest browsing context</dfn>, run the following steps: 
     <ol>
      <li data-md>
       <p>If <var>element</var>’s <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-node-document" id="ref-for-concept-node-document②">node document</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#browsing-context" id="ref-for-browsing-context③">browsing context</a> is not a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#top-level-browsing-context" id="ref-for-top-level-browsing-context①">top-level browsing context</a>, then return false.</p>
       <details class="wpt-tests-block" dir="ltr" lang="en" open>
        <summary>Tests</summary>
        <ul class="wpt-tests-list">
         <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/portals/portals-nested.html" title="portals/portals-nested.html">portals-nested.html</a> <a class="wpt-live" href="http://wpt.live/portals/portals-nested.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/portals/portals-nested.html"><small>(source)</small></a>
        </ul>
       </details>
       <p class="note" role="note"> The user agent may choose to emit a warning if the author attempts to
  use a <code><a data-link-type="element" href="#elementdef-portal" id="ref-for-elementdef-portal⑨">portal</a></code> element in a <a data-link-type="dfn">nested browsing context</a>, as this is not
  supported. </p>
      <li data-md>
       <p>If <var>element</var>’s <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-node-document" id="ref-for-concept-node-document③">node document</a>'s <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-document-url" id="ref-for-concept-document-url">URL</a>'s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-scheme" id="ref-for-concept-url-scheme">scheme</a> is not an <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#http-scheme" id="ref-for-http-scheme">HTTP(S) scheme</a>, then return false.</p>
       <details class="wpt-tests-block" dir="ltr" lang="en" open>
        <summary>Tests</summary>
        <ul class="wpt-tests-list">
         <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/portals/about-blank-cannot-host.html" title="portals/about-blank-cannot-host.html">about-blank-cannot-host.html</a> <a class="wpt-live" href="http://wpt.live/portals/about-blank-cannot-host.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/portals/about-blank-cannot-host.html"><small>(source)</small></a>
        </ul>
       </details>
       <p class="note" role="note"> This is to prevent problems later, if the portaled content attempts to <a data-link-type="dfn" href="#adopt-the-predecessor-browsing-context" id="ref-for-adopt-the-predecessor-browsing-context②">adopt its predecessor</a>. Since portaled content
  can only have a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#http-scheme" id="ref-for-http-scheme①">HTTP(S) scheme</a>, adoption would fail, and so its simpler to restrict
  things at this stage. </p>
      <li data-md>
       <p>If <var>element</var>’s <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-node-document" id="ref-for-concept-node-document④">node document</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#active-sandboxing-flag-set" id="ref-for-active-sandboxing-flag-set">active sandboxing flag set</a> is not empty,
then return false.</p>
       <details class="wpt-tests-block" dir="ltr" lang="en" open>
        <summary>Tests</summary>
        <ul class="wpt-tests-list">
         <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/portals/no-portal-in-sandboxed-popup.html" title="portals/no-portal-in-sandboxed-popup.html">no-portal-in-sandboxed-popup.html</a> <a class="wpt-live" href="http://wpt.live/portals/no-portal-in-sandboxed-popup.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/portals/no-portal-in-sandboxed-popup.html"><small>(source)</small></a>
        </ul>
       </details>
       <p class="note" role="note"> Since portals cannot be created in <a data-link-type="dfn">child browsing contexts</a> anyway, this step is about
  preventing portal uses in <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#auxiliary-browsing-context" id="ref-for-auxiliary-browsing-context">auxiliary browsing contexts</a> spawned by sandboxed <code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/iframe-embed-object.html#the-iframe-element" id="ref-for-the-iframe-element①">iframe</a></code>s, or pages using CSP’s <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#sandbox" id="ref-for-sandbox">sandbox</a> directive. </p>
       <p class="note" role="note"> This restriction is largely added for simplicity. If there are use cases for portals
  inside sandboxed documents, we can enable them in the future, with appropriate opt-in. See <a href="https://github.com/WICG/portals/issues/207">issue #207</a> for discussion. </p>
      <li data-md>
       <p>If <var>element</var> is <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#browsing-context-connected" id="ref-for-browsing-context-connected①">browsing-context connected</a>, then return true.</p>
      <li data-md>
       <p>If <var>element</var>’s <a data-link-type="dfn" href="#htmlportalelement-just-adopted-flag" id="ref-for-htmlportalelement-just-adopted-flag③">just-adopted flag</a> is true, then return true.</p>
      <li data-md>
       <p>Return false.</p>
     </ol>
    </section>
    <section class="algorithm" data-algorithm="htmlportalelement-close">
      To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="close-a-portal-element">close a <code><a data-link-type="element" href="#elementdef-portal" id="ref-for-elementdef-portal①⓪">portal</a></code> element</dfn> <var>element</var>, run the following steps: 
     <ol>
      <li data-md>
       <p>If <var>element</var>’s <a data-link-type="dfn" href="#htmlportalelement-guest-browsing-context" id="ref-for-htmlportalelement-guest-browsing-context④">guest browsing context</a> is not null, then <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/window-object.html#close-a-browsing-context" id="ref-for-close-a-browsing-context③">close</a> it.</p>
       <p>The user agent <em>should not</em> ask the user for confirmation during the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#prompt-to-unload-a-document" id="ref-for-prompt-to-unload-a-document①">prompt to unload</a> step (and so the browsing context should be <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/window-object.html#a-browsing-context-is-discarded" id="ref-for-a-browsing-context-is-discarded③">discarded</a>).</p>
     </ol>
    </section>
    <section class="algorithm" data-algorithm="htmlportalelement-setsourceurl">
      To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="set-the-source-url-of-a-portal-element">set the source URL of a <code><a data-link-type="element" href="#elementdef-portal" id="ref-for-elementdef-portal①①">portal</a></code> element</dfn> <var>element</var>, run the following steps: 
     <ol>
      <li data-md>
       <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#assert" id="ref-for-assert④">Assert</a>: <var>element</var> <a data-link-type="dfn" href="#may-have-a-guest-browsing-context" id="ref-for-may-have-a-guest-browsing-context①">may have a guest browsing context</a>.</p>
      <li data-md>
       <p>Let <var>hostBrowsingContext</var> be <var>element</var>’s <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-node-document" id="ref-for-concept-node-document⑤">node document</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#browsing-context" id="ref-for-browsing-context④">browsing context</a>.</p>
      <li data-md>
       <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#assert" id="ref-for-assert⑤">Assert</a>: <var>hostBrowsingContext</var> is a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#top-level-browsing-context" id="ref-for-top-level-browsing-context②">top-level browsing context</a>.</p>
      <li data-md>
       <p><a data-link-type="dfn" href="#close-a-portal-element" id="ref-for-close-a-portal-element">Close</a> <var>element</var>.</p>
      <li data-md>
       <p>If <var>element</var> has no <code><a data-link-type="element-sub" href="#element-attrdef-portal-src" id="ref-for-element-attrdef-portal-src①">src</a></code> attribute specified, or its value is the empty string,
then return.</p>
      <li data-md>
       <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/urls-and-fetching.html#parse-a-url" id="ref-for-parse-a-url">Parse</a> the value of the <code><a data-link-type="element-sub" href="#element-attrdef-portal-src" id="ref-for-element-attrdef-portal-src②">src</a></code> attribute. If that is not successful,
then return.</p>
       <p>Otherwise, let <var>url</var> be the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/urls-and-fetching.html#resulting-url-record" id="ref-for-resulting-url-record">resulting URL record</a>.</p>
      <li data-md>
       <p class="assertion">Assert: <var>element</var>’s <a data-link-type="dfn" href="#htmlportalelement-guest-browsing-context" id="ref-for-htmlportalelement-guest-browsing-context⑤">guest browsing context</a> is null.</p>
      <li data-md>
       <p>Let <var>guestBrowsingContext</var> be the result of <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#creating-a-new-top-level-browsing-context" id="ref-for-creating-a-new-top-level-browsing-context">creating a new top-level browsing context</a>.</p>
      <li data-md>
       <p>Set the <a data-link-type="dfn" href="#portal-state" id="ref-for-portal-state①⓪">portal state</a> of <var>guestBrowsingContext</var> to "<code>portal</code>", and set the <a data-link-type="dfn" href="#host-element" id="ref-for-host-element⑦">host element</a> of <var>guestBrowsingContext</var> to <var>element</var>.</p>
      <li data-md>
       <p>Let <var>resource</var> be a new <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request" id="ref-for-concept-request">request</a> whose <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-url" id="ref-for-concept-request-url">url</a> is <var>url</var> and whose <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-referrer-policy" id="ref-for-concept-request-referrer-policy">referrer policy</a> is the current state of <var>element</var>’s <code><a data-link-type="element-sub" href="#element-attrdef-portal-referrerpolicy" id="ref-for-element-attrdef-portal-referrerpolicy①">referrerpolicy</a></code> content attribute.</p>
      <li data-md>
       <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#navigate" id="ref-for-navigate">Navigate</a> <var>guestBrowsingContext</var> to <var>resource</var>.</p>
     </ol>
     <div class="note" role="note">
       Unlike an <code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/iframe-embed-object.html#the-iframe-element" id="ref-for-the-iframe-element②">iframe</a></code> element, a <code><a data-link-type="element" href="#elementdef-portal" id="ref-for-elementdef-portal①②">portal</a></code> element supports a state where it has no associated
      browsing context. This is the initial state of a <code><a data-link-type="element" href="#elementdef-portal" id="ref-for-elementdef-portal①③">portal</a></code> element. That is, the <a data-link-type="dfn" href="#portal-browsing-context" id="ref-for-portal-browsing-context⑦">portal
      browsing context</a> has no web-developer-visible initial <code>about:blank</code> <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#document" id="ref-for-document①">Document</a></code>; instead it <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#navigate" id="ref-for-navigate①">navigates</a> directly to the first parsable URL assigned to it, and if the navigation cannot
      finish successfully, it <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/window-object.html#close-a-browsing-context" id="ref-for-close-a-browsing-context④">closes</a> the browsing context before the
      navigation algorithm finishes. 
      <p>Similarly, a <code><a data-link-type="element" href="#elementdef-portal" id="ref-for-elementdef-portal①④">portal</a></code> element responds to an unparsable <code><a data-link-type="element-sub" href="#element-attrdef-portal-src" id="ref-for-element-attrdef-portal-src③">src</a></code> URL by <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/window-object.html#close-a-browsing-context" id="ref-for-close-a-browsing-context⑤">closing</a> its browsing context, rather than by navigating to <code>about:blank</code>.</p>
     </div>
    </section>
    <details class="wpt-tests-block" dir="ltr" lang="en" open>
     <summary>Tests</summary>
     <ul class="wpt-tests-list">
      <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/portals/portals-cross-origin-load.sub.html" title="portals/portals-cross-origin-load.sub.html">portals-cross-origin-load.sub.html</a> <a class="wpt-live" href="http://wpt.live/portals/portals-cross-origin-load.sub.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/portals/portals-cross-origin-load.sub.html"><small>(source)</small></a>
      <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/portals/portals-referrer.html" title="portals/portals-referrer.html">portals-referrer.html</a> <a class="wpt-live" href="http://wpt.live/portals/portals-referrer.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/portals/portals-referrer.html"><small>(source)</small></a>
      <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/portals/portals-referrer-inherit-header.html" title="portals/portals-referrer-inherit-header.html">portals-referrer-inherit-header.html</a> <a class="wpt-live" href="http://wpt.live/portals/portals-referrer-inherit-header.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/portals/portals-referrer-inherit-header.html"><small>(source)</small></a>
      <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/portals/portals-referrer-inherit-meta.html" title="portals/portals-referrer-inherit-meta.html">portals-referrer-inherit-meta.html</a> <a class="wpt-live" href="http://wpt.live/portals/portals-referrer-inherit-meta.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/portals/portals-referrer-inherit-meta.html"><small>(source)</small></a>
     </ul>
    </details>
    <p>Whenever a <code><a data-link-type="element" href="#elementdef-portal" id="ref-for-elementdef-portal①⑤">portal</a></code> element <var>element</var> has its <code><a data-link-type="element-sub" href="#element-attrdef-portal-src" id="ref-for-element-attrdef-portal-src④">src</a></code> attribute set,
  changed, or removed, run the following steps:</p>
    <ol>
     <li data-md>
      <p>If <var>element</var> <a data-link-type="dfn" href="#may-have-a-guest-browsing-context" id="ref-for-may-have-a-guest-browsing-context②">may have a guest browsing context</a>, then <a data-link-type="dfn" href="#set-the-source-url-of-a-portal-element" id="ref-for-set-the-source-url-of-a-portal-element①">set the source URL</a> of <var>element</var>.</p>
    </ol>
    <p>Whenever a <code><a data-link-type="element" href="#elementdef-portal" id="ref-for-elementdef-portal①⑥">portal</a></code> element <var>element</var> <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#becomes-browsing-context-connected" id="ref-for-becomes-browsing-context-connected">becomes
  browsing-context connected</a>, run the following steps:</p>
    <ol>
     <li data-md>
      <p>If <var>element</var> <a data-link-type="dfn" href="#may-have-a-guest-browsing-context" id="ref-for-may-have-a-guest-browsing-context③">may not have a guest browsing context</a>, then abort these steps.</p>
     <li data-md>
      <p>If <var>element</var>’s <a data-link-type="dfn" href="#htmlportalelement-guest-browsing-context" id="ref-for-htmlportalelement-guest-browsing-context⑥">guest browsing context</a> is not null, then abort these steps.</p>
      <div class="note" role="note"> This ensures that a newly <a data-link-type="dfn" href="#adopt-the-predecessor-browsing-context" id="ref-for-adopt-the-predecessor-browsing-context③">adopted</a> <code><a data-link-type="element" href="#elementdef-portal" id="ref-for-elementdef-portal①⑦">portal</a></code> element can be inserted into the document without navigating
    it. </div>
     <li data-md>
      <p><a data-link-type="dfn" href="#set-the-source-url-of-a-portal-element" id="ref-for-set-the-source-url-of-a-portal-element②">Set the source URL</a> of <var>element</var>.</p>
    </ol>
    <p>Whenever a <code><a data-link-type="element" href="#elementdef-portal" id="ref-for-elementdef-portal①⑧">portal</a></code> element <var>element</var> <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#becomes-browsing-context-disconnected" id="ref-for-becomes-browsing-context-disconnected">becomes
  browsing-context connected</a>, run the following steps:</p>
    <ol>
     <li data-md>
      <p>If <var>element</var> <a data-link-type="dfn" href="#may-have-a-guest-browsing-context" id="ref-for-may-have-a-guest-browsing-context④">may not have a guest browsing context</a> and its <a data-link-type="dfn" href="#htmlportalelement-guest-browsing-context" id="ref-for-htmlportalelement-guest-browsing-context⑦">guest browsing context</a> is not null, then <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/window-object.html#a-browsing-context-is-discarded" id="ref-for-a-browsing-context-is-discarded④">discard</a> it.</p>
    </ol>
    <div class="issue" id="issue-833dc9f1"><a class="self-link" href="#issue-833dc9f1"></a> It might be convenient to not immediately detach the portal element, but instead to do so
    in a microtask. This would allow developers to reinsert the <code><a data-link-type="element" href="#elementdef-portal" id="ref-for-elementdef-portal①⑨">portal</a></code> element without losing
    its browsing context. </div>
    <p>Whenever a <code><a data-link-type="element" href="#elementdef-portal" id="ref-for-elementdef-portal②⓪">portal</a></code> element <var>element</var> is <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-node-adopt-ext" id="ref-for-concept-node-adopt-ext">adopted</a>, run the following steps:</p>
    <ol>
     <li data-md>
      <p>Let <var>guestBrowsingContext</var> be <var>element</var>’s <a data-link-type="dfn" href="#htmlportalelement-guest-browsing-context" id="ref-for-htmlportalelement-guest-browsing-context⑧">guest browsing context</a>.</p>
     <li data-md>
      <p>If <var>guestBrowsingContext</var> is null, then abort these steps.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/window-object.html#a-browsing-context-is-discarded" id="ref-for-a-browsing-context-is-discarded⑤">Discard</a> <var>guestBrowsingContext</var>.</p>
    </ol>
    <div class="note" role="note">
      In particular, this means a <code><a data-link-type="element" href="#elementdef-portal" id="ref-for-elementdef-portal②①">portal</a></code> element loses its <a data-link-type="dfn" href="#htmlportalelement-guest-browsing-context" id="ref-for-htmlportalelement-guest-browsing-context⑨">guest browsing
    context</a> if it is moved to the <a data-link-type="dfn">active document</a> of a <a data-link-type="dfn">nested browsing
    context</a>. 
     <p>Similarly, the steps when a <code><a data-link-type="element" href="#elementdef-portal" id="ref-for-elementdef-portal②②">portal</a></code> element’s <a data-link-type="dfn" href="#set-the-source-url-of-a-portal-element" id="ref-for-set-the-source-url-of-a-portal-element③">source URL is set</a> prevent
    elements from creating a new <a data-link-type="dfn" href="#htmlportalelement-guest-browsing-context" id="ref-for-htmlportalelement-guest-browsing-context①⓪">guest browsing context</a> while inside such
    documents.</p>
     <p>It is therefore impossible to embed a <a data-link-type="dfn" href="#portal-browsing-context" id="ref-for-portal-browsing-context⑧">portal browsing context</a> in a <a data-link-type="dfn">nested browsing context</a>.</p>
    </div>
    <p>Whenever a <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#document" id="ref-for-document②">Document</a></code> object <var>document</var> whose <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#concept-document-bc" id="ref-for-concept-document-bc①">browsing context</a> is a <a data-link-type="dfn" href="#portal-browsing-context" id="ref-for-portal-browsing-context⑨">portal browsing context</a> is marked as <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/parsing.html#completely-loaded" id="ref-for-completely-loaded">completely loaded</a>, run the following steps as part of
  the queued task:</p>
    <ol>
     <li data-md>
      <p>Let <var>element</var> be <var>document</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#concept-document-bc" id="ref-for-concept-document-bc②">browsing context</a>'s <a data-link-type="dfn" href="#host-element" id="ref-for-host-element⑧">host element</a>.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-event-fire" id="ref-for-concept-event-fire②">Fire an event</a> named <code class="idl"><a class="idl-code" data-link-type="event" href="https://html.spec.whatwg.org/multipage/indices.html#event-load" id="ref-for-event-load">load</a></code> at <var>element</var>.</p>
    </ol>
    <details class="wpt-tests-block" dir="ltr" lang="en" open>
     <summary>Tests</summary>
     <ul class="wpt-tests-list">
      <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/portals/portal-onload-event.html" title="portals/portal-onload-event.html">portal-onload-event.html</a> <a class="wpt-live" href="http://wpt.live/portals/portal-onload-event.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/portals/portal-onload-event.html"><small>(source)</small></a>
      <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/portals/portals-cross-origin-load.sub.html" title="portals/portals-cross-origin-load.sub.html">portals-cross-origin-load.sub.html</a> <a class="wpt-live" href="http://wpt.live/portals/portals-cross-origin-load.sub.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/portals/portals-cross-origin-load.sub.html"><small>(source)</small></a>
     </ul>
    </details>
    <section class="algorithm" data-algorithm="htmlportalelement-activation-behavior">
      A <code><a data-link-type="element" href="#elementdef-portal" id="ref-for-elementdef-portal②③">portal</a></code> element <var>el</var>’s <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#eventtarget-activation-behavior" id="ref-for-eventtarget-activation-behavior">activation behavior</a> is to run the following steps: 
     <ol>
      <li data-md>
       <p>Let <var>portalBrowsingContext</var> be the <a data-link-type="dfn" href="#htmlportalelement-guest-browsing-context" id="ref-for-htmlportalelement-guest-browsing-context①①">guest browsing context</a> of <var>el</var>.</p>
      <li data-md>
       <p>If <var>portalBrowsingContext</var> is null, return.</p>
      <li data-md>
       <p>Let <var>predecessorBrowsingContext</var> be the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#concept-document-bc" id="ref-for-concept-document-bc③">browsing context</a> of <var>el</var>’s <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-node-document" id="ref-for-concept-node-document⑥">node
document</a>.</p>
      <li data-md>
       <p>If <var>predecessorBrowsingContext</var> is null, return.</p>
      <li data-md>
       <p>If the <a data-link-type="dfn" href="#portal-state" id="ref-for-portal-state①①">portal state</a> of <var>predecessorBrowsingContext</var> is not "<code>none</code>", return.</p>
      <li data-md>
       <p>Let <var>sourceOrigin</var> be <var>el</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object" id="ref-for-relevant-settings-object②">relevant settings object</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin" id="ref-for-concept-settings-object-origin②">origin</a>.</p>
      <li data-md>
       <p>Run the steps to <a data-link-type="dfn" href="#activate-a-portal-browsing-context" id="ref-for-activate-a-portal-browsing-context③">activate</a> <var>portalBrowsingContext</var> in place of <var>predecessorBrowsingContext</var> with <var>sourceOrigin</var>.</p>
     </ol>
     <div class="note" role="note"> This is substantially similar to the steps in <code class="idl"><a data-link-type="idl" href="#dom-htmlportalelement-activate" id="ref-for-dom-htmlportalelement-activate③">activate(options)</a></code>, with default options.
      User agents might wish to display suitable console messages under the same conditions that would
      result in promise rejection in those steps. </div>
    </section>
    <p>The following events are dispatched on <code class="idl"><a data-link-type="idl" href="#htmlportalelement" id="ref-for-htmlportalelement①">HTMLPortalElement</a></code> objects:</p>
    <table class="data">
     <thead>
      <tr>
       <th>Event name
       <th>Interface
       <th>Dispatched when
     <tbody>
      <tr>
       <td><dfn class="dfn-paneled idl-code" data-dfn-for="HTMLPortalElement" data-dfn-type="event" data-export id="eventdef-htmlportalelement-message"><code>message</code></dfn>
       <td><code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/comms.html#messageevent" id="ref-for-messageevent②">MessageEvent</a></code>
       <td>A message is received by the object, and deserialization does not throw an exception.
      <tr>
       <td><dfn class="dfn-paneled idl-code" data-dfn-for="HTMLPortalElement" data-dfn-type="event" data-export id="eventdef-htmlportalelement-messageerror"><code>messageerror</code></dfn>
       <td><code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/comms.html#messageevent" id="ref-for-messageevent③">MessageEvent</a></code>
       <td>A message is received by the object, but deserialization throws an exception.
    </table>
    <p>The <code><a data-link-type="element" href="#elementdef-portal" id="ref-for-elementdef-portal②④">portal</a></code> element exposes <code class="idl"><a data-link-type="idl" href="#dom-htmlportalelement-onmessage" id="ref-for-dom-htmlportalelement-onmessage">onmessage</a></code> and <code class="idl"><a data-link-type="idl" href="#dom-htmlportalelement-onmessageerror" id="ref-for-dom-htmlportalelement-onmessageerror">onmessageerror</a></code> as <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#event-handler-content-attributes" id="ref-for-event-handler-content-attributes">event handler content attributes</a>.</p>
    <details class="wpt-tests-block" dir="ltr" lang="en" open>
     <summary>Tests</summary>
     <ul class="wpt-tests-list">
      <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/portals/htmlportalelement-event-handler-content-attributes.html" title="portals/htmlportalelement-event-handler-content-attributes.html">htmlportalelement-event-handler-content-attributes.html</a> <a class="wpt-live" href="http://wpt.live/portals/htmlportalelement-event-handler-content-attributes.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/portals/htmlportalelement-event-handler-content-attributes.html"><small>(source)</small></a>
     </ul>
    </details>
    <h3 class="heading settled" data-level="3.1" id="the-portalhost-interface"><span class="secno">3.1. </span><span class="content">Portal hosts</span><a class="self-link" href="#the-portalhost-interface"></a></h3>
    <p>Every <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#window" id="ref-for-window">Window</a></code> has a <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="portal-host-object">portal host object</dfn>, which is a <code class="idl"><a data-link-type="idl" href="#portalhost" id="ref-for-portalhost①">PortalHost</a></code>. It is exposed
  through the <code class="idl"><a data-link-type="idl" href="#dom-window-portalhost" id="ref-for-dom-window-portalhost">portalHost</a></code> attribute getter at times when the window may be in a <a data-link-type="dfn" href="#portal-browsing-context" id="ref-for-portal-browsing-context①⓪">portal browsing context</a>.</p>
    <div class="note" role="note"> The <a data-link-type="dfn" href="#portal-host-object" id="ref-for-portal-host-object①">portal host object</a> can be used to communicate with the <a data-link-type="dfn" href="#host-browsing-context" id="ref-for-host-browsing-context②">host browsing context</a>. Its
    operations throw if used while its context is not a <a data-link-type="dfn" href="#portal-browsing-context" id="ref-for-portal-browsing-context①①">portal browsing context</a> (i.e. there is
    no host), in the event that JavaScript code has saved a reference to it. At such times, the <code class="idl"><a data-link-type="idl" href="#dom-window-portalhost" id="ref-for-dom-window-portalhost①">window.portalHost</a></code> getter will return null. </div>
<pre class="idl highlight def"><c- b>partial</c-> <c- b>interface</c-> <a class="idl-code" data-link-type="interface" href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#window" id="ref-for-window①"><c- g>Window</c-></a> {
    <c- b>readonly</c-> <c- b>attribute</c-> <a data-link-type="idl-name" href="#portalhost" id="ref-for-portalhost②"><c- n>PortalHost</c-></a>? <a class="idl-code" data-link-type="attribute" data-readonly data-type="PortalHost?" href="#dom-window-portalhost" id="ref-for-dom-window-portalhost②"><c- g>portalHost</c-></a>;
};
</pre>
    <section class="algorithm" data-algorithm="window-portalhost">
      The <dfn class="dfn-paneled idl-code" data-dfn-for="Window" data-dfn-type="attribute" data-export id="dom-window-portalhost"><code>portalHost</code></dfn> attribute’s getter <em>must</em> run the following steps: 
     <ol>
      <li data-md>
       <p>Let <var>context</var> be <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this⑤">this</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#window-bc" id="ref-for-window-bc">browsing context</a>.</p>
      <li data-md>
       <p>If <var>context</var> is null or the <a data-link-type="dfn" href="#portal-state" id="ref-for-portal-state①②">portal state</a> of <var>context</var> is not "<code>portal</code>", then return null.</p>
      <li data-md>
       <p>Return <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this⑥">this</a>'s <a data-link-type="dfn" href="#portal-host-object" id="ref-for-portal-host-object②">portal host object</a>.</p>
     </ol>
    </section>
    <details class="wpt-tests-block" dir="ltr" lang="en" open>
     <summary>Tests</summary>
     <ul class="wpt-tests-list">
      <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/portals/portals-host-exposure.sub.html" title="portals/portals-host-exposure.sub.html">portals-host-exposure.sub.html</a> <a class="wpt-live" href="http://wpt.live/portals/portals-host-exposure.sub.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/portals/portals-host-exposure.sub.html"><small>(source)</small></a>
      <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/portals/portals-host-null.html" title="portals/portals-host-null.html">portals-host-null.html</a> <a class="wpt-live" href="http://wpt.live/portals/portals-host-null.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/portals/portals-host-null.html"><small>(source)</small></a>
     </ul>
    </details>
    <hr>
    <p>The <code class="idl"><a data-link-type="idl" href="#portalhost" id="ref-for-portalhost③">PortalHost</a></code> interface definition is as follows:</p>
<pre class="idl highlight def">[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed" id="ref-for-Exposed①"><c- g>Exposed</c-></a>=<c- n>Window</c->]
<c- b>interface</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="interface" data-export id="portalhost"><code><c- g>PortalHost</c-></code></dfn> : <a data-link-type="idl-name" href="https://dom.spec.whatwg.org/#eventtarget" id="ref-for-eventtarget"><c- n>EventTarget</c-></a> {
    <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-undefined" id="ref-for-idl-undefined②"><c- b>undefined</c-></a> <a class="idl-code" data-link-type="method" href="#dom-portalhost-postmessage" id="ref-for-dom-portalhost-postmessage"><c- g>postMessage</c-></a>(<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-any" id="ref-for-idl-any②"><c- b>any</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="PortalHost/postMessage(message, options), PortalHost/postMessage(message)" data-dfn-type="argument" data-export id="dom-portalhost-postmessage-message-options-message"><code><c- g>message</c-></code></dfn>, <c- b>optional</c-> <a data-link-type="idl-name"><c- n>PostMessageOptions</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="PortalHost/postMessage(message, options), PortalHost/postMessage(message)" data-dfn-type="argument" data-export id="dom-portalhost-postmessage-message-options-options"><code><c- g>options</c-></code></dfn> = {});

    <c- b>attribute</c-> <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler" id="ref-for-eventhandler②"><c- n>EventHandler</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="PortalHost" data-dfn-type="attribute" data-export data-type="EventHandler" id="dom-portalhost-onmessage"><code><c- g>onmessage</c-></code></dfn>;
    <c- b>attribute</c-> <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler" id="ref-for-eventhandler③"><c- n>EventHandler</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="PortalHost" data-dfn-type="attribute" data-export data-type="EventHandler" id="dom-portalhost-onmessageerror"><code><c- g>onmessageerror</c-></code></dfn>;
};
</pre>
    <section class="algorithm" data-algorithm="portalhost-postmessage">
      The <dfn class="dfn-paneled idl-code" data-dfn-for="PortalHost" data-dfn-type="method" data-export data-lt="postMessage(message, options)|postMessage(message)" id="dom-portalhost-postmessage"><code>postMessage(<var>message</var>, <var>options</var>)</code></dfn> method <em>must</em> run these steps: 
     <ol>
      <li data-md>
       <p>Let <var>browsingContext</var> be <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this⑦">this</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global" id="ref-for-concept-relevant-global">relevant global object</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#window-bc" id="ref-for-window-bc①">browsing context</a>.</p>
      <li data-md>
       <p>If <var>browsingContext</var> has a <a data-link-type="dfn" href="#portal-state" id="ref-for-portal-state①③">portal state</a> other than "<code>portal</code>", throw an "<code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#invalidstateerror" id="ref-for-invalidstateerror⑤">InvalidStateError</a></code>" <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException⑤">DOMException</a></code>.</p>
       <p class="note" role="note"><span class="marker">Note:</span> This roughly means that it has not yet been activated, as far as this <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#event-loop" id="ref-for-event-loop">event loop</a> has been told.
It is possible that this browsing context will be <a data-link-type="dfn" href="#activate-a-portal-browsing-context" id="ref-for-activate-a-portal-browsing-context④">activated</a> in parallel
to this message being sent; in such cases, messages may not be delivered.</p>
      <li data-md>
       <p>Let <var>sourceOrigin</var> be <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this⑧">this</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object" id="ref-for-relevant-settings-object③">relevant settings object</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin" id="ref-for-concept-settings-object-origin③">origin</a>.</p>
      <li data-md>
       <p>Let <var>transfer</var> be <var>options</var>["<code class="idl"><a data-link-type="idl">transfer</a></code>"].</p>
      <li data-md>
       <p>Let <var>serializeWithTransferResult</var> be <a data-link-type="abstract-op" href="https://html.spec.whatwg.org/multipage/structured-data.html#structuredserializewithtransfer" id="ref-for-structuredserializewithtransfer②">StructuredSerializeWithTransfer</a>(<var>message</var>, <var>transfer</var>). Rethrow any exceptions.</p>
      <li data-md>
       <p>Let <var>hostElement</var> be the <a data-link-type="dfn" href="#host-element" id="ref-for-host-element⑨">host element</a> of <var>browsingContext</var>.</p>
      <li data-md>
       <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-an-element-task" id="ref-for-queue-an-element-task">Queue an element task</a> on the <a data-link-type="dfn" href="#portal-task-source" id="ref-for-portal-task-source⑤">portal task source</a> given <var>hostElement</var> to run the following steps:</p>
       <ol>
        <li data-md>
         <p>If <var>browsingContext</var> is not the <a data-link-type="dfn" href="#htmlportalelement-guest-browsing-context" id="ref-for-htmlportalelement-guest-browsing-context①②">guest browsing context</a> of <var>hostElement</var>, then abort these steps.</p>
         <p class="note" role="note"><span class="marker">Note:</span> This might happen if this <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#event-loop" id="ref-for-event-loop①">event loop</a> had a queued task to deliver a message, but
it was not executed before the portal was <a data-link-type="dfn" href="#activate-a-portal-browsing-context" id="ref-for-activate-a-portal-browsing-context⑤">activated</a>.
In such cases, the message is not delivered.</p>
        <li data-md>
         <p>Let <var>targetSettings</var> be the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object" id="ref-for-relevant-settings-object④">relevant settings object</a> of <var>hostElement</var>.</p>
        <li data-md>
         <p>If <var>targetSettings</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin" id="ref-for-concept-settings-object-origin④">origin</a> is not <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#same-origin" id="ref-for-same-origin②">same origin</a> with <var>sourceOrigin</var>, then abort these steps.</p>
        <li data-md>
         <p>Let <var>origin</var> be the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#ascii-serialisation-of-an-origin" id="ref-for-ascii-serialisation-of-an-origin①">serialization</a> of <var>sourceOrigin</var>.</p>
        <li data-md>
         <p>Let <var>targetRealm</var> be <var>targetSettings</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object&apos;s-realm" id="ref-for-environment-settings-object&apos;s-realm">realm</a>.</p>
        <li data-md>
         <p>Let <var>deserializeRecord</var> be <a data-link-type="abstract-op" href="https://html.spec.whatwg.org/multipage/structured-data.html#structureddeserializewithtransfer" id="ref-for-structureddeserializewithtransfer②">StructuredDeserializeWithTransfer</a>(<var>serializeWithTransferResult</var>, <var>targetRealm</var>).</p>
         <p>If this throws an exception, catch it, <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-event-fire" id="ref-for-concept-event-fire③">fire an event</a> named <code class="idl"><a class="idl-code" data-link-type="event" href="#eventdef-htmlportalelement-messageerror" id="ref-for-eventdef-htmlportalelement-messageerror">messageerror</a></code> at <var>element</var> using <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/comms.html#messageevent" id="ref-for-messageevent④">MessageEvent</a></code> with the <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/comms.html#dom-messageevent-origin" id="ref-for-dom-messageevent-origin②">origin</a></code> attribute initialized to <var>origin</var> and the <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/comms.html#dom-messageevent-source" id="ref-for-dom-messageevent-source②">source</a></code> attribute initialized to <var>element</var>.</p>
        <li data-md>
         <p>Let <var>messageClone</var> be <var>deserializeRecord</var>.[[Deserialized]].</p>
        <li data-md>
         <p>Let <var>newPorts</var> be a new <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#dfn-frozen-array-type" id="ref-for-dfn-frozen-array-type①">frozen array</a> consisting of all <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/web-messaging.html#messageport" id="ref-for-messageport①">MessagePort</a></code> objects in <var>deserializeRecord</var>.[[TransferredValues]], if any, maintaining their relative order.</p>
        <li data-md>
         <p><a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-event-fire" id="ref-for-concept-event-fire④">Fire an event</a> named <code class="idl"><a class="idl-code" data-link-type="event" href="#eventdef-htmlportalelement-message" id="ref-for-eventdef-htmlportalelement-message">message</a></code> at the <var>element</var> using <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/comms.html#messageevent" id="ref-for-messageevent⑤">MessageEvent</a></code>, with the <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/comms.html#dom-messageevent-origin" id="ref-for-dom-messageevent-origin③">origin</a></code> attribute
initialized to <var>origin</var>, the <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/comms.html#dom-messageevent-source" id="ref-for-dom-messageevent-source③">source</a></code> attribute initialized to <var>element</var>, the <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/comms.html#dom-messageevent-data" id="ref-for-dom-messageevent-data①">data</a></code> attribute
initialized to <var>messageClone</var>, and the <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/comms.html#dom-messageevent-ports" id="ref-for-dom-messageevent-ports①">ports</a></code> attribute initialized to <var>newPorts</var>.</p>
       </ol>
     </ol>
    </section>
    <details class="wpt-tests-block" dir="ltr" lang="en" open>
     <summary>Tests</summary>
     <ul class="wpt-tests-list">
      <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/portals/portals-host-post-message.sub.html" title="portals/portals-host-post-message.sub.html">portals-host-post-message.sub.html</a> <a class="wpt-live" href="http://wpt.live/portals/portals-host-post-message.sub.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/portals/portals-host-post-message.sub.html"><small>(source)</small></a>
     </ul>
    </details>
    <p>The following events are dispatched on <code class="idl"><a data-link-type="idl" href="#portalhost" id="ref-for-portalhost④">PortalHost</a></code> objects:</p>
    <table class="data">
     <thead>
      <tr>
       <th>Event name
       <th>Interface
       <th>Dispatched when
     <tbody>
      <tr>
       <td><dfn class="dfn-paneled idl-code" data-dfn-for="PortalHost" data-dfn-type="event" data-export id="eventdef-portalhost-message"><code>message</code></dfn>
       <td><code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/comms.html#messageevent" id="ref-for-messageevent⑥">MessageEvent</a></code>
       <td>A message is received by the object, and deserialization does not throw an exception.
      <tr>
       <td><dfn class="dfn-paneled idl-code" data-dfn-for="PortalHost" data-dfn-type="event" data-export id="eventdef-portalhost-messageerror"><code>messageerror</code></dfn>
       <td><code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/comms.html#messageevent" id="ref-for-messageevent⑦">MessageEvent</a></code>
       <td>A message is received by the object, but deserialization throws an exception.
    </table>
    <h3 class="heading settled" data-level="3.2" id="the-portalactivateevent-interface"><span class="secno">3.2. </span><span class="content">The <code>PortalActivateEvent</code> interface</span><a class="self-link" href="#the-portalactivateevent-interface"></a></h3>
<pre class="idl highlight def">[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed" id="ref-for-Exposed②"><c- g>Exposed</c-></a>=<c- n>Window</c->]
<c- b>interface</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="interface" data-export id="portalactivateevent"><code><c- g>PortalActivateEvent</c-></code></dfn> : <a data-link-type="idl-name" href="https://dom.spec.whatwg.org/#event" id="ref-for-event"><c- n>Event</c-></a> {
    <dfn class="dfn-paneled idl-code" data-dfn-for="PortalActivateEvent" data-dfn-type="constructor" data-export data-lt="PortalActivateEvent(type, eventInitDict)|constructor(type, eventInitDict)|PortalActivateEvent(type)|constructor(type)" id="dom-portalactivateevent-portalactivateevent"><code><c- g>constructor</c-></code></dfn>(<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString" id="ref-for-idl-DOMString①"><c- b>DOMString</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="PortalActivateEvent/PortalActivateEvent(type, eventInitDict), PortalActivateEvent/constructor(type, eventInitDict), PortalActivateEvent/PortalActivateEvent(type), PortalActivateEvent/constructor(type)" data-dfn-type="argument" data-export id="dom-portalactivateevent-portalactivateevent-type-eventinitdict-type"><code><c- g>type</c-></code></dfn>, <c- b>optional</c-> <a data-link-type="idl-name" href="#dictdef-portalactivateeventinit" id="ref-for-dictdef-portalactivateeventinit"><c- n>PortalActivateEventInit</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="PortalActivateEvent/PortalActivateEvent(type, eventInitDict), PortalActivateEvent/constructor(type, eventInitDict), PortalActivateEvent/PortalActivateEvent(type), PortalActivateEvent/constructor(type)" data-dfn-type="argument" data-export id="dom-portalactivateevent-portalactivateevent-type-eventinitdict-eventinitdict"><code><c- g>eventInitDict</c-></code></dfn> = {});

    <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-any" id="ref-for-idl-any③"><c- b>any</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="PortalActivateEvent" data-dfn-type="attribute" data-export data-readonly data-type="any" id="dom-portalactivateevent-data"><code><c- g>data</c-></code></dfn>;
    <a data-link-type="idl-name" href="#htmlportalelement" id="ref-for-htmlportalelement②"><c- n>HTMLPortalElement</c-></a> <a class="idl-code" data-link-type="method" href="#dom-portalactivateevent-adoptpredecessor" id="ref-for-dom-portalactivateevent-adoptpredecessor②"><c- g>adoptPredecessor</c-></a>();
};

<c- b>dictionary</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="dictionary" data-export id="dictdef-portalactivateeventinit"><code><c- g>PortalActivateEventInit</c-></code></dfn> : <a data-link-type="idl-name" href="https://dom.spec.whatwg.org/#dictdef-eventinit" id="ref-for-dictdef-eventinit"><c- n>EventInit</c-></a> {
    <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-any" id="ref-for-idl-any④"><c- b>any</c-></a> <dfn class="dfn-paneled idl-code" data-default="null" data-dfn-for="PortalActivateEventInit" data-dfn-type="dict-member" data-export data-type="any" id="dom-portalactivateeventinit-data"><code><c- g>data</c-></code></dfn> = <c- b>null</c->;
};
</pre>
    <div class="note" role="note"> For now, there is no <code>ports</code> attribute on <code class="idl"><a data-link-type="idl" href="#portalactivateevent" id="ref-for-portalactivateevent①">PortalActivateEvent</a></code>, despite it being
    used for data transfer in a similar way to <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/comms.html#messageevent" id="ref-for-messageevent⑧">MessageEvent</a></code>. This omission is for simplicity,
    and could be reconsidered if a use case is found. (See also <a href="https://github.com/whatwg/html/issues/4521">whatwg/html#4521</a> for a potential
    expansion.) </div>
    <p>A <code class="idl"><a data-link-type="idl" href="#portalactivateevent" id="ref-for-portalactivateevent②">PortalActivateEvent</a></code> has an associated <dfn class="dfn-paneled" data-dfn-for="PortalActivateEvent" data-dfn-type="dfn" data-noexport id="portalactivateevent-predecessor-browsing-context">predecessor browsing context</dfn>,
  which is a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#top-level-browsing-context" id="ref-for-top-level-browsing-context③">top-level browsing context</a> or null, a <dfn class="dfn-paneled" data-dfn-for="PortalActivateEvent" data-dfn-type="dfn" data-noexport id="portalactivateevent-successor-window">successor window</dfn>, which is
  a <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#window" id="ref-for-window②">Window</a></code>, an <dfn class="dfn-paneled" data-dfn-for="PortalActivateEvent" data-dfn-type="dfn" data-noexport id="portalactivateevent-activation-promise">activation promise</dfn>, which is a <a data-link-type="dfn" href="http://tc39.github.io/ecma262/#sec-promise-objects" id="ref-for-sec-promise-objects①">promise</a> or null, and a <dfn class="dfn-paneled" data-dfn-for="PortalActivateEvent" data-dfn-type="dfn" data-noexport id="portalactivateevent-adopted-predecessor-element">adopted predecessor element</dfn>, which is a <code><a data-link-type="element" href="#elementdef-portal" id="ref-for-elementdef-portal②⑤">portal</a></code> element or null.</p>
    <section class="algorithm" data-algorithm="portalactivateevent-event-constructing-steps">
      The <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-event-constructor-ext" id="ref-for-concept-event-constructor-ext">event constructing steps</a> for <code class="idl"><a data-link-type="idl" href="#portalactivateevent" id="ref-for-portalactivateevent③">PortalActivateEvent</a></code>, given an <var>event</var>, are as follows: 
     <ol>
      <li data-md>
       <p>Set <var>event</var>’s <a data-link-type="dfn" href="#portalactivateevent-predecessor-browsing-context" id="ref-for-portalactivateevent-predecessor-browsing-context①">predecessor browsing context</a> to null.</p>
      <li data-md>
       <p>Set <var>event</var>’s <a data-link-type="dfn" href="#portalactivateevent-successor-window" id="ref-for-portalactivateevent-successor-window①">successor window</a> to null.</p>
      <li data-md>
       <p>Set <var>event</var>’s <a data-link-type="dfn" href="#portalactivateevent-adopted-predecessor-element" id="ref-for-portalactivateevent-adopted-predecessor-element①">adopted predecessor element</a> to null.</p>
     </ol>
    </section>
    <details class="wpt-tests-block" dir="ltr" lang="en" open>
     <summary>Tests</summary>
     <ul class="wpt-tests-list">
      <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/portals/portal-activate-event-constructor.html" title="portals/portal-activate-event-constructor.html">portal-activate-event-constructor.html</a> <a class="wpt-live" href="http://wpt.live/portals/portal-activate-event-constructor.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/portals/portal-activate-event-constructor.html"><small>(source)</small></a>
     </ul>
    </details>
    <section class="algorithm" data-algorithm="portalactivateevent-adoptpredecessor">
      The <dfn class="dfn-paneled idl-code" data-dfn-for="PortalActivateEvent" data-dfn-type="method" data-export id="dom-portalactivateevent-adoptpredecessor"><code>adoptPredecessor()</code></dfn> method <em>must</em> run these steps: 
     <ol>
      <li data-md>
       <p>If <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this⑨">this</a>'s <a data-link-type="dfn" href="#portalactivateevent-adopted-predecessor-element" id="ref-for-portalactivateevent-adopted-predecessor-element②">adopted predecessor element</a> is not null, throw an "<code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#invalidstateerror" id="ref-for-invalidstateerror⑥">InvalidStateError</a></code>" <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException⑥">DOMException</a></code>.</p>
      <li data-md>
       <p>Let <var>predecessorBrowsingContext</var> be <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this①⓪">this</a>'s <a data-link-type="dfn" href="#portalactivateevent-predecessor-browsing-context" id="ref-for-portalactivateevent-predecessor-browsing-context②">predecessor browsing context</a>.</p>
      <li data-md>
       <p>Let <var>successorWindow</var> be <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this①①">this</a>'s <a data-link-type="dfn" href="#portalactivateevent-successor-window" id="ref-for-portalactivateevent-successor-window②">successor window</a>.</p>
      <li data-md>
       <p>Run the steps to <a data-link-type="dfn" href="#adopt-the-predecessor-browsing-context" id="ref-for-adopt-the-predecessor-browsing-context④">adopt the predecessor browsing context</a> <var>predecessorBrowsingContext</var> in <var>successorWindow</var>,
and let <var>adoptedPredecessorElement</var> be the result.</p>
      <li data-md>
       <p>Set <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this①②">this</a>'s <a data-link-type="dfn" href="#portalactivateevent-adopted-predecessor-element" id="ref-for-portalactivateevent-adopted-predecessor-element③">adopted predecessor element</a> to <var>adoptedPredecessorElement</var>.</p>
      <li data-md>
       <p>If <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this①③">this</a>'s <a data-link-type="dfn" href="#portalactivateevent-activation-promise" id="ref-for-portalactivateevent-activation-promise②">activation promise</a> is not null, <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task" id="ref-for-queue-a-global-task⑤">queue a global task</a> on the <a data-link-type="dfn" href="#portal-task-source" id="ref-for-portal-task-source⑥">portal task source</a> given <var>predecessorBrowsingContext</var>’s <a data-link-type="dfn">active window</a> to resolve it with undefined.</p>
       <p class="note" role="note"><span class="marker">Note:</span> Queuing this immediately makes it possible to send messages to the adopted
portal during dispatch of the <code class="idl"><a class="idl-code" data-link-type="event" href="#eventdef-window-portalactivate" id="ref-for-eventdef-window-portalactivate③">portalactivate</a></code> event without
ordering issues between the task to resolve the activation promise and the task
to deliver the message.</p>
      <li data-md>
       <p>Return <var>adoptedPredecessorElement</var>.</p>
     </ol>
     <details class="wpt-tests-block" dir="ltr" lang="en" open>
      <summary>Tests</summary>
      <ul class="wpt-tests-list">
       <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/portals/portals-adopt-predecessor.html" title="portals/portals-adopt-predecessor.html">portals-adopt-predecessor.html</a> <a class="wpt-live" href="http://wpt.live/portals/portals-adopt-predecessor.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/portals/portals-adopt-predecessor.html"><small>(source)</small></a>
      </ul>
     </details>
    </section>
   </section>
   <section>
    <h2 class="heading settled" data-level="4" id="miscellaneous-extensions"><span class="secno">4. </span><span class="content">Miscellaneous HTML updates</span><a class="self-link" href="#miscellaneous-extensions"></a></h2>
    <p><em>This section contains various small patches to miscellaneous areas of the HTML Standard.</em></p>
    <h3 class="heading settled" data-level="4.1" id="patch-messageevent"><span class="secno">4.1. </span><span class="content">The <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/comms.html#messageevent" id="ref-for-messageevent⑨">MessageEvent</a></code> interface</span><a class="self-link" href="#patch-messageevent"></a></h3>
    <p>The <code class="idl"><a data-link-type="idl" href="#typedefdef-messageeventsource" id="ref-for-typedefdef-messageeventsource">MessageEventSource</a></code> union is extended to include the new interfaces
  which can produce <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/comms.html#messageevent" id="ref-for-messageevent①⓪">MessageEvent</a></code> events.</p>
<pre class="idl highlight def"><c- b>typedef</c-> (<a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#windowproxy" id="ref-for-windowproxy②"><c- n>WindowProxy</c-></a> <c- b>or</c-> <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/web-messaging.html#messageport" id="ref-for-messageport②"><c- n>MessagePort</c-></a> <c- b>or</c-> <a data-link-type="idl-name" href="https://w3c.github.io/ServiceWorker/#serviceworker" id="ref-for-serviceworker"><c- n>ServiceWorker</c-></a> <c- b>or</c-> <a data-link-type="idl-name" href="#htmlportalelement" id="ref-for-htmlportalelement③"><c- n>HTMLPortalElement</c-></a> <c- b>or</c-> <a data-link-type="idl-name" href="#portalhost" id="ref-for-portalhost⑤"><c- n>PortalHost</c-></a>) <dfn class="dfn-paneled idl-code" data-dfn-type="typedef" data-export id="typedefdef-messageeventsource"><code><c- g>MessageEventSource</c-></code></dfn>;
</pre>
    <h3 class="heading settled" data-level="4.2" id="patch-event-handlers"><span class="secno">4.2. </span><span class="content">Event handlers</span><a class="self-link" href="#patch-event-handlers"></a></h3>
    <p>The table of <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#event-handlers" id="ref-for-event-handlers">event handlers</a> which must be supported by <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#window" id="ref-for-window③">Window</a></code> objects, as <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#event-handler-idl-attributes" id="ref-for-event-handler-idl-attributes">event handler
  IDL attributes</a> on the <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#window" id="ref-for-window④">Window</a></code> objects themselves (i.e. the table containing <code>onafterprint</code>),
  gets extended with the following row:</p>
    <table class="data">
     <thead>
      <tr>
       <th><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#event-handlers" id="ref-for-event-handlers①">Event handler</a>
       <th><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#event-handler-event-type" id="ref-for-event-handler-event-type">Event handler event type</a>
     <tbody>
      <tr>
       <td><dfn class="dfn-paneled idl-code" data-dfn-for="Window" data-dfn-type="attribute" data-export id="dom-window-onportalactivate"><code>onportalactivate</code></dfn>
       <td><code class="idl"><a data-link-type="idl" href="#eventdef-window-portalactivate" id="ref-for-eventdef-window-portalactivate④">portalactivate</a></code>
    </table>
    <p>The corresponding <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/webappapis.html#windoweventhandlers" id="ref-for-windoweventhandlers">WindowEventHandlers</a></code> mixin gets extended as follows:</p>
<pre class="idl highlight def"><c- b>partial</c-> <c- b>interface</c-> <c- b>mixin</c-> <a class="idl-code" data-link-type="interface" href="https://html.spec.whatwg.org/multipage/webappapis.html#windoweventhandlers" id="ref-for-windoweventhandlers①"><c- g>WindowEventHandlers</c-></a> {
    <c- b>attribute</c-> <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler" id="ref-for-eventhandler④"><c- n>EventHandler</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="WindowEventHandlers" data-dfn-type="attribute" data-export data-type="EventHandler" id="dom-windoweventhandlers-onportalactivate"><code><c- g>onportalactivate</c-></code></dfn>;
};
</pre>
    <p>The <a href="https://html.spec.whatwg.org/#events-2">Events index</a> is also updated with the
  following additional row:</p>
    <table class="data">
     <thead>
      <tr>
       <th>Event
       <th>Interface
       <th>Interesting targets
       <th>Description
     <tbody>
      <tr>
       <td><dfn class="dfn-paneled idl-code" data-dfn-for="Window" data-dfn-type="event" data-export id="eventdef-window-portalactivate"><code>portalactivate</code></dfn>
       <td><code class="idl"><a data-link-type="idl" href="#portalactivateevent" id="ref-for-portalactivateevent④">PortalActivateEvent</a></code>
       <td><code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#window" id="ref-for-window⑤">Window</a></code>
       <td>Fired at the <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#window" id="ref-for-window⑥">Window</a></code> of a <a data-link-type="dfn" href="#portal-browsing-context" id="ref-for-portal-browsing-context①②">portal browsing context</a> when that <a data-link-type="dfn" href="#portal-browsing-context" id="ref-for-portal-browsing-context①③">portal browsing
        context</a> is activated.
    </table>
    <h3 class="heading settled" data-level="4.3" id="patch-window-apis"><span class="secno">4.3. </span><span class="content">APIs for creating and navigating browsing contexts by name</span><a class="self-link" href="#patch-window-apis"></a></h3>
    <p>Modify the definition of <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#script-closable" id="ref-for-script-closable">script-closable</a> to prevent window closing while in a <a data-link-type="dfn" href="#portal-browsing-context" id="ref-for-portal-browsing-context①④">portal browsing context</a>:</p>
    <p>A <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#browsing-context" id="ref-for-browsing-context⑤">browsing context</a> is <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="script-closable">script-closable</dfn> if either of the following is true:</p>
    <ul>
     <li data-md>
      <p>it is an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#auxiliary-browsing-context" id="ref-for-auxiliary-browsing-context①">auxiliary browsing context</a> that was created by script (as opposed to by an action
of the user); or</p>
     <li data-md>
      <p>
       it is a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#top-level-browsing-context" id="ref-for-top-level-browsing-context④">top-level browsing context</a> 
       <ins>whose <a data-link-type="dfn" href="#portal-state" id="ref-for-portal-state①④">portal state</a> is "<code>none</code>"</ins>
        and whose <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/history.html#session-history" id="ref-for-session-history②">session history</a> contains only one <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#document" id="ref-for-document③">Document</a></code>.
      </p>
    </ul>
    <details class="wpt-tests-block" dir="ltr" lang="en" open>
     <summary>Tests</summary>
     <ul class="wpt-tests-list">
      <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/portals/portals-close-window.html" title="portals/portals-close-window.html">portals-close-window.html</a> <a class="wpt-live" href="http://wpt.live/portals/portals-close-window.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/portals/portals-close-window.html"><small>(source)</small></a>
     </ul>
    </details>
    <h3 class="heading settled" data-level="4.4" id="patch-navigation"><span class="secno">4.4. </span><span class="content">Navigation</span><a class="self-link" href="#patch-navigation"></a></h3>
    <p>Patch the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#navigate" id="ref-for-navigate②">navigate</a> algorithm to prevent certain navigations in a
  portal as follows:</p>
    <div class="algorithm" data-algorithm="process a navigate response patch">
      In <a data-link-type="dfn">process a navigate response</a>, append the following after the step which
    establishes the value of <var>failure</var>, but before the step which uses it to display an error page: 
     <ol>
      <li data-md>
       <p>If <var>browsingContext</var>’s <a data-link-type="dfn" href="#portal-state" id="ref-for-portal-state①⑤">portal state</a> is not "<code>none</code>", and any of the following hold:</p>
       <ul>
        <li data-md>
         <p><var>failure</var> is true;</p>
        <li data-md>
         <p><var>navigationParams</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#navigation-params-request" id="ref-for-navigation-params-request">request</a> is null;</p>
        <li data-md>
         <p><var>navigationParams</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#navigation-params-request" id="ref-for-navigation-params-request①">request</a>'s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-current-url" id="ref-for-concept-request-current-url">current URL</a>'s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-scheme" id="ref-for-concept-url-scheme①">scheme</a> is not a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#http-scheme" id="ref-for-http-scheme②">HTTP(S) scheme</a>;</p>
        <li data-md>
         <p><var>response</var> has a `<code>Content-Disposition</code>` header specifying the <code>attachment</code> disposition type; or</p>
        <li data-md>
         <p><var>response</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-status" id="ref-for-concept-response-status">status</a> is 204 or 205,</p>
       </ul>
       <p>then:</p>
       <ol>
        <li data-md>
         <p>If <var>browsingContext</var>’s only entry in its <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/history.html#session-history" id="ref-for-session-history③">session history</a> is the initial <code>about:blank</code> <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#document" id="ref-for-document④">Document</a></code>, then:</p>
         <ol>
          <li data-md>
           <p><a data-link-type="dfn" href="#close-a-portal-element" id="ref-for-close-a-portal-element①">Close</a> <var>browsingContext</var>’s <a data-link-type="dfn" href="#host-element" id="ref-for-host-element①⓪">host element</a>.</p>
          <li data-md>
           <p>Run the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-discarding-steps" id="ref-for-environment-discarding-steps">environment discarding steps</a> for <var>navigationParam</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#navigation-params-reserved-environment" id="ref-for-navigation-params-reserved-environment">reserved environment</a>.</p>
         </ol>
        <li data-md>
         <p>Return.</p>
       </ol>
     </ol>
    </div>
    <div class="algorithm" data-algorithm="process a navigate URL scheme patch">
      In <a data-link-type="dfn">process a navigate URL scheme</a>, insert the following step before the step
    which displays inline content: 
     <ol>
      <li data-md>
       <p>Otherwise, if <var>browsingContext</var>’s <a data-link-type="dfn" href="#portal-state" id="ref-for-portal-state①⑥">portal state</a> is not "<code>none</code>", then <a data-link-type="dfn" href="#close-a-portal-element" id="ref-for-close-a-portal-element②">close</a> <var>browsingContext</var>’s <a data-link-type="dfn" href="#host-element" id="ref-for-host-element①①">host element</a>.</p>
     </ol>
    </div>
    <details class="wpt-tests-block" dir="ltr" lang="en" open>
     <summary>Tests</summary>
     <ul class="wpt-tests-list">
      <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/portals/portal-non-http-navigation.html" title="portals/portal-non-http-navigation.html">portal-non-http-navigation.html</a> <a class="wpt-live" href="http://wpt.live/portals/portal-non-http-navigation.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/portals/portal-non-http-navigation.html"><small>(source)</small></a>
     </ul>
    </details>
    <h3 class="heading settled" data-level="4.5" id="patch-downloading"><span class="secno">4.5. </span><span class="content">Downloading resources</span><a class="self-link" href="#patch-downloading"></a></h3>
    <p>Modify the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/links.html#allowed-to-download" id="ref-for-allowed-to-download">allowed to download</a> algorithm to ensure that portaled content never
  performs downloads, by prepending the following steps:</p>
    <div class="algorithm" data-algorithm="allowed to download patch">
     <ol>
      <li data-md>
       <p>If <var>initiator browsing context</var>’s <a data-link-type="dfn" href="#portal-state" id="ref-for-portal-state①⑦">portal state</a> is not "<code>none</code>", then
return false.</p>
      <li data-md>
       <p>If <var>instantiator browsing context</var>’s <a data-link-type="dfn" href="#portal-state" id="ref-for-portal-state①⑧">portal state</a> is not "<code>none</code>", then
return false.</p>
     </ol>
    </div>
   </section>
   <section>
    <h2 class="heading settled" data-level="5" id="other-spec-updates"><span class="secno">5. </span><span class="content">Updates to other specifications</span><a class="self-link" href="#other-spec-updates"></a></h2>
    <h3 class="heading settled" data-level="5.1" id="csp"><span class="secno">5.1. </span><span class="content">Content Security Policy</span><a class="self-link" href="#csp"></a></h3>
    <p>This specification integrates with <a data-link-type="biblio" href="#biblio-csp" title="Content Security Policy Level 3">[CSP]</a> as follows.</p>
    <p class="issue" id="issue-0eeb18ac"><a class="self-link" href="#issue-0eeb18ac"></a>Although <code>navigate-to</code> works as expected while the content is portaled, we also
  need to apply it to prevent activation (which is basically a navigation). This is not yet specced,
  pending spec updates to the navigation and session history handling.</p>
    <p>The following new subsection of <a href="https://w3c.github.io/webappsec-csp/#directives-fetch"><cite>Content Security Policy 3</cite> § 6.1 Fetch Directives</a> is added:</p>
    <h4 class="heading settled" data-level="5.1.1" id="portal-src-directive"><span class="secno">5.1.1. </span><span class="content"><code>portal-src</code></span><a class="self-link" href="#portal-src-directive"></a></h4>
    <p>The <dfn class="dfn-paneled" data-dfn-type="dfn" data-export id="portal-src">portal-src</dfn> directive restricts the URLs which may be loaded into <a data-link-type="dfn" href="#portal-browsing-context" id="ref-for-portal-browsing-context①⑤">portal
  browsing contexts</a>. The syntax for the directive’s name and value is described by the following
  ABNF:</p>
<pre class="highlight"><c- nc>directive-name</c->  <c- o>=</c-> <c- l>"portal-src"</c->
<c- nc>directive-value</c-> <c- o>=</c-> <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-serialized-source-list" id="ref-for-grammardef-serialized-source-list"><c- nc>serialized-source-list</c-></a>
</pre>
    <div class="example" id="example-portal-src">
     <a class="self-link" href="#example-portal-src"></a> Given a page with the following Content Security Policy: 
<pre><a data-link-type="http-header" href="https://w3c.github.io/webappsec-csp/#header-content-security-policy" id="ref-for-header-content-security-policy">Content-Security-Policy</a>: <a data-link-type="dfn" href="#portal-src" id="ref-for-portal-src">portal-src</a> https://example.com/
</pre>
     <p>Fetches for the following code will return a network errors, and thus result in <a data-link-type="dfn" href="#close-a-portal-element" id="ref-for-close-a-portal-element③">closing</a> the portal, as the URL provided does not match <code>portal-src</code>’s <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#source-lists" id="ref-for-source-lists">source list</a>:</p>
<pre class="highlight"><c- p>&lt;</c-><c- f>portal</c-> <c- e>src</c-><c- o>=</c-><c- s>"https://example.org/"</c-><c- p>>&lt;/</c-><c- f>portal</c-><c- p>></c->
</pre>
    </div>
    <h5 class="heading settled" data-level="5.1.1.1" id="portal-src-pre-request"><span class="secno">5.1.1.1. </span><span class="content"><code>portal-src</code> Pre-request check</span><a class="self-link" href="#portal-src-pre-request"></a></h5>
    <p>This directive’s <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directive-pre-request-check" id="ref-for-directive-pre-request-check">pre-request check</a> is as follows:</p>
    <div class="algorithm" data-algorithm="portal-src pre-request check">
      Given a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request" id="ref-for-concept-request①">request</a> <var>request</var> and a policy <var>policy</var>: 
     <ol>
      <li data-md>
       <p>Let <var>name</var> be the result of executing <a href="https://w3c.github.io/webappsec-csp/#effective-directive-for-a-request"><cite>Content Security Policy 3</cite> § 6.8.1 Get the effective directive for request</a> on <var>request</var>.</p>
      <li data-md>
       <p>If the result of executing <a href="https://w3c.github.io/webappsec-csp/#should-directive-execute"><cite>Content Security Policy 3</cite> § 6.8.4 Should fetch directive execute</a> on <var>name</var>, <code>portal-src</code> and <var>policy</var> is "<code>No</code>", return "<code>Allowed</code>".</p>
      <li data-md>
       <p>If the result of executing <a href="https://w3c.github.io/webappsec-csp/#match-request-to-source-list"><cite>Content Security Policy 3</cite> § 6.7.2.4 Does request match source list?</a> on <var>request</var>, this directive’s <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directive-value" id="ref-for-directive-value">value</a>, and <var>policy</var> is "<code>Does Not Match</code>", return "<code>Blocked</code>".</p>
      <li data-md>
       <p>Return "<code>Allowed</code>".</p>
     </ol>
    </div>
    <h5 class="heading settled" data-level="5.1.1.2" id="portal-src-post-request"><span class="secno">5.1.1.2. </span><span class="content"><code>portal-src</code> Post-request check</span><a class="self-link" href="#portal-src-post-request"></a></h5>
    <p>This directive’s <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directive-post-request-check" id="ref-for-directive-post-request-check">post-request check</a> is as follows:</p>
    <div class="algorithm" data-algorithm="portal-src post-request check">
      Given a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request" id="ref-for-concept-request②">request</a> <var>request</var>, a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response" id="ref-for-concept-response">response</a> <var>response</var>, and a policy <var>policy</var>: 
     <ol>
      <li data-md>
       <p>Let <var>name</var> be the result of executing <a href="https://w3c.github.io/webappsec-csp/#effective-directive-for-a-request"><cite>Content Security Policy 3</cite> § 6.8.1 Get the effective directive for request</a> on <var>request</var>.</p>
      <li data-md>
       <p>If the result of executing <a href="https://w3c.github.io/webappsec-csp/#should-directive-execute"><cite>Content Security Policy 3</cite> § 6.8.4 Should fetch directive execute</a> on <var>name</var>, <code>portal-src</code> and <var>policy</var> is "<code>No</code>", return "<code>Allowed</code>".</p>
      <li data-md>
       <p>If the result of executing <a href="https://w3c.github.io/webappsec-csp/#match-response-to-source-list"><cite>Content Security Policy 3</cite> § 6.7.2.5 Does response to request match source list?</a> on <var>response</var>, <var>request</var>,
this directive’s <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directive-value" id="ref-for-directive-value①">value</a>, and <var>policy</var> is "<code>Does Not Match</code>", return
"<code>Blocked</code>".</p>
      <li data-md>
       <p>Return "<code>Allowed</code>".</p>
     </ol>
    </div>
    <h4 class="heading settled" data-level="5.1.2" id="default-src-patch"><span class="secno">5.1.2. </span><span class="content"><code>default-src</code></span><a class="self-link" href="#default-src-patch"></a></h4>
    <p>The informative example text which expands it into all other fetch directives in <a href="https://w3c.github.io/webappsec-csp/#directive-default-src"><cite>Content Security Policy 3</cite> § 6.1.3 default-src</a> will need updating to include <a data-link-type="dfn" href="#portal-src" id="ref-for-portal-src①">portal-src</a>.</p>
    <h4 class="heading settled" data-level="5.1.3" id="directive-fallback-list-patch"><span class="secno">5.1.3. </span><span class="content">Get fetch directive fallback list</span><a class="self-link" href="#directive-fallback-list-patch"></a></h4>
    <p>The algorithm in <a href="https://w3c.github.io/webappsec-csp/#directive-fallback-list"><cite>Content Security Policy 3</cite> § 6.8.3 Get fetch directive fallback list</a> needs updating to account for the new <a data-link-type="dfn" href="#portal-src" id="ref-for-portal-src②">portal-src</a> fetch directive. Add a new case to step 1:</p>
    <dl class="switch">
     <dt data-md>"<code>portal-src</code>"
     <dd data-md>
      <ol>
       <li data-md>
        <p>Return « "<code>portal-src</code>", "<code>prefetch-src</code>", "<code>default-src</code>" ».</p>
      </ol>
    </dl>
    <h3 class="heading settled" data-level="5.2" id="fetch-metadata"><span class="secno">5.2. </span><span class="content">Fetch Metadata Request Headers</span><a class="self-link" href="#fetch-metadata"></a></h3>
    <p>This specification integrates with <a data-link-type="biblio" href="#biblio-fetch-metadata" title="Fetch Metadata Request Headers">[FETCH-METADATA]</a> as follows.</p>
    <section class="algorithm" data-algorithm="fetch-metadata-set-mode">
      The algorithm to <span spec-section="#abstract-opdef-set-mode">set the Sec-Fetch-Mode header</span> for a request <var>r</var> is modified as follows: 
     <ol>
      <li data-md>
       <p>Where the algorithm checks whether <var>r</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-reserved-client" id="ref-for-concept-request-reserved-client">reserved client</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-target-browsing-context" id="ref-for-concept-environment-target-browsing-context">target
browsing context</a> is a <a data-link-type="dfn">nested browsing context</a>, check instead whether it is a <a data-link-type="dfn">nested
browsing context</a> or a <a data-link-type="dfn" href="#portal-browsing-context" id="ref-for-portal-browsing-context①⑥">portal browsing context</a>.</p>
     </ol>
    </section>
    <div class="note" role="note">
      The effect of this is that the request for a document in a <a data-link-type="dfn" href="#portal-browsing-context" id="ref-for-portal-browsing-context①⑦">portal browsing context</a> will contain the following HTTP header, as though it were in a <a data-link-type="dfn">nested browsing context</a>. 
<pre>Sec-Fetch-Mode: nested-navigate
</pre>
    </div>
    <div class="note" role="note"> Per the existing processing model, the other fetch metadata headers will automatically have the
    same values as they would would if the load were occurring in an <code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/iframe-embed-object.html#the-iframe-element" id="ref-for-the-iframe-element③">iframe</a></code> element, with no
    spec updates needed. </div>
   </section>
   <section>
    <h2 class="heading settled" data-level="6" id="security-considerations"><span class="secno">6. </span><span class="content">Security Considerations</span><a class="self-link" href="#security-considerations"></a></h2>
    <div class="issue" id="issue-8e856747"><a class="self-link" href="#issue-8e856747"></a> We should expand this section further. Much of what was formerly there is in <a href="#other-spec-updates">§ 5 Updates to other specifications</a> now. Once we have a more comprehensive view of all the security-related
    spec updates, we should summarize them in a non-normative fashion here. </div>
    <h3 class="heading settled" data-level="6.1" id="security-overview"><span class="secno">6.1. </span><span class="content">Overview</span><a class="self-link" href="#security-overview"></a></h3>
    <p><em>This section is non-normative.</em></p>
    <p>In general, a <a data-link-type="dfn" href="#portal-browsing-context" id="ref-for-portal-browsing-context①⑧">portal browsing context</a> should respect policies that would apply to
  a <a data-link-type="dfn">nested browsing context</a>, e.g. that would restrict whether a document can be embedded
  in a document from another <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin" id="ref-for-concept-origin①">origin</a>.</p>
   </section>
   <section>
    <h2 class="heading settled" data-level="7" id="untriaged-tests"><span class="secno">7. </span><span class="content">Untriaged tests</span><a class="self-link" href="#untriaged-tests"></a></h2>
    <p>In order to get this spec to build without warnings, we need to include all the web platform tests
  explicitly. This section contains all the tests which we haven’t yet written spec text for, or
  haven’t triaged into the appropriate sections.</p>
    <details class="wpt-tests-block" dir="ltr" lang="en" open>
     <summary>Tests</summary>
     <ul class="wpt-tests-list">
      <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/portals/history/history-manipulation-inside-portal-with-subframes.html" title="portals/history/history-manipulation-inside-portal-with-subframes.html">history-manipulation-inside-portal-with-subframes.html</a> <a class="wpt-live" href="http://wpt.live/portals/history/history-manipulation-inside-portal-with-subframes.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/portals/history/history-manipulation-inside-portal-with-subframes.html"><small>(source)</small></a>
      <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/portals/history/history-manipulation-inside-portal.html" title="portals/history/history-manipulation-inside-portal.html">history-manipulation-inside-portal.html</a> <a class="wpt-live" href="http://wpt.live/portals/history/history-manipulation-inside-portal.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/portals/history/history-manipulation-inside-portal.html"><small>(source)</small></a>
      <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/portals/portal-activate-default.html" title="portals/portal-activate-default.html">portal-activate-default.html</a> <a class="wpt-live" href="http://wpt.live/portals/portal-activate-default.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/portals/portal-activate-default.html"><small>(source)</small></a>
      <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/portals/portals-activate-empty-browsing-context.html" title="portals/portals-activate-empty-browsing-context.html">portals-activate-empty-browsing-context.html</a> <a class="wpt-live" href="http://wpt.live/portals/portals-activate-empty-browsing-context.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/portals/portals-activate-empty-browsing-context.html"><small>(source)</small></a>
      <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/portals/portals-activate-network-error.html" title="portals/portals-activate-network-error.html">portals-activate-network-error.html</a> <a class="wpt-live" href="http://wpt.live/portals/portals-activate-network-error.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/portals/portals-activate-network-error.html"><small>(source)</small></a>
      <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/portals/portals-activate-while-unloading.html" title="portals/portals-activate-while-unloading.html">portals-activate-while-unloading.html</a> <a class="wpt-live" href="http://wpt.live/portals/portals-activate-while-unloading.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/portals/portals-activate-while-unloading.html"><small>(source)</small></a>
      <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/portals/portals-focus.sub.html" title="portals/portals-focus.sub.html">portals-focus.sub.html</a> <a class="wpt-live" href="http://wpt.live/portals/portals-focus.sub.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/portals/portals-focus.sub.html"><small>(source)</small></a>
      <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/portals/portals-navigate-after-adoption.html" title="portals/portals-navigate-after-adoption.html">portals-navigate-after-adoption.html</a> <a class="wpt-live" href="http://wpt.live/portals/portals-navigate-after-adoption.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/portals/portals-navigate-after-adoption.html"><small>(source)</small></a>
      <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/portals/portals-repeated-activate.html" title="portals/portals-repeated-activate.html">portals-repeated-activate.html</a> <a class="wpt-live" href="http://wpt.live/portals/portals-repeated-activate.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/portals/portals-repeated-activate.html"><small>(source)</small></a>
      <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/portals/portals-set-src-after-activate.html" title="portals/portals-set-src-after-activate.html">portals-set-src-after-activate.html</a> <a class="wpt-live" href="http://wpt.live/portals/portals-set-src-after-activate.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/portals/portals-set-src-after-activate.html"><small>(source)</small></a>
      <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/portals/predecessor-fires-unload.html" title="portals/predecessor-fires-unload.html">predecessor-fires-unload.html</a> <a class="wpt-live" href="http://wpt.live/portals/predecessor-fires-unload.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/portals/predecessor-fires-unload.html"><small>(source)</small></a>
     </ul>
    </details>
    <p>The following tests are actively incorrect and need to get updated:</p>
    <details class="wpt-tests-block" dir="ltr" lang="en" open>
     <summary>Tests</summary>
     <ul class="wpt-tests-list">
      <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/portals/csp/frame-ancestors.sub.html" title="portals/csp/frame-ancestors.sub.html">frame-ancestors.sub.html</a> <a class="wpt-live" href="http://wpt.live/portals/csp/frame-ancestors.sub.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/portals/csp/frame-ancestors.sub.html"><small>(source)</small></a>
      <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/portals/xfo/portals-xfo-deny.sub.html" title="portals/xfo/portals-xfo-deny.sub.html">portals-xfo-deny.sub.html</a> <a class="wpt-live" href="http://wpt.live/portals/xfo/portals-xfo-deny.sub.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/portals/xfo/portals-xfo-deny.sub.html"><small>(source)</small></a>
      <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/portals/xfo/portals-xfo-sameorigin.html" title="portals/xfo/portals-xfo-sameorigin.html">portals-xfo-sameorigin.html</a> <a class="wpt-live" href="http://wpt.live/portals/xfo/portals-xfo-sameorigin.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/portals/xfo/portals-xfo-sameorigin.html"><small>(source)</small></a>
      <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/portals/csp/frame-src.sub.html" title="portals/csp/frame-src.sub.html">frame-src.sub.html</a> <a class="wpt-live" href="http://wpt.live/portals/csp/frame-src.sub.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/portals/csp/frame-src.sub.html"><small>(source)</small></a>
     </ul>
    </details>
   </section>
  </main>
  <div data-fill-with="conformance">
   <h2 class="no-ref no-num heading settled" id="w3c-conformance"><span class="content">Conformance</span><a class="self-link" href="#w3c-conformance"></a></h2>
   <h3 class="no-ref no-num heading settled" id="w3c-conventions"><span class="content">Document conventions</span><a class="self-link" href="#w3c-conventions"></a></h3>
   <p>Conformance requirements are expressed
    with a combination of descriptive assertions
    and RFC 2119 terminology.
    The key words “MUST”, “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”, “RECOMMENDED”, “MAY”, and “OPTIONAL”
    in the normative parts of this document
    are to be interpreted as described in RFC 2119.
    However, for readability,
    these words do not appear in all uppercase letters in this specification. </p>
   <p>All of the text of this specification is normative
    except sections explicitly marked as non-normative, examples, and notes. <a data-link-type="biblio" href="#biblio-rfc2119" title="Key words for use in RFCs to Indicate Requirement Levels">[RFC2119]</a> </p>
   <p>Examples in this specification are introduced with the words “for example”
    or are set apart from the normative text
    with <code>class="example"</code>,
    like this: </p>
   <div class="example" id="w3c-example">
    <a class="self-link" href="#w3c-example"></a> 
    <p>This is an example of an informative example. </p>
   </div>
   <p>Informative notes begin with the word “Note”
    and are set apart from the normative text
    with <code>class="note"</code>,
    like this: </p>
   <p class="note" role="note">Note, this is an informative note.</p>
   <details class="wpt-tests-block" dir="ltr" lang="en" open>
    <summary>Tests</summary>
    <p>Tests relating to the content of this specification
                     may be documented in “Tests” blocks like this one.
                     Any such block is non-normative.</p>
    <ul class="wpt-tests-list"></ul>
    <hr>
   </details>
   <h3 class="no-ref no-num heading settled" id="w3c-conformant-algorithms"><span class="content">Conformant Algorithms</span><a class="self-link" href="#w3c-conformant-algorithms"></a></h3>
   <p>Requirements phrased in the imperative as part of algorithms
    (such as "strip any leading space characters"
    or "return false and abort these steps")
    are to be interpreted with the meaning of the key word
    ("must", "should", "may", etc)
    used in introducing the algorithm. </p>
   <p>Conformance requirements phrased as algorithms or specific steps
    can be implemented in any manner,
    so long as the end result is equivalent.
    In particular, the algorithms defined in this specification
    are intended to be easy to understand
    and are not intended to be performant.
    Implementers are encouraged to optimize. </p>
  </div>
  <script src="https://www.w3.org/scripts/TR/2021/fixup.js"></script>
  <h2 class="no-num no-ref heading settled" id="index"><span class="content">Index</span><a class="self-link" href="#index"></a></h2>
  <h3 class="no-num no-ref heading settled" id="index-defined-here"><span class="content">Terms defined by this specification</span><a class="self-link" href="#index-defined-here"></a></h3>
  <ul class="index">
   <li><a href="#dom-htmlportalelement-activate">activate()</a><span>, in § 3</span>
   <li><a href="#activate-a-portal-browsing-context">activate a portal browsing context</a><span>, in § 2</span>
   <li><a href="#dom-htmlportalelement-activate">activate(options)</a><span>, in § 3</span>
   <li><a href="#portalactivateevent-activation-promise">activation promise</a><span>, in § 3.2</span>
   <li><a href="#portalactivateevent-adopted-predecessor-element">adopted predecessor element</a><span>, in § 3.2</span>
   <li><a href="#dom-portalactivateevent-adoptpredecessor">adoptPredecessor()</a><span>, in § 3.2</span>
   <li><a href="#adopt-the-predecessor-browsing-context">adopt the predecessor browsing context</a><span>, in § 2</span>
   <li><a href="#close-a-portal-element">close a portal element</a><span>, in § 3</span>
   <li><a href="#dom-portalactivateevent-portalactivateevent">constructor(type)</a><span>, in § 3.2</span>
   <li><a href="#dom-portalactivateevent-portalactivateevent">constructor(type, eventInitDict)</a><span>, in § 3.2</span>
   <li>
    data
    <ul>
     <li><a href="#dom-portalactivateevent-data">attribute for PortalActivateEvent</a><span>, in § 3.2</span>
     <li><a href="#dom-portalactivateeventinit-data">dict-member for PortalActivateEventInit</a><span>, in § 3.2</span>
     <li><a href="#dom-portalactivateoptions-data">dict-member for PortalActivateOptions</a><span>, in § 3</span>
    </ul>
   <li><a href="#htmlportalelement-guest-browsing-context">guest browsing context</a><span>, in § 3</span>
   <li><a href="#host-browsing-context">host browsing context</a><span>, in § 2</span>
   <li><a href="#host-element">host element</a><span>, in § 2</span>
   <li><a href="#htmlportalelement">HTMLPortalElement</a><span>, in § 3</span>
   <li><a href="#htmlportalelement-just-adopted-flag">just-adopted flag</a><span>, in § 3</span>
   <li><a href="#may-have-a-guest-browsing-context">may have a guest browsing context</a><span>, in § 3</span>
   <li>
    message
    <ul>
     <li><a href="#eventdef-htmlportalelement-message">event for HTMLPortalElement</a><span>, in § 3</span>
     <li><a href="#eventdef-portalhost-message">event for PortalHost</a><span>, in § 3.1</span>
    </ul>
   <li>
    messageerror
    <ul>
     <li><a href="#eventdef-htmlportalelement-messageerror">event for HTMLPortalElement</a><span>, in § 3</span>
     <li><a href="#eventdef-portalhost-messageerror">event for PortalHost</a><span>, in § 3.1</span>
    </ul>
   <li><a href="#typedefdef-messageeventsource">MessageEventSource</a><span>, in § 4.1</span>
   <li>
    onmessage
    <ul>
     <li><a href="#dom-htmlportalelement-onmessage">attribute for HTMLPortalElement</a><span>, in § 3</span>
     <li><a href="#dom-portalhost-onmessage">attribute for PortalHost</a><span>, in § 3.1</span>
    </ul>
   <li>
    onmessageerror
    <ul>
     <li><a href="#dom-htmlportalelement-onmessageerror">attribute for HTMLPortalElement</a><span>, in § 3</span>
     <li><a href="#dom-portalhost-onmessageerror">attribute for PortalHost</a><span>, in § 3.1</span>
    </ul>
   <li>
    onportalactivate
    <ul>
     <li><a href="#dom-window-onportalactivate">attribute for Window</a><span>, in § 4.2</span>
     <li><a href="#dom-windoweventhandlers-onportalactivate">attribute for WindowEventHandlers</a><span>, in § 4.2</span>
    </ul>
   <li><a href="#elementdef-portal">portal</a><span>, in § 3</span>
   <li><a href="#eventdef-window-portalactivate">portalactivate</a><span>, in § 4.2</span>
   <li><a href="#portalactivateevent">PortalActivateEvent</a><span>, in § 3.2</span>
   <li><a href="#dictdef-portalactivateeventinit">PortalActivateEventInit</a><span>, in § 3.2</span>
   <li><a href="#dom-portalactivateevent-portalactivateevent">PortalActivateEvent(type)</a><span>, in § 3.2</span>
   <li><a href="#dom-portalactivateevent-portalactivateevent">PortalActivateEvent(type, eventInitDict)</a><span>, in § 3.2</span>
   <li><a href="#dictdef-portalactivateoptions">PortalActivateOptions</a><span>, in § 3</span>
   <li><a href="#portal-browsing-context">portal browsing context</a><span>, in § 2</span>
   <li><a href="#portalhost">PortalHost</a><span>, in § 3.1</span>
   <li><a href="#dom-window-portalhost">portalHost</a><span>, in § 3.1</span>
   <li><a href="#portal-host-object">portal host object</a><span>, in § 3.1</span>
   <li><a href="#portal-src">portal-src</a><span>, in § 5.1.1</span>
   <li><a href="#portal-state">portal state</a><span>, in § 2</span>
   <li><a href="#portal-task-source">portal task source</a><span>, in § 2</span>
   <li>
    postMessage(message)
    <ul>
     <li><a href="#dom-htmlportalelement-postmessage">method for HTMLPortalElement</a><span>, in § 3</span>
     <li><a href="#dom-portalhost-postmessage">method for PortalHost</a><span>, in § 3.1</span>
    </ul>
   <li>
    postMessage(message, options)
    <ul>
     <li><a href="#dom-htmlportalelement-postmessage">method for HTMLPortalElement</a><span>, in § 3</span>
     <li><a href="#dom-portalhost-postmessage">method for PortalHost</a><span>, in § 3.1</span>
    </ul>
   <li><a href="#portalactivateevent-predecessor-browsing-context">predecessor browsing context</a><span>, in § 3.2</span>
   <li><a href="#dom-htmlportalelement-referrerpolicy">referrerPolicy</a><span>, in § 3</span>
   <li><a href="#element-attrdef-portal-referrerpolicy">referrerpolicy</a><span>, in § 3</span>
   <li><a href="#script-closable">script-closable</a><span>, in § 4.3</span>
   <li><a href="#set-the-source-url-of-a-portal-element">set the source URL of a portal element</a><span>, in § 3</span>
   <li>
    src
    <ul>
     <li><a href="#dom-htmlportalelement-src">attribute for HTMLPortalElement</a><span>, in § 3</span>
     <li><a href="#element-attrdef-portal-src">element-attr for portal</a><span>, in § 3</span>
    </ul>
   <li><a href="#portalactivateevent-successor-window">successor window</a><span>, in § 3.2</span>
  </ul>
  <h3 class="no-num no-ref heading settled" id="index-defined-elsewhere"><span class="content">Terms defined by reference</span><a class="self-link" href="#index-defined-elsewhere"></a></h3>
  <ul class="index">
   <li>
    <a data-link-type="biblio">[CSP]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="b7c21a86">content-security-policy</span>
     <li><span class="dfn-paneled" id="adb85093">post-request check</span>
     <li><span class="dfn-paneled" id="7fe0991e">pre-request check</span>
     <li><span class="dfn-paneled" id="8ea172e9">sandbox</span>
     <li><span class="dfn-paneled" id="8f1a9afe">serialized-source-list</span>
     <li><span class="dfn-paneled" id="75aafb4f">source lists</span>
     <li><span class="dfn-paneled" id="461b765a">value</span>
    </ul>
   <li>
    <a data-link-type="biblio">[DOM]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="85394472">Document</span>
     <li><span class="dfn-paneled" id="129bdae8">Event</span>
     <li><span class="dfn-paneled" id="44a7708c">EventInit</span>
     <li><span class="dfn-paneled" id="2bc0cdf4">EventTarget</span>
     <li><span class="dfn-paneled" id="bec14ad5">activation behavior</span>
     <li><span class="dfn-paneled" id="a9910bde">adopting steps</span>
     <li><span class="dfn-paneled" id="3c307af9">creating an element</span>
     <li><span class="dfn-paneled" id="8abfc3b6">creating an event</span>
     <li><span class="dfn-paneled" id="1372f92a">dispatch</span>
     <li><span class="dfn-paneled" id="3a89258a">event constructing steps</span>
     <li><span class="dfn-paneled" id="5fd23811">fire an event</span>
     <li><span class="dfn-paneled" id="5216e1a0">node document</span>
     <li><span class="dfn-paneled" id="c62cd7cf">origin</span>
     <li><span class="dfn-paneled" id="9d09d04c">type</span>
     <li><span class="dfn-paneled" id="347e8fe9">url</span>
    </ul>
   <li>
    <a data-link-type="biblio">[ECMASCRIPT]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="83d7f701">agent</span>
     <li><span class="dfn-paneled" id="7c9ab308">promise</span>
    </ul>
   <li>
    <a data-link-type="biblio">[FETCH]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="3f2ca4de">current url</span>
     <li><span class="dfn-paneled" id="eb62573b">http(s) scheme</span>
     <li><span class="dfn-paneled" id="07582c28">referrer policy</span>
     <li><span class="dfn-paneled" id="55213b5b">request</span>
     <li><span class="dfn-paneled" id="abe352cd">reserved client</span>
     <li><span class="dfn-paneled" id="ee7bba09">response</span>
     <li><span class="dfn-paneled" id="a1d47575">status</span>
     <li><span class="dfn-paneled" id="dc1cd39b">url</span>
    </ul>
   <li>
    <a data-link-type="biblio">[HTML]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="402ed79d">CEReactions</span>
     <li><span class="dfn-paneled" id="f0951476">EventHandler</span>
     <li><span class="dfn-paneled" id="973aaf8e">HTMLConstructor</span>
     <li><span class="dfn-paneled" id="b08d0bb2">HTMLElement</span>
     <li><span class="dfn-paneled" id="3e8c0e5f">MessageEvent</span>
     <li><span class="dfn-paneled" id="df16744f">MessagePort</span>
     <li><span class="dfn-paneled" id="e7cb09fb">StructuredDeserializeWithTransfer</span>
     <li><span class="dfn-paneled" id="9da834a1">StructuredSerializeWithTransfer</span>
     <li><span class="dfn-paneled" id="5d7209e9">Window</span>
     <li><span class="dfn-paneled" id="8baa72cd">WindowEventHandlers</span>
     <li><span class="dfn-paneled" id="94039a0c">WindowProxy</span>
     <li><span class="dfn-paneled" id="27e10eaf">active sandboxing flag set</span>
     <li><span class="dfn-paneled" id="28ad22ad">allowed to download</span>
     <li><span class="dfn-paneled" id="3349d69f">associated document</span>
     <li><span class="dfn-paneled" id="58ebefde">auxiliary browsing context</span>
     <li><span class="dfn-paneled" id="01844357">become browsing-context connected</span>
     <li><span class="dfn-paneled" id="5ab33979">become browsing-context disconnected</span>
     <li><span class="dfn-paneled" id="0d0390b4">browsing context</span>
     <li><span class="dfn-paneled" id="3b2ff63e">browsing context <small>(for Document)</small></span>
     <li><span class="dfn-paneled" id="6d88ab2e">browsing context <small>(for Window)</small></span>
     <li><span class="dfn-paneled" id="5d9c7125">browsing context group</span>
     <li><span class="dfn-paneled" id="e809a09f">browsing-context connected</span>
     <li><span class="dfn-paneled" id="9042040b">close a browsing context</span>
     <li><span class="dfn-paneled" id="3b367d8d">completely loaded</span>
     <li><span class="dfn-paneled" id="9e690900">create a new top-level browsing context</span>
     <li><span class="dfn-paneled" id="3700794f">data</span>
     <li><span class="dfn-paneled" id="4c96ad04">discard a browsing context</span>
     <li><span class="dfn-paneled" id="78a97411">environment discarding steps</span>
     <li><span class="dfn-paneled" id="6a5a59a0">event handler</span>
     <li><span class="dfn-paneled" id="cc6d9aed">event handler content attribute</span>
     <li><span class="dfn-paneled" id="9d386f55">event handler event type</span>
     <li><span class="dfn-paneled" id="03675365">event handler idl attribute</span>
     <li><span class="dfn-paneled" id="c6d19e56">event loop</span>
     <li><span class="dfn-paneled" id="b78d6a64">event loop <small>(for agent)</small></span>
     <li><span class="dfn-paneled" id="87fcd40c">iframe</span>
     <li><span class="dfn-paneled" id="a72449dd">in parallel</span>
     <li><span class="dfn-paneled" id="27ce3281">limited to only known values</span>
     <li><span class="dfn-paneled" id="18e7dde9">load</span>
     <li><span class="dfn-paneled" id="2594e562">navigate</span>
     <li><span class="dfn-paneled" id="086e3aff">origin</span>
     <li><span class="dfn-paneled" id="e0eefdd9">origin <small>(for MessageEvent)</small></span>
     <li><span class="dfn-paneled" id="43ac8374">origin <small>(for environment settings object)</small></span>
     <li><span class="dfn-paneled" id="55a8e1b3">parse a url</span>
     <li><span class="dfn-paneled" id="7b162b57">ports</span>
     <li><span class="dfn-paneled" id="5bec656b">prompt to unload</span>
     <li><span class="dfn-paneled" id="48438eb3">queue a global task</span>
     <li><span class="dfn-paneled" id="72aaa5d6">queue an element task</span>
     <li><span class="dfn-paneled" id="d1ee46ce">realm <small>(for environment settings object)</small></span>
     <li><span class="dfn-paneled" id="b75a7d23">realm <small>(for global object)</small></span>
     <li><span class="dfn-paneled" id="57807ab9">referrer policy attribute</span>
     <li><span class="dfn-paneled" id="5ab7b520">reflect</span>
     <li><span class="dfn-paneled" id="e99bd18e">relevant global object</span>
     <li><span class="dfn-paneled" id="9c4c1e66">relevant settings object</span>
     <li><span class="dfn-paneled" id="0364029f">request</span>
     <li><span class="dfn-paneled" id="65d48b3a">reserved environment</span>
     <li><span class="dfn-paneled" id="663fde87">resulting url record</span>
     <li><span class="dfn-paneled" id="7393da89">same origin</span>
     <li><span class="dfn-paneled" id="521818b9">same origin-domain</span>
     <li><span class="dfn-paneled" id="cd2846d6">script-closable</span>
     <li><span class="dfn-paneled" id="dae0bfde">serialization of an origin</span>
     <li><span class="dfn-paneled" id="48093925">session history</span>
     <li><span class="dfn-paneled" id="a0d0a7c7">source</span>
     <li><span class="dfn-paneled" id="085ddd0a">target browsing context</span>
     <li><span class="dfn-paneled" id="c3b2d08c">task source</span>
     <li><span class="dfn-paneled" id="ae2a6342">top-level browsing context</span>
     <li><span class="dfn-paneled" id="ba4c841d">unload</span>
     <li><span class="dfn-paneled" id="8bd6a569">unload <small>(for Window)</small></span>
     <li><span class="dfn-paneled" id="cad61a81">valid non-empty url potentially surrounded by spaces</span>
    </ul>
   <li>
    <a data-link-type="biblio">[INFRA]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="77b4c09a">assert</span>
     <li><span class="dfn-paneled" id="36858240">boolean</span>
     <li><span class="dfn-paneled" id="f052b1ea">html namespace</span>
    </ul>
   <li>
    <a data-link-type="biblio">[REFERRER-POLICY]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="2d09a0dd">referrer policy</span>
    </ul>
   <li>
    <a data-link-type="biblio">[SERVICE-WORKERS]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="1968aaab">ServiceWorker</span>
    </ul>
   <li>
    <a data-link-type="biblio">[URL]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="3a711be7">scheme</span>
     <li><span class="dfn-paneled" id="dcffbccd">url</span>
    </ul>
   <li>
    <a data-link-type="biblio">[WEBIDL]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="dca2de17">DOMException</span>
     <li><span class="dfn-paneled" id="8855a9aa">DOMString</span>
     <li><span class="dfn-paneled" id="889e932f">Exposed</span>
     <li><span class="dfn-paneled" id="797018a7">InvalidStateError</span>
     <li><span class="dfn-paneled" id="c807e273">NewObject</span>
     <li><span class="dfn-paneled" id="bdbd19d1">Promise</span>
     <li><span class="dfn-paneled" id="b0d7f3c3">USVString</span>
     <li><span class="dfn-paneled" id="6c6b1005">any</span>
     <li><span class="dfn-paneled" id="abbed741">frozen array type</span>
     <li><span class="dfn-paneled" id="b262501e">reject</span>
     <li><span class="dfn-paneled" id="4013a022">this</span>
     <li><span class="dfn-paneled" id="5f90bbfb">undefined</span>
    </ul>
  </ul>
  <h2 class="no-num no-ref heading settled" id="references"><span class="content">References</span><a class="self-link" href="#references"></a></h2>
  <h3 class="no-num no-ref heading settled" id="normative"><span class="content">Normative References</span><a class="self-link" href="#normative"></a></h3>
  <dl>
   <dt id="biblio-csp">[CSP]
   <dd>Mike West; Antonio Sartori. <a href="https://w3c.github.io/webappsec-csp/"><cite>Content Security Policy Level 3</cite></a>. URL: <a href="https://w3c.github.io/webappsec-csp/">https://w3c.github.io/webappsec-csp/</a>
   <dt id="biblio-dom">[DOM]
   <dd>Anne van Kesteren. <a href="https://dom.spec.whatwg.org/"><cite>DOM Standard</cite></a>. Living Standard. URL: <a href="https://dom.spec.whatwg.org/">https://dom.spec.whatwg.org/</a>
   <dt id="biblio-ecmascript">[ECMASCRIPT]
   <dd><a href="https://tc39.es/ecma262/multipage/"><cite>ECMAScript Language Specification</cite></a>. URL: <a href="https://tc39.es/ecma262/multipage/">https://tc39.es/ecma262/multipage/</a>
   <dt id="biblio-fetch">[FETCH]
   <dd>Anne van Kesteren. <a href="https://fetch.spec.whatwg.org/"><cite>Fetch Standard</cite></a>. Living Standard. URL: <a href="https://fetch.spec.whatwg.org/">https://fetch.spec.whatwg.org/</a>
   <dt id="biblio-html">[HTML]
   <dd>Anne van Kesteren; et al. <a href="https://html.spec.whatwg.org/multipage/"><cite>HTML Standard</cite></a>. Living Standard. URL: <a href="https://html.spec.whatwg.org/multipage/">https://html.spec.whatwg.org/multipage/</a>
   <dt id="biblio-infra">[INFRA]
   <dd>Anne van Kesteren; Domenic Denicola. <a href="https://infra.spec.whatwg.org/"><cite>Infra Standard</cite></a>. Living Standard. URL: <a href="https://infra.spec.whatwg.org/">https://infra.spec.whatwg.org/</a>
   <dt id="biblio-referrer-policy">[REFERRER-POLICY]
   <dd>Jochen Eisinger; Emily Stark. <a href="https://w3c.github.io/webappsec-referrer-policy/"><cite>Referrer Policy</cite></a>. URL: <a href="https://w3c.github.io/webappsec-referrer-policy/">https://w3c.github.io/webappsec-referrer-policy/</a>
   <dt id="biblio-rfc2119">[RFC2119]
   <dd>S. Bradner. <a href="https://datatracker.ietf.org/doc/html/rfc2119"><cite>Key words for use in RFCs to Indicate Requirement Levels</cite></a>. March 1997. Best Current Practice. URL: <a href="https://datatracker.ietf.org/doc/html/rfc2119">https://datatracker.ietf.org/doc/html/rfc2119</a>
   <dt id="biblio-service-workers">[SERVICE-WORKERS]
   <dd>Jake Archibald; Marijn Kruisselbrink. <a href="https://w3c.github.io/ServiceWorker/"><cite>Service Workers</cite></a>. URL: <a href="https://w3c.github.io/ServiceWorker/">https://w3c.github.io/ServiceWorker/</a>
   <dt id="biblio-url">[URL]
   <dd>Anne van Kesteren. <a href="https://url.spec.whatwg.org/"><cite>URL Standard</cite></a>. Living Standard. URL: <a href="https://url.spec.whatwg.org/">https://url.spec.whatwg.org/</a>
   <dt id="biblio-webidl">[WEBIDL]
   <dd>Edgar Chen; Timothy Gu. <a href="https://webidl.spec.whatwg.org/"><cite>Web IDL Standard</cite></a>. Living Standard. URL: <a href="https://webidl.spec.whatwg.org/">https://webidl.spec.whatwg.org/</a>
  </dl>
  <h3 class="no-num no-ref heading settled" id="informative"><span class="content">Informative References</span><a class="self-link" href="#informative"></a></h3>
  <dl>
   <dt id="biblio-fetch-metadata">[FETCH-METADATA]
   <dd>Mike West. <a href="https://w3c.github.io/webappsec-fetch-metadata/"><cite>Fetch Metadata Request Headers</cite></a>. URL: <a href="https://w3c.github.io/webappsec-fetch-metadata/">https://w3c.github.io/webappsec-fetch-metadata/</a>
  </dl>
  <h2 class="no-num no-ref heading settled" id="idl-index"><span class="content">IDL Index</span><a class="self-link" href="#idl-index"></a></h2>
<pre class="idl highlight def">[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed"><c- g>Exposed</c-></a>=<c- n>Window</c->, <a class="idl-code" data-link-type="extended-attribute" href="https://html.spec.whatwg.org/multipage/dom.html#htmlconstructor"><c- g>HTMLConstructor</c-></a>]
<c- b>interface</c-> <a href="#htmlportalelement"><code><c- g>HTMLPortalElement</c-></code></a> : <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/dom.html#htmlelement"><c- n>HTMLElement</c-></a> {
    [<a class="idl-code" data-link-type="extended-attribute" href="https://html.spec.whatwg.org/multipage/custom-elements.html#cereactions"><c- g>CEReactions</c-></a>] <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-USVString"><c- b>USVString</c-></a> <a class="idl-code" data-link-type="attribute" data-type="USVString" href="#dom-htmlportalelement-src"><c- g>src</c-></a>;
    [<a class="idl-code" data-link-type="extended-attribute" href="https://html.spec.whatwg.org/multipage/custom-elements.html#cereactions"><c- g>CEReactions</c-></a>] <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString"><c- b>DOMString</c-></a> <a class="idl-code" data-link-type="attribute" data-type="DOMString" href="#dom-htmlportalelement-referrerpolicy"><c- g>referrerPolicy</c-></a>;

    [<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#NewObject"><c- g>NewObject</c-></a>] <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise"><c- b>Promise</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-undefined"><c- b>undefined</c-></a>> <a class="idl-code" data-link-type="method" href="#dom-htmlportalelement-activate"><c- g>activate</c-></a>(<c- b>optional</c-> <a data-link-type="idl-name" href="#dictdef-portalactivateoptions"><c- n>PortalActivateOptions</c-></a> <a href="#dom-htmlportalelement-activate-options-options"><code><c- g>options</c-></code></a> = {});
    <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-undefined"><c- b>undefined</c-></a> <a class="idl-code" data-link-type="method" href="#dom-htmlportalelement-postmessage"><c- g>postMessage</c-></a>(<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-any"><c- b>any</c-></a> <a href="#dom-htmlportalelement-postmessage-message-options-message"><code><c- g>message</c-></code></a>, <c- b>optional</c-> <a data-link-type="idl-name"><c- n>PostMessageOptions</c-></a> <a href="#dom-htmlportalelement-postmessage-message-options-options"><code><c- g>options</c-></code></a> = {});

    <c- b>attribute</c-> <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler"><c- n>EventHandler</c-></a> <a data-type="EventHandler" href="#dom-htmlportalelement-onmessage"><code><c- g>onmessage</c-></code></a>;
    <c- b>attribute</c-> <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler"><c- n>EventHandler</c-></a> <a data-type="EventHandler" href="#dom-htmlportalelement-onmessageerror"><code><c- g>onmessageerror</c-></code></a>;
};

<c- b>dictionary</c-> <a href="#dictdef-portalactivateoptions"><code><c- g>PortalActivateOptions</c-></code></a> : <a data-link-type="idl-name"><c- n>PostMessageOptions</c-></a> {
    <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-any"><c- b>any</c-></a> <a data-type="any" href="#dom-portalactivateoptions-data"><code><c- g>data</c-></code></a>;
};

<c- b>partial</c-> <c- b>interface</c-> <a class="idl-code" data-link-type="interface" href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#window"><c- g>Window</c-></a> {
    <c- b>readonly</c-> <c- b>attribute</c-> <a data-link-type="idl-name" href="#portalhost"><c- n>PortalHost</c-></a>? <a class="idl-code" data-link-type="attribute" data-readonly data-type="PortalHost?" href="#dom-window-portalhost"><c- g>portalHost</c-></a>;
};

[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed"><c- g>Exposed</c-></a>=<c- n>Window</c->]
<c- b>interface</c-> <a href="#portalhost"><code><c- g>PortalHost</c-></code></a> : <a data-link-type="idl-name" href="https://dom.spec.whatwg.org/#eventtarget"><c- n>EventTarget</c-></a> {
    <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-undefined"><c- b>undefined</c-></a> <a class="idl-code" data-link-type="method" href="#dom-portalhost-postmessage"><c- g>postMessage</c-></a>(<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-any"><c- b>any</c-></a> <a href="#dom-portalhost-postmessage-message-options-message"><code><c- g>message</c-></code></a>, <c- b>optional</c-> <a data-link-type="idl-name"><c- n>PostMessageOptions</c-></a> <a href="#dom-portalhost-postmessage-message-options-options"><code><c- g>options</c-></code></a> = {});

    <c- b>attribute</c-> <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler"><c- n>EventHandler</c-></a> <a data-type="EventHandler" href="#dom-portalhost-onmessage"><code><c- g>onmessage</c-></code></a>;
    <c- b>attribute</c-> <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler"><c- n>EventHandler</c-></a> <a data-type="EventHandler" href="#dom-portalhost-onmessageerror"><code><c- g>onmessageerror</c-></code></a>;
};

[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed"><c- g>Exposed</c-></a>=<c- n>Window</c->]
<c- b>interface</c-> <a href="#portalactivateevent"><code><c- g>PortalActivateEvent</c-></code></a> : <a data-link-type="idl-name" href="https://dom.spec.whatwg.org/#event"><c- n>Event</c-></a> {
    <a href="#dom-portalactivateevent-portalactivateevent"><code><c- g>constructor</c-></code></a>(<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString"><c- b>DOMString</c-></a> <a href="#dom-portalactivateevent-portalactivateevent-type-eventinitdict-type"><code><c- g>type</c-></code></a>, <c- b>optional</c-> <a data-link-type="idl-name" href="#dictdef-portalactivateeventinit"><c- n>PortalActivateEventInit</c-></a> <a href="#dom-portalactivateevent-portalactivateevent-type-eventinitdict-eventinitdict"><code><c- g>eventInitDict</c-></code></a> = {});

    <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-any"><c- b>any</c-></a> <a data-readonly data-type="any" href="#dom-portalactivateevent-data"><code><c- g>data</c-></code></a>;
    <a data-link-type="idl-name" href="#htmlportalelement"><c- n>HTMLPortalElement</c-></a> <a class="idl-code" data-link-type="method" href="#dom-portalactivateevent-adoptpredecessor"><c- g>adoptPredecessor</c-></a>();
};

<c- b>dictionary</c-> <a href="#dictdef-portalactivateeventinit"><code><c- g>PortalActivateEventInit</c-></code></a> : <a data-link-type="idl-name" href="https://dom.spec.whatwg.org/#dictdef-eventinit"><c- n>EventInit</c-></a> {
    <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-any"><c- b>any</c-></a> <a data-default="null" data-type="any" href="#dom-portalactivateeventinit-data"><code><c- g>data</c-></code></a> = <c- b>null</c->;
};

<c- b>typedef</c-> (<a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#windowproxy"><c- n>WindowProxy</c-></a> <c- b>or</c-> <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/web-messaging.html#messageport"><c- n>MessagePort</c-></a> <c- b>or</c-> <a data-link-type="idl-name" href="https://w3c.github.io/ServiceWorker/#serviceworker"><c- n>ServiceWorker</c-></a> <c- b>or</c-> <a data-link-type="idl-name" href="#htmlportalelement"><c- n>HTMLPortalElement</c-></a> <c- b>or</c-> <a data-link-type="idl-name" href="#portalhost"><c- n>PortalHost</c-></a>) <a href="#typedefdef-messageeventsource"><code><c- g>MessageEventSource</c-></code></a>;

<c- b>partial</c-> <c- b>interface</c-> <c- b>mixin</c-> <a class="idl-code" data-link-type="interface" href="https://html.spec.whatwg.org/multipage/webappapis.html#windoweventhandlers"><c- g>WindowEventHandlers</c-></a> {
    <c- b>attribute</c-> <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler"><c- n>EventHandler</c-></a> <a data-type="EventHandler" href="#dom-windoweventhandlers-onportalactivate"><code><c- g>onportalactivate</c-></code></a>;
};

</pre>
  <h2 class="no-num no-ref heading settled" id="issues-index"><span class="content">Issues Index</span><a class="self-link" href="#issues-index"></a></h2>
  <div style="counter-reset:issue">
   <div class="issue"> Determine how to treat unload/beforeunload handlers. See <a href="https://github.com/WICG/portals/issues/225">issue #225</a> for discussion. <a class="issue-return" href="#issue-c722a2b5" title="Jump to section">↵</a></div>
   <div class="issue"> In the case that structured deserialization throws, it may be useful to do something else to indicate it,
    rather than simply providing null data. <a class="issue-return" href="#issue-b49e4903" title="Jump to section">↵</a></div>
   <div class="issue"> We need to specify how the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/history.html#session-history">session history</a> of each browsing context is
    affected by activation, and supply non-normative text that explains how
    these histories are expected to be presented to the user. <a class="issue-return" href="#issue-0d72b101" title="Jump to section">↵</a></div>
   <div class="issue"> It might be convenient to not immediately detach the portal element, but instead to do so
    in a microtask. This would allow developers to reinsert the <code><a data-link-type="element" href="#elementdef-portal">portal</a></code> element without losing
    its browsing context. <a class="issue-return" href="#issue-833dc9f1" title="Jump to section">↵</a></div>
   <div class="issue">Although <code>navigate-to</code> works as expected while the content is portaled, we also
  need to apply it to prevent activation (which is basically a navigation). This is not yet specced,
  pending spec updates to the navigation and session history handling. <a class="issue-return" href="#issue-0eeb18ac" title="Jump to section">↵</a></div>
   <div class="issue"> We should expand this section further. Much of what was formerly there is in <a href="#other-spec-updates">§ 5 Updates to other specifications</a> now. Once we have a more comprehensive view of all the security-related
    spec updates, we should summarize them in a non-normative fashion here. <a class="issue-return" href="#issue-8e856747" title="Jump to section">↵</a></div>
  </div>
  <details class="mdn-anno unpositioned" data-anno-for="the-portal-element">
   <summary><b class="less-than-two-engines-flag" title="This feature is in less than two current engines.">⚠</b><span>MDN</span></summary>
   <div class="feature">
    <p><a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/portal" title="The <portal> HTML element enables the embedding of another HTML page into the current one for the purposes of allowing smoother navigation into new pages.">Element/portal</a></p>
    <p class="less-than-two-engines-text">In only one current engine.</p>
    <div class="support">
     <span class="firefox no"><span>Firefox</span><span>None</span></span><span class="safari no"><span>Safari</span><span>None</span></span><span class="chrome yes"><span>Chrome</span><span title="Requires setting a user preference or runtime flag.">🔰 85+</span></span>
     <hr>
     <span class="opera yes"><span>Opera</span><span title="Requires setting a user preference or runtime flag.">🔰 73+</span></span><span class="edge_blink yes"><span>Edge</span><span title="Requires setting a user preference or runtime flag.">🔰 85+</span></span>
     <hr>
     <span class="edge no"><span>Edge (Legacy)</span><span>None</span></span><span class="ie no"><span>IE</span><span>None</span></span>
     <hr>
     <span class="firefox_android no"><span>Firefox for Android</span><span>?</span></span><span class="safari_ios no"><span>iOS Safari</span><span>?</span></span><span class="chrome_android no"><span>Chrome for Android</span><span>?</span></span><span class="samsunginternet_android no"><span>Samsung Internet</span><span>?</span></span><span class="opera_android no"><span>Opera Mobile</span><span>?</span></span>
    </div>
   </div>
  </details>
<script>/* Boilerplate: script-dom-helper */
"use strict";
function query(sel) { return document.querySelector(sel); }

function queryAll(sel) { return [...document.querySelectorAll(sel)]; }

function iter(obj) {
	if(!obj) return [];
	var it = obj[Symbol.iterator];
	if(it) return it;
	return Object.entries(obj);
}

function mk(tagname, attrs, ...children) {
	const el = document.createElement(tagname);
	for(const [k,v] of iter(attrs)) {
		if(k.slice(0,3) == "_on") {
			const eventName = k.slice(3);
			el.addEventListener(eventName, v);
		} else if(k[0] == "_") {
			// property, not attribute
			el[k.slice(1)] = v;
		} else {
			if(v === false || v == null) {
        continue;
      } else if(v === true) {
        el.setAttribute(k, "");
        continue;
      } else {
  			el.setAttribute(k, v);
      }
		}
	}
	append(el, children);
	return el;
}

/* Create shortcuts for every known HTML element */
[
  "a",
  "abbr",
  "acronym",
  "address",
  "applet",
  "area",
  "article",
  "aside",
  "audio",
  "b",
  "base",
  "basefont",
  "bdo",
  "big",
  "blockquote",
  "body",
  "br",
  "button",
  "canvas",
  "caption",
  "center",
  "cite",
  "code",
  "col",
  "colgroup",
  "datalist",
  "dd",
  "del",
  "details",
  "dfn",
  "dialog",
  "div",
  "dl",
  "dt",
  "em",
  "embed",
  "fieldset",
  "figcaption",
  "figure",
  "font",
  "footer",
  "form",
  "frame",
  "frameset",
  "head",
  "header",
  "h1",
  "h2",
  "h3",
  "h4",
  "h5",
  "h6",
  "hr",
  "html",
  "i",
  "iframe",
  "img",
  "input",
  "ins",
  "kbd",
  "label",
  "legend",
  "li",
  "link",
  "main",
  "map",
  "mark",
  "meta",
  "meter",
  "nav",
  "nobr",
  "noscript",
  "object",
  "ol",
  "optgroup",
  "option",
  "output",
  "p",
  "param",
  "pre",
  "progress",
  "q",
  "s",
  "samp",
  "script",
  "section",
  "select",
  "small",
  "source",
  "span",
  "strike",
  "strong",
  "style",
  "sub",
  "summary",
  "sup",
  "table",
  "tbody",
  "td",
  "template",
  "textarea",
  "tfoot",
  "th",
  "thead",
  "time",
  "title",
  "tr",
  "u",
  "ul",
  "var",
  "video",
  "wbr",
  "xmp",
].forEach(tagname=>{
	mk[tagname] = (...args) => mk(tagname, ...args);
});

function* nodesFromChildList(children) {
	for(const child of children.flat(Infinity)) {
		if(child instanceof Node) {
			yield child;
		} else {
			yield new Text(child);
		}
	}
}
function append(el, ...children) {
	for(const child of nodesFromChildList(children)) {
		if(el instanceof Node) el.appendChild(child);
		else el.push(child);
	}
	return el;
}

function insertAfter(el, ...children) {
	for(const child of nodesFromChildList(children)) {
		el.parentNode.insertBefore(child, el.nextSibling);
	}
	return el;
}

function clearContents(el) {
	el.innerHTML = "";
	return el;
}

function parseHTML(markup) {
	if(markup.toLowerCase().trim().indexOf('<!doctype') === 0) {
		const doc = document.implementation.createHTMLDocument("");
		doc.documentElement.innerHTML = markup;
		return doc;
	} else {
		const el = mk.template({});
		el.innerHTML = markup;
		return el.content;
	}
}</script>
<script>/* Boilerplate: script-dfn-panel */
"use strict";
{
let dfnPanelData = {
"01844357": {"dfnID":"01844357","dfnText":"become browsing-context connected","external":true,"refSections":[{"refs":[{"id":"ref-for-becomes-browsing-context-connected"}],"title":"3. The portal element"}],"url":"https://html.spec.whatwg.org/multipage/infrastructure.html#becomes-browsing-context-connected"},
"0364029f": {"dfnID":"0364029f","dfnText":"request","external":true,"refSections":[{"refs":[{"id":"ref-for-navigation-params-request"},{"id":"ref-for-navigation-params-request\u2460"}],"title":"4.4. Navigation"}],"url":"https://html.spec.whatwg.org/multipage/browsing-the-web.html#navigation-params-request"},
"03675365": {"dfnID":"03675365","dfnText":"event handler idl attribute","external":true,"refSections":[{"refs":[{"id":"ref-for-event-handler-idl-attributes"}],"title":"4.2. Event handlers"}],"url":"https://html.spec.whatwg.org/multipage/webappapis.html#event-handler-idl-attributes"},
"07582c28": {"dfnID":"07582c28","dfnText":"referrer policy","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-request-referrer-policy"}],"title":"3. The portal element"}],"url":"https://fetch.spec.whatwg.org/#concept-request-referrer-policy"},
"085ddd0a": {"dfnID":"085ddd0a","dfnText":"target browsing context","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-environment-target-browsing-context"}],"title":"5.2. Fetch Metadata Request Headers"}],"url":"https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-target-browsing-context"},
"086e3aff": {"dfnID":"086e3aff","dfnText":"origin","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-origin"}],"title":"2. Portal browsing contexts"},{"refs":[{"id":"ref-for-concept-origin\u2460"}],"title":"6.1. Overview"}],"url":"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin"},
"0d0390b4": {"dfnID":"0d0390b4","dfnText":"browsing context","external":true,"refSections":[{"refs":[{"id":"ref-for-browsing-context"},{"id":"ref-for-browsing-context\u2460"},{"id":"ref-for-browsing-context\u2461"}],"title":"2. Portal browsing contexts"},{"refs":[{"id":"ref-for-browsing-context\u2462"},{"id":"ref-for-browsing-context\u2463"}],"title":"3. The portal element"},{"refs":[{"id":"ref-for-browsing-context\u2464"}],"title":"4.3. APIs for creating and navigating browsing contexts by name"}],"url":"https://html.spec.whatwg.org/multipage/document-sequences.html#browsing-context"},
"129bdae8": {"dfnID":"129bdae8","dfnText":"Event","external":true,"refSections":[{"refs":[{"id":"ref-for-event"}],"title":"3.2. The PortalActivateEvent interface"}],"url":"https://dom.spec.whatwg.org/#event"},
"1372f92a": {"dfnID":"1372f92a","dfnText":"dispatch","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-event-dispatch"}],"title":"2. Portal browsing contexts"}],"url":"https://dom.spec.whatwg.org/#concept-event-dispatch"},
"18e7dde9": {"dfnID":"18e7dde9","dfnText":"load","external":true,"refSections":[{"refs":[{"id":"ref-for-event-load"}],"title":"3. The portal element"}],"url":"https://html.spec.whatwg.org/multipage/indices.html#event-load"},
"1968aaab": {"dfnID":"1968aaab","dfnText":"ServiceWorker","external":true,"refSections":[{"refs":[{"id":"ref-for-serviceworker"}],"title":"4.1. The MessageEvent interface"}],"url":"https://w3c.github.io/ServiceWorker/#serviceworker"},
"2594e562": {"dfnID":"2594e562","dfnText":"navigate","external":true,"refSections":[{"refs":[{"id":"ref-for-navigate"},{"id":"ref-for-navigate\u2460"}],"title":"3. The portal element"},{"refs":[{"id":"ref-for-navigate\u2461"}],"title":"4.4. Navigation"}],"url":"https://html.spec.whatwg.org/multipage/browsing-the-web.html#navigate"},
"27ce3281": {"dfnID":"27ce3281","dfnText":"limited to only known values","external":true,"refSections":[{"refs":[{"id":"ref-for-limited-to-only-known-values"}],"title":"3. The portal element"}],"url":"https://html.spec.whatwg.org/multipage/common-dom-interfaces.html#limited-to-only-known-values"},
"27e10eaf": {"dfnID":"27e10eaf","dfnText":"active sandboxing flag set","external":true,"refSections":[{"refs":[{"id":"ref-for-active-sandboxing-flag-set"}],"title":"3. The portal element"}],"url":"https://html.spec.whatwg.org/multipage/browsers.html#active-sandboxing-flag-set"},
"28ad22ad": {"dfnID":"28ad22ad","dfnText":"allowed to download","external":true,"refSections":[{"refs":[{"id":"ref-for-allowed-to-download"}],"title":"4.5. Downloading resources"}],"url":"https://html.spec.whatwg.org/multipage/links.html#allowed-to-download"},
"2bc0cdf4": {"dfnID":"2bc0cdf4","dfnText":"EventTarget","external":true,"refSections":[{"refs":[{"id":"ref-for-eventtarget"}],"title":"3.1. Portal hosts"}],"url":"https://dom.spec.whatwg.org/#eventtarget"},
"2d09a0dd": {"dfnID":"2d09a0dd","dfnText":"referrer policy","external":true,"refSections":[{"refs":[{"id":"ref-for-referrer-policy"}],"title":"3. The portal element"}],"url":"https://w3c.github.io/webappsec-referrer-policy/#referrer-policy"},
"3349d69f": {"dfnID":"3349d69f","dfnText":"associated document","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-document-window"}],"title":"2. Portal browsing contexts"}],"url":"https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window"},
"347e8fe9": {"dfnID":"347e8fe9","dfnText":"url","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-document-url"}],"title":"3. The portal element"}],"url":"https://dom.spec.whatwg.org/#concept-document-url"},
"36858240": {"dfnID":"36858240","dfnText":"boolean","external":true,"refSections":[{"refs":[{"id":"ref-for-boolean"}],"title":"3. The portal element"}],"url":"https://infra.spec.whatwg.org/#boolean"},
"3700794f": {"dfnID":"3700794f","dfnText":"data","external":true,"refSections":[{"refs":[{"id":"ref-for-dom-messageevent-data"}],"title":"3. The portal element"},{"refs":[{"id":"ref-for-dom-messageevent-data\u2460"}],"title":"3.1. Portal hosts"}],"url":"https://html.spec.whatwg.org/multipage/comms.html#dom-messageevent-data"},
"3a711be7": {"dfnID":"3a711be7","dfnText":"scheme","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-url-scheme"}],"title":"3. The portal element"},{"refs":[{"id":"ref-for-concept-url-scheme\u2460"}],"title":"4.4. Navigation"}],"url":"https://url.spec.whatwg.org/#concept-url-scheme"},
"3a89258a": {"dfnID":"3a89258a","dfnText":"event constructing steps","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-event-constructor-ext"}],"title":"3.2. The PortalActivateEvent interface"}],"url":"https://dom.spec.whatwg.org/#concept-event-constructor-ext"},
"3b2ff63e": {"dfnID":"3b2ff63e","dfnText":"browsing context (for Document)","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-document-bc"},{"id":"ref-for-concept-document-bc\u2460"},{"id":"ref-for-concept-document-bc\u2461"},{"id":"ref-for-concept-document-bc\u2462"}],"title":"3. The portal element"}],"url":"https://html.spec.whatwg.org/multipage/document-sequences.html#concept-document-bc"},
"3b367d8d": {"dfnID":"3b367d8d","dfnText":"completely loaded","external":true,"refSections":[{"refs":[{"id":"ref-for-completely-loaded"}],"title":"3. The portal element"}],"url":"https://html.spec.whatwg.org/multipage/parsing.html#completely-loaded"},
"3c307af9": {"dfnID":"3c307af9","dfnText":"creating an element","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-create-element"}],"title":"2. Portal browsing contexts"}],"url":"https://dom.spec.whatwg.org/#concept-create-element"},
"3e8c0e5f": {"dfnID":"3e8c0e5f","dfnText":"MessageEvent","external":true,"refSections":[{"refs":[{"id":"ref-for-messageevent"},{"id":"ref-for-messageevent\u2460"},{"id":"ref-for-messageevent\u2461"},{"id":"ref-for-messageevent\u2462"}],"title":"3. The portal element"},{"refs":[{"id":"ref-for-messageevent\u2463"},{"id":"ref-for-messageevent\u2464"},{"id":"ref-for-messageevent\u2465"},{"id":"ref-for-messageevent\u2466"}],"title":"3.1. Portal hosts"},{"refs":[{"id":"ref-for-messageevent\u2467"}],"title":"3.2. The PortalActivateEvent interface"},{"refs":[{"id":"ref-for-messageevent\u2468"},{"id":"ref-for-messageevent\u2460\u24ea"}],"title":"4.1. The MessageEvent interface"}],"url":"https://html.spec.whatwg.org/multipage/comms.html#messageevent"},
"3f2ca4de": {"dfnID":"3f2ca4de","dfnText":"current url","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-request-current-url"}],"title":"4.4. Navigation"}],"url":"https://fetch.spec.whatwg.org/#concept-request-current-url"},
"4013a022": {"dfnID":"4013a022","dfnText":"this","external":true,"refSections":[{"refs":[{"id":"ref-for-this"},{"id":"ref-for-this\u2460"},{"id":"ref-for-this\u2461"},{"id":"ref-for-this\u2462"},{"id":"ref-for-this\u2463"}],"title":"3. The portal element"},{"refs":[{"id":"ref-for-this\u2464"},{"id":"ref-for-this\u2465"},{"id":"ref-for-this\u2466"},{"id":"ref-for-this\u2467"}],"title":"3.1. Portal hosts"},{"refs":[{"id":"ref-for-this\u2468"},{"id":"ref-for-this\u2460\u24ea"},{"id":"ref-for-this\u2460\u2460"},{"id":"ref-for-this\u2460\u2461"},{"id":"ref-for-this\u2460\u2462"}],"title":"3.2. The PortalActivateEvent interface"}],"url":"https://webidl.spec.whatwg.org/#this"},
"402ed79d": {"dfnID":"402ed79d","dfnText":"CEReactions","external":true,"refSections":[{"refs":[{"id":"ref-for-cereactions"},{"id":"ref-for-cereactions\u2460"}],"title":"3. The portal element"}],"url":"https://html.spec.whatwg.org/multipage/custom-elements.html#cereactions"},
"43ac8374": {"dfnID":"43ac8374","dfnText":"origin (for environment settings object)","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-settings-object-origin"},{"id":"ref-for-concept-settings-object-origin\u2460"},{"id":"ref-for-concept-settings-object-origin\u2461"}],"title":"3. The portal element"},{"refs":[{"id":"ref-for-concept-settings-object-origin\u2462"},{"id":"ref-for-concept-settings-object-origin\u2463"}],"title":"3.1. Portal hosts"}],"url":"https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin"},
"44a7708c": {"dfnID":"44a7708c","dfnText":"EventInit","external":true,"refSections":[{"refs":[{"id":"ref-for-dictdef-eventinit"}],"title":"3.2. The PortalActivateEvent interface"}],"url":"https://dom.spec.whatwg.org/#dictdef-eventinit"},
"461b765a": {"dfnID":"461b765a","dfnText":"value","external":true,"refSections":[{"refs":[{"id":"ref-for-directive-value"}],"title":"5.1.1.1. portal-src Pre-request check"},{"refs":[{"id":"ref-for-directive-value\u2460"}],"title":"5.1.1.2. portal-src Post-request check"}],"url":"https://w3c.github.io/webappsec-csp/#directive-value"},
"48093925": {"dfnID":"48093925","dfnText":"session history","external":true,"refSections":[{"refs":[{"id":"ref-for-session-history"},{"id":"ref-for-session-history\u2460"}],"title":"2. Portal browsing contexts"},{"refs":[{"id":"ref-for-session-history\u2461"}],"title":"4.3. APIs for creating and navigating browsing contexts by name"},{"refs":[{"id":"ref-for-session-history\u2462"}],"title":"4.4. Navigation"}],"url":"https://html.spec.whatwg.org/multipage/history.html#session-history"},
"48438eb3": {"dfnID":"48438eb3","dfnText":"queue a global task","external":true,"refSections":[{"refs":[{"id":"ref-for-queue-a-global-task"},{"id":"ref-for-queue-a-global-task\u2460"},{"id":"ref-for-queue-a-global-task\u2461"},{"id":"ref-for-queue-a-global-task\u2462"}],"title":"2. Portal browsing contexts"},{"refs":[{"id":"ref-for-queue-a-global-task\u2463"}],"title":"3. The portal element"},{"refs":[{"id":"ref-for-queue-a-global-task\u2464"}],"title":"3.2. The PortalActivateEvent interface"}],"url":"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task"},
"4c96ad04": {"dfnID":"4c96ad04","dfnText":"discard a browsing context","external":true,"refSections":[{"refs":[{"id":"ref-for-a-browsing-context-is-discarded"},{"id":"ref-for-a-browsing-context-is-discarded\u2460"},{"id":"ref-for-a-browsing-context-is-discarded\u2461"}],"title":"2. Portal browsing contexts"},{"refs":[{"id":"ref-for-a-browsing-context-is-discarded\u2462"},{"id":"ref-for-a-browsing-context-is-discarded\u2463"},{"id":"ref-for-a-browsing-context-is-discarded\u2464"}],"title":"3. The portal element"}],"url":"https://html.spec.whatwg.org/multipage/window-object.html#a-browsing-context-is-discarded"},
"5216e1a0": {"dfnID":"5216e1a0","dfnText":"node document","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-node-document"}],"title":"2. Portal browsing contexts"},{"refs":[{"id":"ref-for-concept-node-document\u2460"},{"id":"ref-for-concept-node-document\u2461"},{"id":"ref-for-concept-node-document\u2462"},{"id":"ref-for-concept-node-document\u2463"},{"id":"ref-for-concept-node-document\u2464"},{"id":"ref-for-concept-node-document\u2465"}],"title":"3. The portal element"}],"url":"https://dom.spec.whatwg.org/#concept-node-document"},
"521818b9": {"dfnID":"521818b9","dfnText":"same origin-domain","external":true,"refSections":[{"refs":[{"id":"ref-for-same-origin-domain"}],"title":"3. The portal element"}],"url":"https://html.spec.whatwg.org/multipage/browsers.html#same-origin-domain"},
"55213b5b": {"dfnID":"55213b5b","dfnText":"request","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-request"}],"title":"3. The portal element"},{"refs":[{"id":"ref-for-concept-request\u2460"}],"title":"5.1.1.1. portal-src Pre-request check"},{"refs":[{"id":"ref-for-concept-request\u2461"}],"title":"5.1.1.2. portal-src Post-request check"}],"url":"https://fetch.spec.whatwg.org/#concept-request"},
"55a8e1b3": {"dfnID":"55a8e1b3","dfnText":"parse a url","external":true,"refSections":[{"refs":[{"id":"ref-for-parse-a-url"}],"title":"3. The portal element"}],"url":"https://html.spec.whatwg.org/multipage/urls-and-fetching.html#parse-a-url"},
"57807ab9": {"dfnID":"57807ab9","dfnText":"referrer policy attribute","external":true,"refSections":[{"refs":[{"id":"ref-for-referrer-policy-attribute"}],"title":"3. The portal element"}],"url":"https://html.spec.whatwg.org/multipage/urls-and-fetching.html#referrer-policy-attribute"},
"58ebefde": {"dfnID":"58ebefde","dfnText":"auxiliary browsing context","external":true,"refSections":[{"refs":[{"id":"ref-for-auxiliary-browsing-context"}],"title":"3. The portal element"},{"refs":[{"id":"ref-for-auxiliary-browsing-context\u2460"}],"title":"4.3. APIs for creating and navigating browsing contexts by name"}],"url":"https://html.spec.whatwg.org/multipage/document-sequences.html#auxiliary-browsing-context"},
"5ab33979": {"dfnID":"5ab33979","dfnText":"become browsing-context disconnected","external":true,"refSections":[{"refs":[{"id":"ref-for-becomes-browsing-context-disconnected"}],"title":"3. The portal element"}],"url":"https://html.spec.whatwg.org/multipage/infrastructure.html#becomes-browsing-context-disconnected"},
"5ab7b520": {"dfnID":"5ab7b520","dfnText":"reflect","external":true,"refSections":[{"refs":[{"id":"ref-for-reflect"},{"id":"ref-for-reflect\u2460"}],"title":"3. The portal element"}],"url":"https://html.spec.whatwg.org/multipage/common-dom-interfaces.html#reflect"},
"5bec656b": {"dfnID":"5bec656b","dfnText":"prompt to unload","external":true,"refSections":[{"refs":[{"id":"ref-for-prompt-to-unload-a-document"}],"title":"2. Portal browsing contexts"},{"refs":[{"id":"ref-for-prompt-to-unload-a-document\u2460"}],"title":"3. The portal element"}],"url":"https://html.spec.whatwg.org/multipage/browsing-the-web.html#prompt-to-unload-a-document"},
"5d7209e9": {"dfnID":"5d7209e9","dfnText":"Window","external":true,"refSections":[{"refs":[{"id":"ref-for-window"},{"id":"ref-for-window\u2460"}],"title":"3.1. Portal hosts"},{"refs":[{"id":"ref-for-window\u2461"}],"title":"3.2. The PortalActivateEvent interface"},{"refs":[{"id":"ref-for-window\u2462"},{"id":"ref-for-window\u2463"},{"id":"ref-for-window\u2464"},{"id":"ref-for-window\u2465"}],"title":"4.2. Event handlers"}],"url":"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window"},
"5d9c7125": {"dfnID":"5d9c7125","dfnText":"browsing context group","external":true,"refSections":[{"refs":[{"id":"ref-for-browsing-context-group"}],"title":"3. The portal element"}],"url":"https://html.spec.whatwg.org/multipage/browsers.html#browsing-context-group"},
"5f90bbfb": {"dfnID":"5f90bbfb","dfnText":"undefined","external":true,"refSections":[{"refs":[{"id":"ref-for-idl-undefined"},{"id":"ref-for-idl-undefined\u2460"}],"title":"3. The portal element"},{"refs":[{"id":"ref-for-idl-undefined\u2461"}],"title":"3.1. Portal hosts"}],"url":"https://webidl.spec.whatwg.org/#idl-undefined"},
"5fd23811": {"dfnID":"5fd23811","dfnText":"fire an event","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-event-fire"},{"id":"ref-for-concept-event-fire\u2460"},{"id":"ref-for-concept-event-fire\u2461"}],"title":"3. The portal element"},{"refs":[{"id":"ref-for-concept-event-fire\u2462"},{"id":"ref-for-concept-event-fire\u2463"}],"title":"3.1. Portal hosts"}],"url":"https://dom.spec.whatwg.org/#concept-event-fire"},
"65d48b3a": {"dfnID":"65d48b3a","dfnText":"reserved environment","external":true,"refSections":[{"refs":[{"id":"ref-for-navigation-params-reserved-environment"}],"title":"4.4. Navigation"}],"url":"https://html.spec.whatwg.org/multipage/browsing-the-web.html#navigation-params-reserved-environment"},
"663fde87": {"dfnID":"663fde87","dfnText":"resulting url record","external":true,"refSections":[{"refs":[{"id":"ref-for-resulting-url-record"}],"title":"3. The portal element"}],"url":"https://html.spec.whatwg.org/multipage/urls-and-fetching.html#resulting-url-record"},
"6a5a59a0": {"dfnID":"6a5a59a0","dfnText":"event handler","external":true,"refSections":[{"refs":[{"id":"ref-for-event-handlers"},{"id":"ref-for-event-handlers\u2460"}],"title":"4.2. Event handlers"}],"url":"https://html.spec.whatwg.org/multipage/webappapis.html#event-handlers"},
"6c6b1005": {"dfnID":"6c6b1005","dfnText":"any","external":true,"refSections":[{"refs":[{"id":"ref-for-idl-any"},{"id":"ref-for-idl-any\u2460"}],"title":"3. The portal element"},{"refs":[{"id":"ref-for-idl-any\u2461"}],"title":"3.1. Portal hosts"},{"refs":[{"id":"ref-for-idl-any\u2462"},{"id":"ref-for-idl-any\u2463"}],"title":"3.2. The PortalActivateEvent interface"}],"url":"https://webidl.spec.whatwg.org/#idl-any"},
"6d88ab2e": {"dfnID":"6d88ab2e","dfnText":"browsing context (for Window)","external":true,"refSections":[{"refs":[{"id":"ref-for-window-bc"},{"id":"ref-for-window-bc\u2460"}],"title":"3.1. Portal hosts"}],"url":"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window-bc"},
"72aaa5d6": {"dfnID":"72aaa5d6","dfnText":"queue an element task","external":true,"refSections":[{"refs":[{"id":"ref-for-queue-an-element-task"}],"title":"3.1. Portal hosts"}],"url":"https://html.spec.whatwg.org/multipage/webappapis.html#queue-an-element-task"},
"7393da89": {"dfnID":"7393da89","dfnText":"same origin","external":true,"refSections":[{"refs":[{"id":"ref-for-same-origin"}],"title":"2. Portal browsing contexts"},{"refs":[{"id":"ref-for-same-origin\u2460"}],"title":"3. The portal element"},{"refs":[{"id":"ref-for-same-origin\u2461"}],"title":"3.1. Portal hosts"}],"url":"https://html.spec.whatwg.org/multipage/browsers.html#same-origin"},
"75aafb4f": {"dfnID":"75aafb4f","dfnText":"source lists","external":true,"refSections":[{"refs":[{"id":"ref-for-source-lists"}],"title":"5.1.1. portal-src"}],"url":"https://w3c.github.io/webappsec-csp/#source-lists"},
"77b4c09a": {"dfnID":"77b4c09a","dfnText":"assert","external":true,"refSections":[{"refs":[{"id":"ref-for-assert"},{"id":"ref-for-assert\u2460"},{"id":"ref-for-assert\u2461"},{"id":"ref-for-assert\u2462"}],"title":"2. Portal browsing contexts"},{"refs":[{"id":"ref-for-assert\u2463"},{"id":"ref-for-assert\u2464"}],"title":"3. The portal element"}],"url":"https://infra.spec.whatwg.org/#assert"},
"78a97411": {"dfnID":"78a97411","dfnText":"environment discarding steps","external":true,"refSections":[{"refs":[{"id":"ref-for-environment-discarding-steps"}],"title":"4.4. Navigation"}],"url":"https://html.spec.whatwg.org/multipage/webappapis.html#environment-discarding-steps"},
"797018a7": {"dfnID":"797018a7","dfnText":"InvalidStateError","external":true,"refSections":[{"refs":[{"id":"ref-for-invalidstateerror"}],"title":"2. Portal browsing contexts"},{"refs":[{"id":"ref-for-invalidstateerror\u2460"},{"id":"ref-for-invalidstateerror\u2461"},{"id":"ref-for-invalidstateerror\u2462"},{"id":"ref-for-invalidstateerror\u2463"}],"title":"3. The portal element"},{"refs":[{"id":"ref-for-invalidstateerror\u2464"}],"title":"3.1. Portal hosts"},{"refs":[{"id":"ref-for-invalidstateerror\u2465"}],"title":"3.2. The PortalActivateEvent interface"}],"url":"https://webidl.spec.whatwg.org/#invalidstateerror"},
"7b162b57": {"dfnID":"7b162b57","dfnText":"ports","external":true,"refSections":[{"refs":[{"id":"ref-for-dom-messageevent-ports"}],"title":"3. The portal element"},{"refs":[{"id":"ref-for-dom-messageevent-ports\u2460"}],"title":"3.1. Portal hosts"}],"url":"https://html.spec.whatwg.org/multipage/comms.html#dom-messageevent-ports"},
"7c9ab308": {"dfnID":"7c9ab308","dfnText":"promise","external":true,"refSections":[{"refs":[{"id":"ref-for-sec-promise-objects"}],"title":"3. The portal element"},{"refs":[{"id":"ref-for-sec-promise-objects\u2460"}],"title":"3.2. The PortalActivateEvent interface"}],"url":"http://tc39.github.io/ecma262/#sec-promise-objects"},
"7fe0991e": {"dfnID":"7fe0991e","dfnText":"pre-request check","external":true,"refSections":[{"refs":[{"id":"ref-for-directive-pre-request-check"}],"title":"5.1.1.1. portal-src Pre-request check"}],"url":"https://w3c.github.io/webappsec-csp/#directive-pre-request-check"},
"83d7f701": {"dfnID":"83d7f701","dfnText":"agent","external":true,"refSections":[{"refs":[{"id":"ref-for-sec-agents"}],"title":"3. The portal element"}],"url":"http://tc39.github.io/ecma262/#sec-agents"},
"85394472": {"dfnID":"85394472","dfnText":"Document","external":true,"refSections":[{"refs":[{"id":"ref-for-document"}],"title":"2. Portal browsing contexts"},{"refs":[{"id":"ref-for-document\u2460"},{"id":"ref-for-document\u2461"}],"title":"3. The portal element"},{"refs":[{"id":"ref-for-document\u2462"}],"title":"4.3. APIs for creating and navigating browsing contexts by name"},{"refs":[{"id":"ref-for-document\u2463"}],"title":"4.4. Navigation"}],"url":"https://dom.spec.whatwg.org/#document"},
"87fcd40c": {"dfnID":"87fcd40c","dfnText":"iframe","external":true,"refSections":[{"refs":[{"id":"ref-for-the-iframe-element"},{"id":"ref-for-the-iframe-element\u2460"},{"id":"ref-for-the-iframe-element\u2461"}],"title":"3. The portal element"},{"refs":[{"id":"ref-for-the-iframe-element\u2462"}],"title":"5.2. Fetch Metadata Request Headers"}],"url":"https://html.spec.whatwg.org/multipage/iframe-embed-object.html#the-iframe-element"},
"8855a9aa": {"dfnID":"8855a9aa","dfnText":"DOMString","external":true,"refSections":[{"refs":[{"id":"ref-for-idl-DOMString"}],"title":"3. The portal element"},{"refs":[{"id":"ref-for-idl-DOMString\u2460"}],"title":"3.2. The PortalActivateEvent interface"}],"url":"https://webidl.spec.whatwg.org/#idl-DOMString"},
"889e932f": {"dfnID":"889e932f","dfnText":"Exposed","external":true,"refSections":[{"refs":[{"id":"ref-for-Exposed"}],"title":"3. The portal element"},{"refs":[{"id":"ref-for-Exposed\u2460"}],"title":"3.1. Portal hosts"},{"refs":[{"id":"ref-for-Exposed\u2461"}],"title":"3.2. The PortalActivateEvent interface"}],"url":"https://webidl.spec.whatwg.org/#Exposed"},
"8abfc3b6": {"dfnID":"8abfc3b6","dfnText":"creating an event","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-event-create"}],"title":"2. Portal browsing contexts"}],"url":"https://dom.spec.whatwg.org/#concept-event-create"},
"8baa72cd": {"dfnID":"8baa72cd","dfnText":"WindowEventHandlers","external":true,"refSections":[{"refs":[{"id":"ref-for-windoweventhandlers"},{"id":"ref-for-windoweventhandlers\u2460"}],"title":"4.2. Event handlers"}],"url":"https://html.spec.whatwg.org/multipage/webappapis.html#windoweventhandlers"},
"8bd6a569": {"dfnID":"8bd6a569","dfnText":"unload (for Window)","external":true,"refSections":[{"refs":[{"id":"ref-for-event-unload"}],"title":"2. Portal browsing contexts"}],"url":"https://html.spec.whatwg.org/multipage/indices.html#event-unload"},
"8ea172e9": {"dfnID":"8ea172e9","dfnText":"sandbox","external":true,"refSections":[{"refs":[{"id":"ref-for-sandbox"}],"title":"3. The portal element"}],"url":"https://w3c.github.io/webappsec-csp/#sandbox"},
"8f1a9afe": {"dfnID":"8f1a9afe","dfnText":"serialized-source-list","external":true,"refSections":[{"refs":[{"id":"ref-for-grammardef-serialized-source-list"}],"title":"5.1.1. portal-src"}],"url":"https://w3c.github.io/webappsec-csp/#grammardef-serialized-source-list"},
"9042040b": {"dfnID":"9042040b","dfnText":"close a browsing context","external":true,"refSections":[{"refs":[{"id":"ref-for-close-a-browsing-context"},{"id":"ref-for-close-a-browsing-context\u2460"},{"id":"ref-for-close-a-browsing-context\u2461"}],"title":"2. Portal browsing contexts"},{"refs":[{"id":"ref-for-close-a-browsing-context\u2462"},{"id":"ref-for-close-a-browsing-context\u2463"},{"id":"ref-for-close-a-browsing-context\u2464"}],"title":"3. The portal element"}],"url":"https://html.spec.whatwg.org/multipage/window-object.html#close-a-browsing-context"},
"94039a0c": {"dfnID":"94039a0c","dfnText":"WindowProxy","external":true,"refSections":[{"refs":[{"id":"ref-for-windowproxy"}],"title":"2. Portal browsing contexts"},{"refs":[{"id":"ref-for-windowproxy\u2460"}],"title":"3. The portal element"},{"refs":[{"id":"ref-for-windowproxy\u2461"}],"title":"4.1. The MessageEvent interface"}],"url":"https://html.spec.whatwg.org/multipage/nav-history-apis.html#windowproxy"},
"973aaf8e": {"dfnID":"973aaf8e","dfnText":"HTMLConstructor","external":true,"refSections":[{"refs":[{"id":"ref-for-htmlconstructor"}],"title":"3. The portal element"}],"url":"https://html.spec.whatwg.org/multipage/dom.html#htmlconstructor"},
"9c4c1e66": {"dfnID":"9c4c1e66","dfnText":"relevant settings object","external":true,"refSections":[{"refs":[{"id":"ref-for-relevant-settings-object"},{"id":"ref-for-relevant-settings-object\u2460"},{"id":"ref-for-relevant-settings-object\u2461"}],"title":"3. The portal element"},{"refs":[{"id":"ref-for-relevant-settings-object\u2462"},{"id":"ref-for-relevant-settings-object\u2463"}],"title":"3.1. Portal hosts"}],"url":"https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object"},
"9d09d04c": {"dfnID":"9d09d04c","dfnText":"type","external":true,"refSections":[{"refs":[{"id":"ref-for-dom-event-type"}],"title":"2. Portal browsing contexts"}],"url":"https://dom.spec.whatwg.org/#dom-event-type"},
"9d386f55": {"dfnID":"9d386f55","dfnText":"event handler event type","external":true,"refSections":[{"refs":[{"id":"ref-for-event-handler-event-type"}],"title":"4.2. Event handlers"}],"url":"https://html.spec.whatwg.org/multipage/webappapis.html#event-handler-event-type"},
"9da834a1": {"dfnID":"9da834a1","dfnText":"StructuredSerializeWithTransfer","external":true,"refSections":[{"refs":[{"id":"ref-for-structuredserializewithtransfer"},{"id":"ref-for-structuredserializewithtransfer\u2460"}],"title":"3. The portal element"},{"refs":[{"id":"ref-for-structuredserializewithtransfer\u2461"}],"title":"3.1. Portal hosts"}],"url":"https://html.spec.whatwg.org/multipage/structured-data.html#structuredserializewithtransfer"},
"9e690900": {"dfnID":"9e690900","dfnText":"create a new top-level browsing context","external":true,"refSections":[{"refs":[{"id":"ref-for-creating-a-new-top-level-browsing-context"}],"title":"3. The portal element"}],"url":"https://html.spec.whatwg.org/multipage/browsers.html#creating-a-new-top-level-browsing-context"},
"a0d0a7c7": {"dfnID":"a0d0a7c7","dfnText":"source","external":true,"refSections":[{"refs":[{"id":"ref-for-dom-messageevent-source"},{"id":"ref-for-dom-messageevent-source\u2460"}],"title":"3. The portal element"},{"refs":[{"id":"ref-for-dom-messageevent-source\u2461"},{"id":"ref-for-dom-messageevent-source\u2462"}],"title":"3.1. Portal hosts"}],"url":"https://html.spec.whatwg.org/multipage/comms.html#dom-messageevent-source"},
"a1d47575": {"dfnID":"a1d47575","dfnText":"status","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-response-status"}],"title":"4.4. Navigation"}],"url":"https://fetch.spec.whatwg.org/#concept-response-status"},
"a72449dd": {"dfnID":"a72449dd","dfnText":"in parallel","external":true,"refSections":[{"refs":[{"id":"ref-for-in-parallel"}],"title":"2. Portal browsing contexts"}],"url":"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel"},
"a9910bde": {"dfnID":"a9910bde","dfnText":"adopting steps","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-node-adopt-ext"}],"title":"3. The portal element"}],"url":"https://dom.spec.whatwg.org/#concept-node-adopt-ext"},
"abbed741": {"dfnID":"abbed741","dfnText":"frozen array type","external":true,"refSections":[{"refs":[{"id":"ref-for-dfn-frozen-array-type"}],"title":"3. The portal element"},{"refs":[{"id":"ref-for-dfn-frozen-array-type\u2460"}],"title":"3.1. Portal hosts"}],"url":"https://webidl.spec.whatwg.org/#dfn-frozen-array-type"},
"abe352cd": {"dfnID":"abe352cd","dfnText":"reserved client","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-request-reserved-client"}],"title":"5.2. Fetch Metadata Request Headers"}],"url":"https://fetch.spec.whatwg.org/#concept-request-reserved-client"},
"activate-a-portal-browsing-context": {"dfnID":"activate-a-portal-browsing-context","dfnText":"activate a portal browsing context","external":false,"refSections":[{"refs":[{"id":"ref-for-activate-a-portal-browsing-context"},{"id":"ref-for-activate-a-portal-browsing-context\u2460"}],"title":"2. Portal browsing contexts"},{"refs":[{"id":"ref-for-activate-a-portal-browsing-context\u2461"},{"id":"ref-for-activate-a-portal-browsing-context\u2462"}],"title":"3. The portal element"},{"refs":[{"id":"ref-for-activate-a-portal-browsing-context\u2463"},{"id":"ref-for-activate-a-portal-browsing-context\u2464"}],"title":"3.1. Portal hosts"}],"url":"#activate-a-portal-browsing-context"},
"adb85093": {"dfnID":"adb85093","dfnText":"post-request check","external":true,"refSections":[{"refs":[{"id":"ref-for-directive-post-request-check"}],"title":"5.1.1.2. portal-src Post-request check"}],"url":"https://w3c.github.io/webappsec-csp/#directive-post-request-check"},
"adopt-the-predecessor-browsing-context": {"dfnID":"adopt-the-predecessor-browsing-context","dfnText":"adopt the predecessor browsing context","external":false,"refSections":[{"refs":[{"id":"ref-for-adopt-the-predecessor-browsing-context"},{"id":"ref-for-adopt-the-predecessor-browsing-context\u2460"}],"title":"2. Portal browsing contexts"},{"refs":[{"id":"ref-for-adopt-the-predecessor-browsing-context\u2461"},{"id":"ref-for-adopt-the-predecessor-browsing-context\u2462"}],"title":"3. The portal element"},{"refs":[{"id":"ref-for-adopt-the-predecessor-browsing-context\u2463"}],"title":"3.2. The PortalActivateEvent interface"}],"url":"#adopt-the-predecessor-browsing-context"},
"ae2a6342": {"dfnID":"ae2a6342","dfnText":"top-level browsing context","external":true,"refSections":[{"refs":[{"id":"ref-for-top-level-browsing-context"}],"title":"1. Introduction"},{"refs":[{"id":"ref-for-top-level-browsing-context\u2460"},{"id":"ref-for-top-level-browsing-context\u2461"}],"title":"3. The portal element"},{"refs":[{"id":"ref-for-top-level-browsing-context\u2462"}],"title":"3.2. The PortalActivateEvent interface"},{"refs":[{"id":"ref-for-top-level-browsing-context\u2463"}],"title":"4.3. APIs for creating and navigating browsing contexts by name"}],"url":"https://html.spec.whatwg.org/multipage/document-sequences.html#top-level-browsing-context"},
"b08d0bb2": {"dfnID":"b08d0bb2","dfnText":"HTMLElement","external":true,"refSections":[{"refs":[{"id":"ref-for-htmlelement"}],"title":"3. The portal element"}],"url":"https://html.spec.whatwg.org/multipage/dom.html#htmlelement"},
"b0d7f3c3": {"dfnID":"b0d7f3c3","dfnText":"USVString","external":true,"refSections":[{"refs":[{"id":"ref-for-idl-USVString"}],"title":"3. The portal element"}],"url":"https://webidl.spec.whatwg.org/#idl-USVString"},
"b262501e": {"dfnID":"b262501e","dfnText":"reject","external":true,"refSections":[{"refs":[{"id":"ref-for-reject"}],"title":"2. Portal browsing contexts"}],"url":"https://webidl.spec.whatwg.org/#reject"},
"b75a7d23": {"dfnID":"b75a7d23","dfnText":"realm (for global object)","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-global-object-realm"}],"title":"2. Portal browsing contexts"},{"refs":[{"id":"ref-for-concept-global-object-realm\u2460"}],"title":"3. The portal element"}],"url":"https://html.spec.whatwg.org/multipage/webappapis.html#concept-global-object-realm"},
"b78d6a64": {"dfnID":"b78d6a64","dfnText":"event loop (for agent)","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-agent-event-loop"}],"title":"3. The portal element"}],"url":"https://html.spec.whatwg.org/multipage/webappapis.html#concept-agent-event-loop"},
"b7c21a86": {"dfnID":"b7c21a86","dfnText":"content-security-policy","external":true,"refSections":[{"refs":[{"id":"ref-for-header-content-security-policy"}],"title":"5.1.1. portal-src"}],"url":"https://w3c.github.io/webappsec-csp/#header-content-security-policy"},
"ba4c841d": {"dfnID":"ba4c841d","dfnText":"unload","external":true,"refSections":[{"refs":[{"id":"ref-for-unload-a-document"},{"id":"ref-for-unload-a-document\u2460"}],"title":"2. Portal browsing contexts"}],"url":"https://html.spec.whatwg.org/multipage/browsing-the-web.html#unload-a-document"},
"bdbd19d1": {"dfnID":"bdbd19d1","dfnText":"Promise","external":true,"refSections":[{"refs":[{"id":"ref-for-idl-promise"}],"title":"3. The portal element"}],"url":"https://webidl.spec.whatwg.org/#idl-promise"},
"bec14ad5": {"dfnID":"bec14ad5","dfnText":"activation behavior","external":true,"refSections":[{"refs":[{"id":"ref-for-eventtarget-activation-behavior"}],"title":"3. The portal element"}],"url":"https://dom.spec.whatwg.org/#eventtarget-activation-behavior"},
"c3b2d08c": {"dfnID":"c3b2d08c","dfnText":"task source","external":true,"refSections":[{"refs":[{"id":"ref-for-task-source"},{"id":"ref-for-task-source\u2460"}],"title":"2. Portal browsing contexts"}],"url":"https://html.spec.whatwg.org/multipage/webappapis.html#task-source"},
"c62cd7cf": {"dfnID":"c62cd7cf","dfnText":"origin","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-document-origin"}],"title":"2. Portal browsing contexts"},{"refs":[{"id":"ref-for-concept-document-origin\u2460"}],"title":"3. The portal element"}],"url":"https://dom.spec.whatwg.org/#concept-document-origin"},
"c6d19e56": {"dfnID":"c6d19e56","dfnText":"event loop","external":true,"refSections":[{"refs":[{"id":"ref-for-event-loop"},{"id":"ref-for-event-loop\u2460"}],"title":"3.1. Portal hosts"}],"url":"https://html.spec.whatwg.org/multipage/webappapis.html#event-loop"},
"c807e273": {"dfnID":"c807e273","dfnText":"NewObject","external":true,"refSections":[{"refs":[{"id":"ref-for-NewObject"}],"title":"3. The portal element"}],"url":"https://webidl.spec.whatwg.org/#NewObject"},
"cad61a81": {"dfnID":"cad61a81","dfnText":"valid non-empty url potentially surrounded by spaces","external":true,"refSections":[{"refs":[{"id":"ref-for-valid-non-empty-url-potentially-surrounded-by-spaces"}],"title":"3. The portal element"}],"url":"https://html.spec.whatwg.org/multipage/urls-and-fetching.html#valid-non-empty-url-potentially-surrounded-by-spaces"},
"cc6d9aed": {"dfnID":"cc6d9aed","dfnText":"event handler content attribute","external":true,"refSections":[{"refs":[{"id":"ref-for-event-handler-content-attributes"}],"title":"3. The portal element"}],"url":"https://html.spec.whatwg.org/multipage/webappapis.html#event-handler-content-attributes"},
"cd2846d6": {"dfnID":"cd2846d6","dfnText":"script-closable","external":true,"refSections":[{"refs":[{"id":"ref-for-script-closable"}],"title":"4.3. APIs for creating and navigating browsing contexts by name"}],"url":"https://html.spec.whatwg.org/multipage/nav-history-apis.html#script-closable"},
"close-a-portal-element": {"dfnID":"close-a-portal-element","dfnText":"close a portal element","external":false,"refSections":[{"refs":[{"id":"ref-for-close-a-portal-element"}],"title":"3. The portal element"},{"refs":[{"id":"ref-for-close-a-portal-element\u2460"},{"id":"ref-for-close-a-portal-element\u2461"}],"title":"4.4. Navigation"},{"refs":[{"id":"ref-for-close-a-portal-element\u2462"}],"title":"5.1.1. portal-src"}],"url":"#close-a-portal-element"},
"d1ee46ce": {"dfnID":"d1ee46ce","dfnText":"realm (for environment settings object)","external":true,"refSections":[{"refs":[{"id":"ref-for-environment-settings-object's-realm"}],"title":"3.1. Portal hosts"}],"url":"https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object's-realm"},
"dae0bfde": {"dfnID":"dae0bfde","dfnText":"serialization of an origin","external":true,"refSections":[{"refs":[{"id":"ref-for-ascii-serialisation-of-an-origin"}],"title":"3. The portal element"},{"refs":[{"id":"ref-for-ascii-serialisation-of-an-origin\u2460"}],"title":"3.1. Portal hosts"}],"url":"https://html.spec.whatwg.org/multipage/browsers.html#ascii-serialisation-of-an-origin"},
"dc1cd39b": {"dfnID":"dc1cd39b","dfnText":"url","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-request-url"}],"title":"3. The portal element"}],"url":"https://fetch.spec.whatwg.org/#concept-request-url"},
"dca2de17": {"dfnID":"dca2de17","dfnText":"DOMException","external":true,"refSections":[{"refs":[{"id":"ref-for-idl-DOMException"}],"title":"2. Portal browsing contexts"},{"refs":[{"id":"ref-for-idl-DOMException\u2460"},{"id":"ref-for-idl-DOMException\u2461"},{"id":"ref-for-idl-DOMException\u2462"},{"id":"ref-for-idl-DOMException\u2463"}],"title":"3. The portal element"},{"refs":[{"id":"ref-for-idl-DOMException\u2464"}],"title":"3.1. Portal hosts"},{"refs":[{"id":"ref-for-idl-DOMException\u2465"}],"title":"3.2. The PortalActivateEvent interface"}],"url":"https://webidl.spec.whatwg.org/#idl-DOMException"},
"dcffbccd": {"dfnID":"dcffbccd","dfnText":"url","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-url"}],"title":"3. The portal element"}],"url":"https://url.spec.whatwg.org/#concept-url"},
"df16744f": {"dfnID":"df16744f","dfnText":"MessagePort","external":true,"refSections":[{"refs":[{"id":"ref-for-messageport"}],"title":"3. The portal element"},{"refs":[{"id":"ref-for-messageport\u2460"}],"title":"3.1. Portal hosts"},{"refs":[{"id":"ref-for-messageport\u2461"}],"title":"4.1. The MessageEvent interface"}],"url":"https://html.spec.whatwg.org/multipage/web-messaging.html#messageport"},
"dictdef-portalactivateeventinit": {"dfnID":"dictdef-portalactivateeventinit","dfnText":"PortalActivateEventInit","external":false,"refSections":[{"refs":[{"id":"ref-for-dictdef-portalactivateeventinit"}],"title":"3.2. The PortalActivateEvent interface"}],"url":"#dictdef-portalactivateeventinit"},
"dictdef-portalactivateoptions": {"dfnID":"dictdef-portalactivateoptions","dfnText":"PortalActivateOptions","external":false,"refSections":[{"refs":[{"id":"ref-for-dictdef-portalactivateoptions"}],"title":"3. The portal element"}],"url":"#dictdef-portalactivateoptions"},
"dom-htmlportalelement-activate": {"dfnID":"dom-htmlportalelement-activate","dfnText":"activate(options)","external":false,"refSections":[{"refs":[{"id":"ref-for-dom-htmlportalelement-activate"},{"id":"ref-for-dom-htmlportalelement-activate\u2460"}],"title":"2. Portal browsing contexts"},{"refs":[{"id":"ref-for-dom-htmlportalelement-activate\u2461"},{"id":"ref-for-dom-htmlportalelement-activate\u2462"}],"title":"3. The portal element"}],"url":"#dom-htmlportalelement-activate"},
"dom-htmlportalelement-activate-options-options": {"dfnID":"dom-htmlportalelement-activate-options-options","dfnText":"options","external":false,"refSections":[],"url":"#dom-htmlportalelement-activate-options-options"},
"dom-htmlportalelement-onmessage": {"dfnID":"dom-htmlportalelement-onmessage","dfnText":"onmessage","external":false,"refSections":[{"refs":[{"id":"ref-for-dom-htmlportalelement-onmessage"}],"title":"3. The portal element"}],"url":"#dom-htmlportalelement-onmessage"},
"dom-htmlportalelement-onmessageerror": {"dfnID":"dom-htmlportalelement-onmessageerror","dfnText":"onmessageerror","external":false,"refSections":[{"refs":[{"id":"ref-for-dom-htmlportalelement-onmessageerror"}],"title":"3. The portal element"}],"url":"#dom-htmlportalelement-onmessageerror"},
"dom-htmlportalelement-postmessage": {"dfnID":"dom-htmlportalelement-postmessage","dfnText":"postMessage(message, options)","external":false,"refSections":[{"refs":[{"id":"ref-for-dom-htmlportalelement-postmessage"}],"title":"3. The portal element"}],"url":"#dom-htmlportalelement-postmessage"},
"dom-htmlportalelement-postmessage-message-options-message": {"dfnID":"dom-htmlportalelement-postmessage-message-options-message","dfnText":"message","external":false,"refSections":[],"url":"#dom-htmlportalelement-postmessage-message-options-message"},
"dom-htmlportalelement-postmessage-message-options-options": {"dfnID":"dom-htmlportalelement-postmessage-message-options-options","dfnText":"options","external":false,"refSections":[],"url":"#dom-htmlportalelement-postmessage-message-options-options"},
"dom-htmlportalelement-referrerpolicy": {"dfnID":"dom-htmlportalelement-referrerpolicy","dfnText":"referrerPolicy","external":false,"refSections":[{"refs":[{"id":"ref-for-dom-htmlportalelement-referrerpolicy"}],"title":"3. The portal element"}],"url":"#dom-htmlportalelement-referrerpolicy"},
"dom-htmlportalelement-src": {"dfnID":"dom-htmlportalelement-src","dfnText":"src","external":false,"refSections":[{"refs":[{"id":"ref-for-dom-htmlportalelement-src"}],"title":"3. The portal element"}],"url":"#dom-htmlportalelement-src"},
"dom-portalactivateevent-adoptpredecessor": {"dfnID":"dom-portalactivateevent-adoptpredecessor","dfnText":"adoptPredecessor()","external":false,"refSections":[{"refs":[{"id":"ref-for-dom-portalactivateevent-adoptpredecessor"},{"id":"ref-for-dom-portalactivateevent-adoptpredecessor\u2460"}],"title":"2. Portal browsing contexts"},{"refs":[{"id":"ref-for-dom-portalactivateevent-adoptpredecessor\u2461"}],"title":"3.2. The PortalActivateEvent interface"}],"url":"#dom-portalactivateevent-adoptpredecessor"},
"dom-portalactivateevent-data": {"dfnID":"dom-portalactivateevent-data","dfnText":"data","external":false,"refSections":[{"refs":[{"id":"ref-for-dom-portalactivateevent-data"}],"title":"2. Portal browsing contexts"}],"url":"#dom-portalactivateevent-data"},
"dom-portalactivateevent-portalactivateevent": {"dfnID":"dom-portalactivateevent-portalactivateevent","dfnText":"constructor","external":false,"refSections":[],"url":"#dom-portalactivateevent-portalactivateevent"},
"dom-portalactivateevent-portalactivateevent-type-eventinitdict-eventinitdict": {"dfnID":"dom-portalactivateevent-portalactivateevent-type-eventinitdict-eventinitdict","dfnText":"eventInitDict","external":false,"refSections":[],"url":"#dom-portalactivateevent-portalactivateevent-type-eventinitdict-eventinitdict"},
"dom-portalactivateevent-portalactivateevent-type-eventinitdict-type": {"dfnID":"dom-portalactivateevent-portalactivateevent-type-eventinitdict-type","dfnText":"type","external":false,"refSections":[],"url":"#dom-portalactivateevent-portalactivateevent-type-eventinitdict-type"},
"dom-portalactivateeventinit-data": {"dfnID":"dom-portalactivateeventinit-data","dfnText":"data","external":false,"refSections":[],"url":"#dom-portalactivateeventinit-data"},
"dom-portalactivateoptions-data": {"dfnID":"dom-portalactivateoptions-data","dfnText":"data","external":false,"refSections":[{"refs":[{"id":"ref-for-dom-portalactivateoptions-data"}],"title":"3. The portal element"}],"url":"#dom-portalactivateoptions-data"},
"dom-portalhost-onmessage": {"dfnID":"dom-portalhost-onmessage","dfnText":"onmessage","external":false,"refSections":[],"url":"#dom-portalhost-onmessage"},
"dom-portalhost-onmessageerror": {"dfnID":"dom-portalhost-onmessageerror","dfnText":"onmessageerror","external":false,"refSections":[],"url":"#dom-portalhost-onmessageerror"},
"dom-portalhost-postmessage": {"dfnID":"dom-portalhost-postmessage","dfnText":"postMessage(message, options)","external":false,"refSections":[{"refs":[{"id":"ref-for-dom-portalhost-postmessage"}],"title":"3.1. Portal hosts"}],"url":"#dom-portalhost-postmessage"},
"dom-portalhost-postmessage-message-options-message": {"dfnID":"dom-portalhost-postmessage-message-options-message","dfnText":"message","external":false,"refSections":[],"url":"#dom-portalhost-postmessage-message-options-message"},
"dom-portalhost-postmessage-message-options-options": {"dfnID":"dom-portalhost-postmessage-message-options-options","dfnText":"options","external":false,"refSections":[],"url":"#dom-portalhost-postmessage-message-options-options"},
"dom-window-onportalactivate": {"dfnID":"dom-window-onportalactivate","dfnText":"onportalactivate","external":false,"refSections":[],"url":"#dom-window-onportalactivate"},
"dom-window-portalhost": {"dfnID":"dom-window-portalhost","dfnText":"portalHost","external":false,"refSections":[{"refs":[{"id":"ref-for-dom-window-portalhost"},{"id":"ref-for-dom-window-portalhost\u2460"},{"id":"ref-for-dom-window-portalhost\u2461"}],"title":"3.1. Portal hosts"}],"url":"#dom-window-portalhost"},
"dom-windoweventhandlers-onportalactivate": {"dfnID":"dom-windoweventhandlers-onportalactivate","dfnText":"onportalactivate","external":false,"refSections":[],"url":"#dom-windoweventhandlers-onportalactivate"},
"e0eefdd9": {"dfnID":"e0eefdd9","dfnText":"origin (for MessageEvent)","external":true,"refSections":[{"refs":[{"id":"ref-for-dom-messageevent-origin"},{"id":"ref-for-dom-messageevent-origin\u2460"}],"title":"3. The portal element"},{"refs":[{"id":"ref-for-dom-messageevent-origin\u2461"},{"id":"ref-for-dom-messageevent-origin\u2462"}],"title":"3.1. Portal hosts"}],"url":"https://html.spec.whatwg.org/multipage/comms.html#dom-messageevent-origin"},
"e7cb09fb": {"dfnID":"e7cb09fb","dfnText":"StructuredDeserializeWithTransfer","external":true,"refSections":[{"refs":[{"id":"ref-for-structureddeserializewithtransfer"}],"title":"2. Portal browsing contexts"},{"refs":[{"id":"ref-for-structureddeserializewithtransfer\u2460"}],"title":"3. The portal element"},{"refs":[{"id":"ref-for-structureddeserializewithtransfer\u2461"}],"title":"3.1. Portal hosts"}],"url":"https://html.spec.whatwg.org/multipage/structured-data.html#structureddeserializewithtransfer"},
"e809a09f": {"dfnID":"e809a09f","dfnText":"browsing-context connected","external":true,"refSections":[{"refs":[{"id":"ref-for-browsing-context-connected"}],"title":"2. Portal browsing contexts"},{"refs":[{"id":"ref-for-browsing-context-connected\u2460"}],"title":"3. The portal element"}],"url":"https://html.spec.whatwg.org/multipage/infrastructure.html#browsing-context-connected"},
"e99bd18e": {"dfnID":"e99bd18e","dfnText":"relevant global object","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-relevant-global"}],"title":"3.1. Portal hosts"}],"url":"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global"},
"eb62573b": {"dfnID":"eb62573b","dfnText":"http(s) scheme","external":true,"refSections":[{"refs":[{"id":"ref-for-http-scheme"},{"id":"ref-for-http-scheme\u2460"}],"title":"3. The portal element"},{"refs":[{"id":"ref-for-http-scheme\u2461"}],"title":"4.4. Navigation"}],"url":"https://fetch.spec.whatwg.org/#http-scheme"},
"ee7bba09": {"dfnID":"ee7bba09","dfnText":"response","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-response"}],"title":"5.1.1.2. portal-src Post-request check"}],"url":"https://fetch.spec.whatwg.org/#concept-response"},
"element-attrdef-portal-referrerpolicy": {"dfnID":"element-attrdef-portal-referrerpolicy","dfnText":"referrerpolicy","external":false,"refSections":[{"refs":[{"id":"ref-for-element-attrdef-portal-referrerpolicy"},{"id":"ref-for-element-attrdef-portal-referrerpolicy\u2460"}],"title":"3. The portal element"}],"url":"#element-attrdef-portal-referrerpolicy"},
"element-attrdef-portal-src": {"dfnID":"element-attrdef-portal-src","dfnText":"src","external":false,"refSections":[{"refs":[{"id":"ref-for-element-attrdef-portal-src"},{"id":"ref-for-element-attrdef-portal-src\u2460"},{"id":"ref-for-element-attrdef-portal-src\u2461"},{"id":"ref-for-element-attrdef-portal-src\u2462"},{"id":"ref-for-element-attrdef-portal-src\u2463"}],"title":"3. The portal element"}],"url":"#element-attrdef-portal-src"},
"elementdef-portal": {"dfnID":"elementdef-portal","dfnText":"portal","external":false,"refSections":[{"refs":[{"id":"ref-for-elementdef-portal"},{"id":"ref-for-elementdef-portal\u2460"},{"id":"ref-for-elementdef-portal\u2461"}],"title":"2. Portal browsing contexts"},{"refs":[{"id":"ref-for-elementdef-portal\u2462"},{"id":"ref-for-elementdef-portal\u2463"},{"id":"ref-for-elementdef-portal\u2464"},{"id":"ref-for-elementdef-portal\u2465"},{"id":"ref-for-elementdef-portal\u2466"},{"id":"ref-for-elementdef-portal\u2467"},{"id":"ref-for-elementdef-portal\u2468"},{"id":"ref-for-elementdef-portal\u2460\u24ea"},{"id":"ref-for-elementdef-portal\u2460\u2460"},{"id":"ref-for-elementdef-portal\u2460\u2461"},{"id":"ref-for-elementdef-portal\u2460\u2462"},{"id":"ref-for-elementdef-portal\u2460\u2463"},{"id":"ref-for-elementdef-portal\u2460\u2464"},{"id":"ref-for-elementdef-portal\u2460\u2465"},{"id":"ref-for-elementdef-portal\u2460\u2466"},{"id":"ref-for-elementdef-portal\u2460\u2467"},{"id":"ref-for-elementdef-portal\u2460\u2468"},{"id":"ref-for-elementdef-portal\u2461\u24ea"},{"id":"ref-for-elementdef-portal\u2461\u2460"},{"id":"ref-for-elementdef-portal\u2461\u2461"},{"id":"ref-for-elementdef-portal\u2461\u2462"},{"id":"ref-for-elementdef-portal\u2461\u2463"}],"title":"3. The portal element"},{"refs":[{"id":"ref-for-elementdef-portal\u2461\u2464"}],"title":"3.2. The PortalActivateEvent interface"}],"url":"#elementdef-portal"},
"eventdef-htmlportalelement-message": {"dfnID":"eventdef-htmlportalelement-message","dfnText":"message","external":false,"refSections":[{"refs":[{"id":"ref-for-eventdef-htmlportalelement-message"}],"title":"3.1. Portal hosts"}],"url":"#eventdef-htmlportalelement-message"},
"eventdef-htmlportalelement-messageerror": {"dfnID":"eventdef-htmlportalelement-messageerror","dfnText":"messageerror","external":false,"refSections":[{"refs":[{"id":"ref-for-eventdef-htmlportalelement-messageerror"}],"title":"3.1. Portal hosts"}],"url":"#eventdef-htmlportalelement-messageerror"},
"eventdef-portalhost-message": {"dfnID":"eventdef-portalhost-message","dfnText":"message","external":false,"refSections":[{"refs":[{"id":"ref-for-eventdef-portalhost-message"}],"title":"3. The portal element"}],"url":"#eventdef-portalhost-message"},
"eventdef-portalhost-messageerror": {"dfnID":"eventdef-portalhost-messageerror","dfnText":"messageerror","external":false,"refSections":[{"refs":[{"id":"ref-for-eventdef-portalhost-messageerror"}],"title":"3. The portal element"}],"url":"#eventdef-portalhost-messageerror"},
"eventdef-window-portalactivate": {"dfnID":"eventdef-window-portalactivate","dfnText":"portalactivate","external":false,"refSections":[{"refs":[{"id":"ref-for-eventdef-window-portalactivate"},{"id":"ref-for-eventdef-window-portalactivate\u2460"}],"title":"2. Portal browsing contexts"},{"refs":[{"id":"ref-for-eventdef-window-portalactivate\u2461"}],"title":"3. The portal element"},{"refs":[{"id":"ref-for-eventdef-window-portalactivate\u2462"}],"title":"3.2. The PortalActivateEvent interface"},{"refs":[{"id":"ref-for-eventdef-window-portalactivate\u2463"}],"title":"4.2. Event handlers"}],"url":"#eventdef-window-portalactivate"},
"f052b1ea": {"dfnID":"f052b1ea","dfnText":"html namespace","external":true,"refSections":[{"refs":[{"id":"ref-for-html-namespace"}],"title":"2. Portal browsing contexts"}],"url":"https://infra.spec.whatwg.org/#html-namespace"},
"f0951476": {"dfnID":"f0951476","dfnText":"EventHandler","external":true,"refSections":[{"refs":[{"id":"ref-for-eventhandler"},{"id":"ref-for-eventhandler\u2460"}],"title":"3. The portal element"},{"refs":[{"id":"ref-for-eventhandler\u2461"},{"id":"ref-for-eventhandler\u2462"}],"title":"3.1. Portal hosts"},{"refs":[{"id":"ref-for-eventhandler\u2463"}],"title":"4.2. Event handlers"}],"url":"https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler"},
"host-browsing-context": {"dfnID":"host-browsing-context","dfnText":"host browsing context","external":false,"refSections":[{"refs":[{"id":"ref-for-host-browsing-context"},{"id":"ref-for-host-browsing-context\u2460"}],"title":"2. Portal browsing contexts"},{"refs":[{"id":"ref-for-host-browsing-context\u2461"}],"title":"3.1. Portal hosts"}],"url":"#host-browsing-context"},
"host-element": {"dfnID":"host-element","dfnText":"host element","external":false,"refSections":[{"refs":[{"id":"ref-for-host-element"},{"id":"ref-for-host-element\u2460"},{"id":"ref-for-host-element\u2461"},{"id":"ref-for-host-element\u2462"},{"id":"ref-for-host-element\u2463"},{"id":"ref-for-host-element\u2464"}],"title":"2. Portal browsing contexts"},{"refs":[{"id":"ref-for-host-element\u2465"},{"id":"ref-for-host-element\u2466"},{"id":"ref-for-host-element\u2467"}],"title":"3. The portal element"},{"refs":[{"id":"ref-for-host-element\u2468"}],"title":"3.1. Portal hosts"},{"refs":[{"id":"ref-for-host-element\u2460\u24ea"},{"id":"ref-for-host-element\u2460\u2460"}],"title":"4.4. Navigation"}],"url":"#host-element"},
"htmlportalelement": {"dfnID":"htmlportalelement","dfnText":"HTMLPortalElement","external":false,"refSections":[{"refs":[{"id":"ref-for-htmlportalelement"}],"title":"2. Portal browsing contexts"},{"refs":[{"id":"ref-for-htmlportalelement\u2460"}],"title":"3. The portal element"},{"refs":[{"id":"ref-for-htmlportalelement\u2461"}],"title":"3.2. The PortalActivateEvent interface"},{"refs":[{"id":"ref-for-htmlportalelement\u2462"}],"title":"4.1. The MessageEvent interface"}],"url":"#htmlportalelement"},
"htmlportalelement-guest-browsing-context": {"dfnID":"htmlportalelement-guest-browsing-context","dfnText":"guest\n  browsing context","external":false,"refSections":[{"refs":[{"id":"ref-for-htmlportalelement-guest-browsing-context"}],"title":"2. Portal browsing contexts"},{"refs":[{"id":"ref-for-htmlportalelement-guest-browsing-context\u2460"},{"id":"ref-for-htmlportalelement-guest-browsing-context\u2461"},{"id":"ref-for-htmlportalelement-guest-browsing-context\u2462"},{"id":"ref-for-htmlportalelement-guest-browsing-context\u2463"},{"id":"ref-for-htmlportalelement-guest-browsing-context\u2464"},{"id":"ref-for-htmlportalelement-guest-browsing-context\u2465"},{"id":"ref-for-htmlportalelement-guest-browsing-context\u2466"},{"id":"ref-for-htmlportalelement-guest-browsing-context\u2467"},{"id":"ref-for-htmlportalelement-guest-browsing-context\u2468"},{"id":"ref-for-htmlportalelement-guest-browsing-context\u2460\u24ea"},{"id":"ref-for-htmlportalelement-guest-browsing-context\u2460\u2460"}],"title":"3. The portal element"},{"refs":[{"id":"ref-for-htmlportalelement-guest-browsing-context\u2460\u2461"}],"title":"3.1. Portal hosts"}],"url":"#htmlportalelement-guest-browsing-context"},
"htmlportalelement-just-adopted-flag": {"dfnID":"htmlportalelement-just-adopted-flag","dfnText":"just-adopted\n  flag","external":false,"refSections":[{"refs":[{"id":"ref-for-htmlportalelement-just-adopted-flag"},{"id":"ref-for-htmlportalelement-just-adopted-flag\u2460"},{"id":"ref-for-htmlportalelement-just-adopted-flag\u2461"}],"title":"2. Portal browsing contexts"},{"refs":[{"id":"ref-for-htmlportalelement-just-adopted-flag\u2462"}],"title":"3. The portal element"}],"url":"#htmlportalelement-just-adopted-flag"},
"may-have-a-guest-browsing-context": {"dfnID":"may-have-a-guest-browsing-context","dfnText":"may have a guest browsing context","external":false,"refSections":[{"refs":[{"id":"ref-for-may-have-a-guest-browsing-context"}],"title":"2. Portal browsing contexts"},{"refs":[{"id":"ref-for-may-have-a-guest-browsing-context\u2460"},{"id":"ref-for-may-have-a-guest-browsing-context\u2461"},{"id":"ref-for-may-have-a-guest-browsing-context\u2462"},{"id":"ref-for-may-have-a-guest-browsing-context\u2463"}],"title":"3. The portal element"}],"url":"#may-have-a-guest-browsing-context"},
"portal-browsing-context": {"dfnID":"portal-browsing-context","dfnText":"portal browsing context","external":false,"refSections":[{"refs":[{"id":"ref-for-portal-browsing-context"},{"id":"ref-for-portal-browsing-context\u2460"},{"id":"ref-for-portal-browsing-context\u2461"}],"title":"2. Portal browsing contexts"},{"refs":[{"id":"ref-for-portal-browsing-context\u2462"},{"id":"ref-for-portal-browsing-context\u2463"},{"id":"ref-for-portal-browsing-context\u2464"},{"id":"ref-for-portal-browsing-context\u2465"},{"id":"ref-for-portal-browsing-context\u2466"},{"id":"ref-for-portal-browsing-context\u2467"},{"id":"ref-for-portal-browsing-context\u2468"}],"title":"3. The portal element"},{"refs":[{"id":"ref-for-portal-browsing-context\u2460\u24ea"},{"id":"ref-for-portal-browsing-context\u2460\u2460"}],"title":"3.1. Portal hosts"},{"refs":[{"id":"ref-for-portal-browsing-context\u2460\u2461"},{"id":"ref-for-portal-browsing-context\u2460\u2462"}],"title":"4.2. Event handlers"},{"refs":[{"id":"ref-for-portal-browsing-context\u2460\u2463"}],"title":"4.3. APIs for creating and navigating browsing contexts by name"},{"refs":[{"id":"ref-for-portal-browsing-context\u2460\u2464"}],"title":"5.1.1. portal-src"},{"refs":[{"id":"ref-for-portal-browsing-context\u2460\u2465"},{"id":"ref-for-portal-browsing-context\u2460\u2466"}],"title":"5.2. Fetch Metadata Request Headers"},{"refs":[{"id":"ref-for-portal-browsing-context\u2460\u2467"}],"title":"6.1. Overview"}],"url":"#portal-browsing-context"},
"portal-host-object": {"dfnID":"portal-host-object","dfnText":"portal host object","external":false,"refSections":[{"refs":[{"id":"ref-for-portal-host-object"}],"title":"3. The portal element"},{"refs":[{"id":"ref-for-portal-host-object\u2460"},{"id":"ref-for-portal-host-object\u2461"}],"title":"3.1. Portal hosts"}],"url":"#portal-host-object"},
"portal-src": {"dfnID":"portal-src","dfnText":"portal-src","external":false,"refSections":[{"refs":[{"id":"ref-for-portal-src"}],"title":"5.1.1. portal-src"},{"refs":[{"id":"ref-for-portal-src\u2460"}],"title":"5.1.2. default-src"},{"refs":[{"id":"ref-for-portal-src\u2461"}],"title":"5.1.3. Get fetch directive fallback list"}],"url":"#portal-src"},
"portal-state": {"dfnID":"portal-state","dfnText":"portal state","external":false,"refSections":[{"refs":[{"id":"ref-for-portal-state"},{"id":"ref-for-portal-state\u2460"},{"id":"ref-for-portal-state\u2461"},{"id":"ref-for-portal-state\u2462"},{"id":"ref-for-portal-state\u2463"},{"id":"ref-for-portal-state\u2464"},{"id":"ref-for-portal-state\u2465"},{"id":"ref-for-portal-state\u2466"},{"id":"ref-for-portal-state\u2467"}],"title":"2. Portal browsing contexts"},{"refs":[{"id":"ref-for-portal-state\u2468"},{"id":"ref-for-portal-state\u2460\u24ea"},{"id":"ref-for-portal-state\u2460\u2460"}],"title":"3. The portal element"},{"refs":[{"id":"ref-for-portal-state\u2460\u2461"},{"id":"ref-for-portal-state\u2460\u2462"}],"title":"3.1. Portal hosts"},{"refs":[{"id":"ref-for-portal-state\u2460\u2463"}],"title":"4.3. APIs for creating and navigating browsing contexts by name"},{"refs":[{"id":"ref-for-portal-state\u2460\u2464"},{"id":"ref-for-portal-state\u2460\u2465"}],"title":"4.4. Navigation"},{"refs":[{"id":"ref-for-portal-state\u2460\u2466"},{"id":"ref-for-portal-state\u2460\u2467"}],"title":"4.5. Downloading resources"}],"url":"#portal-state"},
"portal-task-source": {"dfnID":"portal-task-source","dfnText":"portal task source","external":false,"refSections":[{"refs":[{"id":"ref-for-portal-task-source"},{"id":"ref-for-portal-task-source\u2460"},{"id":"ref-for-portal-task-source\u2461"},{"id":"ref-for-portal-task-source\u2462"}],"title":"2. Portal browsing contexts"},{"refs":[{"id":"ref-for-portal-task-source\u2463"}],"title":"3. The portal element"},{"refs":[{"id":"ref-for-portal-task-source\u2464"}],"title":"3.1. Portal hosts"},{"refs":[{"id":"ref-for-portal-task-source\u2465"}],"title":"3.2. The PortalActivateEvent interface"}],"url":"#portal-task-source"},
"portalactivateevent": {"dfnID":"portalactivateevent","dfnText":"PortalActivateEvent","external":false,"refSections":[{"refs":[{"id":"ref-for-portalactivateevent"}],"title":"2. Portal browsing contexts"},{"refs":[{"id":"ref-for-portalactivateevent\u2460"},{"id":"ref-for-portalactivateevent\u2461"},{"id":"ref-for-portalactivateevent\u2462"}],"title":"3.2. The PortalActivateEvent interface"},{"refs":[{"id":"ref-for-portalactivateevent\u2463"}],"title":"4.2. Event handlers"}],"url":"#portalactivateevent"},
"portalactivateevent-activation-promise": {"dfnID":"portalactivateevent-activation-promise","dfnText":"activation promise","external":false,"refSections":[{"refs":[{"id":"ref-for-portalactivateevent-activation-promise"},{"id":"ref-for-portalactivateevent-activation-promise\u2460"}],"title":"2. Portal browsing contexts"},{"refs":[{"id":"ref-for-portalactivateevent-activation-promise\u2461"}],"title":"3.2. The PortalActivateEvent interface"}],"url":"#portalactivateevent-activation-promise"},
"portalactivateevent-adopted-predecessor-element": {"dfnID":"portalactivateevent-adopted-predecessor-element","dfnText":"adopted predecessor element","external":false,"refSections":[{"refs":[{"id":"ref-for-portalactivateevent-adopted-predecessor-element"}],"title":"2. Portal browsing contexts"},{"refs":[{"id":"ref-for-portalactivateevent-adopted-predecessor-element\u2460"},{"id":"ref-for-portalactivateevent-adopted-predecessor-element\u2461"},{"id":"ref-for-portalactivateevent-adopted-predecessor-element\u2462"}],"title":"3.2. The PortalActivateEvent interface"}],"url":"#portalactivateevent-adopted-predecessor-element"},
"portalactivateevent-predecessor-browsing-context": {"dfnID":"portalactivateevent-predecessor-browsing-context","dfnText":"predecessor browsing context","external":false,"refSections":[{"refs":[{"id":"ref-for-portalactivateevent-predecessor-browsing-context"}],"title":"2. Portal browsing contexts"},{"refs":[{"id":"ref-for-portalactivateevent-predecessor-browsing-context\u2460"},{"id":"ref-for-portalactivateevent-predecessor-browsing-context\u2461"}],"title":"3.2. The PortalActivateEvent interface"}],"url":"#portalactivateevent-predecessor-browsing-context"},
"portalactivateevent-successor-window": {"dfnID":"portalactivateevent-successor-window","dfnText":"successor window","external":false,"refSections":[{"refs":[{"id":"ref-for-portalactivateevent-successor-window"}],"title":"2. Portal browsing contexts"},{"refs":[{"id":"ref-for-portalactivateevent-successor-window\u2460"},{"id":"ref-for-portalactivateevent-successor-window\u2461"}],"title":"3.2. The PortalActivateEvent interface"}],"url":"#portalactivateevent-successor-window"},
"portalhost": {"dfnID":"portalhost","dfnText":"PortalHost","external":false,"refSections":[{"refs":[{"id":"ref-for-portalhost"}],"title":"2. Portal browsing contexts"},{"refs":[{"id":"ref-for-portalhost\u2460"},{"id":"ref-for-portalhost\u2461"},{"id":"ref-for-portalhost\u2462"},{"id":"ref-for-portalhost\u2463"}],"title":"3.1. Portal hosts"},{"refs":[{"id":"ref-for-portalhost\u2464"}],"title":"4.1. The MessageEvent interface"}],"url":"#portalhost"},
"script-closable": {"dfnID":"script-closable","dfnText":"script-closable","external":false,"refSections":[],"url":"#script-closable"},
"set-the-source-url-of-a-portal-element": {"dfnID":"set-the-source-url-of-a-portal-element","dfnText":"set the source URL of a portal element","external":false,"refSections":[{"refs":[{"id":"ref-for-set-the-source-url-of-a-portal-element"},{"id":"ref-for-set-the-source-url-of-a-portal-element\u2460"},{"id":"ref-for-set-the-source-url-of-a-portal-element\u2461"},{"id":"ref-for-set-the-source-url-of-a-portal-element\u2462"}],"title":"3. The portal element"}],"url":"#set-the-source-url-of-a-portal-element"},
"typedefdef-messageeventsource": {"dfnID":"typedefdef-messageeventsource","dfnText":"MessageEventSource","external":false,"refSections":[{"refs":[{"id":"ref-for-typedefdef-messageeventsource"}],"title":"4.1. The MessageEvent interface"}],"url":"#typedefdef-messageeventsource"},
};

document.addEventListener("DOMContentLoaded", ()=>{
    genAllDfnPanels();

    document.body.addEventListener("click", (e) => {
        // If not handled already, just hide all dfn panels.
        hideAllDfnPanels();
    });
});

window.addEventListener("resize", () => {
    // Pin any visible dfn panel
    queryAll(".dfn-panel.on, .dfn-panel.activated").forEach(el=>positionDfnPanel(el));
});

function genAllDfnPanels() {
    for(const panelData of Object.values(dfnPanelData)) {
        const dfnID = panelData.dfnID;
        const dfn = document.getElementById(dfnID);
        if(!dfn) {
            console.log(`Can't find dfn#${dfnID}.`, panelData);
            continue;
        }
        dfn.panelData = panelData;
        insertDfnPopupAction(dfn);
    }
}

function genDfnPanel(dfn, { dfnID, url, dfnText, refSections, external }) {
    const dfnPanel = mk.aside({
        class: "dfn-panel on",
        id: `infopanel-for-${dfnID}`,
        "data-for": dfnID,
        "aria-labelled-by":`infopaneltitle-for-${dfnID}`,
        },
        mk.span({id:`infopaneltitle-for-${dfnID}`, style:"display:none"},
            `Info about the '${dfnText}' ${external?"external":""} reference.`),
        mk.a({href:url, class:"dfn-link"}, url),
        refSections.length == 0 ? [] :
            mk.b({}, "Referenced in:"),
            mk.ul({},
                ...refSections.map(section=>
                    mk.li({},
                        ...section.refs.map((ref, refI)=>
                            [
                                mk.a({ href: `#${ref.id}` },
                                    (refI == 0) ? section.title : `(${refI + 1})`
                                ),
                                " ",
                            ]
                        ),
                    ),
                ),
            ),
        genLinkingSyntaxes(dfn),
    );

    dfnPanel.addEventListener('click', (event) => {
        if (event.target.nodeName == 'A') {
            scrollToTargetAndHighlight(event);
            pinDfnPanel(dfnPanel);
        }
        event.stopPropagation();
        refocusOnTarget(event);
    });
    dfnPanel.addEventListener('keydown', (event) => {
        if(event.keyCode == 27) { // Escape key
            hideDfnPanel({dfnPanel});
            event.stopPropagation();
            event.preventDefault();
        }
    });

    dfnPanel.dfn = dfn;
    dfn.dfnPanel = dfnPanel;
    return dfnPanel;
}



function hideAllDfnPanels() {
    // Delete the currently-active dfn panel.
    queryAll(".dfn-panel").forEach(dfnPanel=>hideDfnPanel({dfnPanel}));
}

function showDfnPanel(dfn) {
    hideAllDfnPanels(); // Only display one at a time.

    dfn.setAttribute("aria-expanded", "true");

    const dfnPanel = genDfnPanel(dfn, dfn.panelData);

    // Give the dfn a unique tabindex, and then
    // give all the tabbable panel bits successive indexes.
    let tabIndex = 100;
    dfn.tabIndex = tabIndex++;
    const tabbable = dfnPanel.querySelectorAll(":is(a, button)");
    for (const el of tabbable) {
        el.tabIndex = tabIndex++;
    }

    append(document.body, dfnPanel);
    positionDfnPanel(dfnPanel);
}

function positionDfnPanel(dfnPanel) {
    const dfn = dfnPanel.dfn;
    const dfnPos = getBounds(dfn);
    dfnPanel.style.top = dfnPos.bottom + "px";
    dfnPanel.style.left = dfnPos.left + "px";

    const panelPos = dfnPanel.getBoundingClientRect();
    const panelMargin = 8;
    const maxRight = document.body.parentNode.clientWidth - panelMargin;
    if (panelPos.right > maxRight) {
        const overflowAmount = panelPos.right - maxRight;
        const newLeft = Math.max(panelMargin, dfnPos.left - overflowAmount);
        dfnPanel.style.left = newLeft + "px";
    }
}

function pinDfnPanel(dfnPanel) {
    // Switch it to "activated" state, which pins it.
    dfnPanel.classList.add("activated");
    dfnPanel.style.position = "fixed";
    dfnPanel.style.left = null;
    dfnPanel.style.top = null;
}

function hideDfnPanel({dfn, dfnPanel}) {
    if(!dfnPanel) dfnPanel = dfn.dfnPanel;
    if(!dfn) dfn = dfnPanel.dfn;
    dfn.dfnPanel = undefined;
    dfnPanel.dfn = undefined;
    dfn.setAttribute("aria-expanded", "false");
    dfn.tabIndex = undefined;
    dfnPanel.remove()
}

function toggleDfnPanel(dfn) {
    if(dfn.dfnPanel) {
        hideDfnPanel(dfn);
    } else {
        showDfnPanel(dfn);
    }
}

function insertDfnPopupAction(dfn) {
    dfn.setAttribute('role', 'button');
    dfn.setAttribute('aria-expanded', 'false')
    dfn.tabIndex = 0;
    dfn.classList.add('has-dfn-panel');
    dfn.addEventListener('click', (event) => {
        toggleDfnPanel(dfn);
        event.stopPropagation();
    });
    dfn.addEventListener('keypress', (event) => {
        const kc = event.keyCode;
        // 32->Space, 13->Enter
        if(kc == 32 || kc == 13) {
            toggleDfnPanel(dfn);
            event.stopPropagation();
            event.preventDefault();
        }
    });
}

function refocusOnTarget(event) {
    const target = event.target;
    setTimeout(() => {
        // Refocus on the event.target element.
        // This is needed after browser scrolls to the destination.
        target.focus();
    });
}

// TODO: shared util
// Returns the root-level absolute position {left and top} of element.
function getBounds(el, relativeTo=document.body) {
    const relativeRect = relativeTo.getBoundingClientRect();
    const elRect = el.getBoundingClientRect();
    const top = elRect.top - relativeRect.top;
    const left = elRect.left - relativeRect.left;
    return {
        top,
        left,
        bottom: top + elRect.height,
        right: left + elRect.width,
    }
}

function scrollToTargetAndHighlight(event) {
    let hash = event.target.hash;
    if (hash) {
        hash = decodeURIComponent(hash.substring(1));
        const dest = document.getElementById(hash);
        if (dest) {
            dest.classList.add('highlighted');
            setTimeout(() => dest.classList.remove('highlighted'), 1000);
        }
    }
}

// Functions, divided by link type, that wrap an autolink's
// contents with the appropriate outer syntax.
// Alternately, a string naming another type they format
// the same as.
function needsFor(type) {
    switch(type) {
        case "descriptor":
        case "value":
        case "element-attr":
        case "attr-value":
        case "element-state":
        case "method":
        case "constructor":
        case "argument":
        case "attribute":
        case "const":
        case "dict-member":
        case "event":
        case "enum-value":
        case "stringifier":
        case "serializer":
        case "iterator":
        case "maplike":
        case "setlike":
        case "state":
        case "mode":
        case "context":
        case "facet": return true;

        default: return false;
    }
}
function refusesFor(type) {
    switch(type) {
        case "property":
        case "element":
        case "interface":
        case "namespace":
        case "callback":
        case "dictionary":
        case "enum":
        case "exception":
        case "typedef":
        case "http-header":
        case "permission": return true;

        default: return false;
    }
}
function linkFormatterFromType(type) {
    switch(type) {
        case 'scheme':
        case 'permission':
        case 'dfn': return (text) => `[=${text}=]`;

        case 'abstract-op': return (text) => `[\$${text}\$]`;

        case 'function':
        case 'at-rule':
        case 'selector':
        case 'value': return (text) => `''${text}''`;

        case 'http-header': return (text) => `[:${text}:]`;

        case 'interface':
        case 'constructor':
        case 'method':
        case 'argument':
        case 'attribute':
        case 'callback':
        case 'dictionary':
        case 'dict-member':
        case 'enum':
        case 'enum-value':
        case 'exception':
        case 'const':
        case 'typedef':
        case 'stringifier':
        case 'serializer':
        case 'iterator':
        case 'maplike':
        case 'setlike':
        case 'extended-attribute':
        case 'event':
        case 'idl': return (text) => `{{${text}}}`;

        case 'element-state':
        case 'element-attr':
        case 'attr-value':
        case 'element': return (element) => `<{${element}}>`;

        case 'grammar': return (text) => `${text} (within a <pre class=prod>)`;

        case 'type': return (text)=> `<<${text}>>`;

        case 'descriptor':
        case 'property': return (text) => `'${text}'`;

        default: return;
    };
};

function genLinkingSyntaxes(dfn) {
    if(dfn.tagName != "DFN") return;

    const type = dfn.getAttribute('data-dfn-type');
    if(!type) {
        console.log(`<dfn> doesn't have a data-dfn-type:`, dfn);
        return [];
    }

    // Return a function that wraps link text based on the type
    const linkFormatter = linkFormatterFromType(type);
    if(!linkFormatter) {
        console.log(`<dfn> has an unknown data-dfn-type:`, dfn);
        return [];
    }

    let ltAlts;
    if(dfn.hasAttribute('data-lt')) {
        ltAlts = dfn.getAttribute('data-lt')
            .split("|")
            .map(x=>x.trim());
    } else {
        ltAlts = [dfn.textContent.trim()];
    }
    if(type == "type") {
        // lt of "<foo>", but "foo" is the interior;
        // <<foo/bar>> is how you write it with a for,
        // not <foo/<bar>> or whatever.
        for(var i = 0; i < ltAlts.length; i++) {
            const lt = ltAlts[i];
            const match = /<(.*)>/.exec(lt);
            if(match) { ltAlts[i] = match[1]; }
        }
    }

    let forAlts;
    if(dfn.hasAttribute('data-dfn-for')) {
        forAlts = dfn.getAttribute('data-dfn-for')
            .split(",")
            .map(x=>x.trim());
    } else {
        forAlts = [''];
    }

    let linkingSyntaxes = [];
    if(!needsFor(type)) {
        for(const lt of ltAlts) {
            linkingSyntaxes.push(linkFormatter(lt));
        }
    }
    if(!refusesFor(type)) {
        for(const f of forAlts) {
            linkingSyntaxes.push(linkFormatter(`${f}/${ltAlts[0]}`))
        }
    }
    return [
        mk.b({}, 'Possible linking syntaxes:'),
        mk.ul({},
            ...linkingSyntaxes.map(link => {
                const copyLink = async () =>
                    await navigator.clipboard.writeText(link);
                return mk.li({},
                    mk.div({ class: 'link-item' },
                        mk.button({
                            class: 'copy-icon', title: 'Copy',
                            type: 'button',
                            _onclick: copyLink,
                            tabindex: 0,
                        }, mk.span({ class: 'icon' }) ),
                        mk.span({}, link)
                    )
                );
            })
        )
    ];
}
}
</script>
<script>/* Boilerplate: script-position-annos */
"use strict";
{
function repositionAnnoPanels(){
    const panels = [...document.querySelectorAll("[data-anno-for]")];
    hydratePanels(panels);
    let vSoFar = 0;
    for(const panel of panels.sort(cmpTops)) {
        if(panel.top < vSoFar) {
            panel.top = vSoFar;
            panel.style.top = vSoFar + "px";
        }
        vSoFar = panel.top + panel.height + 15;
    }
}
function hydratePanels(panels) {
    const main = document.querySelector("main");
    let mainRect;
    if(main) mainRect = main.getBoundingClientRect();
    // First display them all, if they're not already visible.
    for(const panel of panels) {
        panel.classList.remove("unpositioned");
    }
    // Measure them all
    for(const panel of panels) {
        const dfn = document.getElementById(panel.getAttribute("data-anno-for"));
        if(!dfn) {
            console.log("Can't find the annotation panel target:", panel);
            continue;
        }
        panel.dfn = dfn;
        panel.top = window.scrollY + dfn.getBoundingClientRect().top;
        let panelRect = panel.getBoundingClientRect();
        panel.height = panelRect.height;
        if(main) {
            panel.overlappingMain = panelRect.left < mainRect.right;
        } else {
            panel.overlappingMain = false;
        }
    }
    // And finally position them
    for(const panel of panels) {
        const dfn = panel.dfn;
        if(!dfn) continue;
        panel.style.top = panel.top + "px";
        panel.classList.toggle("overlapping-main", panel.overlappingMain);
    }
}

function cmpTops(a,b) {
    return a.top - b.top;
}

window.addEventListener("load", repositionAnnoPanels);
window.addEventListener("resize", repositionAnnoPanels);
}
</script>
<script>/* Boilerplate: script-ref-hints */
"use strict";
{
let refsData = {
"#activate-a-portal-browsing-context": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"portals","spec":"portals-1","status":"local","text":"activate a portal browsing context","type":"dfn","url":"#activate-a-portal-browsing-context"},
"#adopt-the-predecessor-browsing-context": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"portals","spec":"portals-1","status":"local","text":"adopt the predecessor browsing context","type":"dfn","url":"#adopt-the-predecessor-browsing-context"},
"#close-a-portal-element": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"portals","spec":"portals-1","status":"local","text":"close a portal element","type":"dfn","url":"#close-a-portal-element"},
"#dictdef-portalactivateeventinit": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"portals","spec":"portals-1","status":"local","text":"PortalActivateEventInit","type":"dictionary","url":"#dictdef-portalactivateeventinit"},
"#dictdef-portalactivateoptions": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"portals","spec":"portals-1","status":"local","text":"PortalActivateOptions","type":"dictionary","url":"#dictdef-portalactivateoptions"},
"#dom-htmlportalelement-activate": {"export":true,"for_":["HTMLPortalElement"],"level":"1","normative":true,"shortname":"portals","spec":"portals-1","status":"local","text":"activate()","type":"method","url":"#dom-htmlportalelement-activate"},
"#dom-htmlportalelement-onmessage": {"export":true,"for_":["HTMLPortalElement"],"level":"1","normative":true,"shortname":"portals","spec":"portals-1","status":"local","text":"onmessage","type":"attribute","url":"#dom-htmlportalelement-onmessage"},
"#dom-htmlportalelement-onmessageerror": {"export":true,"for_":["HTMLPortalElement"],"level":"1","normative":true,"shortname":"portals","spec":"portals-1","status":"local","text":"onmessageerror","type":"attribute","url":"#dom-htmlportalelement-onmessageerror"},
"#dom-htmlportalelement-postmessage": {"export":true,"for_":["HTMLPortalElement"],"level":"1","normative":true,"shortname":"portals","spec":"portals-1","status":"local","text":"postMessage(message, options)","type":"method","url":"#dom-htmlportalelement-postmessage"},
"#dom-htmlportalelement-referrerpolicy": {"export":true,"for_":["HTMLPortalElement"],"level":"1","normative":true,"shortname":"portals","spec":"portals-1","status":"local","text":"referrerPolicy","type":"attribute","url":"#dom-htmlportalelement-referrerpolicy"},
"#dom-htmlportalelement-src": {"export":true,"for_":["HTMLPortalElement"],"level":"1","normative":true,"shortname":"portals","spec":"portals-1","status":"local","text":"src","type":"attribute","url":"#dom-htmlportalelement-src"},
"#dom-portalactivateevent-adoptpredecessor": {"export":true,"for_":["PortalActivateEvent"],"level":"1","normative":true,"shortname":"portals","spec":"portals-1","status":"local","text":"adoptPredecessor()","type":"method","url":"#dom-portalactivateevent-adoptpredecessor"},
"#dom-portalactivateevent-data": {"export":true,"for_":["PortalActivateEvent"],"level":"1","normative":true,"shortname":"portals","spec":"portals-1","status":"local","text":"data","type":"attribute","url":"#dom-portalactivateevent-data"},
"#dom-portalactivateoptions-data": {"export":true,"for_":["PortalActivateOptions"],"level":"1","normative":true,"shortname":"portals","spec":"portals-1","status":"local","text":"data","type":"dict-member","url":"#dom-portalactivateoptions-data"},
"#dom-portalhost-postmessage": {"export":true,"for_":["PortalHost"],"level":"1","normative":true,"shortname":"portals","spec":"portals-1","status":"local","text":"postMessage(message, options)","type":"method","url":"#dom-portalhost-postmessage"},
"#dom-window-portalhost": {"export":true,"for_":["Window"],"level":"1","normative":true,"shortname":"portals","spec":"portals-1","status":"local","text":"portalHost","type":"attribute","url":"#dom-window-portalhost"},
"#element-attrdef-portal-referrerpolicy": {"export":true,"for_":["portal"],"level":"1","normative":true,"shortname":"portals","spec":"portals-1","status":"local","text":"referrerpolicy","type":"element-attr","url":"#element-attrdef-portal-referrerpolicy"},
"#element-attrdef-portal-src": {"export":true,"for_":["portal"],"level":"1","normative":true,"shortname":"portals","spec":"portals-1","status":"local","text":"src","type":"element-attr","url":"#element-attrdef-portal-src"},
"#elementdef-portal": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"portals","spec":"portals-1","status":"local","text":"portal","type":"element","url":"#elementdef-portal"},
"#eventdef-htmlportalelement-message": {"export":true,"for_":["HTMLPortalElement"],"level":"1","normative":true,"shortname":"portals","spec":"portals-1","status":"local","text":"message","type":"event","url":"#eventdef-htmlportalelement-message"},
"#eventdef-htmlportalelement-messageerror": {"export":true,"for_":["HTMLPortalElement"],"level":"1","normative":true,"shortname":"portals","spec":"portals-1","status":"local","text":"messageerror","type":"event","url":"#eventdef-htmlportalelement-messageerror"},
"#eventdef-portalhost-message": {"export":true,"for_":["PortalHost"],"level":"1","normative":true,"shortname":"portals","spec":"portals-1","status":"local","text":"message","type":"event","url":"#eventdef-portalhost-message"},
"#eventdef-portalhost-messageerror": {"export":true,"for_":["PortalHost"],"level":"1","normative":true,"shortname":"portals","spec":"portals-1","status":"local","text":"messageerror","type":"event","url":"#eventdef-portalhost-messageerror"},
"#eventdef-window-portalactivate": {"export":true,"for_":["Window"],"level":"1","normative":true,"shortname":"portals","spec":"portals-1","status":"local","text":"portalactivate","type":"event","url":"#eventdef-window-portalactivate"},
"#host-browsing-context": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"portals","spec":"portals-1","status":"local","text":"host browsing context","type":"dfn","url":"#host-browsing-context"},
"#host-element": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"portals","spec":"portals-1","status":"local","text":"host element","type":"dfn","url":"#host-element"},
"#htmlportalelement": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"portals","spec":"portals-1","status":"local","text":"HTMLPortalElement","type":"interface","url":"#htmlportalelement"},
"#htmlportalelement-guest-browsing-context": {"export":true,"for_":["HTMLPortalElement"],"level":"1","normative":true,"shortname":"portals","spec":"portals-1","status":"local","text":"guest browsing context","type":"dfn","url":"#htmlportalelement-guest-browsing-context"},
"#htmlportalelement-just-adopted-flag": {"export":true,"for_":["HTMLPortalElement"],"level":"1","normative":true,"shortname":"portals","spec":"portals-1","status":"local","text":"just-adopted flag","type":"dfn","url":"#htmlportalelement-just-adopted-flag"},
"#may-have-a-guest-browsing-context": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"portals","spec":"portals-1","status":"local","text":"may have a guest browsing context","type":"dfn","url":"#may-have-a-guest-browsing-context"},
"#portal-browsing-context": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"portals","spec":"portals-1","status":"local","text":"portal browsing context","type":"dfn","url":"#portal-browsing-context"},
"#portal-host-object": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"portals","spec":"portals-1","status":"local","text":"portal host object","type":"dfn","url":"#portal-host-object"},
"#portal-src": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"portals","spec":"portals-1","status":"local","text":"portal-src","type":"dfn","url":"#portal-src"},
"#portal-state": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"portals","spec":"portals-1","status":"local","text":"portal state","type":"dfn","url":"#portal-state"},
"#portal-task-source": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"portals","spec":"portals-1","status":"local","text":"portal task source","type":"dfn","url":"#portal-task-source"},
"#portalactivateevent": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"portals","spec":"portals-1","status":"local","text":"PortalActivateEvent","type":"interface","url":"#portalactivateevent"},
"#portalactivateevent-activation-promise": {"export":true,"for_":["PortalActivateEvent"],"level":"1","normative":true,"shortname":"portals","spec":"portals-1","status":"local","text":"activation promise","type":"dfn","url":"#portalactivateevent-activation-promise"},
"#portalactivateevent-adopted-predecessor-element": {"export":true,"for_":["PortalActivateEvent"],"level":"1","normative":true,"shortname":"portals","spec":"portals-1","status":"local","text":"adopted predecessor element","type":"dfn","url":"#portalactivateevent-adopted-predecessor-element"},
"#portalactivateevent-predecessor-browsing-context": {"export":true,"for_":["PortalActivateEvent"],"level":"1","normative":true,"shortname":"portals","spec":"portals-1","status":"local","text":"predecessor browsing context","type":"dfn","url":"#portalactivateevent-predecessor-browsing-context"},
"#portalactivateevent-successor-window": {"export":true,"for_":["PortalActivateEvent"],"level":"1","normative":true,"shortname":"portals","spec":"portals-1","status":"local","text":"successor window","type":"dfn","url":"#portalactivateevent-successor-window"},
"#portalhost": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"portals","spec":"portals-1","status":"local","text":"PortalHost","type":"interface","url":"#portalhost"},
"#set-the-source-url-of-a-portal-element": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"portals","spec":"portals-1","status":"local","text":"set the source url of a portal element","type":"dfn","url":"#set-the-source-url-of-a-portal-element"},
"#typedefdef-messageeventsource": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"portals","spec":"portals-1","status":"local","text":"MessageEventSource","type":"typedef","url":"#typedefdef-messageeventsource"},
"http://tc39.github.io/ecma262/#sec-agents": {"export":true,"for_":[],"level":"262","normative":true,"shortname":"ecma","spec":"ecma-262","status":"anchor-block","text":"agent","type":"dfn","url":"http://tc39.github.io/ecma262/#sec-agents"},
"http://tc39.github.io/ecma262/#sec-promise-objects": {"export":true,"for_":[],"level":"262","normative":true,"shortname":"ecma","spec":"ecma-262","status":"anchor-block","text":"promise","type":"dfn","url":"http://tc39.github.io/ecma262/#sec-promise-objects"},
"https://dom.spec.whatwg.org/#concept-create-element": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"dom","spec":"dom","status":"current","text":"creating an element","type":"dfn","url":"https://dom.spec.whatwg.org/#concept-create-element"},
"https://dom.spec.whatwg.org/#concept-document-origin": {"export":true,"for_":["Document"],"level":"1","normative":true,"shortname":"dom","spec":"dom","status":"current","text":"origin","type":"dfn","url":"https://dom.spec.whatwg.org/#concept-document-origin"},
"https://dom.spec.whatwg.org/#concept-document-url": {"export":true,"for_":["Document"],"level":"1","normative":true,"shortname":"dom","spec":"dom","status":"current","text":"url","type":"dfn","url":"https://dom.spec.whatwg.org/#concept-document-url"},
"https://dom.spec.whatwg.org/#concept-event-constructor-ext": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"dom","spec":"dom","status":"current","text":"event constructing steps","type":"dfn","url":"https://dom.spec.whatwg.org/#concept-event-constructor-ext"},
"https://dom.spec.whatwg.org/#concept-event-create": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"dom","spec":"dom","status":"current","text":"creating an event","type":"dfn","url":"https://dom.spec.whatwg.org/#concept-event-create"},
"https://dom.spec.whatwg.org/#concept-event-dispatch": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"dom","spec":"dom","status":"current","text":"dispatch","type":"dfn","url":"https://dom.spec.whatwg.org/#concept-event-dispatch"},
"https://dom.spec.whatwg.org/#concept-event-fire": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"dom","spec":"dom","status":"current","text":"fire an event","type":"dfn","url":"https://dom.spec.whatwg.org/#concept-event-fire"},
"https://dom.spec.whatwg.org/#concept-node-adopt-ext": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"dom","spec":"dom","status":"current","text":"adopting steps","type":"dfn","url":"https://dom.spec.whatwg.org/#concept-node-adopt-ext"},
"https://dom.spec.whatwg.org/#concept-node-document": {"export":true,"for_":["Node"],"level":"1","normative":true,"shortname":"dom","spec":"dom","status":"current","text":"node document","type":"dfn","url":"https://dom.spec.whatwg.org/#concept-node-document"},
"https://dom.spec.whatwg.org/#dictdef-eventinit": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"dom","spec":"dom","status":"current","text":"EventInit","type":"dictionary","url":"https://dom.spec.whatwg.org/#dictdef-eventinit"},
"https://dom.spec.whatwg.org/#document": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"dom","spec":"dom","status":"current","text":"Document","type":"interface","url":"https://dom.spec.whatwg.org/#document"},
"https://dom.spec.whatwg.org/#dom-event-type": {"export":true,"for_":["Event"],"level":"1","normative":true,"shortname":"dom","spec":"dom","status":"current","text":"type","type":"attribute","url":"https://dom.spec.whatwg.org/#dom-event-type"},
"https://dom.spec.whatwg.org/#event": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"dom","spec":"dom","status":"current","text":"Event","type":"interface","url":"https://dom.spec.whatwg.org/#event"},
"https://dom.spec.whatwg.org/#eventtarget": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"dom","spec":"dom","status":"current","text":"EventTarget","type":"interface","url":"https://dom.spec.whatwg.org/#eventtarget"},
"https://dom.spec.whatwg.org/#eventtarget-activation-behavior": {"export":true,"for_":["EventTarget"],"level":"1","normative":true,"shortname":"dom","spec":"dom","status":"current","text":"activation behavior","type":"dfn","url":"https://dom.spec.whatwg.org/#eventtarget-activation-behavior"},
"https://fetch.spec.whatwg.org/#concept-request": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"fetch","spec":"fetch","status":"current","text":"request","type":"dfn","url":"https://fetch.spec.whatwg.org/#concept-request"},
"https://fetch.spec.whatwg.org/#concept-request-current-url": {"export":true,"for_":["request"],"level":"1","normative":true,"shortname":"fetch","spec":"fetch","status":"current","text":"current url","type":"dfn","url":"https://fetch.spec.whatwg.org/#concept-request-current-url"},
"https://fetch.spec.whatwg.org/#concept-request-referrer-policy": {"export":true,"for_":["request"],"level":"1","normative":true,"shortname":"fetch","spec":"fetch","status":"current","text":"referrer policy","type":"dfn","url":"https://fetch.spec.whatwg.org/#concept-request-referrer-policy"},
"https://fetch.spec.whatwg.org/#concept-request-reserved-client": {"export":true,"for_":["request"],"level":"1","normative":true,"shortname":"fetch","spec":"fetch","status":"current","text":"reserved client","type":"dfn","url":"https://fetch.spec.whatwg.org/#concept-request-reserved-client"},
"https://fetch.spec.whatwg.org/#concept-request-url": {"export":true,"for_":["request"],"level":"1","normative":true,"shortname":"fetch","spec":"fetch","status":"current","text":"url","type":"dfn","url":"https://fetch.spec.whatwg.org/#concept-request-url"},
"https://fetch.spec.whatwg.org/#concept-response": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"fetch","spec":"fetch","status":"current","text":"response","type":"dfn","url":"https://fetch.spec.whatwg.org/#concept-response"},
"https://fetch.spec.whatwg.org/#concept-response-status": {"export":true,"for_":["response"],"level":"1","normative":true,"shortname":"fetch","spec":"fetch","status":"current","text":"status","type":"dfn","url":"https://fetch.spec.whatwg.org/#concept-response-status"},
"https://fetch.spec.whatwg.org/#http-scheme": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"fetch","spec":"fetch","status":"current","text":"http(s) scheme","type":"dfn","url":"https://fetch.spec.whatwg.org/#http-scheme"},
"https://html.spec.whatwg.org/multipage/browsers.html#active-sandboxing-flag-set": {"export":true,"for_":["Document"],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"active sandboxing flag set","type":"dfn","url":"https://html.spec.whatwg.org/multipage/browsers.html#active-sandboxing-flag-set"},
"https://html.spec.whatwg.org/multipage/browsers.html#ascii-serialisation-of-an-origin": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"serialization of an origin","type":"dfn","url":"https://html.spec.whatwg.org/multipage/browsers.html#ascii-serialisation-of-an-origin"},
"https://html.spec.whatwg.org/multipage/browsers.html#browsing-context-group": {"export":true,"for_":[],"level":"","normative":true,"shortname":"html","spec":"html","status":"anchor-block","text":"browsing context group","type":"dfn","url":"https://html.spec.whatwg.org/multipage/browsers.html#browsing-context-group"},
"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"origin","type":"dfn","url":"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin"},
"https://html.spec.whatwg.org/multipage/browsers.html#creating-a-new-top-level-browsing-context": {"export":true,"for_":[],"level":"","normative":true,"shortname":"html","spec":"html","status":"anchor-block","text":"create a new top-level browsing context","type":"dfn","url":"https://html.spec.whatwg.org/multipage/browsers.html#creating-a-new-top-level-browsing-context"},
"https://html.spec.whatwg.org/multipage/browsers.html#same-origin": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"same origin","type":"dfn","url":"https://html.spec.whatwg.org/multipage/browsers.html#same-origin"},
"https://html.spec.whatwg.org/multipage/browsers.html#same-origin-domain": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"same origin-domain","type":"dfn","url":"https://html.spec.whatwg.org/multipage/browsers.html#same-origin-domain"},
"https://html.spec.whatwg.org/multipage/browsing-the-web.html#navigate": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"navigate","type":"dfn","url":"https://html.spec.whatwg.org/multipage/browsing-the-web.html#navigate"},
"https://html.spec.whatwg.org/multipage/browsing-the-web.html#navigation-params-request": {"export":true,"for_":["navigation params"],"level":"","normative":true,"shortname":"html","spec":"html","status":"anchor-block","text":"request","type":"dfn","url":"https://html.spec.whatwg.org/multipage/browsing-the-web.html#navigation-params-request"},
"https://html.spec.whatwg.org/multipage/browsing-the-web.html#navigation-params-reserved-environment": {"export":true,"for_":["navigation params"],"level":"","normative":true,"shortname":"html","spec":"html","status":"anchor-block","text":"reserved environment","type":"dfn","url":"https://html.spec.whatwg.org/multipage/browsing-the-web.html#navigation-params-reserved-environment"},
"https://html.spec.whatwg.org/multipage/browsing-the-web.html#prompt-to-unload-a-document": {"export":true,"for_":[],"level":"","normative":true,"shortname":"html","spec":"html","status":"anchor-block","text":"prompt to unload","type":"dfn","url":"https://html.spec.whatwg.org/multipage/browsing-the-web.html#prompt-to-unload-a-document"},
"https://html.spec.whatwg.org/multipage/browsing-the-web.html#unload-a-document": {"export":true,"for_":[],"level":"","normative":true,"shortname":"html","spec":"html","status":"anchor-block","text":"unload","type":"dfn","url":"https://html.spec.whatwg.org/multipage/browsing-the-web.html#unload-a-document"},
"https://html.spec.whatwg.org/multipage/common-dom-interfaces.html#limited-to-only-known-values": {"export":true,"for_":[],"level":"","normative":true,"shortname":"html","spec":"html","status":"anchor-block","text":"limited to only known values","type":"dfn","url":"https://html.spec.whatwg.org/multipage/common-dom-interfaces.html#limited-to-only-known-values"},
"https://html.spec.whatwg.org/multipage/common-dom-interfaces.html#reflect": {"export":true,"for_":[],"level":"","normative":true,"shortname":"html","spec":"html","status":"anchor-block","text":"reflect","type":"dfn","url":"https://html.spec.whatwg.org/multipage/common-dom-interfaces.html#reflect"},
"https://html.spec.whatwg.org/multipage/comms.html#dom-messageevent-data": {"export":true,"for_":["MessageEvent"],"level":"","normative":true,"shortname":"html","spec":"html","status":"anchor-block","text":"data","type":"attribute","url":"https://html.spec.whatwg.org/multipage/comms.html#dom-messageevent-data"},
"https://html.spec.whatwg.org/multipage/comms.html#dom-messageevent-origin": {"export":true,"for_":["MessageEvent"],"level":"","normative":true,"shortname":"html","spec":"html","status":"anchor-block","text":"origin","type":"attribute","url":"https://html.spec.whatwg.org/multipage/comms.html#dom-messageevent-origin"},
"https://html.spec.whatwg.org/multipage/comms.html#dom-messageevent-ports": {"export":true,"for_":["MessageEvent"],"level":"","normative":true,"shortname":"html","spec":"html","status":"anchor-block","text":"ports","type":"attribute","url":"https://html.spec.whatwg.org/multipage/comms.html#dom-messageevent-ports"},
"https://html.spec.whatwg.org/multipage/comms.html#dom-messageevent-source": {"export":true,"for_":["MessageEvent"],"level":"","normative":true,"shortname":"html","spec":"html","status":"anchor-block","text":"source","type":"attribute","url":"https://html.spec.whatwg.org/multipage/comms.html#dom-messageevent-source"},
"https://html.spec.whatwg.org/multipage/comms.html#messageevent": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"MessageEvent","type":"interface","url":"https://html.spec.whatwg.org/multipage/comms.html#messageevent"},
"https://html.spec.whatwg.org/multipage/custom-elements.html#cereactions": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"CEReactions","type":"extended-attribute","url":"https://html.spec.whatwg.org/multipage/custom-elements.html#cereactions"},
"https://html.spec.whatwg.org/multipage/document-sequences.html#auxiliary-browsing-context": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"auxiliary browsing context","type":"dfn","url":"https://html.spec.whatwg.org/multipage/document-sequences.html#auxiliary-browsing-context"},
"https://html.spec.whatwg.org/multipage/document-sequences.html#browsing-context": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"browsing context","type":"dfn","url":"https://html.spec.whatwg.org/multipage/document-sequences.html#browsing-context"},
"https://html.spec.whatwg.org/multipage/document-sequences.html#concept-document-bc": {"export":true,"for_":["Document"],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"browsing context","type":"dfn","url":"https://html.spec.whatwg.org/multipage/document-sequences.html#concept-document-bc"},
"https://html.spec.whatwg.org/multipage/document-sequences.html#top-level-browsing-context": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"top-level browsing context","type":"dfn","url":"https://html.spec.whatwg.org/multipage/document-sequences.html#top-level-browsing-context"},
"https://html.spec.whatwg.org/multipage/dom.html#htmlconstructor": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"HTMLConstructor","type":"extended-attribute","url":"https://html.spec.whatwg.org/multipage/dom.html#htmlconstructor"},
"https://html.spec.whatwg.org/multipage/dom.html#htmlelement": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"HTMLElement","type":"interface","url":"https://html.spec.whatwg.org/multipage/dom.html#htmlelement"},
"https://html.spec.whatwg.org/multipage/history.html#session-history": {"export":true,"for_":[],"level":"","normative":true,"shortname":"html","spec":"html","status":"anchor-block","text":"session history","type":"dfn","url":"https://html.spec.whatwg.org/multipage/history.html#session-history"},
"https://html.spec.whatwg.org/multipage/iframe-embed-object.html#the-iframe-element": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"iframe","type":"element","url":"https://html.spec.whatwg.org/multipage/iframe-embed-object.html#the-iframe-element"},
"https://html.spec.whatwg.org/multipage/indices.html#event-load": {"export":true,"for_":["Window","HTMLElement"],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"load","type":"event","url":"https://html.spec.whatwg.org/multipage/indices.html#event-load"},
"https://html.spec.whatwg.org/multipage/indices.html#event-unload": {"export":true,"for_":["Window"],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"unload","type":"event","url":"https://html.spec.whatwg.org/multipage/indices.html#event-unload"},
"https://html.spec.whatwg.org/multipage/infrastructure.html#becomes-browsing-context-connected": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"become browsing-context connected","type":"dfn","url":"https://html.spec.whatwg.org/multipage/infrastructure.html#becomes-browsing-context-connected"},
"https://html.spec.whatwg.org/multipage/infrastructure.html#becomes-browsing-context-disconnected": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"become browsing-context disconnected","type":"dfn","url":"https://html.spec.whatwg.org/multipage/infrastructure.html#becomes-browsing-context-disconnected"},
"https://html.spec.whatwg.org/multipage/infrastructure.html#browsing-context-connected": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"browsing-context connected","type":"dfn","url":"https://html.spec.whatwg.org/multipage/infrastructure.html#browsing-context-connected"},
"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"in parallel","type":"dfn","url":"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel"},
"https://html.spec.whatwg.org/multipage/links.html#allowed-to-download": {"export":false,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"allowed to download","type":"dfn","url":"https://html.spec.whatwg.org/multipage/links.html#allowed-to-download"},
"https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"associated document","type":"dfn","url":"https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window"},
"https://html.spec.whatwg.org/multipage/nav-history-apis.html#script-closable": {"export":false,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"script-closable","type":"dfn","url":"https://html.spec.whatwg.org/multipage/nav-history-apis.html#script-closable"},
"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"Window","type":"interface","url":"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window"},
"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window-bc": {"export":true,"for_":["Window"],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"browsing context","type":"dfn","url":"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window-bc"},
"https://html.spec.whatwg.org/multipage/nav-history-apis.html#windowproxy": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"WindowProxy","type":"interface","url":"https://html.spec.whatwg.org/multipage/nav-history-apis.html#windowproxy"},
"https://html.spec.whatwg.org/multipage/parsing.html#completely-loaded": {"export":true,"for_":[],"level":"","normative":true,"shortname":"html","spec":"html","status":"anchor-block","text":"completely loaded","type":"dfn","url":"https://html.spec.whatwg.org/multipage/parsing.html#completely-loaded"},
"https://html.spec.whatwg.org/multipage/structured-data.html#structureddeserializewithtransfer": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"StructuredDeserializeWithTransfer","type":"abstract-op","url":"https://html.spec.whatwg.org/multipage/structured-data.html#structureddeserializewithtransfer"},
"https://html.spec.whatwg.org/multipage/structured-data.html#structuredserializewithtransfer": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"StructuredSerializeWithTransfer","type":"abstract-op","url":"https://html.spec.whatwg.org/multipage/structured-data.html#structuredserializewithtransfer"},
"https://html.spec.whatwg.org/multipage/urls-and-fetching.html#parse-a-url": {"export":true,"for_":[],"level":"","normative":true,"shortname":"html","spec":"html","status":"anchor-block","text":"parse a url","type":"dfn","url":"https://html.spec.whatwg.org/multipage/urls-and-fetching.html#parse-a-url"},
"https://html.spec.whatwg.org/multipage/urls-and-fetching.html#referrer-policy-attribute": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"referrer policy attribute","type":"dfn","url":"https://html.spec.whatwg.org/multipage/urls-and-fetching.html#referrer-policy-attribute"},
"https://html.spec.whatwg.org/multipage/urls-and-fetching.html#resulting-url-record": {"export":true,"for_":[],"level":"","normative":true,"shortname":"html","spec":"html","status":"anchor-block","text":"resulting url record","type":"dfn","url":"https://html.spec.whatwg.org/multipage/urls-and-fetching.html#resulting-url-record"},
"https://html.spec.whatwg.org/multipage/urls-and-fetching.html#valid-non-empty-url-potentially-surrounded-by-spaces": {"export":true,"for_":[],"level":"","normative":true,"shortname":"html","spec":"html","status":"anchor-block","text":"valid non-empty url potentially surrounded by spaces","type":"dfn","url":"https://html.spec.whatwg.org/multipage/urls-and-fetching.html#valid-non-empty-url-potentially-surrounded-by-spaces"},
"https://html.spec.whatwg.org/multipage/web-messaging.html#messageport": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"MessagePort","type":"interface","url":"https://html.spec.whatwg.org/multipage/web-messaging.html#messageport"},
"https://html.spec.whatwg.org/multipage/webappapis.html#concept-agent-event-loop": {"export":true,"for_":["agent"],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"event loop","type":"dfn","url":"https://html.spec.whatwg.org/multipage/webappapis.html#concept-agent-event-loop"},
"https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-target-browsing-context": {"export":true,"for_":["environment"],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"target browsing context","type":"dfn","url":"https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-target-browsing-context"},
"https://html.spec.whatwg.org/multipage/webappapis.html#concept-global-object-realm": {"export":true,"for_":["global object"],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"realm","type":"dfn","url":"https://html.spec.whatwg.org/multipage/webappapis.html#concept-global-object-realm"},
"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"relevant global object","type":"dfn","url":"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global"},
"https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin": {"export":true,"for_":["environment settings object"],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"origin","type":"dfn","url":"https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin"},
"https://html.spec.whatwg.org/multipage/webappapis.html#environment-discarding-steps": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"environment discarding steps","type":"dfn","url":"https://html.spec.whatwg.org/multipage/webappapis.html#environment-discarding-steps"},
"https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object's-realm": {"export":true,"for_":["environment settings object"],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"realm","type":"dfn","url":"https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object's-realm"},
"https://html.spec.whatwg.org/multipage/webappapis.html#event-handler-content-attributes": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"event handler content attribute","type":"dfn","url":"https://html.spec.whatwg.org/multipage/webappapis.html#event-handler-content-attributes"},
"https://html.spec.whatwg.org/multipage/webappapis.html#event-handler-event-type": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"event handler event type","type":"dfn","url":"https://html.spec.whatwg.org/multipage/webappapis.html#event-handler-event-type"},
"https://html.spec.whatwg.org/multipage/webappapis.html#event-handler-idl-attributes": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"event handler idl attribute","type":"dfn","url":"https://html.spec.whatwg.org/multipage/webappapis.html#event-handler-idl-attributes"},
"https://html.spec.whatwg.org/multipage/webappapis.html#event-handlers": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"event handler","type":"dfn","url":"https://html.spec.whatwg.org/multipage/webappapis.html#event-handlers"},
"https://html.spec.whatwg.org/multipage/webappapis.html#event-loop": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"event loop","type":"dfn","url":"https://html.spec.whatwg.org/multipage/webappapis.html#event-loop"},
"https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"EventHandler","type":"typedef","url":"https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler"},
"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"queue a global task","type":"dfn","url":"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task"},
"https://html.spec.whatwg.org/multipage/webappapis.html#queue-an-element-task": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"queue an element task","type":"dfn","url":"https://html.spec.whatwg.org/multipage/webappapis.html#queue-an-element-task"},
"https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"relevant settings object","type":"dfn","url":"https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object"},
"https://html.spec.whatwg.org/multipage/webappapis.html#task-source": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"task source","type":"dfn","url":"https://html.spec.whatwg.org/multipage/webappapis.html#task-source"},
"https://html.spec.whatwg.org/multipage/webappapis.html#windoweventhandlers": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"WindowEventHandlers","type":"interface","url":"https://html.spec.whatwg.org/multipage/webappapis.html#windoweventhandlers"},
"https://html.spec.whatwg.org/multipage/window-object.html#a-browsing-context-is-discarded": {"export":true,"for_":[],"level":"","normative":true,"shortname":"html","spec":"html","status":"anchor-block","text":"discard a browsing context","type":"dfn","url":"https://html.spec.whatwg.org/multipage/window-object.html#a-browsing-context-is-discarded"},
"https://html.spec.whatwg.org/multipage/window-object.html#close-a-browsing-context": {"export":true,"for_":[],"level":"","normative":true,"shortname":"html","spec":"html","status":"anchor-block","text":"close a browsing context","type":"dfn","url":"https://html.spec.whatwg.org/multipage/window-object.html#close-a-browsing-context"},
"https://infra.spec.whatwg.org/#assert": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"assert","type":"dfn","url":"https://infra.spec.whatwg.org/#assert"},
"https://infra.spec.whatwg.org/#boolean": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"boolean","type":"dfn","url":"https://infra.spec.whatwg.org/#boolean"},
"https://infra.spec.whatwg.org/#html-namespace": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"html namespace","type":"dfn","url":"https://infra.spec.whatwg.org/#html-namespace"},
"https://url.spec.whatwg.org/#concept-url": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"url","spec":"url","status":"current","text":"url","type":"dfn","url":"https://url.spec.whatwg.org/#concept-url"},
"https://url.spec.whatwg.org/#concept-url-scheme": {"export":true,"for_":["url"],"level":"1","normative":true,"shortname":"url","spec":"url","status":"current","text":"scheme","type":"dfn","url":"https://url.spec.whatwg.org/#concept-url-scheme"},
"https://w3c.github.io/ServiceWorker/#serviceworker": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"service-workers","spec":"service-workers","status":"current","text":"ServiceWorker","type":"interface","url":"https://w3c.github.io/ServiceWorker/#serviceworker"},
"https://w3c.github.io/webappsec-csp/#directive-post-request-check": {"export":true,"for_":["directive"],"level":"3","normative":true,"shortname":"csp","spec":"csp3","status":"current","text":"post-request check","type":"dfn","url":"https://w3c.github.io/webappsec-csp/#directive-post-request-check"},
"https://w3c.github.io/webappsec-csp/#directive-pre-request-check": {"export":true,"for_":["directive"],"level":"3","normative":true,"shortname":"csp","spec":"csp3","status":"current","text":"pre-request check","type":"dfn","url":"https://w3c.github.io/webappsec-csp/#directive-pre-request-check"},
"https://w3c.github.io/webappsec-csp/#directive-value": {"export":true,"for_":["directive"],"level":"3","normative":true,"shortname":"csp","spec":"csp3","status":"current","text":"value","type":"dfn","url":"https://w3c.github.io/webappsec-csp/#directive-value"},
"https://w3c.github.io/webappsec-csp/#grammardef-serialized-source-list": {"export":true,"for_":[],"level":"3","normative":true,"shortname":"csp","spec":"csp3","status":"current","text":"serialized-source-list","type":"grammar","url":"https://w3c.github.io/webappsec-csp/#grammardef-serialized-source-list"},
"https://w3c.github.io/webappsec-csp/#header-content-security-policy": {"export":true,"for_":[],"level":"3","normative":true,"shortname":"csp","spec":"csp3","status":"current","text":"content-security-policy","type":"http-header","url":"https://w3c.github.io/webappsec-csp/#header-content-security-policy"},
"https://w3c.github.io/webappsec-csp/#sandbox": {"export":true,"for_":[],"level":"3","normative":true,"shortname":"csp","spec":"csp3","status":"current","text":"sandbox","type":"dfn","url":"https://w3c.github.io/webappsec-csp/#sandbox"},
"https://w3c.github.io/webappsec-csp/#source-lists": {"export":true,"for_":[],"level":"3","normative":true,"shortname":"csp","spec":"csp3","status":"current","text":"source lists","type":"dfn","url":"https://w3c.github.io/webappsec-csp/#source-lists"},
"https://w3c.github.io/webappsec-referrer-policy/#referrer-policy": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"referrer-policy","spec":"referrer-policy","status":"current","text":"referrer policy","type":"dfn","url":"https://w3c.github.io/webappsec-referrer-policy/#referrer-policy"},
"https://webidl.spec.whatwg.org/#Exposed": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"Exposed","type":"extended-attribute","url":"https://webidl.spec.whatwg.org/#Exposed"},
"https://webidl.spec.whatwg.org/#NewObject": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"NewObject","type":"extended-attribute","url":"https://webidl.spec.whatwg.org/#NewObject"},
"https://webidl.spec.whatwg.org/#dfn-frozen-array-type": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"frozen array type","type":"dfn","url":"https://webidl.spec.whatwg.org/#dfn-frozen-array-type"},
"https://webidl.spec.whatwg.org/#idl-DOMException": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"DOMException","type":"interface","url":"https://webidl.spec.whatwg.org/#idl-DOMException"},
"https://webidl.spec.whatwg.org/#idl-DOMString": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"DOMString","type":"interface","url":"https://webidl.spec.whatwg.org/#idl-DOMString"},
"https://webidl.spec.whatwg.org/#idl-USVString": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"USVString","type":"interface","url":"https://webidl.spec.whatwg.org/#idl-USVString"},
"https://webidl.spec.whatwg.org/#idl-any": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"any","type":"interface","url":"https://webidl.spec.whatwg.org/#idl-any"},
"https://webidl.spec.whatwg.org/#idl-promise": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"Promise","type":"interface","url":"https://webidl.spec.whatwg.org/#idl-promise"},
"https://webidl.spec.whatwg.org/#idl-undefined": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"undefined","type":"interface","url":"https://webidl.spec.whatwg.org/#idl-undefined"},
"https://webidl.spec.whatwg.org/#invalidstateerror": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"InvalidStateError","type":"exception","url":"https://webidl.spec.whatwg.org/#invalidstateerror"},
"https://webidl.spec.whatwg.org/#reject": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"reject","type":"dfn","url":"https://webidl.spec.whatwg.org/#reject"},
"https://webidl.spec.whatwg.org/#this": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"this","type":"dfn","url":"https://webidl.spec.whatwg.org/#this"},
};

function mkRefHint(link, ref) {
    const linkText = link.textContent;
    let dfnTextElements = '';
    if (ref.text != linkText) {
        dfnTextElements =
            mk.li({},
                mk.b({}, "Term: "),
                mk.span({}, ref.text)
            );
    }
    const forList = ref.for_;
    let forListElements;
    if(forList.length == 0) {
        forListElements = [];
    } else if(forList.length == 1) {
        forListElements = mk.li({},
            mk.b({}, "For: "),
            mk.span({}, forList[0]),
        );
    } else {
        forListElements = mk.li({},
            mk.b({}, "For: "),
            mk.ul({},
                ...forList.map(forItem =>
                    mk.li({},
                        mk.span({}, forItem)
                    ),
                ),
            ),
        );
    }
    const url = ref.url;
    const safeUrl = encodeURIComponent(url);
    const hintPanel = mk.aside({
        class: "ref-hint",
        id: `ref-hint-for-${safeUrl}`,
        "data-for": url,
        "aria-labelled-by": `ref-hint-for-${safeUrl}`,
    },
        mk.ul({},
            dfnTextElements,
            mk.li({},
                mk.b({}, "URL: "),
                mk.a({ href: url, class: "ref" }, url),
            ),
            mk.li({},
                mk.b({}, "Type: "),
                mk.span({}, `${ref.type}`),
            ),
            mk.li({},
                mk.b({}, "Spec: "),
                mk.span({}, `${ref.spec ? ref.spec : ''}`),
            ),
            forListElements
        ),
    );
    hintPanel.forLink = link;
    setupRefHintEventListeners(link, hintPanel);
    return hintPanel;
}

function hideAllRefHints() {
    queryAll(".ref-hint").forEach(el=>hideRefHint(el));
}

function hideRefHint(refHint) {
    const link = refHint.forLink;
    link.setAttribute("aria-expanded", "false");
    if(refHint.teardownEventListeners) {
        refHint.teardownEventListeners();
    }
    refHint.remove();
}

function showRefHint(link) {
    if(link.classList.contains("dfn-link")) return;
    const url = link.getAttribute("href");
    const ref = refsData[url];
    if(!ref) return;

    hideAllRefHints(); // Only display one at this time.

    const refHint = mkRefHint(link, ref);
    append(document.body, refHint);
    link.setAttribute("aria-expanded", "true");
    positionRefHint(refHint);
}

function setupRefHintEventListeners(link, refHint) {
    if (refHint.teardownEventListeners) return;
    // Add event handlers to hide the refHint after the user moves away
    // from both the link and refHint, if not hovering either within one second.
    let timeout = null;
    const startHidingRefHint = (event) => {
        if (timeout) {
            clearTimeout(timeout);
        }
        timeout = setTimeout(() => {
            hideRefHint(refHint);
        }, 1000);
    }
    const resetHidingRefHint = (event) => {
        if (timeout) clearTimeout(timeout);
        timeout = null;
    };
    link.addEventListener("mouseleave", startHidingRefHint);
    link.addEventListener("mouseenter", resetHidingRefHint);
    link.addEventListener("blur", startHidingRefHint);
    link.addEventListener("focus", resetHidingRefHint);
    refHint.addEventListener("mouseleave", startHidingRefHint);
    refHint.addEventListener("mouseenter", resetHidingRefHint);
    refHint.addEventListener("blur", startHidingRefHint);
    refHint.addEventListener("focus", resetHidingRefHint);

    refHint.teardownEventListeners = () => {
        // remove event listeners
        resetHidingRefHint();
        link.removeEventListener("mouseleave", startHidingRefHint);
        link.removeEventListener("mouseenter", resetHidingRefHint);
        link.removeEventListener("blur", startHidingRefHint);
        link.removeEventListener("focus", resetHidingRefHint);
        refHint.removeEventListener("mouseleave", startHidingRefHint);
        refHint.removeEventListener("mouseenter", resetHidingRefHint);
        refHint.removeEventListener("blur", startHidingRefHint);
        refHint.removeEventListener("focus", resetHidingRefHint);
    };
}

function positionRefHint(refHint) {
    const link = refHint.forLink;
    const linkPos = getBounds(link);
    refHint.style.top = linkPos.bottom + "px";
    refHint.style.left = linkPos.left + "px";

    const panelPos = refHint.getBoundingClientRect();
    const panelMargin = 8;
    const maxRight = document.body.parentNode.clientWidth - panelMargin;
    if (panelPos.right > maxRight) {
        const overflowAmount = panelPos.right - maxRight;
        const newLeft = Math.max(panelMargin, linkPos.left - overflowAmount);
        refHint.style.left = newLeft + "px";
    }
}

// TODO: shared util
// Returns the root-level absolute position {left and top} of element.
function getBounds(el, relativeTo=document.body) {
    const relativeRect = relativeTo.getBoundingClientRect();
    const elRect = el.getBoundingClientRect();
    const top = elRect.top - relativeRect.top;
    const left = elRect.left - relativeRect.left;
    return {
        top,
        left,
        bottom: top + elRect.height,
        right: left + elRect.width,
    }
}

function showRefHintListener(e) {
    // If the target isn't in a link (or is a link),
    // just ignore it.
    let link = e.target.closest("a");
    if(!link) return;

    // If the target is in a ref-hint panel
    // (aka a link in the already-open one),
    // also just ignore it.
    if(link.closest(".ref-hint")) return;

    // Otherwise, show the panel for the link.
    showRefHint(link);
}

function hideAllHintsListener(e) {
    // If the click is inside a ref-hint panel, ignore it.
    if(e.target.closest(".ref-hint")) return;
    // Otherwise, close all the current panels.
    hideAllRefHints();
}

document.addEventListener("DOMContentLoaded", () => {
    document.body.addEventListener("mousedown", showRefHintListener);
    document.body.addEventListener("focus", showRefHintListener);

    document.body.addEventListener("click", hideAllHintsListener);
});

window.addEventListener("resize", () => {
    // Hide any open ref hint.
    hideAllRefHints();
});
}
</script>
<script>/* Boilerplate: script-var-click-highlighting */
"use strict";
{
/*
Color-choosing design:

* Colors are ordered by goodness.
* On clicking a var, give it the earliest color
    with the lowest usage in the algorithm.
* On re-clicking, re-use the var's most recent color
    if that's not currently being used elsewhere.
*/

const COLOR_COUNT = 7;

document.addEventListener("click", e=>{
    if(e.target.nodeName == "VAR") {
        highlightSameAlgoVars(e.target);
    }
});

function highlightSameAlgoVars(v) {
    // Find the algorithm container.
    let algoContainer = findAlgoContainer(v);

    // Not highlighting document-global vars,
    // too likely to be unrelated.
    if(algoContainer == null) return;

    const varName = nameFromVar(v);
    if(!v.hasAttribute("data-var-color")) {
        const newColor = chooseHighlightColor(algoContainer, v);
        for(const el of algoContainer.querySelectorAll("var")) {
            if(nameFromVar(el) == varName) {
                el.setAttribute("data-var-color", newColor);
                el.setAttribute("data-var-last-color", newColor);
            }
        }
    } else {
        for(const el of algoContainer.querySelectorAll("var")) {
            if(nameFromVar(el) == varName) {
                el.removeAttribute("data-var-color");
            }
        }
    }
}
function findAlgoContainer(el) {
    while(el != document.body) {
        if(el.hasAttribute("data-algorithm")) return el;
        el = el.parentNode;
    }
    return null;
}
function nameFromVar(el) {
    return el.textContent.replace(/(\s|\xa0)+/g, " ").trim();
}
function colorCountsFromContainer(container) {
    const namesFromColor = Array.from({length:COLOR_COUNT}, x=>new Set());
    for(let v of container.querySelectorAll("var[data-var-color]")) {
        let color = +v.getAttribute("data-var-color");
        namesFromColor[color].add(nameFromVar(v));
    }

    return namesFromColor.map(x=>x.size);
}
function leastUsedColor(colors) {
    // Find the earliest color with the lowest count.
    let minCount = Infinity;
    let minColor = null;
    for(var i = 0; i < colors.length; i++) {
        if(colors[i] < minCount) {
            minColor = i;
            minCount = colors[i];
        }
    }
    return minColor;
}
function chooseHighlightColor(container, v) {
    const colorCounts = colorCountsFromContainer(container);
    if(v.hasAttribute("data-var-last-color")) {
        let color = +v.getAttribute("data-var-last-color");
        if(colorCounts[color] == 0) return color;
    }
    return leastUsedColor(colorCounts);
}
}
</script>
<script>/* Boilerplate: script-wpt */
"use strict";
{
let wptData = {
"paths": ["/portals/"],
};

document.addEventListener("DOMContentLoaded", async ()=>{
    if(wptData.paths.length == 0) return;

    const runsUrl = "https://wpt.fyi/api/runs?label=master&label=stable&max-count=1&product=chrome&product=firefox&product=safari&product=edge";
    const runs = await (await fetch(runsUrl)).json();

    let testResults = [];
    for(const pathPrefix of wptData.paths) {
        const pathResults = await (await fetch("https://wpt.fyi/api/search", {
            method:"POST",
            headers:{
                "Content-Type":"application/json",
            },
            body: JSON.stringify({
                "run_ids": runs.map(x=>x.id),
                "query": {"path": pathPrefix},
            })
        })).json();
        testResults = testResults.concat(pathResults.results);
    }

    const browsers = runs.map(x=>({name:x.browser_name, version:x.browser_version, passes:0, total: 0}));
    const resultsFromPath = new Map(testResults.map(result=>{
        const testPath = result.test;
        const passes = result.legacy_status.map(x=>[x.passes, x.total]);
        return [testPath, passes];
    }));
    const seenTests = new Set();
    document.querySelectorAll(".wpt-name").forEach(nameEl=>{
        const passData = resultsFromPath.get("/" + nameEl.getAttribute("title"));
        if(!passData) {
            console.log("Couldn't find test in results:", nameEl);
            return
        }
        const numTests = passData[0][1];
        if(numTests > 1) {
            nameEl.insertAdjacentElement("beforeend",
                mk.small({}, ` (${numTests} tests)`));
        }
        if(passData == undefined) return;
        const resultsEl = mk.span({"class":"wpt-results"},
            ...passData.map((p,i) => mk.span(
            {
                "title": `${browsers[i].name} ${p[0]}/${p[1]}`,
                "class": "wpt-result",
                "style": `background: conic-gradient(forestgreen ${p[0]/p[1]*360}deg, darkred 0deg);`,
            })),
        );
        nameEl.insertAdjacentElement("afterend", resultsEl);

        // Only update the summary pass/total count if we haven't seen this
        // test before, to support authors listing the same test multiple times
        // in a spec.
        if (!seenTests.has(nameEl.getAttribute("title"))) {
            seenTests.add(nameEl.getAttribute("title"));
            passData.forEach((p,i) => {
                browsers[i].passes += p[0];
                browsers[i].total += p[1];
            });
        }
    });
    const overview = document.querySelector(".wpt-overview");
    if(overview) {
        overview.appendChild(mk.ul({}, ...browsers.map(formatWptResult)));
        document.head.appendChild(mk.style({},
            `.wpt-overview ul { display: flex; flex-flow: row wrap; gap: .2em; justify-content: start; list-style: none; padding: 0; margin: 0;}
             .wpt-overview li { padding: .25em 1em; color: black; text-align: center; }
             .wpt-overview img { height: 1.5em; height: max(1.5em, 32px); background: transparent; }
             .wpt-overview .browser { font-weight: bold; }
             .wpt-overview .passes-none { background: #e57373; }
             .wpt-overview .passes-hardly { background: #ffb74d; }
             .wpt-overview .passes-a-few { background: #ffd54f; }
             .wpt-overview .passes-half { background: #fff176; }
             .wpt-overview .passes-lots { background: #dce775; }
             .wpt-overview .passes-most { background: #aed581; }
             .wpt-overview .passes-all { background: #81c784; }`));
    }
});

function formatWptResult({name, version, passes, total}) {
    const passRate = passes/total;
    let passClass = "";
    if(passRate == 0)      passClass = "passes-none";
    else if(passRate < .2) passClass = "passes-hardly";
    else if(passRate < .4) passClass = "passes-a-few";
    else if(passRate < .6) passClass = "passes-half";
    else if(passRate < .8) passClass = "passes-lots";
    else if(passRate < 1)  passClass = "passes-most";
    else                   passClass = "passes-all";

    name = name[0].toUpperCase() + name.slice(1);
    const shortVersion = /^\d+/.exec(version);
    const icon = []

    if(name == "Chrome") icon.push(mk.img({alt:"", src:"https://wpt.fyi/static/chrome_64x64.png"}));
    if(name == "Edge") icon.push(mk.img({alt:"", src:"https://wpt.fyi/static/edge_64x64.png"}));
    if(name == "Safari") icon.push(mk.img({alt:"", src:"https://wpt.fyi/static/safari_64x64.png"}));
    if(name == "Firefox") icon.push(mk.img({alt:"", src:"https://wpt.fyi/static/firefox_64x64.png"}));

    return mk.li({"class":passClass},
        mk.nobr({'class':'browser'}, ...icon, ` ${name} ${shortVersion}`),
        mk.br(),
        mk.nobr({'class':'pass-rate'}, `${passes}/${total}`)
    );
}
}
</script>