<!doctype html><html lang="en">
 <head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
  <title>Portals</title>
  <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
  <link href="https://www.w3.org/StyleSheets/TR/2021/cg-draft" rel="stylesheet">
  <link href="https://wicg.github.io/portals/" rel="canonical">
  <meta content="dark light" name="color-scheme">
<style>/* Boilerplate: style-autolinks */
.css.css, .property.property, .descriptor.descriptor {
    color: var(--a-normal-text);
    font-size: inherit;
    font-family: inherit;
}
.css::before, .property::before, .descriptor::before {
    content: "‘";
}
.css::after, .property::after, .descriptor::after {
    content: "’";
}
.property, .descriptor {
    /* Don't wrap property and descriptor names */
    white-space: nowrap;
}
.type { /* CSS value <type> */
    font-style: italic;
}
pre .property::before, pre .property::after {
    content: "";
}
[data-link-type="property"]::before,
[data-link-type="propdesc"]::before,
[data-link-type="descriptor"]::before,
[data-link-type="value"]::before,
[data-link-type="function"]::before,
[data-link-type="at-rule"]::before,
[data-link-type="selector"]::before,
[data-link-type="maybe"]::before {
    content: "‘";
}
[data-link-type="property"]::after,
[data-link-type="propdesc"]::after,
[data-link-type="descriptor"]::after,
[data-link-type="value"]::after,
[data-link-type="function"]::after,
[data-link-type="at-rule"]::after,
[data-link-type="selector"]::after,
[data-link-type="maybe"]::after {
    content: "’";
}

[data-link-type].production::before,
[data-link-type].production::after,
.prod [data-link-type]::before,
.prod [data-link-type]::after {
    content: "";
}

[data-link-type=element],
[data-link-type=element-attr] {
    font-family: Menlo, Consolas, "DejaVu Sans Mono", monospace;
    font-size: .9em;
}
[data-link-type=element]::before { content: "<" }
[data-link-type=element]::after  { content: ">" }

[data-link-type=biblio] {
    white-space: pre;
}

@media (prefers-color-scheme: dark) {
    :root {
        --selflink-text: black;
        --selflink-bg: silver;
        --selflink-hover-text: white;
    }
}
</style>
<style>/* Boilerplate: style-colors */
/* Any --*-text not paired with a --*-bg is assumed to have a transparent bg */
:root {
    color-scheme: light dark;

    --text: black;
    --bg: white;

    --unofficial-watermark: url(https://www.w3.org/StyleSheets/TR/2016/logos/UD-watermark);

    --logo-bg: #1a5e9a;
    --logo-active-bg: #c00;
    --logo-text: white;

    --tocnav-normal-text: #707070;
    --tocnav-normal-bg: var(--bg);
    --tocnav-hover-text: var(--tocnav-normal-text);
    --tocnav-hover-bg: #f8f8f8;
    --tocnav-active-text: #c00;
    --tocnav-active-bg: var(--tocnav-normal-bg);

    --tocsidebar-text: var(--text);
    --tocsidebar-bg: #f7f8f9;
    --tocsidebar-shadow: rgba(0,0,0,.1);
    --tocsidebar-heading-text: hsla(203,20%,40%,.7);

    --toclink-text: var(--text);
    --toclink-underline: #3980b5;
    --toclink-visited-text: var(--toclink-text);
    --toclink-visited-underline: #054572;

    --heading-text: #005a9c;

    --hr-text: var(--text);

    --algo-border: #def;

    --del-text: red;
    --del-bg: transparent;
    --ins-text: #080;
    --ins-bg: transparent;

    --a-normal-text: #034575;
    --a-normal-underline: #bbb;
    --a-visited-text: var(--a-normal-text);
    --a-visited-underline: #707070;
    --a-hover-bg: rgba(75%, 75%, 75%, .25);
    --a-active-text: #c00;
    --a-active-underline: #c00;

    --blockquote-border: silver;
    --blockquote-bg: transparent;
    --blockquote-text: currentcolor;

    --issue-border: #e05252;
    --issue-bg: #fbe9e9;
    --issue-text: var(--text);
    --issueheading-text: #831616;

    --example-border: #e0cb52;
    --example-bg: #fcfaee;
    --example-text: var(--text);
    --exampleheading-text: #574b0f;

    --note-border: #52e052;
    --note-bg: #e9fbe9;
    --note-text: var(--text);
    --noteheading-text: hsl(120, 70%, 30%);
    --notesummary-underline: silver;

    --assertion-border: #aaa;
    --assertion-bg: #eee;
    --assertion-text: black;

    --advisement-border: orange;
    --advisement-bg: #fec;
    --advisement-text: var(--text);
    --advisementheading-text: #b35f00;

    --warning-border: red;
    --warning-bg: hsla(40,100%,50%,0.95);
    --warning-text: var(--text);

    --amendment-border: #330099;
    --amendment-bg: #F5F0FF;
    --amendment-text: var(--text);
    --amendmentheading-text: #220066;

    --def-border: #8ccbf2;
    --def-bg: #def;
    --def-text: var(--text);
    --defrow-border: #bbd7e9;

    --datacell-border: silver;

    --indexinfo-text: #707070;

    --indextable-hover-text: black;
    --indextable-hover-bg: #f7f8f9;

    --outdatedspec-bg: rgba(0, 0, 0, .5);
    --outdatedspec-text: black;
    --outdated-bg: maroon;
    --outdated-text: white;
    --outdated-shadow: red;

    --editedrec-bg: darkorange;
}

@media (prefers-color-scheme: dark) {
    :root {
        --text: #ddd;
        --bg: black;

        --unofficial-watermark: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='400'%3E%3Cg fill='%23100808' transform='translate(200 200) rotate(-45) translate(-200 -200)' stroke='%23100808' stroke-width='3'%3E%3Ctext x='50%25' y='220' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EUNOFFICIAL%3C/text%3E%3Ctext x='50%25' y='305' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EDRAFT%3C/text%3E%3C/g%3E%3C/svg%3E");

        --logo-bg: #1a5e9a;
        --logo-active-bg: #c00;
        --logo-text: white;

        --tocnav-normal-text: #999;
        --tocnav-normal-bg: var(--bg);
        --tocnav-hover-text: var(--tocnav-normal-text);
        --tocnav-hover-bg: #080808;
        --tocnav-active-text: #f44;
        --tocnav-active-bg: var(--tocnav-normal-bg);

        --tocsidebar-text: var(--text);
        --tocsidebar-bg: #080808;
        --tocsidebar-shadow: rgba(255,255,255,.1);
        --tocsidebar-heading-text: hsla(203,20%,40%,.7);

        --toclink-text: var(--text);
        --toclink-underline: #6af;
        --toclink-visited-text: var(--toclink-text);
        --toclink-visited-underline: #054572;

        --heading-text: #8af;

        --hr-text: var(--text);

        --algo-border: #456;

        --del-text: #f44;
        --del-bg: transparent;
        --ins-text: #4a4;
        --ins-bg: transparent;

        --a-normal-text: #6af;
        --a-normal-underline: #555;
        --a-visited-text: var(--a-normal-text);
        --a-visited-underline: var(--a-normal-underline);
        --a-hover-bg: rgba(25%, 25%, 25%, .2);
        --a-active-text: #f44;
        --a-active-underline: var(--a-active-text);

        --borderedblock-bg: rgba(255, 255, 255, .05);

        --blockquote-border: silver;
        --blockquote-bg: var(--borderedblock-bg);
        --blockquote-text: currentcolor;

        --issue-border: #e05252;
        --issue-bg: var(--borderedblock-bg);
        --issue-text: var(--text);
        --issueheading-text: hsl(0deg, 70%, 70%);

        --example-border: hsl(50deg, 90%, 60%);
        --example-bg: var(--borderedblock-bg);
        --example-text: var(--text);
        --exampleheading-text: hsl(50deg, 70%, 70%);

        --note-border: hsl(120deg, 100%, 35%);
        --note-bg: var(--borderedblock-bg);
        --note-text: var(--text);
        --noteheading-text: hsl(120, 70%, 70%);
        --notesummary-underline: silver;

        --assertion-border: #444;
        --assertion-bg: var(--borderedblock-bg);
        --assertion-text: var(--text);

        --advisement-border: orange;
        --advisement-bg: #222218;
        --advisement-text: var(--text);
        --advisementheading-text: #f84;

        --warning-border: red;
        --warning-bg: hsla(40,100%,20%,0.95);
        --warning-text: var(--text);

        --amendment-border: #330099;
        --amendment-bg: #080010;
        --amendment-text: var(--text);
        --amendmentheading-text: #cc00ff;

        --def-border: #8ccbf2;
        --def-bg: #080818;
        --def-text: var(--text);
        --defrow-border: #136;

        --datacell-border: silver;

        --indexinfo-text: #aaa;

        --indextable-hover-text: var(--text);
        --indextable-hover-bg: #181818;

        --outdatedspec-bg: rgba(255, 255, 255, .5);
        --outdatedspec-text: black;
        --outdated-bg: maroon;
        --outdated-text: white;
        --outdated-shadow: red;

        --editedrec-bg: darkorange;
    }
    /* In case a transparent-bg image doesn't expect to be on a dark bg,
       which is quite common in practice... */
    img { background: white; }
}
</style>
<style>/* Boilerplate: style-counters */
body {
    counter-reset: example figure issue;
}
.issue {
    counter-increment: issue;
}
.issue:not(.no-marker)::before {
    content: "Issue " counter(issue);
}

.example {
    counter-increment: example;
}
.example:not(.no-marker)::before {
    content: "Example " counter(example);
}
.invalid.example:not(.no-marker)::before,
.illegal.example:not(.no-marker)::before {
    content: "Invalid Example" counter(example);
}

figcaption {
    counter-increment: figure;
}
figcaption:not(.no-marker)::before {
    content: "Figure " counter(figure) " ";
}
</style>
<style>/* Boilerplate: style-issues */
a[href].issue-return {
    float: right;
    float: inline-end;
    color: var(--issueheading-text);
    font-weight: bold;
    text-decoration: none;
}
</style>
<style>/* Boilerplate: style-md-lists */
/* This is a weird hack for me not yet following the commonmark spec
   regarding paragraph and lists. */
[data-md] > :first-child {
    margin-top: 0;
}
[data-md] > :last-child {
    margin-bottom: 0;
}
</style>
<style>/* Boilerplate: style-selflinks */
:root {
    --selflink-text: white;
    --selflink-bg: gray;
    --selflink-hover-text: black;
}
.heading, .issue, .note, .example, li, dt {
    position: relative;
}
a.self-link {
    position: absolute;
    top: 0;
    left: calc(-1 * (3.5rem - 26px));
    width: calc(3.5rem - 26px);
    height: 2em;
    text-align: center;
    border: none;
    transition: opacity .2s;
    opacity: .5;
}
a.self-link:hover {
    opacity: 1;
}
.heading > a.self-link {
    font-size: 83%;
}
.example > a.self-link,
.note > a.self-link,
.issue > a.self-link {
    /* These blocks are overflow:auto, so positioning outside
       doesn't work. */
    left: auto;
    right: 0;
}
li > a.self-link {
    left: calc(-1 * (3.5rem - 26px) - 2em);
}
dfn > a.self-link {
    top: auto;
    left: auto;
    opacity: 0;
    width: 1.5em;
    height: 1.5em;
    background: var(--selflink-bg);
    color: var(--selflink-text);
    font-style: normal;
    transition: opacity .2s, background-color .2s, color .2s;
}
dfn:hover > a.self-link {
    opacity: 1;
}
dfn > a.self-link:hover {
    color: var(--selflink-hover-text);
}

a.self-link::before            { content: "¶"; }
.heading > a.self-link::before { content: "§"; }
dfn > a.self-link::before      { content: "#"; }
</style>
 <body class="h-entry">
  <div class="head">
   <p data-fill-with="logo"><a class="logo" href="https://www.w3.org/"> <img alt="W3C" height="48" src="https://www.w3.org/StyleSheets/TR/2021/logos/W3C" width="72"> </a> </p>
   <h1 class="p-name no-ref" id="title">Portals</h1>
   <p id="w3c-state"><a href="https://www.w3.org/standards/types/#CG-DRAFT">Draft Community Group Report</a>, <time class="dt-updated" datetime="1970-01-01">1 January 1970</time></p>
   <div data-fill-with="spec-metadata">
    <dl>
     <dt>This version:
     <dd><a class="u-url" href="https://wicg.github.io/portals/">https://wicg.github.io/portals/</a>
     <dt class="editor">Editors:
     <dd class="editor p-author h-card vcard"><a class="p-name fn u-email email" href="mailto:jbroman@chromium.org">Jeremy Roman</a> (<span class="p-org org">Google</span>)
     <dd class="editor p-author h-card vcard"><a class="p-name fn u-email email" href="mailto:lfg@chromium.org">Lucas Gadani</a> (<span class="p-org org">Google</span>)
    </dl>
   </div>
   <div data-fill-with="warning"></div>
   <p class="copyright" data-fill-with="copyright"><a href="https://www.w3.org/policies/#copyright">Copyright</a> © 1970 the Contributors to the Portals Specification, published by the <a href="https://www.w3.org/community/wicg/">Web Platform Incubator Community Group</a> under the <a href="https://www.w3.org/community/about/agreements/cla/">W3C Community Contributor License Agreement (CLA)</a>.
A human-readable <a href="http://www.w3.org/community/about/agreements/cla-deed/">summary</a> is available. </p>
   <hr title="Separator for header">
  </div>
  <div class="p-summary" data-fill-with="abstract">
   <h2 class="no-num no-toc no-ref heading settled" id="abstract"><span class="content">Abstract</span><a class="self-link" href="#abstract"></a></h2>
   <p>This specification defines a mechanism that allows for rendering of, and seamless navigation to, embedded content.</p>
  </div>
  <div data-fill-with="at-risk"></div>
  <h2 class="no-num no-toc no-ref heading settled" id="status"><span class="content">Status of this document</span></h2>
  <div data-fill-with="status">
   <p> This specification was published by the <a href="https://www.w3.org/community/wicg/">Web Platform Incubator Community Group</a>.
  It is not a W3C Standard nor is it on the W3C Standards Track.

  Please note that under the <a href="https://www.w3.org/community/about/agreements/cla/">W3C Community Contributor License Agreement (CLA)</a> there is a limited opt-out and other conditions apply.

  Learn more about <a href="http://www.w3.org/community/">W3C Community and Business Groups</a>. </p>
   <p></p>
  </div>
  <div data-fill-with="at-risk"></div>
  <nav data-fill-with="table-of-contents" id="toc">
   <h2 class="no-num no-toc no-ref heading settled" id="contents"><span class="content">Table of Contents</span></h2>
   <ol class="toc" role="directory">
    <li><a href="#intro"><span class="secno">1</span> <span class="content">Introduction</span></a>
    <li><a href="#concepts"><span class="secno">2</span> <span class="content">Portal browsing contexts</span></a>
    <li>
     <a href="#the-portal-element"><span class="secno">3</span> <span class="content">The <code>portal</code> element</span></a>
     <ol class="toc">
      <li><a href="#the-portalhost-interface"><span class="secno">3.1</span> <span class="content">Portal hosts</span></a>
      <li><a href="#the-portalactivateevent-interface"><span class="secno">3.2</span> <span class="content">The <code>PortalActivateEvent</code> interface</span></a>
     </ol>
    <li>
     <a href="#miscellaneous-extensions"><span class="secno">4</span> <span class="content">Miscellaneous HTML updates</span></a>
     <ol class="toc">
      <li><a href="#patch-messageevent"><span class="secno">4.1</span> <span class="content">The <code class="idl"><span>MessageEvent</span></code> interface</span></a>
      <li><a href="#patch-event-handlers"><span class="secno">4.2</span> <span class="content">Event handlers</span></a>
      <li><a href="#patch-window-apis"><span class="secno">4.3</span> <span class="content">APIs for creating and navigating browsing contexts by name</span></a>
      <li><a href="#patch-navigation"><span class="secno">4.4</span> <span class="content">Navigation</span></a>
      <li><a href="#patch-downloading"><span class="secno">4.5</span> <span class="content">Downloading resources</span></a>
     </ol>
    <li>
     <a href="#other-spec-updates"><span class="secno">5</span> <span class="content">Updates to other specifications</span></a>
     <ol class="toc">
      <li>
       <a href="#csp"><span class="secno">5.1</span> <span class="content">Content Security Policy</span></a>
       <ol class="toc">
        <li>
         <a href="#portal-src-directive"><span class="secno">5.1.1</span> <span class="content"><code>portal-src</code></span></a>
         <ol class="toc">
          <li><a href="#portal-src-pre-request"><span class="secno">5.1.1.1</span> <span class="content"><code>portal-src</code> Pre-request check</span></a>
          <li><a href="#portal-src-post-request"><span class="secno">5.1.1.2</span> <span class="content"><code>portal-src</code> Post-request check</span></a>
         </ol>
        <li><a href="#default-src-patch"><span class="secno">5.1.2</span> <span class="content"><code>default-src</code></span></a>
        <li><a href="#directive-fallback-list-patch"><span class="secno">5.1.3</span> <span class="content">Get fetch directive fallback list</span></a>
       </ol>
      <li><a href="#fetch-metadata"><span class="secno">5.2</span> <span class="content">Fetch Metadata Request Headers</span></a>
     </ol>
    <li>
     <a href="#security-considerations"><span class="secno">6</span> <span class="content">Security Considerations</span></a>
     <ol class="toc">
      <li><a href="#security-overview"><span class="secno">6.1</span> <span class="content">Overview</span></a>
     </ol>
    <li><a href="#untriaged-tests"><span class="secno">7</span> <span class="content">Untriaged tests</span></a>
    <li>
     <a href="#w3c-conformance"><span class="secno"></span> </a>
     <ol class="toc">
      <li><a href="#w3c-conventions"><span class="secno"></span> </a>
     </ol>
    <li>
     <a href="#index"><span class="secno"></span> <span class="content">Index</span></a>
     <ol class="toc">
      <li><a href="#index-defined-here"><span class="secno"></span> <span class="content">Terms defined by this specification</span></a>
      <li><a href="#index-defined-elsewhere"><span class="secno"></span> <span class="content">Terms defined by reference</span></a>
     </ol>
    <li>
     <a href="#references"><span class="secno"></span> <span class="content">References</span></a>
     <ol class="toc">
      <li><a href="#normative"><span class="secno"></span> <span class="content">Normative References</span></a>
      <li><a href="#informative"><span class="secno"></span> <span class="content">Informative References</span></a>
     </ol>
    <li><a href="#idl-index"><span class="secno"></span> <span class="content">IDL Index</span></a>
    <li><a href="#issues-index"><span class="secno"></span> <span class="content">Issues Index</span></a>
   </ol>
  </nav>
  <main>
   <details class="annoying-warning">
    <summary>This spec is behind the explainer</summary>
    <p>This specification document has not yet been updated to reflect the 2020-04 updates to <a href="https://github.com/WICG/portals#readme">the explainer</a>. We’ll fix that as soon as we
  can, but please be aware that there are probably contradictions, and the explainer should be taken
  as more authoritative for the time being.</p>
   </details>
   <section class="non-normative">
    <h2 class="heading settled" data-level="1" id="intro"><span class="secno">1. </span><span class="content">Introduction</span><a class="self-link" href="#intro"></a></h2>
    <p><em>This section is non-normative.</em></p>
    <p>This specification extends <a data-link-type="biblio" href="#biblio-html" title="HTML Standard">[HTML]</a> to define a new kind of <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#top-level-browsing-context" id="ref-for-top-level-browsing-context">top-level browsing context</a>,
  which can be embedded in another document, and a mechanism for replacing the contents of another
  top-level browsing context with the previously embedded context.</p>
    <p>It is structured as a series of patches to HTML and other specifications, with each major section
  indicating where each it would be placed in the event of eventual graduation from incubation.</p>
    <p>See also the <a href="https://github.com/WICG/portals">explainer</a> for more background and
  motivation.</p>
   </section>
   <section>
    <h2 class="heading settled" data-level="2" id="concepts"><span class="secno">2. </span><span class="content">Portal browsing contexts</span><a class="self-link" href="#concepts"></a></h2>
    <p><em>The following section would be added as a new sub-section of <a data-link-type="biblio" href="#biblio-html" title="HTML Standard">[HTML]</a>’s <a href="https://html.spec.whatwg.org/#windows">Browsing contexts</a> section.</em></p>
    <p>Every <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#browsing-context" id="ref-for-browsing-context">browsing context</a> has a <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="portal-state">portal state</dfn>, which may be "<code>none</code>" (the default), "<code>portal</code>" or "<code>orphaned</code>".
  A <a data-link-type="dfn">nested browsing context</a> always has the <a data-link-type="dfn" href="#portal-state" id="ref-for-portal-state">portal state</a> "<code>none</code>".</p>
    <div class="note" role="note">
      Briefly, these correspond to: 
     <ul>
      <li data-md>
       <p>"<code>portal</code>": top-level browsing contexts embedded in a <code><a data-link-type="element" href="#elementdef-portal" id="ref-for-elementdef-portal">portal</a></code> element</p>
      <li data-md>
       <p>"<code>orphaned</code>": top-level browsing contexts which have run <code class="idl"><a data-link-type="idl" href="#dom-htmlportalelement-activate" id="ref-for-dom-htmlportalelement-activate">activate</a></code> but have not (yet) been <a data-link-type="dfn" href="#adopt-the-predecessor-browsing-context" id="ref-for-adopt-the-predecessor-browsing-context">adopted</a></p>
      <li data-md>
       <p>"<code>none</code>": all other browsing contexts</p>
     </ul>
     <p><img alt="Diagram of portal state transitions" src="portals-state-transitions.svg" style="width: 100%"></p>
     <p>A top-level "<code>none</code>" context can become "<code>orphaned</code>" by <a data-link-type="dfn" href="#activate-a-portal-browsing-context" id="ref-for-activate-a-portal-browsing-context">activating</a> another context. An "<code>orphaned</code>" context can be <a data-link-type="dfn" href="#adopt-the-predecessor-browsing-context" id="ref-for-adopt-the-predecessor-browsing-context①">adopted</a> to
    become a "<code>portal</code>" context. A "<code>portal</code>" context can become a "<code>none</code>" context by being <a data-link-type="dfn" href="#activate-a-portal-browsing-context" id="ref-for-activate-a-portal-browsing-context①">activated</a> by its <a data-link-type="dfn" href="#host-browsing-context" id="ref-for-host-browsing-context">host browsing context</a>.</p>
     <p>A browsing context can be <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/window-object.html#close-a-browsing-context" id="ref-for-close-a-browsing-context">closed</a> while in any of these states.</p>
    </div>
    <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="portal-browsing-context">portal browsing context</dfn> is a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#browsing-context" id="ref-for-browsing-context①">browsing context</a> whose <a data-link-type="dfn" href="#portal-state" id="ref-for-portal-state①">portal state</a> is "<code>portal</code>".</p>
    <p>The <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="host-element">host element</dfn> of a <a data-link-type="dfn" href="#portal-browsing-context" id="ref-for-portal-browsing-context">portal browsing context</a> is a <code><a data-link-type="element" href="#elementdef-portal" id="ref-for-elementdef-portal①">portal</a></code> element which embeds its rendered output and receives messages sent from the
  portal browsing context.</p>
    <div class="note" role="note"> A <code><a data-link-type="element" href="#elementdef-portal" id="ref-for-elementdef-portal②">portal</a></code> element may only be a <a data-link-type="dfn" href="#host-element" id="ref-for-host-element">host element</a> while it is <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#browsing-context-connected" id="ref-for-browsing-context-connected">browsing-context connected</a> or during the dispatch of the <code class="idl"><a class="idl-code" data-link-type="event" href="#eventdef-window-portalactivate" id="ref-for-eventdef-window-portalactivate">portalactivate</a></code> event from which it was obtained
    using <code class="idl"><a data-link-type="idl" href="#dom-portalactivateevent-adoptpredecessor" id="ref-for-dom-portalactivateevent-adoptpredecessor">adoptPredecessor()</a></code>. </div>
    <p>The <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="host-browsing-context">host browsing context</dfn> of a <a data-link-type="dfn" href="#portal-browsing-context" id="ref-for-portal-browsing-context①">portal browsing context</a> is its <a data-link-type="dfn" href="#host-element" id="ref-for-host-element①">host element</a>’s <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-node-document" id="ref-for-concept-node-document">node document</a>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#browsing-context" id="ref-for-browsing-context②">browsing context</a>.</p>
    <p>The <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="portal-task-source">portal task source</dfn> is a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#task-source" id="ref-for-task-source">task source</a> used for tasks related to the
  portal lifecycle and communication between a <a data-link-type="dfn" href="#portal-browsing-context" id="ref-for-portal-browsing-context②">portal browsing context</a> and its <a data-link-type="dfn" href="#host-browsing-context" id="ref-for-host-browsing-context①">host browsing context</a>.</p>
    <section class="algorithm" data-algorithm="portal-browsing-context-activate">
      To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="activate-a-portal-browsing-context">activate a portal browsing context</dfn> <var>successorBrowsingContext</var> in
    place of <var>predecessorBrowsingContext</var> with <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin" id="ref-for-concept-origin">origin</a> <var>sourceOrigin</var>, optional data <var>serializeWithTransferResult</var>, and optional promise <var>promise</var>, run the following steps <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel" id="ref-for-in-parallel">in parallel</a>: 
     <ol>
      <li data-md>
       <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#assert" id="ref-for-assert">Assert</a>: The <a data-link-type="dfn" href="#portal-state" id="ref-for-portal-state②">portal state</a> of <var>predecessorBrowsingContext</var> is "<code>none</code>".</p>
      <li data-md>
       <p>If <var>successorBrowsingContext</var>’s only entry in its <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/history.html#session-history" id="ref-for-session-history">session history</a> is the initial <code>about:blank</code> <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#document" id="ref-for-document">Document</a></code>, then wait until either this is no longer true, or <var>successorBrowsingContext</var>’s <a data-link-type="dfn" href="#host-element" id="ref-for-host-element②">host element</a> becomes null.</p>
       <p class="note" role="note">This means that the initial load is still happening in <var>successorBrowsingContext</var>. We wait for it to complete, either successfully or
unsuccessfully, before continuing.</p>
      <li data-md>
       <p>If <var>successorBrowsingContext</var>’s <a data-link-type="dfn" href="#host-element" id="ref-for-host-element③">host element</a> is null, then:</p>
       <ol>
        <li data-md>
         <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task" id="ref-for-queue-a-global-task">Queue a global task</a> on the <a data-link-type="dfn" href="#portal-task-source" id="ref-for-portal-task-source">portal task source</a> given <var>predecessorBrowsingContext</var>’s <a data-link-type="dfn">active window</a> to <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#reject" id="ref-for-reject">reject</a> <var>promise</var> with an "<code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#invalidstateerror" id="ref-for-invalidstateerror">InvalidStateError</a></code>" <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException">DOMException</a></code>.</p>
        <li data-md>
         <p>Return.</p>
       </ol>
      <li data-md>
       <p>Set the <a data-link-type="dfn" href="#host-element" id="ref-for-host-element④">host element</a> of <var>successorBrowsingContext</var> to null.</p>
       <p>User agents <em>should</em>, however, attempt to preserve the rendering of the
guest browsing context until <var>predecessorBrowsingContext</var> has been replaced
with <var>successorBrowsingContext</var> in the rendering.</p>
       <p class="note" role="note"><span class="marker">Note:</span> This is intended to avoid a visual glitch, such as a "white flash", where
the guest browsing context briefly disappears.</p>
      <li data-md>
       <p>Set the <a data-link-type="dfn" href="#portal-state" id="ref-for-portal-state③">portal state</a> of <var>predecessorBrowsingContext</var> to "<code>orphaned</code>".</p>
      <li data-md>
       <p>Update the user interface to replace <var>predecessorBrowsingContext</var> with <var>successorBrowsingContext</var> (e.g., by updating the tab/window contents and browser chrome).</p>
      <li data-md>
       <p>Let <var>successorWindow</var> be <var>successorBrowsingContext</var>’s associated <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#windowproxy" id="ref-for-windowproxy">WindowProxy</a></code>’s [[Window]] internal slot value.</p>
      <li data-md>
       <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task" id="ref-for-queue-a-global-task①">Queue a global task</a> on the <a data-link-type="dfn" href="#portal-task-source" id="ref-for-portal-task-source①">portal task source</a> given <var>successorWindow</var> to run the
following steps:</p>
       <ol>
        <li data-md>
         <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#assert" id="ref-for-assert①">Assert</a>: The <a data-link-type="dfn" href="#portal-state" id="ref-for-portal-state④">portal state</a> of <var>successorBrowsingContext</var> is "<code>portal</code>".</p>
        <li data-md>
         <p>Set the <a data-link-type="dfn" href="#portal-state" id="ref-for-portal-state⑤">portal state</a> of <var>successorBrowsingContext</var> to "<code>none</code>".</p>
        <li data-md>
         <p>Let <var>targetRealm</var> be <var>successorWindow</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-global-object-realm" id="ref-for-concept-global-object-realm">realm</a>.</p>
        <li data-md>
         <p>Let <var>dataClone</var> be null.</p>
        <li data-md>
         <p>If <var>serializeWithTransferResult</var> is given and <var>successorBrowsingContext</var>’s <a data-link-type="dfn">active document</a>’s <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-document-origin" id="ref-for-concept-document-origin">origin</a> is <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#same-origin" id="ref-for-same-origin">same origin</a> with <var>sourceOrigin</var>, then:</p>
         <ol>
          <li data-md>
           <p>Let <var>deserializeRecord</var> be <a data-link-type="abstract-op" href="https://html.spec.whatwg.org/multipage/structured-data.html#structureddeserializewithtransfer" id="ref-for-structureddeserializewithtransfer">StructuredDeserializeWithTransfer</a>(<var>serializeWithTransferResult</var>, <var>targetRealm</var>),
and set <var>dataClone</var> to <var>deserializeRecord</var>.[[Deserialized]].</p>
           <p>If this throws an exception, catch it and do nothing.</p>
         </ol>
        <li data-md>
         <p>Let <var>event</var> be the result of <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-event-create" id="ref-for-concept-event-create">creating an event</a> using <code class="idl"><a data-link-type="idl" href="#portalactivateevent" id="ref-for-portalactivateevent">PortalActivateEvent</a></code> and <var>targetRealm</var>.</p>
        <li data-md>
         <p>Initialize <var>event</var>’s <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#dom-event-type" id="ref-for-dom-event-type">type</a></code> attribute to <code class="idl"><a class="idl-code" data-link-type="event" href="#eventdef-window-portalactivate" id="ref-for-eventdef-window-portalactivate①">portalactivate</a></code>.</p>
        <li data-md>
         <p>Initialize <var>event</var>’s <code class="idl"><a data-link-type="idl" href="#dom-portalactivateevent-data" id="ref-for-dom-portalactivateevent-data">data</a></code> attribute to <var>dataClone</var>.</p>
        <li data-md>
         <p>Set <var>event</var>’s <a data-link-type="dfn" href="#portalactivateevent-predecessor-browsing-context" id="ref-for-portalactivateevent-predecessor-browsing-context">predecessor browsing context</a> to <var>predecessorBrowsingContext</var>.</p>
        <li data-md>
         <p>Set <var>event</var>’s <a data-link-type="dfn" href="#portalactivateevent-successor-window" id="ref-for-portalactivateevent-successor-window">successor window</a> to <var>successorWindow</var>.</p>
        <li data-md>
         <p>Set <var>event</var>’s <a data-link-type="dfn" href="#portalactivateevent-activation-promise" id="ref-for-portalactivateevent-activation-promise">activation promise</a> to <var>promise</var>, if it is given, and null otherwise.</p>
        <li data-md>
         <p><a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-event-dispatch" id="ref-for-concept-event-dispatch">Dispatch</a> <var>event</var> to <var>successorWindow</var>.</p>
        <li data-md>
         <p>Let <var>adoptedPredecessorElement</var> be <var>event</var>’s <a data-link-type="dfn" href="#portalactivateevent-adopted-predecessor-element" id="ref-for-portalactivateevent-adopted-predecessor-element">adopted predecessor element</a>.</p>
        <li data-md>
         <p>If <var>adoptedPredecessorElement</var> is not null, then:</p>
         <ol>
          <li data-md>
           <p>Set <var>adoptedPredecessorElement</var>’s <a data-link-type="dfn" href="#htmlportalelement-just-adopted-flag" id="ref-for-htmlportalelement-just-adopted-flag">just-adopted flag</a> to false.</p>
          <li data-md>
           <p>If <var>adoptedPredecessorElement</var> <a data-link-type="dfn" href="#may-have-a-guest-browsing-context" id="ref-for-may-have-a-guest-browsing-context">may not have a guest browsing context</a> and
its <a data-link-type="dfn" href="#htmlportalelement-guest-browsing-context" id="ref-for-htmlportalelement-guest-browsing-context">guest browsing context</a> is not null, then <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/window-object.html#a-browsing-context-is-discarded" id="ref-for-a-browsing-context-is-discarded">discard</a> it.</p>
           <div class="note" role="note">
             This unceremoniously <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/window-object.html#a-browsing-context-is-discarded" id="ref-for-a-browsing-context-is-discarded①">discards</a> the browsing context, as if the element had been removed from
  the document after previously being attached. This is
  distinct from the case where the predecessor was never
  adopted, below, which <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/window-object.html#close-a-browsing-context" id="ref-for-close-a-browsing-context①">closes</a> the
  browsing context. Closing <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#unload-a-document" id="ref-for-unload-a-document">unloads</a> the predecessor’s
  document, somewhat similarly to if it had performed an ordinary
  navigation. 
            <p>Typically authors would not call <code class="idl"><a data-link-type="idl" href="#dom-portalactivateevent-adoptpredecessor" id="ref-for-dom-portalactivateevent-adoptpredecessor①">adoptPredecessor()</a></code> unless they intend
  to insert it into the document before the <a data-link-type="dfn" href="#htmlportalelement-just-adopted-flag" id="ref-for-htmlportalelement-just-adopted-flag①">just-adopted flag</a> becomes false.</p>
           </div>
         </ol>
        <li data-md>
         <p>Otherwise:</p>
         <ol>
          <li data-md>
           <p>If <var>promise</var> is given, <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task" id="ref-for-queue-a-global-task②">queue a global task</a> on the <a data-link-type="dfn" href="#portal-task-source" id="ref-for-portal-task-source②">portal task source</a> given <var>predecessorBrowsingContext</var>’s <a data-link-type="dfn">active window</a> to resolve <var>promise</var> with undefined.</p>
          <li data-md>
           <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/window-object.html#close-a-browsing-context" id="ref-for-close-a-browsing-context②">Close</a> <var>predecessorBrowsingContext</var>.</p>
           <p>The user agent <em>should not</em> ask the user for confirmation during the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#prompt-to-unload-a-document" id="ref-for-prompt-to-unload-a-document">prompt to unload</a> step (and so the browsing context should be <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/window-object.html#a-browsing-context-is-discarded" id="ref-for-a-browsing-context-is-discarded②">discarded</a>).</p>
           <div class="note" role="note"> Authors should not expect the <code class="idl"><a class="idl-code" data-link-type="event" href="https://html.spec.whatwg.org/multipage/indices.html#event-unload" id="ref-for-event-unload">unload</a></code> event
  to be dispatched consistently following portal activation. In
  addition to adoption of the predecessor, where the predecessor
  would not be <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#unload-a-document" id="ref-for-unload-a-document①">unloaded</a> at all, the predecessor could
  also enter bfcache (back forward cache) where the unload event
  would not be dispatched. </div>
           <div class="issue" id="issue-c722a2b5"><a class="self-link" href="#issue-c722a2b5"></a> Determine how to treat unload/beforeunload handlers. See <a href="https://github.com/WICG/portals/issues/225">issue #225</a> for discussion. </div>
         </ol>
       </ol>
     </ol>
    </section>
    <details class="wpt-tests-block" dir="ltr" lang="en" open>
     <summary>Tests</summary>
     <ul class="wpt-tests-list"></ul>
    </details>
    <div class="issue" id="issue-b49e4903"><a class="self-link" href="#issue-b49e4903"></a> In the case that structured deserialization throws, it may be useful to do something else to indicate it,
    rather than simply providing null data. </div>
    <div class="issue" id="issue-0d72b101"><a class="self-link" href="#issue-0d72b101"></a> We need to specify how the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/history.html#session-history" id="ref-for-session-history①">session history</a> of each browsing context is
    affected by activation, and supply non-normative text that explains how
    these histories are expected to be presented to the user. </div>
    <section class="algorithm" data-algorithm="portal-browsing-context-adopt-predecessor">
      To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="adopt-the-predecessor-browsing-context">adopt the predecessor browsing context</dfn> <var>predecessorBrowsingContext</var> in <var>successorWindow</var>, run the following steps: 
     <ol>
      <li data-md>
       <p>Let <var>document</var> be the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window" id="ref-for-concept-document-window">document</a> of <var>successorWindow</var>.</p>
      <li data-md>
       <p>Let <var>portalElement</var> be the result of <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-create-element" id="ref-for-concept-create-element">creating an element</a> given <var>document</var>, <code>portal</code>, and the <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#html-namespace" id="ref-for-html-namespace">HTML namespace</a>.</p>
      <li data-md>
       <p>Set <var>portalElement</var>’s <a data-link-type="dfn" href="#htmlportalelement-just-adopted-flag" id="ref-for-htmlportalelement-just-adopted-flag②">just-adopted flag</a> to true.</p>
      <li data-md>
       <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#assert" id="ref-for-assert②">Assert</a>: <var>portalElement</var> is an <code class="idl"><a data-link-type="idl" href="#htmlportalelement" id="ref-for-htmlportalelement">HTMLPortalElement</a></code>.</p>
      <li data-md>
       <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task" id="ref-for-queue-a-global-task③">Queue a global task</a> on the <a data-link-type="dfn" href="#portal-task-source" id="ref-for-portal-task-source③">portal task source</a> given <var>predecessorBrowsingContext</var>’s <a data-link-type="dfn">active window</a> to run the following steps:</p>
       <ol>
        <li data-md>
         <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#assert" id="ref-for-assert③">Assert</a>: The <a data-link-type="dfn" href="#portal-state" id="ref-for-portal-state⑥">portal state</a> of <var>predecessorBrowsingContext</var> is "<code>orphaned</code>".</p>
        <li data-md>
         <p>Set the <a data-link-type="dfn" href="#portal-state" id="ref-for-portal-state⑦">portal state</a> of <var>predecessorBrowsingContext</var> to "<code>portal</code>", and
set the <a data-link-type="dfn" href="#host-element" id="ref-for-host-element⑤">host element</a> of <var>predecessorBrowsingContext</var> to <var>portalElement</var>.</p>
       </ol>
      <li data-md>
       <p>Return <var>portalElement</var>.</p>
     </ol>
    </section>
    <div class="note" role="note">
      Since the task to set the <a data-link-type="dfn" href="#portal-state" id="ref-for-portal-state⑧">portal state</a>, and thus expose the <code class="idl"><a data-link-type="idl" href="#portalhost" id="ref-for-portalhost">PortalHost</a></code> object, is queued first, and from the same <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#task-source" id="ref-for-task-source①">task source</a>,
    it is exposed at the time the <a data-link-type="dfn" href="#portalactivateevent-activation-promise" id="ref-for-portalactivateevent-activation-promise①">activation promise</a> returned from <code class="idl"><a data-link-type="idl" href="#dom-htmlportalelement-activate" id="ref-for-dom-htmlportalelement-activate①">activate(options)</a></code> is resolved. 
<pre class="highlight"><c- c1>// In the successor document.</c->
onportalactivate <c- o>=</c-> event <c- p>=></c-> <c- p>{</c->
  <c- c1>// The predecessor document is adopted into a &lt;portal> element...</c->
  document<c- p>.</c->body<c- p>.</c->appendChild<c- p>(</c->event<c- p>.</c->adoptPredecessor<c- p>());</c->
<c- p>});</c->

<c- c1>// In the predecessor document.</c->
portalElement<c- p>.</c->activate<c- p>().</c->then<c- p>(()</c-> <c- p>=></c-> <c- p>{</c->
  <c- c1>// ...and it is guaranteed to observe that change by the time the</c->
  <c- c1>// activation promise resolves.</c->
  console<c- p>.</c->assert<c- p>(</c->window<c- p>.</c->portalHost <c- ow>instanceof</c-> PortalHost<c- p>);</c->
<c- p>});</c->
</pre>
    </div>
   </section>
   <section>
    <h2 class="heading settled" data-level="3" id="the-portal-element"><span class="secno">3. </span><span class="content">The <code>portal</code> element</span><a class="self-link" href="#the-portal-element"></a></h2>
    <p><em>The following section would be added as a new subsection of <a data-link-type="biblio" href="#biblio-html" title="HTML Standard">[HTML]</a>’s <a href="https://html.spec.whatwg.org/#embedded-content">Embedded content</a> section.</em></p>
    <p>A <dfn class="dfn-paneled" data-dfn-type="element" data-export id="elementdef-portal"><code>portal</code></dfn> element allows for a <a data-link-type="dfn" href="#portal-browsing-context" id="ref-for-portal-browsing-context③">portal browsing context</a> to be embedded in an HTML document.</p>
    <details class="wpt-tests-block" dir="ltr" lang="en" open>
     <summary>Tests</summary>
     <ul class="wpt-tests-list"></ul>
    </details>
    <p>A <code><a data-link-type="element" href="#elementdef-portal" id="ref-for-elementdef-portal③">portal</a></code> element <var>portalElement</var> has a <dfn class="dfn-paneled" data-dfn-for="HTMLPortalElement" data-dfn-type="dfn" data-lt="guest browsing context" data-noexport id="htmlportalelement-guest-browsing-context">guest
  browsing context</dfn>, which is the <a data-link-type="dfn" href="#portal-browsing-context" id="ref-for-portal-browsing-context④">portal browsing context</a> whose <a data-link-type="dfn" href="#host-element" id="ref-for-host-element⑥">host element</a> is <var>portalElement</var>, or null if no such browsing context exists.</p>
    <p>A <code><a data-link-type="element" href="#elementdef-portal" id="ref-for-elementdef-portal④">portal</a></code> element has a <dfn class="dfn-paneled" data-dfn-for="HTMLPortalElement" data-dfn-type="dfn" data-lt="just-adopted flag" data-noexport id="htmlportalelement-just-adopted-flag">just-adopted
  flag</dfn>, which is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#boolean" id="ref-for-boolean">boolean</a> and is initially false. It is set during
  dispatch of the <code class="idl"><a class="idl-code" data-link-type="event" href="#eventdef-window-portalactivate" id="ref-for-eventdef-window-portalactivate②">portalactivate</a></code> event.</p>
    <p>The <dfn class="dfn-paneled" data-dfn-for="portal" data-dfn-type="element-attr" data-export id="element-attrdef-portal-src"><code>src</code></dfn> attribute gives the <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url" id="ref-for-concept-url">URL</a> of a
  page that the <a data-link-type="dfn" href="#htmlportalelement-guest-browsing-context" id="ref-for-htmlportalelement-guest-browsing-context①">guest browsing context</a> is to contain. The attribute, if
  present, must be a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/urls-and-fetching.html#valid-non-empty-url-potentially-surrounded-by-spaces" id="ref-for-valid-non-empty-url-potentially-surrounded-by-spaces">valid non-empty URL potentially surrounded by spaces</a>.</p>
    <p>The <dfn class="dfn-paneled" data-dfn-for="portal" data-dfn-type="element-attr" data-export id="element-attrdef-portal-referrerpolicy"><code>referrerpolicy</code></dfn> attribute is a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/urls-and-fetching.html#referrer-policy-attribute" id="ref-for-referrer-policy-attribute">referrer policy attribute</a>.
  Its purpose is to set the <a data-link-type="dfn" href="https://w3c.github.io/webappsec-referrer-policy/#referrer-policy" id="ref-for-referrer-policy">referrer policy</a> used when <a data-link-type="dfn" href="#set-the-source-url-of-a-portal-element" id="ref-for-set-the-source-url-of-a-portal-element">setting the source URL of a portal element</a>. <a data-link-type="biblio" href="#biblio-referrer-policy" title="Referrer Policy">[REFERRER-POLICY]</a></p>
    <p class="note" role="note"> A <code><a data-link-type="element" href="#elementdef-portal" id="ref-for-elementdef-portal⑤">portal</a></code> is similar to an <code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/iframe-embed-object.html#the-iframe-element" id="ref-for-the-iframe-element">iframe</a></code>, in that it allows another
    browsing context to be embedded.  However, the <a data-link-type="dfn" href="#portal-browsing-context" id="ref-for-portal-browsing-context⑤">portal browsing context</a> hosted by a <code><a data-link-type="element" href="#elementdef-portal" id="ref-for-elementdef-portal⑥">portal</a></code> is part of a separate <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#browsing-context-group" id="ref-for-browsing-context-group">browsing context group</a>,
    and thus a separate <a data-link-type="dfn" href="http://tc39.github.io/ecma262/#sec-agents" id="ref-for-sec-agents">agent</a>.  The user agent therefore uses a
    separate <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-agent-event-loop" id="ref-for-concept-agent-event-loop">event loop</a> for the browsing contexts, even if they are <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#same-origin-domain" id="ref-for-same-origin-domain">same origin-domain</a>. </p>
<pre class="idl highlight def">[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed" id="ref-for-Exposed"><c- g>Exposed</c-></a>=<c- n>Window</c->, <a class="idl-code" data-link-type="extended-attribute" href="https://html.spec.whatwg.org/multipage/dom.html#htmlconstructor" id="ref-for-htmlconstructor"><c- g>HTMLConstructor</c-></a>]
<c- b>interface</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="interface" data-export id="htmlportalelement"><code><c- g>HTMLPortalElement</c-></code></dfn> : <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/dom.html#htmlelement" id="ref-for-htmlelement"><c- n>HTMLElement</c-></a> {
    [<a class="idl-code" data-link-type="extended-attribute" href="https://html.spec.whatwg.org/multipage/custom-elements.html#cereactions" id="ref-for-cereactions"><c- g>CEReactions</c-></a>] <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-USVString" id="ref-for-idl-USVString"><c- b>USVString</c-></a> <a class="idl-code" data-link-type="attribute" data-type="USVString" href="#dom-htmlportalelement-src" id="ref-for-dom-htmlportalelement-src"><c- g>src</c-></a>;
    [<a class="idl-code" data-link-type="extended-attribute" href="https://html.spec.whatwg.org/multipage/custom-elements.html#cereactions" id="ref-for-cereactions①"><c- g>CEReactions</c-></a>] <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString" id="ref-for-idl-DOMString"><c- b>DOMString</c-></a> <a class="idl-code" data-link-type="attribute" data-type="DOMString" href="#dom-htmlportalelement-referrerpolicy" id="ref-for-dom-htmlportalelement-referrerpolicy"><c- g>referrerPolicy</c-></a>;

    [<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#NewObject" id="ref-for-NewObject"><c- g>NewObject</c-></a>] <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise" id="ref-for-idl-promise"><c- b>Promise</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-undefined" id="ref-for-idl-undefined"><c- b>undefined</c-></a>> <a class="idl-code" data-link-type="method" href="#dom-htmlportalelement-activate" id="ref-for-dom-htmlportalelement-activate②"><c- g>activate</c-></a>(<c- b>optional</c-> <a data-link-type="idl-name" href="#dictdef-portalactivateoptions" id="ref-for-dictdef-portalactivateoptions"><c- n>PortalActivateOptions</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="HTMLPortalElement/activate(options), HTMLPortalElement/activate()" data-dfn-type="argument" data-export id="dom-htmlportalelement-activate-options-options"><code><c- g>options</c-></code></dfn> = {});
    <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-undefined" id="ref-for-idl-undefined①"><c- b>undefined</c-></a> <a class="idl-code" data-link-type="method" href="#dom-htmlportalelement-postmessage" id="ref-for-dom-htmlportalelement-postmessage"><c- g>postMessage</c-></a>(<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-any" id="ref-for-idl-any"><c- b>any</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="HTMLPortalElement/postMessage(message, options), HTMLPortalElement/postMessage(message)" data-dfn-type="argument" data-export id="dom-htmlportalelement-postmessage-message-options-message"><code><c- g>message</c-></code></dfn>, <c- b>optional</c-> <a data-link-type="idl-name"><c- n>PostMessageOptions</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="HTMLPortalElement/postMessage(message, options), HTMLPortalElement/postMessage(message)" data-dfn-type="argument" data-export id="dom-htmlportalelement-postmessage-message-options-options"><code><c- g>options</c-></code></dfn> = {});

    <c- b>attribute</c-> <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler" id="ref-for-eventhandler"><c- n>EventHandler</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="HTMLPortalElement" data-dfn-type="attribute" data-export data-type="EventHandler" id="dom-htmlportalelement-onmessage"><code><c- g>onmessage</c-></code></dfn>;
    <c- b>attribute</c-> <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler" id="ref-for-eventhandler①"><c- n>EventHandler</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="HTMLPortalElement" data-dfn-type="attribute" data-export data-type="EventHandler" id="dom-htmlportalelement-onmessageerror"><code><c- g>onmessageerror</c-></code></dfn>;
};

<c- b>dictionary</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="dictionary" data-export id="dictdef-portalactivateoptions"><code><c- g>PortalActivateOptions</c-></code></dfn> : <a data-link-type="idl-name"><c- n>PostMessageOptions</c-></a> {
    <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-any" id="ref-for-idl-any①"><c- b>any</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="PortalActivateOptions" data-dfn-type="dict-member" data-export data-type="any" id="dom-portalactivateoptions-data"><code><c- g>data</c-></code></dfn>;
};
</pre>
    <details class="wpt-tests-block" dir="ltr" lang="en" open>
     <summary>Tests</summary>
     <ul class="wpt-tests-list"></ul>
    </details>
    <p>The <dfn class="dfn-paneled idl-code" data-dfn-for="HTMLPortalElement" data-dfn-type="attribute" data-export id="dom-htmlportalelement-src"><code>src</code></dfn> IDL attribute must <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/common-dom-interfaces.html#reflect" id="ref-for-reflect">reflect</a> the <code><a data-link-type="element-sub" href="#element-attrdef-portal-src" id="ref-for-element-attrdef-portal-src">src</a></code> content attribute.</p>
    <p>The <dfn class="dfn-paneled idl-code" data-dfn-for="HTMLPortalElement" data-dfn-type="attribute" data-export id="dom-htmlportalelement-referrerpolicy"><code>referrerPolicy</code></dfn> IDL attribute must <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/common-dom-interfaces.html#reflect" id="ref-for-reflect①">reflect</a> the <code><a data-link-type="element-sub" href="#element-attrdef-portal-referrerpolicy" id="ref-for-element-attrdef-portal-referrerpolicy">referrerpolicy</a></code> content attribute, <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/common-dom-interfaces.html#limited-to-only-known-values" id="ref-for-limited-to-only-known-values">limited to only known values</a>.</p>
    <section class="algorithm" data-algorithm="htmlportalelement-activate">
      The <dfn class="dfn-paneled idl-code" data-dfn-for="HTMLPortalElement" data-dfn-type="method" data-export data-lt="activate(options)|activate()" id="dom-htmlportalelement-activate"><code>activate(<var>options</var>)</code></dfn> method <em>must</em> run these steps: 
     <ol>
      <li data-md>
       <p>Let <var>portalBrowsingContext</var> be the <a data-link-type="dfn" href="#htmlportalelement-guest-browsing-context" id="ref-for-htmlportalelement-guest-browsing-context②">guest browsing context</a> of <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this">this</a>.</p>
      <li data-md>
       <p>If <var>portalBrowsingContext</var> is null, throw an "<code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#invalidstateerror" id="ref-for-invalidstateerror①">InvalidStateError</a></code>" <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException①">DOMException</a></code>.</p>
       <details class="wpt-tests-block" dir="ltr" lang="en" open>
        <summary>Tests</summary>
        <ul class="wpt-tests-list"></ul>
       </details>
      <li data-md>
       <p>Let <var>predecessorBrowsingContext</var> be the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#concept-document-bc" id="ref-for-concept-document-bc">browsing context</a> of <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this①">this</a>’s <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-node-document" id="ref-for-concept-node-document①">node document</a>.</p>
      <li data-md>
       <p>If <var>predecessorBrowsingContext</var> is null, throw an "<code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#invalidstateerror" id="ref-for-invalidstateerror②">InvalidStateError</a></code>" <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException②">DOMException</a></code>.</p>
      <li data-md>
       <p>If the <a data-link-type="dfn" href="#portal-state" id="ref-for-portal-state⑨">portal state</a> of <var>predecessorBrowsingContext</var> is not "<code>none</code>",
throw an "<code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#invalidstateerror" id="ref-for-invalidstateerror③">InvalidStateError</a></code>" <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException③">DOMException</a></code>.</p>
       <p class="note" role="note"><span class="marker">Note:</span> This means that a <code><a data-link-type="element" href="#elementdef-portal" id="ref-for-elementdef-portal⑦">portal</a></code> element inside a <a data-link-type="dfn" href="#portal-browsing-context" id="ref-for-portal-browsing-context⑥">portal browsing context</a> cannot be activated.</p>
      <li data-md>
       <p>Let <var>serializeWithTransferResult</var> be <a data-link-type="abstract-op" href="https://html.spec.whatwg.org/multipage/structured-data.html#structuredserializewithtransfer" id="ref-for-structuredserializewithtransfer">StructuredSerializeWithTransfer</a>(<var>options</var>["<code class="idl"><a data-link-type="idl" href="#dom-portalactivateoptions-data" id="ref-for-dom-portalactivateoptions-data">data</a></code>"], <var>options</var>["<code class="idl"><a data-link-type="idl">transfer</a></code>"]).
Rethrow any exceptions.</p>
      <li data-md>
       <p>Let <var>promise</var> be a new <a data-link-type="dfn" href="http://tc39.github.io/ecma262/#sec-promise-objects" id="ref-for-sec-promise-objects">promise</a>.</p>
      <li data-md>
       <p>Let <var>sourceOrigin</var> be <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this②">this</a>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object" id="ref-for-relevant-settings-object">relevant settings object</a>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin" id="ref-for-concept-settings-object-origin">origin</a>.</p>
      <li data-md>
       <p>Run the steps to <a data-link-type="dfn" href="#activate-a-portal-browsing-context" id="ref-for-activate-a-portal-browsing-context②">activate</a> <var>portalBrowsingContext</var> in place of <var>predecessorBrowsingContext</var> with <var>sourceOrigin</var>, <var>serializeWithTransferResult</var>,
and <var>promise</var>.</p>
      <li data-md>
       <p>Return <var>promise</var>.</p>
     </ol>
     <details class="wpt-tests-block" dir="ltr" lang="en" open>
      <summary>Tests</summary>
      <ul class="wpt-tests-list"></ul>
     </details>
    </section>
    <section class="algorithm" data-algorithm="htmlportalelement-postmessage">
      The <dfn class="dfn-paneled idl-code" data-dfn-for="HTMLPortalElement" data-dfn-type="method" data-export data-lt="postMessage(message, options)|postMessage(message)" id="dom-htmlportalelement-postmessage"><code>postMessage(<var>message</var>, <var>options</var>)</code></dfn> method <em>must</em> run these steps: 
     <ol>
      <li data-md>
       <p>Let <var>portalBrowsingContext</var> be the <a data-link-type="dfn" href="#htmlportalelement-guest-browsing-context" id="ref-for-htmlportalelement-guest-browsing-context③">guest browsing context</a> of <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this③">this</a>.</p>
      <li data-md>
       <p>If <var>portalBrowsingContext</var> is null, throw an "<code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#invalidstateerror" id="ref-for-invalidstateerror④">InvalidStateError</a></code>" <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException④">DOMException</a></code>.</p>
      <li data-md>
       <p>Let <var>sourceOrigin</var> be <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this④">this</a>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object" id="ref-for-relevant-settings-object①">relevant settings object</a>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin" id="ref-for-concept-settings-object-origin①">origin</a>.</p>
      <li data-md>
       <p>Let <var>transfer</var> be <var>options</var>["<code class="idl"><a data-link-type="idl">transfer</a></code>"].</p>
      <li data-md>
       <p>Let <var>serializeWithTransferResult</var> be <a data-link-type="abstract-op" href="https://html.spec.whatwg.org/multipage/structured-data.html#structuredserializewithtransfer" id="ref-for-structuredserializewithtransfer①">StructuredSerializeWithTransfer</a>(<var>message</var>, <var>transfer</var>). Rethrow any exceptions.</p>
      <li data-md>
       <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task" id="ref-for-queue-a-global-task④">Queue a global task</a> on the <a data-link-type="dfn" href="#portal-task-source" id="ref-for-portal-task-source④">portal task source</a> given <var>portalBrowsingContext</var>’s <a data-link-type="dfn">active window</a> to run the following steps:</p>
       <ol>
        <li data-md>
         <p>If <var>portalBrowsingContext</var>’s <a data-link-type="dfn">active document</a>’s <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-document-origin" id="ref-for-concept-document-origin①">origin</a> is not <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#same-origin" id="ref-for-same-origin①">same origin</a> with <var>sourceOrigin</var>, then abort these steps.</p>
        <li data-md>
         <p>Let <var>origin</var> be the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#ascii-serialisation-of-an-origin" id="ref-for-ascii-serialisation-of-an-origin">serialization</a> of <var>sourceOrigin</var>.</p>
        <li data-md>
         <p>Let <var>targetWindow</var> be <var>portalBrowsingContext</var>’s associated <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#windowproxy" id="ref-for-windowproxy①">WindowProxy</a></code>’s [[Window]] internal slot value.</p>
        <li data-md>
         <p>Let <var>portalHost</var> be the <var>targetWindow</var>’s <a data-link-type="dfn" href="#portal-host-object" id="ref-for-portal-host-object">portal host object</a>.</p>
        <li data-md>
         <p>Let <var>targetRealm</var> be the <var>targetWindow</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-global-object-realm" id="ref-for-concept-global-object-realm①">realm</a>.</p>
        <li data-md>
         <p>Let <var>deserializeRecord</var> be <a data-link-type="abstract-op" href="https://html.spec.whatwg.org/multipage/structured-data.html#structureddeserializewithtransfer" id="ref-for-structureddeserializewithtransfer①">StructuredDeserializeWithTransfer</a>(<var>serializeWithTransferResult</var>, <var>targetRealm</var>).</p>
         <p>If this throws an exception, catch it, <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-event-fire" id="ref-for-concept-event-fire">fire an event</a> named <code class="idl"><a class="idl-code" data-link-type="event" href="#eventdef-portalhost-messageerror" id="ref-for-eventdef-portalhost-messageerror">messageerror</a></code> at <var>portalHost</var> using <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/comms.html#messageevent" id="ref-for-messageevent">MessageEvent</a></code> with the <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/comms.html#dom-messageevent-origin" id="ref-for-dom-messageevent-origin">origin</a></code> attribute initialized to <var>origin</var> and the <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/comms.html#dom-messageevent-source" id="ref-for-dom-messageevent-source">source</a></code> attribute initialized to <var>portalHost</var>,
then abort these steps.</p>
        <li data-md>
         <p>Let <var>messageClone</var> be <var>deserializeRecord</var>.[[Deserialized]].</p>
        <li data-md>
         <p>Let <var>newPorts</var> be a new <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#dfn-frozen-array-type" id="ref-for-dfn-frozen-array-type">frozen array</a> consisting of all <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/web-messaging.html#messageport" id="ref-for-messageport">MessagePort</a></code> objects in <var>deserializeRecord</var>.[[TransferredValues]], if any, maintaining their relative order.</p>
        <li data-md>
         <p><a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-event-fire" id="ref-for-concept-event-fire①">Fire an event</a> named <code class="idl"><a class="idl-code" data-link-type="event" href="#eventdef-portalhost-message" id="ref-for-eventdef-portalhost-message">message</a></code> at <var>portalHost</var> using <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/comms.html#messageevent" id="ref-for-messageevent①">MessageEvent</a></code>, with the <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/comms.html#dom-messageevent-origin" id="ref-for-dom-messageevent-origin①">origin</a></code> attribute
initialized to <var>origin</var>, the <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/comms.html#dom-messageevent-source" id="ref-for-dom-messageevent-source①">source</a></code> attribute initialized to <var>portalHost</var>, the <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/comms.html#dom-messageevent-data" id="ref-for-dom-messageevent-data">data</a></code> attribute
initialized to <var>messageClone</var>, and the <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/comms.html#dom-messageevent-ports" id="ref-for-dom-messageevent-ports">ports</a></code> attribute initialized to <var>newPorts</var>.</p>
       </ol>
     </ol>
     <details class="wpt-tests-block" dir="ltr" lang="en" open>
      <summary>Tests</summary>
      <ul class="wpt-tests-list"></ul>
     </details>
    </section>
    <section class="algorithm" data-algorithm="htmlportalelement-may-have-guest-browsing-context">
      To determine whether a <code><a data-link-type="element" href="#elementdef-portal" id="ref-for-elementdef-portal⑧">portal</a></code> element <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="may-have-a-guest-browsing-context">may have a guest browsing context</dfn>, run the following steps: 
     <ol>
      <li data-md>
       <p>If <var>element</var>’s <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-node-document" id="ref-for-concept-node-document②">node document</a>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#browsing-context" id="ref-for-browsing-context③">browsing context</a> is not a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#top-level-browsing-context" id="ref-for-top-level-browsing-context①">top-level browsing context</a>, then return false.</p>
       <details class="wpt-tests-block" dir="ltr" lang="en" open>
        <summary>Tests</summary>
        <ul class="wpt-tests-list"></ul>
       </details>
       <p class="note" role="note"> The user agent may choose to emit a warning if the author attempts to
  use a <code><a data-link-type="element" href="#elementdef-portal" id="ref-for-elementdef-portal⑨">portal</a></code> element in a <a data-link-type="dfn">nested browsing context</a>, as this is not
  supported. </p>
      <li data-md>
       <p>If <var>element</var>’s <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-node-document" id="ref-for-concept-node-document③">node document</a>’s <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-document-url" id="ref-for-concept-document-url">URL</a>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-scheme" id="ref-for-concept-url-scheme">scheme</a> is not an <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#http-scheme" id="ref-for-http-scheme">HTTP(S) scheme</a>, then return false.</p>
       <details class="wpt-tests-block" dir="ltr" lang="en" open>
        <summary>Tests</summary>
        <ul class="wpt-tests-list"></ul>
       </details>
       <p class="note" role="note"> This is to prevent problems later, if the portaled content attempts to <a data-link-type="dfn" href="#adopt-the-predecessor-browsing-context" id="ref-for-adopt-the-predecessor-browsing-context②">adopt its predecessor</a>. Since portaled content
  can only have a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#http-scheme" id="ref-for-http-scheme①">HTTP(S) scheme</a>, adoption would fail, and so its simpler to restrict
  things at this stage. </p>
      <li data-md>
       <p>If <var>element</var>’s <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-node-document" id="ref-for-concept-node-document④">node document</a>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#active-sandboxing-flag-set" id="ref-for-active-sandboxing-flag-set">active sandboxing flag set</a> is not empty,
then return false.</p>
       <details class="wpt-tests-block" dir="ltr" lang="en" open>
        <summary>Tests</summary>
        <ul class="wpt-tests-list"></ul>
       </details>
       <p class="note" role="note"> Since portals cannot be created in <a data-link-type="dfn">child browsing contexts</a> anyway, this step is about
  preventing portal uses in <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#auxiliary-browsing-context" id="ref-for-auxiliary-browsing-context">auxiliary browsing contexts</a> spawned by sandboxed <code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/iframe-embed-object.html#the-iframe-element" id="ref-for-the-iframe-element①">iframe</a></code>s, or pages using CSP’s <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#sandbox" id="ref-for-sandbox">sandbox</a> directive. </p>
       <p class="note" role="note"> This restriction is largely added for simplicity. If there are use cases for portals
  inside sandboxed documents, we can enable them in the future, with appropriate opt-in. See <a href="https://github.com/WICG/portals/issues/207">issue #207</a> for discussion. </p>
      <li data-md>
       <p>If <var>element</var> is <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#browsing-context-connected" id="ref-for-browsing-context-connected①">browsing-context connected</a>, then return true.</p>
      <li data-md>
       <p>If <var>element</var>’s <a data-link-type="dfn" href="#htmlportalelement-just-adopted-flag" id="ref-for-htmlportalelement-just-adopted-flag③">just-adopted flag</a> is true, then return true.</p>
      <li data-md>
       <p>Return false.</p>
     </ol>
    </section>
    <section class="algorithm" data-algorithm="htmlportalelement-close">
      To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="close-a-portal-element">close a <code><a data-link-type="element" href="#elementdef-portal" id="ref-for-elementdef-portal①⓪">portal</a></code> element</dfn> <var>element</var>, run the following steps: 
     <ol>
      <li data-md>
       <p>If <var>element</var>’s <a data-link-type="dfn" href="#htmlportalelement-guest-browsing-context" id="ref-for-htmlportalelement-guest-browsing-context④">guest browsing context</a> is not null, then <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/window-object.html#close-a-browsing-context" id="ref-for-close-a-browsing-context③">close</a> it.</p>
       <p>The user agent <em>should not</em> ask the user for confirmation during the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#prompt-to-unload-a-document" id="ref-for-prompt-to-unload-a-document①">prompt to unload</a> step (and so the browsing context should be <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/window-object.html#a-browsing-context-is-discarded" id="ref-for-a-browsing-context-is-discarded③">discarded</a>).</p>
     </ol>
    </section>
    <section class="algorithm" data-algorithm="htmlportalelement-setsourceurl">
      To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="set-the-source-url-of-a-portal-element">set the source URL of a <code><a data-link-type="element" href="#elementdef-portal" id="ref-for-elementdef-portal①①">portal</a></code> element</dfn> <var>element</var>, run the following steps: 
     <ol>
      <li data-md>
       <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#assert" id="ref-for-assert④">Assert</a>: <var>element</var> <a data-link-type="dfn" href="#may-have-a-guest-browsing-context" id="ref-for-may-have-a-guest-browsing-context①">may have a guest browsing context</a>.</p>
      <li data-md>
       <p>Let <var>hostBrowsingContext</var> be <var>element</var>’s <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-node-document" id="ref-for-concept-node-document⑤">node document</a>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#browsing-context" id="ref-for-browsing-context④">browsing context</a>.</p>
      <li data-md>
       <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#assert" id="ref-for-assert⑤">Assert</a>: <var>hostBrowsingContext</var> is a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#top-level-browsing-context" id="ref-for-top-level-browsing-context②">top-level browsing context</a>.</p>
      <li data-md>
       <p><a data-link-type="dfn" href="#close-a-portal-element" id="ref-for-close-a-portal-element">Close</a> <var>element</var>.</p>
      <li data-md>
       <p>If <var>element</var> has no <code><a data-link-type="element-sub" href="#element-attrdef-portal-src" id="ref-for-element-attrdef-portal-src①">src</a></code> attribute specified, or its value is the empty string,
then return.</p>
      <li data-md>
       <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/urls-and-fetching.html#parse-a-url" id="ref-for-parse-a-url">Parse</a> the value of the <code><a data-link-type="element-sub" href="#element-attrdef-portal-src" id="ref-for-element-attrdef-portal-src②">src</a></code> attribute. If that is not successful,
then return.</p>
       <p>Otherwise, let <var>url</var> be the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/urls-and-fetching.html#resulting-url-record" id="ref-for-resulting-url-record">resulting URL record</a>.</p>
      <li data-md>
       <p class="assertion">Assert: <var>element</var>’s <a data-link-type="dfn" href="#htmlportalelement-guest-browsing-context" id="ref-for-htmlportalelement-guest-browsing-context⑤">guest browsing context</a> is null.</p>
      <li data-md>
       <p>Let <var>guestBrowsingContext</var> be the result of <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#creating-a-new-top-level-browsing-context" id="ref-for-creating-a-new-top-level-browsing-context">creating a new top-level browsing context</a>.</p>
      <li data-md>
       <p>Set the <a data-link-type="dfn" href="#portal-state" id="ref-for-portal-state①⓪">portal state</a> of <var>guestBrowsingContext</var> to "<code>portal</code>", and set the <a data-link-type="dfn" href="#host-element" id="ref-for-host-element⑦">host element</a> of <var>guestBrowsingContext</var> to <var>element</var>.</p>
      <li data-md>
       <p>Let <var>resource</var> be a new <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request" id="ref-for-concept-request">request</a> whose <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-url" id="ref-for-concept-request-url">url</a> is <var>url</var> and whose <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-referrer-policy" id="ref-for-concept-request-referrer-policy">referrer policy</a> is the current state of <var>element</var>’s <code><a data-link-type="element-sub" href="#element-attrdef-portal-referrerpolicy" id="ref-for-element-attrdef-portal-referrerpolicy①">referrerpolicy</a></code> content attribute.</p>
      <li data-md>
       <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#navigate" id="ref-for-navigate">Navigate</a> <var>guestBrowsingContext</var> to <var>resource</var>.</p>
     </ol>
     <div class="note" role="note">
       Unlike an <code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/iframe-embed-object.html#the-iframe-element" id="ref-for-the-iframe-element②">iframe</a></code> element, a <code><a data-link-type="element" href="#elementdef-portal" id="ref-for-elementdef-portal①②">portal</a></code> element supports a state where it has no associated
      browsing context. This is the initial state of a <code><a data-link-type="element" href="#elementdef-portal" id="ref-for-elementdef-portal①③">portal</a></code> element. That is, the <a data-link-type="dfn" href="#portal-browsing-context" id="ref-for-portal-browsing-context⑦">portal browsing context</a> has no web-developer-visible initial <code>about:blank</code> <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#document" id="ref-for-document①">Document</a></code>; instead it <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#navigate" id="ref-for-navigate①">navigates</a> directly to the first parsable URL assigned to it, and if the navigation cannot
      finish successfully, it <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/window-object.html#close-a-browsing-context" id="ref-for-close-a-browsing-context④">closes</a> the browsing context before the
      navigation algorithm finishes. 
      <p>Similarly, a <code><a data-link-type="element" href="#elementdef-portal" id="ref-for-elementdef-portal①④">portal</a></code> element responds to an unparsable <code><a data-link-type="element-sub" href="#element-attrdef-portal-src" id="ref-for-element-attrdef-portal-src③">src</a></code> URL by <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/window-object.html#close-a-browsing-context" id="ref-for-close-a-browsing-context⑤">closing</a> its browsing context, rather than by navigating to <code>about:blank</code>.</p>
     </div>
    </section>
    <details class="wpt-tests-block" dir="ltr" lang="en" open>
     <summary>Tests</summary>
     <ul class="wpt-tests-list"></ul>
    </details>
    <p>Whenever a <code><a data-link-type="element" href="#elementdef-portal" id="ref-for-elementdef-portal①⑤">portal</a></code> element <var>element</var> has its <code><a data-link-type="element-sub" href="#element-attrdef-portal-src" id="ref-for-element-attrdef-portal-src④">src</a></code> attribute set,
  changed, or removed, run the following steps:</p>
    <ol>
     <li data-md>
      <p>If <var>element</var> <a data-link-type="dfn" href="#may-have-a-guest-browsing-context" id="ref-for-may-have-a-guest-browsing-context②">may have a guest browsing context</a>, then <a data-link-type="dfn" href="#set-the-source-url-of-a-portal-element" id="ref-for-set-the-source-url-of-a-portal-element①">set the source URL</a> of <var>element</var>.</p>
    </ol>
    <p>Whenever a <code><a data-link-type="element" href="#elementdef-portal" id="ref-for-elementdef-portal①⑥">portal</a></code> element <var>element</var> <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#becomes-browsing-context-connected" id="ref-for-becomes-browsing-context-connected">becomes
  browsing-context connected</a>, run the following steps:</p>
    <ol>
     <li data-md>
      <p>If <var>element</var> <a data-link-type="dfn" href="#may-have-a-guest-browsing-context" id="ref-for-may-have-a-guest-browsing-context③">may not have a guest browsing context</a>, then abort these steps.</p>
     <li data-md>
      <p>If <var>element</var>’s <a data-link-type="dfn" href="#htmlportalelement-guest-browsing-context" id="ref-for-htmlportalelement-guest-browsing-context⑥">guest browsing context</a> is not null, then abort these steps.</p>
      <div class="note" role="note"> This ensures that a newly <a data-link-type="dfn" href="#adopt-the-predecessor-browsing-context" id="ref-for-adopt-the-predecessor-browsing-context③">adopted</a> <code><a data-link-type="element" href="#elementdef-portal" id="ref-for-elementdef-portal①⑦">portal</a></code> element can be inserted into the document without navigating
    it. </div>
     <li data-md>
      <p><a data-link-type="dfn" href="#set-the-source-url-of-a-portal-element" id="ref-for-set-the-source-url-of-a-portal-element②">Set the source URL</a> of <var>element</var>.</p>
    </ol>
    <p>Whenever a <code><a data-link-type="element" href="#elementdef-portal" id="ref-for-elementdef-portal①⑧">portal</a></code> element <var>element</var> <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#becomes-browsing-context-disconnected" id="ref-for-becomes-browsing-context-disconnected">becomes
  browsing-context connected</a>, run the following steps:</p>
    <ol>
     <li data-md>
      <p>If <var>element</var> <a data-link-type="dfn" href="#may-have-a-guest-browsing-context" id="ref-for-may-have-a-guest-browsing-context④">may not have a guest browsing context</a> and its <a data-link-type="dfn" href="#htmlportalelement-guest-browsing-context" id="ref-for-htmlportalelement-guest-browsing-context⑦">guest browsing context</a> is not null, then <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/window-object.html#a-browsing-context-is-discarded" id="ref-for-a-browsing-context-is-discarded④">discard</a> it.</p>
    </ol>
    <div class="issue" id="issue-833dc9f1"><a class="self-link" href="#issue-833dc9f1"></a> It might be convenient to not immediately detach the portal element, but instead to do so
    in a microtask. This would allow developers to reinsert the <code><a data-link-type="element" href="#elementdef-portal" id="ref-for-elementdef-portal①⑨">portal</a></code> element without losing
    its browsing context. </div>
    <p>Whenever a <code><a data-link-type="element" href="#elementdef-portal" id="ref-for-elementdef-portal②⓪">portal</a></code> element <var>element</var> is <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-node-adopt-ext" id="ref-for-concept-node-adopt-ext">adopted</a>, run the following steps:</p>
    <ol>
     <li data-md>
      <p>Let <var>guestBrowsingContext</var> be <var>element</var>’s <a data-link-type="dfn" href="#htmlportalelement-guest-browsing-context" id="ref-for-htmlportalelement-guest-browsing-context⑧">guest browsing context</a>.</p>
     <li data-md>
      <p>If <var>guestBrowsingContext</var> is null, then abort these steps.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/window-object.html#a-browsing-context-is-discarded" id="ref-for-a-browsing-context-is-discarded⑤">Discard</a> <var>guestBrowsingContext</var>.</p>
    </ol>
    <div class="note" role="note">
      In particular, this means a <code><a data-link-type="element" href="#elementdef-portal" id="ref-for-elementdef-portal②①">portal</a></code> element loses its <a data-link-type="dfn" href="#htmlportalelement-guest-browsing-context" id="ref-for-htmlportalelement-guest-browsing-context⑨">guest browsing context</a> if it is moved to the <a data-link-type="dfn">active document</a> of a <a data-link-type="dfn">nested browsing context</a>. 
     <p>Similarly, the steps when a <code><a data-link-type="element" href="#elementdef-portal" id="ref-for-elementdef-portal②②">portal</a></code> element’s <a data-link-type="dfn" href="#set-the-source-url-of-a-portal-element" id="ref-for-set-the-source-url-of-a-portal-element③">source URL is set</a> prevent
    elements from creating a new <a data-link-type="dfn" href="#htmlportalelement-guest-browsing-context" id="ref-for-htmlportalelement-guest-browsing-context①⓪">guest browsing context</a> while inside such
    documents.</p>
     <p>It is therefore impossible to embed a <a data-link-type="dfn" href="#portal-browsing-context" id="ref-for-portal-browsing-context⑧">portal browsing context</a> in a <a data-link-type="dfn">nested browsing context</a>.</p>
    </div>
    <p>Whenever a <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#document" id="ref-for-document②">Document</a></code> object <var>document</var> whose <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#concept-document-bc" id="ref-for-concept-document-bc①">browsing context</a> is a <a data-link-type="dfn" href="#portal-browsing-context" id="ref-for-portal-browsing-context⑨">portal browsing context</a> is marked as <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/parsing.html#completely-loaded" id="ref-for-completely-loaded">completely loaded</a>, run the following steps as part of
  the queued task:</p>
    <ol>
     <li data-md>
      <p>Let <var>element</var> be <var>document</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#concept-document-bc" id="ref-for-concept-document-bc②">browsing context</a>’s <a data-link-type="dfn" href="#host-element" id="ref-for-host-element⑧">host element</a>.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-event-fire" id="ref-for-concept-event-fire②">Fire an event</a> named <code class="idl"><a class="idl-code" data-link-type="event" href="https://html.spec.whatwg.org/multipage/indices.html#event-load" id="ref-for-event-load">load</a></code> at <var>element</var>.</p>
    </ol>
    <details class="wpt-tests-block" dir="ltr" lang="en" open>
     <summary>Tests</summary>
     <ul class="wpt-tests-list"></ul>
    </details>
    <section class="algorithm" data-algorithm="htmlportalelement-activation-behavior">
      A <code><a data-link-type="element" href="#elementdef-portal" id="ref-for-elementdef-portal②③">portal</a></code> element <var>el</var>’s <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#eventtarget-activation-behavior" id="ref-for-eventtarget-activation-behavior">activation behavior</a> is to run the following steps: 
     <ol>
      <li data-md>
       <p>Let <var>portalBrowsingContext</var> be the <a data-link-type="dfn" href="#htmlportalelement-guest-browsing-context" id="ref-for-htmlportalelement-guest-browsing-context①①">guest browsing context</a> of <var>el</var>.</p>
      <li data-md>
       <p>If <var>portalBrowsingContext</var> is null, return.</p>
      <li data-md>
       <p>Let <var>predecessorBrowsingContext</var> be the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#concept-document-bc" id="ref-for-concept-document-bc③">browsing context</a> of <var>el</var>’s <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-node-document" id="ref-for-concept-node-document⑥">node document</a>.</p>
      <li data-md>
       <p>If <var>predecessorBrowsingContext</var> is null, return.</p>
      <li data-md>
       <p>If the <a data-link-type="dfn" href="#portal-state" id="ref-for-portal-state①①">portal state</a> of <var>predecessorBrowsingContext</var> is not "<code>none</code>", return.</p>
      <li data-md>
       <p>Let <var>sourceOrigin</var> be <var>el</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object" id="ref-for-relevant-settings-object②">relevant settings object</a>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin" id="ref-for-concept-settings-object-origin②">origin</a>.</p>
      <li data-md>
       <p>Run the steps to <a data-link-type="dfn" href="#activate-a-portal-browsing-context" id="ref-for-activate-a-portal-browsing-context③">activate</a> <var>portalBrowsingContext</var> in place of <var>predecessorBrowsingContext</var> with <var>sourceOrigin</var>.</p>
     </ol>
     <div class="note" role="note"> This is substantially similar to the steps in <code class="idl"><a data-link-type="idl" href="#dom-htmlportalelement-activate" id="ref-for-dom-htmlportalelement-activate③">activate(options)</a></code>, with default options.
      User agents might wish to display suitable console messages under the same conditions that would
      result in promise rejection in those steps. </div>
    </section>
    <p>The following events are dispatched on <code class="idl"><a data-link-type="idl" href="#htmlportalelement" id="ref-for-htmlportalelement①">HTMLPortalElement</a></code> objects:</p>
    <table class="data">
     <thead>
      <tr>
       <th>Event name
       <th>Interface
       <th>Dispatched when
     <tbody>
      <tr>
       <td><dfn class="dfn-paneled idl-code" data-dfn-for="HTMLPortalElement" data-dfn-type="event" data-export id="eventdef-htmlportalelement-message"><code>message</code></dfn>
       <td><code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/comms.html#messageevent" id="ref-for-messageevent②">MessageEvent</a></code>
       <td>A message is received by the object, and deserialization does not throw an exception.
      <tr>
       <td><dfn class="dfn-paneled idl-code" data-dfn-for="HTMLPortalElement" data-dfn-type="event" data-export id="eventdef-htmlportalelement-messageerror"><code>messageerror</code></dfn>
       <td><code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/comms.html#messageevent" id="ref-for-messageevent③">MessageEvent</a></code>
       <td>A message is received by the object, but deserialization throws an exception.
    </table>
    <p>The <code><a data-link-type="element" href="#elementdef-portal" id="ref-for-elementdef-portal②④">portal</a></code> element exposes <code class="idl"><a data-link-type="idl" href="#dom-htmlportalelement-onmessage" id="ref-for-dom-htmlportalelement-onmessage">onmessage</a></code> and <code class="idl"><a data-link-type="idl" href="#dom-htmlportalelement-onmessageerror" id="ref-for-dom-htmlportalelement-onmessageerror">onmessageerror</a></code> as <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#event-handler-content-attributes" id="ref-for-event-handler-content-attributes">event handler content attributes</a>.</p>
    <details class="wpt-tests-block" dir="ltr" lang="en" open>
     <summary>Tests</summary>
     <ul class="wpt-tests-list"></ul>
    </details>
    <h3 class="heading settled" data-level="3.1" id="the-portalhost-interface"><span class="secno">3.1. </span><span class="content">Portal hosts</span><a class="self-link" href="#the-portalhost-interface"></a></h3>
    <p>Every <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#window" id="ref-for-window">Window</a></code> has a <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="portal-host-object">portal host object</dfn>, which is a <code class="idl"><a data-link-type="idl" href="#portalhost" id="ref-for-portalhost①">PortalHost</a></code>. It is exposed
  through the <code class="idl"><a data-link-type="idl" href="#dom-window-portalhost" id="ref-for-dom-window-portalhost">portalHost</a></code> attribute getter at times when the window may be in a <a data-link-type="dfn" href="#portal-browsing-context" id="ref-for-portal-browsing-context①⓪">portal browsing context</a>.</p>
    <div class="note" role="note"> The <a data-link-type="dfn" href="#portal-host-object" id="ref-for-portal-host-object①">portal host object</a> can be used to communicate with the <a data-link-type="dfn" href="#host-browsing-context" id="ref-for-host-browsing-context②">host browsing context</a>. Its
    operations throw if used while its context is not a <a data-link-type="dfn" href="#portal-browsing-context" id="ref-for-portal-browsing-context①①">portal browsing context</a> (i.e. there is
    no host), in the event that JavaScript code has saved a reference to it. At such times, the <code class="idl"><a data-link-type="idl" href="#dom-window-portalhost" id="ref-for-dom-window-portalhost①">window.portalHost</a></code> getter will return null. </div>
<pre class="idl highlight def"><c- b>partial</c-> <c- b>interface</c-> <a class="idl-code" data-link-type="interface" href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#window" id="ref-for-window①"><c- g>Window</c-></a> {
    <c- b>readonly</c-> <c- b>attribute</c-> <a data-link-type="idl-name" href="#portalhost" id="ref-for-portalhost②"><c- n>PortalHost</c-></a>? <a class="idl-code" data-link-type="attribute" data-readonly data-type="PortalHost?" href="#dom-window-portalhost" id="ref-for-dom-window-portalhost②"><c- g>portalHost</c-></a>;
};
</pre>
    <section class="algorithm" data-algorithm="window-portalhost">
      The <dfn class="dfn-paneled idl-code" data-dfn-for="Window" data-dfn-type="attribute" data-export id="dom-window-portalhost"><code>portalHost</code></dfn> attribute’s getter <em>must</em> run the following steps: 
     <ol>
      <li data-md>
       <p>Let <var>context</var> be <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this⑤">this</a>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#window-bc" id="ref-for-window-bc">browsing context</a>.</p>
      <li data-md>
       <p>If <var>context</var> is null or the <a data-link-type="dfn" href="#portal-state" id="ref-for-portal-state①②">portal state</a> of <var>context</var> is not "<code>portal</code>", then return null.</p>
      <li data-md>
       <p>Return <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this⑥">this</a>’s <a data-link-type="dfn" href="#portal-host-object" id="ref-for-portal-host-object②">portal host object</a>.</p>
     </ol>
    </section>
    <details class="wpt-tests-block" dir="ltr" lang="en" open>
     <summary>Tests</summary>
     <ul class="wpt-tests-list"></ul>
    </details>
    <hr>
    <p>The <code class="idl"><a data-link-type="idl" href="#portalhost" id="ref-for-portalhost③">PortalHost</a></code> interface definition is as follows:</p>
<pre class="idl highlight def">[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed" id="ref-for-Exposed①"><c- g>Exposed</c-></a>=<c- n>Window</c->]
<c- b>interface</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="interface" data-export id="portalhost"><code><c- g>PortalHost</c-></code></dfn> : <a data-link-type="idl-name" href="https://dom.spec.whatwg.org/#eventtarget" id="ref-for-eventtarget"><c- n>EventTarget</c-></a> {
    <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-undefined" id="ref-for-idl-undefined②"><c- b>undefined</c-></a> <a class="idl-code" data-link-type="method" href="#dom-portalhost-postmessage" id="ref-for-dom-portalhost-postmessage"><c- g>postMessage</c-></a>(<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-any" id="ref-for-idl-any②"><c- b>any</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="PortalHost/postMessage(message, options), PortalHost/postMessage(message)" data-dfn-type="argument" data-export id="dom-portalhost-postmessage-message-options-message"><code><c- g>message</c-></code></dfn>, <c- b>optional</c-> <a data-link-type="idl-name"><c- n>PostMessageOptions</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="PortalHost/postMessage(message, options), PortalHost/postMessage(message)" data-dfn-type="argument" data-export id="dom-portalhost-postmessage-message-options-options"><code><c- g>options</c-></code></dfn> = {});

    <c- b>attribute</c-> <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler" id="ref-for-eventhandler②"><c- n>EventHandler</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="PortalHost" data-dfn-type="attribute" data-export data-type="EventHandler" id="dom-portalhost-onmessage"><code><c- g>onmessage</c-></code></dfn>;
    <c- b>attribute</c-> <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler" id="ref-for-eventhandler③"><c- n>EventHandler</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="PortalHost" data-dfn-type="attribute" data-export data-type="EventHandler" id="dom-portalhost-onmessageerror"><code><c- g>onmessageerror</c-></code></dfn>;
};
</pre>
    <section class="algorithm" data-algorithm="portalhost-postmessage">
      The <dfn class="dfn-paneled idl-code" data-dfn-for="PortalHost" data-dfn-type="method" data-export data-lt="postMessage(message, options)|postMessage(message)" id="dom-portalhost-postmessage"><code>postMessage(<var>message</var>, <var>options</var>)</code></dfn> method <em>must</em> run these steps: 
     <ol>
      <li data-md>
       <p>Let <var>browsingContext</var> be <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this⑦">this</a>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global" id="ref-for-concept-relevant-global">relevant global object</a>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#window-bc" id="ref-for-window-bc①">browsing context</a>.</p>
      <li data-md>
       <p>If <var>browsingContext</var> has a <a data-link-type="dfn" href="#portal-state" id="ref-for-portal-state①③">portal state</a> other than "<code>portal</code>", throw an "<code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#invalidstateerror" id="ref-for-invalidstateerror⑤">InvalidStateError</a></code>" <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException⑤">DOMException</a></code>.</p>
       <p class="note" role="note"><span class="marker">Note:</span> This roughly means that it has not yet been activated, as far as this <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#event-loop" id="ref-for-event-loop">event loop</a> has been told.
It is possible that this browsing context will be <a data-link-type="dfn" href="#activate-a-portal-browsing-context" id="ref-for-activate-a-portal-browsing-context④">activated</a> in parallel
to this message being sent; in such cases, messages may not be delivered.</p>
      <li data-md>
       <p>Let <var>sourceOrigin</var> be <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this⑧">this</a>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object" id="ref-for-relevant-settings-object③">relevant settings object</a>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin" id="ref-for-concept-settings-object-origin③">origin</a>.</p>
      <li data-md>
       <p>Let <var>transfer</var> be <var>options</var>["<code class="idl"><a data-link-type="idl">transfer</a></code>"].</p>
      <li data-md>
       <p>Let <var>serializeWithTransferResult</var> be <a data-link-type="abstract-op" href="https://html.spec.whatwg.org/multipage/structured-data.html#structuredserializewithtransfer" id="ref-for-structuredserializewithtransfer②">StructuredSerializeWithTransfer</a>(<var>message</var>, <var>transfer</var>). Rethrow any exceptions.</p>
      <li data-md>
       <p>Let <var>hostElement</var> be the <a data-link-type="dfn" href="#host-element" id="ref-for-host-element⑨">host element</a> of <var>browsingContext</var>.</p>
      <li data-md>
       <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-an-element-task" id="ref-for-queue-an-element-task">Queue an element task</a> on the <a data-link-type="dfn" href="#portal-task-source" id="ref-for-portal-task-source⑤">portal task source</a> given <var>hostElement</var> to run the following steps:</p>
       <ol>
        <li data-md>
         <p>If <var>browsingContext</var> is not the <a data-link-type="dfn" href="#htmlportalelement-guest-browsing-context" id="ref-for-htmlportalelement-guest-browsing-context①②">guest browsing context</a> of <var>hostElement</var>, then abort these steps.</p>
         <p class="note" role="note"><span class="marker">Note:</span> This might happen if this <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#event-loop" id="ref-for-event-loop①">event loop</a> had a queued task to deliver a message, but
it was not executed before the portal was <a data-link-type="dfn" href="#activate-a-portal-browsing-context" id="ref-for-activate-a-portal-browsing-context⑤">activated</a>.
In such cases, the message is not delivered.</p>
        <li data-md>
         <p>Let <var>targetSettings</var> be the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object" id="ref-for-relevant-settings-object④">relevant settings object</a> of <var>hostElement</var>.</p>
        <li data-md>
         <p>If <var>targetSettings</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin" id="ref-for-concept-settings-object-origin④">origin</a> is not <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#same-origin" id="ref-for-same-origin②">same origin</a> with <var>sourceOrigin</var>, then abort these steps.</p>
        <li data-md>
         <p>Let <var>origin</var> be the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#ascii-serialisation-of-an-origin" id="ref-for-ascii-serialisation-of-an-origin①">serialization</a> of <var>sourceOrigin</var>.</p>
        <li data-md>
         <p>Let <var>targetRealm</var> be <var>targetSettings</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object&apos;s-realm" id="ref-for-environment-settings-object&apos;s-realm">realm</a>.</p>
        <li data-md>
         <p>Let <var>deserializeRecord</var> be <a data-link-type="abstract-op" href="https://html.spec.whatwg.org/multipage/structured-data.html#structureddeserializewithtransfer" id="ref-for-structureddeserializewithtransfer②">StructuredDeserializeWithTransfer</a>(<var>serializeWithTransferResult</var>, <var>targetRealm</var>).</p>
         <p>If this throws an exception, catch it, <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-event-fire" id="ref-for-concept-event-fire③">fire an event</a> named <code class="idl"><a class="idl-code" data-link-type="event" href="#eventdef-htmlportalelement-messageerror" id="ref-for-eventdef-htmlportalelement-messageerror">messageerror</a></code> at <var>element</var> using <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/comms.html#messageevent" id="ref-for-messageevent④">MessageEvent</a></code> with the <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/comms.html#dom-messageevent-origin" id="ref-for-dom-messageevent-origin②">origin</a></code> attribute initialized to <var>origin</var> and the <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/comms.html#dom-messageevent-source" id="ref-for-dom-messageevent-source②">source</a></code> attribute initialized to <var>element</var>.</p>
        <li data-md>
         <p>Let <var>messageClone</var> be <var>deserializeRecord</var>.[[Deserialized]].</p>
        <li data-md>
         <p>Let <var>newPorts</var> be a new <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#dfn-frozen-array-type" id="ref-for-dfn-frozen-array-type①">frozen array</a> consisting of all <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/web-messaging.html#messageport" id="ref-for-messageport①">MessagePort</a></code> objects in <var>deserializeRecord</var>.[[TransferredValues]], if any, maintaining their relative order.</p>
        <li data-md>
         <p><a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-event-fire" id="ref-for-concept-event-fire④">Fire an event</a> named <code class="idl"><a class="idl-code" data-link-type="event" href="#eventdef-htmlportalelement-message" id="ref-for-eventdef-htmlportalelement-message">message</a></code> at the <var>element</var> using <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/comms.html#messageevent" id="ref-for-messageevent⑤">MessageEvent</a></code>, with the <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/comms.html#dom-messageevent-origin" id="ref-for-dom-messageevent-origin③">origin</a></code> attribute
initialized to <var>origin</var>, the <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/comms.html#dom-messageevent-source" id="ref-for-dom-messageevent-source③">source</a></code> attribute initialized to <var>element</var>, the <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/comms.html#dom-messageevent-data" id="ref-for-dom-messageevent-data①">data</a></code> attribute
initialized to <var>messageClone</var>, and the <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/comms.html#dom-messageevent-ports" id="ref-for-dom-messageevent-ports①">ports</a></code> attribute initialized to <var>newPorts</var>.</p>
       </ol>
     </ol>
    </section>
    <details class="wpt-tests-block" dir="ltr" lang="en" open>
     <summary>Tests</summary>
     <ul class="wpt-tests-list"></ul>
    </details>
    <p>The following events are dispatched on <code class="idl"><a data-link-type="idl" href="#portalhost" id="ref-for-portalhost④">PortalHost</a></code> objects:</p>
    <table class="data">
     <thead>
      <tr>
       <th>Event name
       <th>Interface
       <th>Dispatched when
     <tbody>
      <tr>
       <td><dfn class="dfn-paneled idl-code" data-dfn-for="PortalHost" data-dfn-type="event" data-export id="eventdef-portalhost-message"><code>message</code></dfn>
       <td><code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/comms.html#messageevent" id="ref-for-messageevent⑥">MessageEvent</a></code>
       <td>A message is received by the object, and deserialization does not throw an exception.
      <tr>
       <td><dfn class="dfn-paneled idl-code" data-dfn-for="PortalHost" data-dfn-type="event" data-export id="eventdef-portalhost-messageerror"><code>messageerror</code></dfn>
       <td><code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/comms.html#messageevent" id="ref-for-messageevent⑦">MessageEvent</a></code>
       <td>A message is received by the object, but deserialization throws an exception.
    </table>
    <h3 class="heading settled" data-level="3.2" id="the-portalactivateevent-interface"><span class="secno">3.2. </span><span class="content">The <code>PortalActivateEvent</code> interface</span><a class="self-link" href="#the-portalactivateevent-interface"></a></h3>
<pre class="idl highlight def">[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed" id="ref-for-Exposed②"><c- g>Exposed</c-></a>=<c- n>Window</c->]
<c- b>interface</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="interface" data-export id="portalactivateevent"><code><c- g>PortalActivateEvent</c-></code></dfn> : <a data-link-type="idl-name" href="https://dom.spec.whatwg.org/#event" id="ref-for-event"><c- n>Event</c-></a> {
    <dfn class="dfn-paneled idl-code" data-dfn-for="PortalActivateEvent" data-dfn-type="constructor" data-export data-lt="PortalActivateEvent(type, eventInitDict)|constructor(type, eventInitDict)|PortalActivateEvent(type)|constructor(type)" id="dom-portalactivateevent-portalactivateevent"><code><c- g>constructor</c-></code></dfn>(<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString" id="ref-for-idl-DOMString①"><c- b>DOMString</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="PortalActivateEvent/PortalActivateEvent(type, eventInitDict), PortalActivateEvent/constructor(type, eventInitDict), PortalActivateEvent/PortalActivateEvent(type), PortalActivateEvent/constructor(type)" data-dfn-type="argument" data-export id="dom-portalactivateevent-portalactivateevent-type-eventinitdict-type"><code><c- g>type</c-></code></dfn>, <c- b>optional</c-> <a data-link-type="idl-name" href="#dictdef-portalactivateeventinit" id="ref-for-dictdef-portalactivateeventinit"><c- n>PortalActivateEventInit</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="PortalActivateEvent/PortalActivateEvent(type, eventInitDict), PortalActivateEvent/constructor(type, eventInitDict), PortalActivateEvent/PortalActivateEvent(type), PortalActivateEvent/constructor(type)" data-dfn-type="argument" data-export id="dom-portalactivateevent-portalactivateevent-type-eventinitdict-eventinitdict"><code><c- g>eventInitDict</c-></code></dfn> = {});

    <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-any" id="ref-for-idl-any③"><c- b>any</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="PortalActivateEvent" data-dfn-type="attribute" data-export data-readonly data-type="any" id="dom-portalactivateevent-data"><code><c- g>data</c-></code></dfn>;
    <a data-link-type="idl-name" href="#htmlportalelement" id="ref-for-htmlportalelement②"><c- n>HTMLPortalElement</c-></a> <a class="idl-code" data-link-type="method" href="#dom-portalactivateevent-adoptpredecessor" id="ref-for-dom-portalactivateevent-adoptpredecessor②"><c- g>adoptPredecessor</c-></a>();
};

<c- b>dictionary</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="dictionary" data-export id="dictdef-portalactivateeventinit"><code><c- g>PortalActivateEventInit</c-></code></dfn> : <a data-link-type="idl-name" href="https://dom.spec.whatwg.org/#dictdef-eventinit" id="ref-for-dictdef-eventinit"><c- n>EventInit</c-></a> {
    <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-any" id="ref-for-idl-any④"><c- b>any</c-></a> <dfn class="dfn-paneled idl-code" data-default="null" data-dfn-for="PortalActivateEventInit" data-dfn-type="dict-member" data-export data-type="any" id="dom-portalactivateeventinit-data"><code><c- g>data</c-></code></dfn> = <c- b>null</c->;
};
</pre>
    <div class="note" role="note"> For now, there is no <code>ports</code> attribute on <code class="idl"><a data-link-type="idl" href="#portalactivateevent" id="ref-for-portalactivateevent①">PortalActivateEvent</a></code>, despite it being
    used for data transfer in a similar way to <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/comms.html#messageevent" id="ref-for-messageevent⑧">MessageEvent</a></code>. This omission is for simplicity,
    and could be reconsidered if a use case is found. (See also <a href="https://github.com/whatwg/html/issues/4521">whatwg/html#4521</a> for a potential
    expansion.) </div>
    <p>A <code class="idl"><a data-link-type="idl" href="#portalactivateevent" id="ref-for-portalactivateevent②">PortalActivateEvent</a></code> has an associated <dfn class="dfn-paneled" data-dfn-for="PortalActivateEvent" data-dfn-type="dfn" data-noexport id="portalactivateevent-predecessor-browsing-context">predecessor browsing context</dfn>,
  which is a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#top-level-browsing-context" id="ref-for-top-level-browsing-context③">top-level browsing context</a> or null, a <dfn class="dfn-paneled" data-dfn-for="PortalActivateEvent" data-dfn-type="dfn" data-noexport id="portalactivateevent-successor-window">successor window</dfn>, which is
  a <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#window" id="ref-for-window②">Window</a></code>, an <dfn class="dfn-paneled" data-dfn-for="PortalActivateEvent" data-dfn-type="dfn" data-noexport id="portalactivateevent-activation-promise">activation promise</dfn>, which is a <a data-link-type="dfn" href="http://tc39.github.io/ecma262/#sec-promise-objects" id="ref-for-sec-promise-objects①">promise</a> or null, and a <dfn class="dfn-paneled" data-dfn-for="PortalActivateEvent" data-dfn-type="dfn" data-noexport id="portalactivateevent-adopted-predecessor-element">adopted predecessor element</dfn>, which is a <code><a data-link-type="element" href="#elementdef-portal" id="ref-for-elementdef-portal②⑤">portal</a></code> element or null.</p>
    <section class="algorithm" data-algorithm="portalactivateevent-event-constructing-steps">
      The <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-event-constructor-ext" id="ref-for-concept-event-constructor-ext">event constructing steps</a> for <code class="idl"><a data-link-type="idl" href="#portalactivateevent" id="ref-for-portalactivateevent③">PortalActivateEvent</a></code>, given an <var>event</var>, are as follows: 
     <ol>
      <li data-md>
       <p>Set <var>event</var>’s <a data-link-type="dfn" href="#portalactivateevent-predecessor-browsing-context" id="ref-for-portalactivateevent-predecessor-browsing-context①">predecessor browsing context</a> to null.</p>
      <li data-md>
       <p>Set <var>event</var>’s <a data-link-type="dfn" href="#portalactivateevent-successor-window" id="ref-for-portalactivateevent-successor-window①">successor window</a> to null.</p>
      <li data-md>
       <p>Set <var>event</var>’s <a data-link-type="dfn" href="#portalactivateevent-adopted-predecessor-element" id="ref-for-portalactivateevent-adopted-predecessor-element①">adopted predecessor element</a> to null.</p>
     </ol>
    </section>
    <details class="wpt-tests-block" dir="ltr" lang="en" open>
     <summary>Tests</summary>
     <ul class="wpt-tests-list"></ul>
    </details>
    <section class="algorithm" data-algorithm="portalactivateevent-adoptpredecessor">
      The <dfn class="dfn-paneled idl-code" data-dfn-for="PortalActivateEvent" data-dfn-type="method" data-export id="dom-portalactivateevent-adoptpredecessor"><code>adoptPredecessor()</code></dfn> method <em>must</em> run these steps: 
     <ol>
      <li data-md>
       <p>If <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this⑨">this</a>’s <a data-link-type="dfn" href="#portalactivateevent-adopted-predecessor-element" id="ref-for-portalactivateevent-adopted-predecessor-element②">adopted predecessor element</a> is not null, throw an "<code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#invalidstateerror" id="ref-for-invalidstateerror⑥">InvalidStateError</a></code>" <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException⑥">DOMException</a></code>.</p>
      <li data-md>
       <p>Let <var>predecessorBrowsingContext</var> be <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this①⓪">this</a>’s <a data-link-type="dfn" href="#portalactivateevent-predecessor-browsing-context" id="ref-for-portalactivateevent-predecessor-browsing-context②">predecessor browsing context</a>.</p>
      <li data-md>
       <p>Let <var>successorWindow</var> be <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this①①">this</a>’s <a data-link-type="dfn" href="#portalactivateevent-successor-window" id="ref-for-portalactivateevent-successor-window②">successor window</a>.</p>
      <li data-md>
       <p>Run the steps to <a data-link-type="dfn" href="#adopt-the-predecessor-browsing-context" id="ref-for-adopt-the-predecessor-browsing-context④">adopt the predecessor browsing context</a> <var>predecessorBrowsingContext</var> in <var>successorWindow</var>,
and let <var>adoptedPredecessorElement</var> be the result.</p>
      <li data-md>
       <p>Set <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this①②">this</a>’s <a data-link-type="dfn" href="#portalactivateevent-adopted-predecessor-element" id="ref-for-portalactivateevent-adopted-predecessor-element③">adopted predecessor element</a> to <var>adoptedPredecessorElement</var>.</p>
      <li data-md>
       <p>If <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this①③">this</a>’s <a data-link-type="dfn" href="#portalactivateevent-activation-promise" id="ref-for-portalactivateevent-activation-promise②">activation promise</a> is not null, <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task" id="ref-for-queue-a-global-task⑤">queue a global task</a> on the <a data-link-type="dfn" href="#portal-task-source" id="ref-for-portal-task-source⑥">portal task source</a> given <var>predecessorBrowsingContext</var>’s <a data-link-type="dfn">active window</a> to resolve it with undefined.</p>
       <p class="note" role="note"><span class="marker">Note:</span> Queuing this immediately makes it possible to send messages to the adopted
portal during dispatch of the <code class="idl"><a class="idl-code" data-link-type="event" href="#eventdef-window-portalactivate" id="ref-for-eventdef-window-portalactivate③">portalactivate</a></code> event without
ordering issues between the task to resolve the activation promise and the task
to deliver the message.</p>
      <li data-md>
       <p>Return <var>adoptedPredecessorElement</var>.</p>
     </ol>
     <details class="wpt-tests-block" dir="ltr" lang="en" open>
      <summary>Tests</summary>
      <ul class="wpt-tests-list"></ul>
     </details>
    </section>
   </section>
   <section>
    <h2 class="heading settled" data-level="4" id="miscellaneous-extensions"><span class="secno">4. </span><span class="content">Miscellaneous HTML updates</span><a class="self-link" href="#miscellaneous-extensions"></a></h2>
    <p><em>This section contains various small patches to miscellaneous areas of the HTML Standard.</em></p>
    <h3 class="heading settled" data-level="4.1" id="patch-messageevent"><span class="secno">4.1. </span><span class="content">The <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/comms.html#messageevent" id="ref-for-messageevent⑨">MessageEvent</a></code> interface</span><a class="self-link" href="#patch-messageevent"></a></h3>
    <p>The <code class="idl"><a data-link-type="idl" href="#typedefdef-messageeventsource" id="ref-for-typedefdef-messageeventsource">MessageEventSource</a></code> union is extended to include the new interfaces
  which can produce <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/comms.html#messageevent" id="ref-for-messageevent①⓪">MessageEvent</a></code> events.</p>
<pre class="idl highlight def"><c- b>typedef</c-> (<a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#windowproxy" id="ref-for-windowproxy②"><c- n>WindowProxy</c-></a> <c- b>or</c-> <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/web-messaging.html#messageport" id="ref-for-messageport②"><c- n>MessagePort</c-></a> <c- b>or</c-> <a data-link-type="idl-name" href="https://w3c.github.io/ServiceWorker/#serviceworker" id="ref-for-serviceworker"><c- n>ServiceWorker</c-></a> <c- b>or</c-> <a data-link-type="idl-name" href="#htmlportalelement" id="ref-for-htmlportalelement③"><c- n>HTMLPortalElement</c-></a> <c- b>or</c-> <a data-link-type="idl-name" href="#portalhost" id="ref-for-portalhost⑤"><c- n>PortalHost</c-></a>) <dfn class="dfn-paneled idl-code" data-dfn-type="typedef" data-export id="typedefdef-messageeventsource"><code><c- g>MessageEventSource</c-></code></dfn>;
</pre>
    <h3 class="heading settled" data-level="4.2" id="patch-event-handlers"><span class="secno">4.2. </span><span class="content">Event handlers</span><a class="self-link" href="#patch-event-handlers"></a></h3>
    <p>The table of <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#event-handlers" id="ref-for-event-handlers">event handlers</a> which must be supported by <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#window" id="ref-for-window③">Window</a></code> objects, as <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#event-handler-idl-attributes" id="ref-for-event-handler-idl-attributes">event handler IDL attributes</a> on the <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#window" id="ref-for-window④">Window</a></code> objects themselves (i.e. the table containing <code>onafterprint</code>),
  gets extended with the following row:</p>
    <table class="data">
     <thead>
      <tr>
       <th><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#event-handlers" id="ref-for-event-handlers①">Event handler</a>
       <th><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#event-handler-event-type" id="ref-for-event-handler-event-type">Event handler event type</a>
     <tbody>
      <tr>
       <td><dfn class="dfn-paneled idl-code" data-dfn-for="Window" data-dfn-type="attribute" data-export id="dom-window-onportalactivate"><code>onportalactivate</code></dfn>
       <td><code class="idl"><a data-link-type="idl" href="#eventdef-window-portalactivate" id="ref-for-eventdef-window-portalactivate④">portalactivate</a></code>
    </table>
    <p>The corresponding <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/webappapis.html#windoweventhandlers" id="ref-for-windoweventhandlers">WindowEventHandlers</a></code> mixin gets extended as follows:</p>
<pre class="idl highlight def"><c- b>partial</c-> <c- b>interface</c-> <c- b>mixin</c-> <a class="idl-code" data-link-type="interface" href="https://html.spec.whatwg.org/multipage/webappapis.html#windoweventhandlers" id="ref-for-windoweventhandlers①"><c- g>WindowEventHandlers</c-></a> {
    <c- b>attribute</c-> <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler" id="ref-for-eventhandler④"><c- n>EventHandler</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="WindowEventHandlers" data-dfn-type="attribute" data-export data-type="EventHandler" id="dom-windoweventhandlers-onportalactivate"><code><c- g>onportalactivate</c-></code></dfn>;
};
</pre>
    <p>The <a href="https://html.spec.whatwg.org/#events-2">Events index</a> is also updated with the
  following additional row:</p>
    <table class="data">
     <thead>
      <tr>
       <th>Event
       <th>Interface
       <th>Interesting targets
       <th>Description
     <tbody>
      <tr>
       <td><dfn class="dfn-paneled idl-code" data-dfn-for="Window" data-dfn-type="event" data-export id="eventdef-window-portalactivate"><code>portalactivate</code></dfn>
       <td><code class="idl"><a data-link-type="idl" href="#portalactivateevent" id="ref-for-portalactivateevent④">PortalActivateEvent</a></code>
       <td><code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#window" id="ref-for-window⑤">Window</a></code>
       <td>Fired at the <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#window" id="ref-for-window⑥">Window</a></code> of a <a data-link-type="dfn" href="#portal-browsing-context" id="ref-for-portal-browsing-context①②">portal browsing context</a> when that <a data-link-type="dfn" href="#portal-browsing-context" id="ref-for-portal-browsing-context①③">portal browsing context</a> is activated.
    </table>
    <h3 class="heading settled" data-level="4.3" id="patch-window-apis"><span class="secno">4.3. </span><span class="content">APIs for creating and navigating browsing contexts by name</span><a class="self-link" href="#patch-window-apis"></a></h3>
    <p>Modify the definition of <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#script-closable" id="ref-for-script-closable">script-closable</a> to prevent window closing while in a <a data-link-type="dfn" href="#portal-browsing-context" id="ref-for-portal-browsing-context①④">portal browsing context</a>:</p>
    <p>A <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#browsing-context" id="ref-for-browsing-context⑤">browsing context</a> is <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="script-closable">script-closable</dfn> if either of the following is true:</p>
    <ul>
     <li data-md>
      <p>it is an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#auxiliary-browsing-context" id="ref-for-auxiliary-browsing-context①">auxiliary browsing context</a> that was created by script (as opposed to by an action
of the user); or</p>
     <li data-md>
      <p>
       it is a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#top-level-browsing-context" id="ref-for-top-level-browsing-context④">top-level browsing context</a> 
       <ins>whose <a data-link-type="dfn" href="#portal-state" id="ref-for-portal-state①④">portal state</a> is "<code>none</code>"</ins>
        and whose <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/history.html#session-history" id="ref-for-session-history②">session history</a> contains only one <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#document" id="ref-for-document③">Document</a></code>.
      </p>
    </ul>
    <details class="wpt-tests-block" dir="ltr" lang="en" open>
     <summary>Tests</summary>
     <ul class="wpt-tests-list"></ul>
    </details>
    <h3 class="heading settled" data-level="4.4" id="patch-navigation"><span class="secno">4.4. </span><span class="content">Navigation</span><a class="self-link" href="#patch-navigation"></a></h3>
    <p>Patch the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#navigate" id="ref-for-navigate②">navigate</a> algorithm to prevent certain navigations in a
  portal as follows:</p>
    <div class="algorithm" data-algorithm="process a navigate response patch">
      In <a data-link-type="dfn">process a navigate response</a>, append the following after the step which
    establishes the value of <var>failure</var>, but before the step which uses it to display an error page: 
     <ol>
      <li data-md>
       <p>If <var>browsingContext</var>’s <a data-link-type="dfn" href="#portal-state" id="ref-for-portal-state①⑤">portal state</a> is not "<code>none</code>", and any of the following hold:</p>
       <ul>
        <li data-md>
         <p><var>failure</var> is true;</p>
        <li data-md>
         <p><var>navigationParams</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#navigation-params-request" id="ref-for-navigation-params-request">request</a> is null;</p>
        <li data-md>
         <p><var>navigationParams</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#navigation-params-request" id="ref-for-navigation-params-request①">request</a>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-current-url" id="ref-for-concept-request-current-url">current URL</a>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-scheme" id="ref-for-concept-url-scheme①">scheme</a> is not a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#http-scheme" id="ref-for-http-scheme②">HTTP(S) scheme</a>;</p>
        <li data-md>
         <p><var>response</var> has a `<code>Content-Disposition</code>` header specifying the <code>attachment</code> disposition type; or</p>
        <li data-md>
         <p><var>response</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-status" id="ref-for-concept-response-status">status</a> is 204 or 205,</p>
       </ul>
       <p>then:</p>
       <ol>
        <li data-md>
         <p>If <var>browsingContext</var>’s only entry in its <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/history.html#session-history" id="ref-for-session-history③">session history</a> is the initial <code>about:blank</code> <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#document" id="ref-for-document④">Document</a></code>, then:</p>
         <ol>
          <li data-md>
           <p><a data-link-type="dfn" href="#close-a-portal-element" id="ref-for-close-a-portal-element①">Close</a> <var>browsingContext</var>’s <a data-link-type="dfn" href="#host-element" id="ref-for-host-element①⓪">host element</a>.</p>
          <li data-md>
           <p>Run the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-discarding-steps" id="ref-for-environment-discarding-steps">environment discarding steps</a> for <var>navigationParam</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#navigation-params-reserved-environment" id="ref-for-navigation-params-reserved-environment">reserved environment</a>.</p>
         </ol>
        <li data-md>
         <p>Return.</p>
       </ol>
     </ol>
    </div>
    <div class="algorithm" data-algorithm="process a navigate URL scheme patch">
      In <a data-link-type="dfn">process a navigate URL scheme</a>, insert the following step before the step
    which displays inline content: 
     <ol>
      <li data-md>
       <p>Otherwise, if <var>browsingContext</var>’s <a data-link-type="dfn" href="#portal-state" id="ref-for-portal-state①⑥">portal state</a> is not "<code>none</code>", then <a data-link-type="dfn" href="#close-a-portal-element" id="ref-for-close-a-portal-element②">close</a> <var>browsingContext</var>’s <a data-link-type="dfn" href="#host-element" id="ref-for-host-element①①">host element</a>.</p>
     </ol>
    </div>
    <details class="wpt-tests-block" dir="ltr" lang="en" open>
     <summary>Tests</summary>
     <ul class="wpt-tests-list"></ul>
    </details>
    <h3 class="heading settled" data-level="4.5" id="patch-downloading"><span class="secno">4.5. </span><span class="content">Downloading resources</span><a class="self-link" href="#patch-downloading"></a></h3>
    <p>Modify the <a data-link-type="dfn">allowed to download</a> algorithm to ensure that portaled content never
  performs downloads, by prepending the following steps:</p>
    <div class="algorithm" data-algorithm="allowed to download patch">
     <ol>
      <li data-md>
       <p>If <var>initiator browsing context</var>’s <a data-link-type="dfn" href="#portal-state" id="ref-for-portal-state①⑦">portal state</a> is not "<code>none</code>", then
return false.</p>
      <li data-md>
       <p>If <var>instantiator browsing context</var>’s <a data-link-type="dfn" href="#portal-state" id="ref-for-portal-state①⑧">portal state</a> is not "<code>none</code>", then
return false.</p>
     </ol>
    </div>
   </section>
   <section>
    <h2 class="heading settled" data-level="5" id="other-spec-updates"><span class="secno">5. </span><span class="content">Updates to other specifications</span><a class="self-link" href="#other-spec-updates"></a></h2>
    <h3 class="heading settled" data-level="5.1" id="csp"><span class="secno">5.1. </span><span class="content">Content Security Policy</span><a class="self-link" href="#csp"></a></h3>
    <p>This specification integrates with <a data-link-type="biblio" href="#biblio-csp" title="Content Security Policy Level 3">[CSP]</a> as follows.</p>
    <p class="issue" id="issue-0eeb18ac"><a class="self-link" href="#issue-0eeb18ac"></a>Although <code>navigate-to</code> works as expected while the content is portaled, we also
  need to apply it to prevent activation (which is basically a navigation). This is not yet specced,
  pending spec updates to the navigation and session history handling.</p>
    <p>The following new subsection of <a href="https://w3c.github.io/webappsec-csp/#directives-fetch"><cite>Content Security Policy 3</cite> § 6.1 Fetch Directives</a> is added:</p>
    <h4 class="heading settled" data-level="5.1.1" id="portal-src-directive"><span class="secno">5.1.1. </span><span class="content"><code>portal-src</code></span><a class="self-link" href="#portal-src-directive"></a></h4>
    <p>The <dfn class="dfn-paneled" data-dfn-type="dfn" data-export id="portal-src">portal-src</dfn> directive restricts the URLs which may be loaded into <a data-link-type="dfn" href="#portal-browsing-context" id="ref-for-portal-browsing-context①⑤">portal browsing contexts</a>. The syntax for the directive’s name and value is described by the following
  ABNF:</p>
<pre class="highlight"><c- nc>directive-name</c->  <c- o>=</c-> <c- l>"portal-src"</c->
<c- nc>directive-value</c-> <c- o>=</c-> <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-serialized-source-list" id="ref-for-grammardef-serialized-source-list"><c- nc>serialized-source-list</c-></a>
</pre>
    <div class="example" id="example-portal-src">
     <a class="self-link" href="#example-portal-src"></a> Given a page with the following Content Security Policy: 
<pre><a data-link-type="http-header" href="https://w3c.github.io/webappsec-csp/#header-content-security-policy" id="ref-for-header-content-security-policy">Content-Security-Policy</a>: <a data-link-type="dfn" href="#portal-src" id="ref-for-portal-src">portal-src</a> https://example.com/
</pre>
     <p>Fetches for the following code will return a network errors, and thus result in <a data-link-type="dfn" href="#close-a-portal-element" id="ref-for-close-a-portal-element③">closing</a> the portal, as the URL provided does not match <code>portal-src</code>’s <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#source-lists" id="ref-for-source-lists">source list</a>:</p>
<pre class="highlight"><c- p>&lt;</c-><c- f>portal</c-> <c- e>src</c-><c- o>=</c-><c- s>"https://example.org/"</c-><c- p>>&lt;/</c-><c- f>portal</c-><c- p>></c->
</pre>
    </div>
    <h5 class="heading settled" data-level="5.1.1.1" id="portal-src-pre-request"><span class="secno">5.1.1.1. </span><span class="content"><code>portal-src</code> Pre-request check</span><a class="self-link" href="#portal-src-pre-request"></a></h5>
    <p>This directive’s <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directive-pre-request-check" id="ref-for-directive-pre-request-check">pre-request check</a> is as follows:</p>
    <div class="algorithm" data-algorithm="portal-src pre-request check">
      Given a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request" id="ref-for-concept-request①">request</a> <var>request</var> and a policy <var>policy</var>: 
     <ol>
      <li data-md>
       <p>Let <var>name</var> be the result of executing <a href="https://w3c.github.io/webappsec-csp/#effective-directive-for-a-request"><cite>Content Security Policy 3</cite> § 6.8.1 Get the effective directive for request</a> on <var>request</var>.</p>
      <li data-md>
       <p>If the result of executing <a href="https://w3c.github.io/webappsec-csp/#should-directive-execute"><cite>Content Security Policy 3</cite> § 6.8.4 Should fetch directive execute</a> on <var>name</var>, <code>portal-src</code> and <var>policy</var> is "<code>No</code>", return "<code>Allowed</code>".</p>
      <li data-md>
       <p>If the result of executing <a href="https://w3c.github.io/webappsec-csp/#match-request-to-source-list"><cite>Content Security Policy 3</cite> § 6.7.2.5 Does request match source list?</a> on <var>request</var>, this directive’s <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directive-value" id="ref-for-directive-value">value</a>, and <var>policy</var> is "<code>Does Not Match</code>", return "<code>Blocked</code>".</p>
      <li data-md>
       <p>Return "<code>Allowed</code>".</p>
     </ol>
    </div>
    <h5 class="heading settled" data-level="5.1.1.2" id="portal-src-post-request"><span class="secno">5.1.1.2. </span><span class="content"><code>portal-src</code> Post-request check</span><a class="self-link" href="#portal-src-post-request"></a></h5>
    <p>This directive’s <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directive-post-request-check" id="ref-for-directive-post-request-check">post-request check</a> is as follows:</p>
    <div class="algorithm" data-algorithm="portal-src post-request check">
      Given a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request" id="ref-for-concept-request②">request</a> <var>request</var>, a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response" id="ref-for-concept-response">response</a> <var>response</var>, and a policy <var>policy</var>: 
     <ol>
      <li data-md>
       <p>Let <var>name</var> be the result of executing <a href="https://w3c.github.io/webappsec-csp/#effective-directive-for-a-request"><cite>Content Security Policy 3</cite> § 6.8.1 Get the effective directive for request</a> on <var>request</var>.</p>
      <li data-md>
       <p>If the result of executing <a href="https://w3c.github.io/webappsec-csp/#should-directive-execute"><cite>Content Security Policy 3</cite> § 6.8.4 Should fetch directive execute</a> on <var>name</var>, <code>portal-src</code> and <var>policy</var> is "<code>No</code>", return "<code>Allowed</code>".</p>
      <li data-md>
       <p>If the result of executing <a href="https://w3c.github.io/webappsec-csp/#match-response-to-source-list"><cite>Content Security Policy 3</cite> § 6.7.2.6 Does response to request match source list?</a> on <var>response</var>, <var>request</var>,
this directive’s <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directive-value" id="ref-for-directive-value①">value</a>, and <var>policy</var> is "<code>Does Not Match</code>", return
"<code>Blocked</code>".</p>
      <li data-md>
       <p>Return "<code>Allowed</code>".</p>
     </ol>
    </div>
    <h4 class="heading settled" data-level="5.1.2" id="default-src-patch"><span class="secno">5.1.2. </span><span class="content"><code>default-src</code></span><a class="self-link" href="#default-src-patch"></a></h4>
    <p>The informative example text which expands it into all other fetch directives in <a href="https://w3c.github.io/webappsec-csp/#directive-default-src"><cite>Content Security Policy 3</cite> § 6.1.3 default-src</a> will need updating to include <a data-link-type="dfn" href="#portal-src" id="ref-for-portal-src①">portal-src</a>.</p>
    <h4 class="heading settled" data-level="5.1.3" id="directive-fallback-list-patch"><span class="secno">5.1.3. </span><span class="content">Get fetch directive fallback list</span><a class="self-link" href="#directive-fallback-list-patch"></a></h4>
    <p>The algorithm in <a href="https://w3c.github.io/webappsec-csp/#directive-fallback-list"><cite>Content Security Policy 3</cite> § 6.8.3 Get fetch directive fallback list</a> needs updating to account for the new <a data-link-type="dfn" href="#portal-src" id="ref-for-portal-src②">portal-src</a> fetch directive. Add a new case to step 1:</p>
    <dl class="switch">
     <dt data-md>"<code>portal-src</code>"
     <dd data-md>
      <ol>
       <li data-md>
        <p>Return « "<code>portal-src</code>", "<code>prefetch-src</code>", "<code>default-src</code>" ».</p>
      </ol>
    </dl>
    <h3 class="heading settled" data-level="5.2" id="fetch-metadata"><span class="secno">5.2. </span><span class="content">Fetch Metadata Request Headers</span><a class="self-link" href="#fetch-metadata"></a></h3>
    <p>This specification integrates with <a data-link-type="biblio" href="#biblio-fetch-metadata" title="Fetch Metadata Request Headers">[FETCH-METADATA]</a> as follows.</p>
    <section class="algorithm" data-algorithm="fetch-metadata-set-mode">
      The algorithm to <span spec-section="#abstract-opdef-set-mode">set the Sec-Fetch-Mode header</span> for a request <var>r</var> is modified as follows: 
     <ol>
      <li data-md>
       <p>Where the algorithm checks whether <var>r</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-reserved-client" id="ref-for-concept-request-reserved-client">reserved client</a>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-target-browsing-context" id="ref-for-concept-environment-target-browsing-context">target browsing context</a> is a <a data-link-type="dfn">nested browsing context</a>, check instead whether it is a <a data-link-type="dfn">nested browsing context</a> or a <a data-link-type="dfn" href="#portal-browsing-context" id="ref-for-portal-browsing-context①⑥">portal browsing context</a>.</p>
     </ol>
    </section>
    <div class="note" role="note">
      The effect of this is that the request for a document in a <a data-link-type="dfn" href="#portal-browsing-context" id="ref-for-portal-browsing-context①⑦">portal browsing context</a> will contain the following HTTP header, as though it were in a <a data-link-type="dfn">nested browsing context</a>. 
<pre>Sec-Fetch-Mode: nested-navigate
</pre>
    </div>
    <div class="note" role="note"> Per the existing processing model, the other fetch metadata headers will automatically have the
    same values as they would would if the load were occurring in an <code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/iframe-embed-object.html#the-iframe-element" id="ref-for-the-iframe-element③">iframe</a></code> element, with no
    spec updates needed. </div>
   </section>
   <section>
    <h2 class="heading settled" data-level="6" id="security-considerations"><span class="secno">6. </span><span class="content">Security Considerations</span><a class="self-link" href="#security-considerations"></a></h2>
    <div class="issue" id="issue-8e856747"><a class="self-link" href="#issue-8e856747"></a> We should expand this section further. Much of what was formerly there is in <a href="#other-spec-updates">§ 5 Updates to other specifications</a> now. Once we have a more comprehensive view of all the security-related
    spec updates, we should summarize them in a non-normative fashion here. </div>
    <h3 class="heading settled" data-level="6.1" id="security-overview"><span class="secno">6.1. </span><span class="content">Overview</span><a class="self-link" href="#security-overview"></a></h3>
    <p><em>This section is non-normative.</em></p>
    <p>In general, a <a data-link-type="dfn" href="#portal-browsing-context" id="ref-for-portal-browsing-context①⑧">portal browsing context</a> should respect policies that would apply to
  a <a data-link-type="dfn">nested browsing context</a>, e.g. that would restrict whether a document can be embedded
  in a document from another <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin" id="ref-for-concept-origin①">origin</a>.</p>
   </section>
   <section>
    <h2 class="heading settled" data-level="7" id="untriaged-tests"><span class="secno">7. </span><span class="content">Untriaged tests</span><a class="self-link" href="#untriaged-tests"></a></h2>
    <p>In order to get this spec to build without warnings, we need to include all the web platform tests
  explicitly. This section contains all the tests which we haven’t yet written spec text for, or
  haven’t triaged into the appropriate sections.</p>
    <details class="wpt-tests-block" dir="ltr" lang="en" open>
     <summary>Tests</summary>
     <ul class="wpt-tests-list"></ul>
    </details>
    <p>The following tests are actively incorrect and need to get updated:</p>
    <details class="wpt-tests-block" dir="ltr" lang="en" open>
     <summary>Tests</summary>
     <ul class="wpt-tests-list"></ul>
    </details>
   </section>
  </main>
  <div data-fill-with="conformance">
   <h2 class="no-ref no-num heading settled" id="w3c-conformance"><span class="content">Conformance</span></h2>
   <h3 class="no-ref no-num heading settled" id="w3c-conventions"><span class="content">Document conventions</span></h3>
   <p>Conformance requirements are expressed
    with a combination of descriptive assertions
    and RFC 2119 terminology.
    The key words “MUST”, “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”, “RECOMMENDED”, “MAY”, and “OPTIONAL”
    in the normative parts of this document
    are to be interpreted as described in RFC 2119.
    However, for readability,
    these words do not appear in all uppercase letters in this specification. </p>
   <p>All of the text of this specification is normative
    except sections explicitly marked as non-normative, examples, and notes. <a data-link-type="biblio">[RFC2119]</a> </p>
   <p>Examples in this specification are introduced with the words “for example”
    or are set apart from the normative text
    with <code>class="example"</code>,
    like this: </p>
   <div class="example" id="w3c-example">
    <p>This is an example of an informative example. </p>
   </div>
   <p>Informative notes begin with the word “Note”
    and are set apart from the normative text
    with <code>class="note"</code>,
    like this: </p>
   <p class="note" role="note">Note, this is an informative note.</p>
   <wpt open title="Tests relating to the content of this specification
                     may be documented in “Tests” blocks like this one.
                     Any such block is non-normative."></wpt>
  </div>
  <script src="https://www.w3.org/scripts/TR/2021/fixup.js"></script>
  <h2 class="no-num no-ref heading settled" id="index"><span class="content">Index</span><a class="self-link" href="#index"></a></h2>
  <h3 class="no-num no-ref heading settled" id="index-defined-here"><span class="content">Terms defined by this specification</span><a class="self-link" href="#index-defined-here"></a></h3>
  <ul class="index">
   <li><a href="#dom-htmlportalelement-activate">activate()</a><span>, in § 3</span>
   <li><a href="#activate-a-portal-browsing-context">activate a portal browsing context</a><span>, in § 2</span>
   <li><a href="#dom-htmlportalelement-activate">activate(options)</a><span>, in § 3</span>
   <li><a href="#portalactivateevent-activation-promise">activation promise</a><span>, in § 3.2</span>
   <li><a href="#portalactivateevent-adopted-predecessor-element">adopted predecessor element</a><span>, in § 3.2</span>
   <li><a href="#dom-portalactivateevent-adoptpredecessor">adoptPredecessor()</a><span>, in § 3.2</span>
   <li><a href="#adopt-the-predecessor-browsing-context">adopt the predecessor browsing context</a><span>, in § 2</span>
   <li><a href="#close-a-portal-element">close a portal element</a><span>, in § 3</span>
   <li><a href="#dom-portalactivateevent-portalactivateevent">constructor(type)</a><span>, in § 3.2</span>
   <li><a href="#dom-portalactivateevent-portalactivateevent">constructor(type, eventInitDict)</a><span>, in § 3.2</span>
   <li>
    data
    <ul>
     <li><a href="#dom-portalactivateevent-data">attribute for PortalActivateEvent</a><span>, in § 3.2</span>
     <li><a href="#dom-portalactivateeventinit-data">dict-member for PortalActivateEventInit</a><span>, in § 3.2</span>
     <li><a href="#dom-portalactivateoptions-data">dict-member for PortalActivateOptions</a><span>, in § 3</span>
    </ul>
   <li><a href="#htmlportalelement-guest-browsing-context">guest browsing context</a><span>, in § 3</span>
   <li><a href="#host-browsing-context">host browsing context</a><span>, in § 2</span>
   <li><a href="#host-element">host element</a><span>, in § 2</span>
   <li><a href="#htmlportalelement">HTMLPortalElement</a><span>, in § 3</span>
   <li><a href="#htmlportalelement-just-adopted-flag">just-adopted flag</a><span>, in § 3</span>
   <li><a href="#may-have-a-guest-browsing-context">may have a guest browsing context</a><span>, in § 3</span>
   <li>
    message
    <ul>
     <li><a href="#eventdef-htmlportalelement-message">event for HTMLPortalElement</a><span>, in § 3</span>
     <li><a href="#eventdef-portalhost-message">event for PortalHost</a><span>, in § 3.1</span>
    </ul>
   <li>
    messageerror
    <ul>
     <li><a href="#eventdef-htmlportalelement-messageerror">event for HTMLPortalElement</a><span>, in § 3</span>
     <li><a href="#eventdef-portalhost-messageerror">event for PortalHost</a><span>, in § 3.1</span>
    </ul>
   <li><a href="#typedefdef-messageeventsource">MessageEventSource</a><span>, in § 4.1</span>
   <li>
    onmessage
    <ul>
     <li><a href="#dom-htmlportalelement-onmessage">attribute for HTMLPortalElement</a><span>, in § 3</span>
     <li><a href="#dom-portalhost-onmessage">attribute for PortalHost</a><span>, in § 3.1</span>
    </ul>
   <li>
    onmessageerror
    <ul>
     <li><a href="#dom-htmlportalelement-onmessageerror">attribute for HTMLPortalElement</a><span>, in § 3</span>
     <li><a href="#dom-portalhost-onmessageerror">attribute for PortalHost</a><span>, in § 3.1</span>
    </ul>
   <li>
    onportalactivate
    <ul>
     <li><a href="#dom-window-onportalactivate">attribute for Window</a><span>, in § 4.2</span>
     <li><a href="#dom-windoweventhandlers-onportalactivate">attribute for WindowEventHandlers</a><span>, in § 4.2</span>
    </ul>
   <li><a href="#elementdef-portal">portal</a><span>, in § 3</span>
   <li><a href="#eventdef-window-portalactivate">portalactivate</a><span>, in § 4.2</span>
   <li><a href="#portalactivateevent">PortalActivateEvent</a><span>, in § 3.2</span>
   <li><a href="#dictdef-portalactivateeventinit">PortalActivateEventInit</a><span>, in § 3.2</span>
   <li><a href="#dom-portalactivateevent-portalactivateevent">PortalActivateEvent(type)</a><span>, in § 3.2</span>
   <li><a href="#dom-portalactivateevent-portalactivateevent">PortalActivateEvent(type, eventInitDict)</a><span>, in § 3.2</span>
   <li><a href="#dictdef-portalactivateoptions">PortalActivateOptions</a><span>, in § 3</span>
   <li><a href="#portal-browsing-context">portal browsing context</a><span>, in § 2</span>
   <li><a href="#portalhost">PortalHost</a><span>, in § 3.1</span>
   <li><a href="#dom-window-portalhost">portalHost</a><span>, in § 3.1</span>
   <li><a href="#portal-host-object">portal host object</a><span>, in § 3.1</span>
   <li><a href="#portal-src">portal-src</a><span>, in § 5.1.1</span>
   <li><a href="#portal-state">portal state</a><span>, in § 2</span>
   <li><a href="#portal-task-source">portal task source</a><span>, in § 2</span>
   <li>
    postMessage(message)
    <ul>
     <li><a href="#dom-htmlportalelement-postmessage">method for HTMLPortalElement</a><span>, in § 3</span>
     <li><a href="#dom-portalhost-postmessage">method for PortalHost</a><span>, in § 3.1</span>
    </ul>
   <li>
    postMessage(message, options)
    <ul>
     <li><a href="#dom-htmlportalelement-postmessage">method for HTMLPortalElement</a><span>, in § 3</span>
     <li><a href="#dom-portalhost-postmessage">method for PortalHost</a><span>, in § 3.1</span>
    </ul>
   <li><a href="#portalactivateevent-predecessor-browsing-context">predecessor browsing context</a><span>, in § 3.2</span>
   <li><a href="#dom-htmlportalelement-referrerpolicy">referrerPolicy</a><span>, in § 3</span>
   <li><a href="#element-attrdef-portal-referrerpolicy">referrerpolicy</a><span>, in § 3</span>
   <li><a href="#script-closable">script-closable</a><span>, in § 4.3</span>
   <li><a href="#set-the-source-url-of-a-portal-element">set the source URL of a portal element</a><span>, in § 3</span>
   <li>
    src
    <ul>
     <li><a href="#dom-htmlportalelement-src">attribute for HTMLPortalElement</a><span>, in § 3</span>
     <li><a href="#element-attrdef-portal-src">element-attr for portal</a><span>, in § 3</span>
    </ul>
   <li><a href="#portalactivateevent-successor-window">successor window</a><span>, in § 3.2</span>
  </ul>
  <h3 class="no-num no-ref heading settled" id="index-defined-elsewhere"><span class="content">Terms defined by reference</span><a class="self-link" href="#index-defined-elsewhere"></a></h3>
  <ul class="index">
   <li>
    <a data-link-type="biblio">[CSP]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="b7c21a86">Content-Security-Policy</span>
     <li><span class="dfn-paneled" id="adb85093">post-request check</span>
     <li><span class="dfn-paneled" id="7fe0991e">pre-request check</span>
     <li><span class="dfn-paneled" id="8ea172e9">sandbox</span>
     <li><span class="dfn-paneled" id="8f1a9afe">serialized-source-list</span>
     <li><span class="dfn-paneled" id="75aafb4f">source lists</span>
     <li><span class="dfn-paneled" id="461b765a">value</span>
    </ul>
   <li>
    <a data-link-type="biblio">[DOM]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="85394472">Document</span>
     <li><span class="dfn-paneled" id="129bdae8">Event</span>
     <li><span class="dfn-paneled" id="44a7708c">EventInit</span>
     <li><span class="dfn-paneled" id="2bc0cdf4">EventTarget</span>
     <li><span class="dfn-paneled" id="bec14ad5">activation behavior</span>
     <li><span class="dfn-paneled" id="a9910bde">adopting steps</span>
     <li><span class="dfn-paneled" id="3c307af9">creating an element</span>
     <li><span class="dfn-paneled" id="8abfc3b6">creating an event</span>
     <li><span class="dfn-paneled" id="1372f92a">dispatch</span>
     <li><span class="dfn-paneled" id="3a89258a">event constructing steps</span>
     <li><span class="dfn-paneled" id="5fd23811">fire an event</span>
     <li><span class="dfn-paneled" id="5216e1a0">node document</span>
     <li><span class="dfn-paneled" id="c62cd7cf">origin</span>
     <li><span class="dfn-paneled" id="9d09d04c">type</span>
     <li><span class="dfn-paneled" id="347e8fe9">URL</span>
    </ul>
   <li>
    <a data-link-type="biblio">[ECMASCRIPT]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="83d7f701">agent</span>
     <li><span class="dfn-paneled" id="7c9ab308">promise</span>
    </ul>
   <li>
    <a data-link-type="biblio">[FETCH]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="3f2ca4de">current URL</span>
     <li><span class="dfn-paneled" id="eb62573b">HTTP(S) scheme</span>
     <li><span class="dfn-paneled" id="07582c28">referrer policy</span>
     <li><span class="dfn-paneled" id="55213b5b">request</span>
     <li><span class="dfn-paneled" id="abe352cd">reserved client</span>
     <li><span class="dfn-paneled" id="ee7bba09">response</span>
     <li><span class="dfn-paneled" id="a1d47575">status</span>
     <li><span class="dfn-paneled" id="dc1cd39b">URL</span>
    </ul>
   <li>
    <a data-link-type="biblio">[HTML]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="402ed79d">CEReactions</span>
     <li><span class="dfn-paneled" id="f0951476">EventHandler</span>
     <li><span class="dfn-paneled" id="973aaf8e">HTMLConstructor</span>
     <li><span class="dfn-paneled" id="b08d0bb2">HTMLElement</span>
     <li><span class="dfn-paneled" id="3e8c0e5f">MessageEvent</span>
     <li><span class="dfn-paneled" id="df16744f">MessagePort</span>
     <li><span class="dfn-paneled" id="e7cb09fb">StructuredDeserializeWithTransfer</span>
     <li><span class="dfn-paneled" id="9da834a1">StructuredSerializeWithTransfer</span>
     <li><span class="dfn-paneled" id="5d7209e9">Window</span>
     <li><span class="dfn-paneled" id="8baa72cd">WindowEventHandlers</span>
     <li><span class="dfn-paneled" id="94039a0c">WindowProxy</span>
     <li><span class="dfn-paneled" id="27e10eaf">active sandboxing flag set</span>
     <li><span class="dfn-paneled" id="3349d69f">associated Document</span>
     <li><span class="dfn-paneled" id="58ebefde">auxiliary browsing context</span>
     <li><span class="dfn-paneled" id="01844357">become browsing-context connected</span>
     <li><span class="dfn-paneled" id="5ab33979">become browsing-context disconnected</span>
     <li><span class="dfn-paneled" id="0d0390b4">browsing context</span>
     <li><span class="dfn-paneled" id="3b2ff63e">browsing context <small>(for Document)</small></span>
     <li><span class="dfn-paneled" id="6d88ab2e">browsing context <small>(for Window)</small></span>
     <li><span class="dfn-paneled" id="5d9c7125">browsing context group</span>
     <li><span class="dfn-paneled" id="e809a09f">browsing-context connected</span>
     <li><span class="dfn-paneled" id="9042040b">close a browsing context</span>
     <li><span class="dfn-paneled" id="3b367d8d">completely loaded</span>
     <li><span class="dfn-paneled" id="9e690900">create a new top-level browsing context</span>
     <li><span class="dfn-paneled" id="3700794f">data</span>
     <li><span class="dfn-paneled" id="4c96ad04">discard a browsing context</span>
     <li><span class="dfn-paneled" id="78a97411">environment discarding steps</span>
     <li><span class="dfn-paneled" id="6a5a59a0">event handler</span>
     <li><span class="dfn-paneled" id="cc6d9aed">event handler content attribute</span>
     <li><span class="dfn-paneled" id="9d386f55">event handler event type</span>
     <li><span class="dfn-paneled" id="03675365">event handler IDL attribute</span>
     <li><span class="dfn-paneled" id="c6d19e56">event loop</span>
     <li><span class="dfn-paneled" id="b78d6a64">event loop <small>(for agent)</small></span>
     <li><span class="dfn-paneled" id="87fcd40c">iframe</span>
     <li><span class="dfn-paneled" id="a72449dd">in parallel</span>
     <li><span class="dfn-paneled" id="27ce3281">limited to only known values</span>
     <li><span class="dfn-paneled" id="18e7dde9">load</span>
     <li><span class="dfn-paneled" id="2594e562">navigate</span>
     <li><span class="dfn-paneled" id="086e3aff">origin</span>
     <li><span class="dfn-paneled" id="e0eefdd9">origin <small>(for MessageEvent)</small></span>
     <li><span class="dfn-paneled" id="43ac8374">origin <small>(for environment settings object)</small></span>
     <li><span class="dfn-paneled" id="55a8e1b3">parse a URL</span>
     <li><span class="dfn-paneled" id="7b162b57">ports</span>
     <li><span class="dfn-paneled" id="5bec656b">prompt to unload</span>
     <li><span class="dfn-paneled" id="48438eb3">queue a global task</span>
     <li><span class="dfn-paneled" id="72aaa5d6">queue an element task</span>
     <li><span class="dfn-paneled" id="d1ee46ce">realm <small>(for environment settings object)</small></span>
     <li><span class="dfn-paneled" id="b75a7d23">realm <small>(for global object)</small></span>
     <li><span class="dfn-paneled" id="57807ab9">referrer policy attribute</span>
     <li><span class="dfn-paneled" id="5ab7b520">reflect</span>
     <li><span class="dfn-paneled" id="e99bd18e">relevant global object</span>
     <li><span class="dfn-paneled" id="9c4c1e66">relevant settings object</span>
     <li><span class="dfn-paneled" id="0364029f">request</span>
     <li><span class="dfn-paneled" id="65d48b3a">reserved environment</span>
     <li><span class="dfn-paneled" id="663fde87">resulting URL record</span>
     <li><span class="dfn-paneled" id="7393da89">same origin</span>
     <li><span class="dfn-paneled" id="521818b9">same origin-domain</span>
     <li><span class="dfn-paneled" id="cd2846d6">script-closable</span>
     <li><span class="dfn-paneled" id="dae0bfde">serialization of an origin</span>
     <li><span class="dfn-paneled" id="48093925">session history</span>
     <li><span class="dfn-paneled" id="a0d0a7c7">source</span>
     <li><span class="dfn-paneled" id="085ddd0a">target browsing context</span>
     <li><span class="dfn-paneled" id="c3b2d08c">task source</span>
     <li><span class="dfn-paneled" id="ae2a6342">top-level browsing context</span>
     <li><span class="dfn-paneled" id="ba4c841d">unload</span>
     <li><span class="dfn-paneled" id="8bd6a569">unload <small>(for Window)</small></span>
     <li><span class="dfn-paneled" id="cad61a81">valid non-empty URL potentially surrounded by spaces</span>
    </ul>
   <li>
    <a data-link-type="biblio">[INFRA]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="77b4c09a">assert</span>
     <li><span class="dfn-paneled" id="36858240">boolean</span>
     <li><span class="dfn-paneled" id="f052b1ea">HTML namespace</span>
    </ul>
   <li>
    <a data-link-type="biblio">[REFERRER-POLICY]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="2d09a0dd">referrer policy</span>
    </ul>
   <li>
    <a data-link-type="biblio">[SERVICE-WORKERS]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="1968aaab">ServiceWorker</span>
    </ul>
   <li>
    <a data-link-type="biblio">[URL]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="3a711be7">scheme</span>
     <li><span class="dfn-paneled" id="dcffbccd">URL</span>
    </ul>
   <li>
    <a data-link-type="biblio">[WEBIDL]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="dca2de17">DOMException</span>
     <li><span class="dfn-paneled" id="8855a9aa">DOMString</span>
     <li><span class="dfn-paneled" id="889e932f">Exposed</span>
     <li><span class="dfn-paneled" id="797018a7">InvalidStateError</span>
     <li><span class="dfn-paneled" id="c807e273">NewObject</span>
     <li><span class="dfn-paneled" id="bdbd19d1">Promise</span>
     <li><span class="dfn-paneled" id="b0d7f3c3">USVString</span>
     <li><span class="dfn-paneled" id="6c6b1005">any</span>
     <li><span class="dfn-paneled" id="abbed741">frozen array type</span>
     <li><span class="dfn-paneled" id="b262501e">reject</span>
     <li><span class="dfn-paneled" id="4013a022">this</span>
     <li><span class="dfn-paneled" id="5f90bbfb">undefined</span>
    </ul>
  </ul>
  <h2 class="no-num no-ref heading settled" id="references"><span class="content">References</span><a class="self-link" href="#references"></a></h2>
  <h3 class="no-num no-ref heading settled" id="normative"><span class="content">Normative References</span><a class="self-link" href="#normative"></a></h3>
  <dl>
   <dt id="biblio-csp">[CSP]
   <dd>Mike West; Antonio Sartori. <a href="https://w3c.github.io/webappsec-csp/"><cite>Content Security Policy Level 3</cite></a>. URL: <a href="https://w3c.github.io/webappsec-csp/">https://w3c.github.io/webappsec-csp/</a>
   <dt id="biblio-dom">[DOM]
   <dd>Anne van Kesteren. <a href="https://dom.spec.whatwg.org/"><cite>DOM Standard</cite></a>. Living Standard. URL: <a href="https://dom.spec.whatwg.org/">https://dom.spec.whatwg.org/</a>
   <dt id="biblio-ecmascript">[ECMASCRIPT]
   <dd><a href="https://tc39.es/ecma262/multipage/"><cite>ECMAScript Language Specification</cite></a>. URL: <a href="https://tc39.es/ecma262/multipage/">https://tc39.es/ecma262/multipage/</a>
   <dt id="biblio-fetch">[FETCH]
   <dd>Anne van Kesteren. <a href="https://fetch.spec.whatwg.org/"><cite>Fetch Standard</cite></a>. Living Standard. URL: <a href="https://fetch.spec.whatwg.org/">https://fetch.spec.whatwg.org/</a>
   <dt id="biblio-html">[HTML]
   <dd>Anne van Kesteren; et al. <a href="https://html.spec.whatwg.org/multipage/"><cite>HTML Standard</cite></a>. Living Standard. URL: <a href="https://html.spec.whatwg.org/multipage/">https://html.spec.whatwg.org/multipage/</a>
   <dt id="biblio-infra">[INFRA]
   <dd>Anne van Kesteren; Domenic Denicola. <a href="https://infra.spec.whatwg.org/"><cite>Infra Standard</cite></a>. Living Standard. URL: <a href="https://infra.spec.whatwg.org/">https://infra.spec.whatwg.org/</a>
   <dt id="biblio-referrer-policy">[REFERRER-POLICY]
   <dd>Jochen Eisinger; Emily Stark. <a href="https://w3c.github.io/webappsec-referrer-policy/"><cite>Referrer Policy</cite></a>. URL: <a href="https://w3c.github.io/webappsec-referrer-policy/">https://w3c.github.io/webappsec-referrer-policy/</a>
   <dt id="biblio-service-workers">[SERVICE-WORKERS]
   <dd>Jake Archibald; Marijn Kruisselbrink. <a href="https://w3c.github.io/ServiceWorker/"><cite>Service Workers</cite></a>. URL: <a href="https://w3c.github.io/ServiceWorker/">https://w3c.github.io/ServiceWorker/</a>
   <dt id="biblio-url">[URL]
   <dd>Anne van Kesteren. <a href="https://url.spec.whatwg.org/"><cite>URL Standard</cite></a>. Living Standard. URL: <a href="https://url.spec.whatwg.org/">https://url.spec.whatwg.org/</a>
   <dt id="biblio-webidl">[WEBIDL]
   <dd>Edgar Chen; Timothy Gu. <a href="https://webidl.spec.whatwg.org/"><cite>Web IDL Standard</cite></a>. Living Standard. URL: <a href="https://webidl.spec.whatwg.org/">https://webidl.spec.whatwg.org/</a>
  </dl>
  <h3 class="no-num no-ref heading settled" id="informative"><span class="content">Informative References</span><a class="self-link" href="#informative"></a></h3>
  <dl>
   <dt id="biblio-fetch-metadata">[FETCH-METADATA]
   <dd>Mike West. <a href="https://w3c.github.io/webappsec-fetch-metadata/"><cite>Fetch Metadata Request Headers</cite></a>. URL: <a href="https://w3c.github.io/webappsec-fetch-metadata/">https://w3c.github.io/webappsec-fetch-metadata/</a>
  </dl>
  <h2 class="no-num no-ref heading settled" id="idl-index"><span class="content">IDL Index</span><a class="self-link" href="#idl-index"></a></h2>
<pre class="idl highlight def">[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed"><c- g>Exposed</c-></a>=<c- n>Window</c->, <a class="idl-code" data-link-type="extended-attribute" href="https://html.spec.whatwg.org/multipage/dom.html#htmlconstructor"><c- g>HTMLConstructor</c-></a>]
<c- b>interface</c-> <a href="#htmlportalelement"><code><c- g>HTMLPortalElement</c-></code></a> : <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/dom.html#htmlelement"><c- n>HTMLElement</c-></a> {
    [<a class="idl-code" data-link-type="extended-attribute" href="https://html.spec.whatwg.org/multipage/custom-elements.html#cereactions"><c- g>CEReactions</c-></a>] <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-USVString"><c- b>USVString</c-></a> <a class="idl-code" data-link-type="attribute" data-type="USVString" href="#dom-htmlportalelement-src"><c- g>src</c-></a>;
    [<a class="idl-code" data-link-type="extended-attribute" href="https://html.spec.whatwg.org/multipage/custom-elements.html#cereactions"><c- g>CEReactions</c-></a>] <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString"><c- b>DOMString</c-></a> <a class="idl-code" data-link-type="attribute" data-type="DOMString" href="#dom-htmlportalelement-referrerpolicy"><c- g>referrerPolicy</c-></a>;

    [<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#NewObject"><c- g>NewObject</c-></a>] <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise"><c- b>Promise</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-undefined"><c- b>undefined</c-></a>> <a class="idl-code" data-link-type="method" href="#dom-htmlportalelement-activate"><c- g>activate</c-></a>(<c- b>optional</c-> <a data-link-type="idl-name" href="#dictdef-portalactivateoptions"><c- n>PortalActivateOptions</c-></a> <a href="#dom-htmlportalelement-activate-options-options"><code><c- g>options</c-></code></a> = {});
    <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-undefined"><c- b>undefined</c-></a> <a class="idl-code" data-link-type="method" href="#dom-htmlportalelement-postmessage"><c- g>postMessage</c-></a>(<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-any"><c- b>any</c-></a> <a href="#dom-htmlportalelement-postmessage-message-options-message"><code><c- g>message</c-></code></a>, <c- b>optional</c-> <a data-link-type="idl-name"><c- n>PostMessageOptions</c-></a> <a href="#dom-htmlportalelement-postmessage-message-options-options"><code><c- g>options</c-></code></a> = {});

    <c- b>attribute</c-> <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler"><c- n>EventHandler</c-></a> <a data-type="EventHandler" href="#dom-htmlportalelement-onmessage"><code><c- g>onmessage</c-></code></a>;
    <c- b>attribute</c-> <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler"><c- n>EventHandler</c-></a> <a data-type="EventHandler" href="#dom-htmlportalelement-onmessageerror"><code><c- g>onmessageerror</c-></code></a>;
};

<c- b>dictionary</c-> <a href="#dictdef-portalactivateoptions"><code><c- g>PortalActivateOptions</c-></code></a> : <a data-link-type="idl-name"><c- n>PostMessageOptions</c-></a> {
    <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-any"><c- b>any</c-></a> <a data-type="any" href="#dom-portalactivateoptions-data"><code><c- g>data</c-></code></a>;
};

<c- b>partial</c-> <c- b>interface</c-> <a class="idl-code" data-link-type="interface" href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#window"><c- g>Window</c-></a> {
    <c- b>readonly</c-> <c- b>attribute</c-> <a data-link-type="idl-name" href="#portalhost"><c- n>PortalHost</c-></a>? <a class="idl-code" data-link-type="attribute" data-readonly data-type="PortalHost?" href="#dom-window-portalhost"><c- g>portalHost</c-></a>;
};

[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed"><c- g>Exposed</c-></a>=<c- n>Window</c->]
<c- b>interface</c-> <a href="#portalhost"><code><c- g>PortalHost</c-></code></a> : <a data-link-type="idl-name" href="https://dom.spec.whatwg.org/#eventtarget"><c- n>EventTarget</c-></a> {
    <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-undefined"><c- b>undefined</c-></a> <a class="idl-code" data-link-type="method" href="#dom-portalhost-postmessage"><c- g>postMessage</c-></a>(<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-any"><c- b>any</c-></a> <a href="#dom-portalhost-postmessage-message-options-message"><code><c- g>message</c-></code></a>, <c- b>optional</c-> <a data-link-type="idl-name"><c- n>PostMessageOptions</c-></a> <a href="#dom-portalhost-postmessage-message-options-options"><code><c- g>options</c-></code></a> = {});

    <c- b>attribute</c-> <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler"><c- n>EventHandler</c-></a> <a data-type="EventHandler" href="#dom-portalhost-onmessage"><code><c- g>onmessage</c-></code></a>;
    <c- b>attribute</c-> <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler"><c- n>EventHandler</c-></a> <a data-type="EventHandler" href="#dom-portalhost-onmessageerror"><code><c- g>onmessageerror</c-></code></a>;
};

[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed"><c- g>Exposed</c-></a>=<c- n>Window</c->]
<c- b>interface</c-> <a href="#portalactivateevent"><code><c- g>PortalActivateEvent</c-></code></a> : <a data-link-type="idl-name" href="https://dom.spec.whatwg.org/#event"><c- n>Event</c-></a> {
    <a href="#dom-portalactivateevent-portalactivateevent"><code><c- g>constructor</c-></code></a>(<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString"><c- b>DOMString</c-></a> <a href="#dom-portalactivateevent-portalactivateevent-type-eventinitdict-type"><code><c- g>type</c-></code></a>, <c- b>optional</c-> <a data-link-type="idl-name" href="#dictdef-portalactivateeventinit"><c- n>PortalActivateEventInit</c-></a> <a href="#dom-portalactivateevent-portalactivateevent-type-eventinitdict-eventinitdict"><code><c- g>eventInitDict</c-></code></a> = {});

    <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-any"><c- b>any</c-></a> <a data-readonly data-type="any" href="#dom-portalactivateevent-data"><code><c- g>data</c-></code></a>;
    <a data-link-type="idl-name" href="#htmlportalelement"><c- n>HTMLPortalElement</c-></a> <a class="idl-code" data-link-type="method" href="#dom-portalactivateevent-adoptpredecessor"><c- g>adoptPredecessor</c-></a>();
};

<c- b>dictionary</c-> <a href="#dictdef-portalactivateeventinit"><code><c- g>PortalActivateEventInit</c-></code></a> : <a data-link-type="idl-name" href="https://dom.spec.whatwg.org/#dictdef-eventinit"><c- n>EventInit</c-></a> {
    <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-any"><c- b>any</c-></a> <a data-default="null" data-type="any" href="#dom-portalactivateeventinit-data"><code><c- g>data</c-></code></a> = <c- b>null</c->;
};

<c- b>typedef</c-> (<a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#windowproxy"><c- n>WindowProxy</c-></a> <c- b>or</c-> <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/web-messaging.html#messageport"><c- n>MessagePort</c-></a> <c- b>or</c-> <a data-link-type="idl-name" href="https://w3c.github.io/ServiceWorker/#serviceworker"><c- n>ServiceWorker</c-></a> <c- b>or</c-> <a data-link-type="idl-name" href="#htmlportalelement"><c- n>HTMLPortalElement</c-></a> <c- b>or</c-> <a data-link-type="idl-name" href="#portalhost"><c- n>PortalHost</c-></a>) <a href="#typedefdef-messageeventsource"><code><c- g>MessageEventSource</c-></code></a>;

<c- b>partial</c-> <c- b>interface</c-> <c- b>mixin</c-> <a class="idl-code" data-link-type="interface" href="https://html.spec.whatwg.org/multipage/webappapis.html#windoweventhandlers"><c- g>WindowEventHandlers</c-></a> {
    <c- b>attribute</c-> <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler"><c- n>EventHandler</c-></a> <a data-type="EventHandler" href="#dom-windoweventhandlers-onportalactivate"><code><c- g>onportalactivate</c-></code></a>;
};

</pre>
  <h2 class="no-num no-ref heading settled" id="issues-index"><span class="content">Issues Index</span><a class="self-link" href="#issues-index"></a></h2>
  <div style="counter-reset:issue">
   <div class="issue"> Determine how to treat unload/beforeunload handlers. See <a href="https://github.com/WICG/portals/issues/225">issue #225</a> for discussion. <a class="issue-return" href="#issue-c722a2b5" title="Jump to section">↵</a></div>
   <div class="issue"> In the case that structured deserialization throws, it may be useful to do something else to indicate it,
    rather than simply providing null data. <a class="issue-return" href="#issue-b49e4903" title="Jump to section">↵</a></div>
   <div class="issue"> We need to specify how the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/history.html#session-history">session history</a> of each browsing context is
    affected by activation, and supply non-normative text that explains how
    these histories are expected to be presented to the user. <a class="issue-return" href="#issue-0d72b101" title="Jump to section">↵</a></div>
   <div class="issue"> It might be convenient to not immediately detach the portal element, but instead to do so
    in a microtask. This would allow developers to reinsert the <code><a data-link-type="element" href="#elementdef-portal">portal</a></code> element without losing
    its browsing context. <a class="issue-return" href="#issue-833dc9f1" title="Jump to section">↵</a></div>
   <div class="issue">Although <code>navigate-to</code> works as expected while the content is portaled, we also
  need to apply it to prevent activation (which is basically a navigation). This is not yet specced,
  pending spec updates to the navigation and session history handling. <a class="issue-return" href="#issue-0eeb18ac" title="Jump to section">↵</a></div>
   <div class="issue"> We should expand this section further. Much of what was formerly there is in <a href="#other-spec-updates">§ 5 Updates to other specifications</a> now. Once we have a more comprehensive view of all the security-related
    spec updates, we should summarize them in a non-normative fashion here. <a class="issue-return" href="#issue-8e856747" title="Jump to section">↵</a></div>
  </div>
  <details class="mdn-anno unpositioned" data-anno-for="the-portal-element">
   <summary><b class="less-than-two-engines-flag" title="This feature is in less than two current engines.">⚠</b><span>MDN</span></summary>
   <div class="feature">
    <p><a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/portal" title="The <portal> HTML element enables the embedding of another HTML page into the current one for the purposes of allowing smoother navigation into new pages.">Element/portal</a></p>
    <p class="less-than-two-engines-text">In only one current engine.</p>
    <div class="support">
     <span class="firefox no"><span>Firefox</span><span>None</span></span><span class="safari no"><span>Safari</span><span>None</span></span><span class="chrome yes"><span>Chrome</span><span title="Requires setting a user preference or runtime flag.">🔰 85+</span></span>
     <hr>
     <span class="opera yes"><span>Opera</span><span title="Requires setting a user preference or runtime flag.">🔰 73+</span></span><span class="edge_blink yes"><span>Edge</span><span title="Requires setting a user preference or runtime flag.">🔰 85+</span></span>
     <hr>
     <span class="edge no"><span>Edge (Legacy)</span><span>None</span></span><span class="ie no"><span>IE</span><span>None</span></span>
     <hr>
     <span class="firefox_android no"><span>Firefox for Android</span><span>?</span></span><span class="safari_ios no"><span>iOS Safari</span><span>?</span></span><span class="chrome_android no"><span>Chrome for Android</span><span>?</span></span><span class="samsunginternet_android no"><span>Samsung Internet</span><span>?</span></span><span class="opera_android no"><span>Opera Mobile</span><span>?</span></span>
    </div>
   </div>
  </details>