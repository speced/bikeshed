<!doctype html><html lang="en">
 <head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
  <title>Portals</title>
  <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
  <link href="https://www.w3.org/StyleSheets/TR/2016/cg-draft" rel="stylesheet">
  <link href="https://wicg.github.io/portals/" rel="canonical">
<style>/* style-autolinks */

.css.css, .property.property, .descriptor.descriptor {
    color: var(--a-normal-text);
    font-size: inherit;
    font-family: inherit;
}
.css::before, .property::before, .descriptor::before {
    content: "‘";
}
.css::after, .property::after, .descriptor::after {
    content: "’";
}
.property, .descriptor {
    /* Don't wrap property and descriptor names */
    white-space: nowrap;
}
.type { /* CSS value <type> */
    font-style: italic;
}
pre .property::before, pre .property::after {
    content: "";
}
[data-link-type="property"]::before,
[data-link-type="propdesc"]::before,
[data-link-type="descriptor"]::before,
[data-link-type="value"]::before,
[data-link-type="function"]::before,
[data-link-type="at-rule"]::before,
[data-link-type="selector"]::before,
[data-link-type="maybe"]::before {
    content: "‘";
}
[data-link-type="property"]::after,
[data-link-type="propdesc"]::after,
[data-link-type="descriptor"]::after,
[data-link-type="value"]::after,
[data-link-type="function"]::after,
[data-link-type="at-rule"]::after,
[data-link-type="selector"]::after,
[data-link-type="maybe"]::after {
    content: "’";
}

[data-link-type].production::before,
[data-link-type].production::after,
.prod [data-link-type]::before,
.prod [data-link-type]::after {
    content: "";
}

[data-link-type=element],
[data-link-type=element-attr] {
    font-family: Menlo, Consolas, "DejaVu Sans Mono", monospace;
    font-size: .9em;
}
[data-link-type=element]::before { content: "<" }
[data-link-type=element]::after  { content: ">" }

[data-link-type=biblio] {
    white-space: pre;
}</style>
<style>/* style-colors */

/* Any --*-text not paired with a --*-bg is assumed to have a transparent bg */
:root {
    color-scheme: light dark;

    --text: black;
    --bg: white;

    --unofficial-watermark: url(https://www.w3.org/StyleSheets/TR/2016/logos/UD-watermark);

    --logo-bg: #1a5e9a;
    --logo-active-bg: #c00;
    --logo-text: white;

    --tocnav-normal-text: #707070;
    --tocnav-normal-bg: var(--bg);
    --tocnav-hover-text: var(--tocnav-normal-text);
    --tocnav-hover-bg: #f8f8f8;
    --tocnav-active-text: #c00;
    --tocnav-active-bg: var(--tocnav-normal-bg);

    --tocsidebar-text: var(--text);
    --tocsidebar-bg: #f7f8f9;
    --tocsidebar-shadow: rgba(0,0,0,.1);
    --tocsidebar-heading-text: hsla(203,20%,40%,.7);

    --toclink-text: var(--text);
    --toclink-underline: #3980b5;
    --toclink-visited-text: var(--toclink-text);
    --toclink-visited-underline: #054572;

    --heading-text: #005a9c;

    --hr-text: var(--text);

    --algo-border: #def;

    --del-text: red;
    --del-bg: transparent;
    --ins-text: #080;
    --ins-bg: transparent;

    --a-normal-text: #034575;
    --a-normal-underline: #bbb;
    --a-visited-text: var(--a-normal-text);
    --a-visited-underline: #707070;
    --a-hover-bg: rgba(75%, 75%, 75%, .25);
    --a-active-text: #c00;
    --a-active-underline: #c00;

    --blockquote-border: silver;
    --blockquote-bg: transparent;
    --blockquote-text: currentcolor;

    --issue-border: #e05252;
    --issue-bg: #fbe9e9;
    --issue-text: var(--text);
    --issueheading-text: #831616;

    --example-border: #e0cb52;
    --example-bg: #fcfaee;
    --example-text: var(--text);
    --exampleheading-text: #574b0f;

    --note-border: #52e052;
    --note-bg: #e9fbe9;
    --note-text: var(--text);
    --noteheading-text: hsl(120, 70%, 30%);
    --notesummary-underline: silver;

    --assertion-border: #aaa;
    --assertion-bg: #eee;
    --assertion-text: black;

    --advisement-border: orange;
    --advisement-bg: #fec;
    --advisement-text: var(--text);
    --advisementheading-text: #b35f00;

    --warning-border: red;
    --warning-bg: hsla(40,100%,50%,0.95);
    --warning-text: var(--text);

    --amendment-border: #330099;
    --amendment-bg: #F5F0FF;
    --amendment-text: var(--text);
    --amendmentheading-text: #220066;

    --def-border: #8ccbf2;
    --def-bg: #def;
    --def-text: var(--text);
    --defrow-border: #bbd7e9;

    --datacell-border: silver;

    --indexinfo-text: #707070;

    --indextable-hover-text: black;
    --indextable-hover-bg: #f7f8f9;

    --outdatedspec-bg: rgba(0, 0, 0, .5);
    --outdatedspec-text: black;
    --outdated-bg: maroon;
    --outdated-text: white;
    --outdated-shadow: red;

    --editedrec-bg: darkorange;
}</style>
<style>/* style-counters */

body {
    counter-reset: example figure issue;
}
.issue {
    counter-increment: issue;
}
.issue:not(.no-marker)::before {
    content: "Issue " counter(issue);
}

.example {
    counter-increment: example;
}
.example:not(.no-marker)::before {
    content: "Example " counter(example);
}
.invalid.example:not(.no-marker)::before,
.illegal.example:not(.no-marker)::before {
    content: "Invalid Example" counter(example);
}

figcaption {
    counter-increment: figure;
}
figcaption:not(.no-marker)::before {
    content: "Figure " counter(figure) " ";
}</style>
<style>/* style-dfn-panel */

:root {
    --dfnpanel-bg: #ddd;
    --dfnpanel-text: var(--text);
}
.dfn-panel {
    position: absolute;
    z-index: 35;
    height: auto;
    width: -webkit-fit-content;
    width: fit-content;
    max-width: 300px;
    max-height: 500px;
    overflow: auto;
    padding: 0.5em 0.75em;
    font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
    background: var(--dfnpanel-bg);
    color: var(--dfnpanel-text);
    border: outset 0.2em;
}
.dfn-panel:not(.on) { display: none; }
.dfn-panel * { margin: 0; padding: 0; text-indent: 0; }
.dfn-panel > b { display: block; }
.dfn-panel a { color: var(--dfnpanel-text); }
.dfn-panel a:not(:hover) { text-decoration: none !important; border-bottom: none !important; }
.dfn-panel > b + b { margin-top: 0.25em; }
.dfn-panel ul { padding: 0; }
.dfn-panel li { list-style: inside; }
.dfn-panel.activated {
    display: inline-block;
    position: fixed;
    left: .5em;
    bottom: 2em;
    margin: 0 auto;
    max-width: calc(100vw - 1.5em - .4em - .5em);
    max-height: 30vh;
}

.dfn-paneled { cursor: pointer; }
</style>
<style>/* style-issues */

a[href].issue-return {
    float: right;
    float: inline-end;
    color: var(--issueheading-text);
    font-weight: bold;
    text-decoration: none;
}
</style>
<style>/* style-md-lists */

/* This is a weird hack for me not yet following the commonmark spec
   regarding paragraph and lists. */
[data-md] > :first-child {
    margin-top: 0;
}
[data-md] > :last-child {
    margin-bottom: 0;
}</style>
<style>/* style-selflinks */

:root {
    --selflink-text: white;
    --selflink-bg: gray;
    --selflink-hover-text: black;
}
.heading, .issue, .note, .example, li, dt {
    position: relative;
}
a.self-link {
    position: absolute;
    top: 0;
    left: calc(-1 * (3.5rem - 26px));
    width: calc(3.5rem - 26px);
    height: 2em;
    text-align: center;
    border: none;
    transition: opacity .2s;
    opacity: .5;
}
a.self-link:hover {
    opacity: 1;
}
.heading > a.self-link {
    font-size: 83%;
}
li > a.self-link {
    left: calc(-1 * (3.5rem - 26px) - 2em);
}
dfn > a.self-link {
    top: auto;
    left: auto;
    opacity: 0;
    width: 1.5em;
    height: 1.5em;
    background: var(--selflink-bg);
    color: var(--selflink-text);
    font-style: normal;
    transition: opacity .2s, background-color .2s, color .2s;
}
dfn:hover > a.self-link {
    opacity: 1;
}
dfn > a.self-link:hover {
    color: var(--selflink-hover-text);
}

a.self-link::before            { content: "¶"; }
.heading > a.self-link::before { content: "§"; }
dfn > a.self-link::before      { content: "#"; }
</style>
<style>/* style-syntax-highlighting */

            pre.idl.highlight {
                background: var(--borderedblock-bg, var(--def-bg));
            }
            
code.highlight { padding: .1em; border-radius: .3em; }
pre.highlight, pre > code.highlight { display: block; padding: 1em; margin: .5em 0; overflow: auto; border-radius: 0; }

.highlight:not(.idl) { background: rgba(0, 0, 0, .03); }
c-[a] { color: #990055 } /* Keyword.Declaration */
c-[b] { color: #990055 } /* Keyword.Type */
c-[c] { color: #708090 } /* Comment */
c-[d] { color: #708090 } /* Comment.Multiline */
c-[e] { color: #0077aa } /* Name.Attribute */
c-[f] { color: #669900 } /* Name.Tag */
c-[g] { color: #222222 } /* Name.Variable */
c-[k] { color: #990055 } /* Keyword */
c-[l] { color: #000000 } /* Literal */
c-[m] { color: #000000 } /* Literal.Number */
c-[n] { color: #0077aa } /* Name */
c-[o] { color: #999999 } /* Operator */
c-[p] { color: #999999 } /* Punctuation */
c-[s] { color: #a67f59 } /* Literal.String */
c-[t] { color: #a67f59 } /* Literal.String.Single */
c-[u] { color: #a67f59 } /* Literal.String.Double */
c-[cp] { color: #708090 } /* Comment.Preproc */
c-[c1] { color: #708090 } /* Comment.Single */
c-[cs] { color: #708090 } /* Comment.Special */
c-[kc] { color: #990055 } /* Keyword.Constant */
c-[kn] { color: #990055 } /* Keyword.Namespace */
c-[kp] { color: #990055 } /* Keyword.Pseudo */
c-[kr] { color: #990055 } /* Keyword.Reserved */
c-[ld] { color: #000000 } /* Literal.Date */
c-[nc] { color: #0077aa } /* Name.Class */
c-[no] { color: #0077aa } /* Name.Constant */
c-[nd] { color: #0077aa } /* Name.Decorator */
c-[ni] { color: #0077aa } /* Name.Entity */
c-[ne] { color: #0077aa } /* Name.Exception */
c-[nf] { color: #0077aa } /* Name.Function */
c-[nl] { color: #0077aa } /* Name.Label */
c-[nn] { color: #0077aa } /* Name.Namespace */
c-[py] { color: #0077aa } /* Name.Property */
c-[ow] { color: #999999 } /* Operator.Word */
c-[mb] { color: #000000 } /* Literal.Number.Bin */
c-[mf] { color: #000000 } /* Literal.Number.Float */
c-[mh] { color: #000000 } /* Literal.Number.Hex */
c-[mi] { color: #000000 } /* Literal.Number.Integer */
c-[mo] { color: #000000 } /* Literal.Number.Oct */
c-[sb] { color: #a67f59 } /* Literal.String.Backtick */
c-[sc] { color: #a67f59 } /* Literal.String.Char */
c-[sd] { color: #a67f59 } /* Literal.String.Doc */
c-[se] { color: #a67f59 } /* Literal.String.Escape */
c-[sh] { color: #a67f59 } /* Literal.String.Heredoc */
c-[si] { color: #a67f59 } /* Literal.String.Interpol */
c-[sx] { color: #a67f59 } /* Literal.String.Other */
c-[sr] { color: #a67f59 } /* Literal.String.Regex */
c-[ss] { color: #a67f59 } /* Literal.String.Symbol */
c-[vc] { color: #0077aa } /* Name.Variable.Class */
c-[vg] { color: #0077aa } /* Name.Variable.Global */
c-[vi] { color: #0077aa } /* Name.Variable.Instance */
c-[il] { color: #000000 } /* Literal.Number.Integer.Long */
</style>
<style>/* style-var-click-highlighting */

    var { cursor: pointer; }
    var.selected0 { background-color: #F4D200; box-shadow: 0 0 0 2px #F4D200; }
    var.selected1 { background-color: #FF87A2; box-shadow: 0 0 0 2px #FF87A2; }
    var.selected2 { background-color: #96E885; box-shadow: 0 0 0 2px #96E885; }
    var.selected3 { background-color: #3EEED2; box-shadow: 0 0 0 2px #3EEED2; }
    var.selected4 { background-color: #EACFB6; box-shadow: 0 0 0 2px #EACFB6; }
    var.selected5 { background-color: #82DDFF; box-shadow: 0 0 0 2px #82DDFF; }
    var.selected6 { background-color: #FFBCF2; box-shadow: 0 0 0 2px #FFBCF2; }
    </style>
<style>/* style-wpt */

:root {
    --wpt-border: hsl(0, 0%, 60%);
    --wpt-bg: hsl(0, 0%, 95%);
    --wpt-text: var(--text);
    --wptheading-text: hsl(0, 0%, 30%);
}
@media (prefers-color-scheme: dark) {
    :root {
        --wpt-border: hsl(0, 0%, 30%);
        --wpt-bg: var(--borderedblock-bg);
        --wpt-text: var(--text);
        --wptheading-text: hsl(0, 0%, 60%);
    }
}
.wpt-tests-block {
    list-style: none;
    border-left: .5em solid var(--wpt-border);
    background: var(--wpt-bg);
    color: var(--wpt-text);
    margin: 1em auto;
    padding: .5em;
}
.wpt-tests-block summary {
    color: var(--wptheading-text);
    font-weight: normal;
    text-transform: uppercase;
}
.wpt-tests-block summary::marker{
    color: var(--wpt-border);
}
.wpt-tests-block summary:hover::marker{
    color: var(--wpt-text);
}
/*
   The only content  of a wpt test block in its closed state is the <summary>,
   which contains the word TESTS,
   and that is absolutely positioned.
   In that closed state, wpt test blocks are styled
   to have a top margin whose height is exactly equal
   to the height of the absolutely positioned <summary>,
   and no other background/padding/margin/border.
   The wpt test block elements will therefore allow the maring
   of the previous/next block elements
   to collapse through them;
   if this combined margin would be larger than its own top margin,
   it stays as is,
   and therefore the pre-existing vertical rhythm of the document is undisturbed.
   If that combined margin would be smaller, it is grown to that size.
   This means that the wpt test block ensures
   that there's always enough vertical space to insert the summary,
   without adding more than is needed.
*/
.wpt-tests-block:not([open]){
    padding: 0;
    border: none;
    background: none;
    font-size: 0.75em;
    line-height: 1;
    position: relative;
    margin: 1em 0 0;
}
.wpt-tests-block:not([open]) summary {
    position: absolute;
    right: 0;
    bottom: 0;
}
/*
   It is possible that both the last child of a block element
   and the block element itself
   would be annotated with a <wpt> block each.
   If the block element has a padding or a border,
   that's fine, but otherwise
   the bottom margin of the block and of its last child would collapse
   and both <wpt> elements would overlap, being both placed there.
   To avoid that, add 1px of padding to the <wpt> element annotating the last child
   to prevent the bottom margin of the block and of its last child from collapsing
   (and as much negative margin,
   as wel only want to prevent margin collapsing,
   but are not trying to actually take more space).
*/
.wpt-tests-block:not([open]):last-child {
    padding-bottom: 1px;
    margin-bottom: -1px;
}
/*
   Exception to the previous rule:
   don't do that in non-last list items,
   because it's not necessary,
   and would therefore consume more space than strictly needed.
   Lists must have list items as children, not <wpt> elements,
   so a <wpt> element cannot be a sibling of a list item,
   and the collision that the previous rule avoids cannot happen.
*/
li:not(:last-child) > .wpt-tests-block:not([open]):last-child,
dd:not(:last-child) > .wpt-tests-block:not([open]):last-child {
    padding-bottom: 0;
    margin-bottom: 0;
}
.wpt-tests-block:not([open]):not(:hover){
    opacity: 0.5;
}
.wpt-tests-list {
    list-style: none;
    display: grid;
    margin: 0;
    padding: 0;
    grid-template-columns: 1fr max-content auto auto;
    grid-column-gap: .5em;
}
.wpt-tests-block hr:last-child {
    display: none;
}
.wpt-test {
    display: contents;
}
.wpt-test > a {
    text-decoration: underline;
    border: none;
}
.wpt-test > .wpt-name { grid-column: 1; }
.wpt-test > .wpt-results { grid-column: 2; }
.wpt-test > .wpt-live { grid-column: 3; }
.wpt-test > .wpt-source { grid-column: 4; }

.wpt-test > .wpt-results {
    display: flex;
    gap: .1em;
}
.wpt-test .wpt-result {
    display: inline-block;
    height: 1em;
    width: 1em;
    border-radius: 50%;
    position: relative;
}
</style>
<style>/* style-darkmode */

@media (prefers-color-scheme: dark) {
    :root {
        --text: #ddd;
        --bg: black;

        --unofficial-watermark: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='400'%3E%3Cg fill='%23100808' transform='translate(200 200) rotate(-45) translate(-200 -200)' stroke='%23100808' stroke-width='3'%3E%3Ctext x='50%25' y='220' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EUNOFFICIAL%3C/text%3E%3Ctext x='50%25' y='305' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EDRAFT%3C/text%3E%3C/g%3E%3C/svg%3E");

        --logo-bg: #1a5e9a;
        --logo-active-bg: #c00;
        --logo-text: white;

        --tocnav-normal-text: #999;
        --tocnav-normal-bg: var(--bg);
        --tocnav-hover-text: var(--tocnav-normal-text);
        --tocnav-hover-bg: #080808;
        --tocnav-active-text: #f44;
        --tocnav-active-bg: var(--tocnav-normal-bg);

        --tocsidebar-text: var(--text);
        --tocsidebar-bg: #080808;
        --tocsidebar-shadow: rgba(255,255,255,.1);
        --tocsidebar-heading-text: hsla(203,20%,40%,.7);

        --toclink-text: var(--text);
        --toclink-underline: #6af;
        --toclink-visited-text: var(--toclink-text);
        --toclink-visited-underline: #054572;

        --heading-text: #8af;

        --hr-text: var(--text);

        --algo-border: #456;

        --del-text: #f44;
        --del-bg: transparent;
        --ins-text: #4a4;
        --ins-bg: transparent;

        --a-normal-text: #6af;
        --a-normal-underline: #555;
        --a-visited-text: var(--a-normal-text);
        --a-visited-underline: var(--a-normal-underline);
        --a-hover-bg: rgba(25%, 25%, 25%, .2);
        --a-active-text: #f44;
        --a-active-underline: var(--a-active-text);

        --borderedblock-bg: rgba(255, 255, 255, .05);

        --blockquote-border: silver;
        --blockquote-bg: var(--borderedblock-bg);
        --blockquote-text: currentcolor;

        --issue-border: #e05252;
        --issue-bg: var(--borderedblock-bg);
        --issue-text: var(--text);
        --issueheading-text: hsl(0deg, 70%, 70%);

        --example-border: hsl(50deg, 90%, 60%);
        --example-bg: var(--borderedblock-bg);
        --example-text: var(--text);
        --exampleheading-text: hsl(50deg, 70%, 70%);

        --note-border: hsl(120deg, 100%, 35%);
        --note-bg: var(--borderedblock-bg);
        --note-text: var(--text);
        --noteheading-text: hsl(120, 70%, 70%);
        --notesummary-underline: silver;

        --assertion-border: #444;
        --assertion-bg: var(--borderedblock-bg);
        --assertion-text: var(--text);

        --advisement-border: orange;
        --advisement-bg: #222218;
        --advisement-text: var(--text);
        --advisementheading-text: #f84;

        --warning-border: red;
        --warning-bg: hsla(40,100%,20%,0.95);
        --warning-text: var(--text);

        --amendment-border: #330099;
        --amendment-bg: #080010;
        --amendment-text: var(--text);
        --amendmentheading-text: #cc00ff;

        --def-border: #8ccbf2;
        --def-bg: #080818;
        --def-text: var(--text);
        --defrow-border: #136;

        --datacell-border: silver;

        --indexinfo-text: #aaa;

        --indextable-hover-text: var(--text);
        --indextable-hover-bg: #181818;

        --outdatedspec-bg: rgba(255, 255, 255, .5);
        --outdatedspec-text: black;
        --outdated-bg: maroon;
        --outdated-text: white;
        --outdated-shadow: red;

        --editedrec-bg: darkorange;
    }
    /* In case a transparent-bg image doesn't expect to be on a dark bg,
       which is quite common in practice... */
    img { background: white; }
}
@media (prefers-color-scheme: dark) {
    :root {
        --selflink-text: black;
        --selflink-bg: silver;
        --selflink-hover-text: white;
    }
}

@media (prefers-color-scheme: dark) {
    :root {
        --dfnpanel-bg: #222;
        --dfnpanel-text: var(--text);
    }
}
@media (prefers-color-scheme: dark) {
    .highlight:not(.idl) { background: rgba(255, 255, 255, .05); }

    c-[a] { color: #d33682 } /* Keyword.Declaration */
    c-[b] { color: #d33682 } /* Keyword.Type */
    c-[c] { color: #2aa198 } /* Comment */
    c-[d] { color: #2aa198 } /* Comment.Multiline */
    c-[e] { color: #268bd2 } /* Name.Attribute */
    c-[f] { color: #b58900 } /* Name.Tag */
    c-[g] { color: #cb4b16 } /* Name.Variable */
    c-[k] { color: #d33682 } /* Keyword */
    c-[l] { color: #657b83 } /* Literal */
    c-[m] { color: #657b83 } /* Literal.Number */
    c-[n] { color: #268bd2 } /* Name */
    c-[o] { color: #657b83 } /* Operator */
    c-[p] { color: #657b83 } /* Punctuation */
    c-[s] { color: #6c71c4 } /* Literal.String */
    c-[t] { color: #6c71c4 } /* Literal.String.Single */
    c-[u] { color: #6c71c4 } /* Literal.String.Double */
    c-[ch] { color: #2aa198 } /* Comment.Hashbang */
    c-[cp] { color: #2aa198 } /* Comment.Preproc */
    c-[cpf] { color: #2aa198 } /* Comment.PreprocFile */
    c-[c1] { color: #2aa198 } /* Comment.Single */
    c-[cs] { color: #2aa198 } /* Comment.Special */
    c-[kc] { color: #d33682 } /* Keyword.Constant */
    c-[kn] { color: #d33682 } /* Keyword.Namespace */
    c-[kp] { color: #d33682 } /* Keyword.Pseudo */
    c-[kr] { color: #d33682 } /* Keyword.Reserved */
    c-[ld] { color: #657b83 } /* Literal.Date */
    c-[nc] { color: #268bd2 } /* Name.Class */
    c-[no] { color: #268bd2 } /* Name.Constant */
    c-[nd] { color: #268bd2 } /* Name.Decorator */
    c-[ni] { color: #268bd2 } /* Name.Entity */
    c-[ne] { color: #268bd2 } /* Name.Exception */
    c-[nf] { color: #268bd2 } /* Name.Function */
    c-[nl] { color: #268bd2 } /* Name.Label */
    c-[nn] { color: #268bd2 } /* Name.Namespace */
    c-[py] { color: #268bd2 } /* Name.Property */
    c-[ow] { color: #657b83 } /* Operator.Word */
    c-[mb] { color: #657b83 } /* Literal.Number.Bin */
    c-[mf] { color: #657b83 } /* Literal.Number.Float */
    c-[mh] { color: #657b83 } /* Literal.Number.Hex */
    c-[mi] { color: #657b83 } /* Literal.Number.Integer */
    c-[mo] { color: #657b83 } /* Literal.Number.Oct */
    c-[sa] { color: #6c71c4 } /* Literal.String.Affix */
    c-[sb] { color: #6c71c4 } /* Literal.String.Backtick */
    c-[sc] { color: #6c71c4 } /* Literal.String.Char */
    c-[dl] { color: #6c71c4 } /* Literal.String.Delimiter */
    c-[sd] { color: #6c71c4 } /* Literal.String.Doc */
    c-[se] { color: #6c71c4 } /* Literal.String.Escape */
    c-[sh] { color: #6c71c4 } /* Literal.String.Heredoc */
    c-[si] { color: #6c71c4 } /* Literal.String.Interpol */
    c-[sx] { color: #6c71c4 } /* Literal.String.Other */
    c-[sr] { color: #6c71c4 } /* Literal.String.Regex */
    c-[ss] { color: #6c71c4 } /* Literal.String.Symbol */
    c-[fm] { color: #268bd2 } /* Name.Function.Magic */
    c-[vc] { color: #cb4b16 } /* Name.Variable.Class */
    c-[vg] { color: #cb4b16 } /* Name.Variable.Global */
    c-[vi] { color: #cb4b16 } /* Name.Variable.Instance */
    c-[vm] { color: #cb4b16 } /* Name.Variable.Magic */
    c-[il] { color: #657b83 } /* Literal.Number.Integer.Long */
}
</style>
 <body class="h-entry">
  <div class="head">
   <p data-fill-with="logo"><a class="logo" href="https://www.w3.org/"> <img alt="W3C" height="48" src="https://www.w3.org/StyleSheets/TR/2016/logos/W3C" width="72"> </a> </p>
   <h1 class="p-name no-ref" id="title">Portals</h1>
   <h2 class="no-num no-toc no-ref heading settled" id="profile-and-date"><span class="content">Draft Community Group Report, <time class="dt-updated" datetime="1970-01-01">1 January 1970</time></span></h2>
   <div data-fill-with="spec-metadata">
    <dl>
     <dt>This version:
     <dd><a class="u-url" href="https://wicg.github.io/portals/">https://wicg.github.io/portals/</a>
     <dt class="editor">Editors:
     <dd class="editor p-author h-card vcard"><a class="p-name fn u-email email" href="mailto:jbroman@chromium.org">Jeremy Roman</a> (<span class="p-org org">Google</span>)
     <dd class="editor p-author h-card vcard"><a class="p-name fn u-email email" href="mailto:lfg@chromium.org">Lucas Gadani</a> (<span class="p-org org">Google</span>)
    </dl>
   </div>
   <div data-fill-with="warning"></div>
   <p class="copyright" data-fill-with="copyright"><a href="http://www.w3.org/Consortium/Legal/ipr-notice#Copyright">Copyright</a> © 1970 the Contributors to the Portals Specification, published by the <a href="https://www.w3.org/community/wicg/">Web Platform Incubator Community Group</a> under the <a href="https://www.w3.org/community/about/agreements/cla/">W3C Community Contributor License Agreement (CLA)</a>.
A human-readable <a href="http://www.w3.org/community/about/agreements/cla-deed/">summary</a> is available. </p>
   <hr title="Separator for header">
  </div>
  <div class="p-summary" data-fill-with="abstract">
   <h2 class="no-num no-toc no-ref heading settled" id="abstract"><span class="content">Abstract</span></h2>
   <p>This specification defines a mechanism that allows for rendering of, and seamless navigation to, embedded content.</p>
  </div>
  <div data-fill-with="at-risk"></div>
  <h2 class="no-num no-toc no-ref heading settled" id="status"><span class="content">Status of this document</span></h2>
  <div data-fill-with="status">
   <p> This specification was published by the <a href="https://www.w3.org/community/wicg/">Web Platform Incubator Community Group</a>.
  It is not a W3C Standard nor is it on the W3C Standards Track.

  Please note that under the <a href="https://www.w3.org/community/about/agreements/cla/">W3C Community Contributor License Agreement (CLA)</a> there is a limited opt-out and other conditions apply.

  Learn more about <a href="http://www.w3.org/community/">W3C Community and Business Groups</a>. </p>
   <p></p>
  </div>
  <div data-fill-with="at-risk"></div>
  <nav data-fill-with="table-of-contents" id="toc">
   <h2 class="no-num no-toc no-ref" id="contents">Table of Contents</h2>
   <ol class="toc" role="directory">
    <li><a href="#intro"><span class="secno">1</span> <span class="content">Introduction</span></a>
    <li><a href="#concepts"><span class="secno">2</span> <span class="content">Portal browsing contexts</span></a>
    <li>
     <a href="#the-portal-element"><span class="secno">3</span> <span class="content">The <code>portal</code> element</span></a>
     <ol class="toc">
      <li><a href="#the-portalhost-interface"><span class="secno">3.1</span> <span class="content">Portal hosts</span></a>
      <li><a href="#the-portalactivateevent-interface"><span class="secno">3.2</span> <span class="content">The <code>PortalActivateEvent</code> interface</span></a>
     </ol>
    <li>
     <a href="#miscellaneous-extensions"><span class="secno">4</span> <span class="content">Miscellaneous HTML updates</span></a>
     <ol class="toc">
      <li><a href="#patch-messageevent"><span class="secno">4.1</span> <span class="content">The <code class="idl"><span>MessageEvent</span></code> interface</span></a>
      <li><a href="#patch-event-handlers"><span class="secno">4.2</span> <span class="content">Event handlers</span></a>
      <li><a href="#patch-window-apis"><span class="secno">4.3</span> <span class="content">APIs for creating and navigating browsing contexts by name</span></a>
      <li><a href="#patch-navigation"><span class="secno">4.4</span> <span class="content">Navigation</span></a>
      <li><a href="#patch-downloading"><span class="secno">4.5</span> <span class="content">Downloading resources</span></a>
     </ol>
    <li>
     <a href="#other-spec-updates"><span class="secno">5</span> <span class="content">Updates to other specifications</span></a>
     <ol class="toc">
      <li>
       <a href="#csp"><span class="secno">5.1</span> <span class="content">Content Security Policy</span></a>
       <ol class="toc">
        <li>
         <a href="#portal-src-directive"><span class="secno">5.1.1</span> <span class="content"><code>portal-src</code></span></a>
         <ol class="toc">
          <li><a href="#portal-src-pre-request"><span class="secno">5.1.1.1</span> <span class="content"><code>portal-src</code> Pre-request check</span></a>
          <li><a href="#portal-src-post-request"><span class="secno">5.1.1.2</span> <span class="content"><code>portal-src</code> Post-request check</span></a>
         </ol>
        <li><a href="#default-src-patch"><span class="secno">5.1.2</span> <span class="content"><code>default-src</code></span></a>
        <li><a href="#directive-fallback-list-patch"><span class="secno">5.1.3</span> <span class="content">Get fetch directive fallback list</span></a>
       </ol>
      <li><a href="#fetch-metadata"><span class="secno">5.2</span> <span class="content">Fetch Metadata Request Headers</span></a>
     </ol>
    <li>
     <a href="#security-considerations"><span class="secno">6</span> <span class="content">Security Considerations</span></a>
     <ol class="toc">
      <li><a href="#security-overview"><span class="secno">6.1</span> <span class="content">Overview</span></a>
     </ol>
    <li><a href="#untriaged-tests"><span class="secno">7</span> <span class="content">Untriaged tests</span></a>
    <li>
     <a href="#w3c-conformance"><span class="secno"></span> <span class="content">Conformance</span></a>
     <ol class="toc">
      <li><a href="#w3c-conventions"><span class="secno"></span> <span class="content">Document conventions</span></a>
      <li><a href="#w3c-conformant-algorithms"><span class="secno"></span> <span class="content">Conformant Algorithms</span></a>
     </ol>
    <li>
     <a href="#index"><span class="secno"></span> <span class="content">Index</span></a>
     <ol class="toc">
      <li><a href="#index-defined-here"><span class="secno"></span> <span class="content">Terms defined by this specification</span></a>
      <li><a href="#index-defined-elsewhere"><span class="secno"></span> <span class="content">Terms defined by reference</span></a>
     </ol>
    <li>
     <a href="#references"><span class="secno"></span> <span class="content">References</span></a>
     <ol class="toc">
      <li><a href="#normative"><span class="secno"></span> <span class="content">Normative References</span></a>
      <li><a href="#informative"><span class="secno"></span> <span class="content">Informative References</span></a>
     </ol>
    <li><a href="#idl-index"><span class="secno"></span> <span class="content">IDL Index</span></a>
    <li><a href="#issues-index"><span class="secno"></span> <span class="content">Issues Index</span></a>
   </ol>
  </nav>
  <main>
   <details class="annoying-warning">
    <summary>This spec is behind the explainer</summary>
    <p>This specification document has not yet been updated to reflect the 2020-04 updates to <a href="https://github.com/WICG/portals#readme">the explainer</a>. We’ll fix that as soon as we
  can, but please be aware that there are probably contradictions, and the explainer should be taken
  as more authoritative for the time being.</p>
   </details>
   <section class="non-normative">
    <h2 class="heading settled" data-level="1" id="intro"><span class="secno">1. </span><span class="content">Introduction</span><a class="self-link" href="#intro"></a></h2>
    <p><em>This section is non-normative.</em></p>
    <p>This specification extends <a data-link-type="biblio" href="#biblio-html">[HTML]</a> to define a new kind of <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#top-level-browsing-context" id="ref-for-top-level-browsing-context">top-level browsing context</a>,
  which can be embedded in another document, and a mechanism for replacing the contents of another
  top-level browsing context with the previously embedded context.</p>
    <p>It is structured as a series of patches to HTML and other specifications, with each major section
  indicating where each it would be placed in the event of eventual graduation from incubation.</p>
    <p>See also the <a href="https://github.com/WICG/portals">explainer</a> for more background and
  motivation.</p>
   </section>
   <section>
    <h2 class="heading settled" data-level="2" id="concepts"><span class="secno">2. </span><span class="content">Portal browsing contexts</span><a class="self-link" href="#concepts"></a></h2>
    <p><em>The following section would be added as a new sub-section of <a data-link-type="biblio" href="#biblio-html">[HTML]</a>'s <a href="https://html.spec.whatwg.org/#windows">Browsing contexts</a> section.</em></p>
    <p>Every <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#browsing-context" id="ref-for-browsing-context">browsing context</a> has a <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="portal-state">portal state</dfn>, which may be "<code>none</code>" (the default), "<code>portal</code>" or "<code>orphaned</code>".
  A <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#nested-browsing-context" id="ref-for-nested-browsing-context">nested browsing context</a> always has the <a data-link-type="dfn" href="#portal-state" id="ref-for-portal-state">portal state</a> "<code>none</code>".</p>
    <div class="note" role="note">
      Briefly, these correspond to: 
     <ul>
      <li data-md>
       <p>"<code>portal</code>": top-level browsing contexts embedded in a <code><a data-link-type="element" href="#elementdef-portal" id="ref-for-elementdef-portal">portal</a></code> element</p>
      <li data-md>
       <p>"<code>orphaned</code>": top-level browsing contexts which have run <code class="idl"><a data-link-type="idl" href="#dom-htmlportalelement-activate" id="ref-for-dom-htmlportalelement-activate">activate</a></code> but have not (yet) been <a data-link-type="dfn" href="#adopt-the-predecessor-browsing-context" id="ref-for-adopt-the-predecessor-browsing-context">adopted</a></p>
      <li data-md>
       <p>"<code>none</code>": all other browsing contexts</p>
     </ul>
     <p><img alt="Diagram of portal state transitions" src="portals-state-transitions.svg" style="width: 100%"></p>
     <p>A top-level "<code>none</code>" context can become "<code>orphaned</code>" by <a data-link-type="dfn" href="#activate-a-portal-browsing-context" id="ref-for-activate-a-portal-browsing-context">activating</a> another context. An "<code>orphaned</code>" context can be <a data-link-type="dfn" href="#adopt-the-predecessor-browsing-context" id="ref-for-adopt-the-predecessor-browsing-context①">adopted</a> to
    become a "<code>portal</code>" context. A "<code>portal</code>" context can become a "<code>none</code>" context by being <a data-link-type="dfn" href="#activate-a-portal-browsing-context" id="ref-for-activate-a-portal-browsing-context①">activated</a> by its <a data-link-type="dfn" href="#host-browsing-context" id="ref-for-host-browsing-context">host browsing context</a>.</p>
     <p>A browsing context can be <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/window-object.html#close-a-browsing-context" id="ref-for-close-a-browsing-context">closed</a> while in any of these states.</p>
    </div>
    <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="portal-browsing-context">portal browsing context</dfn> is a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#browsing-context" id="ref-for-browsing-context①">browsing context</a> whose <a data-link-type="dfn" href="#portal-state" id="ref-for-portal-state①">portal state</a> is "<code>portal</code>".</p>
    <p>The <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="host-element">host element</dfn> of a <a data-link-type="dfn" href="#portal-browsing-context" id="ref-for-portal-browsing-context">portal browsing context</a> is a <code><a data-link-type="element" href="#elementdef-portal" id="ref-for-elementdef-portal①">portal</a></code> element which embeds its rendered output and receives messages sent from the
  portal browsing context.</p>
    <div class="note" role="note"> A <code><a data-link-type="element" href="#elementdef-portal" id="ref-for-elementdef-portal②">portal</a></code> element may only be a <a data-link-type="dfn" href="#host-element" id="ref-for-host-element">host element</a> while it is <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#browsing-context-connected" id="ref-for-browsing-context-connected">browsing-context connected</a> or during the dispatch of the <code class="idl"><a class="idl-code" data-link-type="event" href="#eventdef-window-portalactivate" id="ref-for-eventdef-window-portalactivate">portalactivate</a></code> event from which it was obtained
    using <code class="idl"><a data-link-type="idl" href="#dom-portalactivateevent-adoptpredecessor" id="ref-for-dom-portalactivateevent-adoptpredecessor">adoptPredecessor()</a></code>. </div>
    <p>The <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="host-browsing-context">host browsing context</dfn> of a <a data-link-type="dfn" href="#portal-browsing-context" id="ref-for-portal-browsing-context①">portal browsing context</a> is its <a data-link-type="dfn" href="#host-element" id="ref-for-host-element①">host element</a>'s <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-node-document" id="ref-for-concept-node-document">node document</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#browsing-context" id="ref-for-browsing-context②">browsing context</a>.</p>
    <p>The <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="portal-task-source">portal task source</dfn> is a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#task-source" id="ref-for-task-source">task source</a> used for tasks related to the
  portal lifecycle and communication between a <a data-link-type="dfn" href="#portal-browsing-context" id="ref-for-portal-browsing-context②">portal browsing context</a> and its <a data-link-type="dfn" href="#host-browsing-context" id="ref-for-host-browsing-context①">host browsing context</a>.</p>
    <section class="algorithm" data-algorithm="portal-browsing-context-activate">
      To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="activate-a-portal-browsing-context">activate a portal browsing context</dfn> <var>successorBrowsingContext</var> in
    place of <var>predecessorBrowsingContext</var> with <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/origin.html#concept-origin" id="ref-for-concept-origin">origin</a> <var>sourceOrigin</var>, optional data <var>serializeWithTransferResult</var>, and optional promise <var>promise</var>, run the following steps <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel" id="ref-for-in-parallel">in parallel</a>: 
     <ol>
      <li data-md>
       <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#assert" id="ref-for-assert">Assert</a>: The <a data-link-type="dfn" href="#portal-state" id="ref-for-portal-state②">portal state</a> of <var>predecessorBrowsingContext</var> is "<code>none</code>".</p>
      <li data-md>
       <p>If <var>successorBrowsingContext</var>’s only entry in its <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/history.html#session-history" id="ref-for-session-history">session history</a> is the initial <code>about:blank</code> <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#document" id="ref-for-document">Document</a></code>, then wait until either this is no longer true, or <var>successorBrowsingContext</var>’s <a data-link-type="dfn" href="#host-element" id="ref-for-host-element②">host element</a> becomes null.</p>
       <p class="note" role="note">This means that the initial load is still happening in <var>successorBrowsingContext</var>. We wait for it to complete, either successfully or
unsuccessfully, before continuing.</p>
      <li data-md>
       <p>If <var>successorBrowsingContext</var>’s <a data-link-type="dfn" href="#host-element" id="ref-for-host-element③">host element</a> is null, then:</p>
       <ol>
        <li data-md>
         <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task" id="ref-for-queue-a-global-task">Queue a global task</a> on the <a data-link-type="dfn" href="#portal-task-source" id="ref-for-portal-task-source">portal task source</a> given <var>predecessorBrowsingContext</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#active-window" id="ref-for-active-window">active window</a> to <a data-link-type="dfn" href="https://heycam.github.io/webidl/#reject" id="ref-for-reject">reject</a> <var>promise</var> with an "<code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#invalidstateerror" id="ref-for-invalidstateerror">InvalidStateError</a></code>" <code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#idl-DOMException" id="ref-for-idl-DOMException">DOMException</a></code>.</p>
        <li data-md>
         <p>Return.</p>
       </ol>
      <li data-md>
       <p>Set the <a data-link-type="dfn" href="#host-element" id="ref-for-host-element④">host element</a> of <var>successorBrowsingContext</var> to null.</p>
       <p>User agents <em>should</em>, however, attempt to preserve the rendering of the
guest browsing context until <var>predecessorBrowsingContext</var> has been replaced
with <var>successorBrowsingContext</var> in the rendering.</p>
       <p class="note" role="note"><span>Note:</span> This is intended to avoid a visual glitch, such as a "white flash", where
the guest browsing context briefly disappears.</p>
      <li data-md>
       <p>Set the <a data-link-type="dfn" href="#portal-state" id="ref-for-portal-state③">portal state</a> of <var>predecessorBrowsingContext</var> to "<code>orphaned</code>".</p>
      <li data-md>
       <p>Update the user interface to replace <var>predecessorBrowsingContext</var> with <var>successorBrowsingContext</var> (e.g., by updating the tab/window contents and browser chrome).</p>
      <li data-md>
       <p>Let <var>successorWindow</var> be <var>successorBrowsingContext</var>’s associated <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/window-object.html#windowproxy" id="ref-for-windowproxy">WindowProxy</a></code>'s [[Window]] internal slot value.</p>
      <li data-md>
       <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task" id="ref-for-queue-a-global-task①">Queue a global task</a> on the <a data-link-type="dfn" href="#portal-task-source" id="ref-for-portal-task-source①">portal task source</a> given <var>successorWindow</var> to run the
following steps:</p>
       <ol>
        <li data-md>
         <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#assert" id="ref-for-assert①">Assert</a>: The <a data-link-type="dfn" href="#portal-state" id="ref-for-portal-state④">portal state</a> of <var>successorBrowsingContext</var> is "<code>portal</code>".</p>
        <li data-md>
         <p>Set the <a data-link-type="dfn" href="#portal-state" id="ref-for-portal-state⑤">portal state</a> of <var>successorBrowsingContext</var> to "<code>none</code>".</p>
        <li data-md>
         <p>Let <var>targetRealm</var> be <var>successorWindow</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-global-object-realm" id="ref-for-concept-global-object-realm">realm</a>.</p>
        <li data-md>
         <p>Let <var>dataClone</var> be null.</p>
        <li data-md>
         <p>If <var>serializeWithTransferResult</var> is given and <var>successorBrowsingContext</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#active-document" id="ref-for-active-document">active document</a>'s <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-document-origin" id="ref-for-concept-document-origin">origin</a> is <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/origin.html#same-origin" id="ref-for-same-origin">same origin</a> with <var>sourceOrigin</var>, then:</p>
         <ol>
          <li data-md>
           <p>Let <var>deserializeRecord</var> be <a data-link-type="abstract-op" href="https://html.spec.whatwg.org/multipage/structured-data.html#structureddeserializewithtransfer" id="ref-for-structureddeserializewithtransfer">StructuredDeserializeWithTransfer</a>(<var>serializeWithTransferResult</var>, <var>targetRealm</var>),
and set <var>dataClone</var> to <var>deserializeRecord</var>.[[Deserialized]].</p>
           <p>If this throws an exception, catch it and do nothing.</p>
         </ol>
        <li data-md>
         <p>Let <var>event</var> be the result of <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-event-create" id="ref-for-concept-event-create">creating an event</a> using <code class="idl"><a data-link-type="idl" href="#portalactivateevent" id="ref-for-portalactivateevent">PortalActivateEvent</a></code> and <var>targetRealm</var>.</p>
        <li data-md>
         <p>Initialize <var>event</var>’s <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#dom-event-type" id="ref-for-dom-event-type">type</a></code> attribute to <code class="idl"><a class="idl-code" data-link-type="event" href="#eventdef-window-portalactivate" id="ref-for-eventdef-window-portalactivate①">portalactivate</a></code>.</p>
        <li data-md>
         <p>Initialize <var>event</var>’s <code class="idl"><a data-link-type="idl" href="#dom-portalactivateevent-data" id="ref-for-dom-portalactivateevent-data">data</a></code> attribute to <var>dataClone</var>.</p>
        <li data-md>
         <p>Set <var>event</var>’s <a data-link-type="dfn" href="#portalactivateevent-predecessor-browsing-context" id="ref-for-portalactivateevent-predecessor-browsing-context">predecessor browsing context</a> to <var>predecessorBrowsingContext</var>.</p>
        <li data-md>
         <p>Set <var>event</var>’s <a data-link-type="dfn" href="#portalactivateevent-successor-window" id="ref-for-portalactivateevent-successor-window">successor window</a> to <var>successorWindow</var>.</p>
        <li data-md>
         <p>Set <var>event</var>’s <a data-link-type="dfn" href="#portalactivateevent-activation-promise" id="ref-for-portalactivateevent-activation-promise">activation promise</a> to <var>promise</var>, if it is given, and null otherwise.</p>
        <li data-md>
         <p><a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-event-dispatch" id="ref-for-concept-event-dispatch">Dispatch</a> <var>event</var> to <var>successorWindow</var>.</p>
        <li data-md>
         <p>Let <var>adoptedPredecessorElement</var> be <var>event</var>’s <a data-link-type="dfn" href="#portalactivateevent-adopted-predecessor-element" id="ref-for-portalactivateevent-adopted-predecessor-element">adopted predecessor element</a>.</p>
        <li data-md>
         <p>If <var>adoptedPredecessorElement</var> is not null, then:</p>
         <ol>
          <li data-md>
           <p>Set <var>adoptedPredecessorElement</var>’s <a data-link-type="dfn" href="#htmlportalelement-just-adopted-flag" id="ref-for-htmlportalelement-just-adopted-flag">just-adopted flag</a> to false.</p>
          <li data-md>
           <p>If <var>adoptedPredecessorElement</var> <a data-link-type="dfn" href="#may-have-a-guest-browsing-context" id="ref-for-may-have-a-guest-browsing-context">may not have a guest browsing context</a> and
its <a data-link-type="dfn" href="#htmlportalelement-guest-browsing-context" id="ref-for-htmlportalelement-guest-browsing-context">guest browsing context</a> is not null, then <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/window-object.html#a-browsing-context-is-discarded" id="ref-for-a-browsing-context-is-discarded">discard</a> it.</p>
           <div class="note" role="note">
             This unceremoniously <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/window-object.html#a-browsing-context-is-discarded" id="ref-for-a-browsing-context-is-discarded①">discards</a> the browsing context, as if the element had been removed from
  the document after previously being attached. This is
  distinct from the case where the predecessor was never
  adopted, below, which <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/window-object.html#close-a-browsing-context" id="ref-for-close-a-browsing-context①">closes</a> the
  browsing context. Closing <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#unload-a-document" id="ref-for-unload-a-document">unloads</a> the predecessor’s
  document, somewhat similarly to if it had performed an ordinary
  navigation. 
            <p>Typically authors would not call <code class="idl"><a data-link-type="idl" href="#dom-portalactivateevent-adoptpredecessor" id="ref-for-dom-portalactivateevent-adoptpredecessor①">adoptPredecessor()</a></code> unless they intend
  to insert it into the document before the <a data-link-type="dfn" href="#htmlportalelement-just-adopted-flag" id="ref-for-htmlportalelement-just-adopted-flag①">just-adopted flag</a> becomes false.</p>
           </div>
         </ol>
        <li data-md>
         <p>Otherwise:</p>
         <ol>
          <li data-md>
           <p>If <var>promise</var> is given, <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task" id="ref-for-queue-a-global-task②">queue a global task</a> on the <a data-link-type="dfn" href="#portal-task-source" id="ref-for-portal-task-source②">portal task source</a> given <var>predecessorBrowsingContext</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#active-window" id="ref-for-active-window①">active window</a> to resolve <var>promise</var> with undefined.</p>
          <li data-md>
           <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/window-object.html#close-a-browsing-context" id="ref-for-close-a-browsing-context②">Close</a> <var>predecessorBrowsingContext</var>.</p>
           <p>The user agent <em>should not</em> ask the user for confirmation during the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#prompt-to-unload-a-document" id="ref-for-prompt-to-unload-a-document">prompt to unload</a> step (and so the browsing context should be <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/window-object.html#a-browsing-context-is-discarded" id="ref-for-a-browsing-context-is-discarded②">discarded</a>).</p>
           <div class="note" role="note"> Authors should not expect the <code class="idl"><a class="idl-code" data-link-type="event" href="https://html.spec.whatwg.org/multipage/indices.html#event-unload" id="ref-for-event-unload">unload</a></code> event
  to be dispatched consistently following portal activation. In
  addition to adoption of the predecessor, where the predecessor
  would not be <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#unload-a-document" id="ref-for-unload-a-document①">unloaded</a> at all, the predecessor could
  also enter bfcache (back forward cache) where the unload event
  would not be dispatched. </div>
           <div class="issue" id="issue-c722a2b5"><a class="self-link" href="#issue-c722a2b5"></a> Determine how to treat unload/beforeunload handlers. See <a href="https://github.com/WICG/portals/issues/225">issue #225</a> for discussion. </div>
         </ol>
       </ol>
     </ol>
    </section>
    <details class="wpt-tests-block" dir="ltr" lang="en" open>
     <summary>Tests</summary>
     <ul class="wpt-tests-list">
      <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/portals/portal-activate-event.html" title="portals/portal-activate-event.html">portal-activate-event.html</a> <a class="wpt-live" href="http://wpt.live/portals/portal-activate-event.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/portals/portal-activate-event.html"><small>(source)</small></a>
      <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/portals/portals-host-hidden-after-activation.html" title="portals/portals-host-hidden-after-activation.html">portals-host-hidden-after-activation.html</a> <a class="wpt-live" href="http://wpt.live/portals/portals-host-hidden-after-activation.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/portals/portals-host-hidden-after-activation.html"><small>(source)</small></a>
     </ul>
    </details>
    <div class="issue" id="issue-b49e4903"><a class="self-link" href="#issue-b49e4903"></a> In the case that structured deserialization throws, it may be useful to do something else to indicate it,
    rather than simply providing null data. </div>
    <div class="issue" id="issue-0d72b101"><a class="self-link" href="#issue-0d72b101"></a> We need to specify how the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/history.html#session-history" id="ref-for-session-history①">session history</a> of each browsing context is
    affected by activation, and supply non-normative text that explains how
    these histories are expected to be presented to the user. </div>
    <section class="algorithm" data-algorithm="portal-browsing-context-adopt-predecessor">
      To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="adopt-the-predecessor-browsing-context">adopt the predecessor browsing context</dfn> <var>predecessorBrowsingContext</var> in <var>successorWindow</var>, run the following steps: 
     <ol>
      <li data-md>
       <p>Let <var>document</var> be the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/window-object.html#concept-document-window" id="ref-for-concept-document-window">document</a> of <var>successorWindow</var>.</p>
      <li data-md>
       <p>Let <var>portalElement</var> be the result of <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-create-element" id="ref-for-concept-create-element">creating an element</a> given <var>document</var>, <code>portal</code>, and the <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#html-namespace" id="ref-for-html-namespace">HTML namespace</a>.</p>
      <li data-md>
       <p>Set <var>portalElement</var>’s <a data-link-type="dfn" href="#htmlportalelement-just-adopted-flag" id="ref-for-htmlportalelement-just-adopted-flag②">just-adopted flag</a> to true.</p>
      <li data-md>
       <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#assert" id="ref-for-assert②">Assert</a>: <var>portalElement</var> is an <code class="idl"><a data-link-type="idl" href="#htmlportalelement" id="ref-for-htmlportalelement">HTMLPortalElement</a></code>.</p>
      <li data-md>
       <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task" id="ref-for-queue-a-global-task③">Queue a global task</a> on the <a data-link-type="dfn" href="#portal-task-source" id="ref-for-portal-task-source③">portal task source</a> given <var>predecessorBrowsingContext</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#active-window" id="ref-for-active-window②">active window</a> to run the following steps:</p>
       <ol>
        <li data-md>
         <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#assert" id="ref-for-assert③">Assert</a>: The <a data-link-type="dfn" href="#portal-state" id="ref-for-portal-state⑥">portal state</a> of <var>predecessorBrowsingContext</var> is "<code>orphaned</code>".</p>
        <li data-md>
         <p>Set the <a data-link-type="dfn" href="#portal-state" id="ref-for-portal-state⑦">portal state</a> of <var>predecessorBrowsingContext</var> to "<code>portal</code>", and
set the <a data-link-type="dfn" href="#host-element" id="ref-for-host-element⑤">host element</a> of <var>predecessorBrowsingContext</var> to <var>portalElement</var>.</p>
       </ol>
      <li data-md>
       <p>Return <var>portalElement</var>.</p>
     </ol>
    </section>
    <div class="note" role="note">
      Since the task to set the <a data-link-type="dfn" href="#portal-state" id="ref-for-portal-state⑧">portal state</a>, and thus expose the <code class="idl"><a data-link-type="idl" href="#portalhost" id="ref-for-portalhost">PortalHost</a></code> object, is queued first, and from the same <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#task-source" id="ref-for-task-source①">task source</a>,
    it is exposed at the time the <a data-link-type="dfn" href="#portalactivateevent-activation-promise" id="ref-for-portalactivateevent-activation-promise①">activation promise</a> returned from <code class="idl"><a data-link-type="idl" href="#dom-htmlportalelement-activate" id="ref-for-dom-htmlportalelement-activate①">activate(options)</a></code> is resolved. 
<pre class="highlight"><c- c1>// In the successor document.</c->
onportalactivate <c- o>=</c-> event <c- p>=></c-> <c- p>{</c->
  <c- c1>// The predecessor document is adopted into a &lt;portal> element...</c->
  document<c- p>.</c->body<c- p>.</c->appendChild<c- p>(</c->event<c- p>.</c->adoptPredecessor<c- p>());</c->
<c- p>});</c->

<c- c1>// In the predecessor document.</c->
portalElement<c- p>.</c->activate<c- p>().</c->then<c- p>(()</c-> <c- p>=></c-> <c- p>{</c->
  <c- c1>// ...and it is guaranteed to observe that change by the time the</c->
  <c- c1>// activation promise resolves.</c->
  console<c- p>.</c->assert<c- p>(</c->window<c- p>.</c->portalHost <c- k>instanceof</c-> PortalHost<c- p>);</c->
<c- p>});</c->
</pre>
    </div>
   </section>
   <section>
    <h2 class="heading settled" data-level="3" id="the-portal-element"><span class="secno">3. </span><span class="content">The <code>portal</code> element</span><a class="self-link" href="#the-portal-element"></a></h2>
    <p><em>The following section would be added as a new subsection of <a data-link-type="biblio" href="#biblio-html">[HTML]</a>'s <a href="https://html.spec.whatwg.org/#embedded-content">Embedded content</a> section.</em></p>
    <p>A <dfn class="dfn-paneled" data-dfn-type="element" data-export id="elementdef-portal"><code>portal</code></dfn> element allows for a <a data-link-type="dfn" href="#portal-browsing-context" id="ref-for-portal-browsing-context③">portal browsing context</a> to be embedded in an HTML document.</p>
    <details class="wpt-tests-block" dir="ltr" lang="en" open>
     <summary>Tests</summary>
     <ul class="wpt-tests-list">
      <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/portals/portals-rendering.html" title="portals/portals-rendering.html">portals-rendering.html</a> <a class="wpt-live" href="http://wpt.live/portals/portals-rendering.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/portals/portals-rendering.html"><small>(source)</small></a>
     </ul>
    </details>
    <p>A <code><a data-link-type="element" href="#elementdef-portal" id="ref-for-elementdef-portal③">portal</a></code> element <var>portalElement</var> has a <dfn class="dfn-paneled" data-dfn-for="HTMLPortalElement" data-dfn-type="dfn" data-lt="guest browsing context" data-noexport id="htmlportalelement-guest-browsing-context">guest
  browsing context</dfn>, which is the <a data-link-type="dfn" href="#portal-browsing-context" id="ref-for-portal-browsing-context④">portal browsing context</a> whose <a data-link-type="dfn" href="#host-element" id="ref-for-host-element⑥">host
  element</a> is <var>portalElement</var>, or null if no such browsing context exists.</p>
    <p>A <code><a data-link-type="element" href="#elementdef-portal" id="ref-for-elementdef-portal④">portal</a></code> element has a <dfn class="dfn-paneled" data-dfn-for="HTMLPortalElement" data-dfn-type="dfn" data-lt="just-adopted flag" data-noexport id="htmlportalelement-just-adopted-flag">just-adopted
  flag</dfn>, which is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#boolean" id="ref-for-boolean">boolean</a> and is initially false. It is set during
  dispatch of the <code class="idl"><a class="idl-code" data-link-type="event" href="#eventdef-window-portalactivate" id="ref-for-eventdef-window-portalactivate②">portalactivate</a></code> event.</p>
    <p>The <dfn class="dfn-paneled" data-dfn-for="portal" data-dfn-type="element-attr" data-export id="element-attrdef-portal-src"><code>src</code></dfn> attribute gives the <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url" id="ref-for-concept-url">URL</a> of a
  page that the <a data-link-type="dfn" href="#htmlportalelement-guest-browsing-context" id="ref-for-htmlportalelement-guest-browsing-context①">guest browsing context</a> is to contain. The attribute, if
  present, must be a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/urls-and-fetching.html#valid-non-empty-url-potentially-surrounded-by-spaces" id="ref-for-valid-non-empty-url-potentially-surrounded-by-spaces">valid non-empty URL potentially surrounded by spaces</a>.</p>
    <p>The <dfn class="dfn-paneled" data-dfn-for="portal" data-dfn-type="element-attr" data-export id="element-attrdef-portal-referrerpolicy"><code>referrerpolicy</code></dfn> attribute is a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/urls-and-fetching.html#referrer-policy-attribute" id="ref-for-referrer-policy-attribute">referrer policy attribute</a>.
  Its purpose is to set the <a data-link-type="dfn" href="https://w3c.github.io/webappsec-referrer-policy/#referrer-policy" id="ref-for-referrer-policy">referrer policy</a> used when <a data-link-type="dfn" href="#set-the-source-url-of-a-portal-element" id="ref-for-set-the-source-url-of-a-portal-element">setting the source URL of a portal element</a>. <a data-link-type="biblio" href="#biblio-referrer-policy">[REFERRER-POLICY]</a></p>
    <p class="note" role="note"> A <code><a data-link-type="element" href="#elementdef-portal" id="ref-for-elementdef-portal⑤">portal</a></code> is similar to an <code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/iframe-embed-object.html#the-iframe-element" id="ref-for-the-iframe-element">iframe</a></code>, in that it allows another
    browsing context to be embedded.  However, the <a data-link-type="dfn" href="#portal-browsing-context" id="ref-for-portal-browsing-context⑤">portal browsing context</a> hosted by a <code><a data-link-type="element" href="#elementdef-portal" id="ref-for-elementdef-portal⑥">portal</a></code> is part of a separate <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#browsing-context-group" id="ref-for-browsing-context-group">browsing context group</a>,
    and thus a separate <a data-link-type="dfn" href="http://tc39.github.io/ecma262/#sec-agents" id="ref-for-sec-agents">agent</a>.  The user agent therefore uses a
    separate <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-agent-event-loop" id="ref-for-concept-agent-event-loop">event loop</a> for the browsing contexts, even if they are <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/origin.html#same-origin-domain" id="ref-for-same-origin-domain">same
    origin-domain</a>. </p>
<pre class="idl highlight def">[<a class="idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed" id="ref-for-Exposed"><c- g>Exposed</c-></a>=<c- n>Window</c->, <a class="idl-code" data-link-type="extended-attribute" href="https://html.spec.whatwg.org/multipage/dom.html#htmlconstructor" id="ref-for-htmlconstructor"><c- g>HTMLConstructor</c-></a>]
<c- b>interface</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="interface" data-export id="htmlportalelement"><code><c- g>HTMLPortalElement</c-></code></dfn> : <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/dom.html#htmlelement" id="ref-for-htmlelement"><c- n>HTMLElement</c-></a> {
    [<a class="idl-code" data-link-type="extended-attribute" href="https://html.spec.whatwg.org/multipage/custom-elements.html#cereactions" id="ref-for-cereactions"><c- g>CEReactions</c-></a>] <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-USVString" id="ref-for-idl-USVString"><c- b>USVString</c-></a> <a class="idl-code" data-link-type="attribute" data-type="USVString" href="#dom-htmlportalelement-src" id="ref-for-dom-htmlportalelement-src"><c- g>src</c-></a>;
    [<a class="idl-code" data-link-type="extended-attribute" href="https://html.spec.whatwg.org/multipage/custom-elements.html#cereactions" id="ref-for-cereactions①"><c- g>CEReactions</c-></a>] <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString" id="ref-for-idl-DOMString"><c- b>DOMString</c-></a> <a class="idl-code" data-link-type="attribute" data-type="DOMString" href="#dom-htmlportalelement-referrerpolicy" id="ref-for-dom-htmlportalelement-referrerpolicy"><c- g>referrerPolicy</c-></a>;

    [<a class="idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#NewObject" id="ref-for-NewObject"><c- g>NewObject</c-></a>] <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-promise" id="ref-for-idl-promise"><c- b>Promise</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-undefined" id="ref-for-idl-undefined"><c- b>undefined</c-></a>> <a class="idl-code" data-link-type="method" href="#dom-htmlportalelement-activate" id="ref-for-dom-htmlportalelement-activate②"><c- g>activate</c-></a>(<c- b>optional</c-> <a data-link-type="idl-name" href="#dictdef-portalactivateoptions" id="ref-for-dictdef-portalactivateoptions"><c- n>PortalActivateOptions</c-></a> <dfn class="idl-code" data-dfn-for="HTMLPortalElement/activate(options), HTMLPortalElement/activate()" data-dfn-type="argument" data-export id="dom-htmlportalelement-activate-options-options"><code><c- g>options</c-></code><a class="self-link" href="#dom-htmlportalelement-activate-options-options"></a></dfn> = {});
    <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-undefined" id="ref-for-idl-undefined①"><c- b>undefined</c-></a> <a class="idl-code" data-link-type="method" href="#dom-htmlportalelement-postmessage" id="ref-for-dom-htmlportalelement-postmessage"><c- g>postMessage</c-></a>(<a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-any" id="ref-for-idl-any"><c- b>any</c-></a> <dfn class="idl-code" data-dfn-for="HTMLPortalElement/postMessage(message, options), HTMLPortalElement/postMessage(message)" data-dfn-type="argument" data-export id="dom-htmlportalelement-postmessage-message-options-message"><code><c- g>message</c-></code><a class="self-link" href="#dom-htmlportalelement-postmessage-message-options-message"></a></dfn>, <c- b>optional</c-> <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/web-messaging.html#postmessageoptions" id="ref-for-postmessageoptions"><c- n>PostMessageOptions</c-></a> <dfn class="idl-code" data-dfn-for="HTMLPortalElement/postMessage(message, options), HTMLPortalElement/postMessage(message)" data-dfn-type="argument" data-export id="dom-htmlportalelement-postmessage-message-options-options"><code><c- g>options</c-></code><a class="self-link" href="#dom-htmlportalelement-postmessage-message-options-options"></a></dfn> = {});

    <c- b>attribute</c-> <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler" id="ref-for-eventhandler"><c- n>EventHandler</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="HTMLPortalElement" data-dfn-type="attribute" data-export data-type="EventHandler" id="dom-htmlportalelement-onmessage"><code><c- g>onmessage</c-></code></dfn>;
    <c- b>attribute</c-> <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler" id="ref-for-eventhandler①"><c- n>EventHandler</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="HTMLPortalElement" data-dfn-type="attribute" data-export data-type="EventHandler" id="dom-htmlportalelement-onmessageerror"><code><c- g>onmessageerror</c-></code></dfn>;
};

<c- b>dictionary</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="dictionary" data-export id="dictdef-portalactivateoptions"><code><c- g>PortalActivateOptions</c-></code></dfn> : <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/web-messaging.html#postmessageoptions" id="ref-for-postmessageoptions①"><c- n>PostMessageOptions</c-></a> {
    <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-any" id="ref-for-idl-any①"><c- b>any</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="PortalActivateOptions" data-dfn-type="dict-member" data-export data-type="any " id="dom-portalactivateoptions-data"><code><c- g>data</c-></code></dfn>;
};
</pre>
    <details class="wpt-tests-block" dir="ltr" lang="en" open>
     <summary>Tests</summary>
     <ul class="wpt-tests-list">
      <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/portals/portals-api.html" title="portals/portals-api.html">portals-api.html</a> <a class="wpt-live" href="http://wpt.live/portals/portals-api.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/portals/portals-api.html"><small>(source)</small></a>
     </ul>
    </details>
    <p>The <dfn class="dfn-paneled idl-code" data-dfn-for="HTMLPortalElement" data-dfn-type="attribute" data-export id="dom-htmlportalelement-src"><code>src</code></dfn> IDL attribute must <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/common-dom-interfaces.html#reflect" id="ref-for-reflect">reflect</a> the <code><a data-link-type="element-sub" href="#element-attrdef-portal-src" id="ref-for-element-attrdef-portal-src">src</a></code> content attribute.</p>
    <p>The <dfn class="dfn-paneled idl-code" data-dfn-for="HTMLPortalElement" data-dfn-type="attribute" data-export id="dom-htmlportalelement-referrerpolicy"><code>referrerPolicy</code></dfn> IDL attribute must <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/common-dom-interfaces.html#reflect" id="ref-for-reflect①">reflect</a> the <code><a data-link-type="element-sub" href="#element-attrdef-portal-referrerpolicy" id="ref-for-element-attrdef-portal-referrerpolicy">referrerpolicy</a></code> content attribute, <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/common-dom-interfaces.html#limited-to-only-known-values" id="ref-for-limited-to-only-known-values">limited to only known values</a>.</p>
    <section class="algorithm" data-algorithm="htmlportalelement-activate">
      The <dfn class="dfn-paneled idl-code" data-dfn-for="HTMLPortalElement" data-dfn-type="method" data-export data-lt="activate(options)|activate()" id="dom-htmlportalelement-activate"><code>activate(<var>options</var>)</code></dfn> method <em>must</em> run these steps: 
     <ol>
      <li data-md>
       <p>Let <var>portalBrowsingContext</var> be the <a data-link-type="dfn" href="#htmlportalelement-guest-browsing-context" id="ref-for-htmlportalelement-guest-browsing-context②">guest browsing context</a> of <a data-link-type="dfn" href="https://heycam.github.io/webidl/#this" id="ref-for-this">this</a>.</p>
      <li data-md>
       <p>If <var>portalBrowsingContext</var> is null, throw an "<code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#invalidstateerror" id="ref-for-invalidstateerror①">InvalidStateError</a></code>" <code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#idl-DOMException" id="ref-for-idl-DOMException①">DOMException</a></code>.</p>
       <details class="wpt-tests-block" dir="ltr" lang="en" open>
        <summary>Tests</summary>
        <ul class="wpt-tests-list">
         <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/portals/portals-activate-no-browsing-context.html" title="portals/portals-activate-no-browsing-context.html">portals-activate-no-browsing-context.html</a> <a class="wpt-live" href="http://wpt.live/portals/portals-activate-no-browsing-context.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/portals/portals-activate-no-browsing-context.html"><small>(source)</small></a>
        </ul>
       </details>
      <li data-md>
       <p>Let <var>predecessorBrowsingContext</var> be the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-document-bc" id="ref-for-concept-document-bc">browsing context</a> of <a data-link-type="dfn" href="https://heycam.github.io/webidl/#this" id="ref-for-this①">this</a>'s <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-node-document" id="ref-for-concept-node-document①">node document</a>.</p>
      <li data-md>
       <p>If <var>predecessorBrowsingContext</var> is null, throw an "<code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#invalidstateerror" id="ref-for-invalidstateerror②">InvalidStateError</a></code>" <code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#idl-DOMException" id="ref-for-idl-DOMException②">DOMException</a></code>.</p>
      <li data-md>
       <p>If the <a data-link-type="dfn" href="#portal-state" id="ref-for-portal-state⑨">portal state</a> of <var>predecessorBrowsingContext</var> is not "<code>none</code>",
throw an "<code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#invalidstateerror" id="ref-for-invalidstateerror③">InvalidStateError</a></code>" <code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#idl-DOMException" id="ref-for-idl-DOMException③">DOMException</a></code>.</p>
       <p class="note" role="note"><span>Note:</span> This means that a <code><a data-link-type="element" href="#elementdef-portal" id="ref-for-elementdef-portal⑦">portal</a></code> element inside a <a data-link-type="dfn" href="#portal-browsing-context" id="ref-for-portal-browsing-context⑥">portal browsing context</a> cannot be activated.</p>
      <li data-md>
       <p>Let <var>serializeWithTransferResult</var> be <a data-link-type="abstract-op" href="https://html.spec.whatwg.org/multipage/structured-data.html#structuredserializewithtransfer" id="ref-for-structuredserializewithtransfer">StructuredSerializeWithTransfer</a>(<var>options</var>["<code class="idl"><a data-link-type="idl" href="#dom-portalactivateoptions-data" id="ref-for-dom-portalactivateoptions-data">data</a></code>"], <var>options</var>["<code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/web-messaging.html#dom-postmessageoptions-transfer" id="ref-for-dom-postmessageoptions-transfer">transfer</a></code>"]).
Rethrow any exceptions.</p>
      <li data-md>
       <p>Let <var>promise</var> be a new <a data-link-type="dfn" href="http://tc39.github.io/ecma262/#sec-promise-objects" id="ref-for-sec-promise-objects">promise</a>.</p>
      <li data-md>
       <p>Let <var>sourceOrigin</var> be <a data-link-type="dfn" href="https://heycam.github.io/webidl/#this" id="ref-for-this②">this</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object" id="ref-for-relevant-settings-object">relevant settings object</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin" id="ref-for-concept-settings-object-origin">origin</a>.</p>
      <li data-md>
       <p>Run the steps to <a data-link-type="dfn" href="#activate-a-portal-browsing-context" id="ref-for-activate-a-portal-browsing-context②">activate</a> <var>portalBrowsingContext</var> in place of <var>predecessorBrowsingContext</var> with <var>sourceOrigin</var>, <var>serializeWithTransferResult</var>,
and <var>promise</var>.</p>
      <li data-md>
       <p>Return <var>promise</var>.</p>
     </ol>
     <details class="wpt-tests-block" dir="ltr" lang="en" open>
      <summary>Tests</summary>
      <ul class="wpt-tests-list">
       <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/portals/portal-activate-data.html" title="portals/portal-activate-data.html">portal-activate-data.html</a> <a class="wpt-live" href="http://wpt.live/portals/portal-activate-data.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/portals/portal-activate-data.html"><small>(source)</small></a>
       <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/portals/portals-activate-inside-iframe.html" title="portals/portals-activate-inside-iframe.html">portals-activate-inside-iframe.html</a> <a class="wpt-live" href="http://wpt.live/portals/portals-activate-inside-iframe.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/portals/portals-activate-inside-iframe.html"><small>(source)</small></a>
       <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/portals/portals-activate-inside-portal.html" title="portals/portals-activate-inside-portal.html">portals-activate-inside-portal.html</a> <a class="wpt-live" href="http://wpt.live/portals/portals-activate-inside-portal.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/portals/portals-activate-inside-portal.html"><small>(source)</small></a>
       <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/portals/portals-activate-resolution.html" title="portals/portals-activate-resolution.html">portals-activate-resolution.html</a> <a class="wpt-live" href="http://wpt.live/portals/portals-activate-resolution.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/portals/portals-activate-resolution.html"><small>(source)</small></a>
       <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/portals/portals-activate-twice.html" title="portals/portals-activate-twice.html">portals-activate-twice.html</a> <a class="wpt-live" href="http://wpt.live/portals/portals-activate-twice.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/portals/portals-activate-twice.html"><small>(source)</small></a>
      </ul>
     </details>
    </section>
    <section class="algorithm" data-algorithm="htmlportalelement-postmessage">
      The <dfn class="dfn-paneled idl-code" data-dfn-for="HTMLPortalElement" data-dfn-type="method" data-export data-lt="postMessage(message, options)|postMessage(message)" id="dom-htmlportalelement-postmessage"><code>postMessage(<var>message</var>, <var>options</var>)</code></dfn> method <em>must</em> run these steps: 
     <ol>
      <li data-md>
       <p>Let <var>portalBrowsingContext</var> be the <a data-link-type="dfn" href="#htmlportalelement-guest-browsing-context" id="ref-for-htmlportalelement-guest-browsing-context③">guest browsing context</a> of <a data-link-type="dfn" href="https://heycam.github.io/webidl/#this" id="ref-for-this③">this</a>.</p>
      <li data-md>
       <p>If <var>portalBrowsingContext</var> is null, throw an "<code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#invalidstateerror" id="ref-for-invalidstateerror④">InvalidStateError</a></code>" <code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#idl-DOMException" id="ref-for-idl-DOMException④">DOMException</a></code>.</p>
      <li data-md>
       <p>Let <var>sourceOrigin</var> be <a data-link-type="dfn" href="https://heycam.github.io/webidl/#this" id="ref-for-this④">this</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object" id="ref-for-relevant-settings-object①">relevant settings object</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin" id="ref-for-concept-settings-object-origin①">origin</a>.</p>
      <li data-md>
       <p>Let <var>transfer</var> be <var>options</var>["<code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/web-messaging.html#dom-postmessageoptions-transfer" id="ref-for-dom-postmessageoptions-transfer①">transfer</a></code>"].</p>
      <li data-md>
       <p>Let <var>serializeWithTransferResult</var> be <a data-link-type="abstract-op" href="https://html.spec.whatwg.org/multipage/structured-data.html#structuredserializewithtransfer" id="ref-for-structuredserializewithtransfer①">StructuredSerializeWithTransfer</a>(<var>message</var>, <var>transfer</var>). Rethrow any exceptions.</p>
      <li data-md>
       <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task" id="ref-for-queue-a-global-task④">Queue a global task</a> on the <a data-link-type="dfn" href="#portal-task-source" id="ref-for-portal-task-source④">portal task source</a> given <var>portalBrowsingContext</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#active-window" id="ref-for-active-window③">active
window</a> to run the following steps:</p>
       <ol>
        <li data-md>
         <p>If <var>portalBrowsingContext</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#active-document" id="ref-for-active-document①">active document</a>'s <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-document-origin" id="ref-for-concept-document-origin①">origin</a> is not <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/origin.html#same-origin" id="ref-for-same-origin①">same origin</a> with <var>sourceOrigin</var>, then abort these steps.</p>
        <li data-md>
         <p>Let <var>origin</var> be the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/origin.html#ascii-serialisation-of-an-origin" id="ref-for-ascii-serialisation-of-an-origin">serialization</a> of <var>sourceOrigin</var>.</p>
        <li data-md>
         <p>Let <var>targetWindow</var> be <var>portalBrowsingContext</var>’s associated <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/window-object.html#windowproxy" id="ref-for-windowproxy①">WindowProxy</a></code>'s [[Window]] internal slot value.</p>
        <li data-md>
         <p>Let <var>portalHost</var> be the <var>targetWindow</var>’s <a data-link-type="dfn" href="#portal-host-object" id="ref-for-portal-host-object">portal host object</a>.</p>
        <li data-md>
         <p>Let <var>targetRealm</var> be the <var>targetWindow</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-global-object-realm" id="ref-for-concept-global-object-realm①">realm</a>.</p>
        <li data-md>
         <p>Let <var>deserializeRecord</var> be <a data-link-type="abstract-op" href="https://html.spec.whatwg.org/multipage/structured-data.html#structureddeserializewithtransfer" id="ref-for-structureddeserializewithtransfer①">StructuredDeserializeWithTransfer</a>(<var>serializeWithTransferResult</var>, <var>targetRealm</var>).</p>
         <p>If this throws an exception, catch it, <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-event-fire" id="ref-for-concept-event-fire">fire an event</a> named <code class="idl"><a class="idl-code" data-link-type="event" href="#eventdef-portalhost-messageerror" id="ref-for-eventdef-portalhost-messageerror">messageerror</a></code> at <var>portalHost</var> using <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/comms.html#messageevent" id="ref-for-messageevent">MessageEvent</a></code> with the <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/comms.html#dom-messageevent-origin" id="ref-for-dom-messageevent-origin">origin</a></code> attribute initialized to <var>origin</var> and the <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/comms.html#dom-messageevent-source" id="ref-for-dom-messageevent-source">source</a></code> attribute initialized to <var>portalHost</var>,
then abort these steps.</p>
        <li data-md>
         <p>Let <var>messageClone</var> be <var>deserializeRecord</var>.[[Deserialized]].</p>
        <li data-md>
         <p>Let <var>newPorts</var> be a new <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-frozen-array-type" id="ref-for-dfn-frozen-array-type">frozen array</a> consisting of all <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/web-messaging.html#messageport" id="ref-for-messageport">MessagePort</a></code> objects in <var>deserializeRecord</var>.[[TransferredValues]], if any, maintaining their relative order.</p>
        <li data-md>
         <p><a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-event-fire" id="ref-for-concept-event-fire①">Fire an event</a> named <code class="idl"><a class="idl-code" data-link-type="event" href="#eventdef-portalhost-message" id="ref-for-eventdef-portalhost-message">message</a></code> at <var>portalHost</var> using <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/comms.html#messageevent" id="ref-for-messageevent①">MessageEvent</a></code>, with the <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/comms.html#dom-messageevent-origin" id="ref-for-dom-messageevent-origin①">origin</a></code> attribute
initialized to <var>origin</var>, the <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/comms.html#dom-messageevent-source" id="ref-for-dom-messageevent-source①">source</a></code> attribute initialized to <var>portalHost</var>, the <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/comms.html#dom-messageevent-data" id="ref-for-dom-messageevent-data">data</a></code> attribute
initialized to <var>messageClone</var>, and the <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/comms.html#dom-messageevent-ports" id="ref-for-dom-messageevent-ports">ports</a></code> attribute initialized to <var>newPorts</var>.</p>
       </ol>
     </ol>
     <details class="wpt-tests-block" dir="ltr" lang="en" open>
      <summary>Tests</summary>
      <ul class="wpt-tests-list">
       <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/portals/portals-post-message.sub.html" title="portals/portals-post-message.sub.html">portals-post-message.sub.html</a> <a class="wpt-live" href="http://wpt.live/portals/portals-post-message.sub.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/portals/portals-post-message.sub.html"><small>(source)</small></a>
      </ul>
     </details>
    </section>
    <section class="algorithm" data-algorithm="htmlportalelement-may-have-guest-browsing-context">
      To determine whether a <code><a data-link-type="element" href="#elementdef-portal" id="ref-for-elementdef-portal⑧">portal</a></code> element <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="may-have-a-guest-browsing-context">may have a guest browsing context</dfn>, run the following steps: 
     <ol>
      <li data-md>
       <p>If <var>element</var>’s <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-node-document" id="ref-for-concept-node-document②">node document</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#browsing-context" id="ref-for-browsing-context③">browsing context</a> is not a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#top-level-browsing-context" id="ref-for-top-level-browsing-context①">top-level browsing context</a>, then return false.</p>
       <details class="wpt-tests-block" dir="ltr" lang="en" open>
        <summary>Tests</summary>
        <ul class="wpt-tests-list">
         <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/portals/portals-nested.html" title="portals/portals-nested.html">portals-nested.html</a> <a class="wpt-live" href="http://wpt.live/portals/portals-nested.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/portals/portals-nested.html"><small>(source)</small></a>
        </ul>
       </details>
       <p class="note" role="note"> The user agent may choose to emit a warning if the author attempts to
  use a <code><a data-link-type="element" href="#elementdef-portal" id="ref-for-elementdef-portal⑨">portal</a></code> element in a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#nested-browsing-context" id="ref-for-nested-browsing-context①">nested browsing context</a>, as this is not
  supported. </p>
      <li data-md>
       <p>If <var>element</var>’s <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-node-document" id="ref-for-concept-node-document③">node document</a>'s <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-document-url" id="ref-for-concept-document-url">URL</a>'s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-scheme" id="ref-for-concept-url-scheme">scheme</a> is not an <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#http-scheme" id="ref-for-http-scheme">HTTP(S) scheme</a>, then return false.</p>
       <details class="wpt-tests-block" dir="ltr" lang="en" open>
        <summary>Tests</summary>
        <ul class="wpt-tests-list">
         <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/portals/about-blank-cannot-host.html" title="portals/about-blank-cannot-host.html">about-blank-cannot-host.html</a> <a class="wpt-live" href="http://wpt.live/portals/about-blank-cannot-host.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/portals/about-blank-cannot-host.html"><small>(source)</small></a>
        </ul>
       </details>
       <p class="note" role="note"> This is to prevent problems later, if the portaled content attempts to <a data-link-type="dfn" href="#adopt-the-predecessor-browsing-context" id="ref-for-adopt-the-predecessor-browsing-context②">adopt its predecessor</a>. Since portaled content
  can only have a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#http-scheme" id="ref-for-http-scheme①">HTTP(S) scheme</a>, adoption would fail, and so its simpler to restrict
  things at this stage. </p>
      <li data-md>
       <p>If <var>element</var>’s <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-node-document" id="ref-for-concept-node-document④">node document</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/origin.html#active-sandboxing-flag-set" id="ref-for-active-sandboxing-flag-set">active sandboxing flag set</a> is not empty,
then return false.</p>
       <details class="wpt-tests-block" dir="ltr" lang="en" open>
        <summary>Tests</summary>
        <ul class="wpt-tests-list">
         <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/portals/no-portal-in-sandboxed-popup.html" title="portals/no-portal-in-sandboxed-popup.html">no-portal-in-sandboxed-popup.html</a> <a class="wpt-live" href="http://wpt.live/portals/no-portal-in-sandboxed-popup.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/portals/no-portal-in-sandboxed-popup.html"><small>(source)</small></a>
        </ul>
       </details>
       <p class="note" role="note"> Since portals cannot be created in <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#child-browsing-context" id="ref-for-child-browsing-context">child browsing contexts</a> anyway, this step is about
  preventing portal uses in <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#auxiliary-browsing-context" id="ref-for-auxiliary-browsing-context">auxiliary browsing contexts</a> spawned by sandboxed <code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/iframe-embed-object.html#the-iframe-element" id="ref-for-the-iframe-element①">iframe</a></code>s, or pages using CSP’s <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#sandbox" id="ref-for-sandbox">sandbox</a> directive. </p>
       <p class="note" role="note"> This restriction is largely added for simplicity. If there are use cases for portals
  inside sandboxed documents, we can enable them in the future, with appropriate opt-in. See <a href="https://github.com/WICG/portals/issues/207">issue #207</a> for discussion. </p>
      <li data-md>
       <p>If <var>element</var> is <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#browsing-context-connected" id="ref-for-browsing-context-connected①">browsing-context connected</a>, then return true.</p>
      <li data-md>
       <p>If <var>element</var>’s <a data-link-type="dfn" href="#htmlportalelement-just-adopted-flag" id="ref-for-htmlportalelement-just-adopted-flag③">just-adopted flag</a> is true, then return true.</p>
      <li data-md>
       <p>Return false.</p>
     </ol>
    </section>
    <section class="algorithm" data-algorithm="htmlportalelement-close">
      To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="close-a-portal-element">close a <code><a data-link-type="element" href="#elementdef-portal" id="ref-for-elementdef-portal①⓪">portal</a></code> element</dfn> <var>element</var>, run the following steps: 
     <ol>
      <li data-md>
       <p>If <var>element</var>’s <a data-link-type="dfn" href="#htmlportalelement-guest-browsing-context" id="ref-for-htmlportalelement-guest-browsing-context④">guest browsing context</a> is not null, then <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/window-object.html#close-a-browsing-context" id="ref-for-close-a-browsing-context③">close</a> it.</p>
       <p>The user agent <em>should not</em> ask the user for confirmation during the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#prompt-to-unload-a-document" id="ref-for-prompt-to-unload-a-document①">prompt to unload</a> step (and so the browsing context should be <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/window-object.html#a-browsing-context-is-discarded" id="ref-for-a-browsing-context-is-discarded③">discarded</a>).</p>
     </ol>
    </section>
    <section class="algorithm" data-algorithm="htmlportalelement-setsourceurl">
      To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="set-the-source-url-of-a-portal-element">set the source URL of a <code><a data-link-type="element" href="#elementdef-portal" id="ref-for-elementdef-portal①①">portal</a></code> element</dfn> <var>element</var>, run the following steps: 
     <ol>
      <li data-md>
       <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#assert" id="ref-for-assert④">Assert</a>: <var>element</var> <a data-link-type="dfn" href="#may-have-a-guest-browsing-context" id="ref-for-may-have-a-guest-browsing-context①">may have a guest browsing context</a>.</p>
      <li data-md>
       <p>Let <var>hostBrowsingContext</var> be <var>element</var>’s <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-node-document" id="ref-for-concept-node-document⑤">node document</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#browsing-context" id="ref-for-browsing-context④">browsing context</a>.</p>
      <li data-md>
       <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#assert" id="ref-for-assert⑤">Assert</a>: <var>hostBrowsingContext</var> is a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#top-level-browsing-context" id="ref-for-top-level-browsing-context②">top-level browsing context</a>.</p>
      <li data-md>
       <p><a data-link-type="dfn" href="#close-a-portal-element" id="ref-for-close-a-portal-element">Close</a> <var>element</var>.</p>
      <li data-md>
       <p>If <var>element</var> has no <code><a data-link-type="element-sub" href="#element-attrdef-portal-src" id="ref-for-element-attrdef-portal-src①">src</a></code> attribute specified, or its value is the empty string,
then return.</p>
      <li data-md>
       <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/urls-and-fetching.html#parse-a-url" id="ref-for-parse-a-url">Parse</a> the value of the <code><a data-link-type="element-sub" href="#element-attrdef-portal-src" id="ref-for-element-attrdef-portal-src②">src</a></code> attribute. If that is not successful,
then return.</p>
       <p>Otherwise, let <var>url</var> be the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/urls-and-fetching.html#resulting-url-record" id="ref-for-resulting-url-record">resulting URL record</a>.</p>
      <li data-md>
       <p class="assertion">Assert: <var>element</var>’s <a data-link-type="dfn" href="#htmlportalelement-guest-browsing-context" id="ref-for-htmlportalelement-guest-browsing-context⑤">guest browsing context</a> is null.</p>
      <li data-md>
       <p>Let <var>guestBrowsingContext</var> be the result of <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#creating-a-new-top-level-browsing-context" id="ref-for-creating-a-new-top-level-browsing-context">creating a new top-level browsing context</a>.</p>
      <li data-md>
       <p>Set the <a data-link-type="dfn" href="#portal-state" id="ref-for-portal-state①⓪">portal state</a> of <var>guestBrowsingContext</var> to "<code>portal</code>", and set the <a data-link-type="dfn" href="#host-element" id="ref-for-host-element⑦">host element</a> of <var>guestBrowsingContext</var> to <var>element</var>.</p>
      <li data-md>
       <p>Let <var>resource</var> be a new <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request" id="ref-for-concept-request">request</a> whose <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-url" id="ref-for-concept-request-url">url</a> is <var>url</var> and whose <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-referrer-policy" id="ref-for-concept-request-referrer-policy">referrer policy</a> is the current state of <var>element</var>’s <code><a data-link-type="element-sub" href="#element-attrdef-portal-referrerpolicy" id="ref-for-element-attrdef-portal-referrerpolicy①">referrerpolicy</a></code> content attribute.</p>
      <li data-md>
       <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#navigate" id="ref-for-navigate">Navigate</a> <var>guestBrowsingContext</var> to <var>resource</var>.</p>
     </ol>
     <div class="note" role="note">
       Unlike an <code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/iframe-embed-object.html#the-iframe-element" id="ref-for-the-iframe-element②">iframe</a></code> element, a <code><a data-link-type="element" href="#elementdef-portal" id="ref-for-elementdef-portal①②">portal</a></code> element supports a state where it has no associated
      browsing context. This is the initial state of a <code><a data-link-type="element" href="#elementdef-portal" id="ref-for-elementdef-portal①③">portal</a></code> element. That is, the <a data-link-type="dfn" href="#portal-browsing-context" id="ref-for-portal-browsing-context⑦">portal
      browsing context</a> has no web-developer-visible initial <code>about:blank</code> <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#document" id="ref-for-document①">Document</a></code>; instead it <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#navigate" id="ref-for-navigate①">navigates</a> directly to the first parsable URL assigned to it, and if the navigation cannot
      finish successfully, it <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/window-object.html#close-a-browsing-context" id="ref-for-close-a-browsing-context④">closes</a> the browsing context before the
      navigation algorithm finishes. 
      <p>Similarly, a <code><a data-link-type="element" href="#elementdef-portal" id="ref-for-elementdef-portal①④">portal</a></code> element responds to an unparsable <code><a data-link-type="element-sub" href="#element-attrdef-portal-src" id="ref-for-element-attrdef-portal-src③">src</a></code> URL by <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/window-object.html#close-a-browsing-context" id="ref-for-close-a-browsing-context⑤">closing</a> its browsing context, rather than by navigating to <code>about:blank</code>.</p>
     </div>
    </section>
    <details class="wpt-tests-block" dir="ltr" lang="en" open>
     <summary>Tests</summary>
     <ul class="wpt-tests-list">
      <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/portals/portals-cross-origin-load.sub.html" title="portals/portals-cross-origin-load.sub.html">portals-cross-origin-load.sub.html</a> <a class="wpt-live" href="http://wpt.live/portals/portals-cross-origin-load.sub.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/portals/portals-cross-origin-load.sub.html"><small>(source)</small></a>
      <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/portals/portals-referrer.html" title="portals/portals-referrer.html">portals-referrer.html</a> <a class="wpt-live" href="http://wpt.live/portals/portals-referrer.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/portals/portals-referrer.html"><small>(source)</small></a>
      <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/portals/portals-referrer-inherit-header.html" title="portals/portals-referrer-inherit-header.html">portals-referrer-inherit-header.html</a> <a class="wpt-live" href="http://wpt.live/portals/portals-referrer-inherit-header.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/portals/portals-referrer-inherit-header.html"><small>(source)</small></a>
      <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/portals/portals-referrer-inherit-meta.html" title="portals/portals-referrer-inherit-meta.html">portals-referrer-inherit-meta.html</a> <a class="wpt-live" href="http://wpt.live/portals/portals-referrer-inherit-meta.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/portals/portals-referrer-inherit-meta.html"><small>(source)</small></a>
     </ul>
    </details>
    <p>Whenever a <code><a data-link-type="element" href="#elementdef-portal" id="ref-for-elementdef-portal①⑤">portal</a></code> element <var>element</var> has its <code><a data-link-type="element-sub" href="#element-attrdef-portal-src" id="ref-for-element-attrdef-portal-src④">src</a></code> attribute set,
  changed, or removed, run the following steps:</p>
    <ol>
     <li data-md>
      <p>If <var>element</var> <a data-link-type="dfn" href="#may-have-a-guest-browsing-context" id="ref-for-may-have-a-guest-browsing-context②">may have a guest browsing context</a>, then <a data-link-type="dfn" href="#set-the-source-url-of-a-portal-element" id="ref-for-set-the-source-url-of-a-portal-element①">set the source URL</a> of <var>element</var>.</p>
    </ol>
    <p>Whenever a <code><a data-link-type="element" href="#elementdef-portal" id="ref-for-elementdef-portal①⑥">portal</a></code> element <var>element</var> <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#becomes-browsing-context-connected" id="ref-for-becomes-browsing-context-connected">becomes
  browsing-context connected</a>, run the following steps:</p>
    <ol>
     <li data-md>
      <p>If <var>element</var> <a data-link-type="dfn" href="#may-have-a-guest-browsing-context" id="ref-for-may-have-a-guest-browsing-context③">may not have a guest browsing context</a>, then abort these steps.</p>
     <li data-md>
      <p>If <var>element</var>’s <a data-link-type="dfn" href="#htmlportalelement-guest-browsing-context" id="ref-for-htmlportalelement-guest-browsing-context⑥">guest browsing context</a> is not null, then abort these steps.</p>
      <div class="note" role="note"> This ensures that a newly <a data-link-type="dfn" href="#adopt-the-predecessor-browsing-context" id="ref-for-adopt-the-predecessor-browsing-context③">adopted</a> <code><a data-link-type="element" href="#elementdef-portal" id="ref-for-elementdef-portal①⑦">portal</a></code> element can be inserted into the document without navigating
    it. </div>
     <li data-md>
      <p><a data-link-type="dfn" href="#set-the-source-url-of-a-portal-element" id="ref-for-set-the-source-url-of-a-portal-element②">Set the source URL</a> of <var>element</var>.</p>
    </ol>
    <p>Whenever a <code><a data-link-type="element" href="#elementdef-portal" id="ref-for-elementdef-portal①⑧">portal</a></code> element <var>element</var> <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#becomes-browsing-context-disconnected" id="ref-for-becomes-browsing-context-disconnected">becomes
  browsing-context connected</a>, run the following steps:</p>
    <ol>
     <li data-md>
      <p>If <var>element</var> <a data-link-type="dfn" href="#may-have-a-guest-browsing-context" id="ref-for-may-have-a-guest-browsing-context④">may not have a guest browsing context</a> and its <a data-link-type="dfn" href="#htmlportalelement-guest-browsing-context" id="ref-for-htmlportalelement-guest-browsing-context⑦">guest browsing context</a> is not null, then <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/window-object.html#a-browsing-context-is-discarded" id="ref-for-a-browsing-context-is-discarded④">discard</a> it.</p>
    </ol>
    <div class="issue" id="issue-833dc9f1"><a class="self-link" href="#issue-833dc9f1"></a> It might be convenient to not immediately detach the portal element, but instead to do so
    in a microtask. This would allow developers to reinsert the <code><a data-link-type="element" href="#elementdef-portal" id="ref-for-elementdef-portal①⑨">portal</a></code> element without losing
    its browsing context. </div>
    <p>Whenever a <code><a data-link-type="element" href="#elementdef-portal" id="ref-for-elementdef-portal②⓪">portal</a></code> element <var>element</var> is <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-node-adopt-ext" id="ref-for-concept-node-adopt-ext">adopted</a>, run the following steps:</p>
    <ol>
     <li data-md>
      <p>Let <var>guestBrowsingContext</var> be <var>element</var>’s <a data-link-type="dfn" href="#htmlportalelement-guest-browsing-context" id="ref-for-htmlportalelement-guest-browsing-context⑧">guest browsing context</a>.</p>
     <li data-md>
      <p>If <var>guestBrowsingContext</var> is null, then abort these steps.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/window-object.html#a-browsing-context-is-discarded" id="ref-for-a-browsing-context-is-discarded⑤">Discard</a> <var>guestBrowsingContext</var>.</p>
    </ol>
    <div class="note" role="note">
      In particular, this means a <code><a data-link-type="element" href="#elementdef-portal" id="ref-for-elementdef-portal②①">portal</a></code> element loses its <a data-link-type="dfn" href="#htmlportalelement-guest-browsing-context" id="ref-for-htmlportalelement-guest-browsing-context⑨">guest browsing
    context</a> if it is moved to the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#active-document" id="ref-for-active-document②">active document</a> of a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#nested-browsing-context" id="ref-for-nested-browsing-context②">nested browsing
    context</a>. 
     <p>Similarly, the steps when a <code><a data-link-type="element" href="#elementdef-portal" id="ref-for-elementdef-portal②②">portal</a></code> element’s <a data-link-type="dfn" href="#set-the-source-url-of-a-portal-element" id="ref-for-set-the-source-url-of-a-portal-element③">source URL is set</a> prevent
    elements from creating a new <a data-link-type="dfn" href="#htmlportalelement-guest-browsing-context" id="ref-for-htmlportalelement-guest-browsing-context①⓪">guest browsing context</a> while inside such
    documents.</p>
     <p>It is therefore impossible to embed a <a data-link-type="dfn" href="#portal-browsing-context" id="ref-for-portal-browsing-context⑧">portal browsing context</a> in a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#nested-browsing-context" id="ref-for-nested-browsing-context③">nested browsing context</a>.</p>
    </div>
    <p>Whenever a <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#document" id="ref-for-document②">Document</a></code> object <var>document</var> whose <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-document-bc" id="ref-for-concept-document-bc①">browsing context</a> is a <a data-link-type="dfn" href="#portal-browsing-context" id="ref-for-portal-browsing-context⑨">portal browsing context</a> is marked as <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/parsing.html#completely-loaded" id="ref-for-completely-loaded">completely loaded</a>, run the following steps as part of
  the queued task:</p>
    <ol>
     <li data-md>
      <p>Let <var>element</var> be <var>document</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-document-bc" id="ref-for-concept-document-bc②">browsing context</a>'s <a data-link-type="dfn" href="#host-element" id="ref-for-host-element⑧">host element</a>.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-event-fire" id="ref-for-concept-event-fire②">Fire an event</a> named <code class="idl"><a class="idl-code" data-link-type="event" href="https://html.spec.whatwg.org/multipage/indices.html#event-load" id="ref-for-event-load">load</a></code> at <var>element</var>.</p>
    </ol>
    <details class="wpt-tests-block" dir="ltr" lang="en" open>
     <summary>Tests</summary>
     <ul class="wpt-tests-list">
      <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/portals/portal-onload-event.html" title="portals/portal-onload-event.html">portal-onload-event.html</a> <a class="wpt-live" href="http://wpt.live/portals/portal-onload-event.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/portals/portal-onload-event.html"><small>(source)</small></a>
      <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/portals/portals-cross-origin-load.sub.html" title="portals/portals-cross-origin-load.sub.html">portals-cross-origin-load.sub.html</a> <a class="wpt-live" href="http://wpt.live/portals/portals-cross-origin-load.sub.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/portals/portals-cross-origin-load.sub.html"><small>(source)</small></a>
     </ul>
    </details>
    <section class="algorithm" data-algorithm="htmlportalelement-activation-behavior">
      A <code><a data-link-type="element" href="#elementdef-portal" id="ref-for-elementdef-portal②③">portal</a></code> element <var>el</var>’s <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#eventtarget-activation-behavior" id="ref-for-eventtarget-activation-behavior">activation behavior</a> is to run the following steps: 
     <ol>
      <li data-md>
       <p>Let <var>portalBrowsingContext</var> be the <a data-link-type="dfn" href="#htmlportalelement-guest-browsing-context" id="ref-for-htmlportalelement-guest-browsing-context①①">guest browsing context</a> of <var>el</var>.</p>
      <li data-md>
       <p>If <var>portalBrowsingContext</var> is null, return.</p>
      <li data-md>
       <p>Let <var>predecessorBrowsingContext</var> be the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-document-bc" id="ref-for-concept-document-bc③">browsing context</a> of <var>el</var>’s <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-node-document" id="ref-for-concept-node-document⑥">node
document</a>.</p>
      <li data-md>
       <p>If <var>predecessorBrowsingContext</var> is null, return.</p>
      <li data-md>
       <p>If the <a data-link-type="dfn" href="#portal-state" id="ref-for-portal-state①①">portal state</a> of <var>predecessorBrowsingContext</var> is not "<code>none</code>", return.</p>
      <li data-md>
       <p>Let <var>sourceOrigin</var> be <var>el</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object" id="ref-for-relevant-settings-object②">relevant settings object</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin" id="ref-for-concept-settings-object-origin②">origin</a>.</p>
      <li data-md>
       <p>Run the steps to <a data-link-type="dfn" href="#activate-a-portal-browsing-context" id="ref-for-activate-a-portal-browsing-context③">activate</a> <var>portalBrowsingContext</var> in place of <var>predecessorBrowsingContext</var> with <var>sourceOrigin</var>.</p>
     </ol>
     <div class="note" role="note"> This is substantially similar to the steps in <code class="idl"><a data-link-type="idl" href="#dom-htmlportalelement-activate" id="ref-for-dom-htmlportalelement-activate③">activate(options)</a></code>, with default options.
      User agents might wish to display suitable console messages under the same conditions that would
      result in promise rejection in those steps. </div>
    </section>
    <p>The following events are dispatched on <code class="idl"><a data-link-type="idl" href="#htmlportalelement" id="ref-for-htmlportalelement①">HTMLPortalElement</a></code> objects:</p>
    <table class="data">
     <thead>
      <tr>
       <th>Event name
       <th>Interface
       <th>Dispatched when
     <tbody>
      <tr>
       <td><dfn class="dfn-paneled idl-code" data-dfn-for="HTMLPortalElement" data-dfn-type="event" data-export id="eventdef-htmlportalelement-message"><code>message</code></dfn>
       <td><code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/comms.html#messageevent" id="ref-for-messageevent②">MessageEvent</a></code>
       <td>A message is received by the object, and deserialization does not throw an exception.
      <tr>
       <td><dfn class="dfn-paneled idl-code" data-dfn-for="HTMLPortalElement" data-dfn-type="event" data-export id="eventdef-htmlportalelement-messageerror"><code>messageerror</code></dfn>
       <td><code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/comms.html#messageevent" id="ref-for-messageevent③">MessageEvent</a></code>
       <td>A message is received by the object, but deserialization throws an exception.
    </table>
    <p>The <code><a data-link-type="element" href="#elementdef-portal" id="ref-for-elementdef-portal②④">portal</a></code> element exposes <code class="idl"><a data-link-type="idl" href="#dom-htmlportalelement-onmessage" id="ref-for-dom-htmlportalelement-onmessage">onmessage</a></code> and <code class="idl"><a data-link-type="idl" href="#dom-htmlportalelement-onmessageerror" id="ref-for-dom-htmlportalelement-onmessageerror">onmessageerror</a></code> as <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#event-handler-content-attributes" id="ref-for-event-handler-content-attributes">event handler content attributes</a>.</p>
    <details class="wpt-tests-block" dir="ltr" lang="en" open>
     <summary>Tests</summary>
     <ul class="wpt-tests-list">
      <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/portals/htmlportalelement-event-handler-content-attributes.html" title="portals/htmlportalelement-event-handler-content-attributes.html">htmlportalelement-event-handler-content-attributes.html</a> <a class="wpt-live" href="http://wpt.live/portals/htmlportalelement-event-handler-content-attributes.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/portals/htmlportalelement-event-handler-content-attributes.html"><small>(source)</small></a>
     </ul>
    </details>
    <h3 class="heading settled" data-level="3.1" id="the-portalhost-interface"><span class="secno">3.1. </span><span class="content">Portal hosts</span><a class="self-link" href="#the-portalhost-interface"></a></h3>
    <p>Every <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/window-object.html#window" id="ref-for-window">Window</a></code> has a <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="portal-host-object">portal host object</dfn>, which is a <code class="idl"><a data-link-type="idl" href="#portalhost" id="ref-for-portalhost①">PortalHost</a></code>. It is exposed
  through the <code class="idl"><a data-link-type="idl" href="#dom-window-portalhost" id="ref-for-dom-window-portalhost">portalHost</a></code> attribute getter at times when the window may be in a <a data-link-type="dfn" href="#portal-browsing-context" id="ref-for-portal-browsing-context①⓪">portal browsing context</a>.</p>
    <div class="note" role="note"> The <a data-link-type="dfn" href="#portal-host-object" id="ref-for-portal-host-object①">portal host object</a> can be used to communicate with the <a data-link-type="dfn" href="#host-browsing-context" id="ref-for-host-browsing-context②">host browsing context</a>. Its
    operations throw if used while its context is not a <a data-link-type="dfn" href="#portal-browsing-context" id="ref-for-portal-browsing-context①①">portal browsing context</a> (i.e. there is
    no host), in the event that JavaScript code has saved a reference to it. At such times, the <code class="idl"><a data-link-type="idl" href="#dom-window-portalhost" id="ref-for-dom-window-portalhost①">window.portalHost</a></code> getter will return null. </div>
<pre class="idl highlight def"><c- b>partial</c-> <c- b>interface</c-> <a class="idl-code" data-link-type="interface" href="https://html.spec.whatwg.org/multipage/window-object.html#window" id="ref-for-window①"><c- g>Window</c-></a> {
    <c- b>readonly</c-> <c- b>attribute</c-> <a data-link-type="idl-name" href="#portalhost" id="ref-for-portalhost②"><c- n>PortalHost</c-></a>? <a class="idl-code" data-link-type="attribute" data-readonly data-type="PortalHost?" href="#dom-window-portalhost" id="ref-for-dom-window-portalhost②"><c- g>portalHost</c-></a>;
};
</pre>
    <section class="algorithm" data-algorithm="window-portalhost">
      The <dfn class="dfn-paneled idl-code" data-dfn-for="Window" data-dfn-type="attribute" data-export id="dom-window-portalhost"><code>portalHost</code></dfn> attribute’s getter <em>must</em> run the following steps: 
     <ol>
      <li data-md>
       <p>Let <var>context</var> be <a data-link-type="dfn" href="https://heycam.github.io/webidl/#this" id="ref-for-this⑤">this</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/window-object.html#window-bc" id="ref-for-window-bc">browsing context</a>.</p>
      <li data-md>
       <p>If <var>context</var> is null or the <a data-link-type="dfn" href="#portal-state" id="ref-for-portal-state①②">portal state</a> of <var>context</var> is not "<code>portal</code>", then return null.</p>
      <li data-md>
       <p>Return <a data-link-type="dfn" href="https://heycam.github.io/webidl/#this" id="ref-for-this⑥">this</a>'s <a data-link-type="dfn" href="#portal-host-object" id="ref-for-portal-host-object②">portal host object</a>.</p>
     </ol>
    </section>
    <details class="wpt-tests-block" dir="ltr" lang="en" open>
     <summary>Tests</summary>
     <ul class="wpt-tests-list">
      <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/portals/portals-host-exposure.sub.html" title="portals/portals-host-exposure.sub.html">portals-host-exposure.sub.html</a> <a class="wpt-live" href="http://wpt.live/portals/portals-host-exposure.sub.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/portals/portals-host-exposure.sub.html"><small>(source)</small></a>
      <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/portals/portals-host-null.html" title="portals/portals-host-null.html">portals-host-null.html</a> <a class="wpt-live" href="http://wpt.live/portals/portals-host-null.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/portals/portals-host-null.html"><small>(source)</small></a>
     </ul>
    </details>
    <hr>
    <p>The <code class="idl"><a data-link-type="idl" href="#portalhost" id="ref-for-portalhost③">PortalHost</a></code> interface definition is as follows:</p>
<pre class="idl highlight def">[<a class="idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed" id="ref-for-Exposed①"><c- g>Exposed</c-></a>=<c- n>Window</c->]
<c- b>interface</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="interface" data-export id="portalhost"><code><c- g>PortalHost</c-></code></dfn> : <a data-link-type="idl-name" href="https://dom.spec.whatwg.org/#eventtarget" id="ref-for-eventtarget"><c- n>EventTarget</c-></a> {
    <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-undefined" id="ref-for-idl-undefined②"><c- b>undefined</c-></a> <a class="idl-code" data-link-type="method" href="#dom-portalhost-postmessage" id="ref-for-dom-portalhost-postmessage"><c- g>postMessage</c-></a>(<a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-any" id="ref-for-idl-any②"><c- b>any</c-></a> <dfn class="idl-code" data-dfn-for="PortalHost/postMessage(message, options), PortalHost/postMessage(message)" data-dfn-type="argument" data-export id="dom-portalhost-postmessage-message-options-message"><code><c- g>message</c-></code><a class="self-link" href="#dom-portalhost-postmessage-message-options-message"></a></dfn>, <c- b>optional</c-> <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/web-messaging.html#postmessageoptions" id="ref-for-postmessageoptions②"><c- n>PostMessageOptions</c-></a> <dfn class="idl-code" data-dfn-for="PortalHost/postMessage(message, options), PortalHost/postMessage(message)" data-dfn-type="argument" data-export id="dom-portalhost-postmessage-message-options-options"><code><c- g>options</c-></code><a class="self-link" href="#dom-portalhost-postmessage-message-options-options"></a></dfn> = {});

    <c- b>attribute</c-> <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler" id="ref-for-eventhandler②"><c- n>EventHandler</c-></a> <dfn class="idl-code" data-dfn-for="PortalHost" data-dfn-type="attribute" data-export data-type="EventHandler" id="dom-portalhost-onmessage"><code><c- g>onmessage</c-></code><a class="self-link" href="#dom-portalhost-onmessage"></a></dfn>;
    <c- b>attribute</c-> <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler" id="ref-for-eventhandler③"><c- n>EventHandler</c-></a> <dfn class="idl-code" data-dfn-for="PortalHost" data-dfn-type="attribute" data-export data-type="EventHandler" id="dom-portalhost-onmessageerror"><code><c- g>onmessageerror</c-></code><a class="self-link" href="#dom-portalhost-onmessageerror"></a></dfn>;
};
</pre>
    <section class="algorithm" data-algorithm="portalhost-postmessage">
      The <dfn class="dfn-paneled idl-code" data-dfn-for="PortalHost" data-dfn-type="method" data-export data-lt="postMessage(message, options)|postMessage(message)" id="dom-portalhost-postmessage"><code>postMessage(<var>message</var>, <var>options</var>)</code></dfn> method <em>must</em> run these steps: 
     <ol>
      <li data-md>
       <p>Let <var>browsingContext</var> be <a data-link-type="dfn" href="https://heycam.github.io/webidl/#this" id="ref-for-this⑦">this</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global" id="ref-for-concept-relevant-global">relevant global object</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/window-object.html#window-bc" id="ref-for-window-bc①">browsing context</a>.</p>
      <li data-md>
       <p>If <var>browsingContext</var> has a <a data-link-type="dfn" href="#portal-state" id="ref-for-portal-state①③">portal state</a> other than "<code>portal</code>", throw an "<code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#invalidstateerror" id="ref-for-invalidstateerror⑤">InvalidStateError</a></code>" <code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#idl-DOMException" id="ref-for-idl-DOMException⑤">DOMException</a></code>.</p>
       <p class="note" role="note"><span>Note:</span> This roughly means that it has not yet been activated, as far as this <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#event-loop" id="ref-for-event-loop">event loop</a> has been told.
It is possible that this browsing context will be <a data-link-type="dfn" href="#activate-a-portal-browsing-context" id="ref-for-activate-a-portal-browsing-context④">activated</a> in parallel
to this message being sent; in such cases, messages may not be delivered.</p>
      <li data-md>
       <p>Let <var>sourceOrigin</var> be <a data-link-type="dfn" href="https://heycam.github.io/webidl/#this" id="ref-for-this⑧">this</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object" id="ref-for-relevant-settings-object③">relevant settings object</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin" id="ref-for-concept-settings-object-origin③">origin</a>.</p>
      <li data-md>
       <p>Let <var>transfer</var> be <var>options</var>["<code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/web-messaging.html#dom-postmessageoptions-transfer" id="ref-for-dom-postmessageoptions-transfer②">transfer</a></code>"].</p>
      <li data-md>
       <p>Let <var>serializeWithTransferResult</var> be <a data-link-type="abstract-op" href="https://html.spec.whatwg.org/multipage/structured-data.html#structuredserializewithtransfer" id="ref-for-structuredserializewithtransfer②">StructuredSerializeWithTransfer</a>(<var>message</var>, <var>transfer</var>). Rethrow any exceptions.</p>
      <li data-md>
       <p>Let <var>hostElement</var> be the <a data-link-type="dfn" href="#host-element" id="ref-for-host-element⑨">host element</a> of <var>browsingContext</var>.</p>
      <li data-md>
       <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-an-element-task" id="ref-for-queue-an-element-task">Queue an element task</a> on the <a data-link-type="dfn" href="#portal-task-source" id="ref-for-portal-task-source⑤">portal task source</a> given <var>hostElement</var> to run the following steps:</p>
       <ol>
        <li data-md>
         <p>If <var>browsingContext</var> is not the <a data-link-type="dfn" href="#htmlportalelement-guest-browsing-context" id="ref-for-htmlportalelement-guest-browsing-context①②">guest browsing context</a> of <var>hostElement</var>, then abort these steps.</p>
         <p class="note" role="note"><span>Note:</span> This might happen if this <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#event-loop" id="ref-for-event-loop①">event loop</a> had a queued task to deliver a message, but
it was not executed before the portal was <a data-link-type="dfn" href="#activate-a-portal-browsing-context" id="ref-for-activate-a-portal-browsing-context⑤">activated</a>.
In such cases, the message is not delivered.</p>
        <li data-md>
         <p>Let <var>targetSettings</var> be the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object" id="ref-for-relevant-settings-object④">relevant settings object</a> of <var>hostElement</var>.</p>
        <li data-md>
         <p>If <var>targetSettings</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin" id="ref-for-concept-settings-object-origin④">origin</a> is not <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/origin.html#same-origin" id="ref-for-same-origin②">same origin</a> with <var>sourceOrigin</var>, then abort these steps.</p>
        <li data-md>
         <p>Let <var>origin</var> be the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/origin.html#ascii-serialisation-of-an-origin" id="ref-for-ascii-serialisation-of-an-origin①">serialization</a> of <var>sourceOrigin</var>.</p>
        <li data-md>
         <p>Let <var>targetRealm</var> be <var>targetSettings</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object&apos;s-realm" id="ref-for-environment-settings-object&apos;s-realm">realm</a>.</p>
        <li data-md>
         <p>Let <var>deserializeRecord</var> be <a data-link-type="abstract-op" href="https://html.spec.whatwg.org/multipage/structured-data.html#structureddeserializewithtransfer" id="ref-for-structureddeserializewithtransfer②">StructuredDeserializeWithTransfer</a>(<var>serializeWithTransferResult</var>, <var>targetRealm</var>).</p>
         <p>If this throws an exception, catch it, <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-event-fire" id="ref-for-concept-event-fire③">fire an event</a> named <code class="idl"><a class="idl-code" data-link-type="event" href="#eventdef-htmlportalelement-messageerror" id="ref-for-eventdef-htmlportalelement-messageerror">messageerror</a></code> at <var>element</var> using <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/comms.html#messageevent" id="ref-for-messageevent④">MessageEvent</a></code> with the <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/comms.html#dom-messageevent-origin" id="ref-for-dom-messageevent-origin②">origin</a></code> attribute initialized to <var>origin</var> and the <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/comms.html#dom-messageevent-source" id="ref-for-dom-messageevent-source②">source</a></code> attribute initialized to <var>element</var>.</p>
        <li data-md>
         <p>Let <var>messageClone</var> be <var>deserializeRecord</var>.[[Deserialized]].</p>
        <li data-md>
         <p>Let <var>newPorts</var> be a new <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-frozen-array-type" id="ref-for-dfn-frozen-array-type①">frozen array</a> consisting of all <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/web-messaging.html#messageport" id="ref-for-messageport①">MessagePort</a></code> objects in <var>deserializeRecord</var>.[[TransferredValues]], if any, maintaining their relative order.</p>
        <li data-md>
         <p><a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-event-fire" id="ref-for-concept-event-fire④">Fire an event</a> named <code class="idl"><a class="idl-code" data-link-type="event" href="#eventdef-htmlportalelement-message" id="ref-for-eventdef-htmlportalelement-message">message</a></code> at the <var>element</var> using <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/comms.html#messageevent" id="ref-for-messageevent⑤">MessageEvent</a></code>, with the <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/comms.html#dom-messageevent-origin" id="ref-for-dom-messageevent-origin③">origin</a></code> attribute
initialized to <var>origin</var>, the <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/comms.html#dom-messageevent-source" id="ref-for-dom-messageevent-source③">source</a></code> attribute initialized to <var>element</var>, the <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/comms.html#dom-messageevent-data" id="ref-for-dom-messageevent-data①">data</a></code> attribute
initialized to <var>messageClone</var>, and the <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/comms.html#dom-messageevent-ports" id="ref-for-dom-messageevent-ports①">ports</a></code> attribute initialized to <var>newPorts</var>.</p>
       </ol>
     </ol>
    </section>
    <details class="wpt-tests-block" dir="ltr" lang="en" open>
     <summary>Tests</summary>
     <ul class="wpt-tests-list">
      <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/portals/portals-host-post-message.sub.html" title="portals/portals-host-post-message.sub.html">portals-host-post-message.sub.html</a> <a class="wpt-live" href="http://wpt.live/portals/portals-host-post-message.sub.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/portals/portals-host-post-message.sub.html"><small>(source)</small></a>
     </ul>
    </details>
    <p>The following events are dispatched on <code class="idl"><a data-link-type="idl" href="#portalhost" id="ref-for-portalhost④">PortalHost</a></code> objects:</p>
    <table class="data">
     <thead>
      <tr>
       <th>Event name
       <th>Interface
       <th>Dispatched when
     <tbody>
      <tr>
       <td><dfn class="dfn-paneled idl-code" data-dfn-for="PortalHost" data-dfn-type="event" data-export id="eventdef-portalhost-message"><code>message</code></dfn>
       <td><code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/comms.html#messageevent" id="ref-for-messageevent⑥">MessageEvent</a></code>
       <td>A message is received by the object, and deserialization does not throw an exception.
      <tr>
       <td><dfn class="dfn-paneled idl-code" data-dfn-for="PortalHost" data-dfn-type="event" data-export id="eventdef-portalhost-messageerror"><code>messageerror</code></dfn>
       <td><code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/comms.html#messageevent" id="ref-for-messageevent⑦">MessageEvent</a></code>
       <td>A message is received by the object, but deserialization throws an exception.
    </table>
    <h3 class="heading settled" data-level="3.2" id="the-portalactivateevent-interface"><span class="secno">3.2. </span><span class="content">The <code>PortalActivateEvent</code> interface</span><a class="self-link" href="#the-portalactivateevent-interface"></a></h3>
<pre class="idl highlight def">[<a class="idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed" id="ref-for-Exposed②"><c- g>Exposed</c-></a>=<c- n>Window</c->]
<c- b>interface</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="interface" data-export id="portalactivateevent"><code><c- g>PortalActivateEvent</c-></code></dfn> : <a data-link-type="idl-name" href="https://dom.spec.whatwg.org/#event" id="ref-for-event"><c- n>Event</c-></a> {
    <dfn class="idl-code" data-dfn-for="PortalActivateEvent" data-dfn-type="constructor" data-export data-lt="PortalActivateEvent(type, eventInitDict)|constructor(type, eventInitDict)|PortalActivateEvent(type)|constructor(type)" id="dom-portalactivateevent-portalactivateevent"><code><c- g>constructor</c-></code><a class="self-link" href="#dom-portalactivateevent-portalactivateevent"></a></dfn>(<a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString" id="ref-for-idl-DOMString①"><c- b>DOMString</c-></a> <dfn class="idl-code" data-dfn-for="PortalActivateEvent/PortalActivateEvent(type, eventInitDict), PortalActivateEvent/constructor(type, eventInitDict), PortalActivateEvent/PortalActivateEvent(type), PortalActivateEvent/constructor(type)" data-dfn-type="argument" data-export id="dom-portalactivateevent-portalactivateevent-type-eventinitdict-type"><code><c- g>type</c-></code><a class="self-link" href="#dom-portalactivateevent-portalactivateevent-type-eventinitdict-type"></a></dfn>, <c- b>optional</c-> <a data-link-type="idl-name" href="#dictdef-portalactivateeventinit" id="ref-for-dictdef-portalactivateeventinit"><c- n>PortalActivateEventInit</c-></a> <dfn class="idl-code" data-dfn-for="PortalActivateEvent/PortalActivateEvent(type, eventInitDict), PortalActivateEvent/constructor(type, eventInitDict), PortalActivateEvent/PortalActivateEvent(type), PortalActivateEvent/constructor(type)" data-dfn-type="argument" data-export id="dom-portalactivateevent-portalactivateevent-type-eventinitdict-eventinitdict"><code><c- g>eventInitDict</c-></code><a class="self-link" href="#dom-portalactivateevent-portalactivateevent-type-eventinitdict-eventinitdict"></a></dfn> = {});

    <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-any" id="ref-for-idl-any③"><c- b>any</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="PortalActivateEvent" data-dfn-type="attribute" data-export data-readonly data-type="any" id="dom-portalactivateevent-data"><code><c- g>data</c-></code></dfn>;
    <a data-link-type="idl-name" href="#htmlportalelement" id="ref-for-htmlportalelement②"><c- n>HTMLPortalElement</c-></a> <a class="idl-code" data-link-type="method" href="#dom-portalactivateevent-adoptpredecessor" id="ref-for-dom-portalactivateevent-adoptpredecessor②"><c- g>adoptPredecessor</c-></a>();
};

<c- b>dictionary</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="dictionary" data-export id="dictdef-portalactivateeventinit"><code><c- g>PortalActivateEventInit</c-></code></dfn> : <a data-link-type="idl-name" href="https://dom.spec.whatwg.org/#dictdef-eventinit" id="ref-for-dictdef-eventinit"><c- n>EventInit</c-></a> {
    <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-any" id="ref-for-idl-any④"><c- b>any</c-></a> <dfn class="idl-code" data-default="null" data-dfn-for="PortalActivateEventInit" data-dfn-type="dict-member" data-export data-type="any " id="dom-portalactivateeventinit-data"><code><c- g>data</c-></code><a class="self-link" href="#dom-portalactivateeventinit-data"></a></dfn> = <c- b>null</c->;
};
</pre>
    <div class="note" role="note"> For now, there is no <code>ports</code> attribute on <code class="idl"><a data-link-type="idl" href="#portalactivateevent" id="ref-for-portalactivateevent①">PortalActivateEvent</a></code>, despite it being
    used for data transfer in a similar way to <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/comms.html#messageevent" id="ref-for-messageevent⑧">MessageEvent</a></code>. This omission is for simplicity,
    and could be reconsidered if a use case is found. (See also <a href="https://github.com/whatwg/html/issues/4521">whatwg/html#4521</a> for a potential
    expansion.) </div>
    <p>A <code class="idl"><a data-link-type="idl" href="#portalactivateevent" id="ref-for-portalactivateevent②">PortalActivateEvent</a></code> has an associated <dfn class="dfn-paneled" data-dfn-for="PortalActivateEvent" data-dfn-type="dfn" data-noexport id="portalactivateevent-predecessor-browsing-context">predecessor browsing context</dfn>,
  which is a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#top-level-browsing-context" id="ref-for-top-level-browsing-context③">top-level browsing context</a> or null, a <dfn class="dfn-paneled" data-dfn-for="PortalActivateEvent" data-dfn-type="dfn" data-noexport id="portalactivateevent-successor-window">successor window</dfn>, which is
  a <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/window-object.html#window" id="ref-for-window②">Window</a></code>, an <dfn class="dfn-paneled" data-dfn-for="PortalActivateEvent" data-dfn-type="dfn" data-noexport id="portalactivateevent-activation-promise">activation promise</dfn>, which is a <a data-link-type="dfn" href="http://tc39.github.io/ecma262/#sec-promise-objects" id="ref-for-sec-promise-objects①">promise</a> or null, and a <dfn class="dfn-paneled" data-dfn-for="PortalActivateEvent" data-dfn-type="dfn" data-noexport id="portalactivateevent-adopted-predecessor-element">adopted predecessor element</dfn>, which is a <code><a data-link-type="element" href="#elementdef-portal" id="ref-for-elementdef-portal②⑤">portal</a></code> element or null.</p>
    <section class="algorithm" data-algorithm="portalactivateevent-event-constructing-steps">
      The <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-event-constructor-ext" id="ref-for-concept-event-constructor-ext">event constructing steps</a> for <code class="idl"><a data-link-type="idl" href="#portalactivateevent" id="ref-for-portalactivateevent③">PortalActivateEvent</a></code>, given an <var>event</var>, are as follows: 
     <ol>
      <li data-md>
       <p>Set <var>event</var>’s <a data-link-type="dfn" href="#portalactivateevent-predecessor-browsing-context" id="ref-for-portalactivateevent-predecessor-browsing-context①">predecessor browsing context</a> to null.</p>
      <li data-md>
       <p>Set <var>event</var>’s <a data-link-type="dfn" href="#portalactivateevent-successor-window" id="ref-for-portalactivateevent-successor-window①">successor window</a> to null.</p>
      <li data-md>
       <p>Set <var>event</var>’s <a data-link-type="dfn" href="#portalactivateevent-adopted-predecessor-element" id="ref-for-portalactivateevent-adopted-predecessor-element①">adopted predecessor element</a> to null.</p>
     </ol>
    </section>
    <details class="wpt-tests-block" dir="ltr" lang="en" open>
     <summary>Tests</summary>
     <ul class="wpt-tests-list">
      <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/portals/portal-activate-event-constructor.html" title="portals/portal-activate-event-constructor.html">portal-activate-event-constructor.html</a> <a class="wpt-live" href="http://wpt.live/portals/portal-activate-event-constructor.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/portals/portal-activate-event-constructor.html"><small>(source)</small></a>
     </ul>
    </details>
    <section class="algorithm" data-algorithm="portalactivateevent-adoptpredecessor">
      The <dfn class="dfn-paneled idl-code" data-dfn-for="PortalActivateEvent" data-dfn-type="method" data-export id="dom-portalactivateevent-adoptpredecessor"><code>adoptPredecessor()</code></dfn> method <em>must</em> run these steps: 
     <ol>
      <li data-md>
       <p>If <a data-link-type="dfn" href="https://heycam.github.io/webidl/#this" id="ref-for-this⑨">this</a>'s <a data-link-type="dfn" href="#portalactivateevent-adopted-predecessor-element" id="ref-for-portalactivateevent-adopted-predecessor-element②">adopted predecessor element</a> is not null, throw an "<code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#invalidstateerror" id="ref-for-invalidstateerror⑥">InvalidStateError</a></code>" <code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#idl-DOMException" id="ref-for-idl-DOMException⑥">DOMException</a></code>.</p>
      <li data-md>
       <p>Let <var>predecessorBrowsingContext</var> be <a data-link-type="dfn" href="https://heycam.github.io/webidl/#this" id="ref-for-this①⓪">this</a>'s <a data-link-type="dfn" href="#portalactivateevent-predecessor-browsing-context" id="ref-for-portalactivateevent-predecessor-browsing-context②">predecessor browsing context</a>.</p>
      <li data-md>
       <p>Let <var>successorWindow</var> be <a data-link-type="dfn" href="https://heycam.github.io/webidl/#this" id="ref-for-this①①">this</a>'s <a data-link-type="dfn" href="#portalactivateevent-successor-window" id="ref-for-portalactivateevent-successor-window②">successor window</a>.</p>
      <li data-md>
       <p>Run the steps to <a data-link-type="dfn" href="#adopt-the-predecessor-browsing-context" id="ref-for-adopt-the-predecessor-browsing-context④">adopt the predecessor browsing context</a> <var>predecessorBrowsingContext</var> in <var>successorWindow</var>,
and let <var>adoptedPredecessorElement</var> be the result.</p>
      <li data-md>
       <p>Set <a data-link-type="dfn" href="https://heycam.github.io/webidl/#this" id="ref-for-this①②">this</a>'s <a data-link-type="dfn" href="#portalactivateevent-adopted-predecessor-element" id="ref-for-portalactivateevent-adopted-predecessor-element③">adopted predecessor element</a> to <var>adoptedPredecessorElement</var>.</p>
      <li data-md>
       <p>If <a data-link-type="dfn" href="https://heycam.github.io/webidl/#this" id="ref-for-this①③">this</a>'s <a data-link-type="dfn" href="#portalactivateevent-activation-promise" id="ref-for-portalactivateevent-activation-promise②">activation promise</a> is not null, <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task" id="ref-for-queue-a-global-task⑤">queue a global task</a> on the <a data-link-type="dfn" href="#portal-task-source" id="ref-for-portal-task-source⑥">portal task source</a> given <var>predecessorBrowsingContext</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#active-window" id="ref-for-active-window④">active window</a> to resolve it with undefined.</p>
       <p class="note" role="note"><span>Note:</span> Queuing this immediately makes it possible to send messages to the adopted
portal during dispatch of the <code class="idl"><a class="idl-code" data-link-type="event" href="#eventdef-window-portalactivate" id="ref-for-eventdef-window-portalactivate③">portalactivate</a></code> event without
ordering issues between the task to resolve the activation promise and the task
to deliver the message.</p>
      <li data-md>
       <p>Return <var>adoptedPredecessorElement</var>.</p>
     </ol>
     <details class="wpt-tests-block" dir="ltr" lang="en" open>
      <summary>Tests</summary>
      <ul class="wpt-tests-list">
       <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/portals/portals-adopt-predecessor.html" title="portals/portals-adopt-predecessor.html">portals-adopt-predecessor.html</a> <a class="wpt-live" href="http://wpt.live/portals/portals-adopt-predecessor.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/portals/portals-adopt-predecessor.html"><small>(source)</small></a>
      </ul>
     </details>
    </section>
   </section>
   <section>
    <h2 class="heading settled" data-level="4" id="miscellaneous-extensions"><span class="secno">4. </span><span class="content">Miscellaneous HTML updates</span><a class="self-link" href="#miscellaneous-extensions"></a></h2>
    <p><em>This section contains various small patches to miscellaneous areas of the HTML Standard.</em></p>
    <h3 class="heading settled" data-level="4.1" id="patch-messageevent"><span class="secno">4.1. </span><span class="content">The <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/comms.html#messageevent" id="ref-for-messageevent⑨">MessageEvent</a></code> interface</span><a class="self-link" href="#patch-messageevent"></a></h3>
    <p>The <code class="idl"><a data-link-type="idl" href="#typedefdef-messageeventsource" id="ref-for-typedefdef-messageeventsource">MessageEventSource</a></code> union is extended to include the new interfaces
  which can produce <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/comms.html#messageevent" id="ref-for-messageevent①⓪">MessageEvent</a></code> events.</p>
<pre class="idl highlight def"><c- b>typedef</c-> (<a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/window-object.html#windowproxy" id="ref-for-windowproxy②"><c- n>WindowProxy</c-></a> <c- b>or</c-> <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/web-messaging.html#messageport" id="ref-for-messageport②"><c- n>MessagePort</c-></a> <c- b>or</c-> <a data-link-type="idl-name" href="https://w3c.github.io/ServiceWorker/#serviceworker" id="ref-for-serviceworker"><c- n>ServiceWorker</c-></a> <c- b>or</c-> <a data-link-type="idl-name" href="#htmlportalelement" id="ref-for-htmlportalelement③"><c- n>HTMLPortalElement</c-></a> <c- b>or</c-> <a data-link-type="idl-name" href="#portalhost" id="ref-for-portalhost⑤"><c- n>PortalHost</c-></a>) <dfn class="dfn-paneled idl-code" data-dfn-type="typedef" data-export id="typedefdef-messageeventsource"><code><c- g>MessageEventSource</c-></code></dfn>;
</pre>
    <h3 class="heading settled" data-level="4.2" id="patch-event-handlers"><span class="secno">4.2. </span><span class="content">Event handlers</span><a class="self-link" href="#patch-event-handlers"></a></h3>
    <p>The table of <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#event-handlers" id="ref-for-event-handlers">event handlers</a> which must be supported by <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/window-object.html#window" id="ref-for-window③">Window</a></code> objects, as <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#event-handler-idl-attributes" id="ref-for-event-handler-idl-attributes">event handler
  IDL attributes</a> on the <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/window-object.html#window" id="ref-for-window④">Window</a></code> objects themselves (i.e. the table containing <code>onafterprint</code>),
  gets extended with the following row:</p>
    <table class="data">
     <thead>
      <tr>
       <th><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#event-handlers" id="ref-for-event-handlers①">Event handler</a>
       <th><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#event-handler-event-type" id="ref-for-event-handler-event-type">Event handler event type</a>
     <tbody>
      <tr>
       <td><dfn class="idl-code" data-dfn-for="Window" data-dfn-type="attribute" data-export id="dom-window-onportalactivate"><code>onportalactivate</code><a class="self-link" href="#dom-window-onportalactivate"></a></dfn>
       <td><code class="idl"><a data-link-type="idl" href="#eventdef-window-portalactivate" id="ref-for-eventdef-window-portalactivate④">portalactivate</a></code>
    </table>
    <p>The corresponding <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/webappapis.html#windoweventhandlers" id="ref-for-windoweventhandlers">WindowEventHandlers</a></code> mixin gets extended as follows:</p>
<pre class="idl highlight def"><c- b>partial</c-> <c- b>interface</c-> <c- b>mixin</c-> <a class="idl-code" data-link-type="interface" href="https://html.spec.whatwg.org/multipage/webappapis.html#windoweventhandlers" id="ref-for-windoweventhandlers①"><c- g>WindowEventHandlers</c-></a> {
    <c- b>attribute</c-> <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler" id="ref-for-eventhandler④"><c- n>EventHandler</c-></a> <dfn class="idl-code" data-dfn-for="WindowEventHandlers" data-dfn-type="attribute" data-export data-type="EventHandler" id="dom-windoweventhandlers-onportalactivate"><code><c- g>onportalactivate</c-></code><a class="self-link" href="#dom-windoweventhandlers-onportalactivate"></a></dfn>;
};
</pre>
    <p>The <a href="https://html.spec.whatwg.org/#events-2">Events index</a> is also updated with the
  following additional row:</p>
    <table class="data">
     <thead>
      <tr>
       <th>Event
       <th>Interface
       <th>Interesting targets
       <th>Description
     <tbody>
      <tr>
       <td><dfn class="dfn-paneled idl-code" data-dfn-for="Window" data-dfn-type="event" data-export id="eventdef-window-portalactivate"><code>portalactivate</code></dfn>
       <td><code class="idl"><a data-link-type="idl" href="#portalactivateevent" id="ref-for-portalactivateevent④">PortalActivateEvent</a></code>
       <td><code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/window-object.html#window" id="ref-for-window⑤">Window</a></code>
       <td>Fired at the <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/window-object.html#window" id="ref-for-window⑥">Window</a></code> of a <a data-link-type="dfn" href="#portal-browsing-context" id="ref-for-portal-browsing-context①②">portal browsing context</a> when that <a data-link-type="dfn" href="#portal-browsing-context" id="ref-for-portal-browsing-context①③">portal browsing
        context</a> is activated.
    </table>
    <h3 class="heading settled" data-level="4.3" id="patch-window-apis"><span class="secno">4.3. </span><span class="content">APIs for creating and navigating browsing contexts by name</span><a class="self-link" href="#patch-window-apis"></a></h3>
    <p>Modify the definition of <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/window-object.html#script-closable" id="ref-for-script-closable">script-closable</a> to prevent window closing while in a <a data-link-type="dfn" href="#portal-browsing-context" id="ref-for-portal-browsing-context①④">portal browsing context</a>:</p>
    <p>A <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#browsing-context" id="ref-for-browsing-context⑤">browsing context</a> is <dfn data-dfn-type="dfn" data-noexport id="script-closable">script-closable<a class="self-link" href="#script-closable"></a></dfn> if either of the following is true:</p>
    <ul>
     <li data-md>
      <p>it is an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#auxiliary-browsing-context" id="ref-for-auxiliary-browsing-context①">auxiliary browsing context</a> that was created by script (as opposed to by an action
of the user); or</p>
     <li data-md>
      <p>
       it is a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#top-level-browsing-context" id="ref-for-top-level-browsing-context④">top-level browsing context</a> 
       <ins>whose <a data-link-type="dfn" href="#portal-state" id="ref-for-portal-state①④">portal state</a> is "<code>none</code>"</ins>
        and whose <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/history.html#session-history" id="ref-for-session-history②">session history</a> contains only one <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#document" id="ref-for-document③">Document</a></code>.
      </p>
    </ul>
    <details class="wpt-tests-block" dir="ltr" lang="en" open>
     <summary>Tests</summary>
     <ul class="wpt-tests-list">
      <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/portals/portals-close-window.html" title="portals/portals-close-window.html">portals-close-window.html</a> <a class="wpt-live" href="http://wpt.live/portals/portals-close-window.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/portals/portals-close-window.html"><small>(source)</small></a>
     </ul>
    </details>
    <h3 class="heading settled" data-level="4.4" id="patch-navigation"><span class="secno">4.4. </span><span class="content">Navigation</span><a class="self-link" href="#patch-navigation"></a></h3>
    <p>Patch the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#navigate" id="ref-for-navigate②">navigate</a> algorithm to prevent certain navigations in a
  portal as follows:</p>
    <div class="algorithm" data-algorithm="process a navigate response patch">
      In <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#process-a-navigate-response" id="ref-for-process-a-navigate-response">process a navigate response</a>, append the following after the step which
    establishes the value of <var>failure</var>, but before the step which uses it to display an error page: 
     <ol>
      <li data-md>
       <p>If <var>browsingContext</var>’s <a data-link-type="dfn" href="#portal-state" id="ref-for-portal-state①⑤">portal state</a> is not "<code>none</code>", and any of the following hold:</p>
       <ul>
        <li data-md>
         <p><var>failure</var> is true;</p>
        <li data-md>
         <p><var>navigationParams</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#navigation-params-request" id="ref-for-navigation-params-request">request</a> is null;</p>
        <li data-md>
         <p><var>navigationParams</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#navigation-params-request" id="ref-for-navigation-params-request①">request</a>'s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-current-url" id="ref-for-concept-request-current-url">current URL</a>'s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-scheme" id="ref-for-concept-url-scheme①">scheme</a> is not a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#http-scheme" id="ref-for-http-scheme②">HTTP(S) scheme</a>;</p>
        <li data-md>
         <p><var>response</var> has a `<code>Content-Disposition</code>` header specifying the <code>attachment</code> disposition type; or</p>
        <li data-md>
         <p><var>response</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-status" id="ref-for-concept-response-status">status</a> is 204 or 205,</p>
       </ul>
       <p>then:</p>
       <ol>
        <li data-md>
         <p>If <var>browsingContext</var>’s only entry in its <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/history.html#session-history" id="ref-for-session-history③">session history</a> is the initial <code>about:blank</code> <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#document" id="ref-for-document④">Document</a></code>, then:</p>
         <ol>
          <li data-md>
           <p><a data-link-type="dfn" href="#close-a-portal-element" id="ref-for-close-a-portal-element①">Close</a> <var>browsingContext</var>’s <a data-link-type="dfn" href="#host-element" id="ref-for-host-element①⓪">host element</a>.</p>
          <li data-md>
           <p>Run the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-discarding-steps" id="ref-for-environment-discarding-steps">environment discarding steps</a> for <var>navigationParam</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#navigation-params-reserved-environment" id="ref-for-navigation-params-reserved-environment">reserved environment</a>.</p>
         </ol>
        <li data-md>
         <p>Return.</p>
       </ol>
     </ol>
    </div>
    <div class="algorithm" data-algorithm="process a navigate URL scheme patch">
      In <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#process-a-navigate-url-scheme" id="ref-for-process-a-navigate-url-scheme">process a navigate URL scheme</a>, insert the following step before the step
    which displays inline content: 
     <ol>
      <li data-md>
       <p>Otherwise, if <var>browsingContext</var>’s <a data-link-type="dfn" href="#portal-state" id="ref-for-portal-state①⑥">portal state</a> is not "<code>none</code>", then <a data-link-type="dfn" href="#close-a-portal-element" id="ref-for-close-a-portal-element②">close</a> <var>browsingContext</var>’s <a data-link-type="dfn" href="#host-element" id="ref-for-host-element①①">host element</a>.</p>
     </ol>
    </div>
    <details class="wpt-tests-block" dir="ltr" lang="en" open>
     <summary>Tests</summary>
     <ul class="wpt-tests-list">
      <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/portals/portal-non-http-navigation.html" title="portals/portal-non-http-navigation.html">portal-non-http-navigation.html</a> <a class="wpt-live" href="http://wpt.live/portals/portal-non-http-navigation.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/portals/portal-non-http-navigation.html"><small>(source)</small></a>
     </ul>
    </details>
    <h3 class="heading settled" data-level="4.5" id="patch-downloading"><span class="secno">4.5. </span><span class="content">Downloading resources</span><a class="self-link" href="#patch-downloading"></a></h3>
    <p>Modify the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/links.html#allowed-to-download" id="ref-for-allowed-to-download">allowed to download</a> algorithm to ensure that portaled content never
  performs downloads, by prepending the following steps:</p>
    <div class="algorithm" data-algorithm="allowed to download patch">
     <ol>
      <li data-md>
       <p>If <var>initiator browsing context</var>’s <a data-link-type="dfn" href="#portal-state" id="ref-for-portal-state①⑦">portal state</a> is not "<code>none</code>", then
return false.</p>
      <li data-md>
       <p>If <var>instantiator browsing context</var>’s <a data-link-type="dfn" href="#portal-state" id="ref-for-portal-state①⑧">portal state</a> is not "<code>none</code>", then
return false.</p>
     </ol>
    </div>
   </section>
   <section>
    <h2 class="heading settled" data-level="5" id="other-spec-updates"><span class="secno">5. </span><span class="content">Updates to other specifications</span><a class="self-link" href="#other-spec-updates"></a></h2>
    <h3 class="heading settled" data-level="5.1" id="csp"><span class="secno">5.1. </span><span class="content">Content Security Policy</span><a class="self-link" href="#csp"></a></h3>
    <p>This specification integrates with <a data-link-type="biblio" href="#biblio-csp">[CSP]</a> as follows.</p>
    <p class="issue" id="issue-0eeb18ac"><a class="self-link" href="#issue-0eeb18ac"></a>Although <code>navigate-to</code> works as expected while the content is portaled, we also
  need to apply it to prevent activation (which is basically a navigation). This is not yet specced,
  pending spec updates to the navigation and session history handling.</p>
    <p>The following new subsection of <a href="https://www.w3.org/TR/CSP3/#directives-fetch"><cite>Content Security Policy</cite> § 6.1 Fetch Directives</a> is added:</p>
    <h4 class="heading settled" data-level="5.1.1" id="portal-src-directive"><span class="secno">5.1.1. </span><span class="content"><code>portal-src</code></span><a class="self-link" href="#portal-src-directive"></a></h4>
    <p>The <dfn class="dfn-paneled" data-dfn-type="dfn" data-export id="portal-src">portal-src</dfn> directive restricts the URLs which may be loaded into <a data-link-type="dfn" href="#portal-browsing-context" id="ref-for-portal-browsing-context①⑤">portal
  browsing contexts</a>. The syntax for the directive’s name and value is described by the following
  ABNF:</p>
<pre class="highlight"><c- nc>directive-name</c->  <c- o>=</c-> <c- l>"portal-src"</c->
<c- nc>directive-value</c-> <c- o>=</c-> <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-serialized-source-list" id="ref-for-grammardef-serialized-source-list"><c- nc>serialized-source-list</c-></a>
</pre>
    <div class="example" id="example-portal-src">
     <a class="self-link" href="#example-portal-src"></a> Given a page with the following Content Security Policy: 
<pre><a data-link-type="http-header" href="https://w3c.github.io/webappsec-csp/#header-content-security-policy" id="ref-for-header-content-security-policy">Content-Security-Policy</a>: <a data-link-type="dfn" href="#portal-src" id="ref-for-portal-src">portal-src</a> https://example.com/
</pre>
     <p>Fetches for the following code will return a network errors, and thus result in <a data-link-type="dfn" href="#close-a-portal-element" id="ref-for-close-a-portal-element③">closing</a> the portal, as the URL provided does not match <code>portal-src</code>'s <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#source-lists" id="ref-for-source-lists">source list</a>:</p>
<pre class="highlight"><c- p>&lt;</c-><c- f>portal</c-> <c- e>src</c-><c- o>=</c-><c- s>"https://example.org/"</c-><c- p>>&lt;/</c-><c- f>portal</c-><c- p>></c->
</pre>
    </div>
    <h5 class="heading settled" data-level="5.1.1.1" id="portal-src-pre-request"><span class="secno">5.1.1.1. </span><span class="content"><code>portal-src</code> Pre-request check</span><a class="self-link" href="#portal-src-pre-request"></a></h5>
    <p>This directive’s <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directive-pre-request-check" id="ref-for-directive-pre-request-check">pre-request check</a> is as follows:</p>
    <div class="algorithm" data-algorithm="portal-src pre-request check">
      Given a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request" id="ref-for-concept-request①">request</a> <var>request</var> and a policy <var>policy</var>: 
     <ol>
      <li data-md>
       <p>Let <var>name</var> be the result of executing <a href="https://www.w3.org/TR/CSP3/#effective-directive-for-a-request"><cite>Content Security Policy</cite> § 6.7.1 Get the effective directive for request</a> on <var>request</var>.</p>
      <li data-md>
       <p>If the result of executing <a href="https://www.w3.org/TR/CSP3/#should-directive-execute"><cite>Content Security Policy</cite> § 6.7.4 Should fetch directive execute</a> on <var>name</var>, <code>portal-src</code> and <var>policy</var> is "<code>No</code>", return "<code>Allowed</code>".</p>
      <li data-md>
       <p>If the result of executing <a href="https://www.w3.org/TR/CSP3/#match-request-to-source-list"><cite>Content Security Policy</cite> § 6.6.2.3 Does request match source list?</a> on <var>request</var>, this directive’s <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directive-value" id="ref-for-directive-value">value</a>, and <var>policy</var> is "<code>Does Not Match</code>", return "<code>Blocked</code>".</p>
      <li data-md>
       <p>Return "<code>Allowed</code>".</p>
     </ol>
    </div>
    <h5 class="heading settled" data-level="5.1.1.2" id="portal-src-post-request"><span class="secno">5.1.1.2. </span><span class="content"><code>portal-src</code> Post-request check</span><a class="self-link" href="#portal-src-post-request"></a></h5>
    <p>This directive’s <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directive-post-request-check" id="ref-for-directive-post-request-check">post-request check</a> is as follows:</p>
    <div class="algorithm" data-algorithm="portal-src post-request check">
      Given a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request" id="ref-for-concept-request②">request</a> <var>request</var>, a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response" id="ref-for-concept-response">response</a> <var>response</var>, and a policy <var>policy</var>: 
     <ol>
      <li data-md>
       <p>Let <var>name</var> be the result of executing <a href="https://www.w3.org/TR/CSP3/#effective-directive-for-a-request"><cite>Content Security Policy</cite> § 6.7.1 Get the effective directive for request</a> on <var>request</var>.</p>
      <li data-md>
       <p>If the result of executing <a href="https://www.w3.org/TR/CSP3/#should-directive-execute"><cite>Content Security Policy</cite> § 6.7.4 Should fetch directive execute</a> on <var>name</var>, <code>portal-src</code> and <var>policy</var> is "<code>No</code>", return "<code>Allowed</code>".</p>
      <li data-md>
       <p>If the result of executing <a href="https://www.w3.org/TR/CSP3/#match-response-to-source-list"><cite>Content Security Policy</cite> § 6.6.2.4 Does response to request match source list?</a> on <var>response</var>, <var>request</var>,
this directive’s <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directive-value" id="ref-for-directive-value①">value</a>, and <var>policy</var> is "<code>Does Not Match</code>", return
"<code>Blocked</code>".</p>
      <li data-md>
       <p>Return "<code>Allowed</code>".</p>
     </ol>
    </div>
    <h4 class="heading settled" data-level="5.1.2" id="default-src-patch"><span class="secno">5.1.2. </span><span class="content"><code>default-src</code></span><a class="self-link" href="#default-src-patch"></a></h4>
    <p>The informative example text which expands it into all other fetch directives in <a href="https://www.w3.org/TR/CSP3/#directive-default-src"><cite>Content Security Policy</cite> § 6.1.3 default-src</a> will need updating to include <a data-link-type="dfn" href="#portal-src" id="ref-for-portal-src①">portal-src</a>.</p>
    <h4 class="heading settled" data-level="5.1.3" id="directive-fallback-list-patch"><span class="secno">5.1.3. </span><span class="content">Get fetch directive fallback list</span><a class="self-link" href="#directive-fallback-list-patch"></a></h4>
    <p>The algorithm in <a href="https://www.w3.org/TR/CSP3/#directive-fallback-list"><cite>Content Security Policy</cite> § 6.7.3 Get fetch directive fallback list</a> needs updating to account for the new <a data-link-type="dfn" href="#portal-src" id="ref-for-portal-src②">portal-src</a> fetch directive. Add a new case to step 1:</p>
    <dl class="switch">
     <dt data-md>"<code>portal-src</code>"
     <dd data-md>
      <ol>
       <li data-md>
        <p>Return « "<code>portal-src</code>", "<code>prefetch-src</code>", "<code>default-src</code>" ».</p>
      </ol>
    </dl>
    <h3 class="heading settled" data-level="5.2" id="fetch-metadata"><span class="secno">5.2. </span><span class="content">Fetch Metadata Request Headers</span><a class="self-link" href="#fetch-metadata"></a></h3>
    <p>This specification integrates with <a data-link-type="biblio" href="#biblio-fetch-metadata">[FETCH-METADATA]</a> as follows.</p>
    <section class="algorithm" data-algorithm="fetch-metadata-set-mode">
      The algorithm to <a href="https://www.w3.org/TR/fetch-metadata/#abstract-opdef-set-mode">set the Sec-Fetch-Mode header</a> for a request <var>r</var> is modified as follows: 
     <ol>
      <li data-md>
       <p>Where the algorithm checks whether <var>r</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-reserved-client" id="ref-for-concept-request-reserved-client">reserved client</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-target-browsing-context" id="ref-for-concept-environment-target-browsing-context">target
browsing context</a> is a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#nested-browsing-context" id="ref-for-nested-browsing-context④">nested browsing context</a>, check instead whether it is a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#nested-browsing-context" id="ref-for-nested-browsing-context⑤">nested
browsing context</a> or a <a data-link-type="dfn" href="#portal-browsing-context" id="ref-for-portal-browsing-context①⑥">portal browsing context</a>.</p>
     </ol>
    </section>
    <div class="note" role="note">
      The effect of this is that the request for a document in a <a data-link-type="dfn" href="#portal-browsing-context" id="ref-for-portal-browsing-context①⑦">portal browsing context</a> will contain the following HTTP header, as though it were in a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#nested-browsing-context" id="ref-for-nested-browsing-context⑥">nested browsing context</a>. 
<pre>    Sec-Fetch-Mode: nested-navigate
</pre>
    </div>
    <div class="note" role="note"> Per the existing processing model, the other fetch metadata headers will automatically have the
    same values as they would would if the load were occurring in an <code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/iframe-embed-object.html#the-iframe-element" id="ref-for-the-iframe-element③">iframe</a></code> element, with no
    spec updates needed. </div>
   </section>
   <section>
    <h2 class="heading settled" data-level="6" id="security-considerations"><span class="secno">6. </span><span class="content">Security Considerations</span><a class="self-link" href="#security-considerations"></a></h2>
    <div class="issue" id="issue-8e856747"><a class="self-link" href="#issue-8e856747"></a> We should expand this section further. Much of what was formerly there is in <a href="#other-spec-updates">§ 5 Updates to other specifications</a> now. Once we have a more comprehensive view of all the security-related
    spec updates, we should summarize them in a non-normative fashion here. </div>
    <h3 class="heading settled" data-level="6.1" id="security-overview"><span class="secno">6.1. </span><span class="content">Overview</span><a class="self-link" href="#security-overview"></a></h3>
    <p><em>This section is non-normative.</em></p>
    <p>In general, a <a data-link-type="dfn" href="#portal-browsing-context" id="ref-for-portal-browsing-context①⑧">portal browsing context</a> should respect policies that would apply to
  a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#nested-browsing-context" id="ref-for-nested-browsing-context⑦">nested browsing context</a>, e.g. that would restrict whether a document can be embedded
  in a document from another <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/origin.html#concept-origin" id="ref-for-concept-origin①">origin</a>.</p>
   </section>
   <section>
    <h2 class="heading settled" data-level="7" id="untriaged-tests"><span class="secno">7. </span><span class="content">Untriaged tests</span><a class="self-link" href="#untriaged-tests"></a></h2>
    <p>In order to get this spec to build without warnings, we need to include all the web platform tests
  explicitly. This section contains all the tests which we haven’t yet written spec text for, or
  haven’t triaged into the appropriate sections.</p>
    <details class="wpt-tests-block" dir="ltr" lang="en" open>
     <summary>Tests</summary>
     <ul class="wpt-tests-list">
      <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/portals/history/history-manipulation-inside-portal-with-subframes.html" title="portals/history/history-manipulation-inside-portal-with-subframes.html">history-manipulation-inside-portal-with-subframes.html</a> <a class="wpt-live" href="http://wpt.live/portals/history/history-manipulation-inside-portal-with-subframes.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/portals/history/history-manipulation-inside-portal-with-subframes.html"><small>(source)</small></a>
      <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/portals/history/history-manipulation-inside-portal.html" title="portals/history/history-manipulation-inside-portal.html">history-manipulation-inside-portal.html</a> <a class="wpt-live" href="http://wpt.live/portals/history/history-manipulation-inside-portal.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/portals/history/history-manipulation-inside-portal.html"><small>(source)</small></a>
      <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/portals/portal-activate-default.html" title="portals/portal-activate-default.html">portal-activate-default.html</a> <a class="wpt-live" href="http://wpt.live/portals/portal-activate-default.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/portals/portal-activate-default.html"><small>(source)</small></a>
      <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/portals/portals-activate-empty-browsing-context.html" title="portals/portals-activate-empty-browsing-context.html">portals-activate-empty-browsing-context.html</a> <a class="wpt-live" href="http://wpt.live/portals/portals-activate-empty-browsing-context.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/portals/portals-activate-empty-browsing-context.html"><small>(source)</small></a>
      <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/portals/portals-activate-network-error.html" title="portals/portals-activate-network-error.html">portals-activate-network-error.html</a> <a class="wpt-live" href="http://wpt.live/portals/portals-activate-network-error.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/portals/portals-activate-network-error.html"><small>(source)</small></a>
      <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/portals/portals-activate-while-unloading.html" title="portals/portals-activate-while-unloading.html">portals-activate-while-unloading.html</a> <a class="wpt-live" href="http://wpt.live/portals/portals-activate-while-unloading.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/portals/portals-activate-while-unloading.html"><small>(source)</small></a>
      <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/portals/portals-focus.sub.html" title="portals/portals-focus.sub.html">portals-focus.sub.html</a> <a class="wpt-live" href="http://wpt.live/portals/portals-focus.sub.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/portals/portals-focus.sub.html"><small>(source)</small></a>
      <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/portals/portals-navigate-after-adoption.html" title="portals/portals-navigate-after-adoption.html">portals-navigate-after-adoption.html</a> <a class="wpt-live" href="http://wpt.live/portals/portals-navigate-after-adoption.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/portals/portals-navigate-after-adoption.html"><small>(source)</small></a>
      <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/portals/portals-repeated-activate.html" title="portals/portals-repeated-activate.html">portals-repeated-activate.html</a> <a class="wpt-live" href="http://wpt.live/portals/portals-repeated-activate.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/portals/portals-repeated-activate.html"><small>(source)</small></a>
      <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/portals/portals-set-src-after-activate.html" title="portals/portals-set-src-after-activate.html">portals-set-src-after-activate.html</a> <a class="wpt-live" href="http://wpt.live/portals/portals-set-src-after-activate.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/portals/portals-set-src-after-activate.html"><small>(source)</small></a>
      <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/portals/predecessor-fires-unload.html" title="portals/predecessor-fires-unload.html">predecessor-fires-unload.html</a> <a class="wpt-live" href="http://wpt.live/portals/predecessor-fires-unload.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/portals/predecessor-fires-unload.html"><small>(source)</small></a>
     </ul>
    </details>
    <p>The following tests are actively incorrect and need to get updated:</p>
    <details class="wpt-tests-block" dir="ltr" lang="en" open>
     <summary>Tests</summary>
     <ul class="wpt-tests-list">
      <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/portals/csp/frame-ancestors.sub.html" title="portals/csp/frame-ancestors.sub.html">frame-ancestors.sub.html</a> <a class="wpt-live" href="http://wpt.live/portals/csp/frame-ancestors.sub.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/portals/csp/frame-ancestors.sub.html"><small>(source)</small></a>
      <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/portals/xfo/portals-xfo-deny.sub.html" title="portals/xfo/portals-xfo-deny.sub.html">portals-xfo-deny.sub.html</a> <a class="wpt-live" href="http://wpt.live/portals/xfo/portals-xfo-deny.sub.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/portals/xfo/portals-xfo-deny.sub.html"><small>(source)</small></a>
      <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/portals/xfo/portals-xfo-sameorigin.html" title="portals/xfo/portals-xfo-sameorigin.html">portals-xfo-sameorigin.html</a> <a class="wpt-live" href="http://wpt.live/portals/xfo/portals-xfo-sameorigin.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/portals/xfo/portals-xfo-sameorigin.html"><small>(source)</small></a>
      <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/portals/csp/frame-src.sub.html" title="portals/csp/frame-src.sub.html">frame-src.sub.html</a> <a class="wpt-live" href="http://wpt.live/portals/csp/frame-src.sub.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/portals/csp/frame-src.sub.html"><small>(source)</small></a>
     </ul>
    </details>
   </section>
  </main>
  <div data-fill-with="conformance">
   <h2 class="no-ref no-num heading settled" id="w3c-conformance"><span class="content">Conformance</span><a class="self-link" href="#w3c-conformance"></a></h2>
   <h3 class="no-ref no-num heading settled" id="w3c-conventions"><span class="content">Document conventions</span><a class="self-link" href="#w3c-conventions"></a></h3>
   <p>Conformance requirements are expressed
    with a combination of descriptive assertions
    and RFC 2119 terminology.
    The key words “MUST”, “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”, “RECOMMENDED”, “MAY”, and “OPTIONAL”
    in the normative parts of this document
    are to be interpreted as described in RFC 2119.
    However, for readability,
    these words do not appear in all uppercase letters in this specification. </p>
   <p>All of the text of this specification is normative
    except sections explicitly marked as non-normative, examples, and notes. <a data-link-type="biblio" href="#biblio-rfc2119">[RFC2119]</a> </p>
   <p>Examples in this specification are introduced with the words “for example”
    or are set apart from the normative text
    with <code>class="example"</code>,
    like this: </p>
   <div class="example" id="w3c-example">
    <a class="self-link" href="#w3c-example"></a> 
    <p>This is an example of an informative example. </p>
   </div>
   <p>Informative notes begin with the word “Note”
    and are set apart from the normative text
    with <code>class="note"</code>,
    like this: </p>
   <p class="note" role="note">
    Note, this is an informative note. 
    <details class="wpt-tests-block" dir="ltr" lang="en" open>
     <summary>Tests</summary>
     <p>Tests relating to the content of this specification
                     may be documented in “Tests” blocks like this one.
                     Any such block is non-normative.</p>
     <ul class="wpt-tests-list"></ul>
     <hr>
    </details>
   </p>
   <h3 class="no-ref no-num heading settled" id="w3c-conformant-algorithms"><span class="content">Conformant Algorithms</span><a class="self-link" href="#w3c-conformant-algorithms"></a></h3>
   <p>Requirements phrased in the imperative as part of algorithms
    (such as "strip any leading space characters"
    or "return false and abort these steps")
    are to be interpreted with the meaning of the key word
    ("must", "should", "may", etc)
    used in introducing the algorithm. </p>
   <p>Conformance requirements phrased as algorithms or specific steps
    can be implemented in any manner,
    so long as the end result is equivalent.
    In particular, the algorithms defined in this specification
    are intended to be easy to understand
    and are not intended to be performant.
    Implementers are encouraged to optimize. </p>
  </div>
<script src="https://www.w3.org/scripts/TR/2016/fixup.js"></script>
  <h2 class="no-num no-ref heading settled" id="index"><span class="content">Index</span><a class="self-link" href="#index"></a></h2>
  <h3 class="no-num no-ref heading settled" id="index-defined-here"><span class="content">Terms defined by this specification</span><a class="self-link" href="#index-defined-here"></a></h3>
  <ul class="index">
   <li><a href="#dom-htmlportalelement-activate">activate()</a><span>, in § 3</span>
   <li><a href="#activate-a-portal-browsing-context">activate a portal browsing context</a><span>, in § 2</span>
   <li><a href="#dom-htmlportalelement-activate">activate(options)</a><span>, in § 3</span>
   <li><a href="#portalactivateevent-activation-promise">activation promise</a><span>, in § 3.2</span>
   <li><a href="#portalactivateevent-adopted-predecessor-element">adopted predecessor element</a><span>, in § 3.2</span>
   <li><a href="#dom-portalactivateevent-adoptpredecessor">adoptPredecessor()</a><span>, in § 3.2</span>
   <li><a href="#adopt-the-predecessor-browsing-context">adopt the predecessor browsing context</a><span>, in § 2</span>
   <li><a href="#close-a-portal-element">close a portal element</a><span>, in § 3</span>
   <li><a href="#dom-portalactivateevent-portalactivateevent">constructor(type)</a><span>, in § 3.2</span>
   <li><a href="#dom-portalactivateevent-portalactivateevent">constructor(type, eventInitDict)</a><span>, in § 3.2</span>
   <li>
    data
    <ul>
     <li><a href="#dom-portalactivateevent-data">attribute for PortalActivateEvent</a><span>, in § 3.2</span>
     <li><a href="#dom-portalactivateeventinit-data">dict-member for PortalActivateEventInit</a><span>, in § 3.2</span>
     <li><a href="#dom-portalactivateoptions-data">dict-member for PortalActivateOptions</a><span>, in § 3</span>
    </ul>
   <li><a href="#htmlportalelement-guest-browsing-context">guest browsing context</a><span>, in § 3</span>
   <li><a href="#host-browsing-context">host browsing context</a><span>, in § 2</span>
   <li><a href="#host-element">host element</a><span>, in § 2</span>
   <li><a href="#htmlportalelement">HTMLPortalElement</a><span>, in § 3</span>
   <li><a href="#htmlportalelement-just-adopted-flag">just-adopted flag</a><span>, in § 3</span>
   <li><a href="#may-have-a-guest-browsing-context">may have a guest browsing context</a><span>, in § 3</span>
   <li>
    message
    <ul>
     <li><a href="#eventdef-htmlportalelement-message">event for HTMLPortalElement</a><span>, in § 3</span>
     <li><a href="#eventdef-portalhost-message">event for PortalHost</a><span>, in § 3.1</span>
    </ul>
   <li>
    messageerror
    <ul>
     <li><a href="#eventdef-htmlportalelement-messageerror">event for HTMLPortalElement</a><span>, in § 3</span>
     <li><a href="#eventdef-portalhost-messageerror">event for PortalHost</a><span>, in § 3.1</span>
    </ul>
   <li><a href="#typedefdef-messageeventsource">MessageEventSource</a><span>, in § 4.1</span>
   <li>
    onmessage
    <ul>
     <li><a href="#dom-htmlportalelement-onmessage">attribute for HTMLPortalElement</a><span>, in § 3</span>
     <li><a href="#dom-portalhost-onmessage">attribute for PortalHost</a><span>, in § 3.1</span>
    </ul>
   <li>
    onmessageerror
    <ul>
     <li><a href="#dom-htmlportalelement-onmessageerror">attribute for HTMLPortalElement</a><span>, in § 3</span>
     <li><a href="#dom-portalhost-onmessageerror">attribute for PortalHost</a><span>, in § 3.1</span>
    </ul>
   <li>
    onportalactivate
    <ul>
     <li><a href="#dom-window-onportalactivate">attribute for Window</a><span>, in § 4.2</span>
     <li><a href="#dom-windoweventhandlers-onportalactivate">attribute for WindowEventHandlers</a><span>, in § 4.2</span>
    </ul>
   <li><a href="#elementdef-portal">portal</a><span>, in § 3</span>
   <li><a href="#eventdef-window-portalactivate">portalactivate</a><span>, in § 4.2</span>
   <li><a href="#portalactivateevent">PortalActivateEvent</a><span>, in § 3.2</span>
   <li><a href="#dictdef-portalactivateeventinit">PortalActivateEventInit</a><span>, in § 3.2</span>
   <li><a href="#dom-portalactivateevent-portalactivateevent">PortalActivateEvent(type)</a><span>, in § 3.2</span>
   <li><a href="#dom-portalactivateevent-portalactivateevent">PortalActivateEvent(type, eventInitDict)</a><span>, in § 3.2</span>
   <li><a href="#dictdef-portalactivateoptions">PortalActivateOptions</a><span>, in § 3</span>
   <li><a href="#portal-browsing-context">portal browsing context</a><span>, in § 2</span>
   <li><a href="#portalhost">PortalHost</a><span>, in § 3.1</span>
   <li><a href="#dom-window-portalhost">portalHost</a><span>, in § 3.1</span>
   <li><a href="#portal-host-object">portal host object</a><span>, in § 3.1</span>
   <li><a href="#portal-src">portal-src</a><span>, in § 5.1.1</span>
   <li><a href="#portal-state">portal state</a><span>, in § 2</span>
   <li><a href="#portal-task-source">portal task source</a><span>, in § 2</span>
   <li>
    postMessage(message)
    <ul>
     <li><a href="#dom-htmlportalelement-postmessage">method for HTMLPortalElement</a><span>, in § 3</span>
     <li><a href="#dom-portalhost-postmessage">method for PortalHost</a><span>, in § 3.1</span>
    </ul>
   <li>
    postMessage(message, options)
    <ul>
     <li><a href="#dom-htmlportalelement-postmessage">method for HTMLPortalElement</a><span>, in § 3</span>
     <li><a href="#dom-portalhost-postmessage">method for PortalHost</a><span>, in § 3.1</span>
    </ul>
   <li><a href="#portalactivateevent-predecessor-browsing-context">predecessor browsing context</a><span>, in § 3.2</span>
   <li><a href="#dom-htmlportalelement-referrerpolicy">referrerPolicy</a><span>, in § 3</span>
   <li><a href="#element-attrdef-portal-referrerpolicy">referrerpolicy</a><span>, in § 3</span>
   <li><a href="#script-closable">script-closable</a><span>, in § 4.3</span>
   <li><a href="#set-the-source-url-of-a-portal-element">set the source URL of a portal element</a><span>, in § 3</span>
   <li>
    src
    <ul>
     <li><a href="#dom-htmlportalelement-src">attribute for HTMLPortalElement</a><span>, in § 3</span>
     <li><a href="#element-attrdef-portal-src">element-attr for portal</a><span>, in § 3</span>
    </ul>
   <li><a href="#portalactivateevent-successor-window">successor window</a><span>, in § 3.2</span>
  </ul>
  <aside class="dfn-panel" data-for="term-for-header-content-security-policy">
   <a href="https://w3c.github.io/webappsec-csp/#header-content-security-policy">https://w3c.github.io/webappsec-csp/#header-content-security-policy</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-header-content-security-policy">5.1.1. portal-src</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-directive-post-request-check">
   <a href="https://w3c.github.io/webappsec-csp/#directive-post-request-check">https://w3c.github.io/webappsec-csp/#directive-post-request-check</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-directive-post-request-check">5.1.1.2. portal-src Post-request check</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-directive-pre-request-check">
   <a href="https://w3c.github.io/webappsec-csp/#directive-pre-request-check">https://w3c.github.io/webappsec-csp/#directive-pre-request-check</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-directive-pre-request-check">5.1.1.1. portal-src Pre-request check</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-sandbox">
   <a href="https://w3c.github.io/webappsec-csp/#sandbox">https://w3c.github.io/webappsec-csp/#sandbox</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-sandbox">3. The portal element</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-grammardef-serialized-source-list">
   <a href="https://w3c.github.io/webappsec-csp/#grammardef-serialized-source-list">https://w3c.github.io/webappsec-csp/#grammardef-serialized-source-list</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-grammardef-serialized-source-list">5.1.1. portal-src</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-source-lists">
   <a href="https://w3c.github.io/webappsec-csp/#source-lists">https://w3c.github.io/webappsec-csp/#source-lists</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-source-lists">5.1.1. portal-src</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-directive-value">
   <a href="https://w3c.github.io/webappsec-csp/#directive-value">https://w3c.github.io/webappsec-csp/#directive-value</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-directive-value">5.1.1.1. portal-src Pre-request check</a>
    <li><a href="#ref-for-directive-value①">5.1.1.2. portal-src Post-request check</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-document">
   <a href="https://dom.spec.whatwg.org/#document">https://dom.spec.whatwg.org/#document</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-document">2. Portal browsing contexts</a>
    <li><a href="#ref-for-document①">3. The portal element</a> <a href="#ref-for-document②">(2)</a>
    <li><a href="#ref-for-document③">4.3. APIs for creating and navigating browsing contexts by name</a>
    <li><a href="#ref-for-document④">4.4. Navigation</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-event">
   <a href="https://dom.spec.whatwg.org/#event">https://dom.spec.whatwg.org/#event</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-event">3.2. The PortalActivateEvent interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dictdef-eventinit">
   <a href="https://dom.spec.whatwg.org/#dictdef-eventinit">https://dom.spec.whatwg.org/#dictdef-eventinit</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dictdef-eventinit">3.2. The PortalActivateEvent interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-eventtarget">
   <a href="https://dom.spec.whatwg.org/#eventtarget">https://dom.spec.whatwg.org/#eventtarget</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-eventtarget">3.1. Portal hosts</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-eventtarget-activation-behavior">
   <a href="https://dom.spec.whatwg.org/#eventtarget-activation-behavior">https://dom.spec.whatwg.org/#eventtarget-activation-behavior</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-eventtarget-activation-behavior">3. The portal element</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-node-adopt-ext">
   <a href="https://dom.spec.whatwg.org/#concept-node-adopt-ext">https://dom.spec.whatwg.org/#concept-node-adopt-ext</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-node-adopt-ext">3. The portal element</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-create-element">
   <a href="https://dom.spec.whatwg.org/#concept-create-element">https://dom.spec.whatwg.org/#concept-create-element</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-create-element">2. Portal browsing contexts</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-event-create">
   <a href="https://dom.spec.whatwg.org/#concept-event-create">https://dom.spec.whatwg.org/#concept-event-create</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-event-create">2. Portal browsing contexts</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-event-dispatch">
   <a href="https://dom.spec.whatwg.org/#concept-event-dispatch">https://dom.spec.whatwg.org/#concept-event-dispatch</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-event-dispatch">2. Portal browsing contexts</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-event-constructor-ext">
   <a href="https://dom.spec.whatwg.org/#concept-event-constructor-ext">https://dom.spec.whatwg.org/#concept-event-constructor-ext</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-event-constructor-ext">3.2. The PortalActivateEvent interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-event-fire">
   <a href="https://dom.spec.whatwg.org/#concept-event-fire">https://dom.spec.whatwg.org/#concept-event-fire</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-event-fire">3. The portal element</a> <a href="#ref-for-concept-event-fire①">(2)</a> <a href="#ref-for-concept-event-fire②">(3)</a>
    <li><a href="#ref-for-concept-event-fire③">3.1. Portal hosts</a> <a href="#ref-for-concept-event-fire④">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-node-document">
   <a href="https://dom.spec.whatwg.org/#concept-node-document">https://dom.spec.whatwg.org/#concept-node-document</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-node-document">2. Portal browsing contexts</a>
    <li><a href="#ref-for-concept-node-document①">3. The portal element</a> <a href="#ref-for-concept-node-document②">(2)</a> <a href="#ref-for-concept-node-document③">(3)</a> <a href="#ref-for-concept-node-document④">(4)</a> <a href="#ref-for-concept-node-document⑤">(5)</a> <a href="#ref-for-concept-node-document⑥">(6)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-document-origin">
   <a href="https://dom.spec.whatwg.org/#concept-document-origin">https://dom.spec.whatwg.org/#concept-document-origin</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-document-origin">2. Portal browsing contexts</a>
    <li><a href="#ref-for-concept-document-origin①">3. The portal element</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dom-event-type">
   <a href="https://dom.spec.whatwg.org/#dom-event-type">https://dom.spec.whatwg.org/#dom-event-type</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-event-type">2. Portal browsing contexts</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-document-url">
   <a href="https://dom.spec.whatwg.org/#concept-document-url">https://dom.spec.whatwg.org/#concept-document-url</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-document-url">3. The portal element</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-sec-agents">
   <a href="http://tc39.github.io/ecma262/#sec-agents">http://tc39.github.io/ecma262/#sec-agents</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-sec-agents">3. The portal element</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-sec-promise-objects">
   <a href="http://tc39.github.io/ecma262/#sec-promise-objects">http://tc39.github.io/ecma262/#sec-promise-objects</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-sec-promise-objects">3. The portal element</a>
    <li><a href="#ref-for-sec-promise-objects①">3.2. The PortalActivateEvent interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-request-current-url">
   <a href="https://fetch.spec.whatwg.org/#concept-request-current-url">https://fetch.spec.whatwg.org/#concept-request-current-url</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-request-current-url">4.4. Navigation</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-http-scheme">
   <a href="https://fetch.spec.whatwg.org/#http-scheme">https://fetch.spec.whatwg.org/#http-scheme</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-http-scheme">3. The portal element</a> <a href="#ref-for-http-scheme①">(2)</a>
    <li><a href="#ref-for-http-scheme②">4.4. Navigation</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-request-referrer-policy">
   <a href="https://fetch.spec.whatwg.org/#concept-request-referrer-policy">https://fetch.spec.whatwg.org/#concept-request-referrer-policy</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-request-referrer-policy">3. The portal element</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-request">
   <a href="https://fetch.spec.whatwg.org/#concept-request">https://fetch.spec.whatwg.org/#concept-request</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-request">3. The portal element</a>
    <li><a href="#ref-for-concept-request①">5.1.1.1. portal-src Pre-request check</a>
    <li><a href="#ref-for-concept-request②">5.1.1.2. portal-src Post-request check</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-request-reserved-client">
   <a href="https://fetch.spec.whatwg.org/#concept-request-reserved-client">https://fetch.spec.whatwg.org/#concept-request-reserved-client</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-request-reserved-client">5.2. Fetch Metadata Request Headers</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-response">
   <a href="https://fetch.spec.whatwg.org/#concept-response">https://fetch.spec.whatwg.org/#concept-response</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-response">5.1.1.2. portal-src Post-request check</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-response-status">
   <a href="https://fetch.spec.whatwg.org/#concept-response-status">https://fetch.spec.whatwg.org/#concept-response-status</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-response-status">4.4. Navigation</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-request-url">
   <a href="https://fetch.spec.whatwg.org/#concept-request-url">https://fetch.spec.whatwg.org/#concept-request-url</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-request-url">3. The portal element</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-cereactions">
   <a href="https://html.spec.whatwg.org/multipage/custom-elements.html#cereactions">https://html.spec.whatwg.org/multipage/custom-elements.html#cereactions</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-cereactions">3. The portal element</a> <a href="#ref-for-cereactions①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-eventhandler">
   <a href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler">https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-eventhandler">3. The portal element</a> <a href="#ref-for-eventhandler①">(2)</a>
    <li><a href="#ref-for-eventhandler②">3.1. Portal hosts</a> <a href="#ref-for-eventhandler③">(2)</a>
    <li><a href="#ref-for-eventhandler④">4.2. Event handlers</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-htmlconstructor">
   <a href="https://html.spec.whatwg.org/multipage/dom.html#htmlconstructor">https://html.spec.whatwg.org/multipage/dom.html#htmlconstructor</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-htmlconstructor">3. The portal element</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-htmlelement">
   <a href="https://html.spec.whatwg.org/multipage/dom.html#htmlelement">https://html.spec.whatwg.org/multipage/dom.html#htmlelement</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-htmlelement">3. The portal element</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-messageevent">
   <a href="https://html.spec.whatwg.org/multipage/comms.html#messageevent">https://html.spec.whatwg.org/multipage/comms.html#messageevent</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-messageevent">3. The portal element</a> <a href="#ref-for-messageevent①">(2)</a> <a href="#ref-for-messageevent②">(3)</a> <a href="#ref-for-messageevent③">(4)</a>
    <li><a href="#ref-for-messageevent④">3.1. Portal hosts</a> <a href="#ref-for-messageevent⑤">(2)</a> <a href="#ref-for-messageevent⑥">(3)</a> <a href="#ref-for-messageevent⑦">(4)</a>
    <li><a href="#ref-for-messageevent⑧">3.2. The PortalActivateEvent interface</a>
    <li><a href="#ref-for-messageevent⑨">4.1. The MessageEvent interface</a> <a href="#ref-for-messageevent①⓪">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-messageport">
   <a href="https://html.spec.whatwg.org/multipage/web-messaging.html#messageport">https://html.spec.whatwg.org/multipage/web-messaging.html#messageport</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-messageport">3. The portal element</a>
    <li><a href="#ref-for-messageport①">3.1. Portal hosts</a>
    <li><a href="#ref-for-messageport②">4.1. The MessageEvent interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-postmessageoptions">
   <a href="https://html.spec.whatwg.org/multipage/web-messaging.html#postmessageoptions">https://html.spec.whatwg.org/multipage/web-messaging.html#postmessageoptions</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-postmessageoptions">3. The portal element</a> <a href="#ref-for-postmessageoptions①">(2)</a>
    <li><a href="#ref-for-postmessageoptions②">3.1. Portal hosts</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-structureddeserializewithtransfer">
   <a href="https://html.spec.whatwg.org/multipage/structured-data.html#structureddeserializewithtransfer">https://html.spec.whatwg.org/multipage/structured-data.html#structureddeserializewithtransfer</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-structureddeserializewithtransfer">2. Portal browsing contexts</a>
    <li><a href="#ref-for-structureddeserializewithtransfer①">3. The portal element</a>
    <li><a href="#ref-for-structureddeserializewithtransfer②">3.1. Portal hosts</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-structuredserializewithtransfer">
   <a href="https://html.spec.whatwg.org/multipage/structured-data.html#structuredserializewithtransfer">https://html.spec.whatwg.org/multipage/structured-data.html#structuredserializewithtransfer</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-structuredserializewithtransfer">3. The portal element</a> <a href="#ref-for-structuredserializewithtransfer①">(2)</a>
    <li><a href="#ref-for-structuredserializewithtransfer②">3.1. Portal hosts</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-window">
   <a href="https://html.spec.whatwg.org/multipage/window-object.html#window">https://html.spec.whatwg.org/multipage/window-object.html#window</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-window">3.1. Portal hosts</a> <a href="#ref-for-window①">(2)</a>
    <li><a href="#ref-for-window②">3.2. The PortalActivateEvent interface</a>
    <li><a href="#ref-for-window③">4.2. Event handlers</a> <a href="#ref-for-window④">(2)</a> <a href="#ref-for-window⑤">(3)</a> <a href="#ref-for-window⑥">(4)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-windoweventhandlers">
   <a href="https://html.spec.whatwg.org/multipage/webappapis.html#windoweventhandlers">https://html.spec.whatwg.org/multipage/webappapis.html#windoweventhandlers</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-windoweventhandlers">4.2. Event handlers</a> <a href="#ref-for-windoweventhandlers①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-windowproxy">
   <a href="https://html.spec.whatwg.org/multipage/window-object.html#windowproxy">https://html.spec.whatwg.org/multipage/window-object.html#windowproxy</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-windowproxy">2. Portal browsing contexts</a>
    <li><a href="#ref-for-windowproxy①">3. The portal element</a>
    <li><a href="#ref-for-windowproxy②">4.1. The MessageEvent interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-active-document">
   <a href="https://html.spec.whatwg.org/multipage/browsers.html#active-document">https://html.spec.whatwg.org/multipage/browsers.html#active-document</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-active-document">2. Portal browsing contexts</a>
    <li><a href="#ref-for-active-document①">3. The portal element</a> <a href="#ref-for-active-document②">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-active-sandboxing-flag-set">
   <a href="https://html.spec.whatwg.org/multipage/origin.html#active-sandboxing-flag-set">https://html.spec.whatwg.org/multipage/origin.html#active-sandboxing-flag-set</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-active-sandboxing-flag-set">3. The portal element</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-active-window">
   <a href="https://html.spec.whatwg.org/multipage/browsers.html#active-window">https://html.spec.whatwg.org/multipage/browsers.html#active-window</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-active-window">2. Portal browsing contexts</a> <a href="#ref-for-active-window①">(2)</a> <a href="#ref-for-active-window②">(3)</a>
    <li><a href="#ref-for-active-window③">3. The portal element</a>
    <li><a href="#ref-for-active-window④">3.2. The PortalActivateEvent interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-allowed-to-download">
   <a href="https://html.spec.whatwg.org/multipage/links.html#allowed-to-download">https://html.spec.whatwg.org/multipage/links.html#allowed-to-download</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-allowed-to-download">4.5. Downloading resources</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-document-window">
   <a href="https://html.spec.whatwg.org/multipage/window-object.html#concept-document-window">https://html.spec.whatwg.org/multipage/window-object.html#concept-document-window</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-document-window">2. Portal browsing contexts</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-auxiliary-browsing-context">
   <a href="https://html.spec.whatwg.org/multipage/browsers.html#auxiliary-browsing-context">https://html.spec.whatwg.org/multipage/browsers.html#auxiliary-browsing-context</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-auxiliary-browsing-context">3. The portal element</a>
    <li><a href="#ref-for-auxiliary-browsing-context①">4.3. APIs for creating and navigating browsing contexts by name</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-becomes-browsing-context-connected">
   <a href="https://html.spec.whatwg.org/multipage/infrastructure.html#becomes-browsing-context-connected">https://html.spec.whatwg.org/multipage/infrastructure.html#becomes-browsing-context-connected</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-becomes-browsing-context-connected">3. The portal element</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-becomes-browsing-context-disconnected">
   <a href="https://html.spec.whatwg.org/multipage/infrastructure.html#becomes-browsing-context-disconnected">https://html.spec.whatwg.org/multipage/infrastructure.html#becomes-browsing-context-disconnected</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-becomes-browsing-context-disconnected">3. The portal element</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-window-bc">
   <a href="https://html.spec.whatwg.org/multipage/window-object.html#window-bc">https://html.spec.whatwg.org/multipage/window-object.html#window-bc</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-window-bc">3.1. Portal hosts</a> <a href="#ref-for-window-bc①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-browsing-context-group">
   <a href="https://html.spec.whatwg.org/multipage/browsers.html#browsing-context-group">https://html.spec.whatwg.org/multipage/browsers.html#browsing-context-group</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-browsing-context-group">3. The portal element</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-browsing-context-connected">
   <a href="https://html.spec.whatwg.org/multipage/infrastructure.html#browsing-context-connected">https://html.spec.whatwg.org/multipage/infrastructure.html#browsing-context-connected</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-browsing-context-connected">2. Portal browsing contexts</a>
    <li><a href="#ref-for-browsing-context-connected①">3. The portal element</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-child-browsing-context">
   <a href="https://html.spec.whatwg.org/multipage/browsers.html#child-browsing-context">https://html.spec.whatwg.org/multipage/browsers.html#child-browsing-context</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-child-browsing-context">3. The portal element</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-close-a-browsing-context">
   <a href="https://html.spec.whatwg.org/multipage/window-object.html#close-a-browsing-context">https://html.spec.whatwg.org/multipage/window-object.html#close-a-browsing-context</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-close-a-browsing-context">2. Portal browsing contexts</a> <a href="#ref-for-close-a-browsing-context①">(2)</a> <a href="#ref-for-close-a-browsing-context②">(3)</a>
    <li><a href="#ref-for-close-a-browsing-context③">3. The portal element</a> <a href="#ref-for-close-a-browsing-context④">(2)</a> <a href="#ref-for-close-a-browsing-context⑤">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-completely-loaded">
   <a href="https://html.spec.whatwg.org/multipage/parsing.html#completely-loaded">https://html.spec.whatwg.org/multipage/parsing.html#completely-loaded</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-completely-loaded">3. The portal element</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-creating-a-new-top-level-browsing-context">
   <a href="https://html.spec.whatwg.org/multipage/browsers.html#creating-a-new-top-level-browsing-context">https://html.spec.whatwg.org/multipage/browsers.html#creating-a-new-top-level-browsing-context</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-creating-a-new-top-level-browsing-context">3. The portal element</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dom-messageevent-data">
   <a href="https://html.spec.whatwg.org/multipage/comms.html#dom-messageevent-data">https://html.spec.whatwg.org/multipage/comms.html#dom-messageevent-data</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-messageevent-data">3. The portal element</a>
    <li><a href="#ref-for-dom-messageevent-data①">3.1. Portal hosts</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-a-browsing-context-is-discarded">
   <a href="https://html.spec.whatwg.org/multipage/window-object.html#a-browsing-context-is-discarded">https://html.spec.whatwg.org/multipage/window-object.html#a-browsing-context-is-discarded</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-a-browsing-context-is-discarded">2. Portal browsing contexts</a> <a href="#ref-for-a-browsing-context-is-discarded①">(2)</a> <a href="#ref-for-a-browsing-context-is-discarded②">(3)</a>
    <li><a href="#ref-for-a-browsing-context-is-discarded③">3. The portal element</a> <a href="#ref-for-a-browsing-context-is-discarded④">(2)</a> <a href="#ref-for-a-browsing-context-is-discarded⑤">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-environment-discarding-steps">
   <a href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-discarding-steps">https://html.spec.whatwg.org/multipage/webappapis.html#environment-discarding-steps</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-environment-discarding-steps">4.4. Navigation</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-event-handlers">
   <a href="https://html.spec.whatwg.org/multipage/webappapis.html#event-handlers">https://html.spec.whatwg.org/multipage/webappapis.html#event-handlers</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-event-handlers">4.2. Event handlers</a> <a href="#ref-for-event-handlers①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-event-handler-content-attributes">
   <a href="https://html.spec.whatwg.org/multipage/webappapis.html#event-handler-content-attributes">https://html.spec.whatwg.org/multipage/webappapis.html#event-handler-content-attributes</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-event-handler-content-attributes">3. The portal element</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-event-handler-event-type">
   <a href="https://html.spec.whatwg.org/multipage/webappapis.html#event-handler-event-type">https://html.spec.whatwg.org/multipage/webappapis.html#event-handler-event-type</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-event-handler-event-type">4.2. Event handlers</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-event-handler-idl-attributes">
   <a href="https://html.spec.whatwg.org/multipage/webappapis.html#event-handler-idl-attributes">https://html.spec.whatwg.org/multipage/webappapis.html#event-handler-idl-attributes</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-event-handler-idl-attributes">4.2. Event handlers</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-agent-event-loop">
   <a href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-agent-event-loop">https://html.spec.whatwg.org/multipage/webappapis.html#concept-agent-event-loop</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-agent-event-loop">3. The portal element</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-the-iframe-element">
   <a href="https://html.spec.whatwg.org/multipage/iframe-embed-object.html#the-iframe-element">https://html.spec.whatwg.org/multipage/iframe-embed-object.html#the-iframe-element</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-the-iframe-element">3. The portal element</a> <a href="#ref-for-the-iframe-element①">(2)</a> <a href="#ref-for-the-iframe-element②">(3)</a>
    <li><a href="#ref-for-the-iframe-element③">5.2. Fetch Metadata Request Headers</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-in-parallel">
   <a href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel">https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-in-parallel">2. Portal browsing contexts</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-limited-to-only-known-values">
   <a href="https://html.spec.whatwg.org/multipage/common-dom-interfaces.html#limited-to-only-known-values">https://html.spec.whatwg.org/multipage/common-dom-interfaces.html#limited-to-only-known-values</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-limited-to-only-known-values">3. The portal element</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-event-load">
   <a href="https://html.spec.whatwg.org/multipage/indices.html#event-load">https://html.spec.whatwg.org/multipage/indices.html#event-load</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-event-load">3. The portal element</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-navigate">
   <a href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#navigate">https://html.spec.whatwg.org/multipage/browsing-the-web.html#navigate</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-navigate">3. The portal element</a> <a href="#ref-for-navigate①">(2)</a>
    <li><a href="#ref-for-navigate②">4.4. Navigation</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-nested-browsing-context">
   <a href="https://html.spec.whatwg.org/multipage/browsers.html#nested-browsing-context">https://html.spec.whatwg.org/multipage/browsers.html#nested-browsing-context</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-nested-browsing-context">2. Portal browsing contexts</a>
    <li><a href="#ref-for-nested-browsing-context①">3. The portal element</a> <a href="#ref-for-nested-browsing-context②">(2)</a> <a href="#ref-for-nested-browsing-context③">(3)</a>
    <li><a href="#ref-for-nested-browsing-context④">5.2. Fetch Metadata Request Headers</a> <a href="#ref-for-nested-browsing-context⑤">(2)</a> <a href="#ref-for-nested-browsing-context⑥">(3)</a>
    <li><a href="#ref-for-nested-browsing-context⑦">6.1. Overview</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-settings-object-origin">
   <a href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin">https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-settings-object-origin">3. The portal element</a> <a href="#ref-for-concept-settings-object-origin①">(2)</a> <a href="#ref-for-concept-settings-object-origin②">(3)</a>
    <li><a href="#ref-for-concept-settings-object-origin③">3.1. Portal hosts</a> <a href="#ref-for-concept-settings-object-origin④">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-parse-a-url">
   <a href="https://html.spec.whatwg.org/multipage/urls-and-fetching.html#parse-a-url">https://html.spec.whatwg.org/multipage/urls-and-fetching.html#parse-a-url</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-parse-a-url">3. The portal element</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dom-messageevent-ports">
   <a href="https://html.spec.whatwg.org/multipage/comms.html#dom-messageevent-ports">https://html.spec.whatwg.org/multipage/comms.html#dom-messageevent-ports</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-messageevent-ports">3. The portal element</a>
    <li><a href="#ref-for-dom-messageevent-ports①">3.1. Portal hosts</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-process-a-navigate-response">
   <a href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#process-a-navigate-response">https://html.spec.whatwg.org/multipage/browsing-the-web.html#process-a-navigate-response</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-process-a-navigate-response">4.4. Navigation</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-process-a-navigate-url-scheme">
   <a href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#process-a-navigate-url-scheme">https://html.spec.whatwg.org/multipage/browsing-the-web.html#process-a-navigate-url-scheme</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-process-a-navigate-url-scheme">4.4. Navigation</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-prompt-to-unload-a-document">
   <a href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#prompt-to-unload-a-document">https://html.spec.whatwg.org/multipage/browsing-the-web.html#prompt-to-unload-a-document</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-prompt-to-unload-a-document">2. Portal browsing contexts</a>
    <li><a href="#ref-for-prompt-to-unload-a-document①">3. The portal element</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-queue-a-global-task">
   <a href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task">https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-queue-a-global-task">2. Portal browsing contexts</a> <a href="#ref-for-queue-a-global-task①">(2)</a> <a href="#ref-for-queue-a-global-task②">(3)</a> <a href="#ref-for-queue-a-global-task③">(4)</a>
    <li><a href="#ref-for-queue-a-global-task④">3. The portal element</a>
    <li><a href="#ref-for-queue-a-global-task⑤">3.2. The PortalActivateEvent interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-queue-an-element-task">
   <a href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-an-element-task">https://html.spec.whatwg.org/multipage/webappapis.html#queue-an-element-task</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-queue-an-element-task">3.1. Portal hosts</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-global-object-realm">
   <a href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-global-object-realm">https://html.spec.whatwg.org/multipage/webappapis.html#concept-global-object-realm</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-global-object-realm">2. Portal browsing contexts</a>
    <li><a href="#ref-for-concept-global-object-realm①">3. The portal element</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-referrer-policy-attribute">
   <a href="https://html.spec.whatwg.org/multipage/urls-and-fetching.html#referrer-policy-attribute">https://html.spec.whatwg.org/multipage/urls-and-fetching.html#referrer-policy-attribute</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-referrer-policy-attribute">3. The portal element</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-reflect">
   <a href="https://html.spec.whatwg.org/multipage/common-dom-interfaces.html#reflect">https://html.spec.whatwg.org/multipage/common-dom-interfaces.html#reflect</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-reflect">3. The portal element</a> <a href="#ref-for-reflect①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-relevant-global">
   <a href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global">https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-relevant-global">3.1. Portal hosts</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-relevant-settings-object">
   <a href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object">https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-relevant-settings-object">3. The portal element</a> <a href="#ref-for-relevant-settings-object①">(2)</a> <a href="#ref-for-relevant-settings-object②">(3)</a>
    <li><a href="#ref-for-relevant-settings-object③">3.1. Portal hosts</a> <a href="#ref-for-relevant-settings-object④">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-navigation-params-request">
   <a href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#navigation-params-request">https://html.spec.whatwg.org/multipage/browsing-the-web.html#navigation-params-request</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-navigation-params-request">4.4. Navigation</a> <a href="#ref-for-navigation-params-request①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-navigation-params-reserved-environment">
   <a href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#navigation-params-reserved-environment">https://html.spec.whatwg.org/multipage/browsing-the-web.html#navigation-params-reserved-environment</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-navigation-params-reserved-environment">4.4. Navigation</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-resulting-url-record">
   <a href="https://html.spec.whatwg.org/multipage/urls-and-fetching.html#resulting-url-record">https://html.spec.whatwg.org/multipage/urls-and-fetching.html#resulting-url-record</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-resulting-url-record">3. The portal element</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-same-origin">
   <a href="https://html.spec.whatwg.org/multipage/origin.html#same-origin">https://html.spec.whatwg.org/multipage/origin.html#same-origin</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-same-origin">2. Portal browsing contexts</a>
    <li><a href="#ref-for-same-origin①">3. The portal element</a>
    <li><a href="#ref-for-same-origin②">3.1. Portal hosts</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-same-origin-domain">
   <a href="https://html.spec.whatwg.org/multipage/origin.html#same-origin-domain">https://html.spec.whatwg.org/multipage/origin.html#same-origin-domain</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-same-origin-domain">3. The portal element</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-script-closable">
   <a href="https://html.spec.whatwg.org/multipage/window-object.html#script-closable">https://html.spec.whatwg.org/multipage/window-object.html#script-closable</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-script-closable">4.3. APIs for creating and navigating browsing contexts by name</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-ascii-serialisation-of-an-origin">
   <a href="https://html.spec.whatwg.org/multipage/origin.html#ascii-serialisation-of-an-origin">https://html.spec.whatwg.org/multipage/origin.html#ascii-serialisation-of-an-origin</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-ascii-serialisation-of-an-origin">3. The portal element</a>
    <li><a href="#ref-for-ascii-serialisation-of-an-origin①">3.1. Portal hosts</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-session-history">
   <a href="https://html.spec.whatwg.org/multipage/history.html#session-history">https://html.spec.whatwg.org/multipage/history.html#session-history</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-session-history">2. Portal browsing contexts</a> <a href="#ref-for-session-history①">(2)</a>
    <li><a href="#ref-for-session-history②">4.3. APIs for creating and navigating browsing contexts by name</a>
    <li><a href="#ref-for-session-history③">4.4. Navigation</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dom-messageevent-source">
   <a href="https://html.spec.whatwg.org/multipage/comms.html#dom-messageevent-source">https://html.spec.whatwg.org/multipage/comms.html#dom-messageevent-source</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-messageevent-source">3. The portal element</a> <a href="#ref-for-dom-messageevent-source①">(2)</a>
    <li><a href="#ref-for-dom-messageevent-source②">3.1. Portal hosts</a> <a href="#ref-for-dom-messageevent-source③">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-environment-target-browsing-context">
   <a href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-target-browsing-context">https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-target-browsing-context</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-environment-target-browsing-context">5.2. Fetch Metadata Request Headers</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-task-source">
   <a href="https://html.spec.whatwg.org/multipage/webappapis.html#task-source">https://html.spec.whatwg.org/multipage/webappapis.html#task-source</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-task-source">2. Portal browsing contexts</a> <a href="#ref-for-task-source①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-top-level-browsing-context">
   <a href="https://html.spec.whatwg.org/multipage/browsers.html#top-level-browsing-context">https://html.spec.whatwg.org/multipage/browsers.html#top-level-browsing-context</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-top-level-browsing-context">1. Introduction</a>
    <li><a href="#ref-for-top-level-browsing-context①">3. The portal element</a> <a href="#ref-for-top-level-browsing-context②">(2)</a>
    <li><a href="#ref-for-top-level-browsing-context③">3.2. The PortalActivateEvent interface</a>
    <li><a href="#ref-for-top-level-browsing-context④">4.3. APIs for creating and navigating browsing contexts by name</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dom-postmessageoptions-transfer">
   <a href="https://html.spec.whatwg.org/multipage/web-messaging.html#dom-postmessageoptions-transfer">https://html.spec.whatwg.org/multipage/web-messaging.html#dom-postmessageoptions-transfer</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-postmessageoptions-transfer">3. The portal element</a> <a href="#ref-for-dom-postmessageoptions-transfer①">(2)</a>
    <li><a href="#ref-for-dom-postmessageoptions-transfer②">3.1. Portal hosts</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-event-unload">
   <a href="https://html.spec.whatwg.org/multipage/indices.html#event-unload">https://html.spec.whatwg.org/multipage/indices.html#event-unload</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-event-unload">2. Portal browsing contexts</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-valid-non-empty-url-potentially-surrounded-by-spaces">
   <a href="https://html.spec.whatwg.org/multipage/urls-and-fetching.html#valid-non-empty-url-potentially-surrounded-by-spaces">https://html.spec.whatwg.org/multipage/urls-and-fetching.html#valid-non-empty-url-potentially-surrounded-by-spaces</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-valid-non-empty-url-potentially-surrounded-by-spaces">3. The portal element</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-assert">
   <a href="https://infra.spec.whatwg.org/#assert">https://infra.spec.whatwg.org/#assert</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-assert">2. Portal browsing contexts</a> <a href="#ref-for-assert①">(2)</a> <a href="#ref-for-assert②">(3)</a> <a href="#ref-for-assert③">(4)</a>
    <li><a href="#ref-for-assert④">3. The portal element</a> <a href="#ref-for-assert⑤">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-boolean">
   <a href="https://infra.spec.whatwg.org/#boolean">https://infra.spec.whatwg.org/#boolean</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-boolean">3. The portal element</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-html-namespace">
   <a href="https://infra.spec.whatwg.org/#html-namespace">https://infra.spec.whatwg.org/#html-namespace</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-html-namespace">2. Portal browsing contexts</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-referrer-policy">
   <a href="https://w3c.github.io/webappsec-referrer-policy/#referrer-policy">https://w3c.github.io/webappsec-referrer-policy/#referrer-policy</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-referrer-policy">3. The portal element</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-serviceworker">
   <a href="https://w3c.github.io/ServiceWorker/#serviceworker">https://w3c.github.io/ServiceWorker/#serviceworker</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-serviceworker">4.1. The MessageEvent interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-url-scheme">
   <a href="https://url.spec.whatwg.org/#concept-url-scheme">https://url.spec.whatwg.org/#concept-url-scheme</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-url-scheme">3. The portal element</a>
    <li><a href="#ref-for-concept-url-scheme①">4.4. Navigation</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-url">
   <a href="https://url.spec.whatwg.org/#concept-url">https://url.spec.whatwg.org/#concept-url</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-url">3. The portal element</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-idl-DOMException">
   <a href="https://heycam.github.io/webidl/#idl-DOMException">https://heycam.github.io/webidl/#idl-DOMException</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-idl-DOMException">2. Portal browsing contexts</a>
    <li><a href="#ref-for-idl-DOMException①">3. The portal element</a> <a href="#ref-for-idl-DOMException②">(2)</a> <a href="#ref-for-idl-DOMException③">(3)</a> <a href="#ref-for-idl-DOMException④">(4)</a>
    <li><a href="#ref-for-idl-DOMException⑤">3.1. Portal hosts</a>
    <li><a href="#ref-for-idl-DOMException⑥">3.2. The PortalActivateEvent interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-idl-DOMString">
   <a href="https://heycam.github.io/webidl/#idl-DOMString">https://heycam.github.io/webidl/#idl-DOMString</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-idl-DOMString">3. The portal element</a>
    <li><a href="#ref-for-idl-DOMString①">3.2. The PortalActivateEvent interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-Exposed">
   <a href="https://heycam.github.io/webidl/#Exposed">https://heycam.github.io/webidl/#Exposed</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-Exposed">3. The portal element</a>
    <li><a href="#ref-for-Exposed①">3.1. Portal hosts</a>
    <li><a href="#ref-for-Exposed②">3.2. The PortalActivateEvent interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-invalidstateerror">
   <a href="https://heycam.github.io/webidl/#invalidstateerror">https://heycam.github.io/webidl/#invalidstateerror</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-invalidstateerror">2. Portal browsing contexts</a>
    <li><a href="#ref-for-invalidstateerror①">3. The portal element</a> <a href="#ref-for-invalidstateerror②">(2)</a> <a href="#ref-for-invalidstateerror③">(3)</a> <a href="#ref-for-invalidstateerror④">(4)</a>
    <li><a href="#ref-for-invalidstateerror⑤">3.1. Portal hosts</a>
    <li><a href="#ref-for-invalidstateerror⑥">3.2. The PortalActivateEvent interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-NewObject">
   <a href="https://heycam.github.io/webidl/#NewObject">https://heycam.github.io/webidl/#NewObject</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-NewObject">3. The portal element</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-idl-promise">
   <a href="https://heycam.github.io/webidl/#idl-promise">https://heycam.github.io/webidl/#idl-promise</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-idl-promise">3. The portal element</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-idl-USVString">
   <a href="https://heycam.github.io/webidl/#idl-USVString">https://heycam.github.io/webidl/#idl-USVString</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-idl-USVString">3. The portal element</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-idl-any">
   <a href="https://heycam.github.io/webidl/#idl-any">https://heycam.github.io/webidl/#idl-any</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-idl-any">3. The portal element</a> <a href="#ref-for-idl-any①">(2)</a>
    <li><a href="#ref-for-idl-any②">3.1. Portal hosts</a>
    <li><a href="#ref-for-idl-any③">3.2. The PortalActivateEvent interface</a> <a href="#ref-for-idl-any④">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dfn-frozen-array-type">
   <a href="https://heycam.github.io/webidl/#dfn-frozen-array-type">https://heycam.github.io/webidl/#dfn-frozen-array-type</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dfn-frozen-array-type">3. The portal element</a>
    <li><a href="#ref-for-dfn-frozen-array-type①">3.1. Portal hosts</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-reject">
   <a href="https://heycam.github.io/webidl/#reject">https://heycam.github.io/webidl/#reject</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-reject">2. Portal browsing contexts</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-this">
   <a href="https://heycam.github.io/webidl/#this">https://heycam.github.io/webidl/#this</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-this">3. The portal element</a> <a href="#ref-for-this①">(2)</a> <a href="#ref-for-this②">(3)</a> <a href="#ref-for-this③">(4)</a> <a href="#ref-for-this④">(5)</a>
    <li><a href="#ref-for-this⑤">3.1. Portal hosts</a> <a href="#ref-for-this⑥">(2)</a> <a href="#ref-for-this⑦">(3)</a> <a href="#ref-for-this⑧">(4)</a>
    <li><a href="#ref-for-this⑨">3.2. The PortalActivateEvent interface</a> <a href="#ref-for-this①⓪">(2)</a> <a href="#ref-for-this①①">(3)</a> <a href="#ref-for-this①②">(4)</a> <a href="#ref-for-this①③">(5)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-idl-undefined">
   <a href="https://heycam.github.io/webidl/#idl-undefined">https://heycam.github.io/webidl/#idl-undefined</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-idl-undefined">3. The portal element</a> <a href="#ref-for-idl-undefined①">(2)</a>
    <li><a href="#ref-for-idl-undefined②">3.1. Portal hosts</a>
   </ul>
  </aside>
  <h3 class="no-num no-ref heading settled" id="index-defined-elsewhere"><span class="content">Terms defined by reference</span><a class="self-link" href="#index-defined-elsewhere"></a></h3>
  <ul class="index">
   <li>
    <a data-link-type="biblio">[CSP]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-header-content-security-policy">content-security-policy</span>
     <li><span class="dfn-paneled" id="term-for-directive-post-request-check">post-request check</span>
     <li><span class="dfn-paneled" id="term-for-directive-pre-request-check">pre-request check</span>
     <li><span class="dfn-paneled" id="term-for-sandbox">sandbox</span>
     <li><span class="dfn-paneled" id="term-for-grammardef-serialized-source-list">serialized-source-list</span>
     <li><span class="dfn-paneled" id="term-for-source-lists">source lists</span>
     <li><span class="dfn-paneled" id="term-for-directive-value">value</span>
    </ul>
   <li>
    <a data-link-type="biblio">[DOM]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-document">Document</span>
     <li><span class="dfn-paneled" id="term-for-event">Event</span>
     <li><span class="dfn-paneled" id="term-for-dictdef-eventinit">EventInit</span>
     <li><span class="dfn-paneled" id="term-for-eventtarget">EventTarget</span>
     <li><span class="dfn-paneled" id="term-for-eventtarget-activation-behavior">activation behavior</span>
     <li><span class="dfn-paneled" id="term-for-concept-node-adopt-ext">adopting steps</span>
     <li><span class="dfn-paneled" id="term-for-concept-create-element">creating an element</span>
     <li><span class="dfn-paneled" id="term-for-concept-event-create">creating an event</span>
     <li><span class="dfn-paneled" id="term-for-concept-event-dispatch">dispatch</span>
     <li><span class="dfn-paneled" id="term-for-concept-event-constructor-ext">event constructing steps</span>
     <li><span class="dfn-paneled" id="term-for-concept-event-fire">fire an event</span>
     <li><span class="dfn-paneled" id="term-for-concept-node-document">node document</span>
     <li><span class="dfn-paneled" id="term-for-concept-document-origin">origin</span>
     <li><span class="dfn-paneled" id="term-for-dom-event-type">type</span>
     <li><span class="dfn-paneled" id="term-for-concept-document-url">url</span>
    </ul>
   <li>
    <a data-link-type="biblio">[ECMASCRIPT]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-sec-agents">agent</span>
     <li><span class="dfn-paneled" id="term-for-sec-promise-objects">promise</span>
    </ul>
   <li>
    <a data-link-type="biblio">[FETCH]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-concept-request-current-url">current url</span>
     <li><span class="dfn-paneled" id="term-for-http-scheme">http(s) scheme</span>
     <li><span class="dfn-paneled" id="term-for-concept-request-referrer-policy">referrer policy</span>
     <li><span class="dfn-paneled" id="term-for-concept-request">request</span>
     <li><span class="dfn-paneled" id="term-for-concept-request-reserved-client">reserved client</span>
     <li><span class="dfn-paneled" id="term-for-concept-response">response</span>
     <li><span class="dfn-paneled" id="term-for-concept-response-status">status</span>
     <li><span class="dfn-paneled" id="term-for-concept-request-url">url</span>
    </ul>
   <li>
    <a data-link-type="biblio">[HTML]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-cereactions">CEReactions</span>
     <li><span class="dfn-paneled" id="term-for-eventhandler">EventHandler</span>
     <li><span class="dfn-paneled" id="term-for-htmlconstructor">HTMLConstructor</span>
     <li><span class="dfn-paneled" id="term-for-htmlelement">HTMLElement</span>
     <li><span class="dfn-paneled" id="term-for-messageevent">MessageEvent</span>
     <li><span class="dfn-paneled" id="term-for-messageport">MessagePort</span>
     <li><span class="dfn-paneled" id="term-for-postmessageoptions">PostMessageOptions</span>
     <li><span class="dfn-paneled" id="term-for-structureddeserializewithtransfer">StructuredDeserializeWithTransfer</span>
     <li><span class="dfn-paneled" id="term-for-structuredserializewithtransfer">StructuredSerializeWithTransfer</span>
     <li><span class="dfn-paneled" id="term-for-window">Window</span>
     <li><span class="dfn-paneled" id="term-for-windoweventhandlers">WindowEventHandlers</span>
     <li><span class="dfn-paneled" id="term-for-windowproxy">WindowProxy</span>
     <li><span class="dfn-paneled" id="term-for-active-document">active document</span>
     <li><span class="dfn-paneled" id="term-for-active-sandboxing-flag-set">active sandboxing flag set</span>
     <li><span class="dfn-paneled" id="term-for-active-window">active window</span>
     <li><span class="dfn-paneled" id="term-for-allowed-to-download">allowed to download</span>
     <li><span class="dfn-paneled" id="term-for-concept-document-window">associated document</span>
     <li><span class="dfn-paneled" id="term-for-auxiliary-browsing-context">auxiliary browsing context</span>
     <li><span class="dfn-paneled" id="term-for-becomes-browsing-context-connected">become browsing-context connected</span>
     <li><span class="dfn-paneled" id="term-for-becomes-browsing-context-disconnected">become browsing-context disconnected</span>
     <li><span class="dfn-paneled" id="term-for-window-bc">browsing context <small>(for Window)</small></span>
     <li><span class="dfn-paneled" id="term-for-browsing-context-group">browsing context group</span>
     <li><span class="dfn-paneled" id="term-for-browsing-context-connected">browsing-context connected</span>
     <li><span class="dfn-paneled" id="term-for-child-browsing-context">child browsing context</span>
     <li><span class="dfn-paneled" id="term-for-close-a-browsing-context">close a browsing context</span>
     <li><span class="dfn-paneled" id="term-for-completely-loaded">completely loaded</span>
     <li><span class="dfn-paneled" id="term-for-creating-a-new-top-level-browsing-context">create a new top-level browsing context</span>
     <li><span class="dfn-paneled" id="term-for-dom-messageevent-data">data</span>
     <li><span class="dfn-paneled" id="term-for-a-browsing-context-is-discarded">discard a browsing context</span>
     <li><span class="dfn-paneled" id="term-for-environment-discarding-steps">environment discarding steps</span>
     <li><span class="dfn-paneled" id="term-for-event-handlers">event handler</span>
     <li><span class="dfn-paneled" id="term-for-event-handler-content-attributes">event handler content attribute</span>
     <li><span class="dfn-paneled" id="term-for-event-handler-event-type">event handler event type</span>
     <li><span class="dfn-paneled" id="term-for-event-handler-idl-attributes">event handler idl attribute</span>
     <li><span class="dfn-paneled" id="term-for-concept-agent-event-loop">event loop <small>(for agent)</small></span>
     <li><span class="dfn-paneled" id="term-for-the-iframe-element">iframe</span>
     <li><span class="dfn-paneled" id="term-for-in-parallel">in parallel</span>
     <li><span class="dfn-paneled" id="term-for-limited-to-only-known-values">limited to only known values</span>
     <li><span class="dfn-paneled" id="term-for-event-load">load</span>
     <li><span class="dfn-paneled" id="term-for-navigate">navigate</span>
     <li><span class="dfn-paneled" id="term-for-nested-browsing-context">nested browsing context</span>
     <li><span class="dfn-paneled" id="term-for-concept-settings-object-origin">origin <small>(for environment settings object)</small></span>
     <li><span class="dfn-paneled" id="term-for-parse-a-url">parse a url</span>
     <li><span class="dfn-paneled" id="term-for-dom-messageevent-ports">ports</span>
     <li><span class="dfn-paneled" id="term-for-process-a-navigate-response">process a navigate response</span>
     <li><span class="dfn-paneled" id="term-for-process-a-navigate-url-scheme">process a navigate url scheme</span>
     <li><span class="dfn-paneled" id="term-for-prompt-to-unload-a-document">prompt to unload</span>
     <li><span class="dfn-paneled" id="term-for-queue-a-global-task">queue a global task</span>
     <li><span class="dfn-paneled" id="term-for-queue-an-element-task">queue an element task</span>
     <li><span class="dfn-paneled" id="term-for-concept-global-object-realm">realm <small>(for global object)</small></span>
     <li><span class="dfn-paneled" id="term-for-referrer-policy-attribute">referrer policy attribute</span>
     <li><span class="dfn-paneled" id="term-for-reflect">reflect</span>
     <li><span class="dfn-paneled" id="term-for-concept-relevant-global">relevant global object</span>
     <li><span class="dfn-paneled" id="term-for-relevant-settings-object">relevant settings object</span>
     <li><span class="dfn-paneled" id="term-for-navigation-params-request">request</span>
     <li><span class="dfn-paneled" id="term-for-navigation-params-reserved-environment">reserved environment</span>
     <li><span class="dfn-paneled" id="term-for-resulting-url-record">resulting url record</span>
     <li><span class="dfn-paneled" id="term-for-same-origin">same origin</span>
     <li><span class="dfn-paneled" id="term-for-same-origin-domain">same origin-domain</span>
     <li><span class="dfn-paneled" id="term-for-script-closable">script-closable</span>
     <li><span class="dfn-paneled" id="term-for-ascii-serialisation-of-an-origin">serialization of an origin</span>
     <li><span class="dfn-paneled" id="term-for-session-history">session history</span>
     <li><span class="dfn-paneled" id="term-for-dom-messageevent-source">source</span>
     <li><span class="dfn-paneled" id="term-for-concept-environment-target-browsing-context">target browsing context</span>
     <li><span class="dfn-paneled" id="term-for-task-source">task source</span>
     <li><span class="dfn-paneled" id="term-for-top-level-browsing-context">top-level browsing context</span>
     <li><span class="dfn-paneled" id="term-for-dom-postmessageoptions-transfer">transfer</span>
     <li><span class="dfn-paneled" id="term-for-event-unload">unload <small>(for Window)</small></span>
     <li><span class="dfn-paneled" id="term-for-valid-non-empty-url-potentially-surrounded-by-spaces">valid non-empty url potentially surrounded by spaces</span>
    </ul>
   <li>
    <a data-link-type="biblio">[INFRA]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-assert">assert</span>
     <li><span class="dfn-paneled" id="term-for-boolean">boolean</span>
     <li><span class="dfn-paneled" id="term-for-html-namespace">html namespace</span>
    </ul>
   <li>
    <a data-link-type="biblio">[REFERRER-POLICY]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-referrer-policy">referrer policy</span>
    </ul>
   <li>
    <a data-link-type="biblio">[service-workers-1]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-serviceworker">ServiceWorker</span>
    </ul>
   <li>
    <a data-link-type="biblio">[URL]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-concept-url-scheme">scheme</span>
     <li><span class="dfn-paneled" id="term-for-concept-url">url</span>
    </ul>
   <li>
    <a data-link-type="biblio">[WebIDL]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-idl-DOMException">DOMException</span>
     <li><span class="dfn-paneled" id="term-for-idl-DOMString">DOMString</span>
     <li><span class="dfn-paneled" id="term-for-Exposed">Exposed</span>
     <li><span class="dfn-paneled" id="term-for-invalidstateerror">InvalidStateError</span>
     <li><span class="dfn-paneled" id="term-for-NewObject">NewObject</span>
     <li><span class="dfn-paneled" id="term-for-idl-promise">Promise</span>
     <li><span class="dfn-paneled" id="term-for-idl-USVString">USVString</span>
     <li><span class="dfn-paneled" id="term-for-idl-any">any</span>
     <li><span class="dfn-paneled" id="term-for-dfn-frozen-array-type">frozen array type</span>
     <li><span class="dfn-paneled" id="term-for-reject">reject</span>
     <li><span class="dfn-paneled" id="term-for-this">this</span>
     <li><span class="dfn-paneled" id="term-for-idl-undefined">undefined</span>
    </ul>
  </ul>
  <h2 class="no-num no-ref heading settled" id="references"><span class="content">References</span><a class="self-link" href="#references"></a></h2>
  <h3 class="no-num no-ref heading settled" id="normative"><span class="content">Normative References</span><a class="self-link" href="#normative"></a></h3>
  <dl>
   <dt id="biblio-csp">[CSP]
   <dd>Mike West. <a href="https://www.w3.org/TR/CSP3/"><cite>Content Security Policy Level 3</cite></a>. 24 March 2021. WD. URL: <a href="https://www.w3.org/TR/CSP3/">https://www.w3.org/TR/CSP3/</a>
   <dt id="biblio-dom">[DOM]
   <dd>Anne van Kesteren. <a href="https://dom.spec.whatwg.org/"><cite>DOM Standard</cite></a>. Living Standard. URL: <a href="https://dom.spec.whatwg.org/">https://dom.spec.whatwg.org/</a>
   <dt id="biblio-ecmascript">[ECMASCRIPT]
   <dd><a href="https://tc39.es/ecma262/"><cite>ECMAScript Language Specification</cite></a>. URL: <a href="https://tc39.es/ecma262/">https://tc39.es/ecma262/</a>
   <dt id="biblio-fetch">[FETCH]
   <dd>Anne van Kesteren. <a href="https://fetch.spec.whatwg.org/"><cite>Fetch Standard</cite></a>. Living Standard. URL: <a href="https://fetch.spec.whatwg.org/">https://fetch.spec.whatwg.org/</a>
   <dt id="biblio-html">[HTML]
   <dd>Anne van Kesteren; et al. <a href="https://html.spec.whatwg.org/multipage/"><cite>HTML Standard</cite></a>. Living Standard. URL: <a href="https://html.spec.whatwg.org/multipage/">https://html.spec.whatwg.org/multipage/</a>
   <dt id="biblio-infra">[INFRA]
   <dd>Anne van Kesteren; Domenic Denicola. <a href="https://infra.spec.whatwg.org/"><cite>Infra Standard</cite></a>. Living Standard. URL: <a href="https://infra.spec.whatwg.org/">https://infra.spec.whatwg.org/</a>
   <dt id="biblio-referrer-policy">[REFERRER-POLICY]
   <dd>Jochen Eisinger; Emily Stark. <a href="https://www.w3.org/TR/referrer-policy/"><cite>Referrer Policy</cite></a>. 26 January 2017. CR. URL: <a href="https://www.w3.org/TR/referrer-policy/">https://www.w3.org/TR/referrer-policy/</a>
   <dt id="biblio-rfc2119">[RFC2119]
   <dd>S. Bradner. <a href="https://datatracker.ietf.org/doc/html/rfc2119"><cite>Key words for use in RFCs to Indicate Requirement Levels</cite></a>. March 1997. Best Current Practice. URL: <a href="https://datatracker.ietf.org/doc/html/rfc2119">https://datatracker.ietf.org/doc/html/rfc2119</a>
   <dt id="biblio-service-workers-1">[SERVICE-WORKERS-1]
   <dd>Alex Russell; et al. <a href="https://www.w3.org/TR/service-workers-1/"><cite>Service Workers 1</cite></a>. 19 November 2019. CR. URL: <a href="https://www.w3.org/TR/service-workers-1/">https://www.w3.org/TR/service-workers-1/</a>
   <dt id="biblio-url">[URL]
   <dd>Anne van Kesteren. <a href="https://url.spec.whatwg.org/"><cite>URL Standard</cite></a>. Living Standard. URL: <a href="https://url.spec.whatwg.org/">https://url.spec.whatwg.org/</a>
   <dt id="biblio-webidl">[WebIDL]
   <dd>Boris Zbarsky. <a href="https://heycam.github.io/webidl/"><cite>Web IDL</cite></a>. 15 December 2016. ED. URL: <a href="https://heycam.github.io/webidl/">https://heycam.github.io/webidl/</a>
  </dl>
  <h3 class="no-num no-ref heading settled" id="informative"><span class="content">Informative References</span><a class="self-link" href="#informative"></a></h3>
  <dl>
   <dt id="biblio-fetch-metadata">[FETCH-METADATA]
   <dd>Mike West. <a href="https://www.w3.org/TR/fetch-metadata/"><cite>Fetch Metadata Request Headers</cite></a>. 13 March 2021. WD. URL: <a href="https://www.w3.org/TR/fetch-metadata/">https://www.w3.org/TR/fetch-metadata/</a>
  </dl>
  <h2 class="no-num no-ref heading settled" id="idl-index"><span class="content">IDL Index</span><a class="self-link" href="#idl-index"></a></h2>
<pre class="idl highlight def">[<a class="idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed"><c- g>Exposed</c-></a>=<c- n>Window</c->, <a class="idl-code" data-link-type="extended-attribute" href="https://html.spec.whatwg.org/multipage/dom.html#htmlconstructor"><c- g>HTMLConstructor</c-></a>]
<c- b>interface</c-> <a href="#htmlportalelement"><code><c- g>HTMLPortalElement</c-></code></a> : <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/dom.html#htmlelement"><c- n>HTMLElement</c-></a> {
    [<a class="idl-code" data-link-type="extended-attribute" href="https://html.spec.whatwg.org/multipage/custom-elements.html#cereactions"><c- g>CEReactions</c-></a>] <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-USVString"><c- b>USVString</c-></a> <a class="idl-code" data-link-type="attribute" data-type="USVString" href="#dom-htmlportalelement-src"><c- g>src</c-></a>;
    [<a class="idl-code" data-link-type="extended-attribute" href="https://html.spec.whatwg.org/multipage/custom-elements.html#cereactions"><c- g>CEReactions</c-></a>] <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString"><c- b>DOMString</c-></a> <a class="idl-code" data-link-type="attribute" data-type="DOMString" href="#dom-htmlportalelement-referrerpolicy"><c- g>referrerPolicy</c-></a>;

    [<a class="idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#NewObject"><c- g>NewObject</c-></a>] <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-promise"><c- b>Promise</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-undefined"><c- b>undefined</c-></a>> <a class="idl-code" data-link-type="method" href="#dom-htmlportalelement-activate"><c- g>activate</c-></a>(<c- b>optional</c-> <a data-link-type="idl-name" href="#dictdef-portalactivateoptions"><c- n>PortalActivateOptions</c-></a> <a href="#dom-htmlportalelement-activate-options-options"><code><c- g>options</c-></code></a> = {});
    <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-undefined"><c- b>undefined</c-></a> <a class="idl-code" data-link-type="method" href="#dom-htmlportalelement-postmessage"><c- g>postMessage</c-></a>(<a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-any"><c- b>any</c-></a> <a href="#dom-htmlportalelement-postmessage-message-options-message"><code><c- g>message</c-></code></a>, <c- b>optional</c-> <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/web-messaging.html#postmessageoptions"><c- n>PostMessageOptions</c-></a> <a href="#dom-htmlportalelement-postmessage-message-options-options"><code><c- g>options</c-></code></a> = {});

    <c- b>attribute</c-> <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler"><c- n>EventHandler</c-></a> <a data-type="EventHandler" href="#dom-htmlportalelement-onmessage"><code><c- g>onmessage</c-></code></a>;
    <c- b>attribute</c-> <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler"><c- n>EventHandler</c-></a> <a data-type="EventHandler" href="#dom-htmlportalelement-onmessageerror"><code><c- g>onmessageerror</c-></code></a>;
};

<c- b>dictionary</c-> <a href="#dictdef-portalactivateoptions"><code><c- g>PortalActivateOptions</c-></code></a> : <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/web-messaging.html#postmessageoptions"><c- n>PostMessageOptions</c-></a> {
    <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-any"><c- b>any</c-></a> <a data-type="any " href="#dom-portalactivateoptions-data"><code><c- g>data</c-></code></a>;
};

<c- b>partial</c-> <c- b>interface</c-> <a class="idl-code" data-link-type="interface" href="https://html.spec.whatwg.org/multipage/window-object.html#window"><c- g>Window</c-></a> {
    <c- b>readonly</c-> <c- b>attribute</c-> <a data-link-type="idl-name" href="#portalhost"><c- n>PortalHost</c-></a>? <a class="idl-code" data-link-type="attribute" data-readonly data-type="PortalHost?" href="#dom-window-portalhost"><c- g>portalHost</c-></a>;
};

[<a class="idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed"><c- g>Exposed</c-></a>=<c- n>Window</c->]
<c- b>interface</c-> <a href="#portalhost"><code><c- g>PortalHost</c-></code></a> : <a data-link-type="idl-name" href="https://dom.spec.whatwg.org/#eventtarget"><c- n>EventTarget</c-></a> {
    <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-undefined"><c- b>undefined</c-></a> <a class="idl-code" data-link-type="method" href="#dom-portalhost-postmessage"><c- g>postMessage</c-></a>(<a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-any"><c- b>any</c-></a> <a href="#dom-portalhost-postmessage-message-options-message"><code><c- g>message</c-></code></a>, <c- b>optional</c-> <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/web-messaging.html#postmessageoptions"><c- n>PostMessageOptions</c-></a> <a href="#dom-portalhost-postmessage-message-options-options"><code><c- g>options</c-></code></a> = {});

    <c- b>attribute</c-> <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler"><c- n>EventHandler</c-></a> <a data-type="EventHandler" href="#dom-portalhost-onmessage"><code><c- g>onmessage</c-></code></a>;
    <c- b>attribute</c-> <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler"><c- n>EventHandler</c-></a> <a data-type="EventHandler" href="#dom-portalhost-onmessageerror"><code><c- g>onmessageerror</c-></code></a>;
};

[<a class="idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed"><c- g>Exposed</c-></a>=<c- n>Window</c->]
<c- b>interface</c-> <a href="#portalactivateevent"><code><c- g>PortalActivateEvent</c-></code></a> : <a data-link-type="idl-name" href="https://dom.spec.whatwg.org/#event"><c- n>Event</c-></a> {
    <a href="#dom-portalactivateevent-portalactivateevent"><code><c- g>constructor</c-></code></a>(<a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString"><c- b>DOMString</c-></a> <a href="#dom-portalactivateevent-portalactivateevent-type-eventinitdict-type"><code><c- g>type</c-></code></a>, <c- b>optional</c-> <a data-link-type="idl-name" href="#dictdef-portalactivateeventinit"><c- n>PortalActivateEventInit</c-></a> <a href="#dom-portalactivateevent-portalactivateevent-type-eventinitdict-eventinitdict"><code><c- g>eventInitDict</c-></code></a> = {});

    <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-any"><c- b>any</c-></a> <a data-readonly data-type="any" href="#dom-portalactivateevent-data"><code><c- g>data</c-></code></a>;
    <a data-link-type="idl-name" href="#htmlportalelement"><c- n>HTMLPortalElement</c-></a> <a class="idl-code" data-link-type="method" href="#dom-portalactivateevent-adoptpredecessor"><c- g>adoptPredecessor</c-></a>();
};

<c- b>dictionary</c-> <a href="#dictdef-portalactivateeventinit"><code><c- g>PortalActivateEventInit</c-></code></a> : <a data-link-type="idl-name" href="https://dom.spec.whatwg.org/#dictdef-eventinit"><c- n>EventInit</c-></a> {
    <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-any"><c- b>any</c-></a> <a data-default="null" data-type="any " href="#dom-portalactivateeventinit-data"><code><c- g>data</c-></code></a> = <c- b>null</c->;
};

<c- b>typedef</c-> (<a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/window-object.html#windowproxy"><c- n>WindowProxy</c-></a> <c- b>or</c-> <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/web-messaging.html#messageport"><c- n>MessagePort</c-></a> <c- b>or</c-> <a data-link-type="idl-name" href="https://w3c.github.io/ServiceWorker/#serviceworker"><c- n>ServiceWorker</c-></a> <c- b>or</c-> <a data-link-type="idl-name" href="#htmlportalelement"><c- n>HTMLPortalElement</c-></a> <c- b>or</c-> <a data-link-type="idl-name" href="#portalhost"><c- n>PortalHost</c-></a>) <a href="#typedefdef-messageeventsource"><code><c- g>MessageEventSource</c-></code></a>;

<c- b>partial</c-> <c- b>interface</c-> <c- b>mixin</c-> <a class="idl-code" data-link-type="interface" href="https://html.spec.whatwg.org/multipage/webappapis.html#windoweventhandlers"><c- g>WindowEventHandlers</c-></a> {
    <c- b>attribute</c-> <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler"><c- n>EventHandler</c-></a> <a data-type="EventHandler" href="#dom-windoweventhandlers-onportalactivate"><code><c- g>onportalactivate</c-></code></a>;
};

</pre>
  <h2 class="no-num no-ref heading settled" id="issues-index"><span class="content">Issues Index</span><a class="self-link" href="#issues-index"></a></h2>
  <div style="counter-reset:issue">
   <div class="issue"> Determine how to treat unload/beforeunload handlers. See <a href="https://github.com/WICG/portals/issues/225">issue #225</a> for discussion. <a class="issue-return" href="#issue-c722a2b5" title="Jump to section">↵</a></div>
   <div class="issue"> In the case that structured deserialization throws, it may be useful to do something else to indicate it,
    rather than simply providing null data. <a class="issue-return" href="#issue-b49e4903" title="Jump to section">↵</a></div>
   <div class="issue"> We need to specify how the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/history.html#session-history">session history</a> of each browsing context is
    affected by activation, and supply non-normative text that explains how
    these histories are expected to be presented to the user. <a class="issue-return" href="#issue-0d72b101" title="Jump to section">↵</a></div>
   <div class="issue"> It might be convenient to not immediately detach the portal element, but instead to do so
    in a microtask. This would allow developers to reinsert the <code><a data-link-type="element" href="#elementdef-portal">portal</a></code> element without losing
    its browsing context. <a class="issue-return" href="#issue-833dc9f1" title="Jump to section">↵</a></div>
   <div class="issue">Although <code>navigate-to</code> works as expected while the content is portaled, we also
  need to apply it to prevent activation (which is basically a navigation). This is not yet specced,
  pending spec updates to the navigation and session history handling. <a class="issue-return" href="#issue-0eeb18ac" title="Jump to section">↵</a></div>
   <div class="issue"> We should expand this section further. Much of what was formerly there is in <a href="#other-spec-updates">§ 5 Updates to other specifications</a> now. Once we have a more comprehensive view of all the security-related
    spec updates, we should summarize them in a non-normative fashion here. <a class="issue-return" href="#issue-8e856747" title="Jump to section">↵</a></div>
  </div>
  <aside class="dfn-panel" data-for="portal-state">
   <b><a href="#portal-state">#portal-state</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-portal-state">2. Portal browsing contexts</a> <a href="#ref-for-portal-state①">(2)</a> <a href="#ref-for-portal-state②">(3)</a> <a href="#ref-for-portal-state③">(4)</a> <a href="#ref-for-portal-state④">(5)</a> <a href="#ref-for-portal-state⑤">(6)</a> <a href="#ref-for-portal-state⑥">(7)</a> <a href="#ref-for-portal-state⑦">(8)</a> <a href="#ref-for-portal-state⑧">(9)</a>
    <li><a href="#ref-for-portal-state⑨">3. The portal element</a> <a href="#ref-for-portal-state①⓪">(2)</a> <a href="#ref-for-portal-state①①">(3)</a>
    <li><a href="#ref-for-portal-state①②">3.1. Portal hosts</a> <a href="#ref-for-portal-state①③">(2)</a>
    <li><a href="#ref-for-portal-state①④">4.3. APIs for creating and navigating browsing contexts by name</a>
    <li><a href="#ref-for-portal-state①⑤">4.4. Navigation</a> <a href="#ref-for-portal-state①⑥">(2)</a>
    <li><a href="#ref-for-portal-state①⑦">4.5. Downloading resources</a> <a href="#ref-for-portal-state①⑧">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="portal-browsing-context">
   <b><a href="#portal-browsing-context">#portal-browsing-context</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-portal-browsing-context">2. Portal browsing contexts</a> <a href="#ref-for-portal-browsing-context①">(2)</a> <a href="#ref-for-portal-browsing-context②">(3)</a>
    <li><a href="#ref-for-portal-browsing-context③">3. The portal element</a> <a href="#ref-for-portal-browsing-context④">(2)</a> <a href="#ref-for-portal-browsing-context⑤">(3)</a> <a href="#ref-for-portal-browsing-context⑥">(4)</a> <a href="#ref-for-portal-browsing-context⑦">(5)</a> <a href="#ref-for-portal-browsing-context⑧">(6)</a> <a href="#ref-for-portal-browsing-context⑨">(7)</a>
    <li><a href="#ref-for-portal-browsing-context①⓪">3.1. Portal hosts</a> <a href="#ref-for-portal-browsing-context①①">(2)</a>
    <li><a href="#ref-for-portal-browsing-context①②">4.2. Event handlers</a> <a href="#ref-for-portal-browsing-context①③">(2)</a>
    <li><a href="#ref-for-portal-browsing-context①④">4.3. APIs for creating and navigating browsing contexts by name</a>
    <li><a href="#ref-for-portal-browsing-context①⑤">5.1.1. portal-src</a>
    <li><a href="#ref-for-portal-browsing-context①⑥">5.2. Fetch Metadata Request Headers</a> <a href="#ref-for-portal-browsing-context①⑦">(2)</a>
    <li><a href="#ref-for-portal-browsing-context①⑧">6.1. Overview</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="host-element">
   <b><a href="#host-element">#host-element</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-host-element">2. Portal browsing contexts</a> <a href="#ref-for-host-element①">(2)</a> <a href="#ref-for-host-element②">(3)</a> <a href="#ref-for-host-element③">(4)</a> <a href="#ref-for-host-element④">(5)</a> <a href="#ref-for-host-element⑤">(6)</a>
    <li><a href="#ref-for-host-element⑥">3. The portal element</a> <a href="#ref-for-host-element⑦">(2)</a> <a href="#ref-for-host-element⑧">(3)</a>
    <li><a href="#ref-for-host-element⑨">3.1. Portal hosts</a>
    <li><a href="#ref-for-host-element①⓪">4.4. Navigation</a> <a href="#ref-for-host-element①①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="host-browsing-context">
   <b><a href="#host-browsing-context">#host-browsing-context</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-host-browsing-context">2. Portal browsing contexts</a> <a href="#ref-for-host-browsing-context①">(2)</a>
    <li><a href="#ref-for-host-browsing-context②">3.1. Portal hosts</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="portal-task-source">
   <b><a href="#portal-task-source">#portal-task-source</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-portal-task-source">2. Portal browsing contexts</a> <a href="#ref-for-portal-task-source①">(2)</a> <a href="#ref-for-portal-task-source②">(3)</a> <a href="#ref-for-portal-task-source③">(4)</a>
    <li><a href="#ref-for-portal-task-source④">3. The portal element</a>
    <li><a href="#ref-for-portal-task-source⑤">3.1. Portal hosts</a>
    <li><a href="#ref-for-portal-task-source⑥">3.2. The PortalActivateEvent interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="activate-a-portal-browsing-context">
   <b><a href="#activate-a-portal-browsing-context">#activate-a-portal-browsing-context</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-activate-a-portal-browsing-context">2. Portal browsing contexts</a> <a href="#ref-for-activate-a-portal-browsing-context①">(2)</a>
    <li><a href="#ref-for-activate-a-portal-browsing-context②">3. The portal element</a> <a href="#ref-for-activate-a-portal-browsing-context③">(2)</a>
    <li><a href="#ref-for-activate-a-portal-browsing-context④">3.1. Portal hosts</a> <a href="#ref-for-activate-a-portal-browsing-context⑤">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="adopt-the-predecessor-browsing-context">
   <b><a href="#adopt-the-predecessor-browsing-context">#adopt-the-predecessor-browsing-context</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-adopt-the-predecessor-browsing-context">2. Portal browsing contexts</a> <a href="#ref-for-adopt-the-predecessor-browsing-context①">(2)</a>
    <li><a href="#ref-for-adopt-the-predecessor-browsing-context②">3. The portal element</a> <a href="#ref-for-adopt-the-predecessor-browsing-context③">(2)</a>
    <li><a href="#ref-for-adopt-the-predecessor-browsing-context④">3.2. The PortalActivateEvent interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="elementdef-portal">
   <b><a href="#elementdef-portal">#elementdef-portal</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-elementdef-portal">2. Portal browsing contexts</a> <a href="#ref-for-elementdef-portal①">(2)</a> <a href="#ref-for-elementdef-portal②">(3)</a>
    <li><a href="#ref-for-elementdef-portal③">3. The portal element</a> <a href="#ref-for-elementdef-portal④">(2)</a> <a href="#ref-for-elementdef-portal⑤">(3)</a> <a href="#ref-for-elementdef-portal⑥">(4)</a> <a href="#ref-for-elementdef-portal⑦">(5)</a> <a href="#ref-for-elementdef-portal⑧">(6)</a> <a href="#ref-for-elementdef-portal⑨">(7)</a> <a href="#ref-for-elementdef-portal①⓪">(8)</a> <a href="#ref-for-elementdef-portal①①">(9)</a> <a href="#ref-for-elementdef-portal①②">(10)</a> <a href="#ref-for-elementdef-portal①③">(11)</a> <a href="#ref-for-elementdef-portal①④">(12)</a> <a href="#ref-for-elementdef-portal①⑤">(13)</a> <a href="#ref-for-elementdef-portal①⑥">(14)</a> <a href="#ref-for-elementdef-portal①⑦">(15)</a> <a href="#ref-for-elementdef-portal①⑧">(16)</a> <a href="#ref-for-elementdef-portal①⑨">(17)</a> <a href="#ref-for-elementdef-portal②⓪">(18)</a> <a href="#ref-for-elementdef-portal②①">(19)</a> <a href="#ref-for-elementdef-portal②②">(20)</a> <a href="#ref-for-elementdef-portal②③">(21)</a> <a href="#ref-for-elementdef-portal②④">(22)</a>
    <li><a href="#ref-for-elementdef-portal②⑤">3.2. The PortalActivateEvent interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="htmlportalelement-guest-browsing-context">
   <b><a href="#htmlportalelement-guest-browsing-context">#htmlportalelement-guest-browsing-context</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-htmlportalelement-guest-browsing-context">2. Portal browsing contexts</a>
    <li><a href="#ref-for-htmlportalelement-guest-browsing-context①">3. The portal element</a> <a href="#ref-for-htmlportalelement-guest-browsing-context②">(2)</a> <a href="#ref-for-htmlportalelement-guest-browsing-context③">(3)</a> <a href="#ref-for-htmlportalelement-guest-browsing-context④">(4)</a> <a href="#ref-for-htmlportalelement-guest-browsing-context⑤">(5)</a> <a href="#ref-for-htmlportalelement-guest-browsing-context⑥">(6)</a> <a href="#ref-for-htmlportalelement-guest-browsing-context⑦">(7)</a> <a href="#ref-for-htmlportalelement-guest-browsing-context⑧">(8)</a> <a href="#ref-for-htmlportalelement-guest-browsing-context⑨">(9)</a> <a href="#ref-for-htmlportalelement-guest-browsing-context①⓪">(10)</a> <a href="#ref-for-htmlportalelement-guest-browsing-context①①">(11)</a>
    <li><a href="#ref-for-htmlportalelement-guest-browsing-context①②">3.1. Portal hosts</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="htmlportalelement-just-adopted-flag">
   <b><a href="#htmlportalelement-just-adopted-flag">#htmlportalelement-just-adopted-flag</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-htmlportalelement-just-adopted-flag">2. Portal browsing contexts</a> <a href="#ref-for-htmlportalelement-just-adopted-flag①">(2)</a> <a href="#ref-for-htmlportalelement-just-adopted-flag②">(3)</a>
    <li><a href="#ref-for-htmlportalelement-just-adopted-flag③">3. The portal element</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="element-attrdef-portal-src">
   <b><a href="#element-attrdef-portal-src">#element-attrdef-portal-src</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-element-attrdef-portal-src">3. The portal element</a> <a href="#ref-for-element-attrdef-portal-src①">(2)</a> <a href="#ref-for-element-attrdef-portal-src②">(3)</a> <a href="#ref-for-element-attrdef-portal-src③">(4)</a> <a href="#ref-for-element-attrdef-portal-src④">(5)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="element-attrdef-portal-referrerpolicy">
   <b><a href="#element-attrdef-portal-referrerpolicy">#element-attrdef-portal-referrerpolicy</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-element-attrdef-portal-referrerpolicy">3. The portal element</a> <a href="#ref-for-element-attrdef-portal-referrerpolicy①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="htmlportalelement">
   <b><a href="#htmlportalelement">#htmlportalelement</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-htmlportalelement">2. Portal browsing contexts</a>
    <li><a href="#ref-for-htmlportalelement①">3. The portal element</a>
    <li><a href="#ref-for-htmlportalelement②">3.2. The PortalActivateEvent interface</a>
    <li><a href="#ref-for-htmlportalelement③">4.1. The MessageEvent interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-htmlportalelement-onmessage">
   <b><a href="#dom-htmlportalelement-onmessage">#dom-htmlportalelement-onmessage</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-htmlportalelement-onmessage">3. The portal element</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-htmlportalelement-onmessageerror">
   <b><a href="#dom-htmlportalelement-onmessageerror">#dom-htmlportalelement-onmessageerror</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-htmlportalelement-onmessageerror">3. The portal element</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dictdef-portalactivateoptions">
   <b><a href="#dictdef-portalactivateoptions">#dictdef-portalactivateoptions</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dictdef-portalactivateoptions">3. The portal element</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-portalactivateoptions-data">
   <b><a href="#dom-portalactivateoptions-data">#dom-portalactivateoptions-data</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-portalactivateoptions-data">3. The portal element</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-htmlportalelement-src">
   <b><a href="#dom-htmlportalelement-src">#dom-htmlportalelement-src</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-htmlportalelement-src">3. The portal element</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-htmlportalelement-referrerpolicy">
   <b><a href="#dom-htmlportalelement-referrerpolicy">#dom-htmlportalelement-referrerpolicy</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-htmlportalelement-referrerpolicy">3. The portal element</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-htmlportalelement-activate">
   <b><a href="#dom-htmlportalelement-activate">#dom-htmlportalelement-activate</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-htmlportalelement-activate">2. Portal browsing contexts</a> <a href="#ref-for-dom-htmlportalelement-activate①">(2)</a>
    <li><a href="#ref-for-dom-htmlportalelement-activate②">3. The portal element</a> <a href="#ref-for-dom-htmlportalelement-activate③">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-htmlportalelement-postmessage">
   <b><a href="#dom-htmlportalelement-postmessage">#dom-htmlportalelement-postmessage</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-htmlportalelement-postmessage">3. The portal element</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="may-have-a-guest-browsing-context">
   <b><a href="#may-have-a-guest-browsing-context">#may-have-a-guest-browsing-context</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-may-have-a-guest-browsing-context">2. Portal browsing contexts</a>
    <li><a href="#ref-for-may-have-a-guest-browsing-context①">3. The portal element</a> <a href="#ref-for-may-have-a-guest-browsing-context②">(2)</a> <a href="#ref-for-may-have-a-guest-browsing-context③">(3)</a> <a href="#ref-for-may-have-a-guest-browsing-context④">(4)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="close-a-portal-element">
   <b><a href="#close-a-portal-element">#close-a-portal-element</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-close-a-portal-element">3. The portal element</a>
    <li><a href="#ref-for-close-a-portal-element①">4.4. Navigation</a> <a href="#ref-for-close-a-portal-element②">(2)</a>
    <li><a href="#ref-for-close-a-portal-element③">5.1.1. portal-src</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="set-the-source-url-of-a-portal-element">
   <b><a href="#set-the-source-url-of-a-portal-element">#set-the-source-url-of-a-portal-element</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-set-the-source-url-of-a-portal-element">3. The portal element</a> <a href="#ref-for-set-the-source-url-of-a-portal-element①">(2)</a> <a href="#ref-for-set-the-source-url-of-a-portal-element②">(3)</a> <a href="#ref-for-set-the-source-url-of-a-portal-element③">(4)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="eventdef-htmlportalelement-message">
   <b><a href="#eventdef-htmlportalelement-message">#eventdef-htmlportalelement-message</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-eventdef-htmlportalelement-message">3.1. Portal hosts</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="eventdef-htmlportalelement-messageerror">
   <b><a href="#eventdef-htmlportalelement-messageerror">#eventdef-htmlportalelement-messageerror</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-eventdef-htmlportalelement-messageerror">3.1. Portal hosts</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="portal-host-object">
   <b><a href="#portal-host-object">#portal-host-object</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-portal-host-object">3. The portal element</a>
    <li><a href="#ref-for-portal-host-object①">3.1. Portal hosts</a> <a href="#ref-for-portal-host-object②">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-window-portalhost">
   <b><a href="#dom-window-portalhost">#dom-window-portalhost</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-window-portalhost">3.1. Portal hosts</a> <a href="#ref-for-dom-window-portalhost①">(2)</a> <a href="#ref-for-dom-window-portalhost②">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="portalhost">
   <b><a href="#portalhost">#portalhost</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-portalhost">2. Portal browsing contexts</a>
    <li><a href="#ref-for-portalhost①">3.1. Portal hosts</a> <a href="#ref-for-portalhost②">(2)</a> <a href="#ref-for-portalhost③">(3)</a> <a href="#ref-for-portalhost④">(4)</a>
    <li><a href="#ref-for-portalhost⑤">4.1. The MessageEvent interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-portalhost-postmessage">
   <b><a href="#dom-portalhost-postmessage">#dom-portalhost-postmessage</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-portalhost-postmessage">3.1. Portal hosts</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="eventdef-portalhost-message">
   <b><a href="#eventdef-portalhost-message">#eventdef-portalhost-message</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-eventdef-portalhost-message">3. The portal element</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="eventdef-portalhost-messageerror">
   <b><a href="#eventdef-portalhost-messageerror">#eventdef-portalhost-messageerror</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-eventdef-portalhost-messageerror">3. The portal element</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="portalactivateevent">
   <b><a href="#portalactivateevent">#portalactivateevent</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-portalactivateevent">2. Portal browsing contexts</a>
    <li><a href="#ref-for-portalactivateevent①">3.2. The PortalActivateEvent interface</a> <a href="#ref-for-portalactivateevent②">(2)</a> <a href="#ref-for-portalactivateevent③">(3)</a>
    <li><a href="#ref-for-portalactivateevent④">4.2. Event handlers</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-portalactivateevent-data">
   <b><a href="#dom-portalactivateevent-data">#dom-portalactivateevent-data</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-portalactivateevent-data">2. Portal browsing contexts</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dictdef-portalactivateeventinit">
   <b><a href="#dictdef-portalactivateeventinit">#dictdef-portalactivateeventinit</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dictdef-portalactivateeventinit">3.2. The PortalActivateEvent interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="portalactivateevent-predecessor-browsing-context">
   <b><a href="#portalactivateevent-predecessor-browsing-context">#portalactivateevent-predecessor-browsing-context</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-portalactivateevent-predecessor-browsing-context">2. Portal browsing contexts</a>
    <li><a href="#ref-for-portalactivateevent-predecessor-browsing-context①">3.2. The PortalActivateEvent interface</a> <a href="#ref-for-portalactivateevent-predecessor-browsing-context②">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="portalactivateevent-successor-window">
   <b><a href="#portalactivateevent-successor-window">#portalactivateevent-successor-window</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-portalactivateevent-successor-window">2. Portal browsing contexts</a>
    <li><a href="#ref-for-portalactivateevent-successor-window①">3.2. The PortalActivateEvent interface</a> <a href="#ref-for-portalactivateevent-successor-window②">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="portalactivateevent-activation-promise">
   <b><a href="#portalactivateevent-activation-promise">#portalactivateevent-activation-promise</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-portalactivateevent-activation-promise">2. Portal browsing contexts</a> <a href="#ref-for-portalactivateevent-activation-promise①">(2)</a>
    <li><a href="#ref-for-portalactivateevent-activation-promise②">3.2. The PortalActivateEvent interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="portalactivateevent-adopted-predecessor-element">
   <b><a href="#portalactivateevent-adopted-predecessor-element">#portalactivateevent-adopted-predecessor-element</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-portalactivateevent-adopted-predecessor-element">2. Portal browsing contexts</a>
    <li><a href="#ref-for-portalactivateevent-adopted-predecessor-element①">3.2. The PortalActivateEvent interface</a> <a href="#ref-for-portalactivateevent-adopted-predecessor-element②">(2)</a> <a href="#ref-for-portalactivateevent-adopted-predecessor-element③">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-portalactivateevent-adoptpredecessor">
   <b><a href="#dom-portalactivateevent-adoptpredecessor">#dom-portalactivateevent-adoptpredecessor</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-portalactivateevent-adoptpredecessor">2. Portal browsing contexts</a> <a href="#ref-for-dom-portalactivateevent-adoptpredecessor①">(2)</a>
    <li><a href="#ref-for-dom-portalactivateevent-adoptpredecessor②">3.2. The PortalActivateEvent interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="typedefdef-messageeventsource">
   <b><a href="#typedefdef-messageeventsource">#typedefdef-messageeventsource</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-typedefdef-messageeventsource">4.1. The MessageEvent interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="eventdef-window-portalactivate">
   <b><a href="#eventdef-window-portalactivate">#eventdef-window-portalactivate</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-eventdef-window-portalactivate">2. Portal browsing contexts</a> <a href="#ref-for-eventdef-window-portalactivate①">(2)</a>
    <li><a href="#ref-for-eventdef-window-portalactivate②">3. The portal element</a>
    <li><a href="#ref-for-eventdef-window-portalactivate③">3.2. The PortalActivateEvent interface</a>
    <li><a href="#ref-for-eventdef-window-portalactivate④">4.2. Event handlers</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="portal-src">
   <b><a href="#portal-src">#portal-src</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-portal-src">5.1.1. portal-src</a>
    <li><a href="#ref-for-portal-src①">5.1.2. default-src</a>
    <li><a href="#ref-for-portal-src②">5.1.3. Get fetch directive fallback list</a>
   </ul>
  </aside>
<script>/* script-dfn-panel */

document.body.addEventListener("click", function(e) {
    var queryAll = function(sel) { return [].slice.call(document.querySelectorAll(sel)); }
    // Find the dfn element or panel, if any, that was clicked on.
    var el = e.target;
    var target;
    var hitALink = false;
    while(el.parentElement) {
        if(el.tagName == "A") {
            // Clicking on a link in a <dfn> shouldn't summon the panel
            hitALink = true;
        }
        if(el.classList.contains("dfn-paneled")) {
            target = "dfn";
            break;
        }
        if(el.classList.contains("dfn-panel")) {
            target = "dfn-panel";
            break;
        }
        el = el.parentElement;
    }
    if(target != "dfn-panel") {
        // Turn off any currently "on" or "activated" panels.
        queryAll(".dfn-panel.on, .dfn-panel.activated").forEach(function(el){
            el.classList.remove("on");
            el.classList.remove("activated");
        });
    }
    if(target == "dfn" && !hitALink) {
        // open the panel
        var dfnPanel = document.querySelector(".dfn-panel[data-for='" + el.id + "']");
        if(dfnPanel) {
            dfnPanel.classList.add("on");
            var rect = el.getBoundingClientRect();
            dfnPanel.style.left = window.scrollX + rect.right + 5 + "px";
            dfnPanel.style.top = window.scrollY + rect.top + "px";
            var panelRect = dfnPanel.getBoundingClientRect();
            var panelWidth = panelRect.right - panelRect.left;
            if(panelRect.right > document.body.scrollWidth && (rect.left - (panelWidth + 5)) > 0) {
                // Reposition, because the panel is overflowing
                dfnPanel.style.left = window.scrollX + rect.left - (panelWidth + 5) + "px";
            }
        } else {
            console.log("Couldn't find .dfn-panel[data-for='" + el.id + "']");
        }
    } else if(target == "dfn-panel") {
        // Switch it to "activated" state, which pins it.
        el.classList.add("activated");
        el.style.left = null;
        el.style.top = null;
    }

});
</script>
<script>/* script-var-click-highlighting */

    document.addEventListener("click", e=>{
        if(e.target.nodeName == "VAR") {
            highlightSameAlgoVars(e.target);
        }
    });
    {
        const indexCounts = new Map();
        const indexNames = new Map();
        function highlightSameAlgoVars(v) {
            // Find the algorithm container.
            let algoContainer = null;
            let searchEl = v;
            while(algoContainer == null && searchEl != document.body) {
                searchEl = searchEl.parentNode;
                if(searchEl.hasAttribute("data-algorithm")) {
                    algoContainer = searchEl;
                }
            }

            // Not highlighting document-global vars,
            // too likely to be unrelated.
            if(algoContainer == null) return;

            const algoName = algoContainer.getAttribute("data-algorithm");
            const varName = getVarName(v);
            const addClass = !v.classList.contains("selected");
            let highlightClass = null;
            if(addClass) {
                const index = chooseHighlightIndex(algoName, varName);
                indexCounts.get(algoName)[index] += 1;
                indexNames.set(algoName+"///"+varName, index);
                highlightClass = nameFromIndex(index);
            } else {
                const index = previousHighlightIndex(algoName, varName);
                indexCounts.get(algoName)[index] -= 1;
                highlightClass = nameFromIndex(index);
            }

            // Find all same-name vars, and toggle their class appropriately.
            for(const el of algoContainer.querySelectorAll("var")) {
                if(getVarName(el) == varName) {
                    el.classList.toggle("selected", addClass);
                    el.classList.toggle(highlightClass, addClass);
                }
            }
        }
        function getVarName(el) {
            return el.textContent.replace(/(\s|\xa0)+/, " ").trim();
        }
        function chooseHighlightIndex(algoName, varName) {
            let indexes = null;
            if(indexCounts.has(algoName)) {
                indexes = indexCounts.get(algoName);
            } else {
                // 7 classes right now
                indexes = [0,0,0,0,0,0,0];
                indexCounts.set(algoName, indexes);
            }

            // If the element was recently unclicked,
            // *and* that color is still unclaimed,
            // give it back the same color.
            const lastIndex = previousHighlightIndex(algoName, varName);
            if(indexes[lastIndex] === 0) return lastIndex;

            // Find the earliest index with the lowest count.
            const minCount = Math.min.apply(null, indexes);
            let index = null;
            for(var i = 0; i < indexes.length; i++) {
                if(indexes[i] == minCount) {
                    return i;
                }
            }
        }
        function previousHighlightIndex(algoName, varName) {
            return indexNames.get(algoName+"///"+varName);
        }
        function nameFromIndex(index) {
            return "selected" + index;
        }
    }
    </script>
<script>/* script-wpt */

    let wptPath = "/portals/";
    
    document.addEventListener("DOMContentLoaded", async ()=>{
        if(wptPath == "/") wptPath = commonPathPrefix();
        if(wptPath == "/") return;

        const runsUrl = "https://wpt.fyi/api/runs?label=master&label=stable&max-count=1&product=chrome&product=firefox&product=safari&product=edge";
        const runs = await (await fetch(runsUrl)).json();

        const testResults = await( await fetch("https://wpt.fyi/api/search", {
            method:"POST",
            headers:{
                "Content-Type":"application/json",
            },
            body: JSON.stringify({
                "run_ids": runs.map(x=>x.id),
                "query": {"path": wptPath},
            })
        })).json();

        const browsers = runs.map(x=>x.browser_name)
        const resultsFromPath = new Map(testResults.results.map(result=>{
            const testPath = result.test;
            const passes = result.legacy_status.map(x=>[x.passes, x.total]);
            return [testPath, passes];
        }));
        document.querySelectorAll(".wpt-name").forEach(nameEl=>{
            const passData = resultsFromPath.get("/" + nameEl.getAttribute("title"));
            if(passData == undefined) return;
            const resultsEl = el("span",{"class":"wpt-results"},
                ...passData.map((p,i) => el("span",
                {
                    "title": `${browsers[i]} ${p[0]}/${p[1]}`,
                    "class": "wpt-result",
                    "style": `background: conic-gradient(forestgreen ${p[0]/p[1]*360}deg, darkred 0deg);`,
                })),
            );
            nameEl.insertAdjacentElement("afterend", resultsEl);
        })
    });
    function commonPathPrefix() {
        const paths = [...document.querySelectorAll(".wpt-name")].map(x=>x.getAttribute("title").split("/").slice(0, -1));
        let commonPrefix = paths[0];
        for(const path of paths.slice(1)) {
            // can't have a common prefix longer than the shortest path
            if(path.length < commonPrefix.length) commonPrefix.length = path.length;
            // now compare the remaining segments
            for(var i = 0; i < Math.min(commonPrefix.length, path.length); i++) {
                if(path[i] != commonPrefix[i]) {
                    commonPrefix.length = i;
                    break;
                }
            }
        }
        console.log(commonPrefix)
        if(commonPrefix.length >= 1) return "/" + commonPrefix.join("/") + "/";
        return "/";
    }
    function el(name, attrs, ...content) {
        const x = document.createElement(name);
        for(const [k,v] of Object.entries(attrs)) {
            x.setAttribute(k, v);
        }
        for(let child of content) {
            if(typeof child == "string") child = document.createTextNode(child);
            try {
            x.appendChild(child);
            } catch(e) { console.log({x, child}); }
        }
        return x;
    }


    </script>