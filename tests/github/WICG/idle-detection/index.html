<!doctype html><html lang="en">
 <head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
  <title>Idle Detection API</title>
  <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
  <link href="https://www.w3.org/StyleSheets/TR/2016/cg-draft" rel="stylesheet">
  <link href="https://wicg.github.io/idle-detection/" rel="canonical">
  <link href="logo-idle.png" rel="icon">
<style>
  table {
    border-collapse: collapse;
    border-left-style: hidden;
    border-right-style: hidden;
    text-align: left;
  }
  table td, table th {
    border: 1px solid black;
    padding: 3px;
  }
</style>
<style>/* style-autolinks */

.css.css, .property.property, .descriptor.descriptor {
    color: var(--a-normal-text);
    font-size: inherit;
    font-family: inherit;
}
.css::before, .property::before, .descriptor::before {
    content: "‘";
}
.css::after, .property::after, .descriptor::after {
    content: "’";
}
.property, .descriptor {
    /* Don't wrap property and descriptor names */
    white-space: nowrap;
}
.type { /* CSS value <type> */
    font-style: italic;
}
pre .property::before, pre .property::after {
    content: "";
}
[data-link-type="property"]::before,
[data-link-type="propdesc"]::before,
[data-link-type="descriptor"]::before,
[data-link-type="value"]::before,
[data-link-type="function"]::before,
[data-link-type="at-rule"]::before,
[data-link-type="selector"]::before,
[data-link-type="maybe"]::before {
    content: "‘";
}
[data-link-type="property"]::after,
[data-link-type="propdesc"]::after,
[data-link-type="descriptor"]::after,
[data-link-type="value"]::after,
[data-link-type="function"]::after,
[data-link-type="at-rule"]::after,
[data-link-type="selector"]::after,
[data-link-type="maybe"]::after {
    content: "’";
}

[data-link-type].production::before,
[data-link-type].production::after,
.prod [data-link-type]::before,
.prod [data-link-type]::after {
    content: "";
}

[data-link-type=element],
[data-link-type=element-attr] {
    font-family: Menlo, Consolas, "DejaVu Sans Mono", monospace;
    font-size: .9em;
}
[data-link-type=element]::before { content: "<" }
[data-link-type=element]::after  { content: ">" }

[data-link-type=biblio] {
    white-space: pre;
}</style>
<style>/* style-colors */

/* Any --*-text not paired with a --*-bg is assumed to have a transparent bg */
:root {
    color-scheme: light dark;

    --text: black;
    --bg: white;

    --unofficial-watermark: url(https://www.w3.org/StyleSheets/TR/2016/logos/UD-watermark);

    --logo-bg: #1a5e9a;
    --logo-active-bg: #c00;
    --logo-text: white;

    --tocnav-normal-text: #707070;
    --tocnav-normal-bg: var(--bg);
    --tocnav-hover-text: var(--tocnav-normal-text);
    --tocnav-hover-bg: #f8f8f8;
    --tocnav-active-text: #c00;
    --tocnav-active-bg: var(--tocnav-normal-bg);

    --tocsidebar-text: var(--text);
    --tocsidebar-bg: #f7f8f9;
    --tocsidebar-shadow: rgba(0,0,0,.1);
    --tocsidebar-heading-text: hsla(203,20%,40%,.7);

    --toclink-text: var(--text);
    --toclink-underline: #3980b5;
    --toclink-visited-text: var(--toclink-text);
    --toclink-visited-underline: #054572;

    --heading-text: #005a9c;

    --hr-text: var(--text);

    --algo-border: #def;

    --del-text: red;
    --del-bg: transparent;
    --ins-text: #080;
    --ins-bg: transparent;

    --a-normal-text: #034575;
    --a-normal-underline: #bbb;
    --a-visited-text: var(--a-normal-text);
    --a-visited-underline: #707070;
    --a-hover-bg: rgba(75%, 75%, 75%, .25);
    --a-active-text: #c00;
    --a-active-underline: #c00;

    --blockquote-border: silver;
    --blockquote-bg: transparent;
    --blockquote-text: currentcolor;

    --issue-border: #e05252;
    --issue-bg: #fbe9e9;
    --issue-text: var(--text);
    --issueheading-text: #831616;

    --example-border: #e0cb52;
    --example-bg: #fcfaee;
    --example-text: var(--text);
    --exampleheading-text: #574b0f;

    --note-border: #52e052;
    --note-bg: #e9fbe9;
    --note-text: var(--text);
    --noteheading-text: hsl(120, 70%, 30%);
    --notesummary-underline: silver;

    --assertion-border: #aaa;
    --assertion-bg: #eee;
    --assertion-text: black;

    --advisement-border: orange;
    --advisement-bg: #fec;
    --advisement-text: var(--text);
    --advisementheading-text: #b35f00;

    --warning-border: red;
    --warning-bg: hsla(40,100%,50%,0.95);
    --warning-text: var(--text);

    --amendment-border: #330099;
    --amendment-bg: #F5F0FF;
    --amendment-text: var(--text);
    --amendmentheading-text: #220066;

    --def-border: #8ccbf2;
    --def-bg: #def;
    --def-text: var(--text);
    --defrow-border: #bbd7e9;

    --datacell-border: silver;

    --indexinfo-text: #707070;

    --indextable-hover-text: black;
    --indextable-hover-bg: #f7f8f9;

    --outdatedspec-bg: rgba(0, 0, 0, .5);
    --outdatedspec-text: black;
    --outdated-bg: maroon;
    --outdated-text: white;
    --outdated-shadow: red;

    --editedrec-bg: darkorange;
}</style>
<style>/* style-counters */

body {
    counter-reset: example figure issue;
}
.issue {
    counter-increment: issue;
}
.issue:not(.no-marker)::before {
    content: "Issue " counter(issue);
}

.example {
    counter-increment: example;
}
.example:not(.no-marker)::before {
    content: "Example " counter(example);
}
.invalid.example:not(.no-marker)::before,
.illegal.example:not(.no-marker)::before {
    content: "Invalid Example" counter(example);
}

figcaption {
    counter-increment: figure;
}
figcaption:not(.no-marker)::before {
    content: "Figure " counter(figure) " ";
}</style>
<style>/* style-dfn-panel */

:root {
    --dfnpanel-bg: #ddd;
    --dfnpanel-text: var(--text);
}
.dfn-panel {
    position: absolute;
    z-index: 35;
    height: auto;
    width: -webkit-fit-content;
    width: fit-content;
    max-width: 300px;
    max-height: 500px;
    overflow: auto;
    padding: 0.5em 0.75em;
    font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
    background: var(--dfnpanel-bg);
    color: var(--dfnpanel-text);
    border: outset 0.2em;
}
.dfn-panel:not(.on) { display: none; }
.dfn-panel * { margin: 0; padding: 0; text-indent: 0; }
.dfn-panel > b { display: block; }
.dfn-panel a { color: var(--dfnpanel-text); }
.dfn-panel a:not(:hover) { text-decoration: none !important; border-bottom: none !important; }
.dfn-panel > b + b { margin-top: 0.25em; }
.dfn-panel ul { padding: 0; }
.dfn-panel li { list-style: inside; }
.dfn-panel.activated {
    display: inline-block;
    position: fixed;
    left: .5em;
    bottom: 2em;
    margin: 0 auto;
    max-width: calc(100vw - 1.5em - .4em - .5em);
    max-height: 30vh;
}

.dfn-paneled { cursor: pointer; }
</style>
<style>/* style-md-lists */

/* This is a weird hack for me not yet following the commonmark spec
   regarding paragraph and lists. */
[data-md] > :first-child {
    margin-top: 0;
}
[data-md] > :last-child {
    margin-bottom: 0;
}</style>
<style>/* style-selflinks */

:root {
    --selflink-text: white;
    --selflink-bg: gray;
    --selflink-hover-text: black;
}
.heading, .issue, .note, .example, li, dt {
    position: relative;
}
a.self-link {
    position: absolute;
    top: 0;
    left: calc(-1 * (3.5rem - 26px));
    width: calc(3.5rem - 26px);
    height: 2em;
    text-align: center;
    border: none;
    transition: opacity .2s;
    opacity: .5;
}
a.self-link:hover {
    opacity: 1;
}
.heading > a.self-link {
    font-size: 83%;
}
li > a.self-link {
    left: calc(-1 * (3.5rem - 26px) - 2em);
}
dfn > a.self-link {
    top: auto;
    left: auto;
    opacity: 0;
    width: 1.5em;
    height: 1.5em;
    background: var(--selflink-bg);
    color: var(--selflink-text);
    font-style: normal;
    transition: opacity .2s, background-color .2s, color .2s;
}
dfn:hover > a.self-link {
    opacity: 1;
}
dfn > a.self-link:hover {
    color: var(--selflink-hover-text);
}

a.self-link::before            { content: "¶"; }
.heading > a.self-link::before { content: "§"; }
dfn > a.self-link::before      { content: "#"; }
</style>
<style>/* style-syntax-highlighting */

            pre.idl.highlight {
                background: var(--borderedblock-bg, var(--def-bg));
            }
            
code.highlight { padding: .1em; border-radius: .3em; }
pre.highlight, pre > code.highlight { display: block; padding: 1em; margin: .5em 0; overflow: auto; border-radius: 0; }

.highlight:not(.idl) { background: rgba(0, 0, 0, .03); }
c-[a] { color: #990055 } /* Keyword.Declaration */
c-[b] { color: #990055 } /* Keyword.Type */
c-[c] { color: #708090 } /* Comment */
c-[d] { color: #708090 } /* Comment.Multiline */
c-[e] { color: #0077aa } /* Name.Attribute */
c-[f] { color: #669900 } /* Name.Tag */
c-[g] { color: #222222 } /* Name.Variable */
c-[k] { color: #990055 } /* Keyword */
c-[l] { color: #000000 } /* Literal */
c-[m] { color: #000000 } /* Literal.Number */
c-[n] { color: #0077aa } /* Name */
c-[o] { color: #999999 } /* Operator */
c-[p] { color: #999999 } /* Punctuation */
c-[s] { color: #a67f59 } /* Literal.String */
c-[t] { color: #a67f59 } /* Literal.String.Single */
c-[u] { color: #a67f59 } /* Literal.String.Double */
c-[cp] { color: #708090 } /* Comment.Preproc */
c-[c1] { color: #708090 } /* Comment.Single */
c-[cs] { color: #708090 } /* Comment.Special */
c-[kc] { color: #990055 } /* Keyword.Constant */
c-[kn] { color: #990055 } /* Keyword.Namespace */
c-[kp] { color: #990055 } /* Keyword.Pseudo */
c-[kr] { color: #990055 } /* Keyword.Reserved */
c-[ld] { color: #000000 } /* Literal.Date */
c-[nc] { color: #0077aa } /* Name.Class */
c-[no] { color: #0077aa } /* Name.Constant */
c-[nd] { color: #0077aa } /* Name.Decorator */
c-[ni] { color: #0077aa } /* Name.Entity */
c-[ne] { color: #0077aa } /* Name.Exception */
c-[nf] { color: #0077aa } /* Name.Function */
c-[nl] { color: #0077aa } /* Name.Label */
c-[nn] { color: #0077aa } /* Name.Namespace */
c-[py] { color: #0077aa } /* Name.Property */
c-[ow] { color: #999999 } /* Operator.Word */
c-[mb] { color: #000000 } /* Literal.Number.Bin */
c-[mf] { color: #000000 } /* Literal.Number.Float */
c-[mh] { color: #000000 } /* Literal.Number.Hex */
c-[mi] { color: #000000 } /* Literal.Number.Integer */
c-[mo] { color: #000000 } /* Literal.Number.Oct */
c-[sb] { color: #a67f59 } /* Literal.String.Backtick */
c-[sc] { color: #a67f59 } /* Literal.String.Char */
c-[sd] { color: #a67f59 } /* Literal.String.Doc */
c-[se] { color: #a67f59 } /* Literal.String.Escape */
c-[sh] { color: #a67f59 } /* Literal.String.Heredoc */
c-[si] { color: #a67f59 } /* Literal.String.Interpol */
c-[sx] { color: #a67f59 } /* Literal.String.Other */
c-[sr] { color: #a67f59 } /* Literal.String.Regex */
c-[ss] { color: #a67f59 } /* Literal.String.Symbol */
c-[vc] { color: #0077aa } /* Name.Variable.Class */
c-[vg] { color: #0077aa } /* Name.Variable.Global */
c-[vi] { color: #0077aa } /* Name.Variable.Instance */
c-[il] { color: #000000 } /* Literal.Number.Integer.Long */
</style>
<style>/* style-var-click-highlighting */

    var { cursor: pointer; }
    var.selected0 { background-color: #F4D200; box-shadow: 0 0 0 2px #F4D200; }
    var.selected1 { background-color: #FF87A2; box-shadow: 0 0 0 2px #FF87A2; }
    var.selected2 { background-color: #96E885; box-shadow: 0 0 0 2px #96E885; }
    var.selected3 { background-color: #3EEED2; box-shadow: 0 0 0 2px #3EEED2; }
    var.selected4 { background-color: #EACFB6; box-shadow: 0 0 0 2px #EACFB6; }
    var.selected5 { background-color: #82DDFF; box-shadow: 0 0 0 2px #82DDFF; }
    var.selected6 { background-color: #FFBCF2; box-shadow: 0 0 0 2px #FFBCF2; }
    </style>
<style>/* style-wpt */

:root {
    --wpt-border: hsl(0, 0%, 60%);
    --wpt-bg: hsl(0, 0%, 95%);
    --wpt-text: var(--text);
    --wptheading-text: hsl(0, 0%, 30%);
}
@media (prefers-color-scheme: dark) {
    :root {
        --wpt-border: hsl(0, 0%, 30%);
        --wpt-bg: var(--borderedblock-bg);
        --wpt-text: var(--text);
        --wptheading-text: hsl(0, 0%, 60%);
    }
}
.wpt-tests-block {
    list-style: none;
    border-left: .5em solid var(--wpt-border);
    background: var(--wpt-bg);
    color: var(--wpt-text);
    margin: 1em auto;
    padding: .5em;
}
.wpt-tests-block summary {
    color: var(--wptheading-text);
    font-weight: normal;
    text-transform: uppercase;
}
.wpt-tests-block summary::marker{
    color: var(--wpt-border);
}
.wpt-tests-block summary:hover::marker{
    color: var(--wpt-text);
}
/*
   The only content  of a wpt test block in its closed state is the <summary>,
   which contains the word TESTS,
   and that is absolutely positioned.
   In that closed state, wpt test blocks are styled
   to have a top margin whose height is exactly equal
   to the height of the absolutely positioned <summary>,
   and no other background/padding/margin/border.
   The wpt test block elements will therefore allow the maring
   of the previous/next block elements
   to collapse through them;
   if this combined margin would be larger than its own top margin,
   it stays as is,
   and therefore the pre-existing vertical rhythm of the document is undisturbed.
   If that combined margin would be smaller, it is grown to that size.
   This means that the wpt test block ensures
   that there's always enough vertical space to insert the summary,
   without adding more than is needed.
*/
.wpt-tests-block:not([open]){
    padding: 0;
    border: none;
    background: none;
    font-size: 0.75em;
    line-height: 1;
    position: relative;
    margin: 1em 0 0;
}
.wpt-tests-block:not([open]) summary {
    position: absolute;
    right: 0;
    bottom: 0;
}
/*
   It is possible that both the last child of a block element
   and the block element itself
   would be annotated with a <wpt> block each.
   If the block element has a padding or a border,
   that's fine, but otherwise
   the bottom margin of the block and of its last child would collapse
   and both <wpt> elements would overlap, being both placed there.
   To avoid that, add 1px of padding to the <wpt> element annotating the last child
   to prevent the bottom margin of the block and of its last child from collapsing
   (and as much negative margin,
   as wel only want to prevent margin collapsing,
   but are not trying to actually take more space).
*/
.wpt-tests-block:not([open]):last-child {
    padding-bottom: 1px;
    margin-bottom: -1px;
}
/*
   Exception to the previous rule:
   don't do that in non-last list items,
   because it's not necessary,
   and would therefore consume more space than strictly needed.
   Lists must have list items as children, not <wpt> elements,
   so a <wpt> element cannot be a sibling of a list item,
   and the collision that the previous rule avoids cannot happen.
*/
li:not(:last-child) > .wpt-tests-block:not([open]):last-child,
dd:not(:last-child) > .wpt-tests-block:not([open]):last-child {
    padding-bottom: 0;
    margin-bottom: 0;
}
.wpt-tests-block:not([open]):not(:hover){
    opacity: 0.5;
}
.wpt-tests-list {
    list-style: none;
    display: grid;
    margin: 0;
    padding: 0;
    grid-template-columns: 1fr auto auto;
    grid-column-gap: .5em;
}
.wpt-tests-block hr:last-child {
    display: none;
}
.wpt-test {
    display: contents;
}
.wpt-test > a {
    text-decoration: underline;
    border: none;
}
.wpt-test > .wpt-name { grid-column: 1; }
.wpt-test > .wpt-live { grid-column: 2; }
.wpt-test > .wpt-source { grid-column: 3; }
</style>
<style>/* style-darkmode */

@media (prefers-color-scheme: dark) {
    :root {
        --text: #ddd;
        --bg: black;

        --unofficial-watermark: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='400'%3E%3Cg fill='%23100808' transform='translate(200 200) rotate(-45) translate(-200 -200)' stroke='%23100808' stroke-width='3'%3E%3Ctext x='50%25' y='220' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EUNOFFICIAL%3C/text%3E%3Ctext x='50%25' y='305' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EDRAFT%3C/text%3E%3C/g%3E%3C/svg%3E");

        --logo-bg: #1a5e9a;
        --logo-active-bg: #c00;
        --logo-text: white;

        --tocnav-normal-text: #999;
        --tocnav-normal-bg: var(--bg);
        --tocnav-hover-text: var(--tocnav-normal-text);
        --tocnav-hover-bg: #080808;
        --tocnav-active-text: #f44;
        --tocnav-active-bg: var(--tocnav-normal-bg);

        --tocsidebar-text: var(--text);
        --tocsidebar-bg: #080808;
        --tocsidebar-shadow: rgba(255,255,255,.1);
        --tocsidebar-heading-text: hsla(203,20%,40%,.7);

        --toclink-text: var(--text);
        --toclink-underline: #6af;
        --toclink-visited-text: var(--toclink-text);
        --toclink-visited-underline: #054572;

        --heading-text: #8af;

        --hr-text: var(--text);

        --algo-border: #456;

        --del-text: #f44;
        --del-bg: transparent;
        --ins-text: #4a4;
        --ins-bg: transparent;

        --a-normal-text: #6af;
        --a-normal-underline: #555;
        --a-visited-text: var(--a-normal-text);
        --a-visited-underline: var(--a-normal-underline);
        --a-hover-bg: rgba(25%, 25%, 25%, .2);
        --a-active-text: #f44;
        --a-active-underline: var(--a-active-text);

        --borderedblock-bg: rgba(255, 255, 255, .05);

        --blockquote-border: silver;
        --blockquote-bg: var(--borderedblock-bg);
        --blockquote-text: currentcolor;

        --issue-border: #e05252;
        --issue-bg: var(--borderedblock-bg);
        --issue-text: var(--text);
        --issueheading-text: hsl(0deg, 70%, 70%);

        --example-border: hsl(50deg, 90%, 60%);
        --example-bg: var(--borderedblock-bg);
        --example-text: var(--text);
        --exampleheading-text: hsl(50deg, 70%, 70%);

        --note-border: hsl(120deg, 100%, 35%);
        --note-bg: var(--borderedblock-bg);
        --note-text: var(--text);
        --noteheading-text: hsl(120, 70%, 70%);
        --notesummary-underline: silver;

        --assertion-border: #444;
        --assertion-bg: var(--borderedblock-bg);
        --assertion-text: var(--text);

        --advisement-border: orange;
        --advisement-bg: #222218;
        --advisement-text: var(--text);
        --advisementheading-text: #f84;

        --warning-border: red;
        --warning-bg: hsla(40,100%,20%,0.95);
        --warning-text: var(--text);

        --amendment-border: #330099;
        --amendment-bg: #080010;
        --amendment-text: var(--text);
        --amendmentheading-text: #cc00ff;

        --def-border: #8ccbf2;
        --def-bg: #080818;
        --def-text: var(--text);
        --defrow-border: #136;

        --datacell-border: silver;

        --indexinfo-text: #aaa;

        --indextable-hover-text: var(--text);
        --indextable-hover-bg: #181818;

        --outdatedspec-bg: rgba(255, 255, 255, .5);
        --outdatedspec-text: black;
        --outdated-bg: maroon;
        --outdated-text: white;
        --outdated-shadow: red;

        --editedrec-bg: darkorange;
    }
    /* In case a transparent-bg image doesn't expect to be on a dark bg,
       which is quite common in practice... */
    img { background: white; }
}
@media (prefers-color-scheme: dark) {
    :root {
        --selflink-text: black;
        --selflink-bg: silver;
        --selflink-hover-text: white;
    }
}

@media (prefers-color-scheme: dark) {
    :root {
        --dfnpanel-bg: #222;
        --dfnpanel-text: var(--text);
    }
}
@media (prefers-color-scheme: dark) {
    .highlight:not(.idl) { background: rgba(255, 255, 255, .05); }

    c-[a] { color: #d33682 } /* Keyword.Declaration */
    c-[b] { color: #d33682 } /* Keyword.Type */
    c-[c] { color: #2aa198 } /* Comment */
    c-[d] { color: #2aa198 } /* Comment.Multiline */
    c-[e] { color: #268bd2 } /* Name.Attribute */
    c-[f] { color: #b58900 } /* Name.Tag */
    c-[g] { color: #cb4b16 } /* Name.Variable */
    c-[k] { color: #d33682 } /* Keyword */
    c-[l] { color: #657b83 } /* Literal */
    c-[m] { color: #657b83 } /* Literal.Number */
    c-[n] { color: #268bd2 } /* Name */
    c-[o] { color: #657b83 } /* Operator */
    c-[p] { color: #657b83 } /* Punctuation */
    c-[s] { color: #6c71c4 } /* Literal.String */
    c-[t] { color: #6c71c4 } /* Literal.String.Single */
    c-[u] { color: #6c71c4 } /* Literal.String.Double */
    c-[ch] { color: #2aa198 } /* Comment.Hashbang */
    c-[cp] { color: #2aa198 } /* Comment.Preproc */
    c-[cpf] { color: #2aa198 } /* Comment.PreprocFile */
    c-[c1] { color: #2aa198 } /* Comment.Single */
    c-[cs] { color: #2aa198 } /* Comment.Special */
    c-[kc] { color: #d33682 } /* Keyword.Constant */
    c-[kn] { color: #d33682 } /* Keyword.Namespace */
    c-[kp] { color: #d33682 } /* Keyword.Pseudo */
    c-[kr] { color: #d33682 } /* Keyword.Reserved */
    c-[ld] { color: #657b83 } /* Literal.Date */
    c-[nc] { color: #268bd2 } /* Name.Class */
    c-[no] { color: #268bd2 } /* Name.Constant */
    c-[nd] { color: #268bd2 } /* Name.Decorator */
    c-[ni] { color: #268bd2 } /* Name.Entity */
    c-[ne] { color: #268bd2 } /* Name.Exception */
    c-[nf] { color: #268bd2 } /* Name.Function */
    c-[nl] { color: #268bd2 } /* Name.Label */
    c-[nn] { color: #268bd2 } /* Name.Namespace */
    c-[py] { color: #268bd2 } /* Name.Property */
    c-[ow] { color: #657b83 } /* Operator.Word */
    c-[mb] { color: #657b83 } /* Literal.Number.Bin */
    c-[mf] { color: #657b83 } /* Literal.Number.Float */
    c-[mh] { color: #657b83 } /* Literal.Number.Hex */
    c-[mi] { color: #657b83 } /* Literal.Number.Integer */
    c-[mo] { color: #657b83 } /* Literal.Number.Oct */
    c-[sa] { color: #6c71c4 } /* Literal.String.Affix */
    c-[sb] { color: #6c71c4 } /* Literal.String.Backtick */
    c-[sc] { color: #6c71c4 } /* Literal.String.Char */
    c-[dl] { color: #6c71c4 } /* Literal.String.Delimiter */
    c-[sd] { color: #6c71c4 } /* Literal.String.Doc */
    c-[se] { color: #6c71c4 } /* Literal.String.Escape */
    c-[sh] { color: #6c71c4 } /* Literal.String.Heredoc */
    c-[si] { color: #6c71c4 } /* Literal.String.Interpol */
    c-[sx] { color: #6c71c4 } /* Literal.String.Other */
    c-[sr] { color: #6c71c4 } /* Literal.String.Regex */
    c-[ss] { color: #6c71c4 } /* Literal.String.Symbol */
    c-[fm] { color: #268bd2 } /* Name.Function.Magic */
    c-[vc] { color: #cb4b16 } /* Name.Variable.Class */
    c-[vg] { color: #cb4b16 } /* Name.Variable.Global */
    c-[vi] { color: #cb4b16 } /* Name.Variable.Instance */
    c-[vm] { color: #cb4b16 } /* Name.Variable.Magic */
    c-[il] { color: #657b83 } /* Literal.Number.Integer.Long */
}
</style>
 <body class="h-entry">
  <div class="head">
   <p data-fill-with="logo"><a class="logo" href="https://www.w3.org/"> <img alt="W3C" height="48" src="https://www.w3.org/StyleSheets/TR/2016/logos/W3C" width="72"> </a> </p>
   <h1 class="p-name no-ref" id="title">Idle Detection API</h1>
   <h2 class="no-num no-toc no-ref heading settled" id="profile-and-date"><span class="content">Draft Community Group Report, <time class="dt-updated" datetime="1970-01-01">1 January 1970</time></span></h2>
   <div data-fill-with="spec-metadata">
    <dl>
     <dt>This version:
     <dd><a class="u-url" href="https://wicg.github.io/idle-detection/">https://wicg.github.io/idle-detection/</a>
     <dt class="editor">Editor:
     <dd class="editor p-author h-card vcard" data-editor-id="83788"><a class="p-name fn u-email email" href="mailto:reillyg@google.com">Reilly Grant</a> (<a class="p-org org" href="https://www.google.com">Google LLC</a>)
    </dl>
   </div>
   <div data-fill-with="warning"></div>
   <p class="copyright" data-fill-with="copyright"><a href="http://www.w3.org/Consortium/Legal/ipr-notice#Copyright">Copyright</a> © 1970 the Contributors to the Idle Detection API Specification, published by the <a href="https://www.w3.org/community/wicg/">Web Platform Incubator Community Group</a> under the <a href="https://www.w3.org/community/about/agreements/cla/">W3C Community Contributor License Agreement (CLA)</a>.
A human-readable <a href="http://www.w3.org/community/about/agreements/cla-deed/">summary</a> is available. </p>
   <hr title="Separator for header">
  </div>
  <div class="p-summary" data-fill-with="abstract">
   <h2 class="no-num no-toc no-ref heading settled" id="abstract"><span class="content">Abstract</span></h2>
   <p>This document defines a web platform API for observing system-wide user presence signals.</p>
  </div>
  <div data-fill-with="at-risk"></div>
  <h2 class="no-num no-toc no-ref heading settled" id="status"><span class="content">Status of this document</span></h2>
  <div data-fill-with="status">
   <p> This specification was published by the <a href="https://www.w3.org/community/wicg/">Web Platform Incubator Community Group</a>.
  It is not a W3C Standard nor is it on the W3C Standards Track.

  Please note that under the <a href="https://www.w3.org/community/about/agreements/cla/">W3C Community Contributor License Agreement (CLA)</a> there is a limited opt-out and other conditions apply.

  Learn more about <a href="http://www.w3.org/community/">W3C Community and Business Groups</a>. </p>
   <p></p>
  </div>
  <div data-fill-with="at-risk"></div>
  <nav data-fill-with="table-of-contents" id="toc">
   <h2 class="no-num no-toc no-ref" id="contents">Table of Contents</h2>
   <ol class="toc" role="directory">
    <li>
     <a href="#introduction"><span class="secno">1</span> <span class="content">Introduction</span></a>
     <ol class="toc">
      <li><a href="#alternatives-considered"><span class="secno">1.1</span> <span class="content">Alternatives Considered</span></a>
     </ol>
    <li>
     <a href="#api"><span class="secno">2</span> <span class="content">Observing User Presence</span></a>
     <ol class="toc">
      <li>
       <a href="#api-model"><span class="secno">2.1</span> <span class="content">Model</span></a>
       <ol class="toc">
        <li><a href="#api-useridlestate"><span class="secno">2.1.1</span> <span class="content">The <code class="idl"><span>UserIdleState</span></code> enum</span></a>
        <li><a href="#api-screenidlestate"><span class="secno">2.1.2</span> <span class="content">The <code class="idl"><span>ScreenIdleState</span></code> enum</span></a>
       </ol>
      <li><a href="#api-permissions"><span class="secno">2.2</span> <span class="content">Permissions</span></a>
      <li><a href="#api-permissions-policy"><span class="secno">2.3</span> <span class="content">Permissions policy</span></a>
      <li>
       <a href="#api-idledetector"><span class="secno">2.4</span> <span class="content">The <code class="idl"><span>IdleDetector</span></code> interface</span></a>
       <ol class="toc">
        <li><a href="#api-idledetector-userstate"><span class="secno">2.4.1</span> <span class="content"><code class="idl"><span>userState</span></code> attribute</span></a>
        <li><a href="#api-idledetector-screenstate"><span class="secno">2.4.2</span> <span class="content"><code class="idl"><span>screenState</span></code> attribute</span></a>
        <li><a href="#api-idledetector-onchange"><span class="secno">2.4.3</span> <span class="content"><code class="idl"><span>onchange</span></code> attribute</span></a>
        <li><a href="#api-idledetector-requestpermission"><span class="secno">2.4.4</span> <span class="content"><code class="idl"><span>requestPermission()</span></code> method</span></a>
        <li><a href="#api-idledetector-start"><span class="secno">2.4.5</span> <span class="content"><code class="idl"><span>start()</span></code> method</span></a>
        <li><a href="#state-changes"><span class="secno">2.4.6</span> <span class="content">Reacting to state changes</span></a>
       </ol>
     </ol>
    <li>
     <a href="#security-and-privacy"><span class="secno">3</span> <span class="content">Security and privacy considerations</span></a>
     <ol class="toc">
      <li><a href="#privacy-cross-origin-leakage"><span class="secno">3.1</span> <span class="content">Cross-origin information leakage</span></a>
      <li><a href="#privacy-behavior-tracking"><span class="secno">3.2</span> <span class="content">Behavior tracking</span></a>
      <li><a href="#privacy-user-coercion"><span class="secno">3.3</span> <span class="content">User coercion</span></a>
     </ol>
    <li><a href="#accessibility"><span class="secno">4</span> <span class="content">Accessibility considerations</span></a>
    <li><a href="#internationalization"><span class="secno">5</span> <span class="content">Internationalization considerations</span></a>
    <li><a href="#acknowledgements"><span class="secno">6</span> <span class="content">Acknowledgements</span></a>
    <li>
     <a href="#w3c-conformance"><span class="secno"></span> <span class="content">Conformance</span></a>
     <ol class="toc">
      <li><a href="#w3c-conventions"><span class="secno"></span> <span class="content">Document conventions</span></a>
      <li><a href="#w3c-conformant-algorithms"><span class="secno"></span> <span class="content">Conformant Algorithms</span></a>
     </ol>
    <li>
     <a href="#index"><span class="secno"></span> <span class="content">Index</span></a>
     <ol class="toc">
      <li><a href="#index-defined-here"><span class="secno"></span> <span class="content">Terms defined by this specification</span></a>
      <li><a href="#index-defined-elsewhere"><span class="secno"></span> <span class="content">Terms defined by reference</span></a>
     </ol>
    <li>
     <a href="#references"><span class="secno"></span> <span class="content">References</span></a>
     <ol class="toc">
      <li><a href="#normative"><span class="secno"></span> <span class="content">Normative References</span></a>
      <li><a href="#informative"><span class="secno"></span> <span class="content">Informative References</span></a>
     </ol>
    <li><a href="#idl-index"><span class="secno"></span> <span class="content">IDL Index</span></a>
   </ol>
  </nav>
  <main>
   <h2 class="heading settled" data-level="1" id="introduction"><span class="secno">1. </span><span class="content">Introduction</span><a class="self-link" href="#introduction"></a></h2>
   <p><em>This section is non-normative.</em></p>
   <p>Using existing capabilities a page is able to determine when it is currently
visible to the user (using the <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/page-visibility-2/#dom-document-hidden" id="ref-for-dom-document-hidden">hidden</a></code> property and <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/page-visibility-2/#dom-document-onvisibilitychange" id="ref-for-dom-document-onvisibilitychange">onvisibilitychange</a></code> event). It is also possible to know when the
user has recently interacted with the page by observing <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/webappapis.html#handler-onmousemove" id="ref-for-handler-onmousemove">onmousemove</a></code>, <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/webappapis.html#handler-onkeypress" id="ref-for-handler-onkeypress">onkeypress</a></code>, and
other events triggered by user input. While sufficiently reflecting user
engagement with a particular page these events give an incomplete picture of
whether the user is still present at their device. For example, if <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/page-visibility-2/#dom-document-hidden" id="ref-for-dom-document-hidden①">hidden</a></code> is <code>true</code>, then the device screensaver may have activated,
or the user could have switched to a different application. If it is <code>false</code> but
there have been no recent input events, then the user could have left their
computer to grab a cup of coffee, or they could be editing a document in another
window side-by-side with the page.</p>
   <p>Making these distinctions is important for applications which have the option of
delivering notifications across multiple devices, such as a desktop and
smartphone. Users may find it frustrating when notifications are delivered to
the wrong device or are disruptive. For example, if they switch from a tab
containing a messaging application to one for a document they are editing, the
messaging application, not being able to observe that the user is still
interacting with their device, may assume that they have left to grab a coffee
and start delivering notifications to their phone, causing it to buzz
distractingly, instead of displaying notifications on their desktop or
incrementing a badge count.</p>
   <h3 class="heading settled" data-level="1.1" id="alternatives-considered"><span class="secno">1.1. </span><span class="content">Alternatives Considered</span><a class="self-link" href="#alternatives-considered"></a></h3>
   <p>An alternative design would protect this information by allowing a notification
to be marked as "hide on active" or "hide on idle" and not allowing the page to
observe whether or not the notification was actually shown. The problem with
this approach is that the intelligent notification routing described previously
requires observing these signals of user presence and making centralized
decisions based on the state of all of the user’s devices.</p>
   <p>For example, to route notifications to a user’s mobile device when they get up
to grab a coffee the messaging application could detect that it is no longer
visible and start sending push messages to the mobile device while marking the
desktop notifications as "hide on active". If the user were still at their desk
but using a different application then they would start getting the distracting
notifications from their mobile device this proposal is attempting to avoid
whether or not the desktop is able to successfully suppress them. Successful
suppression of duplicate and disruptive notification requires multi-device
coordination.</p>
   <p>Allowing notifications to be hidden also breaks implementor mitigations for the <a data-link-type="biblio" href="#biblio-push-api">[PUSH-API]</a> being used to run silent background tasks.</p>
   <h2 class="heading settled" data-level="2" id="api"><span class="secno">2. </span><span class="content">Observing User Presence</span><a class="self-link" href="#api"></a></h2>
   <h3 class="heading settled" data-level="2.1" id="api-model"><span class="secno">2.1. </span><span class="content">Model</span><a class="self-link" href="#api-model"></a></h3>
   <p>This specification defines a model for user presence on two dimensions: idle
state and screen lock.</p>
   <h4 class="heading settled" data-level="2.1.1" id="api-useridlestate"><span class="secno">2.1.1. </span><span class="content">The <code class="idl"><a data-link-type="idl" href="#enumdef-useridlestate" id="ref-for-enumdef-useridlestate">UserIdleState</a></code> enum</span><a class="self-link" href="#api-useridlestate"></a></h4>
<pre class="idl highlight def"><c- b>enum</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="enum" data-export id="enumdef-useridlestate"><code><c- g>UserIdleState</c-></code></dfn> {
    <dfn class="dfn-paneled idl-code" data-dfn-for="UserIdleState" data-dfn-type="enum-value" data-export id="dom-useridlestate-active"><code><c- s>"active"</c-></code></dfn>,
    <dfn class="dfn-paneled idl-code" data-dfn-for="UserIdleState" data-dfn-type="enum-value" data-export id="dom-useridlestate-idle"><code><c- s>"idle"</c-></code></dfn>
};
</pre>
   <dl>
    <dt data-md><code class="idl"><a data-link-type="idl" href="#dom-useridlestate-active" id="ref-for-dom-useridlestate-active">"active"</a></code>
    <dd data-md>
     <p>Indicates that the user has interacted with the device in the last <code class="idl"><a data-link-type="idl" href="#dom-idleoptions-threshold" id="ref-for-dom-idleoptions-threshold">threshold</a></code> milliseconds.</p>
    <dt data-md><code class="idl"><a data-link-type="idl" href="#dom-useridlestate-idle" id="ref-for-dom-useridlestate-idle">"idle"</a></code>
    <dd data-md>
     <p>Indicates that the user has not interacted with the device in at least <code class="idl"><a data-link-type="idl" href="#dom-idleoptions-threshold" id="ref-for-dom-idleoptions-threshold①">threshold</a></code> milliseconds.</p>
   </dl>
   <h4 class="heading settled" data-level="2.1.2" id="api-screenidlestate"><span class="secno">2.1.2. </span><span class="content">The <code class="idl"><a data-link-type="idl" href="#enumdef-screenidlestate" id="ref-for-enumdef-screenidlestate">ScreenIdleState</a></code> enum</span><a class="self-link" href="#api-screenidlestate"></a></h4>
<pre class="idl highlight def"><c- b>enum</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="enum" data-export id="enumdef-screenidlestate"><code><c- g>ScreenIdleState</c-></code></dfn> {
    <dfn class="dfn-paneled idl-code" data-dfn-for="ScreenIdleState" data-dfn-type="enum-value" data-export id="dom-screenidlestate-locked"><code><c- s>"locked"</c-></code></dfn>,
    <dfn class="dfn-paneled idl-code" data-dfn-for="ScreenIdleState" data-dfn-type="enum-value" data-export id="dom-screenidlestate-unlocked"><code><c- s>"unlocked"</c-></code></dfn>
};
</pre>
   <dl>
    <dt data-md><code class="idl"><a data-link-type="idl" href="#dom-screenidlestate-locked" id="ref-for-dom-screenidlestate-locked">"locked"</a></code>
    <dd data-md>
     <p>Indicates that the device has engaged a screensaver or lock screen which
prevents content from being seen or interacted with.</p>
    <dt data-md><code class="idl"><a data-link-type="idl" href="#dom-screenidlestate-unlocked" id="ref-for-dom-screenidlestate-unlocked">"unlocked"</a></code>
    <dd data-md>
     <p>Indicates that the device is able to display content and be interacted with.</p>
   </dl>
   <h3 class="heading settled" data-level="2.2" id="api-permissions"><span class="secno">2.2. </span><span class="content">Permissions</span><a class="self-link" href="#api-permissions"></a></h3>
   <p>The <dfn class="dfn-paneled idl-code" data-dfn-for="PermissionName" data-dfn-type="enum-value" data-export id="dom-permissionname-idle-detection"><code>"idle-detection"</code></dfn> <a data-link-type="dfn" href="https://w3c.github.io/permissions/#powerful-feature" id="ref-for-powerful-feature">powerful
feature</a> is a <a data-link-type="dfn" href="https://w3c.github.io/permissions/#boolean-feature" id="ref-for-boolean-feature">boolean feature</a>.</p>
   <h3 class="heading settled" data-level="2.3" id="api-permissions-policy"><span class="secno">2.3. </span><span class="content">Permissions policy</span><a class="self-link" href="#api-permissions-policy"></a></h3>
   <p>This specification defines a <a data-link-type="dfn" href="https://w3c.github.io/webappsec-permissions-policy/#policy-controlled-feature" id="ref-for-policy-controlled-feature">policy-controlled feature</a> identified by the
string <code>"idle-detection"</code>. Its <a data-link-type="dfn" href="https://w3c.github.io/webappsec-permissions-policy/#default-allowlist" id="ref-for-default-allowlist">default allowlist</a> is <code>'self'</code>.</p>
   <div class="note" role="note">
     The <a data-link-type="dfn" href="https://w3c.github.io/webappsec-permissions-policy/#default-allowlist" id="ref-for-default-allowlist①">default allowlist</a> of <code>'self'</code> allows usage of this feature on
same-origin nested frames by default but prevents access by third-party content. 
    <p>Third-party usage can be selectively enabled by adding the <code>allow="idle-detection"</code> attribute to an <code class="idl"><a data-link-type="idl" href="https://fetch.spec.whatwg.org/#dom-requestdestination-iframe" id="ref-for-dom-requestdestination-iframe">iframe</a></code> element:</p>
    <div class="example" id="example-45553a3a">
     <a class="self-link" href="#example-45553a3a"></a> 
<pre class="language-html highlight"><c- p>&lt;</c-><c- f>iframe</c-> <c- e>src</c-><c- o>=</c-><c- s>"https://example.com"</c-> <c- e>allow</c-><c- o>=</c-><c- s>"idle-detection"</c-><c- p>>&lt;/</c-><c- f>iframe</c-><c- p>></c->
</pre>
    </div>
    <p>Alternatively, this feature can be disabled completely in first-party contexts
by specifying the permissions policy in an HTTP response header:</p>
    <div class="example" id="example-9e9c9d17">
     <a class="self-link" href="#example-9e9c9d17"></a> 
<pre class="language-http highlight">Permissions-Policy: idle-detection 'none'
</pre>
    </div>
    <p>See <a data-link-type="biblio" href="#biblio-permissions-policy">[PERMISSIONS-POLICY]</a> for more details.</p>
   </div>
   <h3 class="heading settled" data-level="2.4" id="api-idledetector"><span class="secno">2.4. </span><span class="content">The <code class="idl"><a data-link-type="idl" href="#idledetector" id="ref-for-idledetector">IdleDetector</a></code> interface</span><a class="self-link" href="#api-idledetector"></a></h3>
<pre class="idl highlight def"><c- b>dictionary</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="dictionary" data-export id="dictdef-idleoptions"><code><c- g>IdleOptions</c-></code></dfn> {
  [<a class="idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#EnforceRange" id="ref-for-EnforceRange"><c- g>EnforceRange</c-></a>] <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-unsigned-long-long" id="ref-for-idl-unsigned-long-long"><c- b>unsigned</c-> <c- b>long</c-> <c- b>long</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="IdleOptions" data-dfn-type="dict-member" data-export data-type="unsigned long long " id="dom-idleoptions-threshold"><code><c- g>threshold</c-></code></dfn>;
  <a data-link-type="idl-name" href="https://dom.spec.whatwg.org/#abortsignal" id="ref-for-abortsignal"><c- n>AbortSignal</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="IdleOptions" data-dfn-type="dict-member" data-export data-type="AbortSignal " id="dom-idleoptions-signal"><code><c- g>signal</c-></code></dfn>;
};

[
  <a class="idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#SecureContext" id="ref-for-SecureContext"><c- g>SecureContext</c-></a>,
  <a class="idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed" id="ref-for-Exposed"><c- g>Exposed</c-></a>=(<c- n>Window</c->,<c- n>DedicatedWorker</c->)
] <c- b>interface</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="interface" data-export id="idledetector"><code><c- g>IdleDetector</c-></code></dfn> : <a data-link-type="idl-name" href="https://dom.spec.whatwg.org/#eventtarget" id="ref-for-eventtarget"><c- n>EventTarget</c-></a> {
  <dfn class="idl-code" data-dfn-for="IdleDetector" data-dfn-type="constructor" data-export data-lt="IdleDetector()|constructor()" id="dom-idledetector-idledetector"><code><c- g>constructor</c-></code><a class="self-link" href="#dom-idledetector-idledetector"></a></dfn>();
  <c- b>readonly</c-> <c- b>attribute</c-> <a data-link-type="idl-name" href="#enumdef-useridlestate" id="ref-for-enumdef-useridlestate①"><c- n>UserIdleState</c-></a>? <a class="idl-code" data-link-type="attribute" data-readonly data-type="UserIdleState?" href="#dom-idledetector-userstate" id="ref-for-dom-idledetector-userstate"><c- g>userState</c-></a>;
  <c- b>readonly</c-> <c- b>attribute</c-> <a data-link-type="idl-name" href="#enumdef-screenidlestate" id="ref-for-enumdef-screenidlestate①"><c- n>ScreenIdleState</c-></a>? <a class="idl-code" data-link-type="attribute" data-readonly data-type="ScreenIdleState?" href="#dom-idledetector-screenstate" id="ref-for-dom-idledetector-screenstate"><c- g>screenState</c-></a>;
  <c- b>attribute</c-> <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler" id="ref-for-eventhandler"><c- n>EventHandler</c-></a> <a class="idl-code" data-link-type="attribute" data-type="EventHandler" href="#dom-idledetector-onchange" id="ref-for-dom-idledetector-onchange"><c- g>onchange</c-></a>;
  [<a class="idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed" id="ref-for-Exposed①"><c- g>Exposed</c-></a>=<c- n>Window</c->] <c- b>static</c-> <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-promise" id="ref-for-idl-promise"><c- b>Promise</c-></a>&lt;<a data-link-type="idl-name" href="https://w3c.github.io/permissions/#enumdef-permissionstate" id="ref-for-enumdef-permissionstate"><c- n>PermissionState</c-></a>> <a class="idl-code" data-link-type="method" href="#dom-idledetector-requestpermission" id="ref-for-dom-idledetector-requestpermission"><c- g>requestPermission</c-></a>();
  <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-promise" id="ref-for-idl-promise①"><c- b>Promise</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-undefined" id="ref-for-idl-undefined"><c- b>undefined</c-></a>> <a class="idl-code" data-link-type="method" href="#dom-idledetector-start" id="ref-for-dom-idledetector-start"><c- g>start</c-></a>(<c- b>optional</c-> <a data-link-type="idl-name" href="#dictdef-idleoptions" id="ref-for-dictdef-idleoptions"><c- n>IdleOptions</c-></a> <dfn class="idl-code" data-dfn-for="IdleDetector/start(options), IdleDetector/start()" data-dfn-type="argument" data-export id="dom-idledetector-start-options-options"><code><c- g>options</c-></code><a class="self-link" href="#dom-idledetector-start-options-options"></a></dfn> = {});
};
</pre>
   <p>Instances of <code class="idl"><a data-link-type="idl" href="#idledetector" id="ref-for-idledetector①">IdleDetector</a></code> are created with the <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#sec-object-internal-methods-and-internal-slots" id="ref-for-sec-object-internal-methods-and-internal-slots">internal slots</a> described
in the following table:</p>
   <table>
    <tbody>
     <tr>
      <th><a data-link-type="dfn" href="https://tc39.github.io/ecma262/#sec-object-internal-methods-and-internal-slots" id="ref-for-sec-object-internal-methods-and-internal-slots①">Internal slot</a>
      <th>Initial value
      <th>Description (non-normative)
     <tr>
      <td><dfn class="dfn-paneled idl-code" data-dfn-for="IdleDetector" data-dfn-type="attribute" data-export id="dom-idledetector-state-slot"><code>[[state]]</code></dfn> 
      <td><code>"stopped"</code>
      <td>Tracks the active state of the <code class="idl"><a data-link-type="idl" href="#idledetector" id="ref-for-idledetector②">IdleDetector</a></code>
     <tr>
      <td><dfn class="dfn-paneled idl-code" data-dfn-for="IdleDetector" data-dfn-type="attribute" data-export id="dom-idledetector-threshold-slot"><code>[[threshold]]</code></dfn> 
      <td><code>undefined</code>
      <td>The configured idle detection threshold
     <tr>
      <td><dfn class="dfn-paneled idl-code" data-dfn-for="IdleDetector" data-dfn-type="attribute" data-export id="dom-idledetector-userstate-slot"><code>[[userState]]</code></dfn>
      <td><code>null</code>
      <td>The last known user idle state
     <tr>
      <td><dfn class="dfn-paneled idl-code" data-dfn-for="IdleDetector" data-dfn-type="attribute" data-export id="dom-idledetector-screenstate-slot"><code>[[screenState]]</code></dfn>
      <td><code>null</code>
      <td>The last known screen idle state
   </table>
   <details class="wpt-tests-block" dir="ltr" lang="en" open>
    <summary>Tests</summary>
    <ul class="wpt-tests-list">
     <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/idle-detection/idlharness-worker.https.window.js">idlharness-worker.https.window.js</a> <a class="wpt-live" href="https://wpt.live/idle-detection/idlharness-worker.https.window.js" title="idle-detection/idlharness-worker.https.window.js"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/idle-detection/idlharness-worker.https.window.js"><small>(source)</small></a>
     <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/idle-detection/idlharness.https.window.js">idlharness.https.window.js</a> <a class="wpt-live" href="https://wpt.live/idle-detection/idlharness.https.window.js" title="idle-detection/idlharness.https.window.js"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/idle-detection/idlharness.https.window.js"><small>(source)</small></a>
    </ul>
   </details>
   <p>Methods on this interface typically complete asynchronously, queuing work on the <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="idle-detection-task-source">idle detection task source</dfn>.</p>
   <h4 class="heading settled" data-level="2.4.1" id="api-idledetector-userstate"><span class="secno">2.4.1. </span><span class="content"><code class="idl"><a data-link-type="idl" href="#dom-idledetector-userstate" id="ref-for-dom-idledetector-userstate①">userState</a></code> attribute</span><a class="self-link" href="#api-idledetector-userstate"></a></h4>
   <div class="algorithm" data-algorithm="userState" data-algorithm-for="IdleDetector">
     The <dfn class="dfn-paneled idl-code" data-dfn-for="IdleDetector" data-dfn-type="attribute" data-export id="dom-idledetector-userstate"><code>userState</code></dfn> getter steps are: 
    <ol>
     <li data-md>
      <p>Return <a data-link-type="dfn" href="https://heycam.github.io/webidl/#this" id="ref-for-this">this</a>.<code class="idl"><a data-link-type="idl" href="#dom-idledetector-userstate-slot" id="ref-for-dom-idledetector-userstate-slot">[[userState]]</a></code>.</p>
    </ol>
   </div>
   <h4 class="heading settled" data-level="2.4.2" id="api-idledetector-screenstate"><span class="secno">2.4.2. </span><span class="content"><code class="idl"><a data-link-type="idl" href="#dom-idledetector-screenstate" id="ref-for-dom-idledetector-screenstate①">screenState</a></code> attribute</span><a class="self-link" href="#api-idledetector-screenstate"></a></h4>
   <div class="algorithm" data-algorithm="screenState" data-algorithm-for="IdleDetector">
     The <dfn class="dfn-paneled idl-code" data-dfn-for="IdleDetector" data-dfn-type="attribute" data-export id="dom-idledetector-screenstate"><code>screenState</code></dfn> getter steps are: 
    <ol>
     <li data-md>
      <p>Return <a data-link-type="dfn" href="https://heycam.github.io/webidl/#this" id="ref-for-this①">this</a>.<code class="idl"><a data-link-type="idl" href="#dom-idledetector-screenstate-slot" id="ref-for-dom-idledetector-screenstate-slot">[[screenState]]</a></code>.</p>
    </ol>
   </div>
   <h4 class="heading settled" data-level="2.4.3" id="api-idledetector-onchange"><span class="secno">2.4.3. </span><span class="content"><code class="idl"><a data-link-type="idl" href="#dom-idledetector-onchange" id="ref-for-dom-idledetector-onchange①">onchange</a></code> attribute</span><a class="self-link" href="#api-idledetector-onchange"></a></h4>
   <p><dfn class="dfn-paneled idl-code" data-dfn-for="IdleDetector" data-dfn-type="attribute" data-export id="dom-idledetector-onchange"><code>onchange</code></dfn> is an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#event-handler-idl-attributes" id="ref-for-event-handler-idl-attributes">Event handler IDL
attribute</a> for the <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/indices.html#event-change" id="ref-for-event-change">change</a></code> event type.</p>
   <h4 class="heading settled" data-level="2.4.4" id="api-idledetector-requestpermission"><span class="secno">2.4.4. </span><span class="content"><code class="idl"><a data-link-type="idl" href="#dom-idledetector-requestpermission" id="ref-for-dom-idledetector-requestpermission①">requestPermission()</a></code> method</span><a class="self-link" href="#api-idledetector-requestpermission"></a></h4>
   <div class="algorithm" data-algorithm="requestPermission()" data-algorithm-for="IdleDetector">
     The <dfn class="dfn-paneled idl-code" data-dfn-for="IdleDetector" data-dfn-type="method" data-export id="dom-idledetector-requestpermission"><code>requestPermission()</code></dfn> method steps are: 
    <ol>
     <li data-md>
      <p>If the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global" id="ref-for-concept-relevant-global">relevant global object</a> of <a data-link-type="dfn" href="https://heycam.github.io/webidl/#this" id="ref-for-this②">this</a> does not have <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/interaction.html#transient-activation" id="ref-for-transient-activation">transient
activation</a>, return <a data-link-type="dfn" href="https://heycam.github.io/webidl/#a-new-promise" id="ref-for-a-new-promise">a new promise</a> <a data-link-type="dfn" href="https://heycam.github.io/webidl/#reject" id="ref-for-reject">rejected</a> with a "<code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#notallowederror" id="ref-for-notallowederror">NotAllowedError</a></code>" <code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#idl-DOMException" id="ref-for-idl-DOMException">DOMException</a></code>.</p>
     <li data-md>
      <p>Let <var>result</var> be <a data-link-type="dfn" href="https://heycam.github.io/webidl/#a-new-promise" id="ref-for-a-new-promise①">a new promise</a>.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel" id="ref-for-in-parallel">In parallel</a>:</p>
      <ol>
       <li data-md>
        <p>Let <var>permissionState</var> be the result of <a data-link-type="dfn" href="https://w3c.github.io/permissions/#request-permission-to-use" id="ref-for-request-permission-to-use">requesting permission to use</a> the <a data-link-type="dfn" href="https://w3c.github.io/permissions/#powerful-feature" id="ref-for-powerful-feature①">powerful feature</a> named <code>"idle-detection"</code>.</p>
       <li data-md>
        <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task" id="ref-for-queue-a-global-task">Queue a global task</a> on the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global" id="ref-for-concept-relevant-global①">relevant global object</a> of <a data-link-type="dfn" href="https://heycam.github.io/webidl/#this" id="ref-for-this③">this</a> using the <a data-link-type="dfn" href="https://w3c.github.io/permissions/#permission-task-source" id="ref-for-permission-task-source">permission task source</a> to <a data-link-type="dfn" href="https://heycam.github.io/webidl/#resolve" id="ref-for-resolve">resolve</a> <var>result</var> with <var>permissionState</var>.</p>
      </ol>
     <li data-md>
      <p>Return <var>result</var>.</p>
    </ol>
   </div>
   <h4 class="heading settled" data-level="2.4.5" id="api-idledetector-start"><span class="secno">2.4.5. </span><span class="content"><code class="idl"><a data-link-type="idl" href="#dom-idledetector-start" id="ref-for-dom-idledetector-start①">start()</a></code> method</span><a class="self-link" href="#api-idledetector-start"></a></h4>
   <div class="algorithm" data-algorithm="start(options)" data-algorithm-for="IdleDetector">
    <p>The <dfn class="dfn-paneled idl-code" data-dfn-for="IdleDetector" data-dfn-type="method" data-export data-lt="start(options)|start()" id="dom-idledetector-start"><code>start(<var>options</var>)</code></dfn> method steps are:</p>
    <ol>
     <li data-md>
      <p>Let <var>result</var> be <a data-link-type="dfn" href="https://heycam.github.io/webidl/#a-new-promise" id="ref-for-a-new-promise②">a new promise</a>.</p>
     <li data-md>
      <p>If the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global" id="ref-for-concept-relevant-global②">relevant global object</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/window-object.html#concept-document-window" id="ref-for-concept-document-window">associated Document</a> is not <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/iframe-embed-object.html#allowed-to-use" id="ref-for-allowed-to-use">allowed
to use</a> the <a data-link-type="dfn" href="https://w3c.github.io/webappsec-permissions-policy/#policy-controlled-feature" id="ref-for-policy-controlled-feature①">policy-controlled feature</a> named <code>"idle-detection"</code> <a data-link-type="dfn" href="https://heycam.github.io/webidl/#reject" id="ref-for-reject①">reject</a> <var>result</var> with a "<code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#notallowederror" id="ref-for-notallowederror①">NotAllowedError</a></code>" <code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#idl-DOMException" id="ref-for-idl-DOMException①">DOMException</a></code> and return <var>result</var>.</p>
      <details class="wpt-tests-block" dir="ltr" lang="en" open>
       <summary>Tests</summary>
       <ul class="wpt-tests-list">
        <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/idle-detection/idle-detection-allowed-by-feature-policy-attribute-redirect-on-load.https.sub.html">idle-detection-allowed-by-feature-policy-attribute-redirect-on-load.https.sub.html</a> <a class="wpt-live" href="https://wpt.live/idle-detection/idle-detection-allowed-by-feature-policy-attribute-redirect-on-load.https.sub.html" title="idle-detection/idle-detection-allowed-by-feature-policy-attribute-redirect-on-load.https.sub.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/idle-detection/idle-detection-allowed-by-feature-policy-attribute-redirect-on-load.https.sub.html"><small>(source)</small></a>
        <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/idle-detection/idle-detection-allowed-by-feature-policy-attribute.https.sub.html">idle-detection-allowed-by-feature-policy-attribute.https.sub.html</a> <a class="wpt-live" href="https://wpt.live/idle-detection/idle-detection-allowed-by-feature-policy-attribute.https.sub.html" title="idle-detection/idle-detection-allowed-by-feature-policy-attribute.https.sub.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/idle-detection/idle-detection-allowed-by-feature-policy-attribute.https.sub.html"><small>(source)</small></a>
        <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/idle-detection/idle-detection-allowed-by-feature-policy.https.sub.html">idle-detection-allowed-by-feature-policy.https.sub.html</a> <a class="wpt-live" href="https://wpt.live/idle-detection/idle-detection-allowed-by-feature-policy.https.sub.html" title="idle-detection/idle-detection-allowed-by-feature-policy.https.sub.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/idle-detection/idle-detection-allowed-by-feature-policy.https.sub.html"><small>(source)</small></a>
        <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/idle-detection/idle-detection-default-feature-policy.https.sub.html">idle-detection-default-feature-policy.https.sub.html</a> <a class="wpt-live" href="https://wpt.live/idle-detection/idle-detection-default-feature-policy.https.sub.html" title="idle-detection/idle-detection-default-feature-policy.https.sub.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/idle-detection/idle-detection-default-feature-policy.https.sub.html"><small>(source)</small></a>
        <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/idle-detection/idle-detection-disabled-by-feature-policy.https.sub.html">idle-detection-disabled-by-feature-policy.https.sub.html</a> <a class="wpt-live" href="https://wpt.live/idle-detection/idle-detection-disabled-by-feature-policy.https.sub.html" title="idle-detection/idle-detection-disabled-by-feature-policy.https.sub.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/idle-detection/idle-detection-disabled-by-feature-policy.https.sub.html"><small>(source)</small></a>
       </ul>
      </details>
     <li data-md>
      <p>If <var>this</var>.<code class="idl"><a data-link-type="idl" href="#dom-idledetector-state-slot" id="ref-for-dom-idledetector-state-slot">[[state]]</a></code> is not <code>"stopped"</code>, <a data-link-type="dfn" href="https://heycam.github.io/webidl/#reject" id="ref-for-reject②">reject</a> <var>result</var> with an "<code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#invalidstateerror" id="ref-for-invalidstateerror">InvalidStateError</a></code>" <code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#idl-DOMException" id="ref-for-idl-DOMException②">DOMException</a></code> and return <var>result</var>.</p>
      <details class="wpt-tests-block" dir="ltr" lang="en" open>
       <summary>Tests</summary>
       <ul class="wpt-tests-list">
        <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/idle-detection/interceptor.https.html">interceptor.https.html</a> <a class="wpt-live" href="https://wpt.live/idle-detection/interceptor.https.html" title="idle-detection/interceptor.https.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/idle-detection/interceptor.https.html"><small>(source)</small></a>
       </ul>
      </details>
     <li data-md>
      <p>Set <var>this</var>.<code class="idl"><a data-link-type="idl" href="#dom-idledetector-state-slot" id="ref-for-dom-idledetector-state-slot①">[[state]]</a></code> to <code>"starting"</code>.</p>
     <li data-md>
      <p>If <var>options</var>[<code class="idl"><a data-link-type="idl" href="#dom-idleoptions-threshold" id="ref-for-dom-idleoptions-threshold②">"threshold"</a></code>] is less than 60,000 <a data-link-type="dfn" href="https://heycam.github.io/webidl/#reject" id="ref-for-reject③">reject</a> <var>result</var> with <code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#exceptiondef-typeerror" id="ref-for-exceptiondef-typeerror">TypeError</a></code> and return <var>result</var>.</p>
      <details class="wpt-tests-block" dir="ltr" lang="en" open>
       <summary>Tests</summary>
       <ul class="wpt-tests-list">
        <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/idle-detection/basics.tentative.https.window.js">basics.tentative.https.window.js</a> <a class="wpt-live" href="https://wpt.live/idle-detection/basics.tentative.https.window.js" title="idle-detection/basics.tentative.https.window.js"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/idle-detection/basics.tentative.https.window.js"><small>(source)</small></a>
       </ul>
      </details>
     <li data-md>
      <p>If <var>options</var>["<code class="idl"><a data-link-type="idl" href="#dom-idleoptions-signal" id="ref-for-dom-idleoptions-signal">signal</a></code>"] is present, then perform the following sub-steps:</p>
      <ol>
       <li data-md>
        <p>If <var>options</var>["<code class="idl"><a data-link-type="idl" href="#dom-idleoptions-signal" id="ref-for-dom-idleoptions-signal①">signal</a></code>"]'s <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#abortsignal-aborted-flag" id="ref-for-abortsignal-aborted-flag">aborted flag</a> is set, then <a data-link-type="dfn" href="https://heycam.github.io/webidl/#reject" id="ref-for-reject④">reject</a> <var>result</var> with an "<code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#aborterror" id="ref-for-aborterror">AbortError</a></code>" <code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#idl-DOMException" id="ref-for-idl-DOMException③">DOMException</a></code> and return <var>result</var>.</p>
       <li data-md>
        <p><a data-link-type="dfn" href="https://dom.spec.whatwg.org/#abortsignal-add" id="ref-for-abortsignal-add">Add the following abort steps</a> to <var>options</var>["<code class="idl"><a data-link-type="idl" href="#dom-idleoptions-signal" id="ref-for-dom-idleoptions-signal②">signal</a></code>"]:</p>
        <ol>
         <li data-md>
          <p>Set <var>this</var>.<code class="idl"><a data-link-type="idl" href="#dom-idledetector-state-slot" id="ref-for-dom-idledetector-state-slot②">[[state]]</a></code> to <code>"stopped"</code>.</p>
         <li data-md>
          <p><a data-link-type="dfn" href="https://heycam.github.io/webidl/#reject" id="ref-for-reject⑤">Reject</a> <var>result</var> with an "<code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#aborterror" id="ref-for-aborterror①">AbortError</a></code>" <code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#idl-DOMException" id="ref-for-idl-DOMException④">DOMException</a></code>.</p>
        </ol>
      </ol>
      <details class="wpt-tests-block" dir="ltr" lang="en" open>
       <summary>Tests</summary>
       <ul class="wpt-tests-list">
        <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/idle-detection/interceptor.https.html">interceptor.https.html</a> <a class="wpt-live" href="https://wpt.live/idle-detection/interceptor.https.html" title="idle-detection/interceptor.https.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/idle-detection/interceptor.https.html"><small>(source)</small></a>
       </ul>
      </details>
     <li data-md>
      <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task" id="ref-for-queue-a-global-task①">Queue a global task</a> on the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global" id="ref-for-concept-relevant-global③">relevant global object</a> of <a data-link-type="dfn" href="https://heycam.github.io/webidl/#this" id="ref-for-this④">this</a> using
the <a data-link-type="dfn" href="#idle-detection-task-source" id="ref-for-idle-detection-task-source">idle detection task source</a> to perform the following steps, but <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#abort-when" id="ref-for-abort-when">abort when</a> <var>this</var>.<code class="idl"><a data-link-type="idl" href="#dom-idledetector-state-slot" id="ref-for-dom-idledetector-state-slot③">[[state]]</a></code> becomes <code>"stopped"</code>.</p>
      <ol>
       <li data-md>
        <p>Let <var>permissionState</var> be the <a data-link-type="dfn" href="https://w3c.github.io/permissions/#permission-state" id="ref-for-permission-state">permission state</a> the <a data-link-type="dfn" href="https://w3c.github.io/permissions/#powerful-feature" id="ref-for-powerful-feature②">powerful
feature</a> named <code>"idle-detection"</code>.</p>
       <li data-md>
        <p>If <var>permissionState</var> is <code>"denied"</code>, <a data-link-type="dfn" href="https://heycam.github.io/webidl/#reject" id="ref-for-reject⑥">reject</a> <var>result</var> with a
"<code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#notallowederror" id="ref-for-notallowederror②">NotAllowedError</a></code>" <code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#idl-DOMException" id="ref-for-idl-DOMException⑤">DOMException</a></code>, set <var>this</var>.<code class="idl"><a data-link-type="idl" href="#dom-idledetector-state-slot" id="ref-for-dom-idledetector-state-slot④">[[state]]</a></code> to <code>"stopped"</code> and abort these steps.</p>
        <details class="wpt-tests-block" dir="ltr" lang="en" open>
         <summary>Tests</summary>
         <ul class="wpt-tests-list">
          <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/idle-detection/idle-permission.tentative.https.window.js">idle-permission.tentative.https.window.js</a> <a class="wpt-live" href="https://wpt.live/idle-detection/idle-permission.tentative.https.window.js" title="idle-detection/idle-permission.tentative.https.window.js"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/idle-detection/idle-permission.tentative.https.window.js"><small>(source)</small></a>
         </ul>
        </details>
       <li data-md>
        <p>Set <var>this</var>.<code class="idl"><a data-link-type="idl" href="#dom-idledetector-state-slot" id="ref-for-dom-idledetector-state-slot⑤">[[state]]</a></code> to <code>"started"</code>.</p>
       <li data-md>
        <p>Set <var>this</var>.<code class="idl"><a data-link-type="idl" href="#dom-idledetector-threshold-slot" id="ref-for-dom-idledetector-threshold-slot">[[threshold]]</a></code> to <var>options</var>["<code class="idl"><a data-link-type="idl" href="#dom-idleoptions-threshold" id="ref-for-dom-idleoptions-threshold③">threshold</a></code>"].</p>
       <li data-md>
        <p><a data-link-type="dfn" href="https://heycam.github.io/webidl/#resolve" id="ref-for-resolve①">Resolve</a> <var>result</var>.</p>
      </ol>
     <li data-md>
      <p>Return <var>result</var>.</p>
    </ol>
   </div>
   <div class="example" id="example-eaf26322">
    <a class="self-link" href="#example-eaf26322"></a> 
    <p>The availability of this API can be detected by looking for the <code class="idl"><a data-link-type="idl" href="#idledetector" id="ref-for-idledetector③">IdleDetector</a></code> constructor in the <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/window-object.html#window" id="ref-for-window">Window</a></code> object.</p>
<pre class="language-js highlight"><c- k>if</c-> <c- p>(</c-><c- o>!</c-><c- p>(</c-><c- t>'IdleDetector'</c-> <c- k>in</c-> window<c- p>))</c-> <c- p>{</c->
  console<c- p>.</c->log<c- p>(</c-><c- t>'Idle detection is not available.'</c-><c- p>);</c->
  <c- k>return</c-><c- p>;</c->
<c- p>}</c->
</pre>
    <p>Calling <code class="idl"><a data-link-type="idl" href="#dom-idledetector-start" id="ref-for-dom-idledetector-start②">start()</a></code> will fail if the <code class="idl"><a data-link-type="idl" href="#dom-permissionname-idle-detection" id="ref-for-dom-permissionname-idle-detection">"idle-detection"</a></code> permission has not
been granted.</p>
<pre class="language-js highlight"><c- k>if</c-> <c- p>((</c-><c- k>await</c-> IdleDetector<c- p>.</c->requestPermission<c- p>())</c-> <c- o>!==</c-> <c- t>'granted'</c-><c- p>)</c-> <c- p>{</c->
  console<c- p>.</c->log<c- p>(</c-><c- t>'Idle detection permission not granted.'</c-><c- p>);</c->
  <c- k>return</c-><c- p>;</c->
<c- p>}</c->
</pre>
    <p>A set of options can be configured to control the threshold the <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#user-agent" id="ref-for-user-agent">user agent</a> uses to decide when the user has become idle.</p>
<pre class="language-js highlight"><c- a>const</c-> controller <c- o>=</c-> <c- k>new</c-> AbortController<c- p>();</c->
<c- a>const</c-> signal <c- o>=</c-> controller<c- p>.</c->signal<c- p>;</c->

<c- a>const</c-> options <c- o>=</c-> <c- p>{</c->
  threshold<c- o>:</c-> <c- mf>60</c->_000<c- p>,</c->
  signal<c- p>,</c->
<c- p>};</c->
</pre>
    <p>The <code class="idl"><a data-link-type="idl" href="#idledetector" id="ref-for-idledetector④">IdleDetector</a></code> can now be created and started. An listener for the <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/indices.html#event-change" id="ref-for-event-change①">"change"</a></code> event is added and will be fired if the <code class="idl"><a data-link-type="idl" href="#dom-idledetector-userstate" id="ref-for-dom-idledetector-userstate②">userState</a></code> or <code class="idl"><a data-link-type="idl" href="#dom-idledetector-screenstate" id="ref-for-dom-idledetector-screenstate②">screenState</a></code> attributes change.</p>
<pre class="language-js highlight"><c- k>try</c-> <c- p>{</c->
  <c- a>const</c-> idleDetector <c- o>=</c-> <c- k>new</c-> IdleDetector<c- p>();</c->
  idleDetector<c- p>.</c->addEventListener<c- p>(</c-><c- t>'change'</c-><c- p>,</c-> <c- p>()</c-> <c- p>=></c-> <c- p>{</c->
    console<c- p>.</c->log<c- p>(</c-><c- sb>`Idle change: </c-><c- si>${</c->idleDetector<c- p>.</c->userState<c- si>}</c-><c- sb>, </c-><c- si>${</c->idleDetector<c- p>.</c->screenState<c- si>}</c-><c- sb>.`</c-><c- p>);</c->
  <c- p>});</c->
  <c- k>await</c-> idleDetector<c- p>.</c->start<c- p>(</c->options<c- p>);</c->
  console<c- p>.</c->log<c- p>(</c-><c- t>'IdleDetector is active.'</c-><c- p>);</c->
<c- p>}</c-> <c- k>catch</c-> <c- p>(</c->err<c- p>)</c-> <c- p>{</c->
  <c- c1>// Deal with initialization errors like permission denied,</c->
  <c- c1>// running outside of top-level frame, etc.</c->
  console<c- p>.</c->error<c- p>(</c->err<c- p>.</c->name<c- p>,</c-> err<c- p>.</c->message<c- p>);</c->
<c- p>}</c->
</pre>
    <p>At a later time the page can cancel its interest in state change events by
removing its event listeners or using the <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#abortsignal" id="ref-for-abortsignal①">AbortSignal</a></code> that was passed to <code class="idl"><a data-link-type="idl" href="#dom-idledetector-start" id="ref-for-dom-idledetector-start③">start()</a></code>.</p>
<pre class="language-js highlight">controller<c- p>.</c->abort<c- p>();</c->
console<c- p>.</c->log<c- p>(</c-><c- t>'IdleDetector is stopped.'</c-><c- p>);</c->
</pre>
   </div>
   <h4 class="heading settled" data-level="2.4.6" id="state-changes"><span class="secno">2.4.6. </span><span class="content">Reacting to state changes</span><a class="self-link" href="#state-changes"></a></h4>
   <div class="algorithm" data-algorithm="state changes">
    <p>For each <code class="idl"><a data-link-type="idl" href="#idledetector" id="ref-for-idledetector⑤">IdleDetector</a></code> instance <var>detector</var> where <var>detector</var>.<code class="idl"><a data-link-type="idl" href="#dom-idledetector-state-slot" id="ref-for-dom-idledetector-state-slot⑥">[[state]]</a></code> is <code>"started"</code> the <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#user-agent" id="ref-for-user-agent①">user agent</a> MUST continuously monitor the following
conditions:</p>
    <ul>
     <li data-md>
      <p>If <var>detector</var>.<code class="idl"><a data-link-type="idl" href="#dom-idledetector-userstate-slot" id="ref-for-dom-idledetector-userstate-slot①">[[userState]]</a></code> is <code class="idl"><a data-link-type="idl" href="#dom-useridlestate-active" id="ref-for-dom-useridlestate-active①">"active"</a></code> and the user has not
interacted with the device within the last <var>detector</var>.<code class="idl"><a data-link-type="idl" href="#dom-idledetector-threshold-slot" id="ref-for-dom-idledetector-threshold-slot①">[[threshold]]</a></code> milliseconds, it MUST <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task" id="ref-for-queue-a-global-task②">queue a global task</a> on the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global" id="ref-for-concept-relevant-global④">relevant global
object</a> of <var>detector</var> using the <a data-link-type="dfn" href="#idle-detection-task-source" id="ref-for-idle-detection-task-source①">idle detection task source</a> to run the
following steps:</p>
      <ol>
       <li data-md>
        <p>Set <var>detector</var>.<code class="idl"><a data-link-type="idl" href="#dom-idledetector-userstate-slot" id="ref-for-dom-idledetector-userstate-slot②">[[userState]]</a></code> to <code class="idl"><a data-link-type="idl" href="#dom-useridlestate-idle" id="ref-for-dom-useridlestate-idle①">"idle"</a></code>.</p>
       <li data-md>
        <p><a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-event-fire" id="ref-for-concept-event-fire">Fire an event</a> named <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/indices.html#event-change" id="ref-for-event-change②">"change"</a></code> at <var>detector</var>.</p>
      </ol>
     <li data-md>
      <p>If <var>detector</var>.<code class="idl"><a data-link-type="idl" href="#dom-idledetector-userstate-slot" id="ref-for-dom-idledetector-userstate-slot③">[[userState]]</a></code> is <code class="idl"><a data-link-type="idl" href="#dom-useridlestate-idle" id="ref-for-dom-useridlestate-idle②">"idle"</a></code> and the user interacts with
the device, it MUST <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task" id="ref-for-queue-a-global-task③">queue a global task</a> on the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global" id="ref-for-concept-relevant-global⑤">relevant global
object</a> of <var>detector</var> using the <a data-link-type="dfn" href="#idle-detection-task-source" id="ref-for-idle-detection-task-source②">idle detection task source</a> to run the
following steps:</p>
      <ol>
       <li data-md>
        <p>Set <var>detector</var>.<code class="idl"><a data-link-type="idl" href="#dom-idledetector-userstate-slot" id="ref-for-dom-idledetector-userstate-slot④">[[userState]]</a></code> to <code class="idl"><a data-link-type="idl" href="#dom-useridlestate-active" id="ref-for-dom-useridlestate-active②">"active"</a></code>.</p>
       <li data-md>
        <p><a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-event-fire" id="ref-for-concept-event-fire①">Fire an event</a> named <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/indices.html#event-change" id="ref-for-event-change③">"change"</a></code> at <var>detector</var>.</p>
      </ol>
     <li data-md>
      <p>If <var>detector</var>.<code class="idl"><a data-link-type="idl" href="#dom-idledetector-screenstate-slot" id="ref-for-dom-idledetector-screenstate-slot①">[[screenState]]</a></code> is <code class="idl"><a data-link-type="idl" href="#dom-screenidlestate-unlocked" id="ref-for-dom-screenidlestate-unlocked①">"unlocked"</a></code> and the screen is
locked, it MUST <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task" id="ref-for-queue-a-global-task④">queue a global task</a> on the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global" id="ref-for-concept-relevant-global⑥">relevant global object</a> of <var>detector</var> using the <a data-link-type="dfn" href="#idle-detection-task-source" id="ref-for-idle-detection-task-source③">idle detection task source</a> to run the following
steps:</p>
      <ol>
       <li data-md>
        <p>Set <var>detector</var>.<code class="idl"><a data-link-type="idl" href="#dom-idledetector-screenstate-slot" id="ref-for-dom-idledetector-screenstate-slot②">[[screenState]]</a></code> to <code class="idl"><a data-link-type="idl" href="#dom-screenidlestate-locked" id="ref-for-dom-screenidlestate-locked①">"locked"</a></code>.</p>
       <li data-md>
        <p><a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-event-fire" id="ref-for-concept-event-fire②">Fire an event</a> named <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/indices.html#event-change" id="ref-for-event-change④">"change"</a></code> at <var>detector</var>.</p>
      </ol>
     <li data-md>
      <p>If <var>detector</var>.<code class="idl"><a data-link-type="idl" href="#dom-idledetector-screenstate-slot" id="ref-for-dom-idledetector-screenstate-slot③">[[screenState]]</a></code> is <code class="idl"><a data-link-type="idl" href="#dom-screenidlestate-locked" id="ref-for-dom-screenidlestate-locked②">"locked"</a></code> and the screen is
unlocked, it MUST <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task" id="ref-for-queue-a-global-task⑤">queue a global task</a> on the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global" id="ref-for-concept-relevant-global⑦">relevant global object</a> of <var>detector</var> using the <a data-link-type="dfn" href="#idle-detection-task-source" id="ref-for-idle-detection-task-source④">idle detection task source</a> to run the following
steps:</p>
      <ol>
       <li data-md>
        <p>Set <var>detector</var>.<code class="idl"><a data-link-type="idl" href="#dom-idledetector-screenstate-slot" id="ref-for-dom-idledetector-screenstate-slot④">[[screenState]]</a></code> to <code class="idl"><a data-link-type="idl" href="#dom-screenidlestate-unlocked" id="ref-for-dom-screenidlestate-unlocked②">"unlocked"</a></code>.</p>
       <li data-md>
        <p><a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-event-fire" id="ref-for-concept-event-fire③">Fire an event</a> named <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/indices.html#event-change" id="ref-for-event-change⑤">"change"</a></code> at <var>detector</var>.</p>
      </ol>
    </ul>
   </div>
   <details class="wpt-tests-block" dir="ltr" lang="en" open>
    <summary>Tests</summary>
    <ul class="wpt-tests-list">
     <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/idle-detection/interceptor.https.html">interceptor.https.html</a> <a class="wpt-live" href="https://wpt.live/idle-detection/interceptor.https.html" title="idle-detection/interceptor.https.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/idle-detection/interceptor.https.html"><small>(source)</small></a>
    </ul>
   </details>
   <h2 class="heading settled" data-level="3" id="security-and-privacy"><span class="secno">3. </span><span class="content">Security and privacy considerations</span><a class="self-link" href="#security-and-privacy"></a></h2>
   <p><em>This section is non-normative.</em></p>
   <h3 class="heading settled" data-level="3.1" id="privacy-cross-origin-leakage"><span class="secno">3.1. </span><span class="content">Cross-origin information leakage</span><a class="self-link" href="#privacy-cross-origin-leakage"></a></h3>
   <p>This interface exposes the state of global system properties and so care must be
taken to prevent them from being used as cross-origin communication or
identification channels. Similar concerns are present in specifications such as <a data-link-type="biblio" href="#biblio-device-orientation">[DEVICE-ORIENTATION]</a> and <a data-link-type="biblio" href="#biblio-geolocation-api">[GEOLOCATION-API]</a>, which mitigate them by requiring
a visible or focused context. This prevents multiple origins from observing the
global state at the same time. These mitigations are unfortunately inappropriate
here because the intent of this specification is precisely to allow a limited
form of tracking in blurred and hidden contexts. A malicious page could notify a
tracking server whenever the user is detected as idle or active. If multiple
pages the user was visiting notified the same server it could use the timing of
the events to guess which sessions corresponded to a single user as they would
arrive roughly simultaneously.</p>
   <p>To reduce the number of independent contexts with access to this interface this
specification restricts it to top-level and same-origin contexts. Access can be
delegated to a cross-origin context through <a data-link-type="biblio" href="#biblio-permissions-policy">[PERMISSIONS-POLICY]</a>.</p>
   <p>To further reduce the number of contexts this specification requires
a page to obtain the <code class="idl"><a data-link-type="idl" href="#dom-permissionname-idle-detection" id="ref-for-dom-permissionname-idle-detection①">"idle-detection"</a></code> permission. User agents should inform
the user of the capability that this permission grants and encourage them to
only grant it to trusted sites which have a legitimate purpose for this data.</p>
   <p>Implementations that provide a "private browsing" mode should not allow this
capability in contexts where this mode is enabled. Implementations should be
careful however to avoid the lack of this capability from being used as a signal
that this mode is enabled. This can be accomplished by refusing to allow the <code class="idl"><a data-link-type="idl" href="#dom-permissionname-idle-detection" id="ref-for-dom-permissionname-idle-detection②">"idle-detection"</a></code> permission to be granted but delaying the automatic
dismissal of the permission request by a random interval so that it appears to
have been a user action.</p>
   <h3 class="heading settled" data-level="3.2" id="privacy-behavior-tracking"><span class="secno">3.2. </span><span class="content">Behavior tracking</span><a class="self-link" href="#privacy-behavior-tracking"></a></h3>
   <p>While this interface does not provide details of the user interaction which
triggered an <code class="idl"><a data-link-type="idl" href="#dom-useridlestate-idle" id="ref-for-dom-useridlestate-idle③">"idle"</a></code> to <code class="idl"><a data-link-type="idl" href="#dom-useridlestate-active" id="ref-for-dom-useridlestate-active③">"active"</a></code> transition, with a sufficiently short
threshold these events could be used to detect behavior such as typing. This
specification therefore restricts the requested threshold to a minimum of at
least 60 seconds.</p>
   <p>The permission requirement described previously also helps to mitigate the
general concern that this interface can be used to build a profile of when and
for how long the user typically interacts with their device.</p>
   <h3 class="heading settled" data-level="3.3" id="privacy-user-coercion"><span class="secno">3.3. </span><span class="content">User coercion</span><a class="self-link" href="#privacy-user-coercion"></a></h3>
   <p>Sites may require the user to grant them the <code class="idl"><a data-link-type="idl" href="#dom-permissionname-idle-detection" id="ref-for-dom-permissionname-idle-detection③">"idle-detection"</a></code> permission
before unlocking some functionality. For example, a testing site could require
this permission as part of an anti-cheating mechanism to detect the user
consulting forbidden reference materials in another window. This type of
"Contract of Adhesion" has been observed with other permissions such as
notifications, FIDO attestation and DRM identifiers.</p>
   <p>A potential mitigation for this concern is to design that interface so that it
is not possible for a site to determine whether the user has granted or denied
the permission. An implementation could refuse to acknowledge that the user is
idle, reducing a site to only the signals currently available. This mitigation
could be detectable as it is unlikely that a user who has not interacted with a
page for hours has nevertheless still been continuously interacting with
something else. Implementations could instead insert fake idle transition events
which correspond to plausible behavior given the other signals available to the
page.</p>
   <p>This specification does not mandate this type of mitigation as it could create a
poor user experience when sites take action based on this false data. For
example, the message application mentioned previously would not deliver
notifications to the user’s mobile device because it believes the signals it has
been given indicate that they are still at their desktop. As the site cannot
detect that it is in this state it cannot directly recommend an action for the
user to take to get themselves out of it.</p>
   <p>The harm done by such a site is limited as tracking is only possible while the
user is visiting that page. Tracking across multiple origins requires permission
to be requested on each participating site.</p>
   <h2 class="heading settled" data-level="4" id="accessibility"><span class="secno">4. </span><span class="content">Accessibility considerations</span><a class="self-link" href="#accessibility"></a></h2>
   <p><em>This section is non-normative.</em></p>
   <p>Users with physical or cognitive impairments may require more time to interact
with user agents and content. Implementations should not allow distinguishing
such users, or limiting their ability to interact with content any more than
existing observation of UI events. For example, implementation should ensure
that interactions from assistive technologies count towards considering the user
active.</p>
   <p>The use of a permission also requires that user agents provide a user interface
element to support requesting and managing that permission. Any such user
interface elements must be designed with accessibility tools in mind. For
example, a user interface describing the capability being requested should
provide the same description to tools such as screen readers.</p>
   <h2 class="heading settled" data-level="5" id="internationalization"><span class="secno">5. </span><span class="content">Internationalization considerations</span><a class="self-link" href="#internationalization"></a></h2>
   <p><em>This section is non-normative.</em></p>
   <p>The interface described by this specification has limited internationalization
considerations, however the use of a permission does require that user agents
provide a user interface element to support requesting and managing that
permission. Any content displayed by the user agent in this context should be
translated into the user’s native language.</p>
   <h2 class="heading settled" data-level="6" id="acknowledgements"><span class="secno">6. </span><span class="content">Acknowledgements</span><a class="self-link" href="#acknowledgements"></a></h2>
   <p><em>This section is non-normative.</em></p>
   <p>Many thanks to
Kenneth Christiansen,
Samuel Goto,
Ayu Ishii and 
Thomas Steiner
for their help in crafting this proposal.</p>
  </main>
  <div data-fill-with="conformance">
   <h2 class="no-ref no-num heading settled" id="w3c-conformance"><span class="content">Conformance</span><a class="self-link" href="#w3c-conformance"></a></h2>
   <h3 class="no-ref no-num heading settled" id="w3c-conventions"><span class="content">Document conventions</span><a class="self-link" href="#w3c-conventions"></a></h3>
   <p>Conformance requirements are expressed
    with a combination of descriptive assertions
    and RFC 2119 terminology.
    The key words “MUST”, “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”, “RECOMMENDED”, “MAY”, and “OPTIONAL”
    in the normative parts of this document
    are to be interpreted as described in RFC 2119.
    However, for readability,
    these words do not appear in all uppercase letters in this specification. </p>
   <p>All of the text of this specification is normative
    except sections explicitly marked as non-normative, examples, and notes. <a data-link-type="biblio" href="#biblio-rfc2119">[RFC2119]</a> </p>
   <p>Examples in this specification are introduced with the words “for example”
    or are set apart from the normative text
    with <code>class="example"</code>,
    like this: </p>
   <div class="example" id="w3c-example">
    <a class="self-link" href="#w3c-example"></a> 
    <p>This is an example of an informative example. </p>
   </div>
   <p>Informative notes begin with the word “Note”
    and are set apart from the normative text
    with <code>class="note"</code>,
    like this: </p>
   <p class="note" role="note">
    Note, this is an informative note. 
    <details class="wpt-tests-block" dir="ltr" lang="en" open>
     <summary>Tests</summary>
     <p>Tests relating to the content of this specification
                     may be documented in “Tests” blocks like this one.
                     Any such block is non-normative.</p>
     <ul class="wpt-tests-list"></ul>
     <hr>
    </details>
   </p>
   <h3 class="no-ref no-num heading settled" id="w3c-conformant-algorithms"><span class="content">Conformant Algorithms</span><a class="self-link" href="#w3c-conformant-algorithms"></a></h3>
   <p>Requirements phrased in the imperative as part of algorithms
    (such as "strip any leading space characters"
    or "return false and abort these steps")
    are to be interpreted with the meaning of the key word
    ("must", "should", "may", etc)
    used in introducing the algorithm. </p>
   <p>Conformance requirements phrased as algorithms or specific steps
    can be implemented in any manner,
    so long as the end result is equivalent.
    In particular, the algorithms defined in this specification
    are intended to be easy to understand
    and are not intended to be performant.
    Implementers are encouraged to optimize. </p>
  </div>
<script src="https://www.w3.org/scripts/TR/2016/fixup.js"></script>
  <h2 class="no-num no-ref heading settled" id="index"><span class="content">Index</span><a class="self-link" href="#index"></a></h2>
  <h3 class="no-num no-ref heading settled" id="index-defined-here"><span class="content">Terms defined by this specification</span><a class="self-link" href="#index-defined-here"></a></h3>
  <ul class="index">
   <li><a href="#dom-useridlestate-active">"active"</a><span>, in §2.1.1</span>
   <li><a href="#dom-idledetector-idledetector">constructor()</a><span>, in §2.4</span>
   <li><a href="#dom-useridlestate-idle">"idle"</a><span>, in §2.1.1</span>
   <li><a href="#dom-permissionname-idle-detection">"idle-detection"</a><span>, in §2.2</span>
   <li><a href="#idle-detection-task-source">idle detection task source</a><span>, in §2.4</span>
   <li><a href="#idledetector">IdleDetector</a><span>, in §2.4</span>
   <li><a href="#dom-idledetector-idledetector">IdleDetector()</a><span>, in §2.4</span>
   <li><a href="#dictdef-idleoptions">IdleOptions</a><span>, in §2.4</span>
   <li><a href="#dom-screenidlestate-locked">"locked"</a><span>, in §2.1.2</span>
   <li><a href="#dom-idledetector-onchange">onchange</a><span>, in §2.4.3</span>
   <li><a href="#dom-idledetector-requestpermission">requestPermission()</a><span>, in §2.4.4</span>
   <li><a href="#enumdef-screenidlestate">ScreenIdleState</a><span>, in §2.1.2</span>
   <li><a href="#dom-idledetector-screenstate-slot">[[screenState]]</a><span>, in §2.4</span>
   <li><a href="#dom-idledetector-screenstate">screenState</a><span>, in §2.4.2</span>
   <li><a href="#dom-idleoptions-signal">signal</a><span>, in §2.4</span>
   <li><a href="#dom-idledetector-start">start()</a><span>, in §2.4.5</span>
   <li><a href="#dom-idledetector-start">start(options)</a><span>, in §2.4.5</span>
   <li><a href="#dom-idledetector-state-slot">[[state]]</a><span>, in §2.4</span>
   <li><a href="#dom-idledetector-threshold-slot">[[threshold]]</a><span>, in §2.4</span>
   <li><a href="#dom-idleoptions-threshold">threshold</a><span>, in §2.4</span>
   <li><a href="#dom-screenidlestate-unlocked">"unlocked"</a><span>, in §2.1.2</span>
   <li><a href="#enumdef-useridlestate">UserIdleState</a><span>, in §2.1.1</span>
   <li><a href="#dom-idledetector-userstate-slot">[[userState]]</a><span>, in §2.4</span>
   <li><a href="#dom-idledetector-userstate">userState</a><span>, in §2.4.1</span>
  </ul>
  <aside class="dfn-panel" data-for="term-for-abortsignal">
   <a href="https://dom.spec.whatwg.org/#abortsignal">https://dom.spec.whatwg.org/#abortsignal</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-abortsignal">2.4. The IdleDetector interface</a>
    <li><a href="#ref-for-abortsignal①">2.4.5. start() method</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-eventtarget">
   <a href="https://dom.spec.whatwg.org/#eventtarget">https://dom.spec.whatwg.org/#eventtarget</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-eventtarget">2.4. The IdleDetector interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-abortsignal-aborted-flag">
   <a href="https://dom.spec.whatwg.org/#abortsignal-aborted-flag">https://dom.spec.whatwg.org/#abortsignal-aborted-flag</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-abortsignal-aborted-flag">2.4.5. start() method</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-abortsignal-add">
   <a href="https://dom.spec.whatwg.org/#abortsignal-add">https://dom.spec.whatwg.org/#abortsignal-add</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-abortsignal-add">2.4.5. start() method</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-event-fire">
   <a href="https://dom.spec.whatwg.org/#concept-event-fire">https://dom.spec.whatwg.org/#concept-event-fire</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-event-fire">2.4.6. Reacting to state changes</a> <a href="#ref-for-concept-event-fire①">(2)</a> <a href="#ref-for-concept-event-fire②">(3)</a> <a href="#ref-for-concept-event-fire③">(4)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-sec-object-internal-methods-and-internal-slots">
   <a href="https://tc39.github.io/ecma262/#sec-object-internal-methods-and-internal-slots">https://tc39.github.io/ecma262/#sec-object-internal-methods-and-internal-slots</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-sec-object-internal-methods-and-internal-slots">2.4. The IdleDetector interface</a> <a href="#ref-for-sec-object-internal-methods-and-internal-slots①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dom-requestdestination-iframe">
   <a href="https://fetch.spec.whatwg.org/#dom-requestdestination-iframe">https://fetch.spec.whatwg.org/#dom-requestdestination-iframe</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-requestdestination-iframe">2.3. Permissions policy</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-eventhandler">
   <a href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler">https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-eventhandler">2.4. The IdleDetector interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-window">
   <a href="https://html.spec.whatwg.org/multipage/window-object.html#window">https://html.spec.whatwg.org/multipage/window-object.html#window</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-window">2.4.5. start() method</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-allowed-to-use">
   <a href="https://html.spec.whatwg.org/multipage/iframe-embed-object.html#allowed-to-use">https://html.spec.whatwg.org/multipage/iframe-embed-object.html#allowed-to-use</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-allowed-to-use">2.4.5. start() method</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-document-window">
   <a href="https://html.spec.whatwg.org/multipage/window-object.html#concept-document-window">https://html.spec.whatwg.org/multipage/window-object.html#concept-document-window</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-document-window">2.4.5. start() method</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-event-change">
   <a href="https://html.spec.whatwg.org/multipage/indices.html#event-change">https://html.spec.whatwg.org/multipage/indices.html#event-change</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-event-change">2.4.3. onchange attribute</a>
    <li><a href="#ref-for-event-change①">2.4.5. start() method</a>
    <li><a href="#ref-for-event-change②">2.4.6. Reacting to state changes</a> <a href="#ref-for-event-change③">(2)</a> <a href="#ref-for-event-change④">(3)</a> <a href="#ref-for-event-change⑤">(4)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-event-handler-idl-attributes">
   <a href="https://html.spec.whatwg.org/multipage/webappapis.html#event-handler-idl-attributes">https://html.spec.whatwg.org/multipage/webappapis.html#event-handler-idl-attributes</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-event-handler-idl-attributes">2.4.3. onchange attribute</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-in-parallel">
   <a href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel">https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-in-parallel">2.4.4. requestPermission() method</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-handler-onkeypress">
   <a href="https://html.spec.whatwg.org/multipage/webappapis.html#handler-onkeypress">https://html.spec.whatwg.org/multipage/webappapis.html#handler-onkeypress</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-handler-onkeypress">1. Introduction</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-handler-onmousemove">
   <a href="https://html.spec.whatwg.org/multipage/webappapis.html#handler-onmousemove">https://html.spec.whatwg.org/multipage/webappapis.html#handler-onmousemove</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-handler-onmousemove">1. Introduction</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-queue-a-global-task">
   <a href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task">https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-queue-a-global-task">2.4.4. requestPermission() method</a>
    <li><a href="#ref-for-queue-a-global-task①">2.4.5. start() method</a>
    <li><a href="#ref-for-queue-a-global-task②">2.4.6. Reacting to state changes</a> <a href="#ref-for-queue-a-global-task③">(2)</a> <a href="#ref-for-queue-a-global-task④">(3)</a> <a href="#ref-for-queue-a-global-task⑤">(4)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-relevant-global">
   <a href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global">https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-relevant-global">2.4.4. requestPermission() method</a> <a href="#ref-for-concept-relevant-global①">(2)</a>
    <li><a href="#ref-for-concept-relevant-global②">2.4.5. start() method</a> <a href="#ref-for-concept-relevant-global③">(2)</a>
    <li><a href="#ref-for-concept-relevant-global④">2.4.6. Reacting to state changes</a> <a href="#ref-for-concept-relevant-global⑤">(2)</a> <a href="#ref-for-concept-relevant-global⑥">(3)</a> <a href="#ref-for-concept-relevant-global⑦">(4)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-transient-activation">
   <a href="https://html.spec.whatwg.org/multipage/interaction.html#transient-activation">https://html.spec.whatwg.org/multipage/interaction.html#transient-activation</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-transient-activation">2.4.4. requestPermission() method</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-abort-when">
   <a href="https://infra.spec.whatwg.org/#abort-when">https://infra.spec.whatwg.org/#abort-when</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-abort-when">2.4.5. start() method</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-user-agent">
   <a href="https://infra.spec.whatwg.org/#user-agent">https://infra.spec.whatwg.org/#user-agent</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-user-agent">2.4.5. start() method</a>
    <li><a href="#ref-for-user-agent①">2.4.6. Reacting to state changes</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dom-document-hidden">
   <a href="https://www.w3.org/TR/page-visibility-2/#dom-document-hidden">https://www.w3.org/TR/page-visibility-2/#dom-document-hidden</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-document-hidden">1. Introduction</a> <a href="#ref-for-dom-document-hidden①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dom-document-onvisibilitychange">
   <a href="https://www.w3.org/TR/page-visibility-2/#dom-document-onvisibilitychange">https://www.w3.org/TR/page-visibility-2/#dom-document-onvisibilitychange</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-document-onvisibilitychange">1. Introduction</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-enumdef-permissionstate">
   <a href="https://w3c.github.io/permissions/#enumdef-permissionstate">https://w3c.github.io/permissions/#enumdef-permissionstate</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-enumdef-permissionstate">2.4. The IdleDetector interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-boolean-feature">
   <a href="https://w3c.github.io/permissions/#boolean-feature">https://w3c.github.io/permissions/#boolean-feature</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-boolean-feature">2.2. Permissions</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-permission-state">
   <a href="https://w3c.github.io/permissions/#permission-state">https://w3c.github.io/permissions/#permission-state</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-permission-state">2.4.5. start() method</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-permission-task-source">
   <a href="https://w3c.github.io/permissions/#permission-task-source">https://w3c.github.io/permissions/#permission-task-source</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-permission-task-source">2.4.4. requestPermission() method</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-powerful-feature">
   <a href="https://w3c.github.io/permissions/#powerful-feature">https://w3c.github.io/permissions/#powerful-feature</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-powerful-feature">2.2. Permissions</a>
    <li><a href="#ref-for-powerful-feature①">2.4.4. requestPermission() method</a>
    <li><a href="#ref-for-powerful-feature②">2.4.5. start() method</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-request-permission-to-use">
   <a href="https://w3c.github.io/permissions/#request-permission-to-use">https://w3c.github.io/permissions/#request-permission-to-use</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-request-permission-to-use">2.4.4. requestPermission() method</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-default-allowlist">
   <a href="https://w3c.github.io/webappsec-permissions-policy/#default-allowlist">https://w3c.github.io/webappsec-permissions-policy/#default-allowlist</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-default-allowlist">2.3. Permissions policy</a> <a href="#ref-for-default-allowlist①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-policy-controlled-feature">
   <a href="https://w3c.github.io/webappsec-permissions-policy/#policy-controlled-feature">https://w3c.github.io/webappsec-permissions-policy/#policy-controlled-feature</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-policy-controlled-feature">2.3. Permissions policy</a>
    <li><a href="#ref-for-policy-controlled-feature①">2.4.5. start() method</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-aborterror">
   <a href="https://heycam.github.io/webidl/#aborterror">https://heycam.github.io/webidl/#aborterror</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-aborterror">2.4.5. start() method</a> <a href="#ref-for-aborterror①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-idl-DOMException">
   <a href="https://heycam.github.io/webidl/#idl-DOMException">https://heycam.github.io/webidl/#idl-DOMException</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-idl-DOMException">2.4.4. requestPermission() method</a>
    <li><a href="#ref-for-idl-DOMException①">2.4.5. start() method</a> <a href="#ref-for-idl-DOMException②">(2)</a> <a href="#ref-for-idl-DOMException③">(3)</a> <a href="#ref-for-idl-DOMException④">(4)</a> <a href="#ref-for-idl-DOMException⑤">(5)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-EnforceRange">
   <a href="https://heycam.github.io/webidl/#EnforceRange">https://heycam.github.io/webidl/#EnforceRange</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-EnforceRange">2.4. The IdleDetector interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-Exposed">
   <a href="https://heycam.github.io/webidl/#Exposed">https://heycam.github.io/webidl/#Exposed</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-Exposed">2.4. The IdleDetector interface</a> <a href="#ref-for-Exposed①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-invalidstateerror">
   <a href="https://heycam.github.io/webidl/#invalidstateerror">https://heycam.github.io/webidl/#invalidstateerror</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-invalidstateerror">2.4.5. start() method</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-notallowederror">
   <a href="https://heycam.github.io/webidl/#notallowederror">https://heycam.github.io/webidl/#notallowederror</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-notallowederror">2.4.4. requestPermission() method</a>
    <li><a href="#ref-for-notallowederror①">2.4.5. start() method</a> <a href="#ref-for-notallowederror②">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-idl-promise">
   <a href="https://heycam.github.io/webidl/#idl-promise">https://heycam.github.io/webidl/#idl-promise</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-idl-promise">2.4. The IdleDetector interface</a> <a href="#ref-for-idl-promise①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-SecureContext">
   <a href="https://heycam.github.io/webidl/#SecureContext">https://heycam.github.io/webidl/#SecureContext</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-SecureContext">2.4. The IdleDetector interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-exceptiondef-typeerror">
   <a href="https://heycam.github.io/webidl/#exceptiondef-typeerror">https://heycam.github.io/webidl/#exceptiondef-typeerror</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-exceptiondef-typeerror">2.4.5. start() method</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-a-new-promise">
   <a href="https://heycam.github.io/webidl/#a-new-promise">https://heycam.github.io/webidl/#a-new-promise</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-a-new-promise">2.4.4. requestPermission() method</a> <a href="#ref-for-a-new-promise①">(2)</a>
    <li><a href="#ref-for-a-new-promise②">2.4.5. start() method</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-reject">
   <a href="https://heycam.github.io/webidl/#reject">https://heycam.github.io/webidl/#reject</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-reject">2.4.4. requestPermission() method</a>
    <li><a href="#ref-for-reject①">2.4.5. start() method</a> <a href="#ref-for-reject②">(2)</a> <a href="#ref-for-reject③">(3)</a> <a href="#ref-for-reject④">(4)</a> <a href="#ref-for-reject⑤">(5)</a> <a href="#ref-for-reject⑥">(6)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-resolve">
   <a href="https://heycam.github.io/webidl/#resolve">https://heycam.github.io/webidl/#resolve</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-resolve">2.4.4. requestPermission() method</a>
    <li><a href="#ref-for-resolve①">2.4.5. start() method</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-this">
   <a href="https://heycam.github.io/webidl/#this">https://heycam.github.io/webidl/#this</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-this">2.4.1. userState attribute</a>
    <li><a href="#ref-for-this①">2.4.2. screenState attribute</a>
    <li><a href="#ref-for-this②">2.4.4. requestPermission() method</a> <a href="#ref-for-this③">(2)</a>
    <li><a href="#ref-for-this④">2.4.5. start() method</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-idl-undefined">
   <a href="https://heycam.github.io/webidl/#idl-undefined">https://heycam.github.io/webidl/#idl-undefined</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-idl-undefined">2.4. The IdleDetector interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-idl-unsigned-long-long">
   <a href="https://heycam.github.io/webidl/#idl-unsigned-long-long">https://heycam.github.io/webidl/#idl-unsigned-long-long</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-idl-unsigned-long-long">2.4. The IdleDetector interface</a>
   </ul>
  </aside>
  <h3 class="no-num no-ref heading settled" id="index-defined-elsewhere"><span class="content">Terms defined by reference</span><a class="self-link" href="#index-defined-elsewhere"></a></h3>
  <ul class="index">
   <li>
    <a data-link-type="biblio">[DOM]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-abortsignal">AbortSignal</span>
     <li><span class="dfn-paneled" id="term-for-eventtarget">EventTarget</span>
     <li><span class="dfn-paneled" id="term-for-abortsignal-aborted-flag">aborted flag</span>
     <li><span class="dfn-paneled" id="term-for-abortsignal-add">add</span>
     <li><span class="dfn-paneled" id="term-for-concept-event-fire">fire an event</span>
    </ul>
   <li>
    <a data-link-type="biblio">[ECMASCRIPT]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-sec-object-internal-methods-and-internal-slots">internal slot</span>
    </ul>
   <li>
    <a data-link-type="biblio">[FETCH]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-dom-requestdestination-iframe">"iframe"</span>
    </ul>
   <li>
    <a data-link-type="biblio">[HTML]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-eventhandler">EventHandler</span>
     <li><span class="dfn-paneled" id="term-for-window">Window</span>
     <li><span class="dfn-paneled" id="term-for-allowed-to-use">allowed to use</span>
     <li><span class="dfn-paneled" id="term-for-concept-document-window">associated document</span>
     <li><span class="dfn-paneled" id="term-for-event-change">change</span>
     <li><span class="dfn-paneled" id="term-for-event-handler-idl-attributes">event handler idl attribute</span>
     <li><span class="dfn-paneled" id="term-for-in-parallel">in parallel</span>
     <li><span class="dfn-paneled" id="term-for-handler-onkeypress">onkeypress</span>
     <li><span class="dfn-paneled" id="term-for-handler-onmousemove">onmousemove</span>
     <li><span class="dfn-paneled" id="term-for-queue-a-global-task">queue a global task</span>
     <li><span class="dfn-paneled" id="term-for-concept-relevant-global">relevant global object</span>
     <li><span class="dfn-paneled" id="term-for-transient-activation">transient activation</span>
    </ul>
   <li>
    <a data-link-type="biblio">[INFRA]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-abort-when">abort when</span>
     <li><span class="dfn-paneled" id="term-for-user-agent">user agent</span>
    </ul>
   <li>
    <a data-link-type="biblio">[page-visibility-2]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-dom-document-hidden">hidden</span>
     <li><span class="dfn-paneled" id="term-for-dom-document-onvisibilitychange">onvisibilitychange</span>
    </ul>
   <li>
    <a data-link-type="biblio">[permissions]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-enumdef-permissionstate">PermissionState</span>
     <li><span class="dfn-paneled" id="term-for-boolean-feature">boolean feature</span>
     <li><span class="dfn-paneled" id="term-for-permission-state">permission state</span>
     <li><span class="dfn-paneled" id="term-for-permission-task-source">permission task source</span>
     <li><span class="dfn-paneled" id="term-for-powerful-feature">powerful feature</span>
     <li><span class="dfn-paneled" id="term-for-request-permission-to-use">requesting permission to use</span>
    </ul>
   <li>
    <a data-link-type="biblio">[PERMISSIONS-POLICY]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-default-allowlist">default allowlist</span>
     <li><span class="dfn-paneled" id="term-for-policy-controlled-feature">policy-controlled feature</span>
    </ul>
   <li>
    <a data-link-type="biblio">[WebIDL]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-aborterror">AbortError</span>
     <li><span class="dfn-paneled" id="term-for-idl-DOMException">DOMException</span>
     <li><span class="dfn-paneled" id="term-for-EnforceRange">EnforceRange</span>
     <li><span class="dfn-paneled" id="term-for-Exposed">Exposed</span>
     <li><span class="dfn-paneled" id="term-for-invalidstateerror">InvalidStateError</span>
     <li><span class="dfn-paneled" id="term-for-notallowederror">NotAllowedError</span>
     <li><span class="dfn-paneled" id="term-for-idl-promise">Promise</span>
     <li><span class="dfn-paneled" id="term-for-SecureContext">SecureContext</span>
     <li><span class="dfn-paneled" id="term-for-exceptiondef-typeerror">TypeError</span>
     <li><span class="dfn-paneled" id="term-for-a-new-promise">a new promise</span>
     <li><span class="dfn-paneled" id="term-for-reject">reject</span>
     <li><span class="dfn-paneled" id="term-for-resolve">resolve</span>
     <li><span class="dfn-paneled" id="term-for-this">this</span>
     <li><span class="dfn-paneled" id="term-for-idl-undefined">undefined</span>
     <li><span class="dfn-paneled" id="term-for-idl-unsigned-long-long">unsigned long long</span>
    </ul>
  </ul>
  <h2 class="no-num no-ref heading settled" id="references"><span class="content">References</span><a class="self-link" href="#references"></a></h2>
  <h3 class="no-num no-ref heading settled" id="normative"><span class="content">Normative References</span><a class="self-link" href="#normative"></a></h3>
  <dl>
   <dt id="biblio-dom">[DOM]
   <dd>Anne van Kesteren. <a href="https://dom.spec.whatwg.org/">DOM Standard</a>. Living Standard. URL: <a href="https://dom.spec.whatwg.org/">https://dom.spec.whatwg.org/</a>
   <dt id="biblio-ecmascript">[ECMASCRIPT]
   <dd><a href="https://tc39.es/ecma262/">ECMAScript Language Specification</a>. URL: <a href="https://tc39.es/ecma262/">https://tc39.es/ecma262/</a>
   <dt id="biblio-html">[HTML]
   <dd>Anne van Kesteren; et al. <a href="https://html.spec.whatwg.org/multipage/">HTML Standard</a>. Living Standard. URL: <a href="https://html.spec.whatwg.org/multipage/">https://html.spec.whatwg.org/multipage/</a>
   <dt id="biblio-infra">[INFRA]
   <dd>Anne van Kesteren; Domenic Denicola. <a href="https://infra.spec.whatwg.org/">Infra Standard</a>. Living Standard. URL: <a href="https://infra.spec.whatwg.org/">https://infra.spec.whatwg.org/</a>
   <dt id="biblio-page-visibility-2">[PAGE-VISIBILITY-2]
   <dd>Ilya Grigorik; Arvind Jain; Jatinder Mann. <a href="https://www.w3.org/TR/page-visibility-2/">Page Visibility Level 2</a>. 17 October 2017. PR. URL: <a href="https://www.w3.org/TR/page-visibility-2/">https://www.w3.org/TR/page-visibility-2/</a>
   <dt id="biblio-permissions">[PERMISSIONS]
   <dd>Mounir Lamouri; Marcos Caceres; Jeffrey Yasskin. <a href="https://www.w3.org/TR/permissions/">Permissions</a>. 20 July 2020. WD. URL: <a href="https://www.w3.org/TR/permissions/">https://www.w3.org/TR/permissions/</a>
   <dt id="biblio-permissions-policy">[PERMISSIONS-POLICY]
   <dd>Ian Clelland. <a href="https://www.w3.org/TR/permissions-policy-1/">Permissions Policy</a>. 16 July 2020. WD. URL: <a href="https://www.w3.org/TR/permissions-policy-1/">https://www.w3.org/TR/permissions-policy-1/</a>
   <dt id="biblio-rfc2119">[RFC2119]
   <dd>S. Bradner. <a href="https://datatracker.ietf.org/doc/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>. March 1997. Best Current Practice. URL: <a href="https://datatracker.ietf.org/doc/html/rfc2119">https://datatracker.ietf.org/doc/html/rfc2119</a>
   <dt id="biblio-webidl">[WebIDL]
   <dd>Boris Zbarsky. <a href="https://heycam.github.io/webidl/">Web IDL</a>. 15 December 2016. ED. URL: <a href="https://heycam.github.io/webidl/">https://heycam.github.io/webidl/</a>
  </dl>
  <h3 class="no-num no-ref heading settled" id="informative"><span class="content">Informative References</span><a class="self-link" href="#informative"></a></h3>
  <dl>
   <dt id="biblio-device-orientation">[DEVICE-ORIENTATION]
   <dd>Rich Tibbett; et al. <a href="https://www.w3.org/TR/orientation-event/">DeviceOrientation Event Specification</a>. 16 April 2019. WD. URL: <a href="https://www.w3.org/TR/orientation-event/">https://www.w3.org/TR/orientation-event/</a>
   <dt id="biblio-fetch">[FETCH]
   <dd>Anne van Kesteren. <a href="https://fetch.spec.whatwg.org/">Fetch Standard</a>. Living Standard. URL: <a href="https://fetch.spec.whatwg.org/">https://fetch.spec.whatwg.org/</a>
   <dt id="biblio-geolocation-api">[GEOLOCATION-API]
   <dd>Andrei Popescu. <a href="https://www.w3.org/TR/geolocation-API/">Geolocation API Specification 2nd Edition</a>. 8 November 2016. REC. URL: <a href="https://www.w3.org/TR/geolocation-API/">https://www.w3.org/TR/geolocation-API/</a>
   <dt id="biblio-push-api">[PUSH-API]
   <dd>Peter Beverloo; Martin Thomson. <a href="https://www.w3.org/TR/push-api/">Push API</a>. 4 February 2020. WD. URL: <a href="https://www.w3.org/TR/push-api/">https://www.w3.org/TR/push-api/</a>
  </dl>
  <h2 class="no-num no-ref heading settled" id="idl-index"><span class="content">IDL Index</span><a class="self-link" href="#idl-index"></a></h2>
<pre class="idl highlight def"><c- b>enum</c-> <a href="#enumdef-useridlestate"><code><c- g>UserIdleState</c-></code></a> {
    <a href="#dom-useridlestate-active"><code><c- s>"active"</c-></code></a>,
    <a href="#dom-useridlestate-idle"><code><c- s>"idle"</c-></code></a>
};

<c- b>enum</c-> <a href="#enumdef-screenidlestate"><code><c- g>ScreenIdleState</c-></code></a> {
    <a href="#dom-screenidlestate-locked"><code><c- s>"locked"</c-></code></a>,
    <a href="#dom-screenidlestate-unlocked"><code><c- s>"unlocked"</c-></code></a>
};

<c- b>dictionary</c-> <a href="#dictdef-idleoptions"><code><c- g>IdleOptions</c-></code></a> {
  [<a class="idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#EnforceRange"><c- g>EnforceRange</c-></a>] <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-unsigned-long-long"><c- b>unsigned</c-> <c- b>long</c-> <c- b>long</c-></a> <a data-type="unsigned long long " href="#dom-idleoptions-threshold"><code><c- g>threshold</c-></code></a>;
  <a data-link-type="idl-name" href="https://dom.spec.whatwg.org/#abortsignal"><c- n>AbortSignal</c-></a> <a data-type="AbortSignal " href="#dom-idleoptions-signal"><code><c- g>signal</c-></code></a>;
};

[
  <a class="idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#SecureContext"><c- g>SecureContext</c-></a>,
  <a class="idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed"><c- g>Exposed</c-></a>=(<c- n>Window</c->,<c- n>DedicatedWorker</c->)
] <c- b>interface</c-> <a href="#idledetector"><code><c- g>IdleDetector</c-></code></a> : <a data-link-type="idl-name" href="https://dom.spec.whatwg.org/#eventtarget"><c- n>EventTarget</c-></a> {
  <a href="#dom-idledetector-idledetector"><code><c- g>constructor</c-></code></a>();
  <c- b>readonly</c-> <c- b>attribute</c-> <a data-link-type="idl-name" href="#enumdef-useridlestate"><c- n>UserIdleState</c-></a>? <a class="idl-code" data-link-type="attribute" data-readonly data-type="UserIdleState?" href="#dom-idledetector-userstate"><c- g>userState</c-></a>;
  <c- b>readonly</c-> <c- b>attribute</c-> <a data-link-type="idl-name" href="#enumdef-screenidlestate"><c- n>ScreenIdleState</c-></a>? <a class="idl-code" data-link-type="attribute" data-readonly data-type="ScreenIdleState?" href="#dom-idledetector-screenstate"><c- g>screenState</c-></a>;
  <c- b>attribute</c-> <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler"><c- n>EventHandler</c-></a> <a class="idl-code" data-link-type="attribute" data-type="EventHandler" href="#dom-idledetector-onchange"><c- g>onchange</c-></a>;
  [<a class="idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed"><c- g>Exposed</c-></a>=<c- n>Window</c->] <c- b>static</c-> <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-promise"><c- b>Promise</c-></a>&lt;<a data-link-type="idl-name" href="https://w3c.github.io/permissions/#enumdef-permissionstate"><c- n>PermissionState</c-></a>> <a class="idl-code" data-link-type="method" href="#dom-idledetector-requestpermission"><c- g>requestPermission</c-></a>();
  <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-promise"><c- b>Promise</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-undefined"><c- b>undefined</c-></a>> <a class="idl-code" data-link-type="method" href="#dom-idledetector-start"><c- g>start</c-></a>(<c- b>optional</c-> <a data-link-type="idl-name" href="#dictdef-idleoptions"><c- n>IdleOptions</c-></a> <a href="#dom-idledetector-start-options-options"><code><c- g>options</c-></code></a> = {});
};

</pre>
  <aside class="dfn-panel" data-for="enumdef-useridlestate">
   <b><a href="#enumdef-useridlestate">#enumdef-useridlestate</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-enumdef-useridlestate">2.1.1. The UserIdleState enum</a>
    <li><a href="#ref-for-enumdef-useridlestate①">2.4. The IdleDetector interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-useridlestate-active">
   <b><a href="#dom-useridlestate-active">#dom-useridlestate-active</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-useridlestate-active">2.1.1. The UserIdleState enum</a>
    <li><a href="#ref-for-dom-useridlestate-active①">2.4.6. Reacting to state changes</a> <a href="#ref-for-dom-useridlestate-active②">(2)</a>
    <li><a href="#ref-for-dom-useridlestate-active③">3.2. Behavior tracking</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-useridlestate-idle">
   <b><a href="#dom-useridlestate-idle">#dom-useridlestate-idle</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-useridlestate-idle">2.1.1. The UserIdleState enum</a>
    <li><a href="#ref-for-dom-useridlestate-idle①">2.4.6. Reacting to state changes</a> <a href="#ref-for-dom-useridlestate-idle②">(2)</a>
    <li><a href="#ref-for-dom-useridlestate-idle③">3.2. Behavior tracking</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="enumdef-screenidlestate">
   <b><a href="#enumdef-screenidlestate">#enumdef-screenidlestate</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-enumdef-screenidlestate">2.1.2. The ScreenIdleState enum</a>
    <li><a href="#ref-for-enumdef-screenidlestate①">2.4. The IdleDetector interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-screenidlestate-locked">
   <b><a href="#dom-screenidlestate-locked">#dom-screenidlestate-locked</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-screenidlestate-locked">2.1.2. The ScreenIdleState enum</a>
    <li><a href="#ref-for-dom-screenidlestate-locked①">2.4.6. Reacting to state changes</a> <a href="#ref-for-dom-screenidlestate-locked②">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-screenidlestate-unlocked">
   <b><a href="#dom-screenidlestate-unlocked">#dom-screenidlestate-unlocked</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-screenidlestate-unlocked">2.1.2. The ScreenIdleState enum</a>
    <li><a href="#ref-for-dom-screenidlestate-unlocked①">2.4.6. Reacting to state changes</a> <a href="#ref-for-dom-screenidlestate-unlocked②">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-permissionname-idle-detection">
   <b><a href="#dom-permissionname-idle-detection">#dom-permissionname-idle-detection</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-permissionname-idle-detection">2.4.5. start() method</a>
    <li><a href="#ref-for-dom-permissionname-idle-detection①">3.1. Cross-origin information leakage</a> <a href="#ref-for-dom-permissionname-idle-detection②">(2)</a>
    <li><a href="#ref-for-dom-permissionname-idle-detection③">3.3. User coercion</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dictdef-idleoptions">
   <b><a href="#dictdef-idleoptions">#dictdef-idleoptions</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dictdef-idleoptions">2.4. The IdleDetector interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-idleoptions-threshold">
   <b><a href="#dom-idleoptions-threshold">#dom-idleoptions-threshold</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-idleoptions-threshold">2.1.1. The UserIdleState enum</a> <a href="#ref-for-dom-idleoptions-threshold①">(2)</a>
    <li><a href="#ref-for-dom-idleoptions-threshold②">2.4.5. start() method</a> <a href="#ref-for-dom-idleoptions-threshold③">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-idleoptions-signal">
   <b><a href="#dom-idleoptions-signal">#dom-idleoptions-signal</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-idleoptions-signal">2.4.5. start() method</a> <a href="#ref-for-dom-idleoptions-signal①">(2)</a> <a href="#ref-for-dom-idleoptions-signal②">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="idledetector">
   <b><a href="#idledetector">#idledetector</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-idledetector">2.4. The IdleDetector interface</a> <a href="#ref-for-idledetector①">(2)</a> <a href="#ref-for-idledetector②">(3)</a>
    <li><a href="#ref-for-idledetector③">2.4.5. start() method</a> <a href="#ref-for-idledetector④">(2)</a>
    <li><a href="#ref-for-idledetector⑤">2.4.6. Reacting to state changes</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-idledetector-state-slot">
   <b><a href="#dom-idledetector-state-slot">#dom-idledetector-state-slot</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-idledetector-state-slot">2.4.5. start() method</a> <a href="#ref-for-dom-idledetector-state-slot①">(2)</a> <a href="#ref-for-dom-idledetector-state-slot②">(3)</a> <a href="#ref-for-dom-idledetector-state-slot③">(4)</a> <a href="#ref-for-dom-idledetector-state-slot④">(5)</a> <a href="#ref-for-dom-idledetector-state-slot⑤">(6)</a>
    <li><a href="#ref-for-dom-idledetector-state-slot⑥">2.4.6. Reacting to state changes</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-idledetector-threshold-slot">
   <b><a href="#dom-idledetector-threshold-slot">#dom-idledetector-threshold-slot</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-idledetector-threshold-slot">2.4.5. start() method</a>
    <li><a href="#ref-for-dom-idledetector-threshold-slot①">2.4.6. Reacting to state changes</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-idledetector-userstate-slot">
   <b><a href="#dom-idledetector-userstate-slot">#dom-idledetector-userstate-slot</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-idledetector-userstate-slot">2.4.1. userState attribute</a>
    <li><a href="#ref-for-dom-idledetector-userstate-slot①">2.4.6. Reacting to state changes</a> <a href="#ref-for-dom-idledetector-userstate-slot②">(2)</a> <a href="#ref-for-dom-idledetector-userstate-slot③">(3)</a> <a href="#ref-for-dom-idledetector-userstate-slot④">(4)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-idledetector-screenstate-slot">
   <b><a href="#dom-idledetector-screenstate-slot">#dom-idledetector-screenstate-slot</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-idledetector-screenstate-slot">2.4.2. screenState attribute</a>
    <li><a href="#ref-for-dom-idledetector-screenstate-slot①">2.4.6. Reacting to state changes</a> <a href="#ref-for-dom-idledetector-screenstate-slot②">(2)</a> <a href="#ref-for-dom-idledetector-screenstate-slot③">(3)</a> <a href="#ref-for-dom-idledetector-screenstate-slot④">(4)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="idle-detection-task-source">
   <b><a href="#idle-detection-task-source">#idle-detection-task-source</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-idle-detection-task-source">2.4.5. start() method</a>
    <li><a href="#ref-for-idle-detection-task-source①">2.4.6. Reacting to state changes</a> <a href="#ref-for-idle-detection-task-source②">(2)</a> <a href="#ref-for-idle-detection-task-source③">(3)</a> <a href="#ref-for-idle-detection-task-source④">(4)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-idledetector-userstate">
   <b><a href="#dom-idledetector-userstate">#dom-idledetector-userstate</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-idledetector-userstate">2.4. The IdleDetector interface</a>
    <li><a href="#ref-for-dom-idledetector-userstate①">2.4.1. userState attribute</a>
    <li><a href="#ref-for-dom-idledetector-userstate②">2.4.5. start() method</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-idledetector-screenstate">
   <b><a href="#dom-idledetector-screenstate">#dom-idledetector-screenstate</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-idledetector-screenstate">2.4. The IdleDetector interface</a>
    <li><a href="#ref-for-dom-idledetector-screenstate①">2.4.2. screenState attribute</a>
    <li><a href="#ref-for-dom-idledetector-screenstate②">2.4.5. start() method</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-idledetector-onchange">
   <b><a href="#dom-idledetector-onchange">#dom-idledetector-onchange</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-idledetector-onchange">2.4. The IdleDetector interface</a>
    <li><a href="#ref-for-dom-idledetector-onchange①">2.4.3. onchange attribute</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-idledetector-requestpermission">
   <b><a href="#dom-idledetector-requestpermission">#dom-idledetector-requestpermission</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-idledetector-requestpermission">2.4. The IdleDetector interface</a>
    <li><a href="#ref-for-dom-idledetector-requestpermission①">2.4.4. requestPermission() method</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-idledetector-start">
   <b><a href="#dom-idledetector-start">#dom-idledetector-start</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-idledetector-start">2.4. The IdleDetector interface</a>
    <li><a href="#ref-for-dom-idledetector-start①">2.4.5. start() method</a> <a href="#ref-for-dom-idledetector-start②">(2)</a> <a href="#ref-for-dom-idledetector-start③">(3)</a>
   </ul>
  </aside>
<script>/* script-dfn-panel */

document.body.addEventListener("click", function(e) {
    var queryAll = function(sel) { return [].slice.call(document.querySelectorAll(sel)); }
    // Find the dfn element or panel, if any, that was clicked on.
    var el = e.target;
    var target;
    var hitALink = false;
    while(el.parentElement) {
        if(el.tagName == "A") {
            // Clicking on a link in a <dfn> shouldn't summon the panel
            hitALink = true;
        }
        if(el.classList.contains("dfn-paneled")) {
            target = "dfn";
            break;
        }
        if(el.classList.contains("dfn-panel")) {
            target = "dfn-panel";
            break;
        }
        el = el.parentElement;
    }
    if(target != "dfn-panel") {
        // Turn off any currently "on" or "activated" panels.
        queryAll(".dfn-panel.on, .dfn-panel.activated").forEach(function(el){
            el.classList.remove("on");
            el.classList.remove("activated");
        });
    }
    if(target == "dfn" && !hitALink) {
        // open the panel
        var dfnPanel = document.querySelector(".dfn-panel[data-for='" + el.id + "']");
        if(dfnPanel) {
            dfnPanel.classList.add("on");
            var rect = el.getBoundingClientRect();
            dfnPanel.style.left = window.scrollX + rect.right + 5 + "px";
            dfnPanel.style.top = window.scrollY + rect.top + "px";
            var panelRect = dfnPanel.getBoundingClientRect();
            var panelWidth = panelRect.right - panelRect.left;
            if(panelRect.right > document.body.scrollWidth && (rect.left - (panelWidth + 5)) > 0) {
                // Reposition, because the panel is overflowing
                dfnPanel.style.left = window.scrollX + rect.left - (panelWidth + 5) + "px";
            }
        } else {
            console.log("Couldn't find .dfn-panel[data-for='" + el.id + "']");
        }
    } else if(target == "dfn-panel") {
        // Switch it to "activated" state, which pins it.
        el.classList.add("activated");
        el.style.left = null;
        el.style.top = null;
    }

});
</script>
<script>/* script-var-click-highlighting */

    document.addEventListener("click", e=>{
        if(e.target.nodeName == "VAR") {
            highlightSameAlgoVars(e.target);
        }
    });
    {
        const indexCounts = new Map();
        const indexNames = new Map();
        function highlightSameAlgoVars(v) {
            // Find the algorithm container.
            let algoContainer = null;
            let searchEl = v;
            while(algoContainer == null && searchEl != document.body) {
                searchEl = searchEl.parentNode;
                if(searchEl.hasAttribute("data-algorithm")) {
                    algoContainer = searchEl;
                }
            }

            // Not highlighting document-global vars,
            // too likely to be unrelated.
            if(algoContainer == null) return;

            const algoName = algoContainer.getAttribute("data-algorithm");
            const varName = getVarName(v);
            const addClass = !v.classList.contains("selected");
            let highlightClass = null;
            if(addClass) {
                const index = chooseHighlightIndex(algoName, varName);
                indexCounts.get(algoName)[index] += 1;
                indexNames.set(algoName+"///"+varName, index);
                highlightClass = nameFromIndex(index);
            } else {
                const index = previousHighlightIndex(algoName, varName);
                indexCounts.get(algoName)[index] -= 1;
                highlightClass = nameFromIndex(index);
            }

            // Find all same-name vars, and toggle their class appropriately.
            for(const el of algoContainer.querySelectorAll("var")) {
                if(getVarName(el) == varName) {
                    el.classList.toggle("selected", addClass);
                    el.classList.toggle(highlightClass, addClass);
                }
            }
        }
        function getVarName(el) {
            return el.textContent.replace(/(\s|\xa0)+/, " ").trim();
        }
        function chooseHighlightIndex(algoName, varName) {
            let indexes = null;
            if(indexCounts.has(algoName)) {
                indexes = indexCounts.get(algoName);
            } else {
                // 7 classes right now
                indexes = [0,0,0,0,0,0,0];
                indexCounts.set(algoName, indexes);
            }

            // If the element was recently unclicked,
            // *and* that color is still unclaimed,
            // give it back the same color.
            const lastIndex = previousHighlightIndex(algoName, varName);
            if(indexes[lastIndex] === 0) return lastIndex;

            // Find the earliest index with the lowest count.
            const minCount = Math.min.apply(null, indexes);
            let index = null;
            for(var i = 0; i < indexes.length; i++) {
                if(indexes[i] == minCount) {
                    return i;
                }
            }
        }
        function previousHighlightIndex(algoName, varName) {
            return indexNames.get(algoName+"///"+varName);
        }
        function nameFromIndex(index) {
            return "selected" + index;
        }
    }
    </script>