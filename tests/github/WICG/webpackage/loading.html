<!doctype html><html lang="en">
 <head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
  <title>Loading Signed Exchanges</title>
  <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
  <link href="https://www.w3.org/StyleSheets/TR/2016/cg-draft" rel="stylesheet">
  <link href="https://wicg.github.io/webpackage/loading.html" rel="canonical">
<style>/* style-autolinks */

.css.css, .property.property, .descriptor.descriptor {
    color: var(--a-normal-text);
    font-size: inherit;
    font-family: inherit;
}
.css::before, .property::before, .descriptor::before {
    content: "‘";
}
.css::after, .property::after, .descriptor::after {
    content: "’";
}
.property, .descriptor {
    /* Don't wrap property and descriptor names */
    white-space: nowrap;
}
.type { /* CSS value <type> */
    font-style: italic;
}
pre .property::before, pre .property::after {
    content: "";
}
[data-link-type="property"]::before,
[data-link-type="propdesc"]::before,
[data-link-type="descriptor"]::before,
[data-link-type="value"]::before,
[data-link-type="function"]::before,
[data-link-type="at-rule"]::before,
[data-link-type="selector"]::before,
[data-link-type="maybe"]::before {
    content: "‘";
}
[data-link-type="property"]::after,
[data-link-type="propdesc"]::after,
[data-link-type="descriptor"]::after,
[data-link-type="value"]::after,
[data-link-type="function"]::after,
[data-link-type="at-rule"]::after,
[data-link-type="selector"]::after,
[data-link-type="maybe"]::after {
    content: "’";
}

[data-link-type].production::before,
[data-link-type].production::after,
.prod [data-link-type]::before,
.prod [data-link-type]::after {
    content: "";
}

[data-link-type=element],
[data-link-type=element-attr] {
    font-family: Menlo, Consolas, "DejaVu Sans Mono", monospace;
    font-size: .9em;
}
[data-link-type=element]::before { content: "<" }
[data-link-type=element]::after  { content: ">" }

[data-link-type=biblio] {
    white-space: pre;
}</style>
<style>/* style-colors */

/* Any --*-text not paired with a --*-bg is assumed to have a transparent bg */
:root {
    color-scheme: light dark;

    --text: black;
    --bg: white;

    --unofficial-watermark: url(https://www.w3.org/StyleSheets/TR/2016/logos/UD-watermark);

    --logo-bg: #1a5e9a;
    --logo-active-bg: #c00;
    --logo-text: white;

    --tocnav-normal-text: #707070;
    --tocnav-normal-bg: var(--bg);
    --tocnav-hover-text: var(--tocnav-normal-text);
    --tocnav-hover-bg: #f8f8f8;
    --tocnav-active-text: #c00;
    --tocnav-active-bg: var(--tocnav-normal-bg);

    --tocsidebar-text: var(--text);
    --tocsidebar-bg: #f7f8f9;
    --tocsidebar-shadow: rgba(0,0,0,.1);
    --tocsidebar-heading-text: hsla(203,20%,40%,.7);

    --toclink-text: var(--text);
    --toclink-underline: #3980b5;
    --toclink-visited-text: var(--toclink-text);
    --toclink-visited-underline: #054572;

    --heading-text: #005a9c;

    --hr-text: var(--text);

    --algo-border: #def;

    --del-text: red;
    --del-bg: transparent;
    --ins-text: #080;
    --ins-bg: transparent;

    --a-normal-text: #034575;
    --a-normal-underline: #707070;
    --a-visited-text: var(--a-normal-text);
    --a-visited-underline: #bbb;
    --a-hover-bg: rgba(75%, 75%, 75%, .25);
    --a-active-text: #c00;
    --a-active-underline: #c00;

    --blockquote-border: silver;
    --blockquote-bg: transparent;
    --blockquote-text: currentcolor;

    --issue-border: #e05252;
    --issue-bg: #fbe9e9;
    --issue-text: var(--text);
    --issueheading-text: #831616;

    --example-border: #e0cb52;
    --example-bg: #fcfaee;
    --example-text: var(--text);
    --exampleheading-text: #574b0f;

    --note-border: #52e052;
    --note-bg: #e9fbe9;
    --note-text: var(--text);
    --noteheading-text: hsl(120, 70%, 30%);
    --notesummary-underline: silver;

    --assertion-border: #aaa;
    --assertion-bg: #eee;
    --assertion-text: black;

    --advisement-border: orange;
    --advisement-bg: #fec;
    --advisement-text: var(--text);
    --advisementheading-text: #b35f00;

    --warning-border: red;
    --warning-bg: hsla(40,100%,50%,0.95);
    --warning-text: var(--text);

    --amendment-border: #330099;
    --amendment-bg: #F5F0FF;
    --amendment-text: var(--text);
    --amendmentheading-text: #220066;

    --def-border: #8ccbf2;
    --def-bg: #def;
    --def-text: var(--text);
    --defrow-border: #bbd7e9;

    --datacell-border: silver;

    --indexinfo-text: #707070;

    --indextable-hover-text: black;
    --indextable-hover-bg: #f7f8f9;

    --outdatedspec-bg: rgba(0, 0, 0, .5);
    --outdatedspec-text: black;
    --outdated-bg: maroon;
    --outdated-text: white;
    --outdated-shadow: red;

    --editedrec-bg: darkorange;
}</style>
<style>/* style-counters */

body {
    counter-reset: example figure issue;
}
.issue {
    counter-increment: issue;
}
.issue:not(.no-marker)::before {
    content: "Issue " counter(issue);
}

.example {
    counter-increment: example;
}
.example:not(.no-marker)::before {
    content: "Example " counter(example);
}
.invalid.example:not(.no-marker)::before,
.illegal.example:not(.no-marker)::before {
    content: "Invalid Example" counter(example);
}

figcaption {
    counter-increment: figure;
}
figcaption:not(.no-marker)::before {
    content: "Figure " counter(figure) " ";
}</style>
<style>/* style-dfn-panel */

:root {
    --dfnpanel-bg: #ddd;
    --dfnpanel-text: var(--text);
}
.dfn-panel {
    position: absolute;
    z-index: 35;
    height: auto;
    width: -webkit-fit-content;
    width: fit-content;
    max-width: 300px;
    max-height: 500px;
    overflow: auto;
    padding: 0.5em 0.75em;
    font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
    background: var(--dfnpanel-bg);
    color: var(--dfnpanel-text);
    border: outset 0.2em;
}
.dfn-panel:not(.on) { display: none; }
.dfn-panel * { margin: 0; padding: 0; text-indent: 0; }
.dfn-panel > b { display: block; }
.dfn-panel a { color: var(--dfnpanel-text); }
.dfn-panel a:not(:hover) { text-decoration: none !important; border-bottom: none !important; }
.dfn-panel > b + b { margin-top: 0.25em; }
.dfn-panel ul { padding: 0; }
.dfn-panel li { list-style: inside; }
.dfn-panel.activated {
    display: inline-block;
    position: fixed;
    left: .5em;
    bottom: 2em;
    margin: 0 auto;
    max-width: calc(100vw - 1.5em - .4em - .5em);
    max-height: 30vh;
}

.dfn-paneled { cursor: pointer; }
</style>
<style>/* style-md-lists */

/* This is a weird hack for me not yet following the commonmark spec
   regarding paragraph and lists. */
[data-md] > :first-child {
    margin-top: 0;
}
[data-md] > :last-child {
    margin-bottom: 0;
}</style>
<style>/* style-selflinks */

:root {
    --selflink-text: white;
    --selflink-bg: gray;
    --selflink-hover-text: black;
}
.heading, .issue, .note, .example, li, dt {
    position: relative;
}
a.self-link {
    position: absolute;
    top: 0;
    left: calc(-1 * (3.5rem - 26px));
    width: calc(3.5rem - 26px);
    height: 2em;
    text-align: center;
    border: none;
    transition: opacity .2s;
    opacity: .5;
}
a.self-link:hover {
    opacity: 1;
}
.heading > a.self-link {
    font-size: 83%;
}
li > a.self-link {
    left: calc(-1 * (3.5rem - 26px) - 2em);
}
dfn > a.self-link {
    top: auto;
    left: auto;
    opacity: 0;
    width: 1.5em;
    height: 1.5em;
    background: var(--selflink-bg);
    color: var(--selflink-text);
    font-style: normal;
    transition: opacity .2s, background-color .2s, color .2s;
}
dfn:hover > a.self-link {
    opacity: 1;
}
dfn > a.self-link:hover {
    color: var(--selflink-hover-text);
}

a.self-link::before            { content: "¶"; }
.heading > a.self-link::before { content: "§"; }
dfn > a.self-link::before      { content: "#"; }
</style>
<style>/* style-syntax-highlighting */

code.highlight { padding: .1em; border-radius: .3em; }
pre.highlight, pre > code.highlight { display: block; padding: 1em; margin: .5em 0; overflow: auto; border-radius: 0; }

.highlight:not(.idl) { background: rgba(0, 0, 0, .03); }
c-[a] { color: #990055 } /* Keyword.Declaration */
c-[b] { color: #990055 } /* Keyword.Type */
c-[c] { color: #708090 } /* Comment */
c-[d] { color: #708090 } /* Comment.Multiline */
c-[e] { color: #0077aa } /* Name.Attribute */
c-[f] { color: #669900 } /* Name.Tag */
c-[g] { color: #222222 } /* Name.Variable */
c-[k] { color: #990055 } /* Keyword */
c-[l] { color: #000000 } /* Literal */
c-[m] { color: #000000 } /* Literal.Number */
c-[n] { color: #0077aa } /* Name */
c-[o] { color: #999999 } /* Operator */
c-[p] { color: #999999 } /* Punctuation */
c-[s] { color: #a67f59 } /* Literal.String */
c-[t] { color: #a67f59 } /* Literal.String.Single */
c-[u] { color: #a67f59 } /* Literal.String.Double */
c-[cp] { color: #708090 } /* Comment.Preproc */
c-[c1] { color: #708090 } /* Comment.Single */
c-[cs] { color: #708090 } /* Comment.Special */
c-[kc] { color: #990055 } /* Keyword.Constant */
c-[kn] { color: #990055 } /* Keyword.Namespace */
c-[kp] { color: #990055 } /* Keyword.Pseudo */
c-[kr] { color: #990055 } /* Keyword.Reserved */
c-[ld] { color: #000000 } /* Literal.Date */
c-[nc] { color: #0077aa } /* Name.Class */
c-[no] { color: #0077aa } /* Name.Constant */
c-[nd] { color: #0077aa } /* Name.Decorator */
c-[ni] { color: #0077aa } /* Name.Entity */
c-[ne] { color: #0077aa } /* Name.Exception */
c-[nf] { color: #0077aa } /* Name.Function */
c-[nl] { color: #0077aa } /* Name.Label */
c-[nn] { color: #0077aa } /* Name.Namespace */
c-[py] { color: #0077aa } /* Name.Property */
c-[ow] { color: #999999 } /* Operator.Word */
c-[mb] { color: #000000 } /* Literal.Number.Bin */
c-[mf] { color: #000000 } /* Literal.Number.Float */
c-[mh] { color: #000000 } /* Literal.Number.Hex */
c-[mi] { color: #000000 } /* Literal.Number.Integer */
c-[mo] { color: #000000 } /* Literal.Number.Oct */
c-[sb] { color: #a67f59 } /* Literal.String.Backtick */
c-[sc] { color: #a67f59 } /* Literal.String.Char */
c-[sd] { color: #a67f59 } /* Literal.String.Doc */
c-[se] { color: #a67f59 } /* Literal.String.Escape */
c-[sh] { color: #a67f59 } /* Literal.String.Heredoc */
c-[si] { color: #a67f59 } /* Literal.String.Interpol */
c-[sx] { color: #a67f59 } /* Literal.String.Other */
c-[sr] { color: #a67f59 } /* Literal.String.Regex */
c-[ss] { color: #a67f59 } /* Literal.String.Symbol */
c-[vc] { color: #0077aa } /* Name.Variable.Class */
c-[vg] { color: #0077aa } /* Name.Variable.Global */
c-[vi] { color: #0077aa } /* Name.Variable.Instance */
c-[il] { color: #000000 } /* Literal.Number.Integer.Long */
</style>
<style>/* style-var-click-highlighting */

    var { cursor: pointer; }
    var.selected0 { background-color: #F4D200; box-shadow: 0 0 0 2px #F4D200; }
    var.selected1 { background-color: #FF87A2; box-shadow: 0 0 0 2px #FF87A2; }
    var.selected2 { background-color: #96E885; box-shadow: 0 0 0 2px #96E885; }
    var.selected3 { background-color: #3EEED2; box-shadow: 0 0 0 2px #3EEED2; }
    var.selected4 { background-color: #EACFB6; box-shadow: 0 0 0 2px #EACFB6; }
    var.selected5 { background-color: #82DDFF; box-shadow: 0 0 0 2px #82DDFF; }
    var.selected6 { background-color: #FFBCF2; box-shadow: 0 0 0 2px #FFBCF2; }
    </style>
<style>/* style-darkmode */

@media (prefers-color-scheme: dark) {
    :root {
        --text: #ddd;
        --bg: black;

        --unofficial-watermark: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='400'%3E%3Cg fill='%23100808' transform='translate(200 200) rotate(-45) translate(-200 -200)' stroke='%23100808' stroke-width='3'%3E%3Ctext x='50%25' y='220' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EUNOFFICIAL%3C/text%3E%3Ctext x='50%25' y='305' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EDRAFT%3C/text%3E%3C/g%3E%3C/svg%3E");

        --logo-bg: #1a5e9a;
        --logo-active-bg: #c00;
        --logo-text: white;

        --tocnav-normal-text: #999;
        --tocnav-normal-bg: var(--bg);
        --tocnav-hover-text: var(--tocnav-normal-text);
        --tocnav-hover-bg: #080808;
        --tocnav-active-text: #f44;
        --tocnav-active-bg: var(--tocnav-normal-bg);

        --tocsidebar-text: var(--text);
        --tocsidebar-bg: #080808;
        --tocsidebar-shadow: rgba(255,255,255,.1);
        --tocsidebar-heading-text: hsla(203,20%,40%,.7);

        --toclink-text: var(--text);
        --toclink-underline: #6af;
        --toclink-visited-text: var(--toclink-text);
        --toclink-visited-underline: #054572;

        --heading-text: #8af;

        --hr-text: var(--text);

        --algo-border: #456;

        --del-text: #f44;
        --del-bg: transparent;
        --ins-text: #4a4;
        --ins-bg: transparent;

        --a-normal-text: #6af;
        --a-normal-underline: #555;
        --a-visited-text: var(--a-normal-text);
        --a-visited-underline: var(--a-normal-underline);
        --a-hover-bg: rgba(25%, 25%, 25%, .2);
        --a-active-text: #f44;
        --a-active-underline: var(--a-active-text);

        --borderedblock-bg: rgba(255, 255, 255, .05);

        --blockquote-border: silver;
        --blockquote-bg: var(--borderedblock-bg);
        --blockquote-text: currentcolor;

        --issue-border: #e05252;
        --issue-bg: var(--borderedblock-bg);
        --issue-text: var(--text);
        --issueheading-text: hsl(0deg, 70%, 70%);

        --example-border: hsl(50deg, 90%, 60%);
        --example-bg: var(--borderedblock-bg);
        --example-text: var(--text);
        --exampleheading-text: hsl(50deg, 70%, 70%);

        --note-border: hsl(120deg, 100%, 35%);
        --note-bg: var(--borderedblock-bg);
        --note-text: var(--text);
        --noteheading-text: hsl(120, 70%, 70%);
        --notesummary-underline: silver;

        --assertion-border: #444;
        --assertion-bg: var(--borderedblock-bg);
        --assertion-text: var(--text);

        --advisement-border: orange;
        --advisement-bg: #222218;
        --advisement-text: var(--text);
        --advisementheading-text: #f84;

        --warning-border: red;
        --warning-bg: hsla(40,100%,20%,0.95);
        --warning-text: var(--text);

        --amendment-border: #330099;
        --amendment-bg: #080010;
        --amendment-text: var(--text);
        --amendmentheading-text: #cc00ff;

        --def-border: #8ccbf2;
        --def-bg: #080818;
        --def-text: var(--text);
        --defrow-border: #136;

        --datacell-border: silver;

        --indexinfo-text: #aaa;

        --indextable-hover-text: var(--text);
        --indextable-hover-bg: #181818;

        --outdatedspec-bg: rgba(255, 255, 255, .5);
        --outdatedspec-text: black;
        --outdated-bg: maroon;
        --outdated-text: white;
        --outdated-shadow: red;

        --editedrec-bg: darkorange;
    }
    /* In case a transparent-bg image doesn't expect to be on a dark bg,
       which is quite common in practice... */
    img { background: white; }
}
@media (prefers-color-scheme: dark) {
    :root {
        --selflink-text: black;
        --selflink-bg: silver;
        --selflink-hover-text: white;
    }
}

@media (prefers-color-scheme: dark) {
    :root {
        --dfnpanel-bg: #222;
        --dfnpanel-text: var(--text);
    }
}
@media (prefers-color-scheme: dark) {
    .highlight:not(.idl) { background: rgba(255, 255, 255, .05); }

    c-[a] { color: #d33682 } /* Keyword.Declaration */
    c-[b] { color: #d33682 } /* Keyword.Type */
    c-[c] { color: #2aa198 } /* Comment */
    c-[d] { color: #2aa198 } /* Comment.Multiline */
    c-[e] { color: #268bd2 } /* Name.Attribute */
    c-[f] { color: #b58900 } /* Name.Tag */
    c-[g] { color: #cb4b16 } /* Name.Variable */
    c-[k] { color: #d33682 } /* Keyword */
    c-[l] { color: #657b83 } /* Literal */
    c-[m] { color: #657b83 } /* Literal.Number */
    c-[n] { color: #268bd2 } /* Name */
    c-[o] { color: #657b83 } /* Operator */
    c-[p] { color: #657b83 } /* Punctuation */
    c-[s] { color: #6c71c4 } /* Literal.String */
    c-[t] { color: #6c71c4 } /* Literal.String.Single */
    c-[u] { color: #6c71c4 } /* Literal.String.Double */
    c-[ch] { color: #2aa198 } /* Comment.Hashbang */
    c-[cp] { color: #2aa198 } /* Comment.Preproc */
    c-[cpf] { color: #2aa198 } /* Comment.PreprocFile */
    c-[c1] { color: #2aa198 } /* Comment.Single */
    c-[cs] { color: #2aa198 } /* Comment.Special */
    c-[kc] { color: #d33682 } /* Keyword.Constant */
    c-[kn] { color: #d33682 } /* Keyword.Namespace */
    c-[kp] { color: #d33682 } /* Keyword.Pseudo */
    c-[kr] { color: #d33682 } /* Keyword.Reserved */
    c-[ld] { color: #657b83 } /* Literal.Date */
    c-[nc] { color: #268bd2 } /* Name.Class */
    c-[no] { color: #268bd2 } /* Name.Constant */
    c-[nd] { color: #268bd2 } /* Name.Decorator */
    c-[ni] { color: #268bd2 } /* Name.Entity */
    c-[ne] { color: #268bd2 } /* Name.Exception */
    c-[nf] { color: #268bd2 } /* Name.Function */
    c-[nl] { color: #268bd2 } /* Name.Label */
    c-[nn] { color: #268bd2 } /* Name.Namespace */
    c-[py] { color: #268bd2 } /* Name.Property */
    c-[ow] { color: #657b83 } /* Operator.Word */
    c-[mb] { color: #657b83 } /* Literal.Number.Bin */
    c-[mf] { color: #657b83 } /* Literal.Number.Float */
    c-[mh] { color: #657b83 } /* Literal.Number.Hex */
    c-[mi] { color: #657b83 } /* Literal.Number.Integer */
    c-[mo] { color: #657b83 } /* Literal.Number.Oct */
    c-[sa] { color: #6c71c4 } /* Literal.String.Affix */
    c-[sb] { color: #6c71c4 } /* Literal.String.Backtick */
    c-[sc] { color: #6c71c4 } /* Literal.String.Char */
    c-[dl] { color: #6c71c4 } /* Literal.String.Delimiter */
    c-[sd] { color: #6c71c4 } /* Literal.String.Doc */
    c-[se] { color: #6c71c4 } /* Literal.String.Escape */
    c-[sh] { color: #6c71c4 } /* Literal.String.Heredoc */
    c-[si] { color: #6c71c4 } /* Literal.String.Interpol */
    c-[sx] { color: #6c71c4 } /* Literal.String.Other */
    c-[sr] { color: #6c71c4 } /* Literal.String.Regex */
    c-[ss] { color: #6c71c4 } /* Literal.String.Symbol */
    c-[fm] { color: #268bd2 } /* Name.Function.Magic */
    c-[vc] { color: #cb4b16 } /* Name.Variable.Class */
    c-[vg] { color: #cb4b16 } /* Name.Variable.Global */
    c-[vi] { color: #cb4b16 } /* Name.Variable.Instance */
    c-[vm] { color: #cb4b16 } /* Name.Variable.Magic */
    c-[il] { color: #657b83 } /* Literal.Number.Integer.Long */
}
</style>
 <body class="h-entry">
  <div class="head">
   <p data-fill-with="logo"><a class="logo" href="https://www.w3.org/"> <img alt="W3C" height="48" src="https://www.w3.org/StyleSheets/TR/2016/logos/W3C" width="72"> </a> </p>
   <h1 class="p-name no-ref" id="title">Loading Signed Exchanges</h1>
   <h2 class="no-num no-toc no-ref heading settled" id="subtitle"><span class="content">Draft Community Group Report, <time class="dt-updated" datetime="1970-01-01">1 January 1970</time></span></h2>
   <div data-fill-with="spec-metadata">
    <dl>
     <dt>This version:
     <dd><a class="u-url" href="https://wicg.github.io/webpackage/loading.html">https://wicg.github.io/webpackage/loading.html</a>
     <dt class="editor">Editor:
     <dd class="editor p-author h-card vcard" data-editor-id="72192"><a class="p-name fn u-email email" href="mailto:jyasskin@chromium.org">Jeffrey Yasskin</a> (<a class="p-org org" href="https://google.com/">Google Inc.</a>)
    </dl>
   </div>
   <div data-fill-with="warning"></div>
   <p class="copyright" data-fill-with="copyright"><a href="http://www.w3.org/Consortium/Legal/ipr-notice#Copyright">Copyright</a> © 1970 the Contributors to the Loading Signed Exchanges Specification, published by the <a href="https://www.w3.org/community/wicg/">Web Platform Incubator Community Group</a> under the <a href="https://www.w3.org/community/about/agreements/cla/">W3C Community Contributor License Agreement (CLA)</a>.
A human-readable <a href="http://www.w3.org/community/about/agreements/cla-deed/">summary</a> is available. </p>
   <hr title="Separator for header">
  </div>
  <div class="p-summary" data-fill-with="abstract">
   <h2 class="no-num no-toc no-ref heading settled" id="abstract"><span class="content">Abstract</span></h2>
   <p>How UAs load signed exchanges.</p>
  </div>
  <div data-fill-with="at-risk"></div>
  <h2 class="no-num no-toc no-ref heading settled" id="status"><span class="content">Status of this document</span></h2>
  <div data-fill-with="status">
   <p> This specification was published by the <a href="https://www.w3.org/community/wicg/">Web Platform Incubator Community Group</a>.
  It is not a W3C Standard nor is it on the W3C Standards Track.

  Please note that under the <a href="https://www.w3.org/community/about/agreements/cla/">W3C Community Contributor License Agreement (CLA)</a> there is a limited opt-out and other conditions apply.

  Learn more about <a href="http://www.w3.org/community/">W3C Community and Business Groups</a>. </p>
   <p></p>
  </div>
  <div data-fill-with="at-risk"></div>
  <nav data-fill-with="table-of-contents" id="toc">
   <h2 class="no-num no-toc no-ref" id="contents">Table of Contents</h2>
   <ol class="toc" role="directory">
    <li>
     <a href="#intro"><span class="secno">1</span> <span class="content">Introduction</span></a>
     <ol class="toc">
      <li><a href="#overview"><span class="secno">1.1</span> <span class="content">Overview</span></a>
      <li><a href="#details"><span class="secno">1.2</span> <span class="content">Other interesting details</span></a>
     </ol>
    <li>
     <a href="#monkeypatches"><span class="secno">2</span> <span class="content">Fetch monkeypatches</span></a>
     <ol class="toc">
      <li><a href="#mp-request-stashed-exchange"><span class="secno">2.1</span> <span class="content">A request’s stashed exchange</span></a>
      <li><a href="#mp-request-clone"><span class="secno">2.2</span> <span class="content">Request clone</span></a>
      <li><a href="#mp-response-date"><span class="secno">2.3</span> <span class="content">Response date</span></a>
      <li><a href="#mp-http-fetch"><span class="secno">2.4</span> <span class="content">Monkeypatch HTTP fetch</span></a>
      <li><a href="#mp-http-network-or-cache-fetch"><span class="secno">2.5</span> <span class="content">Monkeypatch HTTP-network-or-cache fetch</span></a>
     </ol>
    <li>
     <a href="#structs"><span class="secno">3</span> <span class="content">Structures</span></a>
     <ol class="toc">
      <li><a href="#exchange"><span class="secno">3.1</span> <span class="content">Exchange</span></a>
      <li><a href="#read-buffer"><span class="secno">3.2</span> <span class="content">Read buffer</span></a>
      <li><a href="#augmented-certificate"><span class="secno">3.3</span> <span class="content">Augmented Certificate</span></a>
      <li><a href="#signed-exchange-report"><span class="secno">3.4</span> <span class="content">Signed Exchange report</span></a>
      <li><a href="#exchange-signature"><span class="secno">3.5</span> <span class="content">Exchange Signature</span></a>
     </ol>
    <li>
     <a href="#algorithms"><span class="secno">4</span> <span class="content">Algorithms</span></a>
     <ol class="toc">
      <li><a href="#identifying-sxg"><span class="secno">4.1</span> <span class="content">Identifying signed exchanges</span></a>
      <li><a href="#parsing-fallback"><span class="secno">4.2</span> <span class="content">Extracting the fallback URL</span></a>
      <li><a href="#parsing"><span class="secno">4.3</span> <span class="content">Parsing signed exchanges</span></a>
      <li><a href="#parsing-prefix"><span class="secno">4.4</span> <span class="content">Parsing the invariant prefix</span></a>
      <li>
       <a href="#parsing-signature"><span class="secno">4.5</span> <span class="content">Parsing a Signature Header Field</span></a>
       <ol class="toc">
        <li><a href="#handling-cert-url"><span class="secno">4.5.1</span> <span class="content">Handling the certificate reference</span></a>
       </ol>
      <li><a href="#the-signed-message"><span class="secno">4.6</span> <span class="content">The signed message</span></a>
      <li><a href="#validating-signature"><span class="secno">4.7</span> <span class="content">Validating a signature</span></a>
      <li><a href="#cross-origin-trust"><span class="secno">4.8</span> <span class="content">Cross-origin trust</span></a>
      <li><a href="#trusting-certificate"><span class="secno">4.9</span> <span class="content">Establishing trust in a certificate</span></a>
      <li><a href="#parse-b2-cbor-headers"><span class="secno">4.10</span> <span class="content">Parsing b2 CBOR headers</span></a>
      <li>
       <a href="#parse-cbor-headers"><span class="secno">4.11</span> <span class="content">Parsing b3 CBOR headers</span></a>
       <ol class="toc">
        <li><a href="#headers-from-map"><span class="secno">4.11.1</span> <span class="content">Converting a map to a header list</span></a>
       </ol>
      <li><a href="#read-a-body"><span class="secno">4.12</span> <span class="content">Creating the response stream.</span></a>
      <li><a href="#request-matching"><span class="secno">4.13</span> <span class="content">Request matching</span></a>
      <li><a href="#create-a-new-report"><span class="secno">4.14</span> <span class="content">Create a new signed exchange report</span></a>
      <li><a href="#wait-and-queue-a-report"><span class="secno">4.15</span> <span class="content">Wait and queue a report</span></a>
      <li><a href="#queue-report"><span class="secno">4.16</span> <span class="content">Queuing signed exchange report</span></a>
      <li>
       <a href="#stream-algs"><span class="secno">4.17</span> <span class="content">Stream algorithms</span></a>
       <ol class="toc">
        <li><a href="#create-read-buffer"><span class="secno">4.17.1</span> <span class="content">Create a read buffer</span></a>
        <li><a href="#read-up-to-bytes"><span class="secno">4.17.2</span> <span class="content">Read up to bytes</span></a>
        <li><a href="#read-bytes"><span class="secno">4.17.3</span> <span class="content">Read bytes</span></a>
        <li><a href="#dump-stream"><span class="secno">4.17.4</span> <span class="content">Dump to another stream</span></a>
       </ol>
     </ol>
    <li>
     <a href="#seccons"><span class="secno">5</span> <span class="content">Security Considerations</span></a>
     <ol class="toc">
      <li><a href="#seccons-ct"><span class="secno">5.1</span> <span class="content">Certificate Transparency</span></a>
     </ol>
    <li>
     <a href="#w3c-conformance"><span class="secno"></span> <span class="content">Conformance</span></a>
     <ol class="toc">
      <li><a href="#w3c-conventions"><span class="secno"></span> <span class="content">Document conventions</span></a>
      <li><a href="#w3c-conformant-algorithms"><span class="secno"></span> <span class="content">Conformant Algorithms</span></a>
     </ol>
    <li>
     <a href="#index"><span class="secno"></span> <span class="content">Index</span></a>
     <ol class="toc">
      <li><a href="#index-defined-here"><span class="secno"></span> <span class="content">Terms defined by this specification</span></a>
      <li><a href="#index-defined-elsewhere"><span class="secno"></span> <span class="content">Terms defined by reference</span></a>
     </ol>
    <li>
     <a href="#references"><span class="secno"></span> <span class="content">References</span></a>
     <ol class="toc">
      <li><a href="#normative"><span class="secno"></span> <span class="content">Normative References</span></a>
      <li><a href="#informative"><span class="secno"></span> <span class="content">Informative References</span></a>
     </ol>
    <li><a href="#issues-index"><span class="secno"></span> <span class="content">Issues Index</span></a>
   </ol>
  </nav>
  <main>
   <section class="non-normative">
    <h2 class="heading settled" data-level="1" id="intro"><span class="secno">1. </span><span class="content">Introduction</span><a class="self-link" href="#intro"></a></h2>
    <p><em>This section is non-normative.</em></p>
    <p>The Signed Exchanges specification <a data-link-type="biblio" href="#biblio-draft-yasskin-http-origin-signed-responses">[draft-yasskin-http-origin-signed-responses]</a> describes a way to provide one or
more signatures for an HTTP exchange and to check whether any of those
signatures is trusted as authoritative for a particular origin. This
specification describes how web browsers load those exchanges. It is expressed
as several monkeypatches to the <a data-link-type="biblio" href="#biblio-fetch">[FETCH]</a> specification which call algorithms
defined here.</p>
    <h3 class="heading settled" data-level="1.1" id="overview"><span class="secno">1.1. </span><span class="content">Overview</span><a class="self-link" href="#overview"></a></h3>
    <p>When fetching a resource (<code>https://distributor.example.org/foo.sxg</code>) with the <code>application/signed-exchange</code> <a data-link-type="dfn" href="https://mimesniff.spec.whatwg.org/#mime-type" id="ref-for-mime-type">MIME type</a>, the UA parses it, checks its
signatures, and then if all is well, redirects to its request URL
(<code>https://publisher.example.org/foo</code>) with a "stashed" exchange attached to the
request. The redirect applies all the usual processing, and then when it would
normally check for an HTTP cache hit, it also checks whether the stashed request
matches the redirected request and which of the stashed exchange or HTTP cache
contents is newer. If the stashed exchange matches and is newer, the UA returns
the stashed response.</p>
    <p>A Service Worker for <code>https://distributor.example.org/</code> gets to handle the
original request. A Service Worker for <code>https://publisher.example.org/</code> can then
handle the redirect. If it needs to know that signed exchange content is
available for the request it’s handling, it has two options:</p>
    <ol>
     <li data-md>
      <p>If <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/ServiceWorker/#dom-serviceworkerregistration-navigationpreload" id="ref-for-dom-serviceworkerregistration-navigationpreload">navigationPreload</a></code> is enabled, the signed
response will be available in the <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/ServiceWorker/#fetchevent" id="ref-for-fetchevent">FetchEvent</a></code>'s <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/ServiceWorker/#dom-fetchevent-preloadresponse" id="ref-for-dom-fetchevent-preloadresponse">preloadResponse</a></code>. Note that this will also cause a network
request for requests that aren’t served from a signed exchange.</p>
     <li data-md>
      <p><code class="idl"><a data-link-type="idl" href="https://fetch.spec.whatwg.org/#dom-request-clone" id="ref-for-dom-request-clone">clone()</a></code> the <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/ServiceWorker/#dom-fetchevent-request" id="ref-for-dom-fetchevent-request">request</a></code> and set its <code class="idl"><a data-link-type="idl" href="https://fetch.spec.whatwg.org/#dom-request-cache" id="ref-for-dom-request-cache">cache</a></code> to <code class="idl"><a data-link-type="idl" href="https://fetch.spec.whatwg.org/#dom-requestcache-only-if-cached" id="ref-for-dom-requestcache-only-if-cached">"only-if-cached"</a></code>, to retrieve the matching response from
either the signed exchange or the HTTP cache. Note that <code class="idl"><a data-link-type="idl" href="https://fetch.spec.whatwg.org/#dom-global-fetch" id="ref-for-dom-global-fetch">fetch()</a></code>ing a <em>new</em> <code class="idl"><a data-link-type="idl" href="https://fetch.spec.whatwg.org/#request" id="ref-for-request">Request</a></code> with the same <code class="idl"><a data-link-type="idl" href="https://fetch.spec.whatwg.org/#dom-request-url" id="ref-for-dom-request-url">url</a></code> will <em>not</em> retrieve the response from the signed exchange.</p>
    </ol>
    <h3 class="heading settled" data-level="1.2" id="details"><span class="secno">1.2. </span><span class="content">Other interesting details</span><a class="self-link" href="#details"></a></h3>
    <ul>
     <li data-md>
      <p>Like with <code>&lt;link rel="prefetch"></code> and <code>&lt;link rel="preload"></code>, the UA will use
the stashed response even if its HTTP cache headers have expired. This makes
it easier to specify that the contents of the signed exchange don’t wind up
in the HTTP cache before our security reviewers have gotten comfortable with
that idea. The publisher can still control resource expiration by setting
the Signature header’s <a data-link-type="dfn" href="#exchange-signature-expiration-time" id="ref-for-exchange-signature-expiration-time">expiration time</a> to the cache
expiration time if that’s sooner than they’d otherwise have the signature
expire.</p>
    </ul>
   </section>
   <h2 class="heading settled" data-level="2" id="monkeypatches"><span class="secno">2. </span><span class="content">Fetch monkeypatches</span><a class="self-link" href="#monkeypatches"></a></h2>
   <p>When fetching a signed exchange, the UA needs to look for a trusted and valid
signature and then redirect to the contained resource. We don’t put the
contained resource in the HTTP cache, so redirects get a new field to store it.</p>
   <h3 class="heading settled" data-level="2.1" id="mp-request-stashed-exchange"><span class="secno">2.1. </span><span class="content">A request’s stashed exchange</span><a class="self-link" href="#mp-request-stashed-exchange"></a></h3>
   <p>A <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request" id="ref-for-concept-request">request</a> has an associated <dfn class="dfn-paneled" data-dfn-for="request" data-dfn-type="dfn" data-noexport id="request-stashed-exchange">stashed exchange</dfn>, which
is null or an <a data-link-type="dfn" href="#exchange" id="ref-for-exchange">exchange</a>.</p>
   <h3 class="heading settled algorithm" data-algorithm="Request clone" data-level="2.2" id="mp-request-clone"><span class="secno">2.2. </span><span class="content">Request clone</span><a class="self-link" href="#mp-request-clone"></a></h3>
   <p>Rewrite <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-clone" id="ref-for-concept-request-clone">clone a request</a> to run these steps:</p>
   <ol>
    <li>
     Let <var>newRequest</var> be a copy of <var>request</var>, except for its <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-body" id="ref-for-concept-request-body">body</a> 
     <ins>and <a data-link-type="dfn" href="#request-stashed-exchange" id="ref-for-request-stashed-exchange">stashed exchange</a></ins>
     . 
    <li>If <var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-body" id="ref-for-concept-request-body①">body</a> is non-null, set <var>newRequest</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-body" id="ref-for-concept-request-body②">body</a> to the result of <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-body-clone" id="ref-for-concept-body-clone">cloning</a> <var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-body" id="ref-for-concept-request-body③">body</a>. 
    <li>
     <ins>If <var>request</var>’s <a data-link-type="dfn" href="#request-stashed-exchange" id="ref-for-request-stashed-exchange①">stashed exchange</a> is non-null, set <var>newRequest</var>’s <a data-link-type="dfn" href="#request-stashed-exchange" id="ref-for-request-stashed-exchange②">stashed exchange</a> to an exchange whose <a data-link-type="dfn" href="#exchange-request-url" id="ref-for-exchange-request-url">request URL</a> is a copy of <var>request</var>’s <a data-link-type="dfn" href="#request-stashed-exchange" id="ref-for-request-stashed-exchange③">stashed
  exchange</a>'s <a data-link-type="dfn" href="#exchange-request-url" id="ref-for-exchange-request-url①">request URL</a> and whose <a data-link-type="dfn" href="#exchange-response" id="ref-for-exchange-response">response</a> is the <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-clone" id="ref-for-concept-response-clone">clone</a> of <var>request</var>’s <a data-link-type="dfn" href="#request-stashed-exchange" id="ref-for-request-stashed-exchange④">stashed exchange</a>'s <a data-link-type="dfn" href="#exchange-response" id="ref-for-exchange-response①">response</a>.</ins>
    <li>Return <var>newRequest</var>. 
   </ol>
   <h3 class="heading settled algorithm" data-algorithm="Response date" data-level="2.3" id="mp-response-date"><span class="secno">2.3. </span><span class="content">Response date</span><a class="self-link" href="#mp-response-date"></a></h3>
   <p>A <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response" id="ref-for-concept-response">response</a> <var>response</var>’s <dfn class="dfn-paneled" data-dfn-for="response" data-dfn-type="dfn" data-noexport id="response-date">date</dfn> is the result of:</p>
   <ol>
    <li data-md>
     <p>Let <var>date</var> be the result of <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#extract-header-list-values" id="ref-for-extract-header-list-values">extracting header list values</a> given <code>`Date`</code> and <var>response</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-header-list" id="ref-for-concept-response-header-list">header list</a>.</p>
    <li data-md>
     <p>If <var>date</var> is a failure, return the point in time of the beginning of the
universe.</p>
    <li data-md>
     <p>Return the point in time represented by <var>date</var>, as interpreted for the <a data-link-type="http-header" href="https://tools.ietf.org/html/rfc7231#section-7.1.1.2" id="ref-for-section-7.1.1.2">Date</a> header field.</p>
   </ol>
   <h3 class="heading settled algorithm" data-algorithm="Monkeypatch HTTP fetch" data-level="2.4" id="mp-http-fetch"><span class="secno">2.4. </span><span class="content">Monkeypatch HTTP fetch</span><a class="self-link" href="#mp-http-fetch"></a></h3>
   <p>In <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-http-fetch" id="ref-for-concept-http-fetch">HTTP fetch</a>, before</p>
   <blockquote>
    <ol start="5">
     <li data-md>
      <p>If <var>actualResponse</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-status" id="ref-for-concept-response-status">status</a> is a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#redirect-status" id="ref-for-redirect-status">redirect status</a>, then:
...</p>
    </ol>
   </blockquote>
   <p>add the following steps:</p>
   <ol start="5">
    <li data-md>
     <p>If the <a data-link-type="dfn" href="#signed-exchange-version" id="ref-for-signed-exchange-version">signed exchange version</a> of <var>actualResponse</var> is:</p>
     <dl class="switch">
      <dt data-md>undefined
      <dd data-md>
       <p>Do nothing.</p>
      <dt data-md><code>"b2"</code> or <code>"b3"</code>
      <dd data-md>
       <ol>
        <li data-md>
         <p>Let <var>report</var> be the result of <a data-link-type="dfn" href="#create-a-new-signed-exchange-report" id="ref-for-create-a-new-signed-exchange-report">create a new signed exchange report</a> with <var>request</var> and <var>actualResponse</var>.</p>
        <li data-md>
         <p>Let <var>parsedExchange</var> be the result of <a data-link-type="dfn" href="#parsing-a-signed-exchange" id="ref-for-parsing-a-signed-exchange">parsing a signed
exchange</a> of version <code>b2</code> or <code>b3</code>, respectively, from <var>actualResponse</var> in the context of <var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-client" id="ref-for-concept-request-client">client</a>,
reporting to <var>report</var>.</p>
        <li data-md>
         <p>If <var>parsedExchange</var> is not an <a data-link-type="dfn" href="#exchange" id="ref-for-exchange①">exchange</a>, run <a data-link-type="dfn" href="#queue-a-signed-exchange-report" id="ref-for-queue-a-signed-exchange-report">queue a signed exchange report</a> <var>report</var> with <var>parsedExchange</var> as the result, and return a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-network-error" id="ref-for-concept-network-error">network error</a>.</p>
        <li data-md>
         <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel" id="ref-for-in-parallel">In parallel</a>, <a data-link-type="dfn" href="#wait-and-queue-a-report-for" id="ref-for-wait-and-queue-a-report-for">wait and queue a report for</a> <var>parsedExchange</var> and <var>report</var>.</p>
        <li data-md>
         <p>Set <var>actualResponse</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-status" id="ref-for-concept-status">status</a> to <code>303</code>.</p>
        <li data-md>
         <p><a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-header-list-set" id="ref-for-concept-header-list-set">Set</a> <var>actualResponse</var>’s <code>`Location`</code> header to
the <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ascii-encode" id="ref-for-ascii-encode">ASCII encoding</a> of the <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-serializer" id="ref-for-concept-url-serializer">serialization</a> of <var>parsedExchange</var>’s <a data-link-type="dfn" href="#exchange-request-url" id="ref-for-exchange-request-url②">request URL</a>.</p>
        <li data-md>
         <p>Set <var>request</var>’s <a data-link-type="dfn" href="#request-stashed-exchange" id="ref-for-request-stashed-exchange⑤">stashed exchange</a> to <var>parsedExchange</var>.</p>
       </ol>
      <dt data-md>Anything else
      <dd data-md>
       <ol>
        <li data-md>
         <p>Let <var>fallbackUrlBytes</var> be the result of <a data-link-type="dfn" href="#extracting-the-fallback-url" id="ref-for-extracting-the-fallback-url">extracting the fallback
URL</a> from <var>actualResponse</var>.</p>
        <li data-md>
         <p>If <var>fallbackUrlBytes</var> is a failure, return a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-network-error" id="ref-for-concept-network-error①">network error</a>.</p>
        <li data-md>
         <p>Set <var>actualResponse</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-status" id="ref-for-concept-status①">status</a> to <code>303</code>.</p>
        <li data-md>
         <p><a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-header-list-set" id="ref-for-concept-header-list-set①">Set</a> <var>actualResponse</var>’s <code>`Location`</code> header to <var>fallbackUrlBytes</var>.</p>
       </ol>
     </dl>
     <p class="note" role="note"><span>Note:</span> The final <a data-link-type="biblio" href="#biblio-draft-yasskin-http-origin-signed-responses">[draft-yasskin-http-origin-signed-responses]</a> will use a
version of <code>`1`</code>, but this specification tracks what’s actually
implemented in browsers, which still uses draft versions.</p>
   </ol>
   <h3 class="heading settled algorithm" data-algorithm="Monkeypatch HTTP-network-or-cache fetch" data-level="2.5" id="mp-http-network-or-cache-fetch"><span class="secno">2.5. </span><span class="content">Monkeypatch HTTP-network-or-cache fetch</span><a class="self-link" href="#mp-http-network-or-cache-fetch"></a></h3>
   <p>In <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-http-network-or-cache-fetch" id="ref-for-concept-http-network-or-cache-fetch">HTTP-network-or-cache fetch</a>, after</p>
   <blockquote>
    <p>5.19. If <var>httpRequest</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-cache-mode" id="ref-for-concept-request-cache-mode">cache mode</a> is neither "<code>no-store</code>" nor
"<code>reload</code>", then: ...</p>
   </blockquote>
   <p>add the following steps:</p>
   <ol start="20">
    <li data-md>
     <p>If <var>httpRequest</var>’s <a data-link-type="dfn" href="#request-stashed-exchange" id="ref-for-request-stashed-exchange⑥">stashed exchange</a> isn’t null:</p>
     <ol>
      <li data-md>
       <p>Let <var>stashedExchange</var> be <var>httpRequest</var>’s <a data-link-type="dfn" href="#request-stashed-exchange" id="ref-for-request-stashed-exchange⑦">stashed exchange</a>.</p>
      <li data-md>
       <p>If</p>
       <ul>
        <li data-md>
         <p><var>httpRequest</var> <a data-link-type="dfn" href="#matches-the-stored-exchange" id="ref-for-matches-the-stored-exchange">matches the stored exchange</a> <var>stashedExchange</var> and</p>
        <li data-md>
         <p><var>response</var> is null or <var>response</var>’s <a data-link-type="dfn" href="#response-date" id="ref-for-response-date">date</a> is earlier than <var>httpRequest</var>’s <a data-link-type="dfn" href="#request-stashed-exchange" id="ref-for-request-stashed-exchange⑧">stashed exchange</a>'s <a data-link-type="dfn" href="#exchange-response" id="ref-for-exchange-response②">response</a>'s <a data-link-type="dfn" href="#response-date" id="ref-for-response-date①">date</a></p>
       </ul>
       <p>then set <var>response</var> to <var>httpRequest</var>’s <a data-link-type="dfn" href="#request-stashed-exchange" id="ref-for-request-stashed-exchange⑨">stashed exchange</a>'s <a data-link-type="dfn" href="#exchange-response" id="ref-for-exchange-response③">response</a>.</p>
      <li data-md>
       <p>If <var>response</var> is null and <var>httpRequest</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-initiator" id="ref-for-concept-request-initiator">initiator</a> is
"<code>prefetch</code>" or "<code>preload</code>", return a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-network-error" id="ref-for-concept-network-error②">network error</a>.</p>
       <p class="note" role="note"><span>Note:</span> This ensures that prefetching a signed exchange from one origin
won’t accidentally do a network request from another origin, which could <a href="https://wicg.github.io/webpackage/draft-yasskin-wpack-use-cases.html#private-prefetch">compromise the user’s
privacy</a>.</p>
     </ol>
   </ol>
   <p class="note" role="note"><span>Note:</span> Applying the signed exchange’s response here has the effect of letting a
newer HTTP cache entry override a signed exchange’s content, and of not storing
the signed exchange’s response in the HTTP cache.</p>
   <h2 class="heading settled" data-level="3" id="structs"><span class="secno">3. </span><span class="content">Structures</span><a class="self-link" href="#structs"></a></h2>
   <h3 class="heading settled dfn-paneled" data-dfn-type="dfn" data-export data-level="3.1" data-lt="Exchange" id="exchange"><span class="secno">3.1. </span><span class="content">Exchange</span><a class="self-link" href="#exchange" id="ref-for-exchange⑧"></a></h3>
   <p>An exchange is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#struct" id="ref-for-struct">struct</a> with the following items:</p>
   <ul>
    <li data-md>
     <p><dfn class="dfn-paneled" data-dfn-for="exchange" data-dfn-type="dfn" data-export id="exchange-request-url">request URL</dfn>, a <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url" id="ref-for-concept-url">URL</a>.</p>
    <li data-md>
     <p><dfn class="dfn-paneled" data-dfn-for="exchange" data-dfn-type="dfn" data-export id="exchange-response">response</dfn>, a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response" id="ref-for-concept-response①">response</a>.</p>
   </ul>
   <h3 class="heading settled dfn-paneled" data-dfn-type="dfn" data-level="3.2" data-lt="Read buffer" data-noexport id="read-buffer"><span class="secno">3.2. </span><span class="content">Read buffer</span><a class="self-link" href="#read-buffer" id="ref-for-read-buffer"></a></h3>
   <p>A read buffer is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#struct" id="ref-for-struct①">struct</a> with the following items:</p>
   <ul>
    <li data-md>
     <p><dfn class="dfn-paneled" data-dfn-for="read buffer" data-dfn-type="dfn" data-noexport id="read-buffer-stream">stream</dfn>: A <code class="idl"><a data-link-type="idl" href="https://streams.spec.whatwg.org/#readablestream" id="ref-for-readablestream">ReadableStream</a></code>.</p>
    <li data-md>
     <p><dfn class="dfn-paneled" data-dfn-for="read buffer" data-dfn-type="dfn" data-noexport id="read-buffer-reader">reader</dfn>: A <code class="idl"><a data-link-type="idl" href="https://streams.spec.whatwg.org/#readablestreamdefaultreader" id="ref-for-readablestreamdefaultreader">ReadableStreamDefaultReader</a></code> whose stream is <a data-link-type="dfn" href="#read-buffer-stream" id="ref-for-read-buffer-stream">stream</a>.</p>
    <li data-md>
     <p><dfn class="dfn-paneled" data-dfn-for="read buffer" data-dfn-type="dfn" data-noexport id="read-buffer-bytes">bytes</dfn>: A <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte-sequence" id="ref-for-byte-sequence">byte sequence</a> holding the bytes that have been read
from <a data-link-type="dfn" href="#read-buffer-stream" id="ref-for-read-buffer-stream①">stream</a> but not returned to a calling algorithm yet.</p>
   </ul>
   <h3 class="heading settled dfn-paneled" data-dfn-type="dfn" data-level="3.3" data-lt="Augmented Certificate" data-noexport id="augmented-certificate"><span class="secno">3.3. </span><span class="content">Augmented Certificate</span><a class="self-link" href="#augmented-certificate" id="ref-for-augmented-certificate"></a></h3>
   <p>An augmented certificate is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#tuple" id="ref-for-tuple">tuple</a> with the following items:</p>
   <ol>
    <li data-md>
     <p><dfn class="dfn-paneled" data-dfn-for="augmented certificate" data-dfn-type="dfn" data-noexport id="augmented-certificate-certificate">certificate</dfn>, a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte-sequence" id="ref-for-byte-sequence①">byte sequence</a> that’s expected to hold a
DER-encoded X.509v3 certificate (<a data-link-type="biblio" href="#biblio-rfc5280">[RFC5280]</a>).</p>
    <li data-md>
     <p><dfn class="dfn-paneled" data-dfn-for="augmented certificate" data-dfn-type="dfn" data-noexport id="augmented-certificate-ocsp-response">OCSP response</dfn>, a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte-sequence" id="ref-for-byte-sequence②">byte sequence</a> that’s expected to hold a
DER-encoded <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc6960#section-4.2.1" id="ref-for-section-4.2.1">OCSPResponse</a> for the <a data-link-type="dfn" href="#augmented-certificate-certificate" id="ref-for-augmented-certificate-certificate">certificate</a>.</p>
    <li data-md>
     <p><dfn class="dfn-paneled" data-dfn-for="augmented certificate" data-dfn-type="dfn" data-noexport id="augmented-certificate-sct">SCT</dfn>, a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte-sequence" id="ref-for-byte-sequence③">byte sequence</a> that’s expected to hold a <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc6962#section-3.3" id="ref-for-section-3.3">SignedCertificateTimestampList</a> for the <a data-link-type="dfn" href="#augmented-certificate-certificate" id="ref-for-augmented-certificate-certificate①">certificate</a>.</p>
   </ol>
   <p>These fields are <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte-sequence" id="ref-for-byte-sequence④">byte sequences</a> instead of parsed and validated structures
because we expect some UAs to pass them to other systems for validation, and
some of those systems expect plain byte sequences.</p>
   <p>A <a data-link-type="dfn" href="#augmented-certificate-certificate" id="ref-for-augmented-certificate-certificate②">certificate</a> contains a <dfn class="dfn-paneled" data-dfn-for="certificate" data-dfn-type="dfn" data-lt="public key" data-noexport id="certificate-public-key">public
key</dfn> (<a data-link-type="dfn" href="https://tools.ietf.org/html/rfc5280#section-4.1.2.7" id="ref-for-section-4.1.2.7">Subject Public Key Info</a>), which has an <dfn class="dfn-paneled" data-dfn-for="public
key" data-dfn-type="dfn" data-noexport id="public-key-algorithm">algorithm</dfn> (<a data-link-type="dfn" href="https://tools.ietf.org/html/rfc5280#section-4.1.1.2" id="ref-for-section-4.1.1.2">AlgorithmIdentifier</a>).</p>
   <p>A <a data-link-type="dfn" href="#augmented-certificate-certificate" id="ref-for-augmented-certificate-certificate③">certificate</a> contains an <dfn class="dfn-paneled" data-dfn-for="certificate" data-dfn-type="dfn" data-noexport id="certificate-extensions">extensions</dfn> map (<a data-link-type="dfn" href="https://tools.ietf.org/html/rfc5280#section-4.2" id="ref-for-section-4.2">Certificate Extensions</a>) from OIDs to <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte-sequence" id="ref-for-byte-sequence⑤">byte sequences</a>.</p>
   <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="certificate-chain">certificate chain</dfn> is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list">list</a> of <a data-link-type="dfn" href="#augmented-certificate" id="ref-for-augmented-certificate①">augmented certificates</a>, of
which the first <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-item" id="ref-for-list-item">item</a> is the <dfn class="dfn-paneled" data-dfn-for="certificate chain" data-dfn-type="dfn" data-noexport id="certificate-chain-leaf">leaf</dfn>.</p>
   <h3 class="heading settled dfn-paneled" data-dfn-type="dfn" data-export data-level="3.4" data-lt="Signed Exchange report" id="signed-exchange-report"><span class="secno">3.4. </span><span class="content">Signed Exchange report</span><a class="self-link" href="#signed-exchange-report" id="ref-for-signed-exchange-report"></a></h3>
   <p>A signed exchange report is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#struct" id="ref-for-struct②">struct</a> with the following items:</p>
   <dl>
    <dt data-md><dfn class="dfn-paneled" data-dfn-for="signed exchange report" data-dfn-type="dfn" data-noexport id="signed-exchange-report-result">result</dfn>
    <dd data-md>
     <p>The result string of loading signed exchange. This must be unset or one of
"<dfn class="dfn-paneled" data-dfn-for="signed exchange report" data-dfn-type="dfn" data-noexport id="signed-exchange-report-ok"><code>ok</code></dfn>", "<dfn class="dfn-paneled" data-dfn-for="signed exchange report" data-dfn-type="dfn" data-noexport id="signed-exchange-report-mi_error"><code>mi_error</code></dfn>",
"<dfn class="dfn-paneled" data-dfn-for="signed exchange report" data-dfn-type="dfn" data-noexport id="signed-exchange-report-non_secure_distributor"><code>non_secure_distributor</code></dfn>", "<dfn class="dfn-paneled" data-dfn-for="signed exchange report" data-dfn-type="dfn" data-noexport id="signed-exchange-report-parse_error"><code>parse_error</code></dfn>",
"<dfn class="dfn-paneled" data-dfn-for="signed exchange report" data-dfn-type="dfn" data-noexport id="signed-exchange-report-invalid_integrity_header"><code>invalid_integrity_header</code></dfn>",
"<dfn class="dfn-paneled" data-dfn-for="signed exchange report" data-dfn-type="dfn" data-noexport id="signed-exchange-report-signature_verification_error"><code>signature_verification_error</code></dfn>",
"<dfn class="dfn-paneled" data-dfn-for="signed exchange report" data-dfn-type="dfn" data-noexport id="signed-exchange-report-cert_verification_error"><code>cert_verification_error</code></dfn>", "<dfn class="dfn-paneled" data-dfn-for="signed exchange report" data-dfn-type="dfn" data-noexport id="signed-exchange-report-cert_fetch_error"><code>cert_fetch_error</code></dfn>",
"<dfn class="dfn-paneled" data-dfn-for="signed exchange report" data-dfn-type="dfn" data-noexport id="signed-exchange-report-cert_parse_error"><code>cert_parse_error</code></dfn>",</p>
    <dt data-md><dfn class="dfn-paneled" data-dfn-for="signed exchange report" data-dfn-type="dfn" data-noexport id="signed-exchange-report-outer-request">outer request</dfn>
    <dd data-md>
     <p>The <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request" id="ref-for-concept-request①">request</a> which the user agent sent to the server to load the signed exchange.</p>
    <dt data-md><dfn class="dfn-paneled" data-dfn-for="signed exchange report" data-dfn-type="dfn" data-noexport id="signed-exchange-report-outer-response">outer response</dfn>
    <dd data-md>
     <p>The <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response" id="ref-for-concept-response②">response</a> which the user agent received from the server.</p>
    <dt data-md><dfn class="dfn-paneled" data-dfn-for="signed exchange report" data-dfn-type="dfn" data-noexport id="signed-exchange-report-inner-url">inner URL</dfn>
    <dd data-md>
     <p>The logical <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url" id="ref-for-concept-url①">URL</a> of the signed exchange, if available. Otherwise, an empty
string.</p>
    <dt data-md><dfn class="dfn-paneled" data-dfn-for="signed exchange report" data-dfn-type="dfn" data-noexport id="signed-exchange-report-cert-url-list">cert URL list</dfn>
    <dd data-md>
     <p>The list of <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url" id="ref-for-concept-url②">URLs</a> in "<code>cert-url</code>" parameters for the signed exchange’s
signatures, if available. Otherwise, an empty list.</p>
    <dt data-md><dfn class="dfn-paneled" data-dfn-for="signed exchange report" data-dfn-type="dfn" data-noexport id="signed-exchange-report-server-ip">server IP</dfn>
    <dd data-md>
     <p>The IP address of the server from which the user agent received the signed
exchange, if available. Otherwise, an empty string.</p>
    <dt data-md><dfn class="dfn-paneled" data-dfn-for="signed exchange report" data-dfn-type="dfn" data-noexport id="signed-exchange-report-cert-server-ip-list">cert server IP list</dfn>
    <dd data-md>
     <p>The list of IP addresses of the servers from which the user agent received
the certificates listed in <a data-link-type="dfn" href="#signed-exchange-report-cert-url-list" id="ref-for-signed-exchange-report-cert-url-list">cert URL list</a>.</p>
   </dl>
   <h3 class="heading settled dfn-paneled" data-dfn-type="dfn" data-export data-level="3.5" data-lt="Exchange Signature" id="exchange-signature"><span class="secno">3.5. </span><span class="content">Exchange Signature</span><a class="self-link" href="#exchange-signature" id="ref-for-exchange-signature"></a></h3>
   <p>An exchange signature is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#struct" id="ref-for-struct③">struct</a> with the following items:</p>
   <dl>
    <dt data-md><dfn class="dfn-paneled" data-dfn-for="exchange signature" data-dfn-type="dfn" data-noexport id="exchange-signature-signature">signature</dfn>
    <dd data-md>
     <p>A <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte-sequence" id="ref-for-byte-sequence⑥">byte sequence</a> holding a signature of the exchange.</p>
    <dt data-md><dfn class="dfn-paneled" data-dfn-for="exchange signature" data-dfn-type="dfn" data-noexport id="exchange-signature-certificate-chain">certificate chain</dfn>
    <dd data-md>
     <p>A <a data-link-type="dfn" href="#certificate-chain" id="ref-for-certificate-chain">certificate chain</a> whose <a data-link-type="dfn" href="#certificate-chain-leaf" id="ref-for-certificate-chain-leaf">leaf</a>'s <a data-link-type="dfn" href="#certificate-public-key" id="ref-for-certificate-public-key">public key</a> can verify the <a data-link-type="dfn" href="#exchange-signature-signature" id="ref-for-exchange-signature-signature">signature</a> and from which the UA will try to build a path from the <a data-link-type="dfn" href="#certificate-chain-leaf" id="ref-for-certificate-chain-leaf①">leaf</a> to a trusted root.</p>
    <dt data-md><dfn class="dfn-paneled" data-dfn-for="exchange signature" data-dfn-type="dfn" data-noexport id="exchange-signature-certsha256">certSha256</dfn>
    <dd data-md>
     <p>A <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte-sequence" id="ref-for-byte-sequence⑦">byte sequence</a> holding the <a data-link-type="dfn" href="http://csrc.nist.gov/publications/fips/fips180-4/fips-180-4.pdf#" id="termref-for-">SHA-256</a> hash that verified the <a data-link-type="dfn" href="#exchange-signature-certificate-chain" id="ref-for-exchange-signature-certificate-chain">certificate chain</a>'s <a data-link-type="dfn" href="#certificate-chain-leaf" id="ref-for-certificate-chain-leaf②">leaf</a>.</p>
    <dt data-md><dfn class="dfn-paneled" data-dfn-for="exchange signature" data-dfn-type="dfn" data-noexport id="exchange-signature-integrity-header">integrity header</dfn>
    <dd data-md>
     <p>A <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list①">list</a> of <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ascii-string" id="ref-for-ascii-string">ASCII strings</a> that describes the response header and any of
its parameters that guard the integrity of the response payload.</p>
    <dt data-md><dfn class="dfn-paneled" data-dfn-for="exchange signature" data-dfn-type="dfn" data-noexport id="exchange-signature-validityurl">validityUrl</dfn>
    <dd data-md>
     <p>A <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url" id="ref-for-concept-url③">URL</a> describing where to update this signature.</p>
    <dt data-md><dfn class="dfn-paneled" data-dfn-for="exchange signature" data-dfn-type="dfn" data-noexport id="exchange-signature-validityurlbytes">validityUrlBytes</dfn>
    <dd data-md>
     <p>The bytes that <a data-link-type="dfn" href="#exchange-signature-validityurl" id="ref-for-exchange-signature-validityurl">validityUrl</a> was parsed from.</p>
    <dt data-md><dfn class="dfn-paneled" data-dfn-for="exchange signature" data-dfn-type="dfn" data-noexport id="exchange-signature-date">date</dfn>
    <dd data-md>
     <p>The POSIX time at which the signature starts being valid.</p>
    <dt data-md><dfn class="dfn-paneled" data-dfn-for="exchange signature" data-dfn-type="dfn" data-noexport id="exchange-signature-expiration-time">expiration time</dfn>
    <dd data-md>
     <p>The POSIX time at which the signature stops being valid.</p>
   </dl>
   <h2 class="heading settled" data-level="4" id="algorithms"><span class="secno">4. </span><span class="content">Algorithms</span><a class="self-link" href="#algorithms"></a></h2>
   <h3 class="heading settled algorithm" data-algorithm="Identifying signed exchanges" data-level="4.1" id="identifying-sxg"><span class="secno">4.1. </span><span class="content">Identifying signed exchanges</span><a class="self-link" href="#identifying-sxg"></a></h3>
   <p>The <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="signed-exchange-version">signed exchange version</dfn> of a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response" id="ref-for-concept-response③">response</a> <var>response</var> is the
result of the following steps:</p>
   <ol>
    <li data-md>
     <p>If <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#determine-nosniff" id="ref-for-determine-nosniff">determine nosniff</a> on <var>response</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-header-list" id="ref-for-concept-response-header-list①">header
list</a> returns false, return undefined.</p>
     <p class="note" role="note"><span>Note:</span> This requires servers to include the <code>X-Content-Type-Options: nosniff</code> header when they serve signed exchanges, which prevents some clients that
don’t understand signed exchanges from interpreting one as another content
type.</p>
    <li data-md>
     <p>Let <var>mimeType</var> be the result of <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-header-extract-mime-type" id="ref-for-concept-header-extract-mime-type">extracting a MIME type</a> from <var>response</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-header-list" id="ref-for-concept-response-header-list②">header list</a>.</p>
    <li data-md>
     <p>If <var>mimeType</var> is a failure, return undefined.</p>
    <li data-md>
     <p>If <var>mimeType</var>’s <a data-link-type="dfn" href="https://mimesniff.spec.whatwg.org/#mime-type-essence" id="ref-for-mime-type-essence">essence</a> is not <code>"application/signed-exchange"</code>,
return undefined.</p>
    <li data-md>
     <p>Let <var>params</var> be <var>mimeType</var>’s <a data-link-type="dfn" href="https://mimesniff.spec.whatwg.org/#parameters" id="ref-for-parameters">parameters</a></p>
    <li data-md>
     <p>If <var>params</var>["v"] exists, return it. Otherwise, return undefined.</p>
   </ol>
   <h3 class="heading settled algorithm" data-algorithm="Extracting the fallback URL" data-level="4.2" id="parsing-fallback"><span class="secno">4.2. </span><span class="content">Extracting the fallback URL</span><a class="self-link" href="#parsing-fallback"></a></h3>
   <p>This section defines how to load a the fallback URL from its invariant location
in an unrecognized signed exchange version.</p>
   <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="extracting-the-fallback-url">Extracting the fallback URL</dfn> from a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response" id="ref-for-concept-response④">response</a> <var>response</var> returns
the result of the following steps:</p>
   <ol>
    <li data-md>
     <p class="assertion">Assert: This algorithm is running <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel" id="ref-for-in-parallel①">in parallel</a>.</p>
    <li data-md>
     <p class="assertion">Assert: The <a data-link-type="dfn" href="#signed-exchange-version" id="ref-for-signed-exchange-version①">signed exchange version</a> of <var>response</var> is not undefined.</p>
    <li data-md>
     <p>Let <var>bodyStream</var> be <var>response</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-body" id="ref-for-concept-response-body">body</a>'s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-body-stream" id="ref-for-concept-body-stream">stream</a>.</p>
    <li data-md>
     <p>If <var>bodyStream</var> is null, return failure.</p>
    <li data-md>
     <p>Let <var>stream</var> be a <a data-link-type="dfn" href="#new-read-buffer" id="ref-for-new-read-buffer">new read buffer</a> for <var>bodyStream</var>.</p>
    <li data-md>
     <p>Let (<var>magic</var>, <var>fallbackUrlBytes</var>, <var>fallbackUrl</var>) be the result of <a data-link-type="dfn" href="#parsing-the-invariant-prefix" id="ref-for-parsing-the-invariant-prefix">parsing the invariant prefix</a> from <var>stream</var>. If returns a failure, return that failure.</p>
    <li data-md>
     <p>Return <var>fallbackUrlBytes</var>.</p>
   </ol>
   <h3 class="heading settled algorithm" data-algorithm="Parsing signed exchanges" data-level="4.3" id="parsing"><span class="secno">4.3. </span><span class="content">Parsing signed exchanges</span><a class="self-link" href="#parsing"></a></h3>
   <p>This section defines how to load the formats defined in <a data-link-type="biblio" href="#biblio-draft-yasskin-httpbis-origin-signed-exchanges-impl-02">[draft-yasskin-httpbis-origin-signed-exchanges-impl-02]</a> and <a data-link-type="biblio" href="#biblio-draft-yasskin-httpbis-origin-signed-exchanges-impl-03">[draft-yasskin-httpbis-origin-signed-exchanges-impl-03]</a>.</p>
   <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="parsing-a-signed-exchange">Parsing a signed exchange</dfn> of version <var>version</var> from a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response" id="ref-for-concept-response⑤">response</a> <var>response</var> in the context of an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object" id="ref-for-environment-settings-object">environment settings object</a> <var>client</var>,
reporting to a <a data-link-type="dfn" href="#signed-exchange-report" id="ref-for-signed-exchange-report④">signed exchange report</a> <var>report</var>, returns an <a data-link-type="dfn" href="#exchange" id="ref-for-exchange②">exchange</a> or a
string which indicates a <a data-link-type="dfn" href="#signed-exchange-report-result" id="ref-for-signed-exchange-report-result">result</a> as described by the
following steps</p>
   <ol>
    <li data-md>
     <p class="assertion">Assert: This algorithm is running <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel" id="ref-for-in-parallel②">in parallel</a>.</p>
    <li data-md>
     <p class="assertion">Assert: The <a data-link-type="dfn" href="#signed-exchange-version" id="ref-for-signed-exchange-version②">signed exchange version</a> of <var>response</var> is, if <var>version</var> is</p>
     <dl class="switch">
      <dt data-md><code>b2</code>
      <dd data-md>
       <p><code>"b2"</code></p>
      <dt data-md><code>b3</code>
      <dd data-md>
       <p><code>"b3"</code></p>
     </dl>
    <li data-md>
     <p>If <var>response</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-url" id="ref-for-concept-response-url">URL</a>'s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-origin" id="ref-for-concept-url-origin">origin</a> is not a <a data-link-type="dfn" href="https://w3c.github.io/webappsec-secure-contexts/#potentially-trustworthy-origin" id="ref-for-potentially-trustworthy-origin">potentially
trustworthy origin</a>, return
"<a data-link-type="dfn" href="#signed-exchange-report-non_secure_distributor" id="ref-for-signed-exchange-report-non_secure_distributor">non_secure_distributor</a>".</p>
     <p class="note" role="note"><span>Note:</span> This ensures that the privacy properties of retrieving an HTTPS
resource via a signed exchange are no worse than retrieving it via TLS.</p>
    <li data-md>
     <p>Let <var>bodyStream</var> be <var>response</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-body" id="ref-for-concept-response-body①">body</a>'s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-body-stream" id="ref-for-concept-body-stream①">stream</a>.</p>
    <li data-md>
     <p>If <var>bodyStream</var> is null, return "<a data-link-type="dfn" href="#signed-exchange-report-parse_error" id="ref-for-signed-exchange-report-parse_error">parse_error</a>".</p>
    <li data-md>
     <p>Let <var>stream</var> be a <a data-link-type="dfn" href="#new-read-buffer" id="ref-for-new-read-buffer①">new read buffer</a> for <var>bodyStream</var>.</p>
    <li data-md>
     <p>Let (<var>magic</var>, <var>requestUrlBytes</var>, <var>requestUrl</var>) be the result of <a data-link-type="dfn" href="#parsing-the-invariant-prefix" id="ref-for-parsing-the-invariant-prefix①">parsing the
invariant prefix</a> from <var>stream</var>. If returns a failure, return
"<a data-link-type="dfn" href="#signed-exchange-report-parse_error" id="ref-for-signed-exchange-report-parse_error①">parse_error</a>".</p>
    <li data-md>
     <p>Set <var>report</var>’s <a data-link-type="dfn" href="#signed-exchange-report-inner-url" id="ref-for-signed-exchange-report-inner-url">inner URL</a> to <var>requestUrl</var>.</p>
    <li data-md>
     <p>If <var>magic</var> is not the following value, depending on <var>version</var>, return
"<a data-link-type="dfn" href="#signed-exchange-report-parse_error" id="ref-for-signed-exchange-report-parse_error②">parse_error</a>":</p>
     <dl class="switch">
      <dt data-md><code>b2</code>
      <dd data-md>
       <p><code>`sxg1-b2\0`</code></p>
      <dt data-md><code>b3</code>
      <dd data-md>
       <p><code>`sxg1-b3\0`</code></p>
     </dl>
    <li data-md>
     <p class="assertion">Assert: <var>requestUrlBytes</var> should match the result of <a data-link-type="dfn" href="#extracting-the-fallback-url" id="ref-for-extracting-the-fallback-url①">extracting the
fallback URL</a> from <var>response</var>.</p>
    <li data-md>
     <p>Let <var>encodedSigLength</var> be the result of <a data-link-type="dfn" href="#read-buffer-read" id="ref-for-read-buffer-read">reading</a> 3 bytes from <var>stream</var>.</p>
    <li data-md>
     <p>Let <var>encodedHeaderLength</var> be the result of <a data-link-type="dfn" href="#read-buffer-read" id="ref-for-read-buffer-read①">reading</a> 3 bytes
from <var>stream</var>.</p>
    <li data-md>
     <p>If <var>encodedSigLength</var> or <var>encodedHeaderLength</var> is a failure, return
"<a data-link-type="dfn" href="#signed-exchange-report-parse_error" id="ref-for-signed-exchange-report-parse_error③">parse_error</a>".</p>
    <li data-md>
     <p>Let <var>sigLength</var> be the result of decoding <var>encodedSigLength</var> as a big-endian
integer.</p>
    <li data-md>
     <p>Let <var>headerLength</var> be the result of decoding <var>encodedHeaderLength</var> as a
big-endian integer.</p>
    <li data-md>
     <p>If <var>sigLength</var> > 16384 or <var>headerLength</var> > 524288, return
"<a data-link-type="dfn" href="#signed-exchange-report-parse_error" id="ref-for-signed-exchange-report-parse_error④">parse_error</a>".</p>
    <li data-md>
     <p>Let <var>signature</var> be the result of <a data-link-type="dfn" href="#read-buffer-read" id="ref-for-read-buffer-read②">reading</a> <var>sigLength</var> bytes
from <var>stream</var>.</p>
    <li data-md>
     <p>If <var>signature</var> is a failure, return "<a data-link-type="dfn" href="#signed-exchange-report-parse_error" id="ref-for-signed-exchange-report-parse_error⑤">parse_error</a>".</p>
    <li data-md>
     <p>Let <var>parsedSignature</var> be the result of <a data-link-type="dfn" href="#parsing-the-signature-header-field" id="ref-for-parsing-the-signature-header-field">parsing the Signature header field</a> <var>signature</var> in the context of <var>client</var> reporting to with <var>report</var>.</p>
    <li data-md>
     <p>If <var>parsedSignature</var> is not an <a data-link-type="dfn" href="#exchange-signature" id="ref-for-exchange-signature⑦">exchange signature</a>, return it.</p>
    <li data-md>
     <p>Let <var>headerBytes</var> be the result of <a data-link-type="dfn" href="#read-buffer-read" id="ref-for-read-buffer-read③">reading</a> <var>headerLength</var> bytes from <var>stream</var>.</p>
    <li data-md>
     <p>If <var>headerBytes</var> is a failure, return
"<a data-link-type="dfn" href="#signed-exchange-report-parse_error" id="ref-for-signed-exchange-report-parse_error⑥">parse_error</a>".</p>
    <li data-md>
     <p>If <var>parsedSignature</var> <a data-link-type="dfn" href="#exchange-signature-is-valid" id="ref-for-exchange-signature-is-valid">is not valid</a> for <var>headerBytes</var> and <var>requestUrlBytes</var>, and signed exchange version <var>version</var>, return
"<a data-link-type="dfn" href="#signed-exchange-report-signature_verification_error" id="ref-for-signed-exchange-report-signature_verification_error">signature_verification_error</a>".</p>
    <li data-md>
     <p>Let <var>parsedExchange</var> be, if <var>version</var> is:</p>
     <dl class="switch">
      <dt data-md><code>b2</code>
      <dd data-md>
       <p>the result of <a data-link-type="dfn" href="#parsing-b2-cbor-headers" id="ref-for-parsing-b2-cbor-headers">parsing b2 CBOR headers</a> given <var>headerBytes</var> and <var>requestUrl</var>.</p>
      <dt data-md><code>b3</code>
      <dd data-md>
       <p>the result of <a data-link-type="dfn" href="#parsing-b3-cbor-headers" id="ref-for-parsing-b3-cbor-headers">parsing b3 CBOR headers</a> given <var>headerBytes</var> and <var>requestUrl</var>.</p>
     </dl>
    <li data-md>
     <p>If <var>parsedSignature</var> <a data-link-type="dfn" href="#exchange-signature-establishes-cross-origin-trust" id="ref-for-exchange-signature-establishes-cross-origin-trust">does not establish cross-origin
trust</a> for <var>parsedExchange</var>, return
"<a data-link-type="dfn" href="#signed-exchange-report-cert_verification_error" id="ref-for-signed-exchange-report-cert_verification_error">cert_verification_error</a>".</p>
    <li data-md>
     <p>Set <var>parsedExchange</var>’s <a data-link-type="dfn" href="#exchange-response" id="ref-for-exchange-response④">response</a>'s <a data-link-type="dfn">HTTPS state</a> to
either "<code>deprecated</code>" or "<code>modern</code>".</p>
     <p class="note" role="note"><span>Note:</span> See <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-http-network-fetch" id="ref-for-concept-http-network-fetch">HTTP-network fetch</a> for details of this choice.</p>
    <li data-md>
     <p>If <var>parsedExchange</var>’s <a data-link-type="dfn" href="#exchange-response" id="ref-for-exchange-response⑤">response</a>'s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-status" id="ref-for-concept-response-status①">status</a> is a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#redirect-status" id="ref-for-redirect-status①">redirect status</a> or the <a data-link-type="dfn" href="#signed-exchange-version" id="ref-for-signed-exchange-version③">signed exchange version</a> of <var>parsedExchange</var>’s <a data-link-type="dfn" href="#exchange-response" id="ref-for-exchange-response⑥">response</a> is not undefined, return
"<a data-link-type="dfn" href="#signed-exchange-report-parse_error" id="ref-for-signed-exchange-report-parse_error⑦">parse_error</a>".</p>
     <p class="note" role="note"><span>Note:</span> This might simplify the UA’s implementation, since it doesn’t have to
handle nested signed exchanges.</p>
    <li data-md>
     <p><a data-link-type="dfn" href="#reading-a-body" id="ref-for-reading-a-body">Read a body</a> from <var>stream</var> into <var>parsedExchange</var>’s <a data-link-type="dfn" href="#exchange-response" id="ref-for-exchange-response⑦">response</a> using <var>parsedSignature</var> to check its integrity. If
this returns an error string, return it.</p>
     <p class="note" role="note"><span>Note:</span> Typically this body’s stream is still being enqueued to after
returning.</p>
    <li data-md>
     <p>Return <var>parsedExchange</var>.</p>
   </ol>
   <h3 class="heading settled algorithm" data-algorithm="Parsing the invariant prefix" data-level="4.4" id="parsing-prefix"><span class="secno">4.4. </span><span class="content">Parsing the invariant prefix</span><a class="self-link" href="#parsing-prefix"></a></h3>
   <p>All signed exchange versions start with the same initial bytes, parsed by this
section.</p>
   <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="parsing-the-invariant-prefix">Parsing the invariant prefix</dfn> from a <a data-link-type="dfn" href="#read-buffer" id="ref-for-read-buffer⑥">read buffer</a> <var>stream</var> returns
a failure or the triple of a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte-sequence" id="ref-for-byte-sequence⑧">byte sequence</a> <var>magic</var>, <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte-sequence" id="ref-for-byte-sequence⑨">byte sequence</a> <var>fallbackUrlBytes</var>, and <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url" id="ref-for-concept-url④">URL</a> <var>fallbackUrl</var>, as described by the following
steps:</p>
   <ol>
    <li data-md>
     <p class="assertion">Assert: This algorithm is running <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel" id="ref-for-in-parallel③">in parallel</a>.</p>
    <li data-md>
     <p>Let <var>magic</var> be the result of <a data-link-type="dfn" href="#read-buffer-read" id="ref-for-read-buffer-read④">reading</a> 8 bytes from <var>stream</var>.</p>
    <li data-md>
     <p>If <var>magic</var> is a failure, return it.</p>
    <li data-md>
     <p>Let <var>encodedFallbackUrlLength</var> be the result of <a data-link-type="dfn" href="#read-buffer-read" id="ref-for-read-buffer-read⑤">reading</a> 2
bytes from <var>stream</var>.</p>
    <li data-md>
     <p>If <var>encodedFallbackUrlLength</var> is a failure, return it.</p>
    <li data-md>
     <p>Let <var>fallbackUrlLength</var> be the result of decoding <var>encodedFallbackUrlLength</var> as a big-endian integer.</p>
    <li data-md>
     <p>Let <var>fallbackUrlBytes</var> be the result of <a data-link-type="dfn" href="#read-buffer-read" id="ref-for-read-buffer-read⑥">reading</a> <var>fallbackUrlLength</var> bytes from <var>stream</var>.</p>
    <li data-md>
     <p>If <var>fallbackUrlBytes</var> is a failure, return it.</p>
    <li data-md>
     <p>Let <var>fallbackUrlString</var> be the result of <a data-link-type="dfn" href="https://encoding.spec.whatwg.org/#utf-8-decode-without-bom-or-fail" id="ref-for-utf-8-decode-without-bom-or-fail">UTF-8 decode without BOM or fail</a> on <var>fallbackUrlBytes</var>.</p>
    <li data-md>
     <p>If <var>fallbackUrlString</var> is a failure, return it.</p>
    <li data-md>
     <p>Let <var>fallbackUrl</var> be the result of running the <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-parser" id="ref-for-concept-url-parser">URL parser</a> on <var>fallbackUrlString</var>.</p>
    <li data-md>
     <p>If <var>fallbackUrl</var> is a failure, if it has a non-null <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-fragment" id="ref-for-concept-url-fragment">fragment</a>, or if
its <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-scheme" id="ref-for-concept-url-scheme">scheme</a> is something other than <code>"https"</code>, return a failure.</p>
    <li data-md>
     <p>Return (<var>magic</var>, <var>fallbackUrlBytes</var>, <var>fallbackUrl</var>).</p>
   </ol>
   <h3 class="heading settled algorithm" data-algorithm="Parsing a Signature Header Field" data-level="4.5" id="parsing-signature"><span class="secno">4.5. </span><span class="content">Parsing a Signature Header Field</span><a class="self-link" href="#parsing-signature"></a></h3>
   <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="parsing-the-signature-header-field">Parsing the Signature header field</dfn> <var>signatureString</var> in the context
of an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object" id="ref-for-environment-settings-object①">environment settings object</a> <var>client</var>, reporting to a <a data-link-type="dfn" href="#signed-exchange-report" id="ref-for-signed-exchange-report①">signed exchange report</a> <var>report</var>, returns an <a data-link-type="dfn" href="#exchange-signature" id="ref-for-exchange-signature①">exchange signature</a> or
a string which indicates a <a data-link-type="dfn" href="#signed-exchange-report-result" id="ref-for-signed-exchange-report-result①">result</a>, as described by
the following steps:</p>
   <ol>
    <li data-md>
     <p class="assertion">Assert: This algorithm is running <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel" id="ref-for-in-parallel④">in parallel</a>.</p>
    <li data-md>
     <p>If <var>signatureString</var> contains any bytes that aren’t <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ascii-byte" id="ref-for-ascii-byte">ASCII bytes</a>, return
"<a data-link-type="dfn" href="#signed-exchange-report-parse_error" id="ref-for-signed-exchange-report-parse_error⑧">parse_error</a>".</p>
    <li data-md>
     <p>Let <var>parsed</var> be the result of <a data-link-type="dfn" href="https://tools.ietf.org/html/draft-ietf-httpbis-header-structure-07#section-4.2" id="ref-for-section-4.2①">Parsing HTTP1 Header Fields into Structured
Headers</a> given an <var>input_string</var> of the <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ascii-decode" id="ref-for-ascii-decode">ASCII decoding</a> of <var>signatureString</var> and a <var>header_type</var> of "param-list".</p>
    <li data-md>
     <p>If <var>parsed</var> has more than one element, "<a data-link-type="dfn" href="#signed-exchange-report-parse_error" id="ref-for-signed-exchange-report-parse_error⑨">parse_error</a>".</p>
     <p class="note" role="note"><span>Note:</span> This limitation of current implementations will go away in the future.</p>
    <li data-md>
     <p>If any of the parameters of <var>parsed</var>[0] listed here doesn’t have the
associated type, "<a data-link-type="dfn" href="#signed-exchange-report-parse_error" id="ref-for-signed-exchange-report-parse_error①⓪">parse_error</a>".</p>
     <dl>
      <dt data-md>Byte sequence
      <dd data-md>
       <p>"sig", "cert-sha256"</p>
      <dt data-md>String
      <dd data-md>
       <p>"integrity", "cert-url", "validity-url"</p>
      <dt data-md>Integer
      <dd data-md>
       <p>"date", "expires"</p>
     </dl>
    <li data-md>
     <p>Let <var>result</var> be a new <a data-link-type="dfn" href="#exchange-signature" id="ref-for-exchange-signature②">exchange signature</a> struct.</p>
    <li data-md>
     <p>Set <var>result</var>’s <a data-link-type="dfn" href="#exchange-signature-signature" id="ref-for-exchange-signature-signature①">signature</a> to the "sig" parameter of <var>parsed</var>[0].</p>
    <li data-md>
     <p>Set <var>result</var>’s <a data-link-type="dfn" href="#exchange-signature-integrity-header" id="ref-for-exchange-signature-integrity-header">integrity header</a> to the result of <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#strictly-split" id="ref-for-strictly-split">strictly splitting</a> the "integrity" parameter of <var>parsed</var>[0] on U+002F
(<code>/</code>).</p>
    <li data-md>
     <p>Let <var>certUrl</var> be the result of running the <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-parser" id="ref-for-concept-url-parser①">URL parser</a> on the "cert-url"
parameter of <var>parsed</var>[0].</p>
    <li data-md>
     <p>Append <var>certUrl</var> to <var>report</var>’s <a data-link-type="dfn" href="#signed-exchange-report-cert-url-list" id="ref-for-signed-exchange-report-cert-url-list①">cert URL list</a>.</p>
    <li data-md>
     <p>If <var>certUrl</var> is a failure, if it has a non-null <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-fragment" id="ref-for-concept-url-fragment①">fragment</a>, or if its <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-scheme" id="ref-for-concept-url-scheme①">scheme</a> is something other than <code>"https"</code> or <code>"data"</code>, return
"<a data-link-type="dfn" href="#signed-exchange-report-parse_error" id="ref-for-signed-exchange-report-parse_error①①">parse_error</a>".</p>
    <li data-md>
     <p>Set <var>result</var>’s <a data-link-type="dfn" href="#exchange-signature-certsha256" id="ref-for-exchange-signature-certsha256">certSha256</a> to the "cert-sha256"
parameter of <var>parsed</var>[0].</p>
    <li data-md>
     <p>Set <var>result</var>’s <a data-link-type="dfn" href="#exchange-signature-validityurlbytes" id="ref-for-exchange-signature-validityurlbytes">validityUrlBytes</a> to the <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ascii-encode" id="ref-for-ascii-encode①">ASCII
encoding</a> of the "validity-url" parameter of <var>parsed</var>[0].</p>
    <li data-md>
     <p>Let <var>validityUrl</var> be the result of running the <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-parser" id="ref-for-concept-url-parser②">URL parser</a> on the
"validity-url" parameter of <var>parsed</var>[0]..</p>
    <li data-md>
     <p>If <var>validityUrl</var> is a failure, if it has a non-null <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-fragment" id="ref-for-concept-url-fragment②">fragment</a>, or if
its <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-scheme" id="ref-for-concept-url-scheme②">scheme</a> is something other than <code>"https"</code>, return
"<a data-link-type="dfn" href="#signed-exchange-report-parse_error" id="ref-for-signed-exchange-report-parse_error①②">parse_error</a>".</p>
    <li data-md>
     <p>Set <var>result</var>’s <a data-link-type="dfn" href="#exchange-signature-validityurl" id="ref-for-exchange-signature-validityurl①">validityUrl</a> to <var>validityUrl</var>.</p>
    <li data-md>
     <p>Set <var>result</var>’s <a data-link-type="dfn" href="#exchange-signature-date" id="ref-for-exchange-signature-date">date</a> to the "date" parameter of <var>parsed</var>[0].</p>
    <li data-md>
     <p>Set <var>result</var>’s <a data-link-type="dfn" href="#exchange-signature-expiration-time" id="ref-for-exchange-signature-expiration-time①">expiration time</a> to the "expires"
parameter of <var>parsed</var>[0].</p>
    <li data-md>
     <p>If <var>result</var>’s <a data-link-type="dfn" href="#exchange-signature-expiration-time" id="ref-for-exchange-signature-expiration-time②">expiration time</a> or <var>result</var>’s <a data-link-type="dfn" href="#exchange-signature-date" id="ref-for-exchange-signature-date①">date</a> is less than 0 or greater than 2<sup>63</sup>-1, return
"<a data-link-type="dfn" href="#signed-exchange-report-parse_error" id="ref-for-signed-exchange-report-parse_error①③">parse_error</a>".</p>
    <li data-md>
     <p>If <var>result</var>’s <a data-link-type="dfn" href="#exchange-signature-expiration-time" id="ref-for-exchange-signature-expiration-time③">expiration time</a> &lt;= <var>result</var>’s <a data-link-type="dfn" href="#exchange-signature-date" id="ref-for-exchange-signature-date②">date</a>, return
"<a data-link-type="dfn" href="#signed-exchange-report-parse_error" id="ref-for-signed-exchange-report-parse_error①④">parse_error</a>".</p>
    <li data-md>
     <p>Set <var>result</var>’s <a data-link-type="dfn" href="#exchange-signature-certificate-chain" id="ref-for-exchange-signature-certificate-chain①">certificate chain</a> to the result of <a data-link-type="dfn" href="#handling-the-certificate-reference" id="ref-for-handling-the-certificate-reference">handling the certificate reference</a> <var>certUrl</var> with a hash of <var>result</var>’s <a data-link-type="dfn" href="#exchange-signature-certsha256" id="ref-for-exchange-signature-certsha256①">certSha256</a> and <var>report</var> in the context of <var>client</var>.
If this is not a <a data-link-type="dfn" href="#certificate-chain" id="ref-for-certificate-chain①">certificate chain</a>, return it.</p>
    <li data-md>
     <p>Return <var>result</var>.</p>
   </ol>
   <h4 class="heading settled algorithm" data-algorithm="Handling the certificate reference" data-level="4.5.1" id="handling-cert-url"><span class="secno">4.5.1. </span><span class="content">Handling the certificate reference</span><a class="self-link" href="#handling-cert-url"></a></h4>
   <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="handling-the-certificate-reference">Handling the certificate reference</dfn> <var>certUrl</var> with the SHA-256 hash <var>certSha256</var> in the context of an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object" id="ref-for-environment-settings-object②">environment settings object</a> <var>client</var>,
reporting to a <a data-link-type="dfn" href="#signed-exchange-report" id="ref-for-signed-exchange-report②">signed exchange report</a> <var>report</var>, returns a <a data-link-type="dfn" href="#certificate-chain" id="ref-for-certificate-chain②">certificate chain</a> or a string which indicates a <a data-link-type="dfn" href="#signed-exchange-report-result" id="ref-for-signed-exchange-report-result②">result</a>, as described by the following steps:</p>
   <ol>
    <li data-md>
     <p class="assertion">Assert: This algorithm is running <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel" id="ref-for-in-parallel⑤">in parallel</a>.</p>
    <li data-md>
     <p>Let <var>certRequest</var> be a new <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request" id="ref-for-concept-request②">request</a> with the following items:</p>
     <dl>
      <dt data-md><a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-url" id="ref-for-concept-request-url">url</a>
      <dd data-md>
       <p><var>certUrl</var></p>
      <dt data-md><a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-header-list" id="ref-for-concept-request-header-list">header list</a>
      <dd data-md>
       <p>«<code>`Accept`</code>: <code>`application/cert-chain+cbor`</code>»</p>
      <dt data-md><a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-client" id="ref-for-concept-request-client①">client</a>
      <dd data-md>
       <p><var>client</var></p>
      <dt data-md><a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#request-service-workers-mode" id="ref-for-request-service-workers-mode">service-workers mode</a>
      <dd data-md>
       <p>"<code>none</code>"</p>
      <dt data-md><a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-mode" id="ref-for-concept-request-mode">mode</a>
      <dd data-md>
       <p>"<code>cors</code>"</p>
     </dl>
    <li data-md>
     <p>Let <var>certResponse</var> be the result of <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-fetch" id="ref-for-concept-fetch">fetching</a> <var>certRequest</var>.</p>
    <li data-md>
     <p>Append the IP address of the server from which the user agent received the <var>certResponse</var> to <var>report</var>’s <a data-link-type="dfn" href="#signed-exchange-report-cert-server-ip-list" id="ref-for-signed-exchange-report-cert-server-ip-list">cert server IP list</a>,
if available.</p>
    <li data-md>
     <p>If <var>certResponse</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-status" id="ref-for-concept-response-status②">status</a> is not <code>200</code>, return
"<a data-link-type="dfn" href="#signed-exchange-report-cert_fetch_error" id="ref-for-signed-exchange-report-cert_fetch_error">cert_fetch_error</a>".</p>
    <li data-md>
     <p>Let <var>certMimeType</var> be the result of <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-header-extract-mime-type" id="ref-for-concept-header-extract-mime-type①">extracting a MIME type</a> from <var>certResponse</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-header-list" id="ref-for-concept-response-header-list③">header list</a>.</p>
    <li data-md>
     <p>If <var>certMimeType</var> is a failure or its <a data-link-type="dfn" href="https://mimesniff.spec.whatwg.org/#mime-type-essence" id="ref-for-mime-type-essence①">essence</a> is not <code>"application/cert-chain+cbor"</code>, return
"<a data-link-type="dfn" href="#signed-exchange-report-cert_fetch_error" id="ref-for-signed-exchange-report-cert_fetch_error①">cert_fetch_error</a>".</p>
    <li data-md>
     <p>If <var>certResponse</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-body" id="ref-for-concept-response-body②">body</a> is null or that body’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-body-stream" id="ref-for-concept-body-stream②">stream</a> is null, return "<a data-link-type="dfn" href="#signed-exchange-report-cert_parse_error" id="ref-for-signed-exchange-report-cert_parse_error">cert_parse_error</a>".</p>
    <li data-md>
     <p>Let <var>bytes</var> be the result of <a data-link-type="dfn">reading all
bytes</a> from <var>certResponse</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-body" id="ref-for-concept-response-body③">body</a>'s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-body-stream" id="ref-for-concept-body-stream③">stream</a> with a <a data-link-type="dfn" href="https://streams.spec.whatwg.org/#readablestream-get-a-reader" id="ref-for-readablestream-get-a-reader">new reader</a> over the same stream.</p>
    <li data-md>
     <p>Wait for <var>bytes</var> to settle.</p>
    <li data-md>
     <p>If <var>bytes</var> was rejected, return "<a data-link-type="dfn" href="#signed-exchange-report-cert_parse_error" id="ref-for-signed-exchange-report-cert_parse_error①">cert_parse_error</a>".</p>
    <li data-md>
     <p>Let <var>chain</var> be the <a data-link-type="dfn" href="#certificate-chain" id="ref-for-certificate-chain③">certificate chain</a> produced by parsing <var>bytes</var>’ value
using the <a data-link-type="dfn" href="https://tools.ietf.org/html/draft-yasskin-httpbis-origin-signed-exchanges-impl-02#section-3.3" id="ref-for-section-3.3①">cert-chain CDDL</a>. If <var>bytes</var>’s value doesn’t match this CDDL or
isn’t <a data-link-type="dfn" href="https://tools.ietf.org/html/draft-yasskin-httpbis-origin-signed-exchanges-impl-02#section-3.4" id="ref-for-section-3.4">canonically-encoded CBOR</a>, return
 "<a data-link-type="dfn" href="#signed-exchange-report-cert_parse_error" id="ref-for-signed-exchange-report-cert_parse_error②">cert_parse_error</a>".</p>
    <li data-md>
     <p class="assertion">Assert: <var>chain</var> has at least one <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-item" id="ref-for-list-item①">item</a>.</p>
    <li data-md>
     <p>If the <a data-link-type="dfn" href="http://csrc.nist.gov/publications/fips/fips180-4/fips-180-4.pdf#" id="termref-for-①">SHA-256</a> hash of <var>chain</var>’s <a data-link-type="dfn" href="#certificate-chain-leaf" id="ref-for-certificate-chain-leaf③">leaf</a>'s <a data-link-type="dfn" href="#augmented-certificate-certificate" id="ref-for-augmented-certificate-certificate④">certificate</a> is not equal to <var>certSha256</var>, return
 "<a data-link-type="dfn" href="#signed-exchange-report-signature_verification_error" id="ref-for-signed-exchange-report-signature_verification_error①">signature_verification_error</a>".</p>
    <li data-md>
     <p>Return <var>chain</var>.</p>
   </ol>
   <h3 class="heading settled algorithm" data-algorithm="The signed message" data-level="4.6" id="the-signed-message"><span class="secno">4.6. </span><span class="content">The signed message</span><a class="self-link" href="#the-signed-message"></a></h3>
   <p>The <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="signed-message">signed message</dfn> for a version <var>version</var>, an <a data-link-type="dfn" href="#exchange-signature" id="ref-for-exchange-signature③">exchange signature</a> <var>signature</var> and <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte-sequence" id="ref-for-byte-sequence①⓪">byte sequences</a> <var>requestUrlBytes</var> and <var>headerBytes</var> is the
concatenation of the following <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte-sequence" id="ref-for-byte-sequence①①">byte sequences</a>:</p>
   <ol>
    <li data-md>
     <p>The byte 0x20 (SP) repeated 64 times. This matches the TLS 1.3 (<a data-link-type="biblio" href="#biblio-rfc8446">[RFC8446]</a>)
format to avoid cross- protocol attacks if anyone uses the same key in a TLS
certificate and an exchange-signing certificate.</p>
    <li data-md>
     <p>A context string consisting of, if <var>version</var> is:</p>
     <dl class="switch">
      <dt data-md><code>b2</code>
      <dd data-md>
       <p><code>`HTTP Exchange 1 b2`</code></p>
      <dt data-md><code>b3</code>
      <dd data-md>
       <p><code>`HTTP Exchange 1 b3`</code></p>
     </dl>
     <p class="note" role="note"><span>Note:</span> Each draft of <a data-link-type="biblio" href="#biblio-draft-yasskin-httpbis-origin-signed-exchanges-impl-02">[draft-yasskin-httpbis-origin-signed-exchanges-impl-02]</a> and the final RFC
for <a data-link-type="biblio" href="#biblio-draft-yasskin-http-origin-signed-responses">[draft-yasskin-http-origin-signed-responses]</a> will use distinct context
strings.</p>
    <li data-md>
     <p>A single 0x00 byte which serves as a separator.</p>
    <li data-md>
     <p>A single 0x20 (SP) byte, representing the length of the next field.</p>
    <li data-md>
     <p><var>signature</var>’s <a data-link-type="dfn" href="#exchange-signature-certsha256" id="ref-for-exchange-signature-certsha256②">certSha256</a>.</p>
    <li data-md>
     <p>The 8-byte big-endian encoding of the length in bytes of <var>signature</var>’s <a data-link-type="dfn" href="#exchange-signature-validityurlbytes" id="ref-for-exchange-signature-validityurlbytes①">validityUrlBytes</a>.</p>
    <li data-md>
     <p><var>signature</var>’s <a data-link-type="dfn" href="#exchange-signature-validityurlbytes" id="ref-for-exchange-signature-validityurlbytes②">validityUrlBytes</a>.</p>
    <li data-md>
     <p>The 8-byte big-endian encoding of <var>signature</var>’s <a data-link-type="dfn" href="#exchange-signature-date" id="ref-for-exchange-signature-date③">date</a>.</p>
    <li data-md>
     <p>The 8-byte big-endian encoding of <var>signature</var>’s <a data-link-type="dfn" href="#exchange-signature-expiration-time" id="ref-for-exchange-signature-expiration-time④">expiration time</a>.</p>
    <li data-md>
     <p>The 8-byte big-endian encoding of the length in bytes of <var>requestUrlBytes</var>.</p>
    <li data-md>
     <p><var>requestUrlBytes</var>.</p>
    <li data-md>
     <p>The 8-byte big-endian encoding of the length in bytes of <var>headerBytes</var>.</p>
    <li data-md>
     <p><var>headerBytes</var>.</p>
   </ol>
   <h3 class="heading settled algorithm" data-algorithm="Validating a signature" data-level="4.7" id="validating-signature"><span class="secno">4.7. </span><span class="content">Validating a signature</span><a class="self-link" href="#validating-signature"></a></h3>
   <p>An <a data-link-type="dfn" href="#exchange-signature" id="ref-for-exchange-signature④">exchange signature</a> <var>signature</var> <dfn class="dfn-paneled" data-dfn-for="exchange signature" data-dfn-type="dfn" data-lt="is
valid|is not valid" data-noexport id="exchange-signature-is-valid">is valid</dfn> for <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte-sequence" id="ref-for-byte-sequence①②">byte sequences</a> <var>requestUrlBytes</var> and <var>headerBytes</var>, and signed exchange version <var>version</var>, if the following steps
return <code>valid</code>:</p>
   <ol>
    <li data-md>
     <p>Let <var>clockSkew</var> be the uncertainty in the UA’s estimate of the current time
caused by clock skew on the client. The UA MAY set this to 0 or use a more
sophisticated estimate.</p>
    <li data-md>
     <p>If the UA’s estimate of the current time is more than <var>clockSkew</var> before <var>signature</var>’s <a data-link-type="dfn" href="#exchange-signature-date" id="ref-for-exchange-signature-date④">date</a>, return "untrusted".</p>
     <p class="note" role="note"><span>Note:</span> We take estimated clock skew into account when checking the
signature’s <a data-link-type="dfn" href="#exchange-signature-date" id="ref-for-exchange-signature-date⑤">date</a> because we want well-behaved servers
to use the time they created the signature, but if they immediately start
serving that signature, and skewed clients don’t try to correct for their
skew, those clients will reject the signature.</p>
     <p class="issue" id="issue-a7ea6416"><a class="self-link" href="#issue-a7ea6416"></a> Our security reviewers aren’t sure we should
allow UAs to take clock skew into account. <a href="https://github.com/WICG/webpackage/issues/141">&lt;https://github.com/WICG/webpackage/issues/141></a></p>
    <li data-md>
     <p>If the UA’s estimate of the current time is after <var>signature</var>’s <a data-link-type="dfn" href="#exchange-signature-expiration-time" id="ref-for-exchange-signature-expiration-time⑤">expiration time</a>, return "untrusted".</p>
     <p class="note" role="note"><span>Note:</span> We use the client’s best guess of the current time to check the <a data-link-type="dfn" href="#exchange-signature-expiration-time" id="ref-for-exchange-signature-expiration-time⑥">expiration time</a> so that attackers trying to get an
exchange trusted for longer, are constrained to modify the client’s clock
and can’t also attack its estimate of its skew.</p>
    <li data-md>
     <p>Let <var>message</var> be the <a data-link-type="dfn" href="#signed-message" id="ref-for-signed-message">signed message</a> for <var>version</var>, <var>signature</var>, <var>requestUrlBytes</var>, and <var>headerBytes</var>.</p>
    <li data-md>
     <p>Let <var>publicKey</var> be the <a data-link-type="dfn" href="#certificate-public-key" id="ref-for-certificate-public-key①">public key</a> of <var>parsedSignature</var>’s <a data-link-type="dfn" href="#exchange-signature-certificate-chain" id="ref-for-exchange-signature-certificate-chain②">certificate chain</a>'s <a data-link-type="dfn" href="#certificate-chain-leaf" id="ref-for-certificate-chain-leaf④">leaf</a>. If
the certificate can’t be parsed enough to find this public key, return <code>invalid</code>.</p>
    <li data-md>
     <p>If <var>publicKey</var>’s <a data-link-type="dfn" href="#public-key-algorithm" id="ref-for-public-key-algorithm">algorithm</a> is not <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc5480#section-2.1.1" id="ref-for-section-2.1.1">id-ecPublicKey</a> on the <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc5480#section-2.1.1.1" id="ref-for-section-2.1.1.1">secp256r1</a> named curve, return <code>invalid</code>.</p>
    <li data-md>
     <p>If <var>parsedSignature</var>’s <a data-link-type="dfn" href="#exchange-signature-signature" id="ref-for-exchange-signature-signature②">signature</a> is not a valid
signature of <var>message</var> by <var>publicKey</var> using the <a data-link-type="dfn" href="https://tools.ietf.org/html/draft-ietf-tls-tls13-28#section-4.2.3" id="ref-for-section-4.2.3">ecdsa_secp256r1_sha256</a> algorithm, return <code>invalid</code>.</p>
    <li data-md>
     <p>Return <code>valid</code>.</p>
   </ol>
   <h3 class="heading settled algorithm" data-algorithm="Cross-origin trust" data-level="4.8" id="cross-origin-trust"><span class="secno">4.8. </span><span class="content">Cross-origin trust</span><a class="self-link" href="#cross-origin-trust"></a></h3>
   <p>A <a data-link-type="dfn" href="#exchange-signature-is-valid" id="ref-for-exchange-signature-is-valid①">valid</a> <a data-link-type="dfn" href="#exchange-signature" id="ref-for-exchange-signature⑤">exchange signature</a> <var>signature</var> <dfn class="dfn-paneled" data-dfn-for="exchange signature" data-dfn-type="dfn" data-lt="establishes cross-origin trust|does not establish
cross-origin trust" data-noexport id="exchange-signature-establishes-cross-origin-trust">establishes cross-origin trust</dfn> in an <a data-link-type="dfn" href="#exchange" id="ref-for-exchange③">exchange</a> <var>exchange</var> if the following steps return "trusted":</p>
   <ol>
    <li data-md>
     <p>Let <var>requestUrl</var> be <var>exchange</var>’s <a data-link-type="dfn" href="#exchange-request-url" id="ref-for-exchange-request-url③">request URL</a>.</p>
    <li data-md>
     <p>If <var>signature</var>’s <a data-link-type="dfn" href="#exchange-signature-validityurl" id="ref-for-exchange-signature-validityurl②">validityUrl</a>'s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-origin" id="ref-for-concept-url-origin①">origin</a> is not <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/origin.html#same-origin" id="ref-for-same-origin">same origin</a> with <var>requestUrl</var>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-origin" id="ref-for-concept-url-origin②">origin</a>, return "untrusted".</p>
    <li data-md>
     <p>If <var>exchange</var>’s <a data-link-type="dfn" href="#exchange-response" id="ref-for-exchange-response⑧">response</a>'s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-header-list" id="ref-for-concept-response-header-list④">header list</a> includes an <a data-link-type="dfn" href="https://wicg.github.io/webpackage/draft-yasskin-http-origin-signed-responses.html#uncached-headers" id="ref-for-uncached-headers">uncached response header</a>, return "untrusted".</p>
    <li data-md>
     <p>If <var>signature</var>’s <a data-link-type="dfn" href="#exchange-signature-expiration-time" id="ref-for-exchange-signature-expiration-time⑦">expiration time</a> is more than 604800
seconds (7 days) after <var>signature</var>’s <a data-link-type="dfn" href="#exchange-signature-date" id="ref-for-exchange-signature-date⑥">date</a>, return
"untrusted".</p>
    <li data-md>
     <p>If <var>signature</var>’s <a data-link-type="dfn" href="#exchange-signature-certificate-chain" id="ref-for-exchange-signature-certificate-chain③">certificate chain</a> <a data-link-type="dfn" href="#certificate-chain-has-a-trusted-leaf" id="ref-for-certificate-chain-has-a-trusted-leaf">does not have a trusted leaf</a> for <var>requestUrl</var>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-origin" id="ref-for-concept-url-origin③">origin</a>,
return "untrusted".</p>
    <li data-md>
     <p>Return "trusted".</p>
   </ol>
   <h3 class="heading settled algorithm" data-algorithm="Establishing trust in a certificate" data-level="4.9" id="trusting-certificate"><span class="secno">4.9. </span><span class="content">Establishing trust in a certificate</span><a class="self-link" href="#trusting-certificate"></a></h3>
   <p>The <a data-link-type="dfn" href="#certificate-chain" id="ref-for-certificate-chain④">certificate chain</a> <var>chain</var> <dfn class="dfn-paneled" data-dfn-for="certificate chain" data-dfn-type="dfn" data-lt="has a trusted
leaf|does not have a trusted leaf" data-noexport id="certificate-chain-has-a-trusted-leaf">has a trusted leaf</dfn> for an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/origin.html#concept-origin" id="ref-for-concept-origin">origin</a> <var>origin</var> if the following steps return <code>trusted</code>:</p>
   <ol>
    <li data-md>
     <p>Let <var>leaf</var> be <var>chain</var>’s <a data-link-type="dfn" href="#certificate-chain-leaf" id="ref-for-certificate-chain-leaf⑤">leaf</a>.</p>
    <li data-md>
     <p>Attempt to build a trustworthy path from <var>leaf</var>’s <a data-link-type="dfn" href="#augmented-certificate-certificate" id="ref-for-augmented-certificate-certificate⑤">certificate</a> to a trusted root with</p>
     <ul>
      <li data-md>
       <p><var>chain</var>,</p>
      <li data-md>
       <p><var>leaf</var>’s <a data-link-type="dfn" href="#augmented-certificate-ocsp-response" id="ref-for-augmented-certificate-ocsp-response">OCSP response</a>,</p>
      <li data-md>
       <p>any SCTs from</p>
       <ul>
        <li data-md>
         <p><var>leaf</var>’s <a data-link-type="dfn" href="#augmented-certificate-sct" id="ref-for-augmented-certificate-sct">SCT</a>.</p>
        <li data-md>
         <p>An OCSP extension in <var>leaf</var>’s <a data-link-type="dfn" href="#augmented-certificate-ocsp-response" id="ref-for-augmented-certificate-ocsp-response①">OCSP response</a>.</p>
        <li data-md>
         <p>An X.509 extension in <var>leaf</var>’s <a data-link-type="dfn" href="#augmented-certificate-certificate" id="ref-for-augmented-certificate-certificate⑥">certificate</a>.</p>
       </ul>
     </ul>
     <p>as input, using <a data-link-type="biblio" href="#biblio-rfc5280">[RFC5280]</a> and any other conventions used in making TLS
(<a data-link-type="biblio" href="#biblio-rfc8446">[RFC8446]</a>) connections. The UA SHOULD support Certificate Transparency
(<a data-link-type="biblio" href="#biblio-rfc6962">[RFC6962]</a>) for this check. (See <a href="#seccons-ct">§ 5.1 Certificate Transparency</a>.) The UA MUST check that
it has evidence the <var>leaf</var>’s <a data-link-type="dfn" href="#augmented-certificate-certificate" id="ref-for-augmented-certificate-certificate⑦">certificate</a> was not
revoked 7 or more days ago (for example using the <var>leaf</var>’s <a data-link-type="dfn" href="#augmented-certificate-ocsp-response" id="ref-for-augmented-certificate-ocsp-response②">OCSP response</a>). If no such path can be built, return <code>untrusted</code>.</p>
    <li data-md>
     <p>If <var>leaf</var>’s <a data-link-type="dfn" href="#augmented-certificate-certificate" id="ref-for-augmented-certificate-certificate⑧">certificate</a> is not trusted for <var>origin</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/origin.html#concept-origin-host" id="ref-for-concept-origin-host">host</a>, return <code>untrusted</code>.</p>
    <li data-md>
     <p>If <var>leaf</var>’s <a data-link-type="dfn" href="#certificate-extensions" id="ref-for-certificate-extensions">extensions</a> don’t map a <a data-link-type="dfn" href="https://tools.ietf.org/html/draft-yasskin-httpbis-origin-signed-exchanges-impl-02#section-4.2" id="ref-for-section-4.2②">CanSignHttpExchanges</a> OID to the ASN.1/DER encoding of NULL (0x05 0x00), return <code>untrusted</code>.</p>
    <li data-md>
     <p>Return <code>trusted</code>.</p>
   </ol>
   <h3 class="heading settled algorithm" data-algorithm="Parsing b2 CBOR headers" data-level="4.10" id="parse-b2-cbor-headers"><span class="secno">4.10. </span><span class="content">Parsing b2 CBOR headers</span><a class="self-link" href="#parse-b2-cbor-headers"></a></h3>
   <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="parsing-b2-cbor-headers">Parsing b2 CBOR headers</dfn> from a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte-sequence" id="ref-for-byte-sequence①③">byte sequence</a> <var>headerBytes</var> and
a URL <var>requestUrl</var> returns a failure or an <a data-link-type="dfn" href="#exchange" id="ref-for-exchange④">exchange</a> via the following steps:</p>
   <ol>
    <li data-md>
     <p>Let <var>headers</var> be the result of <a data-link-type="dfn" href="https://wicg.github.io/webpackage/draft-yasskin-wpack-bundled-exchanges.html#parse-known-length" id="ref-for-parse-known-length">parsing a CBOR item</a> from <var>headerBytes</var>,
matching the following CDDL rule:</p>
<pre>    headers = [
      {
        ':method': bstr,
        * bstr => bstr,
      },
      {
        ':status': bstr,
        * bstr => bstr,
      }
    ]
</pre>
    <li data-md>
     <p>If any of the following is true, return a failure:</p>
     <ul>
      <li data-md>
       <p><var>headers</var> is an error.</p>
      <li data-md>
       <p><var>headers</var>[0] contains any key starting with <code>`:`</code> that isn’t <code>`:method`</code>.</p>
      <li data-md>
       <p><var>headers</var>[0] contains a <code>`host`</code> key.</p>
      <li data-md>
       <p><var>headers</var>[0][<code>`:method`</code>] is not <code>`GET`</code>.</p>
      <li data-md>
       <p><var>headers</var>[1] contains any key starting with <code>`:`</code> that isn’t <code>`:status`</code>.</p>
      <li data-md>
       <p><var>headers</var>[1][<code>`:status`</code>] is not <code>200</code>.</p>
     </ul>
    <li data-md>
     <p>Let <var>requestHeaders</var> be the result of <a data-link-type="dfn" href="#creating-a-header-list-from-the-cbor-map" id="ref-for-creating-a-header-list-from-the-cbor-map">creating a header list from the CBOR
map</a> <var>headers</var>[0].</p>
    <li data-md>
     <p>If <var>requestHeaders</var> is a failure, return it.</p>
    <li data-md>
     <p>Let <var>responseHeaders</var> be the result of <a data-link-type="dfn" href="#creating-a-header-list-from-the-cbor-map" id="ref-for-creating-a-header-list-from-the-cbor-map①">creating a header list from the CBOR
map</a> <var>headers</var>[1].</p>
    <li data-md>
     <p>If <var>responseHeaders</var> is a failure, return it.</p>
    <li data-md>
     <p>If <var>responseHeaders</var> <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#header-list-contains" id="ref-for-header-list-contains">does not contain</a> <code>`Content-Type`</code>,
return a failure.</p>
    <li data-md>
     <p><a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-header-list-set" id="ref-for-concept-header-list-set②">Set</a> <code>`X-Content-Type-Options`</code>/<code>`nosniff`</code> in <var>responseHeaders</var>.</p>
    <li data-md>
     <p>Let <var>response</var> be a new <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response" id="ref-for-concept-response⑥">response</a> with <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-status" id="ref-for-concept-response-status③">status</a> <var>headers</var>[1][<code>`:status`</code>] and <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-header-list" id="ref-for-concept-response-header-list⑤">header list</a> <var>responseHeaders</var>.</p>
    <li data-md>
     <p>Return an <a data-link-type="dfn" href="#exchange" id="ref-for-exchange⑤">exchange</a> of <var>requestUrl</var> and <var>response</var>.</p>
     <p class="note" role="note"><span>Note:</span> This ignores <var>requestHeaders</var>, which can’t be encoded in b3 and later.</p>
   </ol>
   <h3 class="heading settled algorithm" data-algorithm="Parsing b3 CBOR headers" data-level="4.11" id="parse-cbor-headers"><span class="secno">4.11. </span><span class="content">Parsing b3 CBOR headers</span><a class="self-link" href="#parse-cbor-headers"></a></h3>
   <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="parsing-b3-cbor-headers">Parsing b3 CBOR headers</dfn> from a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte-sequence" id="ref-for-byte-sequence①④">byte sequence</a> <var>headerBytes</var> and
a URL <var>requestUrl</var> returns a failure or an <a data-link-type="dfn" href="#exchange" id="ref-for-exchange⑥">exchange</a> via the following steps:</p>
   <ol>
    <li data-md>
     <p>Let <var>headers</var> be the result of <a data-link-type="dfn" href="https://wicg.github.io/webpackage/draft-yasskin-wpack-bundled-exchanges.html#parse-known-length" id="ref-for-parse-known-length①">parsing a CBOR item</a> from <var>headerBytes</var>,
matching the following CDDL rule:</p>
<pre>    headers = {
      ':status': bstr,
      * bstr => bstr,
    }
</pre>
    <li data-md>
     <p>If any of the following is true, return a failure:</p>
     <ul>
      <li data-md>
       <p><var>headers</var> is an error.</p>
      <li data-md>
       <p><var>headers</var> contains any key starting with <code>`:`</code> that isn’t <code>`:status`</code>.</p>
      <li data-md>
       <p><var>headers</var>[<code>`:status`</code>] is not <code>200</code>.</p>
     </ul>
    <li data-md>
     <p>Let <var>responseHeaders</var> be the result of <a data-link-type="dfn" href="#creating-a-header-list-from-the-cbor-map" id="ref-for-creating-a-header-list-from-the-cbor-map②">creating a header list from the CBOR
map</a> <var>headers</var>.</p>
    <li data-md>
     <p>If <var>responseHeaders</var> is a failure, return it.</p>
    <li data-md>
     <p>Let <var>response</var> be a new <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response" id="ref-for-concept-response⑦">response</a> with <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-status" id="ref-for-concept-response-status④">status</a> <var>headers</var>[<code>`:status`</code>] and <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-header-list" id="ref-for-concept-response-header-list⑥">header list</a> <var>responseHeaders</var>.</p>
    <li data-md>
     <p>Return an <a data-link-type="dfn" href="#exchange" id="ref-for-exchange⑦">exchange</a> of <var>requestUrl</var> and <var>response</var>.</p>
   </ol>
   <h4 class="heading settled algorithm" data-algorithm="Converting a map to a header list" data-level="4.11.1" id="headers-from-map"><span class="secno">4.11.1. </span><span class="content">Converting a map to a header list</span><a class="self-link" href="#headers-from-map"></a></h4>
   <p>The result of <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="creating-a-header-list-from-the-cbor-map">creating a header list from the CBOR map</dfn> <var>map</var> is
returned by the following steps:</p>
   <ol>
    <li data-md>
     <p>Let <var>headers</var> be a new empty <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-header-list" id="ref-for-concept-header-list">header list</a>.</p>
    <li data-md>
     <p>For each <var>key</var> → <var>value</var> of <var>map</var>:</p>
     <ol>
      <li data-md>
       <p>If <var>key</var> starts with <code>`:`</code>, continue.</p>
      <li data-md>
       <p>If the <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#isomorphic-decode" id="ref-for-isomorphic-decode">isomorphic decoding</a> of <var>key</var> contains any <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ascii-upper-alpha" id="ref-for-ascii-upper-alpha">ASCII upper
alpha</a>, return a failure.</p>
      <li data-md>
       <p>If <var>key</var> doesn’t match the constraints on a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-header-name" id="ref-for-concept-header-name">name</a> or <var>value</var> doesn’t match the constraints on a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-header-value" id="ref-for-concept-header-value">value</a>, return a failure.</p>
      <li data-md>
       <p class="assertion">Assert: <var>headers</var> <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#header-list-contains" id="ref-for-header-list-contains①">does not contain</a> <var>key</var>.</p>
      <li data-md>
       <p><a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-header-list-append" id="ref-for-concept-header-list-append">Append</a> <var>key</var>/<var>value</var> to <var>headers</var>.</p>
     </ol>
    <li data-md>
     <p>Return <var>headers</var>.</p>
   </ol>
   <h3 class="heading settled algorithm" data-algorithm="Creating the response stream." data-level="4.12" id="read-a-body"><span class="secno">4.12. </span><span class="content">Creating the response stream.</span><a class="self-link" href="#read-a-body"></a></h3>
   <p>To <dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="reading a body|read a body" data-noexport id="reading-a-body">read a body</dfn> from a <a data-link-type="dfn" href="#read-buffer" id="ref-for-read-buffer①">read buffer</a> <var>stream</var> into a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response" id="ref-for-concept-response⑧">response</a> <var>response</var> using an <a data-link-type="dfn" href="#exchange-signature" id="ref-for-exchange-signature⑥">exchange signature</a> <var>signature</var> to check its integrity, the UA MUST:</p>
   <ol>
    <li data-md>
     <p>If <var>signature</var>’s <a data-link-type="dfn" href="#exchange-signature-integrity-header" id="ref-for-exchange-signature-integrity-header①">integrity header</a> is:</p>
     <dl class="switch">
      <dt data-md>«"<code>digest</code>", "<code>mi-sha256-03</code>"»
      <dd data-md>
       <ol>
        <li data-md>
         <p>Let <var>instance-digests</var> be the result of <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-header-list-get-decode-split" id="ref-for-concept-header-list-get-decode-split">getting,
decoding, and splitting</a> <code>`digest`</code> from <var>response</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-header-list" id="ref-for-concept-response-header-list⑦">header list</a>.</p>
         <p class="note" role="note"><span>Note:</span> No <a data-link-type="dfn" href="https://www.iana.org/assignments/http-dig-alg/http-dig-alg.xhtml#http-dig-alg-1" id="ref-for-http-dig-alg-1">Digest algorithm</a> uses non-ASCII characters or 0x22
(<code>"</code>), so this is equivalent to parsing from the <a data-link-type="http-header" href="https://tools.ietf.org/html/rfc3230#section-4.3.2" id="ref-for-section-4.3.2">Digest</a> ABNF <code>&lt;encoded digest output></code>.</p>
        <li data-md>
         <p>Let <var>mi</var> be the element of <var>instance-digests</var> that starts with <code>"mi-sha256-03="</code>. If there is no such element, return an error
string "<a data-link-type="dfn" href="#signed-exchange-report-invalid_integrity_header" id="ref-for-signed-exchange-report-invalid_integrity_header">invalid_integrity_header</a>".</p>
        <li data-md>
         <p>Let <var>codings</var> be the result of <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-header-list-get-decode-split" id="ref-for-concept-header-list-get-decode-split①">getting, decoding, and
splitting</a> <code>`content-encoding`</code> in <var>response</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-header-list" id="ref-for-concept-response-header-list⑧">header list</a>.</p>
        <li data-md>
         <p>If <var>codings</var> doesn’t include <code>"mi-sha256-03"</code>, return an error string
"<a data-link-type="dfn" href="#signed-exchange-report-invalid_integrity_header" id="ref-for-signed-exchange-report-invalid_integrity_header①">invalid_integrity_header</a>".</p>
        <li data-md>
         <p class="assertion">Assert: <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#handle-content-codings" id="ref-for-handle-content-codings">Handle content codings</a> used the value of <var>mi</var> as the <a data-link-type="dfn" href="https://tools.ietf.org/html/draft-thomson-http-mice-03#section-2.2" id="ref-for-section-2.2">integrity proof for the first record</a> when decoding the <code>mi-sha256-03</code> content encoding to produce the bytes in <var>stream</var>.</p>
       </ol>
      <dt data-md>Anything else
      <dd data-md>
       <p>Return an error string
"<a data-link-type="dfn" href="#signed-exchange-report-invalid_integrity_header" id="ref-for-signed-exchange-report-invalid_integrity_header②">invalid_integrity_header</a>".</p>
     </dl>
    <li data-md>
     <p>Let <var>body</var> be a new <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-body" id="ref-for-concept-body">body</a>.</p>
    <li data-md>
     <p>Let <var>cancel</var> be the following steps, taking <var>reason</var> as an argument:</p>
     <ol>
      <li data-md>
       <p><a data-link-type="dfn" href="https://streams.spec.whatwg.org/#readablestream-cancel" id="ref-for-readablestream-cancel">Cancel</a> <var>stream</var>’s <a data-link-type="dfn" href="#read-buffer-stream" id="ref-for-read-buffer-stream②">stream</a> with <var>reason</var>.</p>
     </ol>
    <li data-md>
     <p>Let <var>outputStream</var> be the result of <a data-link-type="dfn">constructing a ReadableStream</a> with <var>cancel</var>.</p>
    <li data-md>
     <p>Set <var>body</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-body-stream" id="ref-for-concept-body-stream④">stream</a> to <var>outputStream</var>.</p>
    <li data-md>
     <p>Set <var>response</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-body" id="ref-for-concept-response-body④">body</a> to <var>body</var>.</p>
    <li data-md>
     <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel" id="ref-for-in-parallel⑥">In parallel</a>:</p>
     <ol>
      <li data-md>
       <p><a data-link-type="dfn" href="#read-buffer-dump" id="ref-for-read-buffer-dump">Dump</a> <var>stream</var> to <var>outputStream</var>.</p>
     </ol>
   </ol>
   <h3 class="heading settled algorithm" data-algorithm="Request matching" data-level="4.13" id="request-matching"><span class="secno">4.13. </span><span class="content">Request matching</span><a class="self-link" href="#request-matching"></a></h3>
   <p>A <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request" id="ref-for-concept-request③">request</a> <var>browserRequest</var> <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="matches-the-stored-exchange">matches the stored exchange</dfn> <var>storedExchange</var> if the following steps return "match":</p>
   <ol>
    <li data-md>
     <p>If <var>browserRequest</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-method" id="ref-for-concept-request-method">method</a> is not <code>`GET`</code> or <code>`HEAD`</code>,
return "mismatch".</p>
     <p class="note" role="note"><span>Note:</span> The <var>browserRequest</var>’s method can be something other than <code>`GET`</code> if a Service Worker intercepts the redirect and modifies the request before
re-fetching it.</p>
    <li data-md>
     <p>If <var>browserRequest</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-url" id="ref-for-concept-request-url①">url</a> is not <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-equals" id="ref-for-concept-url-equals">equal</a> to <var>storedExchange</var>’s <a data-link-type="dfn" href="#exchange-request-url" id="ref-for-exchange-request-url④">request URL</a>, return "mismatch".</p>
    <li data-md>
     <p>If <var>storedExchange</var>’s <a data-link-type="dfn" href="#exchange-response" id="ref-for-exchange-response⑨">response</a>'s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-header-list" id="ref-for-concept-response-header-list⑨">header list</a> <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#header-list-contains" id="ref-for-header-list-contains②">contains</a>:</p>
     <dl class="switch">
      <dt data-md>Neither a <code>`Variants`</code> nor a <code>`Variant-Key`</code> header
      <dd data-md>
       <p>Return "match".</p>
       <p class="note" role="note"><span>Note:</span> This states that exactly one resource lives at the request URL, and
no content negotiation is intended.</p>
      <dt data-md>A <code>`Variant-Key`</code> header but no <code>`Variants`</code> header
      <dd data-md>
       <p>Return "mismatch".</p>
       <p class="note" role="note"><span>Note:</span> This indicates a likely misconfiguration, and returning "mismatch"
makes that fail fast.</p>
      <dt data-md>A <code>`Variants`</code> header but no <code>`Variant-Key`</code> header
      <dd data-md>
       <p>Return "mismatch".</p>
       <p class="note" role="note"><span>Note:</span> This behavior is implied by the below steps, but we make it
explicit here.</p>
      <dt data-md>Both a <code>`Variants`</code> and a <code>`Variant-Key`</code> header
      <dd data-md>
       <p>Proceed to the following steps.</p>
     </dl>
    <li data-md>
     <p>If <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-header-list-get" id="ref-for-concept-header-list-get">getting</a> <code>`Variants`</code> from <var>storedExchange</var>’s <a data-link-type="dfn" href="#exchange-response" id="ref-for-exchange-response①⓪">response</a>'s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-header-list" id="ref-for-concept-response-header-list①⓪">header list</a> returns a value that fails
to parse according to the instructions for the <a data-link-type="http-header" href="https://httpwg.org/http-extensions/draft-ietf-httpbis-variants.html#variants" id="ref-for-variants">Variants</a> Header Field, return "mismatch".</p>
    <li data-md>
     <p>Let <var>acceptableVariantKeys</var> be the result of running the <a data-link-type="dfn" href="https://httpwg.org/http-extensions/draft-ietf-httpbis-variants.html#cache" id="ref-for-cache">Variants Cache
Behavior</a> on an incoming-request of <var>browserRequest</var> and stored-responses
of a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list②">list</a> containing <var>storedExchange</var>’s <a data-link-type="dfn" href="#exchange-response" id="ref-for-exchange-response①①">response</a>.</p>
    <li data-md>
     <p>Let <var>variantKeys</var> be the result of <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-header-list-get" id="ref-for-concept-header-list-get①">getting</a> <code>`Variant-Key`</code> from <var>storedExchange</var>’s <a data-link-type="dfn" href="#exchange-response" id="ref-for-exchange-response①②">response</a>'s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-header-list" id="ref-for-concept-response-header-list①①">header list</a>,
and parsing it into a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list③">list</a> of <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list④">lists</a> as described in the <a data-link-type="http-header" href="https://httpwg.org/http-extensions/draft-ietf-httpbis-variants.html#variant-key" id="ref-for-variant-key">Variant-Key</a> Header Field.</p>
    <li data-md>
     <p>If parsing <var>variantKeys</var> failed, return "mismatch".</p>
    <li data-md>
     <p>If the <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#set-intersection" id="ref-for-set-intersection">intersection</a> of <var>acceptableVariantKeys</var> and <var>variantKeys</var> is <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-empty" id="ref-for-list-empty">empty</a>, return "mismatch".</p>
     <p class="issue" id="issue-e1733bef"><a class="self-link" href="#issue-e1733bef"></a> This depends on the <a data-link-type="dfn" href="https://httpwg.org/http-extensions/draft-ietf-httpbis-variants.html#cache" id="ref-for-cache①">Variants Cache
Behavior</a> returning a list of lists. <a href="https://github.com/httpwg/http-extensions/issues/744">&lt;https://github.com/httpwg/http-extensions/issues/744></a></p>
    <li data-md>
     <p>Return "match".</p>
   </ol>
   <h3 class="heading settled algorithm" data-algorithm="Create a new signed exchange report" data-level="4.14" id="create-a-new-report"><span class="secno">4.14. </span><span class="content">Create a new signed exchange report</span><a class="self-link" href="#create-a-new-report"></a></h3>
    To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="create-a-new-signed-exchange-report">create a new signed exchange report</dfn> with <var>request</var> and <var>actualResponse</var>, the UA MUST: 
   <ol>
    <li data-md>
     <p>Let <var>report</var> be a new <a data-link-type="dfn" href="#signed-exchange-report" id="ref-for-signed-exchange-report③">signed exchange report</a> struct.</p>
    <li data-md>
     <p>Set <var>report</var>’s <a data-link-type="dfn" href="#signed-exchange-report-outer-request" id="ref-for-signed-exchange-report-outer-request">outer request</a> to <var>request</var>.</p>
    <li data-md>
     <p>Set <var>report</var>’s <a data-link-type="dfn" href="#signed-exchange-report-outer-response" id="ref-for-signed-exchange-report-outer-response">outer response</a> to <var>actualResponse</var>.</p>
    <li data-md>
     <p>Set <var>report</var>’s <a data-link-type="dfn" href="#signed-exchange-report-server-ip" id="ref-for-signed-exchange-report-server-ip">server IP</a> to the IP address of the
server from which the user agent received the <var>actualResponse</var>, if
available.</p>
    <li data-md>
     <p>Return <var>report</var>.</p>
   </ol>
   <h3 class="heading settled algorithm" data-algorithm="Wait and queue a report" data-level="4.15" id="wait-and-queue-a-report"><span class="secno">4.15. </span><span class="content">Wait and queue a report</span><a class="self-link" href="#wait-and-queue-a-report"></a></h3>
    To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="wait-and-queue-a-report-for">wait and queue a report for</dfn> <var>parsedExchange</var> and <var>report</var>, the UA
MUST: 
   <ol>
    <li data-md>
     <p>Wait until <var>parsedExchange</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-body" id="ref-for-concept-response-body⑤">body</a>'s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-body-stream" id="ref-for-concept-body-stream⑤">stream</a> is <a data-link-type="dfn" href="https://streams.spec.whatwg.org/#readablestream-closed" id="ref-for-readablestream-closed">closed</a> or <a data-link-type="dfn" href="https://streams.spec.whatwg.org/#readablestream-errored" id="ref-for-readablestream-errored">errored</a>.</p>
    <li data-md>
     <p>If <var>parsedExchange</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-body" id="ref-for-concept-response-body⑥">body</a>'s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-body-stream" id="ref-for-concept-body-stream⑥">stream</a> is <a data-link-type="dfn" href="https://streams.spec.whatwg.org/#readablestream-closed" id="ref-for-readablestream-closed①">closed</a>, run <a data-link-type="dfn" href="#queue-a-signed-exchange-report" id="ref-for-queue-a-signed-exchange-report①">queue a signed exchange report</a> <var>report</var> with "<a data-link-type="dfn" href="#signed-exchange-report-ok" id="ref-for-signed-exchange-report-ok">ok</a>" as the result and abort these steps.</p>
    <li data-md>
     <p>If <var>parsedExchange</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-body" id="ref-for-concept-response-body⑦">body</a>'s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-body-stream" id="ref-for-concept-body-stream⑦">stream</a> is <a data-link-type="dfn" href="https://streams.spec.whatwg.org/#readablestream-errored" id="ref-for-readablestream-errored①">errored</a>, run <a data-link-type="dfn" href="#queue-a-signed-exchange-report" id="ref-for-queue-a-signed-exchange-report②">queue a signed exchange report</a> <var>report</var> with "<a data-link-type="dfn" href="#signed-exchange-report-mi_error" id="ref-for-signed-exchange-report-mi_error">mi_error</a>" as the result.</p>
   </ol>
   <h3 class="heading settled algorithm" data-algorithm="Queuing signed exchange report" data-level="4.16" id="queue-report"><span class="secno">4.16. </span><span class="content">Queuing signed exchange report</span><a class="self-link" href="#queue-report"></a></h3>
   <p>To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="queue-a-signed-exchange-report">queue a signed exchange report</dfn> <var>report</var> with <var>result</var> as the
result, the UA MUST:</p>
   <ol>
    <li data-md>
     <p>Set <var>report</var>’s <a data-link-type="dfn" href="#signed-exchange-report-result" id="ref-for-signed-exchange-report-result③">result</a> to <var>result</var>.</p>
    <li data-md>
     <p>Let <var>report body</var> and <var>policy</var> be the result of <a data-link-type="dfn" href="https://w3c.github.io/network-error-logging/#generate-a-network-error-report" id="ref-for-generate-a-network-error-report">generate a network error report</a> with <var>report</var>’s <a data-link-type="dfn" href="#signed-exchange-report-outer-request" id="ref-for-signed-exchange-report-outer-request①">outer request</a>. If the result is null, abort
these steps.</p>
    <li data-md>
     <p>If <var>report body</var>’s <code>"type"</code> is <code>"dns.address_changed"</code>, abort these steps.</p>
     <p class="note" role="note"><span>Note:</span> This means that the NEL report was downgraded because the IP addresses
of the server and the <var>policy</var> don’t match. In this case, the UA has called <a data-link-type="dfn" href="https://w3c.github.io/network-error-logging/#deliver-a-network-report" id="ref-for-deliver-a-network-report">deliver a network report</a> algorithm with the error report while handling
the response. So we don’t need to send the same error report while
processing the response as a signed exchange.</p>
    <li data-md>
     <p>Add a new property <code>"sxg"</code> to <var>report body</var> with a new ECMAScript object with
 the following properties:</p>
     <ul>
      <li data-md>
       <p><code>outer_url</code>: The <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-serializer" id="ref-for-concept-url-serializer①">serialization</a> of <var>report</var>’s <a data-link-type="dfn" href="#signed-exchange-report-outer-request" id="ref-for-signed-exchange-report-outer-request②">outer request</a>'s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-url" id="ref-for-concept-request-url②">url</a>.</p>
      <li data-md>
       <p><code>inner_url</code>: The <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-serializer" id="ref-for-concept-url-serializer②">serialization</a> of <var>report</var>’s <a data-link-type="dfn" href="#signed-exchange-report-inner-url" id="ref-for-signed-exchange-report-inner-url①">inner URL</a>.</p>
      <li data-md>
       <p><code>cert_url</code>: The <a data-link-type="dfn" href="https://heycam.github.io/webidl/#sequence-type" id="ref-for-sequence-type">sequence type</a> of the result of <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-serializer" id="ref-for-concept-url-serializer③">serialization</a> of each element of <var>report</var>’s <a data-link-type="dfn" href="#signed-exchange-report-cert-url-list" id="ref-for-signed-exchange-report-cert-url-list②">cert URL list</a>.</p>
     </ul>
    <li data-md>
     <p>Set <var>report body</var>’s <code>"phase"</code> to <code>"sxg"</code>.</p>
    <li data-md>
     <p>If the <var>report</var>’s <a data-link-type="dfn" href="#signed-exchange-report-result" id="ref-for-signed-exchange-report-result④">result</a> is
"<a data-link-type="dfn" href="#signed-exchange-report-ok" id="ref-for-signed-exchange-report-ok①">ok</a>", set <var>report body</var>’s <code>"type"</code> to <code>"ok"</code>.
Otherwise, set <var>report body</var>’s <code>"type"</code> to the result of concatenating a
string <code>"sxg."</code> and the <var>report</var>’s <a data-link-type="dfn" href="#signed-exchange-report-result" id="ref-for-signed-exchange-report-result⑤">result</a>.</p>
    <li data-md>
     <p>If <var>report body</var>’s <code>"sxg"</code>'s <code>"cert_url"</code>'s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-scheme" id="ref-for-concept-url-scheme③">scheme</a> is not <code>"data"</code> and <var>report</var>’s <a data-link-type="dfn" href="#signed-exchange-report-result" id="ref-for-signed-exchange-report-result⑥">result</a> is
"<a data-link-type="dfn" href="#signed-exchange-report-signature_verification_error" id="ref-for-signed-exchange-report-signature_verification_error②">signature_verification_error</a>" or
"<a data-link-type="dfn" href="#signed-exchange-report-cert_verification_error" id="ref-for-signed-exchange-report-cert_verification_error①">cert_verification_error</a>" or
"<a data-link-type="dfn" href="#signed-exchange-report-cert_fetch_error" id="ref-for-signed-exchange-report-cert_fetch_error②">cert_fetch_error</a>" or
"<a data-link-type="dfn" href="#signed-exchange-report-cert_parse_error" id="ref-for-signed-exchange-report-cert_parse_error③">cert_parse_error</a>":</p>
     <ol>
      <li data-md>
       <p>If <var>report</var>’s <a data-link-type="dfn" href="#signed-exchange-report-outer-request" id="ref-for-signed-exchange-report-outer-request③">outer request</a>'s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-url" id="ref-for-concept-request-url③">url</a>'s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-origin" id="ref-for-concept-url-origin④">origin</a> is different from any <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-origin" id="ref-for-concept-url-origin⑤">origin</a> of
the URLs in <var>report</var>’s <a data-link-type="dfn" href="#signed-exchange-report-cert-url-list" id="ref-for-signed-exchange-report-cert-url-list③">cert URL list</a>, or <var>report</var>’s <a data-link-type="dfn" href="#signed-exchange-report-server-ip" id="ref-for-signed-exchange-report-server-ip①">server IP</a> is different from
any of the IP address in <var>report</var>’s <a data-link-type="dfn" href="#signed-exchange-report-cert-server-ip-list" id="ref-for-signed-exchange-report-cert-server-ip-list①">cert server IP list</a>:</p>
       <ol>
        <li data-md>
         <p>Set <var>report body</var>’s <code>"type"</code> to <code>"sxg.failed"</code>.</p>
        <li data-md>
         <p>Set <var>report body</var>’s <code>"elapsed_time"</code> to 0.</p>
       </ol>
     </ol>
     <p class="note" role="note"><span>Note:</span> This step "downgrades" a Signed Exchange report if the certificate
was served from the different server from the server of <code>"outer_url"</code>. This
is intended to avoid leaking the information about the certificate server.</p>
    <li data-md>
     <p><a data-link-type="dfn" href="https://w3c.github.io/network-error-logging/#deliver-a-network-report" id="ref-for-deliver-a-network-report①">Deliver a network report</a> with <var>report body</var> and <var>policy</var> and <var>report</var>’s <a data-link-type="dfn" href="#signed-exchange-report-outer-request" id="ref-for-signed-exchange-report-outer-request④">outer request</a>.</p>
     <div class="example" id="example-network-error-log">
      <a class="self-link" href="#example-network-error-log"></a> If a <a data-link-type="dfn" href="https://w3c.github.io/network-error-logging/#dfn-nel-policies" id="ref-for-dfn-nel-policies">NEL policy</a> was received from the distributor’s origin, <code>distributor.example</code>, this step  will send the following JSON data to
describe an invalid signature: 
<pre class="highlight"><c- p>{</c->
  <c- f>"type"</c-><c- p>:</c-> <c- u>"network-error"</c-><c- p>,</c->
  <c- f>"url"</c-><c- p>:</c-> <c- u>"https://publisher.example/article.html"</c-><c- p>,</c->
  <c- f>"age"</c-><c- p>:</c-> <c- mi>234</c-><c- p>,</c->
  <c- f>"user_agent"</c-><c- p>:</c-> <c- u>"Mozilla/5.0 (X11; Linux x86_64; rv:60.0) ..."</c-><c- p>,</c->
  <c- f>"body"</c-><c- p>:</c-> <c- p>{</c->
    <c- f>"referrer"</c-><c- p>:</c-> <c- u>"https://aggregator.example/article.html"</c-><c- p>,</c->
    <c- f>"sampling_fraction"</c-><c- p>:</c-> <c- mi>1</c-><c- p>,</c->
    <c- f>"server_ip"</c-><c- p>:</c-> <c- u>"192.0.2.42"</c-><c- p>,</c->  // The IP address o<c- kc>f</c-> dis<c- kc>tr</c->ibu<c- kc>t</c->or.example.
    <c- f>"protocol"</c-><c- p>:</c-> <c- u>"http/1.1"</c-><c- p>,</c->
    <c- f>"method"</c-><c- p>:</c-> <c- u>"GET"</c-><c- p>,</c->
    <c- f>"status_code"</c-><c- p>:</c-> <c- mi>200</c-><c- p>,</c->
    <c- f>"elapsed_time"</c-><c- p>:</c-> <c- mi>1234</c-><c- p>,</c->
    <c- f>"phase"</c-><c- p>:</c-> <c- u>"sxg"</c-><c- p>,</c->
    <c- f>"type"</c-><c- p>:</c-> <c- u>"sxg.signature_verification_error"</c-><c- p>,</c->
    <c- f>"sxg"</c-><c- p>:</c-> <c- p>{</c->
      <c- f>"outer_url"</c-><c- p>:</c-> <c- u>"https://distributor.example/publisher.example/article.html.sxg"</c-><c- p>,</c->
      <c- f>"inner_url"</c-><c- p>:</c-> <c- u>"https://publisher.example/article.html"</c-><c- p>,</c->
      <c- f>"cert_url"</c-><c- p>:</c-> <c- p>[</c-><c- u>"https://distributor.example/publisher.example/cert"</c-><c- p>]</c->
    <c- p>},</c->
  <c- p>}</c->
<c- p>}</c->
</pre>
     </div>
   </ol>
   <h3 class="heading settled" data-level="4.17" id="stream-algs"><span class="secno">4.17. </span><span class="content">Stream algorithms</span><a class="self-link" href="#stream-algs"></a></h3>
   <p class="issue" id="issue-3ffca592"><a class="self-link" href="#issue-3ffca592"></a> The algorithms in this section create and operate over
ECMAScript objects like <code class="idl"><a data-link-type="idl" href="https://streams.spec.whatwg.org/#readablestream" id="ref-for-readablestream①">ReadableStream</a></code> despite not having a Realm to attach
them to. <a href="https://github.com/whatwg/fetch/issues/730">&lt;https://github.com/whatwg/fetch/issues/730></a></p>
   <h4 class="heading settled algorithm" data-algorithm="Create a read buffer" data-level="4.17.1" id="create-read-buffer"><span class="secno">4.17.1. </span><span class="content">Create a read buffer</span><a class="self-link" href="#create-read-buffer"></a></h4>
   <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="new-read-buffer">new read buffer</dfn> for a <code class="idl"><a data-link-type="idl" href="https://streams.spec.whatwg.org/#readablestream" id="ref-for-readablestream②">ReadableStream</a></code> <var>stream</var> is a new <a data-link-type="dfn" href="#read-buffer" id="ref-for-read-buffer②">read
buffer</a> struct whose items are:</p>
   <dl>
    <dt data-md><a data-link-type="dfn" href="#read-buffer-stream" id="ref-for-read-buffer-stream③">stream</a>
    <dd data-md>
     <p><var>stream</var></p>
    <dt data-md><a data-link-type="dfn" href="#read-buffer-reader" id="ref-for-read-buffer-reader">reader</a>
    <dd data-md>
     <p>The result of <a data-link-type="dfn" href="https://streams.spec.whatwg.org/#readablestream-get-a-reader" id="ref-for-readablestream-get-a-reader①">getting a reader</a> from <var>stream</var>.</p>
    <dt data-md><a data-link-type="dfn" href="#read-buffer-bytes" id="ref-for-read-buffer-bytes">bytes</a>
    <dd data-md>
     <p>An empty <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte-sequence" id="ref-for-byte-sequence①⑤">byte sequence</a>.</p>
   </dl>
   <h4 class="heading settled algorithm" data-algorithm="Read up to bytes" data-level="4.17.2" id="read-up-to-bytes"><span class="secno">4.17.2. </span><span class="content">Read up to bytes</span><a class="self-link" href="#read-up-to-bytes"></a></h4>
   <p>To <dfn class="dfn-paneled" data-dfn-for="read buffer" data-dfn-type="dfn" data-lt="reading up to" data-noexport id="read-buffer-reading-up-to">read up to</dfn> <var>N</var> bytes from a <a data-link-type="dfn" href="#read-buffer" id="ref-for-read-buffer③">read buffer</a> <var>buffer</var>, the UA MUST:</p>
   <ol>
    <li data-md>
     <p class="assertion">Assert: This algorithm is running <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel" id="ref-for-in-parallel⑦">in parallel</a>.</p>
    <li data-md>
     <p>Let <var>done</var> be <code>false</code>.</p>
    <li data-md>
     <p>While <var>done</var> is <code>false</code> and the length of <var>buffer</var>’s <a data-link-type="dfn" href="#read-buffer-bytes" id="ref-for-read-buffer-bytes①">bytes</a> item is less than <var>N</var> bytes:</p>
     <ol>
      <li data-md>
       <p>Let <var>chunk</var> be the result of <a data-link-type="dfn">reading a
chunk</a> with <var>buffer</var>’s <a data-link-type="dfn" href="#read-buffer-reader" id="ref-for-read-buffer-reader①">reader</a>.</p>
      <li data-md>
       <p>Wait for <var>chunk</var> to settle.</p>
      <li data-md>
       <p>If <var>chunk</var> is :</p>
       <dl class="switch">
        <dt data-md>Fulfilled with an object whose <code>done</code> property is <code>false</code> and whose <code>value</code> property is a <code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#idl-Uint8Array" id="ref-for-idl-Uint8Array">Uint8Array</a></code> object:
        <dd data-md>
         <ol>
          <li data-md>
           <p>Let <var>bs</var> be the <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte-sequence" id="ref-for-byte-sequence①⑥">byte sequence</a> represented by the <code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#idl-Uint8Array" id="ref-for-idl-Uint8Array①">Uint8Array</a></code> object.</p>
          <li data-md>
           <p>Set <var>buffer</var> to the concatenation of <var>buffer</var> and <var>bs</var>.</p>
         </ol>
        <dt data-md>Fulfilled with an object whose <code>done</code> property is <code>true</code>:
        <dd data-md>
         <p>Set <var>done</var> to <code>true</code>.</p>
        <dt data-md>Rejected with <var>e</var>:
        <dd data-md>
         <p>Return a failure with reason <var>e</var>.</p>
       </dl>
     </ol>
    <li data-md>
     <p>If <var>buffer</var>’s <a data-link-type="dfn" href="#read-buffer-bytes" id="ref-for-read-buffer-bytes②">bytes</a> item is at least <var>N</var> bytes long:</p>
     <ol>
      <li data-md>
       <p>Let <var>result</var> be a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte-sequence" id="ref-for-byte-sequence①⑦">byte sequence</a> consisting of the first N bytes of <var>buffer</var>’s <a data-link-type="dfn" href="#read-buffer-bytes" id="ref-for-read-buffer-bytes③">bytes</a> item.</p>
      <li data-md>
       <p>Set <var>buffer</var>’s <a data-link-type="dfn" href="#read-buffer-bytes" id="ref-for-read-buffer-bytes④">bytes</a> item to a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte-sequence" id="ref-for-byte-sequence①⑧">byte sequence</a> consisting of the bytes after the <var>N</var>th from its old value.</p>
     </ol>
    <li data-md>
     <p>Otherwise:</p>
     <ol>
      <li data-md>
       <p>Let <var>result</var> be <var>buffer</var>’s <a data-link-type="dfn" href="#read-buffer-bytes" id="ref-for-read-buffer-bytes⑤">bytes</a> item.</p>
      <li data-md>
       <p>Set <var>buffer</var>’s <a data-link-type="dfn" href="#read-buffer-bytes" id="ref-for-read-buffer-bytes⑥">bytes</a> item to an empty <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte-sequence" id="ref-for-byte-sequence①⑨">byte sequence</a>.</p>
     </ol>
    <li data-md>
     <p>Return <var>result</var>.</p>
   </ol>
   <h4 class="heading settled algorithm" data-algorithm="Read bytes" data-level="4.17.3" id="read-bytes"><span class="secno">4.17.3. </span><span class="content">Read bytes</span><a class="self-link" href="#read-bytes"></a></h4>
   <p>To <dfn class="dfn-paneled" data-dfn-for="read buffer" data-dfn-type="dfn" data-noexport id="read-buffer-read">read</dfn> <var>N</var> bytes from a <a data-link-type="dfn" href="#read-buffer" id="ref-for-read-buffer④">read buffer</a> <var>buffer</var>,
the UA MUST:</p>
   <ol>
    <li data-md>
     <p class="assertion">Assert: This algorithm is running <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel" id="ref-for-in-parallel⑧">in parallel</a>.</p>
    <li data-md>
     <p>Let <var>bytes</var> be the result of <a data-link-type="dfn" href="#read-buffer-reading-up-to" id="ref-for-read-buffer-reading-up-to">reading up to</a> <var>N</var> bytes from <var>buffer</var>.</p>
    <li data-md>
     <p>If <var>bytes</var> is a failure, return it.</p>
    <li data-md>
     <p>If <var>bytes</var> is exactly <var>N</var> bytes long, return it.</p>
    <li data-md>
     <p>Otherwise, return a failure.</p>
   </ol>
   <h4 class="heading settled algorithm" data-algorithm="Dump to another stream" data-level="4.17.4" id="dump-stream"><span class="secno">4.17.4. </span><span class="content">Dump to another stream</span><a class="self-link" href="#dump-stream"></a></h4>
   <p>To <dfn class="dfn-paneled" data-dfn-for="read buffer" data-dfn-type="dfn" data-noexport id="read-buffer-dump">Dump</dfn> a <a data-link-type="dfn" href="#read-buffer" id="ref-for-read-buffer⑤">read buffer</a> <var>input</var> to a <code class="idl"><a data-link-type="idl" href="https://streams.spec.whatwg.org/#readablestream" id="ref-for-readablestream③">ReadableStream</a></code> <var>output</var>, the UA MUST:</p>
   <ol>
    <li data-md>
     <p class="assertion">Assert: This algorithm is running <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel" id="ref-for-in-parallel⑨">in parallel</a>.</p>
    <li data-md>
     <p>Let <var>enqueue</var> be the following steps, taking <var>bytes</var>:</p>
     <ol>
      <li data-md>
       <p><a data-link-type="dfn" href="https://streams.spec.whatwg.org/#readablestream-enqueue" id="ref-for-readablestream-enqueue">Enqueue</a> a <code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#idl-Uint8Array" id="ref-for-idl-Uint8Array②">Uint8Array</a></code> object wrapping an <code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#idl-ArrayBuffer" id="ref-for-idl-ArrayBuffer">ArrayBuffer</a></code> containing <var>bytes</var> to <var>output</var>. Both objects are created
in <var>output</var>’s realm.</p>
      <li data-md>
       <p>If that threw an exception <var>ex</var>, <a data-link-type="dfn" href="https://streams.spec.whatwg.org/#readablestream-error" id="ref-for-readablestream-error">error</a> <var>output</var> with <var>ex</var> and <a data-link-type="dfn" href="https://streams.spec.whatwg.org/#readablestream-cancel" id="ref-for-readablestream-cancel①">cancel</a> <var>input</var>’s <a data-link-type="dfn" href="#read-buffer-stream" id="ref-for-read-buffer-stream④">stream</a> with <var>ex</var>.</p>
      <li data-md>
       <p>Abort this algorithm.</p>
     </ol>
    <li data-md>
     <p><var>enqueue</var> <var>input</var>’s <a data-link-type="dfn" href="#read-buffer-bytes" id="ref-for-read-buffer-bytes⑦">bytes</a>.</p>
    <li data-md>
     <p>While <var>input</var>’s <a data-link-type="dfn" href="#read-buffer-stream" id="ref-for-read-buffer-stream⑤">stream</a> is <a data-link-type="dfn" href="https://streams.spec.whatwg.org/#readablestream-readable" id="ref-for-readablestream-readable">readable</a>:</p>
     <ol>
      <li data-md>
       <p>Wait until <var>output</var> is <a data-link-type="dfn" href="https://streams.spec.whatwg.org/#readablestream-closed" id="ref-for-readablestream-closed②">closed</a>, <a data-link-type="dfn" href="https://streams.spec.whatwg.org/#readablestream-errored" id="ref-for-readablestream-errored②">errored</a>, or <a data-link-type="dfn" href="https://streams.spec.whatwg.org/#readablestream-need-more-data" id="ref-for-readablestream-need-more-data">needs
more data</a>.</p>
      <li data-md>
       <p>If <var>output</var> is <a data-link-type="dfn" href="https://streams.spec.whatwg.org/#readablestream-closed" id="ref-for-readablestream-closed③">closed</a> or <a data-link-type="dfn" href="https://streams.spec.whatwg.org/#readablestream-errored" id="ref-for-readablestream-errored③">errored</a>, <a data-link-type="dfn" href="https://streams.spec.whatwg.org/#readablestream-cancel" id="ref-for-readablestream-cancel②">cancel</a> <var>input</var>’s <a data-link-type="dfn" href="#read-buffer-stream" id="ref-for-read-buffer-stream⑥">stream</a> and abort
these steps.</p>
      <li data-md>
       <p>Let <var>chunk</var> be the result of <a data-link-type="dfn">reading a
chunk</a> with <var>input</var>’s <a data-link-type="dfn" href="#read-buffer-reader" id="ref-for-read-buffer-reader②">reader</a>.</p>
      <li data-md>
       <p>Wait for <var>chunk</var> to settle.</p>
      <li data-md>
       <p>If <var>chunk</var> is:</p>
       <dl class="switch">
        <dt data-md>Fulfilled with an object whose <code>done</code> property is <code>false</code> and whose <code>value</code> property is a <code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#idl-Uint8Array" id="ref-for-idl-Uint8Array③">Uint8Array</a></code> object <var>bytes</var>:
        <dd data-md>
         <p><var>enqueue</var> <var>bytes</var>.</p>
        <dt data-md>Fulfilled with an object whose <code>done</code> property is <code>true</code>:
        <dd data-md>
         <p><a data-link-type="dfn" href="https://streams.spec.whatwg.org/#readablestream-close" id="ref-for-readablestream-close">Close</a> <var>output</var>.</p>
        <dt data-md>Rejected with <var>e</var>:
        <dd data-md>
         <p><a data-link-type="dfn" href="https://streams.spec.whatwg.org/#readablestream-error" id="ref-for-readablestream-error①">Error</a> <var>output</var> with reason <var>e</var>.</p>
       </dl>
     </ol>
   </ol>
   <h2 class="heading settled" data-level="5" id="seccons"><span class="secno">5. </span><span class="content">Security Considerations</span><a class="self-link" href="#seccons"></a></h2>
   <p>The Security Considerations of <a data-link-type="biblio" href="#biblio-draft-yasskin-http-origin-signed-responses">[draft-yasskin-http-origin-signed-responses]</a> apply.</p>
   <h3 class="heading settled" data-level="5.1" id="seccons-ct"><span class="secno">5.1. </span><span class="content">Certificate Transparency</span><a class="self-link" href="#seccons-ct"></a></h3>
   <p>To identify <a data-link-type="dfn" href="https://wicg.github.io/webpackage/draft-yasskin-http-origin-signed-responses.html#seccons-off-path" id="ref-for-seccons-off-path">off-path attackers</a>, <a href="#trusting-certificate">§ 4.9 Establishing trust in a certificate</a> encourages UAs to
implement Certificate Transparency, which requires that, in order for a
certificate to be trusted, it must be logged publicly. This means that an
off-path attacker who has managed to get a mis-issued certificate has to at
least announce that certificate in a place the legitimate domain owner has a
chance to notice. Once they notice, they can revoke the certificate, which will
stop the UA from trusting it no more than 7 days later.</p>
  </main>
  <div data-fill-with="conformance">
   <h2 class="no-ref no-num heading settled" id="w3c-conformance"><span class="content">Conformance</span><a class="self-link" href="#w3c-conformance"></a></h2>
   <h3 class="no-ref no-num heading settled" id="w3c-conventions"><span class="content">Document conventions</span><a class="self-link" href="#w3c-conventions"></a></h3>
   <p>Conformance requirements are expressed
    with a combination of descriptive assertions
    and RFC 2119 terminology.
    The key words “MUST”, “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”, “RECOMMENDED”, “MAY”, and “OPTIONAL”
    in the normative parts of this document
    are to be interpreted as described in RFC 2119.
    However, for readability,
    these words do not appear in all uppercase letters in this specification. </p>
   <p>All of the text of this specification is normative
    except sections explicitly marked as non-normative, examples, and notes. <a data-link-type="biblio" href="#biblio-rfc2119">[RFC2119]</a> </p>
   <p>Examples in this specification are introduced with the words “for example”
    or are set apart from the normative text
    with <code>class="example"</code>,
    like this: </p>
   <div class="example" id="w3c-example">
    <a class="self-link" href="#w3c-example"></a> 
    <p>This is an example of an informative example. </p>
   </div>
   <p>Informative notes begin with the word “Note”
    and are set apart from the normative text
    with <code>class="note"</code>,
    like this: </p>
   <p class="note" role="note">Note, this is an informative note. </p>
   <h3 class="no-ref no-num heading settled" id="w3c-conformant-algorithms"><span class="content">Conformant Algorithms</span><a class="self-link" href="#w3c-conformant-algorithms"></a></h3>
   <p>Requirements phrased in the imperative as part of algorithms
    (such as "strip any leading space characters"
    or "return false and abort these steps")
    are to be interpreted with the meaning of the key word
    ("must", "should", "may", etc)
    used in introducing the algorithm. </p>
   <p>Conformance requirements phrased as algorithms or specific steps
    can be implemented in any manner,
    so long as the end result is equivalent.
    In particular, the algorithms defined in this specification
    are intended to be easy to understand
    and are not intended to be performant.
    Implementers are encouraged to optimize. </p>
  </div>
<script src="https://www.w3.org/scripts/TR/2016/fixup.js"></script>
  <h2 class="no-num no-ref heading settled" id="index"><span class="content">Index</span><a class="self-link" href="#index"></a></h2>
  <h3 class="no-num no-ref heading settled" id="index-defined-here"><span class="content">Terms defined by this specification</span><a class="self-link" href="#index-defined-here"></a></h3>
  <ul class="index">
   <li><a href="#public-key-algorithm">algorithm</a><span>, in §3.3</span>
   <li><a href="#augmented-certificate">Augmented Certificate</a><span>, in §3.2</span>
   <li><a href="#read-buffer-bytes">bytes</a><span>, in §3.2</span>
   <li><a href="#signed-exchange-report-cert_fetch_error">cert_fetch_error</a><span>, in §3.4</span>
   <li><a href="#augmented-certificate-certificate">certificate</a><span>, in §3.3</span>
   <li>
    certificate chain
    <ul>
     <li><a href="#certificate-chain">definition of</a><span>, in §3.3</span>
     <li><a href="#exchange-signature-certificate-chain">dfn for exchange signature</a><span>, in §3.5</span>
    </ul>
   <li><a href="#signed-exchange-report-cert_parse_error">cert_parse_error</a><span>, in §3.4</span>
   <li><a href="#signed-exchange-report-cert-server-ip-list">cert server IP list</a><span>, in §3.4</span>
   <li><a href="#exchange-signature-certsha256">certSha256</a><span>, in §3.5</span>
   <li><a href="#signed-exchange-report-cert-url-list">cert URL list</a><span>, in §3.4</span>
   <li><a href="#signed-exchange-report-cert_verification_error">cert_verification_error</a><span>, in §3.4</span>
   <li><a href="#create-a-new-signed-exchange-report">create a new signed exchange report</a><span>, in §4.14</span>
   <li><a href="#creating-a-header-list-from-the-cbor-map">creating a header list from the CBOR map</a><span>, in §4.11.1</span>
   <li>
    date
    <ul>
     <li><a href="#exchange-signature-date">dfn for exchange signature</a><span>, in §3.5</span>
     <li><a href="#response-date">dfn for response</a><span>, in §2.3</span>
    </ul>
   <li><a href="#exchange-signature-establishes-cross-origin-trust">does not establish cross-origin trust</a><span>, in §4.8</span>
   <li><a href="#certificate-chain-has-a-trusted-leaf">does not have a trusted leaf</a><span>, in §4.9</span>
   <li><a href="#read-buffer-dump">Dump</a><span>, in §4.17.4</span>
   <li><a href="#exchange-signature-establishes-cross-origin-trust">establishes cross-origin trust</a><span>, in §4.8</span>
   <li><a href="#exchange">Exchange</a><span>, in §3</span>
   <li><a href="#exchange-signature">Exchange Signature</a><span>, in §3.4</span>
   <li><a href="#exchange-signature-expiration-time">expiration time</a><span>, in §3.5</span>
   <li><a href="#certificate-extensions">extensions</a><span>, in §3.3</span>
   <li><a href="#extracting-the-fallback-url">Extracting the fallback URL</a><span>, in §4.2</span>
   <li><a href="#handling-the-certificate-reference">Handling the certificate reference</a><span>, in §4.5.1</span>
   <li><a href="#certificate-chain-has-a-trusted-leaf">has a trusted leaf</a><span>, in §4.9</span>
   <li><a href="#signed-exchange-report-inner-url">inner URL</a><span>, in §3.4</span>
   <li><a href="#exchange-signature-integrity-header">integrity header</a><span>, in §3.5</span>
   <li><a href="#signed-exchange-report-invalid_integrity_header">invalid_integrity_header</a><span>, in §3.4</span>
   <li><a href="#exchange-signature-is-valid">is not valid</a><span>, in §4.7</span>
   <li><a href="#exchange-signature-is-valid">is valid</a><span>, in §4.7</span>
   <li><a href="#certificate-chain-leaf">leaf</a><span>, in §3.3</span>
   <li><a href="#matches-the-stored-exchange">matches the stored exchange</a><span>, in §4.13</span>
   <li><a href="#signed-exchange-report-mi_error">mi_error</a><span>, in §3.4</span>
   <li><a href="#new-read-buffer">new read buffer</a><span>, in §4.17.1</span>
   <li><a href="#signed-exchange-report-non_secure_distributor">non_secure_distributor</a><span>, in §3.4</span>
   <li><a href="#augmented-certificate-ocsp-response">OCSP response</a><span>, in §3.3</span>
   <li><a href="#signed-exchange-report-ok">ok</a><span>, in §3.4</span>
   <li><a href="#signed-exchange-report-outer-request">outer request</a><span>, in §3.4</span>
   <li><a href="#signed-exchange-report-outer-response">outer response</a><span>, in §3.4</span>
   <li><a href="#signed-exchange-report-parse_error">parse_error</a><span>, in §3.4</span>
   <li><a href="#parsing-a-signed-exchange">Parsing a signed exchange</a><span>, in §4.3</span>
   <li><a href="#parsing-b2-cbor-headers">Parsing b2 CBOR headers</a><span>, in §4.10</span>
   <li><a href="#parsing-b3-cbor-headers">Parsing b3 CBOR headers</a><span>, in §4.11</span>
   <li><a href="#parsing-the-invariant-prefix">Parsing the invariant prefix</a><span>, in §4.4</span>
   <li><a href="#parsing-the-signature-header-field">Parsing the Signature header field</a><span>, in §4.5</span>
   <li><a href="#certificate-public-key">public key</a><span>, in §3.3</span>
   <li><a href="#queue-a-signed-exchange-report">queue a signed exchange report</a><span>, in §4.16</span>
   <li><a href="#read-buffer-read">read</a><span>, in §4.17.3</span>
   <li><a href="#reading-a-body">read a body</a><span>, in §4.12</span>
   <li><a href="#read-buffer">Read buffer</a><span>, in §3.1</span>
   <li><a href="#read-buffer-reader">reader</a><span>, in §3.2</span>
   <li><a href="#reading-a-body">reading a body</a><span>, in §4.12</span>
   <li><a href="#read-buffer-reading-up-to">reading up to</a><span>, in §4.17.2</span>
   <li><a href="#exchange-request-url">request URL</a><span>, in §3.1</span>
   <li><a href="#exchange-response">response</a><span>, in §3.1</span>
   <li><a href="#signed-exchange-report-result">result</a><span>, in §3.4</span>
   <li><a href="#augmented-certificate-sct">SCT</a><span>, in §3.3</span>
   <li><a href="#signed-exchange-report-server-ip">server IP</a><span>, in §3.4</span>
   <li><a href="#exchange-signature-signature">signature</a><span>, in §3.5</span>
   <li><a href="#signed-exchange-report-signature_verification_error">signature_verification_error</a><span>, in §3.4</span>
   <li><a href="#signed-exchange-report">Signed Exchange report</a><span>, in §3.3</span>
   <li><a href="#signed-exchange-version">signed exchange version</a><span>, in §4.1</span>
   <li><a href="#signed-message">signed message</a><span>, in §4.6</span>
   <li><a href="#request-stashed-exchange">stashed exchange</a><span>, in §2.1</span>
   <li><a href="#read-buffer-stream">stream</a><span>, in §3.2</span>
   <li><a href="#exchange-signature-validityurl">validityUrl</a><span>, in §3.5</span>
   <li><a href="#exchange-signature-validityurlbytes">validityUrlBytes</a><span>, in §3.5</span>
   <li><a href="#wait-and-queue-a-report-for">wait and queue a report for</a><span>, in §4.15</span>
  </ul>
  <aside class="dfn-panel" data-for="term-for-section-4.2">
   <a href="https://tools.ietf.org/html/draft-ietf-httpbis-header-structure-07#section-4.2">https://tools.ietf.org/html/draft-ietf-httpbis-header-structure-07#section-4.2</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-section-4.2①">4.5. Parsing a Signature Header Field</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-variant-key">
   <a href="https://httpwg.org/http-extensions/draft-ietf-httpbis-variants.html#variant-key">https://httpwg.org/http-extensions/draft-ietf-httpbis-variants.html#variant-key</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-variant-key">4.13. Request matching</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-variants">
   <a href="https://httpwg.org/http-extensions/draft-ietf-httpbis-variants.html#variants">https://httpwg.org/http-extensions/draft-ietf-httpbis-variants.html#variants</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-variants">4.13. Request matching</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-cache">
   <a href="https://httpwg.org/http-extensions/draft-ietf-httpbis-variants.html#cache">https://httpwg.org/http-extensions/draft-ietf-httpbis-variants.html#cache</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-cache">4.13. Request matching</a> <a href="#ref-for-cache①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-section-2.2">
   <a href="https://tools.ietf.org/html/draft-thomson-http-mice-03#section-2.2">https://tools.ietf.org/html/draft-thomson-http-mice-03#section-2.2</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-section-2.2">4.12. Creating the response stream.</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-seccons-off-path">
   <a href="https://wicg.github.io/webpackage/draft-yasskin-http-origin-signed-responses.html#seccons-off-path">https://wicg.github.io/webpackage/draft-yasskin-http-origin-signed-responses.html#seccons-off-path</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-seccons-off-path">5.1. Certificate Transparency</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-uncached-headers">
   <a href="https://wicg.github.io/webpackage/draft-yasskin-http-origin-signed-responses.html#uncached-headers">https://wicg.github.io/webpackage/draft-yasskin-http-origin-signed-responses.html#uncached-headers</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-uncached-headers">4.8. Cross-origin trust</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-section-3.4">
   <a href="https://tools.ietf.org/html/draft-yasskin-httpbis-origin-signed-exchanges-impl-02#section-3.4">https://tools.ietf.org/html/draft-yasskin-httpbis-origin-signed-exchanges-impl-02#section-3.4</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-section-3.4">4.5.1. Handling the certificate reference</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-section-4.2">
   <a href="https://tools.ietf.org/html/draft-yasskin-httpbis-origin-signed-exchanges-impl-02#section-4.2">https://tools.ietf.org/html/draft-yasskin-httpbis-origin-signed-exchanges-impl-02#section-4.2</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-section-4.2②">4.9. Establishing trust in a certificate</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-section-3.3">
   <a href="https://tools.ietf.org/html/draft-yasskin-httpbis-origin-signed-exchanges-impl-02#section-3.3">https://tools.ietf.org/html/draft-yasskin-httpbis-origin-signed-exchanges-impl-02#section-3.3</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-section-3.3①">4.5.1. Handling the certificate reference</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-parse-known-length">
   <a href="https://wicg.github.io/webpackage/draft-yasskin-wpack-bundled-exchanges.html#parse-known-length">https://wicg.github.io/webpackage/draft-yasskin-wpack-bundled-exchanges.html#parse-known-length</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-parse-known-length">4.10. Parsing b2 CBOR headers</a>
    <li><a href="#ref-for-parse-known-length①">4.11. Parsing b3 CBOR headers</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-utf-8-decode-without-bom-or-fail">
   <a href="https://encoding.spec.whatwg.org/#utf-8-decode-without-bom-or-fail">https://encoding.spec.whatwg.org/#utf-8-decode-without-bom-or-fail</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-utf-8-decode-without-bom-or-fail">4.4. Parsing the invariant prefix</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dom-requestcache-only-if-cached">
   <a href="https://fetch.spec.whatwg.org/#dom-requestcache-only-if-cached">https://fetch.spec.whatwg.org/#dom-requestcache-only-if-cached</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-requestcache-only-if-cached">1.1. Overview</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-request">
   <a href="https://fetch.spec.whatwg.org/#request">https://fetch.spec.whatwg.org/#request</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-request">1.1. Overview</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-header-list-append">
   <a href="https://fetch.spec.whatwg.org/#concept-header-list-append">https://fetch.spec.whatwg.org/#concept-header-list-append</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-header-list-append">4.11.1. Converting a map to a header list</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-response-body">
   <a href="https://fetch.spec.whatwg.org/#concept-response-body">https://fetch.spec.whatwg.org/#concept-response-body</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-response-body">4.2. Extracting the fallback URL</a>
    <li><a href="#ref-for-concept-response-body①">4.3. Parsing signed exchanges</a>
    <li><a href="#ref-for-concept-response-body②">4.5.1. Handling the certificate reference</a> <a href="#ref-for-concept-response-body③">(2)</a>
    <li><a href="#ref-for-concept-response-body④">4.12. Creating the response stream.</a>
    <li><a href="#ref-for-concept-response-body⑤">4.15. Wait and queue a report</a> <a href="#ref-for-concept-response-body⑥">(2)</a> <a href="#ref-for-concept-response-body⑦">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dom-request-cache">
   <a href="https://fetch.spec.whatwg.org/#dom-request-cache">https://fetch.spec.whatwg.org/#dom-request-cache</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-request-cache">1.1. Overview</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-request-cache-mode">
   <a href="https://fetch.spec.whatwg.org/#concept-request-cache-mode">https://fetch.spec.whatwg.org/#concept-request-cache-mode</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-request-cache-mode">2.5. Monkeypatch HTTP-network-or-cache fetch</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-request-client">
   <a href="https://fetch.spec.whatwg.org/#concept-request-client">https://fetch.spec.whatwg.org/#concept-request-client</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-request-client">2.4. Monkeypatch HTTP fetch</a>
    <li><a href="#ref-for-concept-request-client①">4.5.1. Handling the certificate reference</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-response-clone">
   <a href="https://fetch.spec.whatwg.org/#concept-response-clone">https://fetch.spec.whatwg.org/#concept-response-clone</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-response-clone">2.2. Request clone</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dom-request-clone">
   <a href="https://fetch.spec.whatwg.org/#dom-request-clone">https://fetch.spec.whatwg.org/#dom-request-clone</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-request-clone">1.1. Overview</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-header-list-contains">
   <a href="https://fetch.spec.whatwg.org/#header-list-contains">https://fetch.spec.whatwg.org/#header-list-contains</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-header-list-contains">4.10. Parsing b2 CBOR headers</a>
    <li><a href="#ref-for-header-list-contains①">4.11.1. Converting a map to a header list</a>
    <li><a href="#ref-for-header-list-contains②">4.13. Request matching</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-determine-nosniff">
   <a href="https://fetch.spec.whatwg.org/#determine-nosniff">https://fetch.spec.whatwg.org/#determine-nosniff</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-determine-nosniff">4.1. Identifying signed exchanges</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-header-list-contains">
   <a href="https://fetch.spec.whatwg.org/#header-list-contains">https://fetch.spec.whatwg.org/#header-list-contains</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-header-list-contains">4.10. Parsing b2 CBOR headers</a>
    <li><a href="#ref-for-header-list-contains①">4.11.1. Converting a map to a header list</a>
    <li><a href="#ref-for-header-list-contains②">4.13. Request matching</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-header-extract-mime-type">
   <a href="https://fetch.spec.whatwg.org/#concept-header-extract-mime-type">https://fetch.spec.whatwg.org/#concept-header-extract-mime-type</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-header-extract-mime-type">4.1. Identifying signed exchanges</a>
    <li><a href="#ref-for-concept-header-extract-mime-type①">4.5.1. Handling the certificate reference</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-extract-header-list-values">
   <a href="https://fetch.spec.whatwg.org/#extract-header-list-values">https://fetch.spec.whatwg.org/#extract-header-list-values</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-extract-header-list-values">2.3. Response date</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-fetch">
   <a href="https://fetch.spec.whatwg.org/#concept-fetch">https://fetch.spec.whatwg.org/#concept-fetch</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-fetch">4.5.1. Handling the certificate reference</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dom-global-fetch">
   <a href="https://fetch.spec.whatwg.org/#dom-global-fetch">https://fetch.spec.whatwg.org/#dom-global-fetch</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-global-fetch">1.1. Overview</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-header-list-get">
   <a href="https://fetch.spec.whatwg.org/#concept-header-list-get">https://fetch.spec.whatwg.org/#concept-header-list-get</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-header-list-get">4.13. Request matching</a> <a href="#ref-for-concept-header-list-get①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-header-list-get-decode-split">
   <a href="https://fetch.spec.whatwg.org/#concept-header-list-get-decode-split">https://fetch.spec.whatwg.org/#concept-header-list-get-decode-split</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-header-list-get-decode-split">4.12. Creating the response stream.</a> <a href="#ref-for-concept-header-list-get-decode-split①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-handle-content-codings">
   <a href="https://fetch.spec.whatwg.org/#handle-content-codings">https://fetch.spec.whatwg.org/#handle-content-codings</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-handle-content-codings">4.12. Creating the response stream.</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-response-header-list">
   <a href="https://fetch.spec.whatwg.org/#concept-response-header-list">https://fetch.spec.whatwg.org/#concept-response-header-list</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-response-header-list">2.3. Response date</a>
    <li><a href="#ref-for-concept-response-header-list①">4.1. Identifying signed exchanges</a> <a href="#ref-for-concept-response-header-list②">(2)</a>
    <li><a href="#ref-for-concept-response-header-list③">4.5.1. Handling the certificate reference</a>
    <li><a href="#ref-for-concept-response-header-list④">4.8. Cross-origin trust</a>
    <li><a href="#ref-for-concept-response-header-list⑤">4.10. Parsing b2 CBOR headers</a>
    <li><a href="#ref-for-concept-response-header-list⑥">4.11. Parsing b3 CBOR headers</a>
    <li><a href="#ref-for-concept-response-header-list⑦">4.12. Creating the response stream.</a> <a href="#ref-for-concept-response-header-list⑧">(2)</a>
    <li><a href="#ref-for-concept-response-header-list⑨">4.13. Request matching</a> <a href="#ref-for-concept-response-header-list①⓪">(2)</a> <a href="#ref-for-concept-response-header-list①①">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-http-fetch">
   <a href="https://fetch.spec.whatwg.org/#concept-http-fetch">https://fetch.spec.whatwg.org/#concept-http-fetch</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-http-fetch">2.4. Monkeypatch HTTP fetch</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-http-network-fetch">
   <a href="https://fetch.spec.whatwg.org/#concept-http-network-fetch">https://fetch.spec.whatwg.org/#concept-http-network-fetch</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-http-network-fetch">4.3. Parsing signed exchanges</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-http-network-or-cache-fetch">
   <a href="https://fetch.spec.whatwg.org/#concept-http-network-or-cache-fetch">https://fetch.spec.whatwg.org/#concept-http-network-or-cache-fetch</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-http-network-or-cache-fetch">2.5. Monkeypatch HTTP-network-or-cache fetch</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-request-initiator">
   <a href="https://fetch.spec.whatwg.org/#concept-request-initiator">https://fetch.spec.whatwg.org/#concept-request-initiator</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-request-initiator">2.5. Monkeypatch HTTP-network-or-cache fetch</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-request-method">
   <a href="https://fetch.spec.whatwg.org/#concept-request-method">https://fetch.spec.whatwg.org/#concept-request-method</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-request-method">4.13. Request matching</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-request-mode">
   <a href="https://fetch.spec.whatwg.org/#concept-request-mode">https://fetch.spec.whatwg.org/#concept-request-mode</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-request-mode">4.5.1. Handling the certificate reference</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-header-name">
   <a href="https://fetch.spec.whatwg.org/#concept-header-name">https://fetch.spec.whatwg.org/#concept-header-name</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-header-name">4.11.1. Converting a map to a header list</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-network-error">
   <a href="https://fetch.spec.whatwg.org/#concept-network-error">https://fetch.spec.whatwg.org/#concept-network-error</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-network-error">2.4. Monkeypatch HTTP fetch</a> <a href="#ref-for-concept-network-error①">(2)</a>
    <li><a href="#ref-for-concept-network-error②">2.5. Monkeypatch HTTP-network-or-cache fetch</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-redirect-status">
   <a href="https://fetch.spec.whatwg.org/#redirect-status">https://fetch.spec.whatwg.org/#redirect-status</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-redirect-status">2.4. Monkeypatch HTTP fetch</a>
    <li><a href="#ref-for-redirect-status①">4.3. Parsing signed exchanges</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-request">
   <a href="https://fetch.spec.whatwg.org/#concept-request">https://fetch.spec.whatwg.org/#concept-request</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-request">2.1. A request’s stashed exchange</a>
    <li><a href="#ref-for-concept-request①">3.4. Signed Exchange report</a>
    <li><a href="#ref-for-concept-request②">4.5.1. Handling the certificate reference</a>
    <li><a href="#ref-for-concept-request③">4.13. Request matching</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-response">
   <a href="https://fetch.spec.whatwg.org/#concept-response">https://fetch.spec.whatwg.org/#concept-response</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-response">2.3. Response date</a>
    <li><a href="#ref-for-concept-response①">3.1. Exchange</a>
    <li><a href="#ref-for-concept-response②">3.4. Signed Exchange report</a>
    <li><a href="#ref-for-concept-response③">4.1. Identifying signed exchanges</a>
    <li><a href="#ref-for-concept-response④">4.2. Extracting the fallback URL</a>
    <li><a href="#ref-for-concept-response⑤">4.3. Parsing signed exchanges</a>
    <li><a href="#ref-for-concept-response⑥">4.10. Parsing b2 CBOR headers</a>
    <li><a href="#ref-for-concept-response⑦">4.11. Parsing b3 CBOR headers</a>
    <li><a href="#ref-for-concept-response⑧">4.12. Creating the response stream.</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-request-service-workers-mode">
   <a href="https://fetch.spec.whatwg.org/#request-service-workers-mode">https://fetch.spec.whatwg.org/#request-service-workers-mode</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-request-service-workers-mode">4.5.1. Handling the certificate reference</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-header-list-set">
   <a href="https://fetch.spec.whatwg.org/#concept-header-list-set">https://fetch.spec.whatwg.org/#concept-header-list-set</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-header-list-set">2.4. Monkeypatch HTTP fetch</a> <a href="#ref-for-concept-header-list-set①">(2)</a>
    <li><a href="#ref-for-concept-header-list-set②">4.10. Parsing b2 CBOR headers</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-response-status">
   <a href="https://fetch.spec.whatwg.org/#concept-response-status">https://fetch.spec.whatwg.org/#concept-response-status</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-response-status">2.4. Monkeypatch HTTP fetch</a>
    <li><a href="#ref-for-concept-response-status①">4.3. Parsing signed exchanges</a>
    <li><a href="#ref-for-concept-response-status②">4.5.1. Handling the certificate reference</a>
    <li><a href="#ref-for-concept-response-status③">4.10. Parsing b2 CBOR headers</a>
    <li><a href="#ref-for-concept-response-status④">4.11. Parsing b3 CBOR headers</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-body-stream">
   <a href="https://fetch.spec.whatwg.org/#concept-body-stream">https://fetch.spec.whatwg.org/#concept-body-stream</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-body-stream">4.2. Extracting the fallback URL</a>
    <li><a href="#ref-for-concept-body-stream①">4.3. Parsing signed exchanges</a>
    <li><a href="#ref-for-concept-body-stream②">4.5.1. Handling the certificate reference</a> <a href="#ref-for-concept-body-stream③">(2)</a>
    <li><a href="#ref-for-concept-body-stream④">4.12. Creating the response stream.</a>
    <li><a href="#ref-for-concept-body-stream⑤">4.15. Wait and queue a report</a> <a href="#ref-for-concept-body-stream⑥">(2)</a> <a href="#ref-for-concept-body-stream⑦">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-response-url">
   <a href="https://fetch.spec.whatwg.org/#concept-response-url">https://fetch.spec.whatwg.org/#concept-response-url</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-response-url">4.3. Parsing signed exchanges</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-header-value">
   <a href="https://fetch.spec.whatwg.org/#concept-header-value">https://fetch.spec.whatwg.org/#concept-header-value</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-header-value">4.11.1. Converting a map to a header list</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-environment-settings-object">
   <a href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object">https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-environment-settings-object">4.3. Parsing signed exchanges</a>
    <li><a href="#ref-for-environment-settings-object①">4.5. Parsing a Signature Header Field</a>
    <li><a href="#ref-for-environment-settings-object②">4.5.1. Handling the certificate reference</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-origin-host">
   <a href="https://html.spec.whatwg.org/multipage/origin.html#concept-origin-host">https://html.spec.whatwg.org/multipage/origin.html#concept-origin-host</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-origin-host">4.9. Establishing trust in a certificate</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-in-parallel">
   <a href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel">https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-in-parallel">2.4. Monkeypatch HTTP fetch</a>
    <li><a href="#ref-for-in-parallel①">4.2. Extracting the fallback URL</a>
    <li><a href="#ref-for-in-parallel②">4.3. Parsing signed exchanges</a>
    <li><a href="#ref-for-in-parallel③">4.4. Parsing the invariant prefix</a>
    <li><a href="#ref-for-in-parallel④">4.5. Parsing a Signature Header Field</a>
    <li><a href="#ref-for-in-parallel⑤">4.5.1. Handling the certificate reference</a>
    <li><a href="#ref-for-in-parallel⑥">4.12. Creating the response stream.</a>
    <li><a href="#ref-for-in-parallel⑦">4.17.2. Read up to bytes</a>
    <li><a href="#ref-for-in-parallel⑧">4.17.3. Read bytes</a>
    <li><a href="#ref-for-in-parallel⑨">4.17.4. Dump to another stream</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-origin">
   <a href="https://html.spec.whatwg.org/multipage/origin.html#concept-origin">https://html.spec.whatwg.org/multipage/origin.html#concept-origin</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-origin">4.9. Establishing trust in a certificate</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-same-origin">
   <a href="https://html.spec.whatwg.org/multipage/origin.html#same-origin">https://html.spec.whatwg.org/multipage/origin.html#same-origin</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-same-origin">4.8. Cross-origin trust</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-http-dig-alg-1">
   <a href="https://www.iana.org/assignments/http-dig-alg/http-dig-alg.xhtml#http-dig-alg-1">https://www.iana.org/assignments/http-dig-alg/http-dig-alg.xhtml#http-dig-alg-1</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-http-dig-alg-1">4.12. Creating the response stream.</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-ascii-byte">
   <a href="https://infra.spec.whatwg.org/#ascii-byte">https://infra.spec.whatwg.org/#ascii-byte</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-ascii-byte">4.5. Parsing a Signature Header Field</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-ascii-decode">
   <a href="https://infra.spec.whatwg.org/#ascii-decode">https://infra.spec.whatwg.org/#ascii-decode</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-ascii-decode">4.5. Parsing a Signature Header Field</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-ascii-encode">
   <a href="https://infra.spec.whatwg.org/#ascii-encode">https://infra.spec.whatwg.org/#ascii-encode</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-ascii-encode">2.4. Monkeypatch HTTP fetch</a>
    <li><a href="#ref-for-ascii-encode①">4.5. Parsing a Signature Header Field</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-ascii-string">
   <a href="https://infra.spec.whatwg.org/#ascii-string">https://infra.spec.whatwg.org/#ascii-string</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-ascii-string">3.5. Exchange Signature</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-ascii-upper-alpha">
   <a href="https://infra.spec.whatwg.org/#ascii-upper-alpha">https://infra.spec.whatwg.org/#ascii-upper-alpha</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-ascii-upper-alpha">4.11.1. Converting a map to a header list</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-byte-sequence">
   <a href="https://infra.spec.whatwg.org/#byte-sequence">https://infra.spec.whatwg.org/#byte-sequence</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-byte-sequence">3.2. Read buffer</a>
    <li><a href="#ref-for-byte-sequence①">3.3. Augmented Certificate</a> <a href="#ref-for-byte-sequence②">(2)</a> <a href="#ref-for-byte-sequence③">(3)</a> <a href="#ref-for-byte-sequence④">(4)</a> <a href="#ref-for-byte-sequence⑤">(5)</a>
    <li><a href="#ref-for-byte-sequence⑥">3.5. Exchange Signature</a> <a href="#ref-for-byte-sequence⑦">(2)</a>
    <li><a href="#ref-for-byte-sequence⑧">4.4. Parsing the invariant prefix</a> <a href="#ref-for-byte-sequence⑨">(2)</a>
    <li><a href="#ref-for-byte-sequence①⓪">4.6. The signed message</a> <a href="#ref-for-byte-sequence①①">(2)</a>
    <li><a href="#ref-for-byte-sequence①②">4.7. Validating a signature</a>
    <li><a href="#ref-for-byte-sequence①③">4.10. Parsing b2 CBOR headers</a>
    <li><a href="#ref-for-byte-sequence①④">4.11. Parsing b3 CBOR headers</a>
    <li><a href="#ref-for-byte-sequence①⑤">4.17.1. Create a read buffer</a>
    <li><a href="#ref-for-byte-sequence①⑥">4.17.2. Read up to bytes</a> <a href="#ref-for-byte-sequence①⑦">(2)</a> <a href="#ref-for-byte-sequence①⑧">(3)</a> <a href="#ref-for-byte-sequence①⑨">(4)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-list-empty">
   <a href="https://infra.spec.whatwg.org/#list-empty">https://infra.spec.whatwg.org/#list-empty</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-list-empty">4.13. Request matching</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-set-intersection">
   <a href="https://infra.spec.whatwg.org/#set-intersection">https://infra.spec.whatwg.org/#set-intersection</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-set-intersection">4.13. Request matching</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-isomorphic-decode">
   <a href="https://infra.spec.whatwg.org/#isomorphic-decode">https://infra.spec.whatwg.org/#isomorphic-decode</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-isomorphic-decode">4.11.1. Converting a map to a header list</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-list-item">
   <a href="https://infra.spec.whatwg.org/#list-item">https://infra.spec.whatwg.org/#list-item</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-list-item">3.3. Augmented Certificate</a>
    <li><a href="#ref-for-list-item①">4.5.1. Handling the certificate reference</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-list">
   <a href="https://infra.spec.whatwg.org/#list">https://infra.spec.whatwg.org/#list</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-list">3.3. Augmented Certificate</a>
    <li><a href="#ref-for-list①">3.5. Exchange Signature</a>
    <li><a href="#ref-for-list②">4.13. Request matching</a> <a href="#ref-for-list③">(2)</a> <a href="#ref-for-list④">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-strictly-split">
   <a href="https://infra.spec.whatwg.org/#strictly-split">https://infra.spec.whatwg.org/#strictly-split</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-strictly-split">4.5. Parsing a Signature Header Field</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-struct">
   <a href="https://infra.spec.whatwg.org/#struct">https://infra.spec.whatwg.org/#struct</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-struct">3.1. Exchange</a>
    <li><a href="#ref-for-struct①">3.2. Read buffer</a>
    <li><a href="#ref-for-struct②">3.4. Signed Exchange report</a>
    <li><a href="#ref-for-struct③">3.5. Exchange Signature</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-tuple">
   <a href="https://infra.spec.whatwg.org/#tuple">https://infra.spec.whatwg.org/#tuple</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-tuple">3.3. Augmented Certificate</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-mime-type-essence">
   <a href="https://mimesniff.spec.whatwg.org/#mime-type-essence">https://mimesniff.spec.whatwg.org/#mime-type-essence</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-mime-type-essence">4.1. Identifying signed exchanges</a>
    <li><a href="#ref-for-mime-type-essence①">4.5.1. Handling the certificate reference</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-mime-type">
   <a href="https://mimesniff.spec.whatwg.org/#mime-type">https://mimesniff.spec.whatwg.org/#mime-type</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-mime-type">1.1. Overview</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-parameters">
   <a href="https://mimesniff.spec.whatwg.org/#parameters">https://mimesniff.spec.whatwg.org/#parameters</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-parameters">4.1. Identifying signed exchanges</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-deliver-a-network-report">
   <a href="https://w3c.github.io/network-error-logging/#deliver-a-network-report">https://w3c.github.io/network-error-logging/#deliver-a-network-report</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-deliver-a-network-report">4.16. Queuing signed exchange report</a> <a href="#ref-for-deliver-a-network-report①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-generate-a-network-error-report">
   <a href="https://w3c.github.io/network-error-logging/#generate-a-network-error-report">https://w3c.github.io/network-error-logging/#generate-a-network-error-report</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-generate-a-network-error-report">4.16. Queuing signed exchange report</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dfn-nel-policies">
   <a href="https://w3c.github.io/network-error-logging/#dfn-nel-policies">https://w3c.github.io/network-error-logging/#dfn-nel-policies</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dfn-nel-policies">4.16. Queuing signed exchange report</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-section-4.3.2">
   <a href="https://tools.ietf.org/html/rfc3230#section-4.3.2">https://tools.ietf.org/html/rfc3230#section-4.3.2</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-section-4.3.2">4.12. Creating the response stream.</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-section-4.1.1.2">
   <a href="https://tools.ietf.org/html/rfc5280#section-4.1.1.2">https://tools.ietf.org/html/rfc5280#section-4.1.1.2</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-section-4.1.1.2">3.3. Augmented Certificate</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-section-4.2">
   <a href="https://tools.ietf.org/html/rfc5280#section-4.2">https://tools.ietf.org/html/rfc5280#section-4.2</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-section-4.2">3.3. Augmented Certificate</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-section-4.1.2.7">
   <a href="https://tools.ietf.org/html/rfc5280#section-4.1.2.7">https://tools.ietf.org/html/rfc5280#section-4.1.2.7</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-section-4.1.2.7">3.3. Augmented Certificate</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-section-2.1.1">
   <a href="https://tools.ietf.org/html/rfc5480#section-2.1.1">https://tools.ietf.org/html/rfc5480#section-2.1.1</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-section-2.1.1">4.7. Validating a signature</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-section-2.1.1.1">
   <a href="https://tools.ietf.org/html/rfc5480#section-2.1.1.1">https://tools.ietf.org/html/rfc5480#section-2.1.1.1</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-section-2.1.1.1">4.7. Validating a signature</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-section-4.2.1">
   <a href="https://tools.ietf.org/html/rfc6960#section-4.2.1">https://tools.ietf.org/html/rfc6960#section-4.2.1</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-section-4.2.1">3.3. Augmented Certificate</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-section-3.3">
   <a href="https://tools.ietf.org/html/rfc6962#section-3.3">https://tools.ietf.org/html/rfc6962#section-3.3</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-section-3.3">3.3. Augmented Certificate</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-section-7.1.1.2">
   <a href="https://tools.ietf.org/html/rfc7231#section-7.1.1.2">https://tools.ietf.org/html/rfc7231#section-7.1.1.2</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-section-7.1.1.2">2.3. Response date</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-section-4.2.3">
   <a href="https://tools.ietf.org/html/draft-ietf-tls-tls13-28#section-4.2.3">https://tools.ietf.org/html/draft-ietf-tls-tls13-28#section-4.2.3</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-section-4.2.3">4.7. Validating a signature</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-potentially-trustworthy-origin">
   <a href="https://w3c.github.io/webappsec-secure-contexts/#potentially-trustworthy-origin">https://w3c.github.io/webappsec-secure-contexts/#potentially-trustworthy-origin</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-potentially-trustworthy-origin">4.3. Parsing signed exchanges</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-fetchevent">
   <a href="https://w3c.github.io/ServiceWorker/#fetchevent">https://w3c.github.io/ServiceWorker/#fetchevent</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-fetchevent">1.1. Overview</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dom-serviceworkerregistration-navigationpreload">
   <a href="https://w3c.github.io/ServiceWorker/#dom-serviceworkerregistration-navigationpreload">https://w3c.github.io/ServiceWorker/#dom-serviceworkerregistration-navigationpreload</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-serviceworkerregistration-navigationpreload">1.1. Overview</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dom-fetchevent-preloadresponse">
   <a href="https://w3c.github.io/ServiceWorker/#dom-fetchevent-preloadresponse">https://w3c.github.io/ServiceWorker/#dom-fetchevent-preloadresponse</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-fetchevent-preloadresponse">1.1. Overview</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dom-fetchevent-request">
   <a href="https://w3c.github.io/ServiceWorker/#dom-fetchevent-request">https://w3c.github.io/ServiceWorker/#dom-fetchevent-request</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-fetchevent-request">1.1. Overview</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-">
   <a href="http://csrc.nist.gov/publications/fips/fips180-4/fips-180-4.pdf#">http://csrc.nist.gov/publications/fips/fips180-4/fips-180-4.pdf#</a><b>Referenced in:</b>
   <ul>
    <li><a href="#termref-for-">3.5. Exchange Signature</a>
    <li><a href="#termref-for-">4.5.1. Handling the certificate reference</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-readablestream">
   <a href="https://streams.spec.whatwg.org/#readablestream">https://streams.spec.whatwg.org/#readablestream</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-readablestream">3.2. Read buffer</a>
    <li><a href="#ref-for-readablestream①">4.17. Stream algorithms</a>
    <li><a href="#ref-for-readablestream②">4.17.1. Create a read buffer</a>
    <li><a href="#ref-for-readablestream③">4.17.4. Dump to another stream</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-readablestreamdefaultreader">
   <a href="https://streams.spec.whatwg.org/#readablestreamdefaultreader">https://streams.spec.whatwg.org/#readablestreamdefaultreader</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-readablestreamdefaultreader">3.2. Read buffer</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-readablestream-cancel">
   <a href="https://streams.spec.whatwg.org/#readablestream-cancel">https://streams.spec.whatwg.org/#readablestream-cancel</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-readablestream-cancel">4.12. Creating the response stream.</a>
    <li><a href="#ref-for-readablestream-cancel①">4.17.4. Dump to another stream</a> <a href="#ref-for-readablestream-cancel②">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-readablestream-close">
   <a href="https://streams.spec.whatwg.org/#readablestream-close">https://streams.spec.whatwg.org/#readablestream-close</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-readablestream-close">4.17.4. Dump to another stream</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-readablestream-closed">
   <a href="https://streams.spec.whatwg.org/#readablestream-closed">https://streams.spec.whatwg.org/#readablestream-closed</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-readablestream-closed">4.15. Wait and queue a report</a> <a href="#ref-for-readablestream-closed①">(2)</a>
    <li><a href="#ref-for-readablestream-closed②">4.17.4. Dump to another stream</a> <a href="#ref-for-readablestream-closed③">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-readablestream-enqueue">
   <a href="https://streams.spec.whatwg.org/#readablestream-enqueue">https://streams.spec.whatwg.org/#readablestream-enqueue</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-readablestream-enqueue">4.17.4. Dump to another stream</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-readablestream-error">
   <a href="https://streams.spec.whatwg.org/#readablestream-error">https://streams.spec.whatwg.org/#readablestream-error</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-readablestream-error">4.17.4. Dump to another stream</a> <a href="#ref-for-readablestream-error①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-readablestream-errored">
   <a href="https://streams.spec.whatwg.org/#readablestream-errored">https://streams.spec.whatwg.org/#readablestream-errored</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-readablestream-errored">4.15. Wait and queue a report</a> <a href="#ref-for-readablestream-errored①">(2)</a>
    <li><a href="#ref-for-readablestream-errored②">4.17.4. Dump to another stream</a> <a href="#ref-for-readablestream-errored③">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-readablestream-get-a-reader">
   <a href="https://streams.spec.whatwg.org/#readablestream-get-a-reader">https://streams.spec.whatwg.org/#readablestream-get-a-reader</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-readablestream-get-a-reader">4.5.1. Handling the certificate reference</a>
    <li><a href="#ref-for-readablestream-get-a-reader①">4.17.1. Create a read buffer</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-readablestream-need-more-data">
   <a href="https://streams.spec.whatwg.org/#readablestream-need-more-data">https://streams.spec.whatwg.org/#readablestream-need-more-data</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-readablestream-need-more-data">4.17.4. Dump to another stream</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-readablestream-readable">
   <a href="https://streams.spec.whatwg.org/#readablestream-readable">https://streams.spec.whatwg.org/#readablestream-readable</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-readablestream-readable">4.17.4. Dump to another stream</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-url-equals">
   <a href="https://url.spec.whatwg.org/#concept-url-equals">https://url.spec.whatwg.org/#concept-url-equals</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-url-equals">4.13. Request matching</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-url-fragment">
   <a href="https://url.spec.whatwg.org/#concept-url-fragment">https://url.spec.whatwg.org/#concept-url-fragment</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-url-fragment">4.4. Parsing the invariant prefix</a>
    <li><a href="#ref-for-concept-url-fragment①">4.5. Parsing a Signature Header Field</a> <a href="#ref-for-concept-url-fragment②">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-url-origin">
   <a href="https://url.spec.whatwg.org/#concept-url-origin">https://url.spec.whatwg.org/#concept-url-origin</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-url-origin">4.3. Parsing signed exchanges</a>
    <li><a href="#ref-for-concept-url-origin①">4.8. Cross-origin trust</a> <a href="#ref-for-concept-url-origin②">(2)</a> <a href="#ref-for-concept-url-origin③">(3)</a>
    <li><a href="#ref-for-concept-url-origin④">4.16. Queuing signed exchange report</a> <a href="#ref-for-concept-url-origin⑤">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-url-scheme">
   <a href="https://url.spec.whatwg.org/#concept-url-scheme">https://url.spec.whatwg.org/#concept-url-scheme</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-url-scheme">4.4. Parsing the invariant prefix</a>
    <li><a href="#ref-for-concept-url-scheme①">4.5. Parsing a Signature Header Field</a> <a href="#ref-for-concept-url-scheme②">(2)</a>
    <li><a href="#ref-for-concept-url-scheme③">4.16. Queuing signed exchange report</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-url">
   <a href="https://url.spec.whatwg.org/#concept-url">https://url.spec.whatwg.org/#concept-url</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-url">3.1. Exchange</a>
    <li><a href="#ref-for-concept-url①">3.4. Signed Exchange report</a> <a href="#ref-for-concept-url②">(2)</a>
    <li><a href="#ref-for-concept-url③">3.5. Exchange Signature</a>
    <li><a href="#ref-for-concept-url④">4.4. Parsing the invariant prefix</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-url-parser">
   <a href="https://url.spec.whatwg.org/#concept-url-parser">https://url.spec.whatwg.org/#concept-url-parser</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-url-parser">4.4. Parsing the invariant prefix</a>
    <li><a href="#ref-for-concept-url-parser①">4.5. Parsing a Signature Header Field</a> <a href="#ref-for-concept-url-parser②">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-url-serializer">
   <a href="https://url.spec.whatwg.org/#concept-url-serializer">https://url.spec.whatwg.org/#concept-url-serializer</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-url-serializer">2.4. Monkeypatch HTTP fetch</a>
    <li><a href="#ref-for-concept-url-serializer①">4.16. Queuing signed exchange report</a> <a href="#ref-for-concept-url-serializer②">(2)</a> <a href="#ref-for-concept-url-serializer③">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-idl-ArrayBuffer">
   <a href="https://heycam.github.io/webidl/#idl-ArrayBuffer">https://heycam.github.io/webidl/#idl-ArrayBuffer</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-idl-ArrayBuffer">4.17.4. Dump to another stream</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-idl-Uint8Array">
   <a href="https://heycam.github.io/webidl/#idl-Uint8Array">https://heycam.github.io/webidl/#idl-Uint8Array</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-idl-Uint8Array">4.17.2. Read up to bytes</a> <a href="#ref-for-idl-Uint8Array①">(2)</a>
    <li><a href="#ref-for-idl-Uint8Array②">4.17.4. Dump to another stream</a> <a href="#ref-for-idl-Uint8Array③">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-sequence-type">
   <a href="https://heycam.github.io/webidl/#sequence-type">https://heycam.github.io/webidl/#sequence-type</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-sequence-type">4.16. Queuing signed exchange report</a>
   </ul>
  </aside>
  <h3 class="no-num no-ref heading settled" id="index-defined-elsewhere"><span class="content">Terms defined by reference</span><a class="self-link" href="#index-defined-elsewhere"></a></h3>
  <ul class="index">
   <li>
    <a data-link-type="biblio">[draft-ietf-httpbis-header-structure]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-section-4.2">parsing http1 header fields into structured headers</span>
    </ul>
   <li>
    <a data-link-type="biblio">[draft-ietf-httpbis-variants]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-variant-key">variant-key</span>
     <li><span class="dfn-paneled" id="term-for-variants">variants</span>
     <li><span class="dfn-paneled" id="term-for-cache">variants cache behavior</span>
    </ul>
   <li>
    <a data-link-type="biblio">[draft-thomson-http-mice]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-section-2.2">integrity proof for the first record</span>
    </ul>
   <li>
    <a data-link-type="biblio">[draft-yasskin-http-origin-signed-responses]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-seccons-off-path">off-path attackers</span>
     <li><span class="dfn-paneled" id="term-for-uncached-headers">uncached response header</span>
    </ul>
   <li>
    <a data-link-type="biblio">[draft-yasskin-httpbis-origin-signed-exchanges-impl-02]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-section-3.4">canonically-encoded cbor</span>
     <li><span class="dfn-paneled" id="term-for-section-4.2①">cansignhttpexchanges</span>
     <li><span class="dfn-paneled" id="term-for-section-3.3">cert-chain cddl</span>
    </ul>
   <li>
    <a data-link-type="biblio">[draft-yasskin-wpack-bundled-exchanges]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-parse-known-length">parsing a cbor item</span>
    </ul>
   <li>
    <a data-link-type="biblio">[ENCODING]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-utf-8-decode-without-bom-or-fail">utf-8 decode without bom or fail</span>
    </ul>
   <li>
    <a data-link-type="biblio">[FETCH]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-dom-requestcache-only-if-cached">"only-if-cached"</span>
     <li><span class="dfn-paneled" id="term-for-request">Request</span>
     <li><span class="dfn-paneled" id="term-for-concept-header-list-append">append</span>
     <li><span class="dfn-paneled" id="term-for-concept-response-body">body <small>(for response)</small></span>
     <li><span class="dfn-paneled" id="term-for-dom-request-cache">cache</span>
     <li><span class="dfn-paneled" id="term-for-concept-request-cache-mode">cache mode</span>
     <li><span class="dfn-paneled" id="term-for-concept-request-client">client</span>
     <li><span class="dfn-paneled" id="term-for-concept-response-clone">clone <small>(for response)</small></span>
     <li><span class="dfn-paneled" id="term-for-dom-request-clone">clone()</span>
     <li><span class="dfn-paneled" id="term-for-header-list-contains">contains</span>
     <li><span class="dfn-paneled" id="term-for-determine-nosniff">determine nosniff</span>
     <li><span class="dfn-paneled" id="term-for-header-list-contains①">does not contain</span>
     <li><span class="dfn-paneled" id="term-for-concept-header-extract-mime-type">extracting a mime type</span>
     <li><span class="dfn-paneled" id="term-for-extract-header-list-values">extracting header list values</span>
     <li><span class="dfn-paneled" id="term-for-concept-fetch">fetch</span>
     <li><span class="dfn-paneled" id="term-for-dom-global-fetch">fetch(input)</span>
     <li><span class="dfn-paneled" id="term-for-concept-header-list-get">get</span>
     <li><span class="dfn-paneled" id="term-for-concept-header-list-get-decode-split">getting, decoding, and splitting</span>
     <li><span class="dfn-paneled" id="term-for-handle-content-codings">handle content codings</span>
     <li><span class="dfn-paneled" id="term-for-concept-response-header-list">header list <small>(for response)</small></span>
     <li><span class="dfn-paneled" id="term-for-concept-http-fetch">http fetch</span>
     <li><span class="dfn-paneled" id="term-for-concept-http-network-fetch">http-network fetch</span>
     <li><span class="dfn-paneled" id="term-for-concept-http-network-or-cache-fetch">http-network-or-cache fetch</span>
     <li><span class="dfn-paneled" id="term-for-concept-request-initiator">initiator</span>
     <li><span class="dfn-paneled" id="term-for-concept-request-method">method</span>
     <li><span class="dfn-paneled" id="term-for-concept-request-mode">mode</span>
     <li><span class="dfn-paneled" id="term-for-concept-header-name">name</span>
     <li><span class="dfn-paneled" id="term-for-concept-network-error">network error</span>
     <li><span class="dfn-paneled" id="term-for-redirect-status">redirect status</span>
     <li><span class="dfn-paneled" id="term-for-concept-request">request</span>
     <li><span class="dfn-paneled" id="term-for-concept-response">response</span>
     <li><span class="dfn-paneled" id="term-for-request-service-workers-mode">service-workers mode</span>
     <li><span class="dfn-paneled" id="term-for-concept-header-list-set">set</span>
     <li><span class="dfn-paneled" id="term-for-concept-response-status">status <small>(for response)</small></span>
     <li><span class="dfn-paneled" id="term-for-concept-body-stream">stream</span>
     <li><span class="dfn-paneled" id="term-for-concept-response-url">url <small>(for response)</small></span>
     <li><span class="dfn-paneled" id="term-for-concept-header-value">value</span>
    </ul>
   <li>
    <a data-link-type="biblio">[HTML]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-environment-settings-object">environment settings object</span>
     <li><span class="dfn-paneled" id="term-for-concept-origin-host">host</span>
     <li><span class="dfn-paneled" id="term-for-in-parallel">in parallel</span>
     <li><span class="dfn-paneled" id="term-for-concept-origin">origin</span>
     <li><span class="dfn-paneled" id="term-for-same-origin">same origin</span>
    </ul>
   <li>
    <a data-link-type="biblio">[http-dig-alg]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-http-dig-alg-1">digest algorithm</span>
    </ul>
   <li>
    <a data-link-type="biblio">[INFRA]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-ascii-byte">ascii byte</span>
     <li><span class="dfn-paneled" id="term-for-ascii-decode">ascii decode</span>
     <li><span class="dfn-paneled" id="term-for-ascii-encode">ascii encode</span>
     <li><span class="dfn-paneled" id="term-for-ascii-string">ascii string</span>
     <li><span class="dfn-paneled" id="term-for-ascii-upper-alpha">ascii upper alpha</span>
     <li><span class="dfn-paneled" id="term-for-byte-sequence">byte sequence</span>
     <li><span class="dfn-paneled" id="term-for-list-empty">empty</span>
     <li><span class="dfn-paneled" id="term-for-set-intersection">intersection</span>
     <li><span class="dfn-paneled" id="term-for-isomorphic-decode">isomorphic decode</span>
     <li><span class="dfn-paneled" id="term-for-list-item">item</span>
     <li><span class="dfn-paneled" id="term-for-list">list</span>
     <li><span class="dfn-paneled" id="term-for-strictly-split">strictly split</span>
     <li><span class="dfn-paneled" id="term-for-struct">struct</span>
     <li><span class="dfn-paneled" id="term-for-tuple">tuple</span>
    </ul>
   <li>
    <a data-link-type="biblio">[MIMESNIFF]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-mime-type-essence">essence</span>
     <li><span class="dfn-paneled" id="term-for-mime-type">mime type</span>
     <li><span class="dfn-paneled" id="term-for-parameters">parameters</span>
    </ul>
   <li>
    <a data-link-type="biblio">[network-error-logging-1]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-deliver-a-network-report">deliver a network report</span>
     <li><span class="dfn-paneled" id="term-for-generate-a-network-error-report">generate a network error report</span>
     <li><span class="dfn-paneled" id="term-for-dfn-nel-policies">nel policy</span>
    </ul>
   <li>
    <a data-link-type="biblio">[rfc3230]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-section-4.3.2">digest</span>
    </ul>
   <li>
    <a data-link-type="biblio">[RFC5280]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-section-4.1.1.2">algorithmidentifier</span>
     <li><span class="dfn-paneled" id="term-for-section-4.2②">certificate extensions</span>
     <li><span class="dfn-paneled" id="term-for-section-4.1.2.7">subject public key info</span>
    </ul>
   <li>
    <a data-link-type="biblio">[rfc5480]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-section-2.1.1">id-ecpublickey</span>
     <li><span class="dfn-paneled" id="term-for-section-2.1.1.1">secp256r1</span>
    </ul>
   <li>
    <a data-link-type="biblio">[rfc6960]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-section-4.2.1">ocspresponse</span>
    </ul>
   <li>
    <a data-link-type="biblio">[RFC6962]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-section-3.3①">signedcertificatetimestamplist</span>
    </ul>
   <li>
    <a data-link-type="biblio">[rfc7231]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-section-7.1.1.2">date</span>
    </ul>
   <li>
    <a data-link-type="biblio">[RFC8446]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-section-4.2.3">ecdsa_secp256r1_sha256</span>
    </ul>
   <li>
    <a data-link-type="biblio">[secure-contexts]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-potentially-trustworthy-origin">potentially trustworthy origin</span>
    </ul>
   <li>
    <a data-link-type="biblio">[service-workers-1]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-fetchevent">FetchEvent</span>
     <li><span class="dfn-paneled" id="term-for-dom-serviceworkerregistration-navigationpreload">navigationPreload</span>
     <li><span class="dfn-paneled" id="term-for-dom-fetchevent-preloadresponse">preloadResponse</span>
     <li><span class="dfn-paneled" id="term-for-dom-fetchevent-request">request</span>
    </ul>
   <li>
    <a data-link-type="biblio">[SHA2]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-">sha-256</span>
    </ul>
   <li>
    <a data-link-type="biblio">[STREAMS]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-readablestream">ReadableStream</span>
     <li><span class="dfn-paneled" id="term-for-readablestreamdefaultreader">ReadableStreamDefaultReader</span>
     <li><span class="dfn-paneled" id="term-for-readablestream-cancel">cancel</span>
     <li><span class="dfn-paneled" id="term-for-readablestream-close">close</span>
     <li><span class="dfn-paneled" id="term-for-readablestream-closed">closed</span>
     <li><span class="dfn-paneled" id="term-for-readablestream-enqueue">enqueue</span>
     <li><span class="dfn-paneled" id="term-for-readablestream-error">error</span>
     <li><span class="dfn-paneled" id="term-for-readablestream-errored">errored</span>
     <li><span class="dfn-paneled" id="term-for-readablestream-get-a-reader">get a reader</span>
     <li><span class="dfn-paneled" id="term-for-readablestream-need-more-data">need more data</span>
     <li><span class="dfn-paneled" id="term-for-readablestream-readable">readable</span>
    </ul>
   <li>
    <a data-link-type="biblio">[URL]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-concept-url-equals">equal</span>
     <li><span class="dfn-paneled" id="term-for-concept-url-fragment">fragment</span>
     <li><span class="dfn-paneled" id="term-for-concept-url-origin">origin</span>
     <li><span class="dfn-paneled" id="term-for-concept-url-scheme">scheme</span>
     <li><span class="dfn-paneled" id="term-for-concept-url">url</span>
     <li><span class="dfn-paneled" id="term-for-concept-url-parser">url parser</span>
     <li><span class="dfn-paneled" id="term-for-concept-url-serializer">url serializer</span>
    </ul>
   <li>
    <a data-link-type="biblio">[WebIDL]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-idl-ArrayBuffer">ArrayBuffer</span>
     <li><span class="dfn-paneled" id="term-for-idl-Uint8Array">Uint8Array</span>
     <li><span class="dfn-paneled" id="term-for-sequence-type">sequence type</span>
    </ul>
  </ul>
  <h2 class="no-num no-ref heading settled" id="references"><span class="content">References</span><a class="self-link" href="#references"></a></h2>
  <h3 class="no-num no-ref heading settled" id="normative"><span class="content">Normative References</span><a class="self-link" href="#normative"></a></h3>
  <dl>
   <dt id="biblio-draft-ietf-httpbis-variants">[DRAFT-IETF-HTTPBIS-VARIANTS]
   <dd>Mark Nottingham. <a href="https://httpwg.org/http-extensions/draft-ietf-httpbis-variants.html">HTTP Representation Variants</a>. WD. URL: <a href="https://httpwg.org/http-extensions/draft-ietf-httpbis-variants.html">https://httpwg.org/http-extensions/draft-ietf-httpbis-variants.html</a>
   <dt id="biblio-draft-thomson-http-mice">[DRAFT-THOMSON-HTTP-MICE]
   <dd>Martin Thomson. <a href="https://tools.ietf.org/html/draft-thomson-http-mice-03">Merkle Integrity Content Encoding</a>. ED. URL: <a href="https://tools.ietf.org/html/draft-thomson-http-mice-03">https://tools.ietf.org/html/draft-thomson-http-mice-03</a>
   <dt id="biblio-draft-yasskin-http-origin-signed-responses">[DRAFT-YASSKIN-HTTP-ORIGIN-SIGNED-RESPONSES]
   <dd>Jeffrey Yasskin. <a href="https://wicg.github.io/webpackage/draft-yasskin-http-origin-signed-responses.html">Signed HTTP Exchanges</a>. ED. URL: <a href="https://wicg.github.io/webpackage/draft-yasskin-http-origin-signed-responses.html">https://wicg.github.io/webpackage/draft-yasskin-http-origin-signed-responses.html</a>
   <dt id="biblio-draft-yasskin-httpbis-origin-signed-exchanges-impl-02">[DRAFT-YASSKIN-HTTPBIS-ORIGIN-SIGNED-EXCHANGES-IMPL-02]
   <dd>Jeffrey Yasskin; Kouhei Ueno. <a href="https://tools.ietf.org/html/draft-yasskin-httpbis-origin-signed-exchanges-impl-02">Signed HTTP Exchanges Implementation Checkpoints</a>. ED. URL: <a href="https://tools.ietf.org/html/draft-yasskin-httpbis-origin-signed-exchanges-impl-02">https://tools.ietf.org/html/draft-yasskin-httpbis-origin-signed-exchanges-impl-02</a>
   <dt id="biblio-draft-yasskin-wpack-bundled-exchanges">[DRAFT-YASSKIN-WPACK-BUNDLED-EXCHANGES]
   <dd>Jeffrey Yasskin. <a href="https://wicg.github.io/webpackage/draft-yasskin-wpack-bundled-exchanges.html">Web Bundles</a>. ED. URL: <a href="https://wicg.github.io/webpackage/draft-yasskin-wpack-bundled-exchanges.html">https://wicg.github.io/webpackage/draft-yasskin-wpack-bundled-exchanges.html</a>
   <dt id="biblio-encoding">[ENCODING]
   <dd>Anne van Kesteren. <a href="https://encoding.spec.whatwg.org/">Encoding Standard</a>. Living Standard. URL: <a href="https://encoding.spec.whatwg.org/">https://encoding.spec.whatwg.org/</a>
   <dt id="biblio-fetch">[FETCH]
   <dd>Anne van Kesteren. <a href="https://fetch.spec.whatwg.org/">Fetch Standard</a>. Living Standard. URL: <a href="https://fetch.spec.whatwg.org/">https://fetch.spec.whatwg.org/</a>
   <dt id="biblio-html">[HTML]
   <dd>Anne van Kesteren; et al. <a href="https://html.spec.whatwg.org/multipage/">HTML Standard</a>. Living Standard. URL: <a href="https://html.spec.whatwg.org/multipage/">https://html.spec.whatwg.org/multipage/</a>
   <dt id="biblio-infra">[INFRA]
   <dd>Anne van Kesteren; Domenic Denicola. <a href="https://infra.spec.whatwg.org/">Infra Standard</a>. Living Standard. URL: <a href="https://infra.spec.whatwg.org/">https://infra.spec.whatwg.org/</a>
   <dt id="biblio-mimesniff">[MIMESNIFF]
   <dd>Gordon P. Hemsley. <a href="https://mimesniff.spec.whatwg.org/">MIME Sniffing Standard</a>. Living Standard. URL: <a href="https://mimesniff.spec.whatwg.org/">https://mimesniff.spec.whatwg.org/</a>
   <dt id="biblio-network-error-logging-1">[NETWORK-ERROR-LOGGING-1]
   <dd>Douglas Creager; et al. <a href="https://www.w3.org/TR/network-error-logging-1/">Network Error Logging</a>. 25 September 2018. WD. URL: <a href="https://www.w3.org/TR/network-error-logging-1/">https://www.w3.org/TR/network-error-logging-1/</a>
   <dt id="biblio-rfc2119">[RFC2119]
   <dd>S. Bradner. <a href="https://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>. March 1997. Best Current Practice. URL: <a href="https://tools.ietf.org/html/rfc2119">https://tools.ietf.org/html/rfc2119</a>
   <dt id="biblio-rfc5280">[RFC5280]
   <dd>D. Cooper; et al. <a href="https://tools.ietf.org/html/rfc5280">Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile</a>. May 2008. Proposed Standard. URL: <a href="https://tools.ietf.org/html/rfc5280">https://tools.ietf.org/html/rfc5280</a>
   <dt id="biblio-rfc5480">[RFC5480]
   <dd>S. Turner; et al. <a href="https://tools.ietf.org/html/rfc5480">Elliptic Curve Cryptography Subject Public Key Information</a>. March 2009. Proposed Standard. URL: <a href="https://tools.ietf.org/html/rfc5480">https://tools.ietf.org/html/rfc5480</a>
   <dt id="biblio-rfc6960">[RFC6960]
   <dd>S. Santesson; et al. <a href="https://tools.ietf.org/html/rfc6960">X.509 Internet Public Key Infrastructure Online Certificate Status Protocol - OCSP</a>. June 2013. Proposed Standard. URL: <a href="https://tools.ietf.org/html/rfc6960">https://tools.ietf.org/html/rfc6960</a>
   <dt id="biblio-rfc6962">[RFC6962]
   <dd>B. Laurie; A. Langley; E. Kasper. <a href="https://tools.ietf.org/html/rfc6962">Certificate Transparency</a>. June 2013. Experimental. URL: <a href="https://tools.ietf.org/html/rfc6962">https://tools.ietf.org/html/rfc6962</a>
   <dt id="biblio-rfc7231">[RFC7231]
   <dd>R. Fielding, Ed.; J. Reschke, Ed.. <a href="https://httpwg.org/specs/rfc7231.html">Hypertext Transfer Protocol (HTTP/1.1): Semantics and Content</a>. June 2014. Proposed Standard. URL: <a href="https://httpwg.org/specs/rfc7231.html">https://httpwg.org/specs/rfc7231.html</a>
   <dt id="biblio-rfc8446">[RFC8446]
   <dd>E. Rescorla. <a href="https://tools.ietf.org/html/draft-ietf-tls-tls13">The Transport Layer Security (TLS) Protocol Version 1.3</a>. WD. URL: <a href="https://tools.ietf.org/html/draft-ietf-tls-tls13">https://tools.ietf.org/html/draft-ietf-tls-tls13</a>
   <dt id="biblio-secure-contexts">[SECURE-CONTEXTS]
   <dd>Mike West. <a href="https://www.w3.org/TR/secure-contexts/">Secure Contexts</a>. 15 September 2016. CR. URL: <a href="https://www.w3.org/TR/secure-contexts/">https://www.w3.org/TR/secure-contexts/</a>
   <dt id="biblio-sha2">[SHA2]
   <dd><a href="http://nvlpubs.nist.gov/nistpubs/FIPS/NIST.FIPS.180-4.pdf">FIPS PUB 180-4, Secure Hash Standard</a>. URL: <a href="http://nvlpubs.nist.gov/nistpubs/FIPS/NIST.FIPS.180-4.pdf">http://nvlpubs.nist.gov/nistpubs/FIPS/NIST.FIPS.180-4.pdf</a>
   <dt id="biblio-streams">[STREAMS]
   <dd>Adam Rice; Domenic Denicola; 吉野剛史 (Takeshi Yoshino). <a href="https://streams.spec.whatwg.org/">Streams Standard</a>. Living Standard. URL: <a href="https://streams.spec.whatwg.org/">https://streams.spec.whatwg.org/</a>
   <dt id="biblio-url">[URL]
   <dd>Anne van Kesteren. <a href="https://url.spec.whatwg.org/">URL Standard</a>. Living Standard. URL: <a href="https://url.spec.whatwg.org/">https://url.spec.whatwg.org/</a>
   <dt id="biblio-webidl">[WebIDL]
   <dd>Boris Zbarsky. <a href="https://heycam.github.io/webidl/">Web IDL</a>. 15 December 2016. ED. URL: <a href="https://heycam.github.io/webidl/">https://heycam.github.io/webidl/</a>
  </dl>
  <h3 class="no-num no-ref heading settled" id="informative"><span class="content">Informative References</span><a class="self-link" href="#informative"></a></h3>
  <dl>
   <dt id="biblio-draft-yasskin-httpbis-origin-signed-exchanges-impl-03">[DRAFT-YASSKIN-HTTPBIS-ORIGIN-SIGNED-EXCHANGES-IMPL-03]
   <dd>Jeffrey Yasskin; Kouhei Ueno. <a href="https://tools.ietf.org/html/draft-yasskin-httpbis-origin-signed-exchanges-impl-03">Signed HTTP Exchanges Implementation Checkpoints</a>. ED. URL: <a href="https://tools.ietf.org/html/draft-yasskin-httpbis-origin-signed-exchanges-impl-03">https://tools.ietf.org/html/draft-yasskin-httpbis-origin-signed-exchanges-impl-03</a>
   <dt id="biblio-http-dig-alg">[HTTP-DIG-ALG]
   <dd><a href="https://www.iana.org/assignments/http-dig-alg/http-dig-alg.xhtml">Hypertext Transfer Protocol (HTTP) Digest Algorithm Values</a>. LS. URL: <a href="https://www.iana.org/assignments/http-dig-alg/http-dig-alg.xhtml">https://www.iana.org/assignments/http-dig-alg/http-dig-alg.xhtml</a>
   <dt id="biblio-rfc3230">[RFC3230]
   <dd>J. Mogul; A. Van Hoff. <a href="https://tools.ietf.org/html/rfc3230">Instance Digests in HTTP</a>. January 2002. Proposed Standard. URL: <a href="https://tools.ietf.org/html/rfc3230">https://tools.ietf.org/html/rfc3230</a>
   <dt id="biblio-service-workers-1">[SERVICE-WORKERS-1]
   <dd>Alex Russell; et al. <a href="https://www.w3.org/TR/service-workers-1/">Service Workers 1</a>. 19 November 2019. CR. URL: <a href="https://www.w3.org/TR/service-workers-1/">https://www.w3.org/TR/service-workers-1/</a>
  </dl>
  <h2 class="no-num no-ref heading settled" id="issues-index"><span class="content">Issues Index</span><a class="self-link" href="#issues-index"></a></h2>
  <div style="counter-reset:issue">
   <div class="issue"> Our security reviewers aren’t sure we should
allow UAs to take clock skew into account. <a href="https://github.com/WICG/webpackage/issues/141">&lt;https://github.com/WICG/webpackage/issues/141></a><a href="#issue-a7ea6416"> ↵ </a></div>
   <div class="issue"> This depends on the <a data-link-type="dfn" href="https://httpwg.org/http-extensions/draft-ietf-httpbis-variants.html#cache">Variants Cache
Behavior</a> returning a list of lists. <a href="https://github.com/httpwg/http-extensions/issues/744">&lt;https://github.com/httpwg/http-extensions/issues/744></a><a href="#issue-e1733bef"> ↵ </a></div>
   <div class="issue"> The algorithms in this section create and operate over
ECMAScript objects like <code class="idl"><a data-link-type="idl" href="https://streams.spec.whatwg.org/#readablestream">ReadableStream</a></code> despite not having a Realm to attach
them to. <a href="https://github.com/whatwg/fetch/issues/730">&lt;https://github.com/whatwg/fetch/issues/730></a><a href="#issue-3ffca592"> ↵ </a></div>
  </div>
  <aside class="dfn-panel" data-for="request-stashed-exchange">
   <b><a href="#request-stashed-exchange">#request-stashed-exchange</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-request-stashed-exchange">2.2. Request clone</a> <a href="#ref-for-request-stashed-exchange①">(2)</a> <a href="#ref-for-request-stashed-exchange②">(3)</a> <a href="#ref-for-request-stashed-exchange③">(4)</a> <a href="#ref-for-request-stashed-exchange④">(5)</a>
    <li><a href="#ref-for-request-stashed-exchange⑤">2.4. Monkeypatch HTTP fetch</a>
    <li><a href="#ref-for-request-stashed-exchange⑥">2.5. Monkeypatch HTTP-network-or-cache fetch</a> <a href="#ref-for-request-stashed-exchange⑦">(2)</a> <a href="#ref-for-request-stashed-exchange⑧">(3)</a> <a href="#ref-for-request-stashed-exchange⑨">(4)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="response-date">
   <b><a href="#response-date">#response-date</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-response-date">2.5. Monkeypatch HTTP-network-or-cache fetch</a> <a href="#ref-for-response-date①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="exchange">
   <b><a href="#exchange">#exchange</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-exchange">2.1. A request’s stashed exchange</a>
    <li><a href="#ref-for-exchange①">2.4. Monkeypatch HTTP fetch</a>
    <li><a href="#ref-for-exchange">3.1. Exchange</a>
    <li><a href="#ref-for-exchange②">4.3. Parsing signed exchanges</a>
    <li><a href="#ref-for-exchange③">4.8. Cross-origin trust</a>
    <li><a href="#ref-for-exchange④">4.10. Parsing b2 CBOR headers</a> <a href="#ref-for-exchange⑤">(2)</a>
    <li><a href="#ref-for-exchange⑥">4.11. Parsing b3 CBOR headers</a> <a href="#ref-for-exchange⑦">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="exchange-request-url">
   <b><a href="#exchange-request-url">#exchange-request-url</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-exchange-request-url">2.2. Request clone</a> <a href="#ref-for-exchange-request-url①">(2)</a>
    <li><a href="#ref-for-exchange-request-url②">2.4. Monkeypatch HTTP fetch</a>
    <li><a href="#ref-for-exchange-request-url③">4.8. Cross-origin trust</a>
    <li><a href="#ref-for-exchange-request-url④">4.13. Request matching</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="exchange-response">
   <b><a href="#exchange-response">#exchange-response</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-exchange-response">2.2. Request clone</a> <a href="#ref-for-exchange-response①">(2)</a>
    <li><a href="#ref-for-exchange-response②">2.5. Monkeypatch HTTP-network-or-cache fetch</a> <a href="#ref-for-exchange-response③">(2)</a>
    <li><a href="#ref-for-exchange-response④">4.3. Parsing signed exchanges</a> <a href="#ref-for-exchange-response⑤">(2)</a> <a href="#ref-for-exchange-response⑥">(3)</a> <a href="#ref-for-exchange-response⑦">(4)</a>
    <li><a href="#ref-for-exchange-response⑧">4.8. Cross-origin trust</a>
    <li><a href="#ref-for-exchange-response⑨">4.13. Request matching</a> <a href="#ref-for-exchange-response①⓪">(2)</a> <a href="#ref-for-exchange-response①①">(3)</a> <a href="#ref-for-exchange-response①②">(4)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="read-buffer">
   <b><a href="#read-buffer">#read-buffer</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-read-buffer">3.2. Read buffer</a>
    <li><a href="#ref-for-read-buffer">4.4. Parsing the invariant prefix</a>
    <li><a href="#ref-for-read-buffer①">4.12. Creating the response stream.</a>
    <li><a href="#ref-for-read-buffer②">4.17.1. Create a read buffer</a>
    <li><a href="#ref-for-read-buffer③">4.17.2. Read up to bytes</a>
    <li><a href="#ref-for-read-buffer④">4.17.3. Read bytes</a>
    <li><a href="#ref-for-read-buffer⑤">4.17.4. Dump to another stream</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="read-buffer-stream">
   <b><a href="#read-buffer-stream">#read-buffer-stream</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-read-buffer-stream">3.2. Read buffer</a> <a href="#ref-for-read-buffer-stream①">(2)</a>
    <li><a href="#ref-for-read-buffer-stream②">4.12. Creating the response stream.</a>
    <li><a href="#ref-for-read-buffer-stream③">4.17.1. Create a read buffer</a>
    <li><a href="#ref-for-read-buffer-stream④">4.17.4. Dump to another stream</a> <a href="#ref-for-read-buffer-stream⑤">(2)</a> <a href="#ref-for-read-buffer-stream⑥">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="read-buffer-reader">
   <b><a href="#read-buffer-reader">#read-buffer-reader</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-read-buffer-reader">4.17.1. Create a read buffer</a>
    <li><a href="#ref-for-read-buffer-reader①">4.17.2. Read up to bytes</a>
    <li><a href="#ref-for-read-buffer-reader②">4.17.4. Dump to another stream</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="read-buffer-bytes">
   <b><a href="#read-buffer-bytes">#read-buffer-bytes</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-read-buffer-bytes">4.17.1. Create a read buffer</a>
    <li><a href="#ref-for-read-buffer-bytes①">4.17.2. Read up to bytes</a> <a href="#ref-for-read-buffer-bytes②">(2)</a> <a href="#ref-for-read-buffer-bytes③">(3)</a> <a href="#ref-for-read-buffer-bytes④">(4)</a> <a href="#ref-for-read-buffer-bytes⑤">(5)</a> <a href="#ref-for-read-buffer-bytes⑥">(6)</a>
    <li><a href="#ref-for-read-buffer-bytes⑦">4.17.4. Dump to another stream</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="augmented-certificate">
   <b><a href="#augmented-certificate">#augmented-certificate</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-augmented-certificate">3.3. Augmented Certificate</a> <a href="#ref-for-augmented-certificate">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="augmented-certificate-certificate">
   <b><a href="#augmented-certificate-certificate">#augmented-certificate-certificate</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-augmented-certificate-certificate">3.3. Augmented Certificate</a> <a href="#ref-for-augmented-certificate-certificate①">(2)</a> <a href="#ref-for-augmented-certificate-certificate②">(3)</a> <a href="#ref-for-augmented-certificate-certificate③">(4)</a>
    <li><a href="#ref-for-augmented-certificate-certificate④">4.5.1. Handling the certificate reference</a>
    <li><a href="#ref-for-augmented-certificate-certificate⑤">4.9. Establishing trust in a certificate</a> <a href="#ref-for-augmented-certificate-certificate⑥">(2)</a> <a href="#ref-for-augmented-certificate-certificate⑦">(3)</a> <a href="#ref-for-augmented-certificate-certificate⑧">(4)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="augmented-certificate-ocsp-response">
   <b><a href="#augmented-certificate-ocsp-response">#augmented-certificate-ocsp-response</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-augmented-certificate-ocsp-response">4.9. Establishing trust in a certificate</a> <a href="#ref-for-augmented-certificate-ocsp-response①">(2)</a> <a href="#ref-for-augmented-certificate-ocsp-response②">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="augmented-certificate-sct">
   <b><a href="#augmented-certificate-sct">#augmented-certificate-sct</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-augmented-certificate-sct">4.9. Establishing trust in a certificate</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="certificate-public-key">
   <b><a href="#certificate-public-key">#certificate-public-key</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-certificate-public-key">3.5. Exchange Signature</a>
    <li><a href="#ref-for-certificate-public-key①">4.7. Validating a signature</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="public-key-algorithm">
   <b><a href="#public-key-algorithm">#public-key-algorithm</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-public-key-algorithm">4.7. Validating a signature</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="certificate-extensions">
   <b><a href="#certificate-extensions">#certificate-extensions</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-certificate-extensions">4.9. Establishing trust in a certificate</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="certificate-chain">
   <b><a href="#certificate-chain">#certificate-chain</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-certificate-chain">3.5. Exchange Signature</a>
    <li><a href="#ref-for-certificate-chain①">4.5. Parsing a Signature Header Field</a>
    <li><a href="#ref-for-certificate-chain②">4.5.1. Handling the certificate reference</a> <a href="#ref-for-certificate-chain③">(2)</a>
    <li><a href="#ref-for-certificate-chain④">4.9. Establishing trust in a certificate</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="certificate-chain-leaf">
   <b><a href="#certificate-chain-leaf">#certificate-chain-leaf</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-certificate-chain-leaf">3.5. Exchange Signature</a> <a href="#ref-for-certificate-chain-leaf①">(2)</a> <a href="#ref-for-certificate-chain-leaf②">(3)</a>
    <li><a href="#ref-for-certificate-chain-leaf③">4.5.1. Handling the certificate reference</a>
    <li><a href="#ref-for-certificate-chain-leaf④">4.7. Validating a signature</a>
    <li><a href="#ref-for-certificate-chain-leaf⑤">4.9. Establishing trust in a certificate</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="signed-exchange-report">
   <b><a href="#signed-exchange-report">#signed-exchange-report</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-signed-exchange-report">3.4. Signed Exchange report</a>
    <li><a href="#ref-for-signed-exchange-report">4.3. Parsing signed exchanges</a>
    <li><a href="#ref-for-signed-exchange-report①">4.5. Parsing a Signature Header Field</a>
    <li><a href="#ref-for-signed-exchange-report②">4.5.1. Handling the certificate reference</a>
    <li><a href="#ref-for-signed-exchange-report③">4.14. Create a new signed exchange report</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="signed-exchange-report-result">
   <b><a href="#signed-exchange-report-result">#signed-exchange-report-result</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-signed-exchange-report-result">4.3. Parsing signed exchanges</a>
    <li><a href="#ref-for-signed-exchange-report-result①">4.5. Parsing a Signature Header Field</a>
    <li><a href="#ref-for-signed-exchange-report-result②">4.5.1. Handling the certificate reference</a>
    <li><a href="#ref-for-signed-exchange-report-result③">4.16. Queuing signed exchange report</a> <a href="#ref-for-signed-exchange-report-result④">(2)</a> <a href="#ref-for-signed-exchange-report-result⑤">(3)</a> <a href="#ref-for-signed-exchange-report-result⑥">(4)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="signed-exchange-report-ok">
   <b><a href="#signed-exchange-report-ok">#signed-exchange-report-ok</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-signed-exchange-report-ok">4.15. Wait and queue a report</a>
    <li><a href="#ref-for-signed-exchange-report-ok①">4.16. Queuing signed exchange report</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="signed-exchange-report-mi_error">
   <b><a href="#signed-exchange-report-mi_error">#signed-exchange-report-mi_error</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-signed-exchange-report-mi_error">4.15. Wait and queue a report</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="signed-exchange-report-non_secure_distributor">
   <b><a href="#signed-exchange-report-non_secure_distributor">#signed-exchange-report-non_secure_distributor</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-signed-exchange-report-non_secure_distributor">4.3. Parsing signed exchanges</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="signed-exchange-report-parse_error">
   <b><a href="#signed-exchange-report-parse_error">#signed-exchange-report-parse_error</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-signed-exchange-report-parse_error">4.3. Parsing signed exchanges</a> <a href="#ref-for-signed-exchange-report-parse_error①">(2)</a> <a href="#ref-for-signed-exchange-report-parse_error②">(3)</a> <a href="#ref-for-signed-exchange-report-parse_error③">(4)</a> <a href="#ref-for-signed-exchange-report-parse_error④">(5)</a> <a href="#ref-for-signed-exchange-report-parse_error⑤">(6)</a> <a href="#ref-for-signed-exchange-report-parse_error⑥">(7)</a> <a href="#ref-for-signed-exchange-report-parse_error⑦">(8)</a>
    <li><a href="#ref-for-signed-exchange-report-parse_error⑧">4.5. Parsing a Signature Header Field</a> <a href="#ref-for-signed-exchange-report-parse_error⑨">(2)</a> <a href="#ref-for-signed-exchange-report-parse_error①⓪">(3)</a> <a href="#ref-for-signed-exchange-report-parse_error①①">(4)</a> <a href="#ref-for-signed-exchange-report-parse_error①②">(5)</a> <a href="#ref-for-signed-exchange-report-parse_error①③">(6)</a> <a href="#ref-for-signed-exchange-report-parse_error①④">(7)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="signed-exchange-report-invalid_integrity_header">
   <b><a href="#signed-exchange-report-invalid_integrity_header">#signed-exchange-report-invalid_integrity_header</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-signed-exchange-report-invalid_integrity_header">4.12. Creating the response stream.</a> <a href="#ref-for-signed-exchange-report-invalid_integrity_header①">(2)</a> <a href="#ref-for-signed-exchange-report-invalid_integrity_header②">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="signed-exchange-report-signature_verification_error">
   <b><a href="#signed-exchange-report-signature_verification_error">#signed-exchange-report-signature_verification_error</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-signed-exchange-report-signature_verification_error">4.3. Parsing signed exchanges</a>
    <li><a href="#ref-for-signed-exchange-report-signature_verification_error①">4.5.1. Handling the certificate reference</a>
    <li><a href="#ref-for-signed-exchange-report-signature_verification_error②">4.16. Queuing signed exchange report</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="signed-exchange-report-cert_verification_error">
   <b><a href="#signed-exchange-report-cert_verification_error">#signed-exchange-report-cert_verification_error</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-signed-exchange-report-cert_verification_error">4.3. Parsing signed exchanges</a>
    <li><a href="#ref-for-signed-exchange-report-cert_verification_error①">4.16. Queuing signed exchange report</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="signed-exchange-report-cert_fetch_error">
   <b><a href="#signed-exchange-report-cert_fetch_error">#signed-exchange-report-cert_fetch_error</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-signed-exchange-report-cert_fetch_error">4.5.1. Handling the certificate reference</a> <a href="#ref-for-signed-exchange-report-cert_fetch_error①">(2)</a>
    <li><a href="#ref-for-signed-exchange-report-cert_fetch_error②">4.16. Queuing signed exchange report</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="signed-exchange-report-cert_parse_error">
   <b><a href="#signed-exchange-report-cert_parse_error">#signed-exchange-report-cert_parse_error</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-signed-exchange-report-cert_parse_error">4.5.1. Handling the certificate reference</a> <a href="#ref-for-signed-exchange-report-cert_parse_error①">(2)</a> <a href="#ref-for-signed-exchange-report-cert_parse_error②">(3)</a>
    <li><a href="#ref-for-signed-exchange-report-cert_parse_error③">4.16. Queuing signed exchange report</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="signed-exchange-report-outer-request">
   <b><a href="#signed-exchange-report-outer-request">#signed-exchange-report-outer-request</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-signed-exchange-report-outer-request">4.14. Create a new signed exchange report</a>
    <li><a href="#ref-for-signed-exchange-report-outer-request①">4.16. Queuing signed exchange report</a> <a href="#ref-for-signed-exchange-report-outer-request②">(2)</a> <a href="#ref-for-signed-exchange-report-outer-request③">(3)</a> <a href="#ref-for-signed-exchange-report-outer-request④">(4)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="signed-exchange-report-outer-response">
   <b><a href="#signed-exchange-report-outer-response">#signed-exchange-report-outer-response</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-signed-exchange-report-outer-response">4.14. Create a new signed exchange report</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="signed-exchange-report-inner-url">
   <b><a href="#signed-exchange-report-inner-url">#signed-exchange-report-inner-url</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-signed-exchange-report-inner-url">4.3. Parsing signed exchanges</a>
    <li><a href="#ref-for-signed-exchange-report-inner-url①">4.16. Queuing signed exchange report</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="signed-exchange-report-cert-url-list">
   <b><a href="#signed-exchange-report-cert-url-list">#signed-exchange-report-cert-url-list</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-signed-exchange-report-cert-url-list">3.4. Signed Exchange report</a>
    <li><a href="#ref-for-signed-exchange-report-cert-url-list①">4.5. Parsing a Signature Header Field</a>
    <li><a href="#ref-for-signed-exchange-report-cert-url-list②">4.16. Queuing signed exchange report</a> <a href="#ref-for-signed-exchange-report-cert-url-list③">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="signed-exchange-report-server-ip">
   <b><a href="#signed-exchange-report-server-ip">#signed-exchange-report-server-ip</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-signed-exchange-report-server-ip">4.14. Create a new signed exchange report</a>
    <li><a href="#ref-for-signed-exchange-report-server-ip①">4.16. Queuing signed exchange report</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="signed-exchange-report-cert-server-ip-list">
   <b><a href="#signed-exchange-report-cert-server-ip-list">#signed-exchange-report-cert-server-ip-list</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-signed-exchange-report-cert-server-ip-list">4.5.1. Handling the certificate reference</a>
    <li><a href="#ref-for-signed-exchange-report-cert-server-ip-list①">4.16. Queuing signed exchange report</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="exchange-signature">
   <b><a href="#exchange-signature">#exchange-signature</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-exchange-signature">3.5. Exchange Signature</a>
    <li><a href="#ref-for-exchange-signature">4.3. Parsing signed exchanges</a>
    <li><a href="#ref-for-exchange-signature①">4.5. Parsing a Signature Header Field</a> <a href="#ref-for-exchange-signature②">(2)</a>
    <li><a href="#ref-for-exchange-signature③">4.6. The signed message</a>
    <li><a href="#ref-for-exchange-signature④">4.7. Validating a signature</a>
    <li><a href="#ref-for-exchange-signature⑤">4.8. Cross-origin trust</a>
    <li><a href="#ref-for-exchange-signature⑥">4.12. Creating the response stream.</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="exchange-signature-signature">
   <b><a href="#exchange-signature-signature">#exchange-signature-signature</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-exchange-signature-signature">3.5. Exchange Signature</a>
    <li><a href="#ref-for-exchange-signature-signature①">4.5. Parsing a Signature Header Field</a>
    <li><a href="#ref-for-exchange-signature-signature②">4.7. Validating a signature</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="exchange-signature-certificate-chain">
   <b><a href="#exchange-signature-certificate-chain">#exchange-signature-certificate-chain</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-exchange-signature-certificate-chain">3.5. Exchange Signature</a>
    <li><a href="#ref-for-exchange-signature-certificate-chain①">4.5. Parsing a Signature Header Field</a>
    <li><a href="#ref-for-exchange-signature-certificate-chain②">4.7. Validating a signature</a>
    <li><a href="#ref-for-exchange-signature-certificate-chain③">4.8. Cross-origin trust</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="exchange-signature-certsha256">
   <b><a href="#exchange-signature-certsha256">#exchange-signature-certsha256</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-exchange-signature-certsha256">4.5. Parsing a Signature Header Field</a> <a href="#ref-for-exchange-signature-certsha256①">(2)</a>
    <li><a href="#ref-for-exchange-signature-certsha256②">4.6. The signed message</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="exchange-signature-integrity-header">
   <b><a href="#exchange-signature-integrity-header">#exchange-signature-integrity-header</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-exchange-signature-integrity-header">4.5. Parsing a Signature Header Field</a>
    <li><a href="#ref-for-exchange-signature-integrity-header①">4.12. Creating the response stream.</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="exchange-signature-validityurl">
   <b><a href="#exchange-signature-validityurl">#exchange-signature-validityurl</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-exchange-signature-validityurl">3.5. Exchange Signature</a>
    <li><a href="#ref-for-exchange-signature-validityurl①">4.5. Parsing a Signature Header Field</a>
    <li><a href="#ref-for-exchange-signature-validityurl②">4.8. Cross-origin trust</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="exchange-signature-validityurlbytes">
   <b><a href="#exchange-signature-validityurlbytes">#exchange-signature-validityurlbytes</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-exchange-signature-validityurlbytes">4.5. Parsing a Signature Header Field</a>
    <li><a href="#ref-for-exchange-signature-validityurlbytes①">4.6. The signed message</a> <a href="#ref-for-exchange-signature-validityurlbytes②">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="exchange-signature-date">
   <b><a href="#exchange-signature-date">#exchange-signature-date</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-exchange-signature-date">4.5. Parsing a Signature Header Field</a> <a href="#ref-for-exchange-signature-date①">(2)</a> <a href="#ref-for-exchange-signature-date②">(3)</a>
    <li><a href="#ref-for-exchange-signature-date③">4.6. The signed message</a>
    <li><a href="#ref-for-exchange-signature-date④">4.7. Validating a signature</a> <a href="#ref-for-exchange-signature-date⑤">(2)</a>
    <li><a href="#ref-for-exchange-signature-date⑥">4.8. Cross-origin trust</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="exchange-signature-expiration-time">
   <b><a href="#exchange-signature-expiration-time">#exchange-signature-expiration-time</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-exchange-signature-expiration-time">1.2. Other interesting details</a>
    <li><a href="#ref-for-exchange-signature-expiration-time①">4.5. Parsing a Signature Header Field</a> <a href="#ref-for-exchange-signature-expiration-time②">(2)</a> <a href="#ref-for-exchange-signature-expiration-time③">(3)</a>
    <li><a href="#ref-for-exchange-signature-expiration-time④">4.6. The signed message</a>
    <li><a href="#ref-for-exchange-signature-expiration-time⑤">4.7. Validating a signature</a> <a href="#ref-for-exchange-signature-expiration-time⑥">(2)</a>
    <li><a href="#ref-for-exchange-signature-expiration-time⑦">4.8. Cross-origin trust</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="signed-exchange-version">
   <b><a href="#signed-exchange-version">#signed-exchange-version</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-signed-exchange-version">2.4. Monkeypatch HTTP fetch</a>
    <li><a href="#ref-for-signed-exchange-version①">4.2. Extracting the fallback URL</a>
    <li><a href="#ref-for-signed-exchange-version②">4.3. Parsing signed exchanges</a> <a href="#ref-for-signed-exchange-version③">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="extracting-the-fallback-url">
   <b><a href="#extracting-the-fallback-url">#extracting-the-fallback-url</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-extracting-the-fallback-url">2.4. Monkeypatch HTTP fetch</a>
    <li><a href="#ref-for-extracting-the-fallback-url①">4.3. Parsing signed exchanges</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="parsing-a-signed-exchange">
   <b><a href="#parsing-a-signed-exchange">#parsing-a-signed-exchange</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-parsing-a-signed-exchange">2.4. Monkeypatch HTTP fetch</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="parsing-the-invariant-prefix">
   <b><a href="#parsing-the-invariant-prefix">#parsing-the-invariant-prefix</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-parsing-the-invariant-prefix">4.2. Extracting the fallback URL</a>
    <li><a href="#ref-for-parsing-the-invariant-prefix①">4.3. Parsing signed exchanges</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="parsing-the-signature-header-field">
   <b><a href="#parsing-the-signature-header-field">#parsing-the-signature-header-field</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-parsing-the-signature-header-field">4.3. Parsing signed exchanges</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="handling-the-certificate-reference">
   <b><a href="#handling-the-certificate-reference">#handling-the-certificate-reference</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-handling-the-certificate-reference">4.5. Parsing a Signature Header Field</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="signed-message">
   <b><a href="#signed-message">#signed-message</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-signed-message">4.7. Validating a signature</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="exchange-signature-is-valid">
   <b><a href="#exchange-signature-is-valid">#exchange-signature-is-valid</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-exchange-signature-is-valid">4.3. Parsing signed exchanges</a>
    <li><a href="#ref-for-exchange-signature-is-valid①">4.8. Cross-origin trust</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="exchange-signature-establishes-cross-origin-trust">
   <b><a href="#exchange-signature-establishes-cross-origin-trust">#exchange-signature-establishes-cross-origin-trust</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-exchange-signature-establishes-cross-origin-trust">4.3. Parsing signed exchanges</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="certificate-chain-has-a-trusted-leaf">
   <b><a href="#certificate-chain-has-a-trusted-leaf">#certificate-chain-has-a-trusted-leaf</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-certificate-chain-has-a-trusted-leaf">4.8. Cross-origin trust</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="parsing-b2-cbor-headers">
   <b><a href="#parsing-b2-cbor-headers">#parsing-b2-cbor-headers</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-parsing-b2-cbor-headers">4.3. Parsing signed exchanges</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="parsing-b3-cbor-headers">
   <b><a href="#parsing-b3-cbor-headers">#parsing-b3-cbor-headers</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-parsing-b3-cbor-headers">4.3. Parsing signed exchanges</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="creating-a-header-list-from-the-cbor-map">
   <b><a href="#creating-a-header-list-from-the-cbor-map">#creating-a-header-list-from-the-cbor-map</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-creating-a-header-list-from-the-cbor-map">4.10. Parsing b2 CBOR headers</a> <a href="#ref-for-creating-a-header-list-from-the-cbor-map①">(2)</a>
    <li><a href="#ref-for-creating-a-header-list-from-the-cbor-map②">4.11. Parsing b3 CBOR headers</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="reading-a-body">
   <b><a href="#reading-a-body">#reading-a-body</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-reading-a-body">4.3. Parsing signed exchanges</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="matches-the-stored-exchange">
   <b><a href="#matches-the-stored-exchange">#matches-the-stored-exchange</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-matches-the-stored-exchange">2.5. Monkeypatch HTTP-network-or-cache fetch</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="create-a-new-signed-exchange-report">
   <b><a href="#create-a-new-signed-exchange-report">#create-a-new-signed-exchange-report</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-create-a-new-signed-exchange-report">2.4. Monkeypatch HTTP fetch</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="wait-and-queue-a-report-for">
   <b><a href="#wait-and-queue-a-report-for">#wait-and-queue-a-report-for</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-wait-and-queue-a-report-for">2.4. Monkeypatch HTTP fetch</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="queue-a-signed-exchange-report">
   <b><a href="#queue-a-signed-exchange-report">#queue-a-signed-exchange-report</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-queue-a-signed-exchange-report">2.4. Monkeypatch HTTP fetch</a>
    <li><a href="#ref-for-queue-a-signed-exchange-report①">4.15. Wait and queue a report</a> <a href="#ref-for-queue-a-signed-exchange-report②">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="new-read-buffer">
   <b><a href="#new-read-buffer">#new-read-buffer</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-new-read-buffer">4.2. Extracting the fallback URL</a>
    <li><a href="#ref-for-new-read-buffer①">4.3. Parsing signed exchanges</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="read-buffer-reading-up-to">
   <b><a href="#read-buffer-reading-up-to">#read-buffer-reading-up-to</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-read-buffer-reading-up-to">4.17.3. Read bytes</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="read-buffer-read">
   <b><a href="#read-buffer-read">#read-buffer-read</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-read-buffer-read">4.3. Parsing signed exchanges</a> <a href="#ref-for-read-buffer-read①">(2)</a> <a href="#ref-for-read-buffer-read②">(3)</a> <a href="#ref-for-read-buffer-read③">(4)</a>
    <li><a href="#ref-for-read-buffer-read④">4.4. Parsing the invariant prefix</a> <a href="#ref-for-read-buffer-read⑤">(2)</a> <a href="#ref-for-read-buffer-read⑥">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="read-buffer-dump">
   <b><a href="#read-buffer-dump">#read-buffer-dump</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-read-buffer-dump">4.12. Creating the response stream.</a>
   </ul>
  </aside>
<script>/* script-dfn-panel */

document.body.addEventListener("click", function(e) {
    var queryAll = function(sel) { return [].slice.call(document.querySelectorAll(sel)); }
    // Find the dfn element or panel, if any, that was clicked on.
    var el = e.target;
    var target;
    var hitALink = false;
    while(el.parentElement) {
        if(el.tagName == "A") {
            // Clicking on a link in a <dfn> shouldn't summon the panel
            hitALink = true;
        }
        if(el.classList.contains("dfn-paneled")) {
            target = "dfn";
            break;
        }
        if(el.classList.contains("dfn-panel")) {
            target = "dfn-panel";
            break;
        }
        el = el.parentElement;
    }
    if(target != "dfn-panel") {
        // Turn off any currently "on" or "activated" panels.
        queryAll(".dfn-panel.on, .dfn-panel.activated").forEach(function(el){
            el.classList.remove("on");
            el.classList.remove("activated");
        });
    }
    if(target == "dfn" && !hitALink) {
        // open the panel
        var dfnPanel = document.querySelector(".dfn-panel[data-for='" + el.id + "']");
        if(dfnPanel) {
            dfnPanel.classList.add("on");
            var rect = el.getBoundingClientRect();
            dfnPanel.style.left = window.scrollX + rect.right + 5 + "px";
            dfnPanel.style.top = window.scrollY + rect.top + "px";
            var panelRect = dfnPanel.getBoundingClientRect();
            var panelWidth = panelRect.right - panelRect.left;
            if(panelRect.right > document.body.scrollWidth && (rect.left - (panelWidth + 5)) > 0) {
                // Reposition, because the panel is overflowing
                dfnPanel.style.left = window.scrollX + rect.left - (panelWidth + 5) + "px";
            }
        } else {
            console.log("Couldn't find .dfn-panel[data-for='" + el.id + "']");
        }
    } else if(target == "dfn-panel") {
        // Switch it to "activated" state, which pins it.
        el.classList.add("activated");
        el.style.left = null;
        el.style.top = null;
    }

});
</script>
<script>/* script-var-click-highlighting */

    document.addEventListener("click", e=>{
        if(e.target.nodeName == "VAR") {
            highlightSameAlgoVars(e.target);
        }
    });
    {
        const indexCounts = new Map();
        const indexNames = new Map();
        function highlightSameAlgoVars(v) {
            // Find the algorithm container.
            let algoContainer = null;
            let searchEl = v;
            while(algoContainer == null && searchEl != document.body) {
                searchEl = searchEl.parentNode;
                if(searchEl.hasAttribute("data-algorithm")) {
                    algoContainer = searchEl;
                }
            }

            // Not highlighting document-global vars,
            // too likely to be unrelated.
            if(algoContainer == null) return;

            const algoName = algoContainer.getAttribute("data-algorithm");
            const varName = getVarName(v);
            const addClass = !v.classList.contains("selected");
            let highlightClass = null;
            if(addClass) {
                const index = chooseHighlightIndex(algoName, varName);
                indexCounts.get(algoName)[index] += 1;
                indexNames.set(algoName+"///"+varName, index);
                highlightClass = nameFromIndex(index);
            } else {
                const index = previousHighlightIndex(algoName, varName);
                indexCounts.get(algoName)[index] -= 1;
                highlightClass = nameFromIndex(index);
            }

            // Find all same-name vars, and toggle their class appropriately.
            for(const el of algoContainer.querySelectorAll("var")) {
                if(getVarName(el) == varName) {
                    el.classList.toggle("selected", addClass);
                    el.classList.toggle(highlightClass, addClass);
                }
            }
        }
        function getVarName(el) {
            return el.textContent.replace(/(\s|\xa0)+/, " ").trim();
        }
        function chooseHighlightIndex(algoName, varName) {
            let indexes = null;
            if(indexCounts.has(algoName)) {
                indexes = indexCounts.get(algoName);
            } else {
                // 7 classes right now
                indexes = [0,0,0,0,0,0,0];
                indexCounts.set(algoName, indexes);
            }

            // If the element was recently unclicked,
            // *and* that color is still unclaimed,
            // give it back the same color.
            const lastIndex = previousHighlightIndex(algoName, varName);
            if(indexes[lastIndex] === 0) return lastIndex;

            // Find the earliest index with the lowest count.
            const minCount = Math.min.apply(null, indexes);
            let index = null;
            for(var i = 0; i < indexes.length; i++) {
                if(indexes[i] == minCount) {
                    return i;
                }
            }
        }
        function previousHighlightIndex(algoName, varName) {
            return indexNames.get(algoName+"///"+varName);
        }
        function nameFromIndex(index) {
            return "selected" + index;
        }
    }
    </script>