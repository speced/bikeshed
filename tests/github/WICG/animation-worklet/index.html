<!doctype html><html lang="en">
 <head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
  <title>CSS Animation Worklet API</title>
  <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
<style data-fill-with="stylesheet">/******************************************************************************
 *                   Style sheet for the W3C specifications                   *
 *
 * Special classes handled by this style sheet include:
 *
 * Indices
 *   - .toc for the Table of Contents (<ol class="toc">)
 *     + <span class="secno"> for the section numbers
 *   - #toc for the Table of Contents (<nav id="toc">)
 *   - ul.index for Indices (<a href="#ref">term</a><span>, in Â§N.M</span>)
 *   - table.index for Index Tables (e.g. for properties or elements)
 *
 * Structural Markup
 *   - table.data for general data tables
 *     -> use 'scope' attribute, <colgroup>, <thead>, and <tbody> for best results !
 *     -> use <table class='complex data'> for extra-complex tables
 *     -> use <td class='long'> for paragraph-length cell content
 *     -> use <td class='pre'> when manual line breaks/indentation would help readability
 *   - dl.switch for switch statements
 *   - ol.algorithm for algorithms (helps to visualize nesting)
 *   - .figure and .caption (HTML4) and figure and figcaption (HTML5)
 *     -> .sidefigure for right-floated figures
 *   - ins/del
 *
 * Code
 *   - pre and code
 *
 * Special Sections
 *   - .note       for informative notes             (div, p, span, aside, details)
 *   - .example    for informative examples          (div, p, pre, span)
 *   - .issue      for issues                        (div, p, span)
 *   - .assertion  for assertions                    (div, p, span)
 *   - .advisement for loud normative statements     (div, p, strong)
 *   - .annoying-warning for spec obsoletion notices (div, aside, details)
 *
 * Definition Boxes
 *   - pre.def   for WebIDL definitions
 *   - table.def for tables that define other entities (e.g. CSS properties)
 *   - dl.def    for definition lists that define other entitles (e.g. HTML elements)
 *
 * Numbering
 *   - .secno for section numbers in .toc and headings (<span class='secno'>3.2</span>)
 *   - .marker for source-inserted example/figure/issue numbers (<span class='marker'>Issue 4</span>)
 *   - ::before styled for CSS-generated issue/example/figure numbers:
 *     -> Documents wishing to use this only need to add
 *        figcaption::before,
 *        .caption::before { content: "Figure "  counter(figure) " ";  }
 *        .example::before { content: "Example " counter(example) " "; }
 *        .issue::before   { content: "Issue "   counter(issue) " ";   }
 *
 * Header Stuff (ignore, just don't conflict with these classes)
 *   - .head for the header
 *   - .copyright for the copyright
 *
 * Miscellaneous
 *   - .overlarge for things that should be as wide as possible, even if
 *     that overflows the body text area. This can be used on an item or
 *     on its container, depending on the effect desired.
 *     Note that this styling basically doesn't help at all when printing,
 *     since A4 paper isn't much wider than the max-width here.
 *     It's better to design things to fit into a narrower measure if possible.
 *   - js-added ToC jump links (see fixup.js)
 *
 ******************************************************************************/

/******************************************************************************/
/*                                   Body                                     */
/******************************************************************************/

	body {
		counter-reset: example figure issue;

		/* Layout */
		max-width: 50em;               /* limit line length to 50em for readability   */
		margin: 0 auto;                /* center text within page                     */
		padding: 1.6em 1.5em 2em 50px; /* assume 16px font size for downlevel clients */
		padding: 1.6em 1.5em 2em calc(26px + 1.5em); /* leave space for status flag     */

		/* Typography */
		line-height: 1.5;
		font-family: sans-serif;
		widows: 2;
		orphans: 2;
		word-wrap: break-word;
		overflow-wrap: break-word;
		hyphens: auto;

		/* Colors */
		color: black;
		background: white top left fixed no-repeat;
		background-size: 25px auto;
	}


/******************************************************************************/
/*                         Front Matter & Navigation                          */
/******************************************************************************/

/** Header ********************************************************************/

	div.head { margin-bottom: 1em }
	div.head hr { border-style: solid; }

	div.head h1 {
		font-weight: bold;
		margin: 0 0 .1em;
		font-size: 220%;
	}

	div.head h2 { margin-bottom: 1.5em;}

/** W3C Logo ******************************************************************/

	.head .logo {
		float: right;
		margin: 0.4rem 0 0.2rem .4rem;
	}

	.head img[src*="logos/W3C"] {
		display: block;
		border: solid #1a5e9a;
		border-width: .65rem .7rem .6rem;
		border-radius: .4rem;
		background: #1a5e9a;
		color: white;
		font-weight: bold;
	}

	.head a:hover > img[src*="logos/W3C"],
	.head a:focus > img[src*="logos/W3C"] {
		opacity: .8;
	}

	.head a:active > img[src*="logos/W3C"] {
		background: #c00;
		border-color: #c00;
	}

	/* see also additional rules in Link Styling section */

/** Copyright *****************************************************************/

	p.copyright,
	p.copyright small { font-size: small }

/** Back to Top / ToC Toggle **************************************************/

	@media print {
		#toc-nav {
			display: none;
		}
	}
	@media not print {
		#toc-nav {
			position: fixed;
			z-index: 2;
			bottom: 0; left: 0;
			margin: 0;
			min-width: 1.33em;
			border-top-right-radius: 2rem;
			box-shadow: 0 0 2px;
			font-size: 1.5em;
			color: black;
		}
		#toc-nav > a {
			display: block;
			white-space: nowrap;

			height: 1.33em;
			padding: .1em 0.3em;
			margin: 0;

			background: white;
			box-shadow: 0 0 2px;
			border: none;
			border-top-right-radius: 1.33em;
			background: white;
		}
		#toc-nav > #toc-jump {
			padding-bottom: 2em;
			margin-bottom: -1.9em;
		}

		#toc-nav > a:hover,
		#toc-nav > a:focus {
			background: #f8f8f8;
		}
		#toc-nav > a:not(:hover):not(:focus) {
			color: #707070;
		}

		/* statusbar gets in the way on keyboard focus; remove once browsers fix */
		#toc-nav > a[href="#toc"]:not(:hover):focus:last-child {
			padding-bottom: 1.5rem;
		}

		#toc-nav:not(:hover) > a:not(:focus) > span + span {
			/* Ideally this uses :focus-within on #toc-nav */
			display: none;
		}
		#toc-nav > a > span + span {
			padding-right: 0.2em;
		}

		#toc-toggle-inline {
			vertical-align: 0.05em;
			font-size: 80%;
			color: gray;
			color: hsla(203,20%,40%,.7);
			border-style: none;
			background: transparent;
			position: relative;
		}
		#toc-toggle-inline:hover:not(:active),
		#toc-toggle-inline:focus:not(:active) {
			text-shadow: 1px 1px silver;
			top: -1px;
			left: -1px;
		}

		#toc-nav :active {
			color: #C00;
		}
	}

/** ToC Sidebar ***************************************************************/

	/* Floating sidebar */
	@media screen {
		body.toc-sidebar #toc {
			position: fixed;
			top: 0; bottom: 0;
			left: 0;
			width: 23.5em;
			max-width: 80%;
			max-width: calc(100% - 2em - 26px);
			overflow: auto;
			padding: 0 1em;
			padding-left: 42px;
			padding-left: calc(1em + 26px);
			background: inherit;
			background-color: #f7f8f9;
			z-index: 1;
			box-shadow: -.1em 0 .25em rgba(0,0,0,.1) inset;
		}
		body.toc-sidebar #toc h2 {
			margin-top: .8rem;
			font-variant: small-caps;
			font-variant: all-small-caps;
			text-transform: lowercase;
			font-weight: bold;
			color: gray;
			color: hsla(203,20%,40%,.7);
		}
		body.toc-sidebar #toc-jump:not(:focus) {
			width: 0;
			height: 0;
			padding: 0;
			position: absolute;
			overflow: hidden;
		}
	}
	/* Hide main scroller when only the ToC is visible anyway */
	@media screen and (max-width: 28em) {
		body.toc-sidebar {
			overflow: hidden;
		}
	}

	/* Sidebar with its own space */
	@media screen and (min-width: 78em) {
		body:not(.toc-inline) #toc {
			position: fixed;
			top: 0; bottom: 0;
			left: 0;
			width: 23.5em;
			overflow: auto;
			padding: 0 1em;
			padding-left: 42px;
			padding-left: calc(1em + 26px);
			background: inherit;
			background-color: #f7f8f9;
			z-index: 1;
			box-shadow: -.1em 0 .25em rgba(0,0,0,.1) inset;
		}
		body:not(.toc-inline) #toc h2 {
			margin-top: .8rem;
			font-variant: small-caps;
			font-variant: all-small-caps;
			text-transform: lowercase;
			font-weight: bold;
			color: gray;
			color: hsla(203,20%,40%,.7);
		}

		body:not(.toc-inline) {
			padding-left: 29em;
		}
		/* See also Overflow section at the bottom */

		body:not(.toc-inline) #toc-jump:not(:focus) {
			width: 0;
			height: 0;
			padding: 0;
			position: absolute;
			overflow: hidden;
		}
	}
	@media screen and (min-width: 90em) {
		body:not(.toc-inline) {
			margin: 0 4em;
		}
	}

/******************************************************************************/
/*                                Sectioning                                  */
/******************************************************************************/

/** Headings ******************************************************************/

	h1, h2, h3, h4, h5, h6, dt {
		page-break-after: avoid;
		page-break-inside: avoid;
		font: 100% sans-serif;   /* Reset all font styling to clear out UA styles */
		font-family: inherit;    /* Inherit the font family. */
		line-height: 1.2;        /* Keep wrapped headings compact */
		hyphens: manual;         /* Hyphenated headings look weird */
	}

	h2, h3, h4, h5, h6 {
		margin-top: 3rem;
	}

	h1, h2, h3 {
		color: #005A9C;
		background: transparent;
	}

	h1 { font-size: 170%; }
	h2 { font-size: 140%; }
	h3 { font-size: 120%; }
	h4 { font-weight: bold; }
	h5 { font-style: italic; }
	h6 { font-variant: small-caps; }
	dt { font-weight: bold; }

/** Subheadings ***************************************************************/

	h1 + h2,
	#subtitle {
		/* #subtitle is a subtitle in an H2 under the H1 */
		margin-top: 0;
	}
	h2 + h3,
	h3 + h4,
	h4 + h5,
	h5 + h6 {
		margin-top: 1.2em; /* = 1 x line-height */
	}

/** Section divider ***********************************************************/

	:not(.head) > hr {
		font-size: 1.5em;
		text-align: center;
		margin: 1em auto;
		height: auto;
		border: transparent solid 0;
		background: transparent;
	}
	:not(.head) > hr::before {
		content: "\2727\2003\2003\2727\2003\2003\2727";
	}

/******************************************************************************/
/*                            Paragraphs and Lists                            */
/******************************************************************************/

	p {
		margin: 1em 0;
	}

	dd > p:first-child,
	li > p:first-child {
		margin-top: 0;
	}

	ul, ol {
		margin-left: 0;
		padding-left: 2em;
	}

	li {
		margin: 0.25em 0 0.5em;
		padding: 0;
	}

	dl dd {
		margin: 0 0 .5em 2em;
	}

	.head dd + dd { /* compact for header */
		margin-top: -.5em;
	}

	/* Style for algorithms */
	ol.algorithm ol:not(.algorithm),
	.algorithm > ol ol:not(.algorithm) {
	 border-left: 0.5em solid #DEF;
	}

	/* Put nice boxes around each algorithm. */
	[data-algorithm]:not(.heading) {
	  padding: .5em;
	  border: thin solid #ddd; border-radius: .5em;
	  margin: .5em calc(-0.5em - 1px);
	}
	[data-algorithm]:not(.heading) > :first-child {
	  margin-top: 0;
	}
	[data-algorithm]:not(.heading) > :last-child {
	  margin-bottom: 0;
	}

	/* Style for switch/case <dl>s */
	dl.switch > dd > ol.only,
	dl.switch > dd > .only > ol {
	 margin-left: 0;
	}
	dl.switch > dd > ol.algorithm,
	dl.switch > dd > .algorithm > ol {
	 margin-left: -2em;
	}
	dl.switch {
	 padding-left: 2em;
	}
	dl.switch > dt {
	 text-indent: -1.5em;
	 margin-top: 1em;
	}
	dl.switch > dt + dt {
	 margin-top: 0;
	}
	dl.switch > dt::before {
	 content: '\21AA';
	 padding: 0 0.5em 0 0;
	 display: inline-block;
	 width: 1em;
	 text-align: right;
	 line-height: 0.5em;
	}

/** Terminology Markup ********************************************************/


/******************************************************************************/
/*                                 Inline Markup                              */
/******************************************************************************/

/** Terminology Markup ********************************************************/
	dfn   { /* Defining instance */
		font-weight: bolder;
	}
	a > i { /* Instance of term */
		font-style: normal;
	}
	dt dfn code, code.idl {
		font-size: medium;
	}
	dfn var {
		font-style: normal;
	}

/** Change Marking ************************************************************/

	del { color: red;  text-decoration: line-through; }
	ins { color: #080; text-decoration: underline;    }

/** Miscellaneous improvements to inline formatting ***************************/

	sup {
		vertical-align: super;
		font-size: 80%
	}

/******************************************************************************/
/*                                    Code                                    */
/******************************************************************************/

/** General monospace/pre rules ***********************************************/

	pre, code, samp {
		font-family: Menlo, Consolas, "DejaVu Sans Mono", Monaco, monospace;
		font-size: .9em;
		page-break-inside: avoid;
		hyphens: none;
		text-transform: none;
	}
	pre code,
	code code {
		font-size: 100%;
	}

	pre {
		margin-top: 1em;
		margin-bottom: 1em;
		overflow: auto;
	}

/** Inline Code fragments *****************************************************/

  /* Do something nice. */

/******************************************************************************/
/*                                    Links                                   */
/******************************************************************************/

/** General Hyperlinks ********************************************************/

	/* We hyperlink a lot, so make it less intrusive */
	a[href] {
		color: #034575;
		text-decoration: none;
		border-bottom: 1px solid #707070;
		/* Need a bit of extending for it to look okay */
		padding: 0 1px 0;
		margin: 0 -1px 0;
	}
	a:visited {
		border-bottom-color: #BBB;
	}

	/* Use distinguishing colors when user is interacting with the link */
	a[href]:focus,
	a[href]:hover {
		background: #f8f8f8;
		background: rgba(75%, 75%, 75%, .25);
		border-bottom-width: 3px;
		margin-bottom: -2px;
	}
	a[href]:active {
		color: #C00;
		border-color: #C00;
	}

	/* Backout above styling for W3C logo */
	.head .logo,
	.head .logo a {
		border: none;
		text-decoration: none;
		background: transparent;
	}

/******************************************************************************/
/*                                    Images                                  */
/******************************************************************************/

	img {
		border-style: none;
	}

	/* For autogen numbers, add
	   .caption::before, figcaption::before { content: "Figure " counter(figure) ". "; }
	*/

	figure, .figure, .sidefigure {
		page-break-inside: avoid;
		text-align: center;
		margin: 2.5em 0;
	}
	.figure img,    .sidefigure img,    figure img,
	.figure object, .sidefigure object, figure object {
		max-width: 100%;
		margin: auto;
	}
	.figure pre, .sidefigure pre, figure pre {
		text-align: left;
		display: table;
		margin: 1em auto;
	}
	.figure table, figure table {
		margin: auto;
	}
	@media screen and (min-width: 20em) {
		.sidefigure {
			float: right;
			width: 50%;
			margin: 0 0 0.5em 0.5em
		}
	}
	.caption, figcaption, caption {
		font-style: italic;
		font-size: 90%;
	}
	.caption::before, figcaption::before, figcaption > .marker {
		font-weight: bold;
	}
	.caption, figcaption {
		counter-increment: figure;
	}

	/* DL list is indented 2em, but figure inside it is not */
	dd > .figure, dd > figure { margin-left: -2em }

/******************************************************************************/
/*                             Colored Boxes                                  */
/******************************************************************************/

	.issue, .note, .example, .assertion, .advisement, blockquote {
		padding: .5em;
		border: .5em;
		border-left-style: solid;
		page-break-inside: avoid;
	}
	span.issue, span.note {
		padding: .1em .5em .15em;
		border-right-style: solid;
	}

	.issue,
	.note,
	.example,
	.advisement,
	.assertion,
	blockquote {
		margin: 1em auto;
	}
	.note  > p:first-child,
	.issue > p:first-child,
	blockquote > :first-child {
		margin-top: 0;
	}
	blockquote > :last-child {
		margin-bottom: 0;
	}

/** Blockquotes ***************************************************************/

	blockquote {
		border-color: silver;
	}

/** Open issue ****************************************************************/

	.issue {
		border-color: #E05252;
		background: #FBE9E9;
		counter-increment: issue;
		overflow: auto;
	}
	.issue::before, .issue > .marker {
		text-transform: uppercase;
		color: #AE1E1E;
		padding-right: 1em;
		text-transform: uppercase;
	}
	/* Add .issue::before { content: "Issue " counter(issue) " "; } for autogen numbers,
	   or use class="marker" to mark up the issue number in source. */

/** Example *******************************************************************/

	.example {
		border-color: #E0CB52;
		background: #FCFAEE;
		counter-increment: example;
		overflow: auto;
		clear: both;
	}
	.example::before, .example > .marker {
		text-transform: uppercase;
		color: #827017;
		min-width: 7.5em;
		display: block;
	}
	/* Add .example::before { content: "Example " counter(example) " "; } for autogen numbers,
	   or use class="marker" to mark up the example number in source. */

/** Non-normative Note ********************************************************/

	.note {
		border-color: #52E052;
		background: #E9FBE9;
		overflow: auto;
	}

	.note::before, .note > .marker,
	details.note > summary::before,
	details.note > summary > .marker {
		text-transform: uppercase;
		display: block;
		color: hsl(120, 70%, 30%);
	}
	/* Add .note::before { content: "Note"; } for autogen label,
	   or use class="marker" to mark up the label in source. */

	details.note > summary {
		display: block;
		color: hsl(120, 70%, 30%);
	}
	details.note[open] > summary {
		border-bottom: 1px silver solid;
	}

/** Assertion Box *************************************************************/
	/*  for assertions in algorithms */

	.assertion {
		border-color: #AAA;
		background: #EEE;
	}

/** Advisement Box ************************************************************/
	/*  for attention-grabbing normative statements */

	.advisement {
		border-color: orange;
		border-style: none solid;
		background: #FFEECC;
	}
	strong.advisement {
		display: block;
		text-align: center;
	}
	.advisement > .marker {
		color: #B35F00;
	}

/** Spec Obsoletion Notice ****************************************************/
	/* obnoxious obsoletion notice for older/abandoned specs. */

	details {
		display: block;
	}
	summary {
		font-weight: bolder;
	}

	.annoying-warning:not(details),
	details.annoying-warning:not([open]) > summary,
	details.annoying-warning[open] {
		background: #fdd;
		color: red;
		font-weight: bold;
		padding: .75em 1em;
		border: thick red;
		border-style: solid;
		border-radius: 1em;
	}
	.annoying-warning :last-child {
		margin-bottom: 0;
	}

@media not print {
	details.annoying-warning[open] {
		position: fixed;
		left: 1em;
		right: 1em;
		bottom: 1em;
		z-index: 1000;
	}
}

	details.annoying-warning:not([open]) > summary {
		text-align: center;
	}

/** Entity Definition Boxes ***************************************************/

	.def {
		padding: .5em 1em;
		background: #DEF;
		margin: 1.2em 0;
		border-left: 0.5em solid #8CCBF2;
	}

/******************************************************************************/
/*                                    Tables                                  */
/******************************************************************************/

	th, td {
		text-align: left;
		text-align: start;
	}

/** Property/Descriptor Definition Tables *************************************/

	table.def {
		/* inherits .def box styling, see above */
		width: 100%;
		border-spacing: 0;
	}

	table.def td,
	table.def th {
		padding: 0.5em;
		vertical-align: baseline;
		border-bottom: 1px solid #bbd7e9;
	}

	table.def > tbody > tr:last-child th,
	table.def > tbody > tr:last-child td {
		border-bottom: 0;
	}

	table.def th {
		font-style: italic;
		font-weight: normal;
		padding-left: 1em;
		width: 3em;
	}

	/* For when values are extra-complex and need formatting for readability */
	table td.pre {
		white-space: pre-wrap;
	}

	/* A footnote at the bottom of a def table */
	table.def           td.footnote {
		padding-top: 0.6em;
	}
	table.def           td.footnote::before {
		content: " ";
		display: block;
		height: 0.6em;
		width: 4em;
		border-top: thin solid;
	}

/** Data tables (and properly marked-up index tables) *************************/
	/*
		 <table class="data"> highlights structural relationships in a table
		 when correct markup is used (e.g. thead/tbody, th vs. td, scope attribute)

		 Use class="complex data" for particularly complicated tables --
		 (This will draw more lines: busier, but clearer.)

		 Use class="long" on table cells with paragraph-like contents
		 (This will adjust text alignment accordingly.)
		 Alternately use class="longlastcol" on tables, to have the last column assume "long".
	*/

	table {
		word-wrap: normal;
		overflow-wrap: normal;
		hyphens: manual;
	}

	table.data,
	table.index {
		margin: 1em auto;
		border-collapse: collapse;
		border: hidden;
		width: 100%;
	}
	table.data caption,
	table.index caption {
		max-width: 50em;
		margin: 0 auto 1em;
	}

	table.data td,  table.data th,
	table.index td, table.index th {
		padding: 0.5em 1em;
		border-width: 1px;
		border-color: silver;
		border-top-style: solid;
	}

	table.data thead td:empty {
		padding: 0;
		border: 0;
	}

	table.data  thead,
	table.index thead,
	table.data  tbody,
	table.index tbody {
		border-bottom: 2px solid;
	}

	table.data colgroup,
	table.index colgroup {
		border-left: 2px solid;
	}

	table.data  tbody th:first-child,
	table.index tbody th:first-child  {
		border-right: 2px solid;
		border-top: 1px solid silver;
		padding-right: 1em;
	}

	table.data th[colspan],
	table.data td[colspan] {
		text-align: center;
	}

	table.complex.data th,
	table.complex.data td {
		border: 1px solid silver;
		text-align: center;
	}

	table.data.longlastcol td:last-child,
	table.data td.long {
	 vertical-align: baseline;
	 text-align: left;
	}

	table.data img {
		vertical-align: middle;
	}


/*
Alternate table alignment rules

	table.data,
	table.index {
		text-align: center;
	}

	table.data  thead th[scope="row"],
	table.index thead th[scope="row"] {
		text-align: right;
	}

	table.data  tbody th:first-child,
	table.index tbody th:first-child  {
		text-align: right;
	}

Possible extra rowspan handling

	table.data  tbody th[rowspan]:not([rowspan='1']),
	table.index tbody th[rowspan]:not([rowspan='1']),
	table.data  tbody td[rowspan]:not([rowspan='1']),
	table.index tbody td[rowspan]:not([rowspan='1']) {
		border-left: 1px solid silver;
	}

	table.data  tbody th[rowspan]:first-child,
	table.index tbody th[rowspan]:first-child,
	table.data  tbody td[rowspan]:first-child,
	table.index tbody td[rowspan]:first-child{
		border-left: 0;
		border-right: 1px solid silver;
	}
*/

/******************************************************************************/
/*                                  Indices                                   */
/******************************************************************************/


/** Table of Contents *********************************************************/

	.toc a {
		/* More spacing; use padding to make it part of the click target. */
		padding-top: 0.1rem;
		/* Larger, more consistently-sized click target */
		display: block;
		/* Reverse color scheme */
		color: black;
		border-color: #3980B5;
		border-bottom-width: 3px !important;
		margin-bottom: 0px !important;
	}
	.toc a:visited {
		border-color: #054572;
	}
	.toc a:not(:focus):not(:hover) {
		/* Allow colors to cascade through from link styling */
		border-bottom-color: transparent;
	}

	.toc, .toc ol, .toc ul, .toc li {
		list-style: none; /* Numbers must be inlined into source */
		/* because generated content isn't search/selectable and markers can't do multilevel yet */
		margin:  0;
		padding: 0;
		line-height: 1.1rem; /* consistent spacing */
	}

	/* ToC not indented until third level, but font style & margins show hierarchy */
	.toc > li             { font-weight: bold;   }
	.toc > li li          { font-weight: normal; }
	.toc > li li li       { font-size:   95%;    }
	.toc > li li li li    { font-size:   90%;    }
	.toc > li li li li li { font-size:   85%;    }

	.toc > li             { margin: 1.5rem 0;    }
	.toc > li li          { margin: 0.3rem 0;    }
	.toc > li li li       { margin-left: 2rem;   }

	/* Section numbers in a column of their own */
	.toc .secno {
		float: left;
		width: 4rem;
		white-space: nowrap;
	}
	.toc > li li li li .secno {
		font-size: 85%;
	}
	.toc > li li li li li .secno {
		font-size: 100%;
	}

	:not(li) > .toc              { margin-left:  5rem; }
	.toc .secno                  { margin-left: -5rem; }
	.toc > li li li .secno       { margin-left: -7rem; }
	.toc > li li li li .secno    { margin-left: -9rem; }
	.toc > li li li li li .secno { margin-left: -11rem; }

	/* Tighten up indentation in narrow ToCs */
	@media (max-width: 30em) {
		:not(li) > .toc              { margin-left:  4rem; }
		.toc .secno                  { margin-left: -4rem; }
		.toc > li li li              { margin-left:  1rem; }
		.toc > li li li .secno       { margin-left: -5rem; }
		.toc > li li li li .secno    { margin-left: -6rem; }
		.toc > li li li li li .secno { margin-left: -7rem; }
	}
	@media screen and (min-width: 78em) {
		body:not(.toc-inline) :not(li) > .toc              { margin-left:  4rem; }
		body:not(.toc-inline) .toc .secno                  { margin-left: -4rem; }
		body:not(.toc-inline) .toc > li li li              { margin-left:  1rem; }
		body:not(.toc-inline) .toc > li li li .secno       { margin-left: -5rem; }
		body:not(.toc-inline) .toc > li li li li .secno    { margin-left: -6rem; }
		body:not(.toc-inline) .toc > li li li li li .secno { margin-left: -7rem; }
	}
	body.toc-sidebar #toc :not(li) > .toc              { margin-left:  4rem; }
	body.toc-sidebar #toc .toc .secno                  { margin-left: -4rem; }
	body.toc-sidebar #toc .toc > li li li              { margin-left:  1rem; }
	body.toc-sidebar #toc .toc > li li li .secno       { margin-left: -5rem; }
	body.toc-sidebar #toc .toc > li li li li .secno    { margin-left: -6rem; }
	body.toc-sidebar #toc .toc > li li li li li .secno { margin-left: -7rem; }

	.toc li {
		clear: both;
	}


/** Index *********************************************************************/

	/* Index Lists: Layout */
	ul.index       { margin-left: 0; columns: 15em; text-indent: 1em hanging; }
	ul.index li    { margin-left: 0; list-style: none; break-inside: avoid; }
	ul.index li li { margin-left: 1em }
	ul.index dl    { margin-top: 0; }
	ul.index dt    { margin: .2em 0 .2em 20px;}
	ul.index dd    { margin: .2em 0 .2em 40px;}
	/* Index Lists: Typography */
	ul.index ul,
	ul.index dl { font-size: smaller; }
	@media not print {
		ul.index li span {
			white-space: nowrap;
			color: transparent; }
		ul.index li a:hover + span,
		ul.index li a:focus + span {
			color: #707070;
		}
	}

/** Index Tables *****************************************************/
	/* See also the data table styling section, which this effectively subclasses */

	table.index {
		font-size: small;
		border-collapse: collapse;
		border-spacing: 0;
		text-align: left;
		margin: 1em 0;
	}

	table.index td,
	table.index th {
		padding: 0.4em;
	}

	table.index tr:hover td:not([rowspan]),
	table.index tr:hover th:not([rowspan]) {
		background: #f7f8f9;
	}

	/* The link in the first column in the property table (formerly a TD) */
	table.index th:first-child a {
		font-weight: bold;
	}

/******************************************************************************/
/*                                    Print                                   */
/******************************************************************************/

	@media print {
		/* Pages have their own margins. */
		html {
			margin: 0;
		}
		/* Serif for print. */
		body {
			font-family: serif;
		}
	}
	@page {
		margin: 1.5cm 1.1cm;
	}

/******************************************************************************/
/*                                    Legacy                                  */
/******************************************************************************/

	/* This rule is inherited from past style sheets. No idea what it's for. */
	.hide { display: none }



/******************************************************************************/
/*                             Overflow Control                               */
/******************************************************************************/

	.figure .caption, .sidefigure .caption, figcaption {
		/* in case figure is overlarge, limit caption to 50em */
		max-width: 50rem;
		margin-left: auto;
		margin-right: auto;
	}
	.overlarge > table {
		/* limit preferred width of table */
		max-width: 50em;
		margin-left: auto;
		margin-right: auto;
	}

	@media (min-width: 55em) {
		.overlarge {
			margin-left: calc(13px + 26.5rem - 50vw);
			margin-right: calc(13px + 26.5rem - 50vw);
			max-width: none;
		}
	}
	@media screen and (min-width: 78em) {
		body:not(.toc-inline) .overlarge {
			/* 30.5em body padding 50em content area */
			margin-left: calc(40em - 50vw) !important;
			margin-right: calc(40em - 50vw) !important;
		}
	}
	@media screen and (min-width: 90em) {
		body:not(.toc-inline) .overlarge {
			/* 4em html margin 30.5em body padding 50em content area */
			margin-left: 0 !important;
			margin-right: calc(84.5em - 100vw) !important;
		}
	}

	@media not print {
		.overlarge {
			overflow-x: auto;
			/* See Lea Verou's explanation background-attachment:
			 * http://lea.verou.me/2012/04/background-attachment-local/
			 *
			background: top left  / 4em 100% linear-gradient(to right,  #ffffff, rgba(255, 255, 255, 0)) local,
			            top right / 4em 100% linear-gradient(to left, #ffffff, rgba(255, 255, 255, 0)) local,
			            top left  / 1em 100% linear-gradient(to right,  #c3c3c5, rgba(195, 195, 197, 0)) scroll,
			            top right / 1em 100% linear-gradient(to left, #c3c3c5, rgba(195, 195, 197, 0)) scroll,
			            white;
			background-repeat: no-repeat;
			*/
		}
	}
</style>
  <link href="https://wicg.github.io/animation-worklet/" rel="canonical">
<style>/* style-md-lists */

/* This is a weird hack for me not yet following the commonmark spec
   regarding paragraph and lists. */
[data-md] > :first-child {
    margin-top: 0;
}
[data-md] > :last-child {
    margin-bottom: 0;
}</style>
<style>/* style-selflinks */

.heading, .issue, .note, .example, li, dt {
    position: relative;
}
a.self-link {
    position: absolute;
    top: 0;
    left: calc(-1 * (3.5rem - 26px));
    width: calc(3.5rem - 26px);
    height: 2em;
    text-align: center;
    border: none;
    transition: opacity .2s;
    opacity: .5;
}
a.self-link:hover {
    opacity: 1;
}
.heading > a.self-link {
    font-size: 83%;
}
li > a.self-link {
    left: calc(-1 * (3.5rem - 26px) - 2em);
}
dfn > a.self-link {
    top: auto;
    left: auto;
    opacity: 0;
    width: 1.5em;
    height: 1.5em;
    background: gray;
    color: white;
    font-style: normal;
    transition: opacity .2s, background-color .2s, color .2s;
}
dfn:hover > a.self-link {
    opacity: 1;
}
dfn > a.self-link:hover {
    color: black;
}

a.self-link::before            { content: "Â¶"; }
.heading > a.self-link::before { content: "Â§"; }
dfn > a.self-link::before      { content: "#"; }</style>
<style>/* style-counters */

body {
    counter-reset: example figure issue;
}
.issue {
    counter-increment: issue;
}
.issue:not(.no-marker)::before {
    content: "Issue " counter(issue);
}

.example {
    counter-increment: example;
}
.example:not(.no-marker)::before {
    content: "Example " counter(example);
}
.invalid.example:not(.no-marker)::before,
.illegal.example:not(.no-marker)::before {
    content: "Invalid Example" counter(example);
}

figcaption {
    counter-increment: figure;
}
figcaption:not(.no-marker)::before {
    content: "Figure " counter(figure) " ";
}</style>
<style>/* style-autolinks */

.css.css, .property.property, .descriptor.descriptor {
    color: #005a9c;
    font-size: inherit;
    font-family: inherit;
}
.css::before, .property::before, .descriptor::before {
    content: "â";
}
.css::after, .property::after, .descriptor::after {
    content: "â";
}
.property, .descriptor {
    /* Don't wrap property and descriptor names */
    white-space: nowrap;
}
.type { /* CSS value <type> */
    font-style: italic;
}
pre .property::before, pre .property::after {
    content: "";
}
[data-link-type="property"]::before,
[data-link-type="propdesc"]::before,
[data-link-type="descriptor"]::before,
[data-link-type="value"]::before,
[data-link-type="function"]::before,
[data-link-type="at-rule"]::before,
[data-link-type="selector"]::before,
[data-link-type="maybe"]::before {
    content: "â";
}
[data-link-type="property"]::after,
[data-link-type="propdesc"]::after,
[data-link-type="descriptor"]::after,
[data-link-type="value"]::after,
[data-link-type="function"]::after,
[data-link-type="at-rule"]::after,
[data-link-type="selector"]::after,
[data-link-type="maybe"]::after {
    content: "â";
}

[data-link-type].production::before,
[data-link-type].production::after,
.prod [data-link-type]::before,
.prod [data-link-type]::after {
    content: "";
}

[data-link-type=element],
[data-link-type=element-attr] {
    font-family: Menlo, Consolas, "DejaVu Sans Mono", monospace;
    font-size: .9em;
}
[data-link-type=element]::before { content: "<" }
[data-link-type=element]::after  { content: ">" }

[data-link-type=biblio] {
    white-space: pre;
}</style>
<style>/* style-dfn-panel */

        .dfn-panel {
            position: absolute;
            z-index: 35;
            height: auto;
            width: -webkit-fit-content;
            width: fit-content;
            max-width: 300px;
            max-height: 500px;
            overflow: auto;
            padding: 0.5em 0.75em;
            font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
            background: #DDDDDD;
            color: black;
            border: outset 0.2em;
        }
        .dfn-panel:not(.on) { display: none; }
        .dfn-panel * { margin: 0; padding: 0; text-indent: 0; }
        .dfn-panel > b { display: block; }
        .dfn-panel a { color: black; }
        .dfn-panel a:not(:hover) { text-decoration: none !important; border-bottom: none !important; }
        .dfn-panel > b + b { margin-top: 0.25em; }
        .dfn-panel ul { padding: 0; }
        .dfn-panel li { list-style: inside; }
        .dfn-panel.activated {
            display: inline-block;
            position: fixed;
            left: .5em;
            bottom: 2em;
            margin: 0 auto;
            max-width: calc(100vw - 1.5em - .4em - .5em);
            max-height: 30vh;
        }

        .dfn-paneled { cursor: pointer; }
        </style>
<style>/* style-syntax-highlighting */
pre.idl.highlight { color: #708090; }
.highlight:not(.idl) { background: hsl(24, 20%, 95%); }
code.highlight { padding: .1em; border-radius: .3em; }
pre.highlight, pre > code.highlight { display: block; padding: 1em; margin: .5em 0; overflow: auto; border-radius: 0; }
.highlight .c { color: #708090 } /* Comment */
.highlight .k { color: #990055 } /* Keyword */
.highlight .l { color: #000000 } /* Literal */
.highlight .n { color: #0077aa } /* Name */
.highlight .o { color: #999999 } /* Operator */
.highlight .p { color: #999999 } /* Punctuation */
.highlight .cm { color: #708090 } /* Comment.Multiline */
.highlight .cp { color: #708090 } /* Comment.Preproc */
.highlight .c1 { color: #708090 } /* Comment.Single */
.highlight .cs { color: #708090 } /* Comment.Special */
.highlight .kc { color: #990055 } /* Keyword.Constant */
.highlight .kd { color: #990055 } /* Keyword.Declaration */
.highlight .kn { color: #990055 } /* Keyword.Namespace */
.highlight .kp { color: #990055 } /* Keyword.Pseudo */
.highlight .kr { color: #990055 } /* Keyword.Reserved */
.highlight .kt { color: #990055 } /* Keyword.Type */
.highlight .ld { color: #000000 } /* Literal.Date */
.highlight .m { color: #000000 } /* Literal.Number */
.highlight .s { color: #a67f59 } /* Literal.String */
.highlight .na { color: #0077aa } /* Name.Attribute */
.highlight .nc { color: #0077aa } /* Name.Class */
.highlight .no { color: #0077aa } /* Name.Constant */
.highlight .nd { color: #0077aa } /* Name.Decorator */
.highlight .ni { color: #0077aa } /* Name.Entity */
.highlight .ne { color: #0077aa } /* Name.Exception */
.highlight .nf { color: #0077aa } /* Name.Function */
.highlight .nl { color: #0077aa } /* Name.Label */
.highlight .nn { color: #0077aa } /* Name.Namespace */
.highlight .py { color: #0077aa } /* Name.Property */
.highlight .nt { color: #669900 } /* Name.Tag */
.highlight .nv { color: #222222 } /* Name.Variable */
.highlight .ow { color: #999999 } /* Operator.Word */
.highlight .mb { color: #000000 } /* Literal.Number.Bin */
.highlight .mf { color: #000000 } /* Literal.Number.Float */
.highlight .mh { color: #000000 } /* Literal.Number.Hex */
.highlight .mi { color: #000000 } /* Literal.Number.Integer */
.highlight .mo { color: #000000 } /* Literal.Number.Oct */
.highlight .sb { color: #a67f59 } /* Literal.String.Backtick */
.highlight .sc { color: #a67f59 } /* Literal.String.Char */
.highlight .sd { color: #a67f59 } /* Literal.String.Doc */
.highlight .s2 { color: #a67f59 } /* Literal.String.Double */
.highlight .se { color: #a67f59 } /* Literal.String.Escape */
.highlight .sh { color: #a67f59 } /* Literal.String.Heredoc */
.highlight .si { color: #a67f59 } /* Literal.String.Interpol */
.highlight .sx { color: #a67f59 } /* Literal.String.Other */
.highlight .sr { color: #a67f59 } /* Literal.String.Regex */
.highlight .s1 { color: #a67f59 } /* Literal.String.Single */
.highlight .ss { color: #a67f59 } /* Literal.String.Symbol */
.highlight .vc { color: #0077aa } /* Name.Variable.Class */
.highlight .vg { color: #0077aa } /* Name.Variable.Global */
.highlight .vi { color: #0077aa } /* Name.Variable.Instance */
.highlight .il { color: #000000 } /* Literal.Number.Integer.Long */
</style>
 <body class="h-entry">
  <div class="head">
   <p data-fill-with="logo"></p>
   <h1 class="p-name no-ref" id="title">CSS Animation Worklet API</h1>
   <h2 class="no-num no-toc no-ref heading settled" id="subtitle"><span class="content">Draft Community Group Report, <time class="dt-updated" datetime="1970-01-01">1 January 1970</time></span></h2>
   <div data-fill-with="spec-metadata">
    <dl>
     <dt>This version:
     <dd><a class="u-url" href="https://wicg.github.io/animation-worklet/">https://wicg.github.io/animation-worklet/</a>
     <dt class="editor">Editors:
     <dd class="editor p-author h-card vcard"><a class="p-name fn u-email email" href="mailto:majidvp@google.com">Majid Valipour</a>
     <dd class="editor p-author h-card vcard"><a class="p-name fn u-email email" href="mailto:flackr@chromium.org">Robert Flack</a>
     <dd class="editor p-author h-card vcard"><a class="p-name fn u-email email" href="mailto:smcgruer@chromium.org">Stephen McGruer</a>
    </dl>
   </div>
   <div data-fill-with="warning"></div>
   <p class="copyright" data-fill-with="copyright"><a href="http://www.w3.org/Consortium/Legal/ipr-notice#Copyright">Copyright</a> Â© 1970 the Contributors to the CSS Animation Worklet API Specification, published by the <a href="https://www.w3.org/community/wicg/">Web Platform Incubator Community Group</a> under the <a href="https://www.w3.org/community/about/agreements/cla/">W3C Community Contributor License Agreement (CLA)</a>.
A human-readable <a href="http://www.w3.org/community/about/agreements/cla-deed/">summary</a> is available. </p>
   <hr title="Separator for header">
  </div>
  <div class="p-summary" data-fill-with="abstract">
   <h2 class="no-num no-toc no-ref heading settled" id="abstract"><span class="content">Abstract</span></h2>
  </div>
  <div data-fill-with="at-risk"></div>
  <h2 class="no-num no-toc no-ref heading settled" id="status"><span class="content">Status of this document</span></h2>
  <div data-fill-with="status">
   <p> This specification was published by the <a href="https://www.w3.org/community/wicg/">Web Platform Incubator Community Group</a>.
  It is not a W3C Standard nor is it on the W3C Standards Track.

  Please note that under the <a href="https://www.w3.org/community/about/agreements/cla/">W3C Community Contributor License Agreement (CLA)</a> there is a limited opt-out and other conditions apply.

  Learn more about <a href="http://www.w3.org/community/">W3C Community and Business Groups</a>. </p>
   <p></p>
  </div>
  <div data-fill-with="at-risk"></div>
  <nav data-fill-with="table-of-contents" id="toc">
   <h2 class="no-num no-toc no-ref" id="contents">Table of Contents</h2>
   <ol class="toc" role="directory">
    <li>
     <a href="#intro"><span class="secno">1</span> <span class="content">Introduction</span></a>
     <ol class="toc">
      <li><a href="#relationship-to-web-animations"><span class="secno">1.1</span> <span class="content">Relationship to the Web Animations API</span></a>
     </ol>
    <li><a href="#threading-model"><span class="secno">2</span> <span class="content">Threading Model</span></a>
    <li><a href="#animation-worklet-desc"><span class="secno">3</span> <span class="content">Animation Worklet</span></a>
    <li>
     <a href="#animator-definition-desc"><span class="secno">4</span> <span class="content">Animator Definition</span></a>
     <ol class="toc">
      <li><a href="#registering-animator-definition"><span class="secno">4.1</span> <span class="content">Registering an Animator Definition</span></a>
     </ol>
    <li>
     <a href="#animator-instance-section"><span class="secno">5</span> <span class="content">Animator Instance</span></a>
     <ol class="toc">
      <li><a href="#creating-animator-instance"><span class="secno">5.1</span> <span class="content">Creating an Animator Instance</span></a>
      <li><a href="#running-animators"><span class="secno">5.2</span> <span class="content">Running Animators</span></a>
      <li><a href="#removing-animator"><span class="secno">5.3</span> <span class="content">Removing an Animator Instance</span></a>
      <li><a href="#migrating-animator"><span class="secno">5.4</span> <span class="content">Migrating an Animator Instance</span></a>
      <li><a href="#requesting-animation-frames"><span class="secno">5.5</span> <span class="content">Requesting Animation Frames</span></a>
     </ol>
    <li>
     <a href="#web-animation-integration"><span class="secno">6</span> <span class="content">Web Animations Integration</span></a>
     <ol class="toc">
      <li><a href="#worklet-animation-desc"><span class="secno">6.1</span> <span class="content">Worklet Animation</span></a>
      <li><a href="#creating-worklet-animation"><span class="secno">6.2</span> <span class="content">Creating a Worklet Animation</span></a>
      <li><a href="#timing-model"><span class="secno">6.3</span> <span class="content">Worklet Animation timing model</span></a>
      <li><a href="#worklet-animation-animator-instances"><span class="secno">6.4</span> <span class="content">Interaction with Animator Instances</span></a>
      <li><a href="#timeline-attachment"><span class="secno">6.5</span> <span class="content">Timeline Attachment</span></a>
      <li><a href="#scroll-timeline"><span class="secno">6.6</span> <span class="content">ScrollTimeline</span></a>
      <li><a href="#worklet-group-effect"><span class="secno">6.7</span> <span class="content">WorkletGroupEffect</span></a>
      <li><a href="#effect-stack-composite-order"><span class="secno">6.8</span> <span class="content">Effect Stack and Composite Order</span></a>
     </ol>
    <li><a href="#security-considerations"><span class="secno">7</span> <span class="content">Security Considerations</span></a>
    <li><a href="#privacy-considerations"><span class="secno">8</span> <span class="content">Privacy Considerations</span></a>
    <li>
     <a href="#examples"><span class="secno">9</span> <span class="content">Examples</span></a>
     <ol class="toc">
      <li><a href="#example-1"><span class="secno">9.1</span> <span class="content">Example 1: Hidey Bar.</span></a>
      <li><a href="#example-2"><span class="secno">9.2</span> <span class="content">Example 2: Twitter header.</span></a>
      <li><a href="#example-3"><span class="secno">9.3</span> <span class="content">Example 3: Parallax backgrounds.</span></a>
     </ol>
    <li><a href="#conformance"><span class="secno"></span> <span class="content"> Conformance</span></a>
    <li>
     <a href="#index"><span class="secno"></span> <span class="content">Index</span></a>
     <ol class="toc">
      <li><a href="#index-defined-here"><span class="secno"></span> <span class="content">Terms defined by this specification</span></a>
      <li><a href="#index-defined-elsewhere"><span class="secno"></span> <span class="content">Terms defined by reference</span></a>
     </ol>
    <li>
     <a href="#references"><span class="secno"></span> <span class="content">References</span></a>
     <ol class="toc">
      <li><a href="#normative"><span class="secno"></span> <span class="content">Normative References</span></a>
      <li><a href="#informative"><span class="secno"></span> <span class="content">Informative References</span></a>
     </ol>
    <li><a href="#idl-index"><span class="secno"></span> <span class="content">IDL Index</span></a>
    <li><a href="#issues-index"><span class="secno"></span> <span class="content">Issues Index</span></a>
   </ol>
  </nav>
  <main>
   <h2 class="heading settled" data-level="1" id="intro"><span class="secno">1. </span><span class="content">Introduction</span><a class="self-link" href="#intro"></a></h2>
    This document introduces a new primitive for creating scroll-linked and other high performance
procedural animations on the web. For details on the rationale and motivation see <a data-link-type="biblio" href="#biblio-explainer">[explainer]</a>. 
   <p>The <a data-link-type="dfn" href="#animation-worklet" id="ref-for-animation-worklet">Animation Worklet</a> API provides a method to create scripted animations that control a set
of <a data-link-type="dfn" href="https://w3c.github.io/web-animations/#animation-effect" id="ref-for-animation-effect">animation effects</a>. The API is designed to make it possible for user agents to run such
animations in their own dedicated thread to provide a degree of performance isolation from main
thread.</p>
   <h3 class="heading settled" data-level="1.1" id="relationship-to-web-animations"><span class="secno">1.1. </span><span class="content">Relationship to the Web Animations API</span><a class="self-link" href="#relationship-to-web-animations"></a></h3>
   <p>Animations running inside an <a data-link-type="dfn" href="#animation-worklet" id="ref-for-animation-workletâ ">Animation Worklet</a> execution context expose the <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/web-animations/level-2/#animation" id="ref-for-animation">Animation</a></code> interface from the Web Animations specification on the main javascript execution context. This means
they can be controlled and inspected from main thread using many of the Web Animation APIs. However
Animation Worklet animations follow a different timing model that enables them to be script-driven,
stateful, and runnable in a parallel worklet execution context. As such Web Animation APIs that seek
or alter the input time (reverse, finish, etc.) have different semantics for Animation Worklet
animations.</p>
   <h2 class="heading settled" data-level="2" id="threading-model"><span class="secno">2. </span><span class="content">Threading Model</span><a class="self-link" href="#threading-model"></a></h2>
   <p><a data-link-type="dfn" href="#animation-worklet" id="ref-for-animation-workletâ¡">Animation Worklet</a> is designed to be thread-agnostic. Rendering engines may create one or more
parallel worklet execution contexts separate from the main javascript execution context, e.g., on
their own dedicated threads. Rendering engines may then choose to assign Animation Worklet
animations to run in such contexts. Doing so allows Animation Worklet animations to avoid being
impacted by main thread jank.</p>
   <p>Rendering engines may wish to make a best-effort attempt to execute animate callbacks synchronously
with visual frame production to ensure smooth animation. However it is legal for rendering engines
to produce visual frames without blocking to receive animation updates from a worklet (i.e., letting
the effects slip behind). For example, this could occur when the <a data-link-type="dfn" href="#animate-function" id="ref-for-animate-function">animate function</a> callback is
unable to complete before the frame deadline.</p>
   <p>We believe that scripted animations which are run in a parallel execution environment and which
limit themselves to animating properties which do not require the user agent to consult main thread
will have a much better chance of meeting the strict frame budgets required for smooth playback.</p>
   <p>If a Worklet Animation animation is executing in a parallel worklet execution context, the last
known state of its animation effects must be periodically synced back to the main javascript
execution context. The synchronization of <a data-link-type="dfn" href="https://w3c.github.io/web-animations/#effect-value" id="ref-for-effect-value">effect values</a> from the parallel worklet execution
context to the main javascript execution context <em>must</em> occur before <a data-link-type="dfn" href="https://html.spec.whatwg.org/#run-the-animation-frame-callbacks" id="ref-for-run-the-animation-frame-callbacks">running the animation
frame callbacks</a> as part of the document lifecycle. Note that due to the asynchronous nature of
this animation model a script running in the main javascript execution context may see a stale value
when reading a <a data-link-type="dfn" href="https://w3c.github.io/web-animations/#target-property" id="ref-for-target-property">target property</a> that is being animated in a Worklet Animation, compared to the
value currently being used to produce the visual frame that is visible to the user. This is similar
to the effect of asynchronous scrolling when reading scroll offsets in the main javascript execution
context.</p>
   <figure>
     <img alt="Overview of the animation worklet threading model." src="img/AnimationWorklet-threading-model.svg" width="600"> 
    <figcaption>
      Overview of the animation worklet threading model. <br> 
     <p>A simplified visualization of how animators running in a parallel execution environment can sync
    their update to main thread while remaining in sync with visual frame production.</p>
    </figcaption>
   </figure>
   <h2 class="heading settled" data-level="3" id="animation-worklet-desc"><span class="secno">3. </span><span class="content">Animation Worklet</span><a class="self-link" href="#animation-worklet-desc"></a></h2>
    <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="animation-worklet">Animation Worklet</dfn> is a <code class="idl"><a data-link-type="idl" href="https://drafts.css-houdini.org/worklets/#worklet" id="ref-for-worklet">Worklet</a></code> responsible for all classes related to custom
animations. The worklet can be accessed via <code class="idl"><a data-link-type="idl" href="#dom-window-animationworklet" id="ref-for-dom-window-animationworklet">animationWorklet</a></code> attribute. 
   <p>The <code class="idl"><a data-link-type="idl" href="#dom-window-animationworklet" id="ref-for-dom-window-animationworkletâ ">animationWorklet</a></code>'s <a data-link-type="dfn" href="https://drafts.css-houdini.org/worklets/#worklet-global-scope-type" id="ref-for-worklet-global-scope-type">worklet global scope type</a> is <code class="idl"><a data-link-type="idl" href="#animationworkletglobalscope" id="ref-for-animationworkletglobalscope">AnimationWorkletGlobalScope</a></code>.</p>
   <p><code class="idl"><a data-link-type="idl" href="#animationworkletglobalscope" id="ref-for-animationworkletglobalscopeâ ">AnimationWorkletGlobalScope</a></code> represents a <dfn data-dfn-type="dfn" data-noexport="" id="global-execution-context">global execution context<a class="self-link" href="#global-execution-context"></a></dfn> of <code class="idl"><a data-link-type="idl" href="#dom-window-animationworklet" id="ref-for-dom-window-animationworkletâ¡">animationWorklet</a></code>.</p>
<pre class="idl highlight def"><span class="kt">partial</span> <span class="kt">interface</span> <a class="nv idl-code" data-link-type="interface" href="https://html.spec.whatwg.org/multipage/window-object.html#window" id="ref-for-window">Window</a> {
    [<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#SameObject" id="ref-for-SameObject">SameObject</a>] <span class="kt">readonly</span> <span class="kt">attribute</span> <a class="n" data-link-type="idl-name" href="https://drafts.css-houdini.org/worklets/#worklet" id="ref-for-workletâ ">Worklet</a> <dfn class="nv dfn-paneled idl-code" data-dfn-for="Window" data-dfn-type="attribute" data-export="" data-readonly="" data-type="Worklet" id="dom-window-animationworklet"><code>animationWorklet</code></dfn>;
};
</pre>
<pre class="idl highlight def"><span class="kt">callback</span> <dfn class="nv dfn-paneled idl-code" data-dfn-type="callback" data-export="" id="callbackdef-voidfunction"><code>VoidFunction</code></dfn> = <span class="kt">void</span> ();

[ <a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed" id="ref-for-Exposed">Exposed</a>=<span class="n">AnimationWorklet</span>, <a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Global" id="ref-for-Global">Global</a>=<a class="n" data-link-type="idl-name">AnimationWorklet</a> ]
<span class="kt">interface</span> <dfn class="nv dfn-paneled idl-code" data-dfn-type="interface" data-export="" id="animationworkletglobalscope"><code>AnimationWorkletGlobalScope</code></dfn> : <a class="n" data-link-type="idl-name" href="https://drafts.css-houdini.org/worklets/#workletglobalscope" id="ref-for-workletglobalscope">WorkletGlobalScope</a> {
    <span class="kt">void</span> <a class="nv idl-code" data-link-type="method" href="#dom-animationworkletglobalscope-registeranimator" id="ref-for-dom-animationworkletglobalscope-registeranimator">registerAnimator</a>(<a class="n idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString" id="ref-for-idl-DOMString"><span class="kt">DOMString</span></a> <dfn class="nv idl-code" data-dfn-for="AnimationWorkletGlobalScope/registerAnimator(name, animatorCtor)" data-dfn-type="argument" data-export="" id="dom-animationworkletglobalscope-registeranimator-name-animatorctor-name"><code>name</code><a class="self-link" href="#dom-animationworkletglobalscope-registeranimator-name-animatorctor-name"></a></dfn>, <a class="n" data-link-type="idl-name" href="#callbackdef-voidfunction" id="ref-for-callbackdef-voidfunction">VoidFunction</a> <dfn class="nv idl-code" data-dfn-for="AnimationWorkletGlobalScope/registerAnimator(name, animatorCtor)" data-dfn-type="argument" data-export="" id="dom-animationworkletglobalscope-registeranimator-name-animatorctor-animatorctor"><code>animatorCtor</code><a class="self-link" href="#dom-animationworkletglobalscope-registeranimator-name-animatorctor-animatorctor"></a></dfn>);
};
</pre>
   <div class="note" role="note">
     Note: This is how the class should look. 
<pre class="lang-javascript highlight"><span class="kr">class</span> FooAnimator <span class="p">{</span>
    constructor<span class="p">(</span>options<span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Called when a new animator is instantiated.</span>
<span class="c1"></span>    <span class="p">}</span>
    animate<span class="p">(</span>currentTime<span class="p">,</span> effect<span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Animation frame logic goes here.</span>
<span class="c1"></span>    <span class="p">}</span>
<span class="p">}</span>
</pre>
   </div>
   <h2 class="heading settled" data-level="4" id="animator-definition-desc"><span class="secno">4. </span><span class="content">Animator Definition</span><a class="self-link" href="#animator-definition-desc"></a></h2>
    An <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="animator-definition">animator definition</dfn> is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#struct" id="ref-for-struct">struct</a> which describes the author defined custom
animation as needed by <code class="idl"><a data-link-type="idl" href="#animationworkletglobalscope" id="ref-for-animationworkletglobalscopeâ¡">AnimationWorkletGlobalScope</a></code>. It consists of: 
   <ul>
    <li data-md="">
     <p>An <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="animator-name">animator name</dfn> <a class="production css" data-link-type="type" href="https://drafts.csswg.org/css-values-4/#typedef-ident" id="ref-for-typedef-ident">&lt;ident></a>#.</p>
    <li data-md="">
     <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="class-constructor">class constructor</dfn> which is the class <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#sec-constructor" id="ref-for-sec-constructor">constructor</a>.</p>
    <li data-md="">
     <p>An <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="animate-function">animate function</dfn> which is the animate <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#sec-terms-and-definitions-function" id="ref-for-sec-terms-and-definitions-function">function</a> callback.</p>
   </ul>
   <h3 class="heading settled" data-level="4.1" id="registering-animator-definition"><span class="secno">4.1. </span><span class="content">Registering an Animator Definition</span><a class="self-link" href="#registering-animator-definition"></a></h3>
    An <code class="idl"><a data-link-type="idl" href="#animationworkletglobalscope" id="ref-for-animationworkletglobalscopeâ¢">AnimationWorkletGlobalScope</a></code> has a <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="animator-name-to-animator-definition-map">animator name to animator definition map</dfn>.
The map gets populated when <code class="idl"><a data-link-type="idl" href="#dom-animationworkletglobalscope-registeranimator" id="ref-for-dom-animationworkletglobalscope-registeranimatorâ ">registerAnimator(name, animatorCtor)</a></code> is called. 
   <div class="algorithm" data-algorithm="register-animator">
    <p>When the <dfn class="dfn-paneled idl-code" data-dfn-for="AnimationWorkletGlobalScope" data-dfn-type="method" data-export="" id="dom-animationworkletglobalscope-registeranimator"><code>registerAnimator(<var>name</var>, <var>animatorCtor</var>)</code></dfn> method is called in a <code class="idl"><a data-link-type="idl" href="#animationworkletglobalscope" id="ref-for-animationworkletglobalscopeâ£">AnimationWorkletGlobalScope</a></code>, the user agent <em>must</em> run the
following steps:</p>
    <ol>
     <li data-md="">
      <p>If <var>name</var> is not a valid <a class="production css" data-link-type="type" href="https://drafts.csswg.org/css-values-4/#typedef-ident" id="ref-for-typedef-identâ ">&lt;ident></a>, <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-throw" id="ref-for-dfn-throw">throw</a> a <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#sec-native-error-types-used-in-this-standard-typeerror" id="ref-for-sec-native-error-types-used-in-this-standard-typeerror">TypeError</a> and abort all these
steps.</p>
     <li data-md="">
      <p>If <var>name</var> exists as a key in the <a data-link-type="dfn" href="#animator-name-to-animator-definition-map" id="ref-for-animator-name-to-animator-definition-map">animator name to animator definition map</a>, <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-throw" id="ref-for-dfn-throwâ ">throw</a> a <a data-link-type="dfn" href="https://heycam.github.io/webidl/#notsupportederror" id="ref-for-notsupportederror">NotSupportedError</a> and abort all these steps.</p>
     <li data-md="">
      <p>If the result of <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#sec-isconstructor" id="ref-for-sec-isconstructor">IsConstructor</a>(<var>animatorCtor</var>) is false, <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-throw" id="ref-for-dfn-throwâ¡">throw</a> a <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#sec-native-error-types-used-in-this-standard-typeerror" id="ref-for-sec-native-error-types-used-in-this-standard-typeerrorâ ">TypeError</a> and abort all these steps.</p>
     <li data-md="">
      <p>Let <var>prototype</var> be the result of <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#sec-get-o-p" id="ref-for-sec-get-o-p">Get</a>(<var>animatorCtor</var>, "prototype").</p>
     <li data-md="">
      <p>If the result of <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#sec-ecmascript-data-types-and-values" id="ref-for-sec-ecmascript-data-types-and-values">Type</a>(<var>prototype</var>) is not Object, <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-throw" id="ref-for-dfn-throwâ¢">throw</a> a <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#sec-native-error-types-used-in-this-standard-typeerror" id="ref-for-sec-native-error-types-used-in-this-standard-typeerrorâ¡">TypeError</a> and abort all these steps.</p>
     <li data-md="">
      <p>Let <var>animate</var> be the result of <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#sec-get-o-p" id="ref-for-sec-get-o-pâ ">Get</a>(<var>prototype</var>, "animate").</p>
     <li data-md="">
      <p>If the result of <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#sec-iscallable" id="ref-for-sec-iscallable">IsCallable</a>(<var>animate</var>) is false, <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-throw" id="ref-for-dfn-throwâ£">throw</a> a <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#sec-native-error-types-used-in-this-standard-typeerror" id="ref-for-sec-native-error-types-used-in-this-standard-typeerrorâ¢">TypeError</a> and
abort all these steps.</p>
     <li data-md="">
      <p>Let <var>definition</var> be a new <a data-link-type="dfn" href="#animator-definition" id="ref-for-animator-definition">animator definition</a> with:</p>
      <ul>
       <li data-md="">
        <p><a data-link-type="dfn" href="#animator-name" id="ref-for-animator-name">animator name</a> being <var>name</var></p>
       <li data-md="">
        <p><a data-link-type="dfn" href="#class-constructor" id="ref-for-class-constructor">class constructor</a> being <var>animatorCtor</var></p>
       <li data-md="">
        <p><a data-link-type="dfn" href="#animate-function" id="ref-for-animate-functionâ ">animate function</a> being <var>animate</var></p>
      </ul>
     <li data-md="">
      <p>Add the key-value pair (<var>name</var> - <var>definition</var>) to the <a data-link-type="dfn" href="#animator-name-to-animator-definition-map" id="ref-for-animator-name-to-animator-definition-mapâ ">animator name to animator
definition map</a>.</p>
    </ol>
   </div>
   <h2 class="heading settled" data-level="5" id="animator-instance-section"><span class="secno">5. </span><span class="content">Animator Instance</span><a class="self-link" href="#animator-instance-section"></a></h2>
   <p>An <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="animator-instance">animator instance</dfn> is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#struct" id="ref-for-structâ ">struct</a> which describes a fully realized custom animation
instance in an <code class="idl"><a data-link-type="idl" href="#animationworkletglobalscope" id="ref-for-animationworkletglobalscopeâ¤">AnimationWorkletGlobalScope</a></code>. It has a reference to an <a data-link-type="dfn" href="#animator-definition" id="ref-for-animator-definitionâ ">animator definition</a> and owns the instance specific state such as animation effect and timelines. It consists of:</p>
   <ul>
    <li data-md="">
     <p>An <a data-link-type="dfn" href="#animator-name" id="ref-for-animator-nameâ ">animator name</a>.</p>
    <li data-md="">
     <p>An <a data-link-type="dfn" href="#animation-requested-flag" id="ref-for-animation-requested-flag">animation requested flag</a>.</p>
    <li data-md="">
     <p>An <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="animator-effect">animator effect</dfn> which is an <a data-link-type="dfn" href="https://w3c.github.io/web-animations/#animation-effect" id="ref-for-animation-effectâ ">animation effect</a>.</p>
    <li data-md="">
     <p>An <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="animator-current-time">animator current time</dfn> which is the corresponding <a data-link-type="dfn" href="#worklet-animation" id="ref-for-worklet-animation">worklet animation</a>âs current
 time.</p>
    <li data-md="">
     <p>An <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="animator-timeline">animator timeline</dfn> which is a <a data-link-type="dfn" href="https://w3c.github.io/web-animations/#timeline" id="ref-for-timeline">timeline</a>.</p>
    <li data-md="">
     <p>An <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="animator-attached-timelines">animator attached timelines</dfn> which is <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list">list</a> of attached <a data-link-type="dfn" href="https://w3c.github.io/web-animations/#timeline" id="ref-for-timelineâ ">timelines</a></p>
    <li data-md="">
     <p>An <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="animator-serialized-options">animator serialized options</dfn> which is a serializable object.</p>
   </ul>
   <h3 class="heading settled" data-level="5.1" id="creating-animator-instance"><span class="secno">5.1. </span><span class="content">Creating an Animator Instance</span><a class="self-link" href="#creating-animator-instance"></a></h3>
   <p>Each <a data-link-type="dfn" href="#animator-instance" id="ref-for-animator-instance">animator instance</a> lives in an <code class="idl"><a data-link-type="idl" href="#animationworkletglobalscope" id="ref-for-animationworkletglobalscopeâ¥">AnimationWorkletGlobalScope</a></code>.</p>
   <p>Each <code class="idl"><a data-link-type="idl" href="#animationworkletglobalscope" id="ref-for-animationworkletglobalscopeâ¦">AnimationWorkletGlobalScope</a></code> has an <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="animator-instance-set">animator instance set</dfn>. The set is populated
when the user agent constructs a new <a data-link-type="dfn" href="#animator-instance" id="ref-for-animator-instanceâ ">animator instance</a> in the <code class="idl"><a data-link-type="idl" href="#animationworkletglobalscope" id="ref-for-animationworkletglobalscopeâ§">AnimationWorkletGlobalScope</a></code> scope. Each <a data-link-type="dfn" href="#animator-instance" id="ref-for-animator-instanceâ¡">animator instance</a> corresponds to a worklet animation in the document scope.</p>
   <div class="algorithm" data-algorithm="create-animator">
    <p>To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="create-a-new-animator-instance">create a new animator instance</dfn> given a <var>name</var>, <var>timeline</var>, <var>effect</var>, <var>serializedOptions</var>, <var>serializedState</var>, and <var>workletGlobalScope</var>, the user agent <em>must</em> run the following steps:</p>
    <ol>
     <li data-md="">
      <p>Let the <var>definition</var> be the result of looking up <var>name</var> on the <var>workletGlobalScope</var>âs <a data-link-type="dfn" href="#animator-name-to-animator-definition-map" id="ref-for-animator-name-to-animator-definition-mapâ¡">animator name to animator definition map</a>.</p>
      <p>If <var>definition</var> does not exist abort the following steps.</p>
     <li data-md="">
      <p>Let <var>animatorCtor</var> be the <a data-link-type="dfn" href="#class-constructor" id="ref-for-class-constructorâ ">class constructor</a> of <var>definition</var>.</p>
     <li data-md="">
      <p>Let <var>timelineList</var> be a new <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-listâ ">list</a> with <var>timeline</var> added to it.</p>
     <li data-md="">
      <p>Let <var>options</var> be <a data-link-type="dfn" href="http://w3c.github.io/html/infrastructure.html#structureddeserialize" id="ref-for-structureddeserialize">StructuredDeserialize</a>(<var>serializedOptions</var>).</p>
     <li data-md="">
      <p>Let <var>state</var> be <a data-link-type="dfn" href="http://w3c.github.io/html/infrastructure.html#structureddeserialize" id="ref-for-structureddeserializeâ ">StructuredDeserialize</a>(<var>serializedState</var>).</p>
     <li data-md="">
      <p>Let <var>animatorInstance</var> be the result of <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#sec-construct" id="ref-for-sec-construct">Construct</a>(<var>animatorCtor</var>, [<var>options</var>, <var>state</var>]).</p>
      <p>If <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#sec-construct" id="ref-for-sec-constructâ ">Construct</a> throws an exception, abort the following steps.</p>
     <li data-md="">
      <p>Set the following on <var>animatorInstance</var> with:</p>
      <ul>
       <li data-md="">
        <p><a data-link-type="dfn" href="#animator-name" id="ref-for-animator-nameâ¡">animator name</a> being <var>name</var></p>
       <li data-md="">
        <p><a data-link-type="dfn" href="#animation-requested-flag" id="ref-for-animation-requested-flagâ ">animation requested flag</a> being <a data-link-type="dfn" href="#frame-current" id="ref-for-frame-current">frame-current</a></p>
       <li data-md="">
        <p><a data-link-type="dfn" href="#animator-current-time" id="ref-for-animator-current-time">animator current time</a> being unresolved</p>
       <li data-md="">
        <p><a data-link-type="dfn" href="#animator-effect" id="ref-for-animator-effect">animator effect</a> being <var>effect</var></p>
       <li data-md="">
        <p><a data-link-type="dfn" href="#animator-timeline" id="ref-for-animator-timeline">animator timeline</a> being <var>timeline</var></p>
       <li data-md="">
        <p><a data-link-type="dfn" href="#animator-attached-timelines" id="ref-for-animator-attached-timelines">animator attached timelines</a> being <var>timelineList</var></p>
       <li data-md="">
        <p><a data-link-type="dfn" href="#animator-serialized-options" id="ref-for-animator-serialized-options">animator serialized options</a> being <var>options</var></p>
      </ul>
     <li data-md="">
      <p>Add <var>animatorInstance</var> to <var>workletGlobalScope</var>âs <a data-link-type="dfn" href="#animator-instance-set" id="ref-for-animator-instance-set">animator instance set</a>.</p>
    </ol>
   </div>
   <h3 class="heading settled" data-level="5.2" id="running-animators"><span class="secno">5.2. </span><span class="content">Running Animators</span><a class="self-link" href="#running-animators"></a></h3>
   <p>When a user agent wants to produce a new animation frame, if for any <a data-link-type="dfn" href="#animator-instance" id="ref-for-animator-instanceâ¢">animator instance</a> the
associated <a data-link-type="dfn" href="#animation-requested-flag" id="ref-for-animation-requested-flagâ¡">animation requested flag</a> is <a data-link-type="dfn" href="#frame-requested" id="ref-for-frame-requested">frame-requested</a> then the the user agent <em>must</em> <a data-link-type="dfn" href="#run-animators" id="ref-for-run-animators">run animators</a> for the current frame.</p>
   <p class="note" role="note"><span>Note:</span> The user agent is not required to run animations on every visual frame. It is legal to defer
      generating an animation frame until a later frame. This allow the user agent to
      provide a different service level according to their policy.</p>
   <div class="algorithm" data-algorithm="run-animators">
    <p>When the user agent wants to <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="run-animators">run animators</dfn> in a given <var>workletGlobalScope</var>, it <em>must</em> iterate over all <a data-link-type="dfn" href="#animator-instance" id="ref-for-animator-instanceâ£">animator instance</a>s in the <var>workletGlobalScope</var>âs <a data-link-type="dfn" href="#animator-instance-set" id="ref-for-animator-instance-setâ ">animator
instance set</a>. For each such <var>instance</var> the user agent <em>must</em> perform the following steps:</p>
    <ol>
     <li data-md="">
      <p>Let <var>animatorName</var> be <var>instance</var>âs <a data-link-type="dfn" href="#animator-name" id="ref-for-animator-nameâ¢">animator name</a></p>
     <li data-md="">
      <p>Let the <var>definition</var> be the result of looking up <var>animatorName</var> on the <var>workletGlobalScope</var>âs <a data-link-type="dfn" href="#animator-name-to-animator-definition-map" id="ref-for-animator-name-to-animator-definition-mapâ¢">animator name to animator definition map</a>.</p>
      <p>If <var>definition</var> does not exist then abort the following steps.</p>
     <li data-md="">
      <p>If the <a data-link-type="dfn" href="#animation-requested-flag" id="ref-for-animation-requested-flagâ¢">animation requested flag</a> for <var>instance</var> is <a data-link-type="dfn" href="#frame-current" id="ref-for-frame-currentâ ">frame-current</a> or the effect
   belonging to the <var>instance</var> will not be visible within the visual viewport of the current
   frame the user agent <em>may</em> abort all the following steps.</p>
      <p class="issue" id="issue-6d334361"><a class="self-link" href="#issue-6d334361"></a> Consider giving user agents permission to skip running animator instances to
   throttle slow animators.</p>
     <li data-md="">
      <p>Let <var>animateFunction</var> be <var>definition</var>âs <a data-link-type="dfn" href="#animate-function" id="ref-for-animate-functionâ¡">animate function</a>.</p>
     <li data-md="">
      <p>Let <var>currentTime</var> be <a data-link-type="dfn" href="#animator-current-time" id="ref-for-animator-current-timeâ ">animator current time</a> of <var>instance</var>.</p>
     <li data-md="">
      <p>Let <var>effect</var> be <a data-link-type="dfn" href="#animator-effect" id="ref-for-animator-effectâ ">animator effect</a> of <var>instance</var>.</p>
     <li data-md="">
      <p><a data-link-type="dfn" href="https://heycam.github.io/webidl/#es-invoking-callback-functions" id="ref-for-es-invoking-callback-functions">Invoke</a> <var>animateFunction</var> with arguments Â«<var>currentTime</var>, <var>effect</var>Â»,
    and with <var>instance</var> as the <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-callback-this-value" id="ref-for-dfn-callback-this-value">callback this value</a>.</p>
    </ol>
   </div>
    Note: Although inefficient, it is legal for the user agent to <a data-link-type="dfn" href="#run-animators" id="ref-for-run-animatorsâ ">run animators</a> multiple times
in the same frame. 
   <h3 class="heading settled" data-level="5.3" id="removing-animator"><span class="secno">5.3. </span><span class="content">Removing an Animator Instance</span><a class="self-link" href="#removing-animator"></a></h3>
   <div class="algorithm" data-algorithm="remove-animator">
    <p>To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="remove-an-animator-instance">remove an animator instance</dfn> given <var>instance</var> and <var>workletGlobalScope</var> the user agent <em>must</em> run the following steps:</p>
    <ol>
     <li data-md="">
      <p>Remove <var>instance</var> from <var>workletGlobalScope</var>âs <a data-link-type="dfn" href="#animator-instance-set" id="ref-for-animator-instance-setâ¡">animator instance set</a>.</p>
    </ol>
   </div>
   <h3 class="heading settled" data-level="5.4" id="migrating-animator"><span class="secno">5.4. </span><span class="content">Migrating an Animator Instance</span><a class="self-link" href="#migrating-animator"></a></h3>
   <p>User agents are responsible for assigning an <a data-link-type="dfn" href="#animator-instance" id="ref-for-animator-instanceâ¤">animator instance</a> to a <code class="idl"><a data-link-type="idl" href="https://drafts.css-houdini.org/worklets/#workletglobalscope" id="ref-for-workletglobalscopeâ ">WorkletGlobalScope</a></code>.
There can be many such <code class="idl"><a data-link-type="idl" href="https://drafts.css-houdini.org/worklets/#workletglobalscope" id="ref-for-workletglobalscopeâ¡">WorkletGlobalScope</a></code>s, which may exist across different threads or
processes. To give the most flexibility to user agents in this respect, we allow migration of an <a data-link-type="dfn" href="#animator-instance" id="ref-for-animator-instanceâ¥">animator instance</a> while it is running. The basic mechanism is to serialize the internal state
of any author-defined effect, and restore it after migration.</p>
   <div class="algorithm" data-algorithm="migrate-animator">
    <p>To <dfn data-dfn-type="dfn" data-noexport="" id="migrate-an-animator-instance">migrate an animator instance<a class="self-link" href="#migrate-an-animator-instance"></a></dfn> from one <code class="idl"><a data-link-type="idl" href="https://drafts.css-houdini.org/worklets/#workletglobalscope" id="ref-for-workletglobalscopeâ¢">WorkletGlobalScope</a></code> to another, given <var>instance</var>, <var>sourceWorkletGlobalScope</var>, <var>destinationWorkletGlobalScope</var>, the user agent <em>must</em> run the following steps :</p>
    <ol>
     <li data-md="">
      <p>Let <var>serializedState</var> be undefined.</p>
     <li data-md="">
      <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task" id="ref-for-queue-a-task">Queue a task</a> on <var>sourceWorkletGlobalScope</var> to run the following steps:</p>
      <ol>
       <li data-md="">
        <p>Let <var>animatorName</var> be <var>instance</var>âs <a data-link-type="dfn" href="#animator-name" id="ref-for-animator-nameâ£">animator name</a></p>
       <li data-md="">
        <p>Let <var>definition</var> be the result of looking up <var>animatorName</var> on <var>sourceWorkletGlobalScope</var>âs <a data-link-type="dfn" href="#animator-name-to-animator-definition-map" id="ref-for-animator-name-to-animator-definition-mapâ£">animator name to animator definition map</a>.</p>
        <p>If <var>definition</var> does not exist then abort the following steps.</p>
       <li data-md="">
        <p>Let <var>animatorCtor</var> be the <a data-link-type="dfn" href="#class-constructor" id="ref-for-class-constructorâ¡">class constructor</a> of <var>definition</var>.</p>
       <li data-md="">
        <p>Let <var>prototype</var> be the result of <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#sec-get-o-p" id="ref-for-sec-get-o-pâ¡">Get</a>(<var>animatorCtor</var>, "prototype").</p>
       <li data-md="">
        <p>Let <var>onDestroyFunction</var> be the result of <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#sec-get-o-p" id="ref-for-sec-get-o-pâ¢">Get</a>(<var>prototype</var>, "onDestroy").</p>
       <li data-md="">
        <p>If the result of <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#sec-iscallable" id="ref-for-sec-iscallableâ ">IsCallable</a>(<var>onDestroyFunction</var>) is false then abort the following
steps.</p>
       <li data-md="">
        <p><a data-link-type="dfn" href="https://heycam.github.io/webidl/#es-invoking-callback-functions" id="ref-for-es-invoking-callback-functionsâ ">Invoke</a> <var>onDestroyFunction</var> with <var>instance</var> as the <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-callback-this-value" id="ref-for-dfn-callback-this-valueâ ">callback this value</a> and let <var>state</var> be the result of the invocation.</p>
       <li data-md="">
        <p>Set <var>serializedState</var> to be the result of <a data-link-type="dfn" href="http://w3c.github.io/html/infrastructure.html#structuredserialize" id="ref-for-structuredserialize">StructuredSerialize</a>(<var>state</var>).
If any exception is thrown, then abort the following steps.</p>
       <li data-md="">
        <p>Run the procedure to <a data-link-type="dfn" href="#remove-an-animator-instance" id="ref-for-remove-an-animator-instance">remove an animator instance</a> given <var>instance</var>, and <var>sourceWorkletGlobalScope</var>.</p>
      </ol>
     <li data-md="">
      <p>Wait for the above task to complete. If the task is aborted, abort the following steps.</p>
     <li data-md="">
      <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task" id="ref-for-queue-a-taskâ ">Queue a task</a> on <var>destinationWorkletGlobalScope</var> to run the following steps:</p>
      <ol>
       <li data-md="">
        <p>Run the procedure to <a data-link-type="dfn" href="#create-a-new-animator-instance" id="ref-for-create-a-new-animator-instance">create a new animator instance</a> given:</p>
        <ul>
         <li data-md="">
          <p>The <var>instance</var>âs <a data-link-type="dfn" href="#animator-name" id="ref-for-animator-nameâ¤">animator name</a> as name.</p>
         <li data-md="">
          <p>The <var>instance</var>âs <a data-link-type="dfn" href="#animator-timeline" id="ref-for-animator-timelineâ ">animator timeline</a> as timeline.</p>
         <li data-md="">
          <p>The <var>instance</var>âs <a data-link-type="dfn" href="#animator-effect" id="ref-for-animator-effectâ¡">animator effect</a> as effect.</p>
         <li data-md="">
          <p>The <var>instance</var>âs <a data-link-type="dfn" href="#animator-serialized-options" id="ref-for-animator-serialized-optionsâ ">animator serialized options</a> as options.</p>
         <li data-md="">
          <p>The <var>serializedState</var> as state.</p>
         <li data-md="">
          <p>The <var>destinationWorkletGlobalScope</var> as workletGlobalScope.</p>
        </ul>
      </ol>
    </ol>
   </div>
   <h3 class="heading settled" data-level="5.5" id="requesting-animation-frames"><span class="secno">5.5. </span><span class="content">Requesting Animation Frames</span><a class="self-link" href="#requesting-animation-frames"></a></h3>
   <p>Each <a data-link-type="dfn" href="#animator-instance" id="ref-for-animator-instanceâ¦">animator instance</a> has an associated <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="animation-requested-flag">animation requested flag</dfn>. It must be
either <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="frame-requested">frame-requested</dfn> or <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="frame-current">frame-current</dfn>. It is initially set to <a data-link-type="dfn" href="#frame-current" id="ref-for-frame-currentâ¡">frame-current</a>. Different circumstances can cause the <a data-link-type="dfn" href="#animation-requested-flag" id="ref-for-animation-requested-flagâ£">animation requested flag</a> to be
set to <a data-link-type="dfn" href="#frame-requested" id="ref-for-frame-requestedâ ">frame-requested</a>. These include the following:</p>
   <ul>
    <li data-md="">
     <p>Changes in the <a data-link-type="dfn" href="https://w3c.github.io/web-animations/#current-time" id="ref-for-current-time">current time</a> of any <a data-link-type="dfn" href="https://w3c.github.io/web-animations/#timeline" id="ref-for-timelineâ¡">timeline</a> in the animatorâs <a data-link-type="dfn" href="#animator-attached-timelines" id="ref-for-animator-attached-timelinesâ ">animator attached timelines</a></p>
    <li data-md="">
     <p>Changes in the <a data-link-type="dfn" href="https://w3c.github.io/web-animations/#current-time" id="ref-for-current-timeâ ">current time</a> of the animatorâs corresponding <a data-link-type="dfn" href="#worklet-animation" id="ref-for-worklet-animationâ ">Worklet Animation</a></p>
   </ul>
   <p><a href="#running-animators">Â§5.2 Running Animators</a> resets the <a data-link-type="dfn" href="#animation-requested-flag" id="ref-for-animation-requested-flagâ¤">animation requested flag</a> on animators to <a data-link-type="dfn" href="#frame-current" id="ref-for-frame-currentâ¢">frame-current</a>.</p>
   <h2 class="heading settled" data-level="6" id="web-animation-integration"><span class="secno">6. </span><span class="content">Web Animations Integration</span><a class="self-link" href="#web-animation-integration"></a></h2>
   <h3 class="heading settled" data-level="6.1" id="worklet-animation-desc"><span class="secno">6.1. </span><span class="content">Worklet Animation</span><a class="self-link" href="#worklet-animation-desc"></a></h3>
    <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="worklet-animation">Worklet animation</dfn> is a kind of <a data-link-type="dfn" href="https://w3c.github.io/web-animations/#concept-animation" id="ref-for-concept-animation">animation</a> that delegates the animation playback to
an <a data-link-type="dfn" href="#animator-instance" id="ref-for-animator-instanceâ§">animator instance</a>. It controls the lifetime and playback state of its corresponding <a data-link-type="dfn" href="#animator-instance" id="ref-for-animator-instanceâ¨">animator instance</a>. 
   <p>Being an <a data-link-type="dfn" href="https://w3c.github.io/web-animations/#concept-animation" id="ref-for-concept-animationâ ">animation</a>, <a data-link-type="dfn" href="#worklet-animation" id="ref-for-worklet-animationâ¡">worklet animation</a> has an <a data-link-type="dfn" href="https://w3c.github.io/web-animations/#animation-effect" id="ref-for-animation-effectâ¡">animation effect</a> and a <a data-link-type="dfn" href="https://w3c.github.io/web-animations/#timeline" id="ref-for-timelineâ¢">timeline</a>. However unlike other animations the worklet animationâs <a data-link-type="dfn" href="https://w3c.github.io/web-animations/#current-time" id="ref-for-current-timeâ¡">current time</a> does
not directly determine the animation effectâs <a data-link-type="dfn" href="https://w3c.github.io/web-animations/#local-time" id="ref-for-local-time">local time</a> (via its <a data-link-type="dfn" href="https://w3c.github.io/web-animations/#inherited-time" id="ref-for-inherited-time">inherited time</a>).
Instead the associated <a data-link-type="dfn" href="#animator-instance" id="ref-for-animator-instanceâ âª">animator instance</a> controls the animation effectâs <a data-link-type="dfn" href="https://w3c.github.io/web-animations/#local-time" id="ref-for-local-timeâ ">local time</a> directly. Note that this means that the <a data-link-type="dfn" href="https://w3c.github.io/web-animations/#timeline" id="ref-for-timelineâ£">timelineâs</a> current time does not fully determine the
animationâs output.</p>
   <p><a data-link-type="dfn" href="#worklet-animation" id="ref-for-worklet-animationâ¢">Worklet animation</a> has the following properties in addition to the <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/web-animations/level-2/#animation" id="ref-for-animationâ ">Animation</a></code> interface:</p>
   <ul>
    <li data-md="">
     <p>an <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="animation-animator-name">animation animator name</dfn> which identifies its <a data-link-type="dfn" href="#animator-definition" id="ref-for-animator-definitionâ¡">animator definition</a>.</p>
    <li data-md="">
     <p>a <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="serialized-options">serialized options</dfn> which is serializable object that is used when
constructing a new animator instance.</p>
   </ul>
   <figure>
     <img alt="Overview of the WorkletAnimation timing model." src="img/WorkletAnimation-timing-model.svg" width="600"> 
    <figcaption>
      Overview of the WorkletAnimation timing model. <br> 
     <p>The animation current time is input to the animator instance, which produces a local time value
    for the animation effect. If the animator instance is running in a parallel global scope the
    implementation may also choose to use the local time value to produce the final effect value and
    update the visuals in parallel.</p>
    </figcaption>
   </figure>
   <h3 class="heading settled" data-level="6.2" id="creating-worklet-animation"><span class="secno">6.2. </span><span class="content">Creating a Worklet Animation</span><a class="self-link" href="#creating-worklet-animation"></a></h3>
<pre class="idl highlight def">[Constructor (DOMString animatorName,
              optional (AnimationEffectReadOnly or sequence)? effects = null,
              optional AnimationTimeline? timeline,
              optional any options)]
<span class="kt">interface</span> <dfn class="nv dfn-paneled idl-code" data-dfn-type="interface" data-export="" id="workletanimation"><code>WorkletAnimation</code></dfn> : <a class="n" data-link-type="idl-name" href="https://w3c.github.io/web-animations/level-2/#animation" id="ref-for-animationâ¡">Animation</a> {
        <span class="kt">readonly</span> <span class="kt">attribute</span> <a class="n idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString" id="ref-for-idl-DOMStringâ "><span class="kt">DOMString</span></a> <dfn class="nv idl-code" data-dfn-for="WorkletAnimation" data-dfn-type="attribute" data-export="" data-readonly="" data-type="DOMString" id="dom-workletanimation-animatorname"><code>animatorName</code><a class="self-link" href="#dom-workletanimation-animatorname"></a></dfn>;
};

</pre>
   <div class="algorithm" data-algorithm="create-worklet-animation">
     <dfn class="idl-code" data-dfn-for="WorkletAnimation" data-dfn-type="constructor" data-export="" id="dom-workletanimation-workletanimation"><code>WorkletAnimation(<var>animatorName</var>, <var>effects</var>, <var>timeline</var>, <var>options</var>)</code><a class="self-link" href="#dom-workletanimation-workletanimation"></a></dfn> 
    <p>Creates a new <code class="idl"><a data-link-type="idl" href="#workletanimation" id="ref-for-workletanimation">WorkletAnimation</a></code> object using the following procedure.</p>
    <ol>
     <li data-md="">
      <p>Let <var>workletAnimation</var> be a new <code class="idl"><a data-link-type="idl" href="#workletanimation" id="ref-for-workletanimationâ ">WorkletAnimation</a></code> object.</p>
     <li data-md="">
      <p>Run the procedure to <a data-link-type="dfn" href="https://w3c.github.io/web-animations/#set-the-timeline-of-an-animation" id="ref-for-set-the-timeline-of-an-animation">set the timeline of an animation</a> on <var>workletAnimation</var> passing <var>timeline</var> as the new timeline or, if a <var>timeline</var> argument is not provided,
passing the <a data-link-type="dfn" href="https://w3c.github.io/web-animations/#the-documents-default-timeline" id="ref-for-the-documents-default-timeline">default document timeline</a> of the <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#document" id="ref-for-document">Document</a></code> associated with the <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/window-object.html#window" id="ref-for-windowâ ">Window</a></code> that is the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#current-global-object" id="ref-for-current-global-object">current global object</a>.</p>
     <li data-md="">
      <p>Let <var>effect</var> be the result corresponding to the first matching condition from below.</p>
      <dl>
       <dt data-md="">If <var>effects</var> is a <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/web-animations/level-2/#animationeffectreadonly" id="ref-for-animationeffectreadonly">AnimationEffectReadOnly</a></code> object,
       <dd data-md="">
        <p>Let effect be <var>effects</var>.</p>
       <dt data-md="">If <var>effects</var> is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-listâ¡">list</a> of <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/web-animations/level-2/#animationeffectreadonly" id="ref-for-animationeffectreadonlyâ ">AnimationEffectReadOnly</a></code> objects,
       <dd data-md="">
        <p>Let <var>effect</var> be a new <code class="idl"><a data-link-type="idl" href="#workletgroupeffect" id="ref-for-workletgroupeffect">WorkletGroupEffect</a></code> with its children set to <var>effects</var>.</p>
       <dt data-md="">Otherwise,
       <dd data-md="">
        <p>Let <var>effect</var> be undefined.</p>
      </dl>
     <li data-md="">
      <p>Run the procedure to <a data-link-type="dfn" href="https://w3c.github.io/web-animations/#set-the-target-effect-of-an-animation" id="ref-for-set-the-target-effect-of-an-animation">set the target effect of an animation</a> on <var>workletAnimation</var> passing <var>effect</var> as the new effect.</p>
     <li data-md="">
      <p>Let <var>serializedOptions</var> be the result of <a data-link-type="dfn" href="http://w3c.github.io/html/infrastructure.html#structuredserialize" id="ref-for-structuredserializeâ ">StructuredSerialize</a>(<var>options</var>).
Rethrow any exceptions.</p>
     <li data-md="">
      <p>Set the <a data-link-type="dfn" href="#serialized-options" id="ref-for-serialized-options">serialized options</a> of <var>workletAnimation</var> to <var>serializedOptions</var>.</p>
     <li data-md="">
      <p>Set the <a data-link-type="dfn" href="#animation-animator-name" id="ref-for-animation-animator-name">animation animator name</a> of <var>workletAnimation</var> to <var>animatorName</var>.</p>
    </ol>
   </div>
   <h3 class="heading settled" data-level="6.3" id="timing-model"><span class="secno">6.3. </span><span class="content">Worklet Animation timing model</span><a class="self-link" href="#timing-model"></a></h3>
   <p>This section describes how <a data-link-type="dfn" href="#worklet-animation" id="ref-for-worklet-animationâ£">worklet animationâs</a> timing model differs from other <a data-link-type="dfn" href="https://w3c.github.io/web-animations/#concept-animation" id="ref-for-concept-animationâ¡">animations</a>.</p>
   <p>In addition to the existing conditions on when the <a data-link-type="dfn" href="https://w3c.github.io/web-animations/#concept-animation" id="ref-for-concept-animationâ¢">animation</a> is considered <a data-link-type="dfn" href="https://w3c.github.io/web-animations/#ready" id="ref-for-ready">ready</a>, a <a data-link-type="dfn" href="#worklet-animation" id="ref-for-worklet-animationâ¤">worklet animation</a> is only considered <a data-link-type="dfn" href="https://w3c.github.io/web-animations/#ready" id="ref-for-readyâ ">ready</a> when the following condition is also true:</p>
   <ul>
    <li data-md="">
     <p>the user agent has completed any setup required to create the <a data-link-type="dfn" href="#worklet-animation" id="ref-for-worklet-animationâ¥">worklet animationâs</a> corresponding <a data-link-type="dfn" href="#animator-instance" id="ref-for-animator-instanceâ â ">animator instance</a>.</p>
   </ul>
   <p>As described in <a href="#worklet-animation-desc">Â§6.1 Worklet Animation</a>, the <a data-link-type="dfn" href="#worklet-animation" id="ref-for-worklet-animationâ¦">worklet animationâs</a> <a data-link-type="dfn" href="https://w3c.github.io/web-animations/#current-time" id="ref-for-current-timeâ¢">current time</a> does
not determine its <a data-link-type="dfn" href="https://w3c.github.io/web-animations/#animation-effect" id="ref-for-animation-effectâ¢">animation effectâs</a> <a data-link-type="dfn" href="https://w3c.github.io/web-animations/#local-time" id="ref-for-local-timeâ¡">local time</a>. Instead the associated <a data-link-type="dfn" href="#animator-instance" id="ref-for-animator-instanceâ â¡">animator
instance</a> controls the animation effectâs <a data-link-type="dfn" href="https://w3c.github.io/web-animations/#local-time" id="ref-for-local-timeâ¢">local time</a> directly. This means that the
animation effectâs local time is controlled from a <code class="idl"><a data-link-type="idl" href="https://drafts.css-houdini.org/worklets/#workletglobalscope" id="ref-for-workletglobalscopeâ£">WorkletGlobalScope</a></code> which may be in a parallel
execution context.</p>
   <p>Here are a few implications of the above semantics:</p>
   <ul>
    <li data-md="">
     <p>Setting the <a data-link-type="dfn" href="https://w3c.github.io/web-animations/#current-time" id="ref-for-current-timeâ£">current time</a> or <a data-link-type="dfn" href="https://drafts.csswg.org/css-transitions-1/#transition-start-time" id="ref-for-transition-start-time">start time</a> of a <a data-link-type="dfn" href="#worklet-animation" id="ref-for-worklet-animationâ§">worklet animation</a> does not
necessarily change its output, but may change the animation <a data-link-type="dfn" href="https://w3c.github.io/web-animations/#play-state" id="ref-for-play-state">play state</a>.</p>
    <li data-md="">
     <p>Similarly, invoking <code class="idl"><a data-link-type="idl" href="https://drafts.csswg.org/web-animations-1/#dom-animation-finish" id="ref-for-dom-animation-finish">finish()</a></code> or updating a <a data-link-type="dfn" href="#worklet-animation" id="ref-for-worklet-animationâ¨">worklet animationâs</a> <a data-link-type="dfn" href="https://w3c.github.io/web-animations/#playback-rate" id="ref-for-playback-rate">playback
rate</a> will only change the animation <a data-link-type="dfn" href="https://w3c.github.io/web-animations/#play-state" id="ref-for-play-stateâ ">play state</a> and may not change the output.</p>
    <li data-md="">
     <p>Querying the animation effectâs local time using <code class="idl"><a data-link-type="idl" href="https://drafts.csswg.org/web-animations-1/#dom-animationeffectreadonly-getcomputedtiming" id="ref-for-dom-animationeffectreadonly-getcomputedtiming">getComputedTiming()</a></code> may return stale information, in the case where the <a data-link-type="dfn" href="#animator-instance" id="ref-for-animator-instanceâ â¢">animator instance</a> is running in a
parallel execution context.</p>
   </ul>
   <p class="issue" id="issue-7d7a2dd9"><a class="self-link" href="#issue-7d7a2dd9"></a> Come with appropriate mechanismâs for <a data-link-type="dfn" href="#animator-instance" id="ref-for-animator-instanceâ â£">animator instance</a> to get notified when its
   animation currentTime is changing e.g., via reverse(), finish() or playbackRate change. So that
   it can react appropriately. <a href="https://github.com/wicg/animation-worklet/issues/63">&lt;https://github.com/wicg/animation-worklet/issues/63></a></p>
   <h3 class="heading settled" data-level="6.4" id="worklet-animation-animator-instances"><span class="secno">6.4. </span><span class="content">Interaction with Animator Instances</span><a class="self-link" href="#worklet-animation-animator-instances"></a></h3>
   <p>A <a data-link-type="dfn" href="#worklet-animation" id="ref-for-worklet-animationâ âª">worklet animation</a> corresponds to at most one <a data-link-type="dfn" href="#animator-instance" id="ref-for-animator-instanceâ â¤">animator instance</a> at any time, and may
have no current corresponding <a data-link-type="dfn" href="#animator-instance" id="ref-for-animator-instanceâ â¥">animator instance</a>. The correspondance of an <a data-link-type="dfn" href="#animator-instance" id="ref-for-animator-instanceâ â¦">animator
instance</a> for a <a data-link-type="dfn" href="#worklet-animation" id="ref-for-worklet-animationâ â ">worklet animation</a> depends on the animation <a data-link-type="dfn" href="https://w3c.github.io/web-animations/#play-state" id="ref-for-play-stateâ¡">play state</a>.</p>
   <div class="algorithm" data-algorithm="associate-animator-instance">
    <p>To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="associate-animator-instance-of-worklet-animation">associate animator instance of worklet animation</dfn> given <var>workletAnimation</var>,
the user agent <em>must</em> run the following steps:</p>
    <ol>
     <li data-md="">
      <p>If <var>workletAnimation</var> has a corresponding <a data-link-type="dfn" href="#animator-instance" id="ref-for-animator-instanceâ â§">animator instance</a>, abort the following steps.</p>
     <li data-md="">
      <p>Let <var>workletGlobalScope</var> be the <code class="idl"><a data-link-type="idl" href="#animationworkletglobalscope" id="ref-for-animationworkletglobalscopeâ¨">AnimationWorkletGlobalScope</a></code> associated with <var>workletAnimation</var>.</p>
     <li data-md="">
      <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task" id="ref-for-queue-a-taskâ¡">Queue a task</a> on <var>workletGlobalScope</var> to run the procedure to <a data-link-type="dfn" href="#create-a-new-animator-instance" id="ref-for-create-a-new-animator-instanceâ ">create a new animator
   instance</a>, passing:</p>
      <ul>
       <li data-md="">
        <p>The <var>workletAnimation</var>âs <a data-link-type="dfn" href="#animation-animator-name" id="ref-for-animation-animator-nameâ ">animation animator name</a> as name.</p>
       <li data-md="">
        <p>The <var>workletAnimation</var>âs <a data-link-type="dfn" href="https://w3c.github.io/web-animations/#timeline" id="ref-for-timelineâ¤">timeline</a> as timeline.</p>
       <li data-md="">
        <p>The <var>workletAnimation</var>âs <a data-link-type="dfn" href="https://w3c.github.io/web-animations/#animation-effect" id="ref-for-animation-effectâ£">animation effect</a> as effect.</p>
       <li data-md="">
        <p>The <var>workletAnimation</var>âs <a data-link-type="dfn" href="#serialized-options" id="ref-for-serialized-optionsâ ">serialized options</a> as options.</p>
       <li data-md="">
        <p>The <var>workletGlobalScope</var> as workletGlobalScope.</p>
      </ul>
     <li data-md="">
      <p>If the procedure was successful, set the resulting <a data-link-type="dfn" href="#animator-instance" id="ref-for-animator-instanceâ â¨">animator instance</a> as corresponding to <var>workletAnimation</var>.</p>
    </ol>
   </div>
   <div class="algorithm" data-algorithm="disassociate-animator-instance">
    <p>To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="disassociate-animator-instance-of-worklet-animation">disassociate animator instance of worklet animation</dfn> given <var>workletAnimation</var>, the user age <em>must</em> run the following steps:</p>
    <ol>
     <li data-md="">
      <p>If <var>workletAnimation</var> does not have a corresponding <a data-link-type="dfn" href="#animator-instance" id="ref-for-animator-instanceâ¡âª">animator instance</a>, abort the
following steps.</p>
     <li data-md="">
      <p>Let <var>workletGlobalScope</var> be the <code class="idl"><a data-link-type="idl" href="#animationworkletglobalscope" id="ref-for-animationworkletglobalscopeâ âª">AnimationWorkletGlobalScope</a></code> associated with <var>workletAnimation</var>.</p>
     <li data-md="">
      <p>Let <var>animatorInstance</var> be <var>workletAnimation</var>âs corresponding <a data-link-type="dfn" href="#animator-instance" id="ref-for-animator-instanceâ¡â ">animator instance</a>.</p>
     <li data-md="">
      <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task" id="ref-for-queue-a-taskâ¢">Queue a task</a> on the <var>workletGlobalScope</var> to run the procedure to <a data-link-type="dfn" href="#remove-an-animator-instance" id="ref-for-remove-an-animator-instanceâ ">remove an animator
 instance</a>, passing <var>animatorInstance</var> as instance and <var>workletGlobalScope</var> as
 workletGlobalScope.</p>
     <li data-md="">
      <p>Set <var>workletAnimation</var> as having no corresponding <a data-link-type="dfn" href="#animator-instance" id="ref-for-animator-instanceâ¡â¡">animator instance</a>.</p>
    </ol>
   </div>
   <div class="algorithm" data-algorithm="set-animator-instance">
    <p>To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="set-animator-instance-of-worklet-animation">set animator instance of worklet animation</dfn> given <var>workletAnimation</var>, the user agent <em>must</em> run the following steps:</p>
    <ol>
     <li data-md="">
      <p><a data-link-type="dfn" href="#disassociate-animator-instance-of-worklet-animation" id="ref-for-disassociate-animator-instance-of-worklet-animation">disassociate animator instance of worklet animation</a> given <var>workletAnimation</var>.</p>
     <li data-md="">
      <p><a data-link-type="dfn" href="#associate-animator-instance-of-worklet-animation" id="ref-for-associate-animator-instance-of-worklet-animation">associate animator instance of worklet animation</a> given <var>workletAnimation</var>.</p>
    </ol>
   </div>
   <p>When a given <var>workletAnimation</var>âs <a data-link-type="dfn" href="https://w3c.github.io/web-animations/#play-state" id="ref-for-play-stateâ¢">play state</a> changes to <a data-link-type="dfn" href="https://w3c.github.io/web-animations/#pending" id="ref-for-pending">pending</a>, <a data-link-type="dfn" href="https://w3c.github.io/web-animations/#running" id="ref-for-running">running</a>, or <a data-link-type="dfn" href="https://w3c.github.io/web-animations/#paused" id="ref-for-paused">paused</a>, run the procedure to <a data-link-type="dfn" href="#associate-animator-instance-of-worklet-animation" id="ref-for-associate-animator-instance-of-worklet-animationâ ">associate animator instance of worklet animation</a> given <var>workletAnimation</var>.</p>
   <p>When a given <var>workletAnimation</var>âs <a data-link-type="dfn" href="https://w3c.github.io/web-animations/#play-state" id="ref-for-play-stateâ£">play state</a> changes to <a data-link-type="dfn" href="https://w3c.github.io/web-animations/#idle" id="ref-for-idle">idle</a> or <a data-link-type="dfn" href="https://w3c.github.io/web-animations/#finished" id="ref-for-finished">finished</a>,
run the procedure to <a data-link-type="dfn" href="#disassociate-animator-instance-of-worklet-animation" id="ref-for-disassociate-animator-instance-of-worklet-animationâ ">disassociate animator instance of worklet animation</a> given <var>workletAnimation</var>.</p>
   <p>When the procedure to <a data-link-type="dfn" href="https://w3c.github.io/web-animations/#set-the-target-effect-of-an-animation" id="ref-for-set-the-target-effect-of-an-animationâ ">set the target effect of an animation</a> for a given <var>workletAnimation</var> is called, then <a data-link-type="dfn" href="#set-animator-instance-of-worklet-animation" id="ref-for-set-animator-instance-of-worklet-animation">set animator instance of worklet animation</a> given <var>workletAnimation</var>.</p>
   <p>When the procedure to <a data-link-type="dfn" href="https://w3c.github.io/web-animations/#set-the-timeline-of-an-animation" id="ref-for-set-the-timeline-of-an-animationâ ">set the timeline of an animation</a> for a given <var>workletAnimation</var> is called, then <a data-link-type="dfn" href="#set-animator-instance-of-worklet-animation" id="ref-for-set-animator-instance-of-worklet-animationâ ">set animator instance of worklet animation</a> given <var>workletAnimation</var>.</p>
   <h3 class="heading settled" data-level="6.5" id="timeline-attachment"><span class="secno">6.5. </span><span class="content">Timeline Attachment</span><a class="self-link" href="#timeline-attachment"></a></h3>
   <p class="issue" id="issue-1b7aae40"><a class="self-link" href="#issue-1b7aae40"></a> Define semantics of attachment and detachment. <a href="https://github.com/wicg/animation-worklet/issues/61">&lt;https://github.com/wicg/animation-worklet/issues/61></a></p>
   <h3 class="heading settled" data-level="6.6" id="scroll-timeline"><span class="secno">6.6. </span><span class="content">ScrollTimeline</span><a class="self-link" href="#scroll-timeline"></a></h3>
    <code class="idl"><a data-link-type="idl" href="https://wicg.github.io/scroll-animations/#scrolltimeline" id="ref-for-scrolltimeline">ScrollTimeline</a></code> is a new concept being proposed for addition to web animation API. It defines
an animation timeline whose time value depends on the scroll position of a scroll container. <a data-link-type="dfn" href="#worklet-animation" id="ref-for-worklet-animationâ â¡">Worklet animations</a> can have a scroll timeline and thus drive their scripted effects based
on a scroll offset. 
   <p class="note" role="note"><span>Note:</span> <strong>Access to input</strong>: We are interested on exposing additional user input beside
scrolling (e.g., touch/pointer input) to these animations so that authors can create jank-free
input driven animations which are not really possible today. We are still trying to figure out the
right abstractions and mechanisms to do this.</p>
   <h3 class="heading settled" data-level="6.7" id="worklet-group-effect"><span class="secno">6.7. </span><span class="content">WorkletGroupEffect</span><a class="self-link" href="#worklet-group-effect"></a></h3>
   <p><code class="idl"><a data-link-type="idl" href="#workletgroupeffect" id="ref-for-workletgroupeffectâ ">WorkletGroupEffect</a></code> is a type of <a data-link-type="dfn" href="https://w3c.github.io/web-animations/level-2/#group-effect" id="ref-for-group-effect">group effect</a> that allows its <a data-link-type="dfn" href="https://w3c.github.io/web-animations/level-2/#child-effect" id="ref-for-child-effect">child effectâs</a> <a data-link-type="dfn" href="https://w3c.github.io/web-animations/#local-time" id="ref-for-local-timeâ£">local times</a> to be mutated individually.</p>
   <p>When a <code class="idl"><a data-link-type="idl" href="#workletgroupeffect" id="ref-for-workletgroupeffectâ¡">WorkletGroupEffect</a></code> is set as the <a data-link-type="dfn" href="https://w3c.github.io/web-animations/#animation-effect" id="ref-for-animation-effectâ¤">animation effect</a> of a <code class="idl"><a data-link-type="idl" href="#workletanimation" id="ref-for-workletanimationâ¡">WorkletAnimation</a></code>, the
corresponding <a data-link-type="dfn" href="#animator-instance" id="ref-for-animator-instanceâ¡â¢">animator instance</a> can directly control the <a data-link-type="dfn" href="https://w3c.github.io/web-animations/level-2/#child-effect" id="ref-for-child-effectâ ">child effects</a>' <a data-link-type="dfn" href="https://w3c.github.io/web-animations/#local-time" id="ref-for-local-timeâ¤">local
times</a>. This allows a single worklet animation to coordinate multiple effects - see <a href="#example-2">Â§9.2 Example 2: Twitter header.</a> for an example of such a use-case.</p>
<pre class="idl highlight def"><span class="kt">interface</span> <dfn class="nv dfn-paneled idl-code" data-dfn-type="interface" data-export="" id="workletgroupeffectreadonly"><code>WorkletGroupEffectReadOnly</code></dfn> :  <a class="n" data-link-type="idl-name" href="https://w3c.github.io/web-animations/level-2/#groupeffectreadonly" id="ref-for-groupeffectreadonly">GroupEffectReadOnly</a> {};

<span class="kt">interface</span> <dfn class="nv dfn-paneled idl-code" data-dfn-type="interface" data-export="" id="workletgroupeffect"><code>WorkletGroupEffect</code></dfn> :  <a class="n" data-link-type="idl-name" href="#workletgroupeffectreadonly" id="ref-for-workletgroupeffectreadonly">WorkletGroupEffectReadOnly</a> {};
<a class="n" data-link-type="idl-name" href="#workletgroupeffect" id="ref-for-workletgroupeffectâ¢">WorkletGroupEffect</a> <span class="kt">implements</span> <a class="n" data-link-type="idl-name" href="https://w3c.github.io/web-animations/level-2/#animationeffectmutable" id="ref-for-animationeffectmutable">AnimationEffectMutable</a>;
<a class="n" data-link-type="idl-name" href="#workletgroupeffect" id="ref-for-workletgroupeffectâ£">WorkletGroupEffect</a> <span class="kt">implements</span> <a class="n" data-link-type="idl-name" href="https://w3c.github.io/web-animations/level-2/#groupeffectmutable" id="ref-for-groupeffectmutable">GroupEffectMutable</a>;

[<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed" id="ref-for-Exposedâ ">Exposed</a>=<span class="n">AnimationWorklet</span>]
<span class="kt">partial</span> <span class="kt">interface</span> <a class="nv idl-code" data-link-type="interface" href="https://w3c.github.io/web-animations/level-2/#animationeffectreadonly" id="ref-for-animationeffectreadonlyâ¡">AnimationEffectReadOnly</a> {
    // Intended for use inside Animation Worklet scope to drive the effect.
    <span class="kt">attribute</span> <a class="n idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-double" id="ref-for-idl-double"><span class="kt">double</span></a> <dfn class="nv dfn-paneled idl-code" data-dfn-for="AnimationEffectReadOnly" data-dfn-type="attribute" data-export="" data-type="double" id="dom-animationeffectreadonly-localtime"><code>localTime</code></dfn>;
};
</pre>
   <div class="algorithm" data-algorithm="set-local-time">
    <p>To set the <code class="idl"><a data-link-type="idl" href="#dom-animationeffectreadonly-localtime" id="ref-for-dom-animationeffectreadonly-localtime">localTime</a></code> property on a <var>effect</var> to value <var>t</var>, the user agent should perform the
action that corresponds to the first matching condition from the following:</p>
    <dl>
     <dt data-md="">If the <var>effect</var> does not have a parent group,
     <dd data-md="">
      <p>Set the <var>effect</var> local time to <var>t</var>.</p>
     <dt data-md="">If the <var>effect</var> has a parent group and it is of <code class="idl"><a data-link-type="idl" href="#workletgroupeffect" id="ref-for-workletgroupeffectâ¤">WorkletGroupEffect</a></code> type,
     <dd data-md="">
      <p>Set the effect start time to (parentâs transformed time - t). Note this effectively setâs the <var>effect</var>âs local time to t.</p>
     <dt data-md="">Otherwise
     <dd data-md="">
      <p>Throw an exception indicating that the child effect time can only be controlled by
its parent group.</p>
    </dl>
   </div>
   <p class="issue" id="issue-0ac49f6c"><a class="self-link" href="#issue-0ac49f6c"></a> The above algorithm should probably only apply to within the AnimationWorkletGlobalScope?</p>
   <p>[Issue](https://github.com/w3c/web-animations/issues/191)</p>
   <h3 class="heading settled" data-level="6.8" id="effect-stack-composite-order"><span class="secno">6.8. </span><span class="content">Effect Stack and Composite Order</span><a class="self-link" href="#effect-stack-composite-order"></a></h3>
   <p>As with other animations, <a data-link-type="dfn" href="#worklet-animation" id="ref-for-worklet-animationâ â¢">worklet animations</a> participate in the <a data-link-type="dfn" href="https://w3c.github.io/web-animations/#effect-stack" id="ref-for-effect-stack">effect stack</a>.  A
worklet animation does not have a specific <a data-link-type="dfn" href="https://w3c.github.io/web-animations/#animation-class" id="ref-for-animation-class">animation class</a> which means it has the same
composite order as other Javascript created web animations.</p>
   <h2 class="heading settled" data-level="7" id="security-considerations"><span class="secno">7. </span><span class="content">Security Considerations</span><a class="self-link" href="#security-considerations"></a></h2>
   <p class="issue" id="issue-de770110"><a class="self-link" href="#issue-de770110"></a> Need to decide what security considerations there are for this spec.</p>
   <h2 class="heading settled" data-level="8" id="privacy-considerations"><span class="secno">8. </span><span class="content">Privacy Considerations</span><a class="self-link" href="#privacy-considerations"></a></h2>
   <p class="issue" id="issue-19f9ed9b"><a class="self-link" href="#issue-19f9ed9b"></a> Need to decide what privacy considerations there are for this spec.</p>
   <h2 class="heading settled" data-level="9" id="examples"><span class="secno">9. </span><span class="content">Examples</span><a class="self-link" href="#examples"></a></h2>
   <h3 class="heading settled" data-level="9.1" id="example-1"><span class="secno">9.1. </span><span class="content">Example 1: Hidey Bar.</span><a class="self-link" href="#example-1"></a></h3>
    An example of header effect where a header is moved with scroll and as soon as finger is lifted it
animates fully to close or open position depending on its current position. 
<pre class="lang-markup highlight"><span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">'scrollingContainer'</span><span class="p">></span>
  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">'header'</span><span class="p">></span>Some header<span class="p">&lt;/</span><span class="nt">div</span><span class="p">></span>
  <span class="p">&lt;</span><span class="nt">div</span><span class="p">></span>content<span class="p">&lt;/</span><span class="nt">div</span><span class="p">></span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">></span>

<span class="p">&lt;</span><span class="nt">script</span><span class="p">></span>
await animationWorklet<span class="p">.</span>addModule<span class="p">(</span><span class="s1">'hidey-bar-animator.js'</span><span class="p">);</span>
<span class="kr">const</span> scrollTimeline <span class="o">=</span> <span class="k">new</span> ScrollTimeline<span class="p">(</span>$scrollingContainer<span class="p">,</span> <span class="p">{</span>timeRange<span class="o">:</span> <span class="mi">1000</span><span class="p">});</span>
<span class="kr">const</span> documentTimeline <span class="o">=</span> document<span class="p">.</span>timeline<span class="p">;</span>

<span class="c1">// Note we pass in two timelines in the options bag which allows the animation to read their</span>
<span class="c1">// currenTime values directly.</span>
<span class="c1"></span><span class="kr">const</span> animation <span class="o">=</span> <span class="k">new</span> WorkletAnimation<span class="p">(</span>
    <span class="s1">'hidey-bar'</span><span class="p">,</span>
    <span class="k">new</span> KeyFrameEffect<span class="p">(</span>$header<span class="p">,</span>
                        <span class="p">[{</span>transform<span class="o">:</span> <span class="s1">'translateX(100px)'</span><span class="p">},</span> <span class="p">{</span>transform<span class="o">:</span> <span class="s1">'translateX(0px)'</span><span class="p">}],</span>
                        <span class="p">{</span>duration<span class="o">:</span> <span class="mi">1000</span><span class="p">,</span> iterations<span class="o">:</span> <span class="mi">1</span><span class="p">,</span> fill<span class="o">:</span> <span class="s1">'both'</span> <span class="p">}]),</span>
    scrollTimeline<span class="p">,</span>
    <span class="p">{</span>scrollTimeline<span class="p">,</span> documentTimeline<span class="p">});</span>

animation<span class="p">.</span>play<span class="p">();</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">></span>
</pre>
<pre class="lang-javascript highlight"><span class="c1">// Inside AnimationWorkletGlobalScope</span>
<span class="c1"></span>
registerAnimator<span class="p">(</span><span class="s1">'hidey-bar'</span><span class="p">,</span> <span class="kr">class</span> <span class="p">{</span>
  constructor<span class="p">(</span>options<span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span>scrollTimeline_ <span class="o">=</span> options<span class="p">.</span>scrollTimeline<span class="p">;</span>
    <span class="k">this</span><span class="p">.</span>documentTimeline_ <span class="o">=</span> options<span class="p">.</span>documentTimeline<span class="p">;</span>
  <span class="p">}</span>

  animate<span class="p">(</span>currentTime<span class="p">,</span> effect<span class="p">)</span> <span class="p">{</span>
    <span class="kr">const</span> scroll <span class="o">=</span> <span class="k">this</span><span class="p">.</span>scrollTimeline_<span class="p">.</span>currentTime<span class="p">;</span>  <span class="c1">// [0, 100]</span>
<span class="c1"></span>    <span class="kr">const</span> time <span class="o">=</span> <span class="k">this</span><span class="p">.</span>documentTimeline_<span class="p">.</span>currentTime<span class="p">;</span>

    <span class="kr">const</span> activelyScrolling <span class="o">=</span> <span class="k">this</span><span class="p">.</span>scrollTimeline_<span class="p">.</span>phase <span class="o">==</span> <span class="s1">'active'</span><span class="p">;</span>

    <span class="kd">let</span> localTime<span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span>activelyScrolling<span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span>startTime_ <span class="o">=</span> <span class="kc">undefined</span><span class="p">;</span>
      localTime <span class="o">=</span> scroll<span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span>startTime_ <span class="o">=</span> <span class="k">this</span><span class="p">.</span>startTime_ <span class="o">||</span> time<span class="p">;</span>
      <span class="c1">// Decide on close/open direction depending on how far we have scrolled the header</span>
<span class="c1"></span>      <span class="c1">// This can even do more sophisticated animation curve by computing the scroll velocity and</span>
<span class="c1"></span>      <span class="c1">// using it.</span>
<span class="c1"></span>      <span class="k">this</span><span class="p">.</span>direction_ <span class="o">=</span> scroll <span class="o">>=</span> <span class="mi">50</span> <span class="o">?</span> <span class="o">+</span><span class="mi">1</span> <span class="o">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
      localTime <span class="o">=</span> <span class="k">this</span><span class="p">.</span>direction_ <span class="o">*</span> <span class="p">(</span>time <span class="o">-</span> <span class="k">this</span><span class="p">.</span>startTime_<span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// Drive the output effect by setting its local time.</span>
<span class="c1"></span>    effect<span class="p">.</span>localTime <span class="o">=</span> localTime<span class="p">;</span>
  <span class="p">}</span>
<span class="p">});</span>
</pre>
   <p class="issue" id="issue-8b45d7e3"><a class="self-link" href="#issue-8b45d7e3"></a> This example uses a hypothetical "phase" property on timeline as a way to detect when user
is no longer actively scrolling. This is a reasonable thing to have on scroll timeline. A simple
fallback can emulate this by detecting when timeline time (i.e. scroll offset) has not changed in
the last few frames.</p>
   <h3 class="heading settled" data-level="9.2" id="example-2"><span class="secno">9.2. </span><span class="content">Example 2: Twitter header.</span><a class="self-link" href="#example-2"></a></h3>
    An example of twitter profile header effect where two elements (avatar, and header) are updated in
sync with scroll offset. 
<pre class="lang-markup highlight">// In document scope.
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">'scrollingContainer'</span><span class="p">></span>
  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">'header'</span> <span class="na">style</span><span class="o">=</span><span class="s">'height: 150px'</span><span class="p">>&lt;/</span><span class="nt">div</span><span class="p">></span>
  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">'avatar'</span><span class="p">>&lt;</span><span class="nt">img</span><span class="p">>&lt;/</span><span class="nt">div</span><span class="p">></span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">></span>

<span class="p">&lt;</span><span class="nt">script</span><span class="p">></span>
await animationWorklet<span class="p">.</span>addModule<span class="p">(</span><span class="s1">'twitter-header-animator.js'</span><span class="p">);</span>
<span class="kr">const</span> animation <span class="o">=</span> <span class="k">new</span> WorkletAnimation<span class="p">(</span>
    <span class="s1">'twitter-header'</span><span class="p">,</span>
    <span class="p">[</span><span class="k">new</span> KeyFrameEffect<span class="p">(</span>$avatar<span class="p">,</span>  <span class="cm">/* scales down as we scroll up */</span>
                    <span class="p">[{</span>transform<span class="o">:</span> <span class="s1">'scale(1)'</span><span class="p">},</span> <span class="p">{</span>transform<span class="o">:</span> <span class="s1">'scale(0.5)'</span><span class="p">}],</span>
                    <span class="p">{</span>duration<span class="o">:</span> <span class="mi">1000</span><span class="p">,</span> iterations<span class="o">:</span> <span class="mi">1</span><span class="p">}),</span>
    <span class="k">new</span> KeyFrameEffect<span class="p">(</span>$header<span class="p">,</span> <span class="cm">/* loses transparency as we scroll up */</span>
                    <span class="p">[{</span>opacity<span class="o">:</span> <span class="mi">0</span><span class="p">},</span> <span class="p">{</span>opacity<span class="o">:</span> <span class="mf">0.8</span><span class="p">}],</span>
                    <span class="p">{</span>duration<span class="o">:</span> <span class="mi">1000</span><span class="p">,</span> iterations<span class="o">:</span> <span class="mi">1</span><span class="p">})],</span>
    <span class="k">new</span> ScrollTimeline<span class="p">(</span>$scrollingContainer<span class="p">,</span> <span class="p">{</span>timeRange<span class="o">:</span> <span class="mi">1000</span><span class="p">,</span> startScrollOffset<span class="o">:</span> <span class="mi">0</span><span class="p">,</span> endScrollOffset<span class="o">:</span> $header<span class="p">.</span>clientHeight<span class="p">}));</span>
animation<span class="p">.</span>play<span class="p">();</span>

<span class="c1">// Since this animation is using a group effect, the same animation instance </span>
<span class="c1">// is accessible via different handles: $avatarEl.getAnimations()[0], $headerEl.getAnimations()[0]</span>
<span class="c1"></span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">></span>
</pre>
<pre class="lang-javascript highlight"><span class="c1">// Inside AnimationWorkletGlobalScope.</span>
<span class="c1"></span>registerAnimator<span class="p">(</span><span class="s1">'twitter-header'</span><span class="p">,</span> <span class="kr">class</span> <span class="p">{</span>
  constructor<span class="p">(</span>options<span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span>timing_ <span class="o">=</span> <span class="k">new</span> CubicBezier<span class="p">(</span><span class="s1">'ease-out'</span><span class="p">);</span>
  <span class="p">}</span>

  clamp<span class="p">(</span>value<span class="p">,</span> min<span class="p">,</span> max<span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> Math<span class="p">.</span>min<span class="p">(</span>Math<span class="p">.</span>max<span class="p">(</span>value<span class="p">,</span> min<span class="p">),</span> max<span class="p">);</span>
  <span class="p">}</span>

  animate<span class="p">(</span>currentTime<span class="p">,</span> effect<span class="p">)</span> <span class="p">{</span>
    <span class="kr">const</span> scroll <span class="o">=</span> currentTime<span class="p">;</span>  <span class="c1">// scroll is in [0, 1000] range</span>
<span class="c1"></span>
    <span class="c1">// Drive the output group effect by setting its children local times individually.</span>
<span class="c1"></span>    effect<span class="p">.</span>children<span class="p">[</span><span class="mi">0</span><span class="p">].</span>localTime <span class="o">=</span> scroll<span class="p">;</span>
    effect<span class="p">.</span>children<span class="p">[</span><span class="mi">1</span><span class="p">].</span>localTime <span class="o">=</span> <span class="k">this</span><span class="p">.</span>timing_<span class="p">(</span>clamp<span class="p">(</span>scroll<span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">500</span><span class="p">));</span>
  <span class="p">}</span>
<span class="p">});</span>
</pre>
   <h3 class="heading settled" data-level="9.3" id="example-3"><span class="secno">9.3. </span><span class="content">Example 3: Parallax backgrounds.</span><a class="self-link" href="#example-3"></a></h3>
    A simple parallax background example. 
<pre class="lang-markup highlight"><span class="p">&lt;</span><span class="nt">style</span><span class="p">></span>
<span class="p">.</span><span class="nc">parallax</span> <span class="p">{</span>
    <span class="k">position</span><span class="p">:</span> <span class="kc">fixed</span><span class="p">;</span>
    <span class="k">top</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">left</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">opacity</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">;</span>
<span class="p">}</span>
<span class="p">&lt;/</span><span class="nt">style</span><span class="p">></span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">'scrollingContainer'</span><span class="p">></span>
  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">"slow"</span> <span class="na">class</span><span class="o">=</span><span class="s">"parallax"</span><span class="p">>&lt;/</span><span class="nt">div</span><span class="p">></span>
  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">"fast"</span> <span class="na">class</span><span class="o">=</span><span class="s">"parallax"</span><span class="p">>&lt;/</span><span class="nt">div</span><span class="p">></span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">></span>

<span class="p">&lt;</span><span class="nt">script</span><span class="p">></span>
await animationWorklet<span class="p">.</span>addModule<span class="p">(</span><span class="s1">'parallax-animator.js'</span><span class="p">);</span>
<span class="kr">const</span> scrollTimeline <span class="o">=</span> <span class="k">new</span> ScrollTimeline<span class="p">(</span>$scrollingContainer<span class="p">,</span> <span class="p">{</span>timeRange<span class="o">:</span> <span class="mi">1000</span><span class="p">});</span>
<span class="kr">const</span> scrollRange <span class="o">=</span> $scrollingContainer<span class="p">.</span>scrollHeight <span class="o">-</span> $scrollingContainer<span class="p">.</span>clientHeight<span class="p">;</span>

<span class="kr">const</span> slowParallax <span class="o">=</span> <span class="k">new</span> WorkletAnimation<span class="p">(</span>
    <span class="s1">'parallax'</span><span class="p">,</span>
    <span class="k">new</span> KeyframeEffect<span class="p">(</span>$parallax_slow<span class="p">,</span> <span class="p">[{</span><span class="s1">'transform'</span><span class="o">:</span> <span class="s1">'translateY(0)'</span><span class="p">},</span> <span class="p">{</span><span class="s1">'transform'</span><span class="o">:</span> <span class="s1">'translateY('</span> <span class="o">+</span> <span class="o">-</span>scrollRange <span class="o">+</span> <span class="s1">'px)'</span><span class="p">}],</span> <span class="p">{</span>duration<span class="o">:</span> <span class="mi">1000</span><span class="p">}),</span>
    scrollTimeline<span class="p">,</span>
    <span class="p">{</span>rate <span class="o">:</span> <span class="mf">0.4</span><span class="p">}</span>
<span class="p">);</span>
slowParallax<span class="p">.</span>play<span class="p">();</span>

<span class="kr">const</span> fastParallax <span class="o">=</span> <span class="k">new</span> WorkletAnimation<span class="p">(</span>
    <span class="s1">'parallax'</span><span class="p">,</span>
    <span class="k">new</span> KeyframeEffect<span class="p">(</span>$parallax_fast<span class="p">,</span> <span class="p">[{</span><span class="s1">'transform'</span><span class="o">:</span> <span class="s1">'translateY(0)'</span><span class="p">},</span> <span class="p">{</span><span class="s1">'transform'</span><span class="o">:</span> <span class="s1">'translateY('</span> <span class="o">+</span> <span class="o">-</span>scrollRange <span class="o">+</span> <span class="s1">'px)'</span><span class="p">}],</span> <span class="p">{</span>duration<span class="o">:</span> <span class="mi">1000</span><span class="p">}),</span>
    scrollTimeline<span class="p">,</span>
    <span class="p">{</span>rate <span class="o">:</span> <span class="mf">0.8</span><span class="p">}</span>
<span class="p">);</span>
fastParallax<span class="p">.</span>play<span class="p">();</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">></span>
</pre>
<pre class="lang-javascript highlight"><span class="c1">// Inside AnimationWorkletGlobalScope.</span>
<span class="c1"></span>registerAnimator<span class="p">(</span><span class="s1">'parallax'</span><span class="p">,</span> <span class="kr">class</span> <span class="p">{</span>
  constructor<span class="p">(</span>options<span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span>rate_ <span class="o">=</span> options<span class="p">.</span>rate<span class="p">;</span>
  <span class="p">}</span>

  animate<span class="p">(</span>currentTime<span class="p">,</span> effect<span class="p">)</span> <span class="p">{</span>
    effect<span class="p">.</span>localTime <span class="o">=</span> currentTime <span class="o">*</span> <span class="k">this</span><span class="p">.</span>rate_<span class="p">;</span>
  <span class="p">}</span>
<span class="p">});</span>
</pre>
  </main>
  <div data-fill-with="conformance">
   <h2 class="no-ref no-num heading settled" id="conformance"><span class="content"> Conformance</span><a class="self-link" href="#conformance"></a></h2>
   <p> Conformance requirements are expressed with a combination of descriptive assertions and RFC 2119 terminology.
            The key words âMUSTâ, âMUST NOTâ, âREQUIREDâ, âSHALLâ, âSHALL NOTâ, âSHOULDâ, âSHOULD NOTâ, âRECOMMENDEDâ, âMAYâ, and âOPTIONALâ
            in the normative parts of this document
            are to be interpreted as described in RFC 2119.
            However, for readability,
            these words do not appear in all uppercase letters in this specification. </p>
   <p> All of the text of this specification is normative
            except sections explicitly marked as non-normative, examples, and notes. <a data-link-type="biblio" href="#biblio-rfc2119">[RFC2119]</a> </p>
   <p> Examples in this specification are introduced with the words âfor exampleâ
            or are set apart from the normative text with <code>class="example"</code>, like this: </p>
   <div class="example" id="example-example"><a class="self-link" href="#example-example"></a> This is an example of an informative example. </div>
   <p> Informative notes begin with the word âNoteâ
            and are set apart from the normative text with <code>class="note"</code>, like this: </p>
   <p class="note" role="note"> Note, this is an informative note. </p>
  </div>
<script>
(function() {
  "use strict";
  var collapseSidebarText = '<span aria-hidden="true">â</span> '
                          + '<span>Collapse Sidebar</span>';
  var expandSidebarText   = '<span aria-hidden="true">â</span> '
                          + '<span>Pop Out Sidebar</span>';
  var tocJumpText         = '<span aria-hidden="true">â</span> '
                          + '<span>Jump to Table of Contents</span>';

  var sidebarMedia = window.matchMedia('screen and (min-width: 78em)');
  var autoToggle   = function(e){ toggleSidebar(e.matches) };
  if(sidebarMedia.addListener) {
    sidebarMedia.addListener(autoToggle);
  }

  function toggleSidebar(on) {
    if (on == undefined) {
      on = !document.body.classList.contains('toc-sidebar');
    }

    /* Donât scroll to compensate for the ToC if weâre above it already. */
    var headY = 0;
    var head = document.querySelector('.head');
    if (head) {
      // terrible approx of "top of ToC"
      headY += head.offsetTop + head.offsetHeight;
    }
    var skipScroll = window.scrollY < headY;

    var toggle = document.getElementById('toc-toggle');
    var tocNav = document.getElementById('toc');
    if (on) {
      var tocHeight = tocNav.offsetHeight;
      document.body.classList.add('toc-sidebar');
      document.body.classList.remove('toc-inline');
      toggle.innerHTML = collapseSidebarText;
      if (!skipScroll) {
        window.scrollBy(0, 0 - tocHeight);
      }
      tocNav.focus();
      sidebarMedia.addListener(autoToggle); // auto-collapse when out of room
    }
    else {
      document.body.classList.add('toc-inline');
      document.body.classList.remove('toc-sidebar');
      toggle.innerHTML = expandSidebarText;
      if (!skipScroll) {
        window.scrollBy(0, tocNav.offsetHeight);
      }
      if (toggle.matches(':hover')) {
        /* Unfocus button when not using keyboard navigation,
           because I donât know where else to send the focus. */
        toggle.blur();
      }
    }
  }

  function createSidebarToggle() {
    /* Create the sidebar toggle in JS; it shouldnât exist when JS is off. */
    var toggle = document.createElement('a');
      /* This should probably be a button, but appearance isnât standards-track.*/
    toggle.id = 'toc-toggle';
    toggle.class = 'toc-toggle';
    toggle.href = '#toc';
    toggle.innerHTML = collapseSidebarText;

    sidebarMedia.addListener(autoToggle);
    var toggler = function(e) {
      e.preventDefault();
      sidebarMedia.removeListener(autoToggle); // persist explicit off states
      toggleSidebar();
      return false;
    }
    toggle.addEventListener('click', toggler, false);


    /* Get <nav id=toc-nav>, or make it if we donât have one. */
    var tocNav = document.getElementById('toc-nav');
    if (!tocNav) {
      tocNav = document.createElement('p');
      tocNav.id = 'toc-nav';
      /* Prepend for better keyboard navigation */
      document.body.insertBefore(tocNav, document.body.firstChild);
    }
    /* While weâre at it, make sure we have a Jump to Toc link. */
    var tocJump = document.getElementById('toc-jump');
    if (!tocJump) {
      tocJump = document.createElement('a');
      tocJump.id = 'toc-jump';
      tocJump.href = '#toc';
      tocJump.innerHTML = tocJumpText;
      tocNav.appendChild(tocJump);
    }

    tocNav.appendChild(toggle);
  }

  var toc = document.getElementById('toc');
  if (toc) {
    createSidebarToggle();
    toggleSidebar(sidebarMedia.matches);

    /* If the sidebar has been manually opened and is currently overlaying the text
       (window too small for the MQ to add the margin to body),
       then auto-close the sidebar once you click on something in there. */
    toc.addEventListener('click', function(e) {
      if(e.target.tagName.toLowerCase() == "a" && document.body.classList.contains('toc-sidebar') && !sidebarMedia.matches) {
        toggleSidebar(false);
      }
    }, false);
  }
  else {
    console.warn("Canât find Table of Contents. Please use <nav id='toc'> around the ToC.");
  }

  /* Wrap tables in case they overflow */
  var tables = document.querySelectorAll(':not(.overlarge) > table.data, :not(.overlarge) > table.index');
  var numTables = tables.length;
  for (var i = 0; i < numTables; i++) {
    var table = tables[i];
    var wrapper = document.createElement('div');
    wrapper.className = 'overlarge';
    table.parentNode.insertBefore(wrapper, table);
    wrapper.appendChild(table);
  }

})();
</script>
  <h2 class="no-num no-ref heading settled" id="index"><span class="content">Index</span><a class="self-link" href="#index"></a></h2>
  <h3 class="no-num no-ref heading settled" id="index-defined-here"><span class="content">Terms defined by this specification</span><a class="self-link" href="#index-defined-here"></a></h3>
  <ul class="index">
   <li><a href="#animate-function">animate function</a><span>, in Â§4</span>
   <li><a href="#animation-animator-name">animation animator name</a><span>, in Â§6.1</span>
   <li><a href="#animation-requested-flag">animation requested flag</a><span>, in Â§5.5</span>
   <li><a href="#animation-worklet">Animation Worklet</a><span>, in Â§3</span>
   <li><a href="#dom-window-animationworklet">animationWorklet</a><span>, in Â§3</span>
   <li><a href="#animationworkletglobalscope">AnimationWorkletGlobalScope</a><span>, in Â§3</span>
   <li><a href="#animator-attached-timelines">animator attached timelines</a><span>, in Â§5</span>
   <li><a href="#animator-current-time">animator current time</a><span>, in Â§5</span>
   <li><a href="#animator-definition">animator definition</a><span>, in Â§4</span>
   <li><a href="#animator-effect">animator effect</a><span>, in Â§5</span>
   <li><a href="#animator-instance">animator instance</a><span>, in Â§5</span>
   <li><a href="#animator-instance-set">animator instance set</a><span>, in Â§5.1</span>
   <li><a href="#animator-name">animator name</a><span>, in Â§4</span>
   <li><a href="#dom-workletanimation-animatorname">animatorName</a><span>, in Â§6.2</span>
   <li><a href="#animator-name-to-animator-definition-map">animator name to animator definition map</a><span>, in Â§4.1</span>
   <li><a href="#animator-serialized-options">animator serialized options</a><span>, in Â§5</span>
   <li><a href="#animator-timeline">animator timeline</a><span>, in Â§5</span>
   <li><a href="#associate-animator-instance-of-worklet-animation">associate animator instance of worklet animation</a><span>, in Â§6.4</span>
   <li><a href="#class-constructor">class constructor</a><span>, in Â§4</span>
   <li><a href="#create-a-new-animator-instance">create a new animator instance</a><span>, in Â§5.1</span>
   <li><a href="#disassociate-animator-instance-of-worklet-animation">disassociate animator instance of worklet animation</a><span>, in Â§6.4</span>
   <li><a href="#frame-current">frame-current</a><span>, in Â§5.5</span>
   <li><a href="#frame-requested">frame-requested</a><span>, in Â§5.5</span>
   <li><a href="#global-execution-context">global execution context</a><span>, in Â§3</span>
   <li><a href="#dom-animationeffectreadonly-localtime">localTime</a><span>, in Â§6.7</span>
   <li><a href="#migrate-an-animator-instance">migrate an animator instance</a><span>, in Â§5.4</span>
   <li><a href="#dom-animationworkletglobalscope-registeranimator">registerAnimator(name, animatorCtor)</a><span>, in Â§4.1</span>
   <li><a href="#remove-an-animator-instance">remove an animator instance</a><span>, in Â§5.3</span>
   <li><a href="#run-animators">run animators</a><span>, in Â§5.2</span>
   <li><a href="#serialized-options">serialized options</a><span>, in Â§6.1</span>
   <li><a href="#set-animator-instance-of-worklet-animation">set animator instance of worklet animation</a><span>, in Â§6.4</span>
   <li><a href="#callbackdef-voidfunction">VoidFunction</a><span>, in Â§3</span>
   <li><a href="#worklet-animation">Worklet animation</a><span>, in Â§6.1</span>
   <li><a href="#workletanimation">WorkletAnimation</a><span>, in Â§6.2</span>
   <li><a href="#dom-workletanimation-workletanimation">WorkletAnimation(animatorName, effects, timeline, options)</a><span>, in Â§6.2</span>
   <li><a href="#workletgroupeffect">WorkletGroupEffect</a><span>, in Â§6.7</span>
   <li><a href="#workletgroupeffectreadonly">WorkletGroupEffectReadOnly</a><span>, in Â§6.7</span>
  </ul>
  <h3 class="no-num no-ref heading settled" id="index-defined-elsewhere"><span class="content">Terms defined by reference</span><a class="self-link" href="#index-defined-elsewhere"></a></h3>
  <ul class="index">
   <li>
    <a data-link-type="biblio">[css-transitions-1]</a> defines the following terms:
    <ul>
     <li><a href="https://drafts.csswg.org/css-transitions-1/#transition-start-time">start time</a>
    </ul>
   <li>
    <a data-link-type="biblio">[css-values-4]</a> defines the following terms:
    <ul>
     <li><a href="https://drafts.csswg.org/css-values-4/#typedef-ident">&lt;ident></a>
    </ul>
   <li>
    <a data-link-type="biblio">[DOM]</a> defines the following terms:
    <ul>
     <li><a href="https://dom.spec.whatwg.org/#document">Document</a>
    </ul>
   <li>
    <a data-link-type="biblio">[HTML]</a> defines the following terms:
    <ul>
     <li><a href="https://html.spec.whatwg.org/multipage/window-object.html#window">Window</a>
     <li><a href="https://html.spec.whatwg.org/multipage/webappapis.html#current-global-object">current global object</a>
     <li><a href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task">queue a task</a>
    </ul>
   <li>
    <a data-link-type="biblio">[INFRA]</a> defines the following terms:
    <ul>
     <li><a href="https://infra.spec.whatwg.org/#list">list</a>
     <li><a href="https://infra.spec.whatwg.org/#struct">struct</a>
    </ul>
   <li>
    <a data-link-type="biblio">[web-animations-1]</a> defines the following terms:
    <ul>
     <li><a href="https://drafts.csswg.org/web-animations-1/#dom-animation-finish">finish()</a>
     <li><a href="https://drafts.csswg.org/web-animations-1/#dom-animationeffectreadonly-getcomputedtiming">getComputedTiming()</a>
    </ul>
   <li>
    <a data-link-type="biblio">[WebIDL]</a> defines the following terms:
    <ul>
     <li><a href="https://heycam.github.io/webidl/#idl-DOMString">DOMString</a>
     <li><a href="https://heycam.github.io/webidl/#Exposed">Exposed</a>
     <li><a href="https://heycam.github.io/webidl/#Global">Global</a>
     <li><a href="https://heycam.github.io/webidl/#SameObject">SameObject</a>
     <li><a href="https://heycam.github.io/webidl/#idl-double">double</a>
    </ul>
   <li>
    <a data-link-type="biblio">[worklets-1]</a> defines the following terms:
    <ul>
     <li><a href="https://drafts.css-houdini.org/worklets/#worklet">Worklet</a>
     <li><a href="https://drafts.css-houdini.org/worklets/#workletglobalscope">WorkletGlobalScope</a>
     <li><a href="https://drafts.css-houdini.org/worklets/#worklet-global-scope-type">worklet global scope type</a>
    </ul>
  </ul>
  <h2 class="no-num no-ref heading settled" id="references"><span class="content">References</span><a class="self-link" href="#references"></a></h2>
  <h3 class="no-num no-ref heading settled" id="normative"><span class="content">Normative References</span><a class="self-link" href="#normative"></a></h3>
  <dl>
   <dt id="biblio-css-transitions-1">[CSS-TRANSITIONS-1]
   <dd>David Baron; Dean Jackson; Brian Birtles. <a href="https://www.w3.org/TR/css-transitions-1/">CSS Transitions</a>. 30 November 2017. WD. URL: <a href="https://www.w3.org/TR/css-transitions-1/">https://www.w3.org/TR/css-transitions-1/</a>
   <dt id="biblio-css-values-4">[CSS-VALUES-4]
   <dd>CSS Values and Units Module Level 4 URL: <a href="https://drafts.csswg.org/css-values-4/">https://drafts.csswg.org/css-values-4/</a>
   <dt id="biblio-dom">[DOM]
   <dd>Anne van Kesteren. <a href="https://dom.spec.whatwg.org/">DOM Standard</a>. Living Standard. URL: <a href="https://dom.spec.whatwg.org/">https://dom.spec.whatwg.org/</a>
   <dt id="biblio-html">[HTML]
   <dd>Anne van Kesteren; et al. <a href="https://html.spec.whatwg.org/multipage/">HTML Standard</a>. Living Standard. URL: <a href="https://html.spec.whatwg.org/multipage/">https://html.spec.whatwg.org/multipage/</a>
   <dt id="biblio-infra">[INFRA]
   <dd>Anne van Kesteren; Domenic Denicola. <a href="https://infra.spec.whatwg.org/">Infra Standard</a>. Living Standard. URL: <a href="https://infra.spec.whatwg.org/">https://infra.spec.whatwg.org/</a>
   <dt id="biblio-rfc2119">[RFC2119]
   <dd>S. Bradner. <a href="https://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>. March 1997. Best Current Practice. URL: <a href="https://tools.ietf.org/html/rfc2119">https://tools.ietf.org/html/rfc2119</a>
   <dt id="biblio-web-animations-1">[WEB-ANIMATIONS-1]
   <dd>Brian Birtles; et al. <a href="https://www.w3.org/TR/web-animations-1/">Web Animations</a>. 13 September 2016. WD. URL: <a href="https://www.w3.org/TR/web-animations-1/">https://www.w3.org/TR/web-animations-1/</a>
   <dt id="biblio-webidl">[WebIDL]
   <dd>Cameron McCormack; Boris Zbarsky; Tobie Langel. <a href="https://heycam.github.io/webidl/">Web IDL</a>. 15 December 2016. ED. URL: <a href="https://heycam.github.io/webidl/">https://heycam.github.io/webidl/</a>
   <dt id="biblio-worklets-1">[WORKLETS-1]
   <dd>Ian Kilpatrick. <a href="https://www.w3.org/TR/worklets-1/">Worklets Level 1</a>. 7 June 2016. WD. URL: <a href="https://www.w3.org/TR/worklets-1/">https://www.w3.org/TR/worklets-1/</a>
  </dl>
  <h3 class="no-num no-ref heading settled" id="informative"><span class="content">Informative References</span><a class="self-link" href="#informative"></a></h3>
  <dl>
   <dt id="biblio-explainer">[EXPLAINER]
   <dd><a href="https://github.com/WICG/animation-worklet/blob/gh-pages/README.md">Animation Worklet Explainer</a>. CR. URL: <a href="https://github.com/WICG/animation-worklet/blob/gh-pages/README.md">https://github.com/WICG/animation-worklet/blob/gh-pages/README.md</a>
  </dl>
  <h2 class="no-num no-ref heading settled" id="idl-index"><span class="content">IDL Index</span><a class="self-link" href="#idl-index"></a></h2>
<pre class="idl highlight def"><span class="kt">partial</span> <span class="kt">interface</span> <a class="nv idl-code" data-link-type="interface" href="https://html.spec.whatwg.org/multipage/window-object.html#window" id="ref-for-windowâ¡">Window</a> {
    [<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#SameObject" id="ref-for-SameObjectâ ">SameObject</a>] <span class="kt">readonly</span> <span class="kt">attribute</span> <a class="n" data-link-type="idl-name" href="https://drafts.css-houdini.org/worklets/#worklet" id="ref-for-workletâ â ">Worklet</a> <a class="nv" data-readonly="" data-type="Worklet" href="#dom-window-animationworklet"><code>animationWorklet</code></a>;
};

<span class="kt">callback</span> <a class="nv" href="#callbackdef-voidfunction"><code>VoidFunction</code></a> = <span class="kt">void</span> ();

[ <a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed" id="ref-for-Exposedâ¡">Exposed</a>=<span class="n">AnimationWorklet</span>, <a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Global" id="ref-for-Globalâ ">Global</a>=<a class="n" data-link-type="idl-name">AnimationWorklet</a> ]
<span class="kt">interface</span> <a class="nv" href="#animationworkletglobalscope"><code>AnimationWorkletGlobalScope</code></a> : <a class="n" data-link-type="idl-name" href="https://drafts.css-houdini.org/worklets/#workletglobalscope" id="ref-for-workletglobalscopeâ¤">WorkletGlobalScope</a> {
    <span class="kt">void</span> <a class="nv idl-code" data-link-type="method" href="#dom-animationworkletglobalscope-registeranimator" id="ref-for-dom-animationworkletglobalscope-registeranimatorâ¡">registerAnimator</a>(<a class="n idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString" id="ref-for-idl-DOMStringâ¡"><span class="kt">DOMString</span></a> <a class="nv" href="#dom-animationworkletglobalscope-registeranimator-name-animatorctor-name"><code>name</code></a>, <a class="n" data-link-type="idl-name" href="#callbackdef-voidfunction" id="ref-for-callbackdef-voidfunctionâ ">VoidFunction</a> <a class="nv" href="#dom-animationworkletglobalscope-registeranimator-name-animatorctor-animatorctor"><code>animatorCtor</code></a>);
};

[Constructor (DOMString animatorName,
              optional (AnimationEffectReadOnly or sequence)? effects = null,
              optional AnimationTimeline? timeline,
              optional any options)]
<span class="kt">interface</span> <a class="nv" href="#workletanimation"><code>WorkletAnimation</code></a> : <a class="n" data-link-type="idl-name" href="https://w3c.github.io/web-animations/level-2/#animation" id="ref-for-animationâ¡â ">Animation</a> {
        <span class="kt">readonly</span> <span class="kt">attribute</span> <a class="n idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString" id="ref-for-idl-DOMStringâ â "><span class="kt">DOMString</span></a> <a class="nv" data-readonly="" data-type="DOMString" href="#dom-workletanimation-animatorname"><code>animatorName</code></a>;
};


<span class="kt">interface</span> <a class="nv" href="#workletgroupeffectreadonly"><code>WorkletGroupEffectReadOnly</code></a> :  <a class="n" data-link-type="idl-name" href="https://w3c.github.io/web-animations/level-2/#groupeffectreadonly" id="ref-for-groupeffectreadonlyâ ">GroupEffectReadOnly</a> {};

<span class="kt">interface</span> <a class="nv" href="#workletgroupeffect"><code>WorkletGroupEffect</code></a> :  <a class="n" data-link-type="idl-name" href="#workletgroupeffectreadonly" id="ref-for-workletgroupeffectreadonlyâ ">WorkletGroupEffectReadOnly</a> {};
<a class="n" data-link-type="idl-name" href="#workletgroupeffect" id="ref-for-workletgroupeffectâ¢â ">WorkletGroupEffect</a> <span class="kt">implements</span> <a class="n" data-link-type="idl-name" href="https://w3c.github.io/web-animations/level-2/#animationeffectmutable" id="ref-for-animationeffectmutableâ ">AnimationEffectMutable</a>;
<a class="n" data-link-type="idl-name" href="#workletgroupeffect" id="ref-for-workletgroupeffectâ£â ">WorkletGroupEffect</a> <span class="kt">implements</span> <a class="n" data-link-type="idl-name" href="https://w3c.github.io/web-animations/level-2/#groupeffectmutable" id="ref-for-groupeffectmutableâ ">GroupEffectMutable</a>;

[<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed" id="ref-for-Exposedâ â ">Exposed</a>=<span class="n">AnimationWorklet</span>]
<span class="kt">partial</span> <span class="kt">interface</span> <a class="nv idl-code" data-link-type="interface" href="https://w3c.github.io/web-animations/level-2/#animationeffectreadonly" id="ref-for-animationeffectreadonlyâ¡â ">AnimationEffectReadOnly</a> {
    // Intended for use inside Animation Worklet scope to drive the effect.
    <span class="kt">attribute</span> <a class="n idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-double" id="ref-for-idl-doubleâ "><span class="kt">double</span></a> <a class="nv" data-type="double" href="#dom-animationeffectreadonly-localtime"><code>localTime</code></a>;
};

</pre>
  <h2 class="no-num no-ref heading settled" id="issues-index"><span class="content">Issues Index</span><a class="self-link" href="#issues-index"></a></h2>
  <div style="counter-reset:issue">
   <div class="issue"> Consider giving user agents permission to skip running animator instances to
   throttle slow animators.<a href="#issue-6d334361"> âµ </a></div>
   <div class="issue"> Come with appropriate mechanismâs for <a data-link-type="dfn" href="#animator-instance">animator instance</a> to get notified when its
   animation currentTime is changing e.g., via reverse(), finish() or playbackRate change. So that
   it can react appropriately. <a href="https://github.com/wicg/animation-worklet/issues/63">&lt;https://github.com/wicg/animation-worklet/issues/63></a><a href="#issue-7d7a2dd9"> âµ </a></div>
   <div class="issue"> Define semantics of attachment and detachment. <a href="https://github.com/wicg/animation-worklet/issues/61">&lt;https://github.com/wicg/animation-worklet/issues/61></a><a href="#issue-1b7aae40"> âµ </a></div>
   <div class="issue"> The above algorithm should probably only apply to within the AnimationWorkletGlobalScope?<a href="#issue-0ac49f6c"> âµ </a></div>
   <div class="issue"> Need to decide what security considerations there are for this spec.<a href="#issue-de770110"> âµ </a></div>
   <div class="issue"> Need to decide what privacy considerations there are for this spec.<a href="#issue-19f9ed9b"> âµ </a></div>
   <div class="issue"> This example uses a hypothetical "phase" property on timeline as a way to detect when user
is no longer actively scrolling. This is a reasonable thing to have on scroll timeline. A simple
fallback can emulate this by detecting when timeline time (i.e. scroll offset) has not changed in
the last few frames.<a href="#issue-8b45d7e3"> âµ </a></div>
  </div>
  <aside class="dfn-panel" data-for="animation-worklet">
   <b><a href="#animation-worklet">#animation-worklet</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-animation-worklet">1. Introduction</a>
    <li><a href="#ref-for-animation-workletâ ">1.1. Relationship to the Web Animations API</a>
    <li><a href="#ref-for-animation-workletâ¡">2. Threading Model</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-window-animationworklet">
   <b><a href="#dom-window-animationworklet">#dom-window-animationworklet</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-window-animationworklet">3. Animation Worklet</a> <a href="#ref-for-dom-window-animationworkletâ ">(2)</a> <a href="#ref-for-dom-window-animationworkletâ¡">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="callbackdef-voidfunction">
   <b><a href="#callbackdef-voidfunction">#callbackdef-voidfunction</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-callbackdef-voidfunction">3. Animation Worklet</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="animationworkletglobalscope">
   <b><a href="#animationworkletglobalscope">#animationworkletglobalscope</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-animationworkletglobalscope">3. Animation Worklet</a> <a href="#ref-for-animationworkletglobalscopeâ ">(2)</a>
    <li><a href="#ref-for-animationworkletglobalscopeâ¡">4. Animator Definition</a>
    <li><a href="#ref-for-animationworkletglobalscopeâ¢">4.1. Registering an Animator Definition</a> <a href="#ref-for-animationworkletglobalscopeâ£">(2)</a>
    <li><a href="#ref-for-animationworkletglobalscopeâ¤">5. Animator Instance</a>
    <li><a href="#ref-for-animationworkletglobalscopeâ¥">5.1. Creating an Animator Instance</a> <a href="#ref-for-animationworkletglobalscopeâ¦">(2)</a> <a href="#ref-for-animationworkletglobalscopeâ§">(3)</a>
    <li><a href="#ref-for-animationworkletglobalscopeâ¨">6.4. Interaction with Animator Instances</a> <a href="#ref-for-animationworkletglobalscopeâ âª">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="animator-definition">
   <b><a href="#animator-definition">#animator-definition</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-animator-definition">4.1. Registering an Animator Definition</a>
    <li><a href="#ref-for-animator-definitionâ ">5. Animator Instance</a>
    <li><a href="#ref-for-animator-definitionâ¡">6.1. Worklet Animation</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="animator-name">
   <b><a href="#animator-name">#animator-name</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-animator-name">4.1. Registering an Animator Definition</a>
    <li><a href="#ref-for-animator-nameâ ">5. Animator Instance</a>
    <li><a href="#ref-for-animator-nameâ¡">5.1. Creating an Animator Instance</a>
    <li><a href="#ref-for-animator-nameâ¢">5.2. Running Animators</a>
    <li><a href="#ref-for-animator-nameâ£">5.4. Migrating an Animator Instance</a> <a href="#ref-for-animator-nameâ¤">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="class-constructor">
   <b><a href="#class-constructor">#class-constructor</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-class-constructor">4.1. Registering an Animator Definition</a>
    <li><a href="#ref-for-class-constructorâ ">5.1. Creating an Animator Instance</a>
    <li><a href="#ref-for-class-constructorâ¡">5.4. Migrating an Animator Instance</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="animate-function">
   <b><a href="#animate-function">#animate-function</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-animate-function">2. Threading Model</a>
    <li><a href="#ref-for-animate-functionâ ">4.1. Registering an Animator Definition</a>
    <li><a href="#ref-for-animate-functionâ¡">5.2. Running Animators</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="animator-name-to-animator-definition-map">
   <b><a href="#animator-name-to-animator-definition-map">#animator-name-to-animator-definition-map</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-animator-name-to-animator-definition-map">4.1. Registering an Animator Definition</a> <a href="#ref-for-animator-name-to-animator-definition-mapâ ">(2)</a>
    <li><a href="#ref-for-animator-name-to-animator-definition-mapâ¡">5.1. Creating an Animator Instance</a>
    <li><a href="#ref-for-animator-name-to-animator-definition-mapâ¢">5.2. Running Animators</a>
    <li><a href="#ref-for-animator-name-to-animator-definition-mapâ£">5.4. Migrating an Animator Instance</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-animationworkletglobalscope-registeranimator">
   <b><a href="#dom-animationworkletglobalscope-registeranimator">#dom-animationworkletglobalscope-registeranimator</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-animationworkletglobalscope-registeranimator">3. Animation Worklet</a>
    <li><a href="#ref-for-dom-animationworkletglobalscope-registeranimatorâ ">4.1. Registering an Animator Definition</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="animator-instance">
   <b><a href="#animator-instance">#animator-instance</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-animator-instance">5.1. Creating an Animator Instance</a> <a href="#ref-for-animator-instanceâ ">(2)</a> <a href="#ref-for-animator-instanceâ¡">(3)</a>
    <li><a href="#ref-for-animator-instanceâ¢">5.2. Running Animators</a> <a href="#ref-for-animator-instanceâ£">(2)</a>
    <li><a href="#ref-for-animator-instanceâ¤">5.4. Migrating an Animator Instance</a> <a href="#ref-for-animator-instanceâ¥">(2)</a>
    <li><a href="#ref-for-animator-instanceâ¦">5.5. Requesting Animation Frames</a>
    <li><a href="#ref-for-animator-instanceâ§">6.1. Worklet Animation</a> <a href="#ref-for-animator-instanceâ¨">(2)</a> <a href="#ref-for-animator-instanceâ âª">(3)</a>
    <li><a href="#ref-for-animator-instanceâ â ">6.3. Worklet Animation timing model</a> <a href="#ref-for-animator-instanceâ â¡">(2)</a> <a href="#ref-for-animator-instanceâ â¢">(3)</a> <a href="#ref-for-animator-instanceâ â£">(4)</a>
    <li><a href="#ref-for-animator-instanceâ â¤">6.4. Interaction with Animator Instances</a> <a href="#ref-for-animator-instanceâ â¥">(2)</a> <a href="#ref-for-animator-instanceâ â¦">(3)</a> <a href="#ref-for-animator-instanceâ â§">(4)</a> <a href="#ref-for-animator-instanceâ â¨">(5)</a> <a href="#ref-for-animator-instanceâ¡âª">(6)</a> <a href="#ref-for-animator-instanceâ¡â ">(7)</a> <a href="#ref-for-animator-instanceâ¡â¡">(8)</a>
    <li><a href="#ref-for-animator-instanceâ¡â¢">6.7. WorkletGroupEffect</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="animator-effect">
   <b><a href="#animator-effect">#animator-effect</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-animator-effect">5.1. Creating an Animator Instance</a>
    <li><a href="#ref-for-animator-effectâ ">5.2. Running Animators</a>
    <li><a href="#ref-for-animator-effectâ¡">5.4. Migrating an Animator Instance</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="animator-current-time">
   <b><a href="#animator-current-time">#animator-current-time</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-animator-current-time">5.1. Creating an Animator Instance</a>
    <li><a href="#ref-for-animator-current-timeâ ">5.2. Running Animators</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="animator-timeline">
   <b><a href="#animator-timeline">#animator-timeline</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-animator-timeline">5.1. Creating an Animator Instance</a>
    <li><a href="#ref-for-animator-timelineâ ">5.4. Migrating an Animator Instance</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="animator-attached-timelines">
   <b><a href="#animator-attached-timelines">#animator-attached-timelines</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-animator-attached-timelines">5.1. Creating an Animator Instance</a>
    <li><a href="#ref-for-animator-attached-timelinesâ ">5.5. Requesting Animation Frames</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="animator-serialized-options">
   <b><a href="#animator-serialized-options">#animator-serialized-options</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-animator-serialized-options">5.1. Creating an Animator Instance</a>
    <li><a href="#ref-for-animator-serialized-optionsâ ">5.4. Migrating an Animator Instance</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="animator-instance-set">
   <b><a href="#animator-instance-set">#animator-instance-set</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-animator-instance-set">5.1. Creating an Animator Instance</a>
    <li><a href="#ref-for-animator-instance-setâ ">5.2. Running Animators</a>
    <li><a href="#ref-for-animator-instance-setâ¡">5.3. Removing an Animator Instance</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="create-a-new-animator-instance">
   <b><a href="#create-a-new-animator-instance">#create-a-new-animator-instance</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-create-a-new-animator-instance">5.4. Migrating an Animator Instance</a>
    <li><a href="#ref-for-create-a-new-animator-instanceâ ">6.4. Interaction with Animator Instances</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="run-animators">
   <b><a href="#run-animators">#run-animators</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-run-animators">5.2. Running Animators</a> <a href="#ref-for-run-animatorsâ ">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="remove-an-animator-instance">
   <b><a href="#remove-an-animator-instance">#remove-an-animator-instance</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-remove-an-animator-instance">5.4. Migrating an Animator Instance</a>
    <li><a href="#ref-for-remove-an-animator-instanceâ ">6.4. Interaction with Animator Instances</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="animation-requested-flag">
   <b><a href="#animation-requested-flag">#animation-requested-flag</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-animation-requested-flag">5. Animator Instance</a>
    <li><a href="#ref-for-animation-requested-flagâ ">5.1. Creating an Animator Instance</a>
    <li><a href="#ref-for-animation-requested-flagâ¡">5.2. Running Animators</a> <a href="#ref-for-animation-requested-flagâ¢">(2)</a>
    <li><a href="#ref-for-animation-requested-flagâ£">5.5. Requesting Animation Frames</a> <a href="#ref-for-animation-requested-flagâ¤">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="frame-requested">
   <b><a href="#frame-requested">#frame-requested</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-frame-requested">5.2. Running Animators</a>
    <li><a href="#ref-for-frame-requestedâ ">5.5. Requesting Animation Frames</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="frame-current">
   <b><a href="#frame-current">#frame-current</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-frame-current">5.1. Creating an Animator Instance</a>
    <li><a href="#ref-for-frame-currentâ ">5.2. Running Animators</a>
    <li><a href="#ref-for-frame-currentâ¡">5.5. Requesting Animation Frames</a> <a href="#ref-for-frame-currentâ¢">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="worklet-animation">
   <b><a href="#worklet-animation">#worklet-animation</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-worklet-animation">5. Animator Instance</a>
    <li><a href="#ref-for-worklet-animationâ ">5.5. Requesting Animation Frames</a>
    <li><a href="#ref-for-worklet-animationâ¡">6.1. Worklet Animation</a> <a href="#ref-for-worklet-animationâ¢">(2)</a>
    <li><a href="#ref-for-worklet-animationâ£">6.3. Worklet Animation timing model</a> <a href="#ref-for-worklet-animationâ¤">(2)</a> <a href="#ref-for-worklet-animationâ¥">(3)</a> <a href="#ref-for-worklet-animationâ¦">(4)</a> <a href="#ref-for-worklet-animationâ§">(5)</a> <a href="#ref-for-worklet-animationâ¨">(6)</a>
    <li><a href="#ref-for-worklet-animationâ âª">6.4. Interaction with Animator Instances</a> <a href="#ref-for-worklet-animationâ â ">(2)</a>
    <li><a href="#ref-for-worklet-animationâ â¡">6.6. ScrollTimeline</a>
    <li><a href="#ref-for-worklet-animationâ â¢">6.8. Effect Stack and Composite Order</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="animation-animator-name">
   <b><a href="#animation-animator-name">#animation-animator-name</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-animation-animator-name">6.2. Creating a Worklet Animation</a>
    <li><a href="#ref-for-animation-animator-nameâ ">6.4. Interaction with Animator Instances</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="serialized-options">
   <b><a href="#serialized-options">#serialized-options</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-serialized-options">6.2. Creating a Worklet Animation</a>
    <li><a href="#ref-for-serialized-optionsâ ">6.4. Interaction with Animator Instances</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="workletanimation">
   <b><a href="#workletanimation">#workletanimation</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-workletanimation">6.2. Creating a Worklet Animation</a> <a href="#ref-for-workletanimationâ ">(2)</a>
    <li><a href="#ref-for-workletanimationâ¡">6.7. WorkletGroupEffect</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="associate-animator-instance-of-worklet-animation">
   <b><a href="#associate-animator-instance-of-worklet-animation">#associate-animator-instance-of-worklet-animation</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-associate-animator-instance-of-worklet-animation">6.4. Interaction with Animator Instances</a> <a href="#ref-for-associate-animator-instance-of-worklet-animationâ ">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="disassociate-animator-instance-of-worklet-animation">
   <b><a href="#disassociate-animator-instance-of-worklet-animation">#disassociate-animator-instance-of-worklet-animation</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-disassociate-animator-instance-of-worklet-animation">6.4. Interaction with Animator Instances</a> <a href="#ref-for-disassociate-animator-instance-of-worklet-animationâ ">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="set-animator-instance-of-worklet-animation">
   <b><a href="#set-animator-instance-of-worklet-animation">#set-animator-instance-of-worklet-animation</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-set-animator-instance-of-worklet-animation">6.4. Interaction with Animator Instances</a> <a href="#ref-for-set-animator-instance-of-worklet-animationâ ">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="workletgroupeffectreadonly">
   <b><a href="#workletgroupeffectreadonly">#workletgroupeffectreadonly</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-workletgroupeffectreadonly">6.7. WorkletGroupEffect</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="workletgroupeffect">
   <b><a href="#workletgroupeffect">#workletgroupeffect</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-workletgroupeffect">6.2. Creating a Worklet Animation</a>
    <li><a href="#ref-for-workletgroupeffectâ ">6.7. WorkletGroupEffect</a> <a href="#ref-for-workletgroupeffectâ¡">(2)</a> <a href="#ref-for-workletgroupeffectâ¢">(3)</a> <a href="#ref-for-workletgroupeffectâ£">(4)</a> <a href="#ref-for-workletgroupeffectâ¤">(5)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-animationeffectreadonly-localtime">
   <b><a href="#dom-animationeffectreadonly-localtime">#dom-animationeffectreadonly-localtime</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-animationeffectreadonly-localtime">6.7. WorkletGroupEffect</a>
   </ul>
  </aside>
<script>/* script-dfn-panel */

        document.body.addEventListener("click", function(e) {
            var queryAll = function(sel) { return [].slice.call(document.querySelectorAll(sel)); }
            // Find the dfn element or panel, if any, that was clicked on.
            var el = e.target;
            var target;
            var hitALink = false;
            while(el.parentElement) {
                if(el.tagName == "A") {
                    // Clicking on a link in a <dfn> shouldn't summon the panel
                    hitALink = true;
                }
                if(el.classList.contains("dfn-paneled")) {
                    target = "dfn";
                    break;
                }
                if(el.classList.contains("dfn-panel")) {
                    target = "dfn-panel";
                    break;
                }
                el = el.parentElement;
            }
            if(target != "dfn-panel") {
                // Turn off any currently "on" or "activated" panels.
                queryAll(".dfn-panel.on, .dfn-panel.activated").forEach(function(el){
                    el.classList.remove("on");
                    el.classList.remove("activated");
                });
            }
            if(target == "dfn" && !hitALink) {
                // open the panel
                var dfnPanel = document.querySelector(".dfn-panel[data-for='" + el.id + "']");
                if(dfnPanel) {
                    console.log(dfnPanel);
                    dfnPanel.classList.add("on");
                    var rect = el.getBoundingClientRect();
                    dfnPanel.style.left = window.scrollX + rect.right + 5 + "px";
                    dfnPanel.style.top = window.scrollY + rect.top + "px";
                    var panelRect = dfnPanel.getBoundingClientRect();
                    var panelWidth = panelRect.right - panelRect.left;
                    if(panelRect.right > document.body.scrollWidth && (rect.left - (panelWidth + 5)) > 0) {
                        // Reposition, because the panel is overflowing
                        dfnPanel.style.left = window.scrollX + rect.left - (panelWidth + 5) + "px";
                    }
                } else {
                    console.log("Couldn't find .dfn-panel[data-for='" + el.id + "']");
                }
            } else if(target == "dfn-panel") {
                // Switch it to "activated" state, which pins it.
                el.classList.add("activated");
                el.style.left = null;
                el.style.top = null;
            }

        });
        </script>