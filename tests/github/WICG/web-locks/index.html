<!doctype html><html lang="en">
 <head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
  <title>Web Locks API</title>
  <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
  <link href="https://www.w3.org/StyleSheets/TR/2021/cg-draft" rel="stylesheet">
  <link href="https://wicg.github.io/web-locks/" rel="canonical">
  <link href="logo-lock.svg" rel="icon">
<style>
.domintro::before {
    content: 'For web developers (non-normative)';
    text-transform: initial;
}
.domintro dt {
    font-family: Menlo, Consolas, "DejaVu Sans Mono", Monaco, monospace;

    padding-top: 0.5em;
    padding-bottom: 1em;
}
.domintro dt a {
    color: inherit; border-bottom-style: none;
}
.domintro dt code {
    font-size: inherit;
}
</style>
<style>/* Boilerplate: style-autolinks */
.css.css, .property.property, .descriptor.descriptor {
    color: var(--a-normal-text);
    font-size: inherit;
    font-family: inherit;
}
.css::before, .property::before, .descriptor::before {
    content: "‘";
}
.css::after, .property::after, .descriptor::after {
    content: "’";
}
.property, .descriptor {
    /* Don't wrap property and descriptor names */
    white-space: nowrap;
}
.type { /* CSS value <type> */
    font-style: italic;
}
pre .property::before, pre .property::after {
    content: "";
}
[data-link-type="property"]::before,
[data-link-type="propdesc"]::before,
[data-link-type="descriptor"]::before,
[data-link-type="value"]::before,
[data-link-type="function"]::before,
[data-link-type="at-rule"]::before,
[data-link-type="selector"]::before,
[data-link-type="maybe"]::before {
    content: "‘";
}
[data-link-type="property"]::after,
[data-link-type="propdesc"]::after,
[data-link-type="descriptor"]::after,
[data-link-type="value"]::after,
[data-link-type="function"]::after,
[data-link-type="at-rule"]::after,
[data-link-type="selector"]::after,
[data-link-type="maybe"]::after {
    content: "’";
}

[data-link-type].production::before,
[data-link-type].production::after,
.prod [data-link-type]::before,
.prod [data-link-type]::after {
    content: "";
}

[data-link-type=element],
[data-link-type=element-attr] {
    font-family: Menlo, Consolas, "DejaVu Sans Mono", monospace;
    font-size: .9em;
}
[data-link-type=element]::before { content: "<" }
[data-link-type=element]::after  { content: ">" }

[data-link-type=biblio] {
    white-space: pre;
}

@media (prefers-color-scheme: dark) {
    :root {
        --selflink-text: black;
        --selflink-bg: silver;
        --selflink-hover-text: white;
    }
}
</style>
<style>/* Boilerplate: style-colors */

/* Any --*-text not paired with a --*-bg is assumed to have a transparent bg */
:root {
    color-scheme: light dark;

    --text: black;
    --bg: white;

    --unofficial-watermark: url(https://www.w3.org/StyleSheets/TR/2016/logos/UD-watermark);

    --logo-bg: #1a5e9a;
    --logo-active-bg: #c00;
    --logo-text: white;

    --tocnav-normal-text: #707070;
    --tocnav-normal-bg: var(--bg);
    --tocnav-hover-text: var(--tocnav-normal-text);
    --tocnav-hover-bg: #f8f8f8;
    --tocnav-active-text: #c00;
    --tocnav-active-bg: var(--tocnav-normal-bg);

    --tocsidebar-text: var(--text);
    --tocsidebar-bg: #f7f8f9;
    --tocsidebar-shadow: rgba(0,0,0,.1);
    --tocsidebar-heading-text: hsla(203,20%,40%,.7);

    --toclink-text: var(--text);
    --toclink-underline: #3980b5;
    --toclink-visited-text: var(--toclink-text);
    --toclink-visited-underline: #054572;

    --heading-text: #005a9c;

    --hr-text: var(--text);

    --algo-border: #def;

    --del-text: red;
    --del-bg: transparent;
    --ins-text: #080;
    --ins-bg: transparent;

    --a-normal-text: #034575;
    --a-normal-underline: #bbb;
    --a-visited-text: var(--a-normal-text);
    --a-visited-underline: #707070;
    --a-hover-bg: rgba(75%, 75%, 75%, .25);
    --a-active-text: #c00;
    --a-active-underline: #c00;

    --blockquote-border: silver;
    --blockquote-bg: transparent;
    --blockquote-text: currentcolor;

    --issue-border: #e05252;
    --issue-bg: #fbe9e9;
    --issue-text: var(--text);
    --issueheading-text: #831616;

    --example-border: #e0cb52;
    --example-bg: #fcfaee;
    --example-text: var(--text);
    --exampleheading-text: #574b0f;

    --note-border: #52e052;
    --note-bg: #e9fbe9;
    --note-text: var(--text);
    --noteheading-text: hsl(120, 70%, 30%);
    --notesummary-underline: silver;

    --assertion-border: #aaa;
    --assertion-bg: #eee;
    --assertion-text: black;

    --advisement-border: orange;
    --advisement-bg: #fec;
    --advisement-text: var(--text);
    --advisementheading-text: #b35f00;

    --warning-border: red;
    --warning-bg: hsla(40,100%,50%,0.95);
    --warning-text: var(--text);

    --amendment-border: #330099;
    --amendment-bg: #F5F0FF;
    --amendment-text: var(--text);
    --amendmentheading-text: #220066;

    --def-border: #8ccbf2;
    --def-bg: #def;
    --def-text: var(--text);
    --defrow-border: #bbd7e9;

    --datacell-border: silver;

    --indexinfo-text: #707070;

    --indextable-hover-text: black;
    --indextable-hover-bg: #f7f8f9;

    --outdatedspec-bg: rgba(0, 0, 0, .5);
    --outdatedspec-text: black;
    --outdated-bg: maroon;
    --outdated-text: white;
    --outdated-shadow: red;

    --editedrec-bg: darkorange;
}

@media (prefers-color-scheme: dark) {
    :root {
        --text: #ddd;
        --bg: black;

        --unofficial-watermark: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='400'%3E%3Cg fill='%23100808' transform='translate(200 200) rotate(-45) translate(-200 -200)' stroke='%23100808' stroke-width='3'%3E%3Ctext x='50%25' y='220' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EUNOFFICIAL%3C/text%3E%3Ctext x='50%25' y='305' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EDRAFT%3C/text%3E%3C/g%3E%3C/svg%3E");

        --logo-bg: #1a5e9a;
        --logo-active-bg: #c00;
        --logo-text: white;

        --tocnav-normal-text: #999;
        --tocnav-normal-bg: var(--bg);
        --tocnav-hover-text: var(--tocnav-normal-text);
        --tocnav-hover-bg: #080808;
        --tocnav-active-text: #f44;
        --tocnav-active-bg: var(--tocnav-normal-bg);

        --tocsidebar-text: var(--text);
        --tocsidebar-bg: #080808;
        --tocsidebar-shadow: rgba(255,255,255,.1);
        --tocsidebar-heading-text: hsla(203,20%,40%,.7);

        --toclink-text: var(--text);
        --toclink-underline: #6af;
        --toclink-visited-text: var(--toclink-text);
        --toclink-visited-underline: #054572;

        --heading-text: #8af;

        --hr-text: var(--text);

        --algo-border: #456;

        --del-text: #f44;
        --del-bg: transparent;
        --ins-text: #4a4;
        --ins-bg: transparent;

        --a-normal-text: #6af;
        --a-normal-underline: #555;
        --a-visited-text: var(--a-normal-text);
        --a-visited-underline: var(--a-normal-underline);
        --a-hover-bg: rgba(25%, 25%, 25%, .2);
        --a-active-text: #f44;
        --a-active-underline: var(--a-active-text);

        --borderedblock-bg: rgba(255, 255, 255, .05);

        --blockquote-border: silver;
        --blockquote-bg: var(--borderedblock-bg);
        --blockquote-text: currentcolor;

        --issue-border: #e05252;
        --issue-bg: var(--borderedblock-bg);
        --issue-text: var(--text);
        --issueheading-text: hsl(0deg, 70%, 70%);

        --example-border: hsl(50deg, 90%, 60%);
        --example-bg: var(--borderedblock-bg);
        --example-text: var(--text);
        --exampleheading-text: hsl(50deg, 70%, 70%);

        --note-border: hsl(120deg, 100%, 35%);
        --note-bg: var(--borderedblock-bg);
        --note-text: var(--text);
        --noteheading-text: hsl(120, 70%, 70%);
        --notesummary-underline: silver;

        --assertion-border: #444;
        --assertion-bg: var(--borderedblock-bg);
        --assertion-text: var(--text);

        --advisement-border: orange;
        --advisement-bg: #222218;
        --advisement-text: var(--text);
        --advisementheading-text: #f84;

        --warning-border: red;
        --warning-bg: hsla(40,100%,20%,0.95);
        --warning-text: var(--text);

        --amendment-border: #330099;
        --amendment-bg: #080010;
        --amendment-text: var(--text);
        --amendmentheading-text: #cc00ff;

        --def-border: #8ccbf2;
        --def-bg: #080818;
        --def-text: var(--text);
        --defrow-border: #136;

        --datacell-border: silver;

        --indexinfo-text: #aaa;

        --indextable-hover-text: var(--text);
        --indextable-hover-bg: #181818;

        --outdatedspec-bg: rgba(255, 255, 255, .5);
        --outdatedspec-text: black;
        --outdated-bg: maroon;
        --outdated-text: white;
        --outdated-shadow: red;

        --editedrec-bg: darkorange;
    }
    /* In case a transparent-bg image doesn't expect to be on a dark bg,
       which is quite common in practice... */
    img { background: white; }
}
</style>
<style>/* Boilerplate: style-counters */
body {
    counter-reset: example figure issue;
}
.issue {
    counter-increment: issue;
}
.issue:not(.no-marker)::before {
    content: "Issue " counter(issue);
}

.example {
    counter-increment: example;
}
.example:not(.no-marker)::before {
    content: "Example " counter(example);
}
.invalid.example:not(.no-marker)::before,
.illegal.example:not(.no-marker)::before {
    content: "Invalid Example" counter(example);
}

figcaption {
    counter-increment: figure;
}
figcaption:not(.no-marker)::before {
    content: "Figure " counter(figure) " ";
}
</style>
<style>/* Boilerplate: style-dfn-panel */
:root {
    --dfnpanel-bg: #ddd;
    --dfnpanel-text: var(--text);
    --dfnpanel-target-bg: #ffc;
    --dfnpanel-target-outline: orange;
}
@media (prefers-color-scheme: dark) {
    :root {
        --dfnpanel-bg: #222;
        --dfnpanel-text: var(--text);
        --dfnpanel-target-bg: #333;
        --dfnpanel-target-outline: silver;
    }
}
.dfn-panel {
    position: absolute;
    z-index: 35;
    width: 20em;
    width: 300px;
    height: auto;
    max-height: 500px;
    overflow: auto;
    padding: 0.5em 0.75em;
    font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
    background: var(--dfnpanel-bg);
    color: var(--dfnpanel-text);
    border: outset 0.2em;
    white-space: normal; /* in case it's moved into a pre */
}
.dfn-panel:not(.on) { display: none; }
.dfn-panel * { margin: 0; padding: 0; text-indent: 0; }
.dfn-panel > b { display: block; }
.dfn-panel a { color: var(--dfnpanel-text); }
.dfn-panel a:not(:hover) { text-decoration: none !important; border-bottom: none !important; }
.dfn-panel a:focus {
    outline: 5px auto Highlight;
    outline: 5px auto -webkit-focus-ring-color;
}
.dfn-panel > b + b { margin-top: 0.25em; }
.dfn-panel ul { padding: 0 0 0 1em; list-style: none; }
.dfn-panel li a {
    max-width: calc(300px - 1.5em - 1em);
    overflow: hidden;
    text-overflow: ellipsis;
}

.dfn-panel.activated {
    display: inline-block;
    position: fixed;
    left: 8px;
    bottom: 2em;
    margin: 0 auto;
    max-width: calc(100vw - 1.5em - .4em - .5em);
    max-height: 30vh;
    transition: left 1s ease-out, bottom 1s ease-out;
}

.dfn-panel .link-item:hover {
    text-decoration: underline;
}
.dfn-panel .link-item .copy-icon {
    opacity: 0;
}
.dfn-panel .link-item:hover .copy-icon,
.dfn-panel .link-item .copy-icon:focus {
    opacity: 1;
}

.dfn-panel .copy-icon {
    display: inline-block;
    margin-right: 0.5em;
    width: 0.85em;
    height: 1em;
    border-radius: 3;
    background-color: #ccc;
    cursor: pointer;
}

.dfn-panel .copy-icon .icon {
    width: 100%;
    height: 100%;
    background-color: #fff;
    display: flex;
    justify-content: center;
    align-items: center;
    position: relative;
}

.dfn-panel .copy-icon .icon::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    border: 1px solid black;
    background-color: #ccc;
    opacity: 0.25;
    transform: translate(3px, -3px);
}

.dfn-panel .copy-icon:active .icon::before {
    opacity: 1;
}

.dfn-paneled[role="button"] { cursor: help; }

.highlighted {
    animation: target-fade 3s;
}

@keyframes target-fade {
    from {
        background-color: var(--dfnpanel-target-bg);
        outline: 5px solid var(--dfnpanel-target-outline);
    }
    to {
        color: var(--a-normal-text);
        background-color: transparent;
        outline: transparent;
    }
}
</style>
<style>/* Boilerplate: style-issues */
a[href].issue-return {
    float: right;
    float: inline-end;
    color: var(--issueheading-text);
    font-weight: bold;
    text-decoration: none;
}
</style>
<style>/* Boilerplate: style-md-lists */
/* This is a weird hack for me not yet following the commonmark spec
   regarding paragraph and lists. */
[data-md] > :first-child {
    margin-top: 0;
}
[data-md] > :last-child {
    margin-bottom: 0;
}
</style>
<style>/* Boilerplate: style-mdn-anno */
:root {
	--mdn-bg: #EEE;
	--mdn-shadow: #999;
	--mdn-nosupport-text: #ccc;
}
@media (prefers-color-scheme: dark) {
	:root {
		--mdn-bg: #222;
		--mdn-shadow: #444;
		--mdn-nosupport-text: #666;
	}
}
.mdn-anno {
	background: var(--mdn-bg, #EEE);
	border-radius: .25em;
	box-shadow: 0 0 3px var(--mdn-shadow, #999);
	color: var(--text, black);
	font: 1em sans-serif;
	hyphens: none;
	max-width: min-content;
	overflow: hidden;
	padding: 0.2em;
	position: absolute;
	right: 0.3em;
	top: auto;
	white-space: nowrap;
	word-wrap: normal;
	z-index: 8;
}
.mdn-anno.unpositioned {
	display: none;
}
.mdn-anno.overlapping-main {
	opacity: .2;
	transition: opacity .1s;
}
.mdn-anno[open] {
	opacity: 1;
	z-index: 9;
	min-width: 9em;
}
.mdn-anno:hover {
	opacity: 1;
	outline: var(--text, black) 1px solid;
}
.mdn-anno > summary {
	font-weight: normal;
	text-align: right;
	cursor: pointer;
	display: block;
}
.mdn-anno > summary > .less-than-two-engines-flag {
	color: red;
	padding-right: 2px;
}
.mdn-anno > summary > .all-engines-flag {
	color: green;
	padding-right: 2px;
}
.mdn-anno > summary > span {
	color: #fff;
	background-color: #000;
	font-weight: normal;
	font-family: zillaslab, Palatino, "Palatino Linotype", serif;
	padding: 2px 3px 0px 3px;
	line-height: 1.3em;
	vertical-align: top;
}
.mdn-anno > .feature {
	margin-top: 20px;
}
.mdn-anno > .feature:not(:first-of-type) {
	border-top: 1px solid #999;
	margin-top: 6px;
	padding-top: 2px;
}
.mdn-anno > .feature > .less-than-two-engines-text {
	color: red;
}
.mdn-anno > .feature > .all-engines-text {
	color: green;
}
.mdn-anno > .feature > p {
	font-size: .75em;
	margin-top: 6px;
	margin-bottom: 0;
}
.mdn-anno > .feature > p + p {
	margin-top: 3px;
}
.mdn-anno > .feature > .support {
	display: block;
	font-size: 0.6em;
	margin: 0;
	padding: 0;
	margin-top: 2px;
}
.mdn-anno > .feature > .support + div {
	padding-top: 0.5em;
}
.mdn-anno > .feature > .support > hr {
	display: block;
	border: none;
	border-top: 1px dotted #999;
	padding: 3px 0px 0px 0px;
	margin: 2px 3px 0px 3px;
}
.mdn-anno > .feature > .support > hr::before {
	content: "";
}
.mdn-anno > .feature > .support > span {
	padding: 0.2em 0;
	display: block;
	display: table;
}
.mdn-anno > .feature > .support > span.no {
	color: var(--mdn-nosupport-text);
	filter: grayscale(100%);
}
.mdn-anno > .feature > .support > span.no::before {
	opacity: 0.5;
}
.mdn-anno > .feature > .support > span:first-of-type {
	padding-top: 0.5em;
}
.mdn-anno > .feature > .support > span > span {
	padding: 0 0.5em;
	display: table-cell;
}
.mdn-anno > .feature > .support > span > span:first-child {
	width: 100%;
}
.mdn-anno > .feature > .support > span > span:last-child {
	width: 100%;
	white-space: pre;
	padding: 0;
}
.mdn-anno > .feature > .support > span::before {
	content: ' ';
	display: table-cell;
	min-width: 1.5em;
	height: 1.5em;
	background: no-repeat center center;
	background-size: contain;
	text-align: right;
	font-size: 0.75em;
	font-weight: bold;
}
.mdn-anno > .feature > .support > .chrome_android::before {
	background-image: url(https://resources.whatwg.org/browser-logos/chrome.svg);
}
.mdn-anno > .feature > .support > .firefox_android::before {
	background-image: url(https://resources.whatwg.org/browser-logos/firefox.png);
}
.mdn-anno > .feature > .support > .chrome::before {
	background-image: url(https://resources.whatwg.org/browser-logos/chrome.svg);
}
.mdn-anno > .feature > .support > .edge_blink::before {
	background-image: url(https://resources.whatwg.org/browser-logos/edge.svg);
}
.mdn-anno > .feature > .support > .edge::before {
	background-image: url(https://resources.whatwg.org/browser-logos/edge_legacy.svg);
}
.mdn-anno > .feature > .support > .firefox::before {
	background-image: url(https://resources.whatwg.org/browser-logos/firefox.png);
}
.mdn-anno > .feature > .support > .ie::before {
	background-image: url(https://resources.whatwg.org/browser-logos/ie.png);
}
.mdn-anno > .feature > .support > .safari_ios::before {
	background-image: url(https://resources.whatwg.org/browser-logos/safari-ios.svg);
}
.mdn-anno > .feature > .support > .nodejs::before {
	background-image: url(https://nodejs.org/static/images/favicons/favicon.ico);
}
.mdn-anno > .feature > .support > .opera_android::before {
	background-image: url(https://resources.whatwg.org/browser-logos/opera.svg);
}
.mdn-anno > .feature > .support > .opera::before {
	background-image: url(https://resources.whatwg.org/browser-logos/opera.svg);
}
.mdn-anno > .feature > .support > .safari::before {
	background-image: url(https://resources.whatwg.org/browser-logos/safari.png);
}
.mdn-anno > .feature > .support > .samsunginternet_android::before {
	background-image: url(https://resources.whatwg.org/browser-logos/samsung.svg);
}
.mdn-anno > .feature > .support > .webview_android::before {
	background-image: url(https://resources.whatwg.org/browser-logos/android-webview.png);
}
.name-slug-mismatch {
	color: red;
}
.caniuse-status:hover {
	z-index: 9;
}
/* dt, li, .issue, .note, and .example are "position: relative", so to put annotation at right margin, must move to right of containing block */;
.h-entry:not(.status-LS) dt > .mdn-anno, .h-entry:not(.status-LS) li > .mdn-anno, .h-entry:not(.status-LS) .issue > .mdn-anno, .h-entry:not(.status-LS) .note > .mdn-anno, .h-entry:not(.status-LS) .example > .mdn-anno {
	right: -6.7em;
}
.h-entry p + .mdn-anno {
	margin-top: 0;
}
 h2 + .mdn-anno.after {
	margin: -48px 0 0 0;
}
 h3 + .mdn-anno.after {
	margin: -46px 0 0 0;
}
 h4 + .mdn-anno.after {
	margin: -42px 0 0 0;
}
 h5 + .mdn-anno.after {
	margin: -40px 0 0 0;
}
 h6 + .mdn-anno.after {
	margin: -40px 0 0 0;
}
</style>
<style>/* Boilerplate: style-ref-hints */
:root {
    --ref-hint-bg: #ddd;
    --ref-hint-text: var(--text);
}
@media (prefers-color-scheme: dark) {
    :root {
        --ref-hint-bg: #222;
        --ref-hint-text: var(--text);
    }
}

.ref-hint {
    display: none;
    position: absolute;
    z-index: 35;
    width: 20em;
    width: 300px;
    height: auto;
    max-height: 500px;
    overflow: auto;
    padding: 0.5em 0.5em;
    font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
    background: var(--ref-hint-bg);
    color: var(--ref-hint-text);
    border: outset 0.2em;
    white-space: normal; /* in case it's moved into a pre */
}

.ref-hint.on {
    display: inline-block;
}

.ref-hint * { margin: 0; padding: 0; text-indent: 0; }

.ref-hint ul { padding: 0 0 0 1em; list-style: none; }
</style>
<style>/* Boilerplate: style-selflinks */

:root {
    --selflink-text: white;
    --selflink-bg: gray;
    --selflink-hover-text: black;
}
.heading, .issue, .note, .example, li, dt {
    position: relative;
}
a.self-link {
    position: absolute;
    top: 0;
    left: calc(-1 * (3.5rem - 26px));
    width: calc(3.5rem - 26px);
    height: 2em;
    text-align: center;
    border: none;
    transition: opacity .2s;
    opacity: .5;
}
a.self-link:hover {
    opacity: 1;
}
.heading > a.self-link {
    font-size: 83%;
}
.example > a.self-link,
.note > a.self-link,
.issue > a.self-link {
    /* These blocks are overflow:auto, so positioning outside
       doesn't work. */
    left: auto;
    right: 0;
}
li > a.self-link {
    left: calc(-1 * (3.5rem - 26px) - 2em);
}
dfn > a.self-link {
    top: auto;
    left: auto;
    opacity: 0;
    width: 1.5em;
    height: 1.5em;
    background: var(--selflink-bg);
    color: var(--selflink-text);
    font-style: normal;
    transition: opacity .2s, background-color .2s, color .2s;
}
dfn:hover > a.self-link {
    opacity: 1;
}
dfn > a.self-link:hover {
    color: var(--selflink-hover-text);
}

a.self-link::before            { content: "¶"; }
.heading > a.self-link::before { content: "§"; }
dfn > a.self-link::before      { content: "#"; }
</style>
<style>/* Boilerplate: style-syntax-highlighting */

code.highlight { padding: .1em; border-radius: .3em; }
pre.highlight, pre > code.highlight { display: block; padding: 1em; margin: .5em 0; overflow: auto; border-radius: 0; }

.highlight:not(.idl) { background: rgba(0, 0, 0, .03); }
c-[a] { color: #990055 } /* Keyword.Declaration */
c-[b] { color: #990055 } /* Keyword.Type */
c-[c] { color: #708090 } /* Comment */
c-[d] { color: #708090 } /* Comment.Multiline */
c-[e] { color: #0077aa } /* Name.Attribute */
c-[f] { color: #669900 } /* Name.Tag */
c-[g] { color: #222222 } /* Name.Variable */
c-[k] { color: #990055 } /* Keyword */
c-[l] { color: #000000 } /* Literal */
c-[m] { color: #000000 } /* Literal.Number */
c-[n] { color: #0077aa } /* Name */
c-[o] { color: #999999 } /* Operator */
c-[p] { color: #999999 } /* Punctuation */
c-[s] { color: #a67f59 } /* Literal.String */
c-[t] { color: #a67f59 } /* Literal.String.Single */
c-[u] { color: #a67f59 } /* Literal.String.Double */
c-[cp] { color: #708090 } /* Comment.Preproc */
c-[c1] { color: #708090 } /* Comment.Single */
c-[cs] { color: #708090 } /* Comment.Special */
c-[kc] { color: #990055 } /* Keyword.Constant */
c-[kn] { color: #990055 } /* Keyword.Namespace */
c-[kp] { color: #990055 } /* Keyword.Pseudo */
c-[kr] { color: #990055 } /* Keyword.Reserved */
c-[ld] { color: #000000 } /* Literal.Date */
c-[nc] { color: #0077aa } /* Name.Class */
c-[no] { color: #0077aa } /* Name.Constant */
c-[nd] { color: #0077aa } /* Name.Decorator */
c-[ni] { color: #0077aa } /* Name.Entity */
c-[ne] { color: #0077aa } /* Name.Exception */
c-[nf] { color: #0077aa } /* Name.Function */
c-[nl] { color: #0077aa } /* Name.Label */
c-[nn] { color: #0077aa } /* Name.Namespace */
c-[py] { color: #0077aa } /* Name.Property */
c-[ow] { color: #999999 } /* Operator.Word */
c-[mb] { color: #000000 } /* Literal.Number.Bin */
c-[mf] { color: #000000 } /* Literal.Number.Float */
c-[mh] { color: #000000 } /* Literal.Number.Hex */
c-[mi] { color: #000000 } /* Literal.Number.Integer */
c-[mo] { color: #000000 } /* Literal.Number.Oct */
c-[sb] { color: #a67f59 } /* Literal.String.Backtick */
c-[sc] { color: #a67f59 } /* Literal.String.Char */
c-[sd] { color: #a67f59 } /* Literal.String.Doc */
c-[se] { color: #a67f59 } /* Literal.String.Escape */
c-[sh] { color: #a67f59 } /* Literal.String.Heredoc */
c-[si] { color: #a67f59 } /* Literal.String.Interpol */
c-[sx] { color: #a67f59 } /* Literal.String.Other */
c-[sr] { color: #a67f59 } /* Literal.String.Regex */
c-[ss] { color: #a67f59 } /* Literal.String.Symbol */
c-[vc] { color: #0077aa } /* Name.Variable.Class */
c-[vg] { color: #0077aa } /* Name.Variable.Global */
c-[vi] { color: #0077aa } /* Name.Variable.Instance */
c-[il] { color: #000000 } /* Literal.Number.Integer.Long */


@media (prefers-color-scheme: dark) {
    .highlight:not(.idl) { background: rgba(255, 255, 255, .05); }

    c-[a] { color: #d33682 } /* Keyword.Declaration */
    c-[b] { color: #d33682 } /* Keyword.Type */
    c-[c] { color: #2aa198 } /* Comment */
    c-[d] { color: #2aa198 } /* Comment.Multiline */
    c-[e] { color: #268bd2 } /* Name.Attribute */
    c-[f] { color: #b58900 } /* Name.Tag */
    c-[g] { color: #cb4b16 } /* Name.Variable */
    c-[k] { color: #d33682 } /* Keyword */
    c-[l] { color: #657b83 } /* Literal */
    c-[m] { color: #657b83 } /* Literal.Number */
    c-[n] { color: #268bd2 } /* Name */
    c-[o] { color: #657b83 } /* Operator */
    c-[p] { color: #657b83 } /* Punctuation */
    c-[s] { color: #6c71c4 } /* Literal.String */
    c-[t] { color: #6c71c4 } /* Literal.String.Single */
    c-[u] { color: #6c71c4 } /* Literal.String.Double */
    c-[ch] { color: #2aa198 } /* Comment.Hashbang */
    c-[cp] { color: #2aa198 } /* Comment.Preproc */
    c-[cpf] { color: #2aa198 } /* Comment.PreprocFile */
    c-[c1] { color: #2aa198 } /* Comment.Single */
    c-[cs] { color: #2aa198 } /* Comment.Special */
    c-[kc] { color: #d33682 } /* Keyword.Constant */
    c-[kn] { color: #d33682 } /* Keyword.Namespace */
    c-[kp] { color: #d33682 } /* Keyword.Pseudo */
    c-[kr] { color: #d33682 } /* Keyword.Reserved */
    c-[ld] { color: #657b83 } /* Literal.Date */
    c-[nc] { color: #268bd2 } /* Name.Class */
    c-[no] { color: #268bd2 } /* Name.Constant */
    c-[nd] { color: #268bd2 } /* Name.Decorator */
    c-[ni] { color: #268bd2 } /* Name.Entity */
    c-[ne] { color: #268bd2 } /* Name.Exception */
    c-[nf] { color: #268bd2 } /* Name.Function */
    c-[nl] { color: #268bd2 } /* Name.Label */
    c-[nn] { color: #268bd2 } /* Name.Namespace */
    c-[py] { color: #268bd2 } /* Name.Property */
    c-[ow] { color: #657b83 } /* Operator.Word */
    c-[mb] { color: #657b83 } /* Literal.Number.Bin */
    c-[mf] { color: #657b83 } /* Literal.Number.Float */
    c-[mh] { color: #657b83 } /* Literal.Number.Hex */
    c-[mi] { color: #657b83 } /* Literal.Number.Integer */
    c-[mo] { color: #657b83 } /* Literal.Number.Oct */
    c-[sa] { color: #6c71c4 } /* Literal.String.Affix */
    c-[sb] { color: #6c71c4 } /* Literal.String.Backtick */
    c-[sc] { color: #6c71c4 } /* Literal.String.Char */
    c-[dl] { color: #6c71c4 } /* Literal.String.Delimiter */
    c-[sd] { color: #6c71c4 } /* Literal.String.Doc */
    c-[se] { color: #6c71c4 } /* Literal.String.Escape */
    c-[sh] { color: #6c71c4 } /* Literal.String.Heredoc */
    c-[si] { color: #6c71c4 } /* Literal.String.Interpol */
    c-[sx] { color: #6c71c4 } /* Literal.String.Other */
    c-[sr] { color: #6c71c4 } /* Literal.String.Regex */
    c-[ss] { color: #6c71c4 } /* Literal.String.Symbol */
    c-[fm] { color: #268bd2 } /* Name.Function.Magic */
    c-[vc] { color: #cb4b16 } /* Name.Variable.Class */
    c-[vg] { color: #cb4b16 } /* Name.Variable.Global */
    c-[vi] { color: #cb4b16 } /* Name.Variable.Instance */
    c-[vm] { color: #cb4b16 } /* Name.Variable.Magic */
    c-[il] { color: #657b83 } /* Literal.Number.Integer.Long */
}
</style>
<style>/* Boilerplate: style-var-click-highlighting */
/*
Colors were chosen in Lab using https://nixsensor.com/free-color-converter/
D50 2deg illuminant, L in [0,100], a and b in [-128, 128]
0 = lab(85,0,85)
1 = lab(85,80,30)
2 = lab(85,-40,40)
3 = lab(85,-50,0)
4 = lab(85,5,15)
5 = lab(85,-10,-50)
6 = lab(85,35,-15)
*/
var { cursor: pointer; }
var.selected0 { background-color: #F4D200; box-shadow: 0 0 0 2px #F4D200; }
var.selected1 { background-color: #FF87A2; box-shadow: 0 0 0 2px #FF87A2; }
var.selected2 { background-color: #96E885; box-shadow: 0 0 0 2px #96E885; }
var.selected3 { background-color: #3EEED2; box-shadow: 0 0 0 2px #3EEED2; }
var.selected4 { background-color: #EACFB6; box-shadow: 0 0 0 2px #EACFB6; }
var.selected5 { background-color: #82DDFF; box-shadow: 0 0 0 2px #82DDFF; }
var.selected6 { background-color: #FFBCF2; box-shadow: 0 0 0 2px #FFBCF2; }
</style>
 <body class="h-entry">
  <div class="head">
   <p data-fill-with="logo"><a class="logo" href="https://www.w3.org/"> <img alt="W3C" height="48" src="https://www.w3.org/StyleSheets/TR/2021/logos/W3C" width="72"> </a> </p>
   <h1 class="p-name no-ref" id="title">Web Locks API</h1>
   <p id="w3c-state"><a href="https://www.w3.org/standards/types#CG-DRAFT">Draft Community Group Report</a>, <time class="dt-updated" datetime="1970-01-01">1 January 1970</time></p>
   <div data-fill-with="spec-metadata">
    <dl>
     <dt>This version:
     <dd><a class="u-url" href="https://wicg.github.io/web-locks/">https://wicg.github.io/web-locks/</a>
     <dt>Test Suite:
     <dd><a href="https://github.com/web-platform-tests/wpt/tree/master/web-locks">https://github.com/web-platform-tests/wpt/tree/master/web-locks</a>
     <dt class="editor">Editor:
     <dd class="editor p-author h-card vcard"><a class="p-name fn u-email email" href="mailto:jsbell@google.com">Joshua Bell</a> (<a class="p-org org" href="https://google.com">Google Inc.</a>)
    </dl>
   </div>
   <div data-fill-with="warning"></div>
   <p class="copyright" data-fill-with="copyright"><a href="http://www.w3.org/Consortium/Legal/ipr-notice#Copyright">Copyright</a> © 1970 the Contributors to the Web Locks API Specification, published by the <a href="https://www.w3.org/community/wicg/">Web Platform Incubator Community Group</a> under the <a href="https://www.w3.org/community/about/agreements/cla/">W3C Community Contributor License Agreement (CLA)</a>.
A human-readable <a href="http://www.w3.org/community/about/agreements/cla-deed/">summary</a> is available. </p>
   <hr title="Separator for header">
  </div>
  <div class="p-summary" data-fill-with="abstract">
   <h2 class="no-num no-toc no-ref heading settled" id="abstract"><span class="content">Abstract</span></h2>
   <p>This document defines a web platform API that allows script to asynchronously acquire a lock over a resource, hold it while work is performed, then release it. While held, no other script in the origin can acquire a lock over the same resource. This allows contexts (windows, workers) within a web application to coordinate the usage of resources.</p>
  </div>
  <div data-fill-with="at-risk"></div>
  <h2 class="no-num no-toc no-ref heading settled" id="status"><span class="content">Status of this document</span></h2>
  <div data-fill-with="status">
   <p> This specification was published by the <a href="https://www.w3.org/community/wicg/">Web Platform Incubator Community Group</a>.
  It is not a W3C Standard nor is it on the W3C Standards Track.

  Please note that under the <a href="https://www.w3.org/community/about/agreements/cla/">W3C Community Contributor License Agreement (CLA)</a> there is a limited opt-out and other conditions apply.

  Learn more about <a href="http://www.w3.org/community/">W3C Community and Business Groups</a>. </p>
   <p></p>
  </div>
  <div data-fill-with="at-risk"></div>
  <nav data-fill-with="table-of-contents" id="toc">
   <h2 class="no-num no-toc no-ref" id="contents">Table of Contents</h2>
   <ol class="toc" role="directory">
    <li>
     <a href="#introduction"><span class="secno">1</span> <span class="content">Introduction</span></a>
     <ol class="toc">
      <li><a href="#usage-overview"><span class="secno">1.1</span> <span class="content">Usage Overview</span></a>
      <li><a href="#motivations"><span class="secno">1.2</span> <span class="content">Motivating Use Cases</span></a>
     </ol>
    <li>
     <a href="#concepts"><span class="secno">2</span> <span class="content">Concepts</span></a>
     <ol class="toc">
      <li><a href="#resource-names"><span class="secno">2.1</span> <span class="content">Resources Names</span></a>
      <li><a href="#lock-managers"><span class="secno">2.2</span> <span class="content">Lock Managers</span></a>
      <li><a href="#modes-scheduling"><span class="secno">2.3</span> <span class="content">Modes and Scheduling</span></a>
      <li><a href="#concept-lock"><span class="secno">2.4</span> <span class="content">Locks</span></a>
      <li><a href="#concept-lock-request"><span class="secno">2.5</span> <span class="content">Lock Requests</span></a>
      <li><a href="#agent-integration"><span class="secno">2.6</span> <span class="content">Agent Integration</span></a>
     </ol>
    <li>
     <a href="#api"><span class="secno">3</span> <span class="content">API</span></a>
     <ol class="toc">
      <li><a href="#navigator-mixins"><span class="secno">3.1</span> <span class="content">Navigator Mixins</span></a>
      <li>
       <a href="#api-lock-manager"><span class="secno">3.2</span> <span class="content"><code class="idl"><span>LockManager</span></code> class</span></a>
       <ol class="toc">
        <li><a href="#api-lock-manager-request"><span class="secno">3.2.1</span> <span class="content">The <code class="idl"><span>request()</span></code> method</span></a>
        <li><a href="#api-lock-manager-query"><span class="secno">3.2.2</span> <span class="content">The <code class="idl"><span>query()</span></code> method</span></a>
       </ol>
      <li><a href="#api-lock"><span class="secno">3.3</span> <span class="content"><code class="idl"><span>Lock</span></code> class</span></a>
     </ol>
    <li>
     <a href="#algorithms"><span class="secno">4</span> <span class="content">Algorithms</span></a>
     <ol class="toc">
      <li><a href="#algorithm-request-lock"><span class="secno">4.1</span> <span class="content">Request a lock</span></a>
      <li><a href="#algorithm-release-lock"><span class="secno">4.2</span> <span class="content">Release a lock</span></a>
      <li><a href="#algorithm-abort-request"><span class="secno">4.3</span> <span class="content">Abort a request</span></a>
      <li><a href="#algorithm-process-request"><span class="secno">4.4</span> <span class="content">Process a lock request queue for a given resource name</span></a>
      <li><a href="#algorithm-snapshot-state"><span class="secno">4.5</span> <span class="content">Snapshot the lock state</span></a>
     </ol>
    <li>
     <a href="#usage-considerations"><span class="secno">5</span> <span class="content">Usage Considerations</span></a>
     <ol class="toc">
      <li><a href="#deadlocks"><span class="secno">5.1</span> <span class="content">Deadlocks</span></a>
     </ol>
    <li>
     <a href="#security-privacy"><span class="secno">6</span> <span class="content">Security and Privacy Considerations</span></a>
     <ol class="toc">
      <li><a href="#security-scope"><span class="secno">6.1</span> <span class="content">Lock Scope</span></a>
      <li><a href="#private-browsing"><span class="secno">6.2</span> <span class="content">Private Browsing</span></a>
      <li><a href="#implementation-risks"><span class="secno">6.3</span> <span class="content">Implementation Risks</span></a>
      <li><a href="#security-privacy-checklist"><span class="secno">6.4</span> <span class="content">Checklist</span></a>
     </ol>
    <li><a href="#acknowledgements"><span class="secno">7</span> <span class="content">Acknowledgements</span></a>
    <li>
     <a href="#w3c-conformance"><span class="secno"></span> <span class="content">Conformance</span></a>
     <ol class="toc">
      <li><a href="#w3c-conventions"><span class="secno"></span> <span class="content">Document conventions</span></a>
      <li><a href="#w3c-conformant-algorithms"><span class="secno"></span> <span class="content">Conformant Algorithms</span></a>
     </ol>
    <li>
     <a href="#index"><span class="secno"></span> <span class="content">Index</span></a>
     <ol class="toc">
      <li><a href="#index-defined-here"><span class="secno"></span> <span class="content">Terms defined by this specification</span></a>
      <li><a href="#index-defined-elsewhere"><span class="secno"></span> <span class="content">Terms defined by reference</span></a>
     </ol>
    <li>
     <a href="#references"><span class="secno"></span> <span class="content">References</span></a>
     <ol class="toc">
      <li><a href="#normative"><span class="secno"></span> <span class="content">Normative References</span></a>
      <li><a href="#informative"><span class="secno"></span> <span class="content">Informative References</span></a>
     </ol>
    <li><a href="#idl-index"><span class="secno"></span> <span class="content">IDL Index</span></a>
    <li><a href="#issues-index"><span class="secno"></span> <span class="content">Issues Index</span></a>
   </ol>
  </nav>
  <main>
   <p><img alt="logo" src="logo-lock.svg" style="height: 100px; width: 100px; position: absolute; right: 20px; top: 30px;"></p>
   <h2 class="heading settled" data-level="1" id="introduction"><span class="secno">1. </span><span class="content">Introduction</span><a class="self-link" href="#introduction"></a></h2>
   <p><em>This section is non-normative.</em></p>
   <p>A <a data-link-type="dfn" href="#lock-request" id="ref-for-lock-request">lock request</a> is made by script for a particular <a data-link-type="dfn" href="#resource-name" id="ref-for-resource-name">resource name</a> and <a data-link-type="dfn" href="#mode" id="ref-for-mode">mode</a>. A scheduling algorithm looks at the state of current and previous requests, and eventually grants a lock request. A <a data-link-type="dfn" href="#lock-concept" id="ref-for-lock-concept">lock</a> is a granted request; it has a <a data-link-type="dfn" href="#resource-name" id="ref-for-resource-name①">resource name</a> and <a data-link-type="dfn" href="#mode" id="ref-for-mode①">mode</a>. It is represented as an object returned to script. As long as the lock is held it may prevent other lock requests from being granted (depending on the name and mode). A lock can be released by script, at which point it may allow other lock requests to be granted.</p>
   <p>The API provides optional functionality that may be used as needed, including:</p>
   <ul>
    <li data-md>
     <p>returning values from the asynchronous task,</p>
    <li data-md>
     <p>shared and exclusive lock modes,</p>
    <li data-md>
     <p>conditional acquisition,</p>
    <li data-md>
     <p>diagnostics to query the state of locks in an origin, and</p>
    <li data-md>
     <p>an escape hatch to protect against deadlocks.</p>
   </ul>
   <p>Cooperative coordination takes place within the scope of same-origin <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#agent" id="ref-for-agent">agents</a>; this may span multiple <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#integration-with-the-javascript-agent-cluster-formalism" id="ref-for-integration-with-the-javascript-agent-cluster-formalism">agent clusters</a>.</p>
   <aside class="note"> <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#agent" id="ref-for-agent①">Agents</a> roughly correspond to windows (tabs), iframes, and workers. <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#integration-with-the-javascript-agent-cluster-formalism" id="ref-for-integration-with-the-javascript-agent-cluster-formalism①">Agent clusters</a> correspond to independent processes in some user agent implementations. </aside>
   <h3 class="heading settled" data-level="1.1" id="usage-overview"><span class="secno">1.1. </span><span class="content">Usage Overview</span><a class="self-link" href="#usage-overview"></a></h3>
   <p>The API is used as follows:</p>
   <ol>
    <li data-md>
     <p>The lock is requested.</p>
    <li data-md>
     <p>Work is done while holding the lock in an asynchronous task.</p>
    <li data-md>
     <p>The lock is automatically released when the task completes.</p>
   </ol>
   <aside class="example" id="example-basic-usage">
    <a class="self-link" href="#example-basic-usage"></a> 
    <p>A basic example of the API usage is as follows:</p>
<pre class="language-js highlight">navigator<c- p>.</c->locks<c- p>.</c->request<c- p>(</c-><c- t>'my_resource'</c-><c- p>,</c-> <c- k>async</c-> lock <c- p>=></c-> <c- p>{</c->
   <c- c1>// The lock has been acquired.</c->
   <c- k>await</c-> do_something<c- p>();</c->
   <c- k>await</c-> do_somethng_else<c- p>();</c->
   <c- c1>// Now the lock will be released.</c->
<c- p>});</c->
</pre>
    <p>Within an asynchronous function, the request itself can be awaited:</p>
<pre class="language-js highlight"><c- c1>// Before requesting the lock.</c->
<c- k>await</c-> navigator<c- p>.</c->locks<c- p>.</c->request<c- p>(</c-><c- t>'my_resource'</c-><c- p>,</c-> <c- k>async</c-> lock <c- p>=></c-> <c- p>{</c->
   <c- c1>// The lock has been acquired.</c->
   <c- k>await</c-> do_something<c- p>();</c->
   <c- c1>// Now the lock will be released.</c->
<c- p>});</c->
<c- c1>// After the lock has been released</c->
</pre>
   </aside>
   <h3 class="heading settled" data-level="1.2" id="motivations"><span class="secno">1.2. </span><span class="content">Motivating Use Cases</span><a class="self-link" href="#motivations"></a></h3>
   <p>A web-based document editor stores state in memory for fast access and persists changes (as a series of records) to a storage API such as the <a data-link-type="biblio" href="#biblio-indexeddb-2" title="Indexed Database API 2.0">Indexed Database API</a> for resiliency and offline use, and to a server for cross-device use. When the same document is opened for editing in two tabs the work must be coordinated across tabs, such as allowing only one tab to make changes to or synchronize the document at a time. This requires the tabs to coordinate on which will be actively making changes (and synchronizing the in-memory state with the storage API), knowing when the active tab goes away (navigated, closed, crashed) so that another tab can become active.</p>
   <p>In a data synchronization service, a "primary tab" is designated. This tab is the only one that should be performing some operations (e.g. network sync, cleaning up queued data, etc). It holds a lock and never releases it. Other tabs can attempt to acquire the lock, and such attempts will be queued. If the "primary tab" crashes or is closed then one of the other tabs will get the lock and become the new primary.</p>
   <p>The <a data-link-type="biblio" href="#biblio-indexeddb-2" title="Indexed Database API 2.0">Indexed Database API</a> defines a transaction model allowing shared read and exclusive write access across multiple named storage partitions within an origin. Exposing this concept as a primitive allows any Web Platform activity to be scheduled based on resource availability, for example allowing transactions to be composed for other storage types (such as Caches <a data-link-type="biblio" href="#biblio-service-workers" title="Service Workers">[Service-Workers]</a>), across storage types, even across non-storage APIs (e.g. network fetches).</p>
   <h2 class="heading settled" data-level="2" id="concepts"><span class="secno">2. </span><span class="content">Concepts</span><a class="self-link" href="#concepts"></a></h2>
   <p>For the purposes of this specification:</p>
   <ul>
    <li data-md>
     <p>Separate user profiles within a browser are considered separate user agents.</p>
    <li data-md>
     <p>Every <a href="https://github.com/w3ctag/private-mode">private mode</a> browsing session is considered a separate user agent.</p>
   </ul>
   <p>A user agent has a <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="lock-task-queue">lock task queue</dfn> which is the result of <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#starting-a-new-parallel-queue" id="ref-for-starting-a-new-parallel-queue">starting a new parallel queue</a>.</p>
   <p>The <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#task-source" id="ref-for-task-source">task source</a> for <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#enqueue-the-following-steps" id="ref-for-enqueue-the-following-steps">steps enqueued</a> below is the <dfn data-dfn-type="dfn" data-export id="web-locks-tasks-source">web locks tasks source<a class="self-link" href="#web-locks-tasks-source"></a></dfn>.</p>
   <h3 class="heading settled" data-level="2.1" id="resource-names"><span class="secno">2.1. </span><span class="content">Resources Names</span><a class="self-link" href="#resource-names"></a></h3>
   <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="resource-name">resource name</dfn> is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#string" id="ref-for-string">JavaScript string</a> chosen by the web application to represent an abstract resource.</p>
   <p>A resource name has no external meaning beyond the scheduling algorithm, but is global
across <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#browsing-context" id="ref-for-browsing-context">browsing contexts</a> within an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin" id="ref-for-concept-origin">origin</a>. Web applications are free to use any resource naming scheme.</p>
   <aside class="example" id="example-indexeddb-transactions">
    <a class="self-link" href="#example-indexeddb-transactions"></a> To mimic transaction locking over named stores within a named
database in <a data-link-type="biblio" href="#biblio-indexeddb-2" title="Indexed Database API 2.0">[IndexedDB-2]</a>, an origin might compose resource names as: 
<pre class="language-js highlight">encodeURIComponent<c- p>(</c->db_name<c- p>)</c-> <c- o>+</c-> <c- t>'/'</c-> <c- o>+</c-> encodeURIComponent<c- p>(</c->store_name<c- p>)</c->
</pre>
   </aside>
   <p>Resource names starting with U+002D HYPHEN-MINUS (-) are reserved; requesting these will cause an exception.</p>
   <h3 class="heading settled" data-level="2.2" id="lock-managers"><span class="secno">2.2. </span><span class="content">Lock Managers</span><a class="self-link" href="#lock-managers"></a></h3>
   <p>A user agent has a <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="lock-manager">lock manager</dfn> for each <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin" id="ref-for-concept-origin①">origin</a>, which encapsulates the state of all <a data-link-type="dfn" href="#lock-concept" id="ref-for-lock-concept①">locks</a> and <a data-link-type="dfn" href="#lock-request" id="ref-for-lock-request①">lock requests</a> for that origin.</p>
   <p>Pages and workers (<a data-link-type="dfn" href="https://tc39.github.io/ecma262/#agent" id="ref-for-agent②">agents</a>) on a single <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin" id="ref-for-concept-origin②">origin</a> opened in the same user agent share a lock manager even if they are in unrelated <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#browsing-context" id="ref-for-browsing-context①">browsing contexts</a>.</p>
   <aside class="note">
    <p>There is an equivalence between the following:</p>
    <ul>
     <li data-md>
      <p>Agents that share a <a data-link-type="dfn" href="#lock-manager" id="ref-for-lock-manager">lock manager</a>.</p>
     <li data-md>
      <p>Agents that share a <a data-link-type="dfn" href="https://storage.spec.whatwg.org/#storage-shelf" id="ref-for-storage-shelf">storage shelf</a>, i.e. a per-origin <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webstorage.html#dom-localstorage" id="ref-for-dom-localstorage">local storage area</a> <a data-link-type="biblio" href="#biblio-html" title="HTML Standard">[HTML]</a>, set of <a href="https://w3c.github.io/IndexedDB/#database-construct">databases</a> <a data-link-type="biblio" href="#biblio-indexeddb-2" title="Indexed Database API 2.0">[IndexedDB-2]</a>, or <a href="https://w3c.github.io/ServiceWorker/#cache-objects">caches</a> <a data-link-type="biblio" href="#biblio-service-workers" title="Service Workers">[Service-Workers]</a>.</p>
    </ul>
   </aside>
   <aside class="issue" id="issue-fb27f9c9"><a class="self-link" href="#issue-fb27f9c9"></a> Migrate this definition to <a data-link-type="biblio" href="#biblio-html" title="HTML Standard">[HTML]</a> or <a data-link-type="biblio" href="#biblio-storage" title="Storage Standard">[Storage]</a> so it can be referenced by other standards. </aside>
   <h3 class="heading settled" data-level="2.3" id="modes-scheduling"><span class="secno">2.3. </span><span class="content">Modes and Scheduling</span><a class="self-link" href="#modes-scheduling"></a></h3>
   <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="mode">mode</dfn> is either "<code class="idl"><a data-link-type="idl" href="#dom-lockmode-exclusive" id="ref-for-dom-lockmode-exclusive">exclusive</a></code>" or "<code class="idl"><a data-link-type="idl" href="#dom-lockmode-shared" id="ref-for-dom-lockmode-shared">shared</a></code>". Modes can be used to model the common <a href="http://en.wikipedia.org/wiki/Readers%E2%80%93writer_lock">readers-writer lock</a> pattern. If an "<code class="idl"><a data-link-type="idl" href="#dom-lockmode-exclusive" id="ref-for-dom-lockmode-exclusive①">exclusive</a></code>" lock is held, then no other locks with that name can be granted. If a "<code class="idl"><a data-link-type="idl" href="#dom-lockmode-shared" id="ref-for-dom-lockmode-shared①">shared</a></code>" lock is held, other "<code class="idl"><a data-link-type="idl" href="#dom-lockmode-shared" id="ref-for-dom-lockmode-shared②">shared</a></code>" locks with that name can be granted — but not any "<code class="idl"><a data-link-type="idl" href="#dom-lockmode-exclusive" id="ref-for-dom-lockmode-exclusive②">exclusive</a></code>" locks. The default mode in the API is "<code class="idl"><a data-link-type="idl" href="#dom-lockmode-exclusive" id="ref-for-dom-lockmode-exclusive③">exclusive</a></code>".</p>
   <p>Additional properties may influence scheduling, such as timeouts, fairness, and so on.</p>
   <h3 class="heading settled" data-level="2.4" id="concept-lock"><span class="secno">2.4. </span><span class="content">Locks</span><a class="self-link" href="#concept-lock"></a></h3>
   <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="lock-concept" data-noexport id="lock-concept">lock</dfn> represents exclusive access to a shared resource.</p>
   <div>
    <p>A <a data-link-type="dfn" href="#lock-concept" id="ref-for-lock-concept②">lock</a> has an <dfn class="dfn-paneled" data-dfn-for="lock-concept" data-dfn-type="dfn" data-noexport id="lock-concept-agent">agent</dfn> which is an <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#agent" id="ref-for-agent③">agent</a>.</p>
    <p>A <a data-link-type="dfn" href="#lock-concept" id="ref-for-lock-concept③">lock</a> has a <dfn class="dfn-paneled" data-dfn-for="lock-concept" data-dfn-type="dfn" data-noexport id="lock-concept-clientid">clientId</dfn> which is an opaque string.</p>
    <p>A <a data-link-type="dfn" href="#lock-concept" id="ref-for-lock-concept④">lock</a> has an <dfn class="dfn-paneled" data-dfn-for="lock-concept" data-dfn-type="dfn" data-noexport id="lock-concept-origin">origin</dfn> which is an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin" id="ref-for-concept-origin③">origin</a>.</p>
    <p>A <a data-link-type="dfn" href="#lock-concept" id="ref-for-lock-concept⑤">lock</a> has a <dfn class="dfn-paneled" data-dfn-for="lock-concept" data-dfn-type="dfn" data-noexport id="lock-concept-name">name</dfn> which is a <a data-link-type="dfn" href="#resource-name" id="ref-for-resource-name②">resource name</a>.</p>
    <p>A <a data-link-type="dfn" href="#lock-concept" id="ref-for-lock-concept⑥">lock</a> has a <dfn class="dfn-paneled" data-dfn-for="lock-concept" data-dfn-type="dfn" data-noexport id="lock-concept-mode">mode</dfn> which is one of "<code class="idl"><a data-link-type="idl" href="#dom-lockmode-exclusive" id="ref-for-dom-lockmode-exclusive④">exclusive</a></code>" or "<code class="idl"><a data-link-type="idl" href="#dom-lockmode-shared" id="ref-for-dom-lockmode-shared③">shared</a></code>".</p>
    <p>A <a data-link-type="dfn" href="#lock-concept" id="ref-for-lock-concept⑦">lock</a> has a <dfn class="dfn-paneled" data-dfn-for="lock-concept" data-dfn-type="dfn" data-noexport id="lock-concept-waiting-promise">waiting promise</dfn> which is a Promise.</p>
    <p>A <a data-link-type="dfn" href="#lock-concept" id="ref-for-lock-concept⑧">lock</a> has a <dfn class="dfn-paneled" data-dfn-for="lock-concept" data-dfn-type="dfn" data-noexport id="lock-concept-released-promise">released promise</dfn> which is a Promise.</p>
    <aside class="note">
      There are two promises associated with a lock’s lifecycle: 
     <ul>
      <li data-md>
       <p>A promise provided either implicitly or explicitly by the callback when the lock is granted which determines how long the lock is held. When this promise settles, the lock is released. This is known as the lock’s <a data-link-type="dfn" href="#lock-concept-waiting-promise" id="ref-for-lock-concept-waiting-promise">waiting promise</a>.</p>
      <li data-md>
       <p>A promise returned by <code class="idl"><a data-link-type="idl" href="#lockmanager" id="ref-for-lockmanager">LockManager</a></code>'s <code class="idl"><a data-link-type="idl" href="#dom-lockmanager-request" id="ref-for-dom-lockmanager-request">request()</a></code> method that settles when the lock is released or the request is aborted. This is known as the lock’s <a data-link-type="dfn" href="#lock-concept-released-promise" id="ref-for-lock-concept-released-promise">released promise</a>.</p>
     </ul>
<pre class="language-js highlight"><c- a>const</c-> p1 <c- o>=</c-> navigator<c- p>.</c->locks<c- p>.</c->request<c- p>(</c-><c- t>'resource'</c-><c- p>,</c-> lock <c- p>=></c-> <c- p>{</c->
  <c- a>const</c-> p2 <c- o>=</c-> <c- ow>new</c-> Promise<c- p>(</c->r <c- p>=></c-> <c- p>{</c->
    <c- c1>// Logic to use lock and resolve promise...</c->
  <c- p>});</c->
  <c- k>return</c-> p2<c- p>;</c->
<c- p>});</c->
</pre>
     <p>In the above example, <code>p1</code> is the <a data-link-type="dfn" href="#lock-concept-released-promise" id="ref-for-lock-concept-released-promise①">released promise</a> and <code>p2</code> is the <a data-link-type="dfn" href="#lock-concept-waiting-promise" id="ref-for-lock-concept-waiting-promise①">waiting promise</a>.
Note that in most code the callback would be implemented as an <code>async</code> function and the returned promise would be implicit, as in the following example:</p>
<pre class="language-js highlight"><c- a>const</c-> p1 <c- o>=</c-> navigator<c- p>.</c->locks<c- p>.</c->request<c- p>(</c-><c- t>'resource'</c-><c- p>,</c-> <c- k>async</c-> lock <c- p>=></c-> <c- p>{</c->
  <c- c1>// Logic to use lock...</c->
<c- p>});</c->
</pre>
     <p>The <a data-link-type="dfn" href="#lock-concept-waiting-promise" id="ref-for-lock-concept-waiting-promise②">waiting promise</a> is not named in the above code, but is still present as the return value from the anonymous <code>async</code> callback.
Further note that if the callback is not <code>async</code> and returns a non-promise, the return value is wrapped in a promise that is immediately resolved; the lock will be released in an upcoming microtask, and the <a data-link-type="dfn" href="#lock-concept-released-promise" id="ref-for-lock-concept-released-promise②">released promise</a> will also resolve in a subsequent microtask.</p>
    </aside>
    <p>Each origin has a <dfn class="dfn-paneled" data-dfn-for="lock-concept" data-dfn-type="dfn" data-noexport id="lock-concept-held-lock-set">held lock set</dfn> which is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-set" id="ref-for-ordered-set">set</a> of <a data-link-type="dfn" href="#lock-concept" id="ref-for-lock-concept⑨">locks</a>.</p>
    <div class="algorithm" data-algorithm="waiting promise settles">
     <p>When <a data-link-type="dfn" href="#lock-concept" id="ref-for-lock-concept①⓪">lock</a> <var>lock</var>’s <a data-link-type="dfn" href="#lock-concept-waiting-promise" id="ref-for-lock-concept-waiting-promise③">waiting promise</a> settles (fulfills or rejects), <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#enqueue-the-following-steps" id="ref-for-enqueue-the-following-steps①">enqueue the following steps</a> on the <a data-link-type="dfn" href="#lock-task-queue" id="ref-for-lock-task-queue">lock task queue</a>:</p>
     <ol>
      <li data-md>
       <p><a data-link-type="dfn" href="#release-the-lock" id="ref-for-release-the-lock">Release the lock</a> <var>lock</var>.</p>
      <li data-md>
       <p><a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#resolve" id="ref-for-resolve">Resolve</a> <var>lock</var>’s <a data-link-type="dfn" href="#lock-concept-released-promise" id="ref-for-lock-concept-released-promise③">released promise</a> with <var>lock</var>’s <a data-link-type="dfn" href="#lock-concept-waiting-promise" id="ref-for-lock-concept-waiting-promise④">waiting promise</a>.</p>
     </ol>
    </div>
   </div>
   <h3 class="heading settled" data-level="2.5" id="concept-lock-request"><span class="secno">2.5. </span><span class="content">Lock Requests</span><a class="self-link" href="#concept-lock-request"></a></h3>
   <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="lock-request">lock request</dfn> represents a pending request for a <a data-link-type="dfn" href="#lock-concept" id="ref-for-lock-concept①①">lock</a>.</p>
   <div>
    <p>A <a data-link-type="dfn" href="#lock-request" id="ref-for-lock-request②">lock request</a> is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#struct" id="ref-for-struct">struct</a> with <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#struct-item" id="ref-for-struct-item">items</a> <dfn class="dfn-paneled" data-dfn-for="lock request" data-dfn-type="dfn" data-noexport id="lock-request-agent">agent</dfn>, <dfn class="dfn-paneled" data-dfn-for="lock request" data-dfn-type="dfn" data-noexport id="lock-request-clientid">clientId</dfn>, <dfn class="dfn-paneled" data-dfn-for="lock request" data-dfn-type="dfn" data-noexport id="lock-request-origin">origin</dfn>, <dfn class="dfn-paneled" data-dfn-for="lock request" data-dfn-type="dfn" data-noexport id="lock-request-name">name</dfn>, <dfn class="dfn-paneled" data-dfn-for="lock request" data-dfn-type="dfn" data-noexport id="lock-request-mode">mode</dfn>, and <dfn class="dfn-paneled" data-dfn-for="lock request" data-dfn-type="dfn" data-noexport id="lock-request-promise">promise</dfn>.</p>
    <p>A <dfn class="dfn-paneled" data-dfn-for="lock request" data-dfn-type="dfn" data-noexport id="lock-request-lock-request-queue">lock request queue</dfn> is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#queue" id="ref-for-queue">queue</a> of <a data-link-type="dfn" href="#lock-request" id="ref-for-lock-request③">lock requests</a>.</p>
    <p>Each origin has a <dfn class="dfn-paneled" data-dfn-for="lock request" data-dfn-type="dfn" data-noexport id="lock-request-lock-request-queue-map">lock request queue map</dfn>, which is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map" id="ref-for-ordered-map">map</a> of <a data-link-type="dfn" href="#resource-name" id="ref-for-resource-name③">resource names</a> to <a data-link-type="dfn" href="#lock-request-lock-request-queue" id="ref-for-lock-request-lock-request-queue">lock request queues</a>.</p>
    <div class="algorithm" data-algorithm="grantable">
     <p>A <a data-link-type="dfn" href="#lock-request" id="ref-for-lock-request④">lock request</a> <var>request</var> is said to be <dfn class="dfn-paneled" data-dfn-for="lock request" data-dfn-type="dfn" data-noexport id="lock-request-grantable">grantable</dfn> if the following steps return true:</p>
     <ol>
      <li data-md>
       <p>Let <var>origin</var> be <var>request</var>’s <a data-link-type="dfn" href="#lock-request-origin" id="ref-for-lock-request-origin">origin</a>.</p>
      <li data-md>
       <p>Let <var>queueMap</var> be <var>origin</var>’s <a data-link-type="dfn" href="#lock-request-lock-request-queue-map" id="ref-for-lock-request-lock-request-queue-map">lock request queue map</a>.</p>
      <li data-md>
       <p>Let <var>name</var> be <var>request</var>’s <a data-link-type="dfn" href="#lock-request-name" id="ref-for-lock-request-name">name</a>.</p>
      <li data-md>
       <p>Let <var>queue</var> be <var>queueMap</var>[<var>name</var>].</p>
      <li data-md>
       <p>Let <var>held</var> be <var>origin</var>’s <a data-link-type="dfn" href="#lock-concept-held-lock-set" id="ref-for-lock-concept-held-lock-set">held lock set</a></p>
      <li data-md>
       <p>Let <var>mode</var> be <var>request</var>’s <a data-link-type="dfn" href="#lock-request-mode" id="ref-for-lock-request-mode">mode</a></p>
      <li data-md>
       <p>If <var>mode</var> is "<code class="idl"><a data-link-type="idl" href="#dom-lockmode-exclusive" id="ref-for-dom-lockmode-exclusive⑤">exclusive</a></code>", then return true if all of the following conditions are true, and false otherwise:</p>
       <ul>
        <li data-md>
         <p>No <a data-link-type="dfn" href="#lock-concept" id="ref-for-lock-concept①②">lock</a> in <var>held</var> has a <a data-link-type="dfn" href="#lock-concept-name" id="ref-for-lock-concept-name">name</a> that equals <var>name</var></p>
        <li data-md>
         <p>No <a data-link-type="dfn" href="#lock-request" id="ref-for-lock-request⑤">lock request</a> in <var>queue</var> earlier than <var>request</var> exists.</p>
       </ul>
      <li data-md>
       <p>Otherwise, mode is "<code class="idl"><a data-link-type="idl" href="#dom-lockmode-shared" id="ref-for-dom-lockmode-shared④">shared</a></code>"; return true if all of the following conditions are true, and false otherwise:</p>
       <ul>
        <li data-md>
         <p>No <a data-link-type="dfn" href="#lock-concept" id="ref-for-lock-concept①③">lock</a> in <var>held</var> has <a data-link-type="dfn" href="#lock-concept-mode" id="ref-for-lock-concept-mode">mode</a> "<code class="idl"><a data-link-type="idl" href="#dom-lockmode-exclusive" id="ref-for-dom-lockmode-exclusive⑥">exclusive</a></code>" and has a <a data-link-type="dfn" href="#lock-concept-name" id="ref-for-lock-concept-name①">name</a> that equals <var>name</var>.</p>
        <li data-md>
         <p>No <a data-link-type="dfn" href="#lock-request" id="ref-for-lock-request⑥">lock request</a> in <var>queue</var> earlier than <var>request</var> exists.</p>
       </ul>
     </ol>
    </div>
   </div>
   <h3 class="heading settled" data-level="2.6" id="agent-integration"><span class="secno">2.6. </span><span class="content">Agent Integration</span><a class="self-link" href="#agent-integration"></a></h3>
   <div class="algorithm" data-algorithm="agent termination">
     When an <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#agent" id="ref-for-agent④">agent</a> terminates, <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#enqueue-the-following-steps" id="ref-for-enqueue-the-following-steps②">enqueue the following steps</a> on the <a data-link-type="dfn" href="#lock-task-queue" id="ref-for-lock-task-queue①">lock task queue</a>: 
    <aside class="issue" id="issue-77a47106"><a class="self-link" href="#issue-77a47106"></a> Identify a normative reference for <i>terminates</i>. </aside>
    <ol>
     <li data-md>
      <p>For each <a data-link-type="dfn" href="#lock-request" id="ref-for-lock-request⑦">lock request</a> <var>request</var> with <a data-link-type="dfn" href="#lock-request-agent" id="ref-for-lock-request-agent">agent</a> equal to the terminating agent:</p>
      <ol>
       <li data-md>
        <p><a data-link-type="dfn" href="#abort-the-request" id="ref-for-abort-the-request">Abort the request</a> <var>request</var>.</p>
      </ol>
     <li data-md>
      <p>For each <a data-link-type="dfn" href="#lock-concept" id="ref-for-lock-concept①④">lock</a> <var>lock</var> with <a data-link-type="dfn" href="#lock-concept-agent" id="ref-for-lock-concept-agent">agent</a> equal to the terminating agent:</p>
      <ol>
       <li data-md>
        <p><a data-link-type="dfn" href="#release-the-lock" id="ref-for-release-the-lock①">Release the lock</a> <var>lock</var>.</p>
      </ol>
    </ol>
   </div>
   <h2 class="heading settled" data-level="3" id="api"><span class="secno">3. </span><span class="content">API</span><a class="self-link" href="#api"></a></h2>
   <h3 class="heading settled" data-level="3.1" id="navigator-mixins"><span class="secno">3.1. </span><span class="content">Navigator Mixins</span><a class="self-link" href="#navigator-mixins"></a></h3>
<pre class="idl highlight def">[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#SecureContext" id="ref-for-SecureContext"><c- g>SecureContext</c-></a>]
<c- b>interface</c-> <c- b>mixin</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="interface" data-export id="navigatorlocks"><code><c- g>NavigatorLocks</c-></code></dfn> {
  <c- b>readonly</c-> <c- b>attribute</c-> <a data-link-type="idl-name" href="#lockmanager" id="ref-for-lockmanager①"><c- n>LockManager</c-></a> <a class="idl-code" data-link-type="attribute" data-readonly data-type="LockManager" href="#dom-navigatorlocks-locks" id="ref-for-dom-navigatorlocks-locks"><c- g>locks</c-></a>;
};
<a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/system-state.html#navigator" id="ref-for-navigator"><c- n>Navigator</c-></a> <c- b>includes</c-> <a data-link-type="idl-name" href="#navigatorlocks" id="ref-for-navigatorlocks"><c- n>NavigatorLocks</c-></a>;
<a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/workers.html#workernavigator" id="ref-for-workernavigator"><c- n>WorkerNavigator</c-></a> <c- b>includes</c-> <a data-link-type="idl-name" href="#navigatorlocks" id="ref-for-navigatorlocks①"><c- n>NavigatorLocks</c-></a>;
</pre>
   <p>Each <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object" id="ref-for-environment-settings-object">environment settings object</a> has a <code class="idl"><a data-link-type="idl" href="#lockmanager" id="ref-for-lockmanager②">LockManager</a></code> object.</p>
   <p>The <dfn class="dfn-paneled idl-code" data-dfn-for="NavigatorLocks" data-dfn-type="attribute" data-export id="dom-navigatorlocks-locks"><code>locks</code></dfn> getter’s steps are to return <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this">this</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object" id="ref-for-relevant-settings-object">relevant settings object</a>'s <code class="idl"><a data-link-type="idl" href="#lockmanager" id="ref-for-lockmanager③">LockManager</a></code> object.</p>
   <h3 class="heading settled" data-level="3.2" id="api-lock-manager"><span class="secno">3.2. </span><span class="content"><code class="idl"><a data-link-type="idl" href="#lockmanager" id="ref-for-lockmanager④">LockManager</a></code> class</span><a class="self-link" href="#api-lock-manager"></a></h3>
<pre class="idl highlight def">[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#SecureContext" id="ref-for-SecureContext①"><c- g>SecureContext</c-></a>, <a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed" id="ref-for-Exposed"><c- g>Exposed</c-></a>=(<c- n>Window</c->,<c- n>Worker</c->)]
<c- b>interface</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="interface" data-export id="lockmanager"><code><c- g>LockManager</c-></code></dfn> {
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise" id="ref-for-idl-promise"><c- b>Promise</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-any" id="ref-for-idl-any"><c- b>any</c-></a>> <a class="idl-code" data-link-type="method" href="#dom-lockmanager-request" id="ref-for-dom-lockmanager-request①"><c- g>request</c-></a>(<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString" id="ref-for-idl-DOMString"><c- b>DOMString</c-></a> <dfn class="idl-code" data-dfn-for="LockManager/request(name, callback)" data-dfn-type="argument" data-export id="dom-lockmanager-request-name-callback-name"><code><c- g>name</c-></code><a class="self-link" href="#dom-lockmanager-request-name-callback-name"></a></dfn>,
                       <a data-link-type="idl-name" href="#callbackdef-lockgrantedcallback" id="ref-for-callbackdef-lockgrantedcallback"><c- n>LockGrantedCallback</c-></a> <dfn class="idl-code" data-dfn-for="LockManager/request(name, callback)" data-dfn-type="argument" data-export id="dom-lockmanager-request-name-callback-callback"><code><c- g>callback</c-></code><a class="self-link" href="#dom-lockmanager-request-name-callback-callback"></a></dfn>);
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise" id="ref-for-idl-promise①"><c- b>Promise</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-any" id="ref-for-idl-any①"><c- b>any</c-></a>> <a class="idl-code" data-link-type="method" href="#dom-lockmanager-request-name-options-callback" id="ref-for-dom-lockmanager-request-name-options-callback"><c- g>request</c-></a>(<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString" id="ref-for-idl-DOMString①"><c- b>DOMString</c-></a> <dfn class="idl-code" data-dfn-for="LockManager/request(name, options, callback)" data-dfn-type="argument" data-export id="dom-lockmanager-request-name-options-callback-name"><code><c- g>name</c-></code><a class="self-link" href="#dom-lockmanager-request-name-options-callback-name"></a></dfn>,
                       <a data-link-type="idl-name" href="#dictdef-lockoptions" id="ref-for-dictdef-lockoptions"><c- n>LockOptions</c-></a> <dfn class="idl-code" data-dfn-for="LockManager/request(name, options, callback)" data-dfn-type="argument" data-export id="dom-lockmanager-request-name-options-callback-options"><code><c- g>options</c-></code><a class="self-link" href="#dom-lockmanager-request-name-options-callback-options"></a></dfn>,
                       <a data-link-type="idl-name" href="#callbackdef-lockgrantedcallback" id="ref-for-callbackdef-lockgrantedcallback①"><c- n>LockGrantedCallback</c-></a> <dfn class="idl-code" data-dfn-for="LockManager/request(name, options, callback)" data-dfn-type="argument" data-export id="dom-lockmanager-request-name-options-callback-callback"><code><c- g>callback</c-></code><a class="self-link" href="#dom-lockmanager-request-name-options-callback-callback"></a></dfn>);

  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise" id="ref-for-idl-promise②"><c- b>Promise</c-></a>&lt;<a data-link-type="idl-name" href="#dictdef-lockmanagersnapshot" id="ref-for-dictdef-lockmanagersnapshot"><c- n>LockManagerSnapshot</c-></a>> <a class="idl-code" data-link-type="method" href="#dom-lockmanager-query" id="ref-for-dom-lockmanager-query"><c- g>query</c-></a>();
};

<c- b>callback</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="callback" data-export id="callbackdef-lockgrantedcallback"><code><c- g>LockGrantedCallback</c-></code></dfn> = <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise" id="ref-for-idl-promise③"><c- b>Promise</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-any" id="ref-for-idl-any②"><c- b>any</c-></a>> (<a data-link-type="idl-name" href="#lock" id="ref-for-lock"><c- n>Lock</c-></a>? <dfn class="idl-code" data-dfn-for="LockGrantedCallback" data-dfn-type="argument" data-export id="dom-lockgrantedcallback-lock"><code><c- g>lock</c-></code><a class="self-link" href="#dom-lockgrantedcallback-lock"></a></dfn>);

<c- b>enum</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="enum" data-export id="enumdef-lockmode"><code><c- g>LockMode</c-></code></dfn> { <dfn class="dfn-paneled idl-code" data-dfn-for="LockMode" data-dfn-type="enum-value" data-export id="dom-lockmode-shared"><code><c- s>"shared"</c-></code></dfn>, <dfn class="dfn-paneled idl-code" data-dfn-for="LockMode" data-dfn-type="enum-value" data-export id="dom-lockmode-exclusive"><code><c- s>"exclusive"</c-></code></dfn> };

<c- b>dictionary</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="dictionary" data-export id="dictdef-lockoptions"><code><c- g>LockOptions</c-></code></dfn> {
  <a data-link-type="idl-name" href="#enumdef-lockmode" id="ref-for-enumdef-lockmode"><c- n>LockMode</c-></a> <dfn class="dfn-paneled idl-code" data-default="&quot;exclusive&quot;" data-dfn-for="LockOptions" data-dfn-type="dict-member" data-export data-type="LockMode " id="dom-lockoptions-mode"><code><c- g>mode</c-></code></dfn> = "exclusive";
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-boolean" id="ref-for-idl-boolean"><c- b>boolean</c-></a> <dfn class="dfn-paneled idl-code" data-default="false" data-dfn-for="LockOptions" data-dfn-type="dict-member" data-export data-type="boolean " id="dom-lockoptions-ifavailable"><code><c- g>ifAvailable</c-></code></dfn> = <c- b>false</c->;
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-boolean" id="ref-for-idl-boolean①"><c- b>boolean</c-></a> <dfn class="dfn-paneled idl-code" data-default="false" data-dfn-for="LockOptions" data-dfn-type="dict-member" data-export data-type="boolean " id="dom-lockoptions-steal"><code><c- g>steal</c-></code></dfn> = <c- b>false</c->;
  <a data-link-type="idl-name" href="https://dom.spec.whatwg.org/#abortsignal" id="ref-for-abortsignal"><c- n>AbortSignal</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="LockOptions" data-dfn-type="dict-member" data-export data-type="AbortSignal " id="dom-lockoptions-signal"><code><c- g>signal</c-></code></dfn>;
};

<c- b>dictionary</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="dictionary" data-export id="dictdef-lockmanagersnapshot"><code><c- g>LockManagerSnapshot</c-></code></dfn> {
  <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#idl-sequence" id="ref-for-idl-sequence"><c- b>sequence</c-></a>&lt;<a data-link-type="idl-name" href="#dictdef-lockinfo" id="ref-for-dictdef-lockinfo"><c- n>LockInfo</c-></a>> <dfn class="idl-code" data-dfn-for="LockManagerSnapshot" data-dfn-type="dict-member" data-export data-type="sequence<LockInfo> " id="dom-lockmanagersnapshot-held"><code><c- g>held</c-></code><a class="self-link" href="#dom-lockmanagersnapshot-held"></a></dfn>;
  <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#idl-sequence" id="ref-for-idl-sequence①"><c- b>sequence</c-></a>&lt;<a data-link-type="idl-name" href="#dictdef-lockinfo" id="ref-for-dictdef-lockinfo①"><c- n>LockInfo</c-></a>> <dfn class="idl-code" data-dfn-for="LockManagerSnapshot" data-dfn-type="dict-member" data-export data-type="sequence<LockInfo> " id="dom-lockmanagersnapshot-pending"><code><c- g>pending</c-></code><a class="self-link" href="#dom-lockmanagersnapshot-pending"></a></dfn>;
};

<c- b>dictionary</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="dictionary" data-export id="dictdef-lockinfo"><code><c- g>LockInfo</c-></code></dfn> {
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString" id="ref-for-idl-DOMString②"><c- b>DOMString</c-></a> <dfn class="idl-code" data-dfn-for="LockInfo" data-dfn-type="dict-member" data-export data-type="DOMString " id="dom-lockinfo-name"><code><c- g>name</c-></code><a class="self-link" href="#dom-lockinfo-name"></a></dfn>;
  <a data-link-type="idl-name" href="#enumdef-lockmode" id="ref-for-enumdef-lockmode①"><c- n>LockMode</c-></a> <dfn class="idl-code" data-dfn-for="LockInfo" data-dfn-type="dict-member" data-export data-type="LockMode " id="dom-lockinfo-mode"><code><c- g>mode</c-></code><a class="self-link" href="#dom-lockinfo-mode"></a></dfn>;
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString" id="ref-for-idl-DOMString③"><c- b>DOMString</c-></a> <dfn class="idl-code" data-dfn-for="LockInfo" data-dfn-type="dict-member" data-export data-type="DOMString " id="dom-lockinfo-clientid"><code><c- g>clientId</c-></code><a class="self-link" href="#dom-lockinfo-clientid"></a></dfn>;
};
</pre>
   <p>A <code class="idl"><a data-link-type="idl" href="#lockmanager" id="ref-for-lockmanager⑤">LockManager</a></code> instance allows script to make <a data-link-type="dfn" href="#lock-request" id="ref-for-lock-request⑧">lock requests</a> and query
the state of the origin’s <a data-link-type="dfn" href="#lock-manager" id="ref-for-lock-manager①">lock manager</a>.</p>
   <h4 class="heading settled" data-level="3.2.1" id="api-lock-manager-request"><span class="secno">3.2.1. </span><span class="content">The <code class="idl"><a data-link-type="idl" href="#dom-lockmanager-request" id="ref-for-dom-lockmanager-request②">request()</a></code> method</span><a class="self-link" href="#api-lock-manager-request"></a></h4>
   <div class="domintro note" role="note">
    <dl>
     <dt data-md><var>promise</var> = navigator . locks . <code class="idl"><a data-link-type="idl" href="#dom-lockmanager-request" id="ref-for-dom-lockmanager-request③">request</a></code>(<var>name</var>, <var>callback</var>)
     <dt data-md><var>promise</var> = navigator . locks . <code class="idl"><a data-link-type="idl" href="#dom-lockmanager-request-name-options-callback" id="ref-for-dom-lockmanager-request-name-options-callback①">request</a></code>(<var>name</var>, <var>options</var>, <var>callback</var>)
     <dd data-md>
      <p>The <code class="idl"><a data-link-type="idl" href="#dom-lockmanager-request" id="ref-for-dom-lockmanager-request④">request()</a></code> method is called to request a lock.</p>
      <p>The <var>name</var> (initial argument) is a <a data-link-type="dfn" href="#resource-name" id="ref-for-resource-name④">resource name</a> string.</p>
      <p>The <var>callback</var> (final argument) is a <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#dfn-callback-function" id="ref-for-dfn-callback-function">callback function</a> invoked with the <code class="idl"><a data-link-type="idl" href="#lock" id="ref-for-lock①">Lock</a></code> when granted. This is specified by script, and is usually an <code>async</code> function. The lock is held until the callback function completes. If a non-async callback function is passed in, then it is automatically wrapped in a promise that resolves immediately, so the lock is only held for the duration of the synchronous callback.</p>
    </dl>
    <p>The returned <var>promise</var> resolves (or rejects) with the result of the callback after the lock is released, or rejects if the request is aborted.</p>
    <p>Example:</p>
<pre class="language-js highlight"><c- k>try</c-> <c- p>{</c->
  <c- a>const</c-> result <c- o>=</c-> <c- k>await</c-> navigator<c- p>.</c->locks<c- p>.</c->request<c- p>(</c-><c- t>'resource'</c-><c- p>,</c-> <c- k>async</c-> lock <c- p>=></c-> <c- p>{</c->
    <c- c1>// The lock is held here.</c->
    <c- k>await</c-> do_something<c- p>();</c->
    <c- k>await</c-> do_something_else<c- p>();</c->
    <c- k>return</c-> <c- u>"ok"</c-><c- p>;</c->
    <c- c1>// The lock will be released now.</c->
  <c- p>});</c->
  <c- c1>// |result| has the return value of the callback.</c->
<c- p>}</c-> <c- k>catch</c-> <c- p>(</c->ex<c- p>)</c-> <c- p>{</c->
  <c- c1>// if the callback threw, it will be caught here.</c->
<c- p>}</c->
</pre>
    <p>The lock will be released when the callback exits for any reason — either when the code returns, or if it throws.</p>
    <p>An <var>options</var> dictionary can be specified as a second argument; the <var>callback</var> argument is always last.</p>
    <dl>
     <dt data-md><var>options</var> . mode
     <dd data-md>
      <p>The <code class="idl"><a data-link-type="idl" href="#dom-lockoptions-mode" id="ref-for-dom-lockoptions-mode">mode</a></code> option can be "<code class="idl"><a data-link-type="idl" href="#dom-lockmode-exclusive" id="ref-for-dom-lockmode-exclusive⑦">exclusive</a></code>" (the default if not specified) or "<code class="idl"><a data-link-type="idl" href="#dom-lockmode-shared" id="ref-for-dom-lockmode-shared⑤">shared</a></code>".
Multiple tabs/workers can hold a lock for the same resource in "<code class="idl"><a data-link-type="idl" href="#dom-lockmode-shared" id="ref-for-dom-lockmode-shared⑥">shared</a></code>" mode, but only one tab/worker can hold a lock for the resource in "<code class="idl"><a data-link-type="idl" href="#dom-lockmode-exclusive" id="ref-for-dom-lockmode-exclusive⑧">exclusive</a></code>" mode.</p>
      <p>The most common use for this is to allow multiple readers to access a resource simultaneously but prevent changes.
Once reader locks are released a single exclusive writer can acquire the lock to make changes, followed by another exclusive writer or more shared readers.</p>
    </dl>
<pre class="language-js highlight"><c- k>await</c-> navigator<c- p>.</c->locks<c- p>.</c->request<c- p>(</c-><c- t>'resource'</c-><c- p>,</c-> <c- p>{</c->mode<c- o>:</c-> <c- t>'shared'</c-><c- p>},</c-> <c- k>async</c-> lock <c- p>=></c-> <c- p>{</c->
  <c- c1>// Lock is held here. Other contexts might also hold the lock in shared mode,</c->
  <c- c1>// but no other contexts will hold the lock in exclusive mode.</c->
<c- p>});</c->
</pre>
    <dl>
     <dt data-md><var>options</var> . ifAvailable
     <dd data-md>
      <p>If the <code class="idl"><a data-link-type="idl" href="#dom-lockoptions-ifavailable" id="ref-for-dom-lockoptions-ifavailable">ifAvailable</a></code> option is <code>true</code>, then the lock is only granted if it can be without additional waiting. Note that this is still not <em>synchronous</em>; in many user agents this will require cross-process communication to see if the lock can be granted. If the lock cannot be granted, the callback is invoked with <code>null</code>. (Since this is expected, the request is <em>not</em> rejected.)</p>
    </dl>
<pre class="language-js highlight"><c- k>await</c-> navigator<c- p>.</c->locks<c- p>.</c->request<c- p>(</c-><c- t>'resource'</c-><c- p>,</c-> <c- p>{</c->ifAvailable<c- o>:</c-> <c- kc>true</c-><c- p>},</c-> <c- k>async</c-> lock <c- p>=></c-> <c- p>{</c->
  <c- k>if</c-> <c- p>(</c-><c- o>!</c->lock<c- p>)</c-> <c- p>{</c->
    <c- c1>// Didn't get it. Maybe take appropriate action.</c->
    <c- k>return</c-><c- p>;</c->
  <c- p>}</c->
  <c- c1>// Lock is held here.</c->
<c- p>});</c->
</pre>
    <dl>
     <dt data-md><var>options</var> . signal
     <dd data-md>
      <p>The <code class="idl"><a data-link-type="idl" href="#dom-lockoptions-signal" id="ref-for-dom-lockoptions-signal">signal</a></code> option can be set to an <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#abortsignal" id="ref-for-abortsignal①">AbortSignal</a></code>. This allows aborting a lock request, for example if the request is not granted in a timely manner:</p>
    </dl>
<pre class="language-js highlight"><c- a>const</c-> controller <c- o>=</c-> <c- ow>new</c-> AbortController<c- p>();</c->
setTimeout<c- p>(()</c-> <c- p>=></c-> controller<c- p>.</c->abort<c- p>(),</c-> <c- mf>200</c-><c- p>);</c-> <c- c1>// Wait at most 200ms.</c->

<c- k>try</c-> <c- p>{</c->
  <c- k>await</c-> navigator<c- p>.</c->locks<c- p>.</c->request<c- p>(</c->
    <c- t>'resource'</c-><c- p>,</c-> <c- p>{</c->signal<c- o>:</c-> controller<c- p>.</c->signal<c- p>},</c-> <c- k>async</c-> lock <c- p>=></c-> <c- p>{</c->
      <c- c1>// Lock is held here.</c->
  <c- p>});</c->
  <c- c1>// Done with lock here.</c->
<c- p>}</c-> <c- k>catch</c-> <c- p>(</c->ex<c- p>)</c-> <c- p>{</c->
  <c- c1>// |ex| will be a DOMException with error name "AbortError" if timer fired.</c->
<c- p>}</c->
</pre>
    <p>If an abort is signalled before the lock is granted, then the request promise will reject with an <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#aborterror" id="ref-for-aborterror">AbortError</a></code>.
        Once the lock has been granted, the signal is ignored.</p>
    <dl>
     <dt data-md><var>options</var> . steal
     <dd data-md>
      <p>If the <code class="idl"><a data-link-type="idl" href="#dom-lockoptions-steal" id="ref-for-dom-lockoptions-steal">steal</a></code> option is <code>true</code>, then any held locks for the resource will be released (and the <a data-link-type="dfn" href="#lock-concept-released-promise" id="ref-for-lock-concept-released-promise④">released promise</a> of such locks will resolve with <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#aborterror" id="ref-for-aborterror①">AbortError</a></code>), and the request will be granted, preempting any queued requests for it.</p>
      <p>If a web application detects an unrecoverable state — for example, some coordination point like a Service Worker determines that a tab holding a lock is no longer responding — then it can "steal" a lock using this option.</p>
    </dl>
   </div>
   <aside class="advisement"> Use the <code class="idl"><a data-link-type="idl" href="#dom-lockoptions-steal" id="ref-for-dom-lockoptions-steal①">steal</a></code> option with caution.
    When used, code previously holding a lock will now be executing without guarantees that it is the sole context with access to the resource.
    Similarly, the code that used the option has no guarantees that other contexts will not still be executing as if they have access to the abstract resource.
    It is intended for use by web applications that need to attempt recovery in the face of application and/or user-agent defects, where behavior is already unpredictable. </aside>
   <div class="algorithm" data-algorithm="LockManager request method">
    <p>The <dfn class="dfn-paneled idl-code" data-dfn-for="LockManager" data-dfn-type="method" data-export id="dom-lockmanager-request"><code>request(<var>name</var>, <var>callback</var>)</code></dfn> and <dfn class="dfn-paneled idl-code" data-dfn-for="LockManager" data-dfn-type="method" data-export id="dom-lockmanager-request-name-options-callback"><code>request(<var>name</var>, <var>options</var>, <var>callback</var>)</code></dfn> method steps are:</p>
    <ol>
     <li data-md>
      <p>If <var>options</var> was not passed, then let <var>options</var> be a new <code class="idl"><a data-link-type="idl" href="#dictdef-lockoptions" id="ref-for-dictdef-lockoptions①">LockOptions</a></code> dictionary with default members.</p>
     <li data-md>
      <p>Let <var>environment</var> be <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this①">this</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object" id="ref-for-relevant-settings-object①">relevant settings object</a>.</p>
     <li data-md>
      <p>Let <var>origin</var> be <var>environment</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin" id="ref-for-concept-origin④">origin</a>.</p>
     <li data-md>
      <p>If <var>origin</var> is an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-opaque" id="ref-for-concept-origin-opaque">opaque origin</a>, then return <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#a-promise-rejected-with" id="ref-for-a-promise-rejected-with">a promise rejected with</a> a "<code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#securityerror" id="ref-for-securityerror">SecurityError</a></code>" <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException">DOMException</a></code>.</p>
     <li data-md>
      <p>If <var>name</var> starts with U+002D HYPHEN-MINUS (-), then return <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#a-promise-rejected-with" id="ref-for-a-promise-rejected-with①">a promise rejected with</a> a "<code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#notsupportederror" id="ref-for-notsupportederror">NotSupportedError</a></code>" <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException①">DOMException</a></code>.</p>
     <li data-md>
      <p>If both <var>options</var>’ <code>steal</code> dictionary member and <var>options</var>’ <code>ifAvailable</code> dictionary member are true, then return <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#a-promise-rejected-with" id="ref-for-a-promise-rejected-with②">a promise rejected with</a> a "<code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#notsupportederror" id="ref-for-notsupportederror①">NotSupportedError</a></code>" <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException②">DOMException</a></code>.</p>
     <li data-md>
      <p>If <var>options</var>’ <code>steal</code> dictionary member is true and <var>options</var>’ <code>mode</code> dictionary member is not "<code class="idl"><a data-link-type="idl" href="#dom-lockmode-exclusive" id="ref-for-dom-lockmode-exclusive⑨">exclusive</a></code>", then return <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#a-promise-rejected-with" id="ref-for-a-promise-rejected-with③">a promise rejected with</a> a "<code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#notsupportederror" id="ref-for-notsupportederror②">NotSupportedError</a></code>" <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException③">DOMException</a></code>.</p>
     <li data-md>
      <p>If <var>options</var>’ <code>signal</code> dictionary member is present, and either of <var>options</var>’ <code>steal</code> dictionary member or <var>options</var>’ <code>ifAvailable</code> dictionary member is true, then return <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#a-promise-rejected-with" id="ref-for-a-promise-rejected-with④">a promise rejected with</a> a "<code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#notsupportederror" id="ref-for-notsupportederror③">NotSupportedError</a></code>" <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException④">DOMException</a></code>.</p>
     <li data-md>
      <p>If <var>options</var>’ <code>signal</code> dictionary member is present and its <a data-link-type="dfn">aborted flag</a> is set, then return <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#a-promise-rejected-with" id="ref-for-a-promise-rejected-with⑤">a promise rejected with</a> an "<code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#aborterror" id="ref-for-aborterror②">AbortError</a></code>" {{DOMException}.</p>
     <li data-md>
      <p>Let <var>promise</var> be <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#a-new-promise" id="ref-for-a-new-promise">a new promise</a>.</p>
     <li data-md>
      <p>Let <var>request</var> be the result of running the steps to <a data-link-type="dfn" href="#request-a-lock" id="ref-for-request-a-lock">request a lock</a> with <var>promise</var>, the current <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#agent" id="ref-for-agent⑤">agent</a>, <var>environment</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-id" id="ref-for-concept-environment-id">id</a>, <var>origin</var>, <var>callback</var>, <var>name</var>, <var>options</var>’ <code>mode</code> dictionary member, <var>options</var>’ <code>ifAvailable</code> dictionary member, and <var>options</var>’ <code>steal</code> dictionary member.</p>
     <li data-md>
      <p>If <var>options</var>’ <code>signal</code> dictionary member is present, then <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#abortsignal-add" id="ref-for-abortsignal-add">add the following abort steps</a> to <var>options</var>’ <code>signal</code> dictionary member:</p>
      <ol>
       <li data-md>
        <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#enqueue-the-following-steps" id="ref-for-enqueue-the-following-steps③">Enqueue the steps</a> to <a data-link-type="dfn" href="#abort-the-request" id="ref-for-abort-the-request①">abort the request</a> <var>request</var> to the <a data-link-type="dfn" href="#lock-task-queue" id="ref-for-lock-task-queue②">lock task queue</a>.</p>
       <li data-md>
        <p><a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#reject" id="ref-for-reject">Reject</a> <var>promise</var> with an "<code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#aborterror" id="ref-for-aborterror③">AbortError</a></code>" <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException⑤">DOMException</a></code>.</p>
      </ol>
     <li data-md>
      <p>Return <var>promise</var>.</p>
    </ol>
   </div>
   <h4 class="heading settled" data-level="3.2.2" id="api-lock-manager-query"><span class="secno">3.2.2. </span><span class="content">The <code class="idl"><a data-link-type="idl" href="#dom-lockmanager-query" id="ref-for-dom-lockmanager-query①">query()</a></code> method</span><a class="self-link" href="#api-lock-manager-query"></a></h4>
   <div class="domintro note" role="note">
    <dl>
     <dt data-md><var>state</var> = await navigator . locks . <code class="idl"><a data-link-type="idl" href="#dom-lockmanager-query" id="ref-for-dom-lockmanager-query②">query</a></code>()
     <dd data-md>
      <p>The <code class="idl"><a data-link-type="idl" href="#dom-lockmanager-query" id="ref-for-dom-lockmanager-query③">query()</a></code> method can be used to produce a snapshot of the <a data-link-type="dfn" href="#lock-manager" id="ref-for-lock-manager②">lock manager</a> state for an origin, which allows a web application to introspect its usage of locks, for logging or debugging purposes.</p>
      <p>The returned promise resolves to <var>state</var>, a plain-old-data structure (i.e. JSON-like data) with this form:</p>
    </dl>
<pre class="language-js highlight"><c- p>{</c->
  held<c- o>:</c-> <c- p>[</c->
    <c- p>{</c-> name<c- o>:</c-> <c- u>"resource1"</c-><c- p>,</c-> mode<c- o>:</c-> <c- u>"exclusive"</c-><c- p>,</c->
      clientId<c- o>:</c-> <c- u>"8b1e730c-7405-47db-9265-6ee7c73ac153"</c-> <c- p>},</c->
    <c- p>{</c-> name<c- o>:</c-> <c- u>"resource2"</c-><c- p>,</c-> mode<c- o>:</c-> <c- u>"shared"</c-><c- p>,</c->
      clientId<c- o>:</c-> <c- u>"8b1e730c-7405-47db-9265-6ee7c73ac153"</c-> <c- p>},</c->
    <c- p>{</c-> name<c- o>:</c-> <c- u>"resource2"</c-><c- p>,</c-> mode<c- o>:</c-> <c- u>"shared"</c-><c- p>,</c->
      clientId<c- o>:</c-> <c- u>"fad203a5-1f31-472b-a7f7-a3236a1f6d3b"</c-> <c- p>},</c->
  <c- p>],</c->
  pending<c- o>:</c-> <c- p>[</c->
    <c- p>{</c-> name<c- o>:</c-> <c- u>"resource1"</c-><c- p>,</c-> mode<c- o>:</c-> <c- u>"exclusive"</c-><c- p>,</c->
      clientId<c- o>:</c-> <c- u>"fad203a5-1f31-472b-a7f7-a3236a1f6d3b"</c-> <c- p>},</c->
    <c- p>{</c-> name<c- o>:</c-> <c- u>"resource1"</c-><c- p>,</c-> mode<c- o>:</c-> <c- u>"exclusive"</c-><c- p>,</c->
      clientId<c- o>:</c-> <c- u>"d341a5d0-1d8d-4224-be10-704d1ef92a15"</c-> <c- p>},</c->
  <c- p>]</c->
<c- p>}</c->
</pre>
    <p>The <code>clientId</code> field corresponds to a unique context (frame or worker), and is the same value returned by <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/ServiceWorker/#client" id="ref-for-client">Client</a></code>'s <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/ServiceWorker/#dom-client-id" id="ref-for-dom-client-id">id</a></code> attribute.</p>
   </div>
   <aside class="advisement"> This data is just a <em>snapshot</em> of the <a data-link-type="dfn" href="#lock-manager" id="ref-for-lock-manager③">lock manager</a> state at some point in time. By the time the data is returned to script, the actual lock state might have changed. </aside>
   <div class="algorithm" data-algorithm="query()" data-algorithm-for="LockManager">
    <p>The <dfn class="dfn-paneled idl-code" data-dfn-for="LockManager" data-dfn-type="method" data-export id="dom-lockmanager-query"><code>query()</code></dfn> method steps are:</p>
    <ol>
     <li data-md>
      <p>Let <var>origin</var> be <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this②">this</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object" id="ref-for-relevant-settings-object②">relevant settings object</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin" id="ref-for-concept-origin⑤">origin</a>.</p>
     <li data-md>
      <p>If <var>origin</var> is an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-opaque" id="ref-for-concept-origin-opaque①">opaque origin</a>, then return <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#a-promise-rejected-with" id="ref-for-a-promise-rejected-with⑥">a promise rejected with</a> a "<code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#securityerror" id="ref-for-securityerror①">SecurityError</a></code>" <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException⑥">DOMException</a></code>.</p>
     <li data-md>
      <p>Let <var>promise</var> be <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#a-new-promise" id="ref-for-a-new-promise①">a new promise</a>.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#enqueue-the-following-steps" id="ref-for-enqueue-the-following-steps④">Enqueue the steps</a> to <a data-link-type="dfn" href="#snapshot-the-lock-state" id="ref-for-snapshot-the-lock-state">snapshot the lock state</a> for <var>origin</var> with <var>promise</var> to the <a data-link-type="dfn" href="#lock-task-queue" id="ref-for-lock-task-queue③">lock task queue</a>.</p>
     <li data-md>
      <p>Return <var>promise</var>.</p>
    </ol>
   </div>
   <h3 class="heading settled" data-level="3.3" id="api-lock"><span class="secno">3.3. </span><span class="content"><code class="idl"><a data-link-type="idl" href="#lock" id="ref-for-lock②">Lock</a></code> class</span><a class="self-link" href="#api-lock"></a></h3>
<pre class="idl highlight def">[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#SecureContext" id="ref-for-SecureContext②"><c- g>SecureContext</c-></a>, <a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed" id="ref-for-Exposed①"><c- g>Exposed</c-></a>=(<c- n>Window</c->,<c- n>Worker</c->)]
<c- b>interface</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="interface" data-export id="lock"><code><c- g>Lock</c-></code></dfn> {
  <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString" id="ref-for-idl-DOMString④"><c- b>DOMString</c-></a> <a class="idl-code" data-link-type="attribute" data-readonly data-type="DOMString" href="#dom-lock-name" id="ref-for-dom-lock-name"><c- g>name</c-></a>;
  <c- b>readonly</c-> <c- b>attribute</c-> <a data-link-type="idl-name" href="#enumdef-lockmode" id="ref-for-enumdef-lockmode②"><c- n>LockMode</c-></a> <a class="idl-code" data-link-type="attribute" data-readonly data-type="LockMode" href="#dom-lock-mode" id="ref-for-dom-lock-mode"><c- g>mode</c-></a>;
};
</pre>
   <p>A <code class="idl"><a data-link-type="idl" href="#lock" id="ref-for-lock③">Lock</a></code> object has an associated <a data-link-type="dfn" href="#lock-concept" id="ref-for-lock-concept①⑤">lock</a>.</p>
   <p>The <dfn class="dfn-paneled idl-code" data-dfn-for="Lock" data-dfn-type="attribute" data-export id="dom-lock-name"><code>name</code></dfn> getter’s steps are to return the associated <a data-link-type="dfn" href="#lock-concept" id="ref-for-lock-concept①⑥">lock</a>'s <a data-link-type="dfn" href="#lock-concept-name" id="ref-for-lock-concept-name②">name</a>.</p>
   <p>The <dfn class="dfn-paneled idl-code" data-dfn-for="Lock" data-dfn-type="attribute" data-export id="dom-lock-mode"><code>mode</code></dfn> getter’s steps are to return the associated <a data-link-type="dfn" href="#lock-concept" id="ref-for-lock-concept①⑦">lock</a>'s <a data-link-type="dfn" href="#lock-concept-mode" id="ref-for-lock-concept-mode①">mode</a>.</p>
   <h2 class="heading settled" data-level="4" id="algorithms"><span class="secno">4. </span><span class="content">Algorithms</span><a class="self-link" href="#algorithms"></a></h2>
   <h3 class="heading settled" data-level="4.1" id="algorithm-request-lock"><span class="secno">4.1. </span><span class="content">Request a lock</span><a class="self-link" href="#algorithm-request-lock"></a></h3>
   <div class="algorithm" data-algorithm="request a lock">
     To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="request-a-lock">request a lock</dfn> with <var>promise</var>, <var>agent</var>, <var>clientId</var>, <var>origin</var>, <var>callback</var>, <var>name</var>, <var>mode</var>, <var>ifAvailable</var> and <var>steal</var>: 
    <ol>
     <li data-md>
      <p>Let <var>request</var> be a new <a data-link-type="dfn" href="#lock-request" id="ref-for-lock-request⑨">lock request</a> (<var>agent</var>, <var>clientId</var>, <var>origin</var>, <var>name</var>, <var>mode</var>, <var>promise</var>).</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#enqueue-the-following-steps" id="ref-for-enqueue-the-following-steps⑤">Enqueue the following steps</a> to the <a data-link-type="dfn" href="#lock-task-queue" id="ref-for-lock-task-queue④">lock task queue</a>:</p>
      <ol>
       <li data-md>
        <p>Let <var>queueMap</var> be <var>origin</var>’s <a data-link-type="dfn" href="#lock-request-lock-request-queue-map" id="ref-for-lock-request-lock-request-queue-map①">lock request queue map</a>.</p>
       <li data-md>
        <p>Let <var>queue</var> be <var>queueMap</var>[<var>name</var>].</p>
       <li data-md>
        <p>Let <var>held</var> be <var>origin</var>’s <a data-link-type="dfn" href="#lock-concept-held-lock-set" id="ref-for-lock-concept-held-lock-set①">held lock set</a>.</p>
       <li data-md>
        <p>If <var>steal</var> is true, then run these steps:</p>
        <ol>
         <li data-md>
          <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-iterate" id="ref-for-list-iterate">For each</a> <var>lock</var> of <var>held</var>:</p>
          <ol>
           <li data-md>
            <p>If <var>lock</var>’s <a data-link-type="dfn" href="#lock-concept-name" id="ref-for-lock-concept-name③">name</a> is <var>name</var>, then run these steps:</p>
            <ol>
             <li data-md>
              <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-remove" id="ref-for-list-remove">Remove</a> <a data-link-type="dfn" href="#lock-concept" id="ref-for-lock-concept①⑧">lock</a> from <var>held</var>.</p>
             <li data-md>
              <p><a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#reject" id="ref-for-reject①">Reject</a> <var>lock</var>’s <a data-link-type="dfn" href="#lock-concept-released-promise" id="ref-for-lock-concept-released-promise⑤">released promise</a> with an "<code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#aborterror" id="ref-for-aborterror④">AbortError</a></code>" <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException⑦">DOMException</a></code>.</p>
            </ol>
          </ol>
         <li data-md>
          <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-prepend" id="ref-for-list-prepend">Prepend</a> <var>request</var> in <var>queue</var>.</p>
        </ol>
       <li data-md>
        <p>Otherwise, run these steps:</p>
        <ol>
         <li data-md>
          <p>If <var>ifAvailable</var> is true and <var>request</var> is not <a data-link-type="dfn" href="#lock-request-grantable" id="ref-for-lock-request-grantable">grantable</a>,
 then <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#enqueue-the-following-steps" id="ref-for-enqueue-the-following-steps⑥">enqueue the following steps</a> on <var>callback</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object" id="ref-for-relevant-settings-object③">relevant settings object</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#responsible-event-loop" id="ref-for-responsible-event-loop">responsible event loop</a>:</p>
          <ol>
           <li data-md>
            <p>Let <var>r</var> be the result of <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#invoke-a-callback-function" id="ref-for-invoke-a-callback-function">invoking</a> <var>callback</var> with <code>null</code> as the only argument.</p>
           <li data-md>
            <p><a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#resolve" id="ref-for-resolve①">Resolve</a> <var>promise</var> with <var>r</var> and abort these steps.</p>
          </ol>
         <li data-md>
          <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#queue-enqueue" id="ref-for-queue-enqueue">Enqueue</a> <var>request</var> in <var>queue</var>.</p>
        </ol>
       <li data-md>
        <p><a data-link-type="dfn" href="#process-the-lock-request-queue" id="ref-for-process-the-lock-request-queue">Process the lock request queue</a> <var>queue</var>.</p>
      </ol>
     <li data-md>
      <p>Return <var>request</var>.</p>
    </ol>
   </div>
   <h3 class="heading settled" data-level="4.2" id="algorithm-release-lock"><span class="secno">4.2. </span><span class="content">Release a lock</span><a class="self-link" href="#algorithm-release-lock"></a></h3>
   <div class="algorithm" data-algorithm="release the lock">
     To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="release-the-lock">release the lock</dfn> <var>lock</var>: 
    <ol>
     <li data-md>
      <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#assert" id="ref-for-assert">Assert</a>: these steps are running on the <a data-link-type="dfn" href="#lock-task-queue" id="ref-for-lock-task-queue⑤">lock task queue</a>.</p>
     <li data-md>
      <p>Let <var>origin</var> be <var>lock</var>’s <a data-link-type="dfn" href="#lock-concept-origin" id="ref-for-lock-concept-origin">origin</a>.</p>
     <li data-md>
      <p>Let <var>queueMap</var> be <var>origin</var>’s <a data-link-type="dfn" href="#lock-request-lock-request-queue-map" id="ref-for-lock-request-lock-request-queue-map②">lock request queue map</a>.</p>
     <li data-md>
      <p>Let <var>name</var> be <var>lock</var>’s <a data-link-type="dfn" href="#resource-name" id="ref-for-resource-name⑤">resource name</a>.</p>
     <li data-md>
      <p>Let <var>queue</var> be <var>queueMap</var>[<var>name</var>].</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-remove" id="ref-for-list-remove①">Remove</a> <a data-link-type="dfn" href="#lock-concept" id="ref-for-lock-concept①⑨">lock</a> from the <var>origin</var>’s <a data-link-type="dfn" href="#lock-concept-held-lock-set" id="ref-for-lock-concept-held-lock-set②">held lock set</a>.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="#process-the-lock-request-queue" id="ref-for-process-the-lock-request-queue①">Process the lock request queue</a> <var>queue</var>.</p>
    </ol>
   </div>
   <h3 class="heading settled" data-level="4.3" id="algorithm-abort-request"><span class="secno">4.3. </span><span class="content">Abort a request</span><a class="self-link" href="#algorithm-abort-request"></a></h3>
   <div class="algorithm" data-algorithm="abort the request">
     To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="abort-the-request">abort the request</dfn> <var>request</var>: 
    <ol>
     <li data-md>
      <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#assert" id="ref-for-assert①">Assert</a>: these steps are running on the <a data-link-type="dfn" href="#lock-task-queue" id="ref-for-lock-task-queue⑥">lock task queue</a>.</p>
     <li data-md>
      <p>Let <var>origin</var> be <var>request</var>’s <a data-link-type="dfn" href="#lock-request-origin" id="ref-for-lock-request-origin①">origin</a>.</p>
     <li data-md>
      <p>Let <var>name</var> be <var>request</var>’s <a data-link-type="dfn" href="#lock-request-name" id="ref-for-lock-request-name①">name</a>.</p>
     <li data-md>
      <p>Let <var>queueMap</var> be <var>origin</var>’s <a data-link-type="dfn" href="#lock-request-lock-request-queue-map" id="ref-for-lock-request-lock-request-queue-map③">lock request queue map</a>.</p>
     <li data-md>
      <p>Let <var>queue</var> be <var>queueMap</var>[<var>name</var>].</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-remove" id="ref-for-list-remove②">Remove</a> <var>request</var> from <var>queue</var>.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="#process-the-lock-request-queue" id="ref-for-process-the-lock-request-queue②">Process the lock request queue</a> <var>queue</var>.</p>
    </ol>
   </div>
   <h3 class="heading settled" data-level="4.4" id="algorithm-process-request"><span class="secno">4.4. </span><span class="content">Process a lock request queue for a given resource name</span><a class="self-link" href="#algorithm-process-request"></a></h3>
   <div class="algorithm" data-algorithm="process the lock request queue">
     To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="process-the-lock-request-queue">process the lock request queue</dfn> <var>queue</var>: 
    <ol>
     <li data-md>
      <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#assert" id="ref-for-assert②">Assert</a>: these steps are running on the <a data-link-type="dfn" href="#lock-task-queue" id="ref-for-lock-task-queue⑦">lock task queue</a>.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-iterate" id="ref-for-list-iterate①">For each</a> <var>request</var> of <var>queue</var>:</p>
      <ol>
       <li data-md>
        <p>If <var>request</var> is <a data-link-type="dfn" href="#lock-request-grantable" id="ref-for-lock-request-grantable①">grantable</a>, then run these steps:</p>
        <ol>
         <li data-md>
          <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-remove" id="ref-for-list-remove③">Remove</a> <var>request</var> from <var>queue</var>.</p>
         <li data-md>
          <p>Let <var>agent</var> be <var>request</var>’s <a data-link-type="dfn" href="#lock-concept-agent" id="ref-for-lock-concept-agent①">agent</a></p>
         <li data-md>
          <p>Let <var>clientId</var> be <var>request</var>’s <a data-link-type="dfn" href="#lock-request-clientid" id="ref-for-lock-request-clientid">clientId</a>.</p>
         <li data-md>
          <p>Let <var>name</var> be <var>request</var>’s <a data-link-type="dfn" href="#lock-request-name" id="ref-for-lock-request-name②">name</a>.</p>
         <li data-md>
          <p>Let <var>mode</var> be <var>request</var>’s <a data-link-type="dfn" href="#lock-request-mode" id="ref-for-lock-request-mode①">mode</a>.</p>
         <li data-md>
          <p>Let <var>p</var> be <var>request</var>’s <a data-link-type="dfn" href="#lock-request-promise" id="ref-for-lock-request-promise">promise</a>.</p>
         <li data-md>
          <p>Let <var>waiting</var> be <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#a-new-promise" id="ref-for-a-new-promise②">a new promise</a>.</p>
         <li data-md>
          <p>Let <var>lock</var> be a new <a data-link-type="dfn" href="#lock-concept" id="ref-for-lock-concept②⓪">lock</a> with <a data-link-type="dfn" href="#lock-concept-agent" id="ref-for-lock-concept-agent②">agent</a> <var>agent</var>, <a data-link-type="dfn" href="#lock-concept-clientid" id="ref-for-lock-concept-clientid">clientId</a> <var>clientId</var>, <a data-link-type="dfn" href="#lock-concept-origin" id="ref-for-lock-concept-origin①">origin</a> <var>origin</var>, <a data-link-type="dfn" href="#lock-concept-mode" id="ref-for-lock-concept-mode②">mode</a> <var>mode</var>, <a data-link-type="dfn" href="#lock-concept-name" id="ref-for-lock-concept-name④">name</a> <var>name</var>, <a data-link-type="dfn" href="#lock-concept-released-promise" id="ref-for-lock-concept-released-promise⑥">released promise</a> <var>p</var>, and <a data-link-type="dfn" href="#lock-concept-waiting-promise" id="ref-for-lock-concept-waiting-promise⑤">waiting promise</a> <var>waiting</var>.</p>
         <li data-md>
          <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#set-append" id="ref-for-set-append">Append</a> <var>lock</var> to <var>origin</var>’s <a data-link-type="dfn" href="#lock-concept-held-lock-set" id="ref-for-lock-concept-held-lock-set③">held lock set</a>.</p>
         <li data-md>
          <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#enqueue-the-following-steps" id="ref-for-enqueue-the-following-steps⑦">Enqueue the following steps</a> on <var>callback</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object" id="ref-for-relevant-settings-object④">relevant settings object</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#responsible-event-loop" id="ref-for-responsible-event-loop①">responsible event loop</a>:</p>
          <ol>
           <li data-md>
            <p>Let <var>r</var> be the result of <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#invoke-a-callback-function" id="ref-for-invoke-a-callback-function①">invoking</a> <var>callback</var> with a new <code class="idl"><a data-link-type="idl" href="#lock" id="ref-for-lock④">Lock</a></code> object associated with <var>lock</var> as the only argument.</p>
           <li data-md>
            <p><a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#resolve" id="ref-for-resolve②">Resolve</a> <var>waiting</var> with <var>r</var>.</p>
          </ol>
        </ol>
      </ol>
    </ol>
   </div>
   <h3 class="heading settled" data-level="4.5" id="algorithm-snapshot-state"><span class="secno">4.5. </span><span class="content">Snapshot the lock state</span><a class="self-link" href="#algorithm-snapshot-state"></a></h3>
   <div class="algorithm" data-algorithm="snapshot the lock state">
     To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="snapshot-the-lock-state">snapshot the lock state</dfn> for <var>origin</var> with <var>promise</var>: 
    <ol>
     <li data-md>
      <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#assert" id="ref-for-assert③">Assert</a>: these steps are running on the <a data-link-type="dfn" href="#lock-task-queue" id="ref-for-lock-task-queue⑧">lock task queue</a>.</p>
     <li data-md>
      <p>Let <var>pending</var> be a new <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list">list</a>.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-iterate" id="ref-for-map-iterate">For each</a> <var>queue</var> of <var>origin</var>’s <a data-link-type="dfn" href="#lock-request-lock-request-queue-map" id="ref-for-lock-request-lock-request-queue-map④">lock request queue map</a>'s <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-getting-the-values" id="ref-for-map-getting-the-values">values</a>:</p>
      <ol>
       <li data-md>
        <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-iterate" id="ref-for-list-iterate②">For each</a> <var>request</var> of <var>queue</var>:</p>
        <ol>
         <li data-md>
          <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-append" id="ref-for-list-append">Append</a> «[ "name" → <var>request</var>’s <a data-link-type="dfn" href="#lock-request-name" id="ref-for-lock-request-name③">name</a>, "mode" → <var>request</var>’s <a data-link-type="dfn" href="#lock-request-mode" id="ref-for-lock-request-mode②">mode</a>, "clientId" → <var>request</var>’s <a data-link-type="dfn" href="#lock-request-clientid" id="ref-for-lock-request-clientid①">clientId</a> ]» to <var>pending</var>.</p>
        </ol>
      </ol>
     <li data-md>
      <p>Let <var>held</var> be a new <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list①">list</a>.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-iterate" id="ref-for-list-iterate③">For each</a> <var>lock</var> of <var>origin</var>’s <a data-link-type="dfn" href="#lock-concept-held-lock-set" id="ref-for-lock-concept-held-lock-set④">held lock set</a>:</p>
      <ol>
       <li data-md>
        <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-append" id="ref-for-list-append①">Append</a> «[ "name" → <var>lock</var>’s <a data-link-type="dfn" href="#lock-concept-name" id="ref-for-lock-concept-name⑤">name</a>, "mode" → <var>lock</var>’s <a data-link-type="dfn" href="#lock-concept-mode" id="ref-for-lock-concept-mode③">mode</a>, "clientId" → <var>lock</var>’s <a data-link-type="dfn" href="#lock-concept-clientid" id="ref-for-lock-concept-clientid①">clientId</a> ]» to <var>held</var>.</p>
      </ol>
     <li data-md>
      <p><a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#resolve" id="ref-for-resolve③">Resolve</a> <var>promise</var> with «[ "held" → <var>held</var>, "pending" → <var>pending</var> ]».</p>
    </ol>
   </div>
   <aside class="note">
    <p> For any given resource, the snapshot of the pending lock requests
    will return the requests in the order in which they were made;
    however, no guarantees are made with respect to the relative
    ordering of requests across different resources. For example, if
    pending lock requests A1 and A2 are made against resource A in
    that order, and pending lock requests B1 and B2 are made against
    resource B in that order, than both «A1, A2, B1, B2» and «A1, B1,
    A2, B2» would be possible orderings for a snapshot’s pending list. </p>
    <p> No ordering guarantees exist for the snapshot of the held lock state. </p>
   </aside>
   <h2 class="heading settled" data-level="5" id="usage-considerations"><span class="secno">5. </span><span class="content">Usage Considerations</span><a class="self-link" href="#usage-considerations"></a></h2>
   <p><em>This section is non-normative.</em></p>
   <h3 class="heading settled" data-level="5.1" id="deadlocks"><span class="secno">5.1. </span><span class="content">Deadlocks</span><a class="self-link" href="#deadlocks"></a></h3>
   <p><a href="https://en.wikipedia.org/wiki/Deadlock">Deadlocks</a> are a concept in concurrent computing, and deadlocks scoped to a particular <a data-link-type="dfn" href="#lock-manager" id="ref-for-lock-manager④">lock manager</a> can be introduced by this API.</p>
   <aside class="example" id="example-deadlocks">
    <a class="self-link" href="#example-deadlocks"></a> An example of how deadlocks can be encountered through the use of this API is as follows. 
    <p>Script 1:</p>
<pre class="language-js highlight">navigator<c- p>.</c->locks<c- p>.</c->request<c- p>(</c-><c- t>'A'</c-><c- p>,</c-> <c- k>async</c-> a <c- p>=></c-> <c- p>{</c->
  <c- k>await</c-> navigator<c- p>.</c->locks<c- p>.</c->request<c- p>(</c-><c- t>'B'</c-><c- p>,</c-> <c- k>async</c-> b <c- p>=></c-> <c- p>{</c->
    <c- c1>// do stuff with A and B</c->
  <c- p>});</c->
<c- p>});</c->
</pre>
    <p>Script 2:</p>
<pre class="language-js highlight">navigator<c- p>.</c->locks<c- p>.</c->request<c- p>(</c-><c- t>'B'</c-><c- p>,</c-> <c- k>async</c-> b <c- p>=></c-> <c- p>{</c->
  <c- k>await</c-> navigator<c- p>.</c->locks<c- p>.</c->request<c- p>(</c-><c- t>'A'</c-><c- p>,</c-> <c- k>async</c-> a <c- p>=></c-> <c- p>{</c->
    <c- c1>// do stuff with A and B</c->
  <c- p>});</c->
<c- p>});</c->
</pre>
    <p>If script 1 and script 2 run close to the same time, there is a chance that script 1 will hold lock A and script 2 will hold lock B and neither can make further progress - a deadlock. This will not affect the user agent as a whole, pause the tab, or affect other script in the origin, but this particular functionality will be blocked.</p>
   </aside>
   <p>Preventing deadlocks requires care. One approach is to always acquire multiple locks in a strict order.</p>
   <aside class="example" id="example-request-multiple-locks">
    <a class="self-link" href="#example-request-multiple-locks"></a> 
    <p>A helper function such as the following could be used to request multiple locks in a consistent order.</p>
<pre class="language-js highlight"><c- k>async</c-> <c- a>function</c-> requestMultiple<c- p>(</c->resources<c- p>,</c-> callback<c- p>)</c-> <c- p>{</c->
  <c- a>const</c-> sortedResources <c- o>=</c-> <c- p>[...</c->resources<c- p>];</c->
  sortedResources<c- p>.</c->sort<c- p>();</c-> <c- c1>// Always request in the same order.</c->

  <c- k>async</c-> <c- a>function</c-> requestNext<c- p>(</c->locks<c- p>)</c-> <c- p>{</c->
    <c- k>return</c-> <c- k>await</c-> navigator<c- p>.</c->locks<c- p>.</c->request<c- p>(</c->sortedResources<c- p>.</c->shift<c- p>(),</c-> <c- k>async</c-> lock <c- p>=></c-> <c- p>{</c->
      <c- c1>// Now holding this lock, plus all previously requested locks.</c->
      locks<c- p>.</c->push<c- p>(</c->lock<c- p>);</c->

      <c- c1>// Recursively request the next lock in order if needed.</c->
      <c- k>if</c-> <c- p>(</c->sortedResources<c- p>.</c->length <c- o>></c-> <c- mf>0</c-><c- p>)</c->
        <c- k>return</c-> <c- k>await</c-> requestNext<c- p>(</c->locks<c- p>);</c->

      <c- c1>// Otherwise, run the callback.</c->
      <c- k>return</c-> <c- k>await</c-> callback<c- p>(</c->locks<c- p>);</c->

      <c- c1>// All locks will be released when the callback returns (or throws).</c->
    <c- p>});</c->
  <c- p>}</c->
  <c- k>return</c-> <c- k>await</c-> requestNext<c- p>([]);</c->
<c- p>}</c->
</pre>
    <p>In practice, the use of multiple locks is rarely as straightforward — libraries and other utilities can often unintentionally obfuscate their use.</p>
   </aside>
   <h2 class="heading settled" data-level="6" id="security-privacy"><span class="secno">6. </span><span class="content">Security and Privacy Considerations</span><a class="self-link" href="#security-privacy"></a></h2>
   <h3 class="heading settled" data-level="6.1" id="security-scope"><span class="secno">6.1. </span><span class="content">Lock Scope</span><a class="self-link" href="#security-scope"></a></h3>
   <p>The definition of a <a data-link-type="dfn" href="#lock-manager" id="ref-for-lock-manager⑤">lock manager</a>'s scope is important as it defines a privacy boundary. Locks can be used as an ephemeral state retention mechanism and, like storage APIs, can be used as a communication mechanism, and must be no more privileged than storage facilities. User agents that impose finer granularity on one of these services must impose it on others; for example, a user agent that exposes different storage partitions to a top-level page (first-party) and a cross-origin iframe (third-party) in the same origin for privacy reasons must similarly partition locking.</p>
   <p>This also provides reasonable expectations for web application authors; if a lock is acquired over a storage resource, all same-origin browsing contexts must observe the same state.</p>
   <h3 class="heading settled" data-level="6.2" id="private-browsing"><span class="secno">6.2. </span><span class="content">Private Browsing</span><a class="self-link" href="#private-browsing"></a></h3>
   <p>Every <a href="https://github.com/w3ctag/private-mode">private mode</a> browsing session is considered a separate user agent for the purposes of this API. That is, locks requested/held outside such a session have no affect on requested/held inside such a session, and vice versa. This prevents a website from determining that a session is "incognito" while also not allowing a communication mechanism between such sessions.</p>
   <h3 class="heading settled" data-level="6.3" id="implementation-risks"><span class="secno">6.3. </span><span class="content">Implementation Risks</span><a class="self-link" href="#implementation-risks"></a></h3>
   <p>Implementations must ensure that locks do not span origins. Failure to do so would provide a side-channel for communication between script running in two origins, or allow one script in one origin to disrupt the behavior of another (e.g. denying service).</p>
   <h3 class="heading settled" data-level="6.4" id="security-privacy-checklist"><span class="secno">6.4. </span><span class="content">Checklist</span><a class="self-link" href="#security-privacy-checklist"></a></h3>
   <p>The W3C TAG has developed a <a href="https://www.w3.org/TR/security-privacy-questionnaire/">Self-Review Questionnaire: Security and Privacy</a> for editors of specifications to informatively answer. Revisiting the questions here:</p>
   <ul>
    <li data-md>
     <p>The specification does not deal with personally identifiable information, or high-value data.</p>
    <li data-md>
     <p>No new state for an origin that persists across browsing sessions is introduced.</p>
    <li data-md>
     <p>No new persistent, cross-origin state is exposed to the web.</p>
    <li data-md>
     <p>No new data is exposed to an origin that it doesn’t currently have access to (e.g. via polling <a data-link-type="biblio" href="#biblio-indexeddb-2" title="Indexed Database API 2.0">[IndexedDB-2]</a>.)</p>
    <li data-md>
     <p>No new script execution/loading mechanisms are enabled.</p>
    <li data-md>
     <p>This specification does not allow an origin access to any of the following:</p>
     <ul>
      <li data-md>
       <p>The user’s location.</p>
      <li data-md>
       <p>Sensors on a user’s device.</p>
      <li data-md>
       <p>Aspects of a user’s local computing environment.</p>
      <li data-md>
       <p>Access to other devices.</p>
      <li data-md>
       <p>Any measure of control over a user agent’s native UI.</p>
     </ul>
    <li data-md>
     <p>No temporary identifiers to the web are exposed to the web. All <a data-link-type="dfn" href="#resource-name" id="ref-for-resource-name⑥">resource names</a> are provided by the web application itself.</p>
    <li data-md>
     <p>Behavior in first-party and third-party contexts is distinguished in a user agent if storage is distinguished. See <a href="#security-scope">§ 6.1 Lock Scope</a>.</p>
    <li data-md>
     <p>Behavior in the context of a user agent’s "incognito" mode is described in <a href="#private-browsing">§ 6.2 Private Browsing</a>.</p>
    <li data-md>
     <p>No data is persisted to a user’s local device by this API.</p>
    <li data-md>
     <p>This API does not allow downgrading default security characteristics.</p>
   </ul>
   <h2 class="heading settled" data-level="7" id="acknowledgements"><span class="secno">7. </span><span class="content">Acknowledgements</span><a class="self-link" href="#acknowledgements"></a></h2>
   <p>Many thanks to
Alex Russell,
Andreas Butler,
Anne van Kesteren,
Boris Zbarsky,
Darin Fisher,
Domenic Denicola,
Gus Caplan,
Harald Alvestrand,
Jake Archibald,
L. David Baron,
Luciano Pacheco,
Marcos Caceres,
Ralph Chelala,
Raymond Toy,
Ryan Fioravanti,
and
Victor Costan
for helping craft this proposal.</p>
   <p>Special thanks to Tab Atkins, Jr. for creating and maintaining <a href="https://github.com/tabatkins/bikeshed">Bikeshed</a>, the specification
authoring tool used to create this document, and for his general
authoring advice.</p>
  </main>
  <div data-fill-with="conformance">
   <h2 class="no-ref no-num heading settled" id="w3c-conformance"><span class="content">Conformance</span><a class="self-link" href="#w3c-conformance"></a></h2>
   <h3 class="no-ref no-num heading settled" id="w3c-conventions"><span class="content">Document conventions</span><a class="self-link" href="#w3c-conventions"></a></h3>
   <p>Conformance requirements are expressed
    with a combination of descriptive assertions
    and RFC 2119 terminology.
    The key words “MUST”, “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”, “RECOMMENDED”, “MAY”, and “OPTIONAL”
    in the normative parts of this document
    are to be interpreted as described in RFC 2119.
    However, for readability,
    these words do not appear in all uppercase letters in this specification. </p>
   <p>All of the text of this specification is normative
    except sections explicitly marked as non-normative, examples, and notes. <a data-link-type="biblio" href="#biblio-rfc2119" title="Key words for use in RFCs to Indicate Requirement Levels">[RFC2119]</a> </p>
   <p>Examples in this specification are introduced with the words “for example”
    or are set apart from the normative text
    with <code>class="example"</code>,
    like this: </p>
   <div class="example" id="w3c-example">
    <a class="self-link" href="#w3c-example"></a> 
    <p>This is an example of an informative example. </p>
   </div>
   <p>Informative notes begin with the word “Note”
    and are set apart from the normative text
    with <code>class="note"</code>,
    like this: </p>
   <p class="note" role="note">Note, this is an informative note.</p>
   <h3 class="no-ref no-num heading settled" id="w3c-conformant-algorithms"><span class="content">Conformant Algorithms</span><a class="self-link" href="#w3c-conformant-algorithms"></a></h3>
   <p>Requirements phrased in the imperative as part of algorithms
    (such as "strip any leading space characters"
    or "return false and abort these steps")
    are to be interpreted with the meaning of the key word
    ("must", "should", "may", etc)
    used in introducing the algorithm. </p>
   <p>Conformance requirements phrased as algorithms or specific steps
    can be implemented in any manner,
    so long as the end result is equivalent.
    In particular, the algorithms defined in this specification
    are intended to be easy to understand
    and are not intended to be performant.
    Implementers are encouraged to optimize. </p>
  </div>
<script src="https://www.w3.org/scripts/TR/2021/fixup.js"></script>
  <h2 class="no-num no-ref heading settled" id="index"><span class="content">Index</span><a class="self-link" href="#index"></a></h2>
  <h3 class="no-num no-ref heading settled" id="index-defined-here"><span class="content">Terms defined by this specification</span><a class="self-link" href="#index-defined-here"></a></h3>
  <ul class="index">
   <li><a href="#abort-the-request">abort the request</a><span>, in § 4.3</span>
   <li>
    agent
    <ul>
     <li><a href="#lock-request-agent">dfn for lock request</a><span>, in § 2.5</span>
     <li><a href="#lock-concept-agent">dfn for lock-concept</a><span>, in § 2.4</span>
    </ul>
   <li>
    clientId
    <ul>
     <li><a href="#lock-request-clientid">dfn for lock request</a><span>, in § 2.5</span>
     <li><a href="#lock-concept-clientid">dfn for lock-concept</a><span>, in § 2.4</span>
     <li><a href="#dom-lockinfo-clientid">dict-member for LockInfo</a><span>, in § 3.2</span>
    </ul>
   <li><a href="#dom-lockmode-exclusive">"exclusive"</a><span>, in § 3.2</span>
   <li><a href="#lock-request-grantable">grantable</a><span>, in § 2.5</span>
   <li><a href="#dom-lockmanagersnapshot-held">held</a><span>, in § 3.2</span>
   <li><a href="#lock-concept-held-lock-set">held lock set</a><span>, in § 2.4</span>
   <li><a href="#dom-lockoptions-ifavailable">ifAvailable</a><span>, in § 3.2</span>
   <li><a href="#lock">Lock</a><span>, in § 3.3</span>
   <li><a href="#lock-concept">lock-concept</a><span>, in § 2.4</span>
   <li><a href="#callbackdef-lockgrantedcallback">LockGrantedCallback</a><span>, in § 3.2</span>
   <li><a href="#dictdef-lockinfo">LockInfo</a><span>, in § 3.2</span>
   <li><a href="#lock-manager">lock manager</a><span>, in § 2.2</span>
   <li><a href="#lockmanager">LockManager</a><span>, in § 3.2</span>
   <li><a href="#dictdef-lockmanagersnapshot">LockManagerSnapshot</a><span>, in § 3.2</span>
   <li><a href="#enumdef-lockmode">LockMode</a><span>, in § 3.2</span>
   <li><a href="#dictdef-lockoptions">LockOptions</a><span>, in § 3.2</span>
   <li><a href="#lock-request">lock request</a><span>, in § 2.5</span>
   <li><a href="#lock-request-lock-request-queue">lock request queue</a><span>, in § 2.5</span>
   <li><a href="#lock-request-lock-request-queue-map">lock request queue map</a><span>, in § 2.5</span>
   <li><a href="#dom-navigatorlocks-locks">locks</a><span>, in § 3.1</span>
   <li><a href="#lock-task-queue">lock task queue</a><span>, in § 2</span>
   <li>
    mode
    <ul>
     <li><a href="#dom-lock-mode">attribute for Lock</a><span>, in § 3.3</span>
     <li><a href="#mode">definition of</a><span>, in § 2.3</span>
     <li><a href="#lock-request-mode">dfn for lock request</a><span>, in § 2.5</span>
     <li><a href="#lock-concept-mode">dfn for lock-concept</a><span>, in § 2.4</span>
     <li><a href="#dom-lockinfo-mode">dict-member for LockInfo</a><span>, in § 3.2</span>
     <li><a href="#dom-lockoptions-mode">dict-member for LockOptions</a><span>, in § 3.2</span>
    </ul>
   <li>
    name
    <ul>
     <li><a href="#dom-lock-name">attribute for Lock</a><span>, in § 3.3</span>
     <li><a href="#lock-request-name">dfn for lock request</a><span>, in § 2.5</span>
     <li><a href="#lock-concept-name">dfn for lock-concept</a><span>, in § 2.4</span>
     <li><a href="#dom-lockinfo-name">dict-member for LockInfo</a><span>, in § 3.2</span>
    </ul>
   <li><a href="#navigatorlocks">NavigatorLocks</a><span>, in § 3.1</span>
   <li>
    origin
    <ul>
     <li><a href="#lock-request-origin">dfn for lock request</a><span>, in § 2.5</span>
     <li><a href="#lock-concept-origin">dfn for lock-concept</a><span>, in § 2.4</span>
    </ul>
   <li><a href="#dom-lockmanagersnapshot-pending">pending</a><span>, in § 3.2</span>
   <li><a href="#process-the-lock-request-queue">process the lock request queue</a><span>, in § 4.4</span>
   <li><a href="#lock-request-promise">promise</a><span>, in § 2.5</span>
   <li><a href="#dom-lockmanager-query">query()</a><span>, in § 3.2.2</span>
   <li><a href="#lock-concept-released-promise">released promise</a><span>, in § 2.4</span>
   <li><a href="#release-the-lock">release the lock</a><span>, in § 4.2</span>
   <li><a href="#request-a-lock">request a lock</a><span>, in § 4.1</span>
   <li><a href="#dom-lockmanager-request">request(name, callback)</a><span>, in § 3.2.1</span>
   <li><a href="#dom-lockmanager-request-name-options-callback">request(name, options, callback)</a><span>, in § 3.2.1</span>
   <li><a href="#resource-name">resource name</a><span>, in § 2.1</span>
   <li><a href="#dom-lockmode-shared">"shared"</a><span>, in § 3.2</span>
   <li><a href="#dom-lockoptions-signal">signal</a><span>, in § 3.2</span>
   <li><a href="#snapshot-the-lock-state">snapshot the lock state</a><span>, in § 4.5</span>
   <li><a href="#dom-lockoptions-steal">steal</a><span>, in § 3.2</span>
   <li><a href="#lock-concept-waiting-promise">waiting promise</a><span>, in § 2.4</span>
   <li><a href="#web-locks-tasks-source">web locks tasks source</a><span>, in § 2</span>
  </ul>
  <h3 class="no-num no-ref heading settled" id="index-defined-elsewhere"><span class="content">Terms defined by reference</span><a class="self-link" href="#index-defined-elsewhere"></a></h3>
  <ul class="index">
   <li>
    <a data-link-type="biblio">[DOM]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="cca3cdb2">AbortSignal</span>
     <li><span class="dfn-paneled" id="87bc23a5">add</span>
    </ul>
   <li>
    <a data-link-type="biblio">[ECMA262]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="26e4aa12">agent</span>
    </ul>
   <li>
    <a data-link-type="biblio">[HTML]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="be0c27b2">Navigator</span>
     <li><span class="dfn-paneled" id="a4785085">WorkerNavigator</span>
     <li><span class="dfn-paneled" id="474cbfcb">agent cluster</span>
     <li><span class="dfn-paneled" id="0d0390b4">browsing context</span>
     <li><span class="dfn-paneled" id="e4d92278">enqueue steps</span>
     <li><span class="dfn-paneled" id="102df61f">enqueue the following steps</span>
     <li><span class="dfn-paneled" id="3e12e042">environment settings object</span>
     <li><span class="dfn-paneled" id="73a186aa">id</span>
     <li><span class="dfn-paneled" id="55e92c5b">localstorage</span>
     <li><span class="dfn-paneled" id="b01b1359">opaque origin</span>
     <li><span class="dfn-paneled" id="086e3aff">origin</span>
     <li><span class="dfn-paneled" id="9c4c1e66">relevant settings object</span>
     <li><span class="dfn-paneled" id="e3288657">responsible event loop</span>
     <li><span class="dfn-paneled" id="8219d486">starting a new parallel queue</span>
     <li><span class="dfn-paneled" id="c3b2d08c">task source</span>
    </ul>
   <li>
    <a data-link-type="biblio">[INFRA]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="53275e46">append <small>(for list)</small></span>
     <li><span class="dfn-paneled" id="a3b18719">append <small>(for set)</small></span>
     <li><span class="dfn-paneled" id="77b4c09a">assert</span>
     <li><span class="dfn-paneled" id="06a6db54">enqueue</span>
     <li><span class="dfn-paneled" id="16d07e10">for each <small>(for list)</small></span>
     <li><span class="dfn-paneled" id="45209803">for each <small>(for map)</small></span>
     <li><span class="dfn-paneled" id="c88f3887">item</span>
     <li><span class="dfn-paneled" id="b38d7ca1">javascript string</span>
     <li><span class="dfn-paneled" id="649608b9">list</span>
     <li><span class="dfn-paneled" id="3fca5a9e">map</span>
     <li><span class="dfn-paneled" id="e2fc6023">prepend</span>
     <li><span class="dfn-paneled" id="47dfca75">queue</span>
     <li><span class="dfn-paneled" id="99c988d6">remove</span>
     <li><span class="dfn-paneled" id="15e48c39">set</span>
     <li><span class="dfn-paneled" id="984221ca">struct</span>
     <li><span class="dfn-paneled" id="12d6b9a8">values</span>
    </ul>
   <li>
    <a data-link-type="biblio">[Service-Workers]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="3b7e827f">Client</span>
     <li><span class="dfn-paneled" id="87d2dc25">id</span>
    </ul>
   <li>
    <a data-link-type="biblio">[Storage]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="daed3f4b">storage shelf</span>
    </ul>
   <li>
    <a data-link-type="biblio">[WEBIDL]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="d25dfb2c">AbortError</span>
     <li><span class="dfn-paneled" id="dca2de17">DOMException</span>
     <li><span class="dfn-paneled" id="8855a9aa">DOMString</span>
     <li><span class="dfn-paneled" id="889e932f">Exposed</span>
     <li><span class="dfn-paneled" id="3182eb71">NotSupportedError</span>
     <li><span class="dfn-paneled" id="bdbd19d1">Promise</span>
     <li><span class="dfn-paneled" id="b75bb3bd">SecureContext</span>
     <li><span class="dfn-paneled" id="c3e881ef">SecurityError</span>
     <li><span class="dfn-paneled" id="dacde8b5">a new promise</span>
     <li><span class="dfn-paneled" id="d0b4a948">a promise rejected with</span>
     <li><span class="dfn-paneled" id="6c6b1005">any</span>
     <li><span class="dfn-paneled" id="5372cca8">boolean</span>
     <li><span class="dfn-paneled" id="3ab7bf79">callback function</span>
     <li><span class="dfn-paneled" id="10ce5f6f">invoke</span>
     <li><span class="dfn-paneled" id="b262501e">reject</span>
     <li><span class="dfn-paneled" id="3b90bdcd">resolve</span>
     <li><span class="dfn-paneled" id="9cce47fd">sequence</span>
     <li><span class="dfn-paneled" id="4013a022">this</span>
    </ul>
  </ul>
  <h2 class="no-num no-ref heading settled" id="references"><span class="content">References</span><a class="self-link" href="#references"></a></h2>
  <h3 class="no-num no-ref heading settled" id="normative"><span class="content">Normative References</span><a class="self-link" href="#normative"></a></h3>
  <dl>
   <dt id="biblio-dom">[DOM]
   <dd>Anne van Kesteren. <a href="https://dom.spec.whatwg.org/"><cite>DOM Standard</cite></a>. Living Standard. URL: <a href="https://dom.spec.whatwg.org/">https://dom.spec.whatwg.org/</a>
   <dt id="biblio-html">[HTML]
   <dd>Anne van Kesteren; et al. <a href="https://html.spec.whatwg.org/multipage/"><cite>HTML Standard</cite></a>. Living Standard. URL: <a href="https://html.spec.whatwg.org/multipage/">https://html.spec.whatwg.org/multipage/</a>
   <dt id="biblio-infra">[INFRA]
   <dd>Anne van Kesteren; Domenic Denicola. <a href="https://infra.spec.whatwg.org/"><cite>Infra Standard</cite></a>. Living Standard. URL: <a href="https://infra.spec.whatwg.org/">https://infra.spec.whatwg.org/</a>
   <dt id="biblio-rfc2119">[RFC2119]
   <dd>S. Bradner. <a href="https://datatracker.ietf.org/doc/html/rfc2119"><cite>Key words for use in RFCs to Indicate Requirement Levels</cite></a>. March 1997. Best Current Practice. URL: <a href="https://datatracker.ietf.org/doc/html/rfc2119">https://datatracker.ietf.org/doc/html/rfc2119</a>
   <dt id="biblio-webidl">[WEBIDL]
   <dd>Edgar Chen; Timothy Gu. <a href="https://webidl.spec.whatwg.org/"><cite>Web IDL Standard</cite></a>. Living Standard. URL: <a href="https://webidl.spec.whatwg.org/">https://webidl.spec.whatwg.org/</a>
  </dl>
  <h3 class="no-num no-ref heading settled" id="informative"><span class="content">Informative References</span><a class="self-link" href="#informative"></a></h3>
  <dl>
   <dt id="biblio-indexeddb-2">[IndexedDB-2]
   <dd>Ali Alabbas; Joshua Bell. <a href="https://w3c.github.io/IndexedDB/"><cite>Indexed Database API 2.0</cite></a>. URL: <a href="https://w3c.github.io/IndexedDB/">https://w3c.github.io/IndexedDB/</a>
   <dt id="biblio-service-workers">[Service-Workers]
   <dd>Jake Archibald; Marijn Kruisselbrink. <a href="https://w3c.github.io/ServiceWorker/"><cite>Service Workers</cite></a>. URL: <a href="https://w3c.github.io/ServiceWorker/">https://w3c.github.io/ServiceWorker/</a>
   <dt id="biblio-storage">[Storage]
   <dd>Anne van Kesteren. <a href="https://storage.spec.whatwg.org/"><cite>Storage Standard</cite></a>. Living Standard. URL: <a href="https://storage.spec.whatwg.org/">https://storage.spec.whatwg.org/</a>
  </dl>
  <h2 class="no-num no-ref heading settled" id="idl-index"><span class="content">IDL Index</span><a class="self-link" href="#idl-index"></a></h2>
<pre class="idl highlight def">[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#SecureContext"><c- g>SecureContext</c-></a>]
<c- b>interface</c-> <c- b>mixin</c-> <a href="#navigatorlocks"><code><c- g>NavigatorLocks</c-></code></a> {
  <c- b>readonly</c-> <c- b>attribute</c-> <a data-link-type="idl-name" href="#lockmanager"><c- n>LockManager</c-></a> <a class="idl-code" data-link-type="attribute" data-readonly data-type="LockManager" href="#dom-navigatorlocks-locks"><c- g>locks</c-></a>;
};
<a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/system-state.html#navigator"><c- n>Navigator</c-></a> <c- b>includes</c-> <a data-link-type="idl-name" href="#navigatorlocks"><c- n>NavigatorLocks</c-></a>;
<a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/workers.html#workernavigator"><c- n>WorkerNavigator</c-></a> <c- b>includes</c-> <a data-link-type="idl-name" href="#navigatorlocks"><c- n>NavigatorLocks</c-></a>;

[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#SecureContext"><c- g>SecureContext</c-></a>, <a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed"><c- g>Exposed</c-></a>=(<c- n>Window</c->,<c- n>Worker</c->)]
<c- b>interface</c-> <a href="#lockmanager"><code><c- g>LockManager</c-></code></a> {
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise"><c- b>Promise</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-any"><c- b>any</c-></a>> <a class="idl-code" data-link-type="method" href="#dom-lockmanager-request"><c- g>request</c-></a>(<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString"><c- b>DOMString</c-></a> <a href="#dom-lockmanager-request-name-callback-name"><code><c- g>name</c-></code></a>,
                       <a data-link-type="idl-name" href="#callbackdef-lockgrantedcallback"><c- n>LockGrantedCallback</c-></a> <a href="#dom-lockmanager-request-name-callback-callback"><code><c- g>callback</c-></code></a>);
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise"><c- b>Promise</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-any"><c- b>any</c-></a>> <a class="idl-code" data-link-type="method" href="#dom-lockmanager-request-name-options-callback"><c- g>request</c-></a>(<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString"><c- b>DOMString</c-></a> <a href="#dom-lockmanager-request-name-options-callback-name"><code><c- g>name</c-></code></a>,
                       <a data-link-type="idl-name" href="#dictdef-lockoptions"><c- n>LockOptions</c-></a> <a href="#dom-lockmanager-request-name-options-callback-options"><code><c- g>options</c-></code></a>,
                       <a data-link-type="idl-name" href="#callbackdef-lockgrantedcallback"><c- n>LockGrantedCallback</c-></a> <a href="#dom-lockmanager-request-name-options-callback-callback"><code><c- g>callback</c-></code></a>);

  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise"><c- b>Promise</c-></a>&lt;<a data-link-type="idl-name" href="#dictdef-lockmanagersnapshot"><c- n>LockManagerSnapshot</c-></a>> <a class="idl-code" data-link-type="method" href="#dom-lockmanager-query"><c- g>query</c-></a>();
};

<c- b>callback</c-> <a href="#callbackdef-lockgrantedcallback"><code><c- g>LockGrantedCallback</c-></code></a> = <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise"><c- b>Promise</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-any"><c- b>any</c-></a>> (<a data-link-type="idl-name" href="#lock"><c- n>Lock</c-></a>? <a href="#dom-lockgrantedcallback-lock"><code><c- g>lock</c-></code></a>);

<c- b>enum</c-> <a href="#enumdef-lockmode"><code><c- g>LockMode</c-></code></a> { <a href="#dom-lockmode-shared"><code><c- s>"shared"</c-></code></a>, <a href="#dom-lockmode-exclusive"><code><c- s>"exclusive"</c-></code></a> };

<c- b>dictionary</c-> <a href="#dictdef-lockoptions"><code><c- g>LockOptions</c-></code></a> {
  <a data-link-type="idl-name" href="#enumdef-lockmode"><c- n>LockMode</c-></a> <a data-default="&quot;exclusive&quot;" data-type="LockMode " href="#dom-lockoptions-mode"><code><c- g>mode</c-></code></a> = "exclusive";
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-boolean"><c- b>boolean</c-></a> <a data-default="false" data-type="boolean " href="#dom-lockoptions-ifavailable"><code><c- g>ifAvailable</c-></code></a> = <c- b>false</c->;
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-boolean"><c- b>boolean</c-></a> <a data-default="false" data-type="boolean " href="#dom-lockoptions-steal"><code><c- g>steal</c-></code></a> = <c- b>false</c->;
  <a data-link-type="idl-name" href="https://dom.spec.whatwg.org/#abortsignal"><c- n>AbortSignal</c-></a> <a data-type="AbortSignal " href="#dom-lockoptions-signal"><code><c- g>signal</c-></code></a>;
};

<c- b>dictionary</c-> <a href="#dictdef-lockmanagersnapshot"><code><c- g>LockManagerSnapshot</c-></code></a> {
  <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#idl-sequence"><c- b>sequence</c-></a>&lt;<a data-link-type="idl-name" href="#dictdef-lockinfo"><c- n>LockInfo</c-></a>> <a data-type="sequence<LockInfo> " href="#dom-lockmanagersnapshot-held"><code><c- g>held</c-></code></a>;
  <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#idl-sequence"><c- b>sequence</c-></a>&lt;<a data-link-type="idl-name" href="#dictdef-lockinfo"><c- n>LockInfo</c-></a>> <a data-type="sequence<LockInfo> " href="#dom-lockmanagersnapshot-pending"><code><c- g>pending</c-></code></a>;
};

<c- b>dictionary</c-> <a href="#dictdef-lockinfo"><code><c- g>LockInfo</c-></code></a> {
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString"><c- b>DOMString</c-></a> <a data-type="DOMString " href="#dom-lockinfo-name"><code><c- g>name</c-></code></a>;
  <a data-link-type="idl-name" href="#enumdef-lockmode"><c- n>LockMode</c-></a> <a data-type="LockMode " href="#dom-lockinfo-mode"><code><c- g>mode</c-></code></a>;
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString"><c- b>DOMString</c-></a> <a data-type="DOMString " href="#dom-lockinfo-clientid"><code><c- g>clientId</c-></code></a>;
};

[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#SecureContext"><c- g>SecureContext</c-></a>, <a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed"><c- g>Exposed</c-></a>=(<c- n>Window</c->,<c- n>Worker</c->)]
<c- b>interface</c-> <a href="#lock"><code><c- g>Lock</c-></code></a> {
  <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString"><c- b>DOMString</c-></a> <a class="idl-code" data-link-type="attribute" data-readonly data-type="DOMString" href="#dom-lock-name"><c- g>name</c-></a>;
  <c- b>readonly</c-> <c- b>attribute</c-> <a data-link-type="idl-name" href="#enumdef-lockmode"><c- n>LockMode</c-></a> <a class="idl-code" data-link-type="attribute" data-readonly data-type="LockMode" href="#dom-lock-mode"><c- g>mode</c-></a>;
};

</pre>
  <h2 class="no-num no-ref heading settled" id="issues-index"><span class="content">Issues Index</span><a class="self-link" href="#issues-index"></a></h2>
  <div style="counter-reset:issue">
   <div class="issue"> Migrate this definition to <a data-link-type="biblio" href="#biblio-html" title="HTML Standard">[HTML]</a> or <a data-link-type="biblio" href="#biblio-storage" title="Storage Standard">[Storage]</a> so it can be referenced by other standards. <a class="issue-return" href="#issue-fb27f9c9" title="Jump to section">↵</a></div>
   <div class="issue"> Identify a normative reference for <i>terminates</i>. <a class="issue-return" href="#issue-77a47106" title="Jump to section">↵</a></div>
  </div>
  <details class="mdn-anno unpositioned" data-anno-for="dom-lock-mode">
   <summary><b class="all-engines-flag" title="This feature is in all current engines.">✔</b><span>MDN</span></summary>
   <div class="feature">
    <p><a href="https://developer.mozilla.org/en-US/docs/Web/API/Lock/mode" title="The mode read-only property of the Lock interface returns the access mode passed to LockManager.request() when the lock was requested. The mode is either &quot;exclusive&quot; (the default) or &quot;shared&quot;.">Lock/mode</a></p>
    <p class="all-engines-text">In all current engines.</p>
    <div class="support">
     <span class="firefox yes"><span>Firefox</span><span>96+</span></span><span class="safari yes"><span>Safari</span><span>15.4+</span></span><span class="chrome yes"><span>Chrome</span><span>69+</span></span>
     <hr>
     <span class="opera no"><span>Opera</span><span>?</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span>
     <hr>
     <span class="edge no"><span>Edge (Legacy)</span><span>?</span></span><span class="ie no"><span>IE</span><span>None</span></span>
     <hr>
     <span class="firefox_android no"><span>Firefox for Android</span><span>?</span></span><span class="safari_ios no"><span>iOS Safari</span><span>?</span></span><span class="chrome_android no"><span>Chrome for Android</span><span>?</span></span><span class="webview_android no"><span>Android WebView</span><span>?</span></span><span class="samsunginternet_android no"><span>Samsung Internet</span><span>?</span></span><span class="opera_android no"><span>Opera Mobile</span><span>?</span></span>
    </div>
   </div>
  </details>
  <details class="mdn-anno unpositioned" data-anno-for="dom-lock-name">
   <summary><b class="all-engines-flag" title="This feature is in all current engines.">✔</b><span>MDN</span></summary>
   <div class="feature">
    <p><a href="https://developer.mozilla.org/en-US/docs/Web/API/Lock/name" title="The name read-only property of the Lock interface returns the name passed to LockManager.request selected when the lock was requested.">Lock/name</a></p>
    <p class="all-engines-text">In all current engines.</p>
    <div class="support">
     <span class="firefox yes"><span>Firefox</span><span>96+</span></span><span class="safari yes"><span>Safari</span><span>15.4+</span></span><span class="chrome yes"><span>Chrome</span><span>69+</span></span>
     <hr>
     <span class="opera no"><span>Opera</span><span>?</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span>
     <hr>
     <span class="edge no"><span>Edge (Legacy)</span><span>?</span></span><span class="ie no"><span>IE</span><span>None</span></span>
     <hr>
     <span class="firefox_android no"><span>Firefox for Android</span><span>?</span></span><span class="safari_ios no"><span>iOS Safari</span><span>?</span></span><span class="chrome_android no"><span>Chrome for Android</span><span>?</span></span><span class="webview_android no"><span>Android WebView</span><span>?</span></span><span class="samsunginternet_android no"><span>Samsung Internet</span><span>?</span></span><span class="opera_android no"><span>Opera Mobile</span><span>?</span></span>
    </div>
   </div>
  </details>
  <details class="mdn-anno unpositioned" data-anno-for="api-lock">
   <summary><b class="all-engines-flag" title="This feature is in all current engines.">✔</b><span>MDN</span></summary>
   <div class="feature">
    <p><a href="https://developer.mozilla.org/en-US/docs/Web/API/Lock" title="The Lock interface of the Web Locks API provides the name and mode of a lock. This may be a newly requested lock that is received in the callback to LockManager.request(), or a record of an active or queued lock returned by LockManager.query().">Lock</a></p>
    <p class="all-engines-text">In all current engines.</p>
    <div class="support">
     <span class="firefox yes"><span>Firefox</span><span>96+</span></span><span class="safari yes"><span>Safari</span><span>15.4+</span></span><span class="chrome yes"><span>Chrome</span><span>69+</span></span>
     <hr>
     <span class="opera no"><span>Opera</span><span>?</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span>
     <hr>
     <span class="edge no"><span>Edge (Legacy)</span><span>?</span></span><span class="ie no"><span>IE</span><span>None</span></span>
     <hr>
     <span class="firefox_android no"><span>Firefox for Android</span><span>?</span></span><span class="safari_ios no"><span>iOS Safari</span><span>?</span></span><span class="chrome_android no"><span>Chrome for Android</span><span>?</span></span><span class="webview_android no"><span>Android WebView</span><span>?</span></span><span class="samsunginternet_android no"><span>Samsung Internet</span><span>?</span></span><span class="opera_android no"><span>Opera Mobile</span><span>?</span></span>
    </div>
   </div>
  </details>
  <details class="mdn-anno unpositioned" data-anno-for="api-lock-manager-query">
   <summary><b class="all-engines-flag" title="This feature is in all current engines.">✔</b><span>MDN</span></summary>
   <div class="feature">
    <p><a href="https://developer.mozilla.org/en-US/docs/Web/API/LockManager/query" title="The query() method of the LockManager interface returns a Promise that resolves with an object containing information about held and pending locks.">LockManager/query</a></p>
    <p class="all-engines-text">In all current engines.</p>
    <div class="support">
     <span class="firefox yes"><span>Firefox</span><span>96+</span></span><span class="safari yes"><span>Safari</span><span>15.4+</span></span><span class="chrome yes"><span>Chrome</span><span>69+</span></span>
     <hr>
     <span class="opera no"><span>Opera</span><span>?</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span>
     <hr>
     <span class="edge no"><span>Edge (Legacy)</span><span>?</span></span><span class="ie no"><span>IE</span><span>None</span></span>
     <hr>
     <span class="firefox_android no"><span>Firefox for Android</span><span>?</span></span><span class="safari_ios no"><span>iOS Safari</span><span>?</span></span><span class="chrome_android no"><span>Chrome for Android</span><span>?</span></span><span class="webview_android no"><span>Android WebView</span><span>?</span></span><span class="samsunginternet_android no"><span>Samsung Internet</span><span>?</span></span><span class="opera_android no"><span>Opera Mobile</span><span>?</span></span>
    </div>
   </div>
  </details>
  <details class="mdn-anno unpositioned" data-anno-for="api-lock-manager-request">
   <summary><b class="all-engines-flag" title="This feature is in all current engines.">✔</b><span>MDN</span></summary>
   <div class="feature">
    <p><a href="https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request" title="The request() method of the LockManager interface requests a Lock object with parameters specifying its name and characteristics. The requested Lock is passed to a callback, while the function itself returns a Promise that resolves with undefined.">LockManager/request</a></p>
    <p class="all-engines-text">In all current engines.</p>
    <div class="support">
     <span class="firefox yes"><span>Firefox</span><span>96+</span></span><span class="safari yes"><span>Safari</span><span>15.4+</span></span><span class="chrome yes"><span>Chrome</span><span>69+</span></span>
     <hr>
     <span class="opera no"><span>Opera</span><span>?</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span>
     <hr>
     <span class="edge no"><span>Edge (Legacy)</span><span>?</span></span><span class="ie no"><span>IE</span><span>None</span></span>
     <hr>
     <span class="firefox_android no"><span>Firefox for Android</span><span>?</span></span><span class="safari_ios no"><span>iOS Safari</span><span>?</span></span><span class="chrome_android no"><span>Chrome for Android</span><span>?</span></span><span class="webview_android no"><span>Android WebView</span><span>?</span></span><span class="samsunginternet_android no"><span>Samsung Internet</span><span>?</span></span><span class="opera_android no"><span>Opera Mobile</span><span>?</span></span>
    </div>
   </div>
  </details>
  <details class="mdn-anno unpositioned" data-anno-for="api-lock-manager">
   <summary><b class="all-engines-flag" title="This feature is in all current engines.">✔</b><span>MDN</span></summary>
   <div class="feature">
    <p><a href="https://developer.mozilla.org/en-US/docs/Web/API/LockManager" title="The LockManager interface of the Web Locks API provides methods for requesting a new Lock object and querying for an existing Lock object. To get an instance of LockManager, call navigator.locks.">LockManager</a></p>
    <p class="all-engines-text">In all current engines.</p>
    <div class="support">
     <span class="firefox yes"><span>Firefox</span><span>96+</span></span><span class="safari yes"><span>Safari</span><span>15.4+</span></span><span class="chrome yes"><span>Chrome</span><span>69+</span></span>
     <hr>
     <span class="opera no"><span>Opera</span><span>?</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span>
     <hr>
     <span class="edge no"><span>Edge (Legacy)</span><span>?</span></span><span class="ie no"><span>IE</span><span>None</span></span>
     <hr>
     <span class="firefox_android no"><span>Firefox for Android</span><span>?</span></span><span class="safari_ios no"><span>iOS Safari</span><span>?</span></span><span class="chrome_android no"><span>Chrome for Android</span><span>?</span></span><span class="webview_android no"><span>Android WebView</span><span>?</span></span><span class="samsunginternet_android no"><span>Samsung Internet</span><span>?</span></span><span class="opera_android no"><span>Opera Mobile</span><span>?</span></span>
    </div>
   </div>
  </details>
  <details class="mdn-anno unpositioned" data-anno-for="dom-navigatorlocks-locks">
   <summary><b class="all-engines-flag" title="This feature is in all current engines.">✔</b><span>MDN</span></summary>
   <div class="feature">
    <p><a href="https://developer.mozilla.org/en-US/docs/Web/API/Navigator/locks" title="The locks read-only property of the Navigator interface returns a LockManager object which provides methods for requesting a new Lock object and querying for an existing Lock object.">Navigator/locks</a></p>
    <p class="all-engines-text">In all current engines.</p>
    <div class="support">
     <span class="firefox yes"><span>Firefox</span><span>96+</span></span><span class="safari yes"><span>Safari</span><span>15.4+</span></span><span class="chrome yes"><span>Chrome</span><span>69+</span></span>
     <hr>
     <span class="opera no"><span>Opera</span><span>?</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span>
     <hr>
     <span class="edge no"><span>Edge (Legacy)</span><span>?</span></span><span class="ie no"><span>IE</span><span>None</span></span>
     <hr>
     <span class="firefox_android no"><span>Firefox for Android</span><span>?</span></span><span class="safari_ios no"><span>iOS Safari</span><span>?</span></span><span class="chrome_android no"><span>Chrome for Android</span><span>?</span></span><span class="webview_android no"><span>Android WebView</span><span>?</span></span><span class="samsunginternet_android no"><span>Samsung Internet</span><span>?</span></span><span class="opera_android no"><span>Opera Mobile</span><span>?</span></span>
    </div>
   </div>
  </details>
<script>/* Boilerplate: script-dfn-panel */
"use strict";
{
    // Functions, divided by link type, that wrap an autolink's
    // contents with the appropriate outer syntax.
    // Alternately, a string naming another type they format
    // the same as.
    const typeFormatters = {
        'dfn': (text) => `[=${text}=]`,
        'abstract-op': (text) => `[\$${text}\$]`,
        'value': (text) => `''${text}''`,
        'http-header': (text) => `[:${text}:]`,
        'idl': (text) => `{{${text}}}`,
        'interface': 'idl',
        'constructor': 'idl',
        'method': 'idl',
        'argument': 'idl',
        'attribute': 'idl',
        'callback': 'idl',
        'dictionary': 'idl',
        'dict-member': 'idl',
        'enum': 'idl',
        'enum-value': 'idl',
        'exception': 'idl',
        'const': 'idl',
        'typedef': 'idl',
        'stringifier': 'idl',
        'serializer': 'idl',
        'iterator': 'idl',
        'maplike': 'idl',
        'setlike': 'idl',
        'extended-attribute': 'idl',
        'event': 'idl',
        'element': (element) => `<{${element}}>`,
        'element-state': 'element',
        'element-attr': 'element',
        'attr-value': 'element',
        'scheme': 'dfn',
        'permission': 'dfn',
        'grammar': (text) => `${text} (within a <pre class=prod>)`,
        'type': (text)=> `<<${text}>>`,
        'property': (text) => `'${text}'`,
        'descriptor': 'property',
        'function': 'value',
        'at-rule': 'value',
        'selector': 'value',
    };
    const typesUsingFor = new Set(
        [
            "descriptor",
            "value",
            "element-attr",
            "attr-value",
            "element-state",
            "method",
            "constructor",
            "argument",
            "attribute",
            "const",
            "dict-member",
            "event",
            "enum-value",
            "stringifier",
            "serializer",
            "iterator",
            "maplike",
            "setlike",
            "state",
            "mode",
            "context",
            "facet",
        ],
    )
    const typesNotUsingFor = new Set(
        [
            "property",
            "element",
            "interface",
            "namespace",
            "callback",
            "dictionary",
            "enum",
            "exception",
            "typedef",
            "http-header",
            "permission",
        ],
    )
    function linkFormatterFromType(type) {
        const fnOrType = typeFormatters[type];
        if(typeof fnOrType === 'string') {
            // follow the alias
            return linkFormatterFromType(fnOrType);
        }
        return fnOrType;
    };

    function genLinkingSyntaxes(dfn) {
        if(dfn.tagName != "DFN") return;

        const type = dfn.getAttribute('data-dfn-type');
        if(!type) {
            console.log(`<dfn> doesn't have a data-dfn-type:`, dfn);
            return [];
        }

        // Return a function that wraps link text based on the type
        const linkFormatter = linkFormatterFromType(type);
        if(!linkFormatter) {
            console.log(`<dfn> has an unknown data-dfn-type:`, dfn);
            return [];
        }

        let ltAlts;
        if(dfn.hasAttribute('data-lt')) {
            ltAlts = dfn.getAttribute('data-lt')
                .split("|")
                .map(x=>x.trim());
        } else {
            ltAlts = [dfn.textContent.trim()];
        }
        if(type == "type") {
            // lt of "<foo>", but "foo" is the interior;
            // <<foo/bar>> is how you write it with a for,
            // not <foo/<bar>> or whatever.
            for(var i = 0; i < ltAlts.length; i++) {
                const lt = ltAlts[i];
                const match = /<(.*)>/.exec(lt);
                if(match) { ltAlts[i] = match[1]; }
            }
        }

        let forAlts;
        if(dfn.hasAttribute('data-dfn-for')) {
            forAlts = dfn.getAttribute('data-dfn-for')
                .split(",")
                .map(x=>x.trim());
        } else {
            forAlts = [''];
        }

        let linkingSyntaxes = [];
        if(!typesUsingFor.has(type)) {
            for(const lt of ltAlts) {
                linkingSyntaxes.push(linkFormatter(lt));
            }
        }
        if(!typesNotUsingFor.has(type)) {
            for(const f of forAlts) {
                linkingSyntaxes.push(linkFormatter(`${f}/${ltAlts[0]}`))
            }
        }
        return [
            mk.b({}, 'Possible linking syntaxes:'),
            mk.ul({},
                ...linkingSyntaxes.map(link => {
                    const copyLink = async () =>
                        await navigator.clipboard.writeText(link);
                    return mk.li({},
                        mk.div({ class: 'link-item' },
                            mk.button({
                                class: 'copy-icon', title: 'Copy',
                                type: 'button',
                                _onclick: copyLink,
                                tabindex: 0,
                            }, mk.span({ class: 'icon' }) ),
                            mk.span({}, link)
                        )
                    );
                })
            )
        ];
    }

    function genDfnPanel({ dfn, dfnID, url, dfnText, refSections, external }) {
        const dfnPanel = mk.aside({
            class: "dfn-panel",
            id: `infopanel-for-${dfnID}`,
            "data-for": dfnID,
            "aria-labelled-by":`infopaneltitle-for-${dfnID}`,
            },
            mk.span({id:`infopaneltitle-for-${dfnID}`, style:"display:none"},
                `Info about the '${dfnText}' ${external?"external":""} reference.`),
            mk.a({href:url, class:"dfn-link"}, url),
            mk.b({}, "Referenced in:"),
            mk.ul({},
                ...refSections.map(section=>
                    mk.li({},
                        ...section.refs.map((ref, refI)=>
                            [
                                mk.a({ href: `#${ref.id}` },
                                    (refI == 0) ? section.title : `(${refI + 1})`
                                ),
                                " ",
                            ]
                        ),
                    ),
                ),
            ),
            genLinkingSyntaxes(dfn),
        );
        dfnPanel.forDfn = dfn;
        if(!dfn) { console.log(dfnPanel); }
        return dfnPanel;
    }

    function genAllDfnPanels() {
        for(const panelData of Object.values(window.dfnpanelData)) {
            const dfnID = panelData.dfnID;
            const dfn = document.getElementById(dfnID);
            if(!dfn) {
                console.log(`Can't find dfn#${dfnID}.`, panelData);
                continue;
            }
            const panel = genDfnPanel({ ...panelData, dfn });
            append(document.body, panel);
            insertDfnPopupAction(panel)
        }
    }

    document.addEventListener("DOMContentLoaded", ()=>{
        genAllDfnPanels();

        document.body.addEventListener("click", (e) => {
            // If not handled already, just hide all dfn panels.
            hideAllDfnPanels();
        });
    })

    function hideAllDfnPanels() {
        // Turn off any currently "on" or "activated" panels.
        queryAll(".dfn-panel.on, .dfn-panel.activated").forEach(el=>hideDfnPanel(el));
    }

    function showDfnPanel(dfnPanel) {
        hideAllDfnPanels(); // Only display one at this time.

        const dfn = dfnPanel.forDfn;
        dfn.setAttribute("aria-expanded", "true");

        dfnPanel.classList.add("on");
        positionDfnPanel(dfnPanel);

        let tabIndex = 100;
        dfn.tabIndex = tabIndex++;
        // Increment tabindex for each anchor and button tags in panel
        const tabbable = dfnPanel.querySelectorAll(":is(a, button)");
        for (const el of tabbable) {
            el.tabIndex = tabIndex++;
        }
    }

    function positionDfnPanel(dfnPanel) {
        const dfn = dfnPanel.forDfn;
        const dfnPos = getRootLevelAbsolutePosition(dfn);
        dfnPanel.style.top = dfnPos.bottom + "px";
        dfnPanel.style.left = dfnPos.left + "px";

        const panelPos = dfnPanel.getBoundingClientRect();
        const panelMargin = 8;
        const maxRight = document.body.parentNode.clientWidth - panelMargin;
        if (panelPos.right > maxRight) {
            const overflowAmount = panelPos.right - maxRight;
            const newLeft = Math.max(panelMargin, dfnPos.left - overflowAmount);
            dfnPanel.style.left = newLeft + "px";
        }}

    function pinDfnPanel(dfnPanel) {
        // Switch it to "activated" state, which pins it.
        dfnPanel.classList.add("activated");
        dfnPanel.style.position = "fixed";
        dfnPanel.style.left = null;
        dfnPanel.style.top = null;
    }

    function hideDfnPanel(dfnPanel) {
        const dfn = dfnPanel.forDfn;
        dfn.setAttribute("aria-expanded", "false");
        dfn.tabIndex = undefined;
        dfnPanel.style.position = "absolute"; // unfix it
        dfnPanel.classList.remove("on");
        dfnPanel.classList.remove("activated");
    }

    function toggleDfnPanel(dfnPanel) {
        if(dfnPanel.classList.contains("on")) {
            hideDfnPanel(dfnPanel);
        } else {
            showDfnPanel(dfnPanel);
        }
    }

    function insertDfnPopupAction(dfnPanel) {
        const dfn = dfnPanel.forDfn;
        dfn.setAttribute('role', 'button');
        dfn.setAttribute('aria-expanded', 'false')
        dfn.tabIndex = 0;
        dfn.classList.add('has-dfn-panel');
        dfn.addEventListener('click', (event) => {
            showDfnPanel(dfnPanel);
            event.stopPropagation();
        });
        dfn.addEventListener('keypress', (event) => {
            const kc = event.keyCode;
            // 32->Space, 13->Enter
            if(kc == 32 || kc == 13) {
                toggleDfnPanel(dfnPanel);
                event.stopPropagation();
                event.preventDefault();
            }
        });

        dfnPanel.addEventListener('click', (event) => {
            if (event.target.nodeName == 'A') {
                scrollToTargetAndHighlight(event);
                pinDfnPanel(dfnPanel);
            }
            event.stopPropagation();
            refocusOnTarget(event);
        });

        dfnPanel.addEventListener('keydown', (event) => {
            if(event.keyCode == 27) { // Escape key
                hideDfnPanel(dfnPanel, dfn);
                event.stopPropagation();
                event.preventDefault();
            }
        })
    }

    function refocusOnTarget(event) {
        const target = event.target;
        setTimeout(() => {
            // Refocus on the event.target element.
            // This is needed after browser scrolls to the destination.
            target.focus();
        });
    }

    // Returns the root-level absolute position {left and top} of element.
    function getRootLevelAbsolutePosition(el) {
        const boundsRect = el.getBoundingClientRect();
        let xPos = 0;
        let yPos = 0;

        while (el) {
            let xScroll = el.scrollLeft;
            let yScroll = el.scrollTop;

            // Ignore scrolling of body.
            if (el.tagName === "BODY") {
                xScroll = 0;
                yScroll = 0;
            }
            xPos += (el.offsetLeft - xScroll + el.clientLeft);
            yPos += (el.offsetTop - yScroll + el.clientTop);

            el = el.offsetParent;
        }
        return {
            left: xPos,
            top: yPos,
            right: xPos + boundsRect.width,
            bottom: yPos + boundsRect.height,
        };
    }

    function scrolledIntoView(element) {
        const rect = element.getBoundingClientRect();
        return (
            rect.top > 0 &&
            rect.bottom < window.innerHeight
        );
    }

    function scrollToTargetAndHighlight(event) {
        let hash = event.target.hash;
        if (hash) {
            hash = decodeURIComponent(hash.substring(1));
            const dest = document.getElementById(hash);
            if (dest) {
                // Maybe prevent default scroll.
                if (scrolledIntoView(dest)) {
                    event.preventDefault();
                }
                dest.classList.add('highlighted');
                setTimeout(() => dest.classList.remove('highlighted'), 1000);
            }
        }
    }

    window.addEventListener("resize", () => {
        // Pin any visible dfn panel
        queryAll(".dfn-panel.on, .dfn-panel.activated").forEach(el=>positionDfnPanel(el));
    });
}
</script>
<script>/* Boilerplate: script-dfn-panel-json */
window.dfnpanelData = {};
window.dfnpanelData['cca3cdb2'] = {"dfnID": "cca3cdb2", "url": "https://dom.spec.whatwg.org/#abortsignal", "dfnText": "AbortSignal", "refSections": [{"refs": [{"id": "ref-for-abortsignal"}], "title": "3.2. LockManager class"}, {"refs": [{"id": "ref-for-abortsignal\u2460"}], "title": "3.2.1. The request() method"}], "external": true};
window.dfnpanelData['87bc23a5'] = {"dfnID": "87bc23a5", "url": "https://dom.spec.whatwg.org/#abortsignal-add", "dfnText": "add", "refSections": [{"refs": [{"id": "ref-for-abortsignal-add"}], "title": "3.2.1. The request() method"}], "external": true};
window.dfnpanelData['26e4aa12'] = {"dfnID": "26e4aa12", "url": "https://tc39.github.io/ecma262/#agent", "dfnText": "agent", "refSections": [{"refs": [{"id": "ref-for-agent"}, {"id": "ref-for-agent\u2460"}], "title": "1. Introduction"}, {"refs": [{"id": "ref-for-agent\u2461"}], "title": "2.2. Lock Managers"}, {"refs": [{"id": "ref-for-agent\u2462"}], "title": "2.4. Locks"}, {"refs": [{"id": "ref-for-agent\u2463"}], "title": "2.6. Agent Integration"}, {"refs": [{"id": "ref-for-agent\u2464"}], "title": "3.2.1. The request() method"}], "external": true};
window.dfnpanelData['be0c27b2'] = {"dfnID": "be0c27b2", "url": "https://html.spec.whatwg.org/multipage/system-state.html#navigator", "dfnText": "Navigator", "refSections": [{"refs": [{"id": "ref-for-navigator"}], "title": "3.1. Navigator Mixins"}], "external": true};
window.dfnpanelData['a4785085'] = {"dfnID": "a4785085", "url": "https://html.spec.whatwg.org/multipage/workers.html#workernavigator", "dfnText": "WorkerNavigator", "refSections": [{"refs": [{"id": "ref-for-workernavigator"}], "title": "3.1. Navigator Mixins"}], "external": true};
window.dfnpanelData['474cbfcb'] = {"dfnID": "474cbfcb", "url": "https://html.spec.whatwg.org/multipage/webappapis.html#integration-with-the-javascript-agent-cluster-formalism", "dfnText": "agent cluster", "refSections": [{"refs": [{"id": "ref-for-integration-with-the-javascript-agent-cluster-formalism"}, {"id": "ref-for-integration-with-the-javascript-agent-cluster-formalism\u2460"}], "title": "1. Introduction"}], "external": true};
window.dfnpanelData['0d0390b4'] = {"dfnID": "0d0390b4", "url": "https://html.spec.whatwg.org/multipage/document-sequences.html#browsing-context", "dfnText": "browsing context", "refSections": [{"refs": [{"id": "ref-for-browsing-context"}], "title": "2.1. Resources Names"}, {"refs": [{"id": "ref-for-browsing-context\u2460"}], "title": "2.2. Lock Managers"}], "external": true};
window.dfnpanelData['e4d92278'] = {"dfnID": "e4d92278", "url": "https://html.spec.whatwg.org/multipage/infrastructure.html#enqueue-the-following-steps", "dfnText": "enqueue steps", "refSections": [{"refs": [{"id": "ref-for-enqueue-the-following-steps"}], "title": "2. Concepts"}, {"refs": [{"id": "ref-for-enqueue-the-following-steps\u2460"}], "title": "2.4. Locks"}, {"refs": [{"id": "ref-for-enqueue-the-following-steps\u2461"}], "title": "2.6. Agent Integration"}, {"refs": [{"id": "ref-for-enqueue-the-following-steps\u2462"}], "title": "3.2.1. The request() method"}, {"refs": [{"id": "ref-for-enqueue-the-following-steps\u2463"}], "title": "3.2.2. The query() method"}, {"refs": [{"id": "ref-for-enqueue-the-following-steps\u2464"}, {"id": "ref-for-enqueue-the-following-steps\u2465"}], "title": "4.1. Request a lock"}, {"refs": [{"id": "ref-for-enqueue-the-following-steps\u2466"}], "title": "4.4. Process a lock request queue for a given resource name"}], "external": true};
window.dfnpanelData['102df61f'] = {"dfnID": "102df61f", "url": "https://html.spec.whatwg.org/multipage/infrastructure.html#enqueue-the-following-steps", "dfnText": "enqueue the following steps", "refSections": [{"refs": [{"id": "ref-for-enqueue-the-following-steps"}], "title": "2. Concepts"}, {"refs": [{"id": "ref-for-enqueue-the-following-steps\u2460"}], "title": "2.4. Locks"}, {"refs": [{"id": "ref-for-enqueue-the-following-steps\u2461"}], "title": "2.6. Agent Integration"}, {"refs": [{"id": "ref-for-enqueue-the-following-steps\u2462"}], "title": "3.2.1. The request() method"}, {"refs": [{"id": "ref-for-enqueue-the-following-steps\u2463"}], "title": "3.2.2. The query() method"}, {"refs": [{"id": "ref-for-enqueue-the-following-steps\u2464"}, {"id": "ref-for-enqueue-the-following-steps\u2465"}], "title": "4.1. Request a lock"}, {"refs": [{"id": "ref-for-enqueue-the-following-steps\u2466"}], "title": "4.4. Process a lock request queue for a given resource name"}], "external": true};
window.dfnpanelData['3e12e042'] = {"dfnID": "3e12e042", "url": "https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object", "dfnText": "environment settings object", "refSections": [{"refs": [{"id": "ref-for-environment-settings-object"}], "title": "3.1. Navigator Mixins"}], "external": true};
window.dfnpanelData['73a186aa'] = {"dfnID": "73a186aa", "url": "https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-id", "dfnText": "id", "refSections": [{"refs": [{"id": "ref-for-concept-environment-id"}], "title": "3.2.1. The request() method"}], "external": true};
window.dfnpanelData['55e92c5b'] = {"dfnID": "55e92c5b", "url": "https://html.spec.whatwg.org/multipage/webstorage.html#dom-localstorage", "dfnText": "localstorage", "refSections": [{"refs": [{"id": "ref-for-dom-localstorage"}], "title": "2.2. Lock Managers"}], "external": true};
window.dfnpanelData['b01b1359'] = {"dfnID": "b01b1359", "url": "https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-opaque", "dfnText": "opaque origin", "refSections": [{"refs": [{"id": "ref-for-concept-origin-opaque"}], "title": "3.2.1. The request() method"}, {"refs": [{"id": "ref-for-concept-origin-opaque\u2460"}], "title": "3.2.2. The query() method"}], "external": true};
window.dfnpanelData['086e3aff'] = {"dfnID": "086e3aff", "url": "https://html.spec.whatwg.org/multipage/browsers.html#concept-origin", "dfnText": "origin", "refSections": [{"refs": [{"id": "ref-for-concept-origin"}], "title": "2.1. Resources Names"}, {"refs": [{"id": "ref-for-concept-origin\u2460"}, {"id": "ref-for-concept-origin\u2461"}], "title": "2.2. Lock Managers"}, {"refs": [{"id": "ref-for-concept-origin\u2462"}], "title": "2.4. Locks"}, {"refs": [{"id": "ref-for-concept-origin\u2463"}], "title": "3.2.1. The request() method"}, {"refs": [{"id": "ref-for-concept-origin\u2464"}], "title": "3.2.2. The query() method"}], "external": true};
window.dfnpanelData['9c4c1e66'] = {"dfnID": "9c4c1e66", "url": "https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object", "dfnText": "relevant settings object", "refSections": [{"refs": [{"id": "ref-for-relevant-settings-object"}], "title": "3.1. Navigator Mixins"}, {"refs": [{"id": "ref-for-relevant-settings-object\u2460"}], "title": "3.2.1. The request() method"}, {"refs": [{"id": "ref-for-relevant-settings-object\u2461"}], "title": "3.2.2. The query() method"}, {"refs": [{"id": "ref-for-relevant-settings-object\u2462"}], "title": "4.1. Request a lock"}, {"refs": [{"id": "ref-for-relevant-settings-object\u2463"}], "title": "4.4. Process a lock request queue for a given resource name"}], "external": true};
window.dfnpanelData['e3288657'] = {"dfnID": "e3288657", "url": "https://html.spec.whatwg.org/multipage/webappapis.html#responsible-event-loop", "dfnText": "responsible event loop", "refSections": [{"refs": [{"id": "ref-for-responsible-event-loop"}], "title": "4.1. Request a lock"}, {"refs": [{"id": "ref-for-responsible-event-loop\u2460"}], "title": "4.4. Process a lock request queue for a given resource name"}], "external": true};
window.dfnpanelData['8219d486'] = {"dfnID": "8219d486", "url": "https://html.spec.whatwg.org/multipage/infrastructure.html#starting-a-new-parallel-queue", "dfnText": "starting a new parallel queue", "refSections": [{"refs": [{"id": "ref-for-starting-a-new-parallel-queue"}], "title": "2. Concepts"}], "external": true};
window.dfnpanelData['c3b2d08c'] = {"dfnID": "c3b2d08c", "url": "https://html.spec.whatwg.org/multipage/webappapis.html#task-source", "dfnText": "task source", "refSections": [{"refs": [{"id": "ref-for-task-source"}], "title": "2. Concepts"}], "external": true};
window.dfnpanelData['53275e46'] = {"dfnID": "53275e46", "url": "https://infra.spec.whatwg.org/#list-append", "dfnText": "append (for list)", "refSections": [{"refs": [{"id": "ref-for-list-append"}, {"id": "ref-for-list-append\u2460"}], "title": "4.5. Snapshot the lock state"}], "external": true};
window.dfnpanelData['a3b18719'] = {"dfnID": "a3b18719", "url": "https://infra.spec.whatwg.org/#set-append", "dfnText": "append (for set)", "refSections": [{"refs": [{"id": "ref-for-set-append"}], "title": "4.4. Process a lock request queue for a given resource name"}], "external": true};
window.dfnpanelData['77b4c09a'] = {"dfnID": "77b4c09a", "url": "https://infra.spec.whatwg.org/#assert", "dfnText": "assert", "refSections": [{"refs": [{"id": "ref-for-assert"}], "title": "4.2. Release a lock"}, {"refs": [{"id": "ref-for-assert\u2460"}], "title": "4.3. Abort a request"}, {"refs": [{"id": "ref-for-assert\u2461"}], "title": "4.4. Process a lock request queue for a given resource name"}, {"refs": [{"id": "ref-for-assert\u2462"}], "title": "4.5. Snapshot the lock state"}], "external": true};
window.dfnpanelData['06a6db54'] = {"dfnID": "06a6db54", "url": "https://infra.spec.whatwg.org/#queue-enqueue", "dfnText": "enqueue", "refSections": [{"refs": [{"id": "ref-for-queue-enqueue"}], "title": "4.1. Request a lock"}], "external": true};
window.dfnpanelData['16d07e10'] = {"dfnID": "16d07e10", "url": "https://infra.spec.whatwg.org/#list-iterate", "dfnText": "for each (for list)", "refSections": [{"refs": [{"id": "ref-for-list-iterate"}], "title": "4.1. Request a lock"}, {"refs": [{"id": "ref-for-list-iterate\u2460"}], "title": "4.4. Process a lock request queue for a given resource name"}, {"refs": [{"id": "ref-for-list-iterate\u2461"}, {"id": "ref-for-list-iterate\u2462"}], "title": "4.5. Snapshot the lock state"}], "external": true};
window.dfnpanelData['45209803'] = {"dfnID": "45209803", "url": "https://infra.spec.whatwg.org/#map-iterate", "dfnText": "for each (for map)", "refSections": [{"refs": [{"id": "ref-for-map-iterate"}], "title": "4.5. Snapshot the lock state"}], "external": true};
window.dfnpanelData['c88f3887'] = {"dfnID": "c88f3887", "url": "https://infra.spec.whatwg.org/#struct-item", "dfnText": "item", "refSections": [{"refs": [{"id": "ref-for-struct-item"}], "title": "2.5. Lock Requests"}], "external": true};
window.dfnpanelData['b38d7ca1'] = {"dfnID": "b38d7ca1", "url": "https://infra.spec.whatwg.org/#string", "dfnText": "javascript string", "refSections": [{"refs": [{"id": "ref-for-string"}], "title": "2.1. Resources Names"}], "external": true};
window.dfnpanelData['649608b9'] = {"dfnID": "649608b9", "url": "https://infra.spec.whatwg.org/#list", "dfnText": "list", "refSections": [{"refs": [{"id": "ref-for-list"}, {"id": "ref-for-list\u2460"}], "title": "4.5. Snapshot the lock state"}], "external": true};
window.dfnpanelData['3fca5a9e'] = {"dfnID": "3fca5a9e", "url": "https://infra.spec.whatwg.org/#ordered-map", "dfnText": "map", "refSections": [{"refs": [{"id": "ref-for-ordered-map"}], "title": "2.5. Lock Requests"}], "external": true};
window.dfnpanelData['e2fc6023'] = {"dfnID": "e2fc6023", "url": "https://infra.spec.whatwg.org/#list-prepend", "dfnText": "prepend", "refSections": [{"refs": [{"id": "ref-for-list-prepend"}], "title": "4.1. Request a lock"}], "external": true};
window.dfnpanelData['47dfca75'] = {"dfnID": "47dfca75", "url": "https://infra.spec.whatwg.org/#queue", "dfnText": "queue", "refSections": [{"refs": [{"id": "ref-for-queue"}], "title": "2.5. Lock Requests"}], "external": true};
window.dfnpanelData['99c988d6'] = {"dfnID": "99c988d6", "url": "https://infra.spec.whatwg.org/#list-remove", "dfnText": "remove", "refSections": [{"refs": [{"id": "ref-for-list-remove"}], "title": "4.1. Request a lock"}, {"refs": [{"id": "ref-for-list-remove\u2460"}], "title": "4.2. Release a lock"}, {"refs": [{"id": "ref-for-list-remove\u2461"}], "title": "4.3. Abort a request"}, {"refs": [{"id": "ref-for-list-remove\u2462"}], "title": "4.4. Process a lock request queue for a given resource name"}], "external": true};
window.dfnpanelData['15e48c39'] = {"dfnID": "15e48c39", "url": "https://infra.spec.whatwg.org/#ordered-set", "dfnText": "set", "refSections": [{"refs": [{"id": "ref-for-ordered-set"}], "title": "2.4. Locks"}], "external": true};
window.dfnpanelData['984221ca'] = {"dfnID": "984221ca", "url": "https://infra.spec.whatwg.org/#struct", "dfnText": "struct", "refSections": [{"refs": [{"id": "ref-for-struct"}], "title": "2.5. Lock Requests"}], "external": true};
window.dfnpanelData['12d6b9a8'] = {"dfnID": "12d6b9a8", "url": "https://infra.spec.whatwg.org/#map-getting-the-values", "dfnText": "values", "refSections": [{"refs": [{"id": "ref-for-map-getting-the-values"}], "title": "4.5. Snapshot the lock state"}], "external": true};
window.dfnpanelData['3b7e827f'] = {"dfnID": "3b7e827f", "url": "https://w3c.github.io/ServiceWorker/#client", "dfnText": "Client", "refSections": [{"refs": [{"id": "ref-for-client"}], "title": "3.2.2. The query() method"}], "external": true};
window.dfnpanelData['87d2dc25'] = {"dfnID": "87d2dc25", "url": "https://w3c.github.io/ServiceWorker/#dom-client-id", "dfnText": "id", "refSections": [{"refs": [{"id": "ref-for-dom-client-id"}], "title": "3.2.2. The query() method"}], "external": true};
window.dfnpanelData['daed3f4b'] = {"dfnID": "daed3f4b", "url": "https://storage.spec.whatwg.org/#storage-shelf", "dfnText": "storage shelf", "refSections": [{"refs": [{"id": "ref-for-storage-shelf"}], "title": "2.2. Lock Managers"}], "external": true};
window.dfnpanelData['d25dfb2c'] = {"dfnID": "d25dfb2c", "url": "https://webidl.spec.whatwg.org/#aborterror", "dfnText": "AbortError", "refSections": [{"refs": [{"id": "ref-for-aborterror"}, {"id": "ref-for-aborterror\u2460"}, {"id": "ref-for-aborterror\u2461"}, {"id": "ref-for-aborterror\u2462"}], "title": "3.2.1. The request() method"}, {"refs": [{"id": "ref-for-aborterror\u2463"}], "title": "4.1. Request a lock"}], "external": true};
window.dfnpanelData['dca2de17'] = {"dfnID": "dca2de17", "url": "https://webidl.spec.whatwg.org/#idl-DOMException", "dfnText": "DOMException", "refSections": [{"refs": [{"id": "ref-for-idl-DOMException"}, {"id": "ref-for-idl-DOMException\u2460"}, {"id": "ref-for-idl-DOMException\u2461"}, {"id": "ref-for-idl-DOMException\u2462"}, {"id": "ref-for-idl-DOMException\u2463"}, {"id": "ref-for-idl-DOMException\u2464"}], "title": "3.2.1. The request() method"}, {"refs": [{"id": "ref-for-idl-DOMException\u2465"}], "title": "3.2.2. The query() method"}, {"refs": [{"id": "ref-for-idl-DOMException\u2466"}], "title": "4.1. Request a lock"}], "external": true};
window.dfnpanelData['8855a9aa'] = {"dfnID": "8855a9aa", "url": "https://webidl.spec.whatwg.org/#idl-DOMString", "dfnText": "DOMString", "refSections": [{"refs": [{"id": "ref-for-idl-DOMString"}, {"id": "ref-for-idl-DOMString\u2460"}, {"id": "ref-for-idl-DOMString\u2461"}, {"id": "ref-for-idl-DOMString\u2462"}], "title": "3.2. LockManager class"}, {"refs": [{"id": "ref-for-idl-DOMString\u2463"}], "title": "3.3. Lock class"}], "external": true};
window.dfnpanelData['889e932f'] = {"dfnID": "889e932f", "url": "https://webidl.spec.whatwg.org/#Exposed", "dfnText": "Exposed", "refSections": [{"refs": [{"id": "ref-for-Exposed"}], "title": "3.2. LockManager class"}, {"refs": [{"id": "ref-for-Exposed\u2460"}], "title": "3.3. Lock class"}], "external": true};
window.dfnpanelData['3182eb71'] = {"dfnID": "3182eb71", "url": "https://webidl.spec.whatwg.org/#notsupportederror", "dfnText": "NotSupportedError", "refSections": [{"refs": [{"id": "ref-for-notsupportederror"}, {"id": "ref-for-notsupportederror\u2460"}, {"id": "ref-for-notsupportederror\u2461"}, {"id": "ref-for-notsupportederror\u2462"}], "title": "3.2.1. The request() method"}], "external": true};
window.dfnpanelData['bdbd19d1'] = {"dfnID": "bdbd19d1", "url": "https://webidl.spec.whatwg.org/#idl-promise", "dfnText": "Promise", "refSections": [{"refs": [{"id": "ref-for-idl-promise"}, {"id": "ref-for-idl-promise\u2460"}, {"id": "ref-for-idl-promise\u2461"}, {"id": "ref-for-idl-promise\u2462"}], "title": "3.2. LockManager class"}], "external": true};
window.dfnpanelData['b75bb3bd'] = {"dfnID": "b75bb3bd", "url": "https://webidl.spec.whatwg.org/#SecureContext", "dfnText": "SecureContext", "refSections": [{"refs": [{"id": "ref-for-SecureContext"}], "title": "3.1. Navigator Mixins"}, {"refs": [{"id": "ref-for-SecureContext\u2460"}], "title": "3.2. LockManager class"}, {"refs": [{"id": "ref-for-SecureContext\u2461"}], "title": "3.3. Lock class"}], "external": true};
window.dfnpanelData['c3e881ef'] = {"dfnID": "c3e881ef", "url": "https://webidl.spec.whatwg.org/#securityerror", "dfnText": "SecurityError", "refSections": [{"refs": [{"id": "ref-for-securityerror"}], "title": "3.2.1. The request() method"}, {"refs": [{"id": "ref-for-securityerror\u2460"}], "title": "3.2.2. The query() method"}], "external": true};
window.dfnpanelData['dacde8b5'] = {"dfnID": "dacde8b5", "url": "https://webidl.spec.whatwg.org/#a-new-promise", "dfnText": "a new promise", "refSections": [{"refs": [{"id": "ref-for-a-new-promise"}], "title": "3.2.1. The request() method"}, {"refs": [{"id": "ref-for-a-new-promise\u2460"}], "title": "3.2.2. The query() method"}, {"refs": [{"id": "ref-for-a-new-promise\u2461"}], "title": "4.4. Process a lock request queue for a given resource name"}], "external": true};
window.dfnpanelData['d0b4a948'] = {"dfnID": "d0b4a948", "url": "https://webidl.spec.whatwg.org/#a-promise-rejected-with", "dfnText": "a promise rejected with", "refSections": [{"refs": [{"id": "ref-for-a-promise-rejected-with"}, {"id": "ref-for-a-promise-rejected-with\u2460"}, {"id": "ref-for-a-promise-rejected-with\u2461"}, {"id": "ref-for-a-promise-rejected-with\u2462"}, {"id": "ref-for-a-promise-rejected-with\u2463"}, {"id": "ref-for-a-promise-rejected-with\u2464"}], "title": "3.2.1. The request() method"}, {"refs": [{"id": "ref-for-a-promise-rejected-with\u2465"}], "title": "3.2.2. The query() method"}], "external": true};
window.dfnpanelData['6c6b1005'] = {"dfnID": "6c6b1005", "url": "https://webidl.spec.whatwg.org/#idl-any", "dfnText": "any", "refSections": [{"refs": [{"id": "ref-for-idl-any"}, {"id": "ref-for-idl-any\u2460"}, {"id": "ref-for-idl-any\u2461"}], "title": "3.2. LockManager class"}], "external": true};
window.dfnpanelData['5372cca8'] = {"dfnID": "5372cca8", "url": "https://webidl.spec.whatwg.org/#idl-boolean", "dfnText": "boolean", "refSections": [{"refs": [{"id": "ref-for-idl-boolean"}, {"id": "ref-for-idl-boolean\u2460"}], "title": "3.2. LockManager class"}], "external": true};
window.dfnpanelData['3ab7bf79'] = {"dfnID": "3ab7bf79", "url": "https://webidl.spec.whatwg.org/#dfn-callback-function", "dfnText": "callback function", "refSections": [{"refs": [{"id": "ref-for-dfn-callback-function"}], "title": "3.2.1. The request() method"}], "external": true};
window.dfnpanelData['10ce5f6f'] = {"dfnID": "10ce5f6f", "url": "https://webidl.spec.whatwg.org/#invoke-a-callback-function", "dfnText": "invoke", "refSections": [{"refs": [{"id": "ref-for-invoke-a-callback-function"}], "title": "4.1. Request a lock"}, {"refs": [{"id": "ref-for-invoke-a-callback-function\u2460"}], "title": "4.4. Process a lock request queue for a given resource name"}], "external": true};
window.dfnpanelData['b262501e'] = {"dfnID": "b262501e", "url": "https://webidl.spec.whatwg.org/#reject", "dfnText": "reject", "refSections": [{"refs": [{"id": "ref-for-reject"}], "title": "3.2.1. The request() method"}, {"refs": [{"id": "ref-for-reject\u2460"}], "title": "4.1. Request a lock"}], "external": true};
window.dfnpanelData['3b90bdcd'] = {"dfnID": "3b90bdcd", "url": "https://webidl.spec.whatwg.org/#resolve", "dfnText": "resolve", "refSections": [{"refs": [{"id": "ref-for-resolve"}], "title": "2.4. Locks"}, {"refs": [{"id": "ref-for-resolve\u2460"}], "title": "4.1. Request a lock"}, {"refs": [{"id": "ref-for-resolve\u2461"}], "title": "4.4. Process a lock request queue for a given resource name"}, {"refs": [{"id": "ref-for-resolve\u2462"}], "title": "4.5. Snapshot the lock state"}], "external": true};
window.dfnpanelData['9cce47fd'] = {"dfnID": "9cce47fd", "url": "https://webidl.spec.whatwg.org/#idl-sequence", "dfnText": "sequence", "refSections": [{"refs": [{"id": "ref-for-idl-sequence"}, {"id": "ref-for-idl-sequence\u2460"}], "title": "3.2. LockManager class"}], "external": true};
window.dfnpanelData['4013a022'] = {"dfnID": "4013a022", "url": "https://webidl.spec.whatwg.org/#this", "dfnText": "this", "refSections": [{"refs": [{"id": "ref-for-this"}], "title": "3.1. Navigator Mixins"}, {"refs": [{"id": "ref-for-this\u2460"}], "title": "3.2.1. The request() method"}, {"refs": [{"id": "ref-for-this\u2461"}], "title": "3.2.2. The query() method"}], "external": true};
window.dfnpanelData['lock-task-queue'] = {"dfnID": "lock-task-queue", "url": "#lock-task-queue", "dfnText": "lock task queue", "refSections": [{"refs": [{"id": "ref-for-lock-task-queue"}], "title": "2.4. Locks"}, {"refs": [{"id": "ref-for-lock-task-queue\u2460"}], "title": "2.6. Agent Integration"}, {"refs": [{"id": "ref-for-lock-task-queue\u2461"}], "title": "3.2.1. The request() method"}, {"refs": [{"id": "ref-for-lock-task-queue\u2462"}], "title": "3.2.2. The query() method"}, {"refs": [{"id": "ref-for-lock-task-queue\u2463"}], "title": "4.1. Request a lock"}, {"refs": [{"id": "ref-for-lock-task-queue\u2464"}], "title": "4.2. Release a lock"}, {"refs": [{"id": "ref-for-lock-task-queue\u2465"}], "title": "4.3. Abort a request"}, {"refs": [{"id": "ref-for-lock-task-queue\u2466"}], "title": "4.4. Process a lock request queue for a given resource name"}, {"refs": [{"id": "ref-for-lock-task-queue\u2467"}], "title": "4.5. Snapshot the lock state"}], "external": false};
window.dfnpanelData['resource-name'] = {"dfnID": "resource-name", "url": "#resource-name", "dfnText": "resource name", "refSections": [{"refs": [{"id": "ref-for-resource-name"}, {"id": "ref-for-resource-name\u2460"}], "title": "1. Introduction"}, {"refs": [{"id": "ref-for-resource-name\u2461"}], "title": "2.4. Locks"}, {"refs": [{"id": "ref-for-resource-name\u2462"}], "title": "2.5. Lock Requests"}, {"refs": [{"id": "ref-for-resource-name\u2463"}], "title": "3.2.1. The request() method"}, {"refs": [{"id": "ref-for-resource-name\u2464"}], "title": "4.2. Release a lock"}, {"refs": [{"id": "ref-for-resource-name\u2465"}], "title": "6.4. Checklist"}], "external": false};
window.dfnpanelData['lock-manager'] = {"dfnID": "lock-manager", "url": "#lock-manager", "dfnText": "lock manager", "refSections": [{"refs": [{"id": "ref-for-lock-manager"}], "title": "2.2. Lock Managers"}, {"refs": [{"id": "ref-for-lock-manager\u2460"}], "title": "3.2. LockManager class"}, {"refs": [{"id": "ref-for-lock-manager\u2461"}, {"id": "ref-for-lock-manager\u2462"}], "title": "3.2.2. The query() method"}, {"refs": [{"id": "ref-for-lock-manager\u2463"}], "title": "5.1. Deadlocks"}, {"refs": [{"id": "ref-for-lock-manager\u2464"}], "title": "6.1. Lock Scope"}], "external": false};
window.dfnpanelData['mode'] = {"dfnID": "mode", "url": "#mode", "dfnText": "mode", "refSections": [{"refs": [{"id": "ref-for-mode"}, {"id": "ref-for-mode\u2460"}], "title": "1. Introduction"}], "external": false};
window.dfnpanelData['lock-concept'] = {"dfnID": "lock-concept", "url": "#lock-concept", "dfnText": "lock", "refSections": [{"refs": [{"id": "ref-for-lock-concept"}], "title": "1. Introduction"}, {"refs": [{"id": "ref-for-lock-concept\u2460"}], "title": "2.2. Lock Managers"}, {"refs": [{"id": "ref-for-lock-concept\u2461"}, {"id": "ref-for-lock-concept\u2462"}, {"id": "ref-for-lock-concept\u2463"}, {"id": "ref-for-lock-concept\u2464"}, {"id": "ref-for-lock-concept\u2465"}, {"id": "ref-for-lock-concept\u2466"}, {"id": "ref-for-lock-concept\u2467"}, {"id": "ref-for-lock-concept\u2468"}, {"id": "ref-for-lock-concept\u2460\u24ea"}], "title": "2.4. Locks"}, {"refs": [{"id": "ref-for-lock-concept\u2460\u2460"}, {"id": "ref-for-lock-concept\u2460\u2461"}, {"id": "ref-for-lock-concept\u2460\u2462"}], "title": "2.5. Lock Requests"}, {"refs": [{"id": "ref-for-lock-concept\u2460\u2463"}], "title": "2.6. Agent Integration"}, {"refs": [{"id": "ref-for-lock-concept\u2460\u2464"}, {"id": "ref-for-lock-concept\u2460\u2465"}, {"id": "ref-for-lock-concept\u2460\u2466"}], "title": "3.3. Lock class"}, {"refs": [{"id": "ref-for-lock-concept\u2460\u2467"}], "title": "4.1. Request a lock"}, {"refs": [{"id": "ref-for-lock-concept\u2460\u2468"}], "title": "4.2. Release a lock"}, {"refs": [{"id": "ref-for-lock-concept\u2461\u24ea"}], "title": "4.4. Process a lock request queue for a given resource name"}], "external": false};
window.dfnpanelData['lock-concept-agent'] = {"dfnID": "lock-concept-agent", "url": "#lock-concept-agent", "dfnText": "agent", "refSections": [{"refs": [{"id": "ref-for-lock-concept-agent"}], "title": "2.6. Agent Integration"}, {"refs": [{"id": "ref-for-lock-concept-agent\u2460"}, {"id": "ref-for-lock-concept-agent\u2461"}], "title": "4.4. Process a lock request queue for a given resource name"}], "external": false};
window.dfnpanelData['lock-concept-clientid'] = {"dfnID": "lock-concept-clientid", "url": "#lock-concept-clientid", "dfnText": "clientId", "refSections": [{"refs": [{"id": "ref-for-lock-concept-clientid"}], "title": "4.4. Process a lock request queue for a given resource name"}, {"refs": [{"id": "ref-for-lock-concept-clientid\u2460"}], "title": "4.5. Snapshot the lock state"}], "external": false};
window.dfnpanelData['lock-concept-origin'] = {"dfnID": "lock-concept-origin", "url": "#lock-concept-origin", "dfnText": "origin", "refSections": [{"refs": [{"id": "ref-for-lock-concept-origin"}], "title": "4.2. Release a lock"}, {"refs": [{"id": "ref-for-lock-concept-origin\u2460"}], "title": "4.4. Process a lock request queue for a given resource name"}], "external": false};
window.dfnpanelData['lock-concept-name'] = {"dfnID": "lock-concept-name", "url": "#lock-concept-name", "dfnText": "name", "refSections": [{"refs": [{"id": "ref-for-lock-concept-name"}, {"id": "ref-for-lock-concept-name\u2460"}], "title": "2.5. Lock Requests"}, {"refs": [{"id": "ref-for-lock-concept-name\u2461"}], "title": "3.3. Lock class"}, {"refs": [{"id": "ref-for-lock-concept-name\u2462"}], "title": "4.1. Request a lock"}, {"refs": [{"id": "ref-for-lock-concept-name\u2463"}], "title": "4.4. Process a lock request queue for a given resource name"}, {"refs": [{"id": "ref-for-lock-concept-name\u2464"}], "title": "4.5. Snapshot the lock state"}], "external": false};
window.dfnpanelData['lock-concept-mode'] = {"dfnID": "lock-concept-mode", "url": "#lock-concept-mode", "dfnText": "mode", "refSections": [{"refs": [{"id": "ref-for-lock-concept-mode"}], "title": "2.5. Lock Requests"}, {"refs": [{"id": "ref-for-lock-concept-mode\u2460"}], "title": "3.3. Lock class"}, {"refs": [{"id": "ref-for-lock-concept-mode\u2461"}], "title": "4.4. Process a lock request queue for a given resource name"}, {"refs": [{"id": "ref-for-lock-concept-mode\u2462"}], "title": "4.5. Snapshot the lock state"}], "external": false};
window.dfnpanelData['lock-concept-waiting-promise'] = {"dfnID": "lock-concept-waiting-promise", "url": "#lock-concept-waiting-promise", "dfnText": "waiting promise", "refSections": [{"refs": [{"id": "ref-for-lock-concept-waiting-promise"}, {"id": "ref-for-lock-concept-waiting-promise\u2460"}, {"id": "ref-for-lock-concept-waiting-promise\u2461"}, {"id": "ref-for-lock-concept-waiting-promise\u2462"}, {"id": "ref-for-lock-concept-waiting-promise\u2463"}], "title": "2.4. Locks"}, {"refs": [{"id": "ref-for-lock-concept-waiting-promise\u2464"}], "title": "4.4. Process a lock request queue for a given resource name"}], "external": false};
window.dfnpanelData['lock-concept-released-promise'] = {"dfnID": "lock-concept-released-promise", "url": "#lock-concept-released-promise", "dfnText": "released promise", "refSections": [{"refs": [{"id": "ref-for-lock-concept-released-promise"}, {"id": "ref-for-lock-concept-released-promise\u2460"}, {"id": "ref-for-lock-concept-released-promise\u2461"}, {"id": "ref-for-lock-concept-released-promise\u2462"}], "title": "2.4. Locks"}, {"refs": [{"id": "ref-for-lock-concept-released-promise\u2463"}], "title": "3.2.1. The request() method"}, {"refs": [{"id": "ref-for-lock-concept-released-promise\u2464"}], "title": "4.1. Request a lock"}, {"refs": [{"id": "ref-for-lock-concept-released-promise\u2465"}], "title": "4.4. Process a lock request queue for a given resource name"}], "external": false};
window.dfnpanelData['lock-concept-held-lock-set'] = {"dfnID": "lock-concept-held-lock-set", "url": "#lock-concept-held-lock-set", "dfnText": "held lock set", "refSections": [{"refs": [{"id": "ref-for-lock-concept-held-lock-set"}], "title": "2.5. Lock Requests"}, {"refs": [{"id": "ref-for-lock-concept-held-lock-set\u2460"}], "title": "4.1. Request a lock"}, {"refs": [{"id": "ref-for-lock-concept-held-lock-set\u2461"}], "title": "4.2. Release a lock"}, {"refs": [{"id": "ref-for-lock-concept-held-lock-set\u2462"}], "title": "4.4. Process a lock request queue for a given resource name"}, {"refs": [{"id": "ref-for-lock-concept-held-lock-set\u2463"}], "title": "4.5. Snapshot the lock state"}], "external": false};
window.dfnpanelData['lock-request'] = {"dfnID": "lock-request", "url": "#lock-request", "dfnText": "lock request", "refSections": [{"refs": [{"id": "ref-for-lock-request"}], "title": "1. Introduction"}, {"refs": [{"id": "ref-for-lock-request\u2460"}], "title": "2.2. Lock Managers"}, {"refs": [{"id": "ref-for-lock-request\u2461"}, {"id": "ref-for-lock-request\u2462"}, {"id": "ref-for-lock-request\u2463"}, {"id": "ref-for-lock-request\u2464"}, {"id": "ref-for-lock-request\u2465"}], "title": "2.5. Lock Requests"}, {"refs": [{"id": "ref-for-lock-request\u2466"}], "title": "2.6. Agent Integration"}, {"refs": [{"id": "ref-for-lock-request\u2467"}], "title": "3.2. LockManager class"}, {"refs": [{"id": "ref-for-lock-request\u2468"}], "title": "4.1. Request a lock"}], "external": false};
window.dfnpanelData['lock-request-agent'] = {"dfnID": "lock-request-agent", "url": "#lock-request-agent", "dfnText": "agent", "refSections": [{"refs": [{"id": "ref-for-lock-request-agent"}], "title": "2.6. Agent Integration"}], "external": false};
window.dfnpanelData['lock-request-clientid'] = {"dfnID": "lock-request-clientid", "url": "#lock-request-clientid", "dfnText": "clientId", "refSections": [{"refs": [{"id": "ref-for-lock-request-clientid"}], "title": "4.4. Process a lock request queue for a given resource name"}, {"refs": [{"id": "ref-for-lock-request-clientid\u2460"}], "title": "4.5. Snapshot the lock state"}], "external": false};
window.dfnpanelData['lock-request-origin'] = {"dfnID": "lock-request-origin", "url": "#lock-request-origin", "dfnText": "origin", "refSections": [{"refs": [{"id": "ref-for-lock-request-origin"}], "title": "2.5. Lock Requests"}, {"refs": [{"id": "ref-for-lock-request-origin\u2460"}], "title": "4.3. Abort a request"}], "external": false};
window.dfnpanelData['lock-request-name'] = {"dfnID": "lock-request-name", "url": "#lock-request-name", "dfnText": "name", "refSections": [{"refs": [{"id": "ref-for-lock-request-name"}], "title": "2.5. Lock Requests"}, {"refs": [{"id": "ref-for-lock-request-name\u2460"}], "title": "4.3. Abort a request"}, {"refs": [{"id": "ref-for-lock-request-name\u2461"}], "title": "4.4. Process a lock request queue for a given resource name"}, {"refs": [{"id": "ref-for-lock-request-name\u2462"}], "title": "4.5. Snapshot the lock state"}], "external": false};
window.dfnpanelData['lock-request-mode'] = {"dfnID": "lock-request-mode", "url": "#lock-request-mode", "dfnText": "mode", "refSections": [{"refs": [{"id": "ref-for-lock-request-mode"}], "title": "2.5. Lock Requests"}, {"refs": [{"id": "ref-for-lock-request-mode\u2460"}], "title": "4.4. Process a lock request queue for a given resource name"}, {"refs": [{"id": "ref-for-lock-request-mode\u2461"}], "title": "4.5. Snapshot the lock state"}], "external": false};
window.dfnpanelData['lock-request-promise'] = {"dfnID": "lock-request-promise", "url": "#lock-request-promise", "dfnText": "promise", "refSections": [{"refs": [{"id": "ref-for-lock-request-promise"}], "title": "4.4. Process a lock request queue for a given resource name"}], "external": false};
window.dfnpanelData['lock-request-lock-request-queue'] = {"dfnID": "lock-request-lock-request-queue", "url": "#lock-request-lock-request-queue", "dfnText": "lock request queue", "refSections": [{"refs": [{"id": "ref-for-lock-request-lock-request-queue"}], "title": "2.5. Lock Requests"}], "external": false};
window.dfnpanelData['lock-request-lock-request-queue-map'] = {"dfnID": "lock-request-lock-request-queue-map", "url": "#lock-request-lock-request-queue-map", "dfnText": "lock request queue map", "refSections": [{"refs": [{"id": "ref-for-lock-request-lock-request-queue-map"}], "title": "2.5. Lock Requests"}, {"refs": [{"id": "ref-for-lock-request-lock-request-queue-map\u2460"}], "title": "4.1. Request a lock"}, {"refs": [{"id": "ref-for-lock-request-lock-request-queue-map\u2461"}], "title": "4.2. Release a lock"}, {"refs": [{"id": "ref-for-lock-request-lock-request-queue-map\u2462"}], "title": "4.3. Abort a request"}, {"refs": [{"id": "ref-for-lock-request-lock-request-queue-map\u2463"}], "title": "4.5. Snapshot the lock state"}], "external": false};
window.dfnpanelData['lock-request-grantable'] = {"dfnID": "lock-request-grantable", "url": "#lock-request-grantable", "dfnText": "grantable", "refSections": [{"refs": [{"id": "ref-for-lock-request-grantable"}], "title": "4.1. Request a lock"}, {"refs": [{"id": "ref-for-lock-request-grantable\u2460"}], "title": "4.4. Process a lock request queue for a given resource name"}], "external": false};
window.dfnpanelData['navigatorlocks'] = {"dfnID": "navigatorlocks", "url": "#navigatorlocks", "dfnText": "NavigatorLocks", "refSections": [{"refs": [{"id": "ref-for-navigatorlocks"}, {"id": "ref-for-navigatorlocks\u2460"}], "title": "3.1. Navigator Mixins"}], "external": false};
window.dfnpanelData['dom-navigatorlocks-locks'] = {"dfnID": "dom-navigatorlocks-locks", "url": "#dom-navigatorlocks-locks", "dfnText": "locks", "refSections": [{"refs": [{"id": "ref-for-dom-navigatorlocks-locks"}], "title": "3.1. Navigator Mixins"}], "external": false};
window.dfnpanelData['lockmanager'] = {"dfnID": "lockmanager", "url": "#lockmanager", "dfnText": "LockManager", "refSections": [{"refs": [{"id": "ref-for-lockmanager"}], "title": "2.4. Locks"}, {"refs": [{"id": "ref-for-lockmanager\u2460"}, {"id": "ref-for-lockmanager\u2461"}, {"id": "ref-for-lockmanager\u2462"}], "title": "3.1. Navigator Mixins"}, {"refs": [{"id": "ref-for-lockmanager\u2463"}, {"id": "ref-for-lockmanager\u2464"}], "title": "3.2. LockManager class"}], "external": false};
window.dfnpanelData['callbackdef-lockgrantedcallback'] = {"dfnID": "callbackdef-lockgrantedcallback", "url": "#callbackdef-lockgrantedcallback", "dfnText": "LockGrantedCallback", "refSections": [{"refs": [{"id": "ref-for-callbackdef-lockgrantedcallback"}, {"id": "ref-for-callbackdef-lockgrantedcallback\u2460"}], "title": "3.2. LockManager class"}], "external": false};
window.dfnpanelData['enumdef-lockmode'] = {"dfnID": "enumdef-lockmode", "url": "#enumdef-lockmode", "dfnText": "LockMode", "refSections": [{"refs": [{"id": "ref-for-enumdef-lockmode"}, {"id": "ref-for-enumdef-lockmode\u2460"}], "title": "3.2. LockManager class"}, {"refs": [{"id": "ref-for-enumdef-lockmode\u2461"}], "title": "3.3. Lock class"}], "external": false};
window.dfnpanelData['dom-lockmode-shared'] = {"dfnID": "dom-lockmode-shared", "url": "#dom-lockmode-shared", "dfnText": "\"shared\"", "refSections": [{"refs": [{"id": "ref-for-dom-lockmode-shared"}, {"id": "ref-for-dom-lockmode-shared\u2460"}, {"id": "ref-for-dom-lockmode-shared\u2461"}], "title": "2.3. Modes and Scheduling"}, {"refs": [{"id": "ref-for-dom-lockmode-shared\u2462"}], "title": "2.4. Locks"}, {"refs": [{"id": "ref-for-dom-lockmode-shared\u2463"}], "title": "2.5. Lock Requests"}, {"refs": [{"id": "ref-for-dom-lockmode-shared\u2464"}, {"id": "ref-for-dom-lockmode-shared\u2465"}], "title": "3.2.1. The request() method"}], "external": false};
window.dfnpanelData['dom-lockmode-exclusive'] = {"dfnID": "dom-lockmode-exclusive", "url": "#dom-lockmode-exclusive", "dfnText": "\"exclusive\"", "refSections": [{"refs": [{"id": "ref-for-dom-lockmode-exclusive"}, {"id": "ref-for-dom-lockmode-exclusive\u2460"}, {"id": "ref-for-dom-lockmode-exclusive\u2461"}, {"id": "ref-for-dom-lockmode-exclusive\u2462"}], "title": "2.3. Modes and Scheduling"}, {"refs": [{"id": "ref-for-dom-lockmode-exclusive\u2463"}], "title": "2.4. Locks"}, {"refs": [{"id": "ref-for-dom-lockmode-exclusive\u2464"}, {"id": "ref-for-dom-lockmode-exclusive\u2465"}], "title": "2.5. Lock Requests"}, {"refs": [{"id": "ref-for-dom-lockmode-exclusive\u2466"}, {"id": "ref-for-dom-lockmode-exclusive\u2467"}, {"id": "ref-for-dom-lockmode-exclusive\u2468"}], "title": "3.2.1. The request() method"}], "external": false};
window.dfnpanelData['dictdef-lockoptions'] = {"dfnID": "dictdef-lockoptions", "url": "#dictdef-lockoptions", "dfnText": "LockOptions", "refSections": [{"refs": [{"id": "ref-for-dictdef-lockoptions"}], "title": "3.2. LockManager class"}, {"refs": [{"id": "ref-for-dictdef-lockoptions\u2460"}], "title": "3.2.1. The request() method"}], "external": false};
window.dfnpanelData['dom-lockoptions-mode'] = {"dfnID": "dom-lockoptions-mode", "url": "#dom-lockoptions-mode", "dfnText": "mode", "refSections": [{"refs": [{"id": "ref-for-dom-lockoptions-mode"}], "title": "3.2.1. The request() method"}], "external": false};
window.dfnpanelData['dom-lockoptions-ifavailable'] = {"dfnID": "dom-lockoptions-ifavailable", "url": "#dom-lockoptions-ifavailable", "dfnText": "ifAvailable", "refSections": [{"refs": [{"id": "ref-for-dom-lockoptions-ifavailable"}], "title": "3.2.1. The request() method"}], "external": false};
window.dfnpanelData['dom-lockoptions-steal'] = {"dfnID": "dom-lockoptions-steal", "url": "#dom-lockoptions-steal", "dfnText": "steal", "refSections": [{"refs": [{"id": "ref-for-dom-lockoptions-steal"}, {"id": "ref-for-dom-lockoptions-steal\u2460"}], "title": "3.2.1. The request() method"}], "external": false};
window.dfnpanelData['dom-lockoptions-signal'] = {"dfnID": "dom-lockoptions-signal", "url": "#dom-lockoptions-signal", "dfnText": "signal", "refSections": [{"refs": [{"id": "ref-for-dom-lockoptions-signal"}], "title": "3.2.1. The request() method"}], "external": false};
window.dfnpanelData['dictdef-lockmanagersnapshot'] = {"dfnID": "dictdef-lockmanagersnapshot", "url": "#dictdef-lockmanagersnapshot", "dfnText": "LockManagerSnapshot", "refSections": [{"refs": [{"id": "ref-for-dictdef-lockmanagersnapshot"}], "title": "3.2. LockManager class"}], "external": false};
window.dfnpanelData['dictdef-lockinfo'] = {"dfnID": "dictdef-lockinfo", "url": "#dictdef-lockinfo", "dfnText": "LockInfo", "refSections": [{"refs": [{"id": "ref-for-dictdef-lockinfo"}, {"id": "ref-for-dictdef-lockinfo\u2460"}], "title": "3.2. LockManager class"}], "external": false};
window.dfnpanelData['dom-lockmanager-request'] = {"dfnID": "dom-lockmanager-request", "url": "#dom-lockmanager-request", "dfnText": "request(name, callback)", "refSections": [{"refs": [{"id": "ref-for-dom-lockmanager-request"}], "title": "2.4. Locks"}, {"refs": [{"id": "ref-for-dom-lockmanager-request\u2460"}], "title": "3.2. LockManager class"}, {"refs": [{"id": "ref-for-dom-lockmanager-request\u2461"}, {"id": "ref-for-dom-lockmanager-request\u2462"}, {"id": "ref-for-dom-lockmanager-request\u2463"}], "title": "3.2.1. The request() method"}], "external": false};
window.dfnpanelData['dom-lockmanager-request-name-options-callback'] = {"dfnID": "dom-lockmanager-request-name-options-callback", "url": "#dom-lockmanager-request-name-options-callback", "dfnText": "request(name, options, callback)", "refSections": [{"refs": [{"id": "ref-for-dom-lockmanager-request-name-options-callback"}], "title": "3.2. LockManager class"}, {"refs": [{"id": "ref-for-dom-lockmanager-request-name-options-callback\u2460"}], "title": "3.2.1. The request() method"}], "external": false};
window.dfnpanelData['dom-lockmanager-query'] = {"dfnID": "dom-lockmanager-query", "url": "#dom-lockmanager-query", "dfnText": "query()", "refSections": [{"refs": [{"id": "ref-for-dom-lockmanager-query"}], "title": "3.2. LockManager class"}, {"refs": [{"id": "ref-for-dom-lockmanager-query\u2460"}, {"id": "ref-for-dom-lockmanager-query\u2461"}, {"id": "ref-for-dom-lockmanager-query\u2462"}], "title": "3.2.2. The query() method"}], "external": false};
window.dfnpanelData['lock'] = {"dfnID": "lock", "url": "#lock", "dfnText": "Lock", "refSections": [{"refs": [{"id": "ref-for-lock"}], "title": "3.2. LockManager class"}, {"refs": [{"id": "ref-for-lock\u2460"}], "title": "3.2.1. The request() method"}, {"refs": [{"id": "ref-for-lock\u2461"}, {"id": "ref-for-lock\u2462"}], "title": "3.3. Lock class"}, {"refs": [{"id": "ref-for-lock\u2463"}], "title": "4.4. Process a lock request queue for a given resource name"}], "external": false};
window.dfnpanelData['dom-lock-name'] = {"dfnID": "dom-lock-name", "url": "#dom-lock-name", "dfnText": "name", "refSections": [{"refs": [{"id": "ref-for-dom-lock-name"}], "title": "3.3. Lock class"}], "external": false};
window.dfnpanelData['dom-lock-mode'] = {"dfnID": "dom-lock-mode", "url": "#dom-lock-mode", "dfnText": "mode", "refSections": [{"refs": [{"id": "ref-for-dom-lock-mode"}], "title": "3.3. Lock class"}], "external": false};
window.dfnpanelData['request-a-lock'] = {"dfnID": "request-a-lock", "url": "#request-a-lock", "dfnText": "request a lock", "refSections": [{"refs": [{"id": "ref-for-request-a-lock"}], "title": "3.2.1. The request() method"}], "external": false};
window.dfnpanelData['release-the-lock'] = {"dfnID": "release-the-lock", "url": "#release-the-lock", "dfnText": "release the lock", "refSections": [{"refs": [{"id": "ref-for-release-the-lock"}], "title": "2.4. Locks"}, {"refs": [{"id": "ref-for-release-the-lock\u2460"}], "title": "2.6. Agent Integration"}], "external": false};
window.dfnpanelData['abort-the-request'] = {"dfnID": "abort-the-request", "url": "#abort-the-request", "dfnText": "abort the request", "refSections": [{"refs": [{"id": "ref-for-abort-the-request"}], "title": "2.6. Agent Integration"}, {"refs": [{"id": "ref-for-abort-the-request\u2460"}], "title": "3.2.1. The request() method"}], "external": false};
window.dfnpanelData['process-the-lock-request-queue'] = {"dfnID": "process-the-lock-request-queue", "url": "#process-the-lock-request-queue", "dfnText": "process the lock request queue", "refSections": [{"refs": [{"id": "ref-for-process-the-lock-request-queue"}], "title": "4.1. Request a lock"}, {"refs": [{"id": "ref-for-process-the-lock-request-queue\u2460"}], "title": "4.2. Release a lock"}, {"refs": [{"id": "ref-for-process-the-lock-request-queue\u2461"}], "title": "4.3. Abort a request"}], "external": false};
window.dfnpanelData['snapshot-the-lock-state'] = {"dfnID": "snapshot-the-lock-state", "url": "#snapshot-the-lock-state", "dfnText": "snapshot the lock state", "refSections": [{"refs": [{"id": "ref-for-snapshot-the-lock-state"}], "title": "3.2.2. The query() method"}], "external": false};
</script>
<script>/* Boilerplate: script-dom-helper */
function query(sel) { return document.querySelector(sel); }

function queryAll(sel) { return [...document.querySelectorAll(sel)]; }

function iter(obj) {
	if(!obj) return [];
	var it = obj[Symbol.iterator];
	if(it) return it;
	return Object.entries(obj);
}

function mk(tagname, attrs, ...children) {
	const el = document.createElement(tagname);
	for(const [k,v] of iter(attrs)) {
		if(k.slice(0,3) == "_on") {
			const eventName = k.slice(3);
			el.addEventListener(eventName, v);
		} else if(k[0] == "_") {
			// property, not attribute
			el[k.slice(1)] = v;
		} else {
			if(v === false || v == null) {
        continue;
      } else if(v === true) {
        el.setAttribute(k, "");
        continue;
      } else {
  			el.setAttribute(k, v);
      }
		}
	}
	append(el, children);
	return el;
}

/* Create shortcuts for every known HTML element */
[
  "a",
  "abbr",
  "acronym",
  "address",
  "applet",
  "area",
  "article",
  "aside",
  "audio",
  "b",
  "base",
  "basefont",
  "bdo",
  "big",
  "blockquote",
  "body",
  "br",
  "button",
  "canvas",
  "caption",
  "center",
  "cite",
  "code",
  "col",
  "colgroup",
  "datalist",
  "dd",
  "del",
  "details",
  "dfn",
  "dialog",
  "div",
  "dl",
  "dt",
  "em",
  "embed",
  "fieldset",
  "figcaption",
  "figure",
  "font",
  "footer",
  "form",
  "frame",
  "frameset",
  "head",
  "header",
  "h1",
  "h2",
  "h3",
  "h4",
  "h5",
  "h6",
  "hr",
  "html",
  "i",
  "iframe",
  "img",
  "input",
  "ins",
  "kbd",
  "label",
  "legend",
  "li",
  "link",
  "main",
  "map",
  "mark",
  "meta",
  "meter",
  "nav",
  "nobr",
  "noscript",
  "object",
  "ol",
  "optgroup",
  "option",
  "output",
  "p",
  "param",
  "pre",
  "progress",
  "q",
  "s",
  "samp",
  "script",
  "section",
  "select",
  "small",
  "source",
  "span",
  "strike",
  "strong",
  "style",
  "sub",
  "summary",
  "sup",
  "table",
  "tbody",
  "td",
  "template",
  "textarea",
  "tfoot",
  "th",
  "thead",
  "time",
  "title",
  "tr",
  "u",
  "ul",
  "var",
  "video",
  "wbr",
  "xmp",
].forEach(tagname=>{
	mk[tagname] = (...args) => mk(tagname, ...args);
});

function* nodesFromChildList(children) {
	for(const child of children.flat(Infinity)) {
		if(child instanceof Node) {
			yield child;
		} else {
			yield new Text(child);
		}
	}
}
function append(el, ...children) {
	for(const child of nodesFromChildList(children)) {
		if(el instanceof Node) el.appendChild(child);
		else el.push(child);
	}
	return el;
}

function insertAfter(el, ...children) {
	for(const child of nodesFromChildList(children)) {
		el.parentNode.insertBefore(child, el.nextSibling);
	}
	return el;
}

function clearContents(el) {
	el.innerHTML = "";
	return el;
}

function parseHTML(markup) {
	if(markup.toLowerCase().trim().indexOf('<!doctype') === 0) {
		const doc = document.implementation.createHTMLDocument("");
		doc.documentElement.innerHTML = markup;
		return doc;
	} else {
		const el = mk.template({});
		el.innerHTML = markup;
		return el.content;
	}
}
</script>
<script>/* Boilerplate: script-position-annos */
"use strict";
{

function repositionAnnoPanels(){
    const panels = [...document.querySelectorAll("[data-anno-for]")];
    const main = document.querySelector("main");
    let mainRect;
    if(main) mainRect = main.getBoundingClientRect();
    for(const panel of panels) {
        const dfn = document.getElementById(panel.getAttribute("data-anno-for"));
        if(!dfn) {
            console.log("Can't find the annotation panel target:", panel);
            continue;
        }
        const rect = dfn.getBoundingClientRect();
        const top = window.scrollY + rect.top
        panel.style.top = top + "px";
        panel.top = top;
        panel.height = rect.height;
        panel.classList.remove("unpositioned");
        const panelRect = panel.getBoundingClientRect()
        if(main) {
            panel.classList.toggle("overlapping-main", panelRect.left < mainRect.right)
        }
    }
    let vSoFar = 0;
    for(const panel of panels.sort(cmpTops)) {
        if(panel.top < vSoFar) {
            panel.top = vSoFar;
            panel.style.top = vSoFar + "px";
        }
        vSoFar = panel.top + panel.height + 15;
    }
}

function cmpTops(a,b) {
    return a.top - b.top;
}

window.addEventListener("load", repositionAnnoPanels);
window.addEventListener("resize", repositionAnnoPanels);
}
</script>
<script>/* Boilerplate: script-ref-hints */
"use strict";
{
    function genRefHint(link, ref) {
        const linkText = link.textContent;
        let dfnTextElements = '';
        if (ref.text != linkText) {
            dfnTextElements =
                mk.li({},
                    mk.b({}, "DFN: "),
                    mk.code({ class: "dfn-text" }, ref.text)
                );
        }
        const forList = ref.for_;
        const forListElements = forList.length === 0 ? '' : mk.li({},
            mk.b({}, "For: "),
            mk.ul({},
                ...forList.map(forItem =>
                    mk.li({},
                        mk.span({}, `${forItem}`)
                    ),
                ),
            ),
        );
        const url = ref.url;
        const safeUrl = encodeURIComponent(url);
        const hintPanel = mk.aside({
            class: "ref-hint",
            id: `ref-hint-for-${safeUrl}`,
            "data-for": url,
            "aria-labelled-by": `ref-hint-for-${safeUrl}`,
        },
            mk.ul({},
                dfnTextElements,
                mk.li({},
                    mk.b({}, "URL: "),
                    mk.a({ href: url, class: "ref" }, url),
                ),
                mk.li({},
                    mk.b({}, "Type: "),
                    mk.span({}, `${ref.type}`),
                ),
                mk.li({},
                    mk.b({}, "Spec: "),
                    mk.span({}, `${ref.spec ? ref.spec : ''}`),
                ),
                forListElements
            ),
        );
        hintPanel.forLink = link;
        return hintPanel;
    }
    function genAllRefHints() {
        for(const refData of Object.values(window.refsData)) {
            const refUrl = refData.url;
            const links = document.querySelectorAll(`a[href="${refUrl}"]`);
            if (links.length == 0) {
                console.log(`Can't find link href="${refUrl}".`, refData);
                continue;
            }
            for (let i = 0; i < links.length; i++) {
                const link = links[i];
                const hint = genRefHint(link, refData);
                append(document.body, hint);
                insertLinkPopupAction(hint)
            }
        }
    }

    function hideAllRefHints() {
        queryAll(".ref-hint.on").forEach(el=>hideRefHint(el));
    }

    function hideRefHint(refHint) {
        const link = refHint.forLink;
        link.setAttribute("aria-expanded", "false");
        refHint.style.position = "absolute"; // unfix it
        refHint.classList.remove("on");
        const teardown = refHint.teardownEventListeners;
        if (teardown) {
            refHint.teardownEventListeners = undefined;
            teardown();
        }
    }

    function showRefHint(refHint) {
        hideAllRefHints(); // Only display one at this time.

        const link = refHint.forLink;
        link.setAttribute("aria-expanded", "true");
        refHint.classList.add("on");
        positionRefHint(refHint);
        setupRefHintEventListeners(refHint);
    }

    function setupRefHintEventListeners(refHint) {
        if (refHint.teardownEventListeners) return;
        const link = refHint.forLink;
        // Add event handlers to hide the refHint after the user moves away
        // from both the link and refHint, if not hovering either within one second.
        let timeout = null;
        const startHidingRefHint = (event) => {
            if (timeout) {
                clearTimeout(timeout);
            }
            timeout = setTimeout(() => {
                hideRefHint(refHint);
            }, 1000);
        }
        const resetHidingRefHint = (event) => {
            if (timeout) clearTimeout(timeout);
            timeout = null;
        };
        link.addEventListener("mouseleave", startHidingRefHint);
        link.addEventListener("mouseenter", resetHidingRefHint);
        link.addEventListener("blur", startHidingRefHint);
        link.addEventListener("focus", resetHidingRefHint);
        refHint.addEventListener("mouseleave", startHidingRefHint);
        refHint.addEventListener("mouseenter", resetHidingRefHint);
        refHint.addEventListener("blur", startHidingRefHint);
        refHint.addEventListener("focus", resetHidingRefHint);

        refHint.teardownEventListeners = () => {
            // remove event listeners
            resetHidingRefHint();
            link.removeEventListener("mouseleave", startHidingRefHint);
            link.removeEventListener("mouseenter", resetHidingRefHint);
            link.removeEventListener("blur", startHidingRefHint);
            link.removeEventListener("focus", resetHidingRefHint);
            refHint.removeEventListener("mouseleave", startHidingRefHint);
            refHint.removeEventListener("mouseenter", resetHidingRefHint);
            refHint.removeEventListener("blur", startHidingRefHint);
            refHint.removeEventListener("focus", resetHidingRefHint);
        };
    }

    function positionRefHint(refHint) {
        const link = refHint.forLink;
        const linkPos = getRootLevelAbsolutePosition(link);
        refHint.style.top = linkPos.bottom + "px";
        refHint.style.left = linkPos.left + "px";

        const panelPos = refHint.getBoundingClientRect();
        const panelMargin = 8;
        const maxRight = document.body.parentNode.clientWidth - panelMargin;
        if (panelPos.right > maxRight) {
            const overflowAmount = panelPos.right - maxRight;
            const newLeft = Math.max(panelMargin, linkPos.left - overflowAmount);
            refHint.style.left = newLeft + "px";
        }
    }

    // TODO: shared util
    // Returns the root-level absolute position {left and top} of element.
    function getRootLevelAbsolutePosition(el) {
        const boundsRect = el.getBoundingClientRect();
        let xPos = 0;
        let yPos = 0;

        while (el) {
            let xScroll = el.scrollLeft;
            let yScroll = el.scrollTop;

            // Ignore scrolling of body.
            if (el.tagName === "BODY") {
                xScroll = 0;
                yScroll = 0;
            }
            xPos += (el.offsetLeft - xScroll + el.clientLeft);
            yPos += (el.offsetTop - yScroll + el.clientTop);

            el = el.offsetParent;
        }
        return {
            left: xPos,
            top: yPos,
            right: xPos + boundsRect.width,
            bottom: yPos + boundsRect.height,
        };
    }

    function insertLinkPopupAction(refHint) {
        const link = refHint.forLink;
        // link.setAttribute('role', 'button');
        link.setAttribute('aria-expanded', 'false')
        link.classList.add('has-ref-hint');
        link.addEventListener('mouseover', (event) => {
            showRefHint(refHint);
        });
        link.addEventListener('focus', (event) => {
            showRefHint(refHint);
        })
    }

    document.addEventListener("DOMContentLoaded", () => {
        genAllRefHints();

        document.body.addEventListener("click", (e) => {
            // If not handled already, just hide all link panels.
            hideAllRefHints();
        });
    });

    window.addEventListener("resize", () => {
        // Hide any open ref hint.
        hideAllRefHints();
    });
}
</script>
<script>/* Boilerplate: script-ref-hints-json */
window.refsData = {};
window.refsData['#lock-request'] = {"text": "lock request", "type": "dfn", "spec": "web-locks-1", "shortname": "web-locks", "level": "1", "status": "local", "url": "#lock-request", "export": true, "normative": true, "for_": []};
window.refsData['#resource-name'] = {"text": "resource name", "type": "dfn", "spec": "web-locks-1", "shortname": "web-locks", "level": "1", "status": "local", "url": "#resource-name", "export": true, "normative": true, "for_": []};
window.refsData['#mode'] = {"text": "mode", "type": "dfn", "spec": "web-locks-1", "shortname": "web-locks", "level": "1", "status": "local", "url": "#mode", "export": true, "normative": true, "for_": []};
window.refsData['#lock-concept'] = {"text": "lock-concept", "type": "dfn", "spec": "web-locks-1", "shortname": "web-locks", "level": "1", "status": "local", "url": "#lock-concept", "export": true, "normative": true, "for_": []};
window.refsData['https://tc39.github.io/ecma262/#agent'] = {"text": "agent", "type": "dfn", "spec": "ecma262", "shortname": "ecma262", "level": "", "status": "anchor-block", "url": "https://tc39.github.io/ecma262/#agent", "export": true, "normative": true, "for_": []};
window.refsData['https://html.spec.whatwg.org/multipage/webappapis.html#integration-with-the-javascript-agent-cluster-formalism'] = {"text": "agent cluster", "type": "dfn", "spec": "html", "shortname": "html", "level": "", "status": "anchor-block", "url": "https://html.spec.whatwg.org/multipage/webappapis.html#integration-with-the-javascript-agent-cluster-formalism", "export": true, "normative": true, "for_": []};
window.refsData['https://html.spec.whatwg.org/multipage/infrastructure.html#starting-a-new-parallel-queue'] = {"text": "starting a new parallel queue", "type": "dfn", "spec": "html", "shortname": "html", "level": "1", "status": "current", "url": "https://html.spec.whatwg.org/multipage/infrastructure.html#starting-a-new-parallel-queue", "export": true, "normative": true, "for_": []};
window.refsData['https://html.spec.whatwg.org/multipage/webappapis.html#task-source'] = {"text": "task source", "type": "dfn", "spec": "html", "shortname": "html", "level": "1", "status": "current", "url": "https://html.spec.whatwg.org/multipage/webappapis.html#task-source", "export": true, "normative": true, "for_": []};
window.refsData['https://html.spec.whatwg.org/multipage/infrastructure.html#enqueue-the-following-steps'] = {"text": "enqueue steps", "type": "dfn", "spec": "html", "shortname": "html", "level": "1", "status": "current", "url": "https://html.spec.whatwg.org/multipage/infrastructure.html#enqueue-the-following-steps", "export": true, "normative": true, "for_": ["parallel queue"]};
window.refsData['https://infra.spec.whatwg.org/#string'] = {"text": "javascript string", "type": "dfn", "spec": "infra", "shortname": "infra", "level": "1", "status": "current", "url": "https://infra.spec.whatwg.org/#string", "export": true, "normative": true, "for_": []};
window.refsData['https://html.spec.whatwg.org/multipage/document-sequences.html#browsing-context'] = {"text": "browsing context", "type": "dfn", "spec": "html", "shortname": "html", "level": "1", "status": "current", "url": "https://html.spec.whatwg.org/multipage/document-sequences.html#browsing-context", "export": true, "normative": true, "for_": []};
window.refsData['https://html.spec.whatwg.org/multipage/browsers.html#concept-origin'] = {"text": "origin", "type": "dfn", "spec": "html", "shortname": "html", "level": "1", "status": "current", "url": "https://html.spec.whatwg.org/multipage/browsers.html#concept-origin", "export": true, "normative": true, "for_": []};
window.refsData['#lock-manager'] = {"text": "lock manager", "type": "dfn", "spec": "web-locks-1", "shortname": "web-locks", "level": "1", "status": "local", "url": "#lock-manager", "export": true, "normative": true, "for_": []};
window.refsData['https://storage.spec.whatwg.org/#storage-shelf'] = {"text": "storage shelf", "type": "dfn", "spec": "storage", "shortname": "storage", "level": "", "status": "anchor-block", "url": "https://storage.spec.whatwg.org/#storage-shelf", "export": true, "normative": true, "for_": []};
window.refsData['https://html.spec.whatwg.org/multipage/webstorage.html#dom-localstorage'] = {"text": "localstorage", "type": "dfn", "spec": "html", "shortname": "html", "level": "", "status": "anchor-block", "url": "https://html.spec.whatwg.org/multipage/webstorage.html#dom-localstorage", "export": true, "normative": true, "for_": []};
window.refsData['#dom-lockmode-exclusive'] = {"text": "\"exclusive\"", "type": "enum-value", "spec": "web-locks-1", "shortname": "web-locks", "level": "1", "status": "local", "url": "#dom-lockmode-exclusive", "export": true, "normative": true, "for_": ["LockMode"]};
window.refsData['#dom-lockmode-shared'] = {"text": "\"shared\"", "type": "enum-value", "spec": "web-locks-1", "shortname": "web-locks", "level": "1", "status": "local", "url": "#dom-lockmode-shared", "export": true, "normative": true, "for_": ["LockMode"]};
window.refsData['#lock-concept-waiting-promise'] = {"text": "waiting promise", "type": "dfn", "spec": "web-locks-1", "shortname": "web-locks", "level": "1", "status": "local", "url": "#lock-concept-waiting-promise", "export": true, "normative": true, "for_": ["lock-concept"]};
window.refsData['#lockmanager'] = {"text": "LockManager", "type": "interface", "spec": "web-locks-1", "shortname": "web-locks", "level": "1", "status": "local", "url": "#lockmanager", "export": true, "normative": true, "for_": []};
window.refsData['#dom-lockmanager-request'] = {"text": "request(name, callback)", "type": "method", "spec": "web-locks-1", "shortname": "web-locks", "level": "1", "status": "local", "url": "#dom-lockmanager-request", "export": true, "normative": true, "for_": ["LockManager"]};
window.refsData['#lock-concept-released-promise'] = {"text": "released promise", "type": "dfn", "spec": "web-locks-1", "shortname": "web-locks", "level": "1", "status": "local", "url": "#lock-concept-released-promise", "export": true, "normative": true, "for_": ["lock-concept"]};
window.refsData['https://infra.spec.whatwg.org/#ordered-set'] = {"text": "set", "type": "dfn", "spec": "infra", "shortname": "infra", "level": "1", "status": "current", "url": "https://infra.spec.whatwg.org/#ordered-set", "export": true, "normative": true, "for_": []};
window.refsData['#lock-task-queue'] = {"text": "lock task queue", "type": "dfn", "spec": "web-locks-1", "shortname": "web-locks", "level": "1", "status": "local", "url": "#lock-task-queue", "export": true, "normative": true, "for_": []};
window.refsData['#release-the-lock'] = {"text": "release the lock", "type": "dfn", "spec": "web-locks-1", "shortname": "web-locks", "level": "1", "status": "local", "url": "#release-the-lock", "export": true, "normative": true, "for_": []};
window.refsData['https://webidl.spec.whatwg.org/#resolve'] = {"text": "resolve", "type": "dfn", "spec": "webidl", "shortname": "webidl", "level": "1", "status": "current", "url": "https://webidl.spec.whatwg.org/#resolve", "export": true, "normative": true, "for_": []};
window.refsData['https://infra.spec.whatwg.org/#struct'] = {"text": "struct", "type": "dfn", "spec": "infra", "shortname": "infra", "level": "1", "status": "current", "url": "https://infra.spec.whatwg.org/#struct", "export": true, "normative": true, "for_": []};
window.refsData['https://infra.spec.whatwg.org/#struct-item'] = {"text": "item", "type": "dfn", "spec": "infra", "shortname": "infra", "level": "1", "status": "current", "url": "https://infra.spec.whatwg.org/#struct-item", "export": true, "normative": true, "for_": ["struct", "tuple"]};
window.refsData['https://infra.spec.whatwg.org/#queue'] = {"text": "queue", "type": "dfn", "spec": "infra", "shortname": "infra", "level": "1", "status": "current", "url": "https://infra.spec.whatwg.org/#queue", "export": true, "normative": true, "for_": []};
window.refsData['https://infra.spec.whatwg.org/#ordered-map'] = {"text": "map", "type": "dfn", "spec": "infra", "shortname": "infra", "level": "1", "status": "current", "url": "https://infra.spec.whatwg.org/#ordered-map", "export": true, "normative": true, "for_": []};
window.refsData['#lock-request-lock-request-queue'] = {"text": "lock request queue", "type": "dfn", "spec": "web-locks-1", "shortname": "web-locks", "level": "1", "status": "local", "url": "#lock-request-lock-request-queue", "export": true, "normative": true, "for_": ["lock request"]};
window.refsData['#lock-request-origin'] = {"text": "origin", "type": "dfn", "spec": "web-locks-1", "shortname": "web-locks", "level": "1", "status": "local", "url": "#lock-request-origin", "export": true, "normative": true, "for_": ["lock request"]};
window.refsData['#lock-request-lock-request-queue-map'] = {"text": "lock request queue map", "type": "dfn", "spec": "web-locks-1", "shortname": "web-locks", "level": "1", "status": "local", "url": "#lock-request-lock-request-queue-map", "export": true, "normative": true, "for_": ["lock request"]};
window.refsData['#lock-request-name'] = {"text": "name", "type": "dfn", "spec": "web-locks-1", "shortname": "web-locks", "level": "1", "status": "local", "url": "#lock-request-name", "export": true, "normative": true, "for_": ["lock request"]};
window.refsData['#lock-concept-held-lock-set'] = {"text": "held lock set", "type": "dfn", "spec": "web-locks-1", "shortname": "web-locks", "level": "1", "status": "local", "url": "#lock-concept-held-lock-set", "export": true, "normative": true, "for_": ["lock-concept"]};
window.refsData['#lock-request-mode'] = {"text": "mode", "type": "dfn", "spec": "web-locks-1", "shortname": "web-locks", "level": "1", "status": "local", "url": "#lock-request-mode", "export": true, "normative": true, "for_": ["lock request"]};
window.refsData['#lock-concept-name'] = {"text": "name", "type": "dfn", "spec": "web-locks-1", "shortname": "web-locks", "level": "1", "status": "local", "url": "#lock-concept-name", "export": true, "normative": true, "for_": ["lock-concept"]};
window.refsData['#lock-concept-mode'] = {"text": "mode", "type": "dfn", "spec": "web-locks-1", "shortname": "web-locks", "level": "1", "status": "local", "url": "#lock-concept-mode", "export": true, "normative": true, "for_": ["lock-concept"]};
window.refsData['#lock-request-agent'] = {"text": "agent", "type": "dfn", "spec": "web-locks-1", "shortname": "web-locks", "level": "1", "status": "local", "url": "#lock-request-agent", "export": true, "normative": true, "for_": ["lock request"]};
window.refsData['#abort-the-request'] = {"text": "abort the request", "type": "dfn", "spec": "web-locks-1", "shortname": "web-locks", "level": "1", "status": "local", "url": "#abort-the-request", "export": true, "normative": true, "for_": []};
window.refsData['#lock-concept-agent'] = {"text": "agent", "type": "dfn", "spec": "web-locks-1", "shortname": "web-locks", "level": "1", "status": "local", "url": "#lock-concept-agent", "export": true, "normative": true, "for_": ["lock-concept"]};
window.refsData['https://webidl.spec.whatwg.org/#SecureContext'] = {"text": "SecureContext", "type": "extended-attribute", "spec": "webidl", "shortname": "webidl", "level": "1", "status": "current", "url": "https://webidl.spec.whatwg.org/#SecureContext", "export": true, "normative": true, "for_": []};
window.refsData['#dom-navigatorlocks-locks'] = {"text": "locks", "type": "attribute", "spec": "web-locks-1", "shortname": "web-locks", "level": "1", "status": "local", "url": "#dom-navigatorlocks-locks", "export": true, "normative": true, "for_": ["NavigatorLocks"]};
window.refsData['https://html.spec.whatwg.org/multipage/system-state.html#navigator'] = {"text": "Navigator", "type": "interface", "spec": "html", "shortname": "html", "level": "1", "status": "current", "url": "https://html.spec.whatwg.org/multipage/system-state.html#navigator", "export": true, "normative": true, "for_": []};
window.refsData['#navigatorlocks'] = {"text": "NavigatorLocks", "type": "interface", "spec": "web-locks-1", "shortname": "web-locks", "level": "1", "status": "local", "url": "#navigatorlocks", "export": true, "normative": true, "for_": []};
window.refsData['https://html.spec.whatwg.org/multipage/workers.html#workernavigator'] = {"text": "WorkerNavigator", "type": "interface", "spec": "html", "shortname": "html", "level": "1", "status": "current", "url": "https://html.spec.whatwg.org/multipage/workers.html#workernavigator", "export": true, "normative": true, "for_": []};
window.refsData['https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object'] = {"text": "environment settings object", "type": "dfn", "spec": "html", "shortname": "html", "level": "1", "status": "current", "url": "https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object", "export": true, "normative": true, "for_": []};
window.refsData['https://webidl.spec.whatwg.org/#this'] = {"text": "this", "type": "dfn", "spec": "webidl", "shortname": "webidl", "level": "1", "status": "current", "url": "https://webidl.spec.whatwg.org/#this", "export": true, "normative": true, "for_": []};
window.refsData['https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object'] = {"text": "relevant settings object", "type": "dfn", "spec": "html", "shortname": "html", "level": "1", "status": "current", "url": "https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object", "export": true, "normative": true, "for_": []};
window.refsData['https://webidl.spec.whatwg.org/#Exposed'] = {"text": "Exposed", "type": "extended-attribute", "spec": "webidl", "shortname": "webidl", "level": "1", "status": "current", "url": "https://webidl.spec.whatwg.org/#Exposed", "export": true, "normative": true, "for_": []};
window.refsData['https://webidl.spec.whatwg.org/#idl-promise'] = {"text": "Promise", "type": "interface", "spec": "webidl", "shortname": "webidl", "level": "1", "status": "current", "url": "https://webidl.spec.whatwg.org/#idl-promise", "export": true, "normative": true, "for_": []};
window.refsData['https://webidl.spec.whatwg.org/#idl-any'] = {"text": "any", "type": "interface", "spec": "webidl", "shortname": "webidl", "level": "1", "status": "current", "url": "https://webidl.spec.whatwg.org/#idl-any", "export": true, "normative": true, "for_": []};
window.refsData['https://webidl.spec.whatwg.org/#idl-DOMString'] = {"text": "DOMString", "type": "interface", "spec": "webidl", "shortname": "webidl", "level": "1", "status": "current", "url": "https://webidl.spec.whatwg.org/#idl-DOMString", "export": true, "normative": true, "for_": []};
window.refsData['#callbackdef-lockgrantedcallback'] = {"text": "LockGrantedCallback", "type": "callback", "spec": "web-locks-1", "shortname": "web-locks", "level": "1", "status": "local", "url": "#callbackdef-lockgrantedcallback", "export": true, "normative": true, "for_": []};
window.refsData['#dom-lockmanager-request-name-options-callback'] = {"text": "request(name, options, callback)", "type": "method", "spec": "web-locks-1", "shortname": "web-locks", "level": "1", "status": "local", "url": "#dom-lockmanager-request-name-options-callback", "export": true, "normative": true, "for_": ["LockManager"]};
window.refsData['#dictdef-lockoptions'] = {"text": "LockOptions", "type": "dictionary", "spec": "web-locks-1", "shortname": "web-locks", "level": "1", "status": "local", "url": "#dictdef-lockoptions", "export": true, "normative": true, "for_": []};
window.refsData['#dictdef-lockmanagersnapshot'] = {"text": "LockManagerSnapshot", "type": "dictionary", "spec": "web-locks-1", "shortname": "web-locks", "level": "1", "status": "local", "url": "#dictdef-lockmanagersnapshot", "export": true, "normative": true, "for_": []};
window.refsData['#dom-lockmanager-query'] = {"text": "query()", "type": "method", "spec": "web-locks-1", "shortname": "web-locks", "level": "1", "status": "local", "url": "#dom-lockmanager-query", "export": true, "normative": true, "for_": ["LockManager"]};
window.refsData['#lock'] = {"text": "Lock", "type": "interface", "spec": "web-locks-1", "shortname": "web-locks", "level": "1", "status": "local", "url": "#lock", "export": true, "normative": true, "for_": []};
window.refsData['#enumdef-lockmode'] = {"text": "LockMode", "type": "enum", "spec": "web-locks-1", "shortname": "web-locks", "level": "1", "status": "local", "url": "#enumdef-lockmode", "export": true, "normative": true, "for_": []};
window.refsData['https://webidl.spec.whatwg.org/#idl-boolean'] = {"text": "boolean", "type": "interface", "spec": "webidl", "shortname": "webidl", "level": "1", "status": "current", "url": "https://webidl.spec.whatwg.org/#idl-boolean", "export": true, "normative": true, "for_": []};
window.refsData['https://dom.spec.whatwg.org/#abortsignal'] = {"text": "AbortSignal", "type": "interface", "spec": "dom", "shortname": "dom", "level": "1", "status": "current", "url": "https://dom.spec.whatwg.org/#abortsignal", "export": true, "normative": true, "for_": []};
window.refsData['https://webidl.spec.whatwg.org/#idl-sequence'] = {"text": "sequence", "type": "dfn", "spec": "webidl", "shortname": "webidl", "level": "1", "status": "current", "url": "https://webidl.spec.whatwg.org/#idl-sequence", "export": true, "normative": true, "for_": []};
window.refsData['#dictdef-lockinfo'] = {"text": "LockInfo", "type": "dictionary", "spec": "web-locks-1", "shortname": "web-locks", "level": "1", "status": "local", "url": "#dictdef-lockinfo", "export": true, "normative": true, "for_": []};
window.refsData['https://webidl.spec.whatwg.org/#dfn-callback-function'] = {"text": "callback function", "type": "dfn", "spec": "webidl", "shortname": "webidl", "level": "1", "status": "current", "url": "https://webidl.spec.whatwg.org/#dfn-callback-function", "export": true, "normative": true, "for_": []};
window.refsData['#dom-lockoptions-mode'] = {"text": "mode", "type": "dict-member", "spec": "web-locks-1", "shortname": "web-locks", "level": "1", "status": "local", "url": "#dom-lockoptions-mode", "export": true, "normative": true, "for_": ["LockOptions"]};
window.refsData['#dom-lockoptions-ifavailable'] = {"text": "ifAvailable", "type": "dict-member", "spec": "web-locks-1", "shortname": "web-locks", "level": "1", "status": "local", "url": "#dom-lockoptions-ifavailable", "export": true, "normative": true, "for_": ["LockOptions"]};
window.refsData['#dom-lockoptions-signal'] = {"text": "signal", "type": "dict-member", "spec": "web-locks-1", "shortname": "web-locks", "level": "1", "status": "local", "url": "#dom-lockoptions-signal", "export": true, "normative": true, "for_": ["LockOptions"]};
window.refsData['https://webidl.spec.whatwg.org/#aborterror'] = {"text": "AbortError", "type": "exception", "spec": "webidl", "shortname": "webidl", "level": "1", "status": "current", "url": "https://webidl.spec.whatwg.org/#aborterror", "export": true, "normative": true, "for_": []};
window.refsData['#dom-lockoptions-steal'] = {"text": "steal", "type": "dict-member", "spec": "web-locks-1", "shortname": "web-locks", "level": "1", "status": "local", "url": "#dom-lockoptions-steal", "export": true, "normative": true, "for_": ["LockOptions"]};
window.refsData['https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-opaque'] = {"text": "opaque origin", "type": "dfn", "spec": "html", "shortname": "html", "level": "1", "status": "current", "url": "https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-opaque", "export": true, "normative": true, "for_": []};
window.refsData['https://webidl.spec.whatwg.org/#a-promise-rejected-with'] = {"text": "a promise rejected with", "type": "dfn", "spec": "webidl", "shortname": "webidl", "level": "1", "status": "current", "url": "https://webidl.spec.whatwg.org/#a-promise-rejected-with", "export": true, "normative": true, "for_": []};
window.refsData['https://webidl.spec.whatwg.org/#securityerror'] = {"text": "SecurityError", "type": "exception", "spec": "webidl", "shortname": "webidl", "level": "1", "status": "current", "url": "https://webidl.spec.whatwg.org/#securityerror", "export": true, "normative": true, "for_": []};
window.refsData['https://webidl.spec.whatwg.org/#idl-DOMException'] = {"text": "DOMException", "type": "interface", "spec": "webidl", "shortname": "webidl", "level": "1", "status": "current", "url": "https://webidl.spec.whatwg.org/#idl-DOMException", "export": true, "normative": true, "for_": []};
window.refsData['https://webidl.spec.whatwg.org/#notsupportederror'] = {"text": "NotSupportedError", "type": "exception", "spec": "webidl", "shortname": "webidl", "level": "1", "status": "current", "url": "https://webidl.spec.whatwg.org/#notsupportederror", "export": true, "normative": true, "for_": []};
window.refsData['https://webidl.spec.whatwg.org/#a-new-promise'] = {"text": "a new promise", "type": "dfn", "spec": "webidl", "shortname": "webidl", "level": "1", "status": "current", "url": "https://webidl.spec.whatwg.org/#a-new-promise", "export": true, "normative": true, "for_": []};
window.refsData['#request-a-lock'] = {"text": "request a lock", "type": "dfn", "spec": "web-locks-1", "shortname": "web-locks", "level": "1", "status": "local", "url": "#request-a-lock", "export": true, "normative": true, "for_": []};
window.refsData['https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-id'] = {"text": "id", "type": "dfn", "spec": "html", "shortname": "html", "level": "1", "status": "current", "url": "https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-id", "export": true, "normative": true, "for_": ["environment"]};
window.refsData['https://dom.spec.whatwg.org/#abortsignal-add'] = {"text": "add", "type": "dfn", "spec": "dom", "shortname": "dom", "level": "1", "status": "current", "url": "https://dom.spec.whatwg.org/#abortsignal-add", "export": true, "normative": true, "for_": ["AbortSignal"]};
window.refsData['https://webidl.spec.whatwg.org/#reject'] = {"text": "reject", "type": "dfn", "spec": "webidl", "shortname": "webidl", "level": "1", "status": "current", "url": "https://webidl.spec.whatwg.org/#reject", "export": true, "normative": true, "for_": []};
window.refsData['https://w3c.github.io/ServiceWorker/#client'] = {"text": "Client", "type": "interface", "spec": "service-workers", "shortname": "service-workers", "level": "1", "status": "current", "url": "https://w3c.github.io/ServiceWorker/#client", "export": true, "normative": true, "for_": []};
window.refsData['https://w3c.github.io/ServiceWorker/#dom-client-id'] = {"text": "id", "type": "attribute", "spec": "service-workers", "shortname": "service-workers", "level": "1", "status": "current", "url": "https://w3c.github.io/ServiceWorker/#dom-client-id", "export": true, "normative": true, "for_": ["Client"]};
window.refsData['#snapshot-the-lock-state'] = {"text": "snapshot the lock state", "type": "dfn", "spec": "web-locks-1", "shortname": "web-locks", "level": "1", "status": "local", "url": "#snapshot-the-lock-state", "export": true, "normative": true, "for_": []};
window.refsData['#dom-lock-name'] = {"text": "name", "type": "attribute", "spec": "web-locks-1", "shortname": "web-locks", "level": "1", "status": "local", "url": "#dom-lock-name", "export": true, "normative": true, "for_": ["Lock"]};
window.refsData['#dom-lock-mode'] = {"text": "mode", "type": "attribute", "spec": "web-locks-1", "shortname": "web-locks", "level": "1", "status": "local", "url": "#dom-lock-mode", "export": true, "normative": true, "for_": ["Lock"]};
window.refsData['https://infra.spec.whatwg.org/#list-iterate'] = {"text": "for each", "type": "dfn", "spec": "infra", "shortname": "infra", "level": "1", "status": "current", "url": "https://infra.spec.whatwg.org/#list-iterate", "export": true, "normative": true, "for_": ["list", "set"]};
window.refsData['https://infra.spec.whatwg.org/#list-remove'] = {"text": "remove", "type": "dfn", "spec": "infra", "shortname": "infra", "level": "1", "status": "current", "url": "https://infra.spec.whatwg.org/#list-remove", "export": true, "normative": true, "for_": ["list", "set"]};
window.refsData['https://infra.spec.whatwg.org/#list-prepend'] = {"text": "prepend", "type": "dfn", "spec": "infra", "shortname": "infra", "level": "1", "status": "current", "url": "https://infra.spec.whatwg.org/#list-prepend", "export": true, "normative": true, "for_": ["list"]};
window.refsData['#lock-request-grantable'] = {"text": "grantable", "type": "dfn", "spec": "web-locks-1", "shortname": "web-locks", "level": "1", "status": "local", "url": "#lock-request-grantable", "export": true, "normative": true, "for_": ["lock request"]};
window.refsData['https://html.spec.whatwg.org/multipage/webappapis.html#responsible-event-loop'] = {"text": "responsible event loop", "type": "dfn", "spec": "html", "shortname": "html", "level": "1", "status": "current", "url": "https://html.spec.whatwg.org/multipage/webappapis.html#responsible-event-loop", "export": true, "normative": true, "for_": ["environment settings object"]};
window.refsData['https://webidl.spec.whatwg.org/#invoke-a-callback-function'] = {"text": "invoke", "type": "dfn", "spec": "webidl", "shortname": "webidl", "level": "1", "status": "current", "url": "https://webidl.spec.whatwg.org/#invoke-a-callback-function", "export": true, "normative": true, "for_": []};
window.refsData['https://infra.spec.whatwg.org/#queue-enqueue'] = {"text": "enqueue", "type": "dfn", "spec": "infra", "shortname": "infra", "level": "1", "status": "current", "url": "https://infra.spec.whatwg.org/#queue-enqueue", "export": true, "normative": true, "for_": ["queue"]};
window.refsData['#process-the-lock-request-queue'] = {"text": "process the lock request queue", "type": "dfn", "spec": "web-locks-1", "shortname": "web-locks", "level": "1", "status": "local", "url": "#process-the-lock-request-queue", "export": true, "normative": true, "for_": []};
window.refsData['https://infra.spec.whatwg.org/#assert'] = {"text": "assert", "type": "dfn", "spec": "infra", "shortname": "infra", "level": "1", "status": "current", "url": "https://infra.spec.whatwg.org/#assert", "export": true, "normative": true, "for_": []};
window.refsData['#lock-concept-origin'] = {"text": "origin", "type": "dfn", "spec": "web-locks-1", "shortname": "web-locks", "level": "1", "status": "local", "url": "#lock-concept-origin", "export": true, "normative": true, "for_": ["lock-concept"]};
window.refsData['#lock-request-clientid'] = {"text": "clientid", "type": "dfn", "spec": "web-locks-1", "shortname": "web-locks", "level": "1", "status": "local", "url": "#lock-request-clientid", "export": true, "normative": true, "for_": ["lock request"]};
window.refsData['#lock-request-promise'] = {"text": "promise", "type": "dfn", "spec": "web-locks-1", "shortname": "web-locks", "level": "1", "status": "local", "url": "#lock-request-promise", "export": true, "normative": true, "for_": ["lock request"]};
window.refsData['#lock-concept-clientid'] = {"text": "clientid", "type": "dfn", "spec": "web-locks-1", "shortname": "web-locks", "level": "1", "status": "local", "url": "#lock-concept-clientid", "export": true, "normative": true, "for_": ["lock-concept"]};
window.refsData['https://infra.spec.whatwg.org/#set-append'] = {"text": "append", "type": "dfn", "spec": "infra", "shortname": "infra", "level": "1", "status": "current", "url": "https://infra.spec.whatwg.org/#set-append", "export": true, "normative": true, "for_": ["set"]};
window.refsData['https://infra.spec.whatwg.org/#list'] = {"text": "list", "type": "dfn", "spec": "infra", "shortname": "infra", "level": "1", "status": "current", "url": "https://infra.spec.whatwg.org/#list", "export": true, "normative": true, "for_": []};
window.refsData['https://infra.spec.whatwg.org/#map-iterate'] = {"text": "for each", "type": "dfn", "spec": "infra", "shortname": "infra", "level": "1", "status": "current", "url": "https://infra.spec.whatwg.org/#map-iterate", "export": true, "normative": true, "for_": ["map"]};
window.refsData['https://infra.spec.whatwg.org/#map-getting-the-values'] = {"text": "values", "type": "dfn", "spec": "infra", "shortname": "infra", "level": "1", "status": "current", "url": "https://infra.spec.whatwg.org/#map-getting-the-values", "export": true, "normative": true, "for_": ["map"]};
window.refsData['https://infra.spec.whatwg.org/#list-append'] = {"text": "append", "type": "dfn", "spec": "infra", "shortname": "infra", "level": "1", "status": "current", "url": "https://infra.spec.whatwg.org/#list-append", "export": true, "normative": true, "for_": ["list"]};
</script>
<script>/* Boilerplate: script-var-click-highlighting */
/*
Color-choosing design:

Colors are ordered by goodness.
Each color has a usage count (initially zero).
Each variable has a last-used color.

* If the var has a last-used color, and that color's usage is 0,
    return that color.
* Otherwise, return the lowest-indexed color with the lowest usage.
    Increment the color's usage and set it as the last-used color
    for that var.
* On unclicking, decrement usage of the color.
*/
"use strict";
{
    document.addEventListener("click", e=>{
        if(e.target.nodeName == "VAR") {
            highlightSameAlgoVars(e.target);
        }
    });
    const indexCounts = new Map();
    const indexNames = new Map();
    function highlightSameAlgoVars(v) {
        // Find the algorithm container.
        let algoContainer = null;
        let searchEl = v;
        while(algoContainer == null && searchEl != document.body) {
            searchEl = searchEl.parentNode;
            if(searchEl.hasAttribute("data-algorithm")) {
                algoContainer = searchEl;
            }
        }

        // Not highlighting document-global vars,
        // too likely to be unrelated.
        if(algoContainer == null) return;

        const algoName = algoContainer.getAttribute("data-algorithm");
        const varName = getVarName(v);
        const addClass = !v.classList.contains("selected");
        let highlightClass = null;
        if(addClass) {
            const index = chooseHighlightIndex(algoName, varName);
            indexCounts.get(algoName)[index] += 1;
            indexNames.set(algoName+"///"+varName, index);
            highlightClass = nameFromIndex(index);
        } else {
            const index = previousHighlightIndex(algoName, varName);
            indexCounts.get(algoName)[index] -= 1;
            highlightClass = nameFromIndex(index);
        }

        // Find all same-name vars, and toggle their class appropriately.
        for(const el of algoContainer.querySelectorAll("var")) {
            if(getVarName(el) == varName) {
                el.classList.toggle("selected", addClass);
                el.classList.toggle(highlightClass, addClass);
            }
        }
    }
    function getVarName(el) {
        return el.textContent.replace(/(\s|\xa0)+/, " ").trim();
    }
    function chooseHighlightIndex(algoName, varName) {
        let indexes = null;
        if(indexCounts.has(algoName)) {
            indexes = indexCounts.get(algoName);
        } else {
            // 7 classes right now
            indexes = [0,0,0,0,0,0,0];
            indexCounts.set(algoName, indexes);
        }

        // If the element was recently unclicked,
        // *and* that color is still unclaimed,
        // give it back the same color.
        const lastIndex = previousHighlightIndex(algoName, varName);
        if(indexes[lastIndex] === 0) return lastIndex;

        // Find the earliest index with the lowest count.
        const minCount = Math.min.apply(null, indexes);
        let index = null;
        for(var i = 0; i < indexes.length; i++) {
            if(indexes[i] == minCount) {
                return i;
            }
        }
    }
    function previousHighlightIndex(algoName, varName) {
        return indexNames.get(algoName+"///"+varName);
    }
    function nameFromIndex(index) {
        return "selected" + index;
    }
}
</script>