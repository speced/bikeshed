<!doctype html><html lang="en">
 <head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
  <title>KV Storage</title>
  <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
  <link href="https://www.w3.org/StyleSheets/TR/2021/cg-draft" rel="stylesheet">
  <link href="https://wicg.github.io/kv-storage/" rel="canonical">
  <meta content="dark light" name="color-scheme">
  <link href="https://www.w3.org/StyleSheets/TR/2021/dark.css" media="(prefers-color-scheme: dark)" rel="stylesheet" type="text/css">
<style>
.selected-text-file-an-issue {
  position: fixed;
  bottom: 0;
  right: 0;
  background: rgba(255, 255, 255, 0.8);
  font-size: smaller;
  padding: 4px 10px;
  z-index: 4;
}

summary {
  cursor: pointer;
}

/* domintro from https://resources.whatwg.org/standard.css */
.domintro {
  position: relative;
  color: green;
  background: #DDFFDD;
  margin: 2.5em 0 2em 0;
  padding: 1.5em 1em 0.5em 2em;
}

.domintro dt, .domintro dt * {
  color: black;
  font-size: inherit;
}
.domintro dd {
  margin: 0.5em 0 1em 2em; padding: 0;
}
.domintro dd p {
  margin: 0.5em 0;
}
.domintro::before {
  content: 'For web developers (non-normative)';
  background: green;
  color: white;
  padding: 0.15em 0.25em;
  font-style: normal;
  position: absolute;
  top: -0.8em;
  left: -0.8em;
}
</style>
<style>/* Boilerplate: style-autolinks */
.css.css, .property.property, .descriptor.descriptor {
    color: var(--a-normal-text);
    font-size: inherit;
    font-family: inherit;
}
.css::before, .property::before, .descriptor::before {
    content: "‘";
}
.css::after, .property::after, .descriptor::after {
    content: "’";
}
.property, .descriptor {
    /* Don't wrap property and descriptor names */
    white-space: nowrap;
}
.type { /* CSS value <type> */
    font-style: italic;
}
pre .property::before, pre .property::after {
    content: "";
}
[data-link-type="property"]::before,
[data-link-type="propdesc"]::before,
[data-link-type="descriptor"]::before,
[data-link-type="value"]::before,
[data-link-type="function"]::before,
[data-link-type="at-rule"]::before,
[data-link-type="selector"]::before,
[data-link-type="maybe"]::before {
    content: "‘";
}
[data-link-type="property"]::after,
[data-link-type="propdesc"]::after,
[data-link-type="descriptor"]::after,
[data-link-type="value"]::after,
[data-link-type="function"]::after,
[data-link-type="at-rule"]::after,
[data-link-type="selector"]::after,
[data-link-type="maybe"]::after {
    content: "’";
}

[data-link-type].production::before,
[data-link-type].production::after,
.prod [data-link-type]::before,
.prod [data-link-type]::after {
    content: "";
}

[data-link-type=element],
[data-link-type=element-attr] {
    font-family: Menlo, Consolas, "DejaVu Sans Mono", monospace;
    font-size: .9em;
}
[data-link-type=element]::before { content: "<" }
[data-link-type=element]::after  { content: ">" }

[data-link-type=biblio] {
    white-space: pre;
}

@media (prefers-color-scheme: dark) {
    :root {
        --selflink-text: black;
        --selflink-bg: silver;
        --selflink-hover-text: white;
    }
}
</style>
<style>/* Boilerplate: style-colors */
/* Any --*-text not paired with a --*-bg is assumed to have a transparent bg */
:root {
    color-scheme: light dark;

    --text: black;
    --bg: white;

    --unofficial-watermark: url(https://www.w3.org/StyleSheets/TR/2016/logos/UD-watermark);

    --logo-bg: #1a5e9a;
    --logo-active-bg: #c00;
    --logo-text: white;

    --tocnav-normal-text: #707070;
    --tocnav-normal-bg: var(--bg);
    --tocnav-hover-text: var(--tocnav-normal-text);
    --tocnav-hover-bg: #f8f8f8;
    --tocnav-active-text: #c00;
    --tocnav-active-bg: var(--tocnav-normal-bg);

    --tocsidebar-text: var(--text);
    --tocsidebar-bg: #f7f8f9;
    --tocsidebar-shadow: rgba(0,0,0,.1);
    --tocsidebar-heading-text: hsla(203,20%,40%,.7);

    --toclink-text: var(--text);
    --toclink-underline: #3980b5;
    --toclink-visited-text: var(--toclink-text);
    --toclink-visited-underline: #054572;

    --heading-text: #005a9c;

    --hr-text: var(--text);

    --algo-border: #def;

    --del-text: red;
    --del-bg: transparent;
    --ins-text: #080;
    --ins-bg: transparent;

    --a-normal-text: #034575;
    --a-normal-underline: #bbb;
    --a-visited-text: var(--a-normal-text);
    --a-visited-underline: #707070;
    --a-hover-bg: rgba(75%, 75%, 75%, .25);
    --a-active-text: #c00;
    --a-active-underline: #c00;

    --blockquote-border: silver;
    --blockquote-bg: transparent;
    --blockquote-text: currentcolor;

    --issue-border: #e05252;
    --issue-bg: #fbe9e9;
    --issue-text: var(--text);
    --issueheading-text: #831616;

    --example-border: #e0cb52;
    --example-bg: #fcfaee;
    --example-text: var(--text);
    --exampleheading-text: #574b0f;

    --note-border: #52e052;
    --note-bg: #e9fbe9;
    --note-text: var(--text);
    --noteheading-text: hsl(120, 70%, 30%);
    --notesummary-underline: silver;

    --assertion-border: #aaa;
    --assertion-bg: #eee;
    --assertion-text: black;

    --advisement-border: orange;
    --advisement-bg: #fec;
    --advisement-text: var(--text);
    --advisementheading-text: #b35f00;

    --warning-border: red;
    --warning-bg: hsla(40,100%,50%,0.95);
    --warning-text: var(--text);

    --amendment-border: #330099;
    --amendment-bg: #F5F0FF;
    --amendment-text: var(--text);
    --amendmentheading-text: #220066;

    --def-border: #8ccbf2;
    --def-bg: #def;
    --def-text: var(--text);
    --defrow-border: #bbd7e9;

    --datacell-border: silver;

    --indexinfo-text: #707070;

    --indextable-hover-text: black;
    --indextable-hover-bg: #f7f8f9;

    --outdatedspec-bg: rgba(0, 0, 0, .5);
    --outdatedspec-text: black;
    --outdated-bg: maroon;
    --outdated-text: white;
    --outdated-shadow: red;

    --editedrec-bg: darkorange;
}

@media (prefers-color-scheme: dark) {
    :root {
        --text: #ddd;
        --bg: black;

        --unofficial-watermark: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='400'%3E%3Cg fill='%23100808' transform='translate(200 200) rotate(-45) translate(-200 -200)' stroke='%23100808' stroke-width='3'%3E%3Ctext x='50%25' y='220' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EUNOFFICIAL%3C/text%3E%3Ctext x='50%25' y='305' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EDRAFT%3C/text%3E%3C/g%3E%3C/svg%3E");

        --logo-bg: #1a5e9a;
        --logo-active-bg: #c00;
        --logo-text: white;

        --tocnav-normal-text: #999;
        --tocnav-normal-bg: var(--bg);
        --tocnav-hover-text: var(--tocnav-normal-text);
        --tocnav-hover-bg: #080808;
        --tocnav-active-text: #f44;
        --tocnav-active-bg: var(--tocnav-normal-bg);

        --tocsidebar-text: var(--text);
        --tocsidebar-bg: #080808;
        --tocsidebar-shadow: rgba(255,255,255,.1);
        --tocsidebar-heading-text: hsla(203,20%,40%,.7);

        --toclink-text: var(--text);
        --toclink-underline: #6af;
        --toclink-visited-text: var(--toclink-text);
        --toclink-visited-underline: #054572;

        --heading-text: #8af;

        --hr-text: var(--text);

        --algo-border: #456;

        --del-text: #f44;
        --del-bg: transparent;
        --ins-text: #4a4;
        --ins-bg: transparent;

        --a-normal-text: #6af;
        --a-normal-underline: #555;
        --a-visited-text: var(--a-normal-text);
        --a-visited-underline: var(--a-normal-underline);
        --a-hover-bg: rgba(25%, 25%, 25%, .2);
        --a-active-text: #f44;
        --a-active-underline: var(--a-active-text);

        --borderedblock-bg: rgba(255, 255, 255, .05);

        --blockquote-border: silver;
        --blockquote-bg: var(--borderedblock-bg);
        --blockquote-text: currentcolor;

        --issue-border: #e05252;
        --issue-bg: var(--borderedblock-bg);
        --issue-text: var(--text);
        --issueheading-text: hsl(0deg, 70%, 70%);

        --example-border: hsl(50deg, 90%, 60%);
        --example-bg: var(--borderedblock-bg);
        --example-text: var(--text);
        --exampleheading-text: hsl(50deg, 70%, 70%);

        --note-border: hsl(120deg, 100%, 35%);
        --note-bg: var(--borderedblock-bg);
        --note-text: var(--text);
        --noteheading-text: hsl(120, 70%, 70%);
        --notesummary-underline: silver;

        --assertion-border: #444;
        --assertion-bg: var(--borderedblock-bg);
        --assertion-text: var(--text);

        --advisement-border: orange;
        --advisement-bg: #222218;
        --advisement-text: var(--text);
        --advisementheading-text: #f84;

        --warning-border: red;
        --warning-bg: hsla(40,100%,20%,0.95);
        --warning-text: var(--text);

        --amendment-border: #330099;
        --amendment-bg: #080010;
        --amendment-text: var(--text);
        --amendmentheading-text: #cc00ff;

        --def-border: #8ccbf2;
        --def-bg: #080818;
        --def-text: var(--text);
        --defrow-border: #136;

        --datacell-border: silver;

        --indexinfo-text: #aaa;

        --indextable-hover-text: var(--text);
        --indextable-hover-bg: #181818;

        --outdatedspec-bg: rgba(255, 255, 255, .5);
        --outdatedspec-text: black;
        --outdated-bg: maroon;
        --outdated-text: white;
        --outdated-shadow: red;

        --editedrec-bg: darkorange;
    }
    /* In case a transparent-bg image doesn't expect to be on a dark bg,
       which is quite common in practice... */
    img { background: white; }
}
</style>
<style>/* Boilerplate: style-counters */
body {
    counter-reset: example figure issue;
}
.issue {
    counter-increment: issue;
}
.issue:not(.no-marker)::before {
    content: "Issue " counter(issue);
}

.example {
    counter-increment: example;
}
.example:not(.no-marker)::before {
    content: "Example " counter(example);
}
.invalid.example:not(.no-marker)::before,
.illegal.example:not(.no-marker)::before {
    content: "Invalid Example" counter(example);
}

figcaption {
    counter-increment: figure;
}
figcaption:not(.no-marker)::before {
    content: "Figure " counter(figure) " ";
}
</style>
<style>/* Boilerplate: style-dfn-panel */
:root {
    --dfnpanel-bg: #ddd;
    --dfnpanel-text: var(--text);
    --dfnpanel-target-bg: #ffc;
    --dfnpanel-target-outline: orange;
}
@media (prefers-color-scheme: dark) {
    :root {
        --dfnpanel-bg: #222;
        --dfnpanel-text: var(--text);
        --dfnpanel-target-bg: #333;
        --dfnpanel-target-outline: silver;
    }
}
.dfn-panel {
    position: absolute;
    z-index: 35;
    width: 20em;
    width: 300px;
    height: auto;
    max-height: 500px;
    overflow: auto;
    padding: 0.5em 0.75em;
    font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
    background: var(--dfnpanel-bg);
    color: var(--dfnpanel-text);
    border: outset 0.2em;
    white-space: normal; /* in case it's moved into a pre */
}
.dfn-panel:not(.on) { display: none; }
.dfn-panel * { margin: 0; padding: 0; text-indent: 0; }
.dfn-panel > b { display: block; }
.dfn-panel a { color: var(--dfnpanel-text); }
.dfn-panel a:not(:hover) { text-decoration: none !important; border-bottom: none !important; }
.dfn-panel a:focus {
    outline: 5px auto Highlight;
    outline: 5px auto -webkit-focus-ring-color;
}
.dfn-panel > b + b { margin-top: 0.25em; }
.dfn-panel ul { padding: 0 0 0 1em; list-style: none; }
.dfn-panel li a {
    max-width: calc(300px - 1.5em - 1em);
    overflow: hidden;
    text-overflow: ellipsis;
}

.dfn-panel.activated {
    display: inline-block;
    position: fixed;
    left: 8px;
    bottom: 2em;
    margin: 0 auto;
    max-width: calc(100vw - 1.5em - .4em - .5em);
    max-height: 30vh;
    transition: left 1s ease-out, bottom 1s ease-out;
}

.dfn-panel .link-item:hover {
    text-decoration: underline;
}
.dfn-panel .link-item .copy-icon {
    opacity: 0;
}
.dfn-panel .link-item:hover .copy-icon,
.dfn-panel .link-item .copy-icon:focus {
    opacity: 1;
}

.dfn-panel .copy-icon {
    display: inline-block;
    margin-right: 0.5em;
    width: 0.85em;
    height: 1em;
    border-radius: 3px;
    background-color: #ccc;
    cursor: pointer;
}

.dfn-panel .copy-icon .icon {
    width: 100%;
    height: 100%;
    background-color: #fff;
    display: flex;
    justify-content: center;
    align-items: center;
    position: relative;
}

.dfn-panel .copy-icon .icon::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    border: 1px solid black;
    background-color: #ccc;
    opacity: 0.25;
    transform: translate(3px, -3px);
}

.dfn-panel .copy-icon:active .icon::before {
    opacity: 1;
}

.dfn-paneled[role="button"] { cursor: help; }

.highlighted {
    animation: target-fade 3s;
}

@keyframes target-fade {
    from {
        background-color: var(--dfnpanel-target-bg);
        outline: 5px solid var(--dfnpanel-target-outline);
    }
    to {
        color: var(--a-normal-text);
        background-color: transparent;
        outline: transparent;
    }
}
</style>
<style>/* Boilerplate: style-idl-highlighting */
pre.idl.highlight {
    background: var(--borderedblock-bg, var(--def-bg));
}
</style>
<style>/* Boilerplate: style-issues */
a[href].issue-return {
    float: right;
    float: inline-end;
    color: var(--issueheading-text);
    font-weight: bold;
    text-decoration: none;
}
</style>
<style>/* Boilerplate: style-md-lists */
/* This is a weird hack for me not yet following the commonmark spec
   regarding paragraph and lists. */
[data-md] > :first-child {
    margin-top: 0;
}
[data-md] > :last-child {
    margin-bottom: 0;
}
</style>
<style>/* Boilerplate: style-ref-hints */
:root {
    --ref-hint-bg: #ddd;
    --ref-hint-text: var(--text);
}
@media (prefers-color-scheme: dark) {
    :root {
        --ref-hint-bg: #222;
        --ref-hint-text: var(--text);
    }
}

.ref-hint {
    display: inline-block;
    position: absolute;
    z-index: 35;
    width: 20em;
    width: 300px;
    height: auto;
    max-height: 500px;
    overflow: auto;
    padding: 0.5em 0.5em;
    font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
    background: var(--ref-hint-bg);
    color: var(--ref-hint-text);
    border: outset 0.2em;
    white-space: normal; /* in case it's moved into a pre */
}

.ref-hint * { margin: 0; padding: 0; text-indent: 0; }

.ref-hint ul { padding: 0 0 0 1em; list-style: none; }
</style>
<style>/* Boilerplate: style-selflinks */
:root {
    --selflink-text: white;
    --selflink-bg: gray;
    --selflink-hover-text: black;
}
.heading, .issue, .note, .example, li, dt {
    position: relative;
}
a.self-link {
    position: absolute;
    top: 0;
    left: calc(-1 * (3.5rem - 26px));
    width: calc(3.5rem - 26px);
    height: 2em;
    text-align: center;
    border: none;
    transition: opacity .2s;
    opacity: .5;
}
a.self-link:hover {
    opacity: 1;
}
.heading > a.self-link {
    font-size: 83%;
}
.example > a.self-link,
.note > a.self-link,
.issue > a.self-link {
    /* These blocks are overflow:auto, so positioning outside
       doesn't work. */
    left: auto;
    right: 0;
}
li > a.self-link {
    left: calc(-1 * (3.5rem - 26px) - 2em);
}
dfn > a.self-link {
    top: auto;
    left: auto;
    opacity: 0;
    width: 1.5em;
    height: 1.5em;
    background: var(--selflink-bg);
    color: var(--selflink-text);
    font-style: normal;
    transition: opacity .2s, background-color .2s, color .2s;
}
dfn:hover > a.self-link {
    opacity: 1;
}
dfn > a.self-link:hover {
    color: var(--selflink-hover-text);
}

a.self-link::before            { content: "¶"; }
.heading > a.self-link::before { content: "§"; }
dfn > a.self-link::before      { content: "#"; }
</style>
<style>/* Boilerplate: style-syntax-highlighting */
code.highlight { padding: .1em; border-radius: .3em; }
pre.highlight, pre > code.highlight { display: block; padding: 1em; margin: .5em 0; overflow: auto; border-radius: 0; }

.highlight:not(.idl) { background: rgba(0, 0, 0, .03); }
c-[a] { color: #990055 } /* Keyword.Declaration */
c-[b] { color: #990055 } /* Keyword.Type */
c-[c] { color: #708090 } /* Comment */
c-[d] { color: #708090 } /* Comment.Multiline */
c-[e] { color: #0077aa } /* Name.Attribute */
c-[f] { color: #669900 } /* Name.Tag */
c-[g] { color: #222222 } /* Name.Variable */
c-[k] { color: #990055 } /* Keyword */
c-[l] { color: #000000 } /* Literal */
c-[m] { color: #000000 } /* Literal.Number */
c-[n] { color: #0077aa } /* Name */
c-[o] { color: #999999 } /* Operator */
c-[p] { color: #999999 } /* Punctuation */
c-[s] { color: #a67f59 } /* Literal.String */
c-[t] { color: #a67f59 } /* Literal.String.Single */
c-[u] { color: #a67f59 } /* Literal.String.Double */
c-[cp] { color: #708090 } /* Comment.Preproc */
c-[c1] { color: #708090 } /* Comment.Single */
c-[cs] { color: #708090 } /* Comment.Special */
c-[kc] { color: #990055 } /* Keyword.Constant */
c-[kn] { color: #990055 } /* Keyword.Namespace */
c-[kp] { color: #990055 } /* Keyword.Pseudo */
c-[kr] { color: #990055 } /* Keyword.Reserved */
c-[ld] { color: #000000 } /* Literal.Date */
c-[nc] { color: #0077aa } /* Name.Class */
c-[no] { color: #0077aa } /* Name.Constant */
c-[nd] { color: #0077aa } /* Name.Decorator */
c-[ni] { color: #0077aa } /* Name.Entity */
c-[ne] { color: #0077aa } /* Name.Exception */
c-[nf] { color: #0077aa } /* Name.Function */
c-[nl] { color: #0077aa } /* Name.Label */
c-[nn] { color: #0077aa } /* Name.Namespace */
c-[py] { color: #0077aa } /* Name.Property */
c-[ow] { color: #999999 } /* Operator.Word */
c-[mb] { color: #000000 } /* Literal.Number.Bin */
c-[mf] { color: #000000 } /* Literal.Number.Float */
c-[mh] { color: #000000 } /* Literal.Number.Hex */
c-[mi] { color: #000000 } /* Literal.Number.Integer */
c-[mo] { color: #000000 } /* Literal.Number.Oct */
c-[sb] { color: #a67f59 } /* Literal.String.Backtick */
c-[sc] { color: #a67f59 } /* Literal.String.Char */
c-[sd] { color: #a67f59 } /* Literal.String.Doc */
c-[se] { color: #a67f59 } /* Literal.String.Escape */
c-[sh] { color: #a67f59 } /* Literal.String.Heredoc */
c-[si] { color: #a67f59 } /* Literal.String.Interpol */
c-[sx] { color: #a67f59 } /* Literal.String.Other */
c-[sr] { color: #a67f59 } /* Literal.String.Regex */
c-[ss] { color: #a67f59 } /* Literal.String.Symbol */
c-[vc] { color: #0077aa } /* Name.Variable.Class */
c-[vg] { color: #0077aa } /* Name.Variable.Global */
c-[vi] { color: #0077aa } /* Name.Variable.Instance */
c-[il] { color: #000000 } /* Literal.Number.Integer.Long */

@media (prefers-color-scheme: dark) {
    .highlight:not(.idl) { background: rgba(255, 255, 255, .05); }

    c-[a] { color: #d33682 } /* Keyword.Declaration */
    c-[b] { color: #d33682 } /* Keyword.Type */
    c-[c] { color: #2aa198 } /* Comment */
    c-[d] { color: #2aa198 } /* Comment.Multiline */
    c-[e] { color: #268bd2 } /* Name.Attribute */
    c-[f] { color: #b58900 } /* Name.Tag */
    c-[g] { color: #cb4b16 } /* Name.Variable */
    c-[k] { color: #d33682 } /* Keyword */
    c-[l] { color: #657b83 } /* Literal */
    c-[m] { color: #657b83 } /* Literal.Number */
    c-[n] { color: #268bd2 } /* Name */
    c-[o] { color: #657b83 } /* Operator */
    c-[p] { color: #657b83 } /* Punctuation */
    c-[s] { color: #6c71c4 } /* Literal.String */
    c-[t] { color: #6c71c4 } /* Literal.String.Single */
    c-[u] { color: #6c71c4 } /* Literal.String.Double */
    c-[ch] { color: #2aa198 } /* Comment.Hashbang */
    c-[cp] { color: #2aa198 } /* Comment.Preproc */
    c-[cpf] { color: #2aa198 } /* Comment.PreprocFile */
    c-[c1] { color: #2aa198 } /* Comment.Single */
    c-[cs] { color: #2aa198 } /* Comment.Special */
    c-[kc] { color: #d33682 } /* Keyword.Constant */
    c-[kn] { color: #d33682 } /* Keyword.Namespace */
    c-[kp] { color: #d33682 } /* Keyword.Pseudo */
    c-[kr] { color: #d33682 } /* Keyword.Reserved */
    c-[ld] { color: #657b83 } /* Literal.Date */
    c-[nc] { color: #268bd2 } /* Name.Class */
    c-[no] { color: #268bd2 } /* Name.Constant */
    c-[nd] { color: #268bd2 } /* Name.Decorator */
    c-[ni] { color: #268bd2 } /* Name.Entity */
    c-[ne] { color: #268bd2 } /* Name.Exception */
    c-[nf] { color: #268bd2 } /* Name.Function */
    c-[nl] { color: #268bd2 } /* Name.Label */
    c-[nn] { color: #268bd2 } /* Name.Namespace */
    c-[py] { color: #268bd2 } /* Name.Property */
    c-[ow] { color: #657b83 } /* Operator.Word */
    c-[mb] { color: #657b83 } /* Literal.Number.Bin */
    c-[mf] { color: #657b83 } /* Literal.Number.Float */
    c-[mh] { color: #657b83 } /* Literal.Number.Hex */
    c-[mi] { color: #657b83 } /* Literal.Number.Integer */
    c-[mo] { color: #657b83 } /* Literal.Number.Oct */
    c-[sa] { color: #6c71c4 } /* Literal.String.Affix */
    c-[sb] { color: #6c71c4 } /* Literal.String.Backtick */
    c-[sc] { color: #6c71c4 } /* Literal.String.Char */
    c-[dl] { color: #6c71c4 } /* Literal.String.Delimiter */
    c-[sd] { color: #6c71c4 } /* Literal.String.Doc */
    c-[se] { color: #6c71c4 } /* Literal.String.Escape */
    c-[sh] { color: #6c71c4 } /* Literal.String.Heredoc */
    c-[si] { color: #6c71c4 } /* Literal.String.Interpol */
    c-[sx] { color: #6c71c4 } /* Literal.String.Other */
    c-[sr] { color: #6c71c4 } /* Literal.String.Regex */
    c-[ss] { color: #6c71c4 } /* Literal.String.Symbol */
    c-[fm] { color: #268bd2 } /* Name.Function.Magic */
    c-[vc] { color: #cb4b16 } /* Name.Variable.Class */
    c-[vg] { color: #cb4b16 } /* Name.Variable.Global */
    c-[vi] { color: #cb4b16 } /* Name.Variable.Instance */
    c-[vm] { color: #cb4b16 } /* Name.Variable.Magic */
    c-[il] { color: #657b83 } /* Literal.Number.Integer.Long */
}
</style>
<style>/* Boilerplate: style-var-click-highlighting */
/*
Colors were chosen in Lab using https://nixsensor.com/free-color-converter/
D50 2deg illuminant, L in [0,100], a and b in [-128, 128]
0 = lab(85,0,85)
1 = lab(85,80,30)
2 = lab(85,-40,40)
3 = lab(85,-50,0)
4 = lab(85,5,15)
5 = lab(85,-10,-50)
6 = lab(85,35,-15)

For darkmode:
0 = oklab(50%   0%  108%)
1 = oklab(50% -51%   51%)
2 = oklab(50% -64%  -20%)
3 = oklab(50%   6%   19%)
4 = oklab(50% -12%  -64%)
5 = oklab(50%  44%  -19%)  
6 = oklab(50% 102%   38%)
*/

[data-algorithm] var { cursor: pointer; }
var[data-var-color] { background-color: var(--var-bg); box-shadow: 0 0 0 2px var(--var-bg); }

var[data-var-color] { --var-bg: #F4D200; }
var[data-var-color="1"] { --var-bg: #FF87A2; }
var[data-var-color="2"] { --var-bg: #96E885; }
var[data-var-color="3"] { --var-bg: #3EEED2; }
var[data-var-color="4"] { --var-bg: #EACFB6; }
var[data-var-color="5"] { --var-bg: #82DDFF; }
var[data-var-color="6"] { --var-vg: #FFBCF2; }

@media (prefers-color-scheme: dark) {
	var[data-var-color] { --var-bg: #bc1a00; }
	var[data-var-color="1"] { --var-bg: #007f00; }
	var[data-var-color="2"] { --var-bg: #008698; }
	var[data-var-color="3"] { --var-bg: #7f5b2b; }
	var[data-var-color="4"] { --var-bg: #004df3; }
	var[data-var-color="5"] { --var-bg: #a1248a; }
	var[data-var-color="6"] { --var-vg: #ff0000; }
}
</style>
 <body class="h-entry">
  <div class="head">
   <p data-fill-with="logo"><a class="logo" href="https://www.w3.org/"> <img alt="W3C" height="48" src="https://www.w3.org/StyleSheets/TR/2021/logos/W3C" width="72"> </a> </p>
   <h1 class="p-name no-ref" id="title">KV Storage</h1>
   <p id="w3c-state"><a href="https://www.w3.org/standards/types/#CG-DRAFT">Draft Community Group Report</a>, <time class="dt-updated" datetime="1970-01-01">1 January 1970</time></p>
   <div data-fill-with="spec-metadata">
    <dl>
     <dt>This version:
     <dd><a class="u-url" href="https://wicg.github.io/kv-storage/">https://wicg.github.io/kv-storage/</a>
     <dt class="editor">Editor:
     <dd class="editor p-author h-card vcard"><a class="p-name fn u-url url" href="https://domenic.me/">Domenic Denicola</a> (<a class="p-org org" href="https://www.google.com/">Google</a>) <a class="u-email email" href="mailto:d@domenic.me">d@domenic.me</a>
     <dt>Participate:
     <dd><a href="https://github.com/WICG/kv-storage">GitHub WICG/kv-storage</a> (<a href="https://github.com/WICG/kv-storage/issues/new">new issue</a>, <a href="https://github.com/WICG/kv-storage/issues?state=open">open issues</a>)
     <dt>Commits:
     <dd><a href="https://github.com/WICG/kv-storage/commits/master/spec.bs">GitHub spec.bs commits</a>
    </dl>
   </div>
   <div data-fill-with="warning"></div>
   <p class="copyright" data-fill-with="copyright"><a href="https://www.w3.org/policies/#copyright">Copyright</a> © 1970 the Contributors to the KV Storage Specification, published by the <a href="https://www.w3.org/community/wicg/">Web Platform Incubator Community Group</a> under the <a href="https://www.w3.org/community/about/agreements/cla/">W3C Community Contributor License Agreement (CLA)</a>.
A human-readable <a href="http://www.w3.org/community/about/agreements/cla-deed/">summary</a> is available. </p>
   <hr title="Separator for header">
  </div>
  <div class="p-summary" data-fill-with="abstract">
   <h2 class="no-num no-toc no-ref heading settled" id="abstract"><span class="content">Abstract</span></h2>
   <p>This specification details a high level asynchronous key/value storage API, layered on top of IndexedDB, and as a spiritual successor to the original <span class="non-normative"><code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/webstorage.html#dom-localstorage" id="ref-for-dom-localstorage">localStorage</a></code></span>.</p>
  </div>
  <div data-fill-with="at-risk"></div>
  <h2 class="no-num no-toc no-ref heading settled" id="status"><span class="content">Status of this document</span></h2>
  <div data-fill-with="status">
   <p> This specification was published by the <a href="https://www.w3.org/community/wicg/">Web Platform Incubator Community Group</a>.
  It is not a W3C Standard nor is it on the W3C Standards Track.

  Please note that under the <a href="https://www.w3.org/community/about/agreements/cla/">W3C Community Contributor License Agreement (CLA)</a> there is a limited opt-out and other conditions apply.

  Learn more about <a href="http://www.w3.org/community/">W3C Community and Business Groups</a>. </p>
   <p></p>
  </div>
  <div data-fill-with="at-risk"></div>
  <nav data-fill-with="table-of-contents" id="toc">
   <h2 class="no-num no-toc no-ref" id="contents">Table of Contents</h2>
   <ol class="toc" role="directory">
    <li><a href="#intro"><span class="secno">1</span> <span class="content">Introduction</span></a>
    <li><a href="#global"><span class="secno">2</span> <span class="content">The <code class="idl"><span>kvStorage</span></code> global</span></a>
    <li>
     <a href="#KVStorageArea"><span class="secno">3</span> <span class="content">The <code>KVStorageArea</code> class</span></a>
     <ol class="toc">
      <li><a href="#KVStorageArea-constructor"><span class="secno">3.1</span> <span class="content">constructor(<var>name</var>)</span></a>
      <li><a href="#KVStorageArea-set"><span class="secno">3.2</span> <span class="content">set(<var>key</var>, <var>value</var>)</span></a>
      <li><a href="#KVStorageArea-get"><span class="secno">3.3</span> <span class="content">get(<var>key</var>)</span></a>
      <li><a href="#KVStorageArea-delete"><span class="secno">3.4</span> <span class="content">delete(<var>key</var>)</span></a>
      <li><a href="#KVStorageArea-clear"><span class="secno">3.5</span> <span class="content">clear()</span></a>
      <li><a href="#KVStorageArea-iteration"><span class="secno">3.6</span> <span class="content">Iteration</span></a>
      <li><a href="#KVStorageArea-backingstore"><span class="secno">3.7</span> <span class="content">backingStore</span></a>
     </ol>
    <li><a href="#supporting"><span class="secno">4</span> <span class="content">Supporting operations and concepts</span></a>
    <li><a href="#acks"><span class="secno"></span> <span class="content">Acknowledgments</span></a>
    <li><a href="#conformance"><span class="secno"></span> <span class="content">Conformance</span></a>
    <li>
     <a href="#index"><span class="secno"></span> <span class="content">Index</span></a>
     <ol class="toc">
      <li><a href="#index-defined-here"><span class="secno"></span> <span class="content">Terms defined by this specification</span></a>
      <li><a href="#index-defined-elsewhere"><span class="secno"></span> <span class="content">Terms defined by reference</span></a>
     </ol>
    <li>
     <a href="#references"><span class="secno"></span> <span class="content">References</span></a>
     <ol class="toc">
      <li><a href="#normative"><span class="secno"></span> <span class="content">Normative References</span></a>
      <li><a href="#informative"><span class="secno"></span> <span class="content">Informative References</span></a>
     </ol>
    <li><a href="#idl-index"><span class="secno"></span> <span class="content">IDL Index</span></a>
   </ol>
  </nav>
  <main>
   <script async src="https://resources.whatwg.org/file-issue.js"></script>
   <details class="annoying-warning" open>
    <summary>Not an active specification</summary>
    <p>Work on this specification is currently suspended, as no browser teams (including the Chromium project, which originated the proposal) are currently indicating interest in implementing it.</p>
   </details>
   <h2 class="heading settled" data-level="1" id="intro"><span class="secno">1. </span><span class="content">Introduction</span><a class="self-link" href="#intro"></a></h2>
   <div class="non-normative">
    <p><em>This section is non-normative.</em></p>
    <p>The <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/webstorage.html#dom-localstorage" id="ref-for-dom-localstorage①">localStorage</a></code> API is widely used, and loved for its simplicity. However, its synchronous nature leads to <a href="https://hacks.mozilla.org/2012/03/there-is-no-simple-solution-for-local-storage/">terrible performance</a> and cross-window synchronization issues.</p>
    <p>This specification proposes a new API, called KV storage, which is intended to provide an analogously simple interface, while being asynchronous. Along the way, it embraces some additional goals:</p>
    <ul>
     <li data-md>
      <p><strong>Layer on top of Indexed Database.</strong> This avoids introducing a new type of storage for user agents and web developers to manage, and allows an upgrade path to full IndexedDB usage if a web developer outgrows the KV storage interface. <a data-link-type="biblio" href="#biblio-indexeddb-2" title="Indexed Database API 2.0">[INDEXEDDB-2]</a></p>
     <li data-md>
      <p><strong>Modernize the API surface.</strong> Modern key/value stores in the platform, such as the <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/ServiceWorker/#cache" id="ref-for-cache">Cache</a></code> or <code class="idl"><a data-link-type="idl" href="https://fetch.spec.whatwg.org/#headers" id="ref-for-headers">Headers</a></code> APIs, have aligned around the operation names given by JavaScript’s <code class="idl"><a data-link-type="idl" href="https://tc39.github.io/ecma262/#sec-map-objects" id="ref-for-sec-map-objects">Map</a></code>. We follow their example. As a bonus, this allows us to avoid the legacy <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#idl-named-properties" id="ref-for-idl-named-properties">named properties</a> feature that the <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/webstorage.html#storage-2" id="ref-for-storage-2">Storage</a></code> interface uses.</p>
     <li data-md>
      <p><strong>Support isolated storage areas.</strong> <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/webstorage.html#dom-localstorage" id="ref-for-dom-localstorage②">localStorage</a></code> requires careful namespacing of keys to use robustly in a multi-actor environment. Popular libraries meant to replace it, like <a href="https://localforage.github.io/localForage/">localForage</a>, have included a way to create new storage areas beyond the default one.</p>
    </ul>
    <div class="example" id="example-from-html-spec">
     <a class="self-link" href="#example-from-html-spec"></a> A conversion of <a href="https://html.spec.whatwg.org/multipage/webstorage.html#introduction-15">the HTML Standard’s <code>localStorage</code> example</a> to use KV storage might look like the following: 
<pre class="highlight"><c- p>&lt;</c-><c- f>p</c-><c- p>></c->
  You have viewed this page
  <c- p>&lt;</c-><c- f>span</c-> <c- e>id</c-><c- o>=</c-><c- s>"count"</c-><c- p>></c->an untold number of<c- p>&lt;/</c-><c- f>span</c-><c- p>></c->
  time(s).
<c- p>&lt;/</c-><c- f>p</c-><c- p>></c->
<c- p>&lt;</c-><c- f>script</c-> <c- e>type</c-><c- o>=</c-><c- s>"module"</c-><c- p>></c->
  <c- p>(</c-><c- k>async</c-> <c- p>()</c-> <c- p>=></c-> <c- p>{</c->
    <c- a>let</c-> pageLoadCount <c- o>=</c-> <c- k>await</c-> kvStorage<c- p>.</c->get<c- p>(</c-><c- u>"pageLoadCount"</c-><c- p>)</c-> <c- o>||</c-> <c- mf>0</c-><c- p>;</c->
    <c- o>++</c->pageLoadCount<c- p>;</c->

    document<c- p>.</c->querySelector<c- p>(</c-><c- u>"#count"</c-><c- p>).</c->textContent <c- o>=</c-> pageLoadCount<c- p>;</c->

    <c- k>await</c-> kvStorage<c- p>.</c->set<c- p>(</c-><c- u>"pageLoadCount"</c-><c- p>,</c-> pageLoadCount<c- p>);</c->
  <c- p>})();</c->
<c- p>&lt;/</c-><c- f>script</c-><c- p>></c->
</pre>
     <p>As a side note, observe how, in contrast to the original example which performs up to five storage operations, our example only performs two. Also, it updates the UI as soon as possible, instead of delaying the UI update until we’ve set the new page load count.</p>
     <p>The KV storage API design can take some credit for this, as by forcing us to explicitly state our <code>await</code> points, it makes it more obvious that we’re performing a potentially-expensive storage operation.</p>
    </div>
   </div>
   <h2 class="heading settled" data-level="2" id="global"><span class="secno">2. </span><span class="content">The <code class="idl"><a data-link-type="idl" href="#dom-windoworworkerglobalscope-kvstorage" id="ref-for-dom-windoworworkerglobalscope-kvstorage">kvStorage</a></code> global</span><a class="self-link" href="#global"></a></h2>
<pre class="idl highlight def"><c- b>partial</c-> <c- b>interface</c-> <a class="idl-code" data-link-type="interface" href="https://html.spec.whatwg.org/multipage/webappapis.html#windoworworkerglobalscope" id="ref-for-windoworworkerglobalscope"><c- g>WindowOrWorkerGlobalScope</c-></a> {
  [<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#SecureContext" id="ref-for-SecureContext"><c- g>SecureContext</c-></a>] <c- b>readonly</c-> <c- b>attribute</c-> <a data-link-type="idl-name" href="#KVStorageArea" id="ref-for-KVStorageArea"><c- n>KVStorageArea</c-></a> <a class="idl-code" data-link-type="attribute" data-readonly data-type="KVStorageArea" href="#dom-windoworworkerglobalscope-kvstorage" id="ref-for-dom-windoworworkerglobalscope-kvstorage①"><c- g>kvStorage</c-></a>;
};
</pre>
   <div class="domintro non-normative" id="module-domintro">
    <dl>
     <dt><code>self . <code class="idl"><a data-link-type="idl" href="#dom-windoworworkerglobalscope-kvstorage" id="ref-for-dom-windoworworkerglobalscope-kvstorage②">kvStorage</a></code></code> 
     <dd>
      <p>Returns the default storage area. It is a pre-constructed instance of the <code class="idl"><a data-link-type="idl" href="#KVStorageArea" id="ref-for-KVStorageArea①">KVStorageArea</a></code> class, meant to be a convenience similar to <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/webstorage.html#dom-localstorage" id="ref-for-dom-localstorage③">localStorage</a></code>. </p>
      <p>This property is only present in <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#secure-context" id="ref-for-secure-context">secure contexts</a>, since persistent storage is a powerful feature. </p>
    </dl>
   </div>
   <p>Every <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/webappapis.html#windoworworkerglobalscope" id="ref-for-windoworworkerglobalscope①">WindowOrWorkerGlobalScope</a></code> has an associated <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="default-kv-storage-area">default KV Storage area</dfn>, which is a <code class="idl"><a data-link-type="idl" href="#KVStorageArea" id="ref-for-KVStorageArea②">KVStorageArea</a></code> created in that realm with <a data-link-type="dfn" href="#databasename" id="ref-for-databasename">[[DatabaseName]]</a> set to "<code>kv-storage:default</code>", <a data-link-type="dfn" href="#databasepromise" id="ref-for-databasepromise">[[DatabasePromise]]</a> initially set to null, and <a data-link-type="dfn" href="#backingstoreobject" id="ref-for-backingstoreobject">[[BackingStoreObject]]</a> initially set to null.</p>
   <p>The <dfn class="dfn-paneled idl-code" data-dfn-for="WindowOrWorkerGlobalScope" data-dfn-type="attribute" data-export id="dom-windoworworkerglobalscope-kvstorage"><code>kvStorage</code></dfn> attribute’s getter must return <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this">this</a>'s <a data-link-type="dfn" href="#default-kv-storage-area" id="ref-for-default-kv-storage-area">default KV Storage area</a>.</p>
   <h2 class="heading settled dfn-paneled idl-code" data-dfn-type="interface" data-export data-level="3" data-lt="KVStorageArea" id="KVStorageArea"><span class="secno">3. </span><span class="content">The <code>KVStorageArea</code> class</span><a class="self-link" href="#KVStorageArea" id="ref-for-KVStorageArea①④"></a></h2>
<pre class="idl highlight def">[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#SecureContext" id="ref-for-SecureContext①"><c- g>SecureContext</c-></a>, <a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed" id="ref-for-Exposed"><c- g>Exposed</c-></a>=(<c- n>Window</c->,<c- n>Worker</c->)]
<c- b>interface</c-> <a class="idl-code" data-link-type="interface" href="#KVStorageArea" id="ref-for-KVStorageArea③"><c- g>KVStorageArea</c-></a> {
  <a class="idl-code" data-link-type="constructor" href="#KVStorageArea-constructor" id="ref-for-KVStorageArea-constructor"><c- g>constructor</c-></a>(<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString" id="ref-for-idl-DOMString"><c- b>DOMString</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="KVStorageArea/KVStorageArea(name), KVStorageArea/constructor(name)" data-dfn-type="argument" data-export id="dom-kvstoragearea-kvstoragearea-name-name"><code><c- g>name</c-></code></dfn>);

  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise" id="ref-for-idl-promise"><c- b>Promise</c-></a>&lt;<a data-link-type="idl-name"><c- n>void</c-></a>> <a class="idl-code" data-link-type="method" href="#KVStorageArea-set" id="ref-for-KVStorageArea-set"><c- g>set</c-></a>(<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-any" id="ref-for-idl-any"><c- b>any</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="KVStorageArea/set(key, value)" data-dfn-type="argument" data-export id="dom-kvstoragearea-set-key-value-key"><code><c- g>key</c-></code></dfn>, <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-any" id="ref-for-idl-any①"><c- b>any</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="KVStorageArea/set(key, value)" data-dfn-type="argument" data-export id="dom-kvstoragearea-set-key-value-value"><code><c- g>value</c-></code></dfn>);
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise" id="ref-for-idl-promise①"><c- b>Promise</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-any" id="ref-for-idl-any②"><c- b>any</c-></a>> <a class="idl-code" data-link-type="method" href="#KVStorageArea-get" id="ref-for-KVStorageArea-get"><c- g>get</c-></a>(<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-any" id="ref-for-idl-any③"><c- b>any</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="KVStorageArea/get(key)" data-dfn-type="argument" data-export id="dom-kvstoragearea-get-key-key"><code><c- g>key</c-></code></dfn>);
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise" id="ref-for-idl-promise②"><c- b>Promise</c-></a>&lt;<a data-link-type="idl-name"><c- n>void</c-></a>> <a class="idl-code" data-link-type="method" href="#KVStorageArea-delete" id="ref-for-KVStorageArea-delete"><c- g>delete</c-></a>(<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-any" id="ref-for-idl-any④"><c- b>any</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="KVStorageArea/delete(key)" data-dfn-type="argument" data-export id="dom-kvstoragearea-delete-key-key"><code><c- g>key</c-></code></dfn>);
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise" id="ref-for-idl-promise③"><c- b>Promise</c-></a>&lt;<a data-link-type="idl-name"><c- n>void</c-></a>> <a class="idl-code" data-link-type="method" href="#KVStorageArea-clear" id="ref-for-KVStorageArea-clear"><c- g>clear</c-></a>();

  <c- b>async</c-> <c- b>iterable</c->&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-any" id="ref-for-idl-any⑤"><c- b>any</c-></a>, <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-any" id="ref-for-idl-any⑥"><c- b>any</c-></a>>;

  [<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#SameObject" id="ref-for-SameObject"><c- g>SameObject</c-></a>] <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-object" id="ref-for-idl-object"><c- b>object</c-></a> <a class="idl-code" data-link-type="attribute" data-readonly data-type="object" href="#KVStorageArea-backingstore" id="ref-for-KVStorageArea-backingstore"><c- g>backingStore</c-></a>;
};
</pre>
   <p>Each <code class="idl"><a data-link-type="idl" href="#KVStorageArea" id="ref-for-KVStorageArea④">KVStorageArea</a></code> instance must also contain the <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="databasename">[[DatabaseName]]</dfn>, <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="databasepromise">[[DatabasePromise]]</dfn>, and <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="backingstoreobject">[[BackingStoreObject]]</dfn> internal slots. The following is a non-normative summary of their meaning:</p>
   <dl class="non-normative">
    <dt><a data-link-type="dfn" href="#databasename" id="ref-for-databasename①">[[DatabaseName]]</a> 
    <dd>A string containing the name of the backing IndexedDB database. 
    <dt><a data-link-type="dfn" href="#databasepromise" id="ref-for-databasepromise①">[[DatabasePromise]]</a> 
    <dd>A promise for an <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/IndexedDB/#idbdatabase" id="ref-for-idbdatabase">IDBDatabase</a></code> object, lazily initialized when <a data-link-type="dfn" href="#performing-a-database-operation" id="ref-for-performing-a-database-operation">performing any database operation</a>. 
    <dt><a data-link-type="dfn" href="#backingstoreobject" id="ref-for-backingstoreobject①">[[BackingStoreObject]]</a>
    <dd>The object returned by the <code class="idl"><a data-link-type="idl" href="#KVStorageArea-backingstore" id="ref-for-KVStorageArea-backingstore①">backingStore</a></code> getter, cached to ensure identity across gets.
   </dl>
   <h3 class="heading settled dfn-paneled idl-code" data-dfn-for="KVStorageArea" data-dfn-type="constructor" data-export data-level="3.1" data-lt="KVStorageArea(name)|constructor(name)" id="KVStorageArea-constructor"><span class="secno">3.1. </span><span class="content">constructor(<var>name</var>)</span><a class="self-link" href="#KVStorageArea-constructor" id="ref-for-KVStorageArea-constructor②"></a></h3>
   <dl class="domintro non-normative">
    <dt><code><var>storage</var> = new <code class="idl"><a data-link-type="idl" href="#KVStorageArea-constructor" id="ref-for-KVStorageArea-constructor①">KVStorageArea</a></code>(<var>name</var>)</code> 
    <dd>
     <p>Creates a new <code class="idl"><a data-link-type="idl" href="#KVStorageArea" id="ref-for-KVStorageArea⑤">KVStorageArea</a></code> that provides an async key/value store view onto an IndexedDB database named <code>`kv-storage:${name}`</code>. </p>
     <p>This does not actually open or create the database yet; that is done lazily when other methods are called. This means that all other methods can reject with database-related exceptions in failure cases. </p>
   </dl>
   <div class="algorithm" data-algorithm="KVStorageArea constructor">
    <ol>
     <li data-md>
      <p>Set <b>this</b>.<a data-link-type="dfn" href="#databasename" id="ref-for-databasename②">[[DatabaseName]]</a> to the concatenation of "<code>kv-storage:</code>" and <var> name</var>.</p>
     <li data-md>
      <p>Set <b>this</b>.<a data-link-type="dfn" href="#databasepromise" id="ref-for-databasepromise②">[[DatabasePromise]]</a> to null.</p>
     <li data-md>
      <p>Set <b>this</b>.<a data-link-type="dfn" href="#backingstoreobject" id="ref-for-backingstoreobject②">[[BackingStoreObject]]</a> to null.</p>
    </ol>
   </div>
   <h3 class="heading settled dfn-paneled idl-code" data-dfn-for="KVStorageArea" data-dfn-type="method" data-export data-level="3.2" data-lt="set(key, value)" id="KVStorageArea-set"><span class="secno">3.2. </span><span class="content">set(<var>key</var>, <var>value</var>)</span><a class="self-link" href="#KVStorageArea-set" id="ref-for-KVStorageArea-set③"></a></h3>
   <dl class="domintro non-normative">
    <dt><code>await <var>storage</var>.<code class="idl"><a data-link-type="idl" href="#KVStorageArea-set" id="ref-for-KVStorageArea-set①">set</a></code>(<var>key</var>, <var>value</var>)</code> 
    <dd>
     <p>Asynchronously stores the given <var>value</var> so that it can later be retrieved by the given <var>key</var>. </p>
     <p>Keys have to follow the same restrictions as IndexedDB keys: roughly, a key can be a number, string, array, <code class="idl"><a data-link-type="idl" href="https://tc39.github.io/ecma262/#sec-date-objects" id="ref-for-sec-date-objects">Date</a></code>, <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-ArrayBuffer" id="ref-for-idl-ArrayBuffer">ArrayBuffer</a></code>, <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DataView" id="ref-for-idl-DataView">DataView</a></code>, <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#sec-typedarray-objects" id="ref-for-sec-typedarray-objects">typed array</a>, or an array of these. Invalid keys will cause the returned promise to reject with a "<code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#dataerror" id="ref-for-dataerror">DataError</a></code>" <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException">DOMException</a></code>. </p>
     <p>Values can be any value that can be <a data-link-type="abstract-op" href="https://html.spec.whatwg.org/multipage/structured-data.html#structuredserializeforstorage" id="ref-for-structuredserializeforstorage">structured-serialized for storage</a>. Un-serializable values will cause a "<code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#datacloneerror" id="ref-for-datacloneerror">DataCloneError</a></code>" <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException①">DOMException</a></code>. The value undefined will cause the corresponding entry to be deleted. </p>
     <p>The returned promise will fulfill with undefined on success. </p>
   </dl>
   <div class="algorithm" data-algorithm="KVStorageArea set()">
    <ol>
     <li data-md>
      <p>If <var>key</var> is not <a data-link-type="dfn" href="#allowed-as-a-key" id="ref-for-allowed-as-a-key">allowed as a key</a>, return <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#a-promise-rejected-with" id="ref-for-a-promise-rejected-with">a promise rejected with</a> a "<code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#dataerror" id="ref-for-dataerror①">DataError</a></code>" <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException②">DOMException</a></code>.</p>
     <li data-md>
      <p>Return the result of <a data-link-type="dfn" href="#performing-a-database-operation" id="ref-for-performing-a-database-operation①">performing a database operation</a> given this object, "<code>readwrite</code>", and the following steps operating on <var>transaction</var> and <var>store</var>:</p>
      <ol>
       <li data-md>
        <p>If <var>value</var> is undefined, then</p>
        <ol>
         <li data-md>
          <p>Perform the steps listed in the description of <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/IndexedDB/#idbobjectstore" id="ref-for-idbobjectstore">IDBObjectStore</a></code>'s <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/IndexedDB/#dom-idbobjectstore-delete" id="ref-for-dom-idbobjectstore-delete">delete()</a></code> method on <var>store</var>, given the argument <var>key</var>.</p>
        </ol>
       <li data-md>
        <p>Otherwise,</p>
        <ol>
         <li data-md>
          <p>Perform the steps listed in the description of <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/IndexedDB/#idbobjectstore" id="ref-for-idbobjectstore①">IDBObjectStore</a></code>'s <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/IndexedDB/#dom-idbobjectstore-put" id="ref-for-dom-idbobjectstore-put">put()</a></code> method on <var>store</var>, given the arguments <var>value</var> and <var>key</var>.</p>
        </ol>
       <li data-md>
        <p>Let <var>promise</var> be <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#a-new-promise" id="ref-for-a-new-promise">a new promise</a> in the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm" id="ref-for-concept-relevant-realm">relevant Realm</a> of <b>this</b>.</p>
       <li data-md>
        <p><a data-link-type="dfn" href="#add-a-simple-event-listener" id="ref-for-add-a-simple-event-listener">Add a simple event listener</a> to <var>transaction</var> for "<code>complete</code>" that <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#resolve" id="ref-for-resolve">resolves</a> <var>promise</var> with undefined.</p>
       <li data-md>
        <p><a data-link-type="dfn" href="#add-a-simple-event-listener" id="ref-for-add-a-simple-event-listener①">Add a simple event listener</a> to <var>transaction</var> for "<code>error</code>" that <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#reject" id="ref-for-reject">rejects</a> <var>promise</var> with <var>transaction</var>’s <a data-link-type="dfn" href="https://w3c.github.io/IndexedDB/#transaction-error" id="ref-for-transaction-error">error</a>.</p>
       <li data-md>
        <p><a data-link-type="dfn" href="#add-a-simple-event-listener" id="ref-for-add-a-simple-event-listener②">Add a simple event listener</a> to <var>transaction</var> for "<code>abort</code>" that <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#reject" id="ref-for-reject①">rejects</a> <var>promise</var> with <var>transaction</var>’s <a data-link-type="dfn" href="https://w3c.github.io/IndexedDB/#transaction-error" id="ref-for-transaction-error①">error</a>.</p>
       <li data-md>
        <p>Return <var>promise</var>.</p>
      </ol>
    </ol>
   </div>
   <h3 class="heading settled dfn-paneled idl-code" data-dfn-for="KVStorageArea" data-dfn-type="method" data-export data-level="3.3" data-lt="get(key)" id="KVStorageArea-get"><span class="secno">3.3. </span><span class="content">get(<var>key</var>)</span><a class="self-link" href="#KVStorageArea-get" id="ref-for-KVStorageArea-get②"></a></h3>
   <dl class="domintro non-normative">
    <dt><code><var>value</var> = await <var>storage</var>.<code class="idl"><a data-link-type="idl" href="#KVStorageArea-get" id="ref-for-KVStorageArea-get①">get</a></code>(<var>key</var>)</code> 
    <dd>
     <p>Asynchronously retrieves the value stored at the given <var>key</var>, or undefined if there is no value stored at <var>key</var>. </p>
     <p>Values retrieved will be <a data-link-type="abstract-op" href="https://html.spec.whatwg.org/multipage/structured-data.html#structureddeserialize" id="ref-for-structureddeserialize">structured-deserialized</a> from their original form. </p>
   </dl>
   <div class="algorithm" data-algorithm="KVStorageArea get()">
    <ol>
     <li data-md>
      <p>If <var>key</var> is not <a data-link-type="dfn" href="#allowed-as-a-key" id="ref-for-allowed-as-a-key①">allowed as a key</a>, return <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#a-promise-rejected-with" id="ref-for-a-promise-rejected-with①">a promise rejected with</a> a "<code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#dataerror" id="ref-for-dataerror②">DataError</a></code>" <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException③">DOMException</a></code>.</p>
     <li data-md>
      <p>Return the result of <a data-link-type="dfn" href="#performing-a-database-operation" id="ref-for-performing-a-database-operation②">performing a database operation</a> given this object, "<code>readonly</code>", and the following steps operating on <var>transaction</var> and <var>store</var>:</p>
      <ol>
       <li data-md>
        <p>Let <var>request</var> be the result of performing the steps listed in the description of <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/IndexedDB/#idbobjectstore" id="ref-for-idbobjectstore②">IDBObjectStore</a></code>'s <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/IndexedDB/#dom-idbobjectstore-get" id="ref-for-dom-idbobjectstore-get">get()</a></code> method on <var>store</var>, given the argument <var>key</var>.</p>
       <li data-md>
        <p>Let <var>promise</var> be <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#a-new-promise" id="ref-for-a-new-promise①">a new promise</a> in the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm" id="ref-for-concept-relevant-realm①">relevant Realm</a> of <b>this</b>.</p>
       <li data-md>
        <p><a data-link-type="dfn" href="#add-a-simple-event-listener" id="ref-for-add-a-simple-event-listener③">Add a simple event listener</a> to <var>request</var> for "<code>success</code>" that <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#resolve" id="ref-for-resolve①">resolves</a> <var>promise</var> with <var>request</var>’s <a data-link-type="dfn" href="https://w3c.github.io/IndexedDB/#request-result" id="ref-for-request-result">result</a>.</p>
       <li data-md>
        <p><a data-link-type="dfn" href="#add-a-simple-event-listener" id="ref-for-add-a-simple-event-listener④">Add a simple event listener</a> to <var>request</var> for "<code>error</code>" that <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#reject" id="ref-for-reject②">rejects</a> <var>promise</var> with <var>request</var>’s <a data-link-type="dfn" href="https://w3c.github.io/IndexedDB/#request-error" id="ref-for-request-error">error</a>.</p>
       <li data-md>
        <p>Return <var>promise</var>.</p>
      </ol>
    </ol>
   </div>
   <h3 class="heading settled dfn-paneled idl-code" data-dfn-for="KVStorageArea" data-dfn-type="method" data-export data-level="3.4" data-lt="delete(key)" id="KVStorageArea-delete"><span class="secno">3.4. </span><span class="content">delete(<var>key</var>)</span><a class="self-link" href="#KVStorageArea-delete" id="ref-for-KVStorageArea-delete②"></a></h3>
   <dl class="domintro non-normative">
    <dt><code>await <var>storage</var>.<code class="idl"><a data-link-type="idl" href="#KVStorageArea-delete" id="ref-for-KVStorageArea-delete①">delete</a></code>(<var>key</var>)</code> 
    <dd>
     <p>Asynchronously deletes the entry at the given <var>key</var>. This is equivalent to <var>storage</var>.<code class="idl"><a data-link-type="idl" href="#KVStorageArea-set" id="ref-for-KVStorageArea-set②">set</a></code>(<var>key</var>, undefined). </p>
     <p>The returned promise will fulfill with undefined on success. </p>
   </dl>
   <div class="algorithm" data-algorithm="KVStorageArea delete()">
    <ol>
     <li data-md>
      <p>If <var>key</var> is not <a data-link-type="dfn" href="#allowed-as-a-key" id="ref-for-allowed-as-a-key②">allowed as a key</a>, return <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#a-promise-rejected-with" id="ref-for-a-promise-rejected-with②">a promise rejected with</a> a "<code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#dataerror" id="ref-for-dataerror③">DataError</a></code>" <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException④">DOMException</a></code>.</p>
     <li data-md>
      <p>Return the result of <a data-link-type="dfn" href="#performing-a-database-operation" id="ref-for-performing-a-database-operation③">performing a database operation</a> given this object, "<code>readwrite</code>", and the following steps operating on <var>transaction</var> and <var>store</var>:</p>
      <ol>
       <li data-md>
        <p>Perform the steps listed in the description of <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/IndexedDB/#idbobjectstore" id="ref-for-idbobjectstore③">IDBObjectStore</a></code>'s <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/IndexedDB/#dom-idbobjectstore-delete" id="ref-for-dom-idbobjectstore-delete①">delete()</a></code> method on <var>store</var>, given the argument <var>key</var>.</p>
       <li data-md>
        <p>Let <var>promise</var> be <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#a-new-promise" id="ref-for-a-new-promise②">a new promise</a> in the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm" id="ref-for-concept-relevant-realm②">relevant Realm</a> of <b>this</b>.</p>
       <li data-md>
        <p><a data-link-type="dfn" href="#add-a-simple-event-listener" id="ref-for-add-a-simple-event-listener⑤">Add a simple event listener</a> to <var>transaction</var> for "<code>complete</code>" that <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#resolve" id="ref-for-resolve②">resolves</a> <var>promise</var> with undefined.</p>
       <li data-md>
        <p><a data-link-type="dfn" href="#add-a-simple-event-listener" id="ref-for-add-a-simple-event-listener⑥">Add a simple event listener</a> to <var>transaction</var> for "<code>error</code>" that <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#reject" id="ref-for-reject③">rejects</a> <var>promise</var> with <var>transaction</var>’s <a data-link-type="dfn" href="https://w3c.github.io/IndexedDB/#transaction-error" id="ref-for-transaction-error②">error</a>.</p>
       <li data-md>
        <p><a data-link-type="dfn" href="#add-a-simple-event-listener" id="ref-for-add-a-simple-event-listener⑦">Add a simple event listener</a> to <var>transaction</var> for "<code>abort</code>" that <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#reject" id="ref-for-reject④">rejects</a> <var>promise</var> with <var>transaction</var>’s <a data-link-type="dfn" href="https://w3c.github.io/IndexedDB/#transaction-error" id="ref-for-transaction-error③">error</a>.</p>
       <li data-md>
        <p>Return <var>promise</var>.</p>
      </ol>
    </ol>
   </div>
   <h3 class="heading settled dfn-paneled idl-code" data-dfn-for="KVStorageArea" data-dfn-type="method" data-export data-level="3.5" data-lt="clear()" id="KVStorageArea-clear"><span class="secno">3.5. </span><span class="content">clear()</span><a class="self-link" href="#KVStorageArea-clear" id="ref-for-KVStorageArea-clear④"></a></h3>
   <dl class="domintro non-normative">
    <dt><code>await <var>storage</var>.<code class="idl"><a data-link-type="idl" href="#KVStorageArea-clear" id="ref-for-KVStorageArea-clear①">clear</a></code>()</code> 
    <dd>
     <p>Asynchronously deletes all entries in this storage area. </p>
     <p>This is done by actually deleting the underlying IndexedDB database. As such, it always can be used as a fail-safe to get a clean slate, <a href="#clear-recover-from-changes">as shown below</a>. </p>
     <p>The returned promise will fulfill with undefined on success. </p>
   </dl>
   <div class="algorithm" data-algorithm="KVStorageArea clear()">
    <ol>
     <li data-md>
      <p>Let <var>realm</var> be the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm" id="ref-for-concept-relevant-realm③">relevant Realm</a> of <b>this</b>.</p>
     <li data-md>
      <p>If <b>this</b>.<a data-link-type="dfn" href="#databasepromise" id="ref-for-databasepromise③">[[DatabasePromise]]</a> is not null, return the result of <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#dfn-perform-steps-once-promise-is-settled" id="ref-for-dfn-perform-steps-once-promise-is-settled">reacting</a> to <b>this</b>.<a data-link-type="dfn" href="#databasepromise" id="ref-for-databasepromise④">[[DatabasePromise]]</a> with fulfillment and rejection handlers that both perform the following steps:</p>
      <ol>
       <li data-md>
        <p>Set <b>this</b>.<a data-link-type="dfn" href="#databasepromise" id="ref-for-databasepromise⑤">[[DatabasePromise]]</a> to null.</p>
       <li data-md>
        <p>Return the result of <a data-link-type="dfn" href="#deleting-the-database" id="ref-for-deleting-the-database">deleting the database</a> given <b>this</b>.<a data-link-type="dfn" href="#databasename" id="ref-for-databasename③">[[DatabaseName]]</a> and <var>realm</var>.</p>
      </ol>
     <li data-md>
      <p>Otherwise, return the result of <a data-link-type="dfn" href="#deleting-the-database" id="ref-for-deleting-the-database①">deleting the database</a> given <b>this</b>.<a data-link-type="dfn" href="#databasename" id="ref-for-databasename④">[[DatabaseName]]</a> and <var>realm</var>.</p>
    </ol>
   </div>
   <div class="algorithm" data-algorithm="deleting the database">
     To <dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="deleting the database|delete the database" data-noexport id="deleting-the-database">delete the database</dfn> given a string <var>name</var> and a <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#realm-record" id="ref-for-realm-record">Realm</a> <var>realm</var>: 
    <ol>
     <li data-md>
      <p>Let <var>promise</var> be <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#a-new-promise" id="ref-for-a-new-promise③">a new promise</a> in <var>realm</var>.</p>
     <li data-md>
      <p>Let <var>request</var> be the result of performing the steps listed in the description of <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/IndexedDB/#idbfactory" id="ref-for-idbfactory">IDBFactory</a></code>'s <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/IndexedDB/#dom-idbfactory-deletedatabase" id="ref-for-dom-idbfactory-deletedatabase">deleteDatabase()</a></code> method on the <a data-link-type="dfn" href="#current-idbfactory" id="ref-for-current-idbfactory">current <code>IDBFactory</code></a>, given the argument <var>name</var>.</p>
     <li data-md>
      <p>If those steps threw an exception, catch the exception and <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#reject" id="ref-for-reject⑤">reject</a> <var>promise</var> with it.</p>
     <li data-md>
      <p>Otherwise:</p>
      <ol>
       <li data-md>
        <p><a data-link-type="dfn" href="#add-a-simple-event-listener" id="ref-for-add-a-simple-event-listener⑧">Add a simple event listener</a> to <var>request</var> for "<code>success</code>" that <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#resolve" id="ref-for-resolve③">resolves</a> <var>promise</var> with undefined.</p>
       <li data-md>
        <p><a data-link-type="dfn" href="#add-a-simple-event-listener" id="ref-for-add-a-simple-event-listener⑨">Add a simple event listener</a> to <var>request</var> for "<code>error</code>" that <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#reject" id="ref-for-reject⑥">rejects</a> <var>promise</var> with <var>request</var>’s <a data-link-type="dfn" href="https://w3c.github.io/IndexedDB/#request-error" id="ref-for-request-error①">error</a>.</p>
      </ol>
     <li data-md>
      <p>Return <var>promise</var>.</p>
    </ol>
   </div>
   <div class="example" id="clear-recover-from-changes">
    <a class="self-link" href="#clear-recover-from-changes"></a> This method can be used to recover from unexpected modifications to the backing store. For example, 
<pre class="highlight"><c- c1>// This upgrade to version 100 breaks the "cats" storage area: since StorageAreas</c->
<c- c1>// assume a version of 1, "cats" can no longer be used with KV storage.</c->
<c- a>const</c-> openRequest <c- o>=</c-> indexedDB<c- p>.</c->open<c- p>(</c-><c- u>"kv-storage:cats"</c-><c- p>,</c-> <c- mf>100</c-><c- p>);</c->
openRequest<c- p>.</c->onsuccess <c- o>=</c-> <c- p>()</c-> <c- p>=></c-> <c- p>{</c->
  openRequest<c- p>.</c->onsuccess<c- p>.</c->close<c- p>();</c->
<c- p>};</c->

<c- p>(</c-><c- k>async</c-> <c- p>()</c-> <c- p>=></c-> <c- p>{</c->
  <c- a>const</c-> area <c- o>=</c-> <c- ow>new</c-> KVStorageArea<c- p>(</c-><c- u>"cats"</c-><c- p>);</c->

  <c- c1>// Due to the above upgrade, all other methods will reject:</c->
  <c- k>try</c-> <c- p>{</c->
    <c- k>await</c-> area<c- p>.</c->set<c- p>(</c-><c- u>"fluffy"</c-><c- p>,</c-> <c- ow>new</c-> Cat<c- p>());</c->
  <c- p>}</c-> <c- k>catch</c-> <c- p>(</c->e<c- p>)</c-> <c- p>{</c->
    <c- c1>// This will be reached and output a "VersionError" DOMException</c->
    console<c- p>.</c->error<c- p>(</c->e<c- p>);</c->
  <c- p>}</c->

  <c- c1>// But clear() will delete the database entirely:</c->
  <c- k>await</c-> area<c- p>.</c->clear<c- p>();</c->

  <c- c1>// Now we can use it again!</c->
  <c- k>await</c-> area<c- p>.</c->set<c- p>(</c-><c- u>"fluffy"</c-><c- p>,</c-> <c- ow>new</c-> Cat<c- p>());</c->
  <c- k>await</c-> area<c- p>.</c->set<c- p>(</c-><c- u>"tigger"</c-><c- p>,</c-> <c- ow>new</c-> Cat<c- p>());</c->

  <c- c1>// Also, the version is back down to 1:</c->
  console<c- p>.</c->assert<c- p>(</c->area<c- p>.</c->backingStore<c- p>.</c->version <c- o>===</c-> <c- mf>1</c-><c- p>);</c->
<c- p>})();</c->
</pre>
   </div>
   <h3 class="heading settled" data-level="3.6" id="KVStorageArea-iteration"><span class="secno">3.6. </span><span class="content">Iteration</span><a class="self-link" href="#KVStorageArea-iteration"></a></h3>
   <p>The <code class="idl"><a data-link-type="idl" href="#KVStorageArea" id="ref-for-KVStorageArea⑥">KVStorageArea</a></code> interface supports asynchronous iteration.</p>
   <div class="domintro non-normative">
    <dl>
     <dt><code>for await (const <var>key</var> of <var>storage</var>.<dfn class="dfn-paneled idl-code" data-dfn-for="KVStorageArea" data-dfn-type="method" data-export id="dom-kvstoragearea-keys"><code>keys()</code></dfn>) { ... }</code> 
     <dd>
      <p>Retrieves an async iterator containing the keys of all entries in this storage area. </p>
      <p>Keys will be yielded in <a data-link-type="dfn" href="https://w3c.github.io/IndexedDB/#greater-than" id="ref-for-greater-than">ascending</a> order; roughly, segregated by type, and then sorted within each type. They will be <a data-link-type="dfn" href="#key-round-trip" id="ref-for-key-round-trip">key round-tripped</a> from their original form. </p>
     <dt><code>for await (const <var>value</var> of <var>storage</var>.<dfn class="dfn-paneled idl-code" data-dfn-for="KVStorageArea" data-dfn-type="method" data-export id="dom-kvstoragearea-values"><code>values()</code></dfn>) { ... }</code> 
     <dd>
      <p>Retrieves an async iterator containing the values of all entries in this storage area. </p>
      <p>Values will be yielded in the same order as for <code class="idl"><a data-link-type="idl" href="#dom-kvstoragearea-keys" id="ref-for-dom-kvstoragearea-keys">keys()</a></code>. They will be <a data-link-type="abstract-op" href="https://html.spec.whatwg.org/multipage/structured-data.html#structureddeserialize" id="ref-for-structureddeserialize①">structured-deserialized</a> from their original form. </p>
     <dt><code>for await (const [<var>key</var>, <var>value</var>] of <var>storage</var>.<dfn class="dfn-paneled idl-code" data-dfn-for="KVStorageArea" data-dfn-type="method" data-export id="dom-kvstoragearea-entries"><code>entries()</code></dfn>) { ... }</code> 
     <dt><code>for await (const [<var>key</var>, <var>value</var>] of <var>storage</var>) { ... }</code> 
     <dd>
      <p>Retrieves an async iterator containing two-element <code>[key, value]</code> arrays, each of which corresponds to an entry in this storage area. </p>
      <p>Entries will be yielded in the same order as for <code class="idl"><a data-link-type="idl" href="#dom-kvstoragearea-keys" id="ref-for-dom-kvstoragearea-keys①">keys()</a></code>. Each key and value will be <a data-link-type="dfn" href="#key-round-trip" id="ref-for-key-round-trip①">key round-tripped</a> and <a data-link-type="abstract-op" href="https://html.spec.whatwg.org/multipage/structured-data.html#structureddeserialize" id="ref-for-structureddeserialize②">structured-deserialized</a> from its original form, respectively. </p>
    </dl>
    <p>All of these iterators provide live views onto the storage area: modifications made to entries sorted after the last-returned one will be reflected in the iteration. </p>
   </div>
   <div class="algorithm" data-algorithm="asynchronous iterator initialization steps">
     The <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#asynchronous-iterator-initialization-steps" id="ref-for-asynchronous-iterator-initialization-steps">asynchronous iterator initialization steps</a> for <code class="idl"><a data-link-type="idl" href="#KVStorageArea" id="ref-for-KVStorageArea⑦">KVStorageArea</a></code>, given <var>storageArea</var> and <var>asyncIterator</var>, are: 
    <ol>
     <li data-md>
      <p>Set <var>asyncIterator</var>’s <dfn class="dfn-paneled" data-dfn-for="KVStorageAreaAsyncIterator" data-dfn-type="dfn" data-noexport id="kvstorageareaasynciterator-last-key">last key</dfn> to <a data-link-type="dfn" href="#not-yet-started" id="ref-for-not-yet-started">not yet started</a>.</p>
    </ol>
   </div>
   <div class="algorithm" data-algorithm="get the next iteration result">
     To <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#dfn-get-the-next-iteration-result" id="ref-for-dfn-get-the-next-iteration-result">get the next iteration result</a>, given the <var>storageArea</var> and <var>asyncIterator</var>: 
    <ol>
     <li data-md>
      <p>Return the result of <a data-link-type="dfn" href="#performing-a-database-operation" id="ref-for-performing-a-database-operation④">performing a database operation</a> given <var>storageArea</var>, "<code>readonly</code>", and the following steps operating on <var>transaction</var> and <var>store</var>:</p>
      <ol>
       <li data-md>
        <p>Let <var>range</var> be the result of <a data-link-type="dfn" href="#get-the-range-for-a-key" id="ref-for-get-the-range-for-a-key">getting the range for</a> <var>asyncIterator</var>’s <a data-link-type="dfn" href="#kvstorageareaasynciterator-last-key" id="ref-for-kvstorageareaasynciterator-last-key">last key</a>.</p>
       <li data-md>
        <p>Let <var>keyRequest</var> be the result of performing the steps listed in the description of <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/IndexedDB/#idbobjectstore" id="ref-for-idbobjectstore④">IDBObjectStore</a></code>'s <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/IndexedDB/#dom-idbobjectstore-getkey" id="ref-for-dom-idbobjectstore-getkey">getKey()</a></code> method on <var>store</var>, given the argument <var>range</var>.</p>
       <li data-md>
        <p>Let <var>valueRequest</var> be the result of performing the steps listed in the description of <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/IndexedDB/#idbobjectstore" id="ref-for-idbobjectstore⑤">IDBObjectStore</a></code>'s <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/IndexedDB/#dom-idbobjectstore-get" id="ref-for-dom-idbobjectstore-get①">get()</a></code> method on <var>store</var>, given the argument <var>range</var>.</p>
        <p class="note" role="note"><span class="marker">Note:</span> The iterator returned from <code class="idl"><a data-link-type="idl" href="#dom-kvstoragearea-keys" id="ref-for-dom-kvstoragearea-keys②">keys()</a></code> discards the value. Implementations could avoid constructing <var>valueRequest</var> in that case.</p>
       <li data-md>
        <p>Let <var>promise</var> be <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#a-new-promise" id="ref-for-a-new-promise④">a new promise</a> in the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm" id="ref-for-concept-relevant-realm④">relevant Realm</a> of <var>asyncIterator</var>.</p>
       <li data-md>
        <p><a data-link-type="dfn" href="#add-a-simple-event-listener" id="ref-for-add-a-simple-event-listener①⓪">Add a simple event listener</a> to <var>valueRequest</var> for "<code>success</code>" that performs the following steps:</p>
        <ol>
         <li data-md>
          <p>Let <var>key</var> be <var>keyRequest</var>’s <a data-link-type="dfn" href="https://w3c.github.io/IndexedDB/#request-result" id="ref-for-request-result①">result</a>.</p>
         <li data-md>
          <p>If <var>key</var> is undefined, then:</p>
          <ol>
           <li data-md>
            <p><a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#resolve" id="ref-for-resolve④">Resolve</a> <var>promise</var> with undefined.</p>
          </ol>
         <li data-md>
          <p>Otherwise:</p>
          <ol>
           <li data-md>
            <p>Let <var>value</var> be <var>valueRequest</var>’s <a data-link-type="dfn" href="https://w3c.github.io/IndexedDB/#request-result" id="ref-for-request-result②">result</a>.</p>
           <li data-md>
            <p><a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#resolve" id="ref-for-resolve⑤">Resolve</a> <var>promise</var> with (<var>key</var>, <var>value</var>, <var>key</var>).</p>
           <li data-md>
            <p>Set <var>asyncIterator</var>’s <a data-link-type="dfn" href="#kvstorageareaasynciterator-last-key" id="ref-for-kvstorageareaasynciterator-last-key①">last key</a> to <var>key</var>.</p>
          </ol>
        </ol>
       <li data-md>
        <p><a data-link-type="dfn" href="#add-a-simple-event-listener" id="ref-for-add-a-simple-event-listener①①">Add a simple event listener</a> to <var>keyRequest</var> for "<code>error</code>" that <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#reject" id="ref-for-reject⑦">rejects</a> <var>promise</var> with <var>keyRequest</var>’s <a data-link-type="dfn" href="https://w3c.github.io/IndexedDB/#request-error" id="ref-for-request-error②">error</a>.</p>
       <li data-md>
        <p><a data-link-type="dfn" href="#add-a-simple-event-listener" id="ref-for-add-a-simple-event-listener①②">Add a simple event listener</a> to <var>valueRequest</var> for "<code>error</code>" that <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#reject" id="ref-for-reject⑧">rejects</a> <var>promise</var> with <var>valueRequest</var>’s <a data-link-type="dfn" href="https://w3c.github.io/IndexedDB/#request-error" id="ref-for-request-error③">error</a>.</p>
       <li data-md>
        <p>Return <var>promise</var>.</p>
      </ol>
    </ol>
   </div>
   <div class="example" id="example-live-async-iterator">
    <a class="self-link" href="#example-live-async-iterator"></a> To illustrate the live nature of the async iterators, consider the following: 
<pre class="highlight"><c- k>await</c-> kvStorage<c- p>.</c->set<c- p>(</c-><c- mf>10</c-><c- p>,</c-> <c- u>"value 10"</c-><c- p>);</c->
<c- k>await</c-> kvStorage<c- p>.</c->set<c- p>(</c-><c- mf>20</c-><c- p>,</c-> <c- u>"value 20"</c-><c- p>);</c->
<c- k>await</c-> kvStorage<c- p>.</c->set<c- p>(</c-><c- mf>30</c-><c- p>,</c-> <c- u>"value 30"</c-><c- p>);</c->

<c- a>const</c-> keysSeen <c- o>=</c-> <c- p>[];</c->
<c- k>for</c-> <c- k>await</c-> <c- p>(</c-><c- a>const</c-> key <c- k>of</c-> kvStorage<c- p>.</c->keys<c- p>())</c-> <c- p>{</c->
  <c- k>if</c-> <c- p>(</c->key <c- o>===</c-> <c- mf>20</c-><c- p>)</c-> <c- p>{</c->
    <c- k>await</c-> kvStorage<c- p>.</c->set<c- p>(</c-><c- mf>15</c-><c- p>,</c-> <c- u>"value 15"</c-><c- p>);</c->
    <c- k>await</c-> kvStorage<c- p>.</c-><c- ow>delete</c-><c- p>(</c-><c- mf>20</c-><c- p>);</c->
    <c- k>await</c-> kvStorage<c- p>.</c->set<c- p>(</c-><c- mf>25</c-><c- p>,</c-> <c- u>"value 25"</c-><c- p>);</c->
  <c- p>}</c->
  keysSeen<c- p>.</c->push<c- p>(</c->key<c- p>);</c->
<c- p>}</c->

console<c- p>.</c->log<c- p>(</c->keysSeen<c- p>);</c->   <c- c1>// logs 10, 20, 25, 30</c->
</pre>
    <p>That is, calling <code class="idl"><a data-link-type="idl" href="#dom-kvstoragearea-keys" id="ref-for-dom-kvstoragearea-keys③">keys()</a></code> does not create a snapshot as of the time it was called; it returns a live asynchronous iterator, that lazily retrieves the next key after the last-seen one.</p>
   </div>
   <div class="example" id="example-entries-to-server">
    <a class="self-link" href="#example-entries-to-server"></a> Assuming you knew that that you only stored JSON-compatible types in the <code class="idl"><a data-link-type="idl" href="#KVStorageArea" id="ref-for-KVStorageArea⑧">KVStorageArea</a></code> <var>storage</var>, you could use the following code to send all locally-stored entries to a server: 
<pre class="highlight"><c- a>const</c-> entries <c- o>=</c-> <c- p>[];</c->
<c- k>for</c-> <c- k>await</c-> <c- p>(</c-><c- a>const</c-> entry <c- k>of</c-> kvStorage<c- p>.</c->entries<c- p>())</c-> <c- p>{</c->
  entries<c- p>.</c->push<c- p>(</c->entry<c- p>);</c->
<c- p>}</c->

fetch<c- p>(</c-><c- u>"/storage-receiver"</c-><c- p>,</c-> <c- p>{</c->
  method<c- o>:</c-> <c- u>"POST"</c-><c- p>,</c->
  body<c- o>:</c-> entries<c- p>,</c->
  headers<c- o>:</c-> <c- p>{</c->
    <c- u>"Content-Type"</c-><c- o>:</c-> <c- u>"application/json"</c->
  <c- p>}</c->
<c- p>});</c->
</pre>
   </div>
   <h3 class="heading settled dfn-paneled idl-code" data-dfn-for="KVStorageArea" data-dfn-type="attribute" data-export data-level="3.7" data-lt="backingStore" id="KVStorageArea-backingstore"><span class="secno">3.7. </span><span class="content">backingStore</span><a class="self-link" href="#KVStorageArea-backingstore" id="ref-for-KVStorageArea-backingstore⑤"></a></h3>
   <dl class="domintro non-normative">
    <dt><code>{ <var>database</var>, <var>store</var>, <var>version</var> } = <var>storage</var>.<code class="idl"><a data-link-type="idl" href="#KVStorageArea-backingstore" id="ref-for-KVStorageArea-backingstore②">backingStore</a></code></code> 
    <dd>
     <p>Returns an object containing all of the information necessary to manually interface with the IndexedDB backing store that underlies this storage area: </p>
     <ul>
      <li data-md>
       <p><var>database</var> will be a string equal to "<code>kv-storage:</code>" concatenated with the database name passed to the constructor. (For the default storage area, it will be "<code>kv-storage:default</code>".)</p>
      <li data-md>
       <p><var>store</var> will be the string "<code>store</code>".</p>
      <li data-md>
       <p><var>version</var> will be the number 1.</p>
     </ul>
     <p>It is good practice to use the <code class="idl"><a data-link-type="idl" href="#KVStorageArea-backingstore" id="ref-for-KVStorageArea-backingstore③">backingStore</a></code> property to retrieve this information, instead of memorizing the above factoids. </p>
   </dl>
   <div class="algorithm" data-algorithm="StorageaArea backingStore">
    <ol>
     <li data-md>
      <p>If <b>this</b>.<a data-link-type="dfn" href="#backingstoreobject" id="ref-for-backingstoreobject③">[[BackingStoreObject]]</a> is null, then:</p>
      <ol>
       <li data-md>
        <p>Let <var>backingStoreObject</var> be <a data-link-type="abstract-op" href="https://tc39.github.io/ecma262/#sec-objectcreate" id="ref-for-sec-objectcreate">ObjectCreate</a>(<code class="idl"><a data-link-type="idl" href="https://tc39.github.io/ecma262/#sec-properties-of-the-object-prototype-object" id="ref-for-sec-properties-of-the-object-prototype-object">%ObjectPrototype%</a></code>).</p>
       <li data-md>
        <p>Perform <a data-link-type="abstract-op" href="https://tc39.github.io/ecma262/#sec-createdataproperty" id="ref-for-sec-createdataproperty">CreateDataProperty</a>(<var>backingStoreObject</var>, "<code>database</code>", <b>this</b>.<a data-link-type="dfn" href="#databasename" id="ref-for-databasename⑤">[[DatabaseName]]</a>).</p>
       <li data-md>
        <p>Perform <a data-link-type="abstract-op" href="https://tc39.github.io/ecma262/#sec-createdataproperty" id="ref-for-sec-createdataproperty①">CreateDataProperty</a>(<var>backingStoreObject</var>, "<code>store</code>", "<code>store</code>").</p>
       <li data-md>
        <p>Perform <a data-link-type="abstract-op" href="https://tc39.github.io/ecma262/#sec-createdataproperty" id="ref-for-sec-createdataproperty②">CreateDataProperty</a>(<var>backingStoreObject</var>, "<code>version</code>", 1).</p>
       <li data-md>
        <p>Perform <a data-link-type="abstract-op" href="https://tc39.github.io/ecma262/#sec-setintegritylevel" id="ref-for-sec-setintegritylevel">SetIntegrityLevel</a>(<var>backingStoreObject</var>, "<code>frozen</code>").</p>
       <li data-md>
        <p>Set <b>this</b>.<a data-link-type="dfn" href="#backingstoreobject" id="ref-for-backingstoreobject④">[[BackingStoreObject]]</a> to <var>backingStoreObject</var>.</p>
      </ol>
     <li data-md>
      <p>Return <b>this</b>.<a data-link-type="dfn" href="#backingstoreobject" id="ref-for-backingstoreobject⑤">[[BackingStoreObject]]</a>.</p>
    </ol>
   </div>
   <div class="example" id="example-backingstore">
    <a class="self-link" href="#example-backingstore"></a> Consider a checklist application, which tracks the Pokémon a user has collected. It might use a <code class="idl"><a data-link-type="idl" href="#KVStorageArea" id="ref-for-KVStorageArea⑨">KVStorageArea</a></code> <var>storage</var> like so: 
<pre class="highlight">bulbasaur<c- p>.</c->onchange <c- o>=</c-> <c- p>()</c-> <c- p>=></c-> kvStorage<c- p>.</c->set<c- p>(</c-><c- u>"bulbasaur"</c-><c- p>,</c-> bulbasaur<c- p>.</c->checked<c- p>);</c->
ivysaur<c- p>.</c->onchange <c- o>=</c-> <c- p>()</c-> <c- p>=></c-> kvStorage<c- p>.</c->set<c- p>(</c-><c- u>"ivysaur"</c-><c- p>,</c-> ivysaur<c- p>.</c->checked<c- p>);</c->
venusaur<c- p>.</c->onchange <c- o>=</c-> <c- p>()</c-> <c- p>=></c-> kvStorage<c- p>.</c->set<c- p>(</c-><c- u>"venusaur"</c-><c- p>,</c-> venusaur<c- p>.</c->checked<c- p>);</c->
<c- c1>// ...</c->
</pre>
    <p>(Hopefully the developer quickly realizes that the above will be hard to maintain, and refactors the code into a loop. But in the meantime, their repetitive code makes for a good example, so let’s take advantage of that.)</p>
    <p>The developer now realizes they want to add an evolution feature, e.g. for when the user transforms their Bulbasaur into an Ivysaur. They might first implement this like so:</p>
<pre class="highlight">bulbasaurEvolve<c- p>.</c->onclick <c- o>=</c-> <c- k>async</c-> <c- p>()</c-> <c- p>=></c-> <c- p>{</c->
  <c- k>await</c-> kvStorage<c- p>.</c->set<c- p>(</c-><c- u>"bulbasaur"</c-><c- p>,</c-> <c- kc>false</c-><c- p>);</c->
  <c- k>await</c-> kvStorage<c- p>.</c->set<c- p>(</c-><c- u>"ivysaur"</c-><c- p>,</c-> <c- kc>true</c-><c- p>);</c->
<c- p>};</c->
</pre>
    <p>However, our developer starts getting bug reports from their users: if the users happen to open up the checklist app in a second tab while they’re evolving in the first tab, the second tab will sometimes see that their Bulbasaur has disappeared, without ever turning into an Ivysaur! A Pokémon has gone missing!</p>
    <p>The solution here is to step beyond the comfort zone of KV storage, and start using the full power of IndexedDB: in particular, its <a data-link-type="dfn" href="https://w3c.github.io/IndexedDB/#transaction-concept" id="ref-for-transaction-concept">transactions</a> feature. The <code class="idl"><a data-link-type="idl" href="#KVStorageArea-backingstore" id="ref-for-KVStorageArea-backingstore④">backingStore</a></code> getter is the gateway to this world:</p>
<pre class="highlight"><c- a>const</c-> <c- p>{</c-> database<c- p>,</c-> store<c- p>,</c-> version <c- p>}</c-> <c- o>=</c-> kvStorage<c- p>.</c->backingStore<c- p>;</c->
<c- a>const</c-> request <c- o>=</c-> indexedDB<c- p>.</c->open<c- p>(</c->database<c- p>,</c-> version<c- p>);</c->
request<c- p>.</c->onsuccess <c- o>=</c-> <c- p>()</c-> <c- p>=></c-> <c- p>{</c->
  <c- a>const</c-> db <c- o>=</c-> request<c- p>.</c->result<c- p>;</c->

  bulbasaurEvolve<c- p>.</c->onclick <c- o>=</c-> <c- p>()</c-> <c- p>=></c-> <c- p>{</c->
    <c- a>const</c-> transaction <c- o>=</c-> db<c- p>.</c->transaction<c- p>(</c->store<c- p>,</c-> <c- u>"readwrite"</c-><c- p>);</c->
    <c- a>const</c-> store <c- o>=</c-> transaction<c- p>.</c->objectStore<c- p>(</c->store<c- p>);</c->

    store<c- p>.</c->put<c- p>(</c-><c- u>"bulbasaur"</c-><c- p>,</c-> <c- kc>false</c-><c- p>);</c->
    store<c- p>.</c->put<c- p>(</c-><c- u>"ivysaur"</c-><c- p>,</c-> <c- kc>true</c-><c- p>);</c->

    db<c- p>.</c->close<c- p>();</c->
  <c- p>};</c->
<c- p>};</c->
</pre>
    <p>Satisfied with their web app’s Pokémon integrity, our developer is now happy and fulfilled. (At least, until they realize that none of their code has error handling.)</p>
   </div>
   <h2 class="heading settled" data-level="4" id="supporting"><span class="secno">4. </span><span class="content">Supporting operations and concepts</span><a class="self-link" href="#supporting"></a></h2>
   <div class="algorithm" data-algorithm="add a simple event listener">
     To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="add-a-simple-event-listener">add a simple event listener</dfn>, given an <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#eventtarget" id="ref-for-eventtarget">EventTarget</a></code> <var>target</var>, an event type string <var>type</var>, and a set of steps <var>steps</var>: 
    <ol>
     <li data-md>
      <p>Let <var>jsCallback</var> be a new JavaScript function object, created in the <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#current-realm" id="ref-for-current-realm">current realm</a>, that performs the steps given by <var>steps</var>. Other properties of the function (such as its <code>name</code> and <code>length</code> properties, or [[Prototype]]) are unobservable, and can be chosen arbitrarily.</p>
     <li data-md>
      <p>Let <var>idlCallback</var> be the result of <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#dfn-convert-ecmascript-to-idl-value" id="ref-for-dfn-convert-ecmascript-to-idl-value">converting</a> <var>jsCallback</var> to an <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#callbackdef-eventlistener" id="ref-for-callbackdef-eventlistener">EventListener</a></code>.</p>
     <li data-md>
      <p>Perform the steps listed in the description of <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#eventtarget" id="ref-for-eventtarget①">EventTarget</a></code>'s <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#dom-eventtarget-addeventlistener" id="ref-for-dom-eventtarget-addeventlistener">addEventListener()</a></code> method on <var>target</var> given the arguments <var>type</var> and <var>idlCallback</var>.</p>
    </ol>
   </div>
   <div class="algorithm" data-algorithm="current IDBFactory">
     The <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="current-idbfactory">current <code>IDBFactory</code></dfn> is the <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/IndexedDB/#idbfactory" id="ref-for-idbfactory①">IDBFactory</a></code> instance returned by the following steps: 
    <ol>
     <li data-md>
      <p class="assertion">Assert: the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#current-global-object" id="ref-for-current-global-object">current global object</a> <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#include" id="ref-for-include">includes</a> <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/webappapis.html#windoworworkerglobalscope" id="ref-for-windoworworkerglobalscope②">WindowOrWorkerGlobalScope</a></code>.</p>
     <li data-md>
      <p>Return the result of performing the steps listed in the description of the getter for <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/webappapis.html#windoworworkerglobalscope" id="ref-for-windoworworkerglobalscope③">WindowOrWorkerGlobalScope</a></code>'s <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/IndexedDB/#dom-windoworworkerglobalscope-indexeddb" id="ref-for-dom-windoworworkerglobalscope-indexeddb">indexedDB</a></code> attribute on the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#current-global-object" id="ref-for-current-global-object①">current global object</a>.</p>
    </ol>
   </div>
   <div class="algorithm" data-algorithm="performing a database operation">
     To <dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="performing a database operation|perform a database operation" data-noexport id="performing-a-database-operation">perform a database operation</dfn> given a <code class="idl"><a data-link-type="idl" href="#KVStorageArea" id="ref-for-KVStorageArea①⓪">KVStorageArea</a></code> <var>area</var>, a mode string <var>mode</var>, and a set of steps <var>steps</var> that operate on an <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/IndexedDB/#idbtransaction" id="ref-for-idbtransaction">IDBTransaction</a></code> <var>transaction</var> and an <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/IndexedDB/#idbobjectstore" id="ref-for-idbobjectstore⑥">IDBObjectStore</a></code> <var>store</var>: 
    <ol>
     <li data-md>
      <p class="assertion">Assert: <var>area</var>.<a data-link-type="dfn" href="#databasename" id="ref-for-databasename⑥">[[DatabaseName]]</a> is a string (and in particular is not null).</p>
     <li data-md>
      <p>If <var>area</var>.<a data-link-type="dfn" href="#databasepromise" id="ref-for-databasepromise⑥">[[DatabasePromise]]</a> is null, <a data-link-type="dfn" href="#initialize-the-database-promise" id="ref-for-initialize-the-database-promise">initialize the database promise</a> for <var>area</var>.</p>
     <li data-md>
      <p>Return the result of <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#dfn-perform-steps-once-promise-is-settled" id="ref-for-dfn-perform-steps-once-promise-is-settled①">reacting</a> to <var>area</var>.<a data-link-type="dfn" href="#databasepromise" id="ref-for-databasepromise⑦">[[DatabasePromise]]</a> with a fulfillment handler that performs the following steps, given <var>database</var>:</p>
      <ol>
       <li data-md>
        <p>Let <var>transaction</var> be the result of performing the steps listed in the description of <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/IndexedDB/#idbdatabase" id="ref-for-idbdatabase①">IDBDatabase</a></code>'s <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/IndexedDB/#dom-idbdatabase-transaction" id="ref-for-dom-idbdatabase-transaction">transaction()</a></code> method on <var>database</var>, given the arguments "<code>store</code>" and <var>mode</var>.</p>
       <li data-md>
        <p>Let <var>store</var> be the result of performing the steps listed in the description of <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/IndexedDB/#idbtransaction" id="ref-for-idbtransaction①">IDBTransaction</a></code>'s <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/IndexedDB/#dom-idbtransaction-objectstore" id="ref-for-dom-idbtransaction-objectstore">objectStore()</a></code> method on <var>transaction</var>, given the argument "<code>store</code>".</p>
       <li data-md>
        <p>Return the result of performing <var>steps</var>, passing along <var>transaction</var> and <var>store</var>.</p>
      </ol>
    </ol>
   </div>
   <div class="algorithm" data-algorithm="initialize the database promise">
     To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="initialize-the-database-promise">initialize the database promise</dfn> for a <code class="idl"><a data-link-type="idl" href="#KVStorageArea" id="ref-for-KVStorageArea①①">KVStorageArea</a></code> <var>area</var>: 
    <ol>
     <li data-md>
      <p>Set <var>area</var>.<a data-link-type="dfn" href="#databasepromise" id="ref-for-databasepromise⑧">[[DatabasePromise]]</a> to <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#a-new-promise" id="ref-for-a-new-promise⑤">a new promise</a> in the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm" id="ref-for-concept-relevant-realm⑤">relevant Realm</a> of <var>area</var>.</p>
     <li data-md>
      <p>If the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#current-global-object" id="ref-for-current-global-object②">current global object</a> does not <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#include" id="ref-for-include①">include</a> <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/webappapis.html#windoworworkerglobalscope" id="ref-for-windoworworkerglobalscope④">WindowOrWorkerGlobalScope</a></code>, <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#reject" id="ref-for-reject⑨">reject</a> <var>area</var>.<a data-link-type="dfn" href="#databasepromise" id="ref-for-databasepromise⑨">[[DatabasePromise]]</a> with a <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#exceptiondef-typeerror" id="ref-for-exceptiondef-typeerror">TypeError</a></code>, and return.</p>
     <li data-md>
      <p>Let <var>request</var> be the result of performing the steps listed in the description of <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/IndexedDB/#idbfactory" id="ref-for-idbfactory②">IDBFactory</a></code>'s <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/IndexedDB/#dom-idbfactory-open" id="ref-for-dom-idbfactory-open">open()</a></code> method on the <a data-link-type="dfn" href="#current-idbfactory" id="ref-for-current-idbfactory①">current <code>IDBFactory</code></a>, given the arguments <var>area</var>.<a data-link-type="dfn" href="#databasename" id="ref-for-databasename⑦">[[DatabaseName]]</a> and 1.</p>
     <li data-md>
      <p>If those steps threw an exception, catch the exception, <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#reject" id="ref-for-reject①⓪">reject</a> <var>area</var>.<a data-link-type="dfn" href="#databasepromise" id="ref-for-databasepromise①⓪">[[DatabasePromise]]</a> with it, and return.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="#add-a-simple-event-listener" id="ref-for-add-a-simple-event-listener①③">Add a simple event listener</a> to <var>request</var> for "<code>success</code>" that performs the following steps:</p>
      <ol>
       <li data-md>
        <p>Let <var>database</var> be <var>request</var>’s <a data-link-type="dfn" href="https://w3c.github.io/IndexedDB/#request-result" id="ref-for-request-result③">result</a>.</p>
       <li data-md>
        <p><a data-link-type="dfn" href="#check-the-database-schema" id="ref-for-check-the-database-schema">Check the database schema</a> for <var>database</var>. If the result is false, <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#reject" id="ref-for-reject①①">reject</a> <var>area</var>.<a data-link-type="dfn" href="#databasepromise" id="ref-for-databasepromise①①">[[DatabasePromise]]</a> with an "<code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#invalidstateerror" id="ref-for-invalidstateerror">InvalidStateError</a></code>" <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException⑤">DOMException</a></code> and abort these steps.</p>
       <li data-md>
        <p><a data-link-type="dfn" href="#add-a-simple-event-listener" id="ref-for-add-a-simple-event-listener①④">Add a simple event listener</a> to <var>database</var> for "<code>close</code>" that sets <var>area</var>.<a data-link-type="dfn" href="#databasepromise" id="ref-for-databasepromise①②">[[DatabasePromise]]</a> to null.</p>
        <p class="note" role="note">This means that if the database is <a data-link-type="dfn" href="https://w3c.github.io/IndexedDB/#close-a-database-connection" id="ref-for-close-a-database-connection">closed abnormally</a>, future invocations of <a data-link-type="dfn" href="#performing-a-database-operation" id="ref-for-performing-a-database-operation⑤">perform a database operation</a> will attempt to reopen it.</p>
       <li data-md>
        <p><a data-link-type="dfn" href="#add-a-simple-event-listener" id="ref-for-add-a-simple-event-listener①⑤">Add a simple event listener</a> to <var>database</var> for "<code>versionchange</code>" that performs the steps listed in the description of <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/IndexedDB/#idbdatabase" id="ref-for-idbdatabase②">IDBDatabase</a></code>'s <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/IndexedDB/#dom-idbdatabase-close" id="ref-for-dom-idbdatabase-close">close()</a></code> method on <var>database</var>, and then sets <var>area</var>.<a data-link-type="dfn" href="#databasepromise" id="ref-for-databasepromise①③">[[DatabasePromise]]</a> to null.</p>
        <p class="note" role="note">This allows attempts to upgrade the underlying database, or to delete it (e.g. via the <code class="idl"><a data-link-type="idl" href="#KVStorageArea-clear" id="ref-for-KVStorageArea-clear②">clear()</a></code> method), to succeed. Without this, if two <code class="idl"><a data-link-type="idl" href="#KVStorageArea" id="ref-for-KVStorageArea①②">KVStorageArea</a></code> instances were both open referencing the same underlying database, <code class="idl"><a data-link-type="idl" href="#KVStorageArea-clear" id="ref-for-KVStorageArea-clear③">clear()</a></code> would hang, as it only closes the connection maintained by the <code class="idl"><a data-link-type="idl" href="#KVStorageArea" id="ref-for-KVStorageArea①③">KVStorageArea</a></code> it is invoked on.</p>
       <li data-md>
        <p><a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#resolve" id="ref-for-resolve⑥">Resolve</a> <var>promise</var> with <var>database</var>.</p>
      </ol>
     <li data-md>
      <p><a data-link-type="dfn" href="#add-a-simple-event-listener" id="ref-for-add-a-simple-event-listener①⑥">Add a simple event listener</a> to <var>request</var> for "<code>error</code>" that <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#reject" id="ref-for-reject①②">rejects</a> <var>promise</var> with <var>request</var>’s <a data-link-type="dfn" href="https://w3c.github.io/IndexedDB/#request-error" id="ref-for-request-error④">error</a>.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="#add-a-simple-event-listener" id="ref-for-add-a-simple-event-listener①⑦">Add a simple event listener</a> to <var>request</var> for "<code>upgradeneeded</code>" that performs the following steps:</p>
      <ol>
       <li data-md>
        <p>Let <var>database</var> be <var>request</var>’s <a data-link-type="dfn" href="https://w3c.github.io/IndexedDB/#request-result" id="ref-for-request-result④">result</a>.</p>
       <li data-md>
        <p>Perform the steps listed in the description of <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/IndexedDB/#idbdatabase" id="ref-for-idbdatabase③">IDBDatabase</a></code>'s <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/IndexedDB/#dom-idbdatabase-createobjectstore" id="ref-for-dom-idbdatabase-createobjectstore">createObjectStore()</a></code> method on <var>database</var>, given the arguments "<code>store</code>".</p>
       <li data-md>
        <p>If these steps throw an exception, catch the exception and <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#reject" id="ref-for-reject①③">reject</a> <var>area</var>.<a data-link-type="dfn" href="#databasepromise" id="ref-for-databasepromise①④">[[DatabasePromise]]</a> with it.</p>
      </ol>
    </ol>
   </div>
   <div class="algorithm" data-algorithm="check the database schema">
     To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="check-the-database-schema">check the database schema</dfn> for an <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/IndexedDB/#idbdatabase" id="ref-for-idbdatabase④">IDBDatabase</a></code> <var>database</var>: 
    <ol>
     <li data-md>
      <p>Let <var>objectStores</var> be <var>database</var>’s <a data-link-type="dfn" href="https://w3c.github.io/IndexedDB/#connection" id="ref-for-connection">connection</a>'s <a data-link-type="dfn" href="https://w3c.github.io/IndexedDB/#connection-object-store-set" id="ref-for-connection-object-store-set">object store set</a>.</p>
     <li data-md>
      <p>If <var>objectStores</var>’s <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-size" id="ref-for-list-size">size</a> is not 1, return false.</p>
     <li data-md>
      <p>Let <var>store</var> be <var>objectStores</var>[0].</p>
     <li data-md>
      <p>If <var>store</var>’s <a data-link-type="dfn" href="https://w3c.github.io/IndexedDB/#object-store-name" id="ref-for-object-store-name">name</a> is not "<code>store</code>", return false.</p>
     <li data-md>
      <p>If <var>store</var> has a <a data-link-type="dfn" href="https://w3c.github.io/IndexedDB/#key-generator" id="ref-for-key-generator">key generator</a>, return false.</p>
     <li data-md>
      <p>If <var>store</var> has a <a data-link-type="dfn" href="https://w3c.github.io/IndexedDB/#object-store-key-path" id="ref-for-object-store-key-path">key path</a>, return false.</p>
     <li data-md>
      <p>If any <a data-link-type="dfn" href="https://w3c.github.io/IndexedDB/#index-concept" id="ref-for-index-concept">indexes</a> reference <var>store</var>, return false.</p>
     <li data-md>
      <p>Return true.</p>
    </ol>
    <p class="note" role="note"><a data-link-type="dfn" href="#check-the-database-schema" id="ref-for-check-the-database-schema①">Check the database schema</a> only needs to be called in the initial setup algorithm, <a data-link-type="dfn" href="#initialize-the-database-promise" id="ref-for-initialize-the-database-promise①">initialize the database promise</a>, since once the database connection has been opened, the schema cannot change.</p>
   </div>
   <div class="algorithm" data-algorithm="allowed as a key">
     A value <var>value</var> is <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="allowed-as-a-key">allowed as a key</dfn> if the following steps return true: 
    <ol>
     <li data-md>
      <p>If <a data-link-type="abstract-op" href="https://tc39.github.io/ecma262/#sec-ecmascript-data-types-and-values" id="ref-for-sec-ecmascript-data-types-and-values">Type</a>(<var>value</var>) is Number or String, return true.</p>
     <li data-md>
      <p>If <a data-link-type="abstract-op" href="https://tc39.github.io/ecma262/#sec-isarray" id="ref-for-sec-isarray">IsArray</a>(<var>value</var>) is true, return true.</p>
     <li data-md>
      <p>If <var>value</var> has a [[DateValue]] internal slot, return true.</p>
     <li data-md>
      <p>If <var>value</var> has a [[ViewedArrayBuffer]] internal slot, return true.</p>
     <li data-md>
      <p>If <var>value</var> has an [[ArrayBufferByteLength]] internal slot, return true.</p>
     <li data-md>
      <p>Return false.</p>
    </ol>
    <div class="note" role="note">
      A value being <a data-link-type="dfn" href="#allowed-as-a-key" id="ref-for-allowed-as-a-key③">allowed as a key</a> means that it can at least plausibly be used as a key in the IndexedDB APIs. In particular, the values which are <a data-link-type="dfn" href="#allowed-as-a-key" id="ref-for-allowed-as-a-key④">allowed as a key</a> are a subset of those for which IndexedDB’s <a data-link-type="dfn" href="https://w3c.github.io/IndexedDB/#convert-a-value-to-a-key" id="ref-for-convert-a-value-to-a-key">convert a value to a key</a> algorithm will succeed. 
     <p>Most notably, using the <a data-link-type="dfn" href="#allowed-as-a-key" id="ref-for-allowed-as-a-key⑤">allowed as a key</a> predicate ensures that <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/IndexedDB/#idbkeyrange" id="ref-for-idbkeyrange">IDBKeyRange</a></code> objects, or any other special object that is accepted as a query in future IndexedDB specification revisions, will be disallowed. Only straightforward key values are accepted by the KV storage API.</p>
    </div>
   </div>
   <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="key round-trip" data-noexport id="key-round-trip">Key round-tripping</dfn> refers to the way in which JavaScript values are processed by first being passed through IndexedDB’s <a data-link-type="dfn" href="https://w3c.github.io/IndexedDB/#convert-a-value-to-a-key" id="ref-for-convert-a-value-to-a-key①">convert a value to a key</a> operation, then converted back through its <a data-link-type="dfn" href="https://w3c.github.io/IndexedDB/#convert-a-key-to-a-value" id="ref-for-convert-a-key-to-a-value">convert a key to a value</a> operation. Keys returned by the <code class="idl"><a data-link-type="idl" href="#dom-kvstoragearea-keys" id="ref-for-dom-kvstoragearea-keys④">keys()</a></code> or <code class="idl"><a data-link-type="idl" href="#dom-kvstoragearea-entries" id="ref-for-dom-kvstoragearea-entries">entries()</a></code> methods will have gone through this process.</p>
   <p>Notably, any <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#sec-typedarray-objects" id="ref-for-sec-typedarray-objects①">typed arrays</a> or <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DataView" id="ref-for-idl-DataView①">DataView</a></code>s will have been "unwrapped", and returned back as just <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-ArrayBuffer" id="ref-for-idl-ArrayBuffer①">ArrayBuffer</a></code>s containing the same bytes. Also, similar to the <a data-link-type="abstract-op" href="https://html.spec.whatwg.org/multipage/structured-data.html#structuredserializeforstorage" id="ref-for-structuredserializeforstorage①">structured-serialization</a>/<a data-link-type="abstract-op" href="https://html.spec.whatwg.org/multipage/structured-data.html#structureddeserialize" id="ref-for-structureddeserialize③">deserialization</a> process, any "expando" properties or other modifications will not be preserved by <a data-link-type="dfn" href="#key-round-trip" id="ref-for-key-round-trip②">key round-tripping</a>.</p>
   <p class="note" role="note">For primitive string or number values, there’s no need to worry about <a data-link-type="dfn" href="#key-round-trip" id="ref-for-key-round-trip③">key round-tripping</a>; the values are indistinguishable.</p>
   <div class="algorithm" data-algorithm="get the range for a key">
     To <dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="get the range for a key|getting the range for|getting the range for a key" data-noexport id="get-the-range-for-a-key">get the range for a key</dfn> <var>key</var>: 
    <ol>
     <li data-md>
      <p>If <var>key</var> is <a data-link-type="dfn" href="#not-yet-started" id="ref-for-not-yet-started①">not yet started</a>, then return the result of performing the steps listed in the description of the <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/IndexedDB/#dom-idbkeyrange-lowerbound" id="ref-for-dom-idbkeyrange-lowerbound">IDBKeyRange.lowerBound()</a></code> static method, given the argument −Infinity.</p>
      <p class="note" role="note">The intent here is to get an <a data-link-type="dfn" href="https://w3c.github.io/IndexedDB/#unbounded-key-range" id="ref-for-unbounded-key-range">unbounded key range</a>, but this is the closest thing we can get that is representable as an <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/IndexedDB/#idbkeyrange" id="ref-for-idbkeyrange①">IDBKeyRange</a></code> object. It works equivalently for our purposes, but will behave incorrectly if Indexed DB ever adds keys that sort below −Infinity. See <a href="https://github.com/WICG/kv-storage/issues/6#issuecomment-452054944">some discussion on potential future improvements</a>.</p>
     <li data-md>
      <p>Otherwise, return the result of performing the steps listed listed in the description of the <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/IndexedDB/#dom-idbkeyrange-lowerbound" id="ref-for-dom-idbkeyrange-lowerbound①">IDBKeyRange.lowerBound()</a></code> static method, given the arguments <var>key</var> and true.</p>
    </ol>
   </div>
   <p>The special value <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="not-yet-started">not yet started</dfn> can be taken to be any JavaScript value that is not equal to any other program-accessible JavaScript value (but is equal to itself). It is used exclusively as an argument to the <a data-link-type="dfn" href="#get-the-range-for-a-key" id="ref-for-get-the-range-for-a-key①">get the range for a key</a> algorithm.</p>
   <p class="example" id="example-not-yet-started"><a class="self-link" href="#example-not-yet-started"></a>A newly created object or symbol, e.g. <code class="highlight"><c- a>const</c-> nys <c- o>=</c-> <c- p>{}</c-></code> or <code class="highlight"><c- a>const</c-> nys <c- o>=</c-> Symbol<c- p>()</c-></code>, would satisfy this definition.</p>
   <h2 class="no-num heading settled" id="acks"><span class="content">Acknowledgments</span><a class="self-link" href="#acks"></a></h2>
   <p>The editor would like to thank
Andrew Sutherland,
Kenneth Rohde Christiansen,
Jacob Rask,
Jake Archibald,
Jan Varga,
Joshua Bell,
Ms2ger,
and
Victor Costan
for their contributions to this specification.</p>
   <h2 class="no-num heading settled" id="conformance"><span class="content">Conformance</span><a class="self-link" href="#conformance"></a></h2>
   <p>This specification depends on the Infra Standard. <a data-link-type="biblio" href="#biblio-infra" title="Infra Standard">[INFRA]</a></p>
  </main>
  <script src="https://www.w3.org/scripts/TR/2021/fixup.js"></script>
  <h2 class="no-num no-ref heading settled" id="index"><span class="content">Index</span><a class="self-link" href="#index"></a></h2>
  <h3 class="no-num no-ref heading settled" id="index-defined-here"><span class="content">Terms defined by this specification</span><a class="self-link" href="#index-defined-here"></a></h3>
  <ul class="index">
   <li><a href="#add-a-simple-event-listener">add a simple event listener</a><span>, in § 4</span>
   <li><a href="#allowed-as-a-key">allowed as a key</a><span>, in § 4</span>
   <li><a href="#KVStorageArea-backingstore">backingStore</a><span>, in § 3.6</span>
   <li><a href="#backingstoreobject">[[BackingStoreObject]]</a><span>, in § 3</span>
   <li><a href="#check-the-database-schema">check the database schema</a><span>, in § 4</span>
   <li><a href="#KVStorageArea-clear">clear()</a><span>, in § 3.4</span>
   <li><a href="#KVStorageArea-constructor">constructor(name)</a><span>, in § 3</span>
   <li><a href="#current-idbfactory">current IDBFactory</a><span>, in § 4</span>
   <li><a href="#databasename">[[DatabaseName]]</a><span>, in § 3</span>
   <li><a href="#databasepromise">[[DatabasePromise]]</a><span>, in § 3</span>
   <li><a href="#default-kv-storage-area">default KV Storage area</a><span>, in § 2</span>
   <li><a href="#KVStorageArea-delete">delete(key)</a><span>, in § 3.3</span>
   <li><a href="#deleting-the-database">delete the database</a><span>, in § 3.5</span>
   <li><a href="#deleting-the-database">deleting the database</a><span>, in § 3.5</span>
   <li><a href="#dom-kvstoragearea-entries">entries()</a><span>, in § 3.6</span>
   <li><a href="#KVStorageArea-get">get(key)</a><span>, in § 3.2</span>
   <li><a href="#get-the-range-for-a-key">get the range for a key</a><span>, in § 4</span>
   <li><a href="#get-the-range-for-a-key">getting the range for</a><span>, in § 4</span>
   <li><a href="#get-the-range-for-a-key">getting the range for a key</a><span>, in § 4</span>
   <li><a href="#initialize-the-database-promise">initialize the database promise</a><span>, in § 4</span>
   <li><a href="#key-round-trip">key round-trip</a><span>, in § 4</span>
   <li><a href="#dom-kvstoragearea-keys">keys()</a><span>, in § 3.6</span>
   <li><a href="#dom-windoworworkerglobalscope-kvstorage">kvStorage</a><span>, in § 2</span>
   <li><a href="#KVStorageArea">KVStorageArea</a><span>, in § 2</span>
   <li><a href="#KVStorageArea-constructor">KVStorageArea(name)</a><span>, in § 3</span>
   <li><a href="#kvstorageareaasynciterator-last-key">last key</a><span>, in § 3.6</span>
   <li><a href="#not-yet-started">not yet started</a><span>, in § 4</span>
   <li><a href="#performing-a-database-operation">perform a database operation</a><span>, in § 4</span>
   <li><a href="#performing-a-database-operation">performing a database operation</a><span>, in § 4</span>
   <li><a href="#KVStorageArea-set">set(key, value)</a><span>, in § 3.1</span>
   <li><a href="#dom-kvstoragearea-values">values()</a><span>, in § 3.6</span>
  </ul>
  <h3 class="no-num no-ref heading settled" id="index-defined-elsewhere"><span class="content">Terms defined by reference</span><a class="self-link" href="#index-defined-elsewhere"></a></h3>
  <ul class="index">
   <li>
    <a data-link-type="biblio">[DOM]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="d30f4c38">EventListener</span>
     <li><span class="dfn-paneled" id="2bc0cdf4">EventTarget</span>
     <li><span class="dfn-paneled" id="6cf6f82f">addEventListener(type, callback)</span>
    </ul>
   <li>
    <a data-link-type="biblio">[ECMASCRIPT]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="77f4ac5e">%ObjectPrototype%</span>
     <li><span class="dfn-paneled" id="9969b288">CreateDataProperty</span>
     <li><span class="dfn-paneled" id="4e437047">Date</span>
     <li><span class="dfn-paneled" id="41110b4b">IsArray</span>
     <li><span class="dfn-paneled" id="3ed94265">Map</span>
     <li><span class="dfn-paneled" id="009cf1ad">ObjectCreate</span>
     <li><span class="dfn-paneled" id="128b930d">SetIntegrityLevel</span>
     <li><span class="dfn-paneled" id="c9258c1d">Type</span>
     <li><span class="dfn-paneled" id="b107f911">current Realm</span>
     <li><span class="dfn-paneled" id="6f257f9f">Realm</span>
     <li><span class="dfn-paneled" id="41fb6839">typed array</span>
    </ul>
   <li>
    <a data-link-type="biblio">[FETCH]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="e806d5a8">Headers</span>
    </ul>
   <li>
    <a data-link-type="biblio">[HTML]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="b8bd9c92">Storage</span>
     <li><span class="dfn-paneled" id="0800bdf4">StructuredDeserialize</span>
     <li><span class="dfn-paneled" id="f534ab0c">StructuredSerializeForStorage</span>
     <li><span class="dfn-paneled" id="5f6d392d">WindowOrWorkerGlobalScope</span>
     <li><span class="dfn-paneled" id="ce3d2bbb">current global object</span>
     <li><span class="dfn-paneled" id="3a2db83f">localStorage</span>
     <li><span class="dfn-paneled" id="5991ccfb">relevant realm</span>
     <li><span class="dfn-paneled" id="65181da8">secure context</span>
    </ul>
   <li>
    <a data-link-type="biblio">[INDEXEDDB-2]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="aef9bb02">ascending</span>
     <li><span class="dfn-paneled" id="d4fcc09d">close a database connection</span>
     <li><span class="dfn-paneled" id="58a5d581">connection</span>
     <li><span class="dfn-paneled" id="2a4db95f">convert a key to a value</span>
     <li><span class="dfn-paneled" id="bd42989c">convert a value to a key</span>
     <li><span class="dfn-paneled" id="5a31ec1f">error <small>(for request)</small></span>
     <li><span class="dfn-paneled" id="f40d5e6c">error <small>(for transaction)</small></span>
     <li><span class="dfn-paneled" id="68af01e7">index</span>
     <li><span class="dfn-paneled" id="17bc0980">key generator</span>
     <li><span class="dfn-paneled" id="f045e088">key path</span>
     <li><span class="dfn-paneled" id="36986455">name</span>
     <li><span class="dfn-paneled" id="f35ddfe3">object store set</span>
     <li><span class="dfn-paneled" id="1b3a7884">result</span>
     <li><span class="dfn-paneled" id="1e0c2e49">transaction</span>
     <li><span class="dfn-paneled" id="55ebb067">unbounded key range</span>
    </ul>
   <li>
    <a data-link-type="biblio">[IndexedDB-3]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="a46ec9f9">IDBDatabase</span>
     <li><span class="dfn-paneled" id="78f41bd1">IDBFactory</span>
     <li><span class="dfn-paneled" id="5b474d1b">IDBKeyRange</span>
     <li><span class="dfn-paneled" id="29a9da17">IDBObjectStore</span>
     <li><span class="dfn-paneled" id="668bd53e">IDBTransaction</span>
     <li><span class="dfn-paneled" id="66550d32">close()</span>
     <li><span class="dfn-paneled" id="bb3c1c89">createObjectStore(name)</span>
     <li><span class="dfn-paneled" id="7f6fec08">delete(query)</span>
     <li><span class="dfn-paneled" id="99c92726">deleteDatabase(name)</span>
     <li><span class="dfn-paneled" id="ccf6aba0">get(query)</span>
     <li><span class="dfn-paneled" id="d920cf48">getKey(query)</span>
     <li><span class="dfn-paneled" id="6ced0379">indexedDB</span>
     <li><span class="dfn-paneled" id="73011309">lowerBound(lower)</span>
     <li><span class="dfn-paneled" id="c0cbcc97">lowerBound(lower, open)</span>
     <li><span class="dfn-paneled" id="b7c817bb">objectStore(name)</span>
     <li><span class="dfn-paneled" id="ff414e52">open(name)</span>
     <li><span class="dfn-paneled" id="51b5c19c">put(value)</span>
     <li><span class="dfn-paneled" id="153fbd63">transaction(storeNames)</span>
    </ul>
   <li>
    <a data-link-type="biblio">[INFRA]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="0204d188">size</span>
    </ul>
   <li>
    <a data-link-type="biblio">[SERVICE-WORKERS]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="d8ef5cf9">Cache</span>
    </ul>
   <li>
    <a data-link-type="biblio">[WEBIDL]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="2f8afbfe">ArrayBuffer</span>
     <li><span class="dfn-paneled" id="dca2de17">DOMException</span>
     <li><span class="dfn-paneled" id="8855a9aa">DOMString</span>
     <li><span class="dfn-paneled" id="d54f5897">DataCloneError</span>
     <li><span class="dfn-paneled" id="24fec0b4">DataError</span>
     <li><span class="dfn-paneled" id="7d1e68b7">DataView</span>
     <li><span class="dfn-paneled" id="889e932f">Exposed</span>
     <li><span class="dfn-paneled" id="797018a7">InvalidStateError</span>
     <li><span class="dfn-paneled" id="bdbd19d1">Promise</span>
     <li><span class="dfn-paneled" id="a5c91173">SameObject</span>
     <li><span class="dfn-paneled" id="b75bb3bd">SecureContext</span>
     <li><span class="dfn-paneled" id="82ca3efc">TypeError</span>
     <li><span class="dfn-paneled" id="dacde8b5">a new promise</span>
     <li><span class="dfn-paneled" id="d0b4a948">a promise rejected with</span>
     <li><span class="dfn-paneled" id="6c6b1005">any</span>
     <li><span class="dfn-paneled" id="9a7f3f6f">asynchronous iterator initialization steps</span>
     <li><span class="dfn-paneled" id="cadf5fe9">converted to an IDL value</span>
     <li><span class="dfn-paneled" id="e7652812">get the next iteration result</span>
     <li><span class="dfn-paneled" id="a7900362">include</span>
     <li><span class="dfn-paneled" id="db527bc3">named properties</span>
     <li><span class="dfn-paneled" id="efd1ec5d">object</span>
     <li><span class="dfn-paneled" id="116848ac">reacting</span>
     <li><span class="dfn-paneled" id="b262501e">reject</span>
     <li><span class="dfn-paneled" id="3b90bdcd">resolve</span>
     <li><span class="dfn-paneled" id="4013a022">this</span>
    </ul>
  </ul>
  <h2 class="no-num no-ref heading settled" id="references"><span class="content">References</span><a class="self-link" href="#references"></a></h2>
  <h3 class="no-num no-ref heading settled" id="normative"><span class="content">Normative References</span><a class="self-link" href="#normative"></a></h3>
  <dl>
   <dt id="biblio-dom">[DOM]
   <dd>Anne van Kesteren. <a href="https://dom.spec.whatwg.org/"><cite>DOM Standard</cite></a>. Living Standard. URL: <a href="https://dom.spec.whatwg.org/">https://dom.spec.whatwg.org/</a>
   <dt id="biblio-ecmascript">[ECMASCRIPT]
   <dd><a href="https://tc39.es/ecma262/multipage/"><cite>ECMAScript Language Specification</cite></a>. URL: <a href="https://tc39.es/ecma262/multipage/">https://tc39.es/ecma262/multipage/</a>
   <dt id="biblio-html">[HTML]
   <dd>Anne van Kesteren; et al. <a href="https://html.spec.whatwg.org/multipage/"><cite>HTML Standard</cite></a>. Living Standard. URL: <a href="https://html.spec.whatwg.org/multipage/">https://html.spec.whatwg.org/multipage/</a>
   <dt id="biblio-indexeddb-2">[INDEXEDDB-2]
   <dd>Ali Alabbas; Joshua Bell. <a href="https://w3c.github.io/IndexedDB/"><cite>Indexed Database API 2.0</cite></a>. URL: <a href="https://w3c.github.io/IndexedDB/">https://w3c.github.io/IndexedDB/</a>
   <dt id="biblio-indexeddb-3">[IndexedDB-3]
   <dd>Joshua Bell. <a href="https://w3c.github.io/IndexedDB/"><cite>Indexed Database API 3.0</cite></a>. URL: <a href="https://w3c.github.io/IndexedDB/">https://w3c.github.io/IndexedDB/</a>
   <dt id="biblio-infra">[INFRA]
   <dd>Anne van Kesteren; Domenic Denicola. <a href="https://infra.spec.whatwg.org/"><cite>Infra Standard</cite></a>. Living Standard. URL: <a href="https://infra.spec.whatwg.org/">https://infra.spec.whatwg.org/</a>
   <dt id="biblio-webidl">[WEBIDL]
   <dd>Edgar Chen; Timothy Gu. <a href="https://webidl.spec.whatwg.org/"><cite>Web IDL Standard</cite></a>. Living Standard. URL: <a href="https://webidl.spec.whatwg.org/">https://webidl.spec.whatwg.org/</a>
  </dl>
  <h3 class="no-num no-ref heading settled" id="informative"><span class="content">Informative References</span><a class="self-link" href="#informative"></a></h3>
  <dl>
   <dt id="biblio-fetch">[FETCH]
   <dd>Anne van Kesteren. <a href="https://fetch.spec.whatwg.org/"><cite>Fetch Standard</cite></a>. Living Standard. URL: <a href="https://fetch.spec.whatwg.org/">https://fetch.spec.whatwg.org/</a>
   <dt id="biblio-service-workers">[SERVICE-WORKERS]
   <dd>Jake Archibald; Marijn Kruisselbrink. <a href="https://w3c.github.io/ServiceWorker/"><cite>Service Workers</cite></a>. URL: <a href="https://w3c.github.io/ServiceWorker/">https://w3c.github.io/ServiceWorker/</a>
  </dl>
  <h2 class="no-num no-ref heading settled" id="idl-index"><span class="content">IDL Index</span><a class="self-link" href="#idl-index"></a></h2>
<pre class="idl highlight def"><c- b>partial</c-> <c- b>interface</c-> <a class="idl-code" data-link-type="interface" href="https://html.spec.whatwg.org/multipage/webappapis.html#windoworworkerglobalscope"><c- g>WindowOrWorkerGlobalScope</c-></a> {
  [<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#SecureContext"><c- g>SecureContext</c-></a>] <c- b>readonly</c-> <c- b>attribute</c-> <a data-link-type="idl-name" href="#KVStorageArea"><c- n>KVStorageArea</c-></a> <a class="idl-code" data-link-type="attribute" data-readonly data-type="KVStorageArea" href="#dom-windoworworkerglobalscope-kvstorage"><c- g>kvStorage</c-></a>;
};

[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#SecureContext"><c- g>SecureContext</c-></a>, <a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed"><c- g>Exposed</c-></a>=(<c- n>Window</c->,<c- n>Worker</c->)]
<c- b>interface</c-> <a class="idl-code" data-link-type="interface" href="#KVStorageArea"><c- g>KVStorageArea</c-></a> {
  <a class="idl-code" data-link-type="constructor" href="#KVStorageArea-constructor"><c- g>constructor</c-></a>(<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString"><c- b>DOMString</c-></a> <a href="#dom-kvstoragearea-kvstoragearea-name-name"><code><c- g>name</c-></code></a>);

  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise"><c- b>Promise</c-></a>&lt;<a data-link-type="idl-name"><c- n>void</c-></a>> <a class="idl-code" data-link-type="method" href="#KVStorageArea-set"><c- g>set</c-></a>(<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-any"><c- b>any</c-></a> <a href="#dom-kvstoragearea-set-key-value-key"><code><c- g>key</c-></code></a>, <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-any"><c- b>any</c-></a> <a href="#dom-kvstoragearea-set-key-value-value"><code><c- g>value</c-></code></a>);
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise"><c- b>Promise</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-any"><c- b>any</c-></a>> <a class="idl-code" data-link-type="method" href="#KVStorageArea-get"><c- g>get</c-></a>(<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-any"><c- b>any</c-></a> <a href="#dom-kvstoragearea-get-key-key"><code><c- g>key</c-></code></a>);
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise"><c- b>Promise</c-></a>&lt;<a data-link-type="idl-name"><c- n>void</c-></a>> <a class="idl-code" data-link-type="method" href="#KVStorageArea-delete"><c- g>delete</c-></a>(<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-any"><c- b>any</c-></a> <a href="#dom-kvstoragearea-delete-key-key"><code><c- g>key</c-></code></a>);
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise"><c- b>Promise</c-></a>&lt;<a data-link-type="idl-name"><c- n>void</c-></a>> <a class="idl-code" data-link-type="method" href="#KVStorageArea-clear"><c- g>clear</c-></a>();

  <c- b>async</c-> <c- b>iterable</c->&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-any"><c- b>any</c-></a>, <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-any"><c- b>any</c-></a>>;

  [<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#SameObject"><c- g>SameObject</c-></a>] <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-object"><c- b>object</c-></a> <a class="idl-code" data-link-type="attribute" data-readonly data-type="object" href="#KVStorageArea-backingstore"><c- g>backingStore</c-></a>;
};

</pre>
<script>/* Boilerplate: script-dom-helper */
"use strict";
function query(sel) { return document.querySelector(sel); }

function queryAll(sel) { return [...document.querySelectorAll(sel)]; }

function iter(obj) {
	if(!obj) return [];
	var it = obj[Symbol.iterator];
	if(it) return it;
	return Object.entries(obj);
}

function mk(tagname, attrs, ...children) {
	const el = document.createElement(tagname);
	for(const [k,v] of iter(attrs)) {
		if(k.slice(0,3) == "_on") {
			const eventName = k.slice(3);
			el.addEventListener(eventName, v);
		} else if(k[0] == "_") {
			// property, not attribute
			el[k.slice(1)] = v;
		} else {
			if(v === false || v == null) {
        continue;
      } else if(v === true) {
        el.setAttribute(k, "");
        continue;
      } else {
  			el.setAttribute(k, v);
      }
		}
	}
	append(el, children);
	return el;
}

/* Create shortcuts for every known HTML element */
[
  "a",
  "abbr",
  "acronym",
  "address",
  "applet",
  "area",
  "article",
  "aside",
  "audio",
  "b",
  "base",
  "basefont",
  "bdo",
  "big",
  "blockquote",
  "body",
  "br",
  "button",
  "canvas",
  "caption",
  "center",
  "cite",
  "code",
  "col",
  "colgroup",
  "datalist",
  "dd",
  "del",
  "details",
  "dfn",
  "dialog",
  "div",
  "dl",
  "dt",
  "em",
  "embed",
  "fieldset",
  "figcaption",
  "figure",
  "font",
  "footer",
  "form",
  "frame",
  "frameset",
  "head",
  "header",
  "h1",
  "h2",
  "h3",
  "h4",
  "h5",
  "h6",
  "hr",
  "html",
  "i",
  "iframe",
  "img",
  "input",
  "ins",
  "kbd",
  "label",
  "legend",
  "li",
  "link",
  "main",
  "map",
  "mark",
  "meta",
  "meter",
  "nav",
  "nobr",
  "noscript",
  "object",
  "ol",
  "optgroup",
  "option",
  "output",
  "p",
  "param",
  "pre",
  "progress",
  "q",
  "s",
  "samp",
  "script",
  "section",
  "select",
  "small",
  "source",
  "span",
  "strike",
  "strong",
  "style",
  "sub",
  "summary",
  "sup",
  "table",
  "tbody",
  "td",
  "template",
  "textarea",
  "tfoot",
  "th",
  "thead",
  "time",
  "title",
  "tr",
  "u",
  "ul",
  "var",
  "video",
  "wbr",
  "xmp",
].forEach(tagname=>{
	mk[tagname] = (...args) => mk(tagname, ...args);
});

function* nodesFromChildList(children) {
	for(const child of children.flat(Infinity)) {
		if(child instanceof Node) {
			yield child;
		} else {
			yield new Text(child);
		}
	}
}
function append(el, ...children) {
	for(const child of nodesFromChildList(children)) {
		if(el instanceof Node) el.appendChild(child);
		else el.push(child);
	}
	return el;
}

function insertAfter(el, ...children) {
	for(const child of nodesFromChildList(children)) {
		el.parentNode.insertBefore(child, el.nextSibling);
	}
	return el;
}

function clearContents(el) {
	el.innerHTML = "";
	return el;
}

function parseHTML(markup) {
	if(markup.toLowerCase().trim().indexOf('<!doctype') === 0) {
		const doc = document.implementation.createHTMLDocument("");
		doc.documentElement.innerHTML = markup;
		return doc;
	} else {
		const el = mk.template({});
		el.innerHTML = markup;
		return el.content;
	}
}</script>
<script>/* Boilerplate: script-dfn-panel */
"use strict";
{
let dfnPanelData = {
"009cf1ad": {"dfnID":"009cf1ad","dfnText":"ObjectCreate","external":true,"refSections":[{"refs":[{"id":"ref-for-sec-objectcreate"}],"title":"3.7. backingStore"}],"url":"https://tc39.github.io/ecma262/#sec-objectcreate"},
"0204d188": {"dfnID":"0204d188","dfnText":"size","external":true,"refSections":[{"refs":[{"id":"ref-for-list-size"}],"title":"4. Supporting operations and concepts"}],"url":"https://infra.spec.whatwg.org/#list-size"},
"0800bdf4": {"dfnID":"0800bdf4","dfnText":"StructuredDeserialize","external":true,"refSections":[{"refs":[{"id":"ref-for-structureddeserialize"}],"title":"3.3. get(key)"},{"refs":[{"id":"ref-for-structureddeserialize\u2460"},{"id":"ref-for-structureddeserialize\u2461"}],"title":"3.6. Iteration"},{"refs":[{"id":"ref-for-structureddeserialize\u2462"}],"title":"4. Supporting operations and concepts"}],"url":"https://html.spec.whatwg.org/multipage/structured-data.html#structureddeserialize"},
"116848ac": {"dfnID":"116848ac","dfnText":"reacting","external":true,"refSections":[{"refs":[{"id":"ref-for-dfn-perform-steps-once-promise-is-settled"}],"title":"3.5. clear()"},{"refs":[{"id":"ref-for-dfn-perform-steps-once-promise-is-settled\u2460"}],"title":"4. Supporting operations and concepts"}],"url":"https://webidl.spec.whatwg.org/#dfn-perform-steps-once-promise-is-settled"},
"128b930d": {"dfnID":"128b930d","dfnText":"SetIntegrityLevel","external":true,"refSections":[{"refs":[{"id":"ref-for-sec-setintegritylevel"}],"title":"3.7. backingStore"}],"url":"https://tc39.github.io/ecma262/#sec-setintegritylevel"},
"153fbd63": {"dfnID":"153fbd63","dfnText":"transaction(storeNames)","external":true,"refSections":[{"refs":[{"id":"ref-for-dom-idbdatabase-transaction"}],"title":"4. Supporting operations and concepts"}],"url":"https://w3c.github.io/IndexedDB/#dom-idbdatabase-transaction"},
"17bc0980": {"dfnID":"17bc0980","dfnText":"key generator","external":true,"refSections":[{"refs":[{"id":"ref-for-key-generator"}],"title":"4. Supporting operations and concepts"}],"url":"https://w3c.github.io/IndexedDB/#key-generator"},
"1b3a7884": {"dfnID":"1b3a7884","dfnText":"result","external":true,"refSections":[{"refs":[{"id":"ref-for-request-result"}],"title":"3.3. get(key)"},{"refs":[{"id":"ref-for-request-result\u2460"},{"id":"ref-for-request-result\u2461"}],"title":"3.6. Iteration"},{"refs":[{"id":"ref-for-request-result\u2462"},{"id":"ref-for-request-result\u2463"}],"title":"4. Supporting operations and concepts"}],"url":"https://w3c.github.io/IndexedDB/#request-result"},
"1e0c2e49": {"dfnID":"1e0c2e49","dfnText":"transaction","external":true,"refSections":[{"refs":[{"id":"ref-for-transaction-concept"}],"title":"3.7. backingStore"}],"url":"https://w3c.github.io/IndexedDB/#transaction-concept"},
"24fec0b4": {"dfnID":"24fec0b4","dfnText":"DataError","external":true,"refSections":[{"refs":[{"id":"ref-for-dataerror"},{"id":"ref-for-dataerror\u2460"}],"title":"3.2. set(key, value)"},{"refs":[{"id":"ref-for-dataerror\u2461"}],"title":"3.3. get(key)"},{"refs":[{"id":"ref-for-dataerror\u2462"}],"title":"3.4. delete(key)"}],"url":"https://webidl.spec.whatwg.org/#dataerror"},
"29a9da17": {"dfnID":"29a9da17","dfnText":"IDBObjectStore","external":true,"refSections":[{"refs":[{"id":"ref-for-idbobjectstore"},{"id":"ref-for-idbobjectstore\u2460"}],"title":"3.2. set(key, value)"},{"refs":[{"id":"ref-for-idbobjectstore\u2461"}],"title":"3.3. get(key)"},{"refs":[{"id":"ref-for-idbobjectstore\u2462"}],"title":"3.4. delete(key)"},{"refs":[{"id":"ref-for-idbobjectstore\u2463"},{"id":"ref-for-idbobjectstore\u2464"}],"title":"3.6. Iteration"},{"refs":[{"id":"ref-for-idbobjectstore\u2465"}],"title":"4. Supporting operations and concepts"}],"url":"https://w3c.github.io/IndexedDB/#idbobjectstore"},
"2a4db95f": {"dfnID":"2a4db95f","dfnText":"convert a key to a value","external":true,"refSections":[{"refs":[{"id":"ref-for-convert-a-key-to-a-value"}],"title":"4. Supporting operations and concepts"}],"url":"https://w3c.github.io/IndexedDB/#convert-a-key-to-a-value"},
"2bc0cdf4": {"dfnID":"2bc0cdf4","dfnText":"EventTarget","external":true,"refSections":[{"refs":[{"id":"ref-for-eventtarget"},{"id":"ref-for-eventtarget\u2460"}],"title":"4. Supporting operations and concepts"}],"url":"https://dom.spec.whatwg.org/#eventtarget"},
"2f8afbfe": {"dfnID":"2f8afbfe","dfnText":"ArrayBuffer","external":true,"refSections":[{"refs":[{"id":"ref-for-idl-ArrayBuffer"}],"title":"3.2. set(key, value)"},{"refs":[{"id":"ref-for-idl-ArrayBuffer\u2460"}],"title":"4. Supporting operations and concepts"}],"url":"https://webidl.spec.whatwg.org/#idl-ArrayBuffer"},
"36986455": {"dfnID":"36986455","dfnText":"name","external":true,"refSections":[{"refs":[{"id":"ref-for-object-store-name"}],"title":"4. Supporting operations and concepts"}],"url":"https://w3c.github.io/IndexedDB/#object-store-name"},
"3a2db83f": {"dfnID":"3a2db83f","dfnText":"localStorage","external":true,"refSections":[{"refs":[{"id":"ref-for-dom-localstorage"}],"title":"Unnumbered Section"},{"refs":[{"id":"ref-for-dom-localstorage\u2460"},{"id":"ref-for-dom-localstorage\u2461"}],"title":"1. Introduction"},{"refs":[{"id":"ref-for-dom-localstorage\u2462"}],"title":"2. The kvStorage global"}],"url":"https://html.spec.whatwg.org/multipage/webstorage.html#dom-localstorage"},
"3b90bdcd": {"dfnID":"3b90bdcd","dfnText":"resolve","external":true,"refSections":[{"refs":[{"id":"ref-for-resolve"}],"title":"3.2. set(key, value)"},{"refs":[{"id":"ref-for-resolve\u2460"}],"title":"3.3. get(key)"},{"refs":[{"id":"ref-for-resolve\u2461"}],"title":"3.4. delete(key)"},{"refs":[{"id":"ref-for-resolve\u2462"}],"title":"3.5. clear()"},{"refs":[{"id":"ref-for-resolve\u2463"},{"id":"ref-for-resolve\u2464"}],"title":"3.6. Iteration"},{"refs":[{"id":"ref-for-resolve\u2465"}],"title":"4. Supporting operations and concepts"}],"url":"https://webidl.spec.whatwg.org/#resolve"},
"3ed94265": {"dfnID":"3ed94265","dfnText":"Map","external":true,"refSections":[{"refs":[{"id":"ref-for-sec-map-objects"}],"title":"1. Introduction"}],"url":"https://tc39.github.io/ecma262/#sec-map-objects"},
"4013a022": {"dfnID":"4013a022","dfnText":"this","external":true,"refSections":[{"refs":[{"id":"ref-for-this"}],"title":"2. The kvStorage global"}],"url":"https://webidl.spec.whatwg.org/#this"},
"41110b4b": {"dfnID":"41110b4b","dfnText":"IsArray","external":true,"refSections":[{"refs":[{"id":"ref-for-sec-isarray"}],"title":"4. Supporting operations and concepts"}],"url":"https://tc39.github.io/ecma262/#sec-isarray"},
"41fb6839": {"dfnID":"41fb6839","dfnText":"typed array","external":true,"refSections":[{"refs":[{"id":"ref-for-sec-typedarray-objects"}],"title":"3.2. set(key, value)"},{"refs":[{"id":"ref-for-sec-typedarray-objects\u2460"}],"title":"4. Supporting operations and concepts"}],"url":"https://tc39.github.io/ecma262/#sec-typedarray-objects"},
"4e437047": {"dfnID":"4e437047","dfnText":"Date","external":true,"refSections":[{"refs":[{"id":"ref-for-sec-date-objects"}],"title":"3.2. set(key, value)"}],"url":"https://tc39.github.io/ecma262/#sec-date-objects"},
"51b5c19c": {"dfnID":"51b5c19c","dfnText":"put(value)","external":true,"refSections":[{"refs":[{"id":"ref-for-dom-idbobjectstore-put"}],"title":"3.2. set(key, value)"}],"url":"https://w3c.github.io/IndexedDB/#dom-idbobjectstore-put"},
"55ebb067": {"dfnID":"55ebb067","dfnText":"unbounded key range","external":true,"refSections":[{"refs":[{"id":"ref-for-unbounded-key-range"}],"title":"4. Supporting operations and concepts"}],"url":"https://w3c.github.io/IndexedDB/#unbounded-key-range"},
"58a5d581": {"dfnID":"58a5d581","dfnText":"connection","external":true,"refSections":[{"refs":[{"id":"ref-for-connection"}],"title":"4. Supporting operations and concepts"}],"url":"https://w3c.github.io/IndexedDB/#connection"},
"5991ccfb": {"dfnID":"5991ccfb","dfnText":"relevant realm","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-relevant-realm"}],"title":"3.2. set(key, value)"},{"refs":[{"id":"ref-for-concept-relevant-realm\u2460"}],"title":"3.3. get(key)"},{"refs":[{"id":"ref-for-concept-relevant-realm\u2461"}],"title":"3.4. delete(key)"},{"refs":[{"id":"ref-for-concept-relevant-realm\u2462"}],"title":"3.5. clear()"},{"refs":[{"id":"ref-for-concept-relevant-realm\u2463"}],"title":"3.6. Iteration"},{"refs":[{"id":"ref-for-concept-relevant-realm\u2464"}],"title":"4. Supporting operations and concepts"}],"url":"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm"},
"5a31ec1f": {"dfnID":"5a31ec1f","dfnText":"error (for request)","external":true,"refSections":[{"refs":[{"id":"ref-for-request-error"}],"title":"3.3. get(key)"},{"refs":[{"id":"ref-for-request-error\u2460"}],"title":"3.5. clear()"},{"refs":[{"id":"ref-for-request-error\u2461"},{"id":"ref-for-request-error\u2462"}],"title":"3.6. Iteration"},{"refs":[{"id":"ref-for-request-error\u2463"}],"title":"4. Supporting operations and concepts"}],"url":"https://w3c.github.io/IndexedDB/#request-error"},
"5b474d1b": {"dfnID":"5b474d1b","dfnText":"IDBKeyRange","external":true,"refSections":[{"refs":[{"id":"ref-for-idbkeyrange"},{"id":"ref-for-idbkeyrange\u2460"}],"title":"4. Supporting operations and concepts"}],"url":"https://w3c.github.io/IndexedDB/#idbkeyrange"},
"5f6d392d": {"dfnID":"5f6d392d","dfnText":"WindowOrWorkerGlobalScope","external":true,"refSections":[{"refs":[{"id":"ref-for-windoworworkerglobalscope"},{"id":"ref-for-windoworworkerglobalscope\u2460"}],"title":"2. The kvStorage global"},{"refs":[{"id":"ref-for-windoworworkerglobalscope\u2461"},{"id":"ref-for-windoworworkerglobalscope\u2462"},{"id":"ref-for-windoworworkerglobalscope\u2463"}],"title":"4. Supporting operations and concepts"}],"url":"https://html.spec.whatwg.org/multipage/webappapis.html#windoworworkerglobalscope"},
"65181da8": {"dfnID":"65181da8","dfnText":"secure context","external":true,"refSections":[{"refs":[{"id":"ref-for-secure-context"}],"title":"2. The kvStorage global"}],"url":"https://html.spec.whatwg.org/multipage/webappapis.html#secure-context"},
"66550d32": {"dfnID":"66550d32","dfnText":"close()","external":true,"refSections":[{"refs":[{"id":"ref-for-dom-idbdatabase-close"}],"title":"4. Supporting operations and concepts"}],"url":"https://w3c.github.io/IndexedDB/#dom-idbdatabase-close"},
"668bd53e": {"dfnID":"668bd53e","dfnText":"IDBTransaction","external":true,"refSections":[{"refs":[{"id":"ref-for-idbtransaction"},{"id":"ref-for-idbtransaction\u2460"}],"title":"4. Supporting operations and concepts"}],"url":"https://w3c.github.io/IndexedDB/#idbtransaction"},
"68af01e7": {"dfnID":"68af01e7","dfnText":"index","external":true,"refSections":[{"refs":[{"id":"ref-for-index-concept"}],"title":"4. Supporting operations and concepts"}],"url":"https://w3c.github.io/IndexedDB/#index-concept"},
"6c6b1005": {"dfnID":"6c6b1005","dfnText":"any","external":true,"refSections":[{"refs":[{"id":"ref-for-idl-any"},{"id":"ref-for-idl-any\u2460"},{"id":"ref-for-idl-any\u2461"},{"id":"ref-for-idl-any\u2462"},{"id":"ref-for-idl-any\u2463"},{"id":"ref-for-idl-any\u2464"},{"id":"ref-for-idl-any\u2465"}],"title":"3. The KVStorageArea class"}],"url":"https://webidl.spec.whatwg.org/#idl-any"},
"6ced0379": {"dfnID":"6ced0379","dfnText":"indexedDB","external":true,"refSections":[{"refs":[{"id":"ref-for-dom-windoworworkerglobalscope-indexeddb"}],"title":"4. Supporting operations and concepts"}],"url":"https://w3c.github.io/IndexedDB/#dom-windoworworkerglobalscope-indexeddb"},
"6cf6f82f": {"dfnID":"6cf6f82f","dfnText":"addEventListener(type, callback)","external":true,"refSections":[{"refs":[{"id":"ref-for-dom-eventtarget-addeventlistener"}],"title":"4. Supporting operations and concepts"}],"url":"https://dom.spec.whatwg.org/#dom-eventtarget-addeventlistener"},
"6f257f9f": {"dfnID":"6f257f9f","dfnText":"Realm","external":true,"refSections":[{"refs":[{"id":"ref-for-realm-record"}],"title":"3.5. clear()"}],"url":"https://tc39.github.io/ecma262/#realm-record"},
"73011309": {"dfnID":"73011309","dfnText":"lowerBound(lower)","external":true,"refSections":[{"refs":[{"id":"ref-for-dom-idbkeyrange-lowerbound"},{"id":"ref-for-dom-idbkeyrange-lowerbound\u2460"}],"title":"4. Supporting operations and concepts"}],"url":"https://w3c.github.io/IndexedDB/#dom-idbkeyrange-lowerbound"},
"77f4ac5e": {"dfnID":"77f4ac5e","dfnText":"%ObjectPrototype%","external":true,"refSections":[{"refs":[{"id":"ref-for-sec-properties-of-the-object-prototype-object"}],"title":"3.7. backingStore"}],"url":"https://tc39.github.io/ecma262/#sec-properties-of-the-object-prototype-object"},
"78f41bd1": {"dfnID":"78f41bd1","dfnText":"IDBFactory","external":true,"refSections":[{"refs":[{"id":"ref-for-idbfactory"}],"title":"3.5. clear()"},{"refs":[{"id":"ref-for-idbfactory\u2460"},{"id":"ref-for-idbfactory\u2461"}],"title":"4. Supporting operations and concepts"}],"url":"https://w3c.github.io/IndexedDB/#idbfactory"},
"797018a7": {"dfnID":"797018a7","dfnText":"InvalidStateError","external":true,"refSections":[{"refs":[{"id":"ref-for-invalidstateerror"}],"title":"4. Supporting operations and concepts"}],"url":"https://webidl.spec.whatwg.org/#invalidstateerror"},
"7d1e68b7": {"dfnID":"7d1e68b7","dfnText":"DataView","external":true,"refSections":[{"refs":[{"id":"ref-for-idl-DataView"}],"title":"3.2. set(key, value)"},{"refs":[{"id":"ref-for-idl-DataView\u2460"}],"title":"4. Supporting operations and concepts"}],"url":"https://webidl.spec.whatwg.org/#idl-DataView"},
"7f6fec08": {"dfnID":"7f6fec08","dfnText":"delete(query)","external":true,"refSections":[{"refs":[{"id":"ref-for-dom-idbobjectstore-delete"}],"title":"3.2. set(key, value)"},{"refs":[{"id":"ref-for-dom-idbobjectstore-delete\u2460"}],"title":"3.4. delete(key)"}],"url":"https://w3c.github.io/IndexedDB/#dom-idbobjectstore-delete"},
"82ca3efc": {"dfnID":"82ca3efc","dfnText":"TypeError","external":true,"refSections":[{"refs":[{"id":"ref-for-exceptiondef-typeerror"}],"title":"4. Supporting operations and concepts"}],"url":"https://webidl.spec.whatwg.org/#exceptiondef-typeerror"},
"8855a9aa": {"dfnID":"8855a9aa","dfnText":"DOMString","external":true,"refSections":[{"refs":[{"id":"ref-for-idl-DOMString"}],"title":"3. The KVStorageArea class"}],"url":"https://webidl.spec.whatwg.org/#idl-DOMString"},
"889e932f": {"dfnID":"889e932f","dfnText":"Exposed","external":true,"refSections":[{"refs":[{"id":"ref-for-Exposed"}],"title":"3. The KVStorageArea class"}],"url":"https://webidl.spec.whatwg.org/#Exposed"},
"9969b288": {"dfnID":"9969b288","dfnText":"CreateDataProperty","external":true,"refSections":[{"refs":[{"id":"ref-for-sec-createdataproperty"},{"id":"ref-for-sec-createdataproperty\u2460"},{"id":"ref-for-sec-createdataproperty\u2461"}],"title":"3.7. backingStore"}],"url":"https://tc39.github.io/ecma262/#sec-createdataproperty"},
"99c92726": {"dfnID":"99c92726","dfnText":"deleteDatabase(name)","external":true,"refSections":[{"refs":[{"id":"ref-for-dom-idbfactory-deletedatabase"}],"title":"3.5. clear()"}],"url":"https://w3c.github.io/IndexedDB/#dom-idbfactory-deletedatabase"},
"9a7f3f6f": {"dfnID":"9a7f3f6f","dfnText":"asynchronous iterator initialization steps","external":true,"refSections":[{"refs":[{"id":"ref-for-asynchronous-iterator-initialization-steps"}],"title":"3.6. Iteration"}],"url":"https://webidl.spec.whatwg.org/#asynchronous-iterator-initialization-steps"},
"KVStorageArea": {"dfnID":"KVStorageArea","dfnText":"3. The KVStorageArea class","external":false,"refSections":[{"refs":[{"id":"ref-for-KVStorageArea"},{"id":"ref-for-KVStorageArea\u2460"},{"id":"ref-for-KVStorageArea\u2461"}],"title":"2. The kvStorage global"},{"refs":[{"id":"ref-for-KVStorageArea"},{"id":"ref-for-KVStorageArea\u2462"},{"id":"ref-for-KVStorageArea\u2463"}],"title":"3. The KVStorageArea class"},{"refs":[{"id":"ref-for-KVStorageArea\u2464"}],"title":"3.1. constructor(name)"},{"refs":[{"id":"ref-for-KVStorageArea\u2465"},{"id":"ref-for-KVStorageArea\u2466"},{"id":"ref-for-KVStorageArea\u2467"}],"title":"3.6. Iteration"},{"refs":[{"id":"ref-for-KVStorageArea\u2468"}],"title":"3.7. backingStore"},{"refs":[{"id":"ref-for-KVStorageArea\u2460\u24ea"},{"id":"ref-for-KVStorageArea\u2460\u2460"},{"id":"ref-for-KVStorageArea\u2460\u2461"},{"id":"ref-for-KVStorageArea\u2460\u2462"}],"title":"4. Supporting operations and concepts"}],"url":"#KVStorageArea"},
"KVStorageArea-backingstore": {"dfnID":"KVStorageArea-backingstore","dfnText":"3.7. backingStore","external":false,"refSections":[{"refs":[{"id":"ref-for-KVStorageArea-backingstore"},{"id":"ref-for-KVStorageArea-backingstore\u2460"}],"title":"3. The KVStorageArea class"},{"refs":[{"id":"ref-for-KVStorageArea-backingstore"},{"id":"ref-for-KVStorageArea-backingstore\u2461"},{"id":"ref-for-KVStorageArea-backingstore\u2462"},{"id":"ref-for-KVStorageArea-backingstore\u2463"}],"title":"3.7. backingStore"}],"url":"#KVStorageArea-backingstore"},
"KVStorageArea-clear": {"dfnID":"KVStorageArea-clear","dfnText":"3.5. clear()","external":false,"refSections":[{"refs":[{"id":"ref-for-KVStorageArea-clear"}],"title":"3. The KVStorageArea class"},{"refs":[{"id":"ref-for-KVStorageArea-clear"},{"id":"ref-for-KVStorageArea-clear\u2460"}],"title":"3.5. clear()"},{"refs":[{"id":"ref-for-KVStorageArea-clear\u2461"},{"id":"ref-for-KVStorageArea-clear\u2462"}],"title":"4. Supporting operations and concepts"}],"url":"#KVStorageArea-clear"},
"KVStorageArea-constructor": {"dfnID":"KVStorageArea-constructor","dfnText":"3.1. constructor(name)","external":false,"refSections":[{"refs":[{"id":"ref-for-KVStorageArea-constructor"}],"title":"3. The KVStorageArea class"},{"refs":[{"id":"ref-for-KVStorageArea-constructor"},{"id":"ref-for-KVStorageArea-constructor\u2460"}],"title":"3.1. constructor(name)"}],"url":"#KVStorageArea-constructor"},
"KVStorageArea-delete": {"dfnID":"KVStorageArea-delete","dfnText":"3.4. delete(key)","external":false,"refSections":[{"refs":[{"id":"ref-for-KVStorageArea-delete"}],"title":"3. The KVStorageArea class"},{"refs":[{"id":"ref-for-KVStorageArea-delete"},{"id":"ref-for-KVStorageArea-delete\u2460"}],"title":"3.4. delete(key)"}],"url":"#KVStorageArea-delete"},
"KVStorageArea-get": {"dfnID":"KVStorageArea-get","dfnText":"3.3. get(key)","external":false,"refSections":[{"refs":[{"id":"ref-for-KVStorageArea-get"}],"title":"3. The KVStorageArea class"},{"refs":[{"id":"ref-for-KVStorageArea-get"},{"id":"ref-for-KVStorageArea-get\u2460"}],"title":"3.3. get(key)"}],"url":"#KVStorageArea-get"},
"KVStorageArea-set": {"dfnID":"KVStorageArea-set","dfnText":"3.2. set(key, value)","external":false,"refSections":[{"refs":[{"id":"ref-for-KVStorageArea-set"}],"title":"3. The KVStorageArea class"},{"refs":[{"id":"ref-for-KVStorageArea-set"},{"id":"ref-for-KVStorageArea-set\u2460"}],"title":"3.2. set(key, value)"},{"refs":[{"id":"ref-for-KVStorageArea-set\u2461"}],"title":"3.4. delete(key)"}],"url":"#KVStorageArea-set"},
"a46ec9f9": {"dfnID":"a46ec9f9","dfnText":"IDBDatabase","external":true,"refSections":[{"refs":[{"id":"ref-for-idbdatabase"}],"title":"3. The KVStorageArea class"},{"refs":[{"id":"ref-for-idbdatabase\u2460"},{"id":"ref-for-idbdatabase\u2461"},{"id":"ref-for-idbdatabase\u2462"},{"id":"ref-for-idbdatabase\u2463"}],"title":"4. Supporting operations and concepts"}],"url":"https://w3c.github.io/IndexedDB/#idbdatabase"},
"a5c91173": {"dfnID":"a5c91173","dfnText":"SameObject","external":true,"refSections":[{"refs":[{"id":"ref-for-SameObject"}],"title":"3. The KVStorageArea class"}],"url":"https://webidl.spec.whatwg.org/#SameObject"},
"a7900362": {"dfnID":"a7900362","dfnText":"include","external":true,"refSections":[{"refs":[{"id":"ref-for-include"},{"id":"ref-for-include\u2460"}],"title":"4. Supporting operations and concepts"}],"url":"https://webidl.spec.whatwg.org/#include"},
"add-a-simple-event-listener": {"dfnID":"add-a-simple-event-listener","dfnText":"add a simple event listener","external":false,"refSections":[{"refs":[{"id":"ref-for-add-a-simple-event-listener"},{"id":"ref-for-add-a-simple-event-listener\u2460"},{"id":"ref-for-add-a-simple-event-listener\u2461"}],"title":"3.2. set(key, value)"},{"refs":[{"id":"ref-for-add-a-simple-event-listener\u2462"},{"id":"ref-for-add-a-simple-event-listener\u2463"}],"title":"3.3. get(key)"},{"refs":[{"id":"ref-for-add-a-simple-event-listener\u2464"},{"id":"ref-for-add-a-simple-event-listener\u2465"},{"id":"ref-for-add-a-simple-event-listener\u2466"}],"title":"3.4. delete(key)"},{"refs":[{"id":"ref-for-add-a-simple-event-listener\u2467"},{"id":"ref-for-add-a-simple-event-listener\u2468"}],"title":"3.5. clear()"},{"refs":[{"id":"ref-for-add-a-simple-event-listener\u2460\u24ea"},{"id":"ref-for-add-a-simple-event-listener\u2460\u2460"},{"id":"ref-for-add-a-simple-event-listener\u2460\u2461"}],"title":"3.6. Iteration"},{"refs":[{"id":"ref-for-add-a-simple-event-listener\u2460\u2462"},{"id":"ref-for-add-a-simple-event-listener\u2460\u2463"},{"id":"ref-for-add-a-simple-event-listener\u2460\u2464"},{"id":"ref-for-add-a-simple-event-listener\u2460\u2465"},{"id":"ref-for-add-a-simple-event-listener\u2460\u2466"}],"title":"4. Supporting operations and concepts"}],"url":"#add-a-simple-event-listener"},
"aef9bb02": {"dfnID":"aef9bb02","dfnText":"ascending","external":true,"refSections":[{"refs":[{"id":"ref-for-greater-than"}],"title":"3.6. Iteration"}],"url":"https://w3c.github.io/IndexedDB/#greater-than"},
"allowed-as-a-key": {"dfnID":"allowed-as-a-key","dfnText":"allowed as a key","external":false,"refSections":[{"refs":[{"id":"ref-for-allowed-as-a-key"}],"title":"3.2. set(key, value)"},{"refs":[{"id":"ref-for-allowed-as-a-key\u2460"}],"title":"3.3. get(key)"},{"refs":[{"id":"ref-for-allowed-as-a-key\u2461"}],"title":"3.4. delete(key)"},{"refs":[{"id":"ref-for-allowed-as-a-key\u2462"},{"id":"ref-for-allowed-as-a-key\u2463"},{"id":"ref-for-allowed-as-a-key\u2464"}],"title":"4. Supporting operations and concepts"}],"url":"#allowed-as-a-key"},
"b107f911": {"dfnID":"b107f911","dfnText":"current Realm","external":true,"refSections":[{"refs":[{"id":"ref-for-current-realm"}],"title":"4. Supporting operations and concepts"}],"url":"https://tc39.github.io/ecma262/#current-realm"},
"b262501e": {"dfnID":"b262501e","dfnText":"reject","external":true,"refSections":[{"refs":[{"id":"ref-for-reject"},{"id":"ref-for-reject\u2460"}],"title":"3.2. set(key, value)"},{"refs":[{"id":"ref-for-reject\u2461"}],"title":"3.3. get(key)"},{"refs":[{"id":"ref-for-reject\u2462"},{"id":"ref-for-reject\u2463"}],"title":"3.4. delete(key)"},{"refs":[{"id":"ref-for-reject\u2464"},{"id":"ref-for-reject\u2465"}],"title":"3.5. clear()"},{"refs":[{"id":"ref-for-reject\u2466"},{"id":"ref-for-reject\u2467"}],"title":"3.6. Iteration"},{"refs":[{"id":"ref-for-reject\u2468"},{"id":"ref-for-reject\u2460\u24ea"},{"id":"ref-for-reject\u2460\u2460"},{"id":"ref-for-reject\u2460\u2461"},{"id":"ref-for-reject\u2460\u2462"}],"title":"4. Supporting operations and concepts"}],"url":"https://webidl.spec.whatwg.org/#reject"},
"b75bb3bd": {"dfnID":"b75bb3bd","dfnText":"SecureContext","external":true,"refSections":[{"refs":[{"id":"ref-for-SecureContext"}],"title":"2. The kvStorage global"},{"refs":[{"id":"ref-for-SecureContext\u2460"}],"title":"3. The KVStorageArea class"}],"url":"https://webidl.spec.whatwg.org/#SecureContext"},
"b7c817bb": {"dfnID":"b7c817bb","dfnText":"objectStore(name)","external":true,"refSections":[{"refs":[{"id":"ref-for-dom-idbtransaction-objectstore"}],"title":"4. Supporting operations and concepts"}],"url":"https://w3c.github.io/IndexedDB/#dom-idbtransaction-objectstore"},
"b8bd9c92": {"dfnID":"b8bd9c92","dfnText":"Storage","external":true,"refSections":[{"refs":[{"id":"ref-for-storage-2"}],"title":"1. Introduction"}],"url":"https://html.spec.whatwg.org/multipage/webstorage.html#storage-2"},
"backingstoreobject": {"dfnID":"backingstoreobject","dfnText":"[[BackingStoreObject]]","external":false,"refSections":[{"refs":[{"id":"ref-for-backingstoreobject"}],"title":"2. The kvStorage global"},{"refs":[{"id":"ref-for-backingstoreobject\u2460"}],"title":"3. The KVStorageArea class"},{"refs":[{"id":"ref-for-backingstoreobject\u2461"}],"title":"3.1. constructor(name)"},{"refs":[{"id":"ref-for-backingstoreobject\u2462"},{"id":"ref-for-backingstoreobject\u2463"},{"id":"ref-for-backingstoreobject\u2464"}],"title":"3.7. backingStore"}],"url":"#backingstoreobject"},
"bb3c1c89": {"dfnID":"bb3c1c89","dfnText":"createObjectStore(name)","external":true,"refSections":[{"refs":[{"id":"ref-for-dom-idbdatabase-createobjectstore"}],"title":"4. Supporting operations and concepts"}],"url":"https://w3c.github.io/IndexedDB/#dom-idbdatabase-createobjectstore"},
"bd42989c": {"dfnID":"bd42989c","dfnText":"convert a value to a key","external":true,"refSections":[{"refs":[{"id":"ref-for-convert-a-value-to-a-key"},{"id":"ref-for-convert-a-value-to-a-key\u2460"}],"title":"4. Supporting operations and concepts"}],"url":"https://w3c.github.io/IndexedDB/#convert-a-value-to-a-key"},
"bdbd19d1": {"dfnID":"bdbd19d1","dfnText":"Promise","external":true,"refSections":[{"refs":[{"id":"ref-for-idl-promise"},{"id":"ref-for-idl-promise\u2460"},{"id":"ref-for-idl-promise\u2461"},{"id":"ref-for-idl-promise\u2462"}],"title":"3. The KVStorageArea class"}],"url":"https://webidl.spec.whatwg.org/#idl-promise"},
"c0cbcc97": {"dfnID":"c0cbcc97","dfnText":"lowerBound(lower, open)","external":true,"refSections":[{"refs":[{"id":"ref-for-dom-idbkeyrange-lowerbound"},{"id":"ref-for-dom-idbkeyrange-lowerbound\u2460"}],"title":"4. Supporting operations and concepts"}],"url":"https://w3c.github.io/IndexedDB/#dom-idbkeyrange-lowerbound"},
"c9258c1d": {"dfnID":"c9258c1d","dfnText":"Type","external":true,"refSections":[{"refs":[{"id":"ref-for-sec-ecmascript-data-types-and-values"}],"title":"4. Supporting operations and concepts"}],"url":"https://tc39.github.io/ecma262/#sec-ecmascript-data-types-and-values"},
"cadf5fe9": {"dfnID":"cadf5fe9","dfnText":"converted to an IDL value","external":true,"refSections":[{"refs":[{"id":"ref-for-dfn-convert-ecmascript-to-idl-value"}],"title":"4. Supporting operations and concepts"}],"url":"https://webidl.spec.whatwg.org/#dfn-convert-ecmascript-to-idl-value"},
"ccf6aba0": {"dfnID":"ccf6aba0","dfnText":"get(query)","external":true,"refSections":[{"refs":[{"id":"ref-for-dom-idbobjectstore-get"}],"title":"3.3. get(key)"},{"refs":[{"id":"ref-for-dom-idbobjectstore-get\u2460"}],"title":"3.6. Iteration"}],"url":"https://w3c.github.io/IndexedDB/#dom-idbobjectstore-get"},
"ce3d2bbb": {"dfnID":"ce3d2bbb","dfnText":"current global object","external":true,"refSections":[{"refs":[{"id":"ref-for-current-global-object"},{"id":"ref-for-current-global-object\u2460"},{"id":"ref-for-current-global-object\u2461"}],"title":"4. Supporting operations and concepts"}],"url":"https://html.spec.whatwg.org/multipage/webappapis.html#current-global-object"},
"check-the-database-schema": {"dfnID":"check-the-database-schema","dfnText":"check the database schema","external":false,"refSections":[{"refs":[{"id":"ref-for-check-the-database-schema"},{"id":"ref-for-check-the-database-schema\u2460"}],"title":"4. Supporting operations and concepts"}],"url":"#check-the-database-schema"},
"current-idbfactory": {"dfnID":"current-idbfactory","dfnText":"current IDBFactory","external":false,"refSections":[{"refs":[{"id":"ref-for-current-idbfactory"}],"title":"3.5. clear()"},{"refs":[{"id":"ref-for-current-idbfactory\u2460"}],"title":"4. Supporting operations and concepts"}],"url":"#current-idbfactory"},
"d0b4a948": {"dfnID":"d0b4a948","dfnText":"a promise rejected with","external":true,"refSections":[{"refs":[{"id":"ref-for-a-promise-rejected-with"}],"title":"3.2. set(key, value)"},{"refs":[{"id":"ref-for-a-promise-rejected-with\u2460"}],"title":"3.3. get(key)"},{"refs":[{"id":"ref-for-a-promise-rejected-with\u2461"}],"title":"3.4. delete(key)"}],"url":"https://webidl.spec.whatwg.org/#a-promise-rejected-with"},
"d30f4c38": {"dfnID":"d30f4c38","dfnText":"EventListener","external":true,"refSections":[{"refs":[{"id":"ref-for-callbackdef-eventlistener"}],"title":"4. Supporting operations and concepts"}],"url":"https://dom.spec.whatwg.org/#callbackdef-eventlistener"},
"d4fcc09d": {"dfnID":"d4fcc09d","dfnText":"close a database connection","external":true,"refSections":[{"refs":[{"id":"ref-for-close-a-database-connection"}],"title":"4. Supporting operations and concepts"}],"url":"https://w3c.github.io/IndexedDB/#close-a-database-connection"},
"d54f5897": {"dfnID":"d54f5897","dfnText":"DataCloneError","external":true,"refSections":[{"refs":[{"id":"ref-for-datacloneerror"}],"title":"3.2. set(key, value)"}],"url":"https://webidl.spec.whatwg.org/#datacloneerror"},
"d8ef5cf9": {"dfnID":"d8ef5cf9","dfnText":"Cache","external":true,"refSections":[{"refs":[{"id":"ref-for-cache"}],"title":"1. Introduction"}],"url":"https://w3c.github.io/ServiceWorker/#cache"},
"d920cf48": {"dfnID":"d920cf48","dfnText":"getKey(query)","external":true,"refSections":[{"refs":[{"id":"ref-for-dom-idbobjectstore-getkey"}],"title":"3.6. Iteration"}],"url":"https://w3c.github.io/IndexedDB/#dom-idbobjectstore-getkey"},
"dacde8b5": {"dfnID":"dacde8b5","dfnText":"a new promise","external":true,"refSections":[{"refs":[{"id":"ref-for-a-new-promise"}],"title":"3.2. set(key, value)"},{"refs":[{"id":"ref-for-a-new-promise\u2460"}],"title":"3.3. get(key)"},{"refs":[{"id":"ref-for-a-new-promise\u2461"}],"title":"3.4. delete(key)"},{"refs":[{"id":"ref-for-a-new-promise\u2462"}],"title":"3.5. clear()"},{"refs":[{"id":"ref-for-a-new-promise\u2463"}],"title":"3.6. Iteration"},{"refs":[{"id":"ref-for-a-new-promise\u2464"}],"title":"4. Supporting operations and concepts"}],"url":"https://webidl.spec.whatwg.org/#a-new-promise"},
"databasename": {"dfnID":"databasename","dfnText":"[[DatabaseName]]","external":false,"refSections":[{"refs":[{"id":"ref-for-databasename"}],"title":"2. The kvStorage global"},{"refs":[{"id":"ref-for-databasename\u2460"}],"title":"3. The KVStorageArea class"},{"refs":[{"id":"ref-for-databasename\u2461"}],"title":"3.1. constructor(name)"},{"refs":[{"id":"ref-for-databasename\u2462"},{"id":"ref-for-databasename\u2463"}],"title":"3.5. clear()"},{"refs":[{"id":"ref-for-databasename\u2464"}],"title":"3.7. backingStore"},{"refs":[{"id":"ref-for-databasename\u2465"},{"id":"ref-for-databasename\u2466"}],"title":"4. Supporting operations and concepts"}],"url":"#databasename"},
"databasepromise": {"dfnID":"databasepromise","dfnText":"[[DatabasePromise]]","external":false,"refSections":[{"refs":[{"id":"ref-for-databasepromise"}],"title":"2. The kvStorage global"},{"refs":[{"id":"ref-for-databasepromise\u2460"}],"title":"3. The KVStorageArea class"},{"refs":[{"id":"ref-for-databasepromise\u2461"}],"title":"3.1. constructor(name)"},{"refs":[{"id":"ref-for-databasepromise\u2462"},{"id":"ref-for-databasepromise\u2463"},{"id":"ref-for-databasepromise\u2464"}],"title":"3.5. clear()"},{"refs":[{"id":"ref-for-databasepromise\u2465"},{"id":"ref-for-databasepromise\u2466"},{"id":"ref-for-databasepromise\u2467"},{"id":"ref-for-databasepromise\u2468"},{"id":"ref-for-databasepromise\u2460\u24ea"},{"id":"ref-for-databasepromise\u2460\u2460"},{"id":"ref-for-databasepromise\u2460\u2461"},{"id":"ref-for-databasepromise\u2460\u2462"},{"id":"ref-for-databasepromise\u2460\u2463"}],"title":"4. Supporting operations and concepts"}],"url":"#databasepromise"},
"db527bc3": {"dfnID":"db527bc3","dfnText":"named properties","external":true,"refSections":[{"refs":[{"id":"ref-for-idl-named-properties"}],"title":"1. Introduction"}],"url":"https://webidl.spec.whatwg.org/#idl-named-properties"},
"dca2de17": {"dfnID":"dca2de17","dfnText":"DOMException","external":true,"refSections":[{"refs":[{"id":"ref-for-idl-DOMException"},{"id":"ref-for-idl-DOMException\u2460"},{"id":"ref-for-idl-DOMException\u2461"}],"title":"3.2. set(key, value)"},{"refs":[{"id":"ref-for-idl-DOMException\u2462"}],"title":"3.3. get(key)"},{"refs":[{"id":"ref-for-idl-DOMException\u2463"}],"title":"3.4. delete(key)"},{"refs":[{"id":"ref-for-idl-DOMException\u2464"}],"title":"4. Supporting operations and concepts"}],"url":"https://webidl.spec.whatwg.org/#idl-DOMException"},
"default-kv-storage-area": {"dfnID":"default-kv-storage-area","dfnText":"default KV Storage area","external":false,"refSections":[{"refs":[{"id":"ref-for-default-kv-storage-area"}],"title":"2. The kvStorage global"}],"url":"#default-kv-storage-area"},
"deleting-the-database": {"dfnID":"deleting-the-database","dfnText":"delete the database","external":false,"refSections":[{"refs":[{"id":"ref-for-deleting-the-database"},{"id":"ref-for-deleting-the-database\u2460"}],"title":"3.5. clear()"}],"url":"#deleting-the-database"},
"dom-kvstoragearea-delete-key-key": {"dfnID":"dom-kvstoragearea-delete-key-key","dfnText":"key","external":false,"refSections":[],"url":"#dom-kvstoragearea-delete-key-key"},
"dom-kvstoragearea-entries": {"dfnID":"dom-kvstoragearea-entries","dfnText":"entries()","external":false,"refSections":[{"refs":[{"id":"ref-for-dom-kvstoragearea-entries"}],"title":"4. Supporting operations and concepts"}],"url":"#dom-kvstoragearea-entries"},
"dom-kvstoragearea-get-key-key": {"dfnID":"dom-kvstoragearea-get-key-key","dfnText":"key","external":false,"refSections":[],"url":"#dom-kvstoragearea-get-key-key"},
"dom-kvstoragearea-keys": {"dfnID":"dom-kvstoragearea-keys","dfnText":"keys()","external":false,"refSections":[{"refs":[{"id":"ref-for-dom-kvstoragearea-keys"},{"id":"ref-for-dom-kvstoragearea-keys\u2460"},{"id":"ref-for-dom-kvstoragearea-keys\u2461"},{"id":"ref-for-dom-kvstoragearea-keys\u2462"}],"title":"3.6. Iteration"},{"refs":[{"id":"ref-for-dom-kvstoragearea-keys\u2463"}],"title":"4. Supporting operations and concepts"}],"url":"#dom-kvstoragearea-keys"},
"dom-kvstoragearea-kvstoragearea-name-name": {"dfnID":"dom-kvstoragearea-kvstoragearea-name-name","dfnText":"name","external":false,"refSections":[],"url":"#dom-kvstoragearea-kvstoragearea-name-name"},
"dom-kvstoragearea-set-key-value-key": {"dfnID":"dom-kvstoragearea-set-key-value-key","dfnText":"key","external":false,"refSections":[],"url":"#dom-kvstoragearea-set-key-value-key"},
"dom-kvstoragearea-set-key-value-value": {"dfnID":"dom-kvstoragearea-set-key-value-value","dfnText":"value","external":false,"refSections":[],"url":"#dom-kvstoragearea-set-key-value-value"},
"dom-kvstoragearea-values": {"dfnID":"dom-kvstoragearea-values","dfnText":"values()","external":false,"refSections":[],"url":"#dom-kvstoragearea-values"},
"dom-windoworworkerglobalscope-kvstorage": {"dfnID":"dom-windoworworkerglobalscope-kvstorage","dfnText":"kvStorage","external":false,"refSections":[{"refs":[{"id":"ref-for-dom-windoworworkerglobalscope-kvstorage"},{"id":"ref-for-dom-windoworworkerglobalscope-kvstorage\u2460"},{"id":"ref-for-dom-windoworworkerglobalscope-kvstorage\u2461"}],"title":"2. The kvStorage global"}],"url":"#dom-windoworworkerglobalscope-kvstorage"},
"e7652812": {"dfnID":"e7652812","dfnText":"get the next iteration result","external":true,"refSections":[{"refs":[{"id":"ref-for-dfn-get-the-next-iteration-result"}],"title":"3.6. Iteration"}],"url":"https://webidl.spec.whatwg.org/#dfn-get-the-next-iteration-result"},
"e806d5a8": {"dfnID":"e806d5a8","dfnText":"Headers","external":true,"refSections":[{"refs":[{"id":"ref-for-headers"}],"title":"1. Introduction"}],"url":"https://fetch.spec.whatwg.org/#headers"},
"efd1ec5d": {"dfnID":"efd1ec5d","dfnText":"object","external":true,"refSections":[{"refs":[{"id":"ref-for-idl-object"}],"title":"3. The KVStorageArea class"}],"url":"https://webidl.spec.whatwg.org/#idl-object"},
"f045e088": {"dfnID":"f045e088","dfnText":"key path","external":true,"refSections":[{"refs":[{"id":"ref-for-object-store-key-path"}],"title":"4. Supporting operations and concepts"}],"url":"https://w3c.github.io/IndexedDB/#object-store-key-path"},
"f35ddfe3": {"dfnID":"f35ddfe3","dfnText":"object store set","external":true,"refSections":[{"refs":[{"id":"ref-for-connection-object-store-set"}],"title":"4. Supporting operations and concepts"}],"url":"https://w3c.github.io/IndexedDB/#connection-object-store-set"},
"f40d5e6c": {"dfnID":"f40d5e6c","dfnText":"error (for transaction)","external":true,"refSections":[{"refs":[{"id":"ref-for-transaction-error"},{"id":"ref-for-transaction-error\u2460"}],"title":"3.2. set(key, value)"},{"refs":[{"id":"ref-for-transaction-error\u2461"},{"id":"ref-for-transaction-error\u2462"}],"title":"3.4. delete(key)"}],"url":"https://w3c.github.io/IndexedDB/#transaction-error"},
"f534ab0c": {"dfnID":"f534ab0c","dfnText":"StructuredSerializeForStorage","external":true,"refSections":[{"refs":[{"id":"ref-for-structuredserializeforstorage"}],"title":"3.2. set(key, value)"},{"refs":[{"id":"ref-for-structuredserializeforstorage\u2460"}],"title":"4. Supporting operations and concepts"}],"url":"https://html.spec.whatwg.org/multipage/structured-data.html#structuredserializeforstorage"},
"ff414e52": {"dfnID":"ff414e52","dfnText":"open(name)","external":true,"refSections":[{"refs":[{"id":"ref-for-dom-idbfactory-open"}],"title":"4. Supporting operations and concepts"}],"url":"https://w3c.github.io/IndexedDB/#dom-idbfactory-open"},
"get-the-range-for-a-key": {"dfnID":"get-the-range-for-a-key","dfnText":"get the range for a key","external":false,"refSections":[{"refs":[{"id":"ref-for-get-the-range-for-a-key"}],"title":"3.6. Iteration"},{"refs":[{"id":"ref-for-get-the-range-for-a-key\u2460"}],"title":"4. Supporting operations and concepts"}],"url":"#get-the-range-for-a-key"},
"initialize-the-database-promise": {"dfnID":"initialize-the-database-promise","dfnText":"initialize the database promise","external":false,"refSections":[{"refs":[{"id":"ref-for-initialize-the-database-promise"},{"id":"ref-for-initialize-the-database-promise\u2460"}],"title":"4. Supporting operations and concepts"}],"url":"#initialize-the-database-promise"},
"key-round-trip": {"dfnID":"key-round-trip","dfnText":"Key round-tripping","external":false,"refSections":[{"refs":[{"id":"ref-for-key-round-trip"},{"id":"ref-for-key-round-trip\u2460"}],"title":"3.6. Iteration"},{"refs":[{"id":"ref-for-key-round-trip\u2461"},{"id":"ref-for-key-round-trip\u2462"}],"title":"4. Supporting operations and concepts"}],"url":"#key-round-trip"},
"kvstorageareaasynciterator-last-key": {"dfnID":"kvstorageareaasynciterator-last-key","dfnText":"last key","external":false,"refSections":[{"refs":[{"id":"ref-for-kvstorageareaasynciterator-last-key"},{"id":"ref-for-kvstorageareaasynciterator-last-key\u2460"}],"title":"3.6. Iteration"}],"url":"#kvstorageareaasynciterator-last-key"},
"not-yet-started": {"dfnID":"not-yet-started","dfnText":"not yet started","external":false,"refSections":[{"refs":[{"id":"ref-for-not-yet-started"}],"title":"3.6. Iteration"},{"refs":[{"id":"ref-for-not-yet-started\u2460"}],"title":"4. Supporting operations and concepts"}],"url":"#not-yet-started"},
"performing-a-database-operation": {"dfnID":"performing-a-database-operation","dfnText":"perform a database operation","external":false,"refSections":[{"refs":[{"id":"ref-for-performing-a-database-operation"}],"title":"3. The KVStorageArea class"},{"refs":[{"id":"ref-for-performing-a-database-operation\u2460"}],"title":"3.2. set(key, value)"},{"refs":[{"id":"ref-for-performing-a-database-operation\u2461"}],"title":"3.3. get(key)"},{"refs":[{"id":"ref-for-performing-a-database-operation\u2462"}],"title":"3.4. delete(key)"},{"refs":[{"id":"ref-for-performing-a-database-operation\u2463"}],"title":"3.6. Iteration"},{"refs":[{"id":"ref-for-performing-a-database-operation\u2464"}],"title":"4. Supporting operations and concepts"}],"url":"#performing-a-database-operation"},
};

document.addEventListener("DOMContentLoaded", ()=>{
    genAllDfnPanels();

    document.body.addEventListener("click", (e) => {
        // If not handled already, just hide all dfn panels.
        hideAllDfnPanels();
    });
});

window.addEventListener("resize", () => {
    // Pin any visible dfn panel
    queryAll(".dfn-panel.on, .dfn-panel.activated").forEach(el=>positionDfnPanel(el));
});

function genAllDfnPanels() {
    for(const panelData of Object.values(dfnPanelData)) {
        const dfnID = panelData.dfnID;
        const dfn = document.getElementById(dfnID);
        if(!dfn) {
            console.log(`Can't find dfn#${dfnID}.`, panelData);
            continue;
        }
        dfn.panelData = panelData;
        insertDfnPopupAction(dfn);
    }
}

function genDfnPanel(dfn, { dfnID, url, dfnText, refSections, external }) {
    const dfnPanel = mk.aside({
        class: "dfn-panel on",
        id: `infopanel-for-${dfnID}`,
        "data-for": dfnID,
        "aria-labelled-by":`infopaneltitle-for-${dfnID}`,
        },
        mk.span({id:`infopaneltitle-for-${dfnID}`, style:"display:none"},
            `Info about the '${dfnText}' ${external?"external":""} reference.`),
        mk.a({href:url, class:"dfn-link"}, url),
        refSections.length == 0 ? [] :
            mk.b({}, "Referenced in:"),
            mk.ul({},
                ...refSections.map(section=>
                    mk.li({},
                        ...section.refs.map((ref, refI)=>
                            [
                                mk.a({ href: `#${ref.id}` },
                                    (refI == 0) ? section.title : `(${refI + 1})`
                                ),
                                " ",
                            ]
                        ),
                    ),
                ),
            ),
        genLinkingSyntaxes(dfn),
    );

    dfnPanel.addEventListener('click', (event) => {
        if (event.target.nodeName == 'A') {
            scrollToTargetAndHighlight(event);
            pinDfnPanel(dfnPanel);
        }
        event.stopPropagation();
        refocusOnTarget(event);
    });
    dfnPanel.addEventListener('keydown', (event) => {
        if(event.keyCode == 27) { // Escape key
            hideDfnPanel({dfnPanel});
            event.stopPropagation();
            event.preventDefault();
        }
    });

    dfnPanel.dfn = dfn;
    dfn.dfnPanel = dfnPanel;
    return dfnPanel;
}



function hideAllDfnPanels() {
    // Delete the currently-active dfn panel.
    queryAll(".dfn-panel").forEach(dfnPanel=>hideDfnPanel({dfnPanel}));
}

function showDfnPanel(dfn) {
    hideAllDfnPanels(); // Only display one at a time.

    dfn.setAttribute("aria-expanded", "true");

    const dfnPanel = genDfnPanel(dfn, dfn.panelData);

    // Give the dfn a unique tabindex, and then
    // give all the tabbable panel bits successive indexes.
    let tabIndex = 100;
    dfn.tabIndex = tabIndex++;
    const tabbable = dfnPanel.querySelectorAll(":is(a, button)");
    for (const el of tabbable) {
        el.tabIndex = tabIndex++;
    }

    append(document.body, dfnPanel);
    positionDfnPanel(dfnPanel);
}

function positionDfnPanel(dfnPanel) {
    const dfn = dfnPanel.dfn;
    const dfnPos = getBounds(dfn);
    dfnPanel.style.top = dfnPos.bottom + "px";
    dfnPanel.style.left = dfnPos.left + "px";

    const panelPos = dfnPanel.getBoundingClientRect();
    const panelMargin = 8;
    const maxRight = document.body.parentNode.clientWidth - panelMargin;
    if (panelPos.right > maxRight) {
        const overflowAmount = panelPos.right - maxRight;
        const newLeft = Math.max(panelMargin, dfnPos.left - overflowAmount);
        dfnPanel.style.left = newLeft + "px";
    }
}

function pinDfnPanel(dfnPanel) {
    // Switch it to "activated" state, which pins it.
    dfnPanel.classList.add("activated");
    dfnPanel.style.position = "fixed";
    dfnPanel.style.left = null;
    dfnPanel.style.top = null;
}

function hideDfnPanel({dfn, dfnPanel}) {
    if(!dfnPanel) dfnPanel = dfn.dfnPanel;
    if(!dfn) dfn = dfnPanel.dfn;
    dfn.dfnPanel = undefined;
    dfnPanel.dfn = undefined;
    dfn.setAttribute("aria-expanded", "false");
    dfn.tabIndex = undefined;
    dfnPanel.remove()
}

function toggleDfnPanel(dfn) {
    if(dfn.dfnPanel) {
        hideDfnPanel(dfn);
    } else {
        showDfnPanel(dfn);
    }
}

function insertDfnPopupAction(dfn) {
    dfn.setAttribute('role', 'button');
    dfn.setAttribute('aria-expanded', 'false')
    dfn.tabIndex = 0;
    dfn.classList.add('has-dfn-panel');
    dfn.addEventListener('click', (event) => {
        toggleDfnPanel(dfn);
        event.stopPropagation();
    });
    dfn.addEventListener('keypress', (event) => {
        const kc = event.keyCode;
        // 32->Space, 13->Enter
        if(kc == 32 || kc == 13) {
            toggleDfnPanel(dfn);
            event.stopPropagation();
            event.preventDefault();
        }
    });
}

function refocusOnTarget(event) {
    const target = event.target;
    setTimeout(() => {
        // Refocus on the event.target element.
        // This is needed after browser scrolls to the destination.
        target.focus();
    });
}

// TODO: shared util
// Returns the root-level absolute position {left and top} of element.
function getBounds(el, relativeTo=document.body) {
    const relativeRect = relativeTo.getBoundingClientRect();
    const elRect = el.getBoundingClientRect();
    const top = elRect.top - relativeRect.top;
    const left = elRect.left - relativeRect.left;
    return {
        top,
        left,
        bottom: top + elRect.height,
        right: left + elRect.width,
    }
}

function scrollToTargetAndHighlight(event) {
    let hash = event.target.hash;
    if (hash) {
        hash = decodeURIComponent(hash.substring(1));
        const dest = document.getElementById(hash);
        if (dest) {
            dest.classList.add('highlighted');
            setTimeout(() => dest.classList.remove('highlighted'), 1000);
        }
    }
}

// Functions, divided by link type, that wrap an autolink's
// contents with the appropriate outer syntax.
// Alternately, a string naming another type they format
// the same as.
function needsFor(type) {
    switch(type) {
        case "descriptor":
        case "value":
        case "element-attr":
        case "attr-value":
        case "element-state":
        case "method":
        case "constructor":
        case "argument":
        case "attribute":
        case "const":
        case "dict-member":
        case "event":
        case "enum-value":
        case "stringifier":
        case "serializer":
        case "iterator":
        case "maplike":
        case "setlike":
        case "state":
        case "mode":
        case "context":
        case "facet": return true;

        default: return false;
    }
}
function refusesFor(type) {
    switch(type) {
        case "property":
        case "element":
        case "interface":
        case "namespace":
        case "callback":
        case "dictionary":
        case "enum":
        case "exception":
        case "typedef":
        case "http-header":
        case "permission": return true;

        default: return false;
    }
}
function linkFormatterFromType(type) {
    switch(type) {
        case 'scheme':
        case 'permission':
        case 'dfn': return (text) => `[=${text}=]`;

        case 'abstract-op': return (text) => `[\$${text}\$]`;

        case 'function':
        case 'at-rule':
        case 'selector':
        case 'value': return (text) => `''${text}''`;

        case 'http-header': return (text) => `[:${text}:]`;

        case 'interface':
        case 'constructor':
        case 'method':
        case 'argument':
        case 'attribute':
        case 'callback':
        case 'dictionary':
        case 'dict-member':
        case 'enum':
        case 'enum-value':
        case 'exception':
        case 'const':
        case 'typedef':
        case 'stringifier':
        case 'serializer':
        case 'iterator':
        case 'maplike':
        case 'setlike':
        case 'extended-attribute':
        case 'event':
        case 'idl': return (text) => `{{${text}}}`;

        case 'element-state':
        case 'element-attr':
        case 'attr-value':
        case 'element': return (element) => `<{${element}}>`;

        case 'grammar': return (text) => `${text} (within a <pre class=prod>)`;

        case 'type': return (text)=> `<<${text}>>`;

        case 'descriptor':
        case 'property': return (text) => `'${text}'`;

        default: return;
    };
};

function genLinkingSyntaxes(dfn) {
    if(dfn.tagName != "DFN") return;

    const type = dfn.getAttribute('data-dfn-type');
    if(!type) {
        console.log(`<dfn> doesn't have a data-dfn-type:`, dfn);
        return [];
    }

    // Return a function that wraps link text based on the type
    const linkFormatter = linkFormatterFromType(type);
    if(!linkFormatter) {
        console.log(`<dfn> has an unknown data-dfn-type:`, dfn);
        return [];
    }

    let ltAlts;
    if(dfn.hasAttribute('data-lt')) {
        ltAlts = dfn.getAttribute('data-lt')
            .split("|")
            .map(x=>x.trim());
    } else {
        ltAlts = [dfn.textContent.trim()];
    }
    if(type == "type") {
        // lt of "<foo>", but "foo" is the interior;
        // <<foo/bar>> is how you write it with a for,
        // not <foo/<bar>> or whatever.
        for(var i = 0; i < ltAlts.length; i++) {
            const lt = ltAlts[i];
            const match = /<(.*)>/.exec(lt);
            if(match) { ltAlts[i] = match[1]; }
        }
    }

    let forAlts;
    if(dfn.hasAttribute('data-dfn-for')) {
        forAlts = dfn.getAttribute('data-dfn-for')
            .split(",")
            .map(x=>x.trim());
    } else {
        forAlts = [''];
    }

    let linkingSyntaxes = [];
    if(!needsFor(type)) {
        for(const lt of ltAlts) {
            linkingSyntaxes.push(linkFormatter(lt));
        }
    }
    if(!refusesFor(type)) {
        for(const f of forAlts) {
            linkingSyntaxes.push(linkFormatter(`${f}/${ltAlts[0]}`))
        }
    }
    return [
        mk.b({}, 'Possible linking syntaxes:'),
        mk.ul({},
            ...linkingSyntaxes.map(link => {
                const copyLink = async () =>
                    await navigator.clipboard.writeText(link);
                return mk.li({},
                    mk.div({ class: 'link-item' },
                        mk.button({
                            class: 'copy-icon', title: 'Copy',
                            type: 'button',
                            _onclick: copyLink,
                            tabindex: 0,
                        }, mk.span({ class: 'icon' }) ),
                        mk.span({}, link)
                    )
                );
            })
        )
    ];
}
}
</script>
<script>/* Boilerplate: script-ref-hints */
"use strict";
{
let refsData = {
"#KVStorageArea": {"displayText":"KVStorageArea","export":true,"for_":[],"level":"1","normative":true,"shortname":"kv-storage","spec":"kv-storage-1","status":"local","text":"KVStorageArea","type":"interface","url":"#KVStorageArea"},
"#KVStorageArea-backingstore": {"displayText":"backingStore","export":true,"for_":["KVStorageArea"],"level":"1","normative":true,"shortname":"kv-storage","spec":"kv-storage-1","status":"local","text":"backingStore","type":"attribute","url":"#KVStorageArea-backingstore"},
"#KVStorageArea-clear": {"displayText":"clear()","export":true,"for_":["KVStorageArea"],"level":"1","normative":true,"shortname":"kv-storage","spec":"kv-storage-1","status":"local","text":"clear()","type":"method","url":"#KVStorageArea-clear"},
"#KVStorageArea-constructor": {"displayText":"constructor(name)","export":true,"for_":["KVStorageArea"],"level":"1","normative":true,"shortname":"kv-storage","spec":"kv-storage-1","status":"local","text":"constructor(name)","type":"constructor","url":"#KVStorageArea-constructor"},
"#KVStorageArea-delete": {"displayText":"delete(key)","export":true,"for_":["KVStorageArea"],"level":"1","normative":true,"shortname":"kv-storage","spec":"kv-storage-1","status":"local","text":"delete(key)","type":"method","url":"#KVStorageArea-delete"},
"#KVStorageArea-get": {"displayText":"get(key)","export":true,"for_":["KVStorageArea"],"level":"1","normative":true,"shortname":"kv-storage","spec":"kv-storage-1","status":"local","text":"get(key)","type":"method","url":"#KVStorageArea-get"},
"#KVStorageArea-set": {"displayText":"set(key, value)","export":true,"for_":["KVStorageArea"],"level":"1","normative":true,"shortname":"kv-storage","spec":"kv-storage-1","status":"local","text":"set(key, value)","type":"method","url":"#KVStorageArea-set"},
"#add-a-simple-event-listener": {"displayText":"add a simple event listener","export":true,"for_":[],"level":"1","normative":true,"shortname":"kv-storage","spec":"kv-storage-1","status":"local","text":"add a simple event listener","type":"dfn","url":"#add-a-simple-event-listener"},
"#allowed-as-a-key": {"displayText":"allowed as a key","export":true,"for_":[],"level":"1","normative":true,"shortname":"kv-storage","spec":"kv-storage-1","status":"local","text":"allowed as a key","type":"dfn","url":"#allowed-as-a-key"},
"#backingstoreobject": {"displayText":"[[backingstoreobject]]","export":true,"for_":[],"level":"1","normative":true,"shortname":"kv-storage","spec":"kv-storage-1","status":"local","text":"[[backingstoreobject]]","type":"dfn","url":"#backingstoreobject"},
"#check-the-database-schema": {"displayText":"check the database schema","export":true,"for_":[],"level":"1","normative":true,"shortname":"kv-storage","spec":"kv-storage-1","status":"local","text":"check the database schema","type":"dfn","url":"#check-the-database-schema"},
"#current-idbfactory": {"displayText":"current idbfactory","export":true,"for_":[],"level":"1","normative":true,"shortname":"kv-storage","spec":"kv-storage-1","status":"local","text":"current idbfactory","type":"dfn","url":"#current-idbfactory"},
"#databasename": {"displayText":"[[databasename]]","export":true,"for_":[],"level":"1","normative":true,"shortname":"kv-storage","spec":"kv-storage-1","status":"local","text":"[[databasename]]","type":"dfn","url":"#databasename"},
"#databasepromise": {"displayText":"[[databasepromise]]","export":true,"for_":[],"level":"1","normative":true,"shortname":"kv-storage","spec":"kv-storage-1","status":"local","text":"[[databasepromise]]","type":"dfn","url":"#databasepromise"},
"#default-kv-storage-area": {"displayText":"default kv storage area","export":true,"for_":[],"level":"1","normative":true,"shortname":"kv-storage","spec":"kv-storage-1","status":"local","text":"default kv storage area","type":"dfn","url":"#default-kv-storage-area"},
"#deleting-the-database": {"displayText":"deleting the database","export":true,"for_":[],"level":"1","normative":true,"shortname":"kv-storage","spec":"kv-storage-1","status":"local","text":"deleting the database","type":"dfn","url":"#deleting-the-database"},
"#dom-kvstoragearea-entries": {"displayText":"entries()","export":true,"for_":["KVStorageArea"],"level":"1","normative":true,"shortname":"kv-storage","spec":"kv-storage-1","status":"local","text":"entries()","type":"method","url":"#dom-kvstoragearea-entries"},
"#dom-kvstoragearea-keys": {"displayText":"keys()","export":true,"for_":["KVStorageArea"],"level":"1","normative":true,"shortname":"kv-storage","spec":"kv-storage-1","status":"local","text":"keys()","type":"method","url":"#dom-kvstoragearea-keys"},
"#dom-windoworworkerglobalscope-kvstorage": {"displayText":"kvStorage","export":true,"for_":["WindowOrWorkerGlobalScope"],"level":"1","normative":true,"shortname":"kv-storage","spec":"kv-storage-1","status":"local","text":"kvStorage","type":"attribute","url":"#dom-windoworworkerglobalscope-kvstorage"},
"#get-the-range-for-a-key": {"displayText":"getting the range for","export":true,"for_":[],"level":"1","normative":true,"shortname":"kv-storage","spec":"kv-storage-1","status":"local","text":"getting the range for","type":"dfn","url":"#get-the-range-for-a-key"},
"#initialize-the-database-promise": {"displayText":"initialize the database promise","export":true,"for_":[],"level":"1","normative":true,"shortname":"kv-storage","spec":"kv-storage-1","status":"local","text":"initialize the database promise","type":"dfn","url":"#initialize-the-database-promise"},
"#key-round-trip": {"displayText":"key round-trip","export":true,"for_":[],"level":"1","normative":true,"shortname":"kv-storage","spec":"kv-storage-1","status":"local","text":"key round-trip","type":"dfn","url":"#key-round-trip"},
"#kvstorageareaasynciterator-last-key": {"displayText":"last key","export":true,"for_":["KVStorageAreaAsyncIterator"],"level":"1","normative":true,"shortname":"kv-storage","spec":"kv-storage-1","status":"local","text":"last key","type":"dfn","url":"#kvstorageareaasynciterator-last-key"},
"#not-yet-started": {"displayText":"not yet started","export":true,"for_":[],"level":"1","normative":true,"shortname":"kv-storage","spec":"kv-storage-1","status":"local","text":"not yet started","type":"dfn","url":"#not-yet-started"},
"#performing-a-database-operation": {"displayText":"perform a database operation","export":true,"for_":[],"level":"1","normative":true,"shortname":"kv-storage","spec":"kv-storage-1","status":"local","text":"perform a database operation","type":"dfn","url":"#performing-a-database-operation"},
"https://dom.spec.whatwg.org/#callbackdef-eventlistener": {"displayText":"EventListener","export":true,"for_":[],"level":"1","normative":true,"shortname":"dom","spec":"dom","status":"current","text":"EventListener","type":"callback","url":"https://dom.spec.whatwg.org/#callbackdef-eventlistener"},
"https://dom.spec.whatwg.org/#dom-eventtarget-addeventlistener": {"displayText":"addEventListener(type, callback)","export":true,"for_":["EventTarget"],"level":"1","normative":true,"shortname":"dom","spec":"dom","status":"current","text":"addEventListener(type, callback)","type":"method","url":"https://dom.spec.whatwg.org/#dom-eventtarget-addeventlistener"},
"https://dom.spec.whatwg.org/#eventtarget": {"displayText":"EventTarget","export":true,"for_":[],"level":"1","normative":true,"shortname":"dom","spec":"dom","status":"current","text":"EventTarget","type":"interface","url":"https://dom.spec.whatwg.org/#eventtarget"},
"https://fetch.spec.whatwg.org/#headers": {"displayText":"Headers","export":true,"for_":[],"level":"1","normative":true,"shortname":"fetch","spec":"fetch","status":"current","text":"Headers","type":"interface","url":"https://fetch.spec.whatwg.org/#headers"},
"https://html.spec.whatwg.org/multipage/structured-data.html#structureddeserialize": {"displayText":"StructuredDeserialize","export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"StructuredDeserialize","type":"abstract-op","url":"https://html.spec.whatwg.org/multipage/structured-data.html#structureddeserialize"},
"https://html.spec.whatwg.org/multipage/structured-data.html#structuredserializeforstorage": {"displayText":"StructuredSerializeForStorage","export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"StructuredSerializeForStorage","type":"abstract-op","url":"https://html.spec.whatwg.org/multipage/structured-data.html#structuredserializeforstorage"},
"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm": {"displayText":"relevant realm","export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"relevant realm","type":"dfn","url":"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm"},
"https://html.spec.whatwg.org/multipage/webappapis.html#current-global-object": {"displayText":"current global object","export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"current global object","type":"dfn","url":"https://html.spec.whatwg.org/multipage/webappapis.html#current-global-object"},
"https://html.spec.whatwg.org/multipage/webappapis.html#secure-context": {"displayText":"secure context","export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"secure context","type":"dfn","url":"https://html.spec.whatwg.org/multipage/webappapis.html#secure-context"},
"https://html.spec.whatwg.org/multipage/webappapis.html#windoworworkerglobalscope": {"displayText":"WindowOrWorkerGlobalScope","export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"WindowOrWorkerGlobalScope","type":"interface","url":"https://html.spec.whatwg.org/multipage/webappapis.html#windoworworkerglobalscope"},
"https://html.spec.whatwg.org/multipage/webstorage.html#dom-localstorage": {"displayText":"localStorage","export":true,"for_":["Window"],"level":"","normative":true,"shortname":"html","spec":"html","status":"anchor-block","text":"localStorage","type":"attribute","url":"https://html.spec.whatwg.org/multipage/webstorage.html#dom-localstorage"},
"https://html.spec.whatwg.org/multipage/webstorage.html#storage-2": {"displayText":"Storage","export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"Storage","type":"interface","url":"https://html.spec.whatwg.org/multipage/webstorage.html#storage-2"},
"https://infra.spec.whatwg.org/#list-size": {"displayText":"size","export":true,"for_":["list","stack","queue","set"],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"size","type":"dfn","url":"https://infra.spec.whatwg.org/#list-size"},
"https://tc39.github.io/ecma262/#current-realm": {"displayText":"current Realm","export":true,"for_":[],"level":"","normative":true,"shortname":"ecmascript","spec":"ecmascript","status":"anchor-block","text":"current realm","type":"dfn","url":"https://tc39.github.io/ecma262/#current-realm"},
"https://tc39.github.io/ecma262/#realm-record": {"displayText":"Realm","export":true,"for_":[],"level":"","normative":true,"shortname":"ecmascript","spec":"ecmascript","status":"anchor-block","text":"realm","type":"dfn","url":"https://tc39.github.io/ecma262/#realm-record"},
"https://tc39.github.io/ecma262/#sec-createdataproperty": {"displayText":"CreateDataProperty","export":true,"for_":[],"level":"","normative":true,"shortname":"ecmascript","spec":"ecmascript","status":"anchor-block","text":"CreateDataProperty","type":"abstract-op","url":"https://tc39.github.io/ecma262/#sec-createdataproperty"},
"https://tc39.github.io/ecma262/#sec-date-objects": {"displayText":"Date","export":true,"for_":[],"level":"","normative":true,"shortname":"ecmascript","spec":"ecmascript","status":"anchor-block","text":"Date","type":"interface","url":"https://tc39.github.io/ecma262/#sec-date-objects"},
"https://tc39.github.io/ecma262/#sec-ecmascript-data-types-and-values": {"displayText":"Type","export":true,"for_":[],"level":"","normative":true,"shortname":"ecmascript","spec":"ecmascript","status":"anchor-block","text":"Type","type":"abstract-op","url":"https://tc39.github.io/ecma262/#sec-ecmascript-data-types-and-values"},
"https://tc39.github.io/ecma262/#sec-isarray": {"displayText":"IsArray","export":true,"for_":[],"level":"","normative":true,"shortname":"ecmascript","spec":"ecmascript","status":"anchor-block","text":"IsArray","type":"abstract-op","url":"https://tc39.github.io/ecma262/#sec-isarray"},
"https://tc39.github.io/ecma262/#sec-map-objects": {"displayText":"Map","export":true,"for_":[],"level":"","normative":true,"shortname":"ecmascript","spec":"ecmascript","status":"anchor-block","text":"Map","type":"interface","url":"https://tc39.github.io/ecma262/#sec-map-objects"},
"https://tc39.github.io/ecma262/#sec-objectcreate": {"displayText":"ObjectCreate","export":true,"for_":[],"level":"","normative":true,"shortname":"ecmascript","spec":"ecmascript","status":"anchor-block","text":"ObjectCreate","type":"abstract-op","url":"https://tc39.github.io/ecma262/#sec-objectcreate"},
"https://tc39.github.io/ecma262/#sec-properties-of-the-object-prototype-object": {"displayText":"%ObjectPrototype%","export":true,"for_":[],"level":"","normative":true,"shortname":"ecmascript","spec":"ecmascript","status":"anchor-block","text":"%ObjectPrototype%","type":"interface","url":"https://tc39.github.io/ecma262/#sec-properties-of-the-object-prototype-object"},
"https://tc39.github.io/ecma262/#sec-setintegritylevel": {"displayText":"SetIntegrityLevel","export":true,"for_":[],"level":"","normative":true,"shortname":"ecmascript","spec":"ecmascript","status":"anchor-block","text":"SetIntegrityLevel","type":"abstract-op","url":"https://tc39.github.io/ecma262/#sec-setintegritylevel"},
"https://tc39.github.io/ecma262/#sec-typedarray-objects": {"displayText":"typed array","export":true,"for_":[],"level":"","normative":true,"shortname":"ecmascript","spec":"ecmascript","status":"anchor-block","text":"typed array","type":"dfn","url":"https://tc39.github.io/ecma262/#sec-typedarray-objects"},
"https://w3c.github.io/IndexedDB/#close-a-database-connection": {"displayText":"close a database connection","export":true,"for_":[],"level":"2","normative":true,"shortname":"indexeddb","spec":"indexeddb-2","status":"anchor-block","text":"close a database connection","type":"dfn","url":"https://w3c.github.io/IndexedDB/#close-a-database-connection"},
"https://w3c.github.io/IndexedDB/#connection": {"displayText":"connection","export":true,"for_":["database"],"level":"2","normative":true,"shortname":"indexeddb","spec":"indexeddb-2","status":"anchor-block","text":"connection","type":"dfn","url":"https://w3c.github.io/IndexedDB/#connection"},
"https://w3c.github.io/IndexedDB/#connection-object-store-set": {"displayText":"object store set","export":true,"for_":["connection"],"level":"2","normative":true,"shortname":"indexeddb","spec":"indexeddb-2","status":"anchor-block","text":"object store set","type":"dfn","url":"https://w3c.github.io/IndexedDB/#connection-object-store-set"},
"https://w3c.github.io/IndexedDB/#convert-a-key-to-a-value": {"displayText":"convert a key to a value","export":true,"for_":[],"level":"2","normative":true,"shortname":"indexeddb","spec":"indexeddb-2","status":"anchor-block","text":"convert a key to a value","type":"dfn","url":"https://w3c.github.io/IndexedDB/#convert-a-key-to-a-value"},
"https://w3c.github.io/IndexedDB/#convert-a-value-to-a-key": {"displayText":"convert a value to a key","export":true,"for_":[],"level":"2","normative":true,"shortname":"indexeddb","spec":"indexeddb-2","status":"anchor-block","text":"convert a value to a key","type":"dfn","url":"https://w3c.github.io/IndexedDB/#convert-a-value-to-a-key"},
"https://w3c.github.io/IndexedDB/#dom-idbdatabase-close": {"displayText":"close()","export":true,"for_":["IDBDatabase"],"level":"3","normative":true,"shortname":"indexeddb","spec":"indexeddb-3","status":"current","text":"close()","type":"method","url":"https://w3c.github.io/IndexedDB/#dom-idbdatabase-close"},
"https://w3c.github.io/IndexedDB/#dom-idbdatabase-createobjectstore": {"displayText":"createObjectStore(name)","export":true,"for_":["IDBDatabase"],"level":"3","normative":true,"shortname":"indexeddb","spec":"indexeddb-3","status":"current","text":"createObjectStore(name)","type":"method","url":"https://w3c.github.io/IndexedDB/#dom-idbdatabase-createobjectstore"},
"https://w3c.github.io/IndexedDB/#dom-idbdatabase-transaction": {"displayText":"transaction(storeNames)","export":true,"for_":["IDBDatabase"],"level":"3","normative":true,"shortname":"indexeddb","spec":"indexeddb-3","status":"current","text":"transaction(storeNames)","type":"method","url":"https://w3c.github.io/IndexedDB/#dom-idbdatabase-transaction"},
"https://w3c.github.io/IndexedDB/#dom-idbfactory-deletedatabase": {"displayText":"deleteDatabase(name)","export":true,"for_":["IDBFactory"],"level":"3","normative":true,"shortname":"indexeddb","spec":"indexeddb-3","status":"current","text":"deleteDatabase(name)","type":"method","url":"https://w3c.github.io/IndexedDB/#dom-idbfactory-deletedatabase"},
"https://w3c.github.io/IndexedDB/#dom-idbfactory-open": {"displayText":"open(name)","export":true,"for_":["IDBFactory"],"level":"3","normative":true,"shortname":"indexeddb","spec":"indexeddb-3","status":"current","text":"open(name)","type":"method","url":"https://w3c.github.io/IndexedDB/#dom-idbfactory-open"},
"https://w3c.github.io/IndexedDB/#dom-idbkeyrange-lowerbound": {"displayText":"lowerBound(lower)","export":true,"for_":["IDBKeyRange"],"level":"3","normative":true,"shortname":"indexeddb","spec":"indexeddb-3","status":"current","text":"lowerBound(lower)","type":"method","url":"https://w3c.github.io/IndexedDB/#dom-idbkeyrange-lowerbound"},
"https://w3c.github.io/IndexedDB/#dom-idbobjectstore-delete": {"displayText":"delete(query)","export":true,"for_":["IDBObjectStore"],"level":"3","normative":true,"shortname":"indexeddb","spec":"indexeddb-3","status":"current","text":"delete(query)","type":"method","url":"https://w3c.github.io/IndexedDB/#dom-idbobjectstore-delete"},
"https://w3c.github.io/IndexedDB/#dom-idbobjectstore-get": {"displayText":"get(query)","export":true,"for_":["IDBObjectStore"],"level":"3","normative":true,"shortname":"indexeddb","spec":"indexeddb-3","status":"current","text":"get(query)","type":"method","url":"https://w3c.github.io/IndexedDB/#dom-idbobjectstore-get"},
"https://w3c.github.io/IndexedDB/#dom-idbobjectstore-getkey": {"displayText":"getKey(query)","export":true,"for_":["IDBObjectStore"],"level":"3","normative":true,"shortname":"indexeddb","spec":"indexeddb-3","status":"current","text":"getKey(query)","type":"method","url":"https://w3c.github.io/IndexedDB/#dom-idbobjectstore-getkey"},
"https://w3c.github.io/IndexedDB/#dom-idbobjectstore-put": {"displayText":"put(value)","export":true,"for_":["IDBObjectStore"],"level":"3","normative":true,"shortname":"indexeddb","spec":"indexeddb-3","status":"current","text":"put(value)","type":"method","url":"https://w3c.github.io/IndexedDB/#dom-idbobjectstore-put"},
"https://w3c.github.io/IndexedDB/#dom-idbtransaction-objectstore": {"displayText":"objectStore(name)","export":true,"for_":["IDBTransaction"],"level":"3","normative":true,"shortname":"indexeddb","spec":"indexeddb-3","status":"current","text":"objectStore(name)","type":"method","url":"https://w3c.github.io/IndexedDB/#dom-idbtransaction-objectstore"},
"https://w3c.github.io/IndexedDB/#dom-windoworworkerglobalscope-indexeddb": {"displayText":"indexedDB","export":true,"for_":["WindowOrWorkerGlobalScope"],"level":"3","normative":true,"shortname":"indexeddb","spec":"indexeddb-3","status":"current","text":"indexedDB","type":"attribute","url":"https://w3c.github.io/IndexedDB/#dom-windoworworkerglobalscope-indexeddb"},
"https://w3c.github.io/IndexedDB/#greater-than": {"displayText":"ascending","export":true,"for_":["key"],"level":"2","normative":true,"shortname":"indexeddb","spec":"indexeddb-2","status":"anchor-block","text":"ascending","type":"dfn","url":"https://w3c.github.io/IndexedDB/#greater-than"},
"https://w3c.github.io/IndexedDB/#idbdatabase": {"displayText":"IDBDatabase","export":true,"for_":[],"level":"3","normative":true,"shortname":"indexeddb","spec":"indexeddb-3","status":"current","text":"IDBDatabase","type":"interface","url":"https://w3c.github.io/IndexedDB/#idbdatabase"},
"https://w3c.github.io/IndexedDB/#idbfactory": {"displayText":"IDBFactory","export":true,"for_":[],"level":"3","normative":true,"shortname":"indexeddb","spec":"indexeddb-3","status":"current","text":"IDBFactory","type":"interface","url":"https://w3c.github.io/IndexedDB/#idbfactory"},
"https://w3c.github.io/IndexedDB/#idbkeyrange": {"displayText":"IDBKeyRange","export":true,"for_":[],"level":"3","normative":true,"shortname":"indexeddb","spec":"indexeddb-3","status":"current","text":"IDBKeyRange","type":"interface","url":"https://w3c.github.io/IndexedDB/#idbkeyrange"},
"https://w3c.github.io/IndexedDB/#idbobjectstore": {"displayText":"IDBObjectStore","export":true,"for_":[],"level":"3","normative":true,"shortname":"indexeddb","spec":"indexeddb-3","status":"current","text":"IDBObjectStore","type":"interface","url":"https://w3c.github.io/IndexedDB/#idbobjectstore"},
"https://w3c.github.io/IndexedDB/#idbtransaction": {"displayText":"IDBTransaction","export":true,"for_":[],"level":"3","normative":true,"shortname":"indexeddb","spec":"indexeddb-3","status":"current","text":"IDBTransaction","type":"interface","url":"https://w3c.github.io/IndexedDB/#idbtransaction"},
"https://w3c.github.io/IndexedDB/#index-concept": {"displayText":"index","export":true,"for_":[],"level":"2","normative":true,"shortname":"indexeddb","spec":"indexeddb-2","status":"anchor-block","text":"index","type":"dfn","url":"https://w3c.github.io/IndexedDB/#index-concept"},
"https://w3c.github.io/IndexedDB/#key-generator": {"displayText":"key generator","export":true,"for_":["object store"],"level":"2","normative":true,"shortname":"indexeddb","spec":"indexeddb-2","status":"anchor-block","text":"key generator","type":"dfn","url":"https://w3c.github.io/IndexedDB/#key-generator"},
"https://w3c.github.io/IndexedDB/#object-store-key-path": {"displayText":"key path","export":true,"for_":["object store"],"level":"2","normative":true,"shortname":"indexeddb","spec":"indexeddb-2","status":"anchor-block","text":"key path","type":"dfn","url":"https://w3c.github.io/IndexedDB/#object-store-key-path"},
"https://w3c.github.io/IndexedDB/#object-store-name": {"displayText":"name","export":true,"for_":["object store"],"level":"2","normative":true,"shortname":"indexeddb","spec":"indexeddb-2","status":"anchor-block","text":"name","type":"dfn","url":"https://w3c.github.io/IndexedDB/#object-store-name"},
"https://w3c.github.io/IndexedDB/#request-error": {"displayText":"error","export":true,"for_":["request"],"level":"2","normative":true,"shortname":"indexeddb","spec":"indexeddb-2","status":"anchor-block","text":"error","type":"dfn","url":"https://w3c.github.io/IndexedDB/#request-error"},
"https://w3c.github.io/IndexedDB/#request-result": {"displayText":"result","export":true,"for_":["request"],"level":"2","normative":true,"shortname":"indexeddb","spec":"indexeddb-2","status":"anchor-block","text":"result","type":"dfn","url":"https://w3c.github.io/IndexedDB/#request-result"},
"https://w3c.github.io/IndexedDB/#transaction-concept": {"displayText":"transaction","export":true,"for_":[],"level":"2","normative":true,"shortname":"indexeddb","spec":"indexeddb-2","status":"anchor-block","text":"transaction","type":"dfn","url":"https://w3c.github.io/IndexedDB/#transaction-concept"},
"https://w3c.github.io/IndexedDB/#transaction-error": {"displayText":"error","export":true,"for_":["transaction"],"level":"2","normative":true,"shortname":"indexeddb","spec":"indexeddb-2","status":"anchor-block","text":"error","type":"dfn","url":"https://w3c.github.io/IndexedDB/#transaction-error"},
"https://w3c.github.io/IndexedDB/#unbounded-key-range": {"displayText":"unbounded key range","export":true,"for_":[],"level":"2","normative":true,"shortname":"indexeddb","spec":"indexeddb-2","status":"anchor-block","text":"unbounded key range","type":"dfn","url":"https://w3c.github.io/IndexedDB/#unbounded-key-range"},
"https://w3c.github.io/ServiceWorker/#cache": {"displayText":"Cache","export":true,"for_":[],"level":"1","normative":true,"shortname":"service-workers","spec":"service-workers","status":"current","text":"Cache","type":"interface","url":"https://w3c.github.io/ServiceWorker/#cache"},
"https://webidl.spec.whatwg.org/#Exposed": {"displayText":"Exposed","export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"Exposed","type":"extended-attribute","url":"https://webidl.spec.whatwg.org/#Exposed"},
"https://webidl.spec.whatwg.org/#SameObject": {"displayText":"SameObject","export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"SameObject","type":"extended-attribute","url":"https://webidl.spec.whatwg.org/#SameObject"},
"https://webidl.spec.whatwg.org/#SecureContext": {"displayText":"SecureContext","export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"SecureContext","type":"extended-attribute","url":"https://webidl.spec.whatwg.org/#SecureContext"},
"https://webidl.spec.whatwg.org/#a-new-promise": {"displayText":"a new promise","export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"a new promise","type":"dfn","url":"https://webidl.spec.whatwg.org/#a-new-promise"},
"https://webidl.spec.whatwg.org/#a-promise-rejected-with": {"displayText":"a promise rejected with","export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"a promise rejected with","type":"dfn","url":"https://webidl.spec.whatwg.org/#a-promise-rejected-with"},
"https://webidl.spec.whatwg.org/#asynchronous-iterator-initialization-steps": {"displayText":"asynchronous iterator initialization steps","export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"asynchronous iterator initialization steps","type":"dfn","url":"https://webidl.spec.whatwg.org/#asynchronous-iterator-initialization-steps"},
"https://webidl.spec.whatwg.org/#datacloneerror": {"displayText":"DataCloneError","export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"DataCloneError","type":"exception","url":"https://webidl.spec.whatwg.org/#datacloneerror"},
"https://webidl.spec.whatwg.org/#dataerror": {"displayText":"DataError","export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"DataError","type":"exception","url":"https://webidl.spec.whatwg.org/#dataerror"},
"https://webidl.spec.whatwg.org/#dfn-convert-ecmascript-to-idl-value": {"displayText":"converted to an IDL value","export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"converted to an idl value","type":"dfn","url":"https://webidl.spec.whatwg.org/#dfn-convert-ecmascript-to-idl-value"},
"https://webidl.spec.whatwg.org/#dfn-get-the-next-iteration-result": {"displayText":"get the next iteration result","export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"get the next iteration result","type":"dfn","url":"https://webidl.spec.whatwg.org/#dfn-get-the-next-iteration-result"},
"https://webidl.spec.whatwg.org/#dfn-perform-steps-once-promise-is-settled": {"displayText":"reacting","export":true,"for_":["promise"],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"reacting","type":"dfn","url":"https://webidl.spec.whatwg.org/#dfn-perform-steps-once-promise-is-settled"},
"https://webidl.spec.whatwg.org/#exceptiondef-typeerror": {"displayText":"TypeError","export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"TypeError","type":"exception","url":"https://webidl.spec.whatwg.org/#exceptiondef-typeerror"},
"https://webidl.spec.whatwg.org/#idl-ArrayBuffer": {"displayText":"ArrayBuffer","export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"ArrayBuffer","type":"interface","url":"https://webidl.spec.whatwg.org/#idl-ArrayBuffer"},
"https://webidl.spec.whatwg.org/#idl-DOMException": {"displayText":"DOMException","export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"DOMException","type":"interface","url":"https://webidl.spec.whatwg.org/#idl-DOMException"},
"https://webidl.spec.whatwg.org/#idl-DOMString": {"displayText":"DOMString","export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"DOMString","type":"interface","url":"https://webidl.spec.whatwg.org/#idl-DOMString"},
"https://webidl.spec.whatwg.org/#idl-DataView": {"displayText":"DataView","export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"DataView","type":"interface","url":"https://webidl.spec.whatwg.org/#idl-DataView"},
"https://webidl.spec.whatwg.org/#idl-any": {"displayText":"any","export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"any","type":"interface","url":"https://webidl.spec.whatwg.org/#idl-any"},
"https://webidl.spec.whatwg.org/#idl-named-properties": {"displayText":"named properties","export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"named properties","type":"dfn","url":"https://webidl.spec.whatwg.org/#idl-named-properties"},
"https://webidl.spec.whatwg.org/#idl-object": {"displayText":"object","export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"object","type":"interface","url":"https://webidl.spec.whatwg.org/#idl-object"},
"https://webidl.spec.whatwg.org/#idl-promise": {"displayText":"Promise","export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"Promise","type":"interface","url":"https://webidl.spec.whatwg.org/#idl-promise"},
"https://webidl.spec.whatwg.org/#include": {"displayText":"include","export":true,"for_":["interface"],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"include","type":"dfn","url":"https://webidl.spec.whatwg.org/#include"},
"https://webidl.spec.whatwg.org/#invalidstateerror": {"displayText":"InvalidStateError","export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"InvalidStateError","type":"exception","url":"https://webidl.spec.whatwg.org/#invalidstateerror"},
"https://webidl.spec.whatwg.org/#reject": {"displayText":"reject","export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"reject","type":"dfn","url":"https://webidl.spec.whatwg.org/#reject"},
"https://webidl.spec.whatwg.org/#resolve": {"displayText":"resolve","export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"resolve","type":"dfn","url":"https://webidl.spec.whatwg.org/#resolve"},
"https://webidl.spec.whatwg.org/#this": {"displayText":"this","export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"this","type":"dfn","url":"https://webidl.spec.whatwg.org/#this"},
};

function mkRefHint(link, ref) {
    const linkText = link.textContent;
    let dfnTextElements = '';
    if (ref.displayText.toLowerCase() != linkText.toLowerCase()) {
        // Give the original term if it's being displayed in a different way.
        // But allow casing differences, they're insignificant.
        dfnTextElements =
            mk.li({},
                mk.b({}, "Term: "),
                mk.span({}, ref.displayText)
            );
    }
    const forList = ref.for_;
    let forListElements;
    if(forList.length == 0) {
        forListElements = [];
    } else if(forList.length == 1) {
        forListElements = mk.li({},
            mk.b({}, "For: "),
            mk.span({}, forList[0]),
        );
    } else {
        forListElements = mk.li({},
            mk.b({}, "For: "),
            mk.ul({},
                ...forList.map(forItem =>
                    mk.li({},
                        mk.span({}, forItem)
                    ),
                ),
            ),
        );
    }
    const url = ref.url;
    const safeUrl = encodeURIComponent(url);
    const hintPanel = mk.aside({
        class: "ref-hint",
        id: `ref-hint-for-${safeUrl}`,
        "data-for": url,
        "aria-labelled-by": `ref-hint-for-${safeUrl}`,
    },
        mk.ul({},
            dfnTextElements,
            mk.li({},
                mk.b({}, "URL: "),
                mk.a({ href: url, class: "ref" }, url),
            ),
            mk.li({},
                mk.b({}, "Type: "),
                mk.span({}, `${ref.type}`),
            ),
            mk.li({},
                mk.b({}, "Spec: "),
                mk.span({}, `${ref.spec ? ref.spec : ''}`),
            ),
            forListElements
        ),
    );
    hintPanel.forLink = link;
    setupRefHintEventListeners(link, hintPanel);
    return hintPanel;
}

function hideAllRefHints() {
    queryAll(".ref-hint").forEach(el=>hideRefHint(el));
}

function hideRefHint(refHint) {
    const link = refHint.forLink;
    link.setAttribute("aria-expanded", "false");
    if(refHint.teardownEventListeners) {
        refHint.teardownEventListeners();
    }
    refHint.remove();
}

function showRefHint(link) {
    if(link.classList.contains("dfn-link")) return;
    const url = link.getAttribute("href");
    const ref = refsData[url];
    if(!ref) return;

    hideAllRefHints(); // Only display one at this time.

    const refHint = mkRefHint(link, ref);
    append(document.body, refHint);
    link.setAttribute("aria-expanded", "true");
    positionRefHint(refHint);
}

function setupRefHintEventListeners(link, refHint) {
    if (refHint.teardownEventListeners) return;
    // Add event handlers to hide the refHint after the user moves away
    // from both the link and refHint, if not hovering either within one second.
    let timeout = null;
    const startHidingRefHint = (event) => {
        if (timeout) {
            clearTimeout(timeout);
        }
        timeout = setTimeout(() => {
            hideRefHint(refHint);
        }, 1000);
    }
    const resetHidingRefHint = (event) => {
        if (timeout) clearTimeout(timeout);
        timeout = null;
    };
    link.addEventListener("mouseleave", startHidingRefHint);
    link.addEventListener("mouseenter", resetHidingRefHint);
    link.addEventListener("blur", startHidingRefHint);
    link.addEventListener("focus", resetHidingRefHint);
    refHint.addEventListener("mouseleave", startHidingRefHint);
    refHint.addEventListener("mouseenter", resetHidingRefHint);
    refHint.addEventListener("blur", startHidingRefHint);
    refHint.addEventListener("focus", resetHidingRefHint);

    refHint.teardownEventListeners = () => {
        // remove event listeners
        resetHidingRefHint();
        link.removeEventListener("mouseleave", startHidingRefHint);
        link.removeEventListener("mouseenter", resetHidingRefHint);
        link.removeEventListener("blur", startHidingRefHint);
        link.removeEventListener("focus", resetHidingRefHint);
        refHint.removeEventListener("mouseleave", startHidingRefHint);
        refHint.removeEventListener("mouseenter", resetHidingRefHint);
        refHint.removeEventListener("blur", startHidingRefHint);
        refHint.removeEventListener("focus", resetHidingRefHint);
    };
}

function positionRefHint(refHint) {
    const link = refHint.forLink;
    const linkPos = getBounds(link);
    refHint.style.top = linkPos.bottom + "px";
    refHint.style.left = linkPos.left + "px";

    const panelPos = refHint.getBoundingClientRect();
    const panelMargin = 8;
    const maxRight = document.body.parentNode.clientWidth - panelMargin;
    if (panelPos.right > maxRight) {
        const overflowAmount = panelPos.right - maxRight;
        const newLeft = Math.max(panelMargin, linkPos.left - overflowAmount);
        refHint.style.left = newLeft + "px";
    }
}

// TODO: shared util
// Returns the root-level absolute position {left and top} of element.
function getBounds(el, relativeTo=document.body) {
    const relativeRect = relativeTo.getBoundingClientRect();
    const elRect = el.getBoundingClientRect();
    const top = elRect.top - relativeRect.top;
    const left = elRect.left - relativeRect.left;
    return {
        top,
        left,
        bottom: top + elRect.height,
        right: left + elRect.width,
    }
}

function showRefHintListener(e) {
    // If the target isn't in a link (or is a link),
    // just ignore it.
    let link = e.target.closest("a");
    if(!link) return;

    // If the target is in a ref-hint panel
    // (aka a link in the already-open one),
    // also just ignore it.
    if(link.closest(".ref-hint")) return;

    // Otherwise, show the panel for the link.
    showRefHint(link);
}

function hideAllHintsListener(e) {
    // If the click is inside a ref-hint panel, ignore it.
    if(e.target.closest(".ref-hint")) return;
    // Otherwise, close all the current panels.
    hideAllRefHints();
}

document.addEventListener("DOMContentLoaded", () => {
    document.body.addEventListener("mousedown", showRefHintListener);
    document.body.addEventListener("focus", showRefHintListener);

    document.body.addEventListener("click", hideAllHintsListener);
});

window.addEventListener("resize", () => {
    // Hide any open ref hint.
    hideAllRefHints();
});
}
</script>
<script>/* Boilerplate: script-var-click-highlighting */
"use strict";
{
/*
Color-choosing design:

* Colors are ordered by goodness.
* On clicking a var, give it the earliest color
    with the lowest usage in the algorithm.
* On re-clicking, re-use the var's most recent color
    if that's not currently being used elsewhere.
*/

const COLOR_COUNT = 7;

document.addEventListener("click", e=>{
    if(e.target.nodeName == "VAR") {
        highlightSameAlgoVars(e.target);
    }
});

function highlightSameAlgoVars(v) {
    // Find the algorithm container.
    let algoContainer = findAlgoContainer(v);

    // Not highlighting document-global vars,
    // too likely to be unrelated.
    if(algoContainer == null) return;

    const varName = nameFromVar(v);
    if(!v.hasAttribute("data-var-color")) {
        const newColor = chooseHighlightColor(algoContainer, v);
        for(const el of algoContainer.querySelectorAll("var")) {
            if(nameFromVar(el) == varName) {
                el.setAttribute("data-var-color", newColor);
                el.setAttribute("data-var-last-color", newColor);
            }
        }
    } else {
        for(const el of algoContainer.querySelectorAll("var")) {
            if(nameFromVar(el) == varName) {
                el.removeAttribute("data-var-color");
            }
        }
    }
}
function findAlgoContainer(el) {
    while(el != document.body) {
        if(el.hasAttribute("data-algorithm")) return el;
        el = el.parentNode;
    }
    return null;
}
function nameFromVar(el) {
    return el.textContent.replace(/(\s|\xa0)+/g, " ").trim();
}
function colorCountsFromContainer(container) {
    const namesFromColor = Array.from({length:COLOR_COUNT}, x=>new Set());
    for(let v of container.querySelectorAll("var[data-var-color]")) {
        let color = +v.getAttribute("data-var-color");
        namesFromColor[color].add(nameFromVar(v));
    }

    return namesFromColor.map(x=>x.size);
}
function leastUsedColor(colors) {
    // Find the earliest color with the lowest count.
    let minCount = Infinity;
    let minColor = null;
    for(var i = 0; i < colors.length; i++) {
        if(colors[i] < minCount) {
            minColor = i;
            minCount = colors[i];
        }
    }
    return minColor;
}
function chooseHighlightColor(container, v) {
    const colorCounts = colorCountsFromContainer(container);
    if(v.hasAttribute("data-var-last-color")) {
        let color = +v.getAttribute("data-var-last-color");
        if(colorCounts[color] == 0) return color;
    }
    return leastUsedColor(colorCounts);
}
}
</script>