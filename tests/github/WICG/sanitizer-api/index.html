<!doctype html><html lang="en">
 <head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
  <title>HTML Sanitizer API</title>
  <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
  <link href="https://www.w3.org/StyleSheets/TR/2021/cg-draft" rel="stylesheet">
  <link href="https://wicg.github.io/sanitizer-api/" rel="canonical">
  <meta content="dark light" name="color-scheme">
  <link href="https://www.w3.org/StyleSheets/TR/2021/dark.css" media="(prefers-color-scheme: dark)" rel="stylesheet" type="text/css">
<style>/* Boilerplate: style-autolinks */
.css.css, .property.property, .descriptor.descriptor {
    color: var(--a-normal-text);
    font-size: inherit;
    font-family: inherit;
}
.css::before, .property::before, .descriptor::before {
    content: "‘";
}
.css::after, .property::after, .descriptor::after {
    content: "’";
}
.property, .descriptor {
    /* Don't wrap property and descriptor names */
    white-space: nowrap;
}
.type { /* CSS value <type> */
    font-style: italic;
}
pre .property::before, pre .property::after {
    content: "";
}
[data-link-type="property"]::before,
[data-link-type="propdesc"]::before,
[data-link-type="descriptor"]::before,
[data-link-type="value"]::before,
[data-link-type="function"]::before,
[data-link-type="at-rule"]::before,
[data-link-type="selector"]::before,
[data-link-type="maybe"]::before {
    content: "‘";
}
[data-link-type="property"]::after,
[data-link-type="propdesc"]::after,
[data-link-type="descriptor"]::after,
[data-link-type="value"]::after,
[data-link-type="function"]::after,
[data-link-type="at-rule"]::after,
[data-link-type="selector"]::after,
[data-link-type="maybe"]::after {
    content: "’";
}

[data-link-type].production::before,
[data-link-type].production::after,
.prod [data-link-type]::before,
.prod [data-link-type]::after {
    content: "";
}

[data-link-type=element],
[data-link-type=element-attr] {
    font-family: Menlo, Consolas, "DejaVu Sans Mono", monospace;
    font-size: .9em;
}
[data-link-type=element]::before { content: "<" }
[data-link-type=element]::after  { content: ">" }

[data-link-type=biblio] {
    white-space: pre;
}

@media (prefers-color-scheme: dark) {
    :root {
        --selflink-text: black;
        --selflink-bg: silver;
        --selflink-hover-text: white;
    }
}
</style>
<style>/* Boilerplate: style-colors */
/* Any --*-text not paired with a --*-bg is assumed to have a transparent bg */
:root {
    color-scheme: light dark;

    --text: black;
    --bg: white;

    --unofficial-watermark: url(https://www.w3.org/StyleSheets/TR/2016/logos/UD-watermark);

    --logo-bg: #1a5e9a;
    --logo-active-bg: #c00;
    --logo-text: white;

    --tocnav-normal-text: #707070;
    --tocnav-normal-bg: var(--bg);
    --tocnav-hover-text: var(--tocnav-normal-text);
    --tocnav-hover-bg: #f8f8f8;
    --tocnav-active-text: #c00;
    --tocnav-active-bg: var(--tocnav-normal-bg);

    --tocsidebar-text: var(--text);
    --tocsidebar-bg: #f7f8f9;
    --tocsidebar-shadow: rgba(0,0,0,.1);
    --tocsidebar-heading-text: hsla(203,20%,40%,.7);

    --toclink-text: var(--text);
    --toclink-underline: #3980b5;
    --toclink-visited-text: var(--toclink-text);
    --toclink-visited-underline: #054572;

    --heading-text: #005a9c;

    --hr-text: var(--text);

    --algo-border: #def;

    --del-text: red;
    --del-bg: transparent;
    --ins-text: #080;
    --ins-bg: transparent;

    --a-normal-text: #034575;
    --a-normal-underline: #bbb;
    --a-visited-text: var(--a-normal-text);
    --a-visited-underline: #707070;
    --a-hover-bg: rgba(75%, 75%, 75%, .25);
    --a-active-text: #c00;
    --a-active-underline: #c00;

    --blockquote-border: silver;
    --blockquote-bg: transparent;
    --blockquote-text: currentcolor;

    --issue-border: #e05252;
    --issue-bg: #fbe9e9;
    --issue-text: var(--text);
    --issueheading-text: #831616;

    --example-border: #e0cb52;
    --example-bg: #fcfaee;
    --example-text: var(--text);
    --exampleheading-text: #574b0f;

    --note-border: #52e052;
    --note-bg: #e9fbe9;
    --note-text: var(--text);
    --noteheading-text: hsl(120, 70%, 30%);
    --notesummary-underline: silver;

    --assertion-border: #aaa;
    --assertion-bg: #eee;
    --assertion-text: black;

    --advisement-border: orange;
    --advisement-bg: #fec;
    --advisement-text: var(--text);
    --advisementheading-text: #b35f00;

    --warning-border: red;
    --warning-bg: hsla(40,100%,50%,0.95);
    --warning-text: var(--text);

    --amendment-border: #330099;
    --amendment-bg: #F5F0FF;
    --amendment-text: var(--text);
    --amendmentheading-text: #220066;

    --def-border: #8ccbf2;
    --def-bg: #def;
    --def-text: var(--text);
    --defrow-border: #bbd7e9;

    --datacell-border: silver;

    --indexinfo-text: #707070;

    --indextable-hover-text: black;
    --indextable-hover-bg: #f7f8f9;

    --outdatedspec-bg: rgba(0, 0, 0, .5);
    --outdatedspec-text: black;
    --outdated-bg: maroon;
    --outdated-text: white;
    --outdated-shadow: red;

    --editedrec-bg: darkorange;
}

@media (prefers-color-scheme: dark) {
    :root {
        --text: #ddd;
        --bg: black;

        --unofficial-watermark: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='400'%3E%3Cg fill='%23100808' transform='translate(200 200) rotate(-45) translate(-200 -200)' stroke='%23100808' stroke-width='3'%3E%3Ctext x='50%25' y='220' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EUNOFFICIAL%3C/text%3E%3Ctext x='50%25' y='305' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EDRAFT%3C/text%3E%3C/g%3E%3C/svg%3E");

        --logo-bg: #1a5e9a;
        --logo-active-bg: #c00;
        --logo-text: white;

        --tocnav-normal-text: #999;
        --tocnav-normal-bg: var(--bg);
        --tocnav-hover-text: var(--tocnav-normal-text);
        --tocnav-hover-bg: #080808;
        --tocnav-active-text: #f44;
        --tocnav-active-bg: var(--tocnav-normal-bg);

        --tocsidebar-text: var(--text);
        --tocsidebar-bg: #080808;
        --tocsidebar-shadow: rgba(255,255,255,.1);
        --tocsidebar-heading-text: hsla(203,20%,40%,.7);

        --toclink-text: var(--text);
        --toclink-underline: #6af;
        --toclink-visited-text: var(--toclink-text);
        --toclink-visited-underline: #054572;

        --heading-text: #8af;

        --hr-text: var(--text);

        --algo-border: #456;

        --del-text: #f44;
        --del-bg: transparent;
        --ins-text: #4a4;
        --ins-bg: transparent;

        --a-normal-text: #6af;
        --a-normal-underline: #555;
        --a-visited-text: var(--a-normal-text);
        --a-visited-underline: var(--a-normal-underline);
        --a-hover-bg: rgba(25%, 25%, 25%, .2);
        --a-active-text: #f44;
        --a-active-underline: var(--a-active-text);

        --borderedblock-bg: rgba(255, 255, 255, .05);

        --blockquote-border: silver;
        --blockquote-bg: var(--borderedblock-bg);
        --blockquote-text: currentcolor;

        --issue-border: #e05252;
        --issue-bg: var(--borderedblock-bg);
        --issue-text: var(--text);
        --issueheading-text: hsl(0deg, 70%, 70%);

        --example-border: hsl(50deg, 90%, 60%);
        --example-bg: var(--borderedblock-bg);
        --example-text: var(--text);
        --exampleheading-text: hsl(50deg, 70%, 70%);

        --note-border: hsl(120deg, 100%, 35%);
        --note-bg: var(--borderedblock-bg);
        --note-text: var(--text);
        --noteheading-text: hsl(120, 70%, 70%);
        --notesummary-underline: silver;

        --assertion-border: #444;
        --assertion-bg: var(--borderedblock-bg);
        --assertion-text: var(--text);

        --advisement-border: orange;
        --advisement-bg: #222218;
        --advisement-text: var(--text);
        --advisementheading-text: #f84;

        --warning-border: red;
        --warning-bg: hsla(40,100%,20%,0.95);
        --warning-text: var(--text);

        --amendment-border: #330099;
        --amendment-bg: #080010;
        --amendment-text: var(--text);
        --amendmentheading-text: #cc00ff;

        --def-border: #8ccbf2;
        --def-bg: #080818;
        --def-text: var(--text);
        --defrow-border: #136;

        --datacell-border: silver;

        --indexinfo-text: #aaa;

        --indextable-hover-text: var(--text);
        --indextable-hover-bg: #181818;

        --outdatedspec-bg: rgba(255, 255, 255, .5);
        --outdatedspec-text: black;
        --outdated-bg: maroon;
        --outdated-text: white;
        --outdated-shadow: red;

        --editedrec-bg: darkorange;
    }
    /* In case a transparent-bg image doesn't expect to be on a dark bg,
       which is quite common in practice... */
    img { background: white; }
}
</style>
<style>/* Boilerplate: style-counters */
body {
    counter-reset: example figure issue;
}
.issue {
    counter-increment: issue;
}
.issue:not(.no-marker)::before {
    content: "Issue " counter(issue);
}

.example {
    counter-increment: example;
}
.example:not(.no-marker)::before {
    content: "Example " counter(example);
}
.invalid.example:not(.no-marker)::before,
.illegal.example:not(.no-marker)::before {
    content: "Invalid Example" counter(example);
}

figcaption {
    counter-increment: figure;
}
figcaption:not(.no-marker)::before {
    content: "Figure " counter(figure) " ";
}
</style>
<style>/* Boilerplate: style-dfn-panel */
:root {
    --dfnpanel-bg: #ddd;
    --dfnpanel-text: var(--text);
    --dfnpanel-target-bg: #ffc;
    --dfnpanel-target-outline: orange;
}
@media (prefers-color-scheme: dark) {
    :root {
        --dfnpanel-bg: #222;
        --dfnpanel-text: var(--text);
        --dfnpanel-target-bg: #333;
        --dfnpanel-target-outline: silver;
    }
}
.dfn-panel {
    position: absolute;
    z-index: 35;
    width: 20em;
    width: 300px;
    height: auto;
    max-height: 500px;
    overflow: auto;
    padding: 0.5em 0.75em;
    font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
    background: var(--dfnpanel-bg);
    color: var(--dfnpanel-text);
    border: outset 0.2em;
    white-space: normal; /* in case it's moved into a pre */
}
.dfn-panel:not(.on) { display: none; }
.dfn-panel * { margin: 0; padding: 0; text-indent: 0; }
.dfn-panel > b { display: block; }
.dfn-panel a { color: var(--dfnpanel-text); }
.dfn-panel a:not(:hover) { text-decoration: none !important; border-bottom: none !important; }
.dfn-panel a:focus {
    outline: 5px auto Highlight;
    outline: 5px auto -webkit-focus-ring-color;
}
.dfn-panel > b + b { margin-top: 0.25em; }
.dfn-panel ul { padding: 0 0 0 1em; list-style: none; }
.dfn-panel li a {
    max-width: calc(300px - 1.5em - 1em);
    overflow: hidden;
    text-overflow: ellipsis;
}

.dfn-panel.activated {
    display: inline-block;
    position: fixed;
    left: 8px;
    bottom: 2em;
    margin: 0 auto;
    max-width: calc(100vw - 1.5em - .4em - .5em);
    max-height: 30vh;
    transition: left 1s ease-out, bottom 1s ease-out;
}

.dfn-panel .link-item:hover {
    text-decoration: underline;
}
.dfn-panel .link-item .copy-icon {
    opacity: 0;
}
.dfn-panel .link-item:hover .copy-icon,
.dfn-panel .link-item .copy-icon:focus {
    opacity: 1;
}

.dfn-panel .copy-icon {
    display: inline-block;
    margin-right: 0.5em;
    width: 0.85em;
    height: 1em;
    border-radius: 3px;
    background-color: #ccc;
    cursor: pointer;
}

.dfn-panel .copy-icon .icon {
    width: 100%;
    height: 100%;
    background-color: #fff;
    display: flex;
    justify-content: center;
    align-items: center;
    position: relative;
}

.dfn-panel .copy-icon .icon::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    border: 1px solid black;
    background-color: #ccc;
    opacity: 0.25;
    transform: translate(3px, -3px);
}

.dfn-panel .copy-icon:active .icon::before {
    opacity: 1;
}

.dfn-paneled[role="button"] { cursor: help; }

.highlighted {
    animation: target-fade 3s;
}

@keyframes target-fade {
    from {
        background-color: var(--dfnpanel-target-bg);
        outline: 5px solid var(--dfnpanel-target-outline);
    }
    to {
        color: var(--a-normal-text);
        background-color: transparent;
        outline: transparent;
    }
}
</style>
<style>/* Boilerplate: style-idl-highlighting */
pre.idl.highlight {
    background: var(--borderedblock-bg, var(--def-bg));
}
</style>
<style>/* Boilerplate: style-issues */
a[href].issue-return {
    float: right;
    float: inline-end;
    color: var(--issueheading-text);
    font-weight: bold;
    text-decoration: none;
}
</style>
<style>/* Boilerplate: style-md-lists */
/* This is a weird hack for me not yet following the commonmark spec
   regarding paragraph and lists. */
[data-md] > :first-child {
    margin-top: 0;
}
[data-md] > :last-child {
    margin-bottom: 0;
}
</style>
<style>/* Boilerplate: style-ref-hints */
:root {
    --ref-hint-bg: #ddd;
    --ref-hint-text: var(--text);
}
@media (prefers-color-scheme: dark) {
    :root {
        --ref-hint-bg: #222;
        --ref-hint-text: var(--text);
    }
}

.ref-hint {
    display: inline-block;
    position: absolute;
    z-index: 35;
    width: 20em;
    width: 300px;
    height: auto;
    max-height: 500px;
    overflow: auto;
    padding: 0.5em 0.5em;
    font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
    background: var(--ref-hint-bg);
    color: var(--ref-hint-text);
    border: outset 0.2em;
    white-space: normal; /* in case it's moved into a pre */
}

.ref-hint * { margin: 0; padding: 0; text-indent: 0; }

.ref-hint ul { padding: 0 0 0 1em; list-style: none; }
</style>
<style>/* Boilerplate: style-selflinks */
:root {
    --selflink-text: white;
    --selflink-bg: gray;
    --selflink-hover-text: black;
}
.heading, .issue, .note, .example, li, dt {
    position: relative;
}
a.self-link {
    position: absolute;
    top: 0;
    left: calc(-1 * (3.5rem - 26px));
    width: calc(3.5rem - 26px);
    height: 2em;
    text-align: center;
    border: none;
    transition: opacity .2s;
    opacity: .5;
}
a.self-link:hover {
    opacity: 1;
}
.heading > a.self-link {
    font-size: 83%;
}
.example > a.self-link,
.note > a.self-link,
.issue > a.self-link {
    /* These blocks are overflow:auto, so positioning outside
       doesn't work. */
    left: auto;
    right: 0;
}
li > a.self-link {
    left: calc(-1 * (3.5rem - 26px) - 2em);
}
dfn > a.self-link {
    top: auto;
    left: auto;
    opacity: 0;
    width: 1.5em;
    height: 1.5em;
    background: var(--selflink-bg);
    color: var(--selflink-text);
    font-style: normal;
    transition: opacity .2s, background-color .2s, color .2s;
}
dfn:hover > a.self-link {
    opacity: 1;
}
dfn > a.self-link:hover {
    color: var(--selflink-hover-text);
}

a.self-link::before            { content: "¶"; }
.heading > a.self-link::before { content: "§"; }
dfn > a.self-link::before      { content: "#"; }
</style>
<style>/* Boilerplate: style-syntax-highlighting */
code.highlight { padding: .1em; border-radius: .3em; }
pre.highlight, pre > code.highlight { display: block; padding: 1em; margin: .5em 0; overflow: auto; border-radius: 0; }

.highlight:not(.idl) { background: rgba(0, 0, 0, .03); }
c-[a] { color: #990055 } /* Keyword.Declaration */
c-[b] { color: #990055 } /* Keyword.Type */
c-[c] { color: #708090 } /* Comment */
c-[d] { color: #708090 } /* Comment.Multiline */
c-[e] { color: #0077aa } /* Name.Attribute */
c-[f] { color: #669900 } /* Name.Tag */
c-[g] { color: #222222 } /* Name.Variable */
c-[k] { color: #990055 } /* Keyword */
c-[l] { color: #000000 } /* Literal */
c-[m] { color: #000000 } /* Literal.Number */
c-[n] { color: #0077aa } /* Name */
c-[o] { color: #999999 } /* Operator */
c-[p] { color: #999999 } /* Punctuation */
c-[s] { color: #a67f59 } /* Literal.String */
c-[t] { color: #a67f59 } /* Literal.String.Single */
c-[u] { color: #a67f59 } /* Literal.String.Double */
c-[cp] { color: #708090 } /* Comment.Preproc */
c-[c1] { color: #708090 } /* Comment.Single */
c-[cs] { color: #708090 } /* Comment.Special */
c-[kc] { color: #990055 } /* Keyword.Constant */
c-[kn] { color: #990055 } /* Keyword.Namespace */
c-[kp] { color: #990055 } /* Keyword.Pseudo */
c-[kr] { color: #990055 } /* Keyword.Reserved */
c-[ld] { color: #000000 } /* Literal.Date */
c-[nc] { color: #0077aa } /* Name.Class */
c-[no] { color: #0077aa } /* Name.Constant */
c-[nd] { color: #0077aa } /* Name.Decorator */
c-[ni] { color: #0077aa } /* Name.Entity */
c-[ne] { color: #0077aa } /* Name.Exception */
c-[nf] { color: #0077aa } /* Name.Function */
c-[nl] { color: #0077aa } /* Name.Label */
c-[nn] { color: #0077aa } /* Name.Namespace */
c-[py] { color: #0077aa } /* Name.Property */
c-[ow] { color: #999999 } /* Operator.Word */
c-[mb] { color: #000000 } /* Literal.Number.Bin */
c-[mf] { color: #000000 } /* Literal.Number.Float */
c-[mh] { color: #000000 } /* Literal.Number.Hex */
c-[mi] { color: #000000 } /* Literal.Number.Integer */
c-[mo] { color: #000000 } /* Literal.Number.Oct */
c-[sb] { color: #a67f59 } /* Literal.String.Backtick */
c-[sc] { color: #a67f59 } /* Literal.String.Char */
c-[sd] { color: #a67f59 } /* Literal.String.Doc */
c-[se] { color: #a67f59 } /* Literal.String.Escape */
c-[sh] { color: #a67f59 } /* Literal.String.Heredoc */
c-[si] { color: #a67f59 } /* Literal.String.Interpol */
c-[sx] { color: #a67f59 } /* Literal.String.Other */
c-[sr] { color: #a67f59 } /* Literal.String.Regex */
c-[ss] { color: #a67f59 } /* Literal.String.Symbol */
c-[vc] { color: #0077aa } /* Name.Variable.Class */
c-[vg] { color: #0077aa } /* Name.Variable.Global */
c-[vi] { color: #0077aa } /* Name.Variable.Instance */
c-[il] { color: #000000 } /* Literal.Number.Integer.Long */

@media (prefers-color-scheme: dark) {
    .highlight:not(.idl) { background: rgba(255, 255, 255, .05); }

    c-[a] { color: #d33682 } /* Keyword.Declaration */
    c-[b] { color: #d33682 } /* Keyword.Type */
    c-[c] { color: #2aa198 } /* Comment */
    c-[d] { color: #2aa198 } /* Comment.Multiline */
    c-[e] { color: #268bd2 } /* Name.Attribute */
    c-[f] { color: #b58900 } /* Name.Tag */
    c-[g] { color: #cb4b16 } /* Name.Variable */
    c-[k] { color: #d33682 } /* Keyword */
    c-[l] { color: #657b83 } /* Literal */
    c-[m] { color: #657b83 } /* Literal.Number */
    c-[n] { color: #268bd2 } /* Name */
    c-[o] { color: #657b83 } /* Operator */
    c-[p] { color: #657b83 } /* Punctuation */
    c-[s] { color: #6c71c4 } /* Literal.String */
    c-[t] { color: #6c71c4 } /* Literal.String.Single */
    c-[u] { color: #6c71c4 } /* Literal.String.Double */
    c-[ch] { color: #2aa198 } /* Comment.Hashbang */
    c-[cp] { color: #2aa198 } /* Comment.Preproc */
    c-[cpf] { color: #2aa198 } /* Comment.PreprocFile */
    c-[c1] { color: #2aa198 } /* Comment.Single */
    c-[cs] { color: #2aa198 } /* Comment.Special */
    c-[kc] { color: #d33682 } /* Keyword.Constant */
    c-[kn] { color: #d33682 } /* Keyword.Namespace */
    c-[kp] { color: #d33682 } /* Keyword.Pseudo */
    c-[kr] { color: #d33682 } /* Keyword.Reserved */
    c-[ld] { color: #657b83 } /* Literal.Date */
    c-[nc] { color: #268bd2 } /* Name.Class */
    c-[no] { color: #268bd2 } /* Name.Constant */
    c-[nd] { color: #268bd2 } /* Name.Decorator */
    c-[ni] { color: #268bd2 } /* Name.Entity */
    c-[ne] { color: #268bd2 } /* Name.Exception */
    c-[nf] { color: #268bd2 } /* Name.Function */
    c-[nl] { color: #268bd2 } /* Name.Label */
    c-[nn] { color: #268bd2 } /* Name.Namespace */
    c-[py] { color: #268bd2 } /* Name.Property */
    c-[ow] { color: #657b83 } /* Operator.Word */
    c-[mb] { color: #657b83 } /* Literal.Number.Bin */
    c-[mf] { color: #657b83 } /* Literal.Number.Float */
    c-[mh] { color: #657b83 } /* Literal.Number.Hex */
    c-[mi] { color: #657b83 } /* Literal.Number.Integer */
    c-[mo] { color: #657b83 } /* Literal.Number.Oct */
    c-[sa] { color: #6c71c4 } /* Literal.String.Affix */
    c-[sb] { color: #6c71c4 } /* Literal.String.Backtick */
    c-[sc] { color: #6c71c4 } /* Literal.String.Char */
    c-[dl] { color: #6c71c4 } /* Literal.String.Delimiter */
    c-[sd] { color: #6c71c4 } /* Literal.String.Doc */
    c-[se] { color: #6c71c4 } /* Literal.String.Escape */
    c-[sh] { color: #6c71c4 } /* Literal.String.Heredoc */
    c-[si] { color: #6c71c4 } /* Literal.String.Interpol */
    c-[sx] { color: #6c71c4 } /* Literal.String.Other */
    c-[sr] { color: #6c71c4 } /* Literal.String.Regex */
    c-[ss] { color: #6c71c4 } /* Literal.String.Symbol */
    c-[fm] { color: #268bd2 } /* Name.Function.Magic */
    c-[vc] { color: #cb4b16 } /* Name.Variable.Class */
    c-[vg] { color: #cb4b16 } /* Name.Variable.Global */
    c-[vi] { color: #cb4b16 } /* Name.Variable.Instance */
    c-[vm] { color: #cb4b16 } /* Name.Variable.Magic */
    c-[il] { color: #657b83 } /* Literal.Number.Integer.Long */
}
</style>
<style>/* Boilerplate: style-var-click-highlighting */
/*
Colors were chosen in Lab using https://nixsensor.com/free-color-converter/
D50 2deg illuminant, L in [0,100], a and b in [-128, 128]
0 = lab(85,0,85)
1 = lab(85,80,30)
2 = lab(85,-40,40)
3 = lab(85,-50,0)
4 = lab(85,5,15)
5 = lab(85,-10,-50)
6 = lab(85,35,-15)

For darkmode:
0 = oklab(50%   0%  108%)
1 = oklab(50% -51%   51%)
2 = oklab(50% -64%  -20%)
3 = oklab(50%   6%   19%)
4 = oklab(50% -12%  -64%)
5 = oklab(50%  44%  -19%)  
6 = oklab(50% 102%   38%)
*/

[data-algorithm] var { cursor: pointer; }
var[data-var-color] { background-color: var(--var-bg); box-shadow: 0 0 0 2px var(--var-bg); }

var[data-var-color] { --var-bg: #F4D200; }
var[data-var-color="1"] { --var-bg: #FF87A2; }
var[data-var-color="2"] { --var-bg: #96E885; }
var[data-var-color="3"] { --var-bg: #3EEED2; }
var[data-var-color="4"] { --var-bg: #EACFB6; }
var[data-var-color="5"] { --var-bg: #82DDFF; }
var[data-var-color="6"] { --var-vg: #FFBCF2; }

@media (prefers-color-scheme: dark) {
	var[data-var-color] { --var-bg: #bc1a00; }
	var[data-var-color="1"] { --var-bg: #007f00; }
	var[data-var-color="2"] { --var-bg: #008698; }
	var[data-var-color="3"] { --var-bg: #7f5b2b; }
	var[data-var-color="4"] { --var-bg: #004df3; }
	var[data-var-color="5"] { --var-bg: #a1248a; }
	var[data-var-color="6"] { --var-vg: #ff0000; }
}
</style>
 <body class="h-entry">
  <div class="head">
   <p data-fill-with="logo"><a class="logo" href="https://www.w3.org/"> <img alt="W3C" height="48" src="https://www.w3.org/StyleSheets/TR/2021/logos/W3C" width="72"> </a> </p>
   <h1 class="p-name no-ref" id="title">HTML Sanitizer API</h1>
   <p id="w3c-state"><a href="https://www.w3.org/standards/types#CG-DRAFT">Draft Community Group Report</a>, <time class="dt-updated" datetime="1970-01-01">1 January 1970</time></p>
   <div data-fill-with="spec-metadata">
    <dl>
     <dt>This version:
     <dd><a class="u-url" href="https://wicg.github.io/sanitizer-api/">https://wicg.github.io/sanitizer-api/</a>
     <dt class="editor">Editors:
     <dd class="editor p-author h-card vcard" data-editor-id="68466"><a class="p-name fn u-url url" href="https://frederik-braun.com">Frederik Braun</a> (<span class="p-org org">Mozilla</span>) <a class="u-email email" href="mailto:fbraun@mozilla.com">fbraun@mozilla.com</a>
     <dd class="editor p-author h-card vcard"><a class="p-name fn u-url url" href="https://cure53.de">Mario Heiderich</a> (<span class="p-org org">Cure53</span>) <a class="u-email email" href="mailto:mario@cure53.de">mario@cure53.de</a>
     <dd class="editor p-author h-card vcard"><a class="p-name fn u-url url" href="https://www.google.com">Daniel Vogelheim</a> (<span class="p-org org">Google LLC</span>) <a class="u-email email" href="mailto:vogelheim@google.com">vogelheim@google.com</a>
    </dl>
   </div>
   <div data-fill-with="warning"></div>
   <p class="copyright" data-fill-with="copyright"><a href="https://www.w3.org/policies/#copyright">Copyright</a> © 1970 the Contributors to the HTML Sanitizer API Specification, published by the <a href="https://www.w3.org/community/wicg/">Web Platform Incubator Community Group</a> under the <a href="https://www.w3.org/community/about/agreements/cla/">W3C Community Contributor License Agreement (CLA)</a>.
A human-readable <a href="http://www.w3.org/community/about/agreements/cla-deed/">summary</a> is available. </p>
   <hr title="Separator for header">
  </div>
  <div class="p-summary" data-fill-with="abstract">
   <h2 class="no-num no-toc no-ref heading settled" id="abstract"><span class="content">Abstract</span></h2>
   <p>This document specifies a set of APIs which allow developers to take untrusted
strings of HTML, and sanitize them for safe insertion into a document’s DOM.</p>
  </div>
  <div data-fill-with="at-risk"></div>
  <h2 class="no-num no-toc no-ref heading settled" id="status"><span class="content">Status of this document</span></h2>
  <div data-fill-with="status">
   <p> This specification was published by the <a href="https://www.w3.org/community/wicg/">Web Platform Incubator Community Group</a>.
  It is not a W3C Standard nor is it on the W3C Standards Track.

  Please note that under the <a href="https://www.w3.org/community/about/agreements/cla/">W3C Community Contributor License Agreement (CLA)</a> there is a limited opt-out and other conditions apply.

  Learn more about <a href="http://www.w3.org/community/">W3C Community and Business Groups</a>. </p>
   <p></p>
  </div>
  <div data-fill-with="at-risk"></div>
  <nav data-fill-with="table-of-contents" id="toc">
   <h2 class="no-num no-toc no-ref" id="contents">Table of Contents</h2>
   <ol class="toc" role="directory">
    <li>
     <a href="#intro"><span class="secno">1</span> <span class="content">Introduction</span></a>
     <ol class="toc">
      <li><a href="#goals"><span class="secno">1.1</span> <span class="content">Goals</span></a>
      <li><a href="#examples"><span class="secno">1.2</span> <span class="content">Examples</span></a>
     </ol>
    <li>
     <a href="#framework"><span class="secno">2</span> <span class="content">Framework</span></a>
     <ol class="toc">
      <li><a href="#sanitizer-api"><span class="secno">2.1</span> <span class="content">Sanitizer API</span></a>
      <li><a href="#inputs"><span class="secno">2.2</span> <span class="content">Input Types</span></a>
      <li>
       <a href="#config"><span class="secno">2.3</span> <span class="content">The Configuration Dictionary</span></a>
       <ol class="toc">
        <li><a href="#attr-match-list"><span class="secno">2.3.1</span> <span class="content">Attribute Match Lists</span></a>
       </ol>
      <li>
       <a href="#algorithms"><span class="secno">2.4</span> <span class="content">Algorithms</span></a>
       <ol class="toc">
        <li><a href="#configuration"><span class="secno">2.4.1</span> <span class="content">The Effective Configuration</span></a>
        <li><a href="#defaults"><span class="secno">2.4.2</span> <span class="content">Baseline and Defaults</span></a>
       </ol>
     </ol>
    <li>
     <a href="#security-considerations"><span class="secno">3</span> <span class="content">Security Considerations</span></a>
     <ol class="toc">
      <li><a href="#server-side-xss"><span class="secno">3.1</span> <span class="content">Server-Side Reflected and Stored XSS</span></a>
      <li><a href="#dom-clobbering"><span class="secno">3.2</span> <span class="content">DOM clobbering</span></a>
      <li><a href="#script-gadgets"><span class="secno">3.3</span> <span class="content">XSS with Script gadgets</span></a>
      <li><a href="#mutated-xss"><span class="secno">3.4</span> <span class="content">Mutated XSS</span></a>
     </ol>
    <li><a href="#ack"><span class="secno">4</span> <span class="content">Acknowledgements</span></a>
    <li>
     <a href="#constants"><span class="secno"></span> <span class="content">Appendix A: Built-in Constants</span></a>
     <ol class="toc">
      <li><a href="#baseline-element-allow-list"><span class="secno"></span> <span class="content">The Baseline Element Allow List</span></a>
      <li><a href="#baseline-attribute-allow-list"><span class="secno"></span> <span class="content">The Baseline Attribute Allow List</span></a>
      <li><a href="#default-configuration-object"><span class="secno"></span> <span class="content">The Default Configuration Object</span></a>
     </ol>
    <li>
     <a href="#index"><span class="secno"></span> <span class="content">Index</span></a>
     <ol class="toc">
      <li><a href="#index-defined-here"><span class="secno"></span> <span class="content">Terms defined by this specification</span></a>
      <li><a href="#index-defined-elsewhere"><span class="secno"></span> <span class="content">Terms defined by reference</span></a>
     </ol>
    <li>
     <a href="#references"><span class="secno"></span> <span class="content">References</span></a>
     <ol class="toc">
      <li><a href="#normative"><span class="secno"></span> <span class="content">Normative References</span></a>
      <li><a href="#informative"><span class="secno"></span> <span class="content">Informative References</span></a>
     </ol>
    <li><a href="#idl-index"><span class="secno"></span> <span class="content">IDL Index</span></a>
    <li><a href="#issues-index"><span class="secno"></span> <span class="content">Issues Index</span></a>
   </ol>
  </nav>
  <main>
   <h2 class="heading settled" data-level="1" id="intro"><span class="secno">1. </span><span class="content">Introduction</span><a class="self-link" href="#intro"></a></h2>
   <p><em>This section is not normative.</em></p>
   <p>Web applications often need to work with strings of HTML on the client side,
perhaps as part of a client-side templating solution, perhaps as part of
rendering user generated content, etc. It is difficult to do so in a safe way,
however; the naive approach of joining strings together and stuffing them into
an <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#element" id="ref-for-element">Element</a></code>'s <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/DOM-Parsing/#widl-Element-innerHTML" id="ref-for-widl-Element-innerHTML">innerHTML</a></code> is fraught with risk, as that can and
will cause JavaScript execution in a number of unexpected ways.</p>
   <p>Libraries like <a data-link-type="biblio" href="#biblio-dompurify" title="DOMPurify">[DOMPURIFY]</a> attempt to manage this problem by carefully
parsing and sanitizing strings before insertion by constructing a DOM and
walking its members through an allow-list. This has proven to be a fragile
approach, as the parsing APIs exposed to the web don’t always map in
reasonable ways to the browser’s behavior when actually rendering a string as
HTML in the "real" DOM. Moreover, the libraries need to keep on top of
browsers' changing behavior over time; things that once were safe may turn
into time-bombs based on new platform-level features.</p>
   <p>The browser has a fairly good idea of when it is going to
execute code. We can improve upon the user-space libraries by teaching the
browser how to render HTML from an arbitrary string in a safe manner, and do
so in a way that is much more likely to be maintained and updated along with
the browser’s own changing parser implementation. This document outlines an
API which aims to do just that.</p>
   <h3 class="heading settled" data-level="1.1" id="goals"><span class="secno">1.1. </span><span class="content">Goals</span><a class="self-link" href="#goals"></a></h3>
   <ul>
    <li data-md>
     <p>Mitigate the risk of DOM-based cross-site scripting attacks by providing
  developers with mechanisms for handling user-controlled HTML which prevent
  direct script execution upon injection.</p>
    <li data-md>
     <p>Make HTML output safe for use within the current user agent, taking into
  account its current understanding of HTML.</p>
    <li data-md>
     <p>Allow developers to override the defaults set of elements and attributes.
  Adding certain elements and attributes can prevent <a href="https://github.com/google/security-research-pocs/tree/master/script-gadgets">script gadget</a> attacks.</p>
   </ul>
   <h3 class="heading settled" data-level="1.2" id="examples"><span class="secno">1.2. </span><span class="content">Examples</span><a class="self-link" href="#examples"></a></h3>
<pre class="language-js highlight"><c- a>let</c-> userControlledInput <c- o>=</c-> <c- u>"&amp;lt;img src=x onerror=alert(1)//&amp;gt;"</c-><c- p>;</c->

<c- c1>// Create a DocumentFragment from unsanitized input:</c->
<c- a>let</c-> s <c- o>=</c-> <c- ow>new</c-> Sanitizer<c- p>();</c->
<c- a>let</c-> sanitizedFragment <c- o>=</c-> s<c- p>.</c->sanitize<c- p>(</c->userControlledInput<c- p>);</c->

<c- c1>// Replace an element's content from unsanitized input:</c->
element<c- p>.</c->replaceChildren<c- p>(</c->s<c- p>.</c->sanitize<c- p>(</c->userControlledInput<c- p>));</c->
</pre>
   <h2 class="heading settled" data-level="2" id="framework"><span class="secno">2. </span><span class="content">Framework</span><a class="self-link" href="#framework"></a></h2>
   <h3 class="heading settled" data-level="2.1" id="sanitizer-api"><span class="secno">2.1. </span><span class="content">Sanitizer API</span><a class="self-link" href="#sanitizer-api"></a></h3>
   <p>The core API is the <code>Sanitizer</code> object and the sanitize method. Sanitizers can
be instantiated using an optional <code>SanitizerConfig</code> dictionary for options.
The most common use-case - preventing XSS - is handled by default,
so that creating a Sanitizer with a custom config is necessary only to
handle additional, application-specific use cases.</p>
<pre class="idl highlight def">[
  <a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed" id="ref-for-Exposed"><c- g>Exposed</c-></a>=(<c- n>Window</c->),
  <a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#SecureContext" id="ref-for-SecureContext"><c- g>SecureContext</c-></a>
] <c- b>interface</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="interface" data-export id="sanitizer"><code><c- g>Sanitizer</c-></code></dfn> {
  <a class="idl-code" data-link-type="constructor" href="#dom-sanitizer-sanitizer" id="ref-for-dom-sanitizer-sanitizer"><c- g>constructor</c-></a>(<c- b>optional</c-> <a data-link-type="idl-name" href="#dictdef-sanitizerconfig" id="ref-for-dictdef-sanitizerconfig"><c- n>SanitizerConfig</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="Sanitizer/Sanitizer(config), Sanitizer/constructor(config), Sanitizer/Sanitizer(), Sanitizer/constructor()" data-dfn-type="argument" data-export id="dom-sanitizer-sanitizer-config-config"><code><c- g>config</c-></code></dfn> = {});
  <a data-link-type="idl-name" href="https://dom.spec.whatwg.org/#documentfragment" id="ref-for-documentfragment"><c- n>DocumentFragment</c-></a> <a class="idl-code" data-link-type="method" href="#dom-sanitizer-sanitize" id="ref-for-dom-sanitizer-sanitize"><c- g>sanitize</c-></a>(<a data-link-type="idl-name" href="#typedefdef-sanitizerinput" id="ref-for-typedefdef-sanitizerinput"><c- n>SanitizerInput</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="Sanitizer/sanitize(input)" data-dfn-type="argument" data-export id="dom-sanitizer-sanitize-input-input"><code><c- g>input</c-></code></dfn>);
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString" id="ref-for-idl-DOMString"><c- b>DOMString</c-></a> <a class="idl-code" data-link-type="method" href="#dom-sanitizer-sanitizetostring" id="ref-for-dom-sanitizer-sanitizetostring"><c- g>sanitizeToString</c-></a>(<a data-link-type="idl-name" href="#typedefdef-sanitizerinput" id="ref-for-typedefdef-sanitizerinput①"><c- n>SanitizerInput</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="Sanitizer/sanitizeToString(input)" data-dfn-type="argument" data-export id="dom-sanitizer-sanitizetostring-input-input"><code><c- g>input</c-></code></dfn>);
};
</pre>
   <ul>
    <li data-md>
     <p>The <dfn class="dfn-paneled idl-code" data-dfn-for="Sanitizer" data-dfn-type="constructor" data-export data-lt="Sanitizer(config)|constructor(config)|Sanitizer()|constructor()" id="dom-sanitizer-sanitizer"> <code>new Sanitizer(<var>config</var>)</code></dfn> constructor steps
  are to create a new Sanitizer instance, and to retains a copy of <var>config</var> as its <a data-link-type="dfn" href="#configuration-object" id="ref-for-configuration-object">configuration object</a>.</p>
    <li data-md>
     <p>The <dfn class="dfn-paneled idl-code" data-dfn-for="Sanitizer" data-dfn-type="method" data-export id="dom-sanitizer-sanitize"><code>sanitize(<var>input</var>)</code></dfn> method steps are to return the result of running the <a data-link-type="dfn" href="#sanitize" id="ref-for-sanitize">sanitize</a> algorithm on <var>input</var>,</p>
    <li data-md>
     <p>The <dfn class="dfn-paneled idl-code" data-dfn-for="Sanitizer" data-dfn-type="method" data-export id="dom-sanitizer-sanitizetostring"><code>sanitizeToString(<var>input</var>)</code></dfn> method steps are to return the result of running <a data-link-type="dfn" href="#sanitizetostring" id="ref-for-sanitizetostring">sanitizeToString</a> algorithm on <var>input</var>.</p>
   </ul>
   <p>Example:</p>
<pre class="language-js highlight"><c- c1>// Replace an element's content from unsanitized input:</c->
element<c- p>.</c->replaceChildren<c- p>(</c-><c- ow>new</c-> Sanitizer<c- p>().</c->sanitize<c- p>(</c->userControlledInput<c- p>));</c->
</pre>
   <h3 class="heading settled" data-level="2.2" id="inputs"><span class="secno">2.2. </span><span class="content">Input Types</span><a class="self-link" href="#inputs"></a></h3>
   <p>The sanitization methods support three input types: <code>DOMString</code>, <code>Document</code>,
and <code>DocumentFragment</code>. In all cases, the sanitization will work on a <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#documentfragment" id="ref-for-documentfragment①">DocumentFragment</a></code> internally, but the work-fragment will be created by
parsing, cloning, or using the fragment as-is, respectively.</p>
<pre class="idl highlight def"><c- b>typedef</c-> (<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString" id="ref-for-idl-DOMString①"><c- b>DOMString</c-></a> <c- b>or</c-> <a data-link-type="idl-name" href="https://dom.spec.whatwg.org/#documentfragment" id="ref-for-documentfragment②"><c- n>DocumentFragment</c-></a> <c- b>or</c-> <a data-link-type="idl-name" href="https://dom.spec.whatwg.org/#interface-Document" id="ref-for-interface-Document"><c- n>Document</c-></a>) <dfn class="dfn-paneled idl-code" data-dfn-type="typedef" data-export id="typedefdef-sanitizerinput"><code><c- g>SanitizerInput</c-></code></dfn>;
</pre>
   <p class="note" role="note"><span class="marker">Note:</span> Sanitizing a string will use the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/parsing.html#html-parser" id="ref-for-html-parser">HTML Parser</a> to parse the input,
    which will perform some degree of normalization. So even
    if no sanitization steps are taken on a particular input, it cannot be
    guaranteed that the output of <code>sanitizeToString</code> will be
    character-for-character identical to the input.
    Examples would be character regularization (<code>"&amp;szlig;"</code> to <code>"ß"</code>),
    or light processing for some elements (<code>"&lt;image>"</code> to <code>"&lt;img>"</code>);</p>
   <h3 class="heading settled" data-level="2.3" id="config"><span class="secno">2.3. </span><span class="content">The Configuration Dictionary</span><a class="self-link" href="#config"></a></h3>
   <p>The Sanitizer’s <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="configuration-object">configuration object</dfn> is a dictionary which
describes modifications to the sanitize operation. If a Sanitizer has
not received an explicit configuration, for example when being
constructed without any parameters, then the <a data-link-type="dfn" href="#default-configuration" id="ref-for-default-configuration">default configuration</a> value
is used as the configuration object.</p>
<pre class="idl highlight def"><c- b>dictionary</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="dictionary" data-export id="dictdef-sanitizerconfig"><code><c- g>SanitizerConfig</c-></code></dfn> {
  <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#idl-sequence" id="ref-for-idl-sequence"><c- b>sequence</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString" id="ref-for-idl-DOMString②"><c- b>DOMString</c-></a>> <dfn class="dfn-paneled idl-code" data-dfn-for="SanitizerConfig" data-dfn-type="dict-member" data-export data-type="sequence<DOMString>" id="dom-sanitizerconfig-allowelements"><code><c- g>allowElements</c-></code></dfn>;
  <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#idl-sequence" id="ref-for-idl-sequence①"><c- b>sequence</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString" id="ref-for-idl-DOMString③"><c- b>DOMString</c-></a>> <dfn class="dfn-paneled idl-code" data-dfn-for="SanitizerConfig" data-dfn-type="dict-member" data-export data-type="sequence<DOMString>" id="dom-sanitizerconfig-blockelements"><code><c- g>blockElements</c-></code></dfn>;
  <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#idl-sequence" id="ref-for-idl-sequence②"><c- b>sequence</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString" id="ref-for-idl-DOMString④"><c- b>DOMString</c-></a>> <dfn class="dfn-paneled idl-code" data-dfn-for="SanitizerConfig" data-dfn-type="dict-member" data-export data-type="sequence<DOMString>" id="dom-sanitizerconfig-dropelements"><code><c- g>dropElements</c-></code></dfn>;
  <a data-link-type="idl-name" href="#typedefdef-attributematchlist" id="ref-for-typedefdef-attributematchlist"><c- n>AttributeMatchList</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="SanitizerConfig" data-dfn-type="dict-member" data-export data-type="AttributeMatchList" id="dom-sanitizerconfig-allowattributes"><code><c- g>allowAttributes</c-></code></dfn>;
  <a data-link-type="idl-name" href="#typedefdef-attributematchlist" id="ref-for-typedefdef-attributematchlist①"><c- n>AttributeMatchList</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="SanitizerConfig" data-dfn-type="dict-member" data-export data-type="AttributeMatchList" id="dom-sanitizerconfig-dropattributes"><code><c- g>dropAttributes</c-></code></dfn>;
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-boolean" id="ref-for-idl-boolean"><c- b>boolean</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="SanitizerConfig" data-dfn-type="dict-member" data-export data-type="boolean" id="dom-sanitizerconfig-allowcustomelements"><code><c- g>allowCustomElements</c-></code></dfn>;
};
</pre>
   <dl>
    <dt data-md>allowElements
    <dd data-md>
     <p>The <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="element-allow-list">element allow list</dfn> is a sequence of strings with
  elements that the sanitizer should retain in the input.</p>
    <dt data-md>blockElements
    <dd data-md>
     <p>The <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="element-block-list">element block list</dfn> is a sequence of strings with elements
 where the sanitizer should remove the elements from the input, but retain
 their children.</p>
    <dt data-md>dropElements
    <dd data-md>
     <p>The <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="element-drop-list">element drop list</dfn> is a sequence of strings with elements
 that the sanitizer should remove from the input, including its children.</p>
    <dt data-md>allowAttributes
    <dd data-md>
     <p>The <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="attribute-allow-list">attribute allow list</dfn> is an <a data-link-type="dfn" href="#attribute-match-list" id="ref-for-attribute-match-list">attribute match list</a>, which
 determines whether an attribute (on a given element) should be allowed.</p>
    <dt data-md>dropAttributes
    <dd data-md>
     <p>The <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="attribute-drop-list">attribute drop list</dfn> is an <a data-link-type="dfn" href="#attribute-match-list" id="ref-for-attribute-match-list①">attribute match list</a>, which
 determines whether an attribute (on a given element) should be dropped.</p>
    <dt data-md>allowCustomElements
    <dd data-md>
     <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="allow-custom-elements-option">allow custom elements option</dfn> determines whether <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/custom-elements.html#custom-element" id="ref-for-custom-element">custom elements</a> are to be considered. The default is to drop them.
 If this option is true, custom elements will still be checked against all
 other built-in or configured configured checks.</p>
   </dl>
   <p class="note" role="note"><span class="marker">Note:</span> <code>allowElements</code> creates a sanitizer that defaults to dropping elements,
  while <code>blockElements</code> and <code>dropElements</code> defaults to keeping unknown
  elements. Using both types is possible, but is probably of little practical
  use. The same applies to <code>allowAttributes</code> and <code>dropAttributes</code>.</p>
   <p>Examples:</p>
<pre class="language-js highlight"><c- a>const</c-> sample <c- o>=</c-> <c- u>"Some text &lt;b>&lt;i>with&lt;/i>&lt;/b> &lt;blink>tags&lt;/blink>."</c-><c- p>;</c->

<c- c1>// "Some text &lt;b>with&lt;/b> text tags."</c->
<c- ow>new</c-> Sanitizer<c- p>({</c->allowElements<c- o>:</c-> <c- p>[</c-> <c- u>"b"</c-> <c- p>]).</c->sanitizeToString<c- p>(</c->sample<c- p>);</c->

<c- c1>// "Some text &lt;i>with&lt;/i> &lt;blink>tags&lt;/blink>."</c->
<c- ow>new</c-> Sanitizer<c- p>({</c->blockElements<c- o>:</c-> <c- p>[</c-> <c- u>"b"</c-> <c- p>]).</c->sanitizeToString<c- p>(</c->sample<c- p>);</c->

<c- c1>// "Some text &lt;blink>tags&lt;/blink>."</c->
<c- ow>new</c-> Sanitizer<c- p>({</c->dropElements<c- o>:</c-> <c- p>[</c-> <c- u>"b"</c-> <c- p>]).</c->sanitizeToString<c- p>(</c->sample<c- p>);</c->

<c- c1>// Note: The default configuration handles XSS-relevant input:</c->

<c- c1>// Non-scripting input will be passed through:</c->
<c- ow>new</c-> Sanitizer<c- p>().</c->sanitizeToString<c- p>(</c->sample<c- p>);</c->  <c- c1>// Will output sample unmodified.</c->

<c- c1>// Scripts will be blocked: "abc alert(1) def"</c->
<c- ow>new</c-> Sanitizer<c- p>().</c->sanitizeToString<c- p>(</c-><c- u>"abc &lt;script>alert(1)&lt;/script> def"</c-><c- p>);</c->
</pre>
   <h4 class="heading settled" data-level="2.3.1" id="attr-match-list"><span class="secno">2.3.1. </span><span class="content">Attribute Match Lists</span><a class="self-link" href="#attr-match-list"></a></h4>
   <p>An <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="attribute-match-list">attribute match list</dfn> is a map of attribute names to element names,
where the special name "*" stands for all elements. A given <var>attribute</var> belonging to an <var>element</var> matches an <a data-link-type="dfn" href="#attribute-match-list" id="ref-for-attribute-match-list②">attribute match list</a>, if the
attribute’s local name is a key in the match list, and element’s local name
or <code>"*"</code> are found in the attribute’s value list.</p>
<pre class="idl highlight def"><c- b>typedef</c-> <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#idl-record" id="ref-for-idl-record"><c- b>record</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString" id="ref-for-idl-DOMString⑤"><c- b>DOMString</c-></a>, <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#idl-sequence" id="ref-for-idl-sequence③"><c- b>sequence</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString" id="ref-for-idl-DOMString⑥"><c- b>DOMString</c-></a>>> <dfn class="dfn-paneled idl-code" data-dfn-type="typedef" data-export id="typedefdef-attributematchlist"><code><c- g>AttributeMatchList</c-></code></dfn>;
</pre>
   <p>Examples for attributes and attribute match lists:</p>
<pre class="language-js highlight"><c- a>const</c-> sample <c- o>=</c-> <c- u>"&lt;span id='span1' class='theclass' style='font-weight: bold'>hello&lt;/span>"</c-><c- p>;</c->

<c- c1>// Allow only &lt;span style>: "&lt;span style='font-weight: bold'>...&lt;/span>"</c->
<c- ow>new</c-> Sanitizer<c- p>({</c->allowAttributes<c- o>:</c-> <c- p>{</c-><c- u>"style"</c-><c- o>:</c-> <c- p>[</c-><c- u>"span"</c-><c- p>]}}).</c->sanitizeToString<c- p>(</c->sample<c- p>);</c->

<c- c1>// Allow style, but not on span: "&lt;span>...&lt;/span>"</c->
<c- ow>new</c-> Sanitizer<c- p>({</c->allowAttributes<c- o>:</c-> <c- p>{</c-><c- u>"style"</c-><c- o>:</c-> <c- p>[</c-><c- u>"div"</c-><c- p>]}}).</c->sanitizeToString<c- p>(</c->sample<c- p>);</c->

<c- c1>// Allow style on any elements: "&lt;span style='font-weight: bold'>...&lt;/span>"</c->
<c- ow>new</c-> Sanitizer<c- p>({</c->allowAttributes<c- o>:</c-> <c- p>{</c-><c- u>"style"</c-><c- o>:</c-> <c- p>[</c-><c- u>"*"</c-><c- p>]}}).</c->sanitizeToString<c- p>(</c->sample<c- p>);</c->

<c- c1>// Block &lt;span id>: "&lt;span class='theclass' style='font-weight: bold'>...&lt;/span>";</c->
<c- ow>new</c-> Sanitizer<c- p>({</c->blockAttributes<c- o>:</c-> <c- p>{</c-><c- u>"id"</c-><c- o>:</c-> <c- p>[</c-><c- u>"span"</c-><c- p>]}}).</c->sanitizeToString<c- p>(</c->sample<c- p>);</c->

<c- c1>// Block id, everywhere: "&lt;span class='theclass' style='font-weight: bold'>...&lt;/span>";</c->
<c- ow>new</c-> Sanitizer<c- p>({</c->blockAttributes<c- o>:</c-> <c- p>{</c-><c- u>"id"</c-><c- o>:</c-> <c- p>[</c-><c- u>"*"</c-><c- p>]}}).</c->sanitizeToString<c- p>(</c->sample<c- p>);</c->
</pre>
   <h3 class="heading settled" data-level="2.4" id="algorithms"><span class="secno">2.4. </span><span class="content">Algorithms</span><a class="self-link" href="#algorithms"></a></h3>
   <div class="algorithm" data-algorithm="sanitize">
     To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="sanitize">sanitize</dfn> a given <var>input</var> of type <code class="idl"><a data-link-type="idl" href="#typedefdef-sanitizerinput" id="ref-for-typedefdef-sanitizerinput②">SanitizerInput</a></code>,
run these steps: 
    <ol>
     <li data-md>
      <p>Let <var>fragment</var> be the result of running the <a data-link-type="dfn" href="#create-a-document-fragment" id="ref-for-create-a-document-fragment">create a document fragment</a> algorithm on <var>input</var>.</p>
     <li data-md>
      <p>Run the <a data-link-type="dfn" href="#sanitize-a-document-fragment" id="ref-for-sanitize-a-document-fragment">sanitize a document fragment</a> algorithm on <var>fragment</var>.</p>
     <li data-md>
      <p>Return <var>fragment</var>.</p>
    </ol>
   </div>
   <div class="algorithm" data-algorithm="sanitizeToString">
     To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="sanitizetostring">sanitizeToString</dfn> a given <var>input</var> of type <code class="idl"><a data-link-type="idl" href="#typedefdef-sanitizerinput" id="ref-for-typedefdef-sanitizerinput③">SanitizerInput</a></code>, run these steps: 
    <ol>
     <li data-md>
      <p>Let <var>fragment</var> be the result of the <a data-link-type="dfn" href="#create-a-document-fragment" id="ref-for-create-a-document-fragment①">create a document fragment</a> algorithm on <var>input</var>.</p>
     <li data-md>
      <p>Let <var>sanitized</var> be the result of running the <a data-link-type="dfn" href="#sanitize" id="ref-for-sanitize①">sanitize</a> algorithm on <var>fragment</var>.</p>
     <li data-md>
      <p>Let <var>result</var> be the result of running the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/parsing.html#html-fragment-serialisation-algorithm" id="ref-for-html-fragment-serialisation-algorithm">HTML Fragment Serialization Algorithm</a> with <var>sanitized</var> as the <code>node</code> argument.</p>
     <li data-md>
      <p>Return <var>result</var>.</p>
    </ol>
   </div>
   <div class="algorithm" data-algorithm="create a document fragment">
     To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="create-a-document-fragment">create a document fragment</dfn> named <var>fragment</var> from an <var>input</var> of type <code class="idl"><a data-link-type="idl" href="#typedefdef-sanitizerinput" id="ref-for-typedefdef-sanitizerinput④">SanitizerInput</a></code>, run these steps: 
    <ol>
     <li data-md>
      <p>Switch based on <var>input</var>’s type:</p>
      <ol>
       <li data-md>
        <p>If <var>input</var> is of type <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#documentfragment" id="ref-for-documentfragment③">DocumentFragment</a></code>, then:</p>
        <ol>
         <li data-md>
          <p>Let <var>node</var> refer to <var>input</var>.</p>
        </ol>
       <li data-md>
        <p>If <var>input</var> is of type <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#interface-Document" id="ref-for-interface-Document①">Document</a></code>, then:</p>
        <ol>
         <li data-md>
          <p>Let <var>node</var> refer to <var>input</var>’s <code>documentElement</code>.</p>
        </ol>
       <li data-md>
        <p>If <var>input</var> is of type <code>DOMString</code>, then:</p>
        <ol>
         <li data-md>
          <p>Let <var>node</var> be the result of running the <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/DOM-Parsing/#widl-DOMParser-parseFromString-Document-DOMString-str-SupportedType-type" id="ref-for-widl-DOMParser-parseFromString-Document-DOMString-str-SupportedType-type">parseFromString</a></code> algorithm
  with <var>input</var> as first parameter (<code>string</code>),
  and <code>"text/html"</code> as second parameter (<code>type</code>).</p>
        </ol>
      </ol>
     <li data-md>
      <p>Let <var>clone</var> be the result of running <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-node-clone" id="ref-for-concept-node-clone">clone a node</a> on <var>node</var> with the <code>clone children flag</code> set to <code>true</code>.</p>
     <li data-md>
      <p>Let <code>fragment</code> be the result of <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#dom-document-createdocumentfragment" id="ref-for-dom-document-createdocumentfragment">createDocumentFragment</a></code>.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-node-append" id="ref-for-concept-node-append">Append</a> the node <var>clone</var> to the parent <var>fragment</var>.</p>
     <li data-md>
      <p>Return <var>fragment</var>.</p>
    </ol>
    <p class="issue" id="issue-8301a077"><a class="self-link" href="#issue-8301a077"></a> It’s unclear whether we can assume a generic
  context for <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/DOM-Parsing/#widl-DOMParser-parseFromString-Document-DOMString-str-SupportedType-type" id="ref-for-widl-DOMParser-parseFromString-Document-DOMString-str-SupportedType-type①">parseFromString</a></code>, or if we need to re-work the API to take
  the insertion context of the created fragment into account. <a href="https://github.com/WICG/sanitizer-api/issues/42">[Issue #WICG/sanitizer-api#42]</a></p>
   </div>
   <div class="algorithm" data-algorithm="sanitize a document fragment">
     To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="sanitize-a-document-fragment">sanitize a document fragment</dfn> named <var>fragment</var> run these steps: 
    <ol>
     <li data-md>
      <p>Let <var>m</var> be a map that maps nodes to a <a data-link-type="dfn" href="#sanitize-action" id="ref-for-sanitize-action">sanitize action</a></p>
     <li data-md>
      <p>Let <var>nodes</var> be a list containing the <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-tree-inclusive-descendant" id="ref-for-concept-tree-inclusive-descendant">inclusive descendants</a> of <var>fragment</var>, in <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-tree-order" id="ref-for-concept-tree-order">tree order</a>.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-iterate" id="ref-for-list-iterate">For each</a> <var>node</var> in <var>nodes</var>:</p>
      <ol>
       <li data-md>
        <p>Let <var>action</var> be the result of running the <a data-link-type="dfn" href="#sanitize-a-node" id="ref-for-sanitize-a-node">sanitize a node</a> algorithm
 on <var>node</var>.</p>
       <li data-md>
        <p>Insert <var>node</var> and <var>action</var> into <var>m</var></p>
      </ol>
     <li data-md>
      <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-iterate" id="ref-for-list-iterate①">For each</a> <var>node</var> in <var>nodes</var>:</p>
      <ol>
       <li data-md>
        <p>If m[node] is <code>drop</code>, remove the <var>node</var> and all children from <var>fragment</var>.</p>
       <li data-md>
        <p>If m[node] is <code>block</code>, replace the <var>node</var> with all of its element and text node children from <var>fragment</var>.</p>
       <li data-md>
        <p>If m[node] is <code>keep</code>, do nothing.</p>
      </ol>
    </ol>
   </div>
   <div class="algorithm" data-algorithm="sanitize a node">
     To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="sanitize-a-node">sanitize a node</dfn> named <var>node</var> run these steps: 
    <ol>
     <li data-md>
      <p>Let <var>sanitizer</var> be the current Sanitizer.</p>
     <li data-md>
      <p>If <var>node</var> is an element node:</p>
      <ol>
       <li data-md>
        <p>Let <var>element</var> be <var>node</var>’s element.</p>
       <li data-md>
        <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-iterate" id="ref-for-list-iterate②">For each</a> <var>attr</var> in <var>element</var>’s <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-element-attribute" id="ref-for-concept-element-attribute">attribute list</a>:</p>
        <ol>
         <li data-md>
          <p>Let <var>attr action</var> be the resulf of running the <a data-link-type="dfn" href="#effective-attribute-configuration" id="ref-for-effective-attribute-configuration">effective attribute configuration</a> algorithm on <var>sanitizer</var>, <var>attr</var>, and <var>element</var>.</p>
         <li data-md>
          <p>If <var>attr action</var> is different from <code>keep</code>, remove <var>attr</var> from
i <var>element</var>.</p>
        </ol>
       <li data-md>
        <p>Run the steps to <a data-link-type="dfn" href="#handle-funky-elements" id="ref-for-handle-funky-elements">handle funky elements</a> on <var>element</var>.</p>
       <li data-md>
        <p>Let <var>action</var> be the resulf of running the <a data-link-type="dfn" href="#effective-element-configuration" id="ref-for-effective-element-configuration">effective element configuration</a> algorithm on <var>sanitizer</var> and <var>element</var>.</p>
       <li data-md>
        <p>Return <var>action</var>.</p>
      </ol>
     <li data-md>
      <p>Return 'keep'</p>
    </ol>
    <p class="issue" id="issue-0e5b0c6b"><a class="self-link" href="#issue-0e5b0c6b"></a> What about comment nodes, CDATA, etc. ?</p>
   </div>
   <p>Some HTML elements require special treatment in a way that can’t be easily
expressed in terms of configuration options or other algorithms. The following
algorithm collects these in one place.</p>
   <div class="algorithm" data-algorithm="handle funky elements">
     To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="handle-funky-elements">handle funky elements</dfn> on a given <var>element</var>, run these steps: 
    <ol>
     <li data-md>
      <p>If <var>element</var>’s <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-element-interface" id="ref-for-concept-element-interface">element interface</a> is <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/scripting.html#htmltemplateelement" id="ref-for-htmltemplateelement">HTMLTemplateElement</a></code>:</p>
      <ol>
       <li data-md>
        <p>Run the steps of the <a data-link-type="dfn" href="#sanitize-a-document-fragment" id="ref-for-sanitize-a-document-fragment①">sanitize a document fragment</a> algorithm on <var>element</var>’s <var>content</var> attribute, and replace <var>element</var>’s <var>content</var> attribute with the result.</p>
       <li data-md>
        <p>Drop all child nodes of <var>element</var>.</p>
      </ol>
     <li data-md>
      <p>If <var>element</var>’s <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-element-interface" id="ref-for-concept-element-interface①">element interface</a> has a <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/links.html#htmlhyperlinkelementutils" id="ref-for-htmlhyperlinkelementutils">HTMLHyperlinkElementUtils</a></code> mixin, and if <var>element</var>’s <code>protocol</code> property is "javascript:":</p>
      <ol>
       <li data-md>
        <p>Remove the <code>href</code> attribute from <var>element</var>.</p>
      </ol>
     <li data-md>
      <p>if <var>element</var>’s <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-element-interface" id="ref-for-concept-element-interface②">element interface</a> is <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/forms.html#htmlformelement" id="ref-for-htmlformelement">HTMLFormElement</a></code>,
 and if <var>element</var>’s <code>action</code> attribute is a <a data-link-type="biblio" href="#biblio-url" title="URL Standard">[URL]</a> with <code>javascript:</code> protocol:</p>
      <ol>
       <li data-md>
        <p>Remove the <code>action</code> attribute from <var>element</var>.</p>
      </ol>
     <li data-md>
      <p>if <var>element</var>’s <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-element-interface" id="ref-for-concept-element-interface③">element interface</a> is <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/input.html#htmlinputelement" id="ref-for-htmlinputelement">HTMLInputElement</a></code> or <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/form-elements.html#htmlbuttonelement" id="ref-for-htmlbuttonelement">HTMLButtonElement</a></code>, and if <var>element</var>’s <code>formaction</code> attribute is
  a <a data-link-type="biblio" href="#biblio-url" title="URL Standard">[URL]</a> with <code>javascript:</code> protocol</p>
      <ol>
       <li data-md>
        <p>Remove the <code>formaction</code> attribute from <var>element</var>.</p>
      </ol>
    </ol>
   </div>
   <h4 class="heading settled" data-level="2.4.1" id="configuration"><span class="secno">2.4.1. </span><span class="content">The Effective Configuration</span><a class="self-link" href="#configuration"></a></h4>
   <p>A Sanitizer is potentially complex, so we will define a helper
construct, the <em>effective configuration</em>. This is mostly a specification
convenience and allows us to explain a Sanitizer’s operation in two steps:
One, how to derive the effective configuration, and two, define the
Sanitzer’s operation based on it.</p>
   <p>An <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="effective-configuration">effective configuration</dfn> maps a given <var>element</var> or a given pair of <var>element</var> and <var>attribute</var> to a <a data-link-type="dfn" href="#sanitize-action" id="ref-for-sanitize-action①">sanitize action</a>.</p>
   <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="sanitize-action">sanitize action</dfn> can have the values <code>keep</code>, <code>drop</code>, or <code>block</code>.
To determine the <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="stricter-action">stricter action</dfn> of two <a data-link-type="dfn" href="#sanitize-action" id="ref-for-sanitize-action②">sanitize actions</a>, pick
the 'larger' of the two actions assuming a transitively defined order with <code>drop</code> > <code>block</code>, and <code>block</code> > <code>keep</code>.</p>
   <div class="algorithm" data-algorithm="effective element configuration">
     To determine a Sanitizer <var>sanitizer</var>’s <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="effective-element-configuration">effective element configuration</dfn> for an element <var>element</var>,
run these steps: 
    <ol>
     <li data-md>
      <p>Let <var>config</var> be <var>sanitizer</var>’s <a data-link-type="dfn" href="#configuration-object" id="ref-for-configuration-object①">configuration object</a>.</p>
     <li data-md>
      <p>Let <var>baseline action</var> be the result of running the steps of the <a data-link-type="dfn" href="#determine-the-baseline-configuration-for-an-element" id="ref-for-determine-the-baseline-configuration-for-an-element">determine the baseline configuration for an element</a> algorithm
 for the element <var>element</var>.</p>
     <li data-md>
      <p>Let <var>config action</var> be the result of running the steps of the <a data-link-type="dfn" href="#determine-the-effective-configuration-for-an-element" id="ref-for-determine-the-effective-configuration-for-an-element">determine the effective configuration for an element</a> algorithm
 for the element <var>element</var> and the config <var>config</var>.</p>
     <li data-md>
      <p>Return the <a data-link-type="dfn" href="#stricter-action" id="ref-for-stricter-action">stricter action</a> of <var>baseline action</var> and <var>config action</var>.</p>
    </ol>
    <p class="note" role="note"><span class="marker">Note:</span> The definition of stricter actions ensures that the built-in baseline
      configuration cannot be overriden, and therefor forms a hard guarantee
      for all Sanitizer instances. (Likewise for attributes.)</p>
   </div>
   <div class="algorithm" data-algorithm="effective attribute configuration">
     To determine a Sanitizer <var>sanitizer</var>’s <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="effective-attribute-configuration">effective attribute configuration</dfn> for an attribute <var>attr</var> attached to an element <var>element</var>, run these steps: 
    <ol>
     <li data-md>
      <p>Let <var>config</var> be <var>sanitizer</var>’s <a data-link-type="dfn" href="#configuration-object" id="ref-for-configuration-object②">configuration object</a>.</p>
     <li data-md>
      <p>Let <var>baseline action</var> be the result of running the steps of the <a data-link-type="dfn" href="#determine-the-baseline-configuration-for-an-attribute" id="ref-for-determine-the-baseline-configuration-for-an-attribute">determine the baseline configuration for an attribute</a> algorithm
 on the attribute <var>attr</var>.</p>
     <li data-md>
      <p>Let <var>config action</var> be the result of running the steps of the <a data-link-type="dfn" href="#determine-the-effective-configuration-for-an-attribute" id="ref-for-determine-the-effective-configuration-for-an-attribute">determine the effective configuration for an attribute</a> algorithm
 on the attribute <var>attr</var>, with the element <var>element</var> and the
 config <var>config</var>.</p>
     <li data-md>
      <p>Return the <a data-link-type="dfn" href="#stricter-action" id="ref-for-stricter-action①">stricter action</a> of <var>baseline action</var> and <var>config action</var>.</p>
    </ol>
   </div>
   <p>Before describing how an effective configuration is derived, we need a
helper definition:</p>
   <div class="algorithm" data-algorithm="element kind">
     The <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="element-kind">element kind</dfn> of an <var>element</var> is one of <code>regular</code>, <code>unknown</code>, or <code>custom</code>. Let <var>element kind</var> be: 
    <ul>
     <li data-md>
      <p><code>custom</code>, if <var>element</var>’s tag name is a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/custom-elements.html#valid-custom-element-name" id="ref-for-valid-custom-element-name">valid custom element name</a>,</p>
     <li data-md>
      <p><code>unknown</code>, if <var>element</var> is not in the <a data-link-type="biblio" href="#biblio-html" title="HTML Standard">[HTML]</a> namespace or if <var>element</var>’s
 tag name denotes an unknown element — that is, if the <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-element-interface" id="ref-for-concept-element-interface④">element interface</a> the <a data-link-type="biblio" href="#biblio-html" title="HTML Standard">[HTML]</a> specification assigns to it would
 be <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/dom.html#htmlunknownelement" id="ref-for-htmlunknownelement">HTMLUnknownElement</a></code>,</p>
     <li data-md>
      <p><code>regular</code>, otherwise.</p>
    </ul>
   </div>
   <div class="algorithm" data-algorithm="attribute kind">
     Similarly, the <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="attribute-kind">attribute kind</dfn> of an <var>attribute</var> is one of <code>regular</code> or <code>unknown</code>. Let <var>attribute kind</var> be: 
    <ul>
     <li data-md>
      <p><code>unknown</code>, if the <a data-link-type="biblio" href="#biblio-html" title="HTML Standard">[HTML]</a> specifcation does not assign any meaning to <var>attribute</var>’s name.</p>
     <li data-md>
      <p><code>regular</code>, otherwise.</p>
    </ul>
   </div>
   <p class="issue" id="issue-40748180"><a class="self-link" href="#issue-40748180"></a> The spec currently treats MathML and SVG as <code>unknown</code> content and therefore blocked by default. This needs to be fixed. <a href="https://github.com/WICG/sanitizer-api/issues/72">[Issue #WICG/sanitizer-api#72]</a></p>
   <div class="algorithm" data-algorithm="determine the effective configuration for an element">
     To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="determine-the-effective-configuration-for-an-element">determine the effective configuration for an element</dfn> <var>element</var>,
given a <a data-link-type="dfn" href="#configuration-object" id="ref-for-configuration-object③">configuration object</a> <var>config</var>, run these steps: 
    <ol>
     <li data-md>
      <p>If <var>element</var>’s <a data-link-type="dfn" href="#element-kind" id="ref-for-element-kind">element kind</a> is <code>custom</code> and if <var>config</var>’s <a data-link-type="dfn" href="#allow-custom-elements-option" id="ref-for-allow-custom-elements-option">allow custom elements option</a> is unset or set to anything other
 than <code>true</code>: Return <code>drop</code>.</p>
     <li data-md>
      <p>Let <var>name</var> be <var>element</var>’s tag name.</p>
     <li data-md>
      <p>If <var>name</var> is in <var>config</var>’s <a data-link-type="dfn" href="#element-drop-list" id="ref-for-element-drop-list">element drop list</a>: Return <code>drop</code>.</p>
     <li data-md>
      <p>If <var>name</var> is in <var>config</var>’s <a data-link-type="dfn" href="#element-block-list" id="ref-for-element-block-list">element block list</a>: Return <code>block</code>.</p>
     <li data-md>
      <p>If <var>config</var> has a non-empty <a data-link-type="dfn" href="#element-allow-list" id="ref-for-element-allow-list">element allow list</a> and <var>name</var> is not
 in <var>config</var>’s <a data-link-type="dfn" href="#element-allow-list" id="ref-for-element-allow-list①">element allow list</a>: Return <code>block</code>.</p>
     <li data-md>
      <p>If <var>config</var> does not have a non-empty <a data-link-type="dfn" href="#element-allow-list" id="ref-for-element-allow-list②">element allow list</a> and <var>name</var> is not it the <a data-link-type="dfn" href="#default-configuration" id="ref-for-default-configuration①">default configuration</a>'s <a data-link-type="dfn" href="#element-allow-list" id="ref-for-element-allow-list③">element allow list</a>:
 Return <code>block</code>.</p>
     <li data-md>
      <p>Return <code>keep</code>.</p>
    </ol>
   </div>
   <div class="algorithm" data-algorithm="determine the effective configuration for an attribute">
     To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="determine-the-effective-configuration-for-an-attribute">determine the effective configuration for an attribute</dfn> <var>attr</var>,
attached to an element <var>element</var>, and given a <a data-link-type="dfn" href="#configuration-object" id="ref-for-configuration-object④">configuration object</a> <var>config</var>,
run these steps: 
    <ol>
     <li data-md>
      <p>if <var>config</var>’s <a data-link-type="dfn" href="#attribute-drop-list" id="ref-for-attribute-drop-list">attribute drop list</a> contains <var>attr</var>’s local
 name as key, and the associated value contains either <var>element</var>’s tag
 name or the string <code>"*"</code>: Return <code>drop</code>.</p>
     <li data-md>
      <p>If <var>config</var> has a non-empty <a data-link-type="dfn" href="#attribute-allow-list" id="ref-for-attribute-allow-list">attribute allow list</a> and it does not
 contain <var>attr</var>’s local name, or <var>attr</var>’s associated value
 contains neither <var>element</var>’s tag name nor the string <code>"*"</code>:
 Return <code>drop</code>.</p>
     <li data-md>
      <p>if <var>config</var> does not have a non-empty <a data-link-type="dfn" href="#attribute-allow-list" id="ref-for-attribute-allow-list①">attribute allow list</a> and <a data-link-type="dfn" href="#default-configuration" id="ref-for-default-configuration②">default configuration</a>'s <a data-link-type="dfn" href="#attribute-allow-list" id="ref-for-attribute-allow-list②">attribute allow list</a> does not contain <var>attr</var>’s local name, or <var>attr</var>’s associated value contains
 neither <var>element</var>’s tag name nor the string <code>"*"</code>: Return <code>drop</code>.</p>
     <li data-md>
      <p>Return <code>keep</code>.</p>
    </ol>
   </div>
   <h4 class="heading settled" data-level="2.4.2" id="defaults"><span class="secno">2.4.2. </span><span class="content">Baseline and Defaults</span><a class="self-link" href="#defaults"></a></h4>
   <p class="issue" id="issue-53c87d03"><a class="self-link" href="#issue-53c87d03"></a> The sanitizer baseline and defaults need to be carefully vetted, and
    are still under discussion. The values below are for illustrative
    purposes only.</p>
   <div class="algorithm" data-algorithm="determine the baseline configuration for an element">
     To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="determine-the-baseline-configuration-for-an-element">determine the baseline configuration for an element</dfn> <var>element</var>, run these steps: 
    <ol>
     <li data-md>
      <p>if <var>element</var>’s <a data-link-type="dfn" href="#element-kind" id="ref-for-element-kind①">element kind</a> is <code>regular</code> and if <var>element</var>’s tag name
 is not in the <a data-link-type="dfn" href="#baseline-element-allow-list①" id="ref-for-baseline-element-allow-list①">baseline element allow list</a>: Return <code>drop</code>.</p>
     <li data-md>
      <p>Return <code>keep</code>.</p>
    </ol>
   </div>
   <div class="algorithm" data-algorithm="determine the baseline configuration for an attribute">
     To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="determine-the-baseline-configuration-for-an-attribute">determine the baseline configuration for an attribute</dfn> <var>attr</var>, run these steps: 
    <ol>
     <li data-md>
      <p>If <var>attr</var>’s <a data-link-type="dfn" href="#attribute-kind" id="ref-for-attribute-kind">attribute kind</a> is <code>regular</code> and if <var>attr</var>’s
 name is not in the <a data-link-type="dfn" href="#baseline-attribute-allow-list①" id="ref-for-baseline-attribute-allow-list①">baseline attribute allow list</a>: Return <code>drop</code></p>
     <li data-md>
      <p>Return <code>keep</code>.</p>
    </ol>
   </div>
   <p>The sanitizer has a built-in <a data-link-type="dfn" href="#default-configuration" id="ref-for-default-configuration③">default configuration</a>, which is stricter than
the baseline and aims to eliminate any script-injection possibility, as well
as legacy or unusual constructs.</p>
   <p>The defaults and baseline are defined by three JSON constants, <a data-link-type="dfn" href="#baseline-element-allow-list①" id="ref-for-baseline-element-allow-list①①">baseline element allow list</a>, <a data-link-type="dfn" href="#baseline-attribute-allow-list①" id="ref-for-baseline-attribute-allow-list①①">baseline attribute allow list</a>, <a data-link-type="dfn" href="#default-configuration" id="ref-for-default-configuration④">default configuration</a>. For better readability, these have been moved to
an <a href="#constants">appendix A</a>.</p>
   <h2 class="heading settled" data-level="3" id="security-considerations"><span class="secno">3. </span><span class="content">Security Considerations</span><a class="self-link" href="#security-considerations"></a></h2>
   <p>The Sanitizer API is intended to prevent DOM-Based Cross-Site Scripting
by traversing a supplied HTML content and removing elements and attributes
according to a configuration. The specified API must not support
the construction of a Sanitizer object that leaves script-capable markup in
and doing so would be a bug in the threat model.</p>
   <p>That being said, there are security issues which the correct usage of the
Sanitizer API will not be able to protect against and the scenarios will be
laid out in the following sections.</p>
   <h3 class="heading settled" data-level="3.1" id="server-side-xss"><span class="secno">3.1. </span><span class="content">Server-Side Reflected and Stored XSS</span><a class="self-link" href="#server-side-xss"></a></h3>
   <p><em>This section is not normative.</em></p>
   <p>The Sanitizer API operates solely in the DOM and adds a capability to traverse
and filter an existing DocumentFragment. The Sanitizer does not address
server-side reflected or stored XSS.</p>
   <h3 class="heading settled" data-level="3.2" id="dom-clobbering"><span class="secno">3.2. </span><span class="content">DOM clobbering</span><a class="self-link" href="#dom-clobbering"></a></h3>
   <p><em>This section is not normative.</em></p>
   <p>DOM clobbering describes an attack in which malicious HTML confuses an
application by naming elements through <code>id</code> or <code>name</code> attributes such that
properties like <code>children</code> of an HTML element in the DOM are overshadowed by
the malicious content.</p>
   <p>The Sanitizer API does not protect DOM clobbering attacks in its
default state, but can be configured to remove <code>id</code> and <code>name</code> attributes.</p>
   <h3 class="heading settled" data-level="3.3" id="script-gadgets"><span class="secno">3.3. </span><span class="content">XSS with Script gadgets</span><a class="self-link" href="#script-gadgets"></a></h3>
   <p><em>This section is not normative.</em></p>
   <p>Script gadgets is a technique in which an attacker uses existing application
code from popular JavaScript libraries to cause their own code to execute.
This is often done by injecting innocent-looking code or seemingly inert
DOM nodes that is only parsed and interpreted by a framework which then
performs the execution of JavaScript based on that input.</p>
   <p>The Sanitizer API can not prevent these attacks, but requires page authors to
explicitly allow attributes and elements that are unknown to HTML and markup
that is known to be widely used for templating and framework-specific code,
like <code>data-</code> and <code>slot</code> attributes and elements like <code>&lt;slot></code> and <code>&lt;template></code>.
We believe that these restrictions are not exhaustive and encourage page
authors to examine their third party libraries for this behavior.</p>
   <h3 class="heading settled" data-level="3.4" id="mutated-xss"><span class="secno">3.4. </span><span class="content">Mutated XSS</span><a class="self-link" href="#mutated-xss"></a></h3>
   <p><em>This section is not normative.</em></p>
   <p>Mutated XSS or mXSS describes an attack based on parser mismatches when parsing
an HTML snippet without the correct context. In particular, when a parsed HTML
fragment has been serialized to a string, the format is not guaranteed to be
parsed and interpreted exactly the same when inserted into a different parent
element. An example for carrying out such an attack is by relying on the
change of parsing behavior for foreign content or misnested tags.</p>
   <p>The Sanitizer API does not protect against mutated XSS, however we encourage
authors to use the <code>sanitize()</code> function of the API which returns a
DocumentFragment and avoids risks that come with serialization and additional
parsing. Directly operating on a fragment after sanitization also comes with a
performance benefit, as the cost of additional serialization and parsing is
avoided.</p>
   <h2 class="heading settled" data-level="4" id="ack"><span class="secno">4. </span><span class="content">Acknowledgements</span><a class="self-link" href="#ack"></a></h2>
   <p>Cure53’s <a data-link-type="biblio" href="#biblio-dompurify" title="DOMPurify">[DOMPURIFY]</a> is a clear inspiration for the API this document
describes, as is Internet Explorer’s <code class="idl"><a data-link-type="idl" href="https://msdn.microsoft.com/en-us/library/cc848922(v=vs.85).aspx" id="ref-for-something">window.toStaticHTML()</a></code>.</p>
   <h2 class="heading settled" id="constants"><span class="content">Appendix A: Built-in Constants</span><a class="self-link" href="#constants"></a></h2>
   <p><em>This appendix is normative.</em></p>
   <p>These constants define core behaviour of the Sanitizer algorithm.</p>
   <p class="note" role="note"><span class="marker">Note:</span> The normative values of these constants are found below. They have
    been derived with the <a data-link-type="biblio" href="#biblio-defaults" title="Sanitizer API Defaults">[DEFAULTS]</a> script. It is expected that these
    values will be updated to include additional HTML elements as they are
    introduced in user agents.</p>
   <h3 class="heading settled" id="baseline-element-allow-list"><span class="content">The Baseline Element Allow List</span><a class="self-link" href="#baseline-element-allow-list"></a></h3>
   <p>The built-in <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="baseline-element-allow-list①">baseline element allow list</dfn> has the following value:</p>
   <h3 class="heading settled" id="baseline-attribute-allow-list"><span class="content">The Baseline Attribute Allow List</span><a class="self-link" href="#baseline-attribute-allow-list"></a></h3>
   <p>The <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="baseline-attribute-allow-list①">baseline attribute allow list</dfn> has the following value:</p>
   <h3 class="heading settled" id="default-configuration-object"><span class="content">The Default Configuration Object</span><a class="self-link" href="#default-configuration-object"></a></h3>
   <p>The built-in <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="default-configuration">default configuration</dfn> has the following value:</p>
  </main>
  <script src="https://www.w3.org/scripts/TR/2021/fixup.js"></script>
  <h2 class="no-num no-ref heading settled" id="index"><span class="content">Index</span><a class="self-link" href="#index"></a></h2>
  <h3 class="no-num no-ref heading settled" id="index-defined-here"><span class="content">Terms defined by this specification</span><a class="self-link" href="#index-defined-here"></a></h3>
  <ul class="index">
   <li><a href="#dom-sanitizerconfig-allowattributes">allowAttributes</a><span>, in § 2.3</span>
   <li><a href="#dom-sanitizerconfig-allowcustomelements">allowCustomElements</a><span>, in § 2.3</span>
   <li><a href="#allow-custom-elements-option">allow custom elements option</a><span>, in § 2.3</span>
   <li><a href="#dom-sanitizerconfig-allowelements">allowElements</a><span>, in § 2.3</span>
   <li><a href="#attribute-allow-list">attribute allow list</a><span>, in § 2.3</span>
   <li><a href="#attribute-drop-list">attribute drop list</a><span>, in § 2.3</span>
   <li><a href="#attribute-kind">attribute kind</a><span>, in § 2.4.1</span>
   <li><a href="#attribute-match-list">attribute match list</a><span>, in § 2.3.1</span>
   <li><a href="#typedefdef-attributematchlist">AttributeMatchList</a><span>, in § 2.3.1</span>
   <li><a href="#baseline-attribute-allow-list①">baseline attribute allow list</a><span>, in § Unnumbered section</span>
   <li><a href="#baseline-element-allow-list①">baseline element allow list</a><span>, in § Unnumbered section</span>
   <li><a href="#dom-sanitizerconfig-blockelements">blockElements</a><span>, in § 2.3</span>
   <li><a href="#configuration-object">configuration object</a><span>, in § 2.3</span>
   <li><a href="#dom-sanitizer-sanitizer">constructor()</a><span>, in § 2.1</span>
   <li><a href="#dom-sanitizer-sanitizer">constructor(config)</a><span>, in § 2.1</span>
   <li><a href="#create-a-document-fragment">create a document fragment</a><span>, in § 2.4</span>
   <li><a href="#default-configuration">default configuration</a><span>, in § Unnumbered section</span>
   <li><a href="#determine-the-baseline-configuration-for-an-attribute">determine the baseline configuration for an attribute</a><span>, in § 2.4.2</span>
   <li><a href="#determine-the-baseline-configuration-for-an-element">determine the baseline configuration for an element</a><span>, in § 2.4.2</span>
   <li><a href="#determine-the-effective-configuration-for-an-attribute">determine the effective configuration for an attribute</a><span>, in § 2.4.1</span>
   <li><a href="#determine-the-effective-configuration-for-an-element">determine the effective configuration for an element</a><span>, in § 2.4.1</span>
   <li><a href="#dom-sanitizerconfig-dropattributes">dropAttributes</a><span>, in § 2.3</span>
   <li><a href="#dom-sanitizerconfig-dropelements">dropElements</a><span>, in § 2.3</span>
   <li><a href="#effective-attribute-configuration">effective attribute configuration</a><span>, in § 2.4.1</span>
   <li><a href="#effective-configuration">effective configuration</a><span>, in § 2.4.1</span>
   <li><a href="#effective-element-configuration">effective element configuration</a><span>, in § 2.4.1</span>
   <li><a href="#element-allow-list">element allow list</a><span>, in § 2.3</span>
   <li><a href="#element-block-list">element block list</a><span>, in § 2.3</span>
   <li><a href="#element-drop-list">element drop list</a><span>, in § 2.3</span>
   <li><a href="#element-kind">element kind</a><span>, in § 2.4.1</span>
   <li><a href="#handle-funky-elements">handle funky elements</a><span>, in § 2.4</span>
   <li><a href="#sanitize">sanitize</a><span>, in § 2.4</span>
   <li><a href="#sanitize-action">sanitize action</a><span>, in § 2.4.1</span>
   <li><a href="#sanitize-a-document-fragment">sanitize a document fragment</a><span>, in § 2.4</span>
   <li><a href="#sanitize-a-node">sanitize a node</a><span>, in § 2.4</span>
   <li><a href="#dom-sanitizer-sanitize">sanitize(input)</a><span>, in § 2.1</span>
   <li><a href="#sanitizer">Sanitizer</a><span>, in § 2.1</span>
   <li><a href="#dom-sanitizer-sanitizer">Sanitizer()</a><span>, in § 2.1</span>
   <li><a href="#dom-sanitizer-sanitizer">Sanitizer(config)</a><span>, in § 2.1</span>
   <li><a href="#dictdef-sanitizerconfig">SanitizerConfig</a><span>, in § 2.3</span>
   <li><a href="#typedefdef-sanitizerinput">SanitizerInput</a><span>, in § 2.2</span>
   <li><a href="#sanitizetostring">sanitizeToString</a><span>, in § 2.4</span>
   <li><a href="#dom-sanitizer-sanitizetostring">sanitizeToString(input)</a><span>, in § 2.1</span>
   <li><a href="#stricter-action">stricter action</a><span>, in § 2.4.1</span>
  </ul>
  <h3 class="no-num no-ref heading settled" id="index-defined-elsewhere"><span class="content">Terms defined by reference</span><a class="self-link" href="#index-defined-elsewhere"></a></h3>
  <ul class="index">
   <li>
    <a data-link-type="biblio">[]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="2823e871">Document</span>
     <li><span class="dfn-paneled" id="49a2843d">DocumentFragment</span>
     <li><span class="dfn-paneled" id="44d397b3">createDocumentFragment</span>
     <li><span class="dfn-paneled" id="d354f084">window.toStaticHTML()</span>
    </ul>
   <li>
    <a data-link-type="biblio">[DOM]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="296f3551">Element</span>
     <li><span class="dfn-paneled" id="543878fa">append</span>
     <li><span class="dfn-paneled" id="77211728">attribute list</span>
     <li><span class="dfn-paneled" id="44a7f1a1">clone a node</span>
     <li><span class="dfn-paneled" id="f20f4175">element interface</span>
     <li><span class="dfn-paneled" id="f9d909f7">inclusive descendant</span>
     <li><span class="dfn-paneled" id="25538777">tree order</span>
    </ul>
   <li>
    <a data-link-type="biblio">[DOM-Parsing]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="301b5ac7">innerHTML</span>
     <li><span class="dfn-paneled" id="a157637c">parseFromString</span>
    </ul>
   <li>
    <a data-link-type="biblio">[HTML]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="739f34ec">HTMLButtonElement</span>
     <li><span class="dfn-paneled" id="18c65a7a">HTMLFormElement</span>
     <li><span class="dfn-paneled" id="154d8845">HTMLHyperlinkElementUtils</span>
     <li><span class="dfn-paneled" id="83b269de">HTMLInputElement</span>
     <li><span class="dfn-paneled" id="f099a38d">HTMLTemplateElement</span>
     <li><span class="dfn-paneled" id="a0be88cd">HTMLUnknownElement</span>
     <li><span class="dfn-paneled" id="b6fb7a51">custom element</span>
     <li><span class="dfn-paneled" id="d5edabb5">html fragment serialization algorithm</span>
     <li><span class="dfn-paneled" id="1e02be0a">html parser</span>
     <li><span class="dfn-paneled" id="15c9cf79">valid custom element name</span>
    </ul>
   <li>
    <a data-link-type="biblio">[INFRA]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="f02cd417">iterate</span>
    </ul>
   <li>
    <a data-link-type="biblio">[WEBIDL]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="8855a9aa">DOMString</span>
     <li><span class="dfn-paneled" id="889e932f">Exposed</span>
     <li><span class="dfn-paneled" id="b75bb3bd">SecureContext</span>
     <li><span class="dfn-paneled" id="5372cca8">boolean</span>
     <li><span class="dfn-paneled" id="7787d359">record</span>
     <li><span class="dfn-paneled" id="9cce47fd">sequence</span>
    </ul>
  </ul>
  <h2 class="no-num no-ref heading settled" id="references"><span class="content">References</span><a class="self-link" href="#references"></a></h2>
  <h3 class="no-num no-ref heading settled" id="normative"><span class="content">Normative References</span><a class="self-link" href="#normative"></a></h3>
  <dl>
   <dt id="biblio-dom">[DOM]
   <dd>Anne van Kesteren. <a href="https://dom.spec.whatwg.org/"><cite>DOM Standard</cite></a>. Living Standard. URL: <a href="https://dom.spec.whatwg.org/">https://dom.spec.whatwg.org/</a>
   <dt id="biblio-dom-parsing">[DOM-Parsing]
   <dd>Travis Leithead. <a href="https://w3c.github.io/DOM-Parsing/"><cite>DOM Parsing and Serialization</cite></a>. URL: <a href="https://w3c.github.io/DOM-Parsing/">https://w3c.github.io/DOM-Parsing/</a>
   <dt id="biblio-html">[HTML]
   <dd>Anne van Kesteren; et al. <a href="https://html.spec.whatwg.org/multipage/"><cite>HTML Standard</cite></a>. Living Standard. URL: <a href="https://html.spec.whatwg.org/multipage/">https://html.spec.whatwg.org/multipage/</a>
   <dt id="biblio-infra">[INFRA]
   <dd>Anne van Kesteren; Domenic Denicola. <a href="https://infra.spec.whatwg.org/"><cite>Infra Standard</cite></a>. Living Standard. URL: <a href="https://infra.spec.whatwg.org/">https://infra.spec.whatwg.org/</a>
   <dt id="biblio-webidl">[WEBIDL]
   <dd>Edgar Chen; Timothy Gu. <a href="https://webidl.spec.whatwg.org/"><cite>Web IDL Standard</cite></a>. Living Standard. URL: <a href="https://webidl.spec.whatwg.org/">https://webidl.spec.whatwg.org/</a>
  </dl>
  <h3 class="no-num no-ref heading settled" id="informative"><span class="content">Informative References</span><a class="self-link" href="#informative"></a></h3>
  <dl>
   <dt id="biblio-defaults">[DEFAULTS]
   <dd><a href="https://github.com/WICG/sanitizer-api/blob/main/resources/defaults-derivation.html"><cite>Sanitizer API Defaults</cite></a>. URL: <a href="https://github.com/WICG/sanitizer-api/blob/main/resources/defaults-derivation.html">https://github.com/WICG/sanitizer-api/blob/main/resources/defaults-derivation.html</a>
   <dt id="biblio-dompurify">[DOMPURIFY]
   <dd><a href="https://github.com/cure53/DOMPurify"><cite>DOMPurify</cite></a>. URL: <a href="https://github.com/cure53/DOMPurify">https://github.com/cure53/DOMPurify</a>
   <dt id="biblio-url">[URL]
   <dd>Anne van Kesteren. <a href="https://url.spec.whatwg.org/"><cite>URL Standard</cite></a>. Living Standard. URL: <a href="https://url.spec.whatwg.org/">https://url.spec.whatwg.org/</a>
  </dl>
  <h2 class="no-num no-ref heading settled" id="idl-index"><span class="content">IDL Index</span><a class="self-link" href="#idl-index"></a></h2>
<pre class="idl highlight def">[
  <a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed"><c- g>Exposed</c-></a>=(<c- n>Window</c->),
  <a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#SecureContext"><c- g>SecureContext</c-></a>
] <c- b>interface</c-> <a href="#sanitizer"><code><c- g>Sanitizer</c-></code></a> {
  <a class="idl-code" data-link-type="constructor" href="#dom-sanitizer-sanitizer"><c- g>constructor</c-></a>(<c- b>optional</c-> <a data-link-type="idl-name" href="#dictdef-sanitizerconfig"><c- n>SanitizerConfig</c-></a> <a href="#dom-sanitizer-sanitizer-config-config"><code><c- g>config</c-></code></a> = {});
  <a data-link-type="idl-name" href="https://dom.spec.whatwg.org/#documentfragment"><c- n>DocumentFragment</c-></a> <a class="idl-code" data-link-type="method" href="#dom-sanitizer-sanitize"><c- g>sanitize</c-></a>(<a data-link-type="idl-name" href="#typedefdef-sanitizerinput"><c- n>SanitizerInput</c-></a> <a href="#dom-sanitizer-sanitize-input-input"><code><c- g>input</c-></code></a>);
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString"><c- b>DOMString</c-></a> <a class="idl-code" data-link-type="method" href="#dom-sanitizer-sanitizetostring"><c- g>sanitizeToString</c-></a>(<a data-link-type="idl-name" href="#typedefdef-sanitizerinput"><c- n>SanitizerInput</c-></a> <a href="#dom-sanitizer-sanitizetostring-input-input"><code><c- g>input</c-></code></a>);
};

<c- b>typedef</c-> (<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString"><c- b>DOMString</c-></a> <c- b>or</c-> <a data-link-type="idl-name" href="https://dom.spec.whatwg.org/#documentfragment"><c- n>DocumentFragment</c-></a> <c- b>or</c-> <a data-link-type="idl-name" href="https://dom.spec.whatwg.org/#interface-Document"><c- n>Document</c-></a>) <a href="#typedefdef-sanitizerinput"><code><c- g>SanitizerInput</c-></code></a>;

<c- b>dictionary</c-> <a href="#dictdef-sanitizerconfig"><code><c- g>SanitizerConfig</c-></code></a> {
  <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#idl-sequence"><c- b>sequence</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString"><c- b>DOMString</c-></a>> <a data-type="sequence<DOMString>" href="#dom-sanitizerconfig-allowelements"><code><c- g>allowElements</c-></code></a>;
  <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#idl-sequence"><c- b>sequence</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString"><c- b>DOMString</c-></a>> <a data-type="sequence<DOMString>" href="#dom-sanitizerconfig-blockelements"><code><c- g>blockElements</c-></code></a>;
  <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#idl-sequence"><c- b>sequence</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString"><c- b>DOMString</c-></a>> <a data-type="sequence<DOMString>" href="#dom-sanitizerconfig-dropelements"><code><c- g>dropElements</c-></code></a>;
  <a data-link-type="idl-name" href="#typedefdef-attributematchlist"><c- n>AttributeMatchList</c-></a> <a data-type="AttributeMatchList" href="#dom-sanitizerconfig-allowattributes"><code><c- g>allowAttributes</c-></code></a>;
  <a data-link-type="idl-name" href="#typedefdef-attributematchlist"><c- n>AttributeMatchList</c-></a> <a data-type="AttributeMatchList" href="#dom-sanitizerconfig-dropattributes"><code><c- g>dropAttributes</c-></code></a>;
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-boolean"><c- b>boolean</c-></a> <a data-type="boolean" href="#dom-sanitizerconfig-allowcustomelements"><code><c- g>allowCustomElements</c-></code></a>;
};

<c- b>typedef</c-> <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#idl-record"><c- b>record</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString"><c- b>DOMString</c-></a>, <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#idl-sequence"><c- b>sequence</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString"><c- b>DOMString</c-></a>>> <a href="#typedefdef-attributematchlist"><code><c- g>AttributeMatchList</c-></code></a>;

</pre>
  <h2 class="no-num no-ref heading settled" id="issues-index"><span class="content">Issues Index</span><a class="self-link" href="#issues-index"></a></h2>
  <div style="counter-reset:issue">
   <div class="issue"> It’s unclear whether we can assume a generic
  context for <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/DOM-Parsing/#widl-DOMParser-parseFromString-Document-DOMString-str-SupportedType-type">parseFromString</a></code>, or if we need to re-work the API to take
  the insertion context of the created fragment into account. <a href="https://github.com/WICG/sanitizer-api/issues/42">[Issue #WICG/sanitizer-api#42]</a> <a class="issue-return" href="#issue-8301a077" title="Jump to section">↵</a></div>
   <div class="issue"> What about comment nodes, CDATA, etc. ? <a class="issue-return" href="#issue-0e5b0c6b" title="Jump to section">↵</a></div>
   <div class="issue"> The spec currently treats MathML and SVG as <code>unknown</code> content and therefore blocked by default. This needs to be fixed. <a href="https://github.com/WICG/sanitizer-api/issues/72">[Issue #WICG/sanitizer-api#72]</a> <a class="issue-return" href="#issue-40748180" title="Jump to section">↵</a></div>
   <div class="issue"> The sanitizer baseline and defaults need to be carefully vetted, and
    are still under discussion. The values below are for illustrative
    purposes only. <a class="issue-return" href="#issue-53c87d03" title="Jump to section">↵</a></div>
  </div>
<script>/* Boilerplate: script-dom-helper */
"use strict";
function query(sel) { return document.querySelector(sel); }

function queryAll(sel) { return [...document.querySelectorAll(sel)]; }

function iter(obj) {
	if(!obj) return [];
	var it = obj[Symbol.iterator];
	if(it) return it;
	return Object.entries(obj);
}

function mk(tagname, attrs, ...children) {
	const el = document.createElement(tagname);
	for(const [k,v] of iter(attrs)) {
		if(k.slice(0,3) == "_on") {
			const eventName = k.slice(3);
			el.addEventListener(eventName, v);
		} else if(k[0] == "_") {
			// property, not attribute
			el[k.slice(1)] = v;
		} else {
			if(v === false || v == null) {
        continue;
      } else if(v === true) {
        el.setAttribute(k, "");
        continue;
      } else {
  			el.setAttribute(k, v);
      }
		}
	}
	append(el, children);
	return el;
}

/* Create shortcuts for every known HTML element */
[
  "a",
  "abbr",
  "acronym",
  "address",
  "applet",
  "area",
  "article",
  "aside",
  "audio",
  "b",
  "base",
  "basefont",
  "bdo",
  "big",
  "blockquote",
  "body",
  "br",
  "button",
  "canvas",
  "caption",
  "center",
  "cite",
  "code",
  "col",
  "colgroup",
  "datalist",
  "dd",
  "del",
  "details",
  "dfn",
  "dialog",
  "div",
  "dl",
  "dt",
  "em",
  "embed",
  "fieldset",
  "figcaption",
  "figure",
  "font",
  "footer",
  "form",
  "frame",
  "frameset",
  "head",
  "header",
  "h1",
  "h2",
  "h3",
  "h4",
  "h5",
  "h6",
  "hr",
  "html",
  "i",
  "iframe",
  "img",
  "input",
  "ins",
  "kbd",
  "label",
  "legend",
  "li",
  "link",
  "main",
  "map",
  "mark",
  "meta",
  "meter",
  "nav",
  "nobr",
  "noscript",
  "object",
  "ol",
  "optgroup",
  "option",
  "output",
  "p",
  "param",
  "pre",
  "progress",
  "q",
  "s",
  "samp",
  "script",
  "section",
  "select",
  "small",
  "source",
  "span",
  "strike",
  "strong",
  "style",
  "sub",
  "summary",
  "sup",
  "table",
  "tbody",
  "td",
  "template",
  "textarea",
  "tfoot",
  "th",
  "thead",
  "time",
  "title",
  "tr",
  "u",
  "ul",
  "var",
  "video",
  "wbr",
  "xmp",
].forEach(tagname=>{
	mk[tagname] = (...args) => mk(tagname, ...args);
});

function* nodesFromChildList(children) {
	for(const child of children.flat(Infinity)) {
		if(child instanceof Node) {
			yield child;
		} else {
			yield new Text(child);
		}
	}
}
function append(el, ...children) {
	for(const child of nodesFromChildList(children)) {
		if(el instanceof Node) el.appendChild(child);
		else el.push(child);
	}
	return el;
}

function insertAfter(el, ...children) {
	for(const child of nodesFromChildList(children)) {
		el.parentNode.insertBefore(child, el.nextSibling);
	}
	return el;
}

function clearContents(el) {
	el.innerHTML = "";
	return el;
}

function parseHTML(markup) {
	if(markup.toLowerCase().trim().indexOf('<!doctype') === 0) {
		const doc = document.implementation.createHTMLDocument("");
		doc.documentElement.innerHTML = markup;
		return doc;
	} else {
		const el = mk.template({});
		el.innerHTML = markup;
		return el.content;
	}
}</script>
<script>/* Boilerplate: script-dfn-panel */
"use strict";
{
let dfnPanelData = {
"154d8845": {"dfnID":"154d8845","dfnText":"HTMLHyperlinkElementUtils","external":true,"refSections":[{"refs":[{"id":"ref-for-htmlhyperlinkelementutils"}],"title":"2.4. Algorithms"}],"url":"https://html.spec.whatwg.org/multipage/links.html#htmlhyperlinkelementutils"},
"15c9cf79": {"dfnID":"15c9cf79","dfnText":"valid custom element name","external":true,"refSections":[{"refs":[{"id":"ref-for-valid-custom-element-name"}],"title":"2.4.1. The Effective Configuration"}],"url":"https://html.spec.whatwg.org/multipage/custom-elements.html#valid-custom-element-name"},
"18c65a7a": {"dfnID":"18c65a7a","dfnText":"HTMLFormElement","external":true,"refSections":[{"refs":[{"id":"ref-for-htmlformelement"}],"title":"2.4. Algorithms"}],"url":"https://html.spec.whatwg.org/multipage/forms.html#htmlformelement"},
"1e02be0a": {"dfnID":"1e02be0a","dfnText":"html parser","external":true,"refSections":[{"refs":[{"id":"ref-for-html-parser"}],"title":"2.2. Input Types"}],"url":"https://html.spec.whatwg.org/multipage/parsing.html#html-parser"},
"25538777": {"dfnID":"25538777","dfnText":"tree order","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-tree-order"}],"title":"2.4. Algorithms"}],"url":"https://dom.spec.whatwg.org/#concept-tree-order"},
"2823e871": {"dfnID":"2823e871","dfnText":"Document","external":true,"refSections":[{"refs":[{"id":"ref-for-interface-Document"}],"title":"2.2. Input Types"},{"refs":[{"id":"ref-for-interface-Document\u2460"}],"title":"2.4. Algorithms"}],"url":"https://dom.spec.whatwg.org/#interface-Document"},
"296f3551": {"dfnID":"296f3551","dfnText":"Element","external":true,"refSections":[{"refs":[{"id":"ref-for-element"}],"title":"1. Introduction"}],"url":"https://dom.spec.whatwg.org/#element"},
"301b5ac7": {"dfnID":"301b5ac7","dfnText":"innerHTML","external":true,"refSections":[{"refs":[{"id":"ref-for-widl-Element-innerHTML"}],"title":"1. Introduction"}],"url":"https://w3c.github.io/DOM-Parsing/#widl-Element-innerHTML"},
"44a7f1a1": {"dfnID":"44a7f1a1","dfnText":"clone a node","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-node-clone"}],"title":"2.4. Algorithms"}],"url":"https://dom.spec.whatwg.org/#concept-node-clone"},
"44d397b3": {"dfnID":"44d397b3","dfnText":"createDocumentFragment","external":true,"refSections":[{"refs":[{"id":"ref-for-dom-document-createdocumentfragment"}],"title":"2.4. Algorithms"}],"url":"https://dom.spec.whatwg.org/#dom-document-createdocumentfragment"},
"49a2843d": {"dfnID":"49a2843d","dfnText":"DocumentFragment","external":true,"refSections":[{"refs":[{"id":"ref-for-documentfragment"}],"title":"2.1. Sanitizer API"},{"refs":[{"id":"ref-for-documentfragment\u2460"},{"id":"ref-for-documentfragment\u2461"}],"title":"2.2. Input Types"},{"refs":[{"id":"ref-for-documentfragment\u2462"}],"title":"2.4. Algorithms"}],"url":"https://dom.spec.whatwg.org/#documentfragment"},
"5372cca8": {"dfnID":"5372cca8","dfnText":"boolean","external":true,"refSections":[{"refs":[{"id":"ref-for-idl-boolean"}],"title":"2.3. The Configuration Dictionary"}],"url":"https://webidl.spec.whatwg.org/#idl-boolean"},
"543878fa": {"dfnID":"543878fa","dfnText":"append","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-node-append"}],"title":"2.4. Algorithms"}],"url":"https://dom.spec.whatwg.org/#concept-node-append"},
"739f34ec": {"dfnID":"739f34ec","dfnText":"HTMLButtonElement","external":true,"refSections":[{"refs":[{"id":"ref-for-htmlbuttonelement"}],"title":"2.4. Algorithms"}],"url":"https://html.spec.whatwg.org/multipage/form-elements.html#htmlbuttonelement"},
"77211728": {"dfnID":"77211728","dfnText":"attribute list","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-element-attribute"}],"title":"2.4. Algorithms"}],"url":"https://dom.spec.whatwg.org/#concept-element-attribute"},
"7787d359": {"dfnID":"7787d359","dfnText":"record","external":true,"refSections":[{"refs":[{"id":"ref-for-idl-record"}],"title":"2.3.1. Attribute Match Lists"}],"url":"https://webidl.spec.whatwg.org/#idl-record"},
"83b269de": {"dfnID":"83b269de","dfnText":"HTMLInputElement","external":true,"refSections":[{"refs":[{"id":"ref-for-htmlinputelement"}],"title":"2.4. Algorithms"}],"url":"https://html.spec.whatwg.org/multipage/input.html#htmlinputelement"},
"8855a9aa": {"dfnID":"8855a9aa","dfnText":"DOMString","external":true,"refSections":[{"refs":[{"id":"ref-for-idl-DOMString"}],"title":"2.1. Sanitizer API"},{"refs":[{"id":"ref-for-idl-DOMString\u2460"}],"title":"2.2. Input Types"},{"refs":[{"id":"ref-for-idl-DOMString\u2461"},{"id":"ref-for-idl-DOMString\u2462"},{"id":"ref-for-idl-DOMString\u2463"}],"title":"2.3. The Configuration Dictionary"},{"refs":[{"id":"ref-for-idl-DOMString\u2464"},{"id":"ref-for-idl-DOMString\u2465"}],"title":"2.3.1. Attribute Match Lists"}],"url":"https://webidl.spec.whatwg.org/#idl-DOMString"},
"889e932f": {"dfnID":"889e932f","dfnText":"Exposed","external":true,"refSections":[{"refs":[{"id":"ref-for-Exposed"}],"title":"2.1. Sanitizer API"}],"url":"https://webidl.spec.whatwg.org/#Exposed"},
"9cce47fd": {"dfnID":"9cce47fd","dfnText":"sequence","external":true,"refSections":[{"refs":[{"id":"ref-for-idl-sequence"},{"id":"ref-for-idl-sequence\u2460"},{"id":"ref-for-idl-sequence\u2461"}],"title":"2.3. The Configuration Dictionary"},{"refs":[{"id":"ref-for-idl-sequence\u2462"}],"title":"2.3.1. Attribute Match Lists"}],"url":"https://webidl.spec.whatwg.org/#idl-sequence"},
"a0be88cd": {"dfnID":"a0be88cd","dfnText":"HTMLUnknownElement","external":true,"refSections":[{"refs":[{"id":"ref-for-htmlunknownelement"}],"title":"2.4.1. The Effective Configuration"}],"url":"https://html.spec.whatwg.org/multipage/dom.html#htmlunknownelement"},
"a157637c": {"dfnID":"a157637c","dfnText":"parseFromString","external":true,"refSections":[{"refs":[{"id":"ref-for-widl-DOMParser-parseFromString-Document-DOMString-str-SupportedType-type"},{"id":"ref-for-widl-DOMParser-parseFromString-Document-DOMString-str-SupportedType-type\u2460"}],"title":"2.4. Algorithms"}],"url":"https://w3c.github.io/DOM-Parsing/#widl-DOMParser-parseFromString-Document-DOMString-str-SupportedType-type"},
"allow-custom-elements-option": {"dfnID":"allow-custom-elements-option","dfnText":"allow custom elements option","external":false,"refSections":[{"refs":[{"id":"ref-for-allow-custom-elements-option"}],"title":"2.4.1. The Effective Configuration"}],"url":"#allow-custom-elements-option"},
"attribute-allow-list": {"dfnID":"attribute-allow-list","dfnText":"attribute allow list","external":false,"refSections":[{"refs":[{"id":"ref-for-attribute-allow-list"},{"id":"ref-for-attribute-allow-list\u2460"},{"id":"ref-for-attribute-allow-list\u2461"}],"title":"2.4.1. The Effective Configuration"}],"url":"#attribute-allow-list"},
"attribute-drop-list": {"dfnID":"attribute-drop-list","dfnText":"attribute drop list","external":false,"refSections":[{"refs":[{"id":"ref-for-attribute-drop-list"}],"title":"2.4.1. The Effective Configuration"}],"url":"#attribute-drop-list"},
"attribute-kind": {"dfnID":"attribute-kind","dfnText":"attribute kind","external":false,"refSections":[{"refs":[{"id":"ref-for-attribute-kind"}],"title":"2.4.2. Baseline and Defaults"}],"url":"#attribute-kind"},
"attribute-match-list": {"dfnID":"attribute-match-list","dfnText":"attribute match list","external":false,"refSections":[{"refs":[{"id":"ref-for-attribute-match-list"},{"id":"ref-for-attribute-match-list\u2460"}],"title":"2.3. The Configuration Dictionary"},{"refs":[{"id":"ref-for-attribute-match-list\u2461"}],"title":"2.3.1. Attribute Match Lists"}],"url":"#attribute-match-list"},
"b6fb7a51": {"dfnID":"b6fb7a51","dfnText":"custom element","external":true,"refSections":[{"refs":[{"id":"ref-for-custom-element"}],"title":"2.3. The Configuration Dictionary"}],"url":"https://html.spec.whatwg.org/multipage/custom-elements.html#custom-element"},
"b75bb3bd": {"dfnID":"b75bb3bd","dfnText":"SecureContext","external":true,"refSections":[{"refs":[{"id":"ref-for-SecureContext"}],"title":"2.1. Sanitizer API"}],"url":"https://webidl.spec.whatwg.org/#SecureContext"},
"baseline-attribute-allow-list①": {"dfnID":"baseline-attribute-allow-list\u2460","dfnText":"baseline attribute allow list","external":false,"refSections":[{"refs":[{"id":"ref-for-baseline-attribute-allow-list\u2460"},{"id":"ref-for-baseline-attribute-allow-list\u2460\u2460"}],"title":"2.4.2. Baseline and Defaults"}],"url":"#baseline-attribute-allow-list\u2460"},
"baseline-element-allow-list①": {"dfnID":"baseline-element-allow-list\u2460","dfnText":"baseline element allow list","external":false,"refSections":[{"refs":[{"id":"ref-for-baseline-element-allow-list\u2460"},{"id":"ref-for-baseline-element-allow-list\u2460\u2460"}],"title":"2.4.2. Baseline and Defaults"}],"url":"#baseline-element-allow-list\u2460"},
"configuration-object": {"dfnID":"configuration-object","dfnText":"configuration object","external":false,"refSections":[{"refs":[{"id":"ref-for-configuration-object"}],"title":"2.1. Sanitizer API"},{"refs":[{"id":"ref-for-configuration-object\u2460"},{"id":"ref-for-configuration-object\u2461"},{"id":"ref-for-configuration-object\u2462"},{"id":"ref-for-configuration-object\u2463"}],"title":"2.4.1. The Effective Configuration"}],"url":"#configuration-object"},
"create-a-document-fragment": {"dfnID":"create-a-document-fragment","dfnText":"create a document fragment","external":false,"refSections":[{"refs":[{"id":"ref-for-create-a-document-fragment"},{"id":"ref-for-create-a-document-fragment\u2460"}],"title":"2.4. Algorithms"}],"url":"#create-a-document-fragment"},
"d354f084": {"dfnID":"d354f084","dfnText":"window.toStaticHTML()","external":true,"refSections":[{"refs":[{"id":"ref-for-something"}],"title":"4. Acknowledgements"}],"url":"https://msdn.microsoft.com/en-us/library/cc848922(v=vs.85).aspx"},
"d5edabb5": {"dfnID":"d5edabb5","dfnText":"html fragment serialization algorithm","external":true,"refSections":[{"refs":[{"id":"ref-for-html-fragment-serialisation-algorithm"}],"title":"2.4. Algorithms"}],"url":"https://html.spec.whatwg.org/multipage/parsing.html#html-fragment-serialisation-algorithm"},
"default-configuration": {"dfnID":"default-configuration","dfnText":"default configuration","external":false,"refSections":[{"refs":[{"id":"ref-for-default-configuration"}],"title":"2.3. The Configuration Dictionary"},{"refs":[{"id":"ref-for-default-configuration\u2460"},{"id":"ref-for-default-configuration\u2461"}],"title":"2.4.1. The Effective Configuration"},{"refs":[{"id":"ref-for-default-configuration\u2462"},{"id":"ref-for-default-configuration\u2463"}],"title":"2.4.2. Baseline and Defaults"}],"url":"#default-configuration"},
"determine-the-baseline-configuration-for-an-attribute": {"dfnID":"determine-the-baseline-configuration-for-an-attribute","dfnText":"determine the baseline configuration for an attribute","external":false,"refSections":[{"refs":[{"id":"ref-for-determine-the-baseline-configuration-for-an-attribute"}],"title":"2.4.1. The Effective Configuration"}],"url":"#determine-the-baseline-configuration-for-an-attribute"},
"determine-the-baseline-configuration-for-an-element": {"dfnID":"determine-the-baseline-configuration-for-an-element","dfnText":"determine the baseline configuration for an element","external":false,"refSections":[{"refs":[{"id":"ref-for-determine-the-baseline-configuration-for-an-element"}],"title":"2.4.1. The Effective Configuration"}],"url":"#determine-the-baseline-configuration-for-an-element"},
"determine-the-effective-configuration-for-an-attribute": {"dfnID":"determine-the-effective-configuration-for-an-attribute","dfnText":"determine the effective configuration for an attribute","external":false,"refSections":[{"refs":[{"id":"ref-for-determine-the-effective-configuration-for-an-attribute"}],"title":"2.4.1. The Effective Configuration"}],"url":"#determine-the-effective-configuration-for-an-attribute"},
"determine-the-effective-configuration-for-an-element": {"dfnID":"determine-the-effective-configuration-for-an-element","dfnText":"determine the effective configuration for an element","external":false,"refSections":[{"refs":[{"id":"ref-for-determine-the-effective-configuration-for-an-element"}],"title":"2.4.1. The Effective Configuration"}],"url":"#determine-the-effective-configuration-for-an-element"},
"dictdef-sanitizerconfig": {"dfnID":"dictdef-sanitizerconfig","dfnText":"SanitizerConfig","external":false,"refSections":[{"refs":[{"id":"ref-for-dictdef-sanitizerconfig"}],"title":"2.1. Sanitizer API"}],"url":"#dictdef-sanitizerconfig"},
"dom-sanitizer-sanitize": {"dfnID":"dom-sanitizer-sanitize","dfnText":"sanitize(input)","external":false,"refSections":[{"refs":[{"id":"ref-for-dom-sanitizer-sanitize"}],"title":"2.1. Sanitizer API"}],"url":"#dom-sanitizer-sanitize"},
"dom-sanitizer-sanitize-input-input": {"dfnID":"dom-sanitizer-sanitize-input-input","dfnText":"input","external":false,"refSections":[],"url":"#dom-sanitizer-sanitize-input-input"},
"dom-sanitizer-sanitizer": {"dfnID":"dom-sanitizer-sanitizer","dfnText":"\n  new Sanitizer(config)","external":false,"refSections":[{"refs":[{"id":"ref-for-dom-sanitizer-sanitizer"}],"title":"2.1. Sanitizer API"}],"url":"#dom-sanitizer-sanitizer"},
"dom-sanitizer-sanitizer-config-config": {"dfnID":"dom-sanitizer-sanitizer-config-config","dfnText":"config","external":false,"refSections":[],"url":"#dom-sanitizer-sanitizer-config-config"},
"dom-sanitizer-sanitizetostring": {"dfnID":"dom-sanitizer-sanitizetostring","dfnText":"sanitizeToString(input)","external":false,"refSections":[{"refs":[{"id":"ref-for-dom-sanitizer-sanitizetostring"}],"title":"2.1. Sanitizer API"}],"url":"#dom-sanitizer-sanitizetostring"},
"dom-sanitizer-sanitizetostring-input-input": {"dfnID":"dom-sanitizer-sanitizetostring-input-input","dfnText":"input","external":false,"refSections":[],"url":"#dom-sanitizer-sanitizetostring-input-input"},
"dom-sanitizerconfig-allowattributes": {"dfnID":"dom-sanitizerconfig-allowattributes","dfnText":"allowAttributes","external":false,"refSections":[],"url":"#dom-sanitizerconfig-allowattributes"},
"dom-sanitizerconfig-allowcustomelements": {"dfnID":"dom-sanitizerconfig-allowcustomelements","dfnText":"allowCustomElements","external":false,"refSections":[],"url":"#dom-sanitizerconfig-allowcustomelements"},
"dom-sanitizerconfig-allowelements": {"dfnID":"dom-sanitizerconfig-allowelements","dfnText":"allowElements","external":false,"refSections":[],"url":"#dom-sanitizerconfig-allowelements"},
"dom-sanitizerconfig-blockelements": {"dfnID":"dom-sanitizerconfig-blockelements","dfnText":"blockElements","external":false,"refSections":[],"url":"#dom-sanitizerconfig-blockelements"},
"dom-sanitizerconfig-dropattributes": {"dfnID":"dom-sanitizerconfig-dropattributes","dfnText":"dropAttributes","external":false,"refSections":[],"url":"#dom-sanitizerconfig-dropattributes"},
"dom-sanitizerconfig-dropelements": {"dfnID":"dom-sanitizerconfig-dropelements","dfnText":"dropElements","external":false,"refSections":[],"url":"#dom-sanitizerconfig-dropelements"},
"effective-attribute-configuration": {"dfnID":"effective-attribute-configuration","dfnText":"effective attribute configuration","external":false,"refSections":[{"refs":[{"id":"ref-for-effective-attribute-configuration"}],"title":"2.4. Algorithms"}],"url":"#effective-attribute-configuration"},
"effective-configuration": {"dfnID":"effective-configuration","dfnText":"effective configuration","external":false,"refSections":[],"url":"#effective-configuration"},
"effective-element-configuration": {"dfnID":"effective-element-configuration","dfnText":"effective element configuration","external":false,"refSections":[{"refs":[{"id":"ref-for-effective-element-configuration"}],"title":"2.4. Algorithms"}],"url":"#effective-element-configuration"},
"element-allow-list": {"dfnID":"element-allow-list","dfnText":"element allow list","external":false,"refSections":[{"refs":[{"id":"ref-for-element-allow-list"},{"id":"ref-for-element-allow-list\u2460"},{"id":"ref-for-element-allow-list\u2461"},{"id":"ref-for-element-allow-list\u2462"}],"title":"2.4.1. The Effective Configuration"}],"url":"#element-allow-list"},
"element-block-list": {"dfnID":"element-block-list","dfnText":"element block list","external":false,"refSections":[{"refs":[{"id":"ref-for-element-block-list"}],"title":"2.4.1. The Effective Configuration"}],"url":"#element-block-list"},
"element-drop-list": {"dfnID":"element-drop-list","dfnText":"element drop list","external":false,"refSections":[{"refs":[{"id":"ref-for-element-drop-list"}],"title":"2.4.1. The Effective Configuration"}],"url":"#element-drop-list"},
"element-kind": {"dfnID":"element-kind","dfnText":"element kind","external":false,"refSections":[{"refs":[{"id":"ref-for-element-kind"}],"title":"2.4.1. The Effective Configuration"},{"refs":[{"id":"ref-for-element-kind\u2460"}],"title":"2.4.2. Baseline and Defaults"}],"url":"#element-kind"},
"f02cd417": {"dfnID":"f02cd417","dfnText":"iterate","external":true,"refSections":[{"refs":[{"id":"ref-for-list-iterate"},{"id":"ref-for-list-iterate\u2460"},{"id":"ref-for-list-iterate\u2461"}],"title":"2.4. Algorithms"}],"url":"https://infra.spec.whatwg.org/#list-iterate"},
"f099a38d": {"dfnID":"f099a38d","dfnText":"HTMLTemplateElement","external":true,"refSections":[{"refs":[{"id":"ref-for-htmltemplateelement"}],"title":"2.4. Algorithms"}],"url":"https://html.spec.whatwg.org/multipage/scripting.html#htmltemplateelement"},
"f20f4175": {"dfnID":"f20f4175","dfnText":"element interface","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-element-interface"},{"id":"ref-for-concept-element-interface\u2460"},{"id":"ref-for-concept-element-interface\u2461"},{"id":"ref-for-concept-element-interface\u2462"}],"title":"2.4. Algorithms"},{"refs":[{"id":"ref-for-concept-element-interface\u2463"}],"title":"2.4.1. The Effective Configuration"}],"url":"https://dom.spec.whatwg.org/#concept-element-interface"},
"f9d909f7": {"dfnID":"f9d909f7","dfnText":"inclusive descendant","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-tree-inclusive-descendant"}],"title":"2.4. Algorithms"}],"url":"https://dom.spec.whatwg.org/#concept-tree-inclusive-descendant"},
"handle-funky-elements": {"dfnID":"handle-funky-elements","dfnText":"handle funky elements","external":false,"refSections":[{"refs":[{"id":"ref-for-handle-funky-elements"}],"title":"2.4. Algorithms"}],"url":"#handle-funky-elements"},
"sanitize": {"dfnID":"sanitize","dfnText":"sanitize","external":false,"refSections":[{"refs":[{"id":"ref-for-sanitize"}],"title":"2.1. Sanitizer API"},{"refs":[{"id":"ref-for-sanitize\u2460"}],"title":"2.4. Algorithms"}],"url":"#sanitize"},
"sanitize-a-document-fragment": {"dfnID":"sanitize-a-document-fragment","dfnText":"sanitize a document fragment","external":false,"refSections":[{"refs":[{"id":"ref-for-sanitize-a-document-fragment"},{"id":"ref-for-sanitize-a-document-fragment\u2460"}],"title":"2.4. Algorithms"}],"url":"#sanitize-a-document-fragment"},
"sanitize-a-node": {"dfnID":"sanitize-a-node","dfnText":"sanitize a node","external":false,"refSections":[{"refs":[{"id":"ref-for-sanitize-a-node"}],"title":"2.4. Algorithms"}],"url":"#sanitize-a-node"},
"sanitize-action": {"dfnID":"sanitize-action","dfnText":"sanitize action","external":false,"refSections":[{"refs":[{"id":"ref-for-sanitize-action"}],"title":"2.4. Algorithms"},{"refs":[{"id":"ref-for-sanitize-action\u2460"},{"id":"ref-for-sanitize-action\u2461"}],"title":"2.4.1. The Effective Configuration"}],"url":"#sanitize-action"},
"sanitizer": {"dfnID":"sanitizer","dfnText":"Sanitizer","external":false,"refSections":[],"url":"#sanitizer"},
"sanitizetostring": {"dfnID":"sanitizetostring","dfnText":"sanitizeToString","external":false,"refSections":[{"refs":[{"id":"ref-for-sanitizetostring"}],"title":"2.1. Sanitizer API"}],"url":"#sanitizetostring"},
"stricter-action": {"dfnID":"stricter-action","dfnText":"stricter action","external":false,"refSections":[{"refs":[{"id":"ref-for-stricter-action"},{"id":"ref-for-stricter-action\u2460"}],"title":"2.4.1. The Effective Configuration"}],"url":"#stricter-action"},
"typedefdef-attributematchlist": {"dfnID":"typedefdef-attributematchlist","dfnText":"AttributeMatchList","external":false,"refSections":[{"refs":[{"id":"ref-for-typedefdef-attributematchlist"},{"id":"ref-for-typedefdef-attributematchlist\u2460"}],"title":"2.3. The Configuration Dictionary"}],"url":"#typedefdef-attributematchlist"},
"typedefdef-sanitizerinput": {"dfnID":"typedefdef-sanitizerinput","dfnText":"SanitizerInput","external":false,"refSections":[{"refs":[{"id":"ref-for-typedefdef-sanitizerinput"},{"id":"ref-for-typedefdef-sanitizerinput\u2460"}],"title":"2.1. Sanitizer API"},{"refs":[{"id":"ref-for-typedefdef-sanitizerinput\u2461"},{"id":"ref-for-typedefdef-sanitizerinput\u2462"},{"id":"ref-for-typedefdef-sanitizerinput\u2463"}],"title":"2.4. Algorithms"}],"url":"#typedefdef-sanitizerinput"},
};

document.addEventListener("DOMContentLoaded", ()=>{
    genAllDfnPanels();

    document.body.addEventListener("click", (e) => {
        // If not handled already, just hide all dfn panels.
        hideAllDfnPanels();
    });
});

window.addEventListener("resize", () => {
    // Pin any visible dfn panel
    queryAll(".dfn-panel.on, .dfn-panel.activated").forEach(el=>positionDfnPanel(el));
});

function genAllDfnPanels() {
    for(const panelData of Object.values(dfnPanelData)) {
        const dfnID = panelData.dfnID;
        const dfn = document.getElementById(dfnID);
        if(!dfn) {
            console.log(`Can't find dfn#${dfnID}.`, panelData);
            continue;
        }
        dfn.panelData = panelData;
        insertDfnPopupAction(dfn);
    }
}

function genDfnPanel(dfn, { dfnID, url, dfnText, refSections, external }) {
    const dfnPanel = mk.aside({
        class: "dfn-panel on",
        id: `infopanel-for-${dfnID}`,
        "data-for": dfnID,
        "aria-labelled-by":`infopaneltitle-for-${dfnID}`,
        },
        mk.span({id:`infopaneltitle-for-${dfnID}`, style:"display:none"},
            `Info about the '${dfnText}' ${external?"external":""} reference.`),
        mk.a({href:url, class:"dfn-link"}, url),
        refSections.length == 0 ? [] :
            mk.b({}, "Referenced in:"),
            mk.ul({},
                ...refSections.map(section=>
                    mk.li({},
                        ...section.refs.map((ref, refI)=>
                            [
                                mk.a({ href: `#${ref.id}` },
                                    (refI == 0) ? section.title : `(${refI + 1})`
                                ),
                                " ",
                            ]
                        ),
                    ),
                ),
            ),
        genLinkingSyntaxes(dfn),
    );

    dfnPanel.addEventListener('click', (event) => {
        if (event.target.nodeName == 'A') {
            scrollToTargetAndHighlight(event);
            pinDfnPanel(dfnPanel);
        }
        event.stopPropagation();
        refocusOnTarget(event);
    });
    dfnPanel.addEventListener('keydown', (event) => {
        if(event.keyCode == 27) { // Escape key
            hideDfnPanel({dfnPanel});
            event.stopPropagation();
            event.preventDefault();
        }
    });

    dfnPanel.dfn = dfn;
    dfn.dfnPanel = dfnPanel;
    return dfnPanel;
}



function hideAllDfnPanels() {
    // Delete the currently-active dfn panel.
    queryAll(".dfn-panel").forEach(dfnPanel=>hideDfnPanel({dfnPanel}));
}

function showDfnPanel(dfn) {
    hideAllDfnPanels(); // Only display one at a time.

    dfn.setAttribute("aria-expanded", "true");

    const dfnPanel = genDfnPanel(dfn, dfn.panelData);

    // Give the dfn a unique tabindex, and then
    // give all the tabbable panel bits successive indexes.
    let tabIndex = 100;
    dfn.tabIndex = tabIndex++;
    const tabbable = dfnPanel.querySelectorAll(":is(a, button)");
    for (const el of tabbable) {
        el.tabIndex = tabIndex++;
    }

    append(document.body, dfnPanel);
    positionDfnPanel(dfnPanel);
}

function positionDfnPanel(dfnPanel) {
    const dfn = dfnPanel.dfn;
    const dfnPos = getBounds(dfn);
    dfnPanel.style.top = dfnPos.bottom + "px";
    dfnPanel.style.left = dfnPos.left + "px";

    const panelPos = dfnPanel.getBoundingClientRect();
    const panelMargin = 8;
    const maxRight = document.body.parentNode.clientWidth - panelMargin;
    if (panelPos.right > maxRight) {
        const overflowAmount = panelPos.right - maxRight;
        const newLeft = Math.max(panelMargin, dfnPos.left - overflowAmount);
        dfnPanel.style.left = newLeft + "px";
    }
}

function pinDfnPanel(dfnPanel) {
    // Switch it to "activated" state, which pins it.
    dfnPanel.classList.add("activated");
    dfnPanel.style.position = "fixed";
    dfnPanel.style.left = null;
    dfnPanel.style.top = null;
}

function hideDfnPanel({dfn, dfnPanel}) {
    if(!dfnPanel) dfnPanel = dfn.dfnPanel;
    if(!dfn) dfn = dfnPanel.dfn;
    dfn.dfnPanel = undefined;
    dfnPanel.dfn = undefined;
    dfn.setAttribute("aria-expanded", "false");
    dfn.tabIndex = undefined;
    dfnPanel.remove()
}

function toggleDfnPanel(dfn) {
    if(dfn.dfnPanel) {
        hideDfnPanel(dfn);
    } else {
        showDfnPanel(dfn);
    }
}

function insertDfnPopupAction(dfn) {
    dfn.setAttribute('role', 'button');
    dfn.setAttribute('aria-expanded', 'false')
    dfn.tabIndex = 0;
    dfn.classList.add('has-dfn-panel');
    dfn.addEventListener('click', (event) => {
        toggleDfnPanel(dfn);
        event.stopPropagation();
    });
    dfn.addEventListener('keypress', (event) => {
        const kc = event.keyCode;
        // 32->Space, 13->Enter
        if(kc == 32 || kc == 13) {
            toggleDfnPanel(dfn);
            event.stopPropagation();
            event.preventDefault();
        }
    });
}

function refocusOnTarget(event) {
    const target = event.target;
    setTimeout(() => {
        // Refocus on the event.target element.
        // This is needed after browser scrolls to the destination.
        target.focus();
    });
}

// TODO: shared util
// Returns the root-level absolute position {left and top} of element.
function getBounds(el, relativeTo=document.body) {
    const relativeRect = relativeTo.getBoundingClientRect();
    const elRect = el.getBoundingClientRect();
    const top = elRect.top - relativeRect.top;
    const left = elRect.left - relativeRect.left;
    return {
        top,
        left,
        bottom: top + elRect.height,
        right: left + elRect.width,
    }
}

function scrollToTargetAndHighlight(event) {
    let hash = event.target.hash;
    if (hash) {
        hash = decodeURIComponent(hash.substring(1));
        const dest = document.getElementById(hash);
        if (dest) {
            dest.classList.add('highlighted');
            setTimeout(() => dest.classList.remove('highlighted'), 1000);
        }
    }
}

// Functions, divided by link type, that wrap an autolink's
// contents with the appropriate outer syntax.
// Alternately, a string naming another type they format
// the same as.
function needsFor(type) {
    switch(type) {
        case "descriptor":
        case "value":
        case "element-attr":
        case "attr-value":
        case "element-state":
        case "method":
        case "constructor":
        case "argument":
        case "attribute":
        case "const":
        case "dict-member":
        case "event":
        case "enum-value":
        case "stringifier":
        case "serializer":
        case "iterator":
        case "maplike":
        case "setlike":
        case "state":
        case "mode":
        case "context":
        case "facet": return true;

        default: return false;
    }
}
function refusesFor(type) {
    switch(type) {
        case "property":
        case "element":
        case "interface":
        case "namespace":
        case "callback":
        case "dictionary":
        case "enum":
        case "exception":
        case "typedef":
        case "http-header":
        case "permission": return true;

        default: return false;
    }
}
function linkFormatterFromType(type) {
    switch(type) {
        case 'scheme':
        case 'permission':
        case 'dfn': return (text) => `[=${text}=]`;

        case 'abstract-op': return (text) => `[\$${text}\$]`;

        case 'function':
        case 'at-rule':
        case 'selector':
        case 'value': return (text) => `''${text}''`;

        case 'http-header': return (text) => `[:${text}:]`;

        case 'interface':
        case 'constructor':
        case 'method':
        case 'argument':
        case 'attribute':
        case 'callback':
        case 'dictionary':
        case 'dict-member':
        case 'enum':
        case 'enum-value':
        case 'exception':
        case 'const':
        case 'typedef':
        case 'stringifier':
        case 'serializer':
        case 'iterator':
        case 'maplike':
        case 'setlike':
        case 'extended-attribute':
        case 'event':
        case 'idl': return (text) => `{{${text}}}`;

        case 'element-state':
        case 'element-attr':
        case 'attr-value':
        case 'element': return (element) => `<{${element}}>`;

        case 'grammar': return (text) => `${text} (within a <pre class=prod>)`;

        case 'type': return (text)=> `<<${text}>>`;

        case 'descriptor':
        case 'property': return (text) => `'${text}'`;

        default: return;
    };
};

function genLinkingSyntaxes(dfn) {
    if(dfn.tagName != "DFN") return;

    const type = dfn.getAttribute('data-dfn-type');
    if(!type) {
        console.log(`<dfn> doesn't have a data-dfn-type:`, dfn);
        return [];
    }

    // Return a function that wraps link text based on the type
    const linkFormatter = linkFormatterFromType(type);
    if(!linkFormatter) {
        console.log(`<dfn> has an unknown data-dfn-type:`, dfn);
        return [];
    }

    let ltAlts;
    if(dfn.hasAttribute('data-lt')) {
        ltAlts = dfn.getAttribute('data-lt')
            .split("|")
            .map(x=>x.trim());
    } else {
        ltAlts = [dfn.textContent.trim()];
    }
    if(type == "type") {
        // lt of "<foo>", but "foo" is the interior;
        // <<foo/bar>> is how you write it with a for,
        // not <foo/<bar>> or whatever.
        for(var i = 0; i < ltAlts.length; i++) {
            const lt = ltAlts[i];
            const match = /<(.*)>/.exec(lt);
            if(match) { ltAlts[i] = match[1]; }
        }
    }

    let forAlts;
    if(dfn.hasAttribute('data-dfn-for')) {
        forAlts = dfn.getAttribute('data-dfn-for')
            .split(",")
            .map(x=>x.trim());
    } else {
        forAlts = [''];
    }

    let linkingSyntaxes = [];
    if(!needsFor(type)) {
        for(const lt of ltAlts) {
            linkingSyntaxes.push(linkFormatter(lt));
        }
    }
    if(!refusesFor(type)) {
        for(const f of forAlts) {
            linkingSyntaxes.push(linkFormatter(`${f}/${ltAlts[0]}`))
        }
    }
    return [
        mk.b({}, 'Possible linking syntaxes:'),
        mk.ul({},
            ...linkingSyntaxes.map(link => {
                const copyLink = async () =>
                    await navigator.clipboard.writeText(link);
                return mk.li({},
                    mk.div({ class: 'link-item' },
                        mk.button({
                            class: 'copy-icon', title: 'Copy',
                            type: 'button',
                            _onclick: copyLink,
                            tabindex: 0,
                        }, mk.span({ class: 'icon' }) ),
                        mk.span({}, link)
                    )
                );
            })
        )
    ];
}
}
</script>
<script>/* Boilerplate: script-ref-hints */
"use strict";
{
let refsData = {
"#allow-custom-elements-option": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"sanitizer-api","spec":"sanitizer-api-1","status":"local","text":"allow custom elements option","type":"dfn","url":"#allow-custom-elements-option"},
"#attribute-allow-list": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"sanitizer-api","spec":"sanitizer-api-1","status":"local","text":"attribute allow list","type":"dfn","url":"#attribute-allow-list"},
"#attribute-drop-list": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"sanitizer-api","spec":"sanitizer-api-1","status":"local","text":"attribute drop list","type":"dfn","url":"#attribute-drop-list"},
"#attribute-kind": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"sanitizer-api","spec":"sanitizer-api-1","status":"local","text":"attribute kind","type":"dfn","url":"#attribute-kind"},
"#attribute-match-list": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"sanitizer-api","spec":"sanitizer-api-1","status":"local","text":"attribute match list","type":"dfn","url":"#attribute-match-list"},
"#baseline-attribute-allow-list①": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"sanitizer-api","spec":"sanitizer-api-1","status":"local","text":"baseline attribute allow list","type":"dfn","url":"#baseline-attribute-allow-list\u2460"},
"#baseline-element-allow-list①": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"sanitizer-api","spec":"sanitizer-api-1","status":"local","text":"baseline element allow list","type":"dfn","url":"#baseline-element-allow-list\u2460"},
"#configuration-object": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"sanitizer-api","spec":"sanitizer-api-1","status":"local","text":"configuration object","type":"dfn","url":"#configuration-object"},
"#create-a-document-fragment": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"sanitizer-api","spec":"sanitizer-api-1","status":"local","text":"create a document fragment","type":"dfn","url":"#create-a-document-fragment"},
"#default-configuration": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"sanitizer-api","spec":"sanitizer-api-1","status":"local","text":"default configuration","type":"dfn","url":"#default-configuration"},
"#determine-the-baseline-configuration-for-an-attribute": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"sanitizer-api","spec":"sanitizer-api-1","status":"local","text":"determine the baseline configuration for an attribute","type":"dfn","url":"#determine-the-baseline-configuration-for-an-attribute"},
"#determine-the-baseline-configuration-for-an-element": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"sanitizer-api","spec":"sanitizer-api-1","status":"local","text":"determine the baseline configuration for an element","type":"dfn","url":"#determine-the-baseline-configuration-for-an-element"},
"#determine-the-effective-configuration-for-an-attribute": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"sanitizer-api","spec":"sanitizer-api-1","status":"local","text":"determine the effective configuration for an attribute","type":"dfn","url":"#determine-the-effective-configuration-for-an-attribute"},
"#determine-the-effective-configuration-for-an-element": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"sanitizer-api","spec":"sanitizer-api-1","status":"local","text":"determine the effective configuration for an element","type":"dfn","url":"#determine-the-effective-configuration-for-an-element"},
"#dictdef-sanitizerconfig": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"sanitizer-api","spec":"sanitizer-api-1","status":"local","text":"SanitizerConfig","type":"dictionary","url":"#dictdef-sanitizerconfig"},
"#dom-sanitizer-sanitize": {"export":true,"for_":["Sanitizer"],"level":"1","normative":true,"shortname":"sanitizer-api","spec":"sanitizer-api-1","status":"local","text":"sanitize(input)","type":"method","url":"#dom-sanitizer-sanitize"},
"#dom-sanitizer-sanitizer": {"export":true,"for_":["Sanitizer"],"level":"1","normative":true,"shortname":"sanitizer-api","spec":"sanitizer-api-1","status":"local","text":"Sanitizer(config)","type":"constructor","url":"#dom-sanitizer-sanitizer"},
"#dom-sanitizer-sanitizetostring": {"export":true,"for_":["Sanitizer"],"level":"1","normative":true,"shortname":"sanitizer-api","spec":"sanitizer-api-1","status":"local","text":"sanitizeToString(input)","type":"method","url":"#dom-sanitizer-sanitizetostring"},
"#effective-attribute-configuration": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"sanitizer-api","spec":"sanitizer-api-1","status":"local","text":"effective attribute configuration","type":"dfn","url":"#effective-attribute-configuration"},
"#effective-element-configuration": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"sanitizer-api","spec":"sanitizer-api-1","status":"local","text":"effective element configuration","type":"dfn","url":"#effective-element-configuration"},
"#element-allow-list": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"sanitizer-api","spec":"sanitizer-api-1","status":"local","text":"element allow list","type":"dfn","url":"#element-allow-list"},
"#element-block-list": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"sanitizer-api","spec":"sanitizer-api-1","status":"local","text":"element block list","type":"dfn","url":"#element-block-list"},
"#element-drop-list": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"sanitizer-api","spec":"sanitizer-api-1","status":"local","text":"element drop list","type":"dfn","url":"#element-drop-list"},
"#element-kind": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"sanitizer-api","spec":"sanitizer-api-1","status":"local","text":"element kind","type":"dfn","url":"#element-kind"},
"#handle-funky-elements": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"sanitizer-api","spec":"sanitizer-api-1","status":"local","text":"handle funky elements","type":"dfn","url":"#handle-funky-elements"},
"#sanitize": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"sanitizer-api","spec":"sanitizer-api-1","status":"local","text":"sanitize","type":"dfn","url":"#sanitize"},
"#sanitize-a-document-fragment": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"sanitizer-api","spec":"sanitizer-api-1","status":"local","text":"sanitize a document fragment","type":"dfn","url":"#sanitize-a-document-fragment"},
"#sanitize-a-node": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"sanitizer-api","spec":"sanitizer-api-1","status":"local","text":"sanitize a node","type":"dfn","url":"#sanitize-a-node"},
"#sanitize-action": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"sanitizer-api","spec":"sanitizer-api-1","status":"local","text":"sanitize action","type":"dfn","url":"#sanitize-action"},
"#sanitizetostring": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"sanitizer-api","spec":"sanitizer-api-1","status":"local","text":"sanitizetostring","type":"dfn","url":"#sanitizetostring"},
"#stricter-action": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"sanitizer-api","spec":"sanitizer-api-1","status":"local","text":"stricter action","type":"dfn","url":"#stricter-action"},
"#typedefdef-attributematchlist": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"sanitizer-api","spec":"sanitizer-api-1","status":"local","text":"AttributeMatchList","type":"typedef","url":"#typedefdef-attributematchlist"},
"#typedefdef-sanitizerinput": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"sanitizer-api","spec":"sanitizer-api-1","status":"local","text":"SanitizerInput","type":"typedef","url":"#typedefdef-sanitizerinput"},
"https://dom.spec.whatwg.org/#concept-element-attribute": {"export":true,"for_":["Element"],"level":"1","normative":true,"shortname":"dom","spec":"dom","status":"current","text":"attribute list","type":"dfn","url":"https://dom.spec.whatwg.org/#concept-element-attribute"},
"https://dom.spec.whatwg.org/#concept-element-interface": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"dom","spec":"dom","status":"current","text":"element interface","type":"dfn","url":"https://dom.spec.whatwg.org/#concept-element-interface"},
"https://dom.spec.whatwg.org/#concept-node-append": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"dom","spec":"dom","status":"current","text":"append","type":"dfn","url":"https://dom.spec.whatwg.org/#concept-node-append"},
"https://dom.spec.whatwg.org/#concept-node-clone": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"dom","spec":"dom","status":"current","text":"clone a node","type":"dfn","url":"https://dom.spec.whatwg.org/#concept-node-clone"},
"https://dom.spec.whatwg.org/#concept-tree-inclusive-descendant": {"export":true,"for_":["tree"],"level":"1","normative":true,"shortname":"dom","spec":"dom","status":"current","text":"inclusive descendant","type":"dfn","url":"https://dom.spec.whatwg.org/#concept-tree-inclusive-descendant"},
"https://dom.spec.whatwg.org/#concept-tree-order": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"dom","spec":"dom","status":"current","text":"tree order","type":"dfn","url":"https://dom.spec.whatwg.org/#concept-tree-order"},
"https://dom.spec.whatwg.org/#documentfragment": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"sanitizer-api","spec":"","status":"anchor-block","text":"DocumentFragment","type":"interface","url":"https://dom.spec.whatwg.org/#documentfragment"},
"https://dom.spec.whatwg.org/#dom-document-createdocumentfragment": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"sanitizer-api","spec":"","status":"anchor-block","text":"createDocumentFragment","type":"method","url":"https://dom.spec.whatwg.org/#dom-document-createdocumentfragment"},
"https://dom.spec.whatwg.org/#element": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"dom","spec":"dom","status":"current","text":"Element","type":"interface","url":"https://dom.spec.whatwg.org/#element"},
"https://dom.spec.whatwg.org/#interface-Document": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"sanitizer-api","spec":"","status":"anchor-block","text":"Document","type":"interface","url":"https://dom.spec.whatwg.org/#interface-Document"},
"https://html.spec.whatwg.org/multipage/custom-elements.html#custom-element": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"custom element","type":"dfn","url":"https://html.spec.whatwg.org/multipage/custom-elements.html#custom-element"},
"https://html.spec.whatwg.org/multipage/custom-elements.html#valid-custom-element-name": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"valid custom element name","type":"dfn","url":"https://html.spec.whatwg.org/multipage/custom-elements.html#valid-custom-element-name"},
"https://html.spec.whatwg.org/multipage/dom.html#htmlunknownelement": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"HTMLUnknownElement","type":"interface","url":"https://html.spec.whatwg.org/multipage/dom.html#htmlunknownelement"},
"https://html.spec.whatwg.org/multipage/form-elements.html#htmlbuttonelement": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"HTMLButtonElement","type":"interface","url":"https://html.spec.whatwg.org/multipage/form-elements.html#htmlbuttonelement"},
"https://html.spec.whatwg.org/multipage/forms.html#htmlformelement": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"HTMLFormElement","type":"interface","url":"https://html.spec.whatwg.org/multipage/forms.html#htmlformelement"},
"https://html.spec.whatwg.org/multipage/input.html#htmlinputelement": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"HTMLInputElement","type":"interface","url":"https://html.spec.whatwg.org/multipage/input.html#htmlinputelement"},
"https://html.spec.whatwg.org/multipage/links.html#htmlhyperlinkelementutils": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"HTMLHyperlinkElementUtils","type":"interface","url":"https://html.spec.whatwg.org/multipage/links.html#htmlhyperlinkelementutils"},
"https://html.spec.whatwg.org/multipage/parsing.html#html-fragment-serialisation-algorithm": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"html fragment serialization algorithm","type":"dfn","url":"https://html.spec.whatwg.org/multipage/parsing.html#html-fragment-serialisation-algorithm"},
"https://html.spec.whatwg.org/multipage/parsing.html#html-parser": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"html parser","type":"dfn","url":"https://html.spec.whatwg.org/multipage/parsing.html#html-parser"},
"https://html.spec.whatwg.org/multipage/scripting.html#htmltemplateelement": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"HTMLTemplateElement","type":"interface","url":"https://html.spec.whatwg.org/multipage/scripting.html#htmltemplateelement"},
"https://infra.spec.whatwg.org/#list-iterate": {"export":true,"for_":["list","set"],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"iterate","type":"dfn","url":"https://infra.spec.whatwg.org/#list-iterate"},
"https://msdn.microsoft.com/en-us/library/cc848922(v=vs.85).aspx": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"sanitizer-api","spec":"","status":"anchor-block","text":"window.toStaticHTML()","type":"method","url":"https://msdn.microsoft.com/en-us/library/cc848922(v=vs.85).aspx"},
"https://w3c.github.io/DOM-Parsing/#widl-DOMParser-parseFromString-Document-DOMString-str-SupportedType-type": {"export":true,"for_":[],"level":"","normative":true,"shortname":"dom-parsing","spec":"dom-parsing","status":"anchor-block","text":"parseFromString","type":"method","url":"https://w3c.github.io/DOM-Parsing/#widl-DOMParser-parseFromString-Document-DOMString-str-SupportedType-type"},
"https://w3c.github.io/DOM-Parsing/#widl-Element-innerHTML": {"export":true,"for_":["Element"],"level":"","normative":true,"shortname":"dom-parsing","spec":"dom-parsing","status":"anchor-block","text":"innerHTML","type":"attribute","url":"https://w3c.github.io/DOM-Parsing/#widl-Element-innerHTML"},
"https://webidl.spec.whatwg.org/#Exposed": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"Exposed","type":"extended-attribute","url":"https://webidl.spec.whatwg.org/#Exposed"},
"https://webidl.spec.whatwg.org/#SecureContext": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"SecureContext","type":"extended-attribute","url":"https://webidl.spec.whatwg.org/#SecureContext"},
"https://webidl.spec.whatwg.org/#idl-DOMString": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"DOMString","type":"interface","url":"https://webidl.spec.whatwg.org/#idl-DOMString"},
"https://webidl.spec.whatwg.org/#idl-boolean": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"boolean","type":"interface","url":"https://webidl.spec.whatwg.org/#idl-boolean"},
"https://webidl.spec.whatwg.org/#idl-record": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"record","type":"dfn","url":"https://webidl.spec.whatwg.org/#idl-record"},
"https://webidl.spec.whatwg.org/#idl-sequence": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"sequence","type":"dfn","url":"https://webidl.spec.whatwg.org/#idl-sequence"},
};

function mkRefHint(link, ref) {
    const linkText = link.textContent;
    let dfnTextElements = '';
    if (ref.text != linkText) {
        dfnTextElements =
            mk.li({},
                mk.b({}, "Term: "),
                mk.span({}, ref.text)
            );
    }
    const forList = ref.for_;
    let forListElements;
    if(forList.length == 0) {
        forListElements = [];
    } else if(forList.length == 1) {
        forListElements = mk.li({},
            mk.b({}, "For: "),
            mk.span({}, forList[0]),
        );
    } else {
        forListElements = mk.li({},
            mk.b({}, "For: "),
            mk.ul({},
                ...forList.map(forItem =>
                    mk.li({},
                        mk.span({}, forItem)
                    ),
                ),
            ),
        );
    }
    const url = ref.url;
    const safeUrl = encodeURIComponent(url);
    const hintPanel = mk.aside({
        class: "ref-hint",
        id: `ref-hint-for-${safeUrl}`,
        "data-for": url,
        "aria-labelled-by": `ref-hint-for-${safeUrl}`,
    },
        mk.ul({},
            dfnTextElements,
            mk.li({},
                mk.b({}, "URL: "),
                mk.a({ href: url, class: "ref" }, url),
            ),
            mk.li({},
                mk.b({}, "Type: "),
                mk.span({}, `${ref.type}`),
            ),
            mk.li({},
                mk.b({}, "Spec: "),
                mk.span({}, `${ref.spec ? ref.spec : ''}`),
            ),
            forListElements
        ),
    );
    hintPanel.forLink = link;
    setupRefHintEventListeners(link, hintPanel);
    return hintPanel;
}

function hideAllRefHints() {
    queryAll(".ref-hint").forEach(el=>hideRefHint(el));
}

function hideRefHint(refHint) {
    const link = refHint.forLink;
    link.setAttribute("aria-expanded", "false");
    if(refHint.teardownEventListeners) {
        refHint.teardownEventListeners();
    }
    refHint.remove();
}

function showRefHint(link) {
    if(link.classList.contains("dfn-link")) return;
    const url = link.getAttribute("href");
    const ref = refsData[url];
    if(!ref) return;

    hideAllRefHints(); // Only display one at this time.

    const refHint = mkRefHint(link, ref);
    append(document.body, refHint);
    link.setAttribute("aria-expanded", "true");
    positionRefHint(refHint);
}

function setupRefHintEventListeners(link, refHint) {
    if (refHint.teardownEventListeners) return;
    // Add event handlers to hide the refHint after the user moves away
    // from both the link and refHint, if not hovering either within one second.
    let timeout = null;
    const startHidingRefHint = (event) => {
        if (timeout) {
            clearTimeout(timeout);
        }
        timeout = setTimeout(() => {
            hideRefHint(refHint);
        }, 1000);
    }
    const resetHidingRefHint = (event) => {
        if (timeout) clearTimeout(timeout);
        timeout = null;
    };
    link.addEventListener("mouseleave", startHidingRefHint);
    link.addEventListener("mouseenter", resetHidingRefHint);
    link.addEventListener("blur", startHidingRefHint);
    link.addEventListener("focus", resetHidingRefHint);
    refHint.addEventListener("mouseleave", startHidingRefHint);
    refHint.addEventListener("mouseenter", resetHidingRefHint);
    refHint.addEventListener("blur", startHidingRefHint);
    refHint.addEventListener("focus", resetHidingRefHint);

    refHint.teardownEventListeners = () => {
        // remove event listeners
        resetHidingRefHint();
        link.removeEventListener("mouseleave", startHidingRefHint);
        link.removeEventListener("mouseenter", resetHidingRefHint);
        link.removeEventListener("blur", startHidingRefHint);
        link.removeEventListener("focus", resetHidingRefHint);
        refHint.removeEventListener("mouseleave", startHidingRefHint);
        refHint.removeEventListener("mouseenter", resetHidingRefHint);
        refHint.removeEventListener("blur", startHidingRefHint);
        refHint.removeEventListener("focus", resetHidingRefHint);
    };
}

function positionRefHint(refHint) {
    const link = refHint.forLink;
    const linkPos = getBounds(link);
    refHint.style.top = linkPos.bottom + "px";
    refHint.style.left = linkPos.left + "px";

    const panelPos = refHint.getBoundingClientRect();
    const panelMargin = 8;
    const maxRight = document.body.parentNode.clientWidth - panelMargin;
    if (panelPos.right > maxRight) {
        const overflowAmount = panelPos.right - maxRight;
        const newLeft = Math.max(panelMargin, linkPos.left - overflowAmount);
        refHint.style.left = newLeft + "px";
    }
}

// TODO: shared util
// Returns the root-level absolute position {left and top} of element.
function getBounds(el, relativeTo=document.body) {
    const relativeRect = relativeTo.getBoundingClientRect();
    const elRect = el.getBoundingClientRect();
    const top = elRect.top - relativeRect.top;
    const left = elRect.left - relativeRect.left;
    return {
        top,
        left,
        bottom: top + elRect.height,
        right: left + elRect.width,
    }
}

function showRefHintListener(e) {
    // If the target isn't in a link (or is a link),
    // just ignore it.
    let link = e.target.closest("a");
    if(!link) return;

    // If the target is in a ref-hint panel
    // (aka a link in the already-open one),
    // also just ignore it.
    if(link.closest(".ref-hint")) return;

    // Otherwise, show the panel for the link.
    showRefHint(link);
}

function hideAllHintsListener(e) {
    // If the click is inside a ref-hint panel, ignore it.
    if(e.target.closest(".ref-hint")) return;
    // Otherwise, close all the current panels.
    hideAllRefHints();
}

document.addEventListener("DOMContentLoaded", () => {
    document.body.addEventListener("mousedown", showRefHintListener);
    document.body.addEventListener("focus", showRefHintListener);

    document.body.addEventListener("click", hideAllHintsListener);
});

window.addEventListener("resize", () => {
    // Hide any open ref hint.
    hideAllRefHints();
});
}
</script>
<script>/* Boilerplate: script-var-click-highlighting */
"use strict";
{
/*
Color-choosing design:

* Colors are ordered by goodness.
* On clicking a var, give it the earliest color
    with the lowest usage in the algorithm.
* On re-clicking, re-use the var's most recent color
    if that's not currently being used elsewhere.
*/

const COLOR_COUNT = 7;

document.addEventListener("click", e=>{
    if(e.target.nodeName == "VAR") {
        highlightSameAlgoVars(e.target);
    }
});

function highlightSameAlgoVars(v) {
    // Find the algorithm container.
    let algoContainer = findAlgoContainer(v);

    // Not highlighting document-global vars,
    // too likely to be unrelated.
    if(algoContainer == null) return;

    const varName = nameFromVar(v);
    if(!v.hasAttribute("data-var-color")) {
        const newColor = chooseHighlightColor(algoContainer, v);
        for(const el of algoContainer.querySelectorAll("var")) {
            if(nameFromVar(el) == varName) {
                el.setAttribute("data-var-color", newColor);
                el.setAttribute("data-var-last-color", newColor);
            }
        }
    } else {
        for(const el of algoContainer.querySelectorAll("var")) {
            if(nameFromVar(el) == varName) {
                el.removeAttribute("data-var-color");
            }
        }
    }
}
function findAlgoContainer(el) {
    while(el != document.body) {
        if(el.hasAttribute("data-algorithm")) return el;
        el = el.parentNode;
    }
    return null;
}
function nameFromVar(el) {
    return el.textContent.replace(/(\s|\xa0)+/g, " ").trim();
}
function colorCountsFromContainer(container) {
    const namesFromColor = Array.from({length:COLOR_COUNT}, x=>new Set());
    for(let v of container.querySelectorAll("var[data-var-color]")) {
        let color = +v.getAttribute("data-var-color");
        namesFromColor[color].add(nameFromVar(v));
    }

    return namesFromColor.map(x=>x.size);
}
function leastUsedColor(colors) {
    // Find the earliest color with the lowest count.
    let minCount = Infinity;
    let minColor = null;
    for(var i = 0; i < colors.length; i++) {
        if(colors[i] < minCount) {
            minColor = i;
            minCount = colors[i];
        }
    }
    return minColor;
}
function chooseHighlightColor(container, v) {
    const colorCounts = colorCountsFromContainer(container);
    if(v.hasAttribute("data-var-last-color")) {
        let color = +v.getAttribute("data-var-last-color");
        if(colorCounts[color] == 0) return color;
    }
    return leastUsedColor(colorCounts);
}
}
</script>