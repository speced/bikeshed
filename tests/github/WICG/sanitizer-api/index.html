<!doctype html><html lang="en">
 <head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
  <title>HTML Sanitizer API</title>
  <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
  <link href="https://www.w3.org/StyleSheets/TR/2021/cg-draft" rel="stylesheet">
  <link href="https://wicg.github.io/sanitizer-api/" rel="canonical">
<style>/* style-autolinks */

.css.css, .property.property, .descriptor.descriptor {
    color: var(--a-normal-text);
    font-size: inherit;
    font-family: inherit;
}
.css::before, .property::before, .descriptor::before {
    content: "‘";
}
.css::after, .property::after, .descriptor::after {
    content: "’";
}
.property, .descriptor {
    /* Don't wrap property and descriptor names */
    white-space: nowrap;
}
.type { /* CSS value <type> */
    font-style: italic;
}
pre .property::before, pre .property::after {
    content: "";
}
[data-link-type="property"]::before,
[data-link-type="propdesc"]::before,
[data-link-type="descriptor"]::before,
[data-link-type="value"]::before,
[data-link-type="function"]::before,
[data-link-type="at-rule"]::before,
[data-link-type="selector"]::before,
[data-link-type="maybe"]::before {
    content: "‘";
}
[data-link-type="property"]::after,
[data-link-type="propdesc"]::after,
[data-link-type="descriptor"]::after,
[data-link-type="value"]::after,
[data-link-type="function"]::after,
[data-link-type="at-rule"]::after,
[data-link-type="selector"]::after,
[data-link-type="maybe"]::after {
    content: "’";
}

[data-link-type].production::before,
[data-link-type].production::after,
.prod [data-link-type]::before,
.prod [data-link-type]::after {
    content: "";
}

[data-link-type=element],
[data-link-type=element-attr] {
    font-family: Menlo, Consolas, "DejaVu Sans Mono", monospace;
    font-size: .9em;
}
[data-link-type=element]::before { content: "<" }
[data-link-type=element]::after  { content: ">" }

[data-link-type=biblio] {
    white-space: pre;
}</style>
<style>/* style-colors */

/* Any --*-text not paired with a --*-bg is assumed to have a transparent bg */
:root {
    color-scheme: light dark;

    --text: black;
    --bg: white;

    --unofficial-watermark: url(https://www.w3.org/StyleSheets/TR/2016/logos/UD-watermark);

    --logo-bg: #1a5e9a;
    --logo-active-bg: #c00;
    --logo-text: white;

    --tocnav-normal-text: #707070;
    --tocnav-normal-bg: var(--bg);
    --tocnav-hover-text: var(--tocnav-normal-text);
    --tocnav-hover-bg: #f8f8f8;
    --tocnav-active-text: #c00;
    --tocnav-active-bg: var(--tocnav-normal-bg);

    --tocsidebar-text: var(--text);
    --tocsidebar-bg: #f7f8f9;
    --tocsidebar-shadow: rgba(0,0,0,.1);
    --tocsidebar-heading-text: hsla(203,20%,40%,.7);

    --toclink-text: var(--text);
    --toclink-underline: #3980b5;
    --toclink-visited-text: var(--toclink-text);
    --toclink-visited-underline: #054572;

    --heading-text: #005a9c;

    --hr-text: var(--text);

    --algo-border: #def;

    --del-text: red;
    --del-bg: transparent;
    --ins-text: #080;
    --ins-bg: transparent;

    --a-normal-text: #034575;
    --a-normal-underline: #bbb;
    --a-visited-text: var(--a-normal-text);
    --a-visited-underline: #707070;
    --a-hover-bg: rgba(75%, 75%, 75%, .25);
    --a-active-text: #c00;
    --a-active-underline: #c00;

    --blockquote-border: silver;
    --blockquote-bg: transparent;
    --blockquote-text: currentcolor;

    --issue-border: #e05252;
    --issue-bg: #fbe9e9;
    --issue-text: var(--text);
    --issueheading-text: #831616;

    --example-border: #e0cb52;
    --example-bg: #fcfaee;
    --example-text: var(--text);
    --exampleheading-text: #574b0f;

    --note-border: #52e052;
    --note-bg: #e9fbe9;
    --note-text: var(--text);
    --noteheading-text: hsl(120, 70%, 30%);
    --notesummary-underline: silver;

    --assertion-border: #aaa;
    --assertion-bg: #eee;
    --assertion-text: black;

    --advisement-border: orange;
    --advisement-bg: #fec;
    --advisement-text: var(--text);
    --advisementheading-text: #b35f00;

    --warning-border: red;
    --warning-bg: hsla(40,100%,50%,0.95);
    --warning-text: var(--text);

    --amendment-border: #330099;
    --amendment-bg: #F5F0FF;
    --amendment-text: var(--text);
    --amendmentheading-text: #220066;

    --def-border: #8ccbf2;
    --def-bg: #def;
    --def-text: var(--text);
    --defrow-border: #bbd7e9;

    --datacell-border: silver;

    --indexinfo-text: #707070;

    --indextable-hover-text: black;
    --indextable-hover-bg: #f7f8f9;

    --outdatedspec-bg: rgba(0, 0, 0, .5);
    --outdatedspec-text: black;
    --outdated-bg: maroon;
    --outdated-text: white;
    --outdated-shadow: red;

    --editedrec-bg: darkorange;
}</style>
<style>/* style-counters */

body {
    counter-reset: example figure issue;
}
.issue {
    counter-increment: issue;
}
.issue:not(.no-marker)::before {
    content: "Issue " counter(issue);
}

.example {
    counter-increment: example;
}
.example:not(.no-marker)::before {
    content: "Example " counter(example);
}
.invalid.example:not(.no-marker)::before,
.illegal.example:not(.no-marker)::before {
    content: "Invalid Example" counter(example);
}

figcaption {
    counter-increment: figure;
}
figcaption:not(.no-marker)::before {
    content: "Figure " counter(figure) " ";
}</style>
<style>/* style-dfn-panel */

:root {
    --dfnpanel-bg: #ddd;
    --dfnpanel-text: var(--text);
}
.dfn-panel {
    position: absolute;
    z-index: 35;
    height: auto;
    width: -webkit-fit-content;
    width: fit-content;
    max-width: 300px;
    max-height: 500px;
    overflow: auto;
    padding: 0.5em 0.75em;
    font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
    background: var(--dfnpanel-bg);
    color: var(--dfnpanel-text);
    border: outset 0.2em;
}
.dfn-panel:not(.on) { display: none; }
.dfn-panel * { margin: 0; padding: 0; text-indent: 0; }
.dfn-panel > b { display: block; }
.dfn-panel a { color: var(--dfnpanel-text); }
.dfn-panel a:not(:hover) { text-decoration: none !important; border-bottom: none !important; }
.dfn-panel > b + b { margin-top: 0.25em; }
.dfn-panel ul { padding: 0; }
.dfn-panel li { list-style: inside; }
.dfn-panel.activated {
    display: inline-block;
    position: fixed;
    left: .5em;
    bottom: 2em;
    margin: 0 auto;
    max-width: calc(100vw - 1.5em - .4em - .5em);
    max-height: 30vh;
}

.dfn-paneled { cursor: pointer; }
</style>
<style>/* style-issues */

a[href].issue-return {
    float: right;
    float: inline-end;
    color: var(--issueheading-text);
    font-weight: bold;
    text-decoration: none;
}
</style>
<style>/* style-md-lists */

/* This is a weird hack for me not yet following the commonmark spec
   regarding paragraph and lists. */
[data-md] > :first-child {
    margin-top: 0;
}
[data-md] > :last-child {
    margin-bottom: 0;
}</style>
<style>/* style-selflinks */

:root {
    --selflink-text: white;
    --selflink-bg: gray;
    --selflink-hover-text: black;
}
.heading, .issue, .note, .example, li, dt {
    position: relative;
}
a.self-link {
    position: absolute;
    top: 0;
    left: calc(-1 * (3.5rem - 26px));
    width: calc(3.5rem - 26px);
    height: 2em;
    text-align: center;
    border: none;
    transition: opacity .2s;
    opacity: .5;
}
a.self-link:hover {
    opacity: 1;
}
.heading > a.self-link {
    font-size: 83%;
}
.example > a.self-link,
.note > a.self-link,
.issue > a.self-link {
    /* These blocks are overflow:auto, so positioning outside
       doesn't work. */
    left: auto;
    right: 0;
}
li > a.self-link {
    left: calc(-1 * (3.5rem - 26px) - 2em);
}
dfn > a.self-link {
    top: auto;
    left: auto;
    opacity: 0;
    width: 1.5em;
    height: 1.5em;
    background: var(--selflink-bg);
    color: var(--selflink-text);
    font-style: normal;
    transition: opacity .2s, background-color .2s, color .2s;
}
dfn:hover > a.self-link {
    opacity: 1;
}
dfn > a.self-link:hover {
    color: var(--selflink-hover-text);
}

a.self-link::before            { content: "¶"; }
.heading > a.self-link::before { content: "§"; }
dfn > a.self-link::before      { content: "#"; }
</style>
<style>/* style-syntax-highlighting */

            pre.idl.highlight {
                background: var(--borderedblock-bg, var(--def-bg));
            }
            
code.highlight { padding: .1em; border-radius: .3em; }
pre.highlight, pre > code.highlight { display: block; padding: 1em; margin: .5em 0; overflow: auto; border-radius: 0; }

.highlight:not(.idl) { background: rgba(0, 0, 0, .03); }
c-[a] { color: #990055 } /* Keyword.Declaration */
c-[b] { color: #990055 } /* Keyword.Type */
c-[c] { color: #708090 } /* Comment */
c-[d] { color: #708090 } /* Comment.Multiline */
c-[e] { color: #0077aa } /* Name.Attribute */
c-[f] { color: #669900 } /* Name.Tag */
c-[g] { color: #222222 } /* Name.Variable */
c-[k] { color: #990055 } /* Keyword */
c-[l] { color: #000000 } /* Literal */
c-[m] { color: #000000 } /* Literal.Number */
c-[n] { color: #0077aa } /* Name */
c-[o] { color: #999999 } /* Operator */
c-[p] { color: #999999 } /* Punctuation */
c-[s] { color: #a67f59 } /* Literal.String */
c-[t] { color: #a67f59 } /* Literal.String.Single */
c-[u] { color: #a67f59 } /* Literal.String.Double */
c-[cp] { color: #708090 } /* Comment.Preproc */
c-[c1] { color: #708090 } /* Comment.Single */
c-[cs] { color: #708090 } /* Comment.Special */
c-[kc] { color: #990055 } /* Keyword.Constant */
c-[kn] { color: #990055 } /* Keyword.Namespace */
c-[kp] { color: #990055 } /* Keyword.Pseudo */
c-[kr] { color: #990055 } /* Keyword.Reserved */
c-[ld] { color: #000000 } /* Literal.Date */
c-[nc] { color: #0077aa } /* Name.Class */
c-[no] { color: #0077aa } /* Name.Constant */
c-[nd] { color: #0077aa } /* Name.Decorator */
c-[ni] { color: #0077aa } /* Name.Entity */
c-[ne] { color: #0077aa } /* Name.Exception */
c-[nf] { color: #0077aa } /* Name.Function */
c-[nl] { color: #0077aa } /* Name.Label */
c-[nn] { color: #0077aa } /* Name.Namespace */
c-[py] { color: #0077aa } /* Name.Property */
c-[ow] { color: #999999 } /* Operator.Word */
c-[mb] { color: #000000 } /* Literal.Number.Bin */
c-[mf] { color: #000000 } /* Literal.Number.Float */
c-[mh] { color: #000000 } /* Literal.Number.Hex */
c-[mi] { color: #000000 } /* Literal.Number.Integer */
c-[mo] { color: #000000 } /* Literal.Number.Oct */
c-[sb] { color: #a67f59 } /* Literal.String.Backtick */
c-[sc] { color: #a67f59 } /* Literal.String.Char */
c-[sd] { color: #a67f59 } /* Literal.String.Doc */
c-[se] { color: #a67f59 } /* Literal.String.Escape */
c-[sh] { color: #a67f59 } /* Literal.String.Heredoc */
c-[si] { color: #a67f59 } /* Literal.String.Interpol */
c-[sx] { color: #a67f59 } /* Literal.String.Other */
c-[sr] { color: #a67f59 } /* Literal.String.Regex */
c-[ss] { color: #a67f59 } /* Literal.String.Symbol */
c-[vc] { color: #0077aa } /* Name.Variable.Class */
c-[vg] { color: #0077aa } /* Name.Variable.Global */
c-[vi] { color: #0077aa } /* Name.Variable.Instance */
c-[il] { color: #000000 } /* Literal.Number.Integer.Long */
</style>
<style>/* style-var-click-highlighting */

    var { cursor: pointer; }
    var.selected0 { background-color: #F4D200; box-shadow: 0 0 0 2px #F4D200; }
    var.selected1 { background-color: #FF87A2; box-shadow: 0 0 0 2px #FF87A2; }
    var.selected2 { background-color: #96E885; box-shadow: 0 0 0 2px #96E885; }
    var.selected3 { background-color: #3EEED2; box-shadow: 0 0 0 2px #3EEED2; }
    var.selected4 { background-color: #EACFB6; box-shadow: 0 0 0 2px #EACFB6; }
    var.selected5 { background-color: #82DDFF; box-shadow: 0 0 0 2px #82DDFF; }
    var.selected6 { background-color: #FFBCF2; box-shadow: 0 0 0 2px #FFBCF2; }
    </style>
<style>/* style-wpt */

:root {
    --wpt-border: hsl(0, 0%, 60%);
    --wpt-bg: hsl(0, 0%, 95%);
    --wpt-text: var(--text);
    --wptheading-text: hsl(0, 0%, 30%);
}
@media (prefers-color-scheme: dark) {
    :root {
        --wpt-border: hsl(0, 0%, 30%);
        --wpt-bg: var(--borderedblock-bg);
        --wpt-text: var(--text);
        --wptheading-text: hsl(0, 0%, 60%);
    }
}
.wpt-tests-block {
    list-style: none;
    border-left: .5em solid var(--wpt-border);
    background: var(--wpt-bg);
    color: var(--wpt-text);
    margin: 1em auto;
    padding: .5em;
}
.wpt-tests-block summary {
    color: var(--wptheading-text);
    font-weight: normal;
    text-transform: uppercase;
}
.wpt-tests-block summary::marker{
    color: var(--wpt-border);
}
.wpt-tests-block summary:hover::marker{
    color: var(--wpt-text);
}
/*
   The only content  of a wpt test block in its closed state is the <summary>,
   which contains the word TESTS,
   and that is absolutely positioned.
   In that closed state, wpt test blocks are styled
   to have a top margin whose height is exactly equal
   to the height of the absolutely positioned <summary>,
   and no other background/padding/margin/border.
   The wpt test block elements will therefore allow the maring
   of the previous/next block elements
   to collapse through them;
   if this combined margin would be larger than its own top margin,
   it stays as is,
   and therefore the pre-existing vertical rhythm of the document is undisturbed.
   If that combined margin would be smaller, it is grown to that size.
   This means that the wpt test block ensures
   that there's always enough vertical space to insert the summary,
   without adding more than is needed.
*/
.wpt-tests-block:not([open]){
    padding: 0;
    border: none;
    background: none;
    font-size: 0.75em;
    line-height: 1;
    position: relative;
    margin: 1em 0 0;
}
.wpt-tests-block:not([open]) summary {
    position: absolute;
    right: 0;
    bottom: 0;
}
/*
   It is possible that both the last child of a block element
   and the block element itself
   would be annotated with a <wpt> block each.
   If the block element has a padding or a border,
   that's fine, but otherwise
   the bottom margin of the block and of its last child would collapse
   and both <wpt> elements would overlap, being both placed there.
   To avoid that, add 1px of padding to the <wpt> element annotating the last child
   to prevent the bottom margin of the block and of its last child from collapsing
   (and as much negative margin,
   as wel only want to prevent margin collapsing,
   but are not trying to actually take more space).
*/
.wpt-tests-block:not([open]):last-child {
    padding-bottom: 1px;
    margin-bottom: -1px;
}
/*
   Exception to the previous rule:
   don't do that in non-last list items,
   because it's not necessary,
   and would therefore consume more space than strictly needed.
   Lists must have list items as children, not <wpt> elements,
   so a <wpt> element cannot be a sibling of a list item,
   and the collision that the previous rule avoids cannot happen.
*/
li:not(:last-child) > .wpt-tests-block:not([open]):last-child,
dd:not(:last-child) > .wpt-tests-block:not([open]):last-child {
    padding-bottom: 0;
    margin-bottom: 0;
}
.wpt-tests-block:not([open]):not(:hover){
    opacity: 0.5;
}
.wpt-tests-list {
    list-style: none;
    display: grid;
    margin: 0;
    padding: 0;
    grid-template-columns: 1fr max-content auto auto;
    grid-column-gap: .5em;
}
.wpt-tests-block hr:last-child {
    display: none;
}
.wpt-test {
    display: contents;
}
.wpt-test > a {
    text-decoration: underline;
    border: none;
}
.wpt-test > .wpt-name { grid-column: 1; }
.wpt-test > .wpt-results { grid-column: 2; }
.wpt-test > .wpt-live { grid-column: 3; }
.wpt-test > .wpt-source { grid-column: 4; }

.wpt-test > .wpt-results {
    display: flex;
    gap: .1em;
}
.wpt-test .wpt-result {
    display: inline-block;
    height: 1em;
    width: 1em;
    border-radius: 50%;
    position: relative;
}
</style>
<style>/* style-darkmode */

@media (prefers-color-scheme: dark) {
    :root {
        --text: #ddd;
        --bg: black;

        --unofficial-watermark: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='400'%3E%3Cg fill='%23100808' transform='translate(200 200) rotate(-45) translate(-200 -200)' stroke='%23100808' stroke-width='3'%3E%3Ctext x='50%25' y='220' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EUNOFFICIAL%3C/text%3E%3Ctext x='50%25' y='305' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EDRAFT%3C/text%3E%3C/g%3E%3C/svg%3E");

        --logo-bg: #1a5e9a;
        --logo-active-bg: #c00;
        --logo-text: white;

        --tocnav-normal-text: #999;
        --tocnav-normal-bg: var(--bg);
        --tocnav-hover-text: var(--tocnav-normal-text);
        --tocnav-hover-bg: #080808;
        --tocnav-active-text: #f44;
        --tocnav-active-bg: var(--tocnav-normal-bg);

        --tocsidebar-text: var(--text);
        --tocsidebar-bg: #080808;
        --tocsidebar-shadow: rgba(255,255,255,.1);
        --tocsidebar-heading-text: hsla(203,20%,40%,.7);

        --toclink-text: var(--text);
        --toclink-underline: #6af;
        --toclink-visited-text: var(--toclink-text);
        --toclink-visited-underline: #054572;

        --heading-text: #8af;

        --hr-text: var(--text);

        --algo-border: #456;

        --del-text: #f44;
        --del-bg: transparent;
        --ins-text: #4a4;
        --ins-bg: transparent;

        --a-normal-text: #6af;
        --a-normal-underline: #555;
        --a-visited-text: var(--a-normal-text);
        --a-visited-underline: var(--a-normal-underline);
        --a-hover-bg: rgba(25%, 25%, 25%, .2);
        --a-active-text: #f44;
        --a-active-underline: var(--a-active-text);

        --borderedblock-bg: rgba(255, 255, 255, .05);

        --blockquote-border: silver;
        --blockquote-bg: var(--borderedblock-bg);
        --blockquote-text: currentcolor;

        --issue-border: #e05252;
        --issue-bg: var(--borderedblock-bg);
        --issue-text: var(--text);
        --issueheading-text: hsl(0deg, 70%, 70%);

        --example-border: hsl(50deg, 90%, 60%);
        --example-bg: var(--borderedblock-bg);
        --example-text: var(--text);
        --exampleheading-text: hsl(50deg, 70%, 70%);

        --note-border: hsl(120deg, 100%, 35%);
        --note-bg: var(--borderedblock-bg);
        --note-text: var(--text);
        --noteheading-text: hsl(120, 70%, 70%);
        --notesummary-underline: silver;

        --assertion-border: #444;
        --assertion-bg: var(--borderedblock-bg);
        --assertion-text: var(--text);

        --advisement-border: orange;
        --advisement-bg: #222218;
        --advisement-text: var(--text);
        --advisementheading-text: #f84;

        --warning-border: red;
        --warning-bg: hsla(40,100%,20%,0.95);
        --warning-text: var(--text);

        --amendment-border: #330099;
        --amendment-bg: #080010;
        --amendment-text: var(--text);
        --amendmentheading-text: #cc00ff;

        --def-border: #8ccbf2;
        --def-bg: #080818;
        --def-text: var(--text);
        --defrow-border: #136;

        --datacell-border: silver;

        --indexinfo-text: #aaa;

        --indextable-hover-text: var(--text);
        --indextable-hover-bg: #181818;

        --outdatedspec-bg: rgba(255, 255, 255, .5);
        --outdatedspec-text: black;
        --outdated-bg: maroon;
        --outdated-text: white;
        --outdated-shadow: red;

        --editedrec-bg: darkorange;
    }
    /* In case a transparent-bg image doesn't expect to be on a dark bg,
       which is quite common in practice... */
    img { background: white; }
}
@media (prefers-color-scheme: dark) {
    :root {
        --selflink-text: black;
        --selflink-bg: silver;
        --selflink-hover-text: white;
    }
}

@media (prefers-color-scheme: dark) {
    :root {
        --dfnpanel-bg: #222;
        --dfnpanel-text: var(--text);
    }
}
@media (prefers-color-scheme: dark) {
    .highlight:not(.idl) { background: rgba(255, 255, 255, .05); }

    c-[a] { color: #d33682 } /* Keyword.Declaration */
    c-[b] { color: #d33682 } /* Keyword.Type */
    c-[c] { color: #2aa198 } /* Comment */
    c-[d] { color: #2aa198 } /* Comment.Multiline */
    c-[e] { color: #268bd2 } /* Name.Attribute */
    c-[f] { color: #b58900 } /* Name.Tag */
    c-[g] { color: #cb4b16 } /* Name.Variable */
    c-[k] { color: #d33682 } /* Keyword */
    c-[l] { color: #657b83 } /* Literal */
    c-[m] { color: #657b83 } /* Literal.Number */
    c-[n] { color: #268bd2 } /* Name */
    c-[o] { color: #657b83 } /* Operator */
    c-[p] { color: #657b83 } /* Punctuation */
    c-[s] { color: #6c71c4 } /* Literal.String */
    c-[t] { color: #6c71c4 } /* Literal.String.Single */
    c-[u] { color: #6c71c4 } /* Literal.String.Double */
    c-[ch] { color: #2aa198 } /* Comment.Hashbang */
    c-[cp] { color: #2aa198 } /* Comment.Preproc */
    c-[cpf] { color: #2aa198 } /* Comment.PreprocFile */
    c-[c1] { color: #2aa198 } /* Comment.Single */
    c-[cs] { color: #2aa198 } /* Comment.Special */
    c-[kc] { color: #d33682 } /* Keyword.Constant */
    c-[kn] { color: #d33682 } /* Keyword.Namespace */
    c-[kp] { color: #d33682 } /* Keyword.Pseudo */
    c-[kr] { color: #d33682 } /* Keyword.Reserved */
    c-[ld] { color: #657b83 } /* Literal.Date */
    c-[nc] { color: #268bd2 } /* Name.Class */
    c-[no] { color: #268bd2 } /* Name.Constant */
    c-[nd] { color: #268bd2 } /* Name.Decorator */
    c-[ni] { color: #268bd2 } /* Name.Entity */
    c-[ne] { color: #268bd2 } /* Name.Exception */
    c-[nf] { color: #268bd2 } /* Name.Function */
    c-[nl] { color: #268bd2 } /* Name.Label */
    c-[nn] { color: #268bd2 } /* Name.Namespace */
    c-[py] { color: #268bd2 } /* Name.Property */
    c-[ow] { color: #657b83 } /* Operator.Word */
    c-[mb] { color: #657b83 } /* Literal.Number.Bin */
    c-[mf] { color: #657b83 } /* Literal.Number.Float */
    c-[mh] { color: #657b83 } /* Literal.Number.Hex */
    c-[mi] { color: #657b83 } /* Literal.Number.Integer */
    c-[mo] { color: #657b83 } /* Literal.Number.Oct */
    c-[sa] { color: #6c71c4 } /* Literal.String.Affix */
    c-[sb] { color: #6c71c4 } /* Literal.String.Backtick */
    c-[sc] { color: #6c71c4 } /* Literal.String.Char */
    c-[dl] { color: #6c71c4 } /* Literal.String.Delimiter */
    c-[sd] { color: #6c71c4 } /* Literal.String.Doc */
    c-[se] { color: #6c71c4 } /* Literal.String.Escape */
    c-[sh] { color: #6c71c4 } /* Literal.String.Heredoc */
    c-[si] { color: #6c71c4 } /* Literal.String.Interpol */
    c-[sx] { color: #6c71c4 } /* Literal.String.Other */
    c-[sr] { color: #6c71c4 } /* Literal.String.Regex */
    c-[ss] { color: #6c71c4 } /* Literal.String.Symbol */
    c-[fm] { color: #268bd2 } /* Name.Function.Magic */
    c-[vc] { color: #cb4b16 } /* Name.Variable.Class */
    c-[vg] { color: #cb4b16 } /* Name.Variable.Global */
    c-[vi] { color: #cb4b16 } /* Name.Variable.Instance */
    c-[vm] { color: #cb4b16 } /* Name.Variable.Magic */
    c-[il] { color: #657b83 } /* Literal.Number.Integer.Long */
}
</style>
 <body class="h-entry">
  <div class="head">
   <p data-fill-with="logo"><a class="logo" href="https://www.w3.org/"> <img alt="W3C" height="48" src="https://www.w3.org/StyleSheets/TR/2021/logos/W3C" width="72"> </a> </p>
   <h1 class="p-name no-ref" id="title">HTML Sanitizer API</h1>
   <p id="w3c-state"><a href="https://www.w3.org/standards/types#CG-DRAFT">Draft Community Group Report</a>, <time class="dt-updated" datetime="1970-01-01">1 January 1970</time></p>
   <div data-fill-with="spec-metadata">
    <dl>
     <dt>This version:
     <dd><a class="u-url" href="https://wicg.github.io/sanitizer-api/">https://wicg.github.io/sanitizer-api/</a>
     <dt class="editor">Editors:
     <dd class="editor p-author h-card vcard" data-editor-id="68466"><a class="p-name fn u-url url" href="https://frederik-braun.com">Frederik Braun</a> (<span class="p-org org">Mozilla</span>) <a class="u-email email" href="mailto:fbraun@mozilla.com">fbraun@mozilla.com</a>
     <dd class="editor p-author h-card vcard"><a class="p-name fn u-url url" href="https://cure53.de">Mario Heiderich</a> (<span class="p-org org">Cure53</span>) <a class="u-email email" href="mailto:mario@cure53.de">mario@cure53.de</a>
     <dd class="editor p-author h-card vcard"><a class="p-name fn u-url url" href="https://www.google.com">Daniel Vogelheim</a> (<span class="p-org org">Google LLC</span>) <a class="u-email email" href="mailto:vogelheim@google.com">vogelheim@google.com</a>
     <dt>Test Suite:
     <dd class="wpt-overview"><a href="https://wpt.fyi/results/sanitizer-api/">https://wpt.fyi/results/sanitizer-api/</a>
    </dl>
   </div>
   <div data-fill-with="warning"></div>
   <p class="copyright" data-fill-with="copyright"><a href="http://www.w3.org/Consortium/Legal/ipr-notice#Copyright">Copyright</a> © 1970 the Contributors to the HTML Sanitizer API Specification, published by the <a href="https://www.w3.org/community/wicg/">Web Platform Incubator Community Group</a> under the <a href="https://www.w3.org/community/about/agreements/cla/">W3C Community Contributor License Agreement (CLA)</a>.
A human-readable <a href="http://www.w3.org/community/about/agreements/cla-deed/">summary</a> is available. </p>
   <hr title="Separator for header">
  </div>
  <div class="p-summary" data-fill-with="abstract">
   <h2 class="no-num no-toc no-ref heading settled" id="abstract"><span class="content">Abstract</span></h2>
   <p>This document specifies a set of APIs which allow developers to take

  untrusted HTML input and sanitize it for safe insertion into a document’s
  DOM.</p>
  </div>
  <div data-fill-with="at-risk"></div>
  <h2 class="no-num no-toc no-ref heading settled" id="status"><span class="content">Status of this document</span></h2>
  <div data-fill-with="status">
   <p> This specification was published by the <a href="https://www.w3.org/community/wicg/">Web Platform Incubator Community Group</a>.
  It is not a W3C Standard nor is it on the W3C Standards Track.

  Please note that under the <a href="https://www.w3.org/community/about/agreements/cla/">W3C Community Contributor License Agreement (CLA)</a> there is a limited opt-out and other conditions apply.

  Learn more about <a href="http://www.w3.org/community/">W3C Community and Business Groups</a>. </p>
   <p></p>
  </div>
  <div data-fill-with="at-risk"></div>
  <nav data-fill-with="table-of-contents" id="toc">
   <h2 class="no-num no-toc no-ref" id="contents">Table of Contents</h2>
   <ol class="toc" role="directory">
    <li>
     <a href="#intro"><span class="secno">1</span> <span class="content">Introduction</span></a>
     <ol class="toc">
      <li><a href="#goals"><span class="secno">1.1</span> <span class="content">Goals</span></a>
      <li><a href="#api-summary"><span class="secno">1.2</span> <span class="content">API Summary</span></a>
      <li>
       <a href="#strings"><span class="secno">1.3</span> <span class="content">The Trouble With Strings</span></a>
       <ol class="toc">
        <li><a href="#string-context-case-1"><span class="secno">1.3.1</span> <span class="content">Case 1: Sanitizing With Nodes, Only.</span></a>
        <li><a href="#string-context-case-2"><span class="secno">1.3.2</span> <span class="content">Case 2: Sanitizing a String with Implied Context.</span></a>
        <li><a href="#string-context-case-3"><span class="secno">1.3.3</span> <span class="content">Case 3: Sanitizing a String with a Given Context.</span></a>
        <li><a href="#string-context-case-other"><span class="secno">1.3.4</span> <span class="content">The Other Case</span></a>
       </ol>
     </ol>
    <li>
     <a href="#framework"><span class="secno">2</span> <span class="content">Framework</span></a>
     <ol class="toc">
      <li><a href="#sanitizer-api"><span class="secno">2.1</span> <span class="content">Sanitizer API</span></a>
      <li><a href="#api-string-handling"><span class="secno">2.2</span> <span class="content">String Handling</span></a>
      <li>
       <a href="#config"><span class="secno">2.3</span> <span class="content">The Configuration Dictionary</span></a>
       <ol class="toc">
        <li><a href="#attr-match-list"><span class="secno">2.3.1</span> <span class="content">Attribute Match Lists</span></a>
       </ol>
     </ol>
    <li>
     <a href="#algorithms"><span class="secno">3</span> <span class="content">Algorithms</span></a>
     <ol class="toc">
      <li><a href="#api-algorithms"><span class="secno">3.1</span> <span class="content">API Implementation</span></a>
      <li><a href="#helper-algorithms"><span class="secno">3.2</span> <span class="content">Helper Definitions</span></a>
      <li><a href="#sanitizer-algorithms"><span class="secno">3.3</span> <span class="content">Sanitization Algorithms</span></a>
      <li><a href="#configuration"><span class="secno">3.4</span> <span class="content">Matching Against The Configuration</span></a>
      <li><a href="#defaults"><span class="secno">3.5</span> <span class="content">Baseline and Defaults</span></a>
     </ol>
    <li>
     <a href="#security-considerations"><span class="secno">4</span> <span class="content">Security Considerations</span></a>
     <ol class="toc">
      <li><a href="#server-side-xss"><span class="secno">4.1</span> <span class="content">Server-Side Reflected and Stored XSS</span></a>
      <li><a href="#dom-clobbering"><span class="secno">4.2</span> <span class="content">DOM clobbering</span></a>
      <li><a href="#script-gadgets"><span class="secno">4.3</span> <span class="content">XSS with Script gadgets</span></a>
      <li><a href="#mutated-xss"><span class="secno">4.4</span> <span class="content">Mutated XSS</span></a>
     </ol>
    <li><a href="#ack"><span class="secno">5</span> <span class="content">Acknowledgements</span></a>
    <li>
     <a href="#constants"><span class="secno"></span> <span class="content">Appendix A: Built-in Constants</span></a>
     <ol class="toc">
      <li><a href="#builtins-justification"><span class="secno"></span> <span class="content">Built-ins Justification</span></a>
      <li><a href="#baseline-elements"><span class="secno"></span> <span class="content">The Baseline Element Allow List</span></a>
      <li><a href="#baseline-attributes"><span class="secno"></span> <span class="content">The Baseline Attribute Allow List</span></a>
      <li><a href="#default-configuration-dictionary"><span class="secno"></span> <span class="content">The Default Configuration Dictionary</span></a>
     </ol>
    <li>
     <a href="#index"><span class="secno"></span> <span class="content">Index</span></a>
     <ol class="toc">
      <li><a href="#index-defined-here"><span class="secno"></span> <span class="content">Terms defined by this specification</span></a>
      <li><a href="#index-defined-elsewhere"><span class="secno"></span> <span class="content">Terms defined by reference</span></a>
     </ol>
    <li>
     <a href="#references"><span class="secno"></span> <span class="content">References</span></a>
     <ol class="toc">
      <li><a href="#normative"><span class="secno"></span> <span class="content">Normative References</span></a>
      <li><a href="#informative"><span class="secno"></span> <span class="content">Informative References</span></a>
     </ol>
    <li><a href="#idl-index"><span class="secno"></span> <span class="content">IDL Index</span></a>
    <li><a href="#issues-index"><span class="secno"></span> <span class="content">Issues Index</span></a>
   </ol>
  </nav>
  <main>
   <h2 class="heading settled" data-level="1" id="intro"><span class="secno">1. </span><span class="content">Introduction</span><a class="self-link" href="#intro"></a></h2>
   <p><em>This section is not normative.</em></p>
   <p>Web applications often need to work with strings of HTML on the client side,
perhaps as part of a client-side templating solution, perhaps as part of
rendering user generated content, etc. It is difficult to do so in a safe way.
The naive approach of joining strings together and stuffing them into
an <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#element" id="ref-for-element">Element</a></code>'s <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#widl-Element-innerHTML" id="ref-for-widl-Element-innerHTML">innerHTML</a></code> is fraught with risk, as it can cause
JavaScript execution in a number of unexpected ways.</p>
   <p>Libraries like <a data-link-type="biblio" href="#biblio-dompurify" title="DOMPurify">[DOMPURIFY]</a> attempt to manage this problem by carefully
parsing and sanitizing strings before insertion, by constructing a DOM and
filtering its members through an allow-list. This has proven to be a fragile
approach, as the parsing APIs exposed to the web don’t always map in
reasonable ways to the browser’s behavior when actually rendering a string as
HTML in the "real" DOM. Moreover, the libraries need to keep on top of
browsers' changing behavior over time; things that once were safe may turn
into time-bombs based on new platform-level features.</p>
   <p>The browser has a fairly good idea of when it is going to
execute code. We can improve upon the user-space libraries by teaching the
browser how to render HTML from an arbitrary string in a safe manner, and do
so in a way that is much more likely to be maintained and updated along with
the browser’s own changing parser implementation. This document outlines an
API which aims to do just that.</p>
   <h3 class="heading settled" data-level="1.1" id="goals"><span class="secno">1.1. </span><span class="content">Goals</span><a class="self-link" href="#goals"></a></h3>
   <ul>
    <li data-md>
     <p>Mitigate the risk of DOM-based cross-site scripting attacks by providing
  developers with mechanisms for handling user-controlled HTML which prevent
  direct script execution upon injection.</p>
    <li data-md>
     <p>Make HTML output safe for use within the current user agent, taking into
  account its current understanding of HTML.</p>
    <li data-md>
     <p>Allow developers to override the defaults set of elements and attributes.
  Adding certain elements and attributes can prevent <a href="https://github.com/google/security-research-pocs/tree/master/script-gadgets">script gadget</a> attacks.</p>
   </ul>
   <h3 class="heading settled" data-level="1.2" id="api-summary"><span class="secno">1.2. </span><span class="content">API Summary</span><a class="self-link" href="#api-summary"></a></h3>
   <div class="example" id="example-19897f75">
    <a class="self-link" href="#example-19897f75"></a> 
<pre class="language-js highlight"><c- a>let</c-> s <c- o>=</c-> <c- ow>new</c-> Sanitizer<c- p>();</c->

<c- c1>// Case: The input data is available as a tree of DOM nodes.</c->
<c- a>let</c-> userControlledTree <c- o>=</c-> <c- p>...;</c->
element<c- p>.</c->replaceChildren<c- p>(</c->s<c- p>.</c->sanitize<c- p>(</c->userControlledTree<c- p>));</c->

<c- c1>// Case: The input is available as a string, and we know the element to insert</c->
<c- c1>// it into:</c->
<c- a>let</c-> userControlledInput <c- o>=</c-> <c- u>"&amp;lt;img src=x onerror=alert(1)//&amp;gt;"</c-><c- p>;</c->
element<c- p>.</c->setHTML<c- p>(</c->userControlledInput<c- p>,</c-> <c- p>{</c->sanitizer<c- o>:</c-> s<c- p>});</c->

<c- c1>// Case: The input is available as a string, and we know which type of element</c->
<c- c1>// we will eventually insert it to, but can’t or don’t want to perform the</c->
<c- c1>// insertion now:</c->
<c- a>let</c-> forDiv <c- o>=</c-> s<c- p>.</c->sanitizeFor<c- p>(</c-><c- u>"div"</c-><c- p>,</c-> userControlledInput<c- p>);</c->
<c- c1>// Later:</c->
document<c- p>.</c->querySelector<c- p>(</c-><c- sb>`</c-><c- si>${</c->forDiv<c- p>.</c->localName<c- si>}</c-><c- sb>#target`</c-><c- p>).</c->replaceChildren<c- p>(...</c->forDiv<c- p>.</c->childNodes<c- p>);</c->
</pre>
   </div>
   <h3 class="heading settled" data-level="1.3" id="strings"><span class="secno">1.3. </span><span class="content">The Trouble With Strings</span><a class="self-link" href="#strings"></a></h3>
   <p>Many HTML sanitizer libraries are based on string-to-string APIs, while this
API does not offer such a method. This sub-section explains the reasons and
implications for the Sanitizer API.</p>
   <p>To convert a string into a tree of nodes (or a fragment), it needs to be parsed.
The <a href="https://html.spec.whatwg.org/multipage/parsing.html#parsing">HTML parsing algorithm</a> carefully specifies how parsing HTML works. This parsing algorithm is dependent
on the current node as its parsing context. That is, the same string parsed
in the context of different HTML nodes will yield different parse trees.</p>
   <div class="example" id="example-3403a4ea">
    <a class="self-link" href="#example-3403a4ea"></a> The string <code>&lt;em>bla</code> in <code>&lt;div></code> and <code>&lt;textarea></code> context. 
    <ul>
     <li data-md>
      <p><code>&lt;div>&lt;em>bla&lt;/div></code> ⇨ <code>&lt;div>&lt;em>bla&lt;/em>&lt;/div></code></p>
     <li data-md>
      <p><code>&lt;textarea>&lt;em>bla&lt;/textarea></code> ⇨ <code>&lt;textarea>&amp;lt;em&amp;gt;bla&lt;/textarea></code></p>
    </ul>
   </div>
   <div class="example" id="example-90aa6bbb">
    <a class="self-link" href="#example-90aa6bbb"></a> A table cell in <code>&lt;table></code> and non-table (<code>&lt;div></code>) context. 
    <ul>
     <li data-md>
      <p><code>&lt;table>&lt;td>text&lt;/table></code> ⇨ <code>&lt;table>&lt;td>text&lt;/table></code></p>
     <li data-md>
      <p><code>&lt;div>&lt;td>text&lt;/div></code> ⇨ <code>&lt;div>text&lt;/div></code></p>
    </ul>
   </div>
   <p>These differences can allow bugs to creep into a site’s sanitization strategy,
which can (and have been) exploited by a class of XSS-style attacks called mXSS.
These attacks ultimately depend on confusions of the parsing context, for
example when a developer will sanitize a string in one (parsing) context,
while then applying the resulting string in a different context, where it will
be interpreted differently.</p>
   <div class="example" id="example-bdc06d64"><a class="self-link" href="#example-bdc06d64"></a> Two mXSS-style examples in real-world libraries can be found in <a data-link-type="biblio" href="#biblio-mxss1" title="Mutation XSS via namespace confusion">[MXSS1]</a>] and <a data-link-type="biblio" href="#biblio-mxss2" title="CVE-2020-6802 Write-up">[MXSS2]</a>. We’d like to stress that we picked these reports
  for their ease of reading. There are similar reports for pretty much every
  other tools that deals with HTML parsing. </div>
   <p>Since this attack class depends on a particular usage of the string <em>after</em> the sanitization has occurred, the API itself has only limited capability
to protect its users. As a result, the Sanitizer API follows the following
principle:</p>
   <p>Whenever the Sanitzer API parses or unparses a DOM (sub-)tree to or from a
string, it will either do so in a fashion where the correct parse context is
implied by the operation; or it will require a parse context to be supplied by
the developer and will retain the given context in the resulting argument.
In other words, the Sanitzer API will never assume a parsing context, or
disappear a parsing context that has been supplied earlier.</p>
   <h4 class="heading settled" data-level="1.3.1" id="string-context-case-1"><span class="secno">1.3.1. </span><span class="content">Case 1: Sanitizing With Nodes, Only.</span><a class="self-link" href="#string-context-case-1"></a></h4>
   <p>If the user data in question is already available as DOM nodes - for example
a <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#document" id="ref-for-document">Document</a></code> instance in a frame - then the Sanitizer can be easily used:</p>
   <div class="example" id="example-4d22be26">
    <a class="self-link" href="#example-4d22be26"></a> 
<pre class="language-js highlight"><c- a>const</c-> sanitizer <c- o>=</c-> <c- ow>new</c-> Sanitizer<c- p>(</c-> <c- p>...</c-> <c- p>);</c->  <c- c1>// Our Sanitizer;</c->

<c- c1>// There is an iframe with id "userFrame" whose content we are interested in.</c->
<c- a>const</c-> user_tree <c- o>=</c-> document<c- p>.</c->getElementById<c- p>(</c-><c- u>"userFrame"</c-><c- p>).</c->contentWindow<c- p>.</c->document<c- p>;</c->
<c- a>const</c-> sanitized <c- o>=</c-> sanitizer<c- p>.</c->sanitize<c- p>(</c->user_tree<c- p>);</c->
</pre>
   </div>
   <p class="note" role="note"><span class="marker">Note:</span> Parsing an HTML string can have various side-effects, like network
  requests or executing scripts. Naively parsing these, e.g. by assigning a
  string to <code>.innerHTML</code> of an unconnected element, will not reliably prevent
  these. Therefore, if the user data to be sanitized is originally
  in string form, we recommend to go with one of the following cases.</p>
   <h4 class="heading settled" data-level="1.3.2" id="string-context-case-2"><span class="secno">1.3.2. </span><span class="content">Case 2: Sanitizing a String with Implied Context.</span><a class="self-link" href="#string-context-case-2"></a></h4>
   <p>If the user data is available in string form and we wish to
directly insert the sanitized subtree into the DOM, we can do so as follows:</p>
   <div class="example" id="example-97b41bbe">
    <a class="self-link" href="#example-97b41bbe"></a> 
<pre class="language-js highlight"><c- a>const</c-> user_string <c- o>=</c-> <c- u>"..."</c-><c- p>;</c->  <c- c1>// The user string.</c->
<c- a>const</c-> sanitizer <c- o>=</c-> <c- ow>new</c-> Sanitizer<c- p>(</c-> <c- p>...</c-> <c- p>);</c->  <c- c1>// Our Sanitizer;</c->

<c- c1>// We want to insert the HTML in user_string into a target element with id</c->
<c- c1>// target. That is, we want the equivalent of target.innerHTML = value, except</c->
<c- c1>// without the XSS risks.</c->
document<c- p>.</c->getElementById<c- p>(</c-><c- u>"target"</c-><c- p>).</c->setHTML<c- p>(</c->user_string<c- p>,</c-> <c- p>{</c->sanitizer<c- o>:</c-> sanitizer<c- p>});</c->
</pre>
   </div>
   <h4 class="heading settled" data-level="1.3.3" id="string-context-case-3"><span class="secno">1.3.3. </span><span class="content">Case 3: Sanitizing a String with a Given Context.</span><a class="self-link" href="#string-context-case-3"></a></h4>
   <p>If the user data is available in string form and the developer wishes to
sanitize it now, but apply the result to the DOM later, then the Sanitizer
must be informed about the context that it will be used. To prevent context
confusion the result is wrapper a container that contains both the
result and also the parse context. Conveniently, this container already
exists, and it is the node itself!</p>
   <div class="example" id="example-2244de59">
    <a class="self-link" href="#example-2244de59"></a> 
<pre class="language-js highlight"><c- c1>// A certain piece of user input is meant to be used repeatedly, to insert</c->
<c- c1>// it in multiple elements on the page. All these elements will be &lt;div></c->
<c- c1>// elements.</c->
<c- a>const</c-> user_string <c- o>=</c-> <c- u>"..."</c-><c- p>;</c->  <c- c1>// The user string.</c->
<c- a>const</c-> sanitizer <c- o>=</c-> <c- ow>new</c-> Sanitizer<c- p>(</c-> <c- p>...</c-> <c- p>);</c->  <c- c1>// Our Sanitizer.</c->

<c- a>const</c-> sanitized <c- o>=</c-> sanitizer<c- p>.</c->sanitizeFor<c- p>(</c-><c- u>"div"</c-><c- p>,</c-> user_string<c- p>);</c->
sanitized <c- ow>instanceof</c-> HTMLDivElement  <c- c1>// true. The Sanitizer has given us a node.</c->

<c- c1>// ... later, in the same program ...</c->
<c- k>for</c-> <c- p>(</c-><c- a>let</c-> elem <c- o>=</c-> <c- p>...</c-> <c- k>of</c-> <c- p>...)</c-> <c- p>{</c->
  <c- c1>// All of our "elem" instances should be of the same type used in the</c->
  <c- c1>// .sanitizeFor call above. With an assertion library, this could look as</c->
  <c- c1>// follows:</c->
  assert_true<c- p>(</c->elem <c- ow>instanceof</c-> sanitized<c- p>.</c-><c- kr>constructor</c-><c- p>);</c->  <c- c1>// Assuming assert_true, like in WPT tests.</c->
  elem<c- p>.</c->replaceChildren<c- p>(...</c->sanitized<c- p>.</c->childNodes<c- p>);</c->
<c- p>}</c->

<c- c1>// Instead of:</c->
elem<c- p>.</c->replaceChildren<c- p>(...</c->sanitized<c- p>.</c->childNodes<c- p>);</c->
<c- c1>// one could write:</c->
elem<c- p>.</c->innerHTML <c- o>=</c-> sanitized<c- p>.</c->innerHTML<c- p>;</c->
<c- c1>// This should have the same effect, except be slower, since this will trigger</c->
<c- c1>// un-parsing and then re-parsing the node tree which we already have</c->
<c- c1>// available as a node tree. So we recommend to stick with the former version.</c->
</pre>
   </div>
   <h4 class="heading settled" data-level="1.3.4" id="string-context-case-other"><span class="secno">1.3.4. </span><span class="content">The Other Case</span><a class="self-link" href="#string-context-case-other"></a></h4>
   <p>What if neither of these cases works with a given application structure, and a
string-to-string operation is required? In this case, the developer is free to
take the sanitization result and remove it from its context. In this case, the
responsibility to prevent mXSS-class attacks that stem from mis-applying those
strings in an inappropriate context remains with the developer.</p>
   <div class="example" id="example-71e04b5d">
    <a class="self-link" href="#example-71e04b5d"></a> 
<pre class="language-js highlight"><c- a>const</c-> user_string <c- o>=</c-> <c- u>"..."</c-><c- p>;</c->  <c- c1>// The user string.</c->
<c- a>const</c-> sanitizer <c- o>=</c-> <c- ow>new</c-> Sanitizer<c- p>(</c-> <c- p>...</c-> <c- p>);</c->  <c- c1>// Our Sanitizer.</c->

<c- c1>// The developer plans to insert this string into a &lt;div> element, but has to</c->
<c- c1>// keep this around as a string (instead of an element). It’s important that</c->
<c- c1>// the developer remembers the parsing context and MUST NOT use this in a</c->
<c- c1>// different parsing context in order to prevent mXSS attacks.</c->
<c- a>const</c-> sanitized_for_div <c- o>=</c-> sanitizer<c- p>.</c->sanitizeFor<c- p>(</c-><c- u>"div"</c-><c- p>,</c-> user_string<c- p>).</c->innerHTML<c- p>;</c->
</pre>
   </div>
   <h2 class="heading settled" data-level="2" id="framework"><span class="secno">2. </span><span class="content">Framework</span><a class="self-link" href="#framework"></a></h2>
   <h3 class="heading settled" data-level="2.1" id="sanitizer-api"><span class="secno">2.1. </span><span class="content">Sanitizer API</span><a class="self-link" href="#sanitizer-api"></a></h3>
   <p>The core API is the <code>Sanitizer</code> object and the sanitize method. Sanitizers can
be instantiated using an optional <code>SanitizerConfig</code> dictionary for options.
The most common use-case - preventing XSS - is handled by default,
so that creating a Sanitizer with a custom config is necessary only to
handle additional, application-specific use cases.</p>
<pre class="idl highlight def">[
  <a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed" id="ref-for-Exposed"><c- g>Exposed</c-></a>=(<c- n>Window</c->),
  <a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#SecureContext" id="ref-for-SecureContext"><c- g>SecureContext</c-></a>
] <c- b>interface</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="interface" data-export id="sanitizer"><code><c- g>Sanitizer</c-></code></dfn> {
  <a class="idl-code" data-link-type="constructor" href="#dom-sanitizer-sanitizer" id="ref-for-dom-sanitizer-sanitizer"><c- g>constructor</c-></a>(<c- b>optional</c-> <a data-link-type="idl-name" href="#dictdef-sanitizerconfig" id="ref-for-dictdef-sanitizerconfig"><c- n>SanitizerConfig</c-></a> <dfn class="idl-code" data-dfn-for="Sanitizer/Sanitizer(config), Sanitizer/constructor(config), Sanitizer/Sanitizer(), Sanitizer/constructor()" data-dfn-type="argument" data-export id="dom-sanitizer-sanitizer-config-config"><code><c- g>config</c-></code><a class="self-link" href="#dom-sanitizer-sanitizer-config-config"></a></dfn> = {});

  <a data-link-type="idl-name" href="https://dom.spec.whatwg.org/#documentfragment" id="ref-for-documentfragment"><c- n>DocumentFragment</c-></a> <a class="idl-code" data-link-type="method" href="#dom-sanitizer-sanitize" id="ref-for-dom-sanitizer-sanitize"><c- g>sanitize</c-></a>((<a data-link-type="idl-name" href="https://dom.spec.whatwg.org/#document" id="ref-for-document①"><c- n>Document</c-></a> <c- b>or</c-> <a data-link-type="idl-name" href="https://dom.spec.whatwg.org/#documentfragment" id="ref-for-documentfragment①"><c- n>DocumentFragment</c-></a>) <dfn class="idl-code" data-dfn-for="Sanitizer/sanitize(input)" data-dfn-type="argument" data-export id="dom-sanitizer-sanitize-input-input"><code><c- g>input</c-></code><a class="self-link" href="#dom-sanitizer-sanitize-input-input"></a></dfn>);
  <a data-link-type="idl-name" href="https://dom.spec.whatwg.org/#element" id="ref-for-element①"><c- n>Element</c-></a>? <a class="idl-code" data-link-type="method" href="#dom-sanitizer-sanitizefor" id="ref-for-dom-sanitizer-sanitizefor"><c- g>sanitizeFor</c-></a>(<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString" id="ref-for-idl-DOMString"><c- b>DOMString</c-></a> <dfn class="idl-code" data-dfn-for="Sanitizer/sanitizeFor(element, input)" data-dfn-type="argument" data-export id="dom-sanitizer-sanitizefor-element-input-element"><code><c- g>element</c-></code><a class="self-link" href="#dom-sanitizer-sanitizefor-element-input-element"></a></dfn>, <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString" id="ref-for-idl-DOMString①"><c- b>DOMString</c-></a> <dfn class="idl-code" data-dfn-for="Sanitizer/sanitizeFor(element, input)" data-dfn-type="argument" data-export id="dom-sanitizer-sanitizefor-element-input-input"><code><c- g>input</c-></code><a class="self-link" href="#dom-sanitizer-sanitizefor-element-input-input"></a></dfn>);

  <a data-link-type="idl-name" href="#dictdef-sanitizerconfig" id="ref-for-dictdef-sanitizerconfig①"><c- n>SanitizerConfig</c-></a> <a class="idl-code" data-link-type="method" href="#dom-sanitizer-getconfiguration" id="ref-for-dom-sanitizer-getconfiguration"><c- g>getConfiguration</c-></a>();
  <c- b>static</c-> <a data-link-type="idl-name" href="#dictdef-sanitizerconfig" id="ref-for-dictdef-sanitizerconfig②"><c- n>SanitizerConfig</c-></a> <a class="idl-code" data-link-type="method" href="#dom-sanitizer-getdefaultconfiguration" id="ref-for-dom-sanitizer-getdefaultconfiguration"><c- g>getDefaultConfiguration</c-></a>();
};
</pre>
   <ul>
    <li data-md>
     <p>The <dfn class="dfn-paneled idl-code" data-dfn-for="Sanitizer" data-dfn-type="constructor" data-export data-lt="Sanitizer(config)|constructor(config)|Sanitizer()|constructor()" id="dom-sanitizer-sanitizer"> <code>new Sanitizer(<var>config</var>)</code></dfn> constructor steps
  are to run the <a data-link-type="dfn" href="#create-a-sanitizer" id="ref-for-create-a-sanitizer">create a sanitizer</a> algorithm steps on <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this">this</a> with <var>config</var> as parameter.</p>
    <li data-md>
     <p>The <dfn class="dfn-paneled idl-code" data-dfn-for="Sanitizer" data-dfn-type="method" data-export id="dom-sanitizer-sanitize"><code>sanitize(<var>input</var>)</code></dfn> method steps are to return the result of running the <a data-link-type="dfn" href="#sanitize" id="ref-for-sanitize">sanitize</a> algorithm on <var>input</var>,</p>
    <li data-md>
     <p>The <dfn class="dfn-paneled idl-code" data-dfn-for="Sanitizer" data-dfn-type="method" data-export id="dom-sanitizer-sanitizefor"><code>sanitizeFor(<var>element</var>, <var>input</var>)</code></dfn> method steps are to return the result of running <a data-link-type="dfn" href="#sanitizefor" id="ref-for-sanitizefor">sanitizeFor</a> algorithm on <var>element</var> and <var>input</var>.</p>
    <li data-md>
     <p>The <dfn class="dfn-paneled idl-code" data-dfn-for="Sanitizer" data-dfn-type="method" data-export id="dom-sanitizer-getconfiguration"><code>getConfiguration()</code></dfn> method steps are
  to return the result of running the <a data-link-type="dfn" href="#query-the-sanitizer-config" id="ref-for-query-the-sanitizer-config">query the sanitizer config</a> algorithm. It essentially returns a copy of the Sanitizer’s <a data-link-type="dfn" href="#configuration-dictionary" id="ref-for-configuration-dictionary">configuration dictionary</a>, with some degree of normalization.</p>
    <li data-md>
     <p>The value of the static <dfn class="dfn-paneled idl-code" data-dfn-for="Sanitizer" data-dfn-type="method" data-export id="dom-sanitizer-getdefaultconfiguration"><code>getDefaultConfiguration()</code></dfn> method steps
  are to return the value of the <a data-link-type="dfn" href="#default-configuration" id="ref-for-default-configuration">default configuration</a> object.</p>
   </ul>
   <p>The <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#element" id="ref-for-element②">Element</a></code> interface gains an additional method, <code>setHTML</code> which
applies a string using a <code>Sanitizer</code> directly to an existing element node.</p>
<pre class="idl highlight def"><c- b>dictionary</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="dictionary" data-export id="dictdef-sethtmloptions"><code><c- g>SetHTMLOptions</c-></code></dfn> {
  <a data-link-type="idl-name" href="#sanitizer" id="ref-for-sanitizer"><c- n>Sanitizer</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="SetHTMLOptions" data-dfn-type="dict-member" data-export data-type="Sanitizer " id="dom-sethtmloptions-sanitizer"><code><c- g>sanitizer</c-></code></dfn>;
};
[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#SecureContext" id="ref-for-SecureContext①"><c- g>SecureContext</c-></a>]
<c- b>partial</c-> <c- b>interface</c-> <a class="idl-code" data-link-type="interface" href="https://dom.spec.whatwg.org/#element" id="ref-for-element③"><c- g>Element</c-></a> {
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-undefined" id="ref-for-idl-undefined"><c- b>undefined</c-></a> <a class="idl-code" data-link-type="method" href="#dom-element-sethtml" id="ref-for-dom-element-sethtml"><c- g>setHTML</c-></a>(<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString" id="ref-for-idl-DOMString②"><c- b>DOMString</c-></a> <dfn class="idl-code" data-dfn-for="Element/setHTML(input, options), Element/setHTML(input)" data-dfn-type="argument" data-export id="dom-element-sethtml-input-options-input"><code><c- g>input</c-></code><a class="self-link" href="#dom-element-sethtml-input-options-input"></a></dfn>, <c- b>optional</c-> <a data-link-type="idl-name" href="#dictdef-sethtmloptions" id="ref-for-dictdef-sethtmloptions"><c- n>SetHTMLOptions</c-></a> <dfn class="idl-code" data-dfn-for="Element/setHTML(input, options), Element/setHTML(input)" data-dfn-type="argument" data-export id="dom-element-sethtml-input-options-options"><code><c- g>options</c-></code><a class="self-link" href="#dom-element-sethtml-input-options-options"></a></dfn> = {});
};
</pre>
   <ul>
    <li data-md>
     <p>The <dfn class="dfn-paneled idl-code" data-dfn-for="Element" data-dfn-type="method" data-export data-lt="setHTML(input, options)|setHTML(input)" id="dom-element-sethtml"><code>setHTML(<var>input</var>, <var>options</var>)</code></dfn> method steps are to run the <a data-link-type="dfn" href="#sanitizeandset" id="ref-for-sanitizeandset">sanitizeAndSet</a> algorithm on <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this①">this</a>, <var>input</var>, and <var>options</var>.</p>
   </ul>
   <details class="wpt-tests-block" dir="ltr" lang="en" open>
    <summary>Tests</summary>
    <ul class="wpt-tests-list">
     <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/sanitizer-api/sanitizer-secure-context.https.html" title="sanitizer-api/sanitizer-secure-context.https.html">sanitizer-secure-context.https.html</a> <a class="wpt-live" href="https://wpt.live/sanitizer-api/sanitizer-secure-context.https.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/sanitizer-api/sanitizer-secure-context.https.html"><small>(source)</small></a>
     <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/sanitizer-api/sanitizer-insecure-context.html" title="sanitizer-api/sanitizer-insecure-context.html">sanitizer-insecure-context.html</a> <a class="wpt-live" href="http://wpt.live/sanitizer-api/sanitizer-insecure-context.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/sanitizer-api/sanitizer-insecure-context.html"><small>(source)</small></a>
     <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/sanitizer-api/idlharness.https.window.js" title="sanitizer-api/idlharness.https.window.js">idlharness.https.window.js</a> <a class="wpt-live" href="https://wpt.live/sanitizer-api/idlharness.https.window.js"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/sanitizer-api/idlharness.https.window.js"><small>(source)</small></a>
    </ul>
   </details>
   <p class="issue" id="issue-a1fbc017"><a class="self-link" href="#issue-a1fbc017"></a> Is this how we specify a method on existing class "owned" by a different spe?</p>
   <div class="example" id="example-8886c10c">
    <a class="self-link" href="#example-8886c10c"></a> 
<pre class="language-js highlight"><c- c1>// To make our examples easy to follow, we’ll need a way create DOM nodes.</c->
<c- c1>// The following is hacky way to accomplish this, for illustration only,</c->
<c- c1>// that you shall pretty please not use in practice. This parsing method can</c->
<c- c1>// cause side-effects based on the string being parsed, which is insecure.</c->
<c- c1>// In fact, this very API exists for the sole purpose of preventing the</c->
<c- c1>// problems that this approach has.</c->
<c- c1>//</c->
<c- c1>// But... for our examples we’ll need something that is quick and easy, since</c->
<c- c1>// we cannot use our own Sanitizer API to explain our own Sanitizer API.</c->
<c- a>const</c-> to_node <c- o>=</c-> str <c- p>=></c-> document<c- p>.</c->createRange<c- p>().</c->createContextualFragment<c- p>(</c->str<c- p>);</c->

<c- c1>// The core API of the Sanitizer is the .sanitize method:</c->
<c- a>let</c-> untrusted_input <c- o>=</c-> to_node<c- p>(</c-><c- u>"Hello!"</c-><c- p>);</c->
<c- a>const</c-> sanitizer <c- o>=</c-> <c- ow>new</c-> Sanitizer<c- p>();</c->
sanitizer<c- p>.</c->sanitize<c- p>(</c->untrusted_input<c- p>);</c->  <c- c1>// DocumentFragment w/ a text node, "Hello!"</c->

<c- c1>// Probably we want to put this somewhere in our DOM:</c->
element<c- p>.</c->replaceChildren<c- p>(</c->sanitizer<c- p>.</c->sanitize<c- p>(</c->untrusted_input<c- p>));</c->

<c- c1>// If our input contains markup it’ll be mostly preserved, except for</c->
<c- c1>// script-y markup:</c->
untrusted_input <c- o>=</c-> to_node<c- p>(</c-><c- u>"&lt;em onclick='alert(1);'>Hello!&lt;/em>"</c-><c- p>);</c->
sanitizer<c- p>.</c->sanitize<c- p>(</c->untrusted_input<c- p>);</c->  <c- c1>// &lt;em>Hello!&lt;/em></c->
element<c- p>.</c->replaceChildren<c- p>(</c->sanitizer<c- p>.</c->sanitize<c- p>(</c->untrusted_input<c- p>));</c->  <c- c1>// No alert!</c->

<c- c1>// The .sanitize method is the primary API, and returns a DocumentFragment.</c->
<c- c1>// The .sanitizeFor method accepts and parses a string and returns an HTML</c->
<c- c1>// element node.</c->
<c- a>const</c-> hello <c- o>=</c-> to_node<c- p>(</c-><c- u>"hello"</c-><c- p>);</c->
<c- p>(</c->sanitizer<c- p>.</c->sanitize<c- p>(</c->hello<c- p>))</c-> <c- ow>instanceof</c-> DocumentFragment<c- p>;</c->  <c- c1>// true</c->
<c- p>(</c->sanitizer<c- p>.</c->sanitizeFor<c- p>(</c-><c- u>"template"</c-><c- p>,</c-> <c- u>"hello"</c-><c- p>))</c-> <c- ow>instanceof</c-> HTMLTemplateElement<c- p>;</c->  <c- c1>// true</c->
</pre>
   </div>
   <h3 class="heading settled" data-level="2.2" id="api-string-handling"><span class="secno">2.2. </span><span class="content">String Handling</span><a class="self-link" href="#api-string-handling"></a></h3>
   <p>Parsing (and unparsing) strings to (or from) HTML requires a context element.
Thus, the <code>sanitizeFor</code> method requires us to pass in a context, which the
implementation can then hand over to the HTML Parser.</p>
   <p>Additionally, the <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#element" id="ref-for-element④">Element</a></code> interface gains a <code>setHTML</code> method, which
always knows the correct context, because it is applied to a given <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#element" id="ref-for-element⑤">Element</a></code> instance. This <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#element" id="ref-for-element⑥">Element</a></code> is the correct context for both parsing and
unparsing its own content.</p>
   <p>One way to conceptualize this is to view string sanitization as a three step
operation: 1, parsing the string; 2, sanitizing the resulting node tree;
and 3, grafting the resulting subtree onto our live DOM. <code>Sanitizer.sanitize</code> is the middle step. <code>Sanitizer.sanitizeFor</code> performs the first and second steps, but leaves the
third to the developer. <code>Element.setHTML</code> does all three. Which to use
depends on the structure of your application, whether you can do all three
steps simultaneously, or whether maybe the sanitization is removed (in either
code structure or point in time) from the eventual modification of the DOM.</p>
   <div class="example" id="example-1adc4a7d">
    <a class="self-link" href="#example-1adc4a7d"></a> 
<pre class="language-js highlight"><c- c1>// If the markup to be sanitized is already available as a tree, for example</c->
<c- c1>// from an embedded frame, one can use sanitize:</c->
document<c- p>.</c->getElementById<c- p>(</c-><c- u>"target"</c-><c- p>).</c->replaceChildren<c- p>(</c->
  sanitizer<c- p>.</c->sanitize<c- p>(</c->
    document<c- p>.</c->querySelector<c- p>(</c-><c- u>"iframe#myframe"</c-><c- p>).</c->contentWindow<c- p>.</c->document<c- p>));</c->

<c- c1>// If the markup to be sanitized is present in string form, but we already</c->
<c- c1>// have the element we want to insert in available:</c->
<c- a>const</c-> untrusted_input <c- o>=</c-> <c- u>"...."</c-><c- p>;</c->
document<c- p>.</c->getElementById<c- p>(</c-><c- u>"someelement"</c-><c- p>).</c->setHTML<c- p>(</c->
  untrusted_input<c- p>,</c-> <c- p>{</c->sanitizer<c- o>:</c-> sanitizer<c- p>});</c->

<c- c1>// Same as above, but using the default Sanitizer configuration:</c->
document<c- p>.</c->getElementById<c- p>(</c-><c- u>"somelement"</c-><c- p>).</c->setHTML<c- p>(</c->untrusted_input<c- p>);</c->

<c- c1>// If the markup to be sanitized is present in string form, but we don’t want</c->
<c- c1>// to do the DOM insertion now:</c->
<c- a>let</c-> no_xss <c- o>=</c-> sanitizer<c- p>.</c->sanitizeFor<c- p>(</c-><c- u>"div"</c-><c- p>,</c-> untrusted_input<c- p>);</c->
<c- c1>// ... much later ...</c->
document<c- p>.</c->querySelector<c- p>(</c-><c- u>"div#targetdiv"</c-><c- p>).</c->replaceChildren<c- p>(...</c->no_xss<c- p>.</c->childNodes<c- p>);</c->

<c- c1>// Note that parsing HTML depends on the current context in many ways, some</c->
<c- c1>// subtle, some not so much. Supplying a different context than what the</c->
<c- c1>// result will eventually be used in has both security and functional risks.</c->
<c- c1>// It’s up to the developer to handle this safely.</c->
<c- c1>//</c->
<c- c1>// Example: Most, many parsing contexts disallow table  data (&lt;td>) without</c->
<c- c1>//          an enclosing table.</c->
sanitizer<c- p>.</c->sanitizeFor<c- p>(</c-><c- u>"div"</c-><c- p>,</c-> <c- u>"&lt;td>data&lt;/td>"</c-><c- p>).</c->innerHTML  <c- c1>// "data"</c->
sanitizer<c- p>.</c->sanitizeFor<c- p>(</c-><c- u>"table"</c-><c- p>,</c-> <c- u>"&lt;td>data&lt;/td>"</c-><c- p>).</c->innerHTML  <c- c1>// "&lt;td>data&lt;/td>"</c->
</pre>
   </div>
   <div class="note" role="note">
     Note: Sanitizing a string will use the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/parsing.html#html-parser" id="ref-for-html-parser">HTML Parser</a> to parse the input,
which will perform some degree of normalization. So even
if no sanitization steps are taken on a particular input, it cannot be
guaranteed that the output of <code>.sanitizeFor</code> will be character-for-character
identical to the input. 
    <div class="example" id="example-fc90214f">
     <a class="self-link" href="#example-fc90214f"></a> 
<pre class="language-js highlight">sanitizer<c- p>.</c->sanitizeFor<c- p>(</c-><c- u>"div"</c-><c- p>,</c-> <c- u>"Stra&amp;szlig;e"</c-><c- p>)</c->  <c- c1>// Straße</c->
sanitizer<c- p>.</c->sanitizeFor<c- p>(</c-><c- u>"div"</c-><c- p>,</c-> <c- u>"&lt;image>"</c-><c- p>)</c->  <c- c1>// &lt;img></c->
</pre>
    </div>
   </div>
   <div class="note" role="note">
     Note: <code>Sanitizer.sanitizeFor</code> and <code>Element.setHTML</code> can replace the
    respective other. Both are provided since they support different use cases. 
    <div class="example" id="example-a4e0dd12">
     <a class="self-link" href="#example-a4e0dd12"></a> 
<pre class="language-js highlight"><c- c1>// sanitizeFor, based on SetInnerHTML.</c->
<c- a>function</c-> sanitizeFor<c- p>(</c->element<c- p>,</c-> input<c- p>)</c-> <c- p>{</c->
  <c- a>const</c-> elem <c- o>=</c-> document<c- p>.</c->createElement<c- p>(</c->element<c- p>);</c->
  elem<c- p>.</c->setHTML<c- p>(</c->input<c- p>,</c-> <c- p>{</c->sanitizer<c- o>:</c-> <c- k>this</c-><c- p>});</c->
  <c- k>return</c-> elem<c- p>;</c->
<c- p>}</c->

<c- c1>// setHTML, based on sanitizeFor.</c->
<c- a>function</c-> setHTML<c- p>(</c->input<c- p>,</c-> options<c- p>)</c-> <c- p>{</c->
  <c- a>const</c-> sanitizer <c- o>=</c-> options<c- o>?</c-><c- p>.</c->sanitizer <c- o>??</c-> <c- ow>new</c-> Sanitizer<c- p>();</c->
  <c- k>this</c-><c- p>.</c->replaceChildren<c- p>(...</c->sanitizer<c- p>.</c->sanitizeFor<c- p>(</c-><c- k>this</c-><c- p>.</c->localName<c- p>,</c-> input<c- p>).</c->childNodes<c- p>);</c->
<c- p>}</c->
</pre>
    </div>
   </div>
   <h3 class="heading settled" data-level="2.3" id="config"><span class="secno">2.3. </span><span class="content">The Configuration Dictionary</span><a class="self-link" href="#config"></a></h3>
   <p>The Sanitizer’s <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="configuration-dictionary">configuration dictionary</dfn> is a dictionary which
describes modifications to the sanitize operation. If a Sanitizer has
not received an explicit configuration, for example when being
constructed without any parameters, then the <a data-link-type="dfn" href="#default-configuration" id="ref-for-default-configuration①">default configuration</a> value
is used as the configuration dictionary.</p>
<pre class="idl highlight def"><c- b>dictionary</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="dictionary" data-export id="dictdef-sanitizerconfig"><code><c- g>SanitizerConfig</c-></code></dfn> {
  <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#idl-sequence" id="ref-for-idl-sequence"><c- b>sequence</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString" id="ref-for-idl-DOMString③"><c- b>DOMString</c-></a>> <dfn class="dfn-paneled idl-code" data-dfn-for="SanitizerConfig" data-dfn-type="dict-member" data-export data-type="sequence<DOMString> " id="dom-sanitizerconfig-allowelements"><code><c- g>allowElements</c-></code></dfn>;
  <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#idl-sequence" id="ref-for-idl-sequence①"><c- b>sequence</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString" id="ref-for-idl-DOMString④"><c- b>DOMString</c-></a>> <dfn class="dfn-paneled idl-code" data-dfn-for="SanitizerConfig" data-dfn-type="dict-member" data-export data-type="sequence<DOMString> " id="dom-sanitizerconfig-blockelements"><code><c- g>blockElements</c-></code></dfn>;
  <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#idl-sequence" id="ref-for-idl-sequence②"><c- b>sequence</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString" id="ref-for-idl-DOMString⑤"><c- b>DOMString</c-></a>> <dfn class="dfn-paneled idl-code" data-dfn-for="SanitizerConfig" data-dfn-type="dict-member" data-export data-type="sequence<DOMString> " id="dom-sanitizerconfig-dropelements"><code><c- g>dropElements</c-></code></dfn>;
  <a data-link-type="idl-name" href="#typedefdef-attributematchlist" id="ref-for-typedefdef-attributematchlist"><c- n>AttributeMatchList</c-></a> <dfn class="idl-code" data-dfn-for="SanitizerConfig" data-dfn-type="dict-member" data-export data-type="AttributeMatchList " id="dom-sanitizerconfig-allowattributes"><code><c- g>allowAttributes</c-></code><a class="self-link" href="#dom-sanitizerconfig-allowattributes"></a></dfn>;
  <a data-link-type="idl-name" href="#typedefdef-attributematchlist" id="ref-for-typedefdef-attributematchlist①"><c- n>AttributeMatchList</c-></a> <dfn class="idl-code" data-dfn-for="SanitizerConfig" data-dfn-type="dict-member" data-export data-type="AttributeMatchList " id="dom-sanitizerconfig-dropattributes"><code><c- g>dropAttributes</c-></code><a class="self-link" href="#dom-sanitizerconfig-dropattributes"></a></dfn>;
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-boolean" id="ref-for-idl-boolean"><c- b>boolean</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="SanitizerConfig" data-dfn-type="dict-member" data-export data-type="boolean " id="dom-sanitizerconfig-allowcustomelements"><code><c- g>allowCustomElements</c-></code></dfn>;
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-boolean" id="ref-for-idl-boolean①"><c- b>boolean</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="SanitizerConfig" data-dfn-type="dict-member" data-export data-type="boolean " id="dom-sanitizerconfig-allowunknownmarkup"><code><c- g>allowUnknownMarkup</c-></code></dfn>;
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-boolean" id="ref-for-idl-boolean②"><c- b>boolean</c-></a> <dfn class="idl-code" data-dfn-for="SanitizerConfig" data-dfn-type="dict-member" data-export data-type="boolean " id="dom-sanitizerconfig-allowcomments"><code><c- g>allowComments</c-></code><a class="self-link" href="#dom-sanitizerconfig-allowcomments"></a></dfn>;
};
</pre>
   <dl>
    <dt data-md>allowElements
    <dd data-md>
     <p>The <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="element-allow-list">element allow list</dfn> is a sequence of strings with
  elements that the sanitizer should retain in the input.</p>
    <dt data-md>blockElements
    <dd data-md>
     <p>The <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="element-block-list">element block list</dfn> is a sequence of strings with elements
 where the sanitizer should remove the elements from the input, but retain
 their children.</p>
    <dt data-md>dropElements
    <dd data-md>
     <p>The <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="element-drop-list">element drop list</dfn> is a sequence of strings with elements
 that the sanitizer should remove from the input, including its children.</p>
    <dt data-md>allowAttributes
    <dd data-md>
     <p>The <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="attribute-allow-list">attribute allow list</dfn> is an <a data-link-type="dfn" href="#attribute-match-list" id="ref-for-attribute-match-list">attribute match list</a>, which
 determines whether an attribute (on a given element) should be allowed.</p>
    <dt data-md>dropAttributes
    <dd data-md>
     <p>The <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="attribute-drop-list">attribute drop list</dfn> is an <a data-link-type="dfn" href="#attribute-match-list" id="ref-for-attribute-match-list①">attribute match list</a>, which
 determines whether an attribute (on a given element) should be dropped.</p>
    <dt data-md>allowCustomElements
    <dd data-md>
     <p>The <code class="idl"><a data-link-type="idl" href="#dom-sanitizerconfig-allowcustomelements" id="ref-for-dom-sanitizerconfig-allowcustomelements">allow custom elements</a></code> option
 determines whether <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/custom-elements.html#custom-element" id="ref-for-custom-element">custom elements</a> are to be considered. The default is to drop them.
 If this option is true, custom elements will still be checked against all
 other built-in or configured checks.</p>
    <dt data-md>allowUnknownMarkup
    <dd data-md>
     <p>The <code class="idl"><a data-link-type="idl" href="#dom-sanitizerconfig-allowunknownmarkup" id="ref-for-dom-sanitizerconfig-allowunknownmarkup">allow unknown markup</a></code> option
 determines whether unknown HTML elements are to be considered. The default
 is to drop them.
 If this option is true, unkown HTML elements will still be checked against
 all other built-in or configured checks.</p>
    <dt data-md>allowComments
    <dd data-md>
     <p>The <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="allow-comments-option">allow comments option</dfn> determines whether HTML comments are
 allowed.</p>
   </dl>
   <p class="note" role="note"><span class="marker">Note:</span> <code>allowElements</code> creates a sanitizer that defaults to dropping elements,
  while <code>blockElements</code> and <code>dropElements</code> defaults to keeping unknown
  elements. Using both types is possible, but is probably of little practical
  use. The same applies to <code>allowAttributes</code> and <code>dropAttributes</code>.</p>
   <div class="example" id="example-fe7e1384">
    <a class="self-link" href="#example-fe7e1384"></a> 
<pre class="language-js highlight"><c- a>const</c-> sample <c- o>=</c-> to_node<c- p>(</c-><c- u>"Some text &lt;b>&lt;i>with&lt;/i>&lt;/b> &lt;blink>tags&lt;/blink>."</c-><c- p>);</c->
<c- a>const</c-> script_sample <c- o>=</c-> to_node<c- p>(</c-><c- u>"abc &lt;script>alert(1)&lt;/script> def"</c-><c- p>);</c->

<c- c1>// Some text &lt;b>with&lt;/b> text tags.</c->
<c- ow>new</c-> Sanitizer<c- p>({</c->allowElements<c- o>:</c-> <c- p>[</c-> <c- u>"b"</c-> <c- p>]}).</c->sanitize<c- p>(</c->sample<c- p>);</c->

<c- c1>// Some text &lt;i>with&lt;/i> &lt;blink>tags&lt;/blink>.</c->
<c- ow>new</c-> Sanitizer<c- p>({</c->blockElements<c- o>:</c-> <c- p>[</c-> <c- u>"b"</c-> <c- p>]}).</c->sanitize<c- p>(</c->sample<c- p>);</c->

<c- c1>// Some text &lt;blink>tags&lt;/blink>.</c->
<c- ow>new</c-> Sanitizer<c- p>({</c->dropElements<c- o>:</c-> <c- p>[</c-> <c- u>"b"</c-> <c- p>]}).</c->sanitize<c- p>(</c->sample<c- p>);</c->

<c- c1>// Note: The default configuration handles XSS-relevant input:</c->

<c- c1>// Non-scripting input will be passed through:</c->
<c- ow>new</c-> Sanitizer<c- p>().</c->sanitize<c- p>(</c->sample<c- p>);</c->  <c- c1>// Will output sample unmodified.</c->

<c- c1>// Scripts will be blocked: "abc alert(1) def"</c->
<c- ow>new</c-> Sanitizer<c- p>().</c->sanitize<c- p>(</c->script_sample<c- p>);</c->
</pre>
   </div>
   <p>In addition to allow and block lists for elements and attributes, there are
also options to configure some node or element types.</p>
   <p>Examples:</p>
<pre class="language-js highlight"><c- c1>// Comments will be dropped by default.</c->
<c- a>const</c-> comment <c- o>=</c-> to_node<c- p>(</c-><c- u>"Hello  World!"</c-><c- p>);</c->
<c- ow>new</c-> Sanitizer<c- p>().</c->sanitize<c- p>(</c->comment<c- p>);</c->  <c- c1>// "Hello  World!"</c->
<c- ow>new</c-> Sanitizer<c- p>({</c->allowComments<c- o>:</c-> <c- kc>true</c-><c- p>}).</c->sanitize<c- p>(</c->comment<c- p>);</c->  <c- c1>// Same as comment.</c->
</pre>
   <p>A sanitizer’s configuration can be queried using the <a data-link-type="dfn" href="#query-the-sanitizer-config" id="ref-for-query-the-sanitizer-config①">query the sanitizer config</a> method.</p>
   <div class="example" id="example-0c045ef2">
    <a class="self-link" href="#example-0c045ef2"></a> 
<pre class="language-js highlight"><c- c1>// Does the default config allow script elements?</c->
Sanitizer<c- p>.</c->getDefaultConfiguration<c- p>().</c->allowElements<c- p>.</c->includes<c- p>(</c-><c- u>"script"</c-><c- p>)</c->  <c- c1>// false</c->

<c- c1>// We found a Sanitizer instance. Does it have an allow-list configured?</c->
<c- a>const</c-> a_sanitizer <c- o>=</c-> <c- p>...;</c->
<c- o>!!</c->a_sanitizer<c- p>.</c->getConfiguration<c- p>().</c->allowElements <c- c1>// true, if an allowElements list is configured</c->

<c- c1>// If it does have an allow elements list, does it include the &lt;div> element?</c->
a_sanitizer<c- p>.</c->getConfiguration<c- p>().</c->allowElements<c- p>.</c->includes<c- p>(</c-><c- u>"div"</c-><c- p>)</c->  <c- c1>// true, if "div" is in allowElements.</c->

<c- c1>// Note that the getConfiguration method might do some normalization. E.g., it won’t</c->
<c- c1>// contain key/value pairs that are not declare in the IDL.</c->
Object<c- p>.</c->keys<c- p>(</c-><c- ow>new</c-> Sanitizer<c- p>({</c->madeUpDictionaryKey<c- o>:</c-> <c- u>"Hello"</c-><c- p>}).</c->getConfiguration<c- p>())</c->  <c- c1>// []</c->

<c- c1>// As a Sanitizer’s config describes its operation, a new sanitizer with</c->
<c- c1>// another instance’s configuration should behave identically.</c->
<c- c1>// (For illustration purposes only. It would make more sense to just use a directly.)</c->
<c- a>const</c-> a <c- o>=</c-> <c- d>/* ... a Sanitizer we found somewhere ... */</c-><c- p>;</c->
<c- a>const</c-> b <c- o>=</c-> <c- ow>new</c-> Sanitizer<c- p>(</c->a<c- p>.</c->getConfiguration<c- p>());</c->  <c- c1>// b should behave the same as a.</c->

<c- c1>// getDefaultConfiguration() and new Sanitizer().getConfiguration should be the same.</c->
<c- c1>// (For illustration purposes only. There are better ways of implementing</c->
<c- c1>// object equality in JavaScript.)</c->
JSON<c- p>.</c->stringify<c- p>(</c->Sanitizer<c- p>.</c->getDefaultConfiguration<c- p>())</c-> <c- o>==</c-> JSON<c- p>.</c->stringify<c- p>(</c-><c- ow>new</c-> Sanitizer<c- p>().</c->getConfiguration<c- p>());</c->  <c- c1>// true</c->
</pre>
   </div>
   <h4 class="heading settled" data-level="2.3.1" id="attr-match-list"><span class="secno">2.3.1. </span><span class="content">Attribute Match Lists</span><a class="self-link" href="#attr-match-list"></a></h4>
   <p>An <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="attribute-match-list">attribute match list</dfn> is a map of attributes to elements,
where the special name "*" stands for all attributes or elements.
A given <var>attribute</var> belonging to an <var>element</var> matches an <a data-link-type="dfn" href="#attribute-match-list" id="ref-for-attribute-match-list②">attribute match list</a>, if the <var>attribute</var> is a key in the match list,
and <var>element</var> or <code>"*"</code> are found in the <var>attribute</var>’s value list.</p>
   <p>Element names are interpreted as names in the [[HTML namespace]] and
non-namespaced attributes - i.e., what one may think of as normal <a data-link-type="biblio" href="#biblio-html" title="HTML Standard">[HTML]</a> elements and attributes. Elements are named by their <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-element-local-name" id="ref-for-concept-element-local-name">local name</a>, and <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-attribute-local-name" id="ref-for-concept-attribute-local-name">attributes, too</a>.</p>
<pre class="idl highlight def"><c- b>typedef</c-> <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#idl-record" id="ref-for-idl-record"><c- b>record</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString" id="ref-for-idl-DOMString⑥"><c- b>DOMString</c-></a>, <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#idl-sequence" id="ref-for-idl-sequence③"><c- b>sequence</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString" id="ref-for-idl-DOMString⑦"><c- b>DOMString</c-></a>>> <dfn class="dfn-paneled idl-code" data-dfn-type="typedef" data-export id="typedefdef-attributematchlist"><code><c- g>AttributeMatchList</c-></code></dfn>;
</pre>
   <div class="example" id="example-1002d69f">
    <a class="self-link" href="#example-1002d69f"></a> Examples for attributes and attribute match lists: 
<pre class="language-js highlight"><c- a>const</c-> sample <c- o>=</c-> to_node<c- p>(</c-><c- u>"&lt;span id='span1' class='theclass' style='font-weight: bold'>hello&lt;/span>"</c-><c- p>);</c->

<c- c1>// Allow only &lt;span style>: &lt;span style='font-weight: bold'>...&lt;/span></c->
<c- ow>new</c-> Sanitizer<c- p>({</c->allowAttributes<c- o>:</c-> <c- p>{</c-><c- u>"style"</c-><c- o>:</c-> <c- p>[</c-><c- u>"span"</c-><c- p>]}}).</c->sanitize<c- p>(</c->sample<c- p>);</c->

<c- c1>// Allow style, but not on span: &lt;span>...&lt;/span></c->
<c- ow>new</c-> Sanitizer<c- p>({</c->allowAttributes<c- o>:</c-> <c- p>{</c-><c- u>"style"</c-><c- o>:</c-> <c- p>[</c-><c- u>"div"</c-><c- p>]}}).</c->sanitize<c- p>(</c->sample<c- p>);</c->

<c- c1>// Allow style on any elements: &lt;span style='font-weight: bold'>...&lt;/span></c->
<c- ow>new</c-> Sanitizer<c- p>({</c->allowAttributes<c- o>:</c-> <c- p>{</c-><c- u>"style"</c-><c- o>:</c-> <c- p>[</c-><c- u>"*"</c-><c- p>]}}).</c->sanitize<c- p>(</c->sample<c- p>);</c->

<c- c1>// Drop &lt;span id>: &lt;span class='theclass' style='font-weight: bold'>...&lt;/span></c->
<c- ow>new</c-> Sanitizer<c- p>({</c->dropAttributes<c- o>:</c-> <c- p>{</c-><c- u>"id"</c-><c- o>:</c-> <c- p>[</c-><c- u>"span"</c-><c- p>]}}).</c->sanitize<c- p>(</c->sample<c- p>);</c->

<c- c1>// Drop id, everywhere: &lt;span class='theclass' style='font-weight: bold'>...&lt;/span></c->
<c- ow>new</c-> Sanitizer<c- p>({</c->dropAttributes<c- o>:</c-> <c- p>{</c-><c- u>"id"</c-><c- o>:</c-> <c- p>[</c-><c- u>"*"</c-><c- p>]}}).</c->sanitize<c- p>(</c->sample<c- p>);</c->
</pre>
   </div>
   <h2 class="heading settled" data-level="3" id="algorithms"><span class="secno">3. </span><span class="content">Algorithms</span><a class="self-link" href="#algorithms"></a></h2>
   <h3 class="heading settled" data-level="3.1" id="api-algorithms"><span class="secno">3.1. </span><span class="content">API Implementation</span><a class="self-link" href="#api-algorithms"></a></h3>
   <div class="algorithm" data-algorithm="create a sanitizer">
     To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="create-a-sanitizer">create a Sanitizer</dfn> with an optional <var>config</var> parameter, run
these steps: 
    <ol>
     <li data-md>
      <p>Create a copy of <var>config</var>.</p>
     <li data-md>
      <p>Set <var>config</var> as <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this②">this</a>'s <a data-link-type="dfn" href="#configuration-dictionary" id="ref-for-configuration-dictionary①">configuration dictionary</a>.</p>
    </ol>
    <p class="issue" id="issue-6f447953"><a class="self-link" href="#issue-6f447953"></a> This should explicitly state the config’s properties in which element names are found and modify the config wih map operations. <a href="https://github.com/WICG/sanitizer-api/issues/148">[Issue #148]</a></p>
   </div>
   <p class="note" role="note"><span class="marker">Note:</span> The configuration object contains element names in the <a data-link-type="dfn" href="#element-allow-list" id="ref-for-element-allow-list">element allow list</a>, <a data-link-type="dfn" href="#element-block-list" id="ref-for-element-block-list">element block list</a>, and <a data-link-type="dfn" href="#element-drop-list" id="ref-for-element-drop-list">element drop list</a>, and
  in the mapped values in the <a data-link-type="dfn" href="#attribute-allow-list" id="ref-for-attribute-allow-list">attribute allow list</a> and <a data-link-type="dfn" href="#attribute-drop-list" id="ref-for-attribute-drop-list">attribute drop list</a>.</p>
   <div class="algorithm" data-algorithm="sanitize">
     To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="sanitize">sanitize</dfn> a given <var>input</var> of type <code>Document or DocumentFragment</code> run these steps: 
    <ol>
     <li data-md>
      <p>Let <var>fragment</var> be the result of running the <a data-link-type="dfn" href="#create-a-document-fragment" id="ref-for-create-a-document-fragment">create a document fragment</a> algorithm on <var>input</var>.</p>
     <li data-md>
      <p>Run the <a data-link-type="dfn" href="#sanitize-a-document-fragment" id="ref-for-sanitize-a-document-fragment">sanitize a document fragment</a> algorithm on <var>fragment</var>.</p>
     <li data-md>
      <p>Return <var>fragment</var>.</p>
    </ol>
    <details class="wpt-tests-block" dir="ltr" lang="en" open>
     <summary>Tests</summary>
     <ul class="wpt-tests-list">
      <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/sanitizer-api/sanitizer-sanitize.https.tentative.html" title="sanitizer-api/sanitizer-sanitize.https.tentative.html">sanitizer-sanitize.https.tentative.html</a> <a class="wpt-live" href="https://wpt.live/sanitizer-api/sanitizer-sanitize.https.tentative.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/sanitizer-api/sanitizer-sanitize.https.tentative.html"><small>(source)</small></a>
     </ul>
    </details>
   </div>
   <p class="issue" id="issue-7d8b222c"><a class="self-link" href="#issue-7d8b222c"></a> The sanitize algorithm does not need to run "create a document fragment". <a href="https://github.com/WICG/sanitizer-api/issues/149">[Issue #149]</a></p>
   <div class="algorithm" data-algorithm="sanitizeFor">
     To <dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="sanitizeFor" data-noexport id="sanitizefor">sanitize for</dfn> an <var>element name</var> of type <var>DOMString</var> and a given <var>input</var> of type <var>DOMString</var> run these steps: 
    <ol>
     <li data-md>
      <p>Let <var>element</var> be an HTML element created by running the steps
 of the <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-create-element" id="ref-for-concept-create-element">creating an element</a> algorithm with the current document, <var>element name</var>, the <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#html-namespace" id="ref-for-html-namespace">HTML namespace</a>, and no optional parameters.</p>
     <li data-md>
      <p>If the <a data-link-type="dfn" href="#element-kind" id="ref-for-element-kind">element kind</a> of <var>element</var> is <code>regular</code> and if the <a data-link-type="dfn" href="#baseline-element-allow-list" id="ref-for-baseline-element-allow-list">baseline element allow list</a> does not contain <var>element name</var>,
 then return <code>null</code>.</p>
     <li data-md>
      <p>Let <var>fragment</var> be the result of invoking the <a href="https://w3c.github.io/DOM-Parsing/#dfn-fragment-parsing-algorithm">html fragment parsing algorithm</a>,
 with <var>element</var> as the <code>context element</code> and <var>input</var> as <code>markup</code>.</p>
     <li data-md>
      <p>Run the steps of the <a data-link-type="dfn" href="#sanitize-a-document-fragment" id="ref-for-sanitize-a-document-fragment①">sanitize a document fragment</a> algorithm on <var>fragment</var>.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-node-replace-all" id="ref-for-concept-node-replace-all">Replace all</a> with <var>fragment</var> as the <code>node</code> and <var>element</var> as the <code>parent</code>.</p>
     <li data-md>
      <p>Return <var>element</var>.</p>
    </ol>
    <details class="wpt-tests-block" dir="ltr" lang="en" open>
     <summary>Tests</summary>
     <ul class="wpt-tests-list">
      <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/sanitizer-api/sanitizer-sanitizeFor.https.tentative.html" title="sanitizer-api/sanitizer-sanitizeFor.https.tentative.html">sanitizer-sanitizeFor.https.tentative.html</a> <a class="wpt-live" href="https://wpt.live/sanitizer-api/sanitizer-sanitizeFor.https.tentative.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/sanitizer-api/sanitizer-sanitizeFor.https.tentative.html"><small>(source)</small></a>
     </ul>
    </details>
   </div>
   <p class="issue" id="issue-b45c400e"><a class="self-link" href="#issue-b45c400e"></a> Does the <code>.sanitizeFor</code> element name require namespace-related processing? <a href="https://github.com/WICG/sanitizer-api/issues/140">[Issue #140]</a></p>
   <div class="algorithm" data-algorithm="sanitizeAndSet">
     To <dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="sanitizeAndSet" data-noexport id="sanitizeandset">sanitize and set</dfn> a <var>value</var> using an <code class="idl"><a data-link-type="idl" href="#dictdef-sethtmloptions" id="ref-for-dictdef-sethtmloptions①">SetHTMLOptions</a></code> <var>options</var> dictionary on an <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#element" id="ref-for-element⑦">Element</a></code> node <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this③">this</a>,
run these steps: 
    <ol>
     <li data-md>
      <p>If the <a data-link-type="dfn" href="#element-kind" id="ref-for-element-kind①">element kind</a> of <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this④">this</a> is <code>regular</code> and <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this⑤">this</a>' <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-element-local-name" id="ref-for-concept-element-local-name①">local name</a> does not <a data-link-type="dfn" href="#element-matches-an-element-name" id="ref-for-element-matches-an-element-name">match</a> any name in the <a data-link-type="dfn" href="#baseline-element-allow-list" id="ref-for-baseline-element-allow-list①">baseline element allow list</a>, then throw a <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#exceptiondef-typeerror" id="ref-for-exceptiondef-typeerror">TypeError</a></code> and return.</p>
     <li data-md>
      <p>If the <code class="idl"><a data-link-type="idl" href="#dom-sethtmloptions-sanitizer" id="ref-for-dom-sethtmloptions-sanitizer">sanitizer</a></code> member <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-exists" id="ref-for-map-exists">exists</a> in the <var>options</var> <code class="idl"><a data-link-type="idl" href="#dictdef-sethtmloptions" id="ref-for-dictdef-sethtmloptions②">SetHTMLOptions</a></code> dictionary,</p>
      <ol>
       <li data-md>
        <p>then let <var>sanitizer</var> be <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-get" id="ref-for-map-get">the value</a> of the <code class="idl"><a data-link-type="idl" href="#dom-sethtmloptions-sanitizer" id="ref-for-dom-sethtmloptions-sanitizer①">sanitizer</a></code> member
 of the <var>options</var> <code class="idl"><a data-link-type="idl" href="#dictdef-sethtmloptions" id="ref-for-dictdef-sethtmloptions③">SetHTMLOptions</a></code> dictionary,</p>
       <li data-md>
        <p>otherwise let <var>sanitizer</var> be the result of the <a data-link-type="dfn" href="#create-a-sanitizer" id="ref-for-create-a-sanitizer①">create a Sanitizer</a> algorithm without a <code>config</code> parameter.</p>
      </ol>
     <li data-md>
      <p>Let <var>fragment</var> be the result of invoking the <a href="https://w3c.github.io/DOM-Parsing/#dfn-fragment-parsing-algorithm">html fragment parsing algorithm</a> with <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this⑥">this</a> as the <code>context node</code> and <var>value</var> as <code>markup</code>.</p>
     <li data-md>
      <p>Run the steps if the <a data-link-type="dfn" href="#sanitize-a-document-fragment" id="ref-for-sanitize-a-document-fragment②">sanitize a document fragment</a> algorithm
 on <var>fragment</var>, using <var>sanitizer</var> as the current <code class="idl"><a data-link-type="idl" href="#sanitizer" id="ref-for-sanitizer①">Sanitizer</a></code> instance.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-node-replace-all" id="ref-for-concept-node-replace-all①">Replace all</a> with <var>fragment</var> as the <code>node</code> and <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this⑦">this</a> as the <code>parent</code>.</p>
    </ol>
    <details class="wpt-tests-block" dir="ltr" lang="en" open>
     <summary>Tests</summary>
     <ul class="wpt-tests-list">
      <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/sanitizer-api/element-set-sanitized-html.https.html" title="sanitizer-api/element-set-sanitized-html.https.html">element-set-sanitized-html.https.html</a> <a class="wpt-live" href="https://wpt.live/sanitizer-api/element-set-sanitized-html.https.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/sanitizer-api/element-set-sanitized-html.https.html"><small>(source)</small></a>
     </ul>
    </details>
   </div>
   <div class="algorithm" data-algorithm="query the sanitizer config">
     To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="query-the-sanitizer-config">query the sanitizer config</dfn> of a given sanitizer instance,
run these steps: 
    <ol>
     <li data-md>
      <p>Let <var>sanitizer</var> be the current Sanitizer.</p>
     <li data-md>
      <p>Let <var>config</var> be <var>sanitizer</var>’s <a data-link-type="dfn" href="#configuration-dictionary" id="ref-for-configuration-dictionary②">configuration dictionary</a>, or the <a data-link-type="dfn" href="#default-configuration" id="ref-for-default-configuration②">default configuration</a> if no <a data-link-type="dfn" href="#configuration-dictionary" id="ref-for-configuration-dictionary③">configuration dictionary</a> was given.</p>
     <li data-md>
      <p>Let <var>result</var> be a newly constructed <code class="idl"><a data-link-type="idl" href="#dictdef-sanitizerconfig" id="ref-for-dictdef-sanitizerconfig③">SanitizerConfig</a></code> dictionary.</p>
     <li data-md>
      <p>For any non-empty member of <var>config</var> whose key is declared in <code class="idl"><a data-link-type="idl" href="#dictdef-sanitizerconfig" id="ref-for-dictdef-sanitizerconfig④">SanitizerConfig</a></code>, copy the value to <var>result</var>.</p>
     <li data-md>
      <p>Return <var>result</var>.</p>
    </ol>
    <details class="wpt-tests-block" dir="ltr" lang="en" open>
     <summary>Tests</summary>
     <ul class="wpt-tests-list">
      <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/sanitizer-api/sanitizer-config.https.html" title="sanitizer-api/sanitizer-config.https.html">sanitizer-config.https.html</a> <a class="wpt-live" href="https://wpt.live/sanitizer-api/sanitizer-config.https.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/sanitizer-api/sanitizer-config.https.html"><small>(source)</small></a>
      <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/sanitizer-api/sanitizer-query-config.https.html" title="sanitizer-api/sanitizer-query-config.https.html">sanitizer-query-config.https.html</a> <a class="wpt-live" href="https://wpt.live/sanitizer-api/sanitizer-query-config.https.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/sanitizer-api/sanitizer-query-config.https.html"><small>(source)</small></a>
     </ul>
    </details>
   </div>
   <p class="issue" id="issue-4f906162"><a class="self-link" href="#issue-4f906162"></a> IDL is taking care of most steps in "query the sanitizer config". Clean up. <a href="https://github.com/WICG/sanitizer-api/issues/150">[Issue #150]</a></p>
   <h3 class="heading settled" data-level="3.2" id="helper-algorithms"><span class="secno">3.2. </span><span class="content">Helper Definitions</span><a class="self-link" href="#helper-algorithms"></a></h3>
   <div class="algorithm" data-algorithm="create a document fragment">
     To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="create-a-document-fragment">create a document fragment</dfn> named <var>fragment</var> from an <var>input</var> of type <code>Document or DocumentFragment</code>, run these steps: 
    <ol>
     <li data-md>
      <p>Let <var>node</var> be null.</p>
     <li data-md>
      <p>Switch based on <var>input</var>’s type:</p>
      <ol>
       <li data-md>
        <p>If <var>input</var> is of type <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#documentfragment" id="ref-for-documentfragment②">DocumentFragment</a></code>, then:</p>
        <ol>
         <li data-md>
          <p>Set <var>node</var> to <var>input</var>.</p>
        </ol>
       <li data-md>
        <p>If <var>input</var> is of type <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#document" id="ref-for-document②">Document</a></code>, then:</p>
        <ol>
         <li data-md>
          <p>Set <var>node</var> to <var>input</var>’s <code>documentElement</code>.</p>
        </ol>
      </ol>
     <li data-md>
      <p>Let <var>clone</var> be the result of running <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-node-clone" id="ref-for-concept-node-clone">clone a node</a> on <var>node</var> with the <i>clone children flag</i> set.</p>
     <li data-md>
      <p>Let <var>fragment</var> be a new <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#documentfragment" id="ref-for-documentfragment③">DocumentFragment</a></code> whose <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-node-document" id="ref-for-concept-node-document">node document</a> is <var>node</var>’s <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-node-document" id="ref-for-concept-node-document①">node document</a>.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-node-append" id="ref-for-concept-node-append">Append</a> the node <var>clone</var> to <var>fragment</var>.</p>
     <li data-md>
      <p>Return <var>fragment</var>.</p>
    </ol>
   </div>
   <h3 class="heading settled" data-level="3.3" id="sanitizer-algorithms"><span class="secno">3.3. </span><span class="content">Sanitization Algorithms</span><a class="self-link" href="#sanitizer-algorithms"></a></h3>
   <div class="algorithm" data-algorithm="sanitize a document fragment">
     To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="sanitize-a-document-fragment">sanitize a document fragment</dfn> named <var>fragment</var> with a <code class="idl"><a data-link-type="idl" href="#sanitizer" id="ref-for-sanitizer②">Sanitizer</a></code> <var>sanitizer</var> run these steps: 
    <ol>
     <li data-md>
      <p>Let <var>m</var> be a map that maps nodes to a <a data-link-type="dfn" href="#sanitize-action" id="ref-for-sanitize-action">sanitize action</a>.</p>
     <li data-md>
      <p>Let <var>nodes</var> be a list containing the <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-tree-inclusive-descendant" id="ref-for-concept-tree-inclusive-descendant">inclusive descendants</a> of <var>fragment</var>, in <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-tree-order" id="ref-for-concept-tree-order">tree order</a>.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-iterate" id="ref-for-list-iterate">For each</a> <var>node</var> in <var>nodes</var>:</p>
      <ol>
       <li data-md>
        <p>Let <var>action</var> be the result of running the <a data-link-type="dfn" href="#sanitize-a-node" id="ref-for-sanitize-a-node">sanitize a node</a> algorithm
 on <var>node</var> with <var>sanitizer</var>.</p>
       <li data-md>
        <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-set" id="ref-for-map-set">Set</a> <var>m</var>[<var>node</var>] to <var>action</var>.</p>
      </ol>
     <li data-md>
      <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-iterate" id="ref-for-list-iterate①">For each</a> <var>node</var> in <var>nodes</var>:</p>
      <ol>
       <li data-md>
        <p>If <var>m</var>[<var>node</var>] is <code>drop</code>, <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-node-remove" id="ref-for-concept-node-remove">remove</a> <var>node</var>.</p>
       <li data-md>
        <p>If <var>m</var>[<var>node</var>] is <code>block</code>, create a <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#documentfragment" id="ref-for-documentfragment④">DocumentFragment</a></code> <var>fragment</var>, <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-node-append" id="ref-for-concept-node-append①">append</a> all of <var>node</var>’s <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-tree-child" id="ref-for-concept-tree-child">children</a> to <var>fragment</var>, and <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-node-replace" id="ref-for-concept-node-replace">replace</a> <var>node</var> within <var>node</var>’s <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-tree-parent" id="ref-for-concept-tree-parent">parent</a> with <var>fragment</var>.</p>
       <li data-md>
        <p>If <var>m</var>[<var>node</var>] is <code>keep</code>, do nothing.</p>
      </ol>
    </ol>
   </div>
   <p class="issue" id="issue-2fb6262a"><a class="self-link" href="#issue-2fb6262a"></a> The step above needs to explicitly iterate over the children and insert into parent. It could collect them in a variable or do things in place, but this is a bit too imprecise. <a href="https://github.com/WICG/sanitizer-api/issues/156">[Issue #156]</a></p>
   <div class="algorithm" data-algorithm="sanitize a node">
     To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="sanitize-a-node">sanitize a node</dfn> named <var>node</var> with <var>sanitizer</var> run these steps: 
    <ol>
     <li data-md>
      <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#assert" id="ref-for-assert">Assert</a>: <var>node</var> is not a <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#document" id="ref-for-document③">Document</a></code> or <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#documentfragment" id="ref-for-documentfragment⑤">DocumentFragment</a></code> or <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#attr" id="ref-for-attr">Attr</a></code> or <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#documenttype" id="ref-for-documenttype">DocumentType</a></code> <a data-link-type="dfn" href="https://www.w3.org/TR/rdf11-mt/#dfn-node" id="ref-for-dfn-node">node</a>.</p>
     <li data-md>
      <p>If <var>node</var> is an element node:</p>
      <ol>
       <li data-md>
        <p>Let <var>element</var> be <var>node</var>.</p>
       <li data-md>
        <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-iterate" id="ref-for-list-iterate②">For each</a> <var>attr</var> in <var>element</var>’s <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-element-attribute" id="ref-for-concept-element-attribute">attribute list</a>:</p>
        <ol>
         <li data-md>
          <p>Let <var>attr action</var> be the result of running the <a data-link-type="dfn" href="#sanitize-action-for-an-attribute" id="ref-for-sanitize-action-for-an-attribute">sanitize action for an attribute</a> algorithm on <var>attr</var> and <var>element</var>.</p>
         <li data-md>
          <p>If <var>attr action</var> is different from <code>keep</code>, <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-element-attributes-remove" id="ref-for-concept-element-attributes-remove">remove an attribute</a> supplying <var>attr</var>.</p>
        </ol>
       <li data-md>
        <p>Run the steps to <a data-link-type="dfn" href="#handle-funky-elements" id="ref-for-handle-funky-elements">handle funky elements</a> on <var>element</var>.</p>
       <li data-md>
        <p>Let <var>action</var> be the result of running the <a data-link-type="dfn" href="#sanitize-action-for-an-element" id="ref-for-sanitize-action-for-an-element">sanitize action for an element</a> on <var>element</var>.</p>
       <li data-md>
        <p>Return <var>action</var>.</p>
      </ol>
     <li data-md>
      <p>If <var>node</var> is a <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#comment" id="ref-for-comment">Comment</a></code> <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#boundary-point-node" id="ref-for-boundary-point-node">node</a>:</p>
      <ol>
       <li data-md>
        <p>Let <var>config</var> be <var>sanitizer</var>’s <a data-link-type="dfn" href="#configuration-dictionary" id="ref-for-configuration-dictionary④">configuration dictionary</a>, or the <a data-link-type="dfn" href="#default-configuration" id="ref-for-default-configuration③">default configuration</a> if no <a data-link-type="dfn" href="#configuration-dictionary" id="ref-for-configuration-dictionary⑤">configuration dictionary</a> was given.</p>
       <li data-md>
        <p>If <var>config</var>’s <a data-link-type="dfn" href="#allow-comments-option" id="ref-for-allow-comments-option">allow comments option</a> <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-exists" id="ref-for-map-exists①">exists</a> and <code>|config|[allowComments]</code> is <code>true</code>: Return <code>keep</code>.</p>
       <li data-md>
        <p>Return <code>drop</code>.</p>
      </ol>
     <li data-md>
      <p>If <var>node</var> is a <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#text" id="ref-for-text">Text</a></code> <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#boundary-point-node" id="ref-for-boundary-point-node①">node</a>: Return <code>keep</code>.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#assert" id="ref-for-assert①">Assert</a>: <var>node</var> is a <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#processinginstruction" id="ref-for-processinginstruction">ProcessingInstruction</a></code></p>
     <li data-md>
      <p>Return <code>drop</code>.</p>
    </ol>
   </div>
   <p class="issue" id="issue-bf17aea7"><a class="self-link" href="#issue-bf17aea7"></a> The <a data-link-type="dfn" href="#sanitize-action-for-an-attribute" id="ref-for-sanitize-action-for-an-attribute①">sanitize action for an attribute</a> algorithm parameters do not match.
Issue(153): consider creating an effective sanitizer config. Also, IDL guarantees that a config is ALWAYS given. The question is really whether the members exists. <a href="https://github.com/WICG/sanitizer-api/issues/151">[Issue #151]</a></p>
   <p>Some HTML elements require special treatment in a way that can’t be easily
expressed in terms of configuration options or other algorithms. The following
algorithm collects these in one place.</p>
   <div class="algorithm" data-algorithm="handle funky elements">
     To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="handle-funky-elements">handle funky elements</dfn> on a given <var>element</var>, run these steps: 
    <ol>
     <li data-md>
      <p>If <var>element</var>’s <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-element-namespace" id="ref-for-concept-element-namespace">namespace</a> <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#string-is" id="ref-for-string-is">is</a> <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#html-namespace" id="ref-for-html-namespace①">HTML</a> and
 the <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-element-local-name" id="ref-for-concept-element-local-name②">local name</a> <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#string-is" id="ref-for-string-is①">is</a> <code>"template"</code>:</p>
      <ol>
       <li data-md>
        <p>Run the steps of the <a data-link-type="dfn" href="#sanitize-a-document-fragment" id="ref-for-sanitize-a-document-fragment③">sanitize a document fragment</a> algorithm on <var>element</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/#template-contents" id="ref-for-template-contents">template contents</a> attribute.</p>
       <li data-md>
        <p>Drop all child nodes of <var>element</var>.</p>
      </ol>
     <li data-md>
      <p>If <var>element</var>’s <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-element-namespace" id="ref-for-concept-element-namespace①">namespace</a> <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#string-is" id="ref-for-string-is②">is</a> <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#html-namespace" id="ref-for-html-namespace②">HTML</a> and
 the <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-element-local-name" id="ref-for-concept-element-local-name③">local name</a> <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#string-is" id="ref-for-string-is③">is</a> one of <code>"a"</code> or <code>"area"</code>,
 and if <var>element</var>’s <code>protocol</code> property is "javascript:":</p>
      <ol>
       <li data-md>
        <p>Remove the <code>href</code> attribute from <var>element</var>.</p>
      </ol>
     <li data-md>
      <p>If <var>element</var>’s <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-element-namespace" id="ref-for-concept-element-namespace②">namespace</a> <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#string-is" id="ref-for-string-is④">is</a> <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#html-namespace" id="ref-for-html-namespace③">HTML</a> and
 the <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-element-local-name" id="ref-for-concept-element-local-name④">local name</a> <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#string-is" id="ref-for-string-is⑤">is</a> <code>"form"</code> and if <var>element</var>’s <code>action</code> attribute is a <a data-link-type="biblio" href="#biblio-url" title="URL Standard">[URL]</a> with <code>javascript:</code> protocol:</p>
      <ol>
       <li data-md>
        <p>Remove the <code>action</code> attribute from <var>element</var>.</p>
      </ol>
     <li data-md>
      <p>If <var>element</var>’s <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-element-namespace" id="ref-for-concept-element-namespace③">namespace</a> <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#string-is" id="ref-for-string-is⑥">is</a> <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#html-namespace" id="ref-for-html-namespace④">HTML</a> and
 the <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-element-local-name" id="ref-for-concept-element-local-name⑤">local name</a> <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#string-is" id="ref-for-string-is⑦">is</a> <code>"input"</code> or <code>"button"</code>,
 and if <var>element</var>’s <code>formaction</code> attribute is a <a data-link-type="biblio" href="#biblio-url" title="URL Standard">[URL]</a> with <code>javascript:</code> protocol</p>
      <ol>
       <li data-md>
        <p>Remove the <code>formaction</code> attribute from <var>element</var>.</p>
      </ol>
    </ol>
   </div>
   <p class="issue" id="issue-c273ffb5"><a class="self-link" href="#issue-c273ffb5"></a> Export and refer funky element properties more precisely. <a href="https://github.com/WICG/sanitizer-api/issues/154">[Issue #154]</a></p>
   <h3 class="heading settled" data-level="3.4" id="configuration"><span class="secno">3.4. </span><span class="content">Matching Against The Configuration</span><a class="self-link" href="#configuration"></a></h3>
   <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="sanitize-action">sanitize action</dfn> is <code>keep</code>, <code>drop</code>, or <code>block</code>.</p>
   <div class="algorithm" data-algorithm="sanitize action for an element">
     To determine the <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="sanitize-action-for-an-element">sanitize action for an <var>element</var></dfn>, given a <code class="idl"><a data-link-type="idl" href="#dictdef-sanitizerconfig" id="ref-for-dictdef-sanitizerconfig⑤">SanitizerConfig</a></code> <var>config</var>, run these steps: 
    <ol>
     <li data-md>
      <p>Let <var>kind</var> be <var>element</var>’s <a data-link-type="dfn" href="#element-kind" id="ref-for-element-kind②">element kind</a>.</p>
     <li data-md>
      <p>If <var>kind</var> is <code>regular</code> and <var>element</var> does not <a data-link-type="dfn" href="#element-matches-an-element-name" id="ref-for-element-matches-an-element-name①">match</a> any name in the <a data-link-type="dfn" href="#baseline-element-allow-list" id="ref-for-baseline-element-allow-list②">baseline element allow list</a>: Return <code>drop</code>.</p>
     <li data-md>
      <p>If <var>kind</var> is <code>custom</code> and if <var>config</var>["<code class="idl"><a data-link-type="idl" href="#dom-sanitizerconfig-allowcustomelements" id="ref-for-dom-sanitizerconfig-allowcustomelements①">allowCustomElements</a></code>"] does not <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-exists" id="ref-for-map-exists②">exist</a> or if <var>config</var>["<code class="idl"><a data-link-type="idl" href="#dom-sanitizerconfig-allowcustomelements" id="ref-for-dom-sanitizerconfig-allowcustomelements②">allowCustomElements</a></code>"] is <code>false</code>: Return <code>drop</code>.</p>
     <li data-md>
      <p>If <var>kind</var> is <code>unknown</code> and if <var>config</var>["<code class="idl"><a data-link-type="idl" href="#dom-sanitizerconfig-allowunknownmarkup" id="ref-for-dom-sanitizerconfig-allowunknownmarkup①">allowUnknownMarkup</a></code>"]
 does not <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-exists" id="ref-for-map-exists③">exist</a> or it <var>config</var>["<code class="idl"><a data-link-type="idl" href="#dom-sanitizerconfig-allowunknownmarkup" id="ref-for-dom-sanitizerconfig-allowunknownmarkup②">allowUnknownMarkup</a></code>"]
 is <code>false</code>: Return <code>drop</code>.</p>
     <li data-md>
      <p>If <var>element</var> <a data-link-type="dfn" href="#element-matches-an-element-name" id="ref-for-element-matches-an-element-name②">matches</a> any name
 in <var>config</var>["<code class="idl"><a data-link-type="idl" href="#dom-sanitizerconfig-dropelements" id="ref-for-dom-sanitizerconfig-dropelements">dropElements</a></code>"]: Return <code>drop</code>.</p>
     <li data-md>
      <p>If <var>element</var> <a data-link-type="dfn" href="#element-matches-an-element-name" id="ref-for-element-matches-an-element-name③">matches</a> any name
 in <var>config</var>["<code class="idl"><a data-link-type="idl" href="#dom-sanitizerconfig-blockelements" id="ref-for-dom-sanitizerconfig-blockelements">blockElements</a></code>"]: Return <code>block</code>.</p>
     <li data-md>
      <p>Let <var>allow list</var> be null.</p>
     <li data-md>
      <p>If "<code class="idl"><a data-link-type="idl" href="#dom-sanitizerconfig-allowelements" id="ref-for-dom-sanitizerconfig-allowelements">allowElements</a></code>" <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-exists" id="ref-for-map-exists④">exists</a> in <var>config</var>:</p>
      <ol>
       <li data-md>
        <p>Then : Set <var>allow list</var> to <var>config</var>["<code class="idl"><a data-link-type="idl" href="#dom-sanitizerconfig-allowelements" id="ref-for-dom-sanitizerconfig-allowelements①">allowElements</a></code>"].</p>
       <li data-md>
        <p>Otherwise: Set <var>allow list</var> to the <a data-link-type="dfn" href="#default-configuration" id="ref-for-default-configuration④">default configuration</a>'s <a data-link-type="dfn" href="#element-allow-list" id="ref-for-element-allow-list①">element allow list</a>.</p>
      </ol>
     <li data-md>
      <p>If <var>element</var> does not <a data-link-type="dfn" href="#element-matches-an-element-name" id="ref-for-element-matches-an-element-name④">match</a> any name
 in <var>allow list</var>: Return <code>block</code>.</p>
     <li data-md>
      <p>Return <code>keep</code>.</p>
    </ol>
    <details class="wpt-tests-block" dir="ltr" lang="en" open>
     <summary>Tests</summary>
     <ul class="wpt-tests-list">
      <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/sanitizer-api/sanitizer-unknown.https.html" title="sanitizer-api/sanitizer-unknown.https.html">sanitizer-unknown.https.html</a> <a class="wpt-live" href="https://wpt.live/sanitizer-api/sanitizer-unknown.https.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/sanitizer-api/sanitizer-unknown.https.html"><small>(source)</small></a>
     </ul>
    </details>
   </div>
   <div class="algorithm" data-algorithm="element matches an element name">
     To determine whether an <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="element-matches-an-element-name"><var>element</var> matches an element <var>name</var></dfn>,
run these steps: 
    <ol>
     <li data-md>
      <p>If <var>element</var> is in the <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#html-namespace" id="ref-for-html-namespace⑤">HTML namespace</a> and if <var>element</var>’s <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-element-local-name" id="ref-for-concept-element-local-name⑥">local name</a> is <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#string-is" id="ref-for-string-is⑧">identical to</a> <var>name</var>: Return <code>true</code>.</p>
     <li data-md>
      <p>Return <code>false</code>.</p>
    </ol>
   </div>
   <p class="issue" id="issue-d7c2c132"><a class="self-link" href="#issue-d7c2c132"></a> Whitespaces or colons? <a href="https://github.com/WICG/sanitizer-api/issues/146">[Issue #146]</a></p>
   <div class="algorithm" data-algorithm="attribute matches an attribute match list">
     To determine whether an <dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="attribute matches an attribute match list" data-noexport id="attribute-matches-an-attribute-match-list"><var>attribute</var> matches an <a data-link-type="dfn" href="#attribute-match-list" id="ref-for-attribute-match-list③">attribute match
list</a></dfn> <var>list</var>, run these steps: 
    <ol>
     <li data-md>
      <p>If <var>attribute</var>’s <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-attribute-namespace" id="ref-for-concept-attribute-namespace">namespace</a> is not <code>null</code>: Return <code>false</code>.</p>
     <li data-md>
      <p>If <var>attribute</var>’s <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-attribute-local-name" id="ref-for-concept-attribute-local-name①">local name</a> does not match the <a data-link-type="dfn" href="#attribute-match-list" id="ref-for-attribute-match-list④">attribute match list</a> <var>list</var>’s <a href="https://webidl.spec.whatwg.org/#idl-record" id="termref-for-idl-record">key</a> and if the key is
 not <code>"*"</code>: Return <code>false</code>.</p>
     <li data-md>
      <p>Let <var>element</var> be the <var>attribute</var>’s <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#element" id="ref-for-element⑧">Element</a></code>.</p>
     <li data-md>
      <p>Let <var>element name</var> be <var>element</var>’s <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-element-local-name" id="ref-for-concept-element-local-name⑦">local name</a>.</p>
     <li data-md>
      <p>If <var>list</var>’s <a href="https://webidl.spec.whatwg.org/#idl-record" id="termref-for-idl-record①">value</a> does not
 contain <var>element name</var> and value is not <code>["*"]</code>: Return <code>false</code>.</p>
     <li data-md>
      <p>Return <code>true</code>.</p>
    </ol>
    <div class="algorithm" data-algorithm="sanitize action for an attribute">
      To determine the <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="sanitize-action-for-an-attribute">sanitize action for an <var>attribute</var></dfn> given a Sanitizer
configuration dictionary <var>config</var>, run these steps: 
     <ol>
      <li data-md>
       <p>Let <var>kind</var> be <var>attribute</var>’s <a data-link-type="dfn" href="#attribute-kind" id="ref-for-attribute-kind">attribute kind</a>.</p>
      <li data-md>
       <p>If <var>kind</var> is <code>unknown</code> and if <var>config</var>["<code class="idl"><a data-link-type="idl" href="#dom-sanitizerconfig-allowunknownmarkup" id="ref-for-dom-sanitizerconfig-allowunknownmarkup③">allowUnknownMarkup</a></code>"]
 does not <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-exists" id="ref-for-map-exists⑤">exist</a> or it <var>config</var>["<code class="idl"><a data-link-type="idl" href="#dom-sanitizerconfig-allowunknownmarkup" id="ref-for-dom-sanitizerconfig-allowunknownmarkup④">allowUnknownMarkup</a></code>"]
 is <code>false</code>: Return <code>drop</code>.</p>
      <li data-md>
       <p>If <var>kind</var> is <code>regular</code> and <var>attribute</var>’s <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-attribute-local-name" id="ref-for-concept-attribute-local-name②">local name</a> does not match any
 name in the <a data-link-type="dfn" href="#baseline-attribute-allow-list" id="ref-for-baseline-attribute-allow-list">baseline attribute allow list</a>: Return <code>drop</code>.</p>
      <li data-md>
       <p>If <var>attribute</var> <a data-link-type="dfn" href="#attribute-matches-an-attribute-match-list" id="ref-for-attribute-matches-an-attribute-match-list">matches</a> any <a data-link-type="dfn" href="#attribute-match-list" id="ref-for-attribute-match-list⑤">attribute match list</a> in <var>config</var>’s <a data-link-type="dfn" href="#attribute-drop-list" id="ref-for-attribute-drop-list①">attribute drop list</a>: Return <code>drop</code>.</p>
      <li data-md>
       <p>If <a data-link-type="dfn" href="#attribute-allow-list" id="ref-for-attribute-allow-list①">attribute allow list</a> <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-exists" id="ref-for-map-exists⑥">exists</a> in <var>config</var>:</p>
       <ol>
        <li data-md>
         <p>Then let <var>allow list</var> be <code>|config|["allowAttributes"]</code>.</p>
        <li data-md>
         <p>Otherwise: Let <var>allow list</var> be the <a data-link-type="dfn" href="#default-configuration" id="ref-for-default-configuration⑤">default configuration</a>'s <a data-link-type="dfn" href="#attribute-allow-list" id="ref-for-attribute-allow-list②">attribute allow list</a>.</p>
       </ol>
      <li data-md>
       <p>If <var>attribute</var> does not <a data-link-type="dfn" href="#attribute-matches-an-attribute-match-list" id="ref-for-attribute-matches-an-attribute-match-list①">match</a> any <a data-link-type="dfn" href="#attribute-match-list" id="ref-for-attribute-match-list⑥">attribute match list</a> in <var>allow list</var>: Return <code>drop</code>.</p>
      <li data-md>
       <p>Return <code>keep</code>.</p>
     </ol>
    </div>
    <div class="algorithm" data-algorithm="element kind">
      The <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="element-kind">element kind</dfn> of an <var>element</var> is one of <code>regular</code>, <code>unknown</code>,
or <code>custom</code>. Let <var>element kind</var> be: 
     <ul>
      <li data-md>
       <p><code>custom</code>, if <var>element</var>’s <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-element-local-name" id="ref-for-concept-element-local-name⑧">local name</a> is a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/custom-elements.html#valid-custom-element-name" id="ref-for-valid-custom-element-name">valid custom element name</a>,</p>
      <li data-md>
       <p><code>unknown</code>, if <var>element</var> is not in the <a data-link-type="biblio" href="#biblio-html" title="HTML Standard">[HTML]</a> namespace or if <var>element</var>’s <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-element-local-name" id="ref-for-concept-element-local-name⑨">local name</a> denotes an unknown element — that is, if the <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-element-interface" id="ref-for-concept-element-interface">element interface</a> the <a data-link-type="biblio" href="#biblio-html" title="HTML Standard">[HTML]</a> specification assigns to it would
 be <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/dom.html#htmlunknownelement" id="ref-for-htmlunknownelement">HTMLUnknownElement</a></code>,</p>
     </ul>
     <p class="issue" id="issue-f3f3c0ed"><a class="self-link" href="#issue-f3f3c0ed"></a> We do not want to use the interface (e.g., "applet" and "blink" are HTMLUnknownElement) <a href="https://github.com/WICG/sanitizer-api/issues/147">[Issue #147]</a></p>
     <ul>
      <li data-md>
       <p><code>regular</code>, otherwise.</p>
     </ul>
    </div>
    <div class="algorithm" data-algorithm="attribute kind">
      Similarly, the <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="attribute-kind">attribute kind</dfn> of an <var>attribute</var> is one of <code>regular</code> or <code>unknown</code>. Let <var>attribute kind</var> be: 
     <ul>
      <li data-md>
       <p><code>unknown</code>, if the <a data-link-type="biblio" href="#biblio-html" title="HTML Standard">[HTML]</a> specification does not assign any meaning to <var>attribute</var>’s name.</p>
     </ul>
     <p class="issue" id="issue-a274fa37"><a class="self-link" href="#issue-a274fa37"></a> Again, this needs to be more specific. Historical, obsolete, conforming, non-conforming (e.g. bgcolor). It is desirable we make a sanitizer-specific list. <a href="https://github.com/WICG/sanitizer-api/issues/147">[Issue #147]</a></p>
     <ul>
      <li data-md>
       <p><code>regular</code>, otherwise.</p>
     </ul>
    </div>
    <h3 class="heading settled" data-level="3.5" id="defaults"><span class="secno">3.5. </span><span class="content">Baseline and Defaults</span><a class="self-link" href="#defaults"></a></h3>
    <p class="issue" id="issue-53c87d03"><a class="self-link" href="#issue-53c87d03"></a> The sanitizer baseline and defaults need to be carefully vetted, and
    are still under discussion. The values below are for illustrative
    purposes only.</p>
    <p>The sanitizer has a built-in <a data-link-type="dfn" href="#default-configuration" id="ref-for-default-configuration⑥">default configuration</a>, which is stricter than
the baseline and aims to eliminate any script-injection possibility, as well
as legacy or unusual constructs.</p>
    <p>The defaults and baseline are defined by three JSON constants, <a data-link-type="dfn" href="#baseline-element-allow-list" id="ref-for-baseline-element-allow-list③">baseline element allow list</a>, <a data-link-type="dfn" href="#baseline-attribute-allow-list" id="ref-for-baseline-attribute-allow-list①">baseline attribute allow list</a>, <a data-link-type="dfn" href="#default-configuration" id="ref-for-default-configuration⑦">default configuration</a>. For better readability, these have been moved to
an <a href="#constants">appendix A</a>.</p>
    <h2 class="heading settled" data-level="4" id="security-considerations"><span class="secno">4. </span><span class="content">Security Considerations</span><a class="self-link" href="#security-considerations"></a></h2>
    <p>The Sanitizer API is intended to prevent DOM-based Cross-Site Scripting
by traversing a supplied HTML content and removing elements and attributes
according to a configuration. The specified API must not support
the construction of a Sanitizer object that leaves script-capable markup in
and doing so would be a bug in the threat model.</p>
    <p>That being said, there are security issues which the correct usage of the
Sanitizer API will not be able to protect against and the scenarios will be
laid out in the following sections.</p>
    <h3 class="heading settled" data-level="4.1" id="server-side-xss"><span class="secno">4.1. </span><span class="content">Server-Side Reflected and Stored XSS</span><a class="self-link" href="#server-side-xss"></a></h3>
    <p><em>This section is not normative.</em></p>
    <p>The Sanitizer API operates solely in the DOM and adds a capability to traverse
and filter an existing DocumentFragment. The Sanitizer does not address
server-side reflected or stored XSS.</p>
    <h3 class="heading settled" data-level="4.2" id="dom-clobbering"><span class="secno">4.2. </span><span class="content">DOM clobbering</span><a class="self-link" href="#dom-clobbering"></a></h3>
    <p><em>This section is not normative.</em></p>
    <p>DOM clobbering describes an attack in which malicious HTML confuses an
application by naming elements through <code>id</code> or <code>name</code> attributes such that
properties like <code>children</code> of an HTML element in the DOM are overshadowed by
the malicious content.</p>
    <p>The Sanitizer API does not protect DOM clobbering attacks in its
default state, but can be configured to remove <code>id</code> and <code>name</code> attributes.</p>
    <h3 class="heading settled" data-level="4.3" id="script-gadgets"><span class="secno">4.3. </span><span class="content">XSS with Script gadgets</span><a class="self-link" href="#script-gadgets"></a></h3>
    <p><em>This section is not normative.</em></p>
    <p>Script gadgets are a technique in which an attacker uses existing application
code from popular JavaScript libraries to cause their own code to execute.
This is often done by injecting innocent-looking code or seemingly inert
DOM nodes that is only parsed and interpreted by a framework which then
performs the execution of JavaScript based on that input.</p>
    <p>The Sanitizer API can not prevent these attacks, but requires page authors to
explicitly allow unknown elements in general, and authors must additionally
explicitly configure unknown attributes and elements and markup that is known
to be widely used for templating and framework-specific code,
like <code>data-</code> and <code>slot</code> attributes and elements like <code>&lt;slot></code> and <code>&lt;template></code>.
We believe that these restrictions are not exhaustive and encourage page
authors to examine their third party libraries for this behavior.</p>
    <h3 class="heading settled" data-level="4.4" id="mutated-xss"><span class="secno">4.4. </span><span class="content">Mutated XSS</span><a class="self-link" href="#mutated-xss"></a></h3>
    <p><em>This section is not normative.</em></p>
    <p>Mutated XSS or mXSS describes an attack based on parser context mismatches
when parsing an HTML snippet without the correct context. In particular,
when a parsed HTML fragment has been serialized to a string, the string is
not guaranteed to be parsed and interpreted exactly the same when inserted
into a different parent element. An example for carrying out such an attack
is by relying on the change of parsing behavior for foreign content or
misnested tags.</p>
    <p>The Sanitizer API offers help against Mutated XSS, but relies on some amount of
cooperation by the developers. The <code>sanitize()</code> function does not handle strings
and is therefore unaffected. The <code>setHTML</code> function combines sanitization
with DOM modification and can implicitly apply the correct context. The <code>sanitizeFor()</code> function combines parsing and sanitization, and relies on the
developer to supply the correct context for the eventual application of its
result.</p>
    <p>If the data to be sanitized is available as a node tree, we encourage authors
to use the <code>sanitize()</code> function of the API which returns a
DocumentFragment and avoids risks that come with serialization and additional
parsing. Directly operating on a fragment after sanitization also comes with a
performance benefit, as the cost of additional serialization and parsing is
avoided.</p>
    <p>A more complete treatement of mXSS can be found in <a data-link-type="biblio" href="#biblio-mxss" title="mXSS Attacks: Attacking well-secured Web-Applications by using innerHTML Mutations">[MXSS]</a>.</p>
    <h2 class="heading settled" data-level="5" id="ack"><span class="secno">5. </span><span class="content">Acknowledgements</span><a class="self-link" href="#ack"></a></h2>
    <p>Cure53’s <a data-link-type="biblio" href="#biblio-dompurify" title="DOMPurify">[DOMPURIFY]</a> is a clear inspiration for the API this document
describes, as is Internet Explorer’s <code class="idl"><a data-link-type="idl" href="https://msdn.microsoft.com/en-us/library/cc848922(v=vs.85).aspx" id="termref-for-">window.toStaticHTML()</a></code>.</p>
    <h2 class="heading settled" id="constants"><span class="content">Appendix A: Built-in Constants</span><a class="self-link" href="#constants"></a></h2>
    <p><em>This appendix is normative, except where explicitly noted otherwise.</em></p>
    <p>These constants define core behaviour of the Sanitizer algorithm.</p>
    <h3 class="heading settled" id="builtins-justification"><span class="content">Built-ins Justification</span><a class="self-link" href="#builtins-justification"></a></h3>
    <p><em>This subsection is super duper non-normative.</em></p>
    <p class="note" role="note"><span class="marker">Note:</span> The normative values of these constants are found below. The derivation
    of these are explained here, with an implementation in the <a data-link-type="biblio" href="#biblio-defaults" title="Sanitizer API Defaults">[DEFAULTS]</a> script. It is expected that these values will change before this
    specification is finalized. Also, we expect these
    to be updated to include additional HTML elements as they are
    introduced in user agents.</p>
    <p>For the purpose of this Sanitizer API, <a data-link-type="biblio" href="#biblio-html" title="HTML Standard">[HTML]</a> constructs fall into one of
four classes, where the first defines the baseline, and the first, second,
plus the third define the default:</p>
    <ol>
     <li data-md>
      <p>Elements and attributes that (directly) execute script.
 In other words, elements and attributes that are unconditionally script-ish.</p>
     <li data-md>
      <p>Legacy and "difficult" elements and attributes.
Examples are the <code>&lt;plaintext></code> <code>&lt;xmp></code> and elements, which have special
parsing rules attached to them. These are not dangerous _per se_, but they
have contributed to existing vulnerability.</p>
     <li data-md>
      <p>Elements and attributes that we feel rarely make sense in user-supplied
content.</p>
     <li data-md>
      <p>All the rest.</p>
    </ol>
    <p>Specifically:</p>
    <ol>
     <li data-md>
      <p>Script-ish constructs:</p>
      <ul>
       <li data-md>
        <p>The <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/scripting.html#htmlscriptelement" id="ref-for-htmlscriptelement">HTMLScriptElement</a></code>, which proudly executes script as its sole purpose.</p>
       <li data-md>
        <p>All [event handler attributes]((https://html.spec.whatwg.org/#event-handler-attributes),
since these also execute script.</p>
       <li data-md>
        <p><code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/iframe-embed-object.html#htmliframeelement" id="ref-for-htmliframeelement">HTMLIFrameElement</a></code>, which loads arbitrary HTML content and therefor also script.</p>
       <li data-md>
        <p>The legacy <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/iframe-embed-object.html#htmlobjectelement" id="ref-for-htmlobjectelement">HTMLObjectElement</a></code> and <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/iframe-embed-object.html#htmlembedelement" id="ref-for-htmlembedelement">HTMLEmbedElement</a></code>, which load
non-HTML active content. Also, <code>&lt;object></code>'s side-kick <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/obsolete.html#htmlparamelement" id="ref-for-htmlparamelement">HTMLParamElement</a></code>.</p>
       <li data-md>
        <p>The <a href="https://html.spec.whatwg.org/#non-conforming-features">no-longer conforming</a> <code>&lt;frame></code>, <code>&lt;frameset></code>, and <code>&lt;applet></code> tags, which are
outdated versions companions of several elements listed above.</p>
       <li data-md>
        <p>The <code>&lt;noscript></code>, <code>&lt;noframes></code>, <code>&lt;noembed></code>, and <code>&lt;nolayer></code> elements.
These, by themselves, are arguably not script-ish, but they are companions
to elements listed above, and make no sense on their own.</p>
       <li data-md>
        <p>Also, the <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/semantics.html#htmlbaseelement" id="ref-for-htmlbaseelement">HTMLBaseElement</a></code>, as this effectively modifies interpretation
of other URLs.</p>
      </ul>
     <li data-md>
      <p>Legacy and "difficult" elements.</p>
      <ul>
       <li data-md>
        <p>Special parsing behaviour. This is not dangerous in its own right, but has
contributed to mXSS-style attacks. This includes:</p>
        <ul>
         <li data-md>
          <p><code>&lt;plaintext></code> (Which parses in <a data-link-type="dfn">PLAINTEXT state</a>.)</p>
         <li data-md>
          <p><code>&lt;title></code> and <code>&lt;textarea></code> (Which parse in <a data-link-type="dfn">RCDATA state</a>.)</p>
         <li data-md>
          <p>The non-conforming [<code>&lt;xmp></code>](https://html.spec.whatwg.org/#xmp) element.</p>
        </ul>
       <li data-md>
        <p>Legacy elements:</p>
        <ul>
         <li data-md>
          <p><code>&lt;image></code> ([which is parsed as <code>&lt;img></code>](https://html.spec.whatwg.org/#parsing-main-inbody)).</p>
         <li data-md>
          <p><code>&lt;basefont></code></p>
        </ul>
      </ul>
     <li data-md>
      <p>Constructs unlikely to be beneficial in user-supplied content:</p>
      <ul>
       <li data-md>
        <p>The <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/scripting.html#htmltemplateelement" id="ref-for-htmltemplateelement">HTMLTemplateElement</a></code>, which introduces a new template to be used
by JavaScript, and its <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/scripting.html#htmlslotelement" id="ref-for-htmlslotelement">HTMLSlotElement</a></code> accomplice.</p>
       <li data-md>
        <p>The frame-like <a href="https://wicg.github.io/portals/">HTMLPortalElement</a>.</p>
       <li data-md>
        <p><code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/text-level-semantics.html#htmldataelement" id="ref-for-htmldataelement">HTMLDataElement</a></code>,</p>
       <li data-md>
        <p>The (deprecated) <a href="https://www.w3.org/TR/payment-request/">allowpaymentrequest</a> attribute.</p>
      </ul>
    </ol>
    <h3 class="heading settled" id="baseline-elements"><span class="content">The Baseline Element Allow List</span><a class="self-link" href="#baseline-elements"></a></h3>
    <p>The built-in <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="baseline-element-allow-list">baseline element allow list</dfn> has the following value:</p>
    <h3 class="heading settled" id="baseline-attributes"><span class="content">The Baseline Attribute Allow List</span><a class="self-link" href="#baseline-attributes"></a></h3>
    <p>The <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="baseline-attribute-allow-list">baseline attribute allow list</dfn> has the following value:</p>
    <h3 class="heading settled" id="default-configuration-dictionary"><span class="content">The Default Configuration Dictionary</span><a class="self-link" href="#default-configuration-dictionary"></a></h3>
    <p>The built-in <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="default-configuration">default configuration</dfn> has the following value:</p>
   </div>
  </main>
<script src="https://www.w3.org/scripts/TR/2021/fixup.js"></script>
  <h2 class="no-num no-ref heading settled" id="index"><span class="content">Index</span><a class="self-link" href="#index"></a></h2>
  <h3 class="no-num no-ref heading settled" id="index-defined-here"><span class="content">Terms defined by this specification</span><a class="self-link" href="#index-defined-here"></a></h3>
  <ul class="index">
   <li><a href="#dom-sanitizerconfig-allowattributes">allowAttributes</a><span>, in § 2.3</span>
   <li><a href="#dom-sanitizerconfig-allowcomments">allowComments</a><span>, in § 2.3</span>
   <li><a href="#allow-comments-option">allow comments option</a><span>, in § 2.3</span>
   <li><a href="#dom-sanitizerconfig-allowcustomelements">allowCustomElements</a><span>, in § 2.3</span>
   <li><a href="#dom-sanitizerconfig-allowelements">allowElements</a><span>, in § 2.3</span>
   <li><a href="#dom-sanitizerconfig-allowunknownmarkup">allowUnknownMarkup</a><span>, in § 2.3</span>
   <li><a href="#attribute-allow-list">attribute allow list</a><span>, in § 2.3</span>
   <li><a href="#attribute-drop-list">attribute drop list</a><span>, in § 2.3</span>
   <li><a href="#attribute-kind">attribute kind</a><span>, in § 3.4</span>
   <li><a href="#attribute-matches-an-attribute-match-list">attribute matches an attribute match list</a><span>, in § 3.4</span>
   <li><a href="#attribute-match-list">attribute match list</a><span>, in § 2.3.1</span>
   <li><a href="#typedefdef-attributematchlist">AttributeMatchList</a><span>, in § 2.3.1</span>
   <li><a href="#baseline-attribute-allow-list">baseline attribute allow list</a><span>, in § Unnumbered section</span>
   <li><a href="#baseline-element-allow-list">baseline element allow list</a><span>, in § Unnumbered section</span>
   <li><a href="#dom-sanitizerconfig-blockelements">blockElements</a><span>, in § 2.3</span>
   <li><a href="#configuration-dictionary">configuration dictionary</a><span>, in § 2.3</span>
   <li><a href="#dom-sanitizer-sanitizer">constructor()</a><span>, in § 2.1</span>
   <li><a href="#dom-sanitizer-sanitizer">constructor(config)</a><span>, in § 2.1</span>
   <li><a href="#create-a-document-fragment">create a document fragment</a><span>, in § 3.2</span>
   <li><a href="#create-a-sanitizer">create a Sanitizer</a><span>, in § 3.1</span>
   <li><a href="#default-configuration">default configuration</a><span>, in § Unnumbered section</span>
   <li><a href="#dom-sanitizerconfig-dropattributes">dropAttributes</a><span>, in § 2.3</span>
   <li><a href="#dom-sanitizerconfig-dropelements">dropElements</a><span>, in § 2.3</span>
   <li><a href="#element-allow-list">element allow list</a><span>, in § 2.3</span>
   <li><a href="#element-block-list">element block list</a><span>, in § 2.3</span>
   <li><a href="#element-drop-list">element drop list</a><span>, in § 2.3</span>
   <li><a href="#element-kind">element kind</a><span>, in § 3.4</span>
   <li><a href="#element-matches-an-element-name">element matches an element name</a><span>, in § 3.4</span>
   <li><a href="#dom-sanitizer-getconfiguration">getConfiguration()</a><span>, in § 2.1</span>
   <li><a href="#dom-sanitizer-getdefaultconfiguration">getDefaultConfiguration()</a><span>, in § 2.1</span>
   <li><a href="#handle-funky-elements">handle funky elements</a><span>, in § 3.3</span>
   <li><a href="#query-the-sanitizer-config">query the sanitizer config</a><span>, in § 3.1</span>
   <li><a href="#sanitize">sanitize</a><span>, in § 3.1</span>
   <li><a href="#sanitize-action">sanitize action</a><span>, in § 3.4</span>
   <li><a href="#sanitize-action-for-an-attribute">sanitize action for an attribute</a><span>, in § 3.4</span>
   <li><a href="#sanitize-action-for-an-element">sanitize action for an element</a><span>, in § 3.4</span>
   <li><a href="#sanitize-a-document-fragment">sanitize a document fragment</a><span>, in § 3.3</span>
   <li><a href="#sanitizeandset">sanitizeAndSet</a><span>, in § 3.1</span>
   <li><a href="#sanitize-a-node">sanitize a node</a><span>, in § 3.3</span>
   <li><a href="#sanitizefor">sanitizeFor</a><span>, in § 3.1</span>
   <li><a href="#dom-sanitizer-sanitizefor">sanitizeFor(element, input)</a><span>, in § 2.1</span>
   <li><a href="#dom-sanitizer-sanitize">sanitize(input)</a><span>, in § 2.1</span>
   <li><a href="#sanitizer">Sanitizer</a><span>, in § 2.1</span>
   <li><a href="#dom-sethtmloptions-sanitizer">sanitizer</a><span>, in § 2.1</span>
   <li><a href="#dom-sanitizer-sanitizer">Sanitizer()</a><span>, in § 2.1</span>
   <li><a href="#dom-sanitizer-sanitizer">Sanitizer(config)</a><span>, in § 2.1</span>
   <li><a href="#dictdef-sanitizerconfig">SanitizerConfig</a><span>, in § 2.3</span>
   <li><a href="#dom-element-sethtml">setHTML(input)</a><span>, in § 2.1</span>
   <li><a href="#dom-element-sethtml">setHTML(input, options)</a><span>, in § 2.1</span>
   <li><a href="#dictdef-sethtmloptions">SetHTMLOptions</a><span>, in § 2.1</span>
  </ul>
  <aside class="dfn-panel" data-for="term-for-widl-Element-innerHTML">
   <a href="https://dom.spec.whatwg.org/#widl-Element-innerHTML">https://dom.spec.whatwg.org/#widl-Element-innerHTML</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-widl-Element-innerHTML">1. Introduction</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-template-contents">
   <a href="https://html.spec.whatwg.org/#template-contents">https://html.spec.whatwg.org/#template-contents</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-template-contents">3.3. Sanitization Algorithms</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-">
   <a href="https://msdn.microsoft.com/en-us/library/cc848922(v=vs.85).aspx">https://msdn.microsoft.com/en-us/library/cc848922(v=vs.85).aspx</a><b>Referenced in:</b>
   <ul>
    <li><a href="#termref-for-">5. Acknowledgements</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-attr">
   <a href="https://dom.spec.whatwg.org/#attr">https://dom.spec.whatwg.org/#attr</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-attr">3.3. Sanitization Algorithms</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-comment">
   <a href="https://dom.spec.whatwg.org/#comment">https://dom.spec.whatwg.org/#comment</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-comment">3.3. Sanitization Algorithms</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-document">
   <a href="https://dom.spec.whatwg.org/#document">https://dom.spec.whatwg.org/#document</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-document">1.3.1. Case 1: Sanitizing With Nodes, Only.</a>
    <li><a href="#ref-for-document①">2.1. Sanitizer API</a>
    <li><a href="#ref-for-document②">3.2. Helper Definitions</a>
    <li><a href="#ref-for-document③">3.3. Sanitization Algorithms</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-documentfragment">
   <a href="https://dom.spec.whatwg.org/#documentfragment">https://dom.spec.whatwg.org/#documentfragment</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-documentfragment">2.1. Sanitizer API</a> <a href="#ref-for-documentfragment①">(2)</a>
    <li><a href="#ref-for-documentfragment②">3.2. Helper Definitions</a> <a href="#ref-for-documentfragment③">(2)</a>
    <li><a href="#ref-for-documentfragment④">3.3. Sanitization Algorithms</a> <a href="#ref-for-documentfragment⑤">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-documenttype">
   <a href="https://dom.spec.whatwg.org/#documenttype">https://dom.spec.whatwg.org/#documenttype</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-documenttype">3.3. Sanitization Algorithms</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-element">
   <a href="https://dom.spec.whatwg.org/#element">https://dom.spec.whatwg.org/#element</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-element">1. Introduction</a>
    <li><a href="#ref-for-element①">2.1. Sanitizer API</a> <a href="#ref-for-element②">(2)</a> <a href="#ref-for-element③">(3)</a>
    <li><a href="#ref-for-element④">2.2. String Handling</a> <a href="#ref-for-element⑤">(2)</a> <a href="#ref-for-element⑥">(3)</a>
    <li><a href="#ref-for-element⑦">3.1. API Implementation</a>
    <li><a href="#ref-for-element⑧">3.4. Matching Against The Configuration</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-processinginstruction">
   <a href="https://dom.spec.whatwg.org/#processinginstruction">https://dom.spec.whatwg.org/#processinginstruction</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-processinginstruction">3.3. Sanitization Algorithms</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-text">
   <a href="https://dom.spec.whatwg.org/#text">https://dom.spec.whatwg.org/#text</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-text">3.3. Sanitization Algorithms</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-node-append">
   <a href="https://dom.spec.whatwg.org/#concept-node-append">https://dom.spec.whatwg.org/#concept-node-append</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-node-append">3.2. Helper Definitions</a>
    <li><a href="#ref-for-concept-node-append①">3.3. Sanitization Algorithms</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-element-attribute">
   <a href="https://dom.spec.whatwg.org/#concept-element-attribute">https://dom.spec.whatwg.org/#concept-element-attribute</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-element-attribute">3.3. Sanitization Algorithms</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-tree-child">
   <a href="https://dom.spec.whatwg.org/#concept-tree-child">https://dom.spec.whatwg.org/#concept-tree-child</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-tree-child">3.3. Sanitization Algorithms</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-node-clone">
   <a href="https://dom.spec.whatwg.org/#concept-node-clone">https://dom.spec.whatwg.org/#concept-node-clone</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-node-clone">3.2. Helper Definitions</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-create-element">
   <a href="https://dom.spec.whatwg.org/#concept-create-element">https://dom.spec.whatwg.org/#concept-create-element</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-create-element">3.1. API Implementation</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-element-interface">
   <a href="https://dom.spec.whatwg.org/#concept-element-interface">https://dom.spec.whatwg.org/#concept-element-interface</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-element-interface">3.4. Matching Against The Configuration</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-tree-inclusive-descendant">
   <a href="https://dom.spec.whatwg.org/#concept-tree-inclusive-descendant">https://dom.spec.whatwg.org/#concept-tree-inclusive-descendant</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-tree-inclusive-descendant">3.3. Sanitization Algorithms</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-attribute-local-name">
   <a href="https://dom.spec.whatwg.org/#concept-attribute-local-name">https://dom.spec.whatwg.org/#concept-attribute-local-name</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-attribute-local-name">2.3.1. Attribute Match Lists</a>
    <li><a href="#ref-for-concept-attribute-local-name①">3.4. Matching Against The Configuration</a> <a href="#ref-for-concept-attribute-local-name②">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-element-local-name">
   <a href="https://dom.spec.whatwg.org/#concept-element-local-name">https://dom.spec.whatwg.org/#concept-element-local-name</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-element-local-name">2.3.1. Attribute Match Lists</a>
    <li><a href="#ref-for-concept-element-local-name①">3.1. API Implementation</a>
    <li><a href="#ref-for-concept-element-local-name②">3.3. Sanitization Algorithms</a> <a href="#ref-for-concept-element-local-name③">(2)</a> <a href="#ref-for-concept-element-local-name④">(3)</a> <a href="#ref-for-concept-element-local-name⑤">(4)</a>
    <li><a href="#ref-for-concept-element-local-name⑥">3.4. Matching Against The Configuration</a> <a href="#ref-for-concept-element-local-name⑦">(2)</a> <a href="#ref-for-concept-element-local-name⑧">(3)</a> <a href="#ref-for-concept-element-local-name⑨">(4)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-attribute-namespace">
   <a href="https://dom.spec.whatwg.org/#concept-attribute-namespace">https://dom.spec.whatwg.org/#concept-attribute-namespace</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-attribute-namespace">3.4. Matching Against The Configuration</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-element-namespace">
   <a href="https://dom.spec.whatwg.org/#concept-element-namespace">https://dom.spec.whatwg.org/#concept-element-namespace</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-element-namespace">3.3. Sanitization Algorithms</a> <a href="#ref-for-concept-element-namespace①">(2)</a> <a href="#ref-for-concept-element-namespace②">(3)</a> <a href="#ref-for-concept-element-namespace③">(4)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-boundary-point-node">
   <a href="https://dom.spec.whatwg.org/#boundary-point-node">https://dom.spec.whatwg.org/#boundary-point-node</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-boundary-point-node">3.3. Sanitization Algorithms</a> <a href="#ref-for-boundary-point-node①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-node-document">
   <a href="https://dom.spec.whatwg.org/#concept-node-document">https://dom.spec.whatwg.org/#concept-node-document</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-node-document">3.2. Helper Definitions</a> <a href="#ref-for-concept-node-document①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-tree-parent">
   <a href="https://dom.spec.whatwg.org/#concept-tree-parent">https://dom.spec.whatwg.org/#concept-tree-parent</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-tree-parent">3.3. Sanitization Algorithms</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-node-remove">
   <a href="https://dom.spec.whatwg.org/#concept-node-remove">https://dom.spec.whatwg.org/#concept-node-remove</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-node-remove">3.3. Sanitization Algorithms</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-element-attributes-remove">
   <a href="https://dom.spec.whatwg.org/#concept-element-attributes-remove">https://dom.spec.whatwg.org/#concept-element-attributes-remove</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-element-attributes-remove">3.3. Sanitization Algorithms</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-node-replace">
   <a href="https://dom.spec.whatwg.org/#concept-node-replace">https://dom.spec.whatwg.org/#concept-node-replace</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-node-replace">3.3. Sanitization Algorithms</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-node-replace-all">
   <a href="https://dom.spec.whatwg.org/#concept-node-replace-all">https://dom.spec.whatwg.org/#concept-node-replace-all</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-node-replace-all">3.1. API Implementation</a> <a href="#ref-for-concept-node-replace-all①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-tree-order">
   <a href="https://dom.spec.whatwg.org/#concept-tree-order">https://dom.spec.whatwg.org/#concept-tree-order</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-tree-order">3.3. Sanitization Algorithms</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-htmlbaseelement">
   <a href="https://html.spec.whatwg.org/multipage/semantics.html#htmlbaseelement">https://html.spec.whatwg.org/multipage/semantics.html#htmlbaseelement</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-htmlbaseelement">Built-ins Justification</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-htmldataelement">
   <a href="https://html.spec.whatwg.org/multipage/text-level-semantics.html#htmldataelement">https://html.spec.whatwg.org/multipage/text-level-semantics.html#htmldataelement</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-htmldataelement">Built-ins Justification</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-htmlembedelement">
   <a href="https://html.spec.whatwg.org/multipage/iframe-embed-object.html#htmlembedelement">https://html.spec.whatwg.org/multipage/iframe-embed-object.html#htmlembedelement</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-htmlembedelement">Built-ins Justification</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-htmliframeelement">
   <a href="https://html.spec.whatwg.org/multipage/iframe-embed-object.html#htmliframeelement">https://html.spec.whatwg.org/multipage/iframe-embed-object.html#htmliframeelement</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-htmliframeelement">Built-ins Justification</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-htmlobjectelement">
   <a href="https://html.spec.whatwg.org/multipage/iframe-embed-object.html#htmlobjectelement">https://html.spec.whatwg.org/multipage/iframe-embed-object.html#htmlobjectelement</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-htmlobjectelement">Built-ins Justification</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-htmlparamelement">
   <a href="https://html.spec.whatwg.org/multipage/obsolete.html#htmlparamelement">https://html.spec.whatwg.org/multipage/obsolete.html#htmlparamelement</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-htmlparamelement">Built-ins Justification</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-htmlscriptelement">
   <a href="https://html.spec.whatwg.org/multipage/scripting.html#htmlscriptelement">https://html.spec.whatwg.org/multipage/scripting.html#htmlscriptelement</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-htmlscriptelement">Built-ins Justification</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-htmlslotelement">
   <a href="https://html.spec.whatwg.org/multipage/scripting.html#htmlslotelement">https://html.spec.whatwg.org/multipage/scripting.html#htmlslotelement</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-htmlslotelement">Built-ins Justification</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-htmltemplateelement">
   <a href="https://html.spec.whatwg.org/multipage/scripting.html#htmltemplateelement">https://html.spec.whatwg.org/multipage/scripting.html#htmltemplateelement</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-htmltemplateelement">Built-ins Justification</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-htmlunknownelement">
   <a href="https://html.spec.whatwg.org/multipage/dom.html#htmlunknownelement">https://html.spec.whatwg.org/multipage/dom.html#htmlunknownelement</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-htmlunknownelement">3.4. Matching Against The Configuration</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-custom-element">
   <a href="https://html.spec.whatwg.org/multipage/custom-elements.html#custom-element">https://html.spec.whatwg.org/multipage/custom-elements.html#custom-element</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-custom-element">2.3. The Configuration Dictionary</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-html-parser">
   <a href="https://html.spec.whatwg.org/multipage/parsing.html#html-parser">https://html.spec.whatwg.org/multipage/parsing.html#html-parser</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-html-parser">2.2. String Handling</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-valid-custom-element-name">
   <a href="https://html.spec.whatwg.org/multipage/custom-elements.html#valid-custom-element-name">https://html.spec.whatwg.org/multipage/custom-elements.html#valid-custom-element-name</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-valid-custom-element-name">3.4. Matching Against The Configuration</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-assert">
   <a href="https://infra.spec.whatwg.org/#assert">https://infra.spec.whatwg.org/#assert</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-assert">3.3. Sanitization Algorithms</a> <a href="#ref-for-assert①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-map-exists">
   <a href="https://infra.spec.whatwg.org/#map-exists">https://infra.spec.whatwg.org/#map-exists</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-map-exists">3.1. API Implementation</a>
    <li><a href="#ref-for-map-exists①">3.3. Sanitization Algorithms</a>
    <li><a href="#ref-for-map-exists②">3.4. Matching Against The Configuration</a> <a href="#ref-for-map-exists③">(2)</a> <a href="#ref-for-map-exists④">(3)</a> <a href="#ref-for-map-exists⑤">(4)</a> <a href="#ref-for-map-exists⑥">(5)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-map-get">
   <a href="https://infra.spec.whatwg.org/#map-get">https://infra.spec.whatwg.org/#map-get</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-map-get">3.1. API Implementation</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-html-namespace">
   <a href="https://infra.spec.whatwg.org/#html-namespace">https://infra.spec.whatwg.org/#html-namespace</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-html-namespace">3.1. API Implementation</a>
    <li><a href="#ref-for-html-namespace①">3.3. Sanitization Algorithms</a> <a href="#ref-for-html-namespace②">(2)</a> <a href="#ref-for-html-namespace③">(3)</a> <a href="#ref-for-html-namespace④">(4)</a>
    <li><a href="#ref-for-html-namespace⑤">3.4. Matching Against The Configuration</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-string-is">
   <a href="https://infra.spec.whatwg.org/#string-is">https://infra.spec.whatwg.org/#string-is</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-string-is">3.3. Sanitization Algorithms</a> <a href="#ref-for-string-is①">(2)</a> <a href="#ref-for-string-is②">(3)</a> <a href="#ref-for-string-is③">(4)</a> <a href="#ref-for-string-is④">(5)</a> <a href="#ref-for-string-is⑤">(6)</a> <a href="#ref-for-string-is⑥">(7)</a> <a href="#ref-for-string-is⑦">(8)</a>
    <li><a href="#ref-for-string-is⑧">3.4. Matching Against The Configuration</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-string-is">
   <a href="https://infra.spec.whatwg.org/#string-is">https://infra.spec.whatwg.org/#string-is</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-string-is">3.3. Sanitization Algorithms</a> <a href="#ref-for-string-is①">(2)</a> <a href="#ref-for-string-is②">(3)</a> <a href="#ref-for-string-is③">(4)</a> <a href="#ref-for-string-is④">(5)</a> <a href="#ref-for-string-is⑤">(6)</a> <a href="#ref-for-string-is⑥">(7)</a> <a href="#ref-for-string-is⑦">(8)</a>
    <li><a href="#ref-for-string-is⑧">3.4. Matching Against The Configuration</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-list-iterate">
   <a href="https://infra.spec.whatwg.org/#list-iterate">https://infra.spec.whatwg.org/#list-iterate</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-list-iterate">3.3. Sanitization Algorithms</a> <a href="#ref-for-list-iterate①">(2)</a> <a href="#ref-for-list-iterate②">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-map-set">
   <a href="https://infra.spec.whatwg.org/#map-set">https://infra.spec.whatwg.org/#map-set</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-map-set">3.3. Sanitization Algorithms</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dfn-node">
   <a href="https://www.w3.org/TR/rdf11-mt/#dfn-node">https://www.w3.org/TR/rdf11-mt/#dfn-node</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dfn-node">3.3. Sanitization Algorithms</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-idl-DOMString">
   <a href="https://webidl.spec.whatwg.org/#idl-DOMString">https://webidl.spec.whatwg.org/#idl-DOMString</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-idl-DOMString">2.1. Sanitizer API</a> <a href="#ref-for-idl-DOMString①">(2)</a> <a href="#ref-for-idl-DOMString②">(3)</a>
    <li><a href="#ref-for-idl-DOMString③">2.3. The Configuration Dictionary</a> <a href="#ref-for-idl-DOMString④">(2)</a> <a href="#ref-for-idl-DOMString⑤">(3)</a>
    <li><a href="#ref-for-idl-DOMString⑥">2.3.1. Attribute Match Lists</a> <a href="#ref-for-idl-DOMString⑦">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-Exposed">
   <a href="https://webidl.spec.whatwg.org/#Exposed">https://webidl.spec.whatwg.org/#Exposed</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-Exposed">2.1. Sanitizer API</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-SecureContext">
   <a href="https://webidl.spec.whatwg.org/#SecureContext">https://webidl.spec.whatwg.org/#SecureContext</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-SecureContext">2.1. Sanitizer API</a> <a href="#ref-for-SecureContext①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-exceptiondef-typeerror">
   <a href="https://webidl.spec.whatwg.org/#exceptiondef-typeerror">https://webidl.spec.whatwg.org/#exceptiondef-typeerror</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-exceptiondef-typeerror">3.1. API Implementation</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-idl-boolean">
   <a href="https://webidl.spec.whatwg.org/#idl-boolean">https://webidl.spec.whatwg.org/#idl-boolean</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-idl-boolean">2.3. The Configuration Dictionary</a> <a href="#ref-for-idl-boolean①">(2)</a> <a href="#ref-for-idl-boolean②">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-idl-record">
   <a href="https://webidl.spec.whatwg.org/#idl-record">https://webidl.spec.whatwg.org/#idl-record</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-idl-record">2.3.1. Attribute Match Lists</a>
    <li><a href="#termref-for-idl-record">3.4. Matching Against The Configuration</a> <a href="#termref-for-idl-record">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-idl-sequence">
   <a href="https://webidl.spec.whatwg.org/#idl-sequence">https://webidl.spec.whatwg.org/#idl-sequence</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-idl-sequence">2.3. The Configuration Dictionary</a> <a href="#ref-for-idl-sequence①">(2)</a> <a href="#ref-for-idl-sequence②">(3)</a>
    <li><a href="#ref-for-idl-sequence③">2.3.1. Attribute Match Lists</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-this">
   <a href="https://webidl.spec.whatwg.org/#this">https://webidl.spec.whatwg.org/#this</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-this">2.1. Sanitizer API</a> <a href="#ref-for-this①">(2)</a>
    <li><a href="#ref-for-this②">3.1. API Implementation</a> <a href="#ref-for-this③">(2)</a> <a href="#ref-for-this④">(3)</a> <a href="#ref-for-this⑤">(4)</a> <a href="#ref-for-this⑥">(5)</a> <a href="#ref-for-this⑦">(6)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-idl-undefined">
   <a href="https://webidl.spec.whatwg.org/#idl-undefined">https://webidl.spec.whatwg.org/#idl-undefined</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-idl-undefined">2.1. Sanitizer API</a>
   </ul>
  </aside>
  <h3 class="no-num no-ref heading settled" id="index-defined-elsewhere"><span class="content">Terms defined by reference</span><a class="self-link" href="#index-defined-elsewhere"></a></h3>
  <ul class="index">
   <li>
    <a data-link-type="biblio">[]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-widl-Element-innerHTML">innerHTML</span>
     <li><span class="dfn-paneled" id="term-for-template-contents">template contents</span>
     <li><span class="dfn-paneled" id="term-for-">window.toStaticHTML()</span>
    </ul>
   <li>
    <a data-link-type="biblio">[DOM]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-attr">Attr</span>
     <li><span class="dfn-paneled" id="term-for-comment">Comment</span>
     <li><span class="dfn-paneled" id="term-for-document">Document</span>
     <li><span class="dfn-paneled" id="term-for-documentfragment">DocumentFragment</span>
     <li><span class="dfn-paneled" id="term-for-documenttype">DocumentType</span>
     <li><span class="dfn-paneled" id="term-for-element">Element</span>
     <li><span class="dfn-paneled" id="term-for-processinginstruction">ProcessingInstruction</span>
     <li><span class="dfn-paneled" id="term-for-text">Text</span>
     <li><span class="dfn-paneled" id="term-for-concept-node-append">append</span>
     <li><span class="dfn-paneled" id="term-for-concept-element-attribute">attribute list</span>
     <li><span class="dfn-paneled" id="term-for-concept-tree-child">children</span>
     <li><span class="dfn-paneled" id="term-for-concept-node-clone">clone a node</span>
     <li><span class="dfn-paneled" id="term-for-concept-create-element">creating an element</span>
     <li><span class="dfn-paneled" id="term-for-concept-element-interface">element interface</span>
     <li><span class="dfn-paneled" id="term-for-concept-tree-inclusive-descendant">inclusive descendant</span>
     <li><span class="dfn-paneled" id="term-for-concept-attribute-local-name">local name <small>(for Attr)</small></span>
     <li><span class="dfn-paneled" id="term-for-concept-element-local-name">local name <small>(for Element)</small></span>
     <li><span class="dfn-paneled" id="term-for-concept-attribute-namespace">namespace <small>(for Attr)</small></span>
     <li><span class="dfn-paneled" id="term-for-concept-element-namespace">namespace <small>(for Element)</small></span>
     <li><span class="dfn-paneled" id="term-for-boundary-point-node">node</span>
     <li><span class="dfn-paneled" id="term-for-concept-node-document">node document</span>
     <li><span class="dfn-paneled" id="term-for-concept-tree-parent">parent</span>
     <li><span class="dfn-paneled" id="term-for-concept-node-remove">remove</span>
     <li><span class="dfn-paneled" id="term-for-concept-element-attributes-remove">remove an attribute</span>
     <li><span class="dfn-paneled" id="term-for-concept-node-replace">replace</span>
     <li><span class="dfn-paneled" id="term-for-concept-node-replace-all">replace all</span>
     <li><span class="dfn-paneled" id="term-for-concept-tree-order">tree order</span>
    </ul>
   <li>
    <a data-link-type="biblio">[HTML]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-htmlbaseelement">HTMLBaseElement</span>
     <li><span class="dfn-paneled" id="term-for-htmldataelement">HTMLDataElement</span>
     <li><span class="dfn-paneled" id="term-for-htmlembedelement">HTMLEmbedElement</span>
     <li><span class="dfn-paneled" id="term-for-htmliframeelement">HTMLIFrameElement</span>
     <li><span class="dfn-paneled" id="term-for-htmlobjectelement">HTMLObjectElement</span>
     <li><span class="dfn-paneled" id="term-for-htmlparamelement">HTMLParamElement</span>
     <li><span class="dfn-paneled" id="term-for-htmlscriptelement">HTMLScriptElement</span>
     <li><span class="dfn-paneled" id="term-for-htmlslotelement">HTMLSlotElement</span>
     <li><span class="dfn-paneled" id="term-for-htmltemplateelement">HTMLTemplateElement</span>
     <li><span class="dfn-paneled" id="term-for-htmlunknownelement">HTMLUnknownElement</span>
     <li><span class="dfn-paneled" id="term-for-custom-element">custom element</span>
     <li><span class="dfn-paneled" id="term-for-html-parser">html parser</span>
     <li><span class="dfn-paneled" id="term-for-valid-custom-element-name">valid custom element name</span>
    </ul>
   <li>
    <a data-link-type="biblio">[INFRA]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-assert">assert</span>
     <li><span class="dfn-paneled" id="term-for-map-exists">exist</span>
     <li><span class="dfn-paneled" id="term-for-map-get">get</span>
     <li><span class="dfn-paneled" id="term-for-html-namespace">html namespace</span>
     <li><span class="dfn-paneled" id="term-for-string-is">identical to</span>
     <li><span class="dfn-paneled" id="term-for-string-is①">is</span>
     <li><span class="dfn-paneled" id="term-for-list-iterate">iterate</span>
     <li><span class="dfn-paneled" id="term-for-map-set">set</span>
    </ul>
   <li>
    <a data-link-type="biblio">[RDF11-MT]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-dfn-node">node</span>
    </ul>
   <li>
    <a data-link-type="biblio">[WEBIDL]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-idl-DOMString">DOMString</span>
     <li><span class="dfn-paneled" id="term-for-Exposed">Exposed</span>
     <li><span class="dfn-paneled" id="term-for-SecureContext">SecureContext</span>
     <li><span class="dfn-paneled" id="term-for-exceptiondef-typeerror">TypeError</span>
     <li><span class="dfn-paneled" id="term-for-idl-boolean">boolean</span>
     <li><span class="dfn-paneled" id="term-for-idl-record">record</span>
     <li><span class="dfn-paneled" id="term-for-idl-sequence">sequence</span>
     <li><span class="dfn-paneled" id="term-for-this">this</span>
     <li><span class="dfn-paneled" id="term-for-idl-undefined">undefined</span>
    </ul>
  </ul>
  <h2 class="no-num no-ref heading settled" id="references"><span class="content">References</span><a class="self-link" href="#references"></a></h2>
  <h3 class="no-num no-ref heading settled" id="normative"><span class="content">Normative References</span><a class="self-link" href="#normative"></a></h3>
  <dl>
   <dt id="biblio-dom">[DOM]
   <dd>Anne van Kesteren. <a href="https://dom.spec.whatwg.org/"><cite>DOM Standard</cite></a>. Living Standard. URL: <a href="https://dom.spec.whatwg.org/">https://dom.spec.whatwg.org/</a>
   <dt id="biblio-html">[HTML]
   <dd>Anne van Kesteren; et al. <a href="https://html.spec.whatwg.org/multipage/"><cite>HTML Standard</cite></a>. Living Standard. URL: <a href="https://html.spec.whatwg.org/multipage/">https://html.spec.whatwg.org/multipage/</a>
   <dt id="biblio-infra">[INFRA]
   <dd>Anne van Kesteren; Domenic Denicola. <a href="https://infra.spec.whatwg.org/"><cite>Infra Standard</cite></a>. Living Standard. URL: <a href="https://infra.spec.whatwg.org/">https://infra.spec.whatwg.org/</a>
   <dt id="biblio-rdf11-mt">[RDF11-MT]
   <dd>Patrick Hayes; Peter Patel-Schneider. <a href="https://www.w3.org/TR/rdf11-mt/"><cite>RDF 1.1 Semantics</cite></a>. 25 February 2014. REC. URL: <a href="https://www.w3.org/TR/rdf11-mt/">https://www.w3.org/TR/rdf11-mt/</a>
   <dt id="biblio-webidl">[WEBIDL]
   <dd>Edgar Chen; Timothy Gu. <a href="https://webidl.spec.whatwg.org/"><cite>Web IDL Standard</cite></a>. Living Standard. URL: <a href="https://webidl.spec.whatwg.org/">https://webidl.spec.whatwg.org/</a>
  </dl>
  <h3 class="no-num no-ref heading settled" id="informative"><span class="content">Informative References</span><a class="self-link" href="#informative"></a></h3>
  <dl>
   <dt id="biblio-defaults">[DEFAULTS]
   <dd><a href="https://github.com/WICG/sanitizer-api/blob/main/resources/defaults-derivation.html"><cite>Sanitizer API Defaults</cite></a>. URL: <a href="https://github.com/WICG/sanitizer-api/blob/main/resources/defaults-derivation.html">https://github.com/WICG/sanitizer-api/blob/main/resources/defaults-derivation.html</a>
   <dt id="biblio-dompurify">[DOMPURIFY]
   <dd><a href="https://github.com/cure53/DOMPurify"><cite>DOMPurify</cite></a>. URL: <a href="https://github.com/cure53/DOMPurify">https://github.com/cure53/DOMPurify</a>
   <dt id="biblio-mxss">[MXSS]
   <dd><a href="https://cure53.de/fp170.pdf"><cite>mXSS Attacks: Attacking well-secured Web-Applications by using innerHTML Mutations</cite></a>. URL: <a href="https://cure53.de/fp170.pdf">https://cure53.de/fp170.pdf</a>
   <dt id="biblio-mxss1">[MXSS1]
   <dd><a href="https://research.securitum.com/mutation-xss-via-mathml-mutation-dompurify-2-0-17-bypass/"><cite>Mutation XSS via namespace confusion</cite></a>. URL: <a href="https://research.securitum.com/mutation-xss-via-mathml-mutation-dompurify-2-0-17-bypass/">https://research.securitum.com/mutation-xss-via-mathml-mutation-dompurify-2-0-17-bypass/</a>
   <dt id="biblio-mxss2">[MXSS2]
   <dd><a href="https://www.checkmarx.com/blog/technical-blog/vulnerabilities-discovered-in-mozilla-bleach/"><cite>CVE-2020-6802 Write-up</cite></a>. URL: <a href="https://www.checkmarx.com/blog/technical-blog/vulnerabilities-discovered-in-mozilla-bleach/">https://www.checkmarx.com/blog/technical-blog/vulnerabilities-discovered-in-mozilla-bleach/</a>
   <dt id="biblio-url">[URL]
   <dd>Anne van Kesteren. <a href="https://url.spec.whatwg.org/"><cite>URL Standard</cite></a>. Living Standard. URL: <a href="https://url.spec.whatwg.org/">https://url.spec.whatwg.org/</a>
  </dl>
  <h2 class="no-num no-ref heading settled" id="idl-index"><span class="content">IDL Index</span><a class="self-link" href="#idl-index"></a></h2>
<pre class="idl highlight def">[
  <a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed"><c- g>Exposed</c-></a>=(<c- n>Window</c->),
  <a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#SecureContext"><c- g>SecureContext</c-></a>
] <c- b>interface</c-> <a href="#sanitizer"><code><c- g>Sanitizer</c-></code></a> {
  <a class="idl-code" data-link-type="constructor" href="#dom-sanitizer-sanitizer"><c- g>constructor</c-></a>(<c- b>optional</c-> <a data-link-type="idl-name" href="#dictdef-sanitizerconfig"><c- n>SanitizerConfig</c-></a> <a href="#dom-sanitizer-sanitizer-config-config"><code><c- g>config</c-></code></a> = {});

  <a data-link-type="idl-name" href="https://dom.spec.whatwg.org/#documentfragment"><c- n>DocumentFragment</c-></a> <a class="idl-code" data-link-type="method" href="#dom-sanitizer-sanitize"><c- g>sanitize</c-></a>((<a data-link-type="idl-name" href="https://dom.spec.whatwg.org/#document"><c- n>Document</c-></a> <c- b>or</c-> <a data-link-type="idl-name" href="https://dom.spec.whatwg.org/#documentfragment"><c- n>DocumentFragment</c-></a>) <a href="#dom-sanitizer-sanitize-input-input"><code><c- g>input</c-></code></a>);
  <a data-link-type="idl-name" href="https://dom.spec.whatwg.org/#element"><c- n>Element</c-></a>? <a class="idl-code" data-link-type="method" href="#dom-sanitizer-sanitizefor"><c- g>sanitizeFor</c-></a>(<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString"><c- b>DOMString</c-></a> <a href="#dom-sanitizer-sanitizefor-element-input-element"><code><c- g>element</c-></code></a>, <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString"><c- b>DOMString</c-></a> <a href="#dom-sanitizer-sanitizefor-element-input-input"><code><c- g>input</c-></code></a>);

  <a data-link-type="idl-name" href="#dictdef-sanitizerconfig"><c- n>SanitizerConfig</c-></a> <a class="idl-code" data-link-type="method" href="#dom-sanitizer-getconfiguration"><c- g>getConfiguration</c-></a>();
  <c- b>static</c-> <a data-link-type="idl-name" href="#dictdef-sanitizerconfig"><c- n>SanitizerConfig</c-></a> <a class="idl-code" data-link-type="method" href="#dom-sanitizer-getdefaultconfiguration"><c- g>getDefaultConfiguration</c-></a>();
};

<c- b>dictionary</c-> <a href="#dictdef-sethtmloptions"><code><c- g>SetHTMLOptions</c-></code></a> {
  <a data-link-type="idl-name" href="#sanitizer"><c- n>Sanitizer</c-></a> <a data-type="Sanitizer " href="#dom-sethtmloptions-sanitizer"><code><c- g>sanitizer</c-></code></a>;
};
[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#SecureContext"><c- g>SecureContext</c-></a>]
<c- b>partial</c-> <c- b>interface</c-> <a class="idl-code" data-link-type="interface" href="https://dom.spec.whatwg.org/#element"><c- g>Element</c-></a> {
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-undefined"><c- b>undefined</c-></a> <a class="idl-code" data-link-type="method" href="#dom-element-sethtml"><c- g>setHTML</c-></a>(<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString"><c- b>DOMString</c-></a> <a href="#dom-element-sethtml-input-options-input"><code><c- g>input</c-></code></a>, <c- b>optional</c-> <a data-link-type="idl-name" href="#dictdef-sethtmloptions"><c- n>SetHTMLOptions</c-></a> <a href="#dom-element-sethtml-input-options-options"><code><c- g>options</c-></code></a> = {});
};

<c- b>dictionary</c-> <a href="#dictdef-sanitizerconfig"><code><c- g>SanitizerConfig</c-></code></a> {
  <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#idl-sequence"><c- b>sequence</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString"><c- b>DOMString</c-></a>> <a data-type="sequence<DOMString> " href="#dom-sanitizerconfig-allowelements"><code><c- g>allowElements</c-></code></a>;
  <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#idl-sequence"><c- b>sequence</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString"><c- b>DOMString</c-></a>> <a data-type="sequence<DOMString> " href="#dom-sanitizerconfig-blockelements"><code><c- g>blockElements</c-></code></a>;
  <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#idl-sequence"><c- b>sequence</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString"><c- b>DOMString</c-></a>> <a data-type="sequence<DOMString> " href="#dom-sanitizerconfig-dropelements"><code><c- g>dropElements</c-></code></a>;
  <a data-link-type="idl-name" href="#typedefdef-attributematchlist"><c- n>AttributeMatchList</c-></a> <a data-type="AttributeMatchList " href="#dom-sanitizerconfig-allowattributes"><code><c- g>allowAttributes</c-></code></a>;
  <a data-link-type="idl-name" href="#typedefdef-attributematchlist"><c- n>AttributeMatchList</c-></a> <a data-type="AttributeMatchList " href="#dom-sanitizerconfig-dropattributes"><code><c- g>dropAttributes</c-></code></a>;
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-boolean"><c- b>boolean</c-></a> <a data-type="boolean " href="#dom-sanitizerconfig-allowcustomelements"><code><c- g>allowCustomElements</c-></code></a>;
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-boolean"><c- b>boolean</c-></a> <a data-type="boolean " href="#dom-sanitizerconfig-allowunknownmarkup"><code><c- g>allowUnknownMarkup</c-></code></a>;
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-boolean"><c- b>boolean</c-></a> <a data-type="boolean " href="#dom-sanitizerconfig-allowcomments"><code><c- g>allowComments</c-></code></a>;
};

<c- b>typedef</c-> <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#idl-record"><c- b>record</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString"><c- b>DOMString</c-></a>, <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#idl-sequence"><c- b>sequence</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString"><c- b>DOMString</c-></a>>> <a href="#typedefdef-attributematchlist"><code><c- g>AttributeMatchList</c-></code></a>;

</pre>
  <h2 class="no-num no-ref heading settled" id="issues-index"><span class="content">Issues Index</span><a class="self-link" href="#issues-index"></a></h2>
  <div style="counter-reset:issue">
   <div class="issue"> Is this how we specify a method on existing class "owned" by a different spe? <a class="issue-return" href="#issue-a1fbc017" title="Jump to section">↵</a></div>
   <div class="issue"> This should explicitly state the config’s properties in which element names are found and modify the config wih map operations. <a href="https://github.com/WICG/sanitizer-api/issues/148">[Issue #148]</a> <a class="issue-return" href="#issue-6f447953" title="Jump to section">↵</a></div>
   <div class="issue"> The sanitize algorithm does not need to run "create a document fragment". <a href="https://github.com/WICG/sanitizer-api/issues/149">[Issue #149]</a> <a class="issue-return" href="#issue-7d8b222c" title="Jump to section">↵</a></div>
   <div class="issue"> Does the <code>.sanitizeFor</code> element name require namespace-related processing? <a href="https://github.com/WICG/sanitizer-api/issues/140">[Issue #140]</a> <a class="issue-return" href="#issue-b45c400e" title="Jump to section">↵</a></div>
   <div class="issue"> IDL is taking care of most steps in "query the sanitizer config". Clean up. <a href="https://github.com/WICG/sanitizer-api/issues/150">[Issue #150]</a> <a class="issue-return" href="#issue-4f906162" title="Jump to section">↵</a></div>
   <div class="issue"> The step above needs to explicitly iterate over the children and insert into parent. It could collect them in a variable or do things in place, but this is a bit too imprecise. <a href="https://github.com/WICG/sanitizer-api/issues/156">[Issue #156]</a> <a class="issue-return" href="#issue-2fb6262a" title="Jump to section">↵</a></div>
   <div class="issue"> The <a data-link-type="dfn" href="#sanitize-action-for-an-attribute">sanitize action for an attribute</a> algorithm parameters do not match.
Issue(153): consider creating an effective sanitizer config. Also, IDL guarantees that a config is ALWAYS given. The question is really whether the members exists. <a href="https://github.com/WICG/sanitizer-api/issues/151">[Issue #151]</a> <a class="issue-return" href="#issue-bf17aea7" title="Jump to section">↵</a></div>
   <div class="issue"> Export and refer funky element properties more precisely. <a href="https://github.com/WICG/sanitizer-api/issues/154">[Issue #154]</a> <a class="issue-return" href="#issue-c273ffb5" title="Jump to section">↵</a></div>
   <div class="issue"> Whitespaces or colons? <a href="https://github.com/WICG/sanitizer-api/issues/146">[Issue #146]</a> <a class="issue-return" href="#issue-d7c2c132" title="Jump to section">↵</a></div>
   <div class="issue"> We do not want to use the interface (e.g., "applet" and "blink" are HTMLUnknownElement) <a href="https://github.com/WICG/sanitizer-api/issues/147">[Issue #147]</a> <a class="issue-return" href="#issue-f3f3c0ed" title="Jump to section">↵</a></div>
   <div class="issue"> Again, this needs to be more specific. Historical, obsolete, conforming, non-conforming (e.g. bgcolor). It is desirable we make a sanitizer-specific list. <a href="https://github.com/WICG/sanitizer-api/issues/147">[Issue #147]</a> <a class="issue-return" href="#issue-a274fa37" title="Jump to section">↵</a></div>
   <div class="issue"> The sanitizer baseline and defaults need to be carefully vetted, and
    are still under discussion. The values below are for illustrative
    purposes only. <a class="issue-return" href="#issue-53c87d03" title="Jump to section">↵</a></div>
  </div>
  <aside class="dfn-panel" data-for="sanitizer">
   <b><a href="#sanitizer">#sanitizer</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-sanitizer">2.1. Sanitizer API</a>
    <li><a href="#ref-for-sanitizer①">3.1. API Implementation</a>
    <li><a href="#ref-for-sanitizer②">3.3. Sanitization Algorithms</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-sanitizer-sanitizer">
   <b><a href="#dom-sanitizer-sanitizer">#dom-sanitizer-sanitizer</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-sanitizer-sanitizer">2.1. Sanitizer API</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-sanitizer-sanitize">
   <b><a href="#dom-sanitizer-sanitize">#dom-sanitizer-sanitize</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-sanitizer-sanitize">2.1. Sanitizer API</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-sanitizer-sanitizefor">
   <b><a href="#dom-sanitizer-sanitizefor">#dom-sanitizer-sanitizefor</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-sanitizer-sanitizefor">2.1. Sanitizer API</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-sanitizer-getconfiguration">
   <b><a href="#dom-sanitizer-getconfiguration">#dom-sanitizer-getconfiguration</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-sanitizer-getconfiguration">2.1. Sanitizer API</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-sanitizer-getdefaultconfiguration">
   <b><a href="#dom-sanitizer-getdefaultconfiguration">#dom-sanitizer-getdefaultconfiguration</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-sanitizer-getdefaultconfiguration">2.1. Sanitizer API</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dictdef-sethtmloptions">
   <b><a href="#dictdef-sethtmloptions">#dictdef-sethtmloptions</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dictdef-sethtmloptions">2.1. Sanitizer API</a>
    <li><a href="#ref-for-dictdef-sethtmloptions①">3.1. API Implementation</a> <a href="#ref-for-dictdef-sethtmloptions②">(2)</a> <a href="#ref-for-dictdef-sethtmloptions③">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-sethtmloptions-sanitizer">
   <b><a href="#dom-sethtmloptions-sanitizer">#dom-sethtmloptions-sanitizer</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-sethtmloptions-sanitizer">3.1. API Implementation</a> <a href="#ref-for-dom-sethtmloptions-sanitizer①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-element-sethtml">
   <b><a href="#dom-element-sethtml">#dom-element-sethtml</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-element-sethtml">2.1. Sanitizer API</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="configuration-dictionary">
   <b><a href="#configuration-dictionary">#configuration-dictionary</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-configuration-dictionary">2.1. Sanitizer API</a>
    <li><a href="#ref-for-configuration-dictionary①">3.1. API Implementation</a> <a href="#ref-for-configuration-dictionary②">(2)</a> <a href="#ref-for-configuration-dictionary③">(3)</a>
    <li><a href="#ref-for-configuration-dictionary④">3.3. Sanitization Algorithms</a> <a href="#ref-for-configuration-dictionary⑤">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dictdef-sanitizerconfig">
   <b><a href="#dictdef-sanitizerconfig">#dictdef-sanitizerconfig</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dictdef-sanitizerconfig">2.1. Sanitizer API</a> <a href="#ref-for-dictdef-sanitizerconfig①">(2)</a> <a href="#ref-for-dictdef-sanitizerconfig②">(3)</a>
    <li><a href="#ref-for-dictdef-sanitizerconfig③">3.1. API Implementation</a> <a href="#ref-for-dictdef-sanitizerconfig④">(2)</a>
    <li><a href="#ref-for-dictdef-sanitizerconfig⑤">3.4. Matching Against The Configuration</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-sanitizerconfig-allowelements">
   <b><a href="#dom-sanitizerconfig-allowelements">#dom-sanitizerconfig-allowelements</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-sanitizerconfig-allowelements">3.4. Matching Against The Configuration</a> <a href="#ref-for-dom-sanitizerconfig-allowelements①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-sanitizerconfig-blockelements">
   <b><a href="#dom-sanitizerconfig-blockelements">#dom-sanitizerconfig-blockelements</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-sanitizerconfig-blockelements">3.4. Matching Against The Configuration</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-sanitizerconfig-dropelements">
   <b><a href="#dom-sanitizerconfig-dropelements">#dom-sanitizerconfig-dropelements</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-sanitizerconfig-dropelements">3.4. Matching Against The Configuration</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-sanitizerconfig-allowcustomelements">
   <b><a href="#dom-sanitizerconfig-allowcustomelements">#dom-sanitizerconfig-allowcustomelements</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-sanitizerconfig-allowcustomelements">2.3. The Configuration Dictionary</a>
    <li><a href="#ref-for-dom-sanitizerconfig-allowcustomelements①">3.4. Matching Against The Configuration</a> <a href="#ref-for-dom-sanitizerconfig-allowcustomelements②">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-sanitizerconfig-allowunknownmarkup">
   <b><a href="#dom-sanitizerconfig-allowunknownmarkup">#dom-sanitizerconfig-allowunknownmarkup</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-sanitizerconfig-allowunknownmarkup">2.3. The Configuration Dictionary</a>
    <li><a href="#ref-for-dom-sanitizerconfig-allowunknownmarkup①">3.4. Matching Against The Configuration</a> <a href="#ref-for-dom-sanitizerconfig-allowunknownmarkup②">(2)</a> <a href="#ref-for-dom-sanitizerconfig-allowunknownmarkup③">(3)</a> <a href="#ref-for-dom-sanitizerconfig-allowunknownmarkup④">(4)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="element-allow-list">
   <b><a href="#element-allow-list">#element-allow-list</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-element-allow-list">3.1. API Implementation</a>
    <li><a href="#ref-for-element-allow-list①">3.4. Matching Against The Configuration</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="element-block-list">
   <b><a href="#element-block-list">#element-block-list</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-element-block-list">3.1. API Implementation</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="element-drop-list">
   <b><a href="#element-drop-list">#element-drop-list</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-element-drop-list">3.1. API Implementation</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="attribute-allow-list">
   <b><a href="#attribute-allow-list">#attribute-allow-list</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-attribute-allow-list">3.1. API Implementation</a>
    <li><a href="#ref-for-attribute-allow-list①">3.4. Matching Against The Configuration</a> <a href="#ref-for-attribute-allow-list②">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="attribute-drop-list">
   <b><a href="#attribute-drop-list">#attribute-drop-list</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-attribute-drop-list">3.1. API Implementation</a>
    <li><a href="#ref-for-attribute-drop-list①">3.4. Matching Against The Configuration</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="allow-comments-option">
   <b><a href="#allow-comments-option">#allow-comments-option</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-allow-comments-option">3.3. Sanitization Algorithms</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="attribute-match-list">
   <b><a href="#attribute-match-list">#attribute-match-list</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-attribute-match-list">2.3. The Configuration Dictionary</a> <a href="#ref-for-attribute-match-list①">(2)</a>
    <li><a href="#ref-for-attribute-match-list②">2.3.1. Attribute Match Lists</a>
    <li><a href="#ref-for-attribute-match-list③">3.4. Matching Against The Configuration</a> <a href="#ref-for-attribute-match-list④">(2)</a> <a href="#ref-for-attribute-match-list⑤">(3)</a> <a href="#ref-for-attribute-match-list⑥">(4)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="typedefdef-attributematchlist">
   <b><a href="#typedefdef-attributematchlist">#typedefdef-attributematchlist</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-typedefdef-attributematchlist">2.3. The Configuration Dictionary</a> <a href="#ref-for-typedefdef-attributematchlist①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="create-a-sanitizer">
   <b><a href="#create-a-sanitizer">#create-a-sanitizer</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-create-a-sanitizer">2.1. Sanitizer API</a>
    <li><a href="#ref-for-create-a-sanitizer①">3.1. API Implementation</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="sanitize">
   <b><a href="#sanitize">#sanitize</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-sanitize">2.1. Sanitizer API</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="sanitizefor">
   <b><a href="#sanitizefor">#sanitizefor</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-sanitizefor">2.1. Sanitizer API</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="sanitizeandset">
   <b><a href="#sanitizeandset">#sanitizeandset</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-sanitizeandset">2.1. Sanitizer API</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="query-the-sanitizer-config">
   <b><a href="#query-the-sanitizer-config">#query-the-sanitizer-config</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-query-the-sanitizer-config">2.1. Sanitizer API</a>
    <li><a href="#ref-for-query-the-sanitizer-config①">2.3. The Configuration Dictionary</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="create-a-document-fragment">
   <b><a href="#create-a-document-fragment">#create-a-document-fragment</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-create-a-document-fragment">3.1. API Implementation</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="sanitize-a-document-fragment">
   <b><a href="#sanitize-a-document-fragment">#sanitize-a-document-fragment</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-sanitize-a-document-fragment">3.1. API Implementation</a> <a href="#ref-for-sanitize-a-document-fragment①">(2)</a> <a href="#ref-for-sanitize-a-document-fragment②">(3)</a>
    <li><a href="#ref-for-sanitize-a-document-fragment③">3.3. Sanitization Algorithms</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="sanitize-a-node">
   <b><a href="#sanitize-a-node">#sanitize-a-node</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-sanitize-a-node">3.3. Sanitization Algorithms</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="handle-funky-elements">
   <b><a href="#handle-funky-elements">#handle-funky-elements</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-handle-funky-elements">3.3. Sanitization Algorithms</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="sanitize-action">
   <b><a href="#sanitize-action">#sanitize-action</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-sanitize-action">3.3. Sanitization Algorithms</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="sanitize-action-for-an-element">
   <b><a href="#sanitize-action-for-an-element">#sanitize-action-for-an-element</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-sanitize-action-for-an-element">3.3. Sanitization Algorithms</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="element-matches-an-element-name">
   <b><a href="#element-matches-an-element-name">#element-matches-an-element-name</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-element-matches-an-element-name">3.1. API Implementation</a>
    <li><a href="#ref-for-element-matches-an-element-name①">3.4. Matching Against The Configuration</a> <a href="#ref-for-element-matches-an-element-name②">(2)</a> <a href="#ref-for-element-matches-an-element-name③">(3)</a> <a href="#ref-for-element-matches-an-element-name④">(4)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="attribute-matches-an-attribute-match-list">
   <b><a href="#attribute-matches-an-attribute-match-list">#attribute-matches-an-attribute-match-list</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-attribute-matches-an-attribute-match-list">3.4. Matching Against The Configuration</a> <a href="#ref-for-attribute-matches-an-attribute-match-list①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="sanitize-action-for-an-attribute">
   <b><a href="#sanitize-action-for-an-attribute">#sanitize-action-for-an-attribute</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-sanitize-action-for-an-attribute">3.3. Sanitization Algorithms</a> <a href="#ref-for-sanitize-action-for-an-attribute①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="element-kind">
   <b><a href="#element-kind">#element-kind</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-element-kind">3.1. API Implementation</a> <a href="#ref-for-element-kind①">(2)</a>
    <li><a href="#ref-for-element-kind②">3.4. Matching Against The Configuration</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="attribute-kind">
   <b><a href="#attribute-kind">#attribute-kind</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-attribute-kind">3.4. Matching Against The Configuration</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="baseline-element-allow-list">
   <b><a href="#baseline-element-allow-list">#baseline-element-allow-list</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-baseline-element-allow-list">3.1. API Implementation</a> <a href="#ref-for-baseline-element-allow-list①">(2)</a>
    <li><a href="#ref-for-baseline-element-allow-list②">3.4. Matching Against The Configuration</a>
    <li><a href="#ref-for-baseline-element-allow-list③">3.5. Baseline and Defaults</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="baseline-attribute-allow-list">
   <b><a href="#baseline-attribute-allow-list">#baseline-attribute-allow-list</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-baseline-attribute-allow-list">3.4. Matching Against The Configuration</a>
    <li><a href="#ref-for-baseline-attribute-allow-list①">3.5. Baseline and Defaults</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="default-configuration">
   <b><a href="#default-configuration">#default-configuration</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-default-configuration">2.1. Sanitizer API</a>
    <li><a href="#ref-for-default-configuration①">2.3. The Configuration Dictionary</a>
    <li><a href="#ref-for-default-configuration②">3.1. API Implementation</a>
    <li><a href="#ref-for-default-configuration③">3.3. Sanitization Algorithms</a>
    <li><a href="#ref-for-default-configuration④">3.4. Matching Against The Configuration</a> <a href="#ref-for-default-configuration⑤">(2)</a>
    <li><a href="#ref-for-default-configuration⑥">3.5. Baseline and Defaults</a> <a href="#ref-for-default-configuration⑦">(2)</a>
   </ul>
  </aside>
<script>/* script-dfn-panel */

document.body.addEventListener("click", function(e) {
    var queryAll = function(sel) { return [].slice.call(document.querySelectorAll(sel)); }
    // Find the dfn element or panel, if any, that was clicked on.
    var el = e.target;
    var target;
    var hitALink = false;
    while(el.parentElement) {
        if(el.tagName == "A") {
            // Clicking on a link in a <dfn> shouldn't summon the panel
            hitALink = true;
        }
        if(el.classList.contains("dfn-paneled")) {
            target = "dfn";
            break;
        }
        if(el.classList.contains("dfn-panel")) {
            target = "dfn-panel";
            break;
        }
        el = el.parentElement;
    }
    if(target != "dfn-panel") {
        // Turn off any currently "on" or "activated" panels.
        queryAll(".dfn-panel.on, .dfn-panel.activated").forEach(function(el){
            el.classList.remove("on");
            el.classList.remove("activated");
        });
    }
    if(target == "dfn" && !hitALink) {
        // open the panel
        var dfnPanel = document.querySelector(".dfn-panel[data-for='" + el.id + "']");
        if(dfnPanel) {
            dfnPanel.classList.add("on");
            var rect = el.getBoundingClientRect();
            dfnPanel.style.left = window.scrollX + rect.right + 5 + "px";
            dfnPanel.style.top = window.scrollY + rect.top + "px";
            var panelRect = dfnPanel.getBoundingClientRect();
            var panelWidth = panelRect.right - panelRect.left;
            if(panelRect.right > document.body.scrollWidth && (rect.left - (panelWidth + 5)) > 0) {
                // Reposition, because the panel is overflowing
                dfnPanel.style.left = window.scrollX + rect.left - (panelWidth + 5) + "px";
            }
        } else {
            console.log("Couldn't find .dfn-panel[data-for='" + el.id + "']");
        }
    } else if(target == "dfn-panel") {
        // Switch it to "activated" state, which pins it.
        el.classList.add("activated");
        el.style.left = null;
        el.style.top = null;
    }

});
</script>
<script>/* script-var-click-highlighting */

    "use strict";
    {
        document.addEventListener("click", e=>{
            if(e.target.nodeName == "VAR") {
                highlightSameAlgoVars(e.target);
            }
        });
        const indexCounts = new Map();
        const indexNames = new Map();
        function highlightSameAlgoVars(v) {
            // Find the algorithm container.
            let algoContainer = null;
            let searchEl = v;
            while(algoContainer == null && searchEl != document.body) {
                searchEl = searchEl.parentNode;
                if(searchEl.hasAttribute("data-algorithm")) {
                    algoContainer = searchEl;
                }
            }

            // Not highlighting document-global vars,
            // too likely to be unrelated.
            if(algoContainer == null) return;

            const algoName = algoContainer.getAttribute("data-algorithm");
            const varName = getVarName(v);
            const addClass = !v.classList.contains("selected");
            let highlightClass = null;
            if(addClass) {
                const index = chooseHighlightIndex(algoName, varName);
                indexCounts.get(algoName)[index] += 1;
                indexNames.set(algoName+"///"+varName, index);
                highlightClass = nameFromIndex(index);
            } else {
                const index = previousHighlightIndex(algoName, varName);
                indexCounts.get(algoName)[index] -= 1;
                highlightClass = nameFromIndex(index);
            }

            // Find all same-name vars, and toggle their class appropriately.
            for(const el of algoContainer.querySelectorAll("var")) {
                if(getVarName(el) == varName) {
                    el.classList.toggle("selected", addClass);
                    el.classList.toggle(highlightClass, addClass);
                }
            }
        }
        function getVarName(el) {
            return el.textContent.replace(/(\s|\xa0)+/, " ").trim();
        }
        function chooseHighlightIndex(algoName, varName) {
            let indexes = null;
            if(indexCounts.has(algoName)) {
                indexes = indexCounts.get(algoName);
            } else {
                // 7 classes right now
                indexes = [0,0,0,0,0,0,0];
                indexCounts.set(algoName, indexes);
            }

            // If the element was recently unclicked,
            // *and* that color is still unclaimed,
            // give it back the same color.
            const lastIndex = previousHighlightIndex(algoName, varName);
            if(indexes[lastIndex] === 0) return lastIndex;

            // Find the earliest index with the lowest count.
            const minCount = Math.min.apply(null, indexes);
            let index = null;
            for(var i = 0; i < indexes.length; i++) {
                if(indexes[i] == minCount) {
                    return i;
                }
            }
        }
        function previousHighlightIndex(algoName, varName) {
            return indexNames.get(algoName+"///"+varName);
        }
        function nameFromIndex(index) {
            return "selected" + index;
        }
    }
    </script>
<script>/* script-wpt */
let wptPath = "/sanitizer-api/";
"use strict";

document.addEventListener("DOMContentLoaded", async ()=>{
    if(wptPath == "/") return;

    const runsUrl = "https://wpt.fyi/api/runs?label=master&label=stable&max-count=1&product=chrome&product=firefox&product=safari&product=edge";
    const runs = await (await fetch(runsUrl)).json();

    const testResults = await (await fetch("https://wpt.fyi/api/search", {
        method:"POST",
        headers:{
            "Content-Type":"application/json",
        },
        body: JSON.stringify({
            "run_ids": runs.map(x=>x.id),
            "query": {"path": wptPath},
        })
    })).json();

    const browsers = runs.map(x=>({name:x.browser_name, version:x.browser_version, passes:0, total: 0}));
    const resultsFromPath = new Map(testResults.results.map(result=>{
        const testPath = result.test;
        const passes = result.legacy_status.map(x=>[x.passes, x.total]);
        return [testPath, passes];
    }));
    const seenTests = new Set();
    document.querySelectorAll(".wpt-name").forEach(nameEl=>{
        const passData = resultsFromPath.get("/" + nameEl.getAttribute("title"));
        if(!passData) {
            console.log("Couldn't find test in results:", nameEl);
            return
        }
        const numTests = passData[0][1];
        if(numTests > 1) {
            nameEl.insertAdjacentElement("beforeend",
                el("small", {}, ` (${numTests} tests)`));
        }
        if(passData == undefined) return;
        const resultsEl = el("span",{"class":"wpt-results"},
            ...passData.map((p,i) => el("span",
            {
                "title": `${browsers[i].name} ${p[0]}/${p[1]}`,
                "class": "wpt-result",
                "style": `background: conic-gradient(forestgreen ${p[0]/p[1]*360}deg, darkred 0deg);`,
            })),
        );
        nameEl.insertAdjacentElement("afterend", resultsEl);

        // Only update the summary pass/total count if we haven't seen this
        // test before, to support authors listing the same test multiple times
        // in a spec.
        if (!seenTests.has(nameEl.getAttribute("title"))) {
            seenTests.add(nameEl.getAttribute("title"));
            passData.forEach((p,i) => {
                browsers[i].passes += p[0];
                browsers[i].total += p[1];
            });
        }
    });
    const overview = document.querySelector(".wpt-overview");
    if(overview) {
        overview.appendChild(el('ul',{}, ...browsers.map(formatWptResult)));
        document.head.appendChild(el('style', {},
            `.wpt-overview ul { display: flex; flex-flow: row wrap; gap: .2em; justify-content: start; list-style: none; padding: 0; margin: 0;}
             .wpt-overview li { padding: .25em 1em; color: black; text-align: center; }
             .wpt-overview img { height: 1.5em; height: max(1.5em, 32px); background: transparent; }
             .wpt-overview .browser { font-weight: bold; }
             .wpt-overview .passes-none { background: #e57373; }
             .wpt-overview .passes-hardly { background: #ffb74d; }
             .wpt-overview .passes-a-few { background: #ffd54f; }
             .wpt-overview .passes-half { background: #fff176; }
             .wpt-overview .passes-lots { background: #dce775; }
             .wpt-overview .passes-most { background: #aed581; }
             .wpt-overview .passes-all { background: #81c784; }`));
    }
});
function el(name, attrs, ...content) {
    const x = document.createElement(name);
    for(const [k,v] of Object.entries(attrs)) {
        x.setAttribute(k, v);
    }
    for(let child of content) {
        if(typeof child == "string") child = document.createTextNode(child);
        try {
        x.appendChild(child);
        } catch(e) { console.log({x, child}); }
    }
    return x;
}
function formatWptResult({name, version, passes, total}) {
    const passRate = passes/total;
    let passClass = "";
    if(passRate == 0)      passClass = "passes-none";
    else if(passRate < .2) passClass = "passes-hardly";
    else if(passRate < .4) passClass = "passes-a-few";
    else if(passRate < .6) passClass = "passes-half";
    else if(passRate < .8) passClass = "passes-lots";
    else if(passRate < 1)  passClass = "passes-most";
    else                   passClass = "passes-all";

    name = name[0].toUpperCase() + name.slice(1);
    const shortVersion = /^\d+/.exec(version);
    const icon = []

    if(name == "Chrome") icon.push(el('img', {alt:"", src:"https://wpt.fyi/static/chrome_64x64.png"}));
    if(name == "Edge") icon.push(el('img', {alt:"", src:"https://wpt.fyi/static/edge_64x64.png"}));
    if(name == "Safari") icon.push(el('img', {alt:"", src:"https://wpt.fyi/static/safari_64x64.png"}));
    if(name == "Firefox") icon.push(el('img', {alt:"", src:"https://wpt.fyi/static/firefox_64x64.png"}));

    return el('li', {"class":passClass},
        el('nobr', {'class':'browser'}, ...icon, ` ${name} ${shortVersion}`),
        el('br', {}),
        el('nobr', {'class':'pass-rate'}, `${passes}/${total}`)
    );
}
</script>