<!doctype html><html lang="en">
 <head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
  <title>HTML Sanitizer API</title>
  <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
  <link href="https://www.w3.org/StyleSheets/TR/2016/cg-draft" rel="stylesheet">
  <link href="https://wicg.github.io/sanitizer-api/" rel="canonical">
<style>/* style-autolinks */

.css.css, .property.property, .descriptor.descriptor {
    color: var(--a-normal-text);
    font-size: inherit;
    font-family: inherit;
}
.css::before, .property::before, .descriptor::before {
    content: "‘";
}
.css::after, .property::after, .descriptor::after {
    content: "’";
}
.property, .descriptor {
    /* Don't wrap property and descriptor names */
    white-space: nowrap;
}
.type { /* CSS value <type> */
    font-style: italic;
}
pre .property::before, pre .property::after {
    content: "";
}
[data-link-type="property"]::before,
[data-link-type="propdesc"]::before,
[data-link-type="descriptor"]::before,
[data-link-type="value"]::before,
[data-link-type="function"]::before,
[data-link-type="at-rule"]::before,
[data-link-type="selector"]::before,
[data-link-type="maybe"]::before {
    content: "‘";
}
[data-link-type="property"]::after,
[data-link-type="propdesc"]::after,
[data-link-type="descriptor"]::after,
[data-link-type="value"]::after,
[data-link-type="function"]::after,
[data-link-type="at-rule"]::after,
[data-link-type="selector"]::after,
[data-link-type="maybe"]::after {
    content: "’";
}

[data-link-type].production::before,
[data-link-type].production::after,
.prod [data-link-type]::before,
.prod [data-link-type]::after {
    content: "";
}

[data-link-type=element],
[data-link-type=element-attr] {
    font-family: Menlo, Consolas, "DejaVu Sans Mono", monospace;
    font-size: .9em;
}
[data-link-type=element]::before { content: "<" }
[data-link-type=element]::after  { content: ">" }

[data-link-type=biblio] {
    white-space: pre;
}</style>
<style>/* style-colors */

/* Any --*-text not paired with a --*-bg is assumed to have a transparent bg */
:root {
    color-scheme: light dark;

    --text: black;
    --bg: white;

    --unofficial-watermark: url(https://www.w3.org/StyleSheets/TR/2016/logos/UD-watermark);

    --logo-bg: #1a5e9a;
    --logo-active-bg: #c00;
    --logo-text: white;

    --tocnav-normal-text: #707070;
    --tocnav-normal-bg: var(--bg);
    --tocnav-hover-text: var(--tocnav-normal-text);
    --tocnav-hover-bg: #f8f8f8;
    --tocnav-active-text: #c00;
    --tocnav-active-bg: var(--tocnav-normal-bg);

    --tocsidebar-text: var(--text);
    --tocsidebar-bg: #f7f8f9;
    --tocsidebar-shadow: rgba(0,0,0,.1);
    --tocsidebar-heading-text: hsla(203,20%,40%,.7);

    --toclink-text: var(--text);
    --toclink-underline: #3980b5;
    --toclink-visited-text: var(--toclink-text);
    --toclink-visited-underline: #054572;

    --heading-text: #005a9c;

    --hr-text: var(--text);

    --algo-border: #def;

    --del-text: red;
    --del-bg: transparent;
    --ins-text: #080;
    --ins-bg: transparent;

    --a-normal-text: #034575;
    --a-normal-underline: #707070;
    --a-visited-text: var(--a-normal-text);
    --a-visited-underline: #bbb;
    --a-hover-bg: rgba(75%, 75%, 75%, .25);
    --a-active-text: #c00;
    --a-active-underline: #c00;

    --blockquote-border: silver;
    --blockquote-bg: transparent;
    --blockquote-text: currentcolor;

    --issue-border: #e05252;
    --issue-bg: #fbe9e9;
    --issue-text: var(--text);
    --issueheading-text: #831616;

    --example-border: #e0cb52;
    --example-bg: #fcfaee;
    --example-text: var(--text);
    --exampleheading-text: #574b0f;

    --note-border: #52e052;
    --note-bg: #e9fbe9;
    --note-text: var(--text);
    --noteheading-text: hsl(120, 70%, 30%);
    --notesummary-underline: silver;

    --assertion-border: #aaa;
    --assertion-bg: #eee;
    --assertion-text: black;

    --advisement-border: orange;
    --advisement-bg: #fec;
    --advisement-text: var(--text);
    --advisementheading-text: #b35f00;

    --warning-border: red;
    --warning-bg: hsla(40,100%,50%,0.95);
    --warning-text: var(--text);

    --amendment-border: #330099;
    --amendment-bg: #F5F0FF;
    --amendment-text: var(--text);
    --amendmentheading-text: #220066;

    --def-border: #8ccbf2;
    --def-bg: #def;
    --def-text: var(--text);
    --defrow-border: #bbd7e9;

    --datacell-border: silver;

    --indexinfo-text: #707070;

    --indextable-hover-text: black;
    --indextable-hover-bg: #f7f8f9;

    --outdatedspec-bg: rgba(0, 0, 0, .5);
    --outdatedspec-text: black;
    --outdated-bg: maroon;
    --outdated-text: white;
    --outdated-shadow: red;

    --editedrec-bg: darkorange;
}</style>
<style>/* style-counters */

body {
    counter-reset: example figure issue;
}
.issue {
    counter-increment: issue;
}
.issue:not(.no-marker)::before {
    content: "Issue " counter(issue);
}

.example {
    counter-increment: example;
}
.example:not(.no-marker)::before {
    content: "Example " counter(example);
}
.invalid.example:not(.no-marker)::before,
.illegal.example:not(.no-marker)::before {
    content: "Invalid Example" counter(example);
}

figcaption {
    counter-increment: figure;
}
figcaption:not(.no-marker)::before {
    content: "Figure " counter(figure) " ";
}</style>
<style>/* style-dfn-panel */

:root {
    --dfnpanel-bg: #ddd;
    --dfnpanel-text: var(--text);
}
.dfn-panel {
    position: absolute;
    z-index: 35;
    height: auto;
    width: -webkit-fit-content;
    width: fit-content;
    max-width: 300px;
    max-height: 500px;
    overflow: auto;
    padding: 0.5em 0.75em;
    font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
    background: var(--dfnpanel-bg);
    color: var(--dfnpanel-text);
    border: outset 0.2em;
}
.dfn-panel:not(.on) { display: none; }
.dfn-panel * { margin: 0; padding: 0; text-indent: 0; }
.dfn-panel > b { display: block; }
.dfn-panel a { color: var(--dfnpanel-text); }
.dfn-panel a:not(:hover) { text-decoration: none !important; border-bottom: none !important; }
.dfn-panel > b + b { margin-top: 0.25em; }
.dfn-panel ul { padding: 0; }
.dfn-panel li { list-style: inside; }
.dfn-panel.activated {
    display: inline-block;
    position: fixed;
    left: .5em;
    bottom: 2em;
    margin: 0 auto;
    max-width: calc(100vw - 1.5em - .4em - .5em);
    max-height: 30vh;
}

.dfn-paneled { cursor: pointer; }
</style>
<style>/* style-md-lists */

/* This is a weird hack for me not yet following the commonmark spec
   regarding paragraph and lists. */
[data-md] > :first-child {
    margin-top: 0;
}
[data-md] > :last-child {
    margin-bottom: 0;
}</style>
<style>/* style-selflinks */

:root {
    --selflink-text: white;
    --selflink-bg: gray;
    --selflink-hover-text: black;
}
.heading, .issue, .note, .example, li, dt {
    position: relative;
}
a.self-link {
    position: absolute;
    top: 0;
    left: calc(-1 * (3.5rem - 26px));
    width: calc(3.5rem - 26px);
    height: 2em;
    text-align: center;
    border: none;
    transition: opacity .2s;
    opacity: .5;
}
a.self-link:hover {
    opacity: 1;
}
.heading > a.self-link {
    font-size: 83%;
}
li > a.self-link {
    left: calc(-1 * (3.5rem - 26px) - 2em);
}
dfn > a.self-link {
    top: auto;
    left: auto;
    opacity: 0;
    width: 1.5em;
    height: 1.5em;
    background: var(--selflink-bg);
    color: var(--selflink-text);
    font-style: normal;
    transition: opacity .2s, background-color .2s, color .2s;
}
dfn:hover > a.self-link {
    opacity: 1;
}
dfn > a.self-link:hover {
    color: var(--selflink-hover-text);
}

a.self-link::before            { content: "¶"; }
.heading > a.self-link::before { content: "§"; }
dfn > a.self-link::before      { content: "#"; }
</style>
<style>/* style-syntax-highlighting */

            pre.idl.highlight {
                background: var(--borderedblock-bg, var(--def-bg));
            }
            
code.highlight { padding: .1em; border-radius: .3em; }
pre.highlight, pre > code.highlight { display: block; padding: 1em; margin: .5em 0; overflow: auto; border-radius: 0; }

.highlight:not(.idl) { background: rgba(0, 0, 0, .03); }
c-[a] { color: #990055 } /* Keyword.Declaration */
c-[b] { color: #990055 } /* Keyword.Type */
c-[c] { color: #708090 } /* Comment */
c-[d] { color: #708090 } /* Comment.Multiline */
c-[e] { color: #0077aa } /* Name.Attribute */
c-[f] { color: #669900 } /* Name.Tag */
c-[g] { color: #222222 } /* Name.Variable */
c-[k] { color: #990055 } /* Keyword */
c-[l] { color: #000000 } /* Literal */
c-[m] { color: #000000 } /* Literal.Number */
c-[n] { color: #0077aa } /* Name */
c-[o] { color: #999999 } /* Operator */
c-[p] { color: #999999 } /* Punctuation */
c-[s] { color: #a67f59 } /* Literal.String */
c-[t] { color: #a67f59 } /* Literal.String.Single */
c-[u] { color: #a67f59 } /* Literal.String.Double */
c-[cp] { color: #708090 } /* Comment.Preproc */
c-[c1] { color: #708090 } /* Comment.Single */
c-[cs] { color: #708090 } /* Comment.Special */
c-[kc] { color: #990055 } /* Keyword.Constant */
c-[kn] { color: #990055 } /* Keyword.Namespace */
c-[kp] { color: #990055 } /* Keyword.Pseudo */
c-[kr] { color: #990055 } /* Keyword.Reserved */
c-[ld] { color: #000000 } /* Literal.Date */
c-[nc] { color: #0077aa } /* Name.Class */
c-[no] { color: #0077aa } /* Name.Constant */
c-[nd] { color: #0077aa } /* Name.Decorator */
c-[ni] { color: #0077aa } /* Name.Entity */
c-[ne] { color: #0077aa } /* Name.Exception */
c-[nf] { color: #0077aa } /* Name.Function */
c-[nl] { color: #0077aa } /* Name.Label */
c-[nn] { color: #0077aa } /* Name.Namespace */
c-[py] { color: #0077aa } /* Name.Property */
c-[ow] { color: #999999 } /* Operator.Word */
c-[mb] { color: #000000 } /* Literal.Number.Bin */
c-[mf] { color: #000000 } /* Literal.Number.Float */
c-[mh] { color: #000000 } /* Literal.Number.Hex */
c-[mi] { color: #000000 } /* Literal.Number.Integer */
c-[mo] { color: #000000 } /* Literal.Number.Oct */
c-[sb] { color: #a67f59 } /* Literal.String.Backtick */
c-[sc] { color: #a67f59 } /* Literal.String.Char */
c-[sd] { color: #a67f59 } /* Literal.String.Doc */
c-[se] { color: #a67f59 } /* Literal.String.Escape */
c-[sh] { color: #a67f59 } /* Literal.String.Heredoc */
c-[si] { color: #a67f59 } /* Literal.String.Interpol */
c-[sx] { color: #a67f59 } /* Literal.String.Other */
c-[sr] { color: #a67f59 } /* Literal.String.Regex */
c-[ss] { color: #a67f59 } /* Literal.String.Symbol */
c-[vc] { color: #0077aa } /* Name.Variable.Class */
c-[vg] { color: #0077aa } /* Name.Variable.Global */
c-[vi] { color: #0077aa } /* Name.Variable.Instance */
c-[il] { color: #000000 } /* Literal.Number.Integer.Long */
</style>
<style>/* style-darkmode */

@media (prefers-color-scheme: dark) {
    :root {
        --text: #ddd;
        --bg: black;

        --unofficial-watermark: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='400'%3E%3Cg fill='%23100808' transform='translate(200 200) rotate(-45) translate(-200 -200)' stroke='%23100808' stroke-width='3'%3E%3Ctext x='50%25' y='220' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EUNOFFICIAL%3C/text%3E%3Ctext x='50%25' y='305' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EDRAFT%3C/text%3E%3C/g%3E%3C/svg%3E");

        --logo-bg: #1a5e9a;
        --logo-active-bg: #c00;
        --logo-text: white;

        --tocnav-normal-text: #999;
        --tocnav-normal-bg: var(--bg);
        --tocnav-hover-text: var(--tocnav-normal-text);
        --tocnav-hover-bg: #080808;
        --tocnav-active-text: #f44;
        --tocnav-active-bg: var(--tocnav-normal-bg);

        --tocsidebar-text: var(--text);
        --tocsidebar-bg: #080808;
        --tocsidebar-shadow: rgba(255,255,255,.1);
        --tocsidebar-heading-text: hsla(203,20%,40%,.7);

        --toclink-text: var(--text);
        --toclink-underline: #6af;
        --toclink-visited-text: var(--toclink-text);
        --toclink-visited-underline: #054572;

        --heading-text: #8af;

        --hr-text: var(--text);

        --algo-border: #456;

        --del-text: #f44;
        --del-bg: transparent;
        --ins-text: #4a4;
        --ins-bg: transparent;

        --a-normal-text: #6af;
        --a-normal-underline: #555;
        --a-visited-text: var(--a-normal-text);
        --a-visited-underline: var(--a-normal-underline);
        --a-hover-bg: rgba(25%, 25%, 25%, .2);
        --a-active-text: #f44;
        --a-active-underline: var(--a-active-text);

        --borderedblock-bg: rgba(255, 255, 255, .05);

        --blockquote-border: silver;
        --blockquote-bg: var(--borderedblock-bg);
        --blockquote-text: currentcolor;

        --issue-border: #e05252;
        --issue-bg: var(--borderedblock-bg);
        --issue-text: var(--text);
        --issueheading-text: hsl(0deg, 70%, 70%);

        --example-border: hsl(50deg, 90%, 60%);
        --example-bg: var(--borderedblock-bg);
        --example-text: var(--text);
        --exampleheading-text: hsl(50deg, 70%, 70%);

        --note-border: hsl(120deg, 100%, 35%);
        --note-bg: var(--borderedblock-bg);
        --note-text: var(--text);
        --noteheading-text: hsl(120, 70%, 70%);
        --notesummary-underline: silver;

        --assertion-border: #444;
        --assertion-bg: var(--borderedblock-bg);
        --assertion-text: var(--text);

        --advisement-border: orange;
        --advisement-bg: #222218;
        --advisement-text: var(--text);
        --advisementheading-text: #f84;

        --warning-border: red;
        --warning-bg: hsla(40,100%,20%,0.95);
        --warning-text: var(--text);

        --amendment-border: #330099;
        --amendment-bg: #080010;
        --amendment-text: var(--text);
        --amendmentheading-text: #cc00ff;

        --def-border: #8ccbf2;
        --def-bg: #080818;
        --def-text: var(--text);
        --defrow-border: #136;

        --datacell-border: silver;

        --indexinfo-text: #aaa;

        --indextable-hover-text: var(--text);
        --indextable-hover-bg: #181818;

        --outdatedspec-bg: rgba(255, 255, 255, .5);
        --outdatedspec-text: black;
        --outdated-bg: maroon;
        --outdated-text: white;
        --outdated-shadow: red;

        --editedrec-bg: darkorange;
    }
    /* In case a transparent-bg image doesn't expect to be on a dark bg,
       which is quite common in practice... */
    img { background: white; }
}
@media (prefers-color-scheme: dark) {
    :root {
        --selflink-text: black;
        --selflink-bg: silver;
        --selflink-hover-text: white;
    }
}

@media (prefers-color-scheme: dark) {
    :root {
        --dfnpanel-bg: #222;
        --dfnpanel-text: var(--text);
    }
}
@media (prefers-color-scheme: dark) {
    .highlight:not(.idl) { background: rgba(255, 255, 255, .05); }

    c-[a] { color: #d33682 } /* Keyword.Declaration */
    c-[b] { color: #d33682 } /* Keyword.Type */
    c-[c] { color: #2aa198 } /* Comment */
    c-[d] { color: #2aa198 } /* Comment.Multiline */
    c-[e] { color: #268bd2 } /* Name.Attribute */
    c-[f] { color: #b58900 } /* Name.Tag */
    c-[g] { color: #cb4b16 } /* Name.Variable */
    c-[k] { color: #d33682 } /* Keyword */
    c-[l] { color: #657b83 } /* Literal */
    c-[m] { color: #657b83 } /* Literal.Number */
    c-[n] { color: #268bd2 } /* Name */
    c-[o] { color: #657b83 } /* Operator */
    c-[p] { color: #657b83 } /* Punctuation */
    c-[s] { color: #6c71c4 } /* Literal.String */
    c-[t] { color: #6c71c4 } /* Literal.String.Single */
    c-[u] { color: #6c71c4 } /* Literal.String.Double */
    c-[ch] { color: #2aa198 } /* Comment.Hashbang */
    c-[cp] { color: #2aa198 } /* Comment.Preproc */
    c-[cpf] { color: #2aa198 } /* Comment.PreprocFile */
    c-[c1] { color: #2aa198 } /* Comment.Single */
    c-[cs] { color: #2aa198 } /* Comment.Special */
    c-[kc] { color: #d33682 } /* Keyword.Constant */
    c-[kn] { color: #d33682 } /* Keyword.Namespace */
    c-[kp] { color: #d33682 } /* Keyword.Pseudo */
    c-[kr] { color: #d33682 } /* Keyword.Reserved */
    c-[ld] { color: #657b83 } /* Literal.Date */
    c-[nc] { color: #268bd2 } /* Name.Class */
    c-[no] { color: #268bd2 } /* Name.Constant */
    c-[nd] { color: #268bd2 } /* Name.Decorator */
    c-[ni] { color: #268bd2 } /* Name.Entity */
    c-[ne] { color: #268bd2 } /* Name.Exception */
    c-[nf] { color: #268bd2 } /* Name.Function */
    c-[nl] { color: #268bd2 } /* Name.Label */
    c-[nn] { color: #268bd2 } /* Name.Namespace */
    c-[py] { color: #268bd2 } /* Name.Property */
    c-[ow] { color: #657b83 } /* Operator.Word */
    c-[mb] { color: #657b83 } /* Literal.Number.Bin */
    c-[mf] { color: #657b83 } /* Literal.Number.Float */
    c-[mh] { color: #657b83 } /* Literal.Number.Hex */
    c-[mi] { color: #657b83 } /* Literal.Number.Integer */
    c-[mo] { color: #657b83 } /* Literal.Number.Oct */
    c-[sa] { color: #6c71c4 } /* Literal.String.Affix */
    c-[sb] { color: #6c71c4 } /* Literal.String.Backtick */
    c-[sc] { color: #6c71c4 } /* Literal.String.Char */
    c-[dl] { color: #6c71c4 } /* Literal.String.Delimiter */
    c-[sd] { color: #6c71c4 } /* Literal.String.Doc */
    c-[se] { color: #6c71c4 } /* Literal.String.Escape */
    c-[sh] { color: #6c71c4 } /* Literal.String.Heredoc */
    c-[si] { color: #6c71c4 } /* Literal.String.Interpol */
    c-[sx] { color: #6c71c4 } /* Literal.String.Other */
    c-[sr] { color: #6c71c4 } /* Literal.String.Regex */
    c-[ss] { color: #6c71c4 } /* Literal.String.Symbol */
    c-[fm] { color: #268bd2 } /* Name.Function.Magic */
    c-[vc] { color: #cb4b16 } /* Name.Variable.Class */
    c-[vg] { color: #cb4b16 } /* Name.Variable.Global */
    c-[vi] { color: #cb4b16 } /* Name.Variable.Instance */
    c-[vm] { color: #cb4b16 } /* Name.Variable.Magic */
    c-[il] { color: #657b83 } /* Literal.Number.Integer.Long */
}
</style>
 <body class="h-entry">
  <div class="head">
   <p data-fill-with="logo"><a class="logo" href="https://www.w3.org/"> <img alt="W3C" height="48" src="https://www.w3.org/StyleSheets/TR/2016/logos/W3C" width="72"> </a> </p>
   <h1 class="p-name no-ref" id="title">HTML Sanitizer API</h1>
   <h2 class="no-num no-toc no-ref heading settled" id="subtitle"><span class="content">Draft Community Group Report, <time class="dt-updated" datetime="1970-01-01">1 January 1970</time></span></h2>
   <div data-fill-with="spec-metadata">
    <dl>
     <dt>This version:
     <dd><a class="u-url" href="https://wicg.github.io/sanitizer-api/">https://wicg.github.io/sanitizer-api/</a>
     <dt class="editor">Editors:
     <dd class="editor p-author h-card vcard" data-editor-id="68466"><a class="p-name fn u-url url" href="https://frederik-braun.com">Frederik Braun</a> (<span class="p-org org">Mozilla</span>) <a class="u-email email" href="mailto:fbraun@mozilla.com">fbraun@mozilla.com</a>
     <dd class="editor p-author h-card vcard"><a class="p-name fn u-url url" href="https://cure53.de">Mario Heiderich</a> (<span class="p-org org">Cure53</span>) <a class="u-email email" href="mailto:mario@cure53.de">mario@cure53.de</a>
     <dd class="editor p-author h-card vcard"><a class="p-name fn u-url url" href="https://www.google.com">Daniel Vogelheim</a> (<span class="p-org org">Google LLC</span>) <a class="u-email email" href="mailto:vogelheim@google.com">vogelheim@google.com</a>
    </dl>
   </div>
   <div data-fill-with="warning"></div>
   <p class="copyright" data-fill-with="copyright"><a href="http://www.w3.org/Consortium/Legal/ipr-notice#Copyright">Copyright</a> © 1970 the Contributors to the HTML Sanitizer API Specification, published by the <a href="https://www.w3.org/community/wicg/">Web Platform Incubator Community Group</a> under the <a href="https://www.w3.org/community/about/agreements/cla/">W3C Community Contributor License Agreement (CLA)</a>.
A human-readable <a href="http://www.w3.org/community/about/agreements/cla-deed/">summary</a> is available. </p>
   <hr title="Separator for header">
  </div>
  <div class="p-summary" data-fill-with="abstract">
   <h2 class="no-num no-toc no-ref heading settled" id="abstract"><span class="content">Abstract</span></h2>
   <p>This document specifies a set of APIs which allow developers to take untrusted

  strings of HTML, and sanitize them for safe insertion into a document’s DOM.</p>
  </div>
  <div data-fill-with="at-risk"></div>
  <h2 class="no-num no-toc no-ref heading settled" id="status"><span class="content">Status of this document</span></h2>
  <div data-fill-with="status">
   <p> This specification was published by the <a href="https://www.w3.org/community/wicg/">Web Platform Incubator Community Group</a>.
  It is not a W3C Standard nor is it on the W3C Standards Track.

  Please note that under the <a href="https://www.w3.org/community/about/agreements/cla/">W3C Community Contributor License Agreement (CLA)</a> there is a limited opt-out and other conditions apply.

  Learn more about <a href="http://www.w3.org/community/">W3C Community and Business Groups</a>. </p>
   <p></p>
  </div>
  <div data-fill-with="at-risk"></div>
  <nav data-fill-with="table-of-contents" id="toc">
   <h2 class="no-num no-toc no-ref" id="contents">Table of Contents</h2>
   <ol class="toc" role="directory">
    <li>
     <a href="#intro"><span class="secno">1</span> <span class="content">Introduction</span></a>
     <ol class="toc">
      <li><a href="#goals"><span class="secno">1.1</span> <span class="content">Goals</span></a>
      <li><a href="#examples"><span class="secno">1.2</span> <span class="content">Examples</span></a>
     </ol>
    <li>
     <a href="#framework"><span class="secno">2</span> <span class="content">Framework</span></a>
     <ol class="toc">
      <li><a href="#sanitizer-api"><span class="secno">2.1</span> <span class="content">Sanitizer API {#sanitizer-api}</span></a>
      <li><a href="#inputs"><span class="secno">2.2</span> <span class="content">Input Types {#inputs}</span></a>
      <li>
       <a href="#config"><span class="secno">2.3</span> <span class="content">The Configuration Dictionary {#config}</span></a>
       <ol class="toc">
        <li><a href="#attr-match-list"><span class="secno">2.3.1</span> <span class="content">Attribute Match Lists {#attr-match-list}</span></a>
       </ol>
      <li><a href="#algorithms"><span class="secno">2.4</span> <span class="content">Algorithms {#algorithms}</span></a>
      <li><a href="#defaults"><span class="secno">2.5</span> <span class="content">Default Configuration {#defaults}</span></a>
     </ol>
    <li>
     <a href="#security-considerations"><span class="secno">3</span> <span class="content">Security Considerations {#security-considerations}</span></a>
     <ol class="toc">
      <li><a href="#server-side-xss"><span class="secno">3.1</span> <span class="content">Server-Side Reflected and Stored XSS {#server-side-xss}</span></a>
      <li><a href="#dom-clobbering"><span class="secno">3.2</span> <span class="content">DOM clobbering {#dom-clobbering}</span></a>
      <li><a href="#script-gadgets"><span class="secno">3.3</span> <span class="content">XSS with Script gadgets {#script-gadgets}</span></a>
      <li><a href="#mutated-xss"><span class="secno">3.4</span> <span class="content">Mutated XSS {#mutated-xss}</span></a>
     </ol>
    <li><a href="#ack"><span class="secno">4</span> <span class="content">Acknowledgements</span></a>
    <li>
     <a href="#index"><span class="secno"></span> <span class="content">Index</span></a>
     <ol class="toc">
      <li><a href="#index-defined-here"><span class="secno"></span> <span class="content">Terms defined by this specification</span></a>
      <li><a href="#index-defined-elsewhere"><span class="secno"></span> <span class="content">Terms defined by reference</span></a>
     </ol>
    <li>
     <a href="#references"><span class="secno"></span> <span class="content">References</span></a>
     <ol class="toc">
      <li><a href="#normative"><span class="secno"></span> <span class="content">Normative References</span></a>
      <li><a href="#informative"><span class="secno"></span> <span class="content">Informative References</span></a>
     </ol>
    <li><a href="#idl-index"><span class="secno"></span> <span class="content">IDL Index</span></a>
    <li><a href="#issues-index"><span class="secno"></span> <span class="content">Issues Index</span></a>
   </ol>
  </nav>
  <main>
   <h2 class="heading settled" data-level="1" id="intro"><span class="secno">1. </span><span class="content">Introduction</span><a class="self-link" href="#intro"></a></h2>
   <p><em>This section is not normative.</em></p>
   <p>Web applications often need to work with strings of HTML on the client side,
perhaps as part of a client-side templating solution, perhaps as part of
rendering user generated content, etc. It is difficult to do so in a safe way,
however; the naive approach of joining strings together and stuffing them into
an <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#element" id="ref-for-element">Element</a></code>'s <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/DOM-Parsing/#widl-Element-innerHTML" id="ref-for-widl-Element-innerHTML">innerHTML</a></code> is fraught with risk, as that can and
will cause JavaScript execution in a number of unexpected ways.</p>
   <p>Libraries like <a data-link-type="biblio" href="#biblio-dompurify">[DOMPURIFY]</a> attempt to manage this problem by carefully
parsing and sanitizing strings before insertion by constructing a DOM and
walking its members through an allow-list. This has proven to be a fragile
approach, as the parsing APIs exposed to the web don’t always map in
reasonable ways to the browser’s behavior when actually rendering a string as
HTML in the "real" DOM. Moreover, the libraries need to keep on top of
browsers' changing behavior over time; things that once were safe may turn
into time-bombs based on new platform-level features.</p>
   <p>The browser, on the other, has an fairly good idea of when it is going to
execute code. We can improve upon the user-space libraries by teaching the
browser how to render HTML from an arbitrary string in a safe manner, and do
so in a way that is much more likely to be maintained and updated along with
the browser’s own changing parser implementation. This document outlines an
API which aims to do just that.</p>
   <h3 class="heading settled" data-level="1.1" id="goals"><span class="secno">1.1. </span><span class="content">Goals</span><a class="self-link" href="#goals"></a></h3>
   <ul>
    <li data-md>
     <p>Mitigate the risk of DOM-based cross-site scripting attacks by providing
  developers with mechanisms for handling user-controlled HTML which prevent
  direct script execution upon injection.</p>
    <li data-md>
     <p>Make HTML output safe for use within the current user agent, taking into
  account its current understanding of HTML.</p>
    <li data-md>
     <p>Allow developers to override the defaults set of elements and attributes.
  Adding certain elements and attributes can prevent <a href="https://github.com/google/security-research-pocs/tree/master/script-gadgets">script gadget</a> attacks.</p>
   </ul>
   <h3 class="heading settled" data-level="1.2" id="examples"><span class="secno">1.2. </span><span class="content">Examples</span><a class="self-link" href="#examples"></a></h3>
<pre class="language-js highlight"><c- a>let</c-> userControlledInput <c- o>=</c-> <c- u>"&amp;lt;img src=x onerror=alert(1)//&amp;gt;"</c-><c- p>;</c->

<c- c1>// Create a DocumentFragment from unsanitized input:</c->
<c- a>let</c-> s <c- o>=</c-> <c- k>new</c-> Sanitizer<c- p>();</c->
<c- a>let</c-> sanitizedFragment <c- o>=</c-> s<c- p>.</c->sanitize<c- p>(</c->userControlledInput<c- p>);</c->

<c- c1>// Replace an element’s content from unsanitized input:</c->
element<c- p>.</c->replaceChildren<c- p>(</c->s<c- p>.</c->sanitize<c- p>(</c->userControlledInput<c- p>));</c->
</pre>
   <h2 class="heading settled" data-level="2" id="framework"><span class="secno">2. </span><span class="content">Framework</span><a class="self-link" href="#framework"></a></h2>
   <h3 class="heading settled" data-level="2.1" id="sanitizer-api"><span class="secno">2.1. </span><span class="content">Sanitizer API {#sanitizer-api}</span><a class="self-link" href="#sanitizer-api"></a></h3>
   <p>The core API is the <code>Sanitizer</code> object and the sanitize method. Sanitizers can
be instantiated using an optional <code>SanitizerConfig</code> dictionary for options.
The most common use-case - preventing XSS - is handled by the built-in default
lists, so that creating a Sanitizer with a custom config is necessary only to
handle additional, application-specific use cases.</p>
<pre class="idl highlight def">[
  <a class="idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed" id="ref-for-Exposed"><c- g>Exposed</c-></a>=(<c- n>Window</c->),
  <a class="idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#SecureContext" id="ref-for-SecureContext"><c- g>SecureContext</c-></a>
] <c- b>interface</c-> <dfn class="idl-code" data-dfn-type="interface" data-export id="sanitizer"><code><c- g>Sanitizer</c-></code><a class="self-link" href="#sanitizer"></a></dfn> {
  <dfn class="idl-code" data-dfn-for="Sanitizer" data-dfn-type="constructor" data-export data-lt="Sanitizer(config)|constructor(config)|Sanitizer()|constructor()" id="dom-sanitizer-sanitizer"><code><c- g>constructor</c-></code><a class="self-link" href="#dom-sanitizer-sanitizer"></a></dfn>(<c- b>optional</c-> <a data-link-type="idl-name" href="#dictdef-sanitizerconfig" id="ref-for-dictdef-sanitizerconfig"><c- n>SanitizerConfig</c-></a> <dfn class="idl-code" data-dfn-for="Sanitizer/Sanitizer(config), Sanitizer/constructor(config), Sanitizer/Sanitizer(), Sanitizer/constructor()" data-dfn-type="argument" data-export id="dom-sanitizer-sanitizer-config-config"><code><c- g>config</c-></code><a class="self-link" href="#dom-sanitizer-sanitizer-config-config"></a></dfn> = {});
  <a data-link-type="idl-name" href="https://dom.spec.whatwg.org/#documentfragment" id="ref-for-documentfragment"><c- n>DocumentFragment</c-></a> <dfn class="idl-code" data-dfn-for="Sanitizer" data-dfn-type="method" data-export data-lt="sanitize(input)" id="dom-sanitizer-sanitize"><code><c- g>sanitize</c-></code><a class="self-link" href="#dom-sanitizer-sanitize"></a></dfn>(<a data-link-type="idl-name" href="#typedefdef-sanitizerinput" id="ref-for-typedefdef-sanitizerinput"><c- n>SanitizerInput</c-></a> <dfn class="idl-code" data-dfn-for="Sanitizer/sanitize(input)" data-dfn-type="argument" data-export id="dom-sanitizer-sanitize-input-input"><code><c- g>input</c-></code><a class="self-link" href="#dom-sanitizer-sanitize-input-input"></a></dfn>);
  <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString" id="ref-for-idl-DOMString"><c- b>DOMString</c-></a> <dfn class="idl-code" data-dfn-for="Sanitizer" data-dfn-type="method" data-export data-lt="sanitizeToString(input)" id="dom-sanitizer-sanitizetostring"><code><c- g>sanitizeToString</c-></code><a class="self-link" href="#dom-sanitizer-sanitizetostring"></a></dfn>(<a data-link-type="idl-name" href="#typedefdef-sanitizerinput" id="ref-for-typedefdef-sanitizerinput①"><c- n>SanitizerInput</c-></a> <dfn class="idl-code" data-dfn-for="Sanitizer/sanitizeToString(input)" data-dfn-type="argument" data-export id="dom-sanitizer-sanitizetostring-input-input"><code><c- g>input</c-></code><a class="self-link" href="#dom-sanitizer-sanitizetostring-input-input"></a></dfn>);
};
</pre>
   <ul>
    <li data-md>
     <p>The constructor creates a Sanitizer instance.
It retains a copy of <var>config</var> as its <a data-link-type="dfn" href="#configuration" id="ref-for-configuration">configuration</a> object.</p>
    <li data-md>
     <p>The <code>sanitize</code> method runs the <a data-link-type="dfn" href="#sanitize" id="ref-for-sanitize">sanitize</a> algorithm on <var>input</var>,</p>
    <li data-md>
     <p>The <code>sanitizeToString</code> method runs the <a data-link-type="dfn" href="#sanitizetostring" id="ref-for-sanitizetostring">sanitizeToString</a> algorithm on <var>input</var>.</p>
   </ul>
   <p>Example:</p>
<pre class="language-js highlight">  <c- c1>// Replace an element’s content from unsanitized input:</c->
  element<c- p>.</c->replaceChildren<c- p>(</c-><c- k>new</c-> Sanitizer<c- p>().</c->sanitize<c- p>(</c->userControlledInput<c- p>));</c->
</pre>
   <h3 class="heading settled" data-level="2.2" id="inputs"><span class="secno">2.2. </span><span class="content">Input Types {#inputs}</span><a class="self-link" href="#inputs"></a></h3>
   <p>The sanitization methods support three input types: <code>DOMString</code>, <code>Document</code>,
and <code>DocumentFragment</code>. In all cases, the sanitization will work on a <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#documentfragment" id="ref-for-documentfragment①">DocumentFragment</a></code> internally, but the work-fragment will be created by
parsing, cloning, or using the fragment as-is, respectively.</p>
<pre class="idl highlight def"><c- b>typedef</c-> (<a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString" id="ref-for-idl-DOMString①"><c- b>DOMString</c-></a> <c- b>or</c-> <a data-link-type="idl-name" href="https://dom.spec.whatwg.org/#documentfragment" id="ref-for-documentfragment②"><c- n>DocumentFragment</c-></a> <c- b>or</c-> <a data-link-type="idl-name" href="https://dom.spec.whatwg.org/#interface-Document" id="ref-for-interface-Document"><c- n>Document</c-></a>) <dfn class="dfn-paneled idl-code" data-dfn-type="typedef" data-export id="typedefdef-sanitizerinput"><code><c- g>SanitizerInput</c-></code></dfn>;
</pre>
   <p class="note" role="note"><span>Note:</span> Sanitizing a string will use the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/parsing.html#html-parser" id="ref-for-html-parser">HTML Parser</a> to parse the input,
    which will perform some degree of normalization. So even
    if no sanitization steps are taken on a particular input, it cannot be
    guaranteed that the output of <code>sanitizeToString</code> will be
    character-for-character identical to the input.
    Examples would be character regularization (<code>"&amp;szlig;"</code> to <code>"ß"</code>),
    or light processing for some elements (<code>"&lt;image>"</code> to <code>"&lt;img>"</code>);</p>
   <h3 class="heading settled" data-level="2.3" id="config"><span class="secno">2.3. </span><span class="content">The Configuration Dictionary {#config}</span><a class="self-link" href="#config"></a></h3>
   <p>The <dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="configuration" data-noexport id="configuration">sanitizer’s configuration object</dfn> is a
dictionary which describes modifications to the sanitize operation.</p>
<pre class="idl highlight def"><c- b>dictionary</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="dictionary" data-export id="dictdef-sanitizerconfig"><code><c- g>SanitizerConfig</c-></code></dfn> {
  <a data-link-type="dfn" href="https://heycam.github.io/webidl/#idl-sequence" id="ref-for-idl-sequence"><c- b>sequence</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString" id="ref-for-idl-DOMString②"><c- b>DOMString</c-></a>> <dfn class="idl-code" data-dfn-for="SanitizerConfig" data-dfn-type="dict-member" data-export data-type="sequence<DOMString> " id="dom-sanitizerconfig-allowelements"><code><c- g>allowElements</c-></code><a class="self-link" href="#dom-sanitizerconfig-allowelements"></a></dfn>;
  <a data-link-type="dfn" href="https://heycam.github.io/webidl/#idl-sequence" id="ref-for-idl-sequence①"><c- b>sequence</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString" id="ref-for-idl-DOMString③"><c- b>DOMString</c-></a>> <dfn class="idl-code" data-dfn-for="SanitizerConfig" data-dfn-type="dict-member" data-export data-type="sequence<DOMString> " id="dom-sanitizerconfig-blockelements"><code><c- g>blockElements</c-></code><a class="self-link" href="#dom-sanitizerconfig-blockelements"></a></dfn>;
  <a data-link-type="dfn" href="https://heycam.github.io/webidl/#idl-sequence" id="ref-for-idl-sequence②"><c- b>sequence</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString" id="ref-for-idl-DOMString④"><c- b>DOMString</c-></a>> <dfn class="idl-code" data-dfn-for="SanitizerConfig" data-dfn-type="dict-member" data-export data-type="sequence<DOMString> " id="dom-sanitizerconfig-dropelements"><code><c- g>dropElements</c-></code><a class="self-link" href="#dom-sanitizerconfig-dropelements"></a></dfn>;
  <a data-link-type="idl-name" href="#typedefdef-attributematchlist" id="ref-for-typedefdef-attributematchlist"><c- n>AttributeMatchList</c-></a> <dfn class="idl-code" data-dfn-for="SanitizerConfig" data-dfn-type="dict-member" data-export data-type="AttributeMatchList " id="dom-sanitizerconfig-allowattributes"><code><c- g>allowAttributes</c-></code><a class="self-link" href="#dom-sanitizerconfig-allowattributes"></a></dfn>;
  <a data-link-type="idl-name" href="#typedefdef-attributematchlist" id="ref-for-typedefdef-attributematchlist①"><c- n>AttributeMatchList</c-></a> <dfn class="idl-code" data-dfn-for="SanitizerConfig" data-dfn-type="dict-member" data-export data-type="AttributeMatchList " id="dom-sanitizerconfig-dropattributes"><code><c- g>dropAttributes</c-></code><a class="self-link" href="#dom-sanitizerconfig-dropattributes"></a></dfn>;
  <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-boolean" id="ref-for-idl-boolean"><c- b>boolean</c-></a> <dfn class="idl-code" data-dfn-for="SanitizerConfig" data-dfn-type="dict-member" data-export data-type="boolean " id="dom-sanitizerconfig-allowcustomelements"><code><c- g>allowCustomElements</c-></code><a class="self-link" href="#dom-sanitizerconfig-allowcustomelements"></a></dfn>;
};
</pre>
   <dl>
    <dt data-md>allowElements
    <dd data-md>
     <p>The <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="element-allow-list">element allow list</dfn> is a sequence of strings with
  elements that the sanitizer should retain in the input.</p>
    <dt data-md>blockElements
    <dd data-md>
     <p>The <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="element-block-list">element block list</dfn> is a sequence of strings with elements
 where the sanitizer should remove the elements from the input, but retain
 their children.</p>
    <dt data-md>dropElements
    <dd data-md>
     <p>The <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="element-drop-list">element drop list</dfn> is a sequence of strings with elements
 that the sanitizer should remove from the input, including its children.</p>
    <dt data-md>allowAttributes
    <dd data-md>
     <p>The <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="attribute-allow-list">attribute allow list</dfn> is an <a data-link-type="dfn" href="#attribute-match-list" id="ref-for-attribute-match-list">attribute match list</a>, which
 determines whether an attribute (on a given element) should be allowed.</p>
    <dt data-md>dropAttributes
    <dd data-md>
     <p>The <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="attribute-drop-list">attribute drop list</dfn> is an <a data-link-type="dfn" href="#attribute-match-list" id="ref-for-attribute-match-list①">attribute match list</a>, which
 determines whether an attribute (on a given element) should be dropped.</p>
    <dt data-md>allowCustomElements
    <dd data-md>
     <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="allow-custom-elements-option">allow custom elements option</dfn> determines whether <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/custom-elements.html#custom-element" id="ref-for-custom-element">custom elements</a> are to be considered. The default is to drop them.
 If this option is true, custom elements will still be checked against all
 other built-in or configured configured checks.</p>
   </dl>
   <p class="note" role="note"><span>Note:</span> <code>allowElements</code> creates a sanitizer that defaults to dropping elements,
  while <code>blockElements</code> and <code>dropElements</code> defaults to keeping unknown
  elements. Using both types is possible, but is probably of little practical
  use. The same applies to <code>allowAttributes</code> and <code>dropAttributes</code>.</p>
   <p>Examples:</p>
<pre class="language-js highlight">  <c- a>const</c-> sample <c- o>=</c-> <c- u>"Some text &lt;b>&lt;i>with&lt;/i>&lt;/b> &lt;blink>tags&lt;/blink>."</c-><c- p>;</c->

  <c- c1>// "Some text &lt;b>with&lt;/b> text tags."</c->
  <c- k>new</c-> Sanitizer<c- p>({</c->allowElements<c- o>:</c-> <c- p>[</c-> <c- u>"b"</c-> <c- p>]).</c->sanitizeToString<c- p>(</c->sample<c- p>);</c->

  <c- c1>// "Some text &lt;i>with&lt;/i> &lt;blink>tags&lt;/blink>."</c->
  <c- k>new</c-> Sanitizer<c- p>({</c->blockElements<c- o>:</c-> <c- p>[</c-> <c- u>"b"</c-> <c- p>]).</c->sanitizeToString<c- p>(</c->sample<c- p>);</c->

  <c- c1>// "Some text &lt;blink>tags&lt;/blink>."</c->
  <c- k>new</c-> Sanitizer<c- p>({</c->dropElements<c- o>:</c-> <c- p>[</c-> <c- u>"b"</c-> <c- p>]).</c->sanitizeToString<c- p>(</c->sample<c- p>);</c->

  <c- c1>// Note: The default configuration handles XSS-relevant input:</c->

  <c- c1>// Non-scripting input will be passed through:</c->
  <c- k>new</c-> Sanitizer<c- p>().</c->sanitizeToString<c- p>(</c->sample<c- p>);</c->  <c- c1>// Will output sample unmodified.</c->

  <c- c1>// Scripts will be blocked: "abc alert(1) def"</c->
  <c- k>new</c-> Sanitizer<c- p>().</c->sanitizeToString<c- p>(</c-><c- u>"abc &lt;script>alert(1)&lt;/script> def"</c-><c- p>);</c->
</pre>
   <h4 class="heading settled" data-level="2.3.1" id="attr-match-list"><span class="secno">2.3.1. </span><span class="content">Attribute Match Lists {#attr-match-list}</span><a class="self-link" href="#attr-match-list"></a></h4>
   <p>An <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="attribute-match-list">attribute match list</dfn> is a map of attribute names to element names,
where the special name "*" stands for all elements. A given <var>attribute</var> belonging to an <var>element</var> matches an <a data-link-type="dfn" href="#attribute-match-list" id="ref-for-attribute-match-list②">attribute match list</a>, if the
attribute’s local name is a key in the match list, and element’s local name
or <code>"*"</code> are found in the attribute’s value list.</p>
<pre class="idl highlight def"><c- b>typedef</c-> <a data-link-type="dfn" href="https://heycam.github.io/webidl/#idl-record" id="ref-for-idl-record"><c- b>record</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString" id="ref-for-idl-DOMString⑤"><c- b>DOMString</c-></a>, <a data-link-type="dfn" href="https://heycam.github.io/webidl/#idl-sequence" id="ref-for-idl-sequence③"><c- b>sequence</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString" id="ref-for-idl-DOMString⑥"><c- b>DOMString</c-></a>>> <dfn class="dfn-paneled idl-code" data-dfn-type="typedef" data-export id="typedefdef-attributematchlist"><code><c- g>AttributeMatchList</c-></code></dfn>;
</pre>
   <p>Examples for attributes and attribute match lists:</p>
<pre class="language-js highlight">  <c- a>const</c-> sample <c- o>=</c-> <c- u>"&lt;span id='span1' class='theclass' style='font-weight: bold'>hello&lt;/span>"</c-><c- p>;</c->

  <c- c1>// Allow only &lt;span style>: "&lt;span style='font-weight: bold'>...&lt;/span>"</c->
  <c- k>new</c-> Sanitizer<c- p>({</c->allowAttributes<c- o>:</c-> <c- p>{</c-><c- u>"style"</c-><c- o>:</c-> <c- p>[</c-><c- u>"span"</c-><c- p>]}}).</c->sanitizeToString<c- p>(</c->sample<c- p>);</c->

  <c- c1>// Allow style, but not on span: "&lt;span>...&lt;/span>"</c->
  <c- k>new</c-> Sanitizer<c- p>({</c->allowAttributes<c- o>:</c-> <c- p>{</c-><c- u>"style"</c-><c- o>:</c-> <c- p>[</c-><c- u>"div"</c-><c- p>]}}).</c->sanitizeToString<c- p>(</c->sample<c- p>);</c->

  <c- c1>// Allow style on any elements: "&lt;span style='font-weight: bold'>...&lt;/span>"</c->
  <c- k>new</c-> Sanitizer<c- p>({</c->allowAttributes<c- o>:</c-> <c- p>{</c-><c- u>"style"</c-><c- o>:</c-> <c- p>[</c-><c- u>"*"</c-><c- p>]}}).</c->sanitizeToString<c- p>(</c->sample<c- p>);</c->

  <c- c1>// Block &lt;span id>: "&lt;span class='theclass' style='font-weight: bold'>...&lt;/span>";</c->
  <c- k>new</c-> Sanitizer<c- p>({</c->blockAttributes<c- o>:</c-> <c- p>{</c-><c- u>"id"</c-><c- o>:</c-> <c- p>[</c-><c- u>"span"</c-><c- p>]}}).</c->sanitizeToString<c- p>(</c->sample<c- p>);</c->

  <c- c1>// Block id, everywhere: "&lt;span class='theclass' style='font-weight: bold'>...&lt;/span>";</c->
  <c- k>new</c-> Sanitizer<c- p>({</c->blockAttributes<c- o>:</c-> <c- p>{</c-><c- u>"id"</c-><c- o>:</c-> <c- p>[</c-><c- u>"*"</c-><c- p>]}}).</c->sanitizeToString<c- p>(</c->sample<c- p>);</c->
</pre>
   <h3 class="heading settled" data-level="2.4" id="algorithms"><span class="secno">2.4. </span><span class="content">Algorithms {#algorithms}</span><a class="self-link" href="#algorithms"></a></h3>
   <p>To <dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="sanitize document fragment" data-noexport id="sanitize-document-fragment">sanitize a document fragment</dfn> named <var>fragment</var> using <var>sanitizer</var> run these steps:</p>
   <ol>
    <li data-md>
     <p>let <var>m</var> be a map that maps nodes to {'keep', 'block', 'drop'}.</p>
    <li data-md>
     <p>let <var>nodes</var> be a list containing the <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-tree-inclusive-descendant" id="ref-for-concept-tree-inclusive-descendant">inclusive descendants</a> of <var>fragment</var>, in <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-tree-order" id="ref-for-concept-tree-order">tree order</a>.</p>
    <li data-md>
     <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-iterate" id="ref-for-list-iterate">for each</a> <var>node</var> in <var>nodes</var>:</p>
     <ol>
      <li data-md>
       <p>call <a data-link-type="dfn" href="#sanitize-a-node" id="ref-for-sanitize-a-node">sanitize a node</a> and insert <var>node</var> and the result value into <var>m</var></p>
     </ol>
    <li data-md>
     <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-iterate" id="ref-for-list-iterate①">for each</a> <var>node</var> in <var>nodes</var>:</p>
     <ol>
      <li data-md>
       <p>if m[node] is 'drop', remove the <var>node</var> and all children from <var>fragment</var>.</p>
      <li data-md>
       <p>if m[node] is 'block', replace the <var>node</var> with all of its element and text node children from <var>fragment</var>.</p>
      <li data-md>
       <p>if m[node] is undefined or 'keep', do nothing.</p>
     </ol>
   </ol>
   <p>To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="sanitize-a-node">sanitize a node</dfn> named <var>node</var> run these steps:</p>
   <ol>
    <li data-md>
     <p>if <var>node</var> is an element node, call <a data-link-type="dfn" href="#sanitize-an-element" id="ref-for-sanitize-an-element">sanitize an element</a> and return its result.</p>
    <li data-md>
     <p>return 'keep'</p>
   </ol>
   <p>To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="sanitize-an-element">sanitize an element</dfn> named <var>element</var>, run these steps:</p>
   <ol>
    <li data-md>
     <p>let <var>config</var> be the <var>sanitizer</var>’s <a data-link-type="dfn" href="#configuration" id="ref-for-configuration①">configuration</a> dictionary.</p>
    <li data-md>
     <p>let <var>name</var> be <var>element</var>’s tag name.</p>
    <li data-md>
     <p>if <var>name</var> is a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/custom-elements.html#valid-custom-element-name" id="ref-for-valid-custom-element-name">valid custom element name</a> and if <var>config</var>’s <a data-link-type="dfn" href="#allow-custom-elements-option" id="ref-for-allow-custom-elements-option">allow custom elements option</a> is unset or set to anything other than <code>true</code>, return 'drop'.</p>
    <li data-md>
     <p>if <var>name</var> is contained in the built-in <a data-link-type="dfn" href="#default-element-drop-list" id="ref-for-default-element-drop-list">default element drop list</a> return 'drop'.</p>
    <li data-md>
     <p>if <var>name</var> is in <var>config</var>’s <a data-link-type="dfn" href="#element-drop-list" id="ref-for-element-drop-list">element drop list</a> return 'drop'.</p>
    <li data-md>
     <p>if <var>name</var> is contained in the built-in <a data-link-type="dfn" href="#default-element-block-list" id="ref-for-default-element-block-list">default element block list</a> return 'block'.</p>
    <li data-md>
     <p>if <var>name</var> is in <var>config</var>’s <a data-link-type="dfn" href="#element-block-list" id="ref-for-element-block-list">element block list</a> return 'block'.</p>
    <li data-md>
     <p>if <var>config</var> has a non-empty <a data-link-type="dfn" href="#element-allow-list" id="ref-for-element-allow-list">element allow list</a> and <var>name</var> is not in <var>config</var>’s <a data-link-type="dfn" href="#element-allow-list" id="ref-for-element-allow-list①">element allow list</a> return 'block'</p>
    <li data-md>
     <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-iterate" id="ref-for-list-iterate②">for each</a> <var>attr</var> in <var>element</var>’s <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-element-attribute" id="ref-for-concept-element-attribute">attribute list</a>:</p>
     <ol>
      <li data-md>
       <p>call <a data-link-type="dfn" href="#sanitize-an-attribute" id="ref-for-sanitize-an-attribute">sanitize an attribute</a> with <var>attr</var>’s name and <var>element</var>’s local name.</p>
      <li data-md>
       <p>if the result is different from 'keep', remove <var>attr</var> from <var>element</var>.</p>
     </ol>
    <li data-md>
     <p>return 'keep'</p>
   </ol>
   <p class="issue" id="issue-1cf1de87"><a class="self-link" href="#issue-1cf1de87"></a> This presently ignores all namespace info, making it impossible to
    support different actions for like-named elements from different
    namespaces.</p>
   <p>To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="sanitize-an-attribute">sanitize an attribute</dfn> named <var>attr</var> belonging to <var>element</var>, run these steps:</p>
   <ol>
    <li data-md>
     <p>let <var>config</var> be the <var>sanitizer</var>’s <a data-link-type="dfn" href="#configuration" id="ref-for-configuration②">configuration</a> dictionary.</p>
    <li data-md>
     <p>if <var>attr</var> and <var>element</var> <a data-link-type="dfn" href="#attribute-match" id="ref-for-attribute-match">attribute-match</a> the built-in <a data-link-type="dfn" href="#default-attribute-drop-list" id="ref-for-default-attribute-drop-list">default attribute drop list</a> return 'drop'.</p>
    <li data-md>
     <p>if <var>attr</var> and <var>element</var> <a data-link-type="dfn" href="#attribute-match" id="ref-for-attribute-match①">attribute-match</a> the <var>config</var>’s <a data-link-type="dfn" href="#attribute-drop-list" id="ref-for-attribute-drop-list">attribute drop list</a> return 'drop'.</p>
    <li data-md>
     <p>if <var>config</var> has a non-empty <a data-link-type="dfn" href="#attribute-allow-list" id="ref-for-attribute-allow-list">attribute allow list</a> and <var>attr</var> and <var>element</var> do not <a data-link-type="dfn" href="#attribute-match" id="ref-for-attribute-match②">attribute-match</a> the <var>config</var>’s <a data-link-type="dfn" href="#attribute-allow-list" id="ref-for-attribute-allow-list①">attribute allow list</a> return 'drop'.</p>
    <li data-md>
     <p>return 'keep'.</p>
   </ol>
   <p>To determine whether an <var>attribute</var> and <var>element</var> <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="attribute-match">attribute-match</dfn> an <a data-link-type="dfn" href="#attribute-match-list" id="ref-for-attribute-match-list③">attribute match list</a> <var>list</var>, run these steps:</p>
   <ol>
    <li data-md>
     <p>let <var>attr-name</var> be <var>attribute</var>’s local name.</p>
    <li data-md>
     <p>let <var>elem-name</var> be <var>element</var>’s local name.</p>
    <li data-md>
     <p>if <var>list</var> does not contain a key <var>attr-name</var>, return false.</p>
    <li data-md>
     <p>let <var>matches</var> be the value of <var>list</var>[<var>attr-name</var>].</p>
    <li data-md>
     <p>if <var>matches</var> contains the string <var>elem-name</var>, return true.</p>
    <li data-md>
     <p>if <var>matches</var> contains the string "*", return true.</p>
    <li data-md>
     <p>return false.</p>
   </ol>
   <p>To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="create-a-document-fragment">create a document fragment</dfn> named <var>fragment</var> from a Sanitizer <var>input</var>, run these steps:</p>
   <ol>
    <li data-md>
     <p>Switch based on <var>input</var>’s type:</p>
     <ol>
      <li data-md>
       <p>if <var>input</var> is of type <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#documentfragment" id="ref-for-documentfragment③">DocumentFragment</a></code>, then:</p>
       <ol>
        <li data-md>
         <p>let <var>node</var> refer to <var>input</var>.</p>
       </ol>
      <li data-md>
       <p>if <var>input</var> is of type <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#interface-Document" id="ref-for-interface-Document①">Document</a></code>, then:</p>
       <ol>
        <li data-md>
         <p>let <var>node</var> refer to <var>input</var>’s <code>documentElement</code>.</p>
       </ol>
      <li data-md>
       <p>if <var>input</var> is of type <code>DOMString</code>, then:</p>
       <ol>
        <li data-md>
         <p>let <var>node</var> be the result of the <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/DOM-Parsing/#widl-DOMParser-parseFromString-Document-DOMString-str-SupportedType-type" id="ref-for-widl-DOMParser-parseFromString-Document-DOMString-str-SupportedType-type">parseFromString</a></code> algorithm
  with <var>input</var> as first parameter (<code>string</code>),
  and <code>"text/html"</code> as second parameter (<code>type</code>).</p>
       </ol>
     </ol>
    <li data-md>
     <p>Let <var>clone</var> be the result of running <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-node-clone" id="ref-for-concept-node-clone">clone a node</a> on <var>node</var> with the <code>clone children flag</code> set to <code>true</code>.</p>
    <li data-md>
     <p>Let <code>f</code> be the result of <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#dom-document-createdocumentfragment" id="ref-for-dom-document-createdocumentfragment">createDocumentFragment</a></code>.</p>
    <li data-md>
     <p><a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-node-append" id="ref-for-concept-node-append">Append</a> the node <var>clone</var> to the parent <var>f</var>.</p>
    <li data-md>
     <p>Return <var>f</var>.</p>
   </ol>
   <p class="issue" id="issue-8301a077"><a class="self-link" href="#issue-8301a077"></a> It’s unclear whether we can assume a generic
  context for <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/DOM-Parsing/#widl-DOMParser-parseFromString-Document-DOMString-str-SupportedType-type" id="ref-for-widl-DOMParser-parseFromString-Document-DOMString-str-SupportedType-type①">parseFromString</a></code>, or if we need to re-work the API to take
  the insertion context of the created fragment into account. <a href="https://github.com/WICG/sanitizer-api/issues/42">&lt;https://github.com/WICG/sanitizer-api/issues/42></a></p>
   <p>To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="sanitize">sanitize</dfn> a given <var>input</var>, run these steps:</p>
   <ol>
    <li data-md>
     <p>run <a data-link-type="dfn" href="#create-a-document-fragment" id="ref-for-create-a-document-fragment">create a document fragment</a> algorithm on the <var>input</var>.</p>
    <li data-md>
     <p>run the <a data-link-type="dfn" href="#sanitize-document-fragment" id="ref-for-sanitize-document-fragment">sanitize document fragment</a> algorithm on the resulting fragment,</p>
    <li data-md>
     <p>and return its result.</p>
   </ol>
   <p>To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="sanitizetostring">sanitizeToString</dfn> a given <var>input</var>, run these steps:</p>
   <ol>
    <li data-md>
     <p>run <a data-link-type="dfn" href="#create-a-document-fragment" id="ref-for-create-a-document-fragment①">create a document fragment</a> algorithm on the <var>input</var>.</p>
    <li data-md>
     <p>run the <a data-link-type="dfn" href="#sanitize" id="ref-for-sanitize①">sanitize</a> algorithm on the resulting fragment,</p>
    <li data-md>
     <p>run the steps of the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/parsing.html#html-fragment-serialisation-algorithm" id="ref-for-html-fragment-serialisation-algorithm">HTML Fragment Serialization Algorithm</a> with
   the fragment root of step 1 as the <var>node</var>, and return the result string.</p>
   </ol>
   <h3 class="heading settled" data-level="2.5" id="defaults"><span class="secno">2.5. </span><span class="content">Default Configuration {#defaults}</span><a class="self-link" href="#defaults"></a></h3>
   <p class="issue" id="issue-af977c5a"><a class="self-link" href="#issue-af977c5a"></a> The sanitizer defaults need to be carefully vetted, and are still
    under discussion. The values below are for illustrative purposes only.</p>
   <p>The sanitizer has a built-in default configuration, which aims to eliminate
any script-injection possibility. Note that the <a data-link-type="dfn" href="#sanitize-document-fragment" id="ref-for-sanitize-document-fragment①">sanitize document fragment</a> algorithm
is defined so that these defaults are handled first and cannot be overridden
by a custom configuration.</p>
   <dl>
    <dt data-md>Default Drop Elements
    <dd data-md>
     <p>The <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="default-element-drop-list">default element drop list</dfn> has the following value:</p>
<pre> [ "script", "this is just a placeholder" ]
</pre>
    <dt data-md>Default Block Elements
    <dd data-md>
     <p>The <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="default-element-block-list">default element block list</dfn> has the following value:<br></p>
<pre>[ "noscript", "this is just a placeholder" ]
</pre>
    <dt data-md>Default Drop Attributes
    <dd data-md>
     <p>The <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="default-attribute-drop-list">default attribute drop list</dfn> has the following value:</p>
<pre>{}
</pre>
   </dl>
   <h2 class="heading settled" data-level="3" id="security-considerations"><span class="secno">3. </span><span class="content">Security Considerations {#security-considerations}</span><a class="self-link" href="#security-considerations"></a></h2>
   <p>The Sanitizer API is intended to prevent DOM-Based Cross-Site Scripting
by traversing a supplied HTML content and removing elements and attributes
according to a configuration. The specified API must not support
the construction of a Sanitizer object that leaves script-capable markup in
and doing so would be a bug in the threat model.</p>
   <p>That being said, there are security issues which the correct usage of the
Sanitizer API will not be able to protect against and the scenarios will be
laid out in the following sections.</p>
   <h3 class="heading settled" data-level="3.1" id="server-side-xss"><span class="secno">3.1. </span><span class="content">Server-Side Reflected and Stored XSS {#server-side-xss}</span><a class="self-link" href="#server-side-xss"></a></h3>
   <p><em>This section is not normative.</em></p>
   <p>The Sanitizer API operates solely in the DOM and adds a capability to traverse
and filter an existing DocumentFragment. The Sanitizer does not address
server-side reflected or stored XSS.</p>
   <h3 class="heading settled" data-level="3.2" id="dom-clobbering"><span class="secno">3.2. </span><span class="content">DOM clobbering {#dom-clobbering}</span><a class="self-link" href="#dom-clobbering"></a></h3>
   <p><em>This section is not normative.</em></p>
   <p>DOM clobbering describes an attack in which malicious HTML confuses an
application by naming elements through <code>id</code> or <code>name</code> attributes such that
properties like <code>children</code> of an HTML element in the DOM are overshadowed by
the malicious content.</p>
   <p>The Sanitizer API does not protect DOM clobbering attacks in its
default state, but can be configured to remove <code>id</code> and <code>name</code> attributes.</p>
   <h3 class="heading settled" data-level="3.3" id="script-gadgets"><span class="secno">3.3. </span><span class="content">XSS with Script gadgets {#script-gadgets}</span><a class="self-link" href="#script-gadgets"></a></h3>
   <p><em>This section is not normative.</em></p>
   <p>Script gadgets is a technique in which an attacker uses existing application
code from popular JavaScript libraries to cause their own code to execute.
This is often done by injecting innocent-looking code or seemingly inert
DOM nodes that is only parsed and interpreted by a framework which then
performs the execution of JavaScript based on that input.</p>
   <p>The Sanitizer API can not prevent these attacks, but requires page authors to
explicitly allow attributes and elements that are unknown to HTML and markup
that is known to be widely used for templating and framework-specific code,
like <code>data-</code> and <code>slot</code> attributes and elements like <code>&lt;slot></code> and <code>&lt;template></code>.
We believe that these restrictions are not exhaustive and encourage page
authors to examine their third party libraries for this behavior.</p>
   <h3 class="heading settled" data-level="3.4" id="mutated-xss"><span class="secno">3.4. </span><span class="content">Mutated XSS {#mutated-xss}</span><a class="self-link" href="#mutated-xss"></a></h3>
   <p><em>This section is not normative.</em></p>
   <p>Mutated XSS or mXSS describes an attack based on parser mismatches when parsing
an HTML snippet without the correct context. In particular, when a parsed HTML
fragment has been serialized to a string, the format is not guaranteed to be
parsed and interpreted exactly the same when inserted into a different parent
element. An example for carrying out such an attack is by relying on the
change of parsing behavior for foreign content or misnested tags.</p>
   <p>The Sanitizer API does not protect against mutated XSS, however we encourage
authors to use the <code>sanitize()</code> function of the API which returns a
DocumentFragment and avoids risks that come with serialization and additional
parsing. Directly operating on a fragment after sanitization also comes with a
performance benefit, as the cost of additional serialization and parsing is
avoided.</p>
   <h2 class="heading settled" data-level="4" id="ack"><span class="secno">4. </span><span class="content">Acknowledgements</span><a class="self-link" href="#ack"></a></h2>
   <p>Cure53’s <a data-link-type="biblio" href="#biblio-dompurify">[DOMPURIFY]</a> is a clear inspiration for the API this document
describes, as is Internet Explorer’s <code class="idl"><a data-link-type="idl" href="#https://msdn.microsoft.com/en-us/library/cc848922(v=vs.85).aspx" id="ref-for-https://msdn.microsoft.com/en-us/library/cc848922(v=vs.85).aspx">window.toStaticHTML()</a></code>.</p>
  </main>
<script src="https://www.w3.org/scripts/TR/2016/fixup.js"></script>
  <h2 class="no-num no-ref heading settled" id="index"><span class="content">Index</span><a class="self-link" href="#index"></a></h2>
  <h3 class="no-num no-ref heading settled" id="index-defined-here"><span class="content">Terms defined by this specification</span><a class="self-link" href="#index-defined-here"></a></h3>
  <ul class="index">
   <li><a href="#dom-sanitizerconfig-allowattributes">allowAttributes</a><span>, in §2.3</span>
   <li><a href="#dom-sanitizerconfig-allowcustomelements">allowCustomElements</a><span>, in §2.3</span>
   <li><a href="#allow-custom-elements-option">allow custom elements option</a><span>, in §2.3</span>
   <li><a href="#dom-sanitizerconfig-allowelements">allowElements</a><span>, in §2.3</span>
   <li><a href="#attribute-allow-list">attribute allow list</a><span>, in §2.3</span>
   <li><a href="#attribute-drop-list">attribute drop list</a><span>, in §2.3</span>
   <li><a href="#attribute-match">attribute-match</a><span>, in §2.4</span>
   <li><a href="#attribute-match-list">attribute match list</a><span>, in §2.3.1</span>
   <li><a href="#typedefdef-attributematchlist">AttributeMatchList</a><span>, in §2.3.1</span>
   <li><a href="#dom-sanitizerconfig-blockelements">blockElements</a><span>, in §2.3</span>
   <li><a href="#configuration">configuration</a><span>, in §2.3</span>
   <li><a href="#dom-sanitizer-sanitizer">constructor()</a><span>, in §2.1</span>
   <li><a href="#dom-sanitizer-sanitizer">constructor(config)</a><span>, in §2.1</span>
   <li><a href="#create-a-document-fragment">create a document fragment</a><span>, in §2.4</span>
   <li><a href="#default-attribute-drop-list">default attribute drop list</a><span>, in §2.5</span>
   <li><a href="#default-element-block-list">default element block list</a><span>, in §2.5</span>
   <li><a href="#default-element-drop-list">default element drop list</a><span>, in §2.5</span>
   <li><a href="#dom-sanitizerconfig-dropattributes">dropAttributes</a><span>, in §2.3</span>
   <li><a href="#dom-sanitizerconfig-dropelements">dropElements</a><span>, in §2.3</span>
   <li><a href="#element-allow-list">element allow list</a><span>, in §2.3</span>
   <li><a href="#element-block-list">element block list</a><span>, in §2.3</span>
   <li><a href="#element-drop-list">element drop list</a><span>, in §2.3</span>
   <li><a href="#sanitize">sanitize</a><span>, in §2.4</span>
   <li><a href="#sanitize-an-attribute">sanitize an attribute</a><span>, in §2.4</span>
   <li><a href="#sanitize-an-element">sanitize an element</a><span>, in §2.4</span>
   <li><a href="#sanitize-a-node">sanitize a node</a><span>, in §2.4</span>
   <li><a href="#sanitize-document-fragment">sanitize document fragment</a><span>, in §2.4</span>
   <li><a href="#dom-sanitizer-sanitize">sanitize(input)</a><span>, in §2.1</span>
   <li><a href="#sanitizer">Sanitizer</a><span>, in §2.1</span>
   <li><a href="#dom-sanitizer-sanitizer">Sanitizer()</a><span>, in §2.1</span>
   <li><a href="#dom-sanitizer-sanitizer">Sanitizer(config)</a><span>, in §2.1</span>
   <li><a href="#dictdef-sanitizerconfig">SanitizerConfig</a><span>, in §2.3</span>
   <li><a href="#typedefdef-sanitizerinput">SanitizerInput</a><span>, in §2.2</span>
   <li><a href="#sanitizetostring">sanitizeToString</a><span>, in §2.4</span>
   <li><a href="#dom-sanitizer-sanitizetostring">sanitizeToString(input)</a><span>, in §2.1</span>
  </ul>
  <aside class="dfn-panel" data-for="term-for-element">
   <a href="https://dom.spec.whatwg.org/#element">https://dom.spec.whatwg.org/#element</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-element">1. Introduction</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-node-append">
   <a href="https://dom.spec.whatwg.org/#concept-node-append">https://dom.spec.whatwg.org/#concept-node-append</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-node-append">2.4. Algorithms {#algorithms}</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-element-attribute">
   <a href="https://dom.spec.whatwg.org/#concept-element-attribute">https://dom.spec.whatwg.org/#concept-element-attribute</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-element-attribute">2.4. Algorithms {#algorithms}</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-node-clone">
   <a href="https://dom.spec.whatwg.org/#concept-node-clone">https://dom.spec.whatwg.org/#concept-node-clone</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-node-clone">2.4. Algorithms {#algorithms}</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-tree-inclusive-descendant">
   <a href="https://dom.spec.whatwg.org/#concept-tree-inclusive-descendant">https://dom.spec.whatwg.org/#concept-tree-inclusive-descendant</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-tree-inclusive-descendant">2.4. Algorithms {#algorithms}</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-tree-order">
   <a href="https://dom.spec.whatwg.org/#concept-tree-order">https://dom.spec.whatwg.org/#concept-tree-order</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-tree-order">2.4. Algorithms {#algorithms}</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-widl-Element-innerHTML">
   <a href="https://w3c.github.io/DOM-Parsing/#widl-Element-innerHTML">https://w3c.github.io/DOM-Parsing/#widl-Element-innerHTML</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-widl-Element-innerHTML">1. Introduction</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-widl-DOMParser-parseFromString-Document-DOMString-str-SupportedType-type">
   <a href="https://w3c.github.io/DOM-Parsing/#widl-DOMParser-parseFromString-Document-DOMString-str-SupportedType-type">https://w3c.github.io/DOM-Parsing/#widl-DOMParser-parseFromString-Document-DOMString-str-SupportedType-type</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-widl-DOMParser-parseFromString-Document-DOMString-str-SupportedType-type">2.4. Algorithms {#algorithms}</a> <a href="#ref-for-widl-DOMParser-parseFromString-Document-DOMString-str-SupportedType-type①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-custom-element">
   <a href="https://html.spec.whatwg.org/multipage/custom-elements.html#custom-element">https://html.spec.whatwg.org/multipage/custom-elements.html#custom-element</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-custom-element">2.3. The Configuration Dictionary {#config}</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-html-fragment-serialisation-algorithm">
   <a href="https://html.spec.whatwg.org/multipage/parsing.html#html-fragment-serialisation-algorithm">https://html.spec.whatwg.org/multipage/parsing.html#html-fragment-serialisation-algorithm</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-html-fragment-serialisation-algorithm">2.4. Algorithms {#algorithms}</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-html-parser">
   <a href="https://html.spec.whatwg.org/multipage/parsing.html#html-parser">https://html.spec.whatwg.org/multipage/parsing.html#html-parser</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-html-parser">2.2. Input Types {#inputs}</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-valid-custom-element-name">
   <a href="https://html.spec.whatwg.org/multipage/custom-elements.html#valid-custom-element-name">https://html.spec.whatwg.org/multipage/custom-elements.html#valid-custom-element-name</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-valid-custom-element-name">2.4. Algorithms {#algorithms}</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-list-iterate">
   <a href="https://infra.spec.whatwg.org/#list-iterate">https://infra.spec.whatwg.org/#list-iterate</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-list-iterate">2.4. Algorithms {#algorithms}</a> <a href="#ref-for-list-iterate①">(2)</a> <a href="#ref-for-list-iterate②">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-idl-DOMString">
   <a href="https://heycam.github.io/webidl/#idl-DOMString">https://heycam.github.io/webidl/#idl-DOMString</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-idl-DOMString">2.1. Sanitizer API {#sanitizer-api}</a>
    <li><a href="#ref-for-idl-DOMString①">2.2. Input Types {#inputs}</a>
    <li><a href="#ref-for-idl-DOMString②">2.3. The Configuration Dictionary {#config}</a> <a href="#ref-for-idl-DOMString③">(2)</a> <a href="#ref-for-idl-DOMString④">(3)</a>
    <li><a href="#ref-for-idl-DOMString⑤">2.3.1. Attribute Match Lists {#attr-match-list}</a> <a href="#ref-for-idl-DOMString⑥">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-Exposed">
   <a href="https://heycam.github.io/webidl/#Exposed">https://heycam.github.io/webidl/#Exposed</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-Exposed">2.1. Sanitizer API {#sanitizer-api}</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-SecureContext">
   <a href="https://heycam.github.io/webidl/#SecureContext">https://heycam.github.io/webidl/#SecureContext</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-SecureContext">2.1. Sanitizer API {#sanitizer-api}</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-idl-boolean">
   <a href="https://heycam.github.io/webidl/#idl-boolean">https://heycam.github.io/webidl/#idl-boolean</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-idl-boolean">2.3. The Configuration Dictionary {#config}</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-idl-record">
   <a href="https://heycam.github.io/webidl/#idl-record">https://heycam.github.io/webidl/#idl-record</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-idl-record">2.3.1. Attribute Match Lists {#attr-match-list}</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-idl-sequence">
   <a href="https://heycam.github.io/webidl/#idl-sequence">https://heycam.github.io/webidl/#idl-sequence</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-idl-sequence">2.3. The Configuration Dictionary {#config}</a> <a href="#ref-for-idl-sequence①">(2)</a> <a href="#ref-for-idl-sequence②">(3)</a>
    <li><a href="#ref-for-idl-sequence③">2.3.1. Attribute Match Lists {#attr-match-list}</a>
   </ul>
  </aside>
  <h3 class="no-num no-ref heading settled" id="index-defined-elsewhere"><span class="content">Terms defined by reference</span><a class="self-link" href="#index-defined-elsewhere"></a></h3>
  <ul class="index">
   <li>
    <a data-link-type="biblio">[DOM]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-element">Element</span>
     <li><span class="dfn-paneled" id="term-for-concept-node-append">append</span>
     <li><span class="dfn-paneled" id="term-for-concept-element-attribute">attribute list</span>
     <li><span class="dfn-paneled" id="term-for-concept-node-clone">clone a node</span>
     <li><span class="dfn-paneled" id="term-for-concept-tree-inclusive-descendant">inclusive descendant</span>
     <li><span class="dfn-paneled" id="term-for-concept-tree-order">tree order</span>
    </ul>
   <li>
    <a data-link-type="biblio">[DOM-Parsing]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-widl-Element-innerHTML">innerHTML</span>
     <li><span class="dfn-paneled" id="term-for-widl-DOMParser-parseFromString-Document-DOMString-str-SupportedType-type">parseFromString</span>
    </ul>
   <li>
    <a data-link-type="biblio">[HTML]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-custom-element">custom element</span>
     <li><span class="dfn-paneled" id="term-for-html-fragment-serialisation-algorithm">html fragment serialization algorithm</span>
     <li><span class="dfn-paneled" id="term-for-html-parser">html parser</span>
     <li><span class="dfn-paneled" id="term-for-valid-custom-element-name">valid custom element name</span>
    </ul>
   <li>
    <a data-link-type="biblio">[INFRA]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-list-iterate">iterate</span>
    </ul>
   <li>
    <a data-link-type="biblio">[WebIDL]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-idl-DOMString">DOMString</span>
     <li><span class="dfn-paneled" id="term-for-Exposed">Exposed</span>
     <li><span class="dfn-paneled" id="term-for-SecureContext">SecureContext</span>
     <li><span class="dfn-paneled" id="term-for-idl-boolean">boolean</span>
     <li><span class="dfn-paneled" id="term-for-idl-record">record</span>
     <li><span class="dfn-paneled" id="term-for-idl-sequence">sequence</span>
    </ul>
  </ul>
  <h2 class="no-num no-ref heading settled" id="references"><span class="content">References</span><a class="self-link" href="#references"></a></h2>
  <h3 class="no-num no-ref heading settled" id="normative"><span class="content">Normative References</span><a class="self-link" href="#normative"></a></h3>
  <dl>
   <dt id="biblio-dom">[DOM]
   <dd>Anne van Kesteren. <a href="https://dom.spec.whatwg.org/">DOM Standard</a>. Living Standard. URL: <a href="https://dom.spec.whatwg.org/">https://dom.spec.whatwg.org/</a>
   <dt id="biblio-dom-parsing">[DOM-Parsing]
   <dd>Travis Leithead. <a href="https://www.w3.org/TR/DOM-Parsing/">DOM Parsing and Serialization</a>. 17 May 2016. WD. URL: <a href="https://www.w3.org/TR/DOM-Parsing/">https://www.w3.org/TR/DOM-Parsing/</a>
   <dt id="biblio-html">[HTML]
   <dd>Anne van Kesteren; et al. <a href="https://html.spec.whatwg.org/multipage/">HTML Standard</a>. Living Standard. URL: <a href="https://html.spec.whatwg.org/multipage/">https://html.spec.whatwg.org/multipage/</a>
   <dt id="biblio-infra">[INFRA]
   <dd>Anne van Kesteren; Domenic Denicola. <a href="https://infra.spec.whatwg.org/">Infra Standard</a>. Living Standard. URL: <a href="https://infra.spec.whatwg.org/">https://infra.spec.whatwg.org/</a>
   <dt id="biblio-webidl">[WebIDL]
   <dd>Boris Zbarsky. <a href="https://heycam.github.io/webidl/">Web IDL</a>. 15 December 2016. ED. URL: <a href="https://heycam.github.io/webidl/">https://heycam.github.io/webidl/</a>
  </dl>
  <h3 class="no-num no-ref heading settled" id="informative"><span class="content">Informative References</span><a class="self-link" href="#informative"></a></h3>
  <dl>
   <dt id="biblio-dompurify">[DOMPURIFY]
   <dd><a href="https://github.com/cure53/DOMPurify">DOMPurify</a>. URL: <a href="https://github.com/cure53/DOMPurify">https://github.com/cure53/DOMPurify</a>
  </dl>
  <h2 class="no-num no-ref heading settled" id="idl-index"><span class="content">IDL Index</span><a class="self-link" href="#idl-index"></a></h2>
<pre class="idl highlight def">[
  <a class="idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed"><c- g>Exposed</c-></a>=(<c- n>Window</c->),
  <a class="idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#SecureContext"><c- g>SecureContext</c-></a>
] <c- b>interface</c-> <a href="#sanitizer"><code><c- g>Sanitizer</c-></code></a> {
  <a href="#dom-sanitizer-sanitizer"><code><c- g>constructor</c-></code></a>(<c- b>optional</c-> <a data-link-type="idl-name" href="#dictdef-sanitizerconfig"><c- n>SanitizerConfig</c-></a> <a href="#dom-sanitizer-sanitizer-config-config"><code><c- g>config</c-></code></a> = {});
  <a data-link-type="idl-name" href="https://dom.spec.whatwg.org/#documentfragment"><c- n>DocumentFragment</c-></a> <a href="#dom-sanitizer-sanitize"><code><c- g>sanitize</c-></code></a>(<a data-link-type="idl-name" href="#typedefdef-sanitizerinput"><c- n>SanitizerInput</c-></a> <a href="#dom-sanitizer-sanitize-input-input"><code><c- g>input</c-></code></a>);
  <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString"><c- b>DOMString</c-></a> <a href="#dom-sanitizer-sanitizetostring"><code><c- g>sanitizeToString</c-></code></a>(<a data-link-type="idl-name" href="#typedefdef-sanitizerinput"><c- n>SanitizerInput</c-></a> <a href="#dom-sanitizer-sanitizetostring-input-input"><code><c- g>input</c-></code></a>);
};

<c- b>typedef</c-> (<a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString"><c- b>DOMString</c-></a> <c- b>or</c-> <a data-link-type="idl-name" href="https://dom.spec.whatwg.org/#documentfragment"><c- n>DocumentFragment</c-></a> <c- b>or</c-> <a data-link-type="idl-name" href="https://dom.spec.whatwg.org/#interface-Document"><c- n>Document</c-></a>) <a href="#typedefdef-sanitizerinput"><code><c- g>SanitizerInput</c-></code></a>;

<c- b>dictionary</c-> <a href="#dictdef-sanitizerconfig"><code><c- g>SanitizerConfig</c-></code></a> {
  <a data-link-type="dfn" href="https://heycam.github.io/webidl/#idl-sequence"><c- b>sequence</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString"><c- b>DOMString</c-></a>> <a data-type="sequence<DOMString> " href="#dom-sanitizerconfig-allowelements"><code><c- g>allowElements</c-></code></a>;
  <a data-link-type="dfn" href="https://heycam.github.io/webidl/#idl-sequence"><c- b>sequence</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString"><c- b>DOMString</c-></a>> <a data-type="sequence<DOMString> " href="#dom-sanitizerconfig-blockelements"><code><c- g>blockElements</c-></code></a>;
  <a data-link-type="dfn" href="https://heycam.github.io/webidl/#idl-sequence"><c- b>sequence</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString"><c- b>DOMString</c-></a>> <a data-type="sequence<DOMString> " href="#dom-sanitizerconfig-dropelements"><code><c- g>dropElements</c-></code></a>;
  <a data-link-type="idl-name" href="#typedefdef-attributematchlist"><c- n>AttributeMatchList</c-></a> <a data-type="AttributeMatchList " href="#dom-sanitizerconfig-allowattributes"><code><c- g>allowAttributes</c-></code></a>;
  <a data-link-type="idl-name" href="#typedefdef-attributematchlist"><c- n>AttributeMatchList</c-></a> <a data-type="AttributeMatchList " href="#dom-sanitizerconfig-dropattributes"><code><c- g>dropAttributes</c-></code></a>;
  <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-boolean"><c- b>boolean</c-></a> <a data-type="boolean " href="#dom-sanitizerconfig-allowcustomelements"><code><c- g>allowCustomElements</c-></code></a>;
};

<c- b>typedef</c-> <a data-link-type="dfn" href="https://heycam.github.io/webidl/#idl-record"><c- b>record</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString"><c- b>DOMString</c-></a>, <a data-link-type="dfn" href="https://heycam.github.io/webidl/#idl-sequence"><c- b>sequence</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString"><c- b>DOMString</c-></a>>> <a href="#typedefdef-attributematchlist"><code><c- g>AttributeMatchList</c-></code></a>;

</pre>
  <h2 class="no-num no-ref heading settled" id="issues-index"><span class="content">Issues Index</span><a class="self-link" href="#issues-index"></a></h2>
  <div style="counter-reset:issue">
   <div class="issue"> This presently ignores all namespace info, making it impossible to
    support different actions for like-named elements from different
    namespaces.<a href="#issue-1cf1de87"> ↵ </a></div>
   <div class="issue"> It’s unclear whether we can assume a generic
  context for <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/DOM-Parsing/#widl-DOMParser-parseFromString-Document-DOMString-str-SupportedType-type">parseFromString</a></code>, or if we need to re-work the API to take
  the insertion context of the created fragment into account. <a href="https://github.com/WICG/sanitizer-api/issues/42">&lt;https://github.com/WICG/sanitizer-api/issues/42></a><a href="#issue-8301a077"> ↵ </a></div>
   <div class="issue"> The sanitizer defaults need to be carefully vetted, and are still
    under discussion. The values below are for illustrative purposes only.<a href="#issue-af977c5a"> ↵ </a></div>
  </div>
  <aside class="dfn-panel" data-for="typedefdef-sanitizerinput">
   <b><a href="#typedefdef-sanitizerinput">#typedefdef-sanitizerinput</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-typedefdef-sanitizerinput">2.1. Sanitizer API {#sanitizer-api}</a> <a href="#ref-for-typedefdef-sanitizerinput①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="configuration">
   <b><a href="#configuration">#configuration</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-configuration">2.1. Sanitizer API {#sanitizer-api}</a>
    <li><a href="#ref-for-configuration①">2.4. Algorithms {#algorithms}</a> <a href="#ref-for-configuration②">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dictdef-sanitizerconfig">
   <b><a href="#dictdef-sanitizerconfig">#dictdef-sanitizerconfig</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dictdef-sanitizerconfig">2.1. Sanitizer API {#sanitizer-api}</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="element-allow-list">
   <b><a href="#element-allow-list">#element-allow-list</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-element-allow-list">2.4. Algorithms {#algorithms}</a> <a href="#ref-for-element-allow-list①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="element-block-list">
   <b><a href="#element-block-list">#element-block-list</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-element-block-list">2.4. Algorithms {#algorithms}</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="element-drop-list">
   <b><a href="#element-drop-list">#element-drop-list</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-element-drop-list">2.4. Algorithms {#algorithms}</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="attribute-allow-list">
   <b><a href="#attribute-allow-list">#attribute-allow-list</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-attribute-allow-list">2.4. Algorithms {#algorithms}</a> <a href="#ref-for-attribute-allow-list①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="attribute-drop-list">
   <b><a href="#attribute-drop-list">#attribute-drop-list</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-attribute-drop-list">2.4. Algorithms {#algorithms}</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="allow-custom-elements-option">
   <b><a href="#allow-custom-elements-option">#allow-custom-elements-option</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-allow-custom-elements-option">2.4. Algorithms {#algorithms}</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="attribute-match-list">
   <b><a href="#attribute-match-list">#attribute-match-list</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-attribute-match-list">2.3. The Configuration Dictionary {#config}</a> <a href="#ref-for-attribute-match-list①">(2)</a>
    <li><a href="#ref-for-attribute-match-list②">2.3.1. Attribute Match Lists {#attr-match-list}</a>
    <li><a href="#ref-for-attribute-match-list③">2.4. Algorithms {#algorithms}</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="typedefdef-attributematchlist">
   <b><a href="#typedefdef-attributematchlist">#typedefdef-attributematchlist</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-typedefdef-attributematchlist">2.3. The Configuration Dictionary {#config}</a> <a href="#ref-for-typedefdef-attributematchlist①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="sanitize-document-fragment">
   <b><a href="#sanitize-document-fragment">#sanitize-document-fragment</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-sanitize-document-fragment">2.4. Algorithms {#algorithms}</a>
    <li><a href="#ref-for-sanitize-document-fragment①">2.5. Default Configuration {#defaults}</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="sanitize-a-node">
   <b><a href="#sanitize-a-node">#sanitize-a-node</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-sanitize-a-node">2.4. Algorithms {#algorithms}</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="sanitize-an-element">
   <b><a href="#sanitize-an-element">#sanitize-an-element</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-sanitize-an-element">2.4. Algorithms {#algorithms}</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="sanitize-an-attribute">
   <b><a href="#sanitize-an-attribute">#sanitize-an-attribute</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-sanitize-an-attribute">2.4. Algorithms {#algorithms}</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="attribute-match">
   <b><a href="#attribute-match">#attribute-match</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-attribute-match">2.4. Algorithms {#algorithms}</a> <a href="#ref-for-attribute-match①">(2)</a> <a href="#ref-for-attribute-match②">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="create-a-document-fragment">
   <b><a href="#create-a-document-fragment">#create-a-document-fragment</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-create-a-document-fragment">2.4. Algorithms {#algorithms}</a> <a href="#ref-for-create-a-document-fragment①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="sanitize">
   <b><a href="#sanitize">#sanitize</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-sanitize">2.1. Sanitizer API {#sanitizer-api}</a>
    <li><a href="#ref-for-sanitize①">2.4. Algorithms {#algorithms}</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="sanitizetostring">
   <b><a href="#sanitizetostring">#sanitizetostring</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-sanitizetostring">2.1. Sanitizer API {#sanitizer-api}</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="default-element-drop-list">
   <b><a href="#default-element-drop-list">#default-element-drop-list</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-default-element-drop-list">2.4. Algorithms {#algorithms}</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="default-element-block-list">
   <b><a href="#default-element-block-list">#default-element-block-list</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-default-element-block-list">2.4. Algorithms {#algorithms}</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="default-attribute-drop-list">
   <b><a href="#default-attribute-drop-list">#default-attribute-drop-list</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-default-attribute-drop-list">2.4. Algorithms {#algorithms}</a>
   </ul>
  </aside>
<script>/* script-dfn-panel */

document.body.addEventListener("click", function(e) {
    var queryAll = function(sel) { return [].slice.call(document.querySelectorAll(sel)); }
    // Find the dfn element or panel, if any, that was clicked on.
    var el = e.target;
    var target;
    var hitALink = false;
    while(el.parentElement) {
        if(el.tagName == "A") {
            // Clicking on a link in a <dfn> shouldn't summon the panel
            hitALink = true;
        }
        if(el.classList.contains("dfn-paneled")) {
            target = "dfn";
            break;
        }
        if(el.classList.contains("dfn-panel")) {
            target = "dfn-panel";
            break;
        }
        el = el.parentElement;
    }
    if(target != "dfn-panel") {
        // Turn off any currently "on" or "activated" panels.
        queryAll(".dfn-panel.on, .dfn-panel.activated").forEach(function(el){
            el.classList.remove("on");
            el.classList.remove("activated");
        });
    }
    if(target == "dfn" && !hitALink) {
        // open the panel
        var dfnPanel = document.querySelector(".dfn-panel[data-for='" + el.id + "']");
        if(dfnPanel) {
            dfnPanel.classList.add("on");
            var rect = el.getBoundingClientRect();
            dfnPanel.style.left = window.scrollX + rect.right + 5 + "px";
            dfnPanel.style.top = window.scrollY + rect.top + "px";
            var panelRect = dfnPanel.getBoundingClientRect();
            var panelWidth = panelRect.right - panelRect.left;
            if(panelRect.right > document.body.scrollWidth && (rect.left - (panelWidth + 5)) > 0) {
                // Reposition, because the panel is overflowing
                dfnPanel.style.left = window.scrollX + rect.left - (panelWidth + 5) + "px";
            }
        } else {
            console.log("Couldn't find .dfn-panel[data-for='" + el.id + "']");
        }
    } else if(target == "dfn-panel") {
        // Switch it to "activated" state, which pins it.
        el.classList.add("activated");
        el.style.left = null;
        el.style.top = null;
    }

});
</script>