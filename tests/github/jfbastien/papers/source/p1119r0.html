<!doctype html><html lang="en">
 <head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
  <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
  <title>P1119R0: ABI for std::hardware_{constructive,destructive}_interference_size</title>
<style data-fill-with="stylesheet">
  </style>
<style>
    table, th, td {
      border: 1px solid black;
      border-collapse: collapse;
      vertical-align: top;
    }
    th, td {
      border-left: none;
      border-right: none;
      padding: 0px 10px;
    }
    th {
      text-align: center;
    }

    del { background: #fcc; color: #000; text-decoration: line-through; }
    ins { background: #cfc; color: #000; }
    blockquote .highlight:not(.idl) { background: initial; margin: initial; padding: 0.5em }
    blockquote ul { background: inherit; }
    blockquote code.highlight:not(.idl) { padding: initial; }
    blockquote c-[a] { color: inherit; } /* Keyword.Declaration */
    blockquote c-[b] { color: inherit; } /* Keyword.Type */
    blockquote c-[c] { color: inherit; } /* Comment */
    blockquote c-[d] { color: inherit; } /* Comment.Multiline */
    blockquote c-[e] { color: inherit; } /* Name.Attribute */
    blockquote c-[f] { color: inherit; } /* Name.Tag */
    blockquote c-[g] { color: inherit; } /* Name.Variable */
    blockquote c-[k] { color: inherit; } /* Keyword */
    blockquote c-[l] { color: inherit; } /* Literal */
    blockquote c-[m] { color: inherit; } /* Literal.Number */
    blockquote c-[n] { color: inherit; } /* Name */
    blockquote c-[o] { color: inherit; } /* Operator */
    blockquote c-[p] { color: inherit; } /* Punctuation */
    blockquote c-[s] { color: inherit; } /* Literal.String */
    blockquote c-[t] { color: inherit; } /* Literal.String.Single */
    blockquote c-[u] { color: inherit; } /* Literal.String.Double */
    blockquote c-[cp] { color: inherit; } /* Comment.Preproc */
    blockquote c-[c1] { color: inherit; } /* Comment.Single */
    blockquote c-[cs] { color: inherit; } /* Comment.Special */
    blockquote c-[kc] { color: inherit; } /* Keyword.Constant */
    blockquote c-[kn] { color: inherit; } /* Keyword.Namespace */
    blockquote c-[kp] { color: inherit; } /* Keyword.Pseudo */
    blockquote c-[kr] { color: inherit; } /* Keyword.Reserved */
    blockquote c-[ld] { color: inherit; } /* Literal.Date */
    blockquote c-[nc] { color: inherit; } /* Name.Class */
    blockquote c-[no] { color: inherit; } /* Name.Constant */
    blockquote c-[nd] { color: inherit; } /* Name.Decorator */
    blockquote c-[ni] { color: inherit; } /* Name.Entity */
    blockquote c-[ne] { color: inherit; } /* Name.Exception */
    blockquote c-[nf] { color: inherit; } /* Name.Function */
    blockquote c-[nl] { color: inherit; } /* Name.Label */
    blockquote c-[nn] { color: inherit; } /* Name.Namespace */
    blockquote c-[py] { color: inherit; } /* Name.Property */
    blockquote c-[ow] { color: inherit; } /* Operator.Word */
    blockquote c-[mb] { color: inherit; } /* Literal.Number.Bin */
    blockquote c-[mf] { color: inherit; } /* Literal.Number.Float */
    blockquote c-[mh] { color: inherit; } /* Literal.Number.Hex */
    blockquote c-[mi] { color: inherit; } /* Literal.Number.Integer */
    blockquote c-[mo] { color: inherit; } /* Literal.Number.Oct */
    blockquote c-[sb] { color: inherit; } /* Literal.String.Backtick */
    blockquote c-[sc] { color: inherit; } /* Literal.String.Char */
    blockquote c-[sd] { color: inherit; } /* Literal.String.Doc */
    blockquote c-[se] { color: inherit; } /* Literal.String.Escape */
    blockquote c-[sh] { color: inherit; } /* Literal.String.Heredoc */
    blockquote c-[si] { color: inherit; } /* Literal.String.Interpol */
    blockquote c-[sx] { color: inherit; } /* Literal.String.Other */
    blockquote c-[sr] { color: inherit; } /* Literal.String.Regex */
    blockquote c-[ss] { color: inherit; } /* Literal.String.Symbol */
    blockquote c-[vc] { color: inherit; } /* Name.Variable.Class */
    blockquote c-[vg] { color: inherit; } /* Name.Variable.Global */
    blockquote c-[vi] { color: inherit; } /* Name.Variable.Instance */
    blockquote c-[il] { color: inherit; } /* Literal.Number.Integer.Long */
  </style>
  <link href="http://wg21.link/d1119r0" rel="canonical">
  <link href="https://isocpp.org/favicon.ico" rel="icon">
  <meta content="dark light" name="color-scheme">
<style>/* Boilerplate: style-autolinks */
.css.css, .property.property, .descriptor.descriptor {
    color: var(--a-normal-text);
    font-size: inherit;
    font-family: inherit;
}
.css::before, .property::before, .descriptor::before {
    content: "‘";
}
.css::after, .property::after, .descriptor::after {
    content: "’";
}
.property, .descriptor {
    /* Don't wrap property and descriptor names */
    white-space: nowrap;
}
.type { /* CSS value <type> */
    font-style: italic;
}
pre .property::before, pre .property::after {
    content: "";
}
[data-link-type="property"]::before,
[data-link-type="propdesc"]::before,
[data-link-type="descriptor"]::before,
[data-link-type="value"]::before,
[data-link-type="function"]::before,
[data-link-type="at-rule"]::before,
[data-link-type="selector"]::before,
[data-link-type="maybe"]::before {
    content: "‘";
}
[data-link-type="property"]::after,
[data-link-type="propdesc"]::after,
[data-link-type="descriptor"]::after,
[data-link-type="value"]::after,
[data-link-type="function"]::after,
[data-link-type="at-rule"]::after,
[data-link-type="selector"]::after,
[data-link-type="maybe"]::after {
    content: "’";
}

[data-link-type].production::before,
[data-link-type].production::after,
.prod [data-link-type]::before,
.prod [data-link-type]::after {
    content: "";
}

[data-link-type=element],
[data-link-type=element-attr] {
    font-family: Menlo, Consolas, "DejaVu Sans Mono", monospace;
    font-size: .9em;
}
[data-link-type=element]::before { content: "<" }
[data-link-type=element]::after  { content: ">" }

[data-link-type=biblio] {
    white-space: pre;
}

@media (prefers-color-scheme: dark) {
    :root {
        --selflink-text: black;
        --selflink-bg: silver;
        --selflink-hover-text: white;
    }
}
</style>
<style>/* Boilerplate: style-colors */
/* Any --*-text not paired with a --*-bg is assumed to have a transparent bg */
:root {
    color-scheme: light dark;

    --text: black;
    --bg: white;

    --unofficial-watermark: url(https://www.w3.org/StyleSheets/TR/2016/logos/UD-watermark);

    --logo-bg: #1a5e9a;
    --logo-active-bg: #c00;
    --logo-text: white;

    --tocnav-normal-text: #707070;
    --tocnav-normal-bg: var(--bg);
    --tocnav-hover-text: var(--tocnav-normal-text);
    --tocnav-hover-bg: #f8f8f8;
    --tocnav-active-text: #c00;
    --tocnav-active-bg: var(--tocnav-normal-bg);

    --tocsidebar-text: var(--text);
    --tocsidebar-bg: #f7f8f9;
    --tocsidebar-shadow: rgba(0,0,0,.1);
    --tocsidebar-heading-text: hsla(203,20%,40%,.7);

    --toclink-text: var(--text);
    --toclink-underline: #3980b5;
    --toclink-visited-text: var(--toclink-text);
    --toclink-visited-underline: #054572;

    --heading-text: #005a9c;

    --hr-text: var(--text);

    --algo-border: #def;

    --del-text: red;
    --del-bg: transparent;
    --ins-text: #080;
    --ins-bg: transparent;

    --a-normal-text: #034575;
    --a-normal-underline: #bbb;
    --a-visited-text: var(--a-normal-text);
    --a-visited-underline: #707070;
    --a-hover-bg: rgba(75%, 75%, 75%, .25);
    --a-active-text: #c00;
    --a-active-underline: #c00;

    --blockquote-border: silver;
    --blockquote-bg: transparent;
    --blockquote-text: currentcolor;

    --issue-border: #e05252;
    --issue-bg: #fbe9e9;
    --issue-text: var(--text);
    --issueheading-text: #831616;

    --example-border: #e0cb52;
    --example-bg: #fcfaee;
    --example-text: var(--text);
    --exampleheading-text: #574b0f;

    --note-border: #52e052;
    --note-bg: #e9fbe9;
    --note-text: var(--text);
    --noteheading-text: hsl(120, 70%, 30%);
    --notesummary-underline: silver;

    --assertion-border: #aaa;
    --assertion-bg: #eee;
    --assertion-text: black;

    --advisement-border: orange;
    --advisement-bg: #fec;
    --advisement-text: var(--text);
    --advisementheading-text: #b35f00;

    --warning-border: red;
    --warning-bg: hsla(40,100%,50%,0.95);
    --warning-text: var(--text);

    --amendment-border: #330099;
    --amendment-bg: #F5F0FF;
    --amendment-text: var(--text);
    --amendmentheading-text: #220066;

    --def-border: #8ccbf2;
    --def-bg: #def;
    --def-text: var(--text);
    --defrow-border: #bbd7e9;

    --datacell-border: silver;

    --indexinfo-text: #707070;

    --indextable-hover-text: black;
    --indextable-hover-bg: #f7f8f9;

    --outdatedspec-bg: rgba(0, 0, 0, .5);
    --outdatedspec-text: black;
    --outdated-bg: maroon;
    --outdated-text: white;
    --outdated-shadow: red;

    --editedrec-bg: darkorange;
}

@media (prefers-color-scheme: dark) {
    :root {
        --text: #ddd;
        --bg: black;

        --unofficial-watermark: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='400'%3E%3Cg fill='%23100808' transform='translate(200 200) rotate(-45) translate(-200 -200)' stroke='%23100808' stroke-width='3'%3E%3Ctext x='50%25' y='220' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EUNOFFICIAL%3C/text%3E%3Ctext x='50%25' y='305' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EDRAFT%3C/text%3E%3C/g%3E%3C/svg%3E");

        --logo-bg: #1a5e9a;
        --logo-active-bg: #c00;
        --logo-text: white;

        --tocnav-normal-text: #999;
        --tocnav-normal-bg: var(--bg);
        --tocnav-hover-text: var(--tocnav-normal-text);
        --tocnav-hover-bg: #080808;
        --tocnav-active-text: #f44;
        --tocnav-active-bg: var(--tocnav-normal-bg);

        --tocsidebar-text: var(--text);
        --tocsidebar-bg: #080808;
        --tocsidebar-shadow: rgba(255,255,255,.1);
        --tocsidebar-heading-text: hsla(203,20%,40%,.7);

        --toclink-text: var(--text);
        --toclink-underline: #6af;
        --toclink-visited-text: var(--toclink-text);
        --toclink-visited-underline: #054572;

        --heading-text: #8af;

        --hr-text: var(--text);

        --algo-border: #456;

        --del-text: #f44;
        --del-bg: transparent;
        --ins-text: #4a4;
        --ins-bg: transparent;

        --a-normal-text: #6af;
        --a-normal-underline: #555;
        --a-visited-text: var(--a-normal-text);
        --a-visited-underline: var(--a-normal-underline);
        --a-hover-bg: rgba(25%, 25%, 25%, .2);
        --a-active-text: #f44;
        --a-active-underline: var(--a-active-text);

        --borderedblock-bg: rgba(255, 255, 255, .05);

        --blockquote-border: silver;
        --blockquote-bg: var(--borderedblock-bg);
        --blockquote-text: currentcolor;

        --issue-border: #e05252;
        --issue-bg: var(--borderedblock-bg);
        --issue-text: var(--text);
        --issueheading-text: hsl(0deg, 70%, 70%);

        --example-border: hsl(50deg, 90%, 60%);
        --example-bg: var(--borderedblock-bg);
        --example-text: var(--text);
        --exampleheading-text: hsl(50deg, 70%, 70%);

        --note-border: hsl(120deg, 100%, 35%);
        --note-bg: var(--borderedblock-bg);
        --note-text: var(--text);
        --noteheading-text: hsl(120, 70%, 70%);
        --notesummary-underline: silver;

        --assertion-border: #444;
        --assertion-bg: var(--borderedblock-bg);
        --assertion-text: var(--text);

        --advisement-border: orange;
        --advisement-bg: #222218;
        --advisement-text: var(--text);
        --advisementheading-text: #f84;

        --warning-border: red;
        --warning-bg: hsla(40,100%,20%,0.95);
        --warning-text: var(--text);

        --amendment-border: #330099;
        --amendment-bg: #080010;
        --amendment-text: var(--text);
        --amendmentheading-text: #cc00ff;

        --def-border: #8ccbf2;
        --def-bg: #080818;
        --def-text: var(--text);
        --defrow-border: #136;

        --datacell-border: silver;

        --indexinfo-text: #aaa;

        --indextable-hover-text: var(--text);
        --indextable-hover-bg: #181818;

        --outdatedspec-bg: rgba(255, 255, 255, .5);
        --outdatedspec-text: black;
        --outdated-bg: maroon;
        --outdated-text: white;
        --outdated-shadow: red;

        --editedrec-bg: darkorange;
    }
    /* In case a transparent-bg image doesn't expect to be on a dark bg,
       which is quite common in practice... */
    img { background: white; }
}
</style>
<style>/* Boilerplate: style-counters */
body {
    counter-reset: example figure issue;
}
.issue {
    counter-increment: issue;
}
.issue:not(.no-marker)::before {
    content: "Issue " counter(issue);
}

.example {
    counter-increment: example;
}
.example:not(.no-marker)::before {
    content: "Example " counter(example);
}
.invalid.example:not(.no-marker)::before,
.illegal.example:not(.no-marker)::before {
    content: "Invalid Example" counter(example);
}

figcaption {
    counter-increment: figure;
}
figcaption:not(.no-marker)::before {
    content: "Figure " counter(figure) " ";
}
</style>
<style>/* Boilerplate: style-issues */
a[href].issue-return {
    float: right;
    float: inline-end;
    color: var(--issueheading-text);
    font-weight: bold;
    text-decoration: none;
}
</style>
<style>/* Boilerplate: style-md-lists */
/* This is a weird hack for me not yet following the commonmark spec
   regarding paragraph and lists. */
[data-md] > :first-child {
    margin-top: 0;
}
[data-md] > :last-child {
    margin-bottom: 0;
}
</style>
<style>/* Boilerplate: style-selflinks */
:root {
    --selflink-text: white;
    --selflink-bg: gray;
    --selflink-hover-text: black;
}
.heading, .issue, .note, .example, li, dt {
    position: relative;
}
a.self-link {
    position: absolute;
    top: 0;
    left: calc(-1 * (3.5rem - 26px));
    width: calc(3.5rem - 26px);
    height: 2em;
    text-align: center;
    border: none;
    transition: opacity .2s;
    opacity: .5;
}
a.self-link:hover {
    opacity: 1;
}
.heading > a.self-link {
    font-size: 83%;
}
.example > a.self-link,
.note > a.self-link,
.issue > a.self-link {
    /* These blocks are overflow:auto, so positioning outside
       doesn't work. */
    left: auto;
    right: 0;
}
li > a.self-link {
    left: calc(-1 * (3.5rem - 26px) - 2em);
}
dfn > a.self-link {
    top: auto;
    left: auto;
    opacity: 0;
    width: 1.5em;
    height: 1.5em;
    background: var(--selflink-bg);
    color: var(--selflink-text);
    font-style: normal;
    transition: opacity .2s, background-color .2s, color .2s;
}
dfn:hover > a.self-link {
    opacity: 1;
}
dfn > a.self-link:hover {
    color: var(--selflink-hover-text);
}

a.self-link::before            { content: "¶"; }
.heading > a.self-link::before { content: "§"; }
dfn > a.self-link::before      { content: "#"; }
</style>
 <body class="h-entry">
  <div class="head">
   <p data-fill-with="logo"></p>
   <h1 class="p-name no-ref" id="title">P1119R0<br>ABI for std::hardware_{constructive,destructive}_interference_size</h1>
   <h2 class="no-num no-toc no-ref heading settled" id="profile-and-date"><span class="content">Published Proposal, <time class="dt-updated" datetime="1970-01-01">1970-01-01</time></span></h2>
   <div data-fill-with="spec-metadata">
    <dl>
     <dt>This version:
     <dd><a class="u-url" href="http://wg21.link/d1119r0">http://wg21.link/d1119r0</a>
     <dt class="editor">Authors:
     <dd class="editor p-author h-card vcard"><a class="p-name fn u-email email" href="mailto:jfbastien@apple.com">JF Bastien</a> (<span class="p-org org">Apple</span>)
     <dd class="editor p-author h-card vcard"><a class="p-name fn u-email email" href="mailto:ogiroux@nvidia.com">Olivier Giroux</a> (<span class="p-org org">NVIDIA</span>)
     <dd class="editor p-author h-card vcard"><a class="p-name fn u-email email" href="mailto:cxx@kayari.org">Jonathan Wakely</a> (<span class="p-org org">RedHat</span>)
     <dd class="editor p-author h-card vcard"><a class="p-name fn u-email email" href="mailto:hfinkel@anl.gov">Hal Finkel</a> (<span class="p-org org">Argonne National Laboratory</span>)
     <dd class="editor p-author h-card vcard"><a class="p-name fn u-email email" href="mailto:trodgers@redhat.com">Thomas Rodgers</a> (<span class="p-org org">RedHat</span>)
     <dd class="editor p-author h-card vcard"><a class="p-name fn u-email email" href="mailto:m.kretz@gsi.de">Matthias Kretz</a> (<span class="p-org org">GSI</span>)
     <dt>Audience:
     <dd>SG1, LEWG, LWG
     <dt>Project:
     <dd>ISO/IEC 14882 Programming Languages — C++, ISO/IEC JTC1/SC22/WG21
     <dt>Source:
     <dd><a href="https://github.com/jfbastien/papers/blob/master/source/p1119r0.bs">github.com/jfbastien/papers/blob/master/source/p1119r0.bs</a>
    </dl>
   </div>
   <div data-fill-with="warning"></div>
   <hr title="Separator for header">
  </div>
  <div class="p-summary" data-fill-with="abstract">
   <h2 class="no-num no-toc no-ref heading settled" id="abstract"><span class="content">Abstract</span><a class="self-link" href="#abstract"></a></h2>
   <p>std::hardware_{constructive,destructive}_interference_size exposes potential ABI issues, and that’s OK. This position paper clarifies the committee’s position.</p>
  </div>
  <nav data-fill-with="table-of-contents" id="toc">
   <h2 class="no-num no-toc no-ref heading settled" id="contents"><span class="content">Table of Contents</span></h2>
   <ol class="toc" role="directory">
    <li><a href="#word"><span class="secno">1</span> <span class="content">Wording</span></a>
    <li><a href="#discussions"><span class="secno">2</span> <span class="content">Discussions</span></a>
    <li><a href="#push"><span class="secno">3</span> <span class="content">Pushback</span></a>
    <li><a href="#polls"><span class="secno">4</span> <span class="content">Polls</span></a>
    <li>
     <a href="#references"><span class="secno"></span> <span class="content">References</span></a>
     <ol class="toc">
      <li><a href="#informative"><span class="secno"></span> <span class="content">Informative References</span></a>
     </ol>
   </ol>
  </nav>
  <main>
   <h2 class="heading settled" data-level="1" id="word"><span class="secno">1. </span><span class="content">Wording</span><a class="self-link" href="#word"></a></h2>
   <p><a data-link-type="biblio" href="#biblio-p0154r1" title="constexpr std::thread::hardware_{true,false}_sharing_size">[P0154R1]</a> introduced <code class="highlight"><c- k>constexpr</c-> <c- n>std</c-><c- o>::</c-><c- n>hardware_</c-><c- p>{</c-><c- n>constructive</c-><c- p>,</c-><c- n>destructive</c-><c- p>}</c-><c- n>_interference_size</c-></code> to C++17:</p>
   <p>Header <code class="highlight"><c- o>&lt;</c-><c- k>new</c-><c- o>></c-></code> synopsis [<strong>new.syn</strong>]:</p>
   <blockquote>
<pre class="highlight">
<c- k>namespace</c-> <c- nn>std</c-> <c- p>{</c->
  <c- c1>// ...</c->
  <c- c1>// 21.6.5, hardware interference size</c->
  <c- kr>inline</c-> <c- k>constexpr</c-> <c- b>size_t</c-> <c- n>hardware_destructive_interference_size</c-> <c- o>=</c-> <c- n>implementation</c-><c- o>-</c-><c- n>defined</c-><c- p>;</c->
  <c- kr>inline</c-> <c- k>constexpr</c-> <c- b>size_t</c-> <c- n>hardware_constructive_interference_size</c-> <c- o>=</c-> <c- n>implementation</c-><c- o>-</c-><c- n>defined</c-><c- p>;</c->
  <c- c1>// ...</c->
<c- p>}</c->

</pre>
   </blockquote>
   <p>Hardware interference size [<strong>hardware.interference</strong>]:</p>
   <blockquote>
<pre class="highlight"><c- kr>inline</c-> <c- k>constexpr</c-> <c- b>size_t</c-> <c- n>hardware_destructive_interference_size</c-> <c- o>=</c-> <c- n>implementation</c-><c- o>-</c-><c- n>defined</c-><c- p>;</c-></pre>
    <p>This number is the minimum recommended offset between two concurrently-accessed
  objects to avoid additional performance degradation due to contention introduced
  by the implementation. It shall be at least <code class="highlight"><c- k>alignof</c-><c- p>(</c-><c- n>max_align_t</c-><c- p>)</c-></code>.</p>
    <p>[ <em>Example</em>:</p>
<pre class="highlight"><c- k>struct</c-> <c- nc>keep_apart</c-> <c- p>{</c->
  <c- k>alignas</c-><c- p>(</c-><c- n>hardware_destructive_interference_size</c-><c- p>)</c-> <c- n>atomic</c-><c- o>&lt;</c-><c- b>int</c-><c- o>></c-> <c- n>cat</c-><c- p>;</c->
  <c- k>alignas</c-><c- p>(</c-><c- n>hardware_destructive_interference_size</c-><c- p>)</c-> <c- n>atomic</c-><c- o>&lt;</c-><c- b>int</c-><c- o>></c-> <c- n>dog</c-><c- p>;</c->
<c- p>};</c->
</pre>
    <p>— <em>end example</em> ]</p>
<pre class="highlight"><c- kr>inline</c-> <c- k>constexpr</c-> <c- b>size_t</c-> <c- n>hardware_constructive_interference_size</c-> <c- o>=</c-> <c- n>implementation</c-><c- o>-</c-><c- n>defined</c-><c- p>;</c-></pre>
    <p>This number is the maximum recommended size of contiguous memory occupied by
  two objects accessed with temporal locality by concurrent threads. It shall be
  at least <code class="highlight"><c- k>alignof</c-><c- p>(</c-><c- n>max_align_t</c-><c- p>)</c-></code>.</p>
    <p>[ <em>Example</em>:</p>
<pre class="highlight"><c- k>struct</c-> <c- nc>together</c-> <c- p>{</c->
  <c- n>atomic</c-><c- o>&lt;</c-><c- b>int</c-><c- o>></c-> <c- n>dog</c-><c- p>;</c->
  <c- b>int</c-> <c- n>puppy</c-><c- p>;</c->
<c- p>};</c->
<c- k>struct</c-> <c- nc>kennel</c-> <c- p>{</c->
<c- c1>// Other data members...</c->
   <c- k>alignas</c-><c- p>(</c-><c- k>sizeof</c-><c- p>(</c-><c- n>together</c-><c- p>))</c-> <c- n>together</c-> <c- n>pack</c-><c- p>;</c->
<c- c1>// Other data members...</c->
<c- p>};</c->
<c- k>static_assert</c-><c- p>(</c-><c- k>sizeof</c-><c- p>(</c-><c- n>together</c-><c- p>)</c-> <c- o>&lt;=</c-> <c- n>hardware_constructive_interference_size</c-><c- p>);</c->
</pre>
    <p>— <em>end example</em> ]</p>
   </blockquote>
   <h2 class="heading settled" data-level="2" id="discussions"><span class="secno">2. </span><span class="content">Discussions</span><a class="self-link" href="#discussions"></a></h2>
   <p>The paper was discussed in:</p>
   <ul>
    <li data-md>
     <p><a href="http://wiki.edg.com/bin/view/Wg21kona2015/N4523">SG1 Kona</a></p>
    <li data-md>
     <p><a href="http://wiki.edg.com/bin/view/Wg21kona2015/P0154">LEWG Kona</a></p>
    <li data-md>
     <p><a href="http://wiki.edg.com/bin/view/Wg21jacksonville/P0154">LEWG Jacksonville</a></p>
    <li data-md>
     <p><a href="http://wiki.edg.com/bin/view/Wg21jacksonville/D0154R1">LWG Jacksonville</a></p>
   </ul>
   <p>ABI issues were considered in these discussions, and the committee decided that
having these values was worth the potential pain points. ABI issues can arise as
follows:</p>
   <ol>
    <li data-md>
     <p>A developer asks the compiler to generate code for multiple targets of the
 same ISA, and these targets prefer different interference sizes.</p>
    <li data-md>
     <p>A developer indicates that code should be generated for heterogeneous system
 (such as CPU and GPU), which prefer different interference sizes.</p>
    <li data-md>
     <p>A developer uses different compilers, and links the result together.</p>
   </ol>
   <p>A further ABI issue was added by <a data-link-type="biblio" href="#biblio-p0607r0" title="Inline Variables for the Standard Library">[P0607r0]</a> by making the variables <code class="highlight"><c- kr>inline</c-></code>:
in case 1. above the interference size values differ between translation units,
which is a problem if they are used in an ODR-relevant context. That paper noted:</p>
   <blockquote>
    <p>[<em>Drafting notes</em>: The removal of the explicit <code class="highlight"><c- k>static</c-></code> specifier for the
  namespace-scope constants <code class="highlight"><c- n>hardware_destructive_interference_size</c-></code> and <code class="highlight"><c- n>hardware_constructive_interference_size</c-></code> is still required because adding <code class="highlight"><c- kr>inline</c-></code> alone would still not solve the ODR violation problem here.
  — <em>end drafting notes</em>]</p>
   </blockquote>
   <p>This change indeed fixes the ODR issue where two translation units translated
with the same interference size values may violate ODR when used with e.g. <code class="highlight"><c- n>std</c-><c- o>::</c-><c- n>max</c-></code>. It however introduces a new ODR issue for case 1. above.</p>
   <p>Richard Smith and Tim Song propose changing the definition to:</p>
<pre class="highlight"><c- k>static</c-> <c- k>constexpr</c-> <c- k>const</c-> <c- n>std</c-><c- o>::</c-><c- b>size_t</c-><c- o>&amp;</c-> <c- n>hardware_destructive_interference_size</c-> <c- o>=</c-> <c- n>implementation</c-><c- o>-</c-><c- n>defined</c-><c- p>;</c->
<c- k>static</c-> <c- k>constexpr</c-> <c- k>const</c-> <c- n>std</c-><c- o>::</c-><c- b>size_t</c-><c- o>&amp;</c-> <c- n>hardware_constructive_interference_size</c-> <c- o>=</c-> <c- n>implementation</c-><c- o>-</c-><c- n>defined</c-><c- p>;</c->
</pre>
   <p>We propose a discussion and poll on this topic.</p>
   <h2 class="heading settled" data-level="3" id="push"><span class="secno">3. </span><span class="content">Pushback</span><a class="self-link" href="#push"></a></h2>
   <p>The maintainers of clang and GCC
have <a href="http://lists.llvm.org/pipermail/cfe-dev/2018-May/058073.html">discussed an implementation strategy</a>,
but received pushback based on the above ABI issues. The messaging from the
committee wasn’t clear that ABI issues were discussed and the proposal accepted
despite these issues. This type of ABI problem is difficult or impossible to
warn about, some implementors are worried.</p>
   <p>Some implementors are worries that they have the following choices when
implementing, and are unsure which approach to take:</p>
   <ol>
    <li data-md>
     <p>Pick a value once for each ABI and cast it in stone forever, even if
 microarchitectural revisions cause the values to change.</p>
    <li data-md>
     <p>Change the value between microarchitectures, even though that’s an ABI
 break?</p>
    <li data-md>
     <p>Something else.</p>
   </ol>
   <p>The authors believe that the ABI issues are acceptable because:</p>
   <ul>
    <li data-md>
     <p>As demonstrated in the original paper, developers already write code like
this, using macros. Any ABI issue that exist with this proposal already
existed before the proposal.</p>
    <li data-md>
     <p>Many uses of these values have no ABI breakage potential because they only
target one variant of one ISA.</p>
    <li data-md>
     <p>The usecase for these values is to lay out datastructures. These
datastructures shouldn’t be shared across translation units which follow
different ABIs.</p>
    <li data-md>
     <p>Similar ABI issues already exist with <code class="highlight"><c- n>max_align_t</c-></code> and <code class="highlight"><c- b>intmax_t</c-></code>.</p>
    <li data-md>
     <p>Implementations can offer compiler flags which specifically control ABI. For
example, <code class="highlight"><c- o>-</c-><c- n>mcpu</c-></code> could keep the ABI stable, but <code class="highlight"><c- o>-</c-><c- n>mcpu</c-><c- o>-</c-><c- n>abi</c-></code> would change it.</p>
   </ul>
   <h2 class="heading settled" data-level="4" id="polls"><span class="secno">4. </span><span class="content">Polls</span><a class="self-link" href="#polls"></a></h2>
   <p>We propose the following poll for SG1:</p>
   <blockquote>
    <p>The committee understands the ABI issues  with <code class="highlight"><c- n>std</c-><c- o>::</c-><c- n>hardware_</c-><c- p>{</c-><c- n>constructive</c-><c- p>,</c-><c- n>destructive</c-><c- p>}</c-><c- n>_interference_size</c-></code>, yet chooses to  standardize these values nonetheless.</p>
   </blockquote>
   <p>The committee could also consider adding a note to point out ABI issues with
these values. This would be a novel note, since ABI isn’t discussed in the
Standard.</p>
   <p>We propose the following poll for SG1, LEWG, and LWG:</p>
   <blockquote>
    <p>Both ODR issues should be addressed, the type should therefore be changed to <code class="highlight"><c- k>static</c-> <c- k>constexpr</c-> <c- k>const</c-> <c- n>std</c-><c- o>::</c-><c- b>size_t</c-><c- o>&amp;</c-></code>.</p>
   </blockquote>
   <p>Not all authors of this paper are in favor of this direction, but all agree the
discussion is worth having.</p>
  </main>
<script>
(function() {
  "use strict";
  var collapseSidebarText = '<span aria-hidden="true">←</span> '
                          + '<span>Collapse Sidebar</span>';
  var expandSidebarText   = '<span aria-hidden="true">→</span> '
                          + '<span>Pop Out Sidebar</span>';
  var tocJumpText         = '<span aria-hidden="true">↑</span> '
                          + '<span>Jump to Table of Contents</span>';

  var sidebarMedia = window.matchMedia('screen and (min-width: 78em)');
  var autoToggle   = function(e){ toggleSidebar(e.matches) };
  if(sidebarMedia.addListener) {
    sidebarMedia.addListener(autoToggle);
  }

  function toggleSidebar(on) {
    if (on == undefined) {
      on = !document.body.classList.contains('toc-sidebar');
    }

    /* Don't scroll to compensate for the ToC if we're above it already. */
    var headY = 0;
    var head = document.querySelector('.head');
    if (head) {
      // terrible approx of "top of ToC"
      headY += head.offsetTop + head.offsetHeight;
    }
    var skipScroll = window.scrollY < headY;

    var toggle = document.getElementById('toc-toggle');
    var tocNav = document.getElementById('toc');
    if (on) {
      var tocHeight = tocNav.offsetHeight;
      document.body.classList.add('toc-sidebar');
      document.body.classList.remove('toc-inline');
      toggle.innerHTML = collapseSidebarText;
      if (!skipScroll) {
        window.scrollBy(0, 0 - tocHeight);
      }
      tocNav.focus();
      sidebarMedia.addListener(autoToggle); // auto-collapse when out of room
    }
    else {
      document.body.classList.add('toc-inline');
      document.body.classList.remove('toc-sidebar');
      toggle.innerHTML = expandSidebarText;
      if (!skipScroll) {
        window.scrollBy(0, tocNav.offsetHeight);
      }
      if (toggle.matches(':hover')) {
        /* Unfocus button when not using keyboard navigation,
           because I don't know where else to send the focus. */
        toggle.blur();
      }
    }
  }

  function createSidebarToggle() {
    /* Create the sidebar toggle in JS; it shouldn't exist when JS is off. */
    var toggle = document.createElement('a');
      /* This should probably be a button, but appearance isn't standards-track.*/
    toggle.id = 'toc-toggle';
    toggle.class = 'toc-toggle';
    toggle.href = '#toc';
    toggle.innerHTML = collapseSidebarText;

    sidebarMedia.addListener(autoToggle);
    var toggler = function(e) {
      e.preventDefault();
      sidebarMedia.removeListener(autoToggle); // persist explicit off states
      toggleSidebar();
      return false;
    }
    toggle.addEventListener('click', toggler, false);


    /* Get <nav id=toc-nav>, or make it if we don't have one. */
    var tocNav = document.getElementById('toc-nav');
    if (!tocNav) {
      tocNav = document.createElement('p');
      tocNav.id = 'toc-nav';
      /* Prepend for better keyboard navigation */
      document.body.insertBefore(tocNav, document.body.firstChild);
    }
    /* While we're at it, make sure we have a Jump to Toc link. */
    var tocJump = document.getElementById('toc-jump');
    if (!tocJump) {
      tocJump = document.createElement('a');
      tocJump.id = 'toc-jump';
      tocJump.href = '#toc';
      tocJump.innerHTML = tocJumpText;
      tocNav.appendChild(tocJump);
    }

    tocNav.appendChild(toggle);
  }

  var toc = document.getElementById('toc');
  if (toc) {
    createSidebarToggle();
    toggleSidebar(sidebarMedia.matches);

    /* If the sidebar has been manually opened and is currently overlaying the text
       (window too small for the MQ to add the margin to body),
       then auto-close the sidebar once you click on something in there. */
    toc.addEventListener('click', function(e) {
      if(e.target.tagName.toLowerCase() == "a" && document.body.classList.contains('toc-sidebar') && !sidebarMedia.matches) {
        toggleSidebar(false);
      }
    }, false);
  }
  else {
    console.warn("Can't find Table of Contents. Please use <nav id='toc'> around the ToC.");
  }

  /* Wrap tables in case they overflow */
  var tables = document.querySelectorAll(':not(.overlarge) > table.data, :not(.overlarge) > table.index');
  var numTables = tables.length;
  for (var i = 0; i < numTables; i++) {
    var table = tables[i];
    var wrapper = document.createElement('div');
    wrapper.className = 'overlarge';
    table.parentNode.insertBefore(wrapper, table);
    wrapper.appendChild(table);
  }

})();
</script>
  <h2 class="no-num no-ref heading settled" id="references"><span class="content">References</span><a class="self-link" href="#references"></a></h2>
  <h3 class="no-num no-ref heading settled" id="informative"><span class="content">Informative References</span><a class="self-link" href="#informative"></a></h3>
  <dl>
   <dt id="biblio-p0154r1">[P0154R1]
   <dd>JF Bastien, Olivier Giroux. <a href="https://wg21.link/p0154r1"><cite>constexpr std::thread::hardware_{true,false}_sharing_size</cite></a>. 3 March 2016. URL: <a href="https://wg21.link/p0154r1">https://wg21.link/p0154r1</a>
   <dt id="biblio-p0607r0">[P0607r0]
   <dd>Daniel Krugler. <a href="https://wg21.link/p0607r0"><cite>Inline Variables for the Standard Library</cite></a>. 27 February 2017. URL: <a href="https://wg21.link/p0607r0">https://wg21.link/p0607r0</a>
  </dl>