<!doctype html><html lang="en">
 <head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
  <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
  <title>P0476R2: Bit-casting object representations</title>
<style data-fill-with="stylesheet">
  </style>
<style>
    table, th, td {
      border: 1px solid black;
      border-collapse: collapse;
      vertical-align: top;
    }
    th, td {
      border-left: none;
      border-right: none;
      padding: 0px 10px;
    }
    th {
      text-align: center;
    }

    del { background: #fcc; color: #000; text-decoration: line-through; }
    ins { background: #cfc; color: #000; }
    blockquote .highlight:not(.idl) { background: initial; margin: initial; padding: 0.5em }
    blockquote ul { background: inherit; }
    blockquote code.highlight:not(.idl) { padding: initial; }
    blockquote c-[a] { color: inherit; } /* Keyword.Declaration */
    blockquote c-[b] { color: inherit; } /* Keyword.Type */
    blockquote c-[c] { color: inherit; } /* Comment */
    blockquote c-[d] { color: inherit; } /* Comment.Multiline */
    blockquote c-[e] { color: inherit; } /* Name.Attribute */
    blockquote c-[f] { color: inherit; } /* Name.Tag */
    blockquote c-[g] { color: inherit; } /* Name.Variable */
    blockquote c-[k] { color: inherit; } /* Keyword */
    blockquote c-[l] { color: inherit; } /* Literal */
    blockquote c-[m] { color: inherit; } /* Literal.Number */
    blockquote c-[n] { color: inherit; } /* Name */
    blockquote c-[o] { color: inherit; } /* Operator */
    blockquote c-[p] { color: inherit; } /* Punctuation */
    blockquote c-[s] { color: inherit; } /* Literal.String */
    blockquote c-[t] { color: inherit; } /* Literal.String.Single */
    blockquote c-[u] { color: inherit; } /* Literal.String.Double */
    blockquote c-[cp] { color: inherit; } /* Comment.Preproc */
    blockquote c-[c1] { color: inherit; } /* Comment.Single */
    blockquote c-[cs] { color: inherit; } /* Comment.Special */
    blockquote c-[kc] { color: inherit; } /* Keyword.Constant */
    blockquote c-[kn] { color: inherit; } /* Keyword.Namespace */
    blockquote c-[kp] { color: inherit; } /* Keyword.Pseudo */
    blockquote c-[kr] { color: inherit; } /* Keyword.Reserved */
    blockquote c-[ld] { color: inherit; } /* Literal.Date */
    blockquote c-[nc] { color: inherit; } /* Name.Class */
    blockquote c-[no] { color: inherit; } /* Name.Constant */
    blockquote c-[nd] { color: inherit; } /* Name.Decorator */
    blockquote c-[ni] { color: inherit; } /* Name.Entity */
    blockquote c-[ne] { color: inherit; } /* Name.Exception */
    blockquote c-[nf] { color: inherit; } /* Name.Function */
    blockquote c-[nl] { color: inherit; } /* Name.Label */
    blockquote c-[nn] { color: inherit; } /* Name.Namespace */
    blockquote c-[py] { color: inherit; } /* Name.Property */
    blockquote c-[ow] { color: inherit; } /* Operator.Word */
    blockquote c-[mb] { color: inherit; } /* Literal.Number.Bin */
    blockquote c-[mf] { color: inherit; } /* Literal.Number.Float */
    blockquote c-[mh] { color: inherit; } /* Literal.Number.Hex */
    blockquote c-[mi] { color: inherit; } /* Literal.Number.Integer */
    blockquote c-[mo] { color: inherit; } /* Literal.Number.Oct */
    blockquote c-[sb] { color: inherit; } /* Literal.String.Backtick */
    blockquote c-[sc] { color: inherit; } /* Literal.String.Char */
    blockquote c-[sd] { color: inherit; } /* Literal.String.Doc */
    blockquote c-[se] { color: inherit; } /* Literal.String.Escape */
    blockquote c-[sh] { color: inherit; } /* Literal.String.Heredoc */
    blockquote c-[si] { color: inherit; } /* Literal.String.Interpol */
    blockquote c-[sx] { color: inherit; } /* Literal.String.Other */
    blockquote c-[sr] { color: inherit; } /* Literal.String.Regex */
    blockquote c-[ss] { color: inherit; } /* Literal.String.Symbol */
    blockquote c-[vc] { color: inherit; } /* Name.Variable.Class */
    blockquote c-[vg] { color: inherit; } /* Name.Variable.Global */
    blockquote c-[vi] { color: inherit; } /* Name.Variable.Instance */
    blockquote c-[il] { color: inherit; } /* Literal.Number.Integer.Long */
  </style>
  <link href="http://wg21.link/P0476r2" rel="canonical">
  <link href="https://isocpp.org/favicon.ico" rel="icon">
  <meta content="dark light" name="color-scheme">
<style>/* Boilerplate: style-autolinks */
.css.css, .property.property, .descriptor.descriptor {
    color: var(--a-normal-text);
    font-size: inherit;
    font-family: inherit;
}
.css::before, .property::before, .descriptor::before {
    content: "‘";
}
.css::after, .property::after, .descriptor::after {
    content: "’";
}
.property, .descriptor {
    /* Don't wrap property and descriptor names */
    white-space: nowrap;
}
.type { /* CSS value <type> */
    font-style: italic;
}
pre .property::before, pre .property::after {
    content: "";
}
[data-link-type="property"]::before,
[data-link-type="propdesc"]::before,
[data-link-type="descriptor"]::before,
[data-link-type="value"]::before,
[data-link-type="function"]::before,
[data-link-type="at-rule"]::before,
[data-link-type="selector"]::before,
[data-link-type="maybe"]::before {
    content: "‘";
}
[data-link-type="property"]::after,
[data-link-type="propdesc"]::after,
[data-link-type="descriptor"]::after,
[data-link-type="value"]::after,
[data-link-type="function"]::after,
[data-link-type="at-rule"]::after,
[data-link-type="selector"]::after,
[data-link-type="maybe"]::after {
    content: "’";
}

[data-link-type].production::before,
[data-link-type].production::after,
.prod [data-link-type]::before,
.prod [data-link-type]::after {
    content: "";
}

[data-link-type=element],
[data-link-type=element-attr] {
    font-family: Menlo, Consolas, "DejaVu Sans Mono", monospace;
    font-size: .9em;
}
[data-link-type=element]::before { content: "<" }
[data-link-type=element]::after  { content: ">" }

[data-link-type=biblio] {
    white-space: pre;
}

@media (prefers-color-scheme: dark) {
    :root {
        --selflink-text: black;
        --selflink-bg: silver;
        --selflink-hover-text: white;
    }
}
</style>
<style>/* Boilerplate: style-colors */
/* Any --*-text not paired with a --*-bg is assumed to have a transparent bg */
:root {
    color-scheme: light dark;

    --text: black;
    --bg: white;

    --unofficial-watermark: url(https://www.w3.org/StyleSheets/TR/2016/logos/UD-watermark);

    --logo-bg: #1a5e9a;
    --logo-active-bg: #c00;
    --logo-text: white;

    --tocnav-normal-text: #707070;
    --tocnav-normal-bg: var(--bg);
    --tocnav-hover-text: var(--tocnav-normal-text);
    --tocnav-hover-bg: #f8f8f8;
    --tocnav-active-text: #c00;
    --tocnav-active-bg: var(--tocnav-normal-bg);

    --tocsidebar-text: var(--text);
    --tocsidebar-bg: #f7f8f9;
    --tocsidebar-shadow: rgba(0,0,0,.1);
    --tocsidebar-heading-text: hsla(203,20%,40%,.7);

    --toclink-text: var(--text);
    --toclink-underline: #3980b5;
    --toclink-visited-text: var(--toclink-text);
    --toclink-visited-underline: #054572;

    --heading-text: #005a9c;

    --hr-text: var(--text);

    --algo-border: #def;

    --del-text: red;
    --del-bg: transparent;
    --ins-text: #080;
    --ins-bg: transparent;

    --a-normal-text: #034575;
    --a-normal-underline: #bbb;
    --a-visited-text: var(--a-normal-text);
    --a-visited-underline: #707070;
    --a-hover-bg: rgba(75%, 75%, 75%, .25);
    --a-active-text: #c00;
    --a-active-underline: #c00;

    --blockquote-border: silver;
    --blockquote-bg: transparent;
    --blockquote-text: currentcolor;

    --issue-border: #e05252;
    --issue-bg: #fbe9e9;
    --issue-text: var(--text);
    --issueheading-text: #831616;

    --example-border: #e0cb52;
    --example-bg: #fcfaee;
    --example-text: var(--text);
    --exampleheading-text: #574b0f;

    --note-border: #52e052;
    --note-bg: #e9fbe9;
    --note-text: var(--text);
    --noteheading-text: hsl(120, 70%, 30%);
    --notesummary-underline: silver;

    --assertion-border: #aaa;
    --assertion-bg: #eee;
    --assertion-text: black;

    --advisement-border: orange;
    --advisement-bg: #fec;
    --advisement-text: var(--text);
    --advisementheading-text: #b35f00;

    --warning-border: red;
    --warning-bg: hsla(40,100%,50%,0.95);
    --warning-text: var(--text);

    --amendment-border: #330099;
    --amendment-bg: #F5F0FF;
    --amendment-text: var(--text);
    --amendmentheading-text: #220066;

    --def-border: #8ccbf2;
    --def-bg: #def;
    --def-text: var(--text);
    --defrow-border: #bbd7e9;

    --datacell-border: silver;

    --indexinfo-text: #707070;

    --indextable-hover-text: black;
    --indextable-hover-bg: #f7f8f9;

    --outdatedspec-bg: rgba(0, 0, 0, .5);
    --outdatedspec-text: black;
    --outdated-bg: maroon;
    --outdated-text: white;
    --outdated-shadow: red;

    --editedrec-bg: darkorange;
}

@media (prefers-color-scheme: dark) {
    :root {
        --text: #ddd;
        --bg: black;

        --unofficial-watermark: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='400'%3E%3Cg fill='%23100808' transform='translate(200 200) rotate(-45) translate(-200 -200)' stroke='%23100808' stroke-width='3'%3E%3Ctext x='50%25' y='220' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EUNOFFICIAL%3C/text%3E%3Ctext x='50%25' y='305' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EDRAFT%3C/text%3E%3C/g%3E%3C/svg%3E");

        --logo-bg: #1a5e9a;
        --logo-active-bg: #c00;
        --logo-text: white;

        --tocnav-normal-text: #999;
        --tocnav-normal-bg: var(--bg);
        --tocnav-hover-text: var(--tocnav-normal-text);
        --tocnav-hover-bg: #080808;
        --tocnav-active-text: #f44;
        --tocnav-active-bg: var(--tocnav-normal-bg);

        --tocsidebar-text: var(--text);
        --tocsidebar-bg: #080808;
        --tocsidebar-shadow: rgba(255,255,255,.1);
        --tocsidebar-heading-text: hsla(203,20%,40%,.7);

        --toclink-text: var(--text);
        --toclink-underline: #6af;
        --toclink-visited-text: var(--toclink-text);
        --toclink-visited-underline: #054572;

        --heading-text: #8af;

        --hr-text: var(--text);

        --algo-border: #456;

        --del-text: #f44;
        --del-bg: transparent;
        --ins-text: #4a4;
        --ins-bg: transparent;

        --a-normal-text: #6af;
        --a-normal-underline: #555;
        --a-visited-text: var(--a-normal-text);
        --a-visited-underline: var(--a-normal-underline);
        --a-hover-bg: rgba(25%, 25%, 25%, .2);
        --a-active-text: #f44;
        --a-active-underline: var(--a-active-text);

        --borderedblock-bg: rgba(255, 255, 255, .05);

        --blockquote-border: silver;
        --blockquote-bg: var(--borderedblock-bg);
        --blockquote-text: currentcolor;

        --issue-border: #e05252;
        --issue-bg: var(--borderedblock-bg);
        --issue-text: var(--text);
        --issueheading-text: hsl(0deg, 70%, 70%);

        --example-border: hsl(50deg, 90%, 60%);
        --example-bg: var(--borderedblock-bg);
        --example-text: var(--text);
        --exampleheading-text: hsl(50deg, 70%, 70%);

        --note-border: hsl(120deg, 100%, 35%);
        --note-bg: var(--borderedblock-bg);
        --note-text: var(--text);
        --noteheading-text: hsl(120, 70%, 70%);
        --notesummary-underline: silver;

        --assertion-border: #444;
        --assertion-bg: var(--borderedblock-bg);
        --assertion-text: var(--text);

        --advisement-border: orange;
        --advisement-bg: #222218;
        --advisement-text: var(--text);
        --advisementheading-text: #f84;

        --warning-border: red;
        --warning-bg: hsla(40,100%,20%,0.95);
        --warning-text: var(--text);

        --amendment-border: #330099;
        --amendment-bg: #080010;
        --amendment-text: var(--text);
        --amendmentheading-text: #cc00ff;

        --def-border: #8ccbf2;
        --def-bg: #080818;
        --def-text: var(--text);
        --defrow-border: #136;

        --datacell-border: silver;

        --indexinfo-text: #aaa;

        --indextable-hover-text: var(--text);
        --indextable-hover-bg: #181818;

        --outdatedspec-bg: rgba(255, 255, 255, .5);
        --outdatedspec-text: black;
        --outdated-bg: maroon;
        --outdated-text: white;
        --outdated-shadow: red;

        --editedrec-bg: darkorange;
    }
    /* In case a transparent-bg image doesn't expect to be on a dark bg,
       which is quite common in practice... */
    img { background: white; }
}
</style>
<style>/* Boilerplate: style-counters */
body {
    counter-reset: example figure issue;
}
.issue {
    counter-increment: issue;
}
.issue:not(.no-marker)::before {
    content: "Issue " counter(issue);
}

.example {
    counter-increment: example;
}
.example:not(.no-marker)::before {
    content: "Example " counter(example);
}
.invalid.example:not(.no-marker)::before,
.illegal.example:not(.no-marker)::before {
    content: "Invalid Example" counter(example);
}

figcaption {
    counter-increment: figure;
}
figcaption:not(.no-marker)::before {
    content: "Figure " counter(figure) " ";
}
</style>
<style>/* Boilerplate: style-issues */
a[href].issue-return {
    float: right;
    float: inline-end;
    color: var(--issueheading-text);
    font-weight: bold;
    text-decoration: none;
}
</style>
<style>/* Boilerplate: style-md-lists */
/* This is a weird hack for me not yet following the commonmark spec
   regarding paragraph and lists. */
[data-md] > :first-child {
    margin-top: 0;
}
[data-md] > :last-child {
    margin-bottom: 0;
}
</style>
<style>/* Boilerplate: style-selflinks */
:root {
    --selflink-text: white;
    --selflink-bg: gray;
    --selflink-hover-text: black;
}
.heading, .issue, .note, .example, li, dt {
    position: relative;
}
a.self-link {
    position: absolute;
    top: 0;
    left: calc(-1 * (3.5rem - 26px));
    width: calc(3.5rem - 26px);
    height: 2em;
    text-align: center;
    border: none;
    transition: opacity .2s;
    opacity: .5;
}
a.self-link:hover {
    opacity: 1;
}
.heading > a.self-link {
    font-size: 83%;
}
.example > a.self-link,
.note > a.self-link,
.issue > a.self-link {
    /* These blocks are overflow:auto, so positioning outside
       doesn't work. */
    left: auto;
    right: 0;
}
li > a.self-link {
    left: calc(-1 * (3.5rem - 26px) - 2em);
}
dfn > a.self-link {
    top: auto;
    left: auto;
    opacity: 0;
    width: 1.5em;
    height: 1.5em;
    background: var(--selflink-bg);
    color: var(--selflink-text);
    font-style: normal;
    transition: opacity .2s, background-color .2s, color .2s;
}
dfn:hover > a.self-link {
    opacity: 1;
}
dfn > a.self-link:hover {
    color: var(--selflink-hover-text);
}

a.self-link::before            { content: "¶"; }
.heading > a.self-link::before { content: "§"; }
dfn > a.self-link::before      { content: "#"; }
</style>
 <body class="h-entry">
  <div class="head">
   <p data-fill-with="logo"></p>
   <h1 class="p-name no-ref" id="title">P0476R2<br>Bit-casting object representations</h1>
   <h2 class="no-num no-toc no-ref heading settled" id="profile-and-date"><span class="content">Published Proposal, <time class="dt-updated" datetime="1970-01-01">1970-01-01</time></span></h2>
   <div data-fill-with="spec-metadata">
    <dl>
     <dt>This version:
     <dd><a class="u-url" href="http://wg21.link/P0476r2">http://wg21.link/P0476r2</a>
     <dt class="editor">Author:
     <dd class="editor p-author h-card vcard"><a class="p-name fn u-email email" href="mailto:jfbastien@apple.com">JF Bastien</a> (<span class="p-org org">Apple</span>)
     <dt>Audience:
     <dd>LWG
     <dt>Project:
     <dd>ISO/IEC 14882 Programming Languages — C++, ISO/IEC JTC1/SC22/WG21
     <dt>Source:
     <dd><a href="https://github.com/jfbastien/papers/blob/master/source/P0476r2.bs">github.com/jfbastien/papers/blob/master/source/P0476r2.bs</a>
     <dt>Implementation:
     <dd><a href="https://github.com/jfbastien/bit_cast/">github.com/jfbastien/bit_cast/</a>
    </dl>
   </div>
   <div data-fill-with="warning"></div>
   <hr title="Separator for header">
  </div>
  <div class="p-summary" data-fill-with="abstract">
   <h2 class="no-num no-toc no-ref heading settled" id="abstract"><span class="content">Abstract</span><a class="self-link" href="#abstract"></a></h2>
   <p>Obtaining equivalent object representations The Right Way™.</p>
  </div>
  <nav data-fill-with="table-of-contents" id="toc">
   <h2 class="no-num no-toc no-ref heading settled" id="contents"><span class="content">Table of Contents</span></h2>
   <ol class="toc" role="directory">
    <li><a href="#bg"><span class="secno">1</span> <span class="content">Background</span></a>
    <li>
     <a href="#word"><span class="secno">2</span> <span class="content">Proposed Wording</span></a>
     <ol class="toc">
      <li><a href="#bit"><span class="secno">2.1</span> <span class="content">29.� Bit manipulation library [<strong>bit</strong>]</span></a>
      <li><a href="#bitgen"><span class="secno">2.2</span> <span class="content">29.�.1 General [<strong>bit.general</strong>]</span></a>
      <li><a href="#bitsyn"><span class="secno">2.3</span> <span class="content">29.�.2 Header <code class="highlight"><c- o>&lt;</c-><c- n>bit</c-><c- o>></c-></code> synopsis [<strong>bit.syn</strong>]</span></a>
      <li><a href="#bitcast"><span class="secno">2.4</span> <span class="content">29.�.3 Function template <code class="highlight"><c- n>bit_cast</c-></code> [<strong>bit.cast</strong>]</span></a>
      <li><a href="#test"><span class="secno">2.5</span> <span class="content">Feature testing</span></a>
     </ol>
    <li><a href="#appendix"><span class="secno">3</span> <span class="content">Appendix</span></a>
    <li>
     <a href="#rev"><span class="secno">4</span> <span class="content">Revision History</span></a>
     <ol class="toc">
      <li><a href="#r1r2"><span class="secno">4.1</span> <span class="content">r1 ➡ r2</span></a>
      <li><a href="#r0r1"><span class="secno">4.2</span> <span class="content">r0 ➡ r1</span></a>
     </ol>
    <li><a href="#ack"><span class="secno">5</span> <span class="content">Acknowledgement</span></a>
    <li>
     <a href="#references"><span class="secno"></span> <span class="content">References</span></a>
     <ol class="toc">
      <li><a href="#informative"><span class="secno"></span> <span class="content">Informative References</span></a>
     </ol>
   </ol>
  </nav>
  <main>
   <p>This paper is a revision of <a data-link-type="biblio" href="#biblio-p0476r1" title="Bit-casting object representations">[P0476r1]</a>, addressing LEWG comments from the 2017
Toronto meeting as well as comments from LEWG and LWG from the 2017 Albuquerque
meeting. See <a href="#rev">§ 4 Revision History</a> for details.</p>
   <h2 class="heading settled" data-level="1" id="bg"><span class="secno">1. </span><span class="content">Background</span><a class="self-link" href="#bg"></a></h2>
   <p>Low-level code often seeks to interpret objects of one type as another: keep the
same bits, but obtain an object of a different type. Doing so correctly is
error-prone: using <code class="highlight"><c- k>reinterpret_cast</c-></code> or <code class="highlight"><c- k>union</c-></code> runs afoul of type-aliasing
rules yet these are the intuitive solutions developers mistakenly turn to.</p>
   <p>Attuned developers use <code class="highlight"><c- n>aligned_storage</c-></code> with <code class="highlight"><c- n>memcpy</c-></code>, avoiding alignment
pitfalls and allowing them to bit-cast non-default-constructible types.</p>
   <p>This proposal uses appropriate concepts to prevent misuse. As the sample
implementation demonstrates we could as well use <code class="highlight"><c- k>static_assert</c-></code> or template
SFINAE, but the timing of this library feature will likely coincide with
concept’s standardization.</p>
   <p>Furthermore, it is currently impossible to implement a <code class="highlight"><c- k>constexpr</c-></code> bit-cast
function, as <code class="highlight"><c- n>memcpy</c-></code> itself isn’t <code class="highlight"><c- k>constexpr</c-></code>. Marking the proposed function as <code class="highlight"><c- k>constexpr</c-></code> doesn’t require or prevent <code class="highlight"><c- n>memcpy</c-></code> from becoming <code class="highlight"><c- k>constexpr</c-></code>, but
requires compiler support. This leaves implementations free to use their own
internal solution (e.g. LLVM has <a href="http://llvm.org/docs/LangRef.html#bitcast-to-instruction">a <code class="highlight"><c- n>bitcast</c-></code> opcode</a>).</p>
   <p>We should standardize this oft-used idiom, and avoid the pitfalls once and for
all.</p>
   <h2 class="heading settled" data-level="2" id="word"><span class="secno">2. </span><span class="content">Proposed Wording</span><a class="self-link" href="#word"></a></h2>
   <p>Below, substitute the <code class="highlight">�</code> character with a number or name the editor finds
appropriate for the sub-section.</p>
   <p>In 20.5.1.2 [<strong>headers</strong>] add the header <code class="highlight"><c- o>&lt;</c-><c- n>bit</c-><c- o>></c-></code> to:</p>
   <ul>
    <li data-md>
     <p>Table 16 — C++ library headers</p>
    <li data-md>
     <p>Table 19 — C++ headers for freestanding implementations</p>
   </ul>
   <p>In the numerics section, add the following:</p>
   <ins>
    <h3 class="heading settled" data-level="2.1" id="bit"><span class="secno">2.1. </span><span class="content">29.� Bit manipulation library [<strong>bit</strong>]</span><a class="self-link" href="#bit"></a></h3>
    <h3 class="heading settled" data-level="2.2" id="bitgen"><span class="secno">2.2. </span><span class="content">29.�.1 General [<strong>bit.general</strong>]</span><a class="self-link" href="#bitgen"></a></h3>
    <p>The header <code class="highlight"><c- o>&lt;</c-><c- n>bit</c-><c- o>></c-></code> provides components to access, manipulate and process both
individual bits and bit sequences.</p>
    <h3 class="heading settled" data-level="2.3" id="bitsyn"><span class="secno">2.3. </span><span class="content">29.�.2 Header <code class="highlight"><c- o>&lt;</c-><c- n>bit</c-><c- o>></c-></code> synopsis [<strong>bit.syn</strong>]</span><a class="self-link" href="#bitsyn"></a></h3>
<pre class="highlight"><c- k>namespace</c-> <c- nn>std</c-> <c- p>{</c->
  
  <c- c1>// 29.�.3 bit_cast</c->
  <c- k>template</c-><c- o>&lt;</c-><c- k>typename</c-> <c- nc>To</c-><c- p>,</c-> <c- k>typename</c-> <c- nc>From</c-><c- o>></c->
  <c- k>constexpr</c-> <c- n>To</c-> <c- n>bit_cast</c-><c- p>(</c-><c- k>const</c-> <c- n>From</c-><c- o>&amp;</c-> <c- n>from</c-><c- p>)</c-> <c- k>noexcept</c-><c- p>;</c->
  
<c- p>}</c->
</pre>
    <h3 class="heading settled" data-level="2.4" id="bitcast"><span class="secno">2.4. </span><span class="content">29.�.3 Function template <code class="highlight"><c- n>bit_cast</c-></code> [<strong>bit.cast</strong>]</span><a class="self-link" href="#bitcast"></a></h3>
<pre class="highlight"><c- k>template</c-><c- o>&lt;</c-><c- k>typename</c-> <c- nc>To</c-><c- p>,</c-> <c- k>typename</c-> <c- nc>From</c-><c- o>></c->
<c- k>constexpr</c-> <c- n>To</c-> <c- n>bit_cast</c-><c- p>(</c-><c- k>const</c-> <c- n>From</c-><c- o>&amp;</c-> <c- n>from</c-><c- p>)</c-> <c- k>noexcept</c-><c- p>;</c->
</pre>
    <ol>
     <li>
      <em>Remarks</em>: 
      <p>This function shall not participate in overload resolution unless:</p>
      <ul>
       <li><code class="highlight"><c- k>sizeof</c-><c- p>(</c-><c- n>To</c-><c- p>)</c-> <c- o>==</c-> <c- k>sizeof</c-><c- p>(</c-><c- n>From</c-><c- p>)</c-></code> is <code class="highlight">true</code>;
       <li><code class="highlight"><c- n>is_trivially_copyable_v</c-><c- o>&lt;</c-><c- n>To</c-><c- o>></c-></code> is <code class="highlight">true</code>; and
       <li><code class="highlight"><c- n>is_trivially_copyable_v</c-><c- o>&lt;</c-><c- n>From</c-><c- o>></c-></code> is <code class="highlight">true</code>.
      </ul>
      <p>This function shall be <code class="highlight"><c- k>constexpr</c-></code> if and only if <code class="highlight"><c- n>To</c-></code>, <code class="highlight"><c- n>From</c-></code>, and the types
  of all subobjects of <code class="highlight"><c- n>To</c-></code> and <code class="highlight"><c- n>From</c-></code> are types <code class="highlight"><c- n>T</c-></code> such that:</p>
      <ul>
       <li><code class="highlight"><c- n>is_union_v</c-><c- o>&lt;</c-><c- n>T</c-><c- o>></c-></code> is <code class="highlight">false</code>;
       <li><code class="highlight"><c- n>is_pointer_v</c-><c- o>&lt;</c-><c- n>T</c-><c- o>></c-></code> is <code class="highlight">false</code>;
       <li><code class="highlight"><c- n>is_member_pointer_v</c-><c- o>&lt;</c-><c- n>T</c-><c- o>></c-></code> is <code class="highlight">false</code>;
       <li><code class="highlight"><c- n>is_volatile_v</c-><c- o>&lt;</c-><c- n>T</c-><c- o>></c-></code> is <code class="highlight">false</code>; and
       <li><code class="highlight"><c- n>T</c-></code> has no non-static data members of reference type.
      </ul>
     <li>
      <em>Returns</em>: 
      <p>An object of type <code class="highlight"><c- n>To</c-></code>. Each bit of the value representation of the result
    is equal to the corresponding bit in the object representation of <code class="highlight"><c- n>from</c-></code>. Padding bits of the <code class="highlight"><c- n>To</c-></code> object are unspecified. If there is no
    value of type <code class="highlight"><c- n>To</c-></code> corresponding to the value representation produced, the
    behavior is undefined. If there are multiple such values, which value is
    produced is unspecified.</p>
    </ol>
   </ins>
   <h3 class="heading settled" data-level="2.5" id="test"><span class="secno">2.5. </span><span class="content">Feature testing</span><a class="self-link" href="#test"></a></h3>
   <p>The <code class="highlight"><c- n>__cpp_lib_bit_cast</c-></code> feature test macro should be added.</p>
   <h2 class="heading settled" data-level="3" id="appendix"><span class="secno">3. </span><span class="content">Appendix</span><a class="self-link" href="#appendix"></a></h2>
   <p>The Standard’s [<strong>basic.types</strong>] section explicitly blesses <code class="highlight"><c- n>memcpy</c-></code>:</p>
   <blockquote>
    <p>For any trivially copyable type <code class="highlight"><c- n>T</c-></code>, if two pointers to <code class="highlight"><c- n>T</c-></code> point to distinct <code class="highlight"><c- n>T</c-></code> objects <code class="highlight"><c- n>obj1</c-></code> and <code class="highlight"><c- n>obj2</c-></code>, where neither <code class="highlight"><c- n>obj1</c-></code> nor <code class="highlight"><c- n>obj2</c-></code> is a base-class
  subobject, if the <em>underlying bytes</em> (1.7) making up <code class="highlight"><c- n>obj1</c-></code> are copied into <code class="highlight"><c- n>obj2</c-></code>, <code class="highlight"><c- n>obj2</c-></code> shall subsequently hold the same value as <code class="highlight"><c- n>obj1</c-></code>.</p>
    <p>[<em>Example:</em></p>
<pre class="highlight"><c- n>T</c-><c- o>*</c-> <c- n>t1p</c-><c- p>;</c->
<c- n>T</c-><c- o>*</c-> <c- n>t2p</c-><c- p>;</c->
<c- c1>// provided that t2p points to an initialized object ...</c->
<c- n>std</c-><c- o>::</c-><c- n>memcpy</c-><c- p>(</c-><c- n>t1p</c-><c- p>,</c-> <c- n>t2p</c-><c- p>,</c-> <c- k>sizeof</c-><c- p>(</c-><c- n>T</c-><c- p>));</c->
<c- c1>// at this point, every subobject of trivially copyable type in *t1p contains</c->
<c- c1>// the same value as the corresponding subobject in *t2p</c->
</pre>
    <p>— <em>end example</em>]</p>
   </blockquote>
   <p>Whereas section [<strong>class.union</strong>] says:</p>
   <blockquote>
    <p>In a union, at most one of the non-static data members can be
  active at any time, that is, the value of at most one of the
  non-static data members can be stored in a union at any time.</p>
   </blockquote>
   <h2 class="heading settled" data-level="4" id="rev"><span class="secno">4. </span><span class="content">Revision History</span><a class="self-link" href="#rev"></a></h2>
   <h3 class="heading settled" data-level="4.1" id="r1r2"><span class="secno">4.1. </span><span class="content">r1 ➡ r2</span><a class="self-link" href="#r1r2"></a></h3>
   <p>The paper was reviewed by LEWG at the 2017 Toronto meeting and feedback was
provided. In the 2017 Albuquerque meeting LEWG provided feedback regarding usage
of concepts while discussing <a data-link-type="biblio" href="#biblio-p0802r0" title="Applying Concepts to the Standard Library">[P0802r0]</a>, and EWG reviewed the paper:</p>
   <ul>
    <li data-md>
     <p>Use "shall not participate in overload resolution" wording instead of a
requires clause.</p>
    <li data-md>
     <p>The author was asked to explore naming. LEWG took a poll in Albuquerque and
voted to keep <code class="highlight"><c- n>bit_cast</c-></code>.</p>
    <li data-md>
     <p>There was strong sentiment that this facility should be available in
freestanding implementations. LEWG is changing its guidance regarding
freestanding header granularity, but until guidance is actually changed it
was decided that a currently freestanding header should be used. LEWG took a
poll in Albuquerque, and the new <code class="highlight"><c- o>&lt;</c-><c- n>bit</c-><c- o>></c-></code> header was chosen instead of <code class="highlight"><c- o>&lt;</c-><c- n>cstddef</c-><c- o>></c-></code>.</p>
    <li data-md>
     <p>Call out that <code class="highlight"><c- k>constexpr</c-></code> requires compiler support.</p>
    <li data-md>
     <p>Make <code class="highlight"><c- k>constexpr</c-></code> conditional, similar to variant’s [variant.ctor] wording,
based on an EWG straw poll in Albuquerque.</p>
    <li data-md>
     <p>LWG review made the <code class="highlight"><c- k>constexpr</c-></code> remark recursive, and tuned the return
wording, asking CWG to review the changes.</p>
    <li data-md>
     <p>LWG review requested that this paper also add the <code class="highlight"><c- o>&lt;</c-><c- n>bit</c-><c- o>></c-></code> header, and let
the editor resolve races if multiple papers add the header concurrently.</p>
    <li data-md>
     <p>CWG substantially tuned the wording.</p>
   </ul>
   <h3 class="heading settled" data-level="4.2" id="r0r1"><span class="secno">4.2. </span><span class="content">r0 ➡ r1</span><a class="self-link" href="#r0r1"></a></h3>
   <p>The paper was reviewed by LEWG at the 2016 Issaquah meeting:</p>
   <ul>
    <li data-md>
     <p>Remove the standard layout requirement—trivially copyable suffices for the <code class="highlight"><c- n>memcpy</c-></code> requirement.</p>
    <li data-md>
     <p>We discussed removing <code class="highlight"><c- k>constexpr</c-></code>, but there was no consent either way. There was some suggestion that it’ll be hard for implementers, but there’s also some desire (by the same implementers) to have those features available in order to support things like <code class="highlight"><c- k>constexpr</c-></code> instances of <code class="highlight"><c- n>std</c-><c- o>::</c-><c- n>variant</c-></code>.</p>
    <li data-md>
     <p>The pointer-forbidding logic was removed. It was initially there to help developers when a better tool is available, but it’s easily worked around (e.g. with a <code class="highlight"><c- k>struct</c-></code> containing a pointer). Note that this doesn’t prevent <code class="highlight"><c- k>constexpr</c-></code> versions of <code class="highlight"><c- n>bit_cast</c-></code>: the implementation is allowed to error out on <code class="highlight"><c- n>bit_cast</c-></code> of pointer.</p>
    <li data-md>
     <p>Some discussion about concepts-usage, but it seems like mostly an LWG issue and we’re reasonably sure that concepts will land before this or in a compatible vehicle.</p>
   </ul>
   <p>Straw polls:</p>
   <ul>
    <li data-md>
     <p>Do we want to see <a data-link-type="biblio" href="#biblio-p0476r0" title="Bit-casting object representations">[P0476r0]</a> again? unanimous consent.</p>
    <li data-md>
     <p><code class="highlight"><c- n>bit_cast</c-></code> should allow pointer types in <code class="highlight"><c- n>To</c-></code> and <code class="highlight"><c- n>From</c-></code>. <strong>SF F N A SA</strong> 4 5 4 2 1</p>
    <li data-md>
     <p><code class="highlight"><c- n>bit_cast</c-></code> should be <code class="highlight"><c- k>constexpr</c-></code>? <strong>SF F N A SA</strong> 4 3 7 2 3</p>
   </ul>
   <h2 class="heading settled" data-level="5" id="ack"><span class="secno">5. </span><span class="content">Acknowledgement</span><a class="self-link" href="#ack"></a></h2>
   <p>Thanks to Saam Barati, Jeffrey Yasskin, and Sam Benzaquen for their early review
and suggested improvements.</p>
  </main>
<script>
(function() {
  "use strict";
  var collapseSidebarText = '<span aria-hidden="true">←</span> '
                          + '<span>Collapse Sidebar</span>';
  var expandSidebarText   = '<span aria-hidden="true">→</span> '
                          + '<span>Pop Out Sidebar</span>';
  var tocJumpText         = '<span aria-hidden="true">↑</span> '
                          + '<span>Jump to Table of Contents</span>';

  var sidebarMedia = window.matchMedia('screen and (min-width: 78em)');
  var autoToggle   = function(e){ toggleSidebar(e.matches) };
  if(sidebarMedia.addListener) {
    sidebarMedia.addListener(autoToggle);
  }

  function toggleSidebar(on) {
    if (on == undefined) {
      on = !document.body.classList.contains('toc-sidebar');
    }

    /* Don't scroll to compensate for the ToC if we're above it already. */
    var headY = 0;
    var head = document.querySelector('.head');
    if (head) {
      // terrible approx of "top of ToC"
      headY += head.offsetTop + head.offsetHeight;
    }
    var skipScroll = window.scrollY < headY;

    var toggle = document.getElementById('toc-toggle');
    var tocNav = document.getElementById('toc');
    if (on) {
      var tocHeight = tocNav.offsetHeight;
      document.body.classList.add('toc-sidebar');
      document.body.classList.remove('toc-inline');
      toggle.innerHTML = collapseSidebarText;
      if (!skipScroll) {
        window.scrollBy(0, 0 - tocHeight);
      }
      tocNav.focus();
      sidebarMedia.addListener(autoToggle); // auto-collapse when out of room
    }
    else {
      document.body.classList.add('toc-inline');
      document.body.classList.remove('toc-sidebar');
      toggle.innerHTML = expandSidebarText;
      if (!skipScroll) {
        window.scrollBy(0, tocNav.offsetHeight);
      }
      if (toggle.matches(':hover')) {
        /* Unfocus button when not using keyboard navigation,
           because I don't know where else to send the focus. */
        toggle.blur();
      }
    }
  }

  function createSidebarToggle() {
    /* Create the sidebar toggle in JS; it shouldn't exist when JS is off. */
    var toggle = document.createElement('a');
      /* This should probably be a button, but appearance isn't standards-track.*/
    toggle.id = 'toc-toggle';
    toggle.class = 'toc-toggle';
    toggle.href = '#toc';
    toggle.innerHTML = collapseSidebarText;

    sidebarMedia.addListener(autoToggle);
    var toggler = function(e) {
      e.preventDefault();
      sidebarMedia.removeListener(autoToggle); // persist explicit off states
      toggleSidebar();
      return false;
    }
    toggle.addEventListener('click', toggler, false);


    /* Get <nav id=toc-nav>, or make it if we don't have one. */
    var tocNav = document.getElementById('toc-nav');
    if (!tocNav) {
      tocNav = document.createElement('p');
      tocNav.id = 'toc-nav';
      /* Prepend for better keyboard navigation */
      document.body.insertBefore(tocNav, document.body.firstChild);
    }
    /* While we're at it, make sure we have a Jump to Toc link. */
    var tocJump = document.getElementById('toc-jump');
    if (!tocJump) {
      tocJump = document.createElement('a');
      tocJump.id = 'toc-jump';
      tocJump.href = '#toc';
      tocJump.innerHTML = tocJumpText;
      tocNav.appendChild(tocJump);
    }

    tocNav.appendChild(toggle);
  }

  var toc = document.getElementById('toc');
  if (toc) {
    createSidebarToggle();
    toggleSidebar(sidebarMedia.matches);

    /* If the sidebar has been manually opened and is currently overlaying the text
       (window too small for the MQ to add the margin to body),
       then auto-close the sidebar once you click on something in there. */
    toc.addEventListener('click', function(e) {
      if(e.target.tagName.toLowerCase() == "a" && document.body.classList.contains('toc-sidebar') && !sidebarMedia.matches) {
        toggleSidebar(false);
      }
    }, false);
  }
  else {
    console.warn("Can't find Table of Contents. Please use <nav id='toc'> around the ToC.");
  }

  /* Wrap tables in case they overflow */
  var tables = document.querySelectorAll(':not(.overlarge) > table.data, :not(.overlarge) > table.index');
  var numTables = tables.length;
  for (var i = 0; i < numTables; i++) {
    var table = tables[i];
    var wrapper = document.createElement('div');
    wrapper.className = 'overlarge';
    table.parentNode.insertBefore(wrapper, table);
    wrapper.appendChild(table);
  }

})();
</script>
  <h2 class="no-num no-ref heading settled" id="references"><span class="content">References</span><a class="self-link" href="#references"></a></h2>
  <h3 class="no-num no-ref heading settled" id="informative"><span class="content">Informative References</span><a class="self-link" href="#informative"></a></h3>
  <dl>
   <dt id="biblio-p0476r0">[P0476r0]
   <dd>JF Bastien. <a href="https://wg21.link/p0476r0"><cite>Bit-casting object representations</cite></a>. 16 October 2016. URL: <a href="https://wg21.link/p0476r0">https://wg21.link/p0476r0</a>
   <dt id="biblio-p0476r1">[P0476r1]
   <dd>JF Bastien. <a href="https://wg21.link/p0476r1"><cite>Bit-casting object representations</cite></a>. 11 November 2016. URL: <a href="https://wg21.link/p0476r1">https://wg21.link/p0476r1</a>
   <dt id="biblio-p0802r0">[P0802r0]
   <dd>Beman Dawes, Nicolai Josuttis, Walter E. Brown, Bob Steagall. <a href="https://wg21.link/p0802r0"><cite>Applying Concepts to the Standard Library</cite></a>. 15 October 2017. URL: <a href="https://wg21.link/p0802r0">https://wg21.link/p0802r0</a>
  </dl>