<!doctype html><html lang="en">
 <head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
  <meta content="#3c790a" name="theme-color">
  <title>Storage Standard</title>
  <link crossorigin href="https://resources.whatwg.org/spec.css" rel="stylesheet">
  <link crossorigin href="https://resources.whatwg.org/standard.css" rel="stylesheet">
  <link crossorigin href="https://resources.whatwg.org/standard-shared-with-dev.css" rel="stylesheet">
  <link crossorigin href="https://resources.whatwg.org/logo-storage.svg" rel="icon">
<script async crossorigin src="https://resources.whatwg.org/file-issue.js"></script>
<script async crossorigin src="https://resources.whatwg.org/commit-snapshot-shortcut-key.js"></script>
<script crossorigin defer src="https://resources.whatwg.org/standard-mdn-annos.js"></script>
<style>/* Boilerplate: style-issues */
a[href].issue-return {
    float: right;
    float: inline-end;
    color: var(--issueheading-text);
    font-weight: bold;
    text-decoration: none;
}
</style>
<style>/* Boilerplate: style-var-click-highlighting */
/*
Colors were chosen in Lab using https://nixsensor.com/free-color-converter/
D50 2deg illuminant, L in [0,100], a and b in [-128, 128]
0 = lab(85,0,85)
1 = lab(85,80,30)
2 = lab(85,-40,40)
3 = lab(85,-50,0)
4 = lab(85,5,15)
5 = lab(85,-10,-50)
6 = lab(85,35,-15)
*/
var { cursor: pointer; }
var.selected0 { background-color: #F4D200; box-shadow: 0 0 0 2px #F4D200; }
var.selected1 { background-color: #FF87A2; box-shadow: 0 0 0 2px #FF87A2; }
var.selected2 { background-color: #96E885; box-shadow: 0 0 0 2px #96E885; }
var.selected3 { background-color: #3EEED2; box-shadow: 0 0 0 2px #3EEED2; }
var.selected4 { background-color: #EACFB6; box-shadow: 0 0 0 2px #EACFB6; }
var.selected5 { background-color: #82DDFF; box-shadow: 0 0 0 2px #82DDFF; }
var.selected6 { background-color: #FFBCF2; box-shadow: 0 0 0 2px #FFBCF2; }
</style>
 <body class="h-entry status-LS">
  <div class="head">
    <a class="logo" href="https://whatwg.org/"> <img alt="WHATWG" crossorigin height="100" src="https://resources.whatwg.org/logo-storage.svg"> </a> 
   <hgroup>
    <h1 class="p-name no-ref" id="title">Storage</h1>
    <p id="subtitle">Living Standard — Last Updated <time class="dt-updated" datetime="1970-01-01">1 January 1970</time> </p>
   </hgroup>
   <div data-fill-with="spec-metadata">
    <dl>
     <dt>Participate:
     <dd><a href="https://github.com/whatwg/storage">GitHub whatwg/storage</a> (<a href="https://github.com/whatwg/storage/issues/new">new issue</a>, <a href="https://github.com/whatwg/storage/issues">open issues</a>)
     <dd><a href="https://whatwg.org/chat">Chat on Matrix</a>
     <dt>Commits:
     <dd><a href="https://github.com/whatwg/storage/commits">GitHub whatwg/storage/commits</a>
     <dd><a href="/commit-snapshots/[COMMIT-SHA]/" id="commit-snapshot-link">Snapshot as of this commit</a>
     <dd><a href="https://twitter.com/storagestandard">@storagestandard</a>
     <dt>Tests:
     <dd><a href="https://github.com/web-platform-tests/wpt/tree/master/storage">web-platform-tests storage/</a> (<a href="https://github.com/web-platform-tests/wpt/labels/storage">ongoing work</a>)
     <dt>Translations <small>(non-normative)</small>:
     <dd><span title="Japanese"><a href="https://triple-underscore.github.io/storage-ja.html" hreflang="ja" lang="ja" rel="alternate">日本語</a></span>
    </dl>
   </div>
   <div data-fill-with="warning"></div>
  </div>
  <div class="p-summary" data-fill-with="abstract">
   <h2 class="no-num no-toc no-ref heading settled" id="abstract"><span class="content">Abstract</span></h2>
   <p>The Storage Standard defines an API for persistent storage and quota estimates, as well as the platform storage architecture.</p>
  </div>
  <nav data-fill-with="table-of-contents" id="toc">
   <h2 class="no-num no-toc no-ref" id="contents">Table of Contents</h2>
   <ol class="toc" role="directory">
    <li><a href="#introduction"><span class="secno">1</span> <span class="content">Introduction</span></a>
    <li><a href="#terminology"><span class="secno">2</span> <span class="content">Terminology</span></a>
    <li><a href="#infrastructure"><span class="secno">3</span> <span class="content">Lay of the land</span></a>
    <li>
     <a href="#model"><span class="secno">4</span> <span class="content">Model</span></a>
     <ol class="toc">
      <li><a href="#storage-endpoints"><span class="secno">4.1</span> <span class="content">Storage endpoints</span></a>
      <li><a href="#storage-keys"><span class="secno">4.2</span> <span class="content">Storage keys</span></a>
      <li><a href="#storage-sheds"><span class="secno">4.3</span> <span class="content">Storage sheds</span></a>
      <li><a href="#storage-shelves"><span class="secno">4.4</span> <span class="content">Storage shelves</span></a>
      <li><a href="#buckets"><span class="secno">4.5</span> <span class="content">Storage buckets</span></a>
      <li><a href="#storage-bottles"><span class="secno">4.6</span> <span class="content">Storage bottles</span></a>
      <li><a href="#storage-proxy-maps"><span class="secno">4.7</span> <span class="content">Storage proxy maps</span></a>
     </ol>
    <li><a href="#persistence"><span class="secno">5</span> <span class="content">Persistence permission</span></a>
    <li><a href="#usage-and-quota"><span class="secno">6</span> <span class="content">Usage and quota</span></a>
    <li>
     <a href="#management"><span class="secno">7</span> <span class="content">Management</span></a>
     <ol class="toc">
      <li><a href="#storage-pressure"><span class="secno">7.1</span> <span class="content">Storage pressure</span></a>
      <li><a href="#ui-guidelines"><span class="secno">7.2</span> <span class="content">User interface guidelines</span></a>
     </ol>
    <li><a href="#api"><span class="secno">8</span> <span class="content">API</span></a>
    <li><a href="#acks"><span class="secno"></span> <span class="content">Acknowledgments</span></a>
    <li><a href="#ipr"><span class="secno"></span> <span class="content">Intellectual property rights</span></a>
    <li>
     <a href="#index"><span class="secno"></span> <span class="content">Index</span></a>
     <ol class="toc">
      <li><a href="#index-defined-here"><span class="secno"></span> <span class="content">Terms defined by this specification</span></a>
      <li><a href="#index-defined-elsewhere"><span class="secno"></span> <span class="content">Terms defined by reference</span></a>
     </ol>
    <li>
     <a href="#references"><span class="secno"></span> <span class="content">References</span></a>
     <ol class="toc">
      <li><a href="#normative"><span class="secno"></span> <span class="content">Normative References</span></a>
     </ol>
    <li><a href="#idl-index"><span class="secno"></span> <span class="content">IDL Index</span></a>
   </ol>
  </nav>
  <main>
   <h2 class="heading settled" data-level="1" id="introduction"><span class="secno">1. </span><span class="content">Introduction</span><a class="self-link" href="#introduction"></a></h2>
   <p>Over the years the web has grown various APIs that can be used for storage, e.g., IndexedDB, <code>localStorage</code>, and <code>showNotification()</code>. The Storage Standard consolidates
these APIs by defining: </p>
   <ul class="brief">
    <li>A bucket, the primitive these APIs store their data in 
    <li>A way of making that bucket persistent 
    <li>A way of getting usage and quota estimates for an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin" id="ref-for-concept-origin">origin</a> 
   </ul>
   <p>Traditionally, as the user runs out of storage space on their device, the data stored with these
APIs gets lost without the user being able to intervene. However, persistent buckets cannot be
cleared without consent by the user. This thus brings data guarantees users have enjoyed on native
platforms to the web. </p>
   <div class="example" id="example-3a7051a8">
    <a class="self-link" href="#example-3a7051a8"></a> 
    <p>A simple way to make storage persistent is through invoking the <code class="idl"><a data-link-type="idl" href="#dom-storagemanager-persist" id="ref-for-dom-storagemanager-persist">persist()</a></code> method. It
 simultaneously requests the end user for permission and changes the storage to be persistent once
 granted:</p>
<pre><code class="lang-javascript highlight">navigator<c- p>.</c->storage<c- p>.</c->persist<c- p>().</c->then<c- p>(</c->persisted <c- p>=></c-> <c- p>{</c->
  <c- k>if</c-> <c- p>(</c->persisted<c- p>)</c-> <c- p>{</c->
    <c- d>/* … */</c->
  <c- p>}</c->
<c- p>});</c->
</code></pre>
    <p>To not show user-agent-driven dialogs to the end user unannounced slightly more involved code
 can be written:</p>
<pre><code class="lang-javascript highlight">Promise<c- p>.</c->all<c- p>([</c->
  navigator<c- p>.</c->storage<c- p>.</c->persisted<c- p>(),</c->
  navigator<c- p>.</c->permissions<c- p>.</c->query<c- p>({</c->name<c- o>:</c-> <c- u>"persistent-storage"</c-><c- p>})</c->
<c- p>]).</c->then<c- p>(([</c->persisted<c- p>,</c-> permission<c- p>])</c-> <c- p>=></c-> <c- p>{</c->
  <c- k>if</c-> <c- p>(</c-><c- o>!</c->persisted <c- o>&amp;&amp;</c-> permission<c- p>.</c->state <c- o>==</c-> <c- u>"granted"</c-><c- p>)</c-> <c- p>{</c->
    navigator<c- p>.</c->storage<c- p>.</c->persist<c- p>().</c->then<c- p>(</c-> <c- d>/* … */</c-> <c- p>);</c->
  <c- p>}</c-> <c- k>else</c-> <c- k>if</c-> <c- p>(</c-><c- o>!</c->persisted <c- o>&amp;&amp;</c-> permission<c- p>.</c->state <c- o>==</c-> <c- u>"prompt"</c-><c- p>)</c-> <c- p>{</c->
    showPersistentStorageExplanation<c- p>();</c->
  <c- p>}</c->
<c- p>});</c->
</code></pre>
    <p>The <code class="idl"><a data-link-type="idl" href="#dom-storagemanager-estimate" id="ref-for-dom-storagemanager-estimate">estimate()</a></code> method can be used to determine whether there is enough space left to
 store content for an application: </p>
<pre><code class="lang-javascript highlight"><c- a>function</c-> retrieveNextChunk<c- p>(</c->nextChunkInfo<c- p>)</c-> <c- p>{</c->
  <c- k>return</c-> navigator<c- p>.</c->storage<c- p>.</c->estimate<c- p>().</c->then<c- p>(</c->info <c- p>=></c-> <c- p>{</c->
    <c- k>if</c-> <c- p>(</c->info<c- p>.</c->quota <c- o>-</c-> info<c- p>.</c->usage <c- o>></c-> nextChunkInfo<c- p>.</c->size<c- p>)</c-> <c- p>{</c->
      <c- k>return</c-> fetch<c- p>(</c->nextChunkInfo<c- p>.</c->url<c- p>);</c->
    <c- p>}</c-> <c- k>else</c-> <c- p>{</c->
      <c- k>throw</c-> <c- ow>new</c-> <c- ne>Error</c-><c- p>(</c-><c- u>"insufficient space to store next chunk"</c-><c- p>);</c->
    <c- p>}</c->
  <c- p>}).</c->then<c- p>(</c-> <c- d>/* … */</c-> <c- p>);</c->
<c- p>}</c->
</code></pre>
   </div>
   <h2 class="heading settled" data-level="2" id="terminology"><span class="secno">2. </span><span class="content">Terminology</span><a class="self-link" href="#terminology"></a></h2>
   <p>This specification depends on the Infra Standard. <a data-link-type="biblio" href="#biblio-infra" title="Infra Standard">[INFRA]</a> </p>
   <p>This specification uses terminology from the HTML, IDL, and Permissions Standards. <a data-link-type="biblio" href="#biblio-html" title="HTML Standard">[HTML]</a> <a data-link-type="biblio" href="#biblio-webidl" title="Web IDL Standard">[WEBIDL]</a> <a data-link-type="biblio" href="#biblio-permissions" title="Permissions">[PERMISSIONS]</a> </p>
   <h2 class="heading settled" data-level="3" id="infrastructure"><span class="secno">3. </span><span class="content">Lay of the land</span><a class="self-link" href="#infrastructure"></a></h2>
   <p>A <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#user-agent" id="ref-for-user-agent">user agent</a> has various kinds of semi-persistent state: </p>
   <dl>
    <dt>Credentials 
    <dd>
     <p>End-user credentials, such as username and passwords submitted through HTML forms </p>
    <dt>Permissions 
    <dd>
     <p>Permissions for various features, such as geolocation </p>
    <dt>Network 
    <dd>
     <p>HTTP cache, cookies, authentication entries, TLS client certificates </p>
    <dt id="site-storage"><a class="self-link" href="#site-storage"></a>Storage 
    <dd>Indexed DB, Cache API, service worker registrations, <code>localStorage</code>, <code>sessionStorage</code>, application caches, notifications, etc. 
   </dl>
   <p>This standard primarily concerns itself with storage. </p>
   <h2 class="heading settled" data-level="4" id="model"><span class="secno">4. </span><span class="content">Model</span><a class="self-link" href="#model"></a></h2>
   <p>Standards defining local or session storage APIs will define a <a data-link-type="dfn" href="#storage-endpoint" id="ref-for-storage-endpoint">storage endpoint</a> and <a data-link-type="dfn" href="#registered-storage-endpoints" id="ref-for-registered-storage-endpoints">register</a> it by changing this standard. They will invoke
either the <a data-link-type="dfn" href="#obtain-a-local-storage-bottle-map" id="ref-for-obtain-a-local-storage-bottle-map">obtain a local storage bottle map</a> or the <a data-link-type="dfn" href="#obtain-a-session-storage-bottle-map" id="ref-for-obtain-a-session-storage-bottle-map">obtain a session storage bottle map</a> algorithm, which will give them: </p>
   <ul>
    <li>
     <p>Failure, which might mean the API has to throw or otherwise indicate there is no storage
 available for that <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object" id="ref-for-environment-settings-object">environment settings object</a>. </p>
    <li>
     <p>A <a data-link-type="dfn" href="#storage-proxy-map" id="ref-for-storage-proxy-map">storage proxy map</a> that operates analogously to a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map" id="ref-for-ordered-map">map</a>, which can be
 used to store data in a manner that suits the API. This standard takes care of isolating that data
 from other APIs, <a data-link-type="dfn" href="#storage-key" id="ref-for-storage-key">storage keys</a>, and <a data-link-type="dfn" href="#storage-type" id="ref-for-storage-type">storage types</a>. </p>
   </ul>
   <p class="note" role="note">If you are defining a standard for such an API, consider filing an issue against this
standard for assistance and review. </p>
   <p>To isolate this data this standard defines a <a data-link-type="dfn" href="#storage-shed" id="ref-for-storage-shed">storage shed</a> which segments <a data-link-type="dfn" href="#storage-shelf" id="ref-for-storage-shelf">storage shelves</a> by a <a data-link-type="dfn" href="#storage-key" id="ref-for-storage-key①">storage key</a>. A <a data-link-type="dfn" href="#storage-shelf" id="ref-for-storage-shelf①">storage shelf</a> in turn consists of a <a data-link-type="dfn" href="#storage-bucket" id="ref-for-storage-bucket">storage bucket</a> and will likely consist of multiple <a data-link-type="dfn" href="#storage-bucket" id="ref-for-storage-bucket①">storage buckets</a> in the future to
allow for different storage policies. And lastly, a <a data-link-type="dfn" href="#storage-bucket" id="ref-for-storage-bucket②">storage bucket</a> consists of <a data-link-type="dfn" href="#storage-bottle" id="ref-for-storage-bottle">storage bottles</a>, one for each <a data-link-type="dfn" href="#storage-endpoint" id="ref-for-storage-endpoint①">storage endpoint</a>. </p>
   <h3 class="heading settled" data-level="4.1" id="storage-endpoints"><span class="secno">4.1. </span><span class="content">Storage endpoints</span><a class="self-link" href="#storage-endpoints"></a></h3>
   <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-export id="storage-endpoint">storage endpoint</dfn> is a <a data-link-type="dfn" href="#local-storage" id="ref-for-local-storage">local</a> or <a data-link-type="dfn" href="#session-storage" id="ref-for-session-storage">session storage</a> API that uses the infrastructure defined by this standard, most notably <a data-link-type="dfn" href="#storage-bottle" id="ref-for-storage-bottle①">storage bottles</a>, to keep track of its storage needs. </p>
   <p>A <a data-link-type="dfn" href="#storage-endpoint" id="ref-for-storage-endpoint②">storage endpoint</a> has an <dfn class="dfn-paneled" data-dfn-for="storage endpoint" data-dfn-type="dfn" data-noexport id="storage-endpoint-identifier">identifier</dfn>, which is a <a data-link-type="dfn" href="#storage-identifier" id="ref-for-storage-identifier">storage identifier</a>. </p>
   <p>A <a data-link-type="dfn" href="#storage-endpoint" id="ref-for-storage-endpoint③">storage endpoint</a> also has <dfn class="dfn-paneled" data-dfn-for="storage endpoint" data-dfn-type="dfn" data-noexport id="storage-endpoint-types">types</dfn>, which is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-set" id="ref-for-ordered-set">set</a> of <a data-link-type="dfn" href="#storage-type" id="ref-for-storage-type①">storage types</a>. </p>
   <p>A <a data-link-type="dfn" href="#storage-endpoint" id="ref-for-storage-endpoint④">storage endpoint</a> also has a <dfn class="dfn-paneled" data-dfn-for="storage endpoint" data-dfn-type="dfn" data-noexport id="storage-endpoint-quota">quota</dfn>, which is null or a
number representing a recommended <a data-link-type="dfn" href="#storage-bottle-quota" id="ref-for-storage-bottle-quota">quota</a> (in bytes) for each <a data-link-type="dfn" href="#storage-bottle" id="ref-for-storage-bottle②">storage bottle</a> corresponding to this <a data-link-type="dfn" href="#storage-endpoint" id="ref-for-storage-endpoint⑤">storage endpoint</a>. </p>
   <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="storage-identifier">storage identifier</dfn> is an <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ascii-string" id="ref-for-ascii-string">ASCII string</a>. </p>
   <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="storage-type">storage type</dfn> is "<code>local</code>" or "<code>session</code>". </p>
   <hr>
   <p>The <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="registered-storage-endpoints">registered storage endpoints</dfn> are a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-set" id="ref-for-ordered-set①">set</a> of <a data-link-type="dfn" href="#storage-endpoint" id="ref-for-storage-endpoint⑥">storage endpoints</a> defined by the following table: </p>
   <table>
    <tbody>
     <tr>
      <th><a data-link-type="dfn" href="#storage-endpoint-identifier" id="ref-for-storage-endpoint-identifier">Identifier</a> 
      <th><a data-link-type="dfn" href="#storage-endpoint-types" id="ref-for-storage-endpoint-types">Type</a> 
      <th><a data-link-type="dfn" href="#storage-endpoint-quota" id="ref-for-storage-endpoint-quota">Quota</a> 
     <tr>
      <td>"<code>caches</code>" 
      <td>« "<code>local</code>" » 
      <td>null 
     <tr>
      <td>"<code>indexedDB</code>" 
      <td>« "<code>local</code>" » 
      <td>null 
     <tr>
      <td>"<code>localStorage</code>" 
      <td>« "<code>local</code>" » 
      <td>5 × 2<sup>20</sup> (i.e., 5 mebibytes) 
     <tr>
      <td>"<code>serviceWorkerRegistrations</code>" 
      <td>« "<code>local</code>" » 
      <td>null 
     <tr>
      <td>"<code>sessionStorage</code>" 
      <td>« "<code>session</code>" » 
      <td>5 × 2<sup>20</sup> (i.e., 5 mebibytes) 
   </table>
   <p class="note" role="note">As mentioned, standards can use these <a data-link-type="dfn" href="#storage-identifier" id="ref-for-storage-identifier①">storage identifiers</a> with <a data-link-type="dfn" href="#obtain-a-local-storage-bottle-map" id="ref-for-obtain-a-local-storage-bottle-map①">obtain a local storage bottle map</a> and <a data-link-type="dfn" href="#obtain-a-session-storage-bottle-map" id="ref-for-obtain-a-session-storage-bottle-map①">obtain a session storage bottle map</a>. It is
anticipated that some APIs will be applicable to both <a data-link-type="dfn" href="#storage-type" id="ref-for-storage-type②">storage types</a> going forward. </p>
   <h3 class="heading settled" data-level="4.2" id="storage-keys"><span class="secno">4.2. </span><span class="content">Storage keys</span><a class="self-link" href="#storage-keys"></a></h3>
   <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="storage-key">storage key</dfn> is an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin" id="ref-for-concept-origin①">origin</a>. <a data-link-type="biblio" href="#biblio-html" title="HTML Standard">[HTML]</a> </p>
   <p class="XXX">This is expected to change; see <a href="https://privacycg.github.io/storage-partitioning/">Client-Side Storage Partitioning</a>. </p>
   <p>To <dfn class="dfn-paneled" data-dfn-type="dfn" data-export id="obtain-a-storage-key">obtain a storage key</dfn>, given an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object" id="ref-for-environment-settings-object①">environment settings object</a> <var>environment</var>, run these steps: </p>
   <ol>
    <li>
     <p>Let <var>key</var> be <var>environment</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin" id="ref-for-concept-settings-object-origin">origin</a>. </p>
    <li>
     <p>If <var>key</var> is an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-opaque" id="ref-for-concept-origin-opaque">opaque origin</a>, then return failure. </p>
    <li>
     <p>If the user has disabled storage, then return failure. </p>
    <li>
     <p>Return <var>key</var>. </p>
   </ol>
   <h3 class="heading settled" data-level="4.3" id="storage-sheds"><span class="secno">4.3. </span><span class="content">Storage sheds</span><a class="self-link" href="#storage-sheds"></a></h3>
   <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="storage-shed">storage shed</dfn> is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map" id="ref-for-ordered-map①">map</a> of <a data-link-type="dfn" href="#storage-key" id="ref-for-storage-key②">storage keys</a> to <a data-link-type="dfn" href="#storage-shelf" id="ref-for-storage-shelf②">storage shelves</a>.
It is initially empty. </p>
   <hr>
   <p>A <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#user-agent" id="ref-for-user-agent①">user agent</a> holds a <dfn class="dfn-paneled" data-dfn-for="user agent" data-dfn-type="dfn" data-noexport id="user-agent-storage-shed">storage shed</dfn>, which is a <a data-link-type="dfn" href="#storage-shed" id="ref-for-storage-shed①">storage shed</a>. A user agent’s <a data-link-type="dfn" href="#user-agent-storage-shed" id="ref-for-user-agent-storage-shed">storage shed</a> holds all <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="local-storage">local storage</dfn> data. </p>
   <p>A <a data-link-type="dfn">browsing session</a> holds a <dfn class="dfn-paneled" data-dfn-for="browsing session" data-dfn-type="dfn" data-noexport id="browsing-session-storage-shed">storage shed</dfn>, which is
a <a data-link-type="dfn" href="#storage-shed" id="ref-for-storage-shed②">storage shed</a>. A <a data-link-type="dfn">browsing session</a>’s <a data-link-type="dfn" href="#browsing-session-storage-shed" id="ref-for-browsing-session-storage-shed">storage shed</a> holds all <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="session-storage">session storage</dfn> data. </p>
   <p>To <dfn data-dfn-type="dfn" data-export id="legacy-clone-a-browsing-session-storage-shed">legacy-clone a browsing session storage shed<a class="self-link" href="#legacy-clone-a-browsing-session-storage-shed"></a></dfn>, given a <a data-link-type="dfn">browsing session</a> <var>A</var> and a <a data-link-type="dfn">browsing session</a> <var>B</var>, run
these steps: </p>
   <ol>
    <li>
     <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-iterate" id="ref-for-map-iterate">For each</a> <var>key</var> → <var>shelf</var> of <var>A</var>’s <a data-link-type="dfn" href="#browsing-session-storage-shed" id="ref-for-browsing-session-storage-shed①">storage shed</a>: </p>
     <ol>
      <li>
       <p>Let <var>newShelf</var> be the result of running <a data-link-type="dfn" href="#create-a-storage-shelf" id="ref-for-create-a-storage-shelf">create a storage shelf</a> with
   "<code>session</code>". </p>
      <li>
       <p>Set <var>newShelf</var>’s <a data-link-type="dfn" href="#bucket-map" id="ref-for-bucket-map">bucket map</a>["<code>default</code>"]'s <a data-link-type="dfn" href="#bottle-map" id="ref-for-bottle-map">bottle map</a>["<code>sessionStorage</code>"]'s <a data-link-type="dfn" href="#storage-bottle-map" id="ref-for-storage-bottle-map">map</a> to a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-clone" id="ref-for-map-clone">clone</a> of <var>shelf</var>’s <a data-link-type="dfn" href="#bucket-map" id="ref-for-bucket-map①">bucket map</a>["<code>default</code>"]'s <a data-link-type="dfn" href="#bottle-map" id="ref-for-bottle-map①">bottle map</a>["<code>sessionStorage</code>"]'s <a data-link-type="dfn" href="#storage-bottle-map" id="ref-for-storage-bottle-map①">map</a>. </p>
      <li>
       <p>Set <var>B</var>’s <a data-link-type="dfn" href="#browsing-session-storage-shed" id="ref-for-browsing-session-storage-shed②">storage shed</a>[<var>key</var>] to <var>newShelf</var>. </p>
     </ol>
   </ol>
   <p class="note" role="note">This is considered legacy as the benefits, if any, do not outweigh the
implementation complexity. And therefore it will not be expanded or used outside of <cite>HTML</cite>. <a data-link-type="biblio" href="#biblio-html" title="HTML Standard">[HTML]</a> </p>
   <h3 class="heading settled" data-level="4.4" id="storage-shelves"><span class="secno">4.4. </span><span class="content">Storage shelves</span><a class="self-link" href="#storage-shelves"></a></h3>
   <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="storage shelf|storage shelves" data-noexport id="storage-shelf">storage shelf<span id="site-storage-unit"></span></dfn> exists for
each <a data-link-type="dfn" href="#storage-key" id="ref-for-storage-key③">storage key</a> within a <a data-link-type="dfn" href="#storage-shed" id="ref-for-storage-shed③">storage shed</a>. It holds a <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="bucket-map">bucket map</dfn>,
which is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map" id="ref-for-ordered-map②">map</a> of <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#string" id="ref-for-string">strings</a> to <a data-link-type="dfn" href="#storage-bucket" id="ref-for-storage-bucket③">storage buckets</a>. </p>
   <p class="note" role="note">For now "<code>default</code>" is the only <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-key" id="ref-for-map-key">key</a> that exists in a <a data-link-type="dfn" href="#bucket-map" id="ref-for-bucket-map②">bucket map</a>. See <a href="https://github.com/whatwg/storage/issues/2">issue #2</a>. It is
given a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-value" id="ref-for-map-value">value</a> when a <a data-link-type="dfn" href="#storage-shelf" id="ref-for-storage-shelf③">storage shelf</a> is <a data-link-type="dfn" href="#obtain-a-storage-shelf" id="ref-for-obtain-a-storage-shelf">obtained</a> for the first time. </p>
   <p>To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="obtain-a-storage-shelf">obtain a storage shelf</dfn>, given a <a data-link-type="dfn" href="#storage-shed" id="ref-for-storage-shed④">storage shed</a> <var>shed</var>, an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object" id="ref-for-environment-settings-object②">environment settings object</a> <var>environment</var>, and a <a data-link-type="dfn" href="#storage-type" id="ref-for-storage-type③">storage type</a> <var>type</var>, run these steps: </p>
   <ol>
    <li>
     <p>Let <var>key</var> be the result of running <a data-link-type="dfn" href="#obtain-a-storage-key" id="ref-for-obtain-a-storage-key">obtain a storage key</a> with <var>environment</var>. </p>
    <li>
     <p>If <var>key</var> is failure, then return failure. </p>
    <li>
     <p>If <var>shed</var>[<var>key</var>] does not <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-exists" id="ref-for-map-exists">exist</a>, then set <var>shed</var>[<var>key</var>] to the result of running <a data-link-type="dfn" href="#create-a-storage-shelf" id="ref-for-create-a-storage-shelf①">create a storage shelf</a> with <var>type</var>. </p>
    <li>
     <p>Return <var>shed</var>[<var>key</var>]. </p>
   </ol>
   <p>To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="obtain-a-local-storage-shelf">obtain a local storage shelf</dfn>, given an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object" id="ref-for-environment-settings-object③">environment settings object</a> <var>environment</var>, return the result of running <a data-link-type="dfn" href="#obtain-a-storage-shelf" id="ref-for-obtain-a-storage-shelf①">obtain a storage shelf</a> with the user
agent’s <a data-link-type="dfn" href="#user-agent-storage-shed" id="ref-for-user-agent-storage-shed①">storage shed</a>, <var>environment</var>, and "<code>local</code>". </p>
   <p>To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="create-a-storage-shelf">create a storage shelf</dfn>, given a <a data-link-type="dfn" href="#storage-type" id="ref-for-storage-type④">storage type</a> <var>type</var>, run these
steps: </p>
   <ol>
    <li>
     <p>Let <var>shelf</var> be a new <a data-link-type="dfn" href="#storage-shelf" id="ref-for-storage-shelf④">storage shelf</a>. </p>
    <li>
     <p>Set <var>shelf</var>’s <a data-link-type="dfn" href="#bucket-map" id="ref-for-bucket-map③">bucket map</a>["<code>default</code>"] to the result of running <a data-link-type="dfn" href="#create-a-storage-bucket" id="ref-for-create-a-storage-bucket">create a storage bucket</a> with <var>type</var>. </p>
    <li>
     <p>Return <var>shelf</var>. </p>
   </ol>
   <h3 class="heading settled" data-level="4.5" id="buckets"><span class="secno">4.5. </span><span class="content">Storage buckets</span><span id="boxes"></span><a class="self-link" href="#buckets"></a></h3>
   <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="storage-bucket">storage bucket</dfn> is a place for <a data-link-type="dfn" href="#storage-endpoint" id="ref-for-storage-endpoint⑦">storage endpoints</a> to store data. </p>
   <p>A <a data-link-type="dfn" href="#storage-bucket" id="ref-for-storage-bucket④">storage bucket</a> has a <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="bottle-map">bottle map</dfn> of <a data-link-type="dfn" href="#storage-identifier" id="ref-for-storage-identifier②">storage identifiers</a> to <a data-link-type="dfn" href="#storage-bottle" id="ref-for-storage-bottle③">storage bottles</a>. </p>
   <hr>
   <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="bucket">local storage bucket<span id="box"></span></dfn> is a <a data-link-type="dfn" href="#storage-bucket" id="ref-for-storage-bucket⑤">storage bucket</a> for <a data-link-type="dfn" href="#local-storage" id="ref-for-local-storage①">local storage</a> APIs. </p>
   <p>A <a data-link-type="dfn" href="#bucket" id="ref-for-bucket">local storage bucket</a> has a <dfn class="dfn-paneled" data-dfn-for="local storage bucket" data-dfn-type="dfn" data-noexport id="bucket-mode">mode<span id="box-mode"></span></dfn>, which is
"<code>best-effort</code>" or "<code>persistent</code>". It is initially "<code>best-effort</code>". </p>
   <hr>
   <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="session-storage-bucket">session storage bucket</dfn> is a <a data-link-type="dfn" href="#storage-bucket" id="ref-for-storage-bucket⑥">storage bucket</a> for <a data-link-type="dfn" href="#session-storage" id="ref-for-session-storage①">session storage</a> APIs. </p>
   <hr>
   <p>To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="create-a-storage-bucket">create a storage bucket</dfn>, given a <a data-link-type="dfn" href="#storage-type" id="ref-for-storage-type⑤">storage type</a> <var>type</var>, run these
steps: </p>
   <ol>
    <li>
     <p>Let <var>bucket</var> be null. </p>
    <li>
     <p>If <var>type</var> is "<code>local</code>", then set <var>bucket</var> to a new <a data-link-type="dfn" href="#bucket" id="ref-for-bucket①">local storage bucket</a>. </p>
    <li>
     <p>Otherwise: </p>
     <ol>
      <li>
       <p>Assert: <var>type</var> is "<code>session</code>". </p>
      <li>
       <p>Set <var>bucket</var> to a new <a data-link-type="dfn" href="#session-storage-bucket" id="ref-for-session-storage-bucket">session storage bucket</a>. </p>
     </ol>
    <li>
     <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-iterate" id="ref-for-list-iterate">For each</a> <var>endpoint</var> of <a data-link-type="dfn" href="#registered-storage-endpoints" id="ref-for-registered-storage-endpoints①">registered storage endpoints</a> whose <a data-link-type="dfn" href="#storage-endpoint-types" id="ref-for-storage-endpoint-types①">types</a> <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-contain" id="ref-for-list-contain">contain</a> <var>type</var>, set <var>bucket</var>’s <a data-link-type="dfn" href="#bottle-map" id="ref-for-bottle-map②">bottle map</a>[<var>endpoint</var>’s <a data-link-type="dfn" href="#storage-endpoint-identifier" id="ref-for-storage-endpoint-identifier①">identifier</a>] to a new <a data-link-type="dfn" href="#storage-bottle" id="ref-for-storage-bottle④">storage bottle</a> whose <a data-link-type="dfn" href="#storage-bottle-quota" id="ref-for-storage-bottle-quota①">quota</a> is <var>endpoint</var>’s <a data-link-type="dfn" href="#storage-endpoint-quota" id="ref-for-storage-endpoint-quota①">quota</a>. </p>
    <li>
     <p>Return <var>bucket</var>. </p>
   </ol>
   <h3 class="heading settled" data-level="4.6" id="storage-bottles"><span class="secno">4.6. </span><span class="content">Storage bottles</span><a class="self-link" href="#storage-bottles"></a></h3>
   <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="storage-bottle">storage bottle</dfn> is a part of a <a data-link-type="dfn" href="#storage-bucket" id="ref-for-storage-bucket⑦">storage bucket</a> carved out for a single <a data-link-type="dfn" href="#storage-endpoint" id="ref-for-storage-endpoint⑧">storage endpoint</a>. A <a data-link-type="dfn" href="#storage-bottle" id="ref-for-storage-bottle⑤">storage bottle</a> has a <dfn class="dfn-paneled" data-dfn-for="storage bottle" data-dfn-type="dfn" data-noexport id="storage-bottle-map">map</dfn>, which is
initially an empty <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map" id="ref-for-ordered-map③">map</a>. A <a data-link-type="dfn" href="#storage-bottle" id="ref-for-storage-bottle⑥">storage bottle</a> also has a <dfn class="dfn-paneled" data-dfn-for="storage bottle" data-dfn-type="dfn" data-noexport id="storage-bottle-proxy-map-reference-set">proxy map reference set</dfn>, which is initially an empty <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-set" id="ref-for-ordered-set②">set</a>. A <a data-link-type="dfn" href="#storage-bottle" id="ref-for-storage-bottle⑦">storage bottle</a> also has a <dfn class="dfn-paneled" data-dfn-for="storage bottle" data-dfn-type="dfn" data-noexport id="storage-bottle-quota">quota</dfn>, which is
null or a number representing a conservative estimate of the total amount of bytes it can hold. Null
indicates the lack of a limit. <span class="note">It is still bound by the <a data-link-type="dfn" href="#storage-quota" id="ref-for-storage-quota">storage quota</a> of its
encompassing <a data-link-type="dfn" href="#storage-shelf" id="ref-for-storage-shelf⑤">storage shelf</a>. </span></p>
   <p>A <a data-link-type="dfn" href="#storage-bottle" id="ref-for-storage-bottle⑧">storage bottle</a>’s <a data-link-type="dfn" href="#storage-bottle-map" id="ref-for-storage-bottle-map②">map</a> is where the actual data meant to be
stored lives. User agents are expected to store this data, and make it available across <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#sec-agents" id="ref-for-sec-agents">agent</a> and even <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#sec-agent-clusters" id="ref-for-sec-agent-clusters">agent cluster</a> boundaries, in an <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#implementation-defined" id="ref-for-implementation-defined">implementation-defined</a> manner, so that this
standard and standards using this standard can access the contents. </p>
   <hr>
   <p>To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="obtain-a-storage-bottle-map">obtain a storage bottle map</dfn>, given a <a data-link-type="dfn" href="#storage-type" id="ref-for-storage-type⑥">storage type</a> <var>type</var>, <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object" id="ref-for-environment-settings-object④">environment settings object</a> <var>environment</var>, and <a data-link-type="dfn" href="#storage-identifier" id="ref-for-storage-identifier③">storage identifier</a> <var>identifier</var>, run these steps:</p>
   <ol>
    <li>
     <p>Let <var>shed</var> be null. </p>
    <li>
     <p>If <var>type</var> is "<code>local</code>", then set <var>shed</var> to the user agent’s <a data-link-type="dfn" href="#user-agent-storage-shed" id="ref-for-user-agent-storage-shed②">storage shed</a>. </p>
    <li>
     <p>Otherwise: </p>
     <ol>
      <li>
       <p>Assert: <var>type</var> is "<code>session</code>". </p>
      <li>
       <p>Set <var>shed</var> to <var>environment</var>’s <a data-link-type="dfn">browsing session</a>’s <a data-link-type="dfn" href="#browsing-session-storage-shed" id="ref-for-browsing-session-storage-shed③">storage shed</a>. </p>
     </ol>
    <li>
     <p>Let <var>shelf</var> be the result of running <a data-link-type="dfn" href="#obtain-a-storage-shelf" id="ref-for-obtain-a-storage-shelf②">obtain a storage shelf</a>, with <var>shed</var>, <var>environment</var>, and <var>type</var>. </p>
    <li>
     <p>If <var>shelf</var> is failure, then return failure. </p>
    <li>
     <p>Let <var>bucket</var> be <var>shelf</var>’s <a data-link-type="dfn" href="#bucket-map" id="ref-for-bucket-map④">bucket map</a>["<code>default</code>"]. </p>
    <li>
     <p>Let <var>bottle</var> be <var>bucket</var>’s <a data-link-type="dfn" href="#bottle-map" id="ref-for-bottle-map③">bottle map</a>[<var>identifier</var>]. </p>
    <li>
     <p>Let <var>proxyMap</var> be a new <a data-link-type="dfn" href="#storage-proxy-map" id="ref-for-storage-proxy-map①">storage proxy map</a> whose <a data-link-type="dfn" href="#storage-proxy-map-backing-map" id="ref-for-storage-proxy-map-backing-map">backing map</a> is <var>bottle</var>’s <a data-link-type="dfn" href="#storage-bottle-map" id="ref-for-storage-bottle-map③">map</a>. </p>
    <li>
     <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#set-append" id="ref-for-set-append">Append</a> <var>proxyMap</var> to <var>bottle</var>’s <a data-link-type="dfn" href="#storage-bottle-proxy-map-reference-set" id="ref-for-storage-bottle-proxy-map-reference-set">proxy map reference set</a>. </p>
    <li>
     <p>Return <var>proxyMap</var>. </p>
   </ol>
   <p>To <dfn class="dfn-paneled" data-dfn-type="dfn" data-export id="obtain-a-local-storage-bottle-map">obtain a local storage bottle map</dfn>, given an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object" id="ref-for-environment-settings-object⑤">environment settings object</a> <var>environment</var> and <a data-link-type="dfn" href="#storage-identifier" id="ref-for-storage-identifier④">storage identifier</a> <var>identifier</var>, return the result of running <a data-link-type="dfn" href="#obtain-a-storage-bottle-map" id="ref-for-obtain-a-storage-bottle-map">obtain a storage bottle map</a> with
"<code>local</code>", <var>environment</var>, and <var>identifier</var>. </p>
   <p>To <dfn class="dfn-paneled" data-dfn-type="dfn" data-export id="obtain-a-session-storage-bottle-map">obtain a session storage bottle map</dfn>, given an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object" id="ref-for-environment-settings-object⑥">environment settings object</a> <var>environment</var> and <a data-link-type="dfn" href="#storage-identifier" id="ref-for-storage-identifier⑤">storage identifier</a> <var>identifier</var>, return the result of running <a data-link-type="dfn" href="#obtain-a-storage-bottle-map" id="ref-for-obtain-a-storage-bottle-map①">obtain a storage bottle map</a> with
"<code>session</code>", <var>environment</var>, and <var>identifier</var>. </p>
   <h3 class="heading settled" data-level="4.7" id="storage-proxy-maps"><span class="secno">4.7. </span><span class="content">Storage proxy maps</span><a class="self-link" href="#storage-proxy-maps"></a></h3>
   <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="storage-proxy-map">storage proxy map</dfn> is equivalent to a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map" id="ref-for-ordered-map④">map</a>, except that all operations
are instead performed on its <dfn class="dfn-paneled" data-dfn-for="storage proxy map" data-dfn-type="dfn" data-noexport id="storage-proxy-map-backing-map">backing map</dfn>. </p>
   <p class="XXX">This allows for the <a data-link-type="dfn" href="#storage-proxy-map-backing-map" id="ref-for-storage-proxy-map-backing-map①">backing map</a> to be replaced. This
is needed for <a href="https://github.com/whatwg/storage/issues/4">issue #4</a> and potentially the <a href="https://privacycg.github.io/storage-access/">Storage Access API</a>. </p>
   <h2 class="heading settled" data-level="5" id="persistence"><span class="secno">5. </span><span class="content">Persistence permission</span><a class="self-link" href="#persistence"></a></h2>
   <p>A <a data-link-type="dfn" href="#bucket" id="ref-for-bucket②">local storage bucket</a> can only have its <a data-link-type="dfn" href="#bucket-mode" id="ref-for-bucket-mode">mode</a> change to
"<code>persistent</code>" if the user (or user agent on behalf of the user) has granted permission
to use the "<code class="idl"><a data-link-type="idl">persistent-storage</a></code>" feature. </p>
   <p class="note" role="note">When granted to an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin" id="ref-for-concept-origin②">origin</a>, the persistence permission can be used to
protect storage from the user agent’s clearing policies. The user agent cannot clear storage marked
as persistent without involvement from the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin" id="ref-for-concept-origin③">origin</a> or user. This makes it particularly
useful for resources the user needs to have available while offline or resources the user creates
locally. </p>
   <p>The "<code class="idl"><a data-link-type="idl">persistent-storage</a></code>" <a data-link-type="dfn" href="https://w3c.github.io/permissions/#dfn-powerful-feature" id="ref-for-dfn-powerful-feature">powerful feature</a>’s permission-related flags, algorithms, and types are defaulted, except for: </p>
   <dl>
    <dt><a data-link-type="dfn" href="https://w3c.github.io/permissions/#dfn-permission-state" id="ref-for-dfn-permission-state">permission state</a> 
    <dd>
     <p>"<code class="idl"><a data-link-type="idl">persistent-storage</a></code>"'s <a data-link-type="dfn" href="https://w3c.github.io/permissions/#dfn-permission-state" id="ref-for-dfn-permission-state①">permission state</a> must have the same value for all <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object" id="ref-for-environment-settings-object⑦">environment settings objects</a> with a given <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin" id="ref-for-concept-settings-object-origin①">origin</a>. </p>
    <dt><a data-link-type="dfn" href="https://w3c.github.io/permissions/#dfn-permission-revocation-algorithm" id="ref-for-dfn-permission-revocation-algorithm">permission revocation algorithm</a> 
    <dd class="algorithm" data-algorithm="permission-revocation">
     <ol>
      <li>
       <p>If "<code class="idl"><a data-link-type="idl">persistent-storage</a></code>"'s <a data-link-type="dfn" href="https://w3c.github.io/permissions/#dfn-permission-state" id="ref-for-dfn-permission-state②">permission state</a> is <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/permissions/#dom-permissionstate-granted" id="ref-for-dom-permissionstate-granted">"granted"</a></code>,
   then return. </p>
      <li>
       <p>Let <var>shelf</var> be the result of running <a data-link-type="dfn" href="#obtain-a-local-storage-shelf" id="ref-for-obtain-a-local-storage-shelf">obtain a local storage shelf</a> with <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#current-settings-object" id="ref-for-current-settings-object">current settings object</a>. </p>
      <li>
       <p>Set <var>shelf</var>’s <a data-link-type="dfn" href="#bucket-map" id="ref-for-bucket-map⑤">bucket map</a>["<code>default</code>"]'s <a data-link-type="dfn" href="#bucket-mode" id="ref-for-bucket-mode①">mode</a> to "<code>best-effort</code>". </p>
     </ol>
   </dl>
   <h2 class="heading settled" data-level="6" id="usage-and-quota"><span class="secno">6. </span><span class="content">Usage and quota</span><a class="self-link" href="#usage-and-quota"></a></h2>
   <p>The <dfn class="dfn-paneled" data-dfn-type="dfn" data-export id="storage-usage">storage usage</dfn> of a <a data-link-type="dfn" href="#storage-shelf" id="ref-for-storage-shelf⑥">storage shelf</a> is an <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#implementation-defined" id="ref-for-implementation-defined①">implementation-defined</a> rough estimate of the amount of bytes used by it. </p>
   <p class="note" role="note">This cannot be an exact amount as user agents might, and are encouraged to, use
deduplication, compression, and other techniques that obscure exactly how much bytes a <a data-link-type="dfn" href="#storage-shelf" id="ref-for-storage-shelf⑦">storage shelf</a> uses. </p>
   <p><a class="tracking-vector" href="https://infra.spec.whatwg.org/#tracking-vector"><img alt="(This is a tracking vector.)" crossorigin height="64" src="https://resources.whatwg.org/tracking-vector.svg" title="There is a tracking vector here." width="46"></a> The <dfn class="dfn-paneled" data-dfn-type="dfn" data-export id="storage-quota">storage quota</dfn> of a <a data-link-type="dfn" href="#storage-shelf" id="ref-for-storage-shelf⑧">storage shelf</a> is an <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#implementation-defined" id="ref-for-implementation-defined②">implementation-defined</a> conservative estimate of the total amount of bytes it can hold. This
amount should be less than the total storage space on the device. It must not be a function of the
available storage space on the device. </p>
   <div class="note" role="note">
    <p>User agents are strongly encouraged to consider navigation frequency, recency of visits,
 bookmarking, and <a href="#persistence">permission</a> for "<code class="idl"><a data-link-type="idl">persistent-storage</a></code>" when
 determining quotas. </p>
    <p>Directly or indirectly revealing available storage space can lead to fingerprinting and leaking
 information outside the scope of the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin" id="ref-for-concept-origin④">origin</a> involved. </p>
   </div>
   <h2 class="heading settled" data-level="7" id="management"><span class="secno">7. </span><span class="content">Management</span><a class="self-link" href="#management"></a></h2>
   <p>Whenever a <a data-link-type="dfn" href="#storage-bucket" id="ref-for-storage-bucket⑧">storage bucket</a> is cleared by the user agent, it must be cleared in its
entirety. User agents should avoid clearing <a data-link-type="dfn" href="#storage-bucket" id="ref-for-storage-bucket⑨">storage buckets</a> while script that is able to
access them is running, unless instructed otherwise by the user. </p>
   <p>If removal of <a data-link-type="dfn" href="#storage-bucket" id="ref-for-storage-bucket①⓪">storage buckets</a> leaves the encompassing <a data-link-type="dfn" href="#storage-shelf" id="ref-for-storage-shelf⑨">storage shelf</a>’s <a data-link-type="dfn" href="#bucket-map" id="ref-for-bucket-map⑥">bucket map</a> <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-is-empty" id="ref-for-map-is-empty">empty</a>, then <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-remove" id="ref-for-map-remove">remove</a> that <a data-link-type="dfn" href="#storage-shelf" id="ref-for-storage-shelf①⓪">storage shelf</a> and corresponding <a data-link-type="dfn" href="#storage-key" id="ref-for-storage-key④">storage key</a> from the encompassing <a data-link-type="dfn" href="#storage-shed" id="ref-for-storage-shed⑤">storage shed</a>. </p>
   <h3 class="heading settled" data-level="7.1" id="storage-pressure"><span class="secno">7.1. </span><span class="content">Storage pressure</span><a class="self-link" href="#storage-pressure"></a></h3>
   <p>A user agent that comes under storage pressure should clear network state and <a data-link-type="dfn" href="#bucket" id="ref-for-bucket③">local storage buckets</a> whose <a data-link-type="dfn" href="#bucket-mode" id="ref-for-bucket-mode②">mode</a> is
"<code>best-effort</code>", ideally prioritizing removal in a manner that least impacts the user. </p>
   <p>If a user agent continues to be under storage pressure, then the user agent should inform the
user and offer a way to clear the remaining <a data-link-type="dfn" href="#bucket" id="ref-for-bucket④">local storage buckets</a>, i.e., those whose <a data-link-type="dfn" href="#bucket-mode" id="ref-for-bucket-mode③">mode</a> is "<code>persistent</code>". </p>
   <p><a data-link-type="dfn" href="#session-storage-bucket" id="ref-for-session-storage-bucket①">Session storage buckets</a> must be cleared as <a data-link-type="dfn">browsing sessions</a> are closed. </p>
   <p class="note" role="note">If the user agent allows for revival of <a data-link-type="dfn">browsing sessions</a>, e.g.,
through reopening <a data-link-type="dfn">browsing sessions</a> or continued use of them after restarting the user
agent, then clearing necessarily involves a more complex set of heuristics. </p>
   <h3 class="heading settled" data-level="7.2" id="ui-guidelines"><span class="secno">7.2. </span><span class="content">User interface guidelines</span><a class="self-link" href="#ui-guidelines"></a></h3>
   <p>User agents should offer users the ability to clear network state and storage for individual
websites. User agents should not distinguish between network state and storage in their user
interface. This ensures network state cannot be used to revive storage and reduces the number of
concepts users need to be mindful of. </p>
   <p>Credentials should be separated as they contain data the user might not be able to revive, such
as an autogenerated password. Permissions are best separated too to avoid inconveniencing the user. </p>
   <h2 class="heading settled" data-level="8" id="api"><span class="secno">8. </span><span class="content">API</span><a class="self-link" href="#api"></a></h2>
<pre class="idl highlight def">[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#SecureContext" id="ref-for-SecureContext"><c- g>SecureContext</c-></a>]
<c- b>interface</c-> <c- b>mixin</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="interface" data-export id="navigatorstorage"><code><c- g>NavigatorStorage</c-></code></dfn> {
  [<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#SameObject" id="ref-for-SameObject"><c- g>SameObject</c-></a>] <c- b>readonly</c-> <c- b>attribute</c-> <a data-link-type="idl-name" href="#storagemanager" id="ref-for-storagemanager"><c- n>StorageManager</c-></a> <a class="idl-code" data-link-type="attribute" data-readonly data-type="StorageManager" href="#dom-navigatorstorage-storage" id="ref-for-dom-navigatorstorage-storage"><c- g>storage</c-></a>;
};
<a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/system-state.html#navigator" id="ref-for-navigator"><c- n>Navigator</c-></a> <c- b>includes</c-> <a data-link-type="idl-name" href="#navigatorstorage" id="ref-for-navigatorstorage"><c- n>NavigatorStorage</c-></a>;
<a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/workers.html#workernavigator" id="ref-for-workernavigator"><c- n>WorkerNavigator</c-></a> <c- b>includes</c-> <a data-link-type="idl-name" href="#navigatorstorage" id="ref-for-navigatorstorage①"><c- n>NavigatorStorage</c-></a>;
</pre>
   <p>Each <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object" id="ref-for-environment-settings-object⑧">environment settings object</a> has an associated <code class="idl"><a data-link-type="idl" href="#storagemanager" id="ref-for-storagemanager①">StorageManager</a></code> object. <a data-link-type="biblio" href="#biblio-html" title="HTML Standard">[HTML]</a> </p>
   <p>The <dfn class="dfn-paneled idl-code" data-dfn-for="NavigatorStorage" data-dfn-type="attribute" data-export id="dom-navigatorstorage-storage"><code>storage</code></dfn> getter steps are to return <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this">this</a>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object" id="ref-for-relevant-settings-object">relevant settings object</a>’s <code class="idl"><a data-link-type="idl" href="#storagemanager" id="ref-for-storagemanager②">StorageManager</a></code> object. </p>
<pre class="idl highlight def">[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#SecureContext" id="ref-for-SecureContext①"><c- g>SecureContext</c-></a>,
 <a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed" id="ref-for-Exposed"><c- g>Exposed</c-></a>=(<c- n>Window</c->,<c- n>Worker</c->)]
<c- b>interface</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="interface" data-export id="storagemanager"><code><c- g>StorageManager</c-></code></dfn> {
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise" id="ref-for-idl-promise"><c- b>Promise</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-boolean" id="ref-for-idl-boolean"><c- b>boolean</c-></a>> <a class="idl-code" data-link-type="method" href="#dom-storagemanager-persisted" id="ref-for-dom-storagemanager-persisted"><c- g>persisted</c-></a>();
  [<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed" id="ref-for-Exposed①"><c- g>Exposed</c-></a>=<c- n>Window</c->] <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise" id="ref-for-idl-promise①"><c- b>Promise</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-boolean" id="ref-for-idl-boolean①"><c- b>boolean</c-></a>> <a class="idl-code" data-link-type="method" href="#dom-storagemanager-persist" id="ref-for-dom-storagemanager-persist①"><c- g>persist</c-></a>();

  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise" id="ref-for-idl-promise②"><c- b>Promise</c-></a>&lt;<a data-link-type="idl-name" href="#dictdef-storageestimate" id="ref-for-dictdef-storageestimate"><c- n>StorageEstimate</c-></a>> <a class="idl-code" data-link-type="method" href="#dom-storagemanager-estimate" id="ref-for-dom-storagemanager-estimate①"><c- g>estimate</c-></a>();
};

<c- b>dictionary</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="dictionary" data-export id="dictdef-storageestimate"><code><c- g>StorageEstimate</c-></code></dfn> {
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-unsigned-long-long" id="ref-for-idl-unsigned-long-long"><c- b>unsigned</c-> <c- b>long</c-> <c- b>long</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="StorageEstimate" data-dfn-type="dict-member" data-export data-type="unsigned long long " id="dom-storageestimate-usage"><code><c- g>usage</c-></code></dfn>;
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-unsigned-long-long" id="ref-for-idl-unsigned-long-long①"><c- b>unsigned</c-> <c- b>long</c-> <c- b>long</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="StorageEstimate" data-dfn-type="dict-member" data-export data-type="unsigned long long " id="dom-storageestimate-quota"><code><c- g>quota</c-></code></dfn>;
};
</pre>
   <p>The <dfn class="dfn-paneled idl-code" data-dfn-for="StorageManager" data-dfn-type="method" data-export id="dom-storagemanager-persisted"><code>persisted()</code></dfn> method steps are: </p>
   <ol>
    <li>
     <p>Let <var>promise</var> be a new promise. </p>
    <li>
     <p>Let <var>shelf</var> be the result of running <a data-link-type="dfn" href="#obtain-a-local-storage-shelf" id="ref-for-obtain-a-local-storage-shelf①">obtain a local storage shelf</a> with <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this①">this</a>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object" id="ref-for-relevant-settings-object①">relevant settings object</a>. </p>
    <li>
     <p>If <var>shelf</var> is failure, then reject <var>promise</var> with a <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#exceptiondef-typeerror" id="ref-for-exceptiondef-typeerror">TypeError</a></code>. </p>
    <li>
     <p>Otherwise, run these steps <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel" id="ref-for-in-parallel">in parallel</a>: </p>
     <ol>
      <li>
       <p>Let <var>persisted</var> be true if <var>shelf</var>’s <a data-link-type="dfn" href="#bucket-map" id="ref-for-bucket-map⑦">bucket map</a>["<code>default</code>"]'s <a data-link-type="dfn" href="#bucket-mode" id="ref-for-bucket-mode④">mode</a> is
    "<code>persistent</code>"; otherwise false. </p>
       <p class="note" role="note">It will be false when there’s an internal error. </p>
      <li>
       <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task" id="ref-for-queue-a-task">Queue a task</a> to resolve <var>promise</var> with <var>persisted</var>. </p>
     </ol>
    <li>
     <p>Return <var>promise</var>. </p>
   </ol>
   <p>The <dfn class="dfn-paneled idl-code" data-dfn-for="StorageManager" data-dfn-type="method" data-export id="dom-storagemanager-persist"><code>persist()</code></dfn> method steps are: </p>
   <ol>
    <li>
     <p>Let <var>promise</var> be a new promise. </p>
    <li>
     <p>Let <var>shelf</var> be the result of running <a data-link-type="dfn" href="#obtain-a-local-storage-shelf" id="ref-for-obtain-a-local-storage-shelf②">obtain a local storage shelf</a> with <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this②">this</a>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object" id="ref-for-relevant-settings-object②">relevant settings object</a>. </p>
    <li>
     <p>If <var>shelf</var> is failure, then reject <var>promise</var> with a <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#exceptiondef-typeerror" id="ref-for-exceptiondef-typeerror①">TypeError</a></code>. </p>
    <li>
     <p>Otherwise, run these steps <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel" id="ref-for-in-parallel①">in parallel</a>: </p>
     <ol>
      <li>
       <p>Let <var>permission</var> be the result of <a data-link-type="dfn" href="https://w3c.github.io/permissions/#dfn-request-permission-to-use" id="ref-for-dfn-request-permission-to-use">requesting permission to use</a> "<code class="idl"><a data-link-type="idl">persistent-storage</a></code>". </p>
       <p class="note" role="note">User agents are encouraged to not let the user answer this question twice for
    the same <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin" id="ref-for-concept-origin⑤">origin</a> around the same time and this algorithm is not equipped to handle
    such a scenario. </p>
      <li>
       <p>Let <var>bucket</var> be <var>shelf</var>’s <a data-link-type="dfn" href="#bucket-map" id="ref-for-bucket-map⑧">bucket map</a>["<code>default</code>"]. </p>
      <li>
       <p>Let <var>persisted</var> be true if <var>bucket</var>’s <a data-link-type="dfn" href="#bucket-mode" id="ref-for-bucket-mode⑤">mode</a> is "<code>persistent</code>"; otherwise false. </p>
       <p class="note" role="note">It will be false when there’s an internal error. </p>
      <li>
       <p>If <var>persisted</var> is false and <var>permission</var> is <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/permissions/#dom-permissionstate-granted" id="ref-for-dom-permissionstate-granted①">"granted"</a></code>,
    then: </p>
       <ol>
        <li>
         <p>Set <var>bucket</var>’s <a data-link-type="dfn" href="#bucket-mode" id="ref-for-bucket-mode⑥">mode</a> to
     "<code>persistent</code>". </p>
        <li>
         <p>If there was no internal error, then set <var>persisted</var> to true. </p>
       </ol>
      <li>
       <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task" id="ref-for-queue-a-task①">Queue a task</a> to resolve <var>promise</var> with <var>persisted</var>. </p>
     </ol>
    <li>
     <p>Return <var>promise</var>. </p>
   </ol>
   <p>The <dfn class="dfn-paneled idl-code" data-dfn-for="StorageManager" data-dfn-type="method" data-export id="dom-storagemanager-estimate"><code>estimate()</code></dfn> method steps are: </p>
   <ol>
    <li>
     <p>Let <var>promise</var> be a new promise. </p>
    <li>
     <p>Let <var>shelf</var> be the result of running <a data-link-type="dfn" href="#obtain-a-local-storage-shelf" id="ref-for-obtain-a-local-storage-shelf③">obtain a local storage shelf</a> with <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this③">this</a>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object" id="ref-for-relevant-settings-object③">relevant settings object</a>. </p>
    <li>
     <p>If <var>shelf</var> is failure, then reject <var>promise</var> with a <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#exceptiondef-typeerror" id="ref-for-exceptiondef-typeerror②">TypeError</a></code>. </p>
    <li>
     <p>Otherwise, run these steps <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel" id="ref-for-in-parallel②">in parallel</a>: </p>
     <ol>
      <li>
       <p>Let <var>usage</var> be <a data-link-type="dfn" href="#storage-usage" id="ref-for-storage-usage">storage usage</a> for <var>shelf</var>. </p>
      <li>
       <p>Let <var>quota</var> be <a data-link-type="dfn" href="#storage-quota" id="ref-for-storage-quota①">storage quota</a> for <var>shelf</var>. </p>
      <li>
       <p>Let <var>dictionary</var> be a new <code class="idl"><a data-link-type="idl" href="#dictdef-storageestimate" id="ref-for-dictdef-storageestimate①">StorageEstimate</a></code> dictionary whose <code class="idl"><a data-link-type="idl" href="#dom-storageestimate-usage" id="ref-for-dom-storageestimate-usage">usage</a></code> member
   is <var>usage</var> and <code class="idl"><a data-link-type="idl" href="#dom-storageestimate-quota" id="ref-for-dom-storageestimate-quota">quota</a></code> member is <var>quota</var>. </p>
      <li>
       <p>If there was an internal error while obtaining <var>usage</var> and <var>quota</var>, then <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task" id="ref-for-queue-a-task②">queue a task</a> to reject <var>promise</var> with a <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#exceptiondef-typeerror" id="ref-for-exceptiondef-typeerror③">TypeError</a></code>. </p>
       <p class="note" role="note">Internal errors are supposed to be extremely rare and indicate some kind of
    low-level platform or hardware fault. However, at the scale of the web with the diversity of
    implementation and platforms, the unexpected does occur. </p>
      <li>
       <p>Otherwise, <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task" id="ref-for-queue-a-task③">queue a task</a> to resolve <var>promise</var> with <var>dictionary</var>. </p>
     </ol>
    <li>
     <p>Return <var>promise</var>. </p>
   </ol>
   <h2 class="no-num heading settled" id="acks"><span class="content">Acknowledgments</span><a class="self-link" href="#acks"></a></h2>
   <p>With that, many thanks to
Adrian Bateman,
Aislinn Grigas,
Alex Russell,
Ali Alabbas,
Andrew Sutherland,
Ben Kelly,
Ben Turner,
Dale Harvey,
David Grogan,
Domenic Denicola,
fantasai,
Jake Archibald,
Jeffrey Yasskin,
Jesse Mykolyn,
Jinho Bang,
Jonas Sicking,
Joshua Bell,
Kenji Baheux,
Kinuko Yasuda,
Luke Wagner,
Michael Nordman,
Mounir Lamouri,
Shachar Zohar,
黃強 (Shawn Huang),
簡冠庭 (Timothy Guan-tin Chien), and
Victor Costan
for being awesome! </p>
   <p>This standard is written by <a href="https://annevankesteren.nl/" lang="nl">Anne van Kesteren</a> (<a href="https://www.mozilla.org/">Mozilla</a>, <a href="mailto:annevk@annevk.nl">annevk@annevk.nl</a>). </p>
   <h2 class="no-num heading settled" id="ipr"><span class="content">Intellectual property rights</span><a class="self-link" href="#ipr"></a></h2>
   <p>Copyright © WHATWG (Apple, Google, Mozilla, Microsoft). This work is licensed under a <a href="https://creativecommons.org/licenses/by/4.0/" rel="license">Creative Commons Attribution 4.0
International License</a>. To the extent portions of it are incorporated into source code, such
portions in the source code are licensed under the <a href="https://opensource.org/licenses/BSD-3-Clause" rel="license">BSD 3-Clause License</a> instead.</p>
   <p>This is the Living Standard. Those
interested in the patent-review version should view the <a href="/review-drafts/2021-02/">Living Standard Review Draft</a>.</p>
  </main>
<script>
"use strict";
if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("/service-worker.js");
}
</script>
  <h2 class="no-num no-ref heading settled" id="index"><span class="content">Index</span><a class="self-link" href="#index"></a></h2>
  <h3 class="no-num no-ref heading settled" id="index-defined-here"><span class="content">Terms defined by this specification</span><a class="self-link" href="#index-defined-here"></a></h3>
  <ul class="index">
   <li><a href="#storage-proxy-map-backing-map">backing map</a><span>, in § 4.7</span>
   <li><a href="#bottle-map">bottle map</a><span>, in § 4.5</span>
   <li><a href="#bucket-map">bucket map</a><span>, in § 4.4</span>
   <li><a href="#create-a-storage-bucket">create a storage bucket</a><span>, in § 4.5</span>
   <li><a href="#create-a-storage-shelf">create a storage shelf</a><span>, in § 4.4</span>
   <li><a href="#dom-storagemanager-estimate">estimate()</a><span>, in § 8</span>
   <li><a href="#storage-endpoint-identifier">identifier</a><span>, in § 4.1</span>
   <li><a href="#legacy-clone-a-browsing-session-storage-shed">legacy-clone a browsing session storage shed</a><span>, in § 4.3</span>
   <li><a href="#local-storage">local storage</a><span>, in § 4.3</span>
   <li><a href="#bucket">local storage bucket</a><span>, in § 4.5</span>
   <li><a href="#storage-bottle-map">map</a><span>, in § 4.6</span>
   <li><a href="#bucket-mode">mode</a><span>, in § 4.5</span>
   <li><a href="#navigatorstorage">NavigatorStorage</a><span>, in § 8</span>
   <li><a href="#obtain-a-local-storage-bottle-map">obtain a local storage bottle map</a><span>, in § 4.6</span>
   <li><a href="#obtain-a-local-storage-shelf">obtain a local storage shelf</a><span>, in § 4.4</span>
   <li><a href="#obtain-a-session-storage-bottle-map">obtain a session storage bottle map</a><span>, in § 4.6</span>
   <li><a href="#obtain-a-storage-bottle-map">obtain a storage bottle map</a><span>, in § 4.6</span>
   <li><a href="#obtain-a-storage-key">obtain a storage key</a><span>, in § 4.2</span>
   <li><a href="#obtain-a-storage-shelf">obtain a storage shelf</a><span>, in § 4.4</span>
   <li><a href="#dom-storagemanager-persist">persist()</a><span>, in § 8</span>
   <li><a href="#dom-storagemanager-persisted">persisted()</a><span>, in § 8</span>
   <li><a href="#storage-bottle-proxy-map-reference-set">proxy map reference set</a><span>, in § 4.6</span>
   <li>
    quota
    <ul>
     <li><a href="#storage-bottle-quota">dfn for storage bottle</a><span>, in § 4.6</span>
     <li><a href="#storage-endpoint-quota">dfn for storage endpoint</a><span>, in § 4.1</span>
     <li><a href="#dom-storageestimate-quota">dict-member for StorageEstimate</a><span>, in § 8</span>
    </ul>
   <li><a href="#registered-storage-endpoints">registered storage endpoints</a><span>, in § 4.1</span>
   <li><a href="#session-storage">session storage</a><span>, in § 4.3</span>
   <li><a href="#session-storage-bucket">session storage bucket</a><span>, in § 4.5</span>
   <li><a href="#dom-navigatorstorage-storage">storage</a><span>, in § 8</span>
   <li><a href="#storage-bottle">storage bottle</a><span>, in § 4.6</span>
   <li><a href="#storage-bucket">storage bucket</a><span>, in § 4.5</span>
   <li><a href="#storage-endpoint">storage endpoint</a><span>, in § 4.1</span>
   <li><a href="#dictdef-storageestimate">StorageEstimate</a><span>, in § 8</span>
   <li><a href="#storage-identifier">storage identifier</a><span>, in § 4.1</span>
   <li><a href="#storage-key">storage key</a><span>, in § 4.2</span>
   <li><a href="#storagemanager">StorageManager</a><span>, in § 8</span>
   <li><a href="#storage-proxy-map">storage proxy map</a><span>, in § 4.7</span>
   <li><a href="#storage-quota">storage quota</a><span>, in § 6</span>
   <li>
    storage shed
    <ul>
     <li><a href="#storage-shed">definition of</a><span>, in § 4.3</span>
     <li><a href="#browsing-session-storage-shed">dfn for browsing session</a><span>, in § 4.3</span>
     <li><a href="#user-agent-storage-shed">dfn for user agent</a><span>, in § 4.3</span>
    </ul>
   <li><a href="#storage-shelf">storage shelf</a><span>, in § 4.4</span>
   <li><a href="#storage-shelf">storage shelves</a><span>, in § 4.4</span>
   <li><a href="#storage-type">storage type</a><span>, in § 4.1</span>
   <li><a href="#storage-usage">storage usage</a><span>, in § 6</span>
   <li><a href="#storage-endpoint-types">types</a><span>, in § 4.1</span>
   <li><a href="#dom-storageestimate-usage">usage</a><span>, in § 8</span>
  </ul>
  <h3 class="no-num no-ref heading settled" id="index-defined-elsewhere"><span class="content">Terms defined by reference</span><a class="self-link" href="#index-defined-elsewhere"></a></h3>
  <ul class="index">
   <li>
    <a data-link-type="biblio">[ECMASCRIPT]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="3187558e">agent</span>
     <li><span class="dfn-paneled" id="f6e4cbfd">agent cluster</span>
    </ul>
   <li>
    <a data-link-type="biblio">[HTML]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="be0c27b2">Navigator</span>
     <li><span class="dfn-paneled" id="a4785085">WorkerNavigator</span>
     <li><span class="dfn-paneled" id="12b8dfc0">current settings object</span>
     <li><span class="dfn-paneled" id="3e12e042">environment settings object</span>
     <li><span class="dfn-paneled" id="a72449dd">in parallel</span>
     <li><span class="dfn-paneled" id="b01b1359">opaque origin</span>
     <li><span class="dfn-paneled" id="086e3aff">origin</span>
     <li><span class="dfn-paneled" id="43ac8374">origin <small>(for environment settings object)</small></span>
     <li><span class="dfn-paneled" id="9a517a7d">queue a task</span>
     <li><span class="dfn-paneled" id="9c4c1e66">relevant settings object</span>
    </ul>
   <li>
    <a data-link-type="biblio">[INFRA]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="a3b18719">append</span>
     <li><span class="dfn-paneled" id="2d5a2765">ascii string</span>
     <li><span class="dfn-paneled" id="ab3919d2">clone</span>
     <li><span class="dfn-paneled" id="ae8def21">contain</span>
     <li><span class="dfn-paneled" id="1243a891">exist</span>
     <li><span class="dfn-paneled" id="16d07e10">for each <small>(for list)</small></span>
     <li><span class="dfn-paneled" id="45209803">for each <small>(for map)</small></span>
     <li><span class="dfn-paneled" id="860300d4">implementation-defined</span>
     <li><span class="dfn-paneled" id="dc3369de">is empty</span>
     <li><span class="dfn-paneled" id="d14a6f26">key</span>
     <li><span class="dfn-paneled" id="3fca5a9e">map</span>
     <li><span class="dfn-paneled" id="7d4424b2">remove</span>
     <li><span class="dfn-paneled" id="15e48c39">set</span>
     <li><span class="dfn-paneled" id="0698d556">string</span>
     <li><span class="dfn-paneled" id="6d19ac93">user agent</span>
     <li><span class="dfn-paneled" id="802b0fdd">value</span>
    </ul>
   <li>
    <a data-link-type="biblio">[PERMISSIONS]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="c6ce3c60">granted</span>
     <li><span class="dfn-paneled" id="409a61ca">permission revocation algorithm</span>
     <li><span class="dfn-paneled" id="d124397f">permission state</span>
     <li><span class="dfn-paneled" id="6c2d7879">powerful feature</span>
     <li><span class="dfn-paneled" id="d357c753">requesting permission to use</span>
    </ul>
   <li>
    <a data-link-type="biblio">[WEBIDL]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="889e932f">Exposed</span>
     <li><span class="dfn-paneled" id="bdbd19d1">Promise</span>
     <li><span class="dfn-paneled" id="a5c91173">SameObject</span>
     <li><span class="dfn-paneled" id="b75bb3bd">SecureContext</span>
     <li><span class="dfn-paneled" id="82ca3efc">TypeError</span>
     <li><span class="dfn-paneled" id="5372cca8">boolean</span>
     <li><span class="dfn-paneled" id="4013a022">this</span>
     <li><span class="dfn-paneled" id="f14b47b8">unsigned long long</span>
    </ul>
  </ul>
  <h2 class="no-num no-ref heading settled" id="references"><span class="content">References</span><a class="self-link" href="#references"></a></h2>
  <h3 class="no-num no-ref heading settled" id="normative"><span class="content">Normative References</span><a class="self-link" href="#normative"></a></h3>
  <dl>
   <dt id="biblio-ecmascript">[ECMASCRIPT]
   <dd><a href="https://tc39.es/ecma262/multipage/"><cite>ECMAScript Language Specification</cite></a>. URL: <a href="https://tc39.es/ecma262/multipage/">https://tc39.es/ecma262/multipage/</a>
   <dt id="biblio-html">[HTML]
   <dd>Anne van Kesteren; et al. <a href="https://html.spec.whatwg.org/multipage/"><cite>HTML Standard</cite></a>. Living Standard. URL: <a href="https://html.spec.whatwg.org/multipage/">https://html.spec.whatwg.org/multipage/</a>
   <dt id="biblio-infra">[INFRA]
   <dd>Anne van Kesteren; Domenic Denicola. <a href="https://infra.spec.whatwg.org/"><cite>Infra Standard</cite></a>. Living Standard. URL: <a href="https://infra.spec.whatwg.org/">https://infra.spec.whatwg.org/</a>
   <dt id="biblio-permissions">[PERMISSIONS]
   <dd>Marcos Caceres; Mike Taylor. <a href="https://w3c.github.io/permissions/"><cite>Permissions</cite></a>. URL: <a href="https://w3c.github.io/permissions/">https://w3c.github.io/permissions/</a>
   <dt id="biblio-webidl">[WEBIDL]
   <dd>Edgar Chen; Timothy Gu. <a href="https://webidl.spec.whatwg.org/"><cite>Web IDL Standard</cite></a>. Living Standard. URL: <a href="https://webidl.spec.whatwg.org/">https://webidl.spec.whatwg.org/</a>
  </dl>
  <h2 class="no-num no-ref heading settled" id="idl-index"><span class="content">IDL Index</span><a class="self-link" href="#idl-index"></a></h2>
<pre class="idl highlight def">[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#SecureContext"><c- g>SecureContext</c-></a>]
<c- b>interface</c-> <c- b>mixin</c-> <a href="#navigatorstorage"><code><c- g>NavigatorStorage</c-></code></a> {
  [<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#SameObject"><c- g>SameObject</c-></a>] <c- b>readonly</c-> <c- b>attribute</c-> <a data-link-type="idl-name" href="#storagemanager"><c- n>StorageManager</c-></a> <a class="idl-code" data-link-type="attribute" data-readonly data-type="StorageManager" href="#dom-navigatorstorage-storage"><c- g>storage</c-></a>;
};
<a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/system-state.html#navigator"><c- n>Navigator</c-></a> <c- b>includes</c-> <a data-link-type="idl-name" href="#navigatorstorage"><c- n>NavigatorStorage</c-></a>;
<a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/workers.html#workernavigator"><c- n>WorkerNavigator</c-></a> <c- b>includes</c-> <a data-link-type="idl-name" href="#navigatorstorage"><c- n>NavigatorStorage</c-></a>;

[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#SecureContext"><c- g>SecureContext</c-></a>,
 <a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed"><c- g>Exposed</c-></a>=(<c- n>Window</c->,<c- n>Worker</c->)]
<c- b>interface</c-> <a href="#storagemanager"><code><c- g>StorageManager</c-></code></a> {
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise"><c- b>Promise</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-boolean"><c- b>boolean</c-></a>> <a class="idl-code" data-link-type="method" href="#dom-storagemanager-persisted"><c- g>persisted</c-></a>();
  [<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed"><c- g>Exposed</c-></a>=<c- n>Window</c->] <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise"><c- b>Promise</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-boolean"><c- b>boolean</c-></a>> <a class="idl-code" data-link-type="method" href="#dom-storagemanager-persist"><c- g>persist</c-></a>();

  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise"><c- b>Promise</c-></a>&lt;<a data-link-type="idl-name" href="#dictdef-storageestimate"><c- n>StorageEstimate</c-></a>> <a class="idl-code" data-link-type="method" href="#dom-storagemanager-estimate"><c- g>estimate</c-></a>();
};

<c- b>dictionary</c-> <a href="#dictdef-storageestimate"><code><c- g>StorageEstimate</c-></code></a> {
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-unsigned-long-long"><c- b>unsigned</c-> <c- b>long</c-> <c- b>long</c-></a> <a data-type="unsigned long long " href="#dom-storageestimate-usage"><code><c- g>usage</c-></code></a>;
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-unsigned-long-long"><c- b>unsigned</c-> <c- b>long</c-> <c- b>long</c-></a> <a data-type="unsigned long long " href="#dom-storageestimate-quota"><code><c- g>quota</c-></code></a>;
};

</pre>
  <details class="mdn-anno unpositioned" data-anno-for="dom-navigatorstorage-storage">
   <summary><b class="all-engines-flag" title="This feature is in all current engines.">✔</b><span>MDN</span></summary>
   <div class="feature">
    <p><a href="https://developer.mozilla.org/en-US/docs/Web/API/Navigator/storage" title="The Navigator.storage read-only property returns the singleton StorageManager object used to access the overall storage capabilities of the browser for the current site or app. The returned object lets you examine and configure persistence of data stores and learn approximately how much more space your browser has available for local storage use.">Navigator/storage</a></p>
    <p class="all-engines-text">In all current engines.</p>
    <div class="support">
     <span class="firefox yes"><span>Firefox</span><span>57+</span></span><span class="safari yes"><span>Safari</span><span>15.2+</span></span><span class="chrome yes"><span>Chrome</span><span>55+</span></span>
     <hr>
     <span class="opera no"><span>Opera</span><span>?</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span>
     <hr>
     <span class="edge no"><span>Edge (Legacy)</span><span>?</span></span><span class="ie no"><span>IE</span><span>None</span></span>
     <hr>
     <span class="firefox_android no"><span>Firefox for Android</span><span>?</span></span><span class="safari_ios no"><span>iOS Safari</span><span>?</span></span><span class="chrome_android no"><span>Chrome for Android</span><span>?</span></span><span class="webview_android no"><span>Android WebView</span><span>?</span></span><span class="samsunginternet_android no"><span>Samsung Internet</span><span>?</span></span><span class="opera_android no"><span>Opera Mobile</span><span>?</span></span>
    </div>
   </div>
   <div class="feature">
    <p><a href="https://developer.mozilla.org/en-US/docs/Web/API/WorkerNavigator/storage" title="The WorkerNavigator.storage read-only property returns the singleton StorageManager object used to access the overall storage capabilities of the browser for the current site or app. The returned object lets you examine and configure persistence of data stores and learn approximately how much more space your browser has available for local storage use.">WorkerNavigator/storage</a></p>
    <p class="all-engines-text">In all current engines.</p>
    <div class="support">
     <span class="firefox yes"><span>Firefox</span><span>57+</span></span><span class="safari yes"><span>Safari</span><span>15.2+</span></span><span class="chrome yes"><span>Chrome</span><span>55+</span></span>
     <hr>
     <span class="opera no"><span>Opera</span><span>?</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span>
     <hr>
     <span class="edge no"><span>Edge (Legacy)</span><span>?</span></span><span class="ie no"><span>IE</span><span>None</span></span>
     <hr>
     <span class="firefox_android no"><span>Firefox for Android</span><span>?</span></span><span class="safari_ios no"><span>iOS Safari</span><span>?</span></span><span class="chrome_android no"><span>Chrome for Android</span><span>?</span></span><span class="webview_android no"><span>Android WebView</span><span>?</span></span><span class="samsunginternet_android no"><span>Samsung Internet</span><span>?</span></span><span class="opera_android no"><span>Opera Mobile</span><span>?</span></span>
    </div>
   </div>
  </details>
  <details class="mdn-anno unpositioned" data-anno-for="ref-for-dom-storagemanager-estimate">
   <summary><span>MDN</span></summary>
   <div class="feature">
    <p><a href="https://developer.mozilla.org/en-US/docs/Web/API/StorageManager/estimate" title="The estimate() method of the StorageManager interface asks the Storage Manager for how much storage the current origin takes up (usage), and how much space is available (quota).">StorageManager/estimate</a></p>
    <div class="support">
     <span class="firefox yes"><span>Firefox</span><span>57+</span></span><span class="safari no"><span>Safari</span><span>None</span></span><span class="chrome yes"><span>Chrome</span><span>61+</span></span>
     <hr>
     <span class="opera no"><span>Opera</span><span>?</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span>
     <hr>
     <span class="edge no"><span>Edge (Legacy)</span><span>?</span></span><span class="ie no"><span>IE</span><span>None</span></span>
     <hr>
     <span class="firefox_android no"><span>Firefox for Android</span><span>?</span></span><span class="safari_ios no"><span>iOS Safari</span><span>?</span></span><span class="chrome_android no"><span>Chrome for Android</span><span>?</span></span><span class="webview_android no"><span>Android WebView</span><span>?</span></span><span class="samsunginternet_android no"><span>Samsung Internet</span><span>?</span></span><span class="opera_android no"><span>Opera Mobile</span><span>?</span></span>
    </div>
   </div>
  </details>
  <details class="mdn-anno unpositioned" data-anno-for="ref-for-dom-storagemanager-persist">
   <summary><b class="all-engines-flag" title="This feature is in all current engines.">✔</b><span>MDN</span></summary>
   <div class="feature">
    <p><a href="https://developer.mozilla.org/en-US/docs/Web/API/StorageManager/persist" title="The persist() method of the StorageManager interface requests permission to use persistent storage, and returns a Promise that resolves to true if permission is granted and box mode is persistent, and false otherwise.">StorageManager/persist</a></p>
    <p class="all-engines-text">In all current engines.</p>
    <div class="support">
     <span class="firefox yes"><span>Firefox</span><span>57+</span></span><span class="safari yes"><span>Safari</span><span>15.2+</span></span><span class="chrome yes"><span>Chrome</span><span>55+</span></span>
     <hr>
     <span class="opera no"><span>Opera</span><span>?</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span>
     <hr>
     <span class="edge no"><span>Edge (Legacy)</span><span>?</span></span><span class="ie no"><span>IE</span><span>None</span></span>
     <hr>
     <span class="firefox_android no"><span>Firefox for Android</span><span>?</span></span><span class="safari_ios no"><span>iOS Safari</span><span>?</span></span><span class="chrome_android no"><span>Chrome for Android</span><span>?</span></span><span class="webview_android no"><span>Android WebView</span><span>?</span></span><span class="samsunginternet_android no"><span>Samsung Internet</span><span>?</span></span><span class="opera_android no"><span>Opera Mobile</span><span>?</span></span>
    </div>
   </div>
  </details>
  <details class="mdn-anno unpositioned" data-anno-for="dom-storagemanager-persisted">
   <summary><b class="all-engines-flag" title="This feature is in all current engines.">✔</b><span>MDN</span></summary>
   <div class="feature">
    <p><a href="https://developer.mozilla.org/en-US/docs/Web/API/StorageManager/persisted" title="The persisted() method of the StorageManager interface returns a Promise that resolves to true if box mode is persistent for your site&apos;s storage.">StorageManager/persisted</a></p>
    <p class="all-engines-text">In all current engines.</p>
    <div class="support">
     <span class="firefox yes"><span>Firefox</span><span>57+</span></span><span class="safari yes"><span>Safari</span><span>15.2+</span></span><span class="chrome yes"><span>Chrome</span><span>55+</span></span>
     <hr>
     <span class="opera no"><span>Opera</span><span>?</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span>
     <hr>
     <span class="edge no"><span>Edge (Legacy)</span><span>?</span></span><span class="ie no"><span>IE</span><span>None</span></span>
     <hr>
     <span class="firefox_android no"><span>Firefox for Android</span><span>?</span></span><span class="safari_ios no"><span>iOS Safari</span><span>?</span></span><span class="chrome_android no"><span>Chrome for Android</span><span>?</span></span><span class="webview_android no"><span>Android WebView</span><span>?</span></span><span class="samsunginternet_android no"><span>Samsung Internet</span><span>?</span></span><span class="opera_android no"><span>Opera Mobile</span><span>?</span></span>
    </div>
   </div>
  </details>
  <details class="mdn-anno unpositioned" data-anno-for="storagemanager">
   <summary><b class="all-engines-flag" title="This feature is in all current engines.">✔</b><span>MDN</span></summary>
   <div class="feature">
    <p><a href="https://developer.mozilla.org/en-US/docs/Web/API/StorageManager" title="The StorageManager interface of the Storage API provides an interface for managing persistence permissions and estimating available storage. You can get a reference to this interface using either navigator.storage or WorkerNavigator.storage.">StorageManager</a></p>
    <p class="all-engines-text">In all current engines.</p>
    <div class="support">
     <span class="firefox yes"><span>Firefox</span><span>57+</span></span><span class="safari yes"><span>Safari</span><span>15.2+</span></span><span class="chrome yes"><span>Chrome</span><span>55+</span></span>
     <hr>
     <span class="opera no"><span>Opera</span><span>?</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span>
     <hr>
     <span class="edge no"><span>Edge (Legacy)</span><span>?</span></span><span class="ie no"><span>IE</span><span>None</span></span>
     <hr>
     <span class="firefox_android no"><span>Firefox for Android</span><span>?</span></span><span class="safari_ios no"><span>iOS Safari</span><span>?</span></span><span class="chrome_android no"><span>Chrome for Android</span><span>?</span></span><span class="webview_android no"><span>Android WebView</span><span>?</span></span><span class="samsunginternet_android no"><span>Samsung Internet</span><span>?</span></span><span class="opera_android no"><span>Opera Mobile</span><span>?</span></span>
    </div>
   </div>
  </details>
<script>/* Boilerplate: script-dfn-panel */
"use strict";
{
    const dfnsJson = window.dfnsJson || {};

    // Functions, divided by link type, that wrap an autolink's
    // contents with the appropriate outer syntax.
    // Alternately, a string naming another type they format
    // the same as.
    const typeFormatters = {
        'dfn': (text) => `[=${text}=]`,
        'abstract-op': (text) => `[\$${text}\$]`,
        'value': (text) => `''${text}''`,
        'http-header': (text) => `[:${text}:]`,
        'idl': (text) => `{{${text}}}`,
        'interface': 'idl',
        'constructor': 'idl',
        'method': 'idl',
        'argument': 'idl',
        'attribute': 'idl',
        'callback': 'idl',
        'dictionary': 'idl',
        'dict-member': 'idl',
        'enum': 'idl',
        'enum-value': 'idl',
        'exception': 'idl',
        'const': 'idl',
        'typedef': 'idl',
        'stringifier': 'idl',
        'serializer': 'idl',
        'iterator': 'idl',
        'maplike': 'idl',
        'setlike': 'idl',
        'extended-attribute': 'idl',
        'event': 'idl',
        'element': (element) => `<{${element}}>`,
        'element-state': 'element',
        'element-attr': 'element',
        'attr-value': 'element',
        'scheme': 'dfn',
        'permission': 'dfn',
        'grammar': (text) => `${text} (within a <pre class=prod>)`,
        'type': (text)=> `<<${text}>>`,
        'property': (text) => `'${text}'`,
        'descriptor': 'property',
        'function': 'value',
        'at-rule': 'value',
        'selector': 'value',
    };
    const typesUsingFor = new Set(
        [
            "descriptor",
            "value",
            "element-attr",
            "attr-value",
            "element-state",
            "method",
            "constructor",
            "argument",
            "attribute",
            "const",
            "dict-member",
            "event",
            "enum-value",
            "stringifier",
            "serializer",
            "iterator",
            "maplike",
            "setlike",
            "state",
            "mode",
            "context",
            "facet",
        ],
    )
    const typesNotUsingFor = new Set(
        [
            "property",
            "element",
            "interface",
            "namespace",
            "callback",
            "dictionary",
            "enum",
            "exception",
            "typedef",
            "http-header",
            "permission",
        ],
    )
    function linkFormatterFromType(type) {
        const fnOrType = typeFormatters[type];
        if(typeof fnOrType === 'string') {
            // follow the alias
            return linkFormatterFromType(fnOrType);
        }
        return fnOrType;
    };

    function genLinkingSyntaxes(dfn) {
        if(dfn.tagName != "DFN") return;

        const type = dfn.getAttribute('data-dfn-type');
        if(!type) {
            console.log(`<dfn> doesn't have a data-dfn-type:`, dfn);
            return [];
        }

        // Return a function that wraps link text based on the type
        const linkFormatter = linkFormatterFromType(type);
        if(!linkFormatter) {
            console.log(`<dfn> has an unknown data-dfn-type:`, dfn);
            return [];
        }

        let ltAlts;
        if(dfn.hasAttribute('data-lt')) {
            ltAlts = dfn.getAttribute('data-lt')
                .split("|")
                .map(x=>x.trim());
        } else {
            ltAlts = [dfn.textContent.trim()];
        }
        if(type == "type") {
            // lt of "<foo>", but "foo" is the interior;
            // <<foo/bar>> is how you write it with a for,
            // not <foo/<bar>> or whatever.
            for(var i = 0; i < ltAlts.length; i++) {
                const lt = ltAlts[i];
                const match = /<(.*)>/.exec(lt);
                if(match) { ltAlts[i] = match[1]; }
            }
        }

        let forAlts;
        if(dfn.hasAttribute('data-dfn-for')) {
            forAlts = dfn.getAttribute('data-dfn-for')
                .split(",")
                .map(x=>x.trim());
        } else {
            forAlts = [''];
        }

        let linkingSyntaxes = [];
        if(!typesUsingFor.has(type)) {
            for(const lt of ltAlts) {
                linkingSyntaxes.push(linkFormatter(lt));
            }
        }
        if(!typesNotUsingFor.has(type)) {
            for(const f of forAlts) {
                linkingSyntaxes.push(linkFormatter(`${f}/${ltAlts[0]}`))
            }
        }
        return [
            mk.b({}, 'Possible linking syntaxes:'),
            mk.ul({},
                ...linkingSyntaxes.map(link => {
                    const copyLink = async () =>
                        await navigator.clipboard.writeText(link);
                    return mk.li({},
                        mk.div({ class: 'link-item' },
                            mk.button({
                                class: 'copy-icon', title: 'Copy',
                                type: 'button',
                                _onclick: copyLink,
                                tabindex: 0,
                            }, mk.span({ class: 'icon' }) ),
                            mk.span({}, link)
                        )
                    );
                })
            )
        ];
    }

    function genDfnPanel({ dfn, dfnID, url, dfnText, refSections, external }) {
        const dfnPanel = mk.aside({
            class: "dfn-panel",
            id: `infopanel-for-${dfnID}`,
            "data-for": dfnID,
            "aria-labelled-by":`infopaneltitle-for-${dfnID}`,
            },
            mk.span({id:`infopaneltitle-for-${dfnID}`, style:"display:none"},
                `Info about the '${dfnText}' ${external?"external":""} reference.`),
            mk.a({href:url, class:"dfn-link"}, url),
            mk.b({}, "Referenced in:"),
            mk.ul({},
                ...refSections.map(section=>
                    mk.li({},
                        ...section.refs.map((ref, refI)=>
                            [
                                mk.a({ href: `#${ref.id}` },
                                    (refI == 0) ? section.title : `(${refI + 1})`
                                ),
                                " ",
                            ]
                        ),
                    ),
                ),
            ),
            genLinkingSyntaxes(dfn),
        );
        dfnPanel.forDfn = dfn;
        if(!dfn) { console.log(dfnPanel); }
        return dfnPanel;
    }

    function genAllDfnPanels() {
        for(const panelData of Object.values(window.dfnpanelData)) {
            const dfnID = panelData.dfnID;
            const dfn = document.getElementById(dfnID);
            if(!dfn) {
                console.log(`Can't find dfn#${dfnID}.`, panelData);
                continue;
            }
            const panel = genDfnPanel({ ...panelData, dfn });
            append(document.body, panel);
            insertDfnPopupAction(panel)
        }
    }

    document.addEventListener("DOMContentLoaded", ()=>{
        genAllDfnPanels();

        document.body.addEventListener("click", (e) => {
            // If not handled already, just hide all dfn panels.
            hideAllDfnPanels();
        });
    })

    function hideAllDfnPanels() {
        // Turn off any currently "on" or "activated" panels.
        queryAll(".dfn-panel.on, .dfn-panel.activated").forEach(el=>hideDfnPanel(el));
    }

    function showDfnPanel(dfnPanel) {
        hideAllDfnPanels(); // Only display one at this time.

        const dfn = dfnPanel.forDfn;
        dfn.setAttribute("aria-expanded", "true");

        dfnPanel.classList.add("on");
        positionDfnPanel(dfnPanel);

        let tabIndex = 100;
        dfn.tabIndex = tabIndex++;
        // Increment tabindex for each anchor and button tags in panel
        const tabbable = dfnPanel.querySelectorAll(":is(a, button)");
        for (const el of tabbable) {
            el.tabIndex = tabIndex++;
        }

    }

    function positionDfnPanel(dfnPanel) {
        const dfn = dfnPanel.forDfn;
        const dfnPos = getRootLevelAbsolutePosition(dfn);
        dfnPanel.style.top = dfnPos.bottom + "px";
        dfnPanel.style.left = dfnPos.left + "px";

        const panelPos = dfnPanel.getBoundingClientRect();
        const panelMargin = 8;
        const maxRight = document.body.parentNode.clientWidth - panelMargin;
        if (panelPos.right > maxRight) {
            const overflowAmount = panelPos.right - maxRight;
            const newLeft = Math.max(panelMargin, dfnPos.left - overflowAmount);
            dfnPanel.style.left = newLeft + "px";
        }}

    function pinDfnPanel(dfnPanel) {
        // Switch it to "activated" state, which pins it.
        dfnPanel.classList.add("activated");
        dfnPanel.style.position = "fixed";
        dfnPanel.style.left = null;
        dfnPanel.style.top = null;
    }

    function hideDfnPanel(dfnPanel) {
        const dfn = dfnPanel.forDfn;
        dfn.setAttribute("aria-expanded", "false");
        dfn.tabIndex = undefined;
        dfnPanel.style.position = "absolute"; // unfix it
        dfnPanel.classList.remove("on");
        dfnPanel.classList.remove("activated");
    }

    function toggleDfnPanel(dfnPanel) {
        if(dfnPanel.classList.contains("on")) {
            hideDfnPanel(dfnPanel);
        } else {
            showDfnPanel(dfnPanel);
        }
    }

    function insertDfnPopupAction(dfnPanel) {
        const dfn = dfnPanel.forDfn;
        dfn.setAttribute('role', 'button');
        dfn.setAttribute('aria-expanded', 'false')
        dfn.tabIndex = 0;
        dfn.classList.add('has-dfn-panel');
        dfn.addEventListener('click', (event) => {
            showDfnPanel(dfnPanel);
            event.stopPropagation();
        });
        dfn.addEventListener('keypress', (event) => {
            const kc = event.keyCode;
            // 32->Space, 13->Enter
            if(kc == 32 || kc == 13) {
                toggleDfnPanel(dfnPanel);
                event.stopPropagation();
                event.preventDefault();
            }
        });

        dfnPanel.addEventListener('click', (event) => {
            if (event.target.nodeName == 'A') {
                scrollToTargetAndHighlight(event);
                pinDfnPanel(dfnPanel);
            }
            event.stopPropagation();
            refocusOnTarget(event);
        });

        dfnPanel.addEventListener('keydown', (event) => {
            if(event.keyCode == 27) { // Escape key
                hideDfnPanel(dfnPanel, dfn);
                event.stopPropagation();
                event.preventDefault();
            }
        })
    }

    function refocusOnTarget(event) {
        const target = event.target;
        setTimeout(() => {
            // Refocus on the event.target element.
            // This is needed after browser scrolls to the destination.
            target.focus();
        });
    }

    // Returns the root-level absolute position {left and top} of element.
    function getRootLevelAbsolutePosition(el) {
        const boundsRect = el.getBoundingClientRect();
        let xPos = 0;
        let yPos = 0;

        while (el) {
            let xScroll = el.scrollLeft;
            let yScroll = el.scrollTop;

            // Ignore scrolling of body.
            if (el.tagName === "BODY") {
                xScroll = 0;
                yScroll = 0;
            }
            xPos += (el.offsetLeft - xScroll + el.clientLeft);
            yPos += (el.offsetTop - yScroll + el.clientTop);

            el = el.offsetParent;
        }
        return {
            left: xPos,
            top: yPos,
            right: xPos + boundsRect.width,
            bottom: yPos + boundsRect.height,
        };
    }

    function scrolledIntoView(element) {
        const rect = element.getBoundingClientRect();
        return (
            rect.top > 0 &&
            rect.bottom < window.innerHeight
        );
    }

    function scrollToTargetAndHighlight(event) {
        let hash = event.target.hash;
        if (hash) {
            hash = decodeURIComponent(hash.substring(1));
            const dest = document.getElementById(hash);
            if (dest) {
                // Maybe prevent default scroll.
                if (scrolledIntoView(dest)) {
                    event.preventDefault();
                }
                dest.classList.add('highlighted');
                setTimeout(() => dest.classList.remove('highlighted'), 1000);
            }
        }
    }

    window.addEventListener("resize", () => {
        // Pin any visible dfn panel
        queryAll(".dfn-panel.on, .dfn-panel.activated").forEach(el=>positionDfnPanel(el));
    });
}
</script>
<script>/* Boilerplate: script-dfn-panel-json */
window.dfnpanelData = {};
window.dfnpanelData['3187558e'] = {"dfnID": "3187558e", "url": "https://tc39.github.io/ecma262/#sec-agents", "dfnText": "agent", "refSections": [{"refs": [{"id": "ref-for-sec-agents"}], "title": "4.6. Storage bottles"}], "external": true};
window.dfnpanelData['f6e4cbfd'] = {"dfnID": "f6e4cbfd", "url": "https://tc39.github.io/ecma262/#sec-agent-clusters", "dfnText": "agent cluster", "refSections": [{"refs": [{"id": "ref-for-sec-agent-clusters"}], "title": "4.6. Storage bottles"}], "external": true};
window.dfnpanelData['be0c27b2'] = {"dfnID": "be0c27b2", "url": "https://html.spec.whatwg.org/multipage/system-state.html#navigator", "dfnText": "Navigator", "refSections": [{"refs": [{"id": "ref-for-navigator"}], "title": "8. API"}], "external": true};
window.dfnpanelData['a4785085'] = {"dfnID": "a4785085", "url": "https://html.spec.whatwg.org/multipage/workers.html#workernavigator", "dfnText": "WorkerNavigator", "refSections": [{"refs": [{"id": "ref-for-workernavigator"}], "title": "8. API"}], "external": true};
window.dfnpanelData['12b8dfc0'] = {"dfnID": "12b8dfc0", "url": "https://html.spec.whatwg.org/multipage/webappapis.html#current-settings-object", "dfnText": "current settings object", "refSections": [{"refs": [{"id": "ref-for-current-settings-object"}], "title": "5. Persistence permission"}], "external": true};
window.dfnpanelData['3e12e042'] = {"dfnID": "3e12e042", "url": "https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object", "dfnText": "environment settings object", "refSections": [{"refs": [{"id": "ref-for-environment-settings-object"}], "title": "4. Model"}, {"refs": [{"id": "ref-for-environment-settings-object\u2460"}], "title": "4.2. Storage keys"}, {"refs": [{"id": "ref-for-environment-settings-object\u2461"}, {"id": "ref-for-environment-settings-object\u2462"}], "title": "4.4. Storage shelves"}, {"refs": [{"id": "ref-for-environment-settings-object\u2463"}, {"id": "ref-for-environment-settings-object\u2464"}, {"id": "ref-for-environment-settings-object\u2465"}], "title": "4.6. Storage bottles"}, {"refs": [{"id": "ref-for-environment-settings-object\u2466"}], "title": "5. Persistence permission"}, {"refs": [{"id": "ref-for-environment-settings-object\u2467"}], "title": "8. API"}], "external": true};
window.dfnpanelData['a72449dd'] = {"dfnID": "a72449dd", "url": "https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel", "dfnText": "in parallel", "refSections": [{"refs": [{"id": "ref-for-in-parallel"}, {"id": "ref-for-in-parallel\u2460"}, {"id": "ref-for-in-parallel\u2461"}], "title": "8. API"}], "external": true};
window.dfnpanelData['b01b1359'] = {"dfnID": "b01b1359", "url": "https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-opaque", "dfnText": "opaque origin", "refSections": [{"refs": [{"id": "ref-for-concept-origin-opaque"}], "title": "4.2. Storage keys"}], "external": true};
window.dfnpanelData['086e3aff'] = {"dfnID": "086e3aff", "url": "https://html.spec.whatwg.org/multipage/browsers.html#concept-origin", "dfnText": "origin", "refSections": [{"refs": [{"id": "ref-for-concept-origin"}], "title": "1. Introduction"}, {"refs": [{"id": "ref-for-concept-origin\u2460"}], "title": "4.2. Storage keys"}, {"refs": [{"id": "ref-for-concept-origin\u2461"}, {"id": "ref-for-concept-origin\u2462"}], "title": "5. Persistence permission"}, {"refs": [{"id": "ref-for-concept-origin\u2463"}], "title": "6. Usage and quota"}, {"refs": [{"id": "ref-for-concept-origin\u2464"}], "title": "8. API"}], "external": true};
window.dfnpanelData['43ac8374'] = {"dfnID": "43ac8374", "url": "https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin", "dfnText": "origin (for environment settings object)", "refSections": [{"refs": [{"id": "ref-for-concept-settings-object-origin"}], "title": "4.2. Storage keys"}, {"refs": [{"id": "ref-for-concept-settings-object-origin\u2460"}], "title": "5. Persistence permission"}], "external": true};
window.dfnpanelData['9a517a7d'] = {"dfnID": "9a517a7d", "url": "https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task", "dfnText": "queue a task", "refSections": [{"refs": [{"id": "ref-for-queue-a-task"}, {"id": "ref-for-queue-a-task\u2460"}, {"id": "ref-for-queue-a-task\u2461"}, {"id": "ref-for-queue-a-task\u2462"}], "title": "8. API"}], "external": true};
window.dfnpanelData['9c4c1e66'] = {"dfnID": "9c4c1e66", "url": "https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object", "dfnText": "relevant settings object", "refSections": [{"refs": [{"id": "ref-for-relevant-settings-object"}, {"id": "ref-for-relevant-settings-object\u2460"}, {"id": "ref-for-relevant-settings-object\u2461"}, {"id": "ref-for-relevant-settings-object\u2462"}], "title": "8. API"}], "external": true};
window.dfnpanelData['a3b18719'] = {"dfnID": "a3b18719", "url": "https://infra.spec.whatwg.org/#set-append", "dfnText": "append", "refSections": [{"refs": [{"id": "ref-for-set-append"}], "title": "4.6. Storage bottles"}], "external": true};
window.dfnpanelData['2d5a2765'] = {"dfnID": "2d5a2765", "url": "https://infra.spec.whatwg.org/#ascii-string", "dfnText": "ascii string", "refSections": [{"refs": [{"id": "ref-for-ascii-string"}], "title": "4.1. Storage endpoints"}], "external": true};
window.dfnpanelData['ab3919d2'] = {"dfnID": "ab3919d2", "url": "https://infra.spec.whatwg.org/#map-clone", "dfnText": "clone", "refSections": [{"refs": [{"id": "ref-for-map-clone"}], "title": "4.3. Storage sheds"}], "external": true};
window.dfnpanelData['ae8def21'] = {"dfnID": "ae8def21", "url": "https://infra.spec.whatwg.org/#list-contain", "dfnText": "contain", "refSections": [{"refs": [{"id": "ref-for-list-contain"}], "title": "4.5. Storage buckets"}], "external": true};
window.dfnpanelData['1243a891'] = {"dfnID": "1243a891", "url": "https://infra.spec.whatwg.org/#map-exists", "dfnText": "exist", "refSections": [{"refs": [{"id": "ref-for-map-exists"}], "title": "4.4. Storage shelves"}], "external": true};
window.dfnpanelData['16d07e10'] = {"dfnID": "16d07e10", "url": "https://infra.spec.whatwg.org/#list-iterate", "dfnText": "for each (for list)", "refSections": [{"refs": [{"id": "ref-for-list-iterate"}], "title": "4.5. Storage buckets"}], "external": true};
window.dfnpanelData['45209803'] = {"dfnID": "45209803", "url": "https://infra.spec.whatwg.org/#map-iterate", "dfnText": "for each (for map)", "refSections": [{"refs": [{"id": "ref-for-map-iterate"}], "title": "4.3. Storage sheds"}], "external": true};
window.dfnpanelData['860300d4'] = {"dfnID": "860300d4", "url": "https://infra.spec.whatwg.org/#implementation-defined", "dfnText": "implementation-defined", "refSections": [{"refs": [{"id": "ref-for-implementation-defined"}], "title": "4.6. Storage bottles"}, {"refs": [{"id": "ref-for-implementation-defined\u2460"}, {"id": "ref-for-implementation-defined\u2461"}], "title": "6. Usage and quota"}], "external": true};
window.dfnpanelData['dc3369de'] = {"dfnID": "dc3369de", "url": "https://infra.spec.whatwg.org/#map-is-empty", "dfnText": "is empty", "refSections": [{"refs": [{"id": "ref-for-map-is-empty"}], "title": "7. Management"}], "external": true};
window.dfnpanelData['d14a6f26'] = {"dfnID": "d14a6f26", "url": "https://infra.spec.whatwg.org/#map-key", "dfnText": "key", "refSections": [{"refs": [{"id": "ref-for-map-key"}], "title": "4.4. Storage shelves"}], "external": true};
window.dfnpanelData['3fca5a9e'] = {"dfnID": "3fca5a9e", "url": "https://infra.spec.whatwg.org/#ordered-map", "dfnText": "map", "refSections": [{"refs": [{"id": "ref-for-ordered-map"}], "title": "4. Model"}, {"refs": [{"id": "ref-for-ordered-map\u2460"}], "title": "4.3. Storage sheds"}, {"refs": [{"id": "ref-for-ordered-map\u2461"}], "title": "4.4. Storage shelves"}, {"refs": [{"id": "ref-for-ordered-map\u2462"}], "title": "4.6. Storage bottles"}, {"refs": [{"id": "ref-for-ordered-map\u2463"}], "title": "4.7. Storage proxy maps"}], "external": true};
window.dfnpanelData['7d4424b2'] = {"dfnID": "7d4424b2", "url": "https://infra.spec.whatwg.org/#map-remove", "dfnText": "remove", "refSections": [{"refs": [{"id": "ref-for-map-remove"}], "title": "7. Management"}], "external": true};
window.dfnpanelData['15e48c39'] = {"dfnID": "15e48c39", "url": "https://infra.spec.whatwg.org/#ordered-set", "dfnText": "set", "refSections": [{"refs": [{"id": "ref-for-ordered-set"}, {"id": "ref-for-ordered-set\u2460"}], "title": "4.1. Storage endpoints"}, {"refs": [{"id": "ref-for-ordered-set\u2461"}], "title": "4.6. Storage bottles"}], "external": true};
window.dfnpanelData['0698d556'] = {"dfnID": "0698d556", "url": "https://infra.spec.whatwg.org/#string", "dfnText": "string", "refSections": [{"refs": [{"id": "ref-for-string"}], "title": "4.4. Storage shelves"}], "external": true};
window.dfnpanelData['6d19ac93'] = {"dfnID": "6d19ac93", "url": "https://infra.spec.whatwg.org/#user-agent", "dfnText": "user agent", "refSections": [{"refs": [{"id": "ref-for-user-agent"}], "title": "3. Lay of the land"}, {"refs": [{"id": "ref-for-user-agent\u2460"}], "title": "4.3. Storage sheds"}], "external": true};
window.dfnpanelData['802b0fdd'] = {"dfnID": "802b0fdd", "url": "https://infra.spec.whatwg.org/#map-value", "dfnText": "value", "refSections": [{"refs": [{"id": "ref-for-map-value"}], "title": "4.4. Storage shelves"}], "external": true};
window.dfnpanelData['c6ce3c60'] = {"dfnID": "c6ce3c60", "url": "https://w3c.github.io/permissions/#dom-permissionstate-granted", "dfnText": "granted", "refSections": [{"refs": [{"id": "ref-for-dom-permissionstate-granted"}], "title": "5. Persistence permission"}, {"refs": [{"id": "ref-for-dom-permissionstate-granted\u2460"}], "title": "8. API"}], "external": true};
window.dfnpanelData['409a61ca'] = {"dfnID": "409a61ca", "url": "https://w3c.github.io/permissions/#dfn-permission-revocation-algorithm", "dfnText": "permission revocation algorithm", "refSections": [{"refs": [{"id": "ref-for-dfn-permission-revocation-algorithm"}], "title": "5. Persistence permission"}], "external": true};
window.dfnpanelData['d124397f'] = {"dfnID": "d124397f", "url": "https://w3c.github.io/permissions/#dfn-permission-state", "dfnText": "permission state", "refSections": [{"refs": [{"id": "ref-for-dfn-permission-state"}, {"id": "ref-for-dfn-permission-state\u2460"}, {"id": "ref-for-dfn-permission-state\u2461"}], "title": "5. Persistence permission"}], "external": true};
window.dfnpanelData['6c2d7879'] = {"dfnID": "6c2d7879", "url": "https://w3c.github.io/permissions/#dfn-powerful-feature", "dfnText": "powerful feature", "refSections": [{"refs": [{"id": "ref-for-dfn-powerful-feature"}], "title": "5. Persistence permission"}], "external": true};
window.dfnpanelData['d357c753'] = {"dfnID": "d357c753", "url": "https://w3c.github.io/permissions/#dfn-request-permission-to-use", "dfnText": "requesting permission to use", "refSections": [{"refs": [{"id": "ref-for-dfn-request-permission-to-use"}], "title": "8. API"}], "external": true};
window.dfnpanelData['889e932f'] = {"dfnID": "889e932f", "url": "https://webidl.spec.whatwg.org/#Exposed", "dfnText": "Exposed", "refSections": [{"refs": [{"id": "ref-for-Exposed"}, {"id": "ref-for-Exposed\u2460"}], "title": "8. API"}], "external": true};
window.dfnpanelData['bdbd19d1'] = {"dfnID": "bdbd19d1", "url": "https://webidl.spec.whatwg.org/#idl-promise", "dfnText": "Promise", "refSections": [{"refs": [{"id": "ref-for-idl-promise"}, {"id": "ref-for-idl-promise\u2460"}, {"id": "ref-for-idl-promise\u2461"}], "title": "8. API"}], "external": true};
window.dfnpanelData['a5c91173'] = {"dfnID": "a5c91173", "url": "https://webidl.spec.whatwg.org/#SameObject", "dfnText": "SameObject", "refSections": [{"refs": [{"id": "ref-for-SameObject"}], "title": "8. API"}], "external": true};
window.dfnpanelData['b75bb3bd'] = {"dfnID": "b75bb3bd", "url": "https://webidl.spec.whatwg.org/#SecureContext", "dfnText": "SecureContext", "refSections": [{"refs": [{"id": "ref-for-SecureContext"}, {"id": "ref-for-SecureContext\u2460"}], "title": "8. API"}], "external": true};
window.dfnpanelData['82ca3efc'] = {"dfnID": "82ca3efc", "url": "https://webidl.spec.whatwg.org/#exceptiondef-typeerror", "dfnText": "TypeError", "refSections": [{"refs": [{"id": "ref-for-exceptiondef-typeerror"}, {"id": "ref-for-exceptiondef-typeerror\u2460"}, {"id": "ref-for-exceptiondef-typeerror\u2461"}, {"id": "ref-for-exceptiondef-typeerror\u2462"}], "title": "8. API"}], "external": true};
window.dfnpanelData['5372cca8'] = {"dfnID": "5372cca8", "url": "https://webidl.spec.whatwg.org/#idl-boolean", "dfnText": "boolean", "refSections": [{"refs": [{"id": "ref-for-idl-boolean"}, {"id": "ref-for-idl-boolean\u2460"}], "title": "8. API"}], "external": true};
window.dfnpanelData['4013a022'] = {"dfnID": "4013a022", "url": "https://webidl.spec.whatwg.org/#this", "dfnText": "this", "refSections": [{"refs": [{"id": "ref-for-this"}, {"id": "ref-for-this\u2460"}, {"id": "ref-for-this\u2461"}, {"id": "ref-for-this\u2462"}], "title": "8. API"}], "external": true};
window.dfnpanelData['f14b47b8'] = {"dfnID": "f14b47b8", "url": "https://webidl.spec.whatwg.org/#idl-unsigned-long-long", "dfnText": "unsigned long long", "refSections": [{"refs": [{"id": "ref-for-idl-unsigned-long-long"}, {"id": "ref-for-idl-unsigned-long-long\u2460"}], "title": "8. API"}], "external": true};
window.dfnpanelData['storage-endpoint'] = {"dfnID": "storage-endpoint", "url": "#storage-endpoint", "dfnText": "storage endpoint", "refSections": [{"refs": [{"id": "ref-for-storage-endpoint"}, {"id": "ref-for-storage-endpoint\u2460"}], "title": "4. Model"}, {"refs": [{"id": "ref-for-storage-endpoint\u2461"}, {"id": "ref-for-storage-endpoint\u2462"}, {"id": "ref-for-storage-endpoint\u2463"}, {"id": "ref-for-storage-endpoint\u2464"}, {"id": "ref-for-storage-endpoint\u2465"}], "title": "4.1. Storage endpoints"}, {"refs": [{"id": "ref-for-storage-endpoint\u2466"}], "title": "4.5. Storage buckets"}, {"refs": [{"id": "ref-for-storage-endpoint\u2467"}], "title": "4.6. Storage bottles"}], "external": false};
window.dfnpanelData['storage-endpoint-identifier'] = {"dfnID": "storage-endpoint-identifier", "url": "#storage-endpoint-identifier", "dfnText": "identifier", "refSections": [{"refs": [{"id": "ref-for-storage-endpoint-identifier"}], "title": "4.1. Storage endpoints"}, {"refs": [{"id": "ref-for-storage-endpoint-identifier\u2460"}], "title": "4.5. Storage buckets"}], "external": false};
window.dfnpanelData['storage-endpoint-types'] = {"dfnID": "storage-endpoint-types", "url": "#storage-endpoint-types", "dfnText": "types", "refSections": [{"refs": [{"id": "ref-for-storage-endpoint-types"}], "title": "4.1. Storage endpoints"}, {"refs": [{"id": "ref-for-storage-endpoint-types\u2460"}], "title": "4.5. Storage buckets"}], "external": false};
window.dfnpanelData['storage-endpoint-quota'] = {"dfnID": "storage-endpoint-quota", "url": "#storage-endpoint-quota", "dfnText": "quota", "refSections": [{"refs": [{"id": "ref-for-storage-endpoint-quota"}], "title": "4.1. Storage endpoints"}, {"refs": [{"id": "ref-for-storage-endpoint-quota\u2460"}], "title": "4.5. Storage buckets"}], "external": false};
window.dfnpanelData['storage-identifier'] = {"dfnID": "storage-identifier", "url": "#storage-identifier", "dfnText": "storage identifier", "refSections": [{"refs": [{"id": "ref-for-storage-identifier"}, {"id": "ref-for-storage-identifier\u2460"}], "title": "4.1. Storage endpoints"}, {"refs": [{"id": "ref-for-storage-identifier\u2461"}], "title": "4.5. Storage buckets"}, {"refs": [{"id": "ref-for-storage-identifier\u2462"}, {"id": "ref-for-storage-identifier\u2463"}, {"id": "ref-for-storage-identifier\u2464"}], "title": "4.6. Storage bottles"}], "external": false};
window.dfnpanelData['storage-type'] = {"dfnID": "storage-type", "url": "#storage-type", "dfnText": "storage type", "refSections": [{"refs": [{"id": "ref-for-storage-type"}], "title": "4. Model"}, {"refs": [{"id": "ref-for-storage-type\u2460"}, {"id": "ref-for-storage-type\u2461"}], "title": "4.1. Storage endpoints"}, {"refs": [{"id": "ref-for-storage-type\u2462"}, {"id": "ref-for-storage-type\u2463"}], "title": "4.4. Storage shelves"}, {"refs": [{"id": "ref-for-storage-type\u2464"}], "title": "4.5. Storage buckets"}, {"refs": [{"id": "ref-for-storage-type\u2465"}], "title": "4.6. Storage bottles"}], "external": false};
window.dfnpanelData['registered-storage-endpoints'] = {"dfnID": "registered-storage-endpoints", "url": "#registered-storage-endpoints", "dfnText": "registered storage endpoints", "refSections": [{"refs": [{"id": "ref-for-registered-storage-endpoints"}], "title": "4. Model"}, {"refs": [{"id": "ref-for-registered-storage-endpoints\u2460"}], "title": "4.5. Storage buckets"}], "external": false};
window.dfnpanelData['storage-key'] = {"dfnID": "storage-key", "url": "#storage-key", "dfnText": "storage key", "refSections": [{"refs": [{"id": "ref-for-storage-key"}, {"id": "ref-for-storage-key\u2460"}], "title": "4. Model"}, {"refs": [{"id": "ref-for-storage-key\u2461"}], "title": "4.3. Storage sheds"}, {"refs": [{"id": "ref-for-storage-key\u2462"}], "title": "4.4. Storage shelves"}, {"refs": [{"id": "ref-for-storage-key\u2463"}], "title": "7. Management"}], "external": false};
window.dfnpanelData['obtain-a-storage-key'] = {"dfnID": "obtain-a-storage-key", "url": "#obtain-a-storage-key", "dfnText": "obtain a storage key", "refSections": [{"refs": [{"id": "ref-for-obtain-a-storage-key"}], "title": "4.4. Storage shelves"}], "external": false};
window.dfnpanelData['storage-shed'] = {"dfnID": "storage-shed", "url": "#storage-shed", "dfnText": "storage shed", "refSections": [{"refs": [{"id": "ref-for-storage-shed"}], "title": "4. Model"}, {"refs": [{"id": "ref-for-storage-shed\u2460"}, {"id": "ref-for-storage-shed\u2461"}], "title": "4.3. Storage sheds"}, {"refs": [{"id": "ref-for-storage-shed\u2462"}, {"id": "ref-for-storage-shed\u2463"}], "title": "4.4. Storage shelves"}, {"refs": [{"id": "ref-for-storage-shed\u2464"}], "title": "7. Management"}], "external": false};
window.dfnpanelData['user-agent-storage-shed'] = {"dfnID": "user-agent-storage-shed", "url": "#user-agent-storage-shed", "dfnText": "storage shed", "refSections": [{"refs": [{"id": "ref-for-user-agent-storage-shed"}], "title": "4.3. Storage sheds"}, {"refs": [{"id": "ref-for-user-agent-storage-shed\u2460"}], "title": "4.4. Storage shelves"}, {"refs": [{"id": "ref-for-user-agent-storage-shed\u2461"}], "title": "4.6. Storage bottles"}], "external": false};
window.dfnpanelData['local-storage'] = {"dfnID": "local-storage", "url": "#local-storage", "dfnText": "local storage", "refSections": [{"refs": [{"id": "ref-for-local-storage"}], "title": "4.1. Storage endpoints"}, {"refs": [{"id": "ref-for-local-storage\u2460"}], "title": "4.5. Storage buckets"}], "external": false};
window.dfnpanelData['browsing-session-storage-shed'] = {"dfnID": "browsing-session-storage-shed", "url": "#browsing-session-storage-shed", "dfnText": "storage shed", "refSections": [{"refs": [{"id": "ref-for-browsing-session-storage-shed"}, {"id": "ref-for-browsing-session-storage-shed\u2460"}, {"id": "ref-for-browsing-session-storage-shed\u2461"}], "title": "4.3. Storage sheds"}, {"refs": [{"id": "ref-for-browsing-session-storage-shed\u2462"}], "title": "4.6. Storage bottles"}], "external": false};
window.dfnpanelData['session-storage'] = {"dfnID": "session-storage", "url": "#session-storage", "dfnText": "session storage", "refSections": [{"refs": [{"id": "ref-for-session-storage"}], "title": "4.1. Storage endpoints"}, {"refs": [{"id": "ref-for-session-storage\u2460"}], "title": "4.5. Storage buckets"}], "external": false};
window.dfnpanelData['storage-shelf'] = {"dfnID": "storage-shelf", "url": "#storage-shelf", "dfnText": "storage shelf", "refSections": [{"refs": [{"id": "ref-for-storage-shelf"}, {"id": "ref-for-storage-shelf\u2460"}], "title": "4. Model"}, {"refs": [{"id": "ref-for-storage-shelf\u2461"}], "title": "4.3. Storage sheds"}, {"refs": [{"id": "ref-for-storage-shelf\u2462"}, {"id": "ref-for-storage-shelf\u2463"}], "title": "4.4. Storage shelves"}, {"refs": [{"id": "ref-for-storage-shelf\u2464"}], "title": "4.6. Storage bottles"}, {"refs": [{"id": "ref-for-storage-shelf\u2465"}, {"id": "ref-for-storage-shelf\u2466"}, {"id": "ref-for-storage-shelf\u2467"}], "title": "6. Usage and quota"}, {"refs": [{"id": "ref-for-storage-shelf\u2468"}, {"id": "ref-for-storage-shelf\u2460\u24ea"}], "title": "7. Management"}], "external": false};
window.dfnpanelData['bucket-map'] = {"dfnID": "bucket-map", "url": "#bucket-map", "dfnText": "bucket map", "refSections": [{"refs": [{"id": "ref-for-bucket-map"}, {"id": "ref-for-bucket-map\u2460"}], "title": "4.3. Storage sheds"}, {"refs": [{"id": "ref-for-bucket-map\u2461"}, {"id": "ref-for-bucket-map\u2462"}], "title": "4.4. Storage shelves"}, {"refs": [{"id": "ref-for-bucket-map\u2463"}], "title": "4.6. Storage bottles"}, {"refs": [{"id": "ref-for-bucket-map\u2464"}], "title": "5. Persistence permission"}, {"refs": [{"id": "ref-for-bucket-map\u2465"}], "title": "7. Management"}, {"refs": [{"id": "ref-for-bucket-map\u2466"}, {"id": "ref-for-bucket-map\u2467"}], "title": "8. API"}], "external": false};
window.dfnpanelData['obtain-a-storage-shelf'] = {"dfnID": "obtain-a-storage-shelf", "url": "#obtain-a-storage-shelf", "dfnText": "obtain a storage shelf", "refSections": [{"refs": [{"id": "ref-for-obtain-a-storage-shelf"}, {"id": "ref-for-obtain-a-storage-shelf\u2460"}], "title": "4.4. Storage shelves"}, {"refs": [{"id": "ref-for-obtain-a-storage-shelf\u2461"}], "title": "4.6. Storage bottles"}], "external": false};
window.dfnpanelData['obtain-a-local-storage-shelf'] = {"dfnID": "obtain-a-local-storage-shelf", "url": "#obtain-a-local-storage-shelf", "dfnText": "obtain a local storage shelf", "refSections": [{"refs": [{"id": "ref-for-obtain-a-local-storage-shelf"}], "title": "5. Persistence permission"}, {"refs": [{"id": "ref-for-obtain-a-local-storage-shelf\u2460"}, {"id": "ref-for-obtain-a-local-storage-shelf\u2461"}, {"id": "ref-for-obtain-a-local-storage-shelf\u2462"}], "title": "8. API"}], "external": false};
window.dfnpanelData['create-a-storage-shelf'] = {"dfnID": "create-a-storage-shelf", "url": "#create-a-storage-shelf", "dfnText": "create a storage shelf", "refSections": [{"refs": [{"id": "ref-for-create-a-storage-shelf"}], "title": "4.3. Storage sheds"}, {"refs": [{"id": "ref-for-create-a-storage-shelf\u2460"}], "title": "4.4. Storage shelves"}], "external": false};
window.dfnpanelData['storage-bucket'] = {"dfnID": "storage-bucket", "url": "#storage-bucket", "dfnText": "storage bucket", "refSections": [{"refs": [{"id": "ref-for-storage-bucket"}, {"id": "ref-for-storage-bucket\u2460"}, {"id": "ref-for-storage-bucket\u2461"}], "title": "4. Model"}, {"refs": [{"id": "ref-for-storage-bucket\u2462"}], "title": "4.4. Storage shelves"}, {"refs": [{"id": "ref-for-storage-bucket\u2463"}, {"id": "ref-for-storage-bucket\u2464"}, {"id": "ref-for-storage-bucket\u2465"}], "title": "4.5. Storage buckets"}, {"refs": [{"id": "ref-for-storage-bucket\u2466"}], "title": "4.6. Storage bottles"}, {"refs": [{"id": "ref-for-storage-bucket\u2467"}, {"id": "ref-for-storage-bucket\u2468"}, {"id": "ref-for-storage-bucket\u2460\u24ea"}], "title": "7. Management"}], "external": false};
window.dfnpanelData['bottle-map'] = {"dfnID": "bottle-map", "url": "#bottle-map", "dfnText": "bottle map", "refSections": [{"refs": [{"id": "ref-for-bottle-map"}, {"id": "ref-for-bottle-map\u2460"}], "title": "4.3. Storage sheds"}, {"refs": [{"id": "ref-for-bottle-map\u2461"}], "title": "4.5. Storage buckets"}, {"refs": [{"id": "ref-for-bottle-map\u2462"}], "title": "4.6. Storage bottles"}], "external": false};
window.dfnpanelData['bucket'] = {"dfnID": "bucket", "url": "#bucket", "dfnText": "local storage bucket", "refSections": [{"refs": [{"id": "ref-for-bucket"}, {"id": "ref-for-bucket\u2460"}], "title": "4.5. Storage buckets"}, {"refs": [{"id": "ref-for-bucket\u2461"}], "title": "5. Persistence permission"}, {"refs": [{"id": "ref-for-bucket\u2462"}, {"id": "ref-for-bucket\u2463"}], "title": "7.1. Storage pressure"}], "external": false};
window.dfnpanelData['bucket-mode'] = {"dfnID": "bucket-mode", "url": "#bucket-mode", "dfnText": "mode", "refSections": [{"refs": [{"id": "ref-for-bucket-mode"}, {"id": "ref-for-bucket-mode\u2460"}], "title": "5. Persistence permission"}, {"refs": [{"id": "ref-for-bucket-mode\u2461"}, {"id": "ref-for-bucket-mode\u2462"}], "title": "7.1. Storage pressure"}, {"refs": [{"id": "ref-for-bucket-mode\u2463"}, {"id": "ref-for-bucket-mode\u2464"}, {"id": "ref-for-bucket-mode\u2465"}], "title": "8. API"}], "external": false};
window.dfnpanelData['session-storage-bucket'] = {"dfnID": "session-storage-bucket", "url": "#session-storage-bucket", "dfnText": "session storage bucket", "refSections": [{"refs": [{"id": "ref-for-session-storage-bucket"}], "title": "4.5. Storage buckets"}, {"refs": [{"id": "ref-for-session-storage-bucket\u2460"}], "title": "7.1. Storage pressure"}], "external": false};
window.dfnpanelData['create-a-storage-bucket'] = {"dfnID": "create-a-storage-bucket", "url": "#create-a-storage-bucket", "dfnText": "create a storage bucket", "refSections": [{"refs": [{"id": "ref-for-create-a-storage-bucket"}], "title": "4.4. Storage shelves"}], "external": false};
window.dfnpanelData['storage-bottle'] = {"dfnID": "storage-bottle", "url": "#storage-bottle", "dfnText": "storage bottle", "refSections": [{"refs": [{"id": "ref-for-storage-bottle"}], "title": "4. Model"}, {"refs": [{"id": "ref-for-storage-bottle\u2460"}, {"id": "ref-for-storage-bottle\u2461"}], "title": "4.1. Storage endpoints"}, {"refs": [{"id": "ref-for-storage-bottle\u2462"}, {"id": "ref-for-storage-bottle\u2463"}], "title": "4.5. Storage buckets"}, {"refs": [{"id": "ref-for-storage-bottle\u2464"}, {"id": "ref-for-storage-bottle\u2465"}, {"id": "ref-for-storage-bottle\u2466"}, {"id": "ref-for-storage-bottle\u2467"}], "title": "4.6. Storage bottles"}], "external": false};
window.dfnpanelData['storage-bottle-map'] = {"dfnID": "storage-bottle-map", "url": "#storage-bottle-map", "dfnText": "map", "refSections": [{"refs": [{"id": "ref-for-storage-bottle-map"}, {"id": "ref-for-storage-bottle-map\u2460"}], "title": "4.3. Storage sheds"}, {"refs": [{"id": "ref-for-storage-bottle-map\u2461"}, {"id": "ref-for-storage-bottle-map\u2462"}], "title": "4.6. Storage bottles"}], "external": false};
window.dfnpanelData['storage-bottle-proxy-map-reference-set'] = {"dfnID": "storage-bottle-proxy-map-reference-set", "url": "#storage-bottle-proxy-map-reference-set", "dfnText": "proxy map reference set", "refSections": [{"refs": [{"id": "ref-for-storage-bottle-proxy-map-reference-set"}], "title": "4.6. Storage bottles"}], "external": false};
window.dfnpanelData['storage-bottle-quota'] = {"dfnID": "storage-bottle-quota", "url": "#storage-bottle-quota", "dfnText": "quota", "refSections": [{"refs": [{"id": "ref-for-storage-bottle-quota"}], "title": "4.1. Storage endpoints"}, {"refs": [{"id": "ref-for-storage-bottle-quota\u2460"}], "title": "4.5. Storage buckets"}], "external": false};
window.dfnpanelData['obtain-a-storage-bottle-map'] = {"dfnID": "obtain-a-storage-bottle-map", "url": "#obtain-a-storage-bottle-map", "dfnText": "obtain a storage bottle map", "refSections": [{"refs": [{"id": "ref-for-obtain-a-storage-bottle-map"}, {"id": "ref-for-obtain-a-storage-bottle-map\u2460"}], "title": "4.6. Storage bottles"}], "external": false};
window.dfnpanelData['obtain-a-local-storage-bottle-map'] = {"dfnID": "obtain-a-local-storage-bottle-map", "url": "#obtain-a-local-storage-bottle-map", "dfnText": "obtain a local storage bottle map", "refSections": [{"refs": [{"id": "ref-for-obtain-a-local-storage-bottle-map"}], "title": "4. Model"}, {"refs": [{"id": "ref-for-obtain-a-local-storage-bottle-map\u2460"}], "title": "4.1. Storage endpoints"}], "external": false};
window.dfnpanelData['obtain-a-session-storage-bottle-map'] = {"dfnID": "obtain-a-session-storage-bottle-map", "url": "#obtain-a-session-storage-bottle-map", "dfnText": "obtain a session storage bottle map", "refSections": [{"refs": [{"id": "ref-for-obtain-a-session-storage-bottle-map"}], "title": "4. Model"}, {"refs": [{"id": "ref-for-obtain-a-session-storage-bottle-map\u2460"}], "title": "4.1. Storage endpoints"}], "external": false};
window.dfnpanelData['storage-proxy-map'] = {"dfnID": "storage-proxy-map", "url": "#storage-proxy-map", "dfnText": "storage proxy map", "refSections": [{"refs": [{"id": "ref-for-storage-proxy-map"}], "title": "4. Model"}, {"refs": [{"id": "ref-for-storage-proxy-map\u2460"}], "title": "4.6. Storage bottles"}], "external": false};
window.dfnpanelData['storage-proxy-map-backing-map'] = {"dfnID": "storage-proxy-map-backing-map", "url": "#storage-proxy-map-backing-map", "dfnText": "backing map", "refSections": [{"refs": [{"id": "ref-for-storage-proxy-map-backing-map"}], "title": "4.6. Storage bottles"}, {"refs": [{"id": "ref-for-storage-proxy-map-backing-map\u2460"}], "title": "4.7. Storage proxy maps"}], "external": false};
window.dfnpanelData['storage-usage'] = {"dfnID": "storage-usage", "url": "#storage-usage", "dfnText": "storage usage", "refSections": [{"refs": [{"id": "ref-for-storage-usage"}], "title": "8. API"}], "external": false};
window.dfnpanelData['storage-quota'] = {"dfnID": "storage-quota", "url": "#storage-quota", "dfnText": "storage quota", "refSections": [{"refs": [{"id": "ref-for-storage-quota"}], "title": "4.6. Storage bottles"}, {"refs": [{"id": "ref-for-storage-quota\u2460"}], "title": "8. API"}], "external": false};
window.dfnpanelData['navigatorstorage'] = {"dfnID": "navigatorstorage", "url": "#navigatorstorage", "dfnText": "NavigatorStorage", "refSections": [{"refs": [{"id": "ref-for-navigatorstorage"}, {"id": "ref-for-navigatorstorage\u2460"}], "title": "8. API"}], "external": false};
window.dfnpanelData['dom-navigatorstorage-storage'] = {"dfnID": "dom-navigatorstorage-storage", "url": "#dom-navigatorstorage-storage", "dfnText": "storage", "refSections": [{"refs": [{"id": "ref-for-dom-navigatorstorage-storage"}], "title": "8. API"}], "external": false};
window.dfnpanelData['storagemanager'] = {"dfnID": "storagemanager", "url": "#storagemanager", "dfnText": "StorageManager", "refSections": [{"refs": [{"id": "ref-for-storagemanager"}, {"id": "ref-for-storagemanager\u2460"}, {"id": "ref-for-storagemanager\u2461"}], "title": "8. API"}], "external": false};
window.dfnpanelData['dictdef-storageestimate'] = {"dfnID": "dictdef-storageestimate", "url": "#dictdef-storageestimate", "dfnText": "StorageEstimate", "refSections": [{"refs": [{"id": "ref-for-dictdef-storageestimate"}, {"id": "ref-for-dictdef-storageestimate\u2460"}], "title": "8. API"}], "external": false};
window.dfnpanelData['dom-storageestimate-usage'] = {"dfnID": "dom-storageestimate-usage", "url": "#dom-storageestimate-usage", "dfnText": "usage", "refSections": [{"refs": [{"id": "ref-for-dom-storageestimate-usage"}], "title": "8. API"}], "external": false};
window.dfnpanelData['dom-storageestimate-quota'] = {"dfnID": "dom-storageestimate-quota", "url": "#dom-storageestimate-quota", "dfnText": "quota", "refSections": [{"refs": [{"id": "ref-for-dom-storageestimate-quota"}], "title": "8. API"}], "external": false};
window.dfnpanelData['dom-storagemanager-persisted'] = {"dfnID": "dom-storagemanager-persisted", "url": "#dom-storagemanager-persisted", "dfnText": "persisted()", "refSections": [{"refs": [{"id": "ref-for-dom-storagemanager-persisted"}], "title": "8. API"}], "external": false};
window.dfnpanelData['dom-storagemanager-persist'] = {"dfnID": "dom-storagemanager-persist", "url": "#dom-storagemanager-persist", "dfnText": "persist()", "refSections": [{"refs": [{"id": "ref-for-dom-storagemanager-persist"}], "title": "1. Introduction"}, {"refs": [{"id": "ref-for-dom-storagemanager-persist\u2460"}], "title": "8. API"}], "external": false};
window.dfnpanelData['dom-storagemanager-estimate'] = {"dfnID": "dom-storagemanager-estimate", "url": "#dom-storagemanager-estimate", "dfnText": "estimate()", "refSections": [{"refs": [{"id": "ref-for-dom-storagemanager-estimate"}], "title": "1. Introduction"}, {"refs": [{"id": "ref-for-dom-storagemanager-estimate\u2460"}], "title": "8. API"}], "external": false};
</script>
<script>/* Boilerplate: script-dom-helper */
function query(sel) { return document.querySelector(sel); }

function queryAll(sel) { return [...document.querySelectorAll(sel)]; }

function iter(obj) {
	if(!obj) return [];
	var it = obj[Symbol.iterator];
	if(it) return it;
	return Object.entries(obj);
}

function mk(tagname, attrs, ...children) {
	const el = document.createElement(tagname);
	for(const [k,v] of iter(attrs)) {
		if(k.slice(0,3) == "_on") {
			const eventName = k.slice(3);
			el.addEventListener(eventName, v);
		} else if(k[0] == "_") {
			// property, not attribute
			el[k.slice(1)] = v;
		} else {
			if(v === false || v == null) {
        continue;
      } else if(v === true) {
        el.setAttribute(k, "");
        continue;
      } else {
  			el.setAttribute(k, v);
      }
		}
	}
	append(el, children);
	return el;
}

/* Create shortcuts for every known HTML element */
[
  "a",
  "abbr",
  "acronym",
  "address",
  "applet",
  "area",
  "article",
  "aside",
  "audio",
  "b",
  "base",
  "basefont",
  "bdo",
  "big",
  "blockquote",
  "body",
  "br",
  "button",
  "canvas",
  "caption",
  "center",
  "cite",
  "code",
  "col",
  "colgroup",
  "datalist",
  "dd",
  "del",
  "details",
  "dfn",
  "dialog",
  "div",
  "dl",
  "dt",
  "em",
  "embed",
  "fieldset",
  "figcaption",
  "figure",
  "font",
  "footer",
  "form",
  "frame",
  "frameset",
  "head",
  "header",
  "h1",
  "h2",
  "h3",
  "h4",
  "h5",
  "h6",
  "hr",
  "html",
  "i",
  "iframe",
  "img",
  "input",
  "ins",
  "kbd",
  "label",
  "legend",
  "li",
  "link",
  "main",
  "map",
  "mark",
  "meta",
  "meter",
  "nav",
  "nobr",
  "noscript",
  "object",
  "ol",
  "optgroup",
  "option",
  "output",
  "p",
  "param",
  "pre",
  "progress",
  "q",
  "s",
  "samp",
  "script",
  "section",
  "select",
  "small",
  "source",
  "span",
  "strike",
  "strong",
  "style",
  "sub",
  "summary",
  "sup",
  "table",
  "tbody",
  "td",
  "template",
  "textarea",
  "tfoot",
  "th",
  "thead",
  "time",
  "title",
  "tr",
  "u",
  "ul",
  "var",
  "video",
  "wbr",
  "xmp",
].forEach(tagname=>{
	mk[tagname] = (...args) => mk(tagname, ...args);
});

function* nodesFromChildList(children) {
	for(const child of children.flat(Infinity)) {
		if(child instanceof Node) {
			yield child;
		} else {
			yield new Text(child);
		}
	}
}
function append(el, ...children) {
	for(const child of nodesFromChildList(children)) {
		if(el instanceof Node) el.appendChild(child);
		else el.push(child);
	}
	return el;
}

function insertAfter(el, ...children) {
	for(const child of nodesFromChildList(children)) {
		el.parentNode.insertBefore(child, el.nextSibling);
	}
	return el;
}

function clearContents(el) {
	el.innerHTML = "";
	return el;
}

function parseHTML(markup) {
	if(markup.toLowerCase().trim().indexOf('<!doctype') === 0) {
		const doc = document.implementation.createHTMLDocument("");
		doc.documentElement.innerHTML = markup;
		return doc;
	} else {
		const el = mk.template({});
		el.innerHTML = markup;
		return el.content;
	}
}
</script>
<script>/* Boilerplate: script-position-annos */
"use strict";
{

function repositionAnnoPanels(){
    const panels = [...document.querySelectorAll("[data-anno-for]")];
    const main = document.querySelector("main");
    let mainRect;
    if(main) mainRect = main.getBoundingClientRect();
    for(const panel of panels) {
        const dfn = document.getElementById(panel.getAttribute("data-anno-for"));
        if(!dfn) {
            console.log("Can't find the annotation panel target:", panel);
            continue;
        }
        const rect = dfn.getBoundingClientRect();
        const top = window.scrollY + rect.top
        panel.style.top = top + "px";
        panel.top = top;
        panel.height = rect.height;
        panel.classList.remove("unpositioned");
        const panelRect = panel.getBoundingClientRect()
        if(main) {
            panel.classList.toggle("overlapping-main", panelRect.left < mainRect.right)
        }
    }
    let vSoFar = 0;
    for(const panel of panels.sort(cmpTops)) {
        if(panel.top < vSoFar) {
            panel.top = vSoFar;
            panel.style.top = vSoFar + "px";
        }
        vSoFar = panel.top + panel.height + 15;
    }
}

function cmpTops(a,b) {
    return a.top - b.top;
}

window.addEventListener("load", repositionAnnoPanels);
window.addEventListener("resize", repositionAnnoPanels);
}
</script>
<script>/* Boilerplate: script-var-click-highlighting */
/*
Color-choosing design:

Colors are ordered by goodness.
Each color has a usage count (initially zero).
Each variable has a last-used color.

* If the var has a last-used color, and that color's usage is 0,
    return that color.
* Otherwise, return the lowest-indexed color with the lowest usage.
    Increment the color's usage and set it as the last-used color
    for that var.
* On unclicking, decrement usage of the color.
*/
"use strict";
{
    document.addEventListener("click", e=>{
        if(e.target.nodeName == "VAR") {
            highlightSameAlgoVars(e.target);
        }
    });
    const indexCounts = new Map();
    const indexNames = new Map();
    function highlightSameAlgoVars(v) {
        // Find the algorithm container.
        let algoContainer = null;
        let searchEl = v;
        while(algoContainer == null && searchEl != document.body) {
            searchEl = searchEl.parentNode;
            if(searchEl.hasAttribute("data-algorithm")) {
                algoContainer = searchEl;
            }
        }

        // Not highlighting document-global vars,
        // too likely to be unrelated.
        if(algoContainer == null) return;

        const algoName = algoContainer.getAttribute("data-algorithm");
        const varName = getVarName(v);
        const addClass = !v.classList.contains("selected");
        let highlightClass = null;
        if(addClass) {
            const index = chooseHighlightIndex(algoName, varName);
            indexCounts.get(algoName)[index] += 1;
            indexNames.set(algoName+"///"+varName, index);
            highlightClass = nameFromIndex(index);
        } else {
            const index = previousHighlightIndex(algoName, varName);
            indexCounts.get(algoName)[index] -= 1;
            highlightClass = nameFromIndex(index);
        }

        // Find all same-name vars, and toggle their class appropriately.
        for(const el of algoContainer.querySelectorAll("var")) {
            if(getVarName(el) == varName) {
                el.classList.toggle("selected", addClass);
                el.classList.toggle(highlightClass, addClass);
            }
        }
    }
    function getVarName(el) {
        return el.textContent.replace(/(\s|\xa0)+/, " ").trim();
    }
    function chooseHighlightIndex(algoName, varName) {
        let indexes = null;
        if(indexCounts.has(algoName)) {
            indexes = indexCounts.get(algoName);
        } else {
            // 7 classes right now
            indexes = [0,0,0,0,0,0,0];
            indexCounts.set(algoName, indexes);
        }

        // If the element was recently unclicked,
        // *and* that color is still unclaimed,
        // give it back the same color.
        const lastIndex = previousHighlightIndex(algoName, varName);
        if(indexes[lastIndex] === 0) return lastIndex;

        // Find the earliest index with the lowest count.
        const minCount = Math.min.apply(null, indexes);
        let index = null;
        for(var i = 0; i < indexes.length; i++) {
            if(indexes[i] == minCount) {
                return i;
            }
        }
    }
    function previousHighlightIndex(algoName, varName) {
        return indexNames.get(algoName+"///"+varName);
    }
    function nameFromIndex(index) {
        return "selected" + index;
    }
}
</script>