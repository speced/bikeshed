<!doctype html><html lang="en">
 <head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
  <meta content="#3c790a" name="theme-color">
  <meta content="light dark" name="color-scheme">
  <title>MIME Sniffing Standard</title>
  <link crossorigin href="https://resources.whatwg.org/standard-shared-with-dev.css" rel="stylesheet">
  <link crossorigin href="https://resources.whatwg.org/standard.css" rel="stylesheet">
  <link crossorigin href="https://resources.whatwg.org/spec.css" rel="stylesheet">
  <link crossorigin href="https://resources.whatwg.org/logo-mimesniff.svg" rel="icon">
  <script crossorigin defer src="https://resources.whatwg.org/commit-snapshot-shortcut-key.js"></script>
<style>/* Boilerplate: style-dfn-panel */
:root {
    --dfnpanel-bg: #ddd;
    --dfnpanel-text: var(--text);
    --dfnpanel-target-bg: #ffc;
    --dfnpanel-target-outline: orange;
}
@media (prefers-color-scheme: dark) {
    :root {
        --dfnpanel-bg: #222;
        --dfnpanel-text: var(--text);
        --dfnpanel-target-bg: #333;
        --dfnpanel-target-outline: silver;
    }
}
.dfn-panel {
    position: absolute;
    z-index: 35;
    width: 20em;
    width: 300px;
    height: auto;
    max-height: 500px;
    overflow: auto;
    padding: 0.5em 0.75em;
    font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
    background: var(--dfnpanel-bg);
    color: var(--dfnpanel-text);
    border: outset 0.2em;
    white-space: normal; /* in case it's moved into a pre */
}
.dfn-panel:not(.on) { display: none; }
.dfn-panel * { margin: 0; padding: 0; text-indent: 0; }
.dfn-panel > b { display: block; }
.dfn-panel a { color: var(--dfnpanel-text); }
.dfn-panel a:not(:hover) { text-decoration: none !important; border-bottom: none !important; }
.dfn-panel a:focus {
    outline: 5px auto Highlight;
    outline: 5px auto -webkit-focus-ring-color;
}
.dfn-panel > b + b { margin-top: 0.25em; }
.dfn-panel ul { padding: 0 0 0 1em; list-style: none; }
.dfn-panel li a {
    max-width: calc(300px - 1.5em - 1em);
    overflow: hidden;
    text-overflow: ellipsis;
}

.dfn-panel.activated {
    display: inline-block;
    position: fixed;
    left: 8px;
    bottom: 2em;
    margin: 0 auto;
    max-width: calc(100vw - 1.5em - .4em - .5em);
    max-height: 30vh;
    transition: left 1s ease-out, bottom 1s ease-out;
}

.dfn-panel .link-item:hover {
    text-decoration: underline;
}
.dfn-panel .link-item .copy-icon {
    opacity: 0;
}
.dfn-panel .link-item:hover .copy-icon,
.dfn-panel .link-item .copy-icon:focus {
    opacity: 1;
}

.dfn-panel .copy-icon {
    display: inline-block;
    margin-right: 0.5em;
    width: 0.85em;
    height: 1em;
    border-radius: 3px;
    background-color: #ccc;
    cursor: pointer;
}

.dfn-panel .copy-icon .icon {
    width: 100%;
    height: 100%;
    background-color: #fff;
    display: flex;
    justify-content: center;
    align-items: center;
    position: relative;
}

.dfn-panel .copy-icon .icon::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    border: 1px solid black;
    background-color: #ccc;
    opacity: 0.25;
    transform: translate(3px, -3px);
}

.dfn-panel .copy-icon:active .icon::before {
    opacity: 1;
}

.dfn-paneled[role="button"] { cursor: help; }

.highlighted {
    animation: target-fade 3s;
}

@keyframes target-fade {
    from {
        background-color: var(--dfnpanel-target-bg);
        outline: 5px solid var(--dfnpanel-target-outline);
    }
    to {
        color: var(--a-normal-text);
        background-color: transparent;
        outline: transparent;
    }
}
</style>
<style>/* Boilerplate: style-ref-hints */
:root {
    --ref-hint-bg: #ddd;
    --ref-hint-text: var(--text);
}
@media (prefers-color-scheme: dark) {
    :root {
        --ref-hint-bg: #222;
        --ref-hint-text: var(--text);
    }
}

.ref-hint {
    display: inline-block;
    position: absolute;
    z-index: 35;
    width: 20em;
    width: 300px;
    height: auto;
    max-height: 500px;
    overflow: auto;
    padding: 0.5em 0.5em;
    font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
    background: var(--ref-hint-bg);
    color: var(--ref-hint-text);
    border: outset 0.2em;
    white-space: normal; /* in case it's moved into a pre */
}

.ref-hint * { margin: 0; padding: 0; text-indent: 0; }

.ref-hint ul { padding: 0 0 0 1em; list-style: none; }
</style>
 <body class="h-entry status-LS">
  <div class="head">
    <a class="logo" href="https://whatwg.org/"> <img alt="WHATWG" class="darkmode-aware" crossorigin height="100" src="https://resources.whatwg.org/logo-mimesniff.svg"> </a> 
   <hgroup>
    <h1 class="p-name no-ref" id="title">MIME Sniffing</h1>
    <p id="subtitle">Living Standard — Last Updated <time class="dt-updated" datetime="1970-01-01">1 January 1970</time> </p>
   </hgroup>
   <div data-fill-with="spec-metadata">
    <dl>
     <dt>Participate:
     <dd><a href="https://github.com/whatwg/mimesniff">GitHub whatwg/mimesniff</a> (<a href="https://github.com/whatwg/mimesniff/issues/new/choose">new issue</a>, <a href="https://github.com/whatwg/mimesniff/issues">open issues</a>)
     <dd><a href="https://whatwg.org/chat">Chat on Matrix</a>
     <dt>Commits:
     <dd><a href="https://github.com/whatwg/mimesniff/commits">GitHub whatwg/mimesniff/commits</a>
     <dd><a href="/commit-snapshots/[COMMIT-SHA]/" id="commit-snapshot-link">Snapshot as of this commit</a>
     <dd><a href="https://twitter.com/mimesniff">@mimesniff</a>
     <dt>Tests:
     <dd><a href="https://github.com/web-platform-tests/wpt/tree/master/mimesniff">web-platform-tests mimesniff/</a> (<a href="https://github.com/web-platform-tests/wpt/labels/mimesniff">ongoing work</a>)
     <dt>Translations <small>(non-normative)</small>:
     <dd><span title="Japanese"><a href="https://triple-underscore.github.io/mimesniff-ja.html" hreflang="ja" lang="ja" rel="alternate">日本語</a></span>
    </dl>
   </div>
   <div data-fill-with="warning"></div>
  </div>
  <div class="p-summary" data-fill-with="abstract">
   <h2 class="no-num no-toc no-ref heading settled" id="abstract"><span class="content">Abstract</span></h2>
   <p>The MIME Sniffing standard defines sniffing resources.</p>
  </div>
  <nav data-fill-with="table-of-contents" id="toc">
   <h2 class="no-num no-toc no-ref" id="contents">Table of Contents</h2>
   <ol class="toc" role="directory">
    <li><a href="#introduction"><span class="secno">1</span> <span class="content">Introduction</span></a>
    <li><a href="#conformance-requirements"><span class="secno">2</span> <span class="content">Conformance requirements</span></a>
    <li><a href="#terminology"><span class="secno">3</span> <span class="content">Terminology</span></a>
    <li>
     <a href="#understanding-mime-types"><span class="secno">4</span> <span class="content">MIME types</span></a>
     <ol class="toc">
      <li><a href="#mime-type-representation"><span class="secno">4.1</span> <span class="content">MIME type representation</span></a>
      <li><a href="#mime-type-miscellaneous"><span class="secno">4.2</span> <span class="content">MIME type miscellaneous</span></a>
      <li><a href="#mime-type-writing"><span class="secno">4.3</span> <span class="content">MIME type writing</span></a>
      <li><a href="#parsing-a-mime-type"><span class="secno">4.4</span> <span class="content">Parsing a MIME type</span></a>
      <li><a href="#serializing-a-mime-type"><span class="secno">4.5</span> <span class="content">Serializing a MIME type</span></a>
      <li><a href="#mime-type-groups"><span class="secno">4.6</span> <span class="content">MIME type groups</span></a>
     </ol>
    <li>
     <a href="#handling-a-resource"><span class="secno">5</span> <span class="content">Handling a resource</span></a>
     <ol class="toc">
      <li><a href="#interpreting-the-resource-metadata"><span class="secno">5.1</span> <span class="content">Interpreting the resource metadata</span></a>
      <li><a href="#reading-the-resource-header"><span class="secno">5.2</span> <span class="content">Reading the resource header</span></a>
     </ol>
    <li>
     <a href="#matching-a-mime-type-pattern"><span class="secno">6</span> <span class="content">Matching a MIME type pattern</span></a>
     <ol class="toc">
      <li><a href="#matching-an-image-type-pattern"><span class="secno">6.1</span> <span class="content">Matching an image type pattern</span></a>
      <li>
       <a href="#matching-an-audio-or-video-type-pattern"><span class="secno">6.2</span> <span class="content">Matching an audio or video type pattern</span></a>
       <ol class="toc">
        <li><a href="#signature-for-mp4"><span class="secno">6.2.1</span> <span class="content">Signature for MP4</span></a>
        <li><a href="#signature-for-webm"><span class="secno">6.2.2</span> <span class="content">Signature for WebM</span></a>
        <li><a href="#signature-for-mp3-without-id3"><span class="secno">6.2.3</span> <span class="content">Signature for MP3 without ID3</span></a>
       </ol>
      <li><a href="#matching-a-font-type-pattern"><span class="secno">6.3</span> <span class="content">Matching a font type pattern</span></a>
      <li><a href="#matching-an-archive-type-pattern"><span class="secno">6.4</span> <span class="content">Matching an archive type pattern</span></a>
     </ol>
    <li>
     <a href="#determining-the-computed-mime-type-of-a-resource"><span class="secno">7</span> <span class="content">Determining the computed MIME type of a resource</span></a>
     <ol class="toc">
      <li><a href="#identifying-a-resource-with-an-unknown-mime-type"><span class="secno">7.1</span> <span class="content">Identifying a resource with an unknown MIME type</span></a>
      <li><a href="#sniffing-a-mislabeled-binary-resource"><span class="secno">7.2</span> <span class="content">Sniffing a mislabeled binary resource</span></a>
      <li><a href="#sniffing-a-mislabeled-feed"><span class="secno">7.3</span> <span class="content">Sniffing a mislabeled feed</span></a>
     </ol>
    <li>
     <a href="#context-specific-sniffing"><span class="secno">8</span> <span class="content">Context-specific sniffing</span></a>
     <ol class="toc">
      <li><a href="#sniffing-in-a-browsing-context"><span class="secno">8.1</span> <span class="content">Sniffing in a browsing context</span></a>
      <li><a href="#sniffing-in-an-image-context"><span class="secno">8.2</span> <span class="content">Sniffing in an image context</span></a>
      <li><a href="#sniffing-in-an-audio-or-video-context"><span class="secno">8.3</span> <span class="content">Sniffing in an audio or video context</span></a>
      <li><a href="#sniffing-in-a-plugin-context"><span class="secno">8.4</span> <span class="content">Sniffing in a plugin context</span></a>
      <li><a href="#sniffing-in-a-style-context"><span class="secno">8.5</span> <span class="content">Sniffing in a style context</span></a>
      <li><a href="#sniffing-in-a-script-context"><span class="secno">8.6</span> <span class="content">Sniffing in a script context</span></a>
      <li><a href="#sniffing-in-a-font-context"><span class="secno">8.7</span> <span class="content">Sniffing in a font context</span></a>
      <li><a href="#sniffing-in-a-text-track-context"><span class="secno">8.8</span> <span class="content">Sniffing in a text track context</span></a>
      <li><a href="#sniffing-in-a-cache-manifest-context"><span class="secno">8.9</span> <span class="content">Sniffing in a cache manifest context</span></a>
     </ol>
    <li><a href="#acknowledgements"><span class="secno"></span> <span class="content">Acknowledgments</span></a>
    <li><a href="#ipr"><span class="secno"></span> <span class="content">Intellectual property rights</span></a>
    <li>
     <a href="#index"><span class="secno"></span> <span class="content">Index</span></a>
     <ol class="toc">
      <li><a href="#index-defined-here"><span class="secno"></span> <span class="content">Terms defined by this specification</span></a>
      <li><a href="#index-defined-elsewhere"><span class="secno"></span> <span class="content">Terms defined by reference</span></a>
     </ol>
    <li>
     <a href="#references"><span class="secno"></span> <span class="content">References</span></a>
     <ol class="toc">
      <li><a href="#normative"><span class="secno"></span> <span class="content">Normative References</span></a>
      <li><a href="#informative"><span class="secno"></span> <span class="content">Informative References</span></a>
     </ol>
   </ol>
  </nav>
  <main>
   <h2 class="heading settled" data-level="1" id="introduction"><span class="secno">1. </span><span class="content">Introduction</span><a class="self-link" href="#introduction"></a></h2>
   <p> The HTTP <code>Content-Type</code> header field is intended to indicate the
 MIME type of an HTTP response.
 However, many HTTP servers supply a <code>Content-Type</code> header field
 value that does not match the actual contents of the response.
 Historically, web browsers have tolerated these servers by examining the
 content of HTTP responses in addition to the <code>Content-Type</code> header
 field in order to determine the effective MIME type of the response. </p>
   <p> Without a clear specification for how to "sniff" the MIME type, each user
 agent has been forced to reverse-engineer the algorithms of other user agents
 in order to maintain interoperability.
 Inevitably, these efforts have not been entirely successful, resulting in
 divergent behaviors among user agents.
 In some cases, these divergent behaviors have had security implications, as a
 user agent could interpret an HTTP response as a different MIME type than
 the server intended. </p>
   <p> These security issues are most severe when an "honest" server allows
 potentially malicious users to upload their own files and then serves the
 contents of those files with a low-privilege MIME type.
 For example, if a server believes that the client will treat a contributed
 file as an image (and thus treat it as benign), but a user agent believes the
 content to be HTML (and thus privileged to execute any scripts contained
 therein), an attacker might be able to steal the user’s authentication
 credentials and mount other cross-site scripting attacks.
 (Malicious servers, of course, can specify an arbitrary MIME type in the <code>Content-Type</code> header field.) </p>
   <p> This document describes a content sniffing algorithm that carefully balances
 the compatibility needs of user agent with the security constraints imposed
 by existing web content.
 The algorithm originated from research conducted by Adam Barth, Juan
 Caballero, and Dawn Song, based on content sniffing algorithms present in
 popular user agents, an extensive database of existing web content, and
 metrics collected from implementations deployed to a sizable number of users. <a data-link-type="biblio" href="#biblio-seccontsniff" title="Secure Content Sniffing for Web Browsers, or How to Stop Papers from Reviewing Themselves">[SECCONTSNIFF]</a> </p>
   <h2 class="heading settled" data-level="2" id="conformance-requirements"><span class="secno">2. </span><span class="content">Conformance requirements</span><a class="self-link" href="#conformance-requirements"></a></h2>
   <p> The keywords "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD",
 "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and "OPTIONAL" in this
 document are to be interpreted as described in RFC 2119.
 For readability, these keywords will generally not appear in all uppercase
 letters. <a data-link-type="biblio" href="#biblio-rfc2119" title="Key words for use in RFCs to Indicate Requirement Levels">[RFC2119]</a> </p>
   <p> Requirements phrased in the imperative as part of algorithms (such as "strip
 any leading space characters" or "return false and abort these steps") are to
 be interpreted with the meaning of the keyword used in introducing the
 algorithm. </p>
   <p> Conformance requirements phrased as algorithms or specific steps can be
 implemented in any manner, so long as the end result is equivalent.
 In particular, note that the algorithms defined in this specification are
 intended to be easy to understand and are not intended to be performant. </p>
   <h2 class="heading settled" data-level="3" id="terminology"><span class="secno">3. </span><span class="content">Terminology</span><a class="self-link" href="#terminology"></a></h2>
   <p> This specification depends on the Infra Standard. <a data-link-type="biblio" href="#biblio-infra" title="Infra Standard">[INFRA]</a> </p>
   <p>An <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="http-token-code-point">HTTP token code point</dfn> is U+0021 (!), U+0023 (#), U+0024 ($), U+0025 (%),
U+0026 (&amp;), U+0027 ('), U+002A (*), U+002B (+), U+002D (-), U+002E (.), U+005E (^), U+005F (_),
U+0060 (`), U+007C (|), U+007E (~), or an <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ascii-alphanumeric" id="ref-for-ascii-alphanumeric">ASCII alphanumeric</a>.</p>
   <p class="note" role="note">This matches the value space of the <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc7230#section-3.2.6" id="ref-for-section-3.2.6">token</a> token production. <a data-link-type="biblio" href="#biblio-http" title="HTTP/1.1">[HTTP]</a> </p>
   <p>An <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="http-quoted-string-token-code-point">HTTP quoted-string token code point</dfn> is U+0009 TAB, a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#code-point" id="ref-for-code-point">code point</a> in the range
U+0020 SPACE to U+007E (~), inclusive, or a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#code-point" id="ref-for-code-point①">code point</a> in the range U+0080 through
U+00FF (ÿ), inclusive. </p>
   <p class="note" role="note">This matches the effective value space of the <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc7230#section-3.2.6" id="ref-for-section-3.2.6①">quoted-string</a> token
production. By definition it is a superset of the <a data-link-type="dfn" href="#http-token-code-point" id="ref-for-http-token-code-point">HTTP token code points</a>. <a data-link-type="biblio" href="#biblio-http" title="HTTP/1.1">[HTTP]</a> </p>
   <p> A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="binary-data-byte">binary data byte</dfn> is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte" id="ref-for-byte">byte</a> in the range 0x00 to
 0x08 (NUL to BS), the <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte" id="ref-for-byte①">byte</a> 0x0B (VT), a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte" id="ref-for-byte②">byte</a> in the
 range 0x0E to 0x1A (SO to SUB), or a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte" id="ref-for-byte③">byte</a> in the range 0x1C to
 0x1F (FS to US). </p>
   <p> A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="whitespace-byte">whitespace byte</dfn> (abbreviated <abbr data-lt="whitespace byte">0xWS</abbr>) is any one of the following <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte" id="ref-for-byte④">bytes</a>: 0x09 (HT), 0x0A (LF), 0x0C (FF), 0x0D (CR),
 0x20 (SP). </p>
   <p> A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="tag-terminating-byte">tag-terminating byte</dfn> (abbreviated <abbr data-lt="tag terminating byte">0xTT</abbr>) is any one of the following <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte" id="ref-for-byte⑤">bytes</a>: 0x20 (SP), 0x3E ("<code>></code>"). </p>
   <p> Equations are using the mathematical operators as defined in <a data-link-type="biblio" href="#biblio-encoding" title="Encoding Standard">[ENCODING]</a>. In addition, the bitwise NOT is
  represented by ~. </p>
   <h2 class="heading settled" data-level="4" id="understanding-mime-types"><span class="secno">4. </span><span class="content">MIME types</span><a class="self-link" href="#understanding-mime-types"></a></h2>
   <h3 class="heading settled" data-level="4.1" id="mime-type-representation"><span class="secno">4.1. </span><span class="content">MIME type representation</span><a class="self-link" href="#mime-type-representation"></a></h3>
   <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-export data-lt="MIME type|MIME type record" id="mime-type">MIME type</dfn> represents an <i>internet media type</i> as defined by <cite>Multipurpose Internet Mail Extensions (MIME) Part Two: Media Types</cite>. It can also be
referred to as a <a data-link-type="dfn" href="#mime-type" id="ref-for-mime-type">MIME type record</a>. <a data-link-type="biblio" href="#biblio-mimetype" title="Multipurpose Internet Mail Extensions (MIME) Part Two: Media Types">[MIMETYPE]</a> </p>
   <p class="note" role="note">Standards are encouraged to consistently use the term <a data-link-type="dfn" href="#mime-type" id="ref-for-mime-type①">MIME type</a> to avoid
confusion with the use of <i>media type</i> as described in <cite>Media Queries</cite>. <a data-link-type="biblio" href="#biblio-mediaqueries" title="Media Queries Level 4">[MEDIAQUERIES]</a> </p>
   <p>A <a data-link-type="dfn" href="#mime-type" id="ref-for-mime-type②">MIME type</a>’s <dfn class="dfn-paneled" data-dfn-for="MIME type" data-dfn-type="dfn" data-export id="type">type</dfn> is a non-empty <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ascii-string" id="ref-for-ascii-string">ASCII string</a>. </p>
   <p>A <a data-link-type="dfn" href="#mime-type" id="ref-for-mime-type③">MIME type</a>’s <dfn class="dfn-paneled" data-dfn-for="MIME type" data-dfn-type="dfn" data-export id="subtype">subtype</dfn> is a non-empty <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ascii-string" id="ref-for-ascii-string①">ASCII string</a>. </p>
   <p>A <a data-link-type="dfn" href="#mime-type" id="ref-for-mime-type④">MIME type</a>’s <dfn class="dfn-paneled" data-dfn-for="MIME type" data-dfn-type="dfn" data-export id="parameters">parameters</dfn> is an <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map" id="ref-for-ordered-map">ordered map</a> whose <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-getting-the-keys" id="ref-for-map-getting-the-keys">keys</a> and <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-getting-the-values" id="ref-for-map-getting-the-values">values</a> are <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ascii-string" id="ref-for-ascii-string②">ASCII strings</a>. It
is initially empty. </p>
   <h3 class="heading settled" data-level="4.2" id="mime-type-miscellaneous"><span class="secno">4.2. </span><span class="content">MIME type miscellaneous</span><a class="self-link" href="#mime-type-miscellaneous"></a></h3>
   <p>The <dfn class="dfn-paneled" data-dfn-for="MIME type" data-dfn-type="dfn" data-export id="mime-type-essence">essence</dfn> of a <a data-link-type="dfn" href="#mime-type" id="ref-for-mime-type⑤">MIME type</a> <var>mimeType</var> is <var>mimeType</var>’s <a data-link-type="dfn" href="#type" id="ref-for-type">type</a>, followed by U+002F (/), followed by <var>mimeType</var>’s <a data-link-type="dfn" href="#subtype" id="ref-for-subtype">subtype</a>. </p>
   <p>A <a data-link-type="dfn" href="#mime-type" id="ref-for-mime-type⑥">MIME type</a> is <dfn class="dfn-paneled" data-dfn-type="dfn" data-export id="supported-by-the-user-agent">supported by the user agent</dfn> if the user agent has the
capability to interpret a <a data-link-type="dfn" href="#resource" id="ref-for-resource">resource</a> of that <a data-link-type="dfn" href="#mime-type" id="ref-for-mime-type⑦">MIME type</a> and present it to the user. </p>
   <p class="XXX">This needs more work. See <a href="https://github.com/w3c/preload/issues/113">w3c/preload #113</a>. </p>
   <h3 class="heading settled" data-level="4.3" id="mime-type-writing"><span class="secno">4.3. </span><span class="content">MIME type writing</span><a class="self-link" href="#mime-type-writing"></a></h3>
   <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-export id="valid-mime-type">valid MIME type string</dfn> is a string that matches the <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc7231#section-3.1.1.1" id="ref-for-section-3.1.1.1">media-type</a> token production. In particular, a <a data-link-type="dfn" href="#valid-mime-type" id="ref-for-valid-mime-type">valid MIME type string</a> may
include <a data-link-type="dfn" href="#parameters" id="ref-for-parameters">parameters</a>. <a data-link-type="biblio" href="#biblio-rfc7231" title="HTTP Semantics">[RFC7231]</a> </p>
   <p class="note" role="note">A <a data-link-type="dfn" href="#valid-mime-type" id="ref-for-valid-mime-type①">valid MIME type string</a> is supposed to be used for conformance checkers only. </p>
   <div class="example" id="example-valid-mime-type-string">
    <a class="self-link" href="#example-valid-mime-type-string"></a> 
    <p>"<code>text/html</code>" is a <a data-link-type="dfn" href="#valid-mime-type" id="ref-for-valid-mime-type②">valid MIME type string</a>. </p>
    <p>"<code>text/html;</code>" is not a <a data-link-type="dfn" href="#valid-mime-type" id="ref-for-valid-mime-type③">valid MIME type string</a>, though <a data-link-type="dfn" href="#parse-a-mime-type" id="ref-for-parse-a-mime-type">parse a MIME type</a> returns a <a data-link-type="dfn" href="#mime-type" id="ref-for-mime-type⑧">MIME type record</a> for it identical to if the input had
 been "<code>text/html</code>". </p>
   </div>
   <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-export id="valid-mime-type-with-no-parameters">valid MIME type string with no parameters</dfn> is
a <a data-link-type="dfn" href="#valid-mime-type" id="ref-for-valid-mime-type④">valid MIME type string</a> that does not contain U+003B (;). </p>
   <h3 class="heading settled" data-level="4.4" id="parsing-a-mime-type"><span class="secno">4.4. </span><span class="content">Parsing a MIME type</span><a class="self-link" href="#parsing-a-mime-type"></a></h3>
   <p>To <dfn class="dfn-paneled" data-dfn-type="dfn" data-export id="parse-a-mime-type">parse a MIME type</dfn>, given a string <var>input</var>, run these steps: </p>
   <ol>
    <li>
     <p>Remove any leading and trailing <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#http-whitespace" id="ref-for-http-whitespace">HTTP whitespace</a> from <var>input</var>. </p>
    <li>
     <p>Let <var>position</var> be a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#string-position-variable" id="ref-for-string-position-variable">position variable</a> for <var>input</var>,
 initially pointing at the start of <var>input</var>. </p>
    <li>
     <p>Let <var>type</var> be the result of <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#collect-a-sequence-of-code-points" id="ref-for-collect-a-sequence-of-code-points">collecting a sequence of code points</a> that are
 not U+002F (/) from <var>input</var>, given <var>position</var>. </p>
    <li>
     <p>If <var>type</var> is the empty string or does not solely contain <a data-link-type="dfn" href="#http-token-code-point" id="ref-for-http-token-code-point①">HTTP token code points</a>, then return failure. </p>
    <li>
     <p>If <var>position</var> is past the end of <var>input</var>, then return failure. </p>
    <li>
     <p>Advance <var>position</var> by 1. (This skips past U+002F (/).) </p>
    <li>
     <p>Let <var>subtype</var> be the result of <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#collect-a-sequence-of-code-points" id="ref-for-collect-a-sequence-of-code-points①">collecting a sequence of code points</a> that are
 not U+003B (;) from <var>input</var>, given <var>position</var>. </p>
    <li>
     <p>Remove any trailing <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#http-whitespace" id="ref-for-http-whitespace①">HTTP whitespace</a> from <var>subtype</var>. </p>
    <li>
     <p>If <var>subtype</var> is the empty string or does not solely contain <a data-link-type="dfn" href="#http-token-code-point" id="ref-for-http-token-code-point②">HTTP token code points</a>, then return failure. </p>
    <li>
     <p>Let <var>mimeType</var> be a new <a data-link-type="dfn" href="#mime-type" id="ref-for-mime-type⑨">MIME type record</a> whose <a data-link-type="dfn" href="#type" id="ref-for-type①">type</a> is <var>type</var>, in <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ascii-lowercase" id="ref-for-ascii-lowercase">ASCII lowercase</a>, and <a data-link-type="dfn" href="#subtype" id="ref-for-subtype①">subtype</a> is <var>subtype</var>, in <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ascii-lowercase" id="ref-for-ascii-lowercase①">ASCII lowercase</a>. </p>
    <li>
     <p>While <var>position</var> is not past the end of <var>input</var>: </p>
     <ol>
      <li>
       <p>Advance <var>position</var> by 1. (This skips past U+003B (;).) </p>
      <li>
       <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#collect-a-sequence-of-code-points" id="ref-for-collect-a-sequence-of-code-points②">Collect a sequence of code points</a> that are <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#http-whitespace" id="ref-for-http-whitespace②">HTTP whitespace</a> from <var>input</var> given <var>position</var>. </p>
       <p class="note" role="note">This is roughly equivalent to <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#skip-ascii-whitespace" id="ref-for-skip-ascii-whitespace">skip ASCII whitespace</a>, except that <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#http-whitespace" id="ref-for-http-whitespace③">HTTP whitespace</a> is used rather than <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ascii-whitespace" id="ref-for-ascii-whitespace">ASCII whitespace</a>. </p>
      <li>
       <p>Let <var>parameterName</var> be the result of <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#collect-a-sequence-of-code-points" id="ref-for-collect-a-sequence-of-code-points③">collecting a sequence of code points</a> that are not U+003B (;) or U+003D (=) from <var>input</var>, given <var>position</var>. </p>
      <li>
       <p>Set <var>parameterName</var> to <var>parameterName</var>, in <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ascii-lowercase" id="ref-for-ascii-lowercase②">ASCII lowercase</a>. </p>
      <li>
       <p>If <var>position</var> is not past the end of <var>input</var>, then: </p>
       <ol>
        <li>
         <p>If the <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#code-point" id="ref-for-code-point②">code point</a> at <var>position</var> within <var>input</var> is U+003B (;),
     then <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue" id="ref-for-iteration-continue">continue</a>. </p>
        <li>
         <p>Advance <var>position</var> by 1. (This skips past U+003D (=).) </p>
       </ol>
      <li>
       <p>If <var>position</var> is past the end of <var>input</var>, then <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-break" id="ref-for-iteration-break">break</a>. </p>
      <li>
       <p>Let <var>parameterValue</var> be null. </p>
      <li>
       <p>If the <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#code-point" id="ref-for-code-point③">code point</a> at <var>position</var> within <var>input</var> is U+0022 ("),
    then: </p>
       <ol>
        <li>
         <p>Set <var>parameterValue</var> to the result of <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#collect-an-http-quoted-string" id="ref-for-collect-an-http-quoted-string">collecting an HTTP quoted string</a> from <var>input</var>, given <var>position</var> and the <var>extract-value flag</var>. </p>
        <li>
         <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#collect-a-sequence-of-code-points" id="ref-for-collect-a-sequence-of-code-points④">Collect a sequence of code points</a> that are not U+003B (;) from <var>input</var>,
      given <var>position</var>. </p>
         <p class="example" id="example-mime-type-parser-trailing-garbage"><a class="self-link" href="#example-mime-type-parser-trailing-garbage"></a>Given <code>text/html;charset="shift_jis"iso-2022-jp</code> you end up with <code>text/html;charset=shift_jis</code>. </p>
       </ol>
      <li>
       <p>Otherwise: </p>
       <ol>
        <li>
         <p>Set <var>parameterValue</var> to the result of <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#collect-a-sequence-of-code-points" id="ref-for-collect-a-sequence-of-code-points⑤">collecting a sequence of code points</a> that are not U+003B (;) from <var>input</var>,
     given <var>position</var>. </p>
        <li>
         <p>Remove any trailing <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#http-whitespace" id="ref-for-http-whitespace④">HTTP whitespace</a> from <var>parameterValue</var>. </p>
        <li>
         <p>If <var>parameterValue</var> is the empty string, then <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue" id="ref-for-iteration-continue①">continue</a>. </p>
       </ol>
      <li>
       <p>If all of the following are true </p>
       <ul class="brief">
        <li><var>parameterName</var> is not the empty string 
        <li><var>parameterName</var> solely contains <a data-link-type="dfn" href="#http-token-code-point" id="ref-for-http-token-code-point③">HTTP token code points</a> 
        <li><var>parameterValue</var> solely contains <a data-link-type="dfn" href="#http-quoted-string-token-code-point" id="ref-for-http-quoted-string-token-code-point">HTTP quoted-string token code points</a> 
        <li><var>mimeType</var>’s <a data-link-type="dfn" href="#parameters" id="ref-for-parameters①">parameters</a>[<var>parameterName</var>] <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-exists" id="ref-for-map-exists">does not exist</a> 
       </ul>
       <p>then <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-set" id="ref-for-map-set">set</a> <var>mimeType</var>’s <a data-link-type="dfn" href="#parameters" id="ref-for-parameters②">parameters</a>[<var>parameterName</var>] to <var>parameterValue</var>. </p>
     </ol>
    <li>
     <p>Return <var>mimeType</var>. </p>
   </ol>
   <hr>
   <p>To <dfn class="dfn-paneled" data-dfn-type="dfn" data-export id="parse-a-mime-type-from-bytes">parse a MIME type from bytes</dfn>, given a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte-sequence" id="ref-for-byte-sequence">byte sequence</a> <var>input</var>,
run these steps: </p>
   <ol>
    <li>
     <p>Let <var>string</var> be <var>input</var>, <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#isomorphic-decode" id="ref-for-isomorphic-decode">isomorphic decoded</a>. </p>
    <li>
     <p>Return the result of <a data-link-type="dfn" href="#parse-a-mime-type" id="ref-for-parse-a-mime-type①">parse a MIME type</a> with <var>string</var>. </p>
   </ol>
   <h3 class="heading settled" data-level="4.5" id="serializing-a-mime-type"><span class="secno">4.5. </span><span class="content">Serializing a MIME type</span><a class="self-link" href="#serializing-a-mime-type"></a></h3>
   <p>To <dfn class="dfn-paneled" data-dfn-type="dfn" data-export id="serialize-a-mime-type">serialize a MIME type</dfn>, given a <a data-link-type="dfn" href="#mime-type" id="ref-for-mime-type①⓪">MIME type</a> <var>mimeType</var>, run
these steps: </p>
   <ol>
    <li>
     <p>Let <var>serialization</var> be the concatenation of <var>mimeType</var>’s <a data-link-type="dfn" href="#type" id="ref-for-type②">type</a>, U+002F (/), and <var>mimeType</var>’s <a data-link-type="dfn" href="#subtype" id="ref-for-subtype②">subtype</a>. </p>
    <li>
     <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-iterate" id="ref-for-map-iterate">For each</a> <var>name</var> → <var>value</var> of <var>mimeType</var>’s <a data-link-type="dfn" href="#parameters" id="ref-for-parameters③">parameters</a>: </p>
     <ol>
      <li>
       <p>Append U+003B (;) to <var>serialization</var>. </p>
      <li>
       <p>Append <var>name</var> to <var>serialization</var>. </p>
      <li>
       <p>Append U+003D (=) to <var>serialization</var>. </p>
      <li>
       <p>If <var>value</var> does not solely contain <a data-link-type="dfn" href="#http-token-code-point" id="ref-for-http-token-code-point④">HTTP token code points</a> or <var>value</var> is the empty string, then: </p>
       <ol>
        <li>
         <p>Precede each occurence of U+0022 (") or U+005C (\) in <var>value</var> with U+005C (\). </p>
        <li>
         <p>Prepend U+0022 (") to <var>value</var>. </p>
        <li>
         <p>Append U+0022 (") to <var>value</var>. </p>
       </ol>
      <li>
       <p>Append <var>value</var> to <var>serialization</var>. </p>
     </ol>
    <li>
     <p>Return <var>serialization</var>. </p>
   </ol>
   <hr>
   <p>To <dfn class="dfn-paneled" data-dfn-type="dfn" data-export id="serialize-a-mime-type-to-bytes">serialize a MIME type to bytes</dfn>, given a <a data-link-type="dfn" href="#mime-type" id="ref-for-mime-type①①">MIME type</a> <var>mimeType</var>, run these steps: </p>
   <ol>
    <li>
     <p>Let <var>stringSerialization</var> be the result of <a data-link-type="dfn" href="#serialize-a-mime-type" id="ref-for-serialize-a-mime-type">serialize a MIME type</a> with <var>mimeType</var>. </p>
    <li>
     <p>Return <var>stringSerialization</var>, <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#isomorphic-encode" id="ref-for-isomorphic-encode">isomorphic encoded</a>. </p>
   </ol>
   <h3 class="heading settled" data-level="4.6" id="mime-type-groups"><span class="secno">4.6. </span><span class="content">MIME type groups</span><a class="self-link" href="#mime-type-groups"></a></h3>
   <p>An <dfn class="dfn-paneled" data-dfn-type="dfn" data-export id="image-mime-type">image MIME type</dfn> is a <a data-link-type="dfn" href="#mime-type" id="ref-for-mime-type①②">MIME type</a> whose <a data-link-type="dfn" href="#type" id="ref-for-type③">type</a> is
"<code>image</code>". </p>
   <p>An <dfn class="dfn-paneled" data-dfn-type="dfn" data-export id="audio-or-video-mime-type">audio or video MIME type</dfn> is any <a data-link-type="dfn" href="#mime-type" id="ref-for-mime-type①③">MIME type</a> whose <a data-link-type="dfn" href="#type" id="ref-for-type④">type</a> is "<code>audio</code>" or "<code>video</code>", or whose <a data-link-type="dfn" href="#mime-type-essence" id="ref-for-mime-type-essence">essence</a> is "<code>application/ogg</code>". </p>
   <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-export id="font-mime-type">font MIME type</dfn> is any <a data-link-type="dfn" href="#mime-type" id="ref-for-mime-type①④">MIME type</a> whose <a data-link-type="dfn" href="#type" id="ref-for-type⑤">type</a> is
"<code>font</code>", or whose <a data-link-type="dfn" href="#mime-type-essence" id="ref-for-mime-type-essence①">essence</a> is one of the following: <a data-link-type="biblio" href="#biblio-rfc8081" title="The &quot;font&quot; Top-Level Media Type">[RFC8081]</a> </p>
   <ul class="brief">
    <li><code>application/font-cff</code> 
    <li><code>application/font-off</code> 
    <li><code>application/font-sfnt</code> 
    <li><code>application/font-ttf</code> 
    <li><code>application/font-woff</code> 
    <li><code>application/vnd.ms-fontobject</code> 
    <li><code>application/vnd.ms-opentype</code> 
   </ul>
   <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-export id="zip-based-mime-type">ZIP-based MIME type</dfn> is any <a data-link-type="dfn" href="#mime-type" id="ref-for-mime-type①⑤">MIME type</a> whose <a data-link-type="dfn" href="#subtype" id="ref-for-subtype③">subtype</a> ends in "<code>+zip</code>" or whose <a data-link-type="dfn" href="#mime-type-essence" id="ref-for-mime-type-essence②">essence</a> is one of the following: </p>
   <ul class="XXX brief">
    <li><code>application/zip</code> 
   </ul>
   <p>An <dfn class="dfn-paneled" data-dfn-type="dfn" data-export id="archive-mime-type">archive MIME type</dfn> is any <a data-link-type="dfn" href="#mime-type" id="ref-for-mime-type①⑥">MIME type</a> whose <a data-link-type="dfn" href="#mime-type-essence" id="ref-for-mime-type-essence③">essence</a> is one of the following: </p>
   <ul class="brief">
    <li><code>application/x-rar-compressed</code> 
    <li><code>application/zip</code> 
    <li><code>application/x-gzip</code> 
   </ul>
   <p>An <dfn class="dfn-paneled" data-dfn-type="dfn" data-export id="xml-mime-type">XML MIME type</dfn> is any <a data-link-type="dfn" href="#mime-type" id="ref-for-mime-type①⑦">MIME type</a> whose <a data-link-type="dfn" href="#subtype" id="ref-for-subtype④">subtype</a> ends in "<code>+xml</code>" or whose <a data-link-type="dfn" href="#mime-type-essence" id="ref-for-mime-type-essence④">essence</a> is "<code>text/xml</code>" or
"<code>application/xml</code>". <a data-link-type="biblio" href="#biblio-rfc7303" title="XML Media Types">[RFC7303]</a> </p>
   <p>An <dfn class="dfn-paneled" data-dfn-type="dfn" data-export id="html-mime-type">HTML MIME type</dfn> is any <a data-link-type="dfn" href="#mime-type" id="ref-for-mime-type①⑧">MIME type</a> whose <a data-link-type="dfn" href="#mime-type-essence" id="ref-for-mime-type-essence⑤">essence</a> is "<code>text/html</code>". </p>
   <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-export id="scriptable-mime-type">scriptable MIME type</dfn> is an <a data-link-type="dfn" href="#xml-mime-type" id="ref-for-xml-mime-type">XML MIME type</a>, <a data-link-type="dfn" href="#html-mime-type" id="ref-for-html-mime-type">HTML MIME type</a>, or
any <a data-link-type="dfn" href="#mime-type" id="ref-for-mime-type①⑨">MIME type</a> whose <a data-link-type="dfn" href="#mime-type-essence" id="ref-for-mime-type-essence⑥">essence</a> is "<code>application/pdf</code>". </p>
   <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-export id="javascript-mime-type">JavaScript MIME type</dfn> is any <a data-link-type="dfn" href="#mime-type" id="ref-for-mime-type②⓪">MIME type</a> whose <a data-link-type="dfn" href="#mime-type-essence" id="ref-for-mime-type-essence⑦">essence</a> is one of the following: </p>
   <ul class="brief">
    <li><code>application/ecmascript</code> 
    <li><code>application/javascript</code> 
    <li><code>application/x-ecmascript</code> 
    <li><code>application/x-javascript</code> 
    <li><code>text/ecmascript</code> 
    <li><code>text/javascript</code> 
    <li><code>text/javascript1.0</code> 
    <li><code>text/javascript1.1</code> 
    <li><code>text/javascript1.2</code> 
    <li><code>text/javascript1.3</code> 
    <li><code>text/javascript1.4</code> 
    <li><code>text/javascript1.5</code> 
    <li><code>text/jscript</code> 
    <li><code>text/livescript</code> 
    <li><code>text/x-ecmascript</code> 
    <li><code>text/x-javascript</code> 
   </ul>
   <p>A <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#string" id="ref-for-string">string</a> is a <dfn class="dfn-paneled" data-dfn-type="dfn" data-export id="javascript-mime-type-essence-match">JavaScript MIME type essence match</dfn> if it is an <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ascii-case-insensitive" id="ref-for-ascii-case-insensitive">ASCII case-insensitive</a> match for one of the <a data-link-type="dfn" href="#javascript-mime-type" id="ref-for-javascript-mime-type">JavaScript MIME type</a> essence strings. </p>
   <p class="note" role="note">This hook is used by the <code><a data-link-type="element-sub" href="https://html.spec.whatwg.org/multipage/scripting.html#attr-script-type" id="ref-for-attr-script-type">type</a></code> attribute of <code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/scripting.html#script" id="ref-for-script">script</a></code> elements. </p>
   <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-export id="json-mime-type">JSON MIME type</dfn> is any <a data-link-type="dfn" href="#mime-type" id="ref-for-mime-type②①">MIME type</a> whose <a data-link-type="dfn" href="#subtype" id="ref-for-subtype⑤">subtype</a> ends in "<code>+json</code>" or whose <a data-link-type="dfn" href="#mime-type-essence" id="ref-for-mime-type-essence⑧">essence</a> is
"<code>application/json</code>" or "<code>text/json</code>". </p>
   <h2 class="heading settled" data-level="5" id="handling-a-resource"><span class="secno">5. </span><span class="content">Handling a resource</span><a class="self-link" href="#handling-a-resource"></a></h2>
   <p class="XXX"> A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="resource">resource</dfn> is …. </p>
   <p> For each <a data-link-type="dfn" href="#resource" id="ref-for-resource①">resource</a> it handles, the user agent must keep track of
 the following associated metadata: </p>
   <ul>
    <li> A <dfn class="dfn-paneled" data-dfn-type="dfn" data-export id="supplied-mime-type">supplied MIME type</dfn>, the <a data-link-type="dfn" href="#mime-type" id="ref-for-mime-type②②">MIME type</a> determined by
   the <a data-link-type="dfn" href="#supplied-mime-type-detection-algorithm" id="ref-for-supplied-mime-type-detection-algorithm">supplied MIME type detection algorithm</a>. 
    <li> A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="check-for-apache-bug-flag">check-for-apache-bug flag</dfn>, which defaults to unset. 
    <li>
      A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="no-sniff-flag">no-sniff flag</dfn>, which defaults to set if the user agent does
   not wish to perform sniffing on the <a data-link-type="dfn" href="#resource" id="ref-for-resource②">resource</a> and unset
   otherwise. 
     <p class="note" role="note"> The user agent can choose to use outside information, such as previous
    experience with a site, to determine whether to opt out of sniffing for a
    particular <a data-link-type="dfn" href="#resource" id="ref-for-resource③">resource</a>. The user agent can also choose to opt
    out of sniffing for all <a data-link-type="dfn" href="#resource" id="ref-for-resource④">resources</a>. However,
    opting out of sniffing does not exempt the user agent from using the <a data-link-type="dfn" href="#mime-type-sniffing-algorithm" id="ref-for-mime-type-sniffing-algorithm">MIME type sniffing algorithm</a>. </p>
    <li> A <dfn class="dfn-paneled" data-dfn-type="dfn" data-export id="computed-mime-type">computed MIME type</dfn>, the <a data-link-type="dfn" href="#mime-type" id="ref-for-mime-type②③">MIME type</a> determined by the <a data-link-type="dfn" href="#mime-type-sniffing-algorithm" id="ref-for-mime-type-sniffing-algorithm①">MIME type sniffing algorithm</a>. 
   </ul>
   <h3 class="heading settled" data-level="5.1" id="interpreting-the-resource-metadata"><span class="secno">5.1. </span><span class="content">Interpreting the resource metadata</span><a class="self-link" href="#interpreting-the-resource-metadata"></a></h3>
   <p> The <a data-link-type="dfn" href="#supplied-mime-type" id="ref-for-supplied-mime-type">supplied MIME type</a> of a <a data-link-type="dfn" href="#resource" id="ref-for-resource⑤">resource</a> is provided
 to the user agent by an external source associated with that <a data-link-type="dfn" href="#resource" id="ref-for-resource⑥">resource</a>.
 The method of obtaining this information varies depending upon how the <a data-link-type="dfn" href="#resource" id="ref-for-resource⑦">resource</a> is retrieved. </p>
   <p> To determine the <a data-link-type="dfn" href="#supplied-mime-type" id="ref-for-supplied-mime-type①">supplied MIME type</a> of a <a data-link-type="dfn" href="#resource" id="ref-for-resource⑧">resource</a>,
 user agents must use the following <dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="supplied MIME type detection algorithm" data-noexport id="supplied-mime-type-detection-algorithm">supplied MIME type detection
 algorithm</dfn>: </p>
   <ol>
    <li> Let <var>supplied-type</var> be null. 
    <li>
      If the <a data-link-type="dfn" href="#resource" id="ref-for-resource⑨">resource</a> is retrieved via HTTP, execute the following
   steps: 
     <ol>
      <li>
        If one or more <code>Content-Type</code> headers are associated with the <a data-link-type="dfn" href="#resource" id="ref-for-resource①⓪">resource</a>, execute the following steps: 
       <ol>
        <li>
          Set <var>supplied-type</var> to the value of the last <code>Content-Type</code> header associated with the <a data-link-type="dfn" href="#resource" id="ref-for-resource①①">resource</a>. 
         <p class="note" role="note"> File extensions are not used to determine the <a data-link-type="dfn" href="#supplied-mime-type" id="ref-for-supplied-mime-type②">supplied MIME
        type</a> of a <a data-link-type="dfn" href="#resource" id="ref-for-resource①②">resource</a> retrieved via HTTP because they are
        unreliable and easily spoofed. </p>
        <li>
          Set the <a data-link-type="dfn" href="#check-for-apache-bug-flag" id="ref-for-check-for-apache-bug-flag">check-for-apache-bug flag</a> if <var>supplied-type</var> is <strong>exactly</strong> equal to one of
       the values in the following table: 
         <table>
          <thead>
           <tr>
            <th>Bytes in Hexadecimal 
            <th>Bytes in ASCII 
          <tbody>
           <tr>
            <td> 74 65 78 74 2F 70 6C 61 69 6E 
            <td> <code>text/plain</code> 
           <tr>
            <td> 74 65 78 74 2F 70 6C 61 69 6E<br> 3B 20 63 68 61 72 73 65 74 3D<br> 49 53 4F 2D 38 38 35 39 2D 31 
            <td> <code>text/plain; charset=ISO-8859-1</code> 
           <tr>
            <td> 74 65 78 74 2F 70 6C 61 69 6E<br> 3B 20 63 68 61 72 73 65 74 3D<br> 69 73 6F 2D 38 38 35 39 2D 31 
            <td> <code>text/plain; charset=iso-8859-1</code> 
           <tr>
            <td> 74 65 78 74 2F 70 6C 61 69 6E<br> 3B 20 63 68 61 72 73 65 74 3D<br> 55 54 46 2D 38 
            <td> <code>text/plain; charset=UTF-8</code> 
         </table>
         <p class="note" role="note"> The <a data-link-type="dfn" href="#supplied-mime-type-detection-algorithm" id="ref-for-supplied-mime-type-detection-algorithm①">supplied MIME type detection algorithm</a> detects these
        exact <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte" id="ref-for-byte⑥">byte</a> sequences because some older installations of
        Apache contain <a href="https://issues.apache.org/bugzilla/show_bug.cgi?id=13986">a
        bug</a> that causes them to supply one of these Content-Type headers
        when serving files with unrecognized <a data-link-type="dfn" href="#mime-type" id="ref-for-mime-type②④">MIME
        types</a>. </p>
       </ol>
     </ol>
     <p><a data-link-type="biblio" href="#biblio-http" title="HTTP/1.1">[HTTP]</a></p>
    <li> If the <a data-link-type="dfn" href="#resource" id="ref-for-resource①③">resource</a> is retrieved directly from the file system,
   set <var>supplied-type</var> to the <a data-link-type="dfn" href="#mime-type" id="ref-for-mime-type②⑤">MIME type</a> provided by the
   file system. 
    <li>
      If the <a data-link-type="dfn" href="#resource" id="ref-for-resource①④">resource</a> is retrieved via another protocol (such as
   FTP), set <var>supplied-type</var> to the <a data-link-type="dfn" href="#mime-type" id="ref-for-mime-type②⑥">MIME type</a> as
   determined by that protocol, if any. 
     <p><a data-link-type="biblio" href="#biblio-ftp" title="File Transfer Protocol">[FTP]</a></p>
    <li>
      If <var>supplied-type</var> is not a <a data-link-type="dfn" href="#mime-type" id="ref-for-mime-type②⑦">MIME type</a>, the <a data-link-type="dfn" href="#supplied-mime-type" id="ref-for-supplied-mime-type③">supplied MIME type</a> is undefined. 
     <p>Abort these steps.</p>
    <li> The <a data-link-type="dfn" href="#supplied-mime-type" id="ref-for-supplied-mime-type④">supplied MIME type</a> is <var>supplied-type</var>. 
   </ol>
   <h3 class="heading settled" data-level="5.2" id="reading-the-resource-header"><span class="secno">5.2. </span><span class="content">Reading the resource header</span><a class="self-link" href="#reading-the-resource-header"></a></h3>
   <p> A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="resource-header">resource header</dfn> is the <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte-sequence" id="ref-for-byte-sequence①">byte sequence</a> at the
 beginning of a <a data-link-type="dfn" href="#resource" id="ref-for-resource①⑤">resource</a>, as determined by <a data-link-type="dfn" href="#read-the-resource-header" id="ref-for-read-the-resource-header">reading the resource header</a>. </p>
   <p> To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="read-the-resource-header">read the resource header</dfn>, perform the following steps: </p>
   <ol>
    <li> Let <var>buffer</var> be a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte-sequence" id="ref-for-byte-sequence②">byte sequence</a>. 
    <li>
      Read <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte" id="ref-for-byte⑦">bytes</a> of the <a data-link-type="dfn" href="#resource" id="ref-for-resource①⑥">resource</a> into <var>buffer</var> until one of the following conditions is met: 
     <ul>
      <li> the end of the <a data-link-type="dfn" href="#resource" id="ref-for-resource①⑦">resource</a> is reached. 
      <li> the number of <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte" id="ref-for-byte⑧">bytes</a> in <var>buffer</var> is
     greater than or equal to 1445. 
      <li> a reasonable amount of time has elapsed, as determined by the user
     agent. 
     </ul>
     <p class="note" role="note"> If the number of <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte" id="ref-for-byte⑨">bytes</a> in <var>buffer</var> is
    greater than or equal to 1445, the <a data-link-type="dfn" href="#mime-type-sniffing-algorithm" id="ref-for-mime-type-sniffing-algorithm②">MIME type sniffing
    algorithm</a> will be deterministic for the majority of cases. </p>
     <p>However, certain factors (such as a slow connection) may prevent the
    user agent from reading 1445 <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte" id="ref-for-byte①⓪">bytes</a> in a
    reasonable amount of time.</p>
    <li> The <a data-link-type="dfn" href="#resource-header" id="ref-for-resource-header">resource header</a> is <var>buffer</var>. 
   </ol>
   <p class="note" role="note"> The <a data-link-type="dfn" href="#resource-header" id="ref-for-resource-header①">resource header</a> need only be determined once per <a data-link-type="dfn" href="#resource" id="ref-for-resource①⑧">resource</a>. </p>
   <h2 class="heading settled" data-level="6" id="matching-a-mime-type-pattern"><span class="secno">6. </span><span class="content">Matching a MIME type pattern</span><a class="self-link" href="#matching-a-mime-type-pattern"></a></h2>
   <p> A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="byte-pattern">byte pattern</dfn> is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte-sequence" id="ref-for-byte-sequence③">byte sequence</a> used as a template
 to be matched against in the <a data-link-type="dfn" href="#pattern-matching-algorithm" id="ref-for-pattern-matching-algorithm">pattern matching algorithm</a>. </p>
   <p> A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="pattern-mask">pattern mask</dfn> is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte-sequence" id="ref-for-byte-sequence④">byte sequence</a> used to determine
 the significance of <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte" id="ref-for-byte①①">bytes</a> being compared against a <a data-link-type="dfn" href="#byte-pattern" id="ref-for-byte-pattern">byte pattern</a> in the <a data-link-type="dfn" href="#pattern-matching-algorithm" id="ref-for-pattern-matching-algorithm①">pattern matching algorithm</a>. </p>
   <p class="note" role="note"> In a <a data-link-type="dfn" href="#pattern-mask" id="ref-for-pattern-mask">pattern mask</a>, 0xFF indicates the <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte" id="ref-for-byte①②">byte</a> is
 strictly significant, 0xDF indicates that the <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte" id="ref-for-byte①③">byte</a> is
 significant in an ASCII case-insensitive way, and 0x00 indicates that the <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte" id="ref-for-byte①④">byte</a> is not significant. </p>
   <p>To determine whether a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte-sequence" id="ref-for-byte-sequence⑤">byte sequence</a> matches a particular <a data-link-type="dfn" href="#byte-pattern" id="ref-for-byte-pattern①">byte pattern</a>, use the
following <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="pattern-matching-algorithm">pattern matching algorithm</dfn>. It is given a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte-sequence" id="ref-for-byte-sequence⑥">byte sequence</a> <var>input</var>, a <a data-link-type="dfn" href="#byte-pattern" id="ref-for-byte-pattern②">byte pattern</a> <var>pattern</var>, a <a data-link-type="dfn" href="#pattern-mask" id="ref-for-pattern-mask①">pattern mask</a> <var>mask</var>,
and a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-set" id="ref-for-ordered-set">set</a> of <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte" id="ref-for-byte①⑤">bytes</a> to be ignored <var>ignored</var>, and returns true or false. </p>
   <ol>
    <li>
     <p>Assert: <var>pattern</var>’s <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte-sequence-length" id="ref-for-byte-sequence-length">length</a> is equal to <var>mask</var>’s <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte-sequence-length" id="ref-for-byte-sequence-length①">length</a>. </p>
    <li>
     <p>If <var>input</var>’s <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte-sequence-length" id="ref-for-byte-sequence-length②">length</a> is less than <var>pattern</var>’s <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte-sequence-length" id="ref-for-byte-sequence-length③">length</a>, return false. </p>
    <li>
     <p>Let <var>s</var> be 0. </p>
    <li>
     <p>While <var>s</var> &lt; <var>input</var>’s <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte-sequence-length" id="ref-for-byte-sequence-length④">length</a>: </p>
     <ol>
      <li>
       <p>If <var>ignored</var> does not <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-contain" id="ref-for-list-contain">contain</a> <var>input</var>[<var>s</var>], <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-break" id="ref-for-iteration-break①">break</a>. </p>
      <li>
       <p>Set <var>s</var> to <var>s</var> + 1. </p>
     </ol>
    <li>
     <p>Let <var>p</var> be 0. </p>
    <li>
     <p>While <var>p</var> &lt; <var>pattern</var>’s <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte-sequence-length" id="ref-for-byte-sequence-length⑤">length</a>: </p>
     <ol>
      <li>
       <p>Let <var>maskedData</var> be the result of applying the bitwise AND operator to <var>input</var>[<var>s</var>] and <var>mask</var>[<var>p</var>]. </p>
      <li>
       <p>If <var>maskedData</var> is not equal to <var>pattern</var>[<var>p</var>], return false. </p>
      <li>
       <p>Set <var>s</var> to <var>s</var> + 1. </p>
      <li>
       <p>Set <var>p</var> to <var>p</var> + 1. </p>
     </ol>
    <li>
     <p>Return true. </p>
   </ol>
   <h3 class="heading settled" data-level="6.1" id="matching-an-image-type-pattern"><span class="secno">6.1. </span><span class="content">Matching an image type pattern</span><a class="self-link" href="#matching-an-image-type-pattern"></a></h3>
   <p>To determine which <a data-link-type="dfn" href="#image-mime-type" id="ref-for-image-mime-type">image MIME type</a> <a data-link-type="dfn" href="#byte-pattern" id="ref-for-byte-pattern③">byte pattern</a> a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte-sequence" id="ref-for-byte-sequence⑦">byte sequence</a> <var>input</var> matches, if any, use the following <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="image-type-pattern-matching-algorithm">image type pattern matching algorithm</dfn>: </p>
   <ol>
    <li>
     <p>Execute the following steps for each row <var>row</var> in the following table: </p>
     <ol>
      <li>
       <p>Let <var>patternMatched</var> be the result of the <a data-link-type="dfn" href="#pattern-matching-algorithm" id="ref-for-pattern-matching-algorithm②">pattern matching algorithm</a> given <var>input</var>, the value in the first column of <var>row</var>, the value in the second
    column of <var>row</var>, and the value in the third column of <var>row</var>. </p>
      <li>
       <p>If <var>patternMatched</var> is true, return the value in the fourth column of <var>row</var>. </p>
     </ol>
     <table>
      <thead>
       <tr>
        <th> <a data-link-type="dfn" href="#byte-pattern" id="ref-for-byte-pattern④">Byte Pattern</a> 
        <th> <a data-link-type="dfn" href="#pattern-mask" id="ref-for-pattern-mask②">Pattern Mask</a> 
        <th> Leading <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte" id="ref-for-byte①⑥">Bytes</a> to Be Ignored 
        <th> <a data-link-type="dfn" href="#image-mime-type" id="ref-for-image-mime-type①">Image MIME Type</a> 
        <th> Note 
      <tbody>
       <tr>
        <td> 00 00 01 00 
        <td> FF FF FF FF 
        <td> None. 
        <td> <code>image/x-icon</code> 
        <td> A Windows Icon signature. 
       <tr>
        <td> 00 00 02 00 
        <td> FF FF FF FF 
        <td> None. 
        <td> <code>image/x-icon</code> 
        <td> A Windows Cursor signature. 
       <tr>
        <td> 42 4D 
        <td> FF FF 
        <td> None. 
        <td> <code>image/bmp</code> 
        <td> The string "<code>BM</code>", a BMP signature. 
       <tr>
        <td> 47 49 46 38 37 61 
        <td> FF FF FF FF FF FF 
        <td> None. 
        <td> <code>image/gif</code> 
        <td> The string "<code>GIF87a</code>", a GIF signature. 
       <tr>
        <td> 47 49 46 38 39 61 
        <td> FF FF FF FF FF FF 
        <td> None. 
        <td> <code>image/gif</code> 
        <td> The string "<code>GIF89a</code>", a GIF signature. 
       <tr>
        <td> 52 49 46 46 00 00 00 00 57 45 42 50 56 50 
        <td> FF FF FF FF 00 00 00 00 FF FF FF FF FF FF 
        <td> None. 
        <td> <code>image/webp</code> 
        <td> The string "<code>RIFF</code>" followed by four <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte" id="ref-for-byte①⑦">bytes</a> followed by the string
       "<code>WEBPVP</code>". 
       <tr>
        <td> 89 50 4E 47 0D 0A 1A 0A 
        <td> FF FF FF FF FF FF FF FF 
        <td> None. 
        <td> <code>image/png</code> 
        <td> An error-checking <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte" id="ref-for-byte①⑧">byte</a> followed by the string
       "<code>PNG</code>" followed by CR LF SUB LF, the PNG signature. 
       <tr>
        <td> FF D8 FF 
        <td> FF FF FF 
        <td> None. 
        <td> <code>image/jpeg</code> 
        <td> The JPEG Start of Image marker followed by the indicator <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte" id="ref-for-byte①⑨">byte</a> of another marker. 
     </table>
    <li>
     <p>Return undefined. </p>
   </ol>
   <h3 class="heading settled" data-level="6.2" id="matching-an-audio-or-video-type-pattern"><span class="secno">6.2. </span><span class="content">Matching an audio or video type pattern</span><a class="self-link" href="#matching-an-audio-or-video-type-pattern"></a></h3>
   <p>To determine which <a data-link-type="dfn" href="#audio-or-video-mime-type" id="ref-for-audio-or-video-mime-type">audio or video MIME type</a> <a data-link-type="dfn" href="#byte-pattern" id="ref-for-byte-pattern⑤">byte pattern</a> a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte-sequence" id="ref-for-byte-sequence⑧">byte sequence</a> <var>input</var> matches, if any, use the following <dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="audio or video type pattern matching algorithm" data-noexport id="audio-or-video-type-pattern-matching-algorithm">audio or video type pattern matching
algorithm</dfn>: </p>
   <ol>
    <li>
     <p>Execute the following steps for each row <var>row</var> in the following table: </p>
     <ol>
      <li>
       <p>Let <var>patternMatched</var> be the result of the <a data-link-type="dfn" href="#pattern-matching-algorithm" id="ref-for-pattern-matching-algorithm③">pattern matching algorithm</a> given <var>input</var>, the value in the first column of <var>row</var>, the value in the second
    column of <var>row</var>, and the value in the third column of <var>row</var>. </p>
      <li>
       <p>If <var>patternMatched</var> is true, return the value in the fourth column of <var>row</var>. </p>
     </ol>
     <table>
      <thead>
       <tr>
        <th> <a data-link-type="dfn" href="#byte-pattern" id="ref-for-byte-pattern⑥">Byte Pattern</a> 
        <th> <a data-link-type="dfn" href="#pattern-mask" id="ref-for-pattern-mask③">Pattern Mask</a> 
        <th> Leading <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte" id="ref-for-byte②⓪">Bytes</a> to Be Ignored 
        <th> <a data-link-type="dfn" href="#audio-or-video-mime-type" id="ref-for-audio-or-video-mime-type①">Audio or Video MIME Type</a> 
        <th> Note 
      <tbody>
       <tr>
        <td> 2E 73 6E 64 
        <td> FF FF FF FF 
        <td> None. 
        <td> <code>audio/basic</code> 
        <td> The string "<code>.snd</code>", the basic audio signature. 
       <tr>
        <td> 46 4F 52 4D 00 00 00 00 41 49 46 46 
        <td> FF FF FF FF 00 00 00 00 FF FF FF FF 
        <td> None. 
        <td> <code>audio/aiff</code> 
        <td> The string "<code>FORM</code>" followed by four <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte" id="ref-for-byte②①">bytes</a> followed by the string
       "<code>AIFF</code>", the AIFF signature. 
       <tr>
        <td> 49 44 33 
        <td> FF FF FF 
        <td> None. 
        <td> <code>audio/mpeg</code> 
        <td> The string "<code>ID3</code>", the ID3v2-tagged MP3 signature. 
       <tr>
        <td> 4F 67 67 53 00 
        <td> FF FF FF FF FF 
        <td> None. 
        <td> <code>application/ogg</code> 
        <td> The string "<code>OggS</code>" followed by NUL, the Ogg container
       signature. 
       <tr>
        <td> 4D 54 68 64 00 00 00 06 
        <td> FF FF FF FF FF FF FF FF 
        <td> None. 
        <td> <code>audio/midi</code> 
        <td> The string "<code>MThd</code>" followed by four <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte" id="ref-for-byte②②">bytes</a> representing the number 6 in 32 bits
       (big-endian), the MIDI signature. 
       <tr>
        <td> 52 49 46 46 00 00 00 00 41 56 49 20 
        <td> FF FF FF FF 00 00 00 00 FF FF FF FF 
        <td> None. 
        <td> <code>video/avi</code> 
        <td> The string "<code>RIFF</code>" followed by four <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte" id="ref-for-byte②③">bytes</a> followed by the string
       "<code>AVI </code>", the AVI signature. 
       <tr>
        <td> 52 49 46 46 00 00 00 00 57 41 56 45 
        <td> FF FF FF FF 00 00 00 00 FF FF FF FF 
        <td> None. 
        <td> <code>audio/wave</code> 
        <td> The string "<code>RIFF</code>" followed by four <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte" id="ref-for-byte②④">bytes</a> followed by the string
       "<code>WAVE</code>", the WAVE signature. 
     </table>
    <li>
     <p>If <var>input</var> <a data-link-type="dfn" href="#matches-the-signature-for-mp4" id="ref-for-matches-the-signature-for-mp4">matches the signature for MP4</a>, return "<code>video/mp4</code>". </p>
    <li>
     <p>If <var>input</var> <a data-link-type="dfn" href="#matches-the-signature-for-webm" id="ref-for-matches-the-signature-for-webm">matches the signature for WebM</a>, return
  "<code>video/webm</code>". </p>
    <li>
     <p>If <var>input</var> <a data-link-type="dfn" href="#matches-the-signature-for-mp3-without-id3" id="ref-for-matches-the-signature-for-mp3-without-id3">matches the signature for MP3 without ID3</a>, return
  "<code>audio/mpeg</code>". </p>
    <li>
     <p>Return undefined. </p>
   </ol>
   <h4 class="heading settled" data-level="6.2.1" id="signature-for-mp4"><span class="secno">6.2.1. </span><span class="content">Signature for MP4</span><a class="self-link" href="#signature-for-mp4"></a></h4>
   <p> To determine whether a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte-sequence" id="ref-for-byte-sequence⑨">byte sequence</a> <dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="matches the signature for MP4" data-noexport id="matches-the-signature-for-mp4">matches the signature
 for MP4</dfn>, use the following steps: </p>
   <ol>
    <li> Let <var>sequence</var> be the <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte-sequence" id="ref-for-byte-sequence①⓪">byte sequence</a> to be matched,
   where <var>sequence</var>[<var>s</var>] is <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte" id="ref-for-byte②⑤">byte</a> <var>s</var> in <var>sequence</var> and <var>sequence</var>[0] is the first <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte" id="ref-for-byte②⑥">byte</a> in <var>sequence</var>. 
    <li> Let <var>length</var> be the number of <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte" id="ref-for-byte②⑦">bytes</a> in <var>sequence</var>. 
    <li> If <var>length</var> is less than 12, return false. 
    <li> Let <var>box-size</var> be the four <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte" id="ref-for-byte②⑧">bytes</a> from <var>sequence</var>[0] to <var>sequence</var>[3], interpreted as a 32-bit
   unsigned big-endian integer. 
    <li> If <var>length</var> is less than <var>box-size</var> or if <var>box-size</var> modulo 4 is not equal to 0, return false. 
    <li> If the four <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte" id="ref-for-byte②⑨">bytes</a> from <var>sequence</var>[4] to <var>sequence</var>[7] are not equal to 0x66 0x74 0x79 0x70
   ("<code>ftyp</code>"), return false. 
    <li> If the three <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte" id="ref-for-byte③⓪">bytes</a> from <var>sequence</var>[8] to <var>sequence</var>[10] are equal to 0x6D 0x70 0x34
   ("<code>mp4</code>"), return true. 
    <li>
      Let <var>bytes-read</var> be 16. 
     <p class="note" role="note"> This ignores the four <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte" id="ref-for-byte③①">bytes</a> that correspond to the
    version number of the "major brand". </p>
    <li>
      While <var>bytes-read</var> is less than <var>box-size</var>, continuously
   loop through these steps: 
     <ol>
      <li> If the three <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte" id="ref-for-byte③②">bytes</a> from <var>sequence</var>[<var>bytes-read</var>] to <var>sequence</var>[<var>bytes-read</var> + 2] are equal to 0x6D 0x70
     0x34 ("<code>mp4</code>"), return true. 
      <li> Increment <var>bytes-read</var> by 4. 
     </ol>
    <li> Return false. 
   </ol>
   <h4 class="heading settled" data-level="6.2.2" id="signature-for-webm"><span class="secno">6.2.2. </span><span class="content">Signature for WebM</span><a class="self-link" href="#signature-for-webm"></a></h4>
   <p> To determine whether a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte-sequence" id="ref-for-byte-sequence①①">byte sequence</a> <dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="matches the signature for WebM" data-noexport id="matches-the-signature-for-webm">matches the signature
 for WebM</dfn>, use the following steps: </p>
   <ol>
    <li> Let <var>sequence</var> be the <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte-sequence" id="ref-for-byte-sequence①②">byte sequence</a> to be matched,
   where <var>sequence</var>[<var>s</var>] is <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte" id="ref-for-byte③③">byte</a> <var>s</var> in <var>sequence</var> and <var>sequence</var>[0] is the first <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte" id="ref-for-byte③④">byte</a> in <var>sequence</var>. 
    <li> Let <var>length</var> be the number of <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte" id="ref-for-byte③⑤">bytes</a> in <var>sequence</var>. 
    <li> If <var>length</var> is less than 4, return false. 
    <li> If the four <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte" id="ref-for-byte③⑥">bytes</a> from <var>sequence</var>[0] to <var>sequence</var>[3], are not equal to 0x1A
   0x45 0xDF 0xA3, return false. 
    <li> Let <var>iter</var> be 4. 
    <li>
      While <var>iter</var> is less than <var>length</var> and <var>iter</var> is
  less than 38, continuously loop through these steps: 
     <ol>
      <li>
        If the two bytes from <var>sequence</var>[<var>iter</var>] to <var>sequence</var>[<var>iter</var> + 1] are equal to 0x42 0x82, 
       <ol>
        <li> Increment <var>iter</var> by 2. 
        <li> If <var>iter</var> is greater or equal than <var>length</var>, abort
      these steps. 
        <li> Let <var>number size</var> be the result
      of <a href="#parse-a-vint" id="ref-for-parse-a-vint">parsing a <code>vint</code></a> starting at <var>sequence</var>[<var>iter</var>]. 
        <li> Increment <var>iter</var> by <var>number size</var>. 
        <li> If <var>iter</var> is less than <var>length</var> - 4, abort these
      steps. 
        <li> Let <var>matched</var> be the result of <a href="#matching-a-padded-sequence" id="ref-for-matching-a-padded-sequence">matching a padded
        sequence</a> 0x77 0x65 0x62 0x6D
      ("<code>webm</code>") on <var>sequence</var> at offset <var>iter</var>. 
        <li> If <var>matched</var> is true, abort these steps and return true. 
       </ol>
      <li> Increment <var>iter</var> by 1. 
     </ol>
    <li> Return false. 
   </ol>
   <p>To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="parse-a-vint">parse a <code>vint</code></dfn> on a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte-sequence" id="ref-for-byte-sequence①③">byte sequence</a> <var>sequence</var> of size <var>length</var>, starting at index <var>iter</var> use the following steps:</p>
   <ol>
    <li>Let <var>mask</var> be 128. 
    <li>Let <var>max vint length</var> be 8. 
    <li>Let <var>number size</var> be 1. 
    <li>
      While <var>number size</var> is less than <var>max vint length</var>, and less than <var>length</var>, continuously loop through these steps: 
     <ol>
      <li>If the <var>sequence</var>[<var>index</var>] &amp; <var>mask</var> is
   not zero, abort these steps. 
      <li>Let <var>mask</var> be the value of <var>mask</var> >> 1. 
      <li>Increment <var>number size</var> by one. 
     </ol>
    <li>Let <var>index</var> be 0. 
    <li>Let <var>parsed number</var> be <var>sequence</var>[<var>index</var>] &amp; ~<var>mask</var>. 
    <li>Increment <var>index</var> by one. 
    <li>Let <var>bytes remaining</var> be the value of <var>number size</var>. 
    <li>
      While <var>bytes remaining</var> is not zero, execute there steps: 
     <ol>
      <li>Let <var>parsed number</var> be <var>parsed number</var> &lt;&lt; 8. 
      <li>Let <var>parsed number</var> be <var>parsed number</var> | <var>sequence</var>[<var>index</var>]. 
      <li>Increment <var>index</var> by one. 
      <li>If <var>index</var> is greater or equal than <var>length</var>, abort these steps. 
      <li>Decrement <var>bytes remaining</var> by one. 
     </ol>
    <li>Return <var>parsed number</var> and <var>number size</var> 
   </ol>
   <p> <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="matching-a-padded-sequence">Matching a padded sequence</dfn> <var>pattern</var> on a sequence <var>sequence</var> at starting at byte <var>offset</var> and ending at by <var>end</var> means returning true if <var>sequence</var> has a length greater
than <var>end</var>, and contains exactly, in the range [<var>offset</var>, <var>end</var>], the bytes in <var>pattern</var>, in the same order, eventually
preceded by bytes with a value of 0x00, false otherwise. </p>
   <h4 class="heading settled" data-level="6.2.3" id="signature-for-mp3-without-id3"><span class="secno">6.2.3. </span><span class="content">Signature for MP3 without ID3</span><a class="self-link" href="#signature-for-mp3-without-id3"></a></h4>
   <p>To determine whether a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte-sequence" id="ref-for-byte-sequence①④">byte sequence</a> <dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="matches the signature for MP3 without ID3" data-noexport id="matches-the-signature-for-mp3-without-id3">matches the signature
for MP3 without ID3</dfn>, use the following steps:</p>
   <ol>
    <li> Let <var>sequence</var> be the <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte-sequence" id="ref-for-byte-sequence①⑤">byte sequence</a> to be matched,
  where <var>sequence</var>[<var>s</var>] is <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte" id="ref-for-byte③⑦">byte</a> <var>s</var> in <var>sequence</var> and <var>sequence</var>[0] is the first <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte" id="ref-for-byte③⑧">byte</a> in <var>sequence</var>. 
    <li> Let <var>length</var> be the number of <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte" id="ref-for-byte③⑨">bytes</a> in <var>sequence</var>. 
    <li>Initialize s to 0. 
    <li>If the result of the operation <a href="#match-an-mp3-header" id="ref-for-match-an-mp3-header">match mp3
  header</a> is false, return false. 
    <li><a href="#parse-an-mp3-frame" id="ref-for-parse-an-mp3-frame">Parse an mp3 frame</a> on <var>sequence</var> at offset <var>s</var> 
    <li>Let <var>skipped-bytes</var> the return value of the execution of <a href="#compute-an-mp3-frame-size" id="ref-for-compute-an-mp3-frame-size">mp3 framesize computation</a> 
    <li>If <var>skipped-bytes</var> is less than 4, or <var>skipped-bytes</var> is
  greater than <var>s</var> - <var>length</var>, return false. 
    <li>Increment s by <var>skipped-bytes</var>. 
    <li>If the result of the operation <a href="#match-an-mp3-header" id="ref-for-match-an-mp3-header①">match mp3
  header</a> operation is false, return false, else, return true. 
   </ol>
   <p>To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="match-an-mp3-header">match an mp3 header</dfn>, using a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte-sequence" id="ref-for-byte-sequence①⑥">byte sequence</a> <var>sequence</var> of length <var>length</var> at offset <var>s</var> execute these steps:</p>
   <ol>
    <li>If <var>length</var> is less than 4, return false. 
    <li>If <var>sequence</var>[<var>s</var>] is not equal to 0xff and <var>sequence</var>[<var>s</var> + 1] &amp; 0xe0 is not equal to 0xe0, return
  false. 
    <li>Let <var>layer</var> be the result of <var>sequence</var>[<var>s</var> +
  1] &amp; 0x06 >> 1. 
    <li>If <var>layer</var> is 0, return false. 
    <li>Let <var>bit-rate</var> be <var>sequence</var>[<var>s</var> + 2] &amp;
  0xf0 >> 4. 
    <li>If <var>bit-rate</var> is 15, return false. 
    <li>Let <var>sample-rate</var> be <var>sequence</var>[<var>s</var> + 2] &amp;
  0x0c >> 2. 
    <li>If <var>sample-rate</var> is 3, return false. 
    <li>Let <var>freq</var> be the value given by <var>sample-rate</var> in the table sample-rate. 
    <li>Let <var>final-layer</var> be the result of 4 -
  (<var>sequence</var>[<var>s</var> + 1]). 
    <li>If <var>final-layer</var> &amp; 0x06 >> 1 is not 3, return
  false. 
    <li>Return true. 
   </ol>
   <p>To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="compute-an-mp3-frame-size">compute an mp3 frame size</dfn>, execute these steps:</p>
   <ol>
    <li>If <var>version</var> is 1, let <var>scale</var> be 72, else, let <var>scale</var> be 144. 
    <li>Let <var>size</var> be <var>bitrate</var> * <var>scale</var> / <var>freq</var>. 
    <li>If <var>pad</var> is not zero, increment <var>size</var> by 1. 
    <li>Return <var>size</var>. 
   </ol>
   <p>To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="parse-an-mp3-frame">parse an mp3 frame</dfn>, execute these steps:</p>
   <ol>
    <li>Let <var>version</var> be <var>sequence</var>[<var>s</var> + 1] &amp; 0x18 >> 3. 
    <li>Let <var>bitrate-index</var> be sequence[s + 2] &amp; 0xf0 >> 4. 
    <li>If the <var>version</var> &amp; 0x01 is non-zero, let <var>bitrate</var> be the value given by <var>bitrate-index</var> in the table mp2.5-rates 
    <li>If <var>version</var> &amp; 0x01 is zero, let <var>bitrate</var> be the value given by <var>bitrate-index</var> in the table mp3-rates 
    <li>Let <var>samplerate-index</var> be <var>sequence</var>[<var>s</var> + 2] &amp; 0x0c >> 2. 
    <li>Let <var>samplerate</var> be the value given by <var>samplerate-index</var> in the <var>sample-rate</var> table. 
    <li>Let <var>pad</var> be <var>sequence</var>[<var>s</var> + 2] &amp; 0x02 >> 1. 
   </ol>
   <figure>
    <figcaption>mp3-rates table</figcaption>
    <table>
     <thead>
      <tr>
       <th>index 
       <th>mp3-rates 
     <tbody>
      <tr>
       <td>0 
       <td>0 
      <tr>
       <td>1 
       <td>32000 
      <tr>
       <td>2 
       <td>40000 
      <tr>
       <td>3 
       <td>48000 
      <tr>
       <td>4 
       <td>56000 
      <tr>
       <td>5 
       <td>64000 
      <tr>
       <td>6 
       <td>80000 
      <tr>
       <td>7 
       <td>96000 
      <tr>
       <td>8 
       <td>112000 
      <tr>
       <td>9 
       <td>128000 
      <tr>
       <td>10 
       <td>160000 
      <tr>
       <td>11 
       <td>192000 
      <tr>
       <td>12 
       <td>224000 
      <tr>
       <td>13 
       <td>256000 
      <tr>
       <td>14 
       <td>320000 
    </table>
   </figure>
   <figure>
    <figcaption>mp2.5-rates</figcaption>
    <table>
     <thead>
      <tr>
       <th>index 
       <th>mp2.5-rates 
     <tbody>
      <tr>
       <td>0 
       <td>0 
      <tr>
       <td>1 
       <td>8000 
      <tr>
       <td>2 
       <td>16000 
      <tr>
       <td>3 
       <td>24000 
      <tr>
       <td>4 
       <td>32000 
      <tr>
       <td>5 
       <td>40000 
      <tr>
       <td>6 
       <td>48000 
      <tr>
       <td>7 
       <td>56000 
      <tr>
       <td>8 
       <td>64000 
      <tr>
       <td>9 
       <td>80000 
      <tr>
       <td>10 
       <td>96000 
      <tr>
       <td>11 
       <td>112000 
      <tr>
       <td>12 
       <td>128000 
      <tr>
       <td>13 
       <td>144000 
      <tr>
       <td>14 
       <td>160000 
    </table>
   </figure>
   <figure>
    <figcaption>sample-rate table</figcaption>
    <table>
     <thead>
      <tr>
       <th>index 
       <th>samplerate 
     <tbody>
      <tr>
       <td>0 
       <td>44100 
      <tr>
       <td>1 
       <td>48000 
      <tr>
       <td>2 
       <td>32000 
    </table>
   </figure>
   <h3 class="heading settled" data-level="6.3" id="matching-a-font-type-pattern"><span class="secno">6.3. </span><span class="content">Matching a font type pattern</span><a class="self-link" href="#matching-a-font-type-pattern"></a></h3>
   <p>To determine which <a data-link-type="dfn" href="#font-mime-type" id="ref-for-font-mime-type">font MIME type</a> <a data-link-type="dfn" href="#byte-pattern" id="ref-for-byte-pattern⑦">byte pattern</a> a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte-sequence" id="ref-for-byte-sequence①⑦">byte sequence</a> <var>input</var> matches, if any, use the following <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="font-type-pattern-matching-algorithm">font type pattern matching algorithm</dfn>: </p>
   <ol>
    <li>
     <p>Execute the following steps for each row <var>row</var> in the following table: </p>
     <ol>
      <li>
       <p>Let <var>patternMatched</var> be the result of the <a data-link-type="dfn" href="#pattern-matching-algorithm" id="ref-for-pattern-matching-algorithm④">pattern matching algorithm</a> given <var>input</var>, the value in the first column of <var>row</var>, the value in the second
    column of <var>row</var>, and the value in the third column of <var>row</var>. </p>
      <li>
       <p>If <var>patternMatched</var> is true, return the value in the fourth column of <var>row</var>. </p>
     </ol>
     <table>
      <thead>
       <tr>
        <th> <a data-link-type="dfn" href="#byte-pattern" id="ref-for-byte-pattern⑧">Byte Pattern</a> 
        <th> <a data-link-type="dfn" href="#pattern-mask" id="ref-for-pattern-mask④">Pattern Mask</a> 
        <th> Leading <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte" id="ref-for-byte④⓪">Bytes</a> to Be Ignored 
        <th> <a data-link-type="dfn" href="#font-mime-type" id="ref-for-font-mime-type①">Font MIME Type</a> 
        <th> Note 
      <tbody>
       <tr>
        <td> 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
       00 00 00 00 00 00 00 00 00 00 4C 50 
        <td> 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
       00 00 00 00 00 00 00 00 00 00 FF FF 
        <td> None. 
        <td> <code>application/vnd.ms-fontobject</code> 
        <td> 34 <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte" id="ref-for-byte④①">bytes</a> followed by the string
       "<code>LP</code>", the Embedded OpenType signature. 
       <tr>
        <td> 00 01 00 00 
        <td> FF FF FF FF 
        <td> None. 
        <td> <code>font/ttf</code> 
        <td> 4 <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte" id="ref-for-byte④②">bytes</a> representing the version number 1.0, a
       TrueType signature. 
       <tr>
        <td> 4F 54 54 4F 
        <td> FF FF FF FF 
        <td> None. 
        <td> <code>font/otf</code> 
        <td> The string "<code>OTTO</code>", the OpenType signature. 
       <tr>
        <td> 74 74 63 66 
        <td> FF FF FF FF 
        <td> None. 
        <td> <code>font/collection</code> 
        <td> The string "<code>ttcf</code>", the TrueType Collection
       signature. 
       <tr>
        <td> 77 4F 46 46 
        <td> FF FF FF FF 
        <td> None. 
        <td> <code>font/woff</code> 
        <td> The string "<code>wOFF</code>", the Web Open Font Format 1.0
       signature. 
       <tr>
        <td> 77 4F 46 32 
        <td> FF FF FF FF 
        <td> None. 
        <td> <code>font/woff2</code> 
        <td> The string "<code>wOF2</code>", the Web Open Font Format 2.0
       signature. 
     </table>
    <li>
     <p>Return undefined. </p>
   </ol>
   <h3 class="heading settled" data-level="6.4" id="matching-an-archive-type-pattern"><span class="secno">6.4. </span><span class="content">Matching an archive type pattern</span><a class="self-link" href="#matching-an-archive-type-pattern"></a></h3>
   <p>To determine which <a data-link-type="dfn" href="#archive-mime-type" id="ref-for-archive-mime-type">archive MIME type</a> <a data-link-type="dfn" href="#byte-pattern" id="ref-for-byte-pattern⑨">byte pattern</a> a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte-sequence" id="ref-for-byte-sequence①⑧">byte sequence</a> <var>input</var> matches, if any, use the following <dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="archive type pattern matching algorithm" data-noexport id="archive-type-pattern-matching-algorithm">archive type pattern matching
algorithm</dfn>: </p>
   <ol>
    <li>
     <p>Execute the following steps for each row <var>row</var> in the following table: </p>
     <ol>
      <li>
       <p>Let <var>patternMatched</var> be the result of the <a data-link-type="dfn" href="#pattern-matching-algorithm" id="ref-for-pattern-matching-algorithm⑤">pattern matching algorithm</a> given <var>input</var>, the value in the first column of <var>row</var>, the value in the second
    column of <var>row</var>, and the value in the third column of <var>row</var>. </p>
      <li>
       <p>If <var>patternMatched</var> is true, return the value in the fourth column of <var>row</var>. </p>
     </ol>
     <table>
      <thead>
       <tr>
        <th> <a data-link-type="dfn" href="#byte-pattern" id="ref-for-byte-pattern①⓪">Byte Pattern</a> 
        <th> <a data-link-type="dfn" href="#pattern-mask" id="ref-for-pattern-mask⑤">Pattern Mask</a> 
        <th> Leading <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte" id="ref-for-byte④③">Bytes</a> to Be Ignored 
        <th> <a data-link-type="dfn" href="#archive-mime-type" id="ref-for-archive-mime-type①">Archive MIME Type</a> 
        <th> Note 
      <tbody>
       <tr>
        <td> 1F 8B 08 
        <td> FF FF FF 
        <td> None. 
        <td> <code>application/x-gzip</code> 
        <td> The GZIP archive signature. 
       <tr>
        <td> 50 4B 03 04 
        <td> FF FF FF FF 
        <td> None. 
        <td> <code>application/zip</code> 
        <td> The string "<code>PK</code>" followed by ETX EOT, the ZIP archive
       signature. 
       <tr>
        <td> 52 61 72 20 1A 07 00 
        <td> FF FF FF FF FF FF FF 
        <td> None. 
        <td> <code>application/x-rar-compressed</code> 
        <td> The string "<code>Rar </code>" followed by SUB BEL NUL, the RAR
       archive signature. 
     </table>
    <li>
     <p>Return undefined. </p>
   </ol>
   <h2 class="heading settled" data-level="7" id="determining-the-computed-mime-type-of-a-resource"><span class="secno">7. </span><span class="content">Determining the computed MIME type of a resource</span><a class="self-link" href="#determining-the-computed-mime-type-of-a-resource"></a></h2>
   <p> To determine the <a data-link-type="dfn" href="#computed-mime-type" id="ref-for-computed-mime-type">computed MIME type</a> of a <a data-link-type="dfn" href="#resource" id="ref-for-resource①⑨">resource</a>,
 user agents must use the following <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="mime-type-sniffing-algorithm">MIME type sniffing algorithm</dfn>: </p>
   <ol>
    <li> If the <a data-link-type="dfn" href="#supplied-mime-type" id="ref-for-supplied-mime-type⑤">supplied MIME type</a> is undefined or if the <a data-link-type="dfn" href="#supplied-mime-type" id="ref-for-supplied-mime-type⑥">supplied MIME type</a>’s <a data-link-type="dfn" href="#mime-type-essence" id="ref-for-mime-type-essence⑨">essence</a> is
   "<code>unknown/unknown</code>",
   "<code>application/unknown</code>", or "<code>*/*</code>",
   execute the <a data-link-type="dfn" href="#rules-for-identifying-an-unknown-mime-type" id="ref-for-rules-for-identifying-an-unknown-mime-type">rules for identifying an unknown MIME type</a> with
   the <a data-link-type="dfn" href="#sniff-scriptable-flag" id="ref-for-sniff-scriptable-flag">sniff-scriptable flag</a> equal to the inverse of the <a data-link-type="dfn" href="#no-sniff-flag" id="ref-for-no-sniff-flag">no-sniff flag</a> and abort these steps. 
    <li>
      If the <a data-link-type="dfn" href="#no-sniff-flag" id="ref-for-no-sniff-flag①">no-sniff flag</a> is set, the <a data-link-type="dfn" href="#computed-mime-type" id="ref-for-computed-mime-type①">computed MIME
   type</a> is the <a data-link-type="dfn" href="#supplied-mime-type" id="ref-for-supplied-mime-type⑦">supplied MIME type</a>. 
     <p>Abort these steps.</p>
    <li> If the <a data-link-type="dfn" href="#check-for-apache-bug-flag" id="ref-for-check-for-apache-bug-flag①">check-for-apache-bug flag</a> is set, execute the <a data-link-type="dfn" href="#rules-for-text-or-binary" id="ref-for-rules-for-text-or-binary">rules for distinguishing if a resource is text or binary</a> and
   abort these steps. 
    <li>
      If the <a data-link-type="dfn" href="#supplied-mime-type" id="ref-for-supplied-mime-type⑧">supplied MIME type</a> is an <a data-link-type="dfn" href="#xml-mime-type" id="ref-for-xml-mime-type①">XML MIME type</a>, the <a data-link-type="dfn" href="#computed-mime-type" id="ref-for-computed-mime-type②">computed MIME type</a> is the <a data-link-type="dfn" href="#supplied-mime-type" id="ref-for-supplied-mime-type⑨">supplied MIME type</a>. 
     <p>Abort these steps.</p>
    <li> If the <a data-link-type="dfn" href="#supplied-mime-type" id="ref-for-supplied-mime-type①⓪">supplied MIME type</a>’s <a data-link-type="dfn" href="#mime-type-essence" id="ref-for-mime-type-essence①⓪">essence</a> is "<code>text/html</code>",
   execute the <a data-link-type="dfn" href="#rules-for-distinguishing-if-a-resource-is-a-feed-or-html" id="ref-for-rules-for-distinguishing-if-a-resource-is-a-feed-or-html">rules for distinguishing if a resource is a feed or HTML</a> and
   abort these steps. 
    <li> If the <a data-link-type="dfn" href="#supplied-mime-type" id="ref-for-supplied-mime-type①①">supplied MIME type</a> is an <a data-link-type="dfn" href="#image-mime-type" id="ref-for-image-mime-type②">image MIME type</a> <a data-link-type="dfn" href="#supported-by-the-user-agent" id="ref-for-supported-by-the-user-agent">supported by the user agent</a>, let <var>matched-type</var> be
   the result of executing the <a data-link-type="dfn" href="#image-type-pattern-matching-algorithm" id="ref-for-image-type-pattern-matching-algorithm">image type pattern matching
   algorithm</a> with the <a data-link-type="dfn" href="#resource-header" id="ref-for-resource-header②">resource header</a> as the <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte-sequence" id="ref-for-byte-sequence①⑨">byte
   sequence</a> to be matched. 
    <li>
      If <var>matched-type</var> is not undefined, the <a data-link-type="dfn" href="#computed-mime-type" id="ref-for-computed-mime-type③">computed MIME
   type</a> is <var>matched-type</var>. 
     <p>Abort these steps.</p>
    <li> If the <a data-link-type="dfn" href="#supplied-mime-type" id="ref-for-supplied-mime-type①②">supplied MIME type</a> is an <a data-link-type="dfn" href="#audio-or-video-mime-type" id="ref-for-audio-or-video-mime-type②">audio or video MIME type</a> <a data-link-type="dfn" href="#supported-by-the-user-agent" id="ref-for-supported-by-the-user-agent①">supported by the user agent</a>, let <var>matched-type</var> be the result of executing the <a data-link-type="dfn" href="#audio-or-video-type-pattern-matching-algorithm" id="ref-for-audio-or-video-type-pattern-matching-algorithm">audio or video
   type pattern matching algorithm</a> with the <a data-link-type="dfn" href="#resource-header" id="ref-for-resource-header③">resource
   header</a> as the <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte-sequence" id="ref-for-byte-sequence②⓪">byte sequence</a> to be matched. 
    <li>
      If <var>matched-type</var> is not undefined, the <a data-link-type="dfn" href="#computed-mime-type" id="ref-for-computed-mime-type④">computed MIME
   type</a> is <var>matched-type</var>. 
     <p>Abort these steps.</p>
    <li> The <a data-link-type="dfn" href="#computed-mime-type" id="ref-for-computed-mime-type⑤">computed MIME type</a> is the <a data-link-type="dfn" href="#supplied-mime-type" id="ref-for-supplied-mime-type①③">supplied MIME
   type</a>. 
   </ol>
   <h3 class="heading settled" data-level="7.1" id="identifying-a-resource-with-an-unknown-mime-type"><span class="secno">7.1. </span><span class="content">Identifying a resource with an unknown MIME type</span><a class="self-link" href="#identifying-a-resource-with-an-unknown-mime-type"></a></h3>
   <p> The <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="sniff-scriptable-flag">sniff-scriptable flag</dfn> is used by the <a data-link-type="dfn" href="#rules-for-identifying-an-unknown-mime-type" id="ref-for-rules-for-identifying-an-unknown-mime-type①">rules for
 identifying an unknown MIME type</a> to determine whether to sniff for <a data-link-type="dfn" href="#scriptable-mime-type" id="ref-for-scriptable-mime-type">scriptable MIME types</a>. </p>
   <p>If the setting of the <a data-link-type="dfn" href="#sniff-scriptable-flag" id="ref-for-sniff-scriptable-flag①">sniff-scriptable flag</a> is not specified
 when calling the <a data-link-type="dfn" href="#rules-for-identifying-an-unknown-mime-type" id="ref-for-rules-for-identifying-an-unknown-mime-type②">rules for identifying an unknown MIME type</a>,
 the <a data-link-type="dfn" href="#sniff-scriptable-flag" id="ref-for-sniff-scriptable-flag②">sniff-scriptable flag</a> must default to unset.</p>
   <p>To determine the <a data-link-type="dfn" href="#computed-mime-type" id="ref-for-computed-mime-type⑥">computed MIME type</a> of a <a data-link-type="dfn" href="#resource" id="ref-for-resource②⓪">resource</a> <var>resource</var> with an
unknown <a data-link-type="dfn" href="#mime-type" id="ref-for-mime-type②⑧">MIME type</a>, execute the following <dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="rules for identifying an unknown MIME type" data-noexport id="rules-for-identifying-an-unknown-mime-type">rules for identifying an unknown MIME
type</dfn>: </p>
   <ol>
    <li>
     <p>If the <a data-link-type="dfn" href="#sniff-scriptable-flag" id="ref-for-sniff-scriptable-flag③">sniff-scriptable flag</a> is set, execute the following steps for each row <var>row</var> in the following table: </p>
     <ol>
      <li>
       <p>Let <var>patternMatched</var> be the result of the <a data-link-type="dfn" href="#pattern-matching-algorithm" id="ref-for-pattern-matching-algorithm⑥">pattern matching algorithm</a> given <var>resource</var>’s <a data-link-type="dfn" href="#resource-header" id="ref-for-resource-header④">resource header</a>, the value in the first column of <var>row</var>, the value in the second column of <var>row</var>, and the value in the third
    column of <var>row</var>. </p>
      <li>
       <p>If <var>patternMatched</var> is true, return the value in the fourth column of <var>row</var>. </p>
     </ol>
     <table>
      <thead>
       <tr>
        <th> <a data-link-type="dfn" href="#byte-pattern" id="ref-for-byte-pattern①①">Byte Pattern</a> 
        <th> <a data-link-type="dfn" href="#pattern-mask" id="ref-for-pattern-mask⑥">Pattern Mask</a> 
        <th> Leading <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte" id="ref-for-byte④④">Bytes</a> to Be Ignored 
        <th> <a data-link-type="dfn" href="#computed-mime-type" id="ref-for-computed-mime-type⑦">Computed MIME Type</a> 
        <th> Note 
      <tbody>
       <tr>
        <td> 3C 21 44 4F 43 54 59 50 45 20 48 54 4D 4C <abbr data-lt="tag terminating byte">TT</abbr> 
        <td> FF FF DF DF DF DF DF DF DF FF DF DF DF DF FF 
        <td> <a data-link-type="dfn" href="#whitespace-byte" id="ref-for-whitespace-byte">Whitespace bytes</a>. 
        <td> <code>text/html</code> 
        <td> The case-insensitive string "<code>&lt;!DOCTYPE HTML</code>"
       followed by a <a data-link-type="dfn" href="#tag-terminating-byte" id="ref-for-tag-terminating-byte">tag-terminating byte</a>. 
       <tr>
        <td> 3C 48 54 4D 4C <abbr data-lt="tag terminating byte">TT</abbr> 
        <td> FF DF DF DF DF FF 
        <td> <a data-link-type="dfn" href="#whitespace-byte" id="ref-for-whitespace-byte①">Whitespace bytes</a>. 
        <td> <code>text/html</code> 
        <td> The case-insensitive string "<code>&lt;HTML</code>" followed by a <a data-link-type="dfn" href="#tag-terminating-byte" id="ref-for-tag-terminating-byte①">tag-terminating byte</a>. 
       <tr>
        <td> 3C 48 45 41 44 <abbr data-lt="tag terminating byte">TT</abbr> 
        <td> FF DF DF DF DF FF 
        <td> <a data-link-type="dfn" href="#whitespace-byte" id="ref-for-whitespace-byte②">Whitespace bytes</a>. 
        <td> <code>text/html</code> 
        <td> The case-insensitive string "<code>&lt;HEAD</code>" followed by a <a data-link-type="dfn" href="#tag-terminating-byte" id="ref-for-tag-terminating-byte②">tag-terminating byte</a>. 
       <tr>
        <td> 3C 53 43 52 49 50 54 <abbr data-lt="tag terminating byte">TT</abbr> 
        <td> FF DF DF DF DF DF DF FF 
        <td> <a data-link-type="dfn" href="#whitespace-byte" id="ref-for-whitespace-byte③">Whitespace bytes</a>. 
        <td> <code>text/html</code> 
        <td> The case-insensitive string "<code>&lt;SCRIPT</code>" followed by
       a <a data-link-type="dfn" href="#tag-terminating-byte" id="ref-for-tag-terminating-byte③">tag-terminating byte</a>. 
       <tr>
        <td> 3C 49 46 52 41 4D 45 <abbr data-lt="tag terminating byte">TT</abbr> 
        <td> FF DF DF DF DF DF DF FF 
        <td> <a data-link-type="dfn" href="#whitespace-byte" id="ref-for-whitespace-byte④">Whitespace bytes</a>. 
        <td> <code>text/html</code> 
        <td> The case-insensitive string "<code>&lt;IFRAME</code>" followed by
       a <a data-link-type="dfn" href="#tag-terminating-byte" id="ref-for-tag-terminating-byte④">tag-terminating byte</a>. 
       <tr>
        <td> 3C 48 31 <abbr data-lt="tag terminating byte">TT</abbr> 
        <td> FF DF FF FF 
        <td> <a data-link-type="dfn" href="#whitespace-byte" id="ref-for-whitespace-byte⑤">Whitespace bytes</a>. 
        <td> <code>text/html</code> 
        <td> The case-insensitive string "<code>&lt;H1</code>" followed by a <a data-link-type="dfn" href="#tag-terminating-byte" id="ref-for-tag-terminating-byte⑤">tag-terminating byte</a>. 
       <tr>
        <td> 3C 44 49 56 <abbr data-lt="tag terminating byte">TT</abbr> 
        <td> FF DF DF DF FF 
        <td> <a data-link-type="dfn" href="#whitespace-byte" id="ref-for-whitespace-byte⑥">Whitespace bytes</a>. 
        <td> <code>text/html</code> 
        <td> The case-insensitive string "<code>&lt;DIV</code>" followed by a <a data-link-type="dfn" href="#tag-terminating-byte" id="ref-for-tag-terminating-byte⑥">tag-terminating byte</a>. 
       <tr>
        <td> 3C 46 4F 4E 54 <abbr data-lt="tag terminating byte">TT</abbr> 
        <td> FF DF DF DF DF FF 
        <td> <a data-link-type="dfn" href="#whitespace-byte" id="ref-for-whitespace-byte⑦">Whitespace bytes</a>. 
        <td> <code>text/html</code> 
        <td> The case-insensitive string "<code>&lt;FONT</code>" followed by a <a data-link-type="dfn" href="#tag-terminating-byte" id="ref-for-tag-terminating-byte⑦">tag-terminating byte</a>. 
       <tr>
        <td> 3C 54 41 42 4C 45 <abbr data-lt="tag terminating byte">TT</abbr> 
        <td> FF DF DF DF DF DF FF 
        <td> <a data-link-type="dfn" href="#whitespace-byte" id="ref-for-whitespace-byte⑧">Whitespace bytes</a>. 
        <td> <code>text/html</code> 
        <td> The case-insensitive string "<code>&lt;TABLE</code>" followed by
       a <a data-link-type="dfn" href="#tag-terminating-byte" id="ref-for-tag-terminating-byte⑧">tag-terminating byte</a>. 
       <tr>
        <td> 3C 41 <abbr data-lt="tag terminating byte">TT</abbr> 
        <td> FF DF FF 
        <td> <a data-link-type="dfn" href="#whitespace-byte" id="ref-for-whitespace-byte⑨">Whitespace bytes</a>. 
        <td> <code>text/html</code> 
        <td> The case-insensitive string "<code>&lt;A</code>" followed by a <a data-link-type="dfn" href="#tag-terminating-byte" id="ref-for-tag-terminating-byte⑨">tag-terminating byte</a>. 
       <tr>
        <td> 3C 53 54 59 4C 45 <abbr data-lt="tag terminating byte">TT</abbr> 
        <td> FF DF DF DF DF DF FF 
        <td> <a data-link-type="dfn" href="#whitespace-byte" id="ref-for-whitespace-byte①⓪">Whitespace bytes</a>. 
        <td> <code>text/html</code> 
        <td> The case-insensitive string "<code>&lt;STYLE</code>" followed by
       a <a data-link-type="dfn" href="#tag-terminating-byte" id="ref-for-tag-terminating-byte①⓪">tag-terminating byte</a>. 
       <tr>
        <td> 3C 54 49 54 4C 45 <abbr data-lt="tag terminating byte">TT</abbr> 
        <td> FF DF DF DF DF DF FF 
        <td> <a data-link-type="dfn" href="#whitespace-byte" id="ref-for-whitespace-byte①①">Whitespace bytes</a>. 
        <td> <code>text/html</code> 
        <td> The case-insensitive string "<code>&lt;TITLE</code>" followed by
       a <a data-link-type="dfn" href="#tag-terminating-byte" id="ref-for-tag-terminating-byte①①">tag-terminating byte</a>. 
       <tr>
        <td> 3C 42 <abbr data-lt="tag terminating byte">TT</abbr> 
        <td> FF DF FF 
        <td> <a data-link-type="dfn" href="#whitespace-byte" id="ref-for-whitespace-byte①②">Whitespace bytes</a>. 
        <td> <code>text/html</code> 
        <td> The case-insensitive string "<code>&lt;B</code>" followed by a <a data-link-type="dfn" href="#tag-terminating-byte" id="ref-for-tag-terminating-byte①②">tag-terminating byte</a>. 
       <tr>
        <td> 3C 42 4F 44 59 <abbr data-lt="tag terminating byte">TT</abbr> 
        <td> FF DF DF DF DF FF 
        <td> <a data-link-type="dfn" href="#whitespace-byte" id="ref-for-whitespace-byte①③">Whitespace bytes</a>. 
        <td> <code>text/html</code> 
        <td> The case-insensitive string "<code>&lt;BODY</code>" followed by a <a data-link-type="dfn" href="#tag-terminating-byte" id="ref-for-tag-terminating-byte①③">tag-terminating byte</a>. 
       <tr>
        <td> 3C 42 52 <abbr data-lt="tag terminating byte">TT</abbr> 
        <td> FF DF DF FF 
        <td> <a data-link-type="dfn" href="#whitespace-byte" id="ref-for-whitespace-byte①④">Whitespace bytes</a>. 
        <td> <code>text/html</code> 
        <td> The case-insensitive string "<code>&lt;BR</code>" followed by a <a data-link-type="dfn" href="#tag-terminating-byte" id="ref-for-tag-terminating-byte①④">tag-terminating byte</a>. 
       <tr>
        <td> 3C 50 <abbr data-lt="tag terminating byte">TT</abbr> 
        <td> FF DF FF 
        <td> <a data-link-type="dfn" href="#whitespace-byte" id="ref-for-whitespace-byte①⑤">Whitespace bytes</a>. 
        <td> <code>text/html</code> 
        <td> The case-insensitive string "<code>&lt;P</code>" followed by a <a data-link-type="dfn" href="#tag-terminating-byte" id="ref-for-tag-terminating-byte①⑤">tag-terminating byte</a>. 
       <tr>
        <td> 3C 21 2D 2D <abbr data-lt="tag terminating byte">TT</abbr> 
        <td> FF FF FF FF FF 
        <td> <a data-link-type="dfn" href="#whitespace-byte" id="ref-for-whitespace-byte①⑥">Whitespace bytes</a>. 
        <td> <code>text/html</code> 
        <td> The string "<code>&lt;!--</code>" followed by a <a data-link-type="dfn" href="#tag-terminating-byte" id="ref-for-tag-terminating-byte①⑥">tag-terminating byte</a>. 
       <tr>
        <td> 3C 3F 78 6D 6C 
        <td> FF FF FF FF FF 
        <td> <a data-link-type="dfn" href="#whitespace-byte" id="ref-for-whitespace-byte①⑦">Whitespace bytes</a>. 
        <td> <code>text/xml</code> 
        <td> The string "<code>&lt;?xml</code>". 
       <tr>
        <td> 25 50 44 46 2D 
        <td> FF FF FF FF FF 
        <td> None. 
        <td> <code>application/pdf</code> 
        <td> The string "<code>%PDF-</code>", the PDF signature. 
     </table>
     <p class="XXX"> What about feeds? </p>
    <li>
     <p>Execute the following steps for each row <var>row</var> in the following table: </p>
     <ol>
      <li>
       <p>Let <var>patternMatched</var> be the result of the <a data-link-type="dfn" href="#pattern-matching-algorithm" id="ref-for-pattern-matching-algorithm⑦">pattern matching algorithm</a> given <var>resource</var>’s <a data-link-type="dfn" href="#resource-header" id="ref-for-resource-header⑤">resource header</a>, the value in the first column of <var>row</var>, the value in the second column of <var>row</var>, and the value in the third
    column of <var>row</var>. </p>
      <li>
       <p>If <var>patternMatched</var> is true, return the value in the fourth column of <var>row</var>. </p>
     </ol>
     <table>
      <thead>
       <tr>
        <th> <a data-link-type="dfn" href="#byte-pattern" id="ref-for-byte-pattern①②">Byte Pattern</a> 
        <th> <a data-link-type="dfn" href="#pattern-mask" id="ref-for-pattern-mask⑦">Pattern Mask</a> 
        <th> Leading <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte" id="ref-for-byte④⑤">Bytes</a> to Be Ignored 
        <th> <a data-link-type="dfn" href="#computed-mime-type" id="ref-for-computed-mime-type⑧">Computed MIME Type</a> 
        <th> Note 
      <tbody>
       <tr>
        <td> 25 21 50 53 2D 41 64 6F 62 65 2D 
        <td> FF FF FF FF FF FF FF FF FF FF FF 
        <td> None. 
        <td> <code>application/postscript</code> 
        <td> The string "<code>%!PS-Adobe-</code>", the PostScript signature. 
       <tr>
        <td> FE FF 00 00 
        <td> FF FF 00 00 
        <td> None. 
        <td> <code>text/plain</code> 
        <td> UTF-16BE BOM 
       <tr>
        <td> FF FE 00 00 
        <td> FF FF 00 00 
        <td> None. 
        <td> <code>text/plain</code> 
        <td> UTF-16LE BOM 
       <tr>
        <td> EF BB BF 00 
        <td> FF FF FF 00 
        <td> None. 
        <td> <code>text/plain</code> 
        <td> UTF-8 BOM 
     </table>
     <p>User agents may implicitly extend this table to support additional <a data-link-type="dfn" href="#mime-type" id="ref-for-mime-type②⑨">MIME types</a>. </p>
     <p>However, user agents should not implicitly extend this table to include additional <a data-link-type="dfn" href="#byte-pattern" id="ref-for-byte-pattern①③">byte patterns</a> for any <a data-link-type="dfn" href="#computed-mime-type" id="ref-for-computed-mime-type⑨">computed MIME type</a> already present in this table, as doing so
   could introduce privilege escalation vulnerabilities. </p>
     <p>User agents must not introduce any privilege escalation vulnerabilities when extending this
   table. </p>
    <li>
     <p>Let <var>matchedType</var> be the result of executing the <a data-link-type="dfn" href="#image-type-pattern-matching-algorithm" id="ref-for-image-type-pattern-matching-algorithm①">image type pattern matching algorithm</a> given <var>resource</var>’s <a data-link-type="dfn" href="#resource-header" id="ref-for-resource-header⑥">resource header</a>. </p>
    <li>
     <p>If <var>matchedType</var> is not undefined, return <var>matchedType</var>. </p>
    <li>
     <p>Set <var>matchedType</var> to the result of executing the <a data-link-type="dfn" href="#audio-or-video-type-pattern-matching-algorithm" id="ref-for-audio-or-video-type-pattern-matching-algorithm①">audio or video type pattern matching algorithm</a> given <var>resource</var>’s <a data-link-type="dfn" href="#resource-header" id="ref-for-resource-header⑦">resource header</a>. </p>
    <li>
     <p>If <var>matchedType</var> is not undefined, return <var>matchedType</var>. </p>
    <li>
     <p>Set <var>matchedType</var> to the result of executing the <a data-link-type="dfn" href="#archive-type-pattern-matching-algorithm" id="ref-for-archive-type-pattern-matching-algorithm">archive type pattern matching algorithm</a> given <var>resource</var>’s <a data-link-type="dfn" href="#resource-header" id="ref-for-resource-header⑧">resource header</a>. </p>
    <li>
     <p>If <var>matchedType</var> is not undefined, return <var>matchedType</var>. </p>
    <li>
     <p>If <var>resource</var>’s <a data-link-type="dfn" href="#resource-header" id="ref-for-resource-header⑨">resource header</a> contains no <a data-link-type="dfn" href="#binary-data-byte" id="ref-for-binary-data-byte">binary data bytes</a>,
  return  "<code>text/plain</code>". </p>
    <li>
     <p>Return "<code>application/octet-stream</code>". </p>
   </ol>
   <h3 class="heading settled" data-level="7.2" id="sniffing-a-mislabeled-binary-resource"><span class="secno">7.2. </span><span class="content">Sniffing a mislabeled binary resource</span><a class="self-link" href="#sniffing-a-mislabeled-binary-resource"></a></h3>
   <p> To determine whether a binary <a data-link-type="dfn" href="#resource" id="ref-for-resource②①">resource</a> has been mislabeled as
 plain text, execute the following <dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="rules for distinguishing if a resource is text or binary" data-noexport id="rules-for-text-or-binary">rules for
 distinguishing if a resource is text or binary</dfn>: </p>
   <ol>
    <li> Let <var>length</var> be the number of <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte" id="ref-for-byte④⑥">bytes</a> in the <a data-link-type="dfn" href="#resource-header" id="ref-for-resource-header①⓪">resource header</a>. 
    <li>
      If <var>length</var> is greater than or equal to 2 and the first 2 bytes of
  the <a data-link-type="dfn" href="#resource-header" id="ref-for-resource-header①①">resource header</a> are equal to 0xFE 0xFF (UTF-16BE BOM) or
  0xFF 0xFE (UTF-16LE BOM), the <a data-link-type="dfn" href="#computed-mime-type" id="ref-for-computed-mime-type①⓪">computed MIME type</a> is
  "<code>text/plain</code>". 
     <p>Abort these steps.</p>
    <li>
      If <var>length</var> is greater than or equal to 3 and the first 3 bytes of
  the <a data-link-type="dfn" href="#resource-header" id="ref-for-resource-header①②">resource header</a> are equal to 0xEF 0xBB 0xBF (UTF-8 BOM),
  the <a data-link-type="dfn" href="#computed-mime-type" id="ref-for-computed-mime-type①①">computed MIME type</a> is "<code>text/plain</code>". 
     <p>Abort these steps.</p>
    <li>
      If the <a data-link-type="dfn" href="#resource-header" id="ref-for-resource-header①③">resource header</a> contains no <a data-link-type="dfn" href="#binary-data-byte" id="ref-for-binary-data-byte①">binary data bytes</a>, the <a data-link-type="dfn" href="#computed-mime-type" id="ref-for-computed-mime-type①②">computed
  MIME type</a> is "<code>text/plain</code>". 
     <p>Abort these steps.</p>
    <li>
      The <a data-link-type="dfn" href="#computed-mime-type" id="ref-for-computed-mime-type①③">computed MIME type</a> is
  "<code>application/octet-stream</code>". 
     <p class="warning"> It is critical that the <a data-link-type="dfn" href="#rules-for-text-or-binary" id="ref-for-rules-for-text-or-binary①">rules for distinguishing if a resource is
   text or binary</a> never determine the <a data-link-type="dfn" href="#computed-mime-type" id="ref-for-computed-mime-type①④">computed MIME type</a> to be a <a data-link-type="dfn" href="#scriptable-mime-type" id="ref-for-scriptable-mime-type①">scriptable MIME type</a>, as this could allow a privilege
   escalation attack. </p>
   </ol>
   <h3 class="heading settled" data-level="7.3" id="sniffing-a-mislabeled-feed"><span class="secno">7.3. </span><span class="content">Sniffing a mislabeled feed</span><a class="self-link" href="#sniffing-a-mislabeled-feed"></a></h3>
   <p> To determine whether a feed has been mislabeled as HTML, execute the
 following <dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="rules for distinguishing if a resource is a feed or HTML" data-noexport id="rules-for-distinguishing-if-a-resource-is-a-feed-or-html">rules for distinguishing if a resource is a feed or
 HTML</dfn>: </p>
   <ol>
    <li> Let <var>sequence</var> be the <a data-link-type="dfn" href="#resource-header" id="ref-for-resource-header①④">resource header</a>, where <var>sequence</var>[<var>s</var>] is <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte" id="ref-for-byte④⑦">byte</a> <var>s</var> in <var>sequence</var> and <var>sequence</var>[0] is the first <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte" id="ref-for-byte④⑧">byte</a> in <var>sequence</var>. 
    <li> Let <var>length</var> be the number of <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte" id="ref-for-byte④⑨">bytes</a> in <var>sequence</var>. 
    <li> Initialize <var>s</var> to 0. 
    <li> If <var>length</var> is greater than or equal to 3 and the three <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte" id="ref-for-byte⑤⓪">bytes</a> from <var>sequence</var>[0] to <var>sequence</var>[2] are equal to 0xEF 0xBB 0xBF (UTF-8 BOM), increment <var>s</var> by 3. 
    <li>
      While <var>s</var> is less than <var>length</var>, continuously loop
   through these steps: 
     <ol>
      <li>
        Enter loop <var>L</var>: 
       <ol>
        <li>
          If <var>sequence</var>[<var>s</var>] is undefined, the <a data-link-type="dfn" href="#computed-mime-type" id="ref-for-computed-mime-type①⑤">computed
       MIME type</a> is the <a data-link-type="dfn" href="#supplied-mime-type" id="ref-for-supplied-mime-type①④">supplied MIME type</a>. 
         <p>Abort these steps.</p>
        <li> If <var>sequence</var>[<var>s</var>] is equal to 0x3C
       ("<code>&lt;</code>"), increment <var>s</var> by 1 and exit loop <var>L</var>. 
        <li>
          If <var>sequence</var>[<var>s</var>] is not a <a data-link-type="dfn" href="#whitespace-byte" id="ref-for-whitespace-byte①⑧">whitespace
       byte</a>, the <a data-link-type="dfn" href="#computed-mime-type" id="ref-for-computed-mime-type①⑥">computed MIME type</a> is the <a data-link-type="dfn" href="#supplied-mime-type" id="ref-for-supplied-mime-type①⑤">supplied
       MIME type</a>. 
         <p>Abort these steps.</p>
        <li> Increment <var>s</var> by 1. 
       </ol>
      <li>
        Enter loop <var>L</var>: 
       <ol>
        <li>
          If <var>sequence</var>[<var>s</var>] is undefined, the <a data-link-type="dfn" href="#computed-mime-type" id="ref-for-computed-mime-type①⑦">computed
       MIME type</a> is the <a data-link-type="dfn" href="#supplied-mime-type" id="ref-for-supplied-mime-type①⑥">supplied MIME type</a>. 
         <p>Abort these steps.</p>
        <li>
          If <var>length</var> is greater than or equal to <var>s</var> + 3 and
       the three <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte" id="ref-for-byte⑤①">bytes</a> from <var>sequence</var>[<var>s</var>] to <var>sequence</var>[<var>s</var> + 2] are equal to 0x21 0x2D 0x2D
       ("<code>!--</code>"), increment <var>s</var> by 3 and enter loop <var>M</var>: 
         <ol>
          <li>
            If <var>sequence</var>[<var>s</var>] is undefined, the <a data-link-type="dfn" href="#computed-mime-type" id="ref-for-computed-mime-type①⑧">computed
         MIME type</a> is the <a data-link-type="dfn" href="#supplied-mime-type" id="ref-for-supplied-mime-type①⑦">supplied MIME type</a>. 
           <p>Abort these steps.</p>
          <li> If <var>length</var> is greater than or equal to <var>s</var> + 3 and
         the three <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte" id="ref-for-byte⑤②">bytes</a> from <var>sequence</var>[<var>s</var>] to <var>sequence</var>[<var>s</var> + 2] are equal to 0x2D 0x2D 0x3E
         ("<code>--></code>"), increment <var>s</var> by 3 and exit
         loops <var>M</var> and <var>L</var>. 
          <li> Increment <var>s</var> by 1. 
         </ol>
        <li>
          If <var>length</var> is greater than or equal to <var>s</var> + 1 and <var>sequence</var>[<var>s</var>] is equal to 0x21
       ("<code>!</code>"), increment <var>s</var> by 1 and enter loop <var>M</var>: 
         <ol>
          <li>
            If <var>sequence</var>[<var>s</var>] is undefined, the <a data-link-type="dfn" href="#computed-mime-type" id="ref-for-computed-mime-type①⑨">computed
         MIME type</a> is the <a data-link-type="dfn" href="#supplied-mime-type" id="ref-for-supplied-mime-type①⑧">supplied MIME type</a>. 
           <p>Abort these steps.</p>
          <li> If <var>length</var> is greater than or equal to <var>s</var> + 1 and <var>sequence</var>[<var>s</var>] is equal to 0x3E
         ("<code>></code>"), increment <var>s</var> by 1 and exit loops <var>M</var> and <var>L</var>. 
          <li> Increment <var>s</var> by 1. 
         </ol>
        <li>
          If <var>length</var> is greater than or equal to <var>s</var> + 1 and <var>sequence</var>[<var>s</var>] is equal to 0x3F
       ("<code>?</code>"), increment <var>s</var> by 1 and enter loop <var>M</var>: 
         <ol>
          <li>
            If <var>sequence</var>[<var>s</var>] is undefined, the <a data-link-type="dfn" href="#computed-mime-type" id="ref-for-computed-mime-type②⓪">computed
         MIME type</a> is the <a data-link-type="dfn" href="#supplied-mime-type" id="ref-for-supplied-mime-type①⑨">supplied MIME type</a>. 
           <p>Abort these steps.</p>
          <li> If <var>length</var> is greater than or equal to <var>s</var> + 2 and
         the two <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte" id="ref-for-byte⑤③">bytes</a> from <var>sequence</var>[<var>s</var>] to <var>sequence</var>[<var>s</var> + 1] are equal to 0x3F 0x3E
         ("<code>?></code>"), increment <var>s</var> by 2 and exit loops <var>M</var> and <var>L</var>. 
          <li> Increment <var>s</var> by 1. 
         </ol>
        <li>
          If <var>length</var> is greater than or equal to <var>s</var> + 3 and
       the three <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte" id="ref-for-byte⑤④">bytes</a> from <var>sequence</var>[<var>s</var>] to <var>sequence</var>[<var>s</var> + 2] are equal to 0x72 0x73 0x73
       ("<code>rss</code>"), the <a data-link-type="dfn" href="#computed-mime-type" id="ref-for-computed-mime-type②①">computed MIME type</a> is
       "<code>application/rss+xml</code>". 
         <p>Abort these steps.</p>
        <li>
          If <var>length</var> is greater than or equal to <var>s</var> + 4 and
       the four <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte" id="ref-for-byte⑤⑤">bytes</a> from <var>sequence</var>[<var>s</var>] to <var>sequence</var>[<var>s</var> + 3] are equal to 0x66 0x65 0x65 0x64
       ("<code>feed</code>"), the <a data-link-type="dfn" href="#computed-mime-type" id="ref-for-computed-mime-type②②">computed MIME type</a> is
       "<code>application/atom+xml</code>". 
         <p>Abort these steps.</p>
        <li>
          If <var>length</var> is greater than or equal to <var>s</var> + 7 and
       the seven <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte" id="ref-for-byte⑤⑥">bytes</a> from <var>sequence</var>[<var>s</var>] to <var>sequence</var>[<var>s</var> + 6] are equal to 0x72 0x64 0x66 0x3A
       0x52 0x44 0x46 ("<code>rdf:RDF</code>"), increment <var>s</var> by 7 and enter loop <var>M</var>: 
         <ol>
          <li>
            If <var>sequence</var>[<var>s</var>] is undefined, the <a data-link-type="dfn" href="#computed-mime-type" id="ref-for-computed-mime-type②③">computed
         MIME type</a> is the <a data-link-type="dfn" href="#supplied-mime-type" id="ref-for-supplied-mime-type②⓪">supplied MIME type</a>. 
           <p>Abort these steps.</p>
          <li>
            If <var>length</var> is greater than or equal to <var>s</var> + 24
         and the twenty-four <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte" id="ref-for-byte⑤⑦">bytes</a> from <var>sequence</var>[<var>s</var>] to <var>sequence</var>[<var>s</var> + 23] are equal to 0x68 0x74 0x74
         0x70 0x3A 0x2F 0x2F 0x70 0x75 0x72 0x6C 0x2E 0x6F 0x72 0x67 0x2F 0x72
         0x73 0x73 0x2F 0x31 0x2E 0x30 0x2F
         ("<code>http://purl.org/rss/1.0/</code>"), increment <var>s</var> by 24 and enter loop <var>N</var>: 
           <ol>
            <li>
              If <var>sequence</var>[<var>s</var>] is undefined, the <a data-link-type="dfn" href="#computed-mime-type" id="ref-for-computed-mime-type②④">computed MIME type</a> is the <a data-link-type="dfn" href="#supplied-mime-type" id="ref-for-supplied-mime-type②①">supplied MIME
           type</a>. 
             <p>Abort these steps.</p>
            <li>
              If <var>length</var> is greater than or equal to <var>s</var> + 43
           and the forty-three <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte" id="ref-for-byte⑤⑧">bytes</a> from <var>sequence</var>[<var>s</var>] to <var>sequence</var>[<var>s</var> + 42] are equal to 0x68 0x74 0x74
           0x70 0x3A 0x2F 0x2F 0x77 0x77 0x77 0x2E 0x77 0x33 0x2E 0x6F 0x72
           0x67 0x2F 0x31 0x39 0x39 0x39 0x2F 0x30 0x32 0x2F 0x32 0x32 0x2D
           0x72 0x64 0x66 0x2D 0x73 0x79 0x6E 0x74 0x61 0x78 0x2D 0x6E 0x73
           0x23
           ("<code>http://www.w3.org/1999/02/22-rdf-syntax-ns#</code>"),
           the <a data-link-type="dfn" href="#computed-mime-type" id="ref-for-computed-mime-type②⑤">computed MIME type</a> is
           "<code>application/rss+xml</code>". 
             <p>Abort these steps.</p>
            <li> Increment <var>s</var> by 1. 
           </ol>
          <li>
            If <var>length</var> is greater than or equal to <var>s</var> + 24
         and the twenty-four <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte" id="ref-for-byte⑤⑨">bytes</a> from <var>sequence</var>[<var>s</var>] to <var>sequence</var>[<var>s</var> + 23] are equal to 0x68 0x74 0x74
         0x70 0x3A 0x2F 0x2F 0x77 0x77 0x77 0x2E 0x77 0x33 0x2E 0x6F 0x72 0x67
         0x2F 0x31 0x39 0x39 0x39 0x2F 0x30 0x32 0x2F 0x32 0x32 0x2D 0x72 0x64
         0x66 0x2D 0x73 0x79 0x6E 0x74 0x61 0x78 0x2D 0x6E 0x73 0x23
         ("<code>http://www.w3.org/1999/02/22-rdf-syntax-ns#</code>"),
         increment <var>s</var> by 24 and enter loop <var>N</var>: 
           <ol>
            <li>
              If <var>sequence</var>[<var>s</var>] is undefined, the <a data-link-type="dfn" href="#computed-mime-type" id="ref-for-computed-mime-type②⑥">computed MIME type</a> is the <a data-link-type="dfn" href="#supplied-mime-type" id="ref-for-supplied-mime-type②②">supplied MIME
           type</a>. 
             <p>Abort these steps.</p>
            <li>
              If <var>length</var> is greater than or equal to <var>s</var> + 43
           and the forty-three <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte" id="ref-for-byte⑥⓪">bytes</a> from <var>sequence</var>[<var>s</var>] to <var>sequence</var>[<var>s</var> + 42] are equal to 0x68 0x74 0x74
           0x70 0x3A 0x2F 0x2F 0x70 0x75 0x72 0x6C 0x2E 0x6F 0x72 0x67 0x2F
           0x72 0x73 0x73 0x2F 0x31 0x2E 0x30 0x2F
           ("<code>http://purl.org/rss/1.0/</code>"), the <a data-link-type="dfn" href="#computed-mime-type" id="ref-for-computed-mime-type②⑦">computed
           MIME type</a> is "<code>application/rss+xml</code>". 
             <p>Abort these steps.</p>
            <li> Increment <var>s</var> by 1. 
           </ol>
          <li> Increment <var>s</var> by 1. 
         </ol>
        <li>
          The <a data-link-type="dfn" href="#computed-mime-type" id="ref-for-computed-mime-type②⑧">computed MIME type</a> is the <a data-link-type="dfn" href="#supplied-mime-type" id="ref-for-supplied-mime-type②③">supplied MIME
       type</a>. 
         <p>Abort these steps.</p>
       </ol>
     </ol>
    <li> The <a data-link-type="dfn" href="#computed-mime-type" id="ref-for-computed-mime-type②⑨">computed MIME type</a> is the <a data-link-type="dfn" href="#supplied-mime-type" id="ref-for-supplied-mime-type②④">supplied MIME type</a>. 
   </ol>
   <p class="note" role="note"> It might be more efficient for the user agent to implement the <a data-link-type="dfn" href="#rules-for-distinguishing-if-a-resource-is-a-feed-or-html" id="ref-for-rules-for-distinguishing-if-a-resource-is-a-feed-or-html①">rules
 for distinguishing if a resource is a feed or HTML</a> in parallel with
 its algorithm for detecting the character encoding of an HTML document. </p>
   <h2 class="heading settled" data-level="8" id="context-specific-sniffing"><span class="secno">8. </span><span class="content">Context-specific sniffing</span><a class="self-link" href="#context-specific-sniffing"></a></h2>
   <p class="XXX"> A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="context">context</dfn> is …. </p>
   <p> In certain <a data-link-type="dfn" href="#context" id="ref-for-context">contexts</a>, it is only useful to identify <a data-link-type="dfn" href="#resource" id="ref-for-resource②②">resources</a> that belong to a certain subset of <a data-link-type="dfn" href="#mime-type" id="ref-for-mime-type③⓪">MIME types</a>. </p>
   <p>In such <a data-link-type="dfn" href="#context" id="ref-for-context①">contexts</a>, it is appropriate to use a <a data-link-type="dfn" href="#context-specific-sniffing-algorithm" id="ref-for-context-specific-sniffing-algorithm">context-specific sniffing algorithm</a> in place of the <a data-link-type="dfn" href="#mime-type-sniffing-algorithm" id="ref-for-mime-type-sniffing-algorithm③">MIME
 type sniffing algorithm</a> in order to determine the <a data-link-type="dfn" href="#computed-mime-type" id="ref-for-computed-mime-type③⓪">computed MIME
 type</a> of a <a data-link-type="dfn" href="#resource" id="ref-for-resource②③">resource</a>.</p>
   <p> A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="context-specific-sniffing-algorithm">context-specific sniffing algorithm</dfn> determines the <a data-link-type="dfn" href="#computed-mime-type" id="ref-for-computed-mime-type③①">computed MIME type</a> of a <a data-link-type="dfn" href="#resource" id="ref-for-resource②④">resource</a> only if the <a data-link-type="dfn" href="#resource" id="ref-for-resource②⑤">resource</a> is a <a data-link-type="dfn" href="#mime-type" id="ref-for-mime-type③①">MIME type</a> relevant to a particular <a data-link-type="dfn" href="#context" id="ref-for-context②">context</a>. </p>
   <h3 class="heading settled" data-level="8.1" id="sniffing-in-a-browsing-context"><span class="secno">8.1. </span><span class="content">Sniffing in a browsing context</span><a class="self-link" href="#sniffing-in-a-browsing-context"></a></h3>
   <p class="XXX"> Use the <a data-link-type="dfn" href="#mime-type-sniffing-algorithm" id="ref-for-mime-type-sniffing-algorithm④">MIME type sniffing algorithm</a>. </p>
   <h3 class="heading settled" data-level="8.2" id="sniffing-in-an-image-context"><span class="secno">8.2. </span><span class="content">Sniffing in an image context</span><a class="self-link" href="#sniffing-in-an-image-context"></a></h3>
   <p> To determine the <a data-link-type="dfn" href="#computed-mime-type" id="ref-for-computed-mime-type③②">computed MIME type</a> of a <a data-link-type="dfn" href="#resource" id="ref-for-resource②⑥">resource</a> with an <a data-link-type="dfn" href="#image-mime-type" id="ref-for-image-mime-type③">image MIME type</a>, execute the following <dfn class="dfn-paneled" data-dfn-type="dfn" data-export data-lt="rules for sniffing images specifically" id="rules-for-sniffing-images-specifically">rules for
 sniffing images specifically</dfn>: </p>
   <ol>
    <li>
      If the <a data-link-type="dfn" href="#supplied-mime-type" id="ref-for-supplied-mime-type②⑤">supplied MIME type</a> is an <a data-link-type="dfn" href="#xml-mime-type" id="ref-for-xml-mime-type②">XML MIME type</a>, the <a data-link-type="dfn" href="#computed-mime-type" id="ref-for-computed-mime-type③③">computed MIME type</a> is the <a data-link-type="dfn" href="#supplied-mime-type" id="ref-for-supplied-mime-type②⑥">supplied MIME type</a>. 
     <p>Abort these steps.</p>
    <li> Let <var>image-type-matched</var> be the result of executing the <a data-link-type="dfn" href="#image-type-pattern-matching-algorithm" id="ref-for-image-type-pattern-matching-algorithm②">image type pattern matching algorithm</a> with the <a data-link-type="dfn" href="#resource-header" id="ref-for-resource-header①⑤">resource
   header</a> as the <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte-sequence" id="ref-for-byte-sequence②①">byte sequence</a> to be matched. 
    <li>
      If <var>image-type-matched</var> is not undefined, the <a data-link-type="dfn" href="#computed-mime-type" id="ref-for-computed-mime-type③④">computed MIME
   type</a> is <var>image-type-matched</var>. 
     <p>Abort these steps.</p>
    <li> The <a data-link-type="dfn" href="#computed-mime-type" id="ref-for-computed-mime-type③⑤">computed MIME type</a> is the <a data-link-type="dfn" href="#supplied-mime-type" id="ref-for-supplied-mime-type②⑦">supplied MIME
   type</a>. 
   </ol>
   <h3 class="heading settled" data-level="8.3" id="sniffing-in-an-audio-or-video-context"><span class="secno">8.3. </span><span class="content">Sniffing in an audio or video context</span><a class="self-link" href="#sniffing-in-an-audio-or-video-context"></a></h3>
   <p> To determine the <a data-link-type="dfn" href="#computed-mime-type" id="ref-for-computed-mime-type③⑥">computed MIME type</a> of a <a data-link-type="dfn" href="#resource" id="ref-for-resource②⑦">resource</a> with an <a data-link-type="dfn" href="#audio-or-video-mime-type" id="ref-for-audio-or-video-mime-type③">audio or video MIME type</a>, execute the following <dfn class="dfn-paneled" data-dfn-type="dfn" data-export data-lt="rules for sniffing audio and video specifically" id="rules-for-sniffing-audio-and-video-specifically">rules
 for sniffing audio and video specifically</dfn>: </p>
   <ol>
    <li>
      If the <a data-link-type="dfn" href="#supplied-mime-type" id="ref-for-supplied-mime-type②⑧">supplied MIME type</a> is an <a data-link-type="dfn" href="#xml-mime-type" id="ref-for-xml-mime-type③">XML MIME type</a>, the <a data-link-type="dfn" href="#computed-mime-type" id="ref-for-computed-mime-type③⑦">computed MIME type</a> is the <a data-link-type="dfn" href="#supplied-mime-type" id="ref-for-supplied-mime-type②⑨">supplied MIME type</a>. 
     <p>Abort these steps.</p>
    <li> Let <var>audio-or-video-type-matched</var> be the result of executing the <a data-link-type="dfn" href="#audio-or-video-type-pattern-matching-algorithm" id="ref-for-audio-or-video-type-pattern-matching-algorithm②">audio or video type pattern matching algorithm</a> with the <a data-link-type="dfn" href="#resource-header" id="ref-for-resource-header①⑥">resource header</a> as the <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte-sequence" id="ref-for-byte-sequence②②">byte sequence</a> to be
   matched. 
    <li>
      If <var>audio-or-video-type-matched</var> is not undefined, the <a data-link-type="dfn" href="#computed-mime-type" id="ref-for-computed-mime-type③⑧">computed MIME type</a> is <var>audio-or-video-type-matched</var>. 
     <p>Abort these steps.</p>
    <li> The <a data-link-type="dfn" href="#computed-mime-type" id="ref-for-computed-mime-type③⑨">computed MIME type</a> is the <a data-link-type="dfn" href="#supplied-mime-type" id="ref-for-supplied-mime-type③⓪">supplied MIME
   type</a>. 
   </ol>
   <h3 class="heading settled" data-level="8.4" id="sniffing-in-a-plugin-context"><span class="secno">8.4. </span><span class="content">Sniffing in a plugin context</span><a class="self-link" href="#sniffing-in-a-plugin-context"></a></h3>
   <p> To determine the <a data-link-type="dfn" href="#computed-mime-type" id="ref-for-computed-mime-type④⓪">computed MIME type</a> of a <a data-link-type="dfn" href="#resource" id="ref-for-resource②⑧">resource</a> <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-fetch" id="ref-for-concept-fetch">fetched</a> in a plugin context, execute
 the following <dfn class="dfn-paneled" data-dfn-type="dfn" data-export id="rules-for-sniffing-in-a-plugin-context">rules for sniffing in a plugin context</dfn>: </p>
   <ol>
    <li class="XXX"> If the <a data-link-type="dfn" href="#supplied-mime-type" id="ref-for-supplied-mime-type③①">supplied MIME type</a> is undefined, the <a data-link-type="dfn" href="#computed-mime-type" id="ref-for-computed-mime-type④①">computed
   MIME type</a> is "<code>application/octet-stream</code>". 
    <li> The <a data-link-type="dfn" href="#computed-mime-type" id="ref-for-computed-mime-type④②">computed MIME type</a> is the <a data-link-type="dfn" href="#supplied-mime-type" id="ref-for-supplied-mime-type③②">supplied MIME type</a>. 
   </ol>
   <h3 class="heading settled" data-level="8.5" id="sniffing-in-a-style-context"><span class="secno">8.5. </span><span class="content">Sniffing in a style context</span><a class="self-link" href="#sniffing-in-a-style-context"></a></h3>
   <p> To determine the <a data-link-type="dfn" href="#computed-mime-type" id="ref-for-computed-mime-type④③">computed MIME type</a> of a <a data-link-type="dfn" href="#resource" id="ref-for-resource②⑨">resource</a> <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-fetch" id="ref-for-concept-fetch①">fetched</a> in a style context, execute the
 following <dfn class="dfn-paneled" data-dfn-type="dfn" data-export id="rules-for-sniffing-in-a-style-context">rules for sniffing in a style context</dfn>: </p>
   <ol>
    <li class="XXX"> If the <a data-link-type="dfn" href="#supplied-mime-type" id="ref-for-supplied-mime-type③③">supplied MIME type</a> is undefined, …. 
    <li> The <a data-link-type="dfn" href="#computed-mime-type" id="ref-for-computed-mime-type④④">computed MIME type</a> is the <a data-link-type="dfn" href="#supplied-mime-type" id="ref-for-supplied-mime-type③④">supplied MIME type</a>. 
   </ol>
   <h3 class="heading settled" data-level="8.6" id="sniffing-in-a-script-context"><span class="secno">8.6. </span><span class="content">Sniffing in a script context</span><a class="self-link" href="#sniffing-in-a-script-context"></a></h3>
   <p> To determine the <a data-link-type="dfn" href="#computed-mime-type" id="ref-for-computed-mime-type④⑤">computed MIME type</a> of a <a data-link-type="dfn" href="#resource" id="ref-for-resource③⓪">resource</a> <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-fetch" id="ref-for-concept-fetch②">fetched</a> in a script context, execute
 the following <dfn class="dfn-paneled" data-dfn-type="dfn" data-export id="rules-for-sniffing-in-a-script-context">rules for sniffing in a script context</dfn>: </p>
   <ol>
    <li class="XXX"> If the <a data-link-type="dfn" href="#supplied-mime-type" id="ref-for-supplied-mime-type③⑤">supplied MIME type</a> is undefined, …. 
    <li> The <a data-link-type="dfn" href="#computed-mime-type" id="ref-for-computed-mime-type④⑥">computed MIME type</a> is the <a data-link-type="dfn" href="#supplied-mime-type" id="ref-for-supplied-mime-type③⑥">supplied MIME type</a>. 
   </ol>
   <h3 class="heading settled" data-level="8.7" id="sniffing-in-a-font-context"><span class="secno">8.7. </span><span class="content">Sniffing in a font context</span><a class="self-link" href="#sniffing-in-a-font-context"></a></h3>
   <p> To determine the <a data-link-type="dfn" href="#computed-mime-type" id="ref-for-computed-mime-type④⑦">computed MIME type</a> of a <a data-link-type="dfn" href="#resource" id="ref-for-resource③①">resource</a> with a <a data-link-type="dfn" href="#font-mime-type" id="ref-for-font-mime-type②">font MIME type</a>, execute the following <dfn class="dfn-paneled" data-dfn-type="dfn" data-export data-lt="rules for sniffing fonts specifically" id="rules-for-sniffing-fonts-specifically">rules for sniffing
 fonts specifically</dfn>: </p>
   <ol>
    <li>
      If the <a data-link-type="dfn" href="#supplied-mime-type" id="ref-for-supplied-mime-type③⑦">supplied MIME type</a> is an <a data-link-type="dfn" href="#xml-mime-type" id="ref-for-xml-mime-type④">XML MIME type</a>, the <a data-link-type="dfn" href="#computed-mime-type" id="ref-for-computed-mime-type④⑧">computed MIME type</a> is the <a data-link-type="dfn" href="#supplied-mime-type" id="ref-for-supplied-mime-type③⑧">supplied MIME type</a>. 
     <p>Abort these steps.</p>
    <li> Let <var>font-type-matched</var> be the result of executing the <a data-link-type="dfn" href="#font-type-pattern-matching-algorithm" id="ref-for-font-type-pattern-matching-algorithm">font
   type pattern matching algorithm</a> with the <a data-link-type="dfn" href="#resource-header" id="ref-for-resource-header①⑦">resource
   header</a> as the <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte-sequence" id="ref-for-byte-sequence②③">byte sequence</a> to be matched. 
    <li>
      If <var>font-type-matched</var> is not undefined, the <a data-link-type="dfn" href="#computed-mime-type" id="ref-for-computed-mime-type④⑨">computed MIME
   type</a> is <var>font-type-matched</var>. 
     <p>Abort these steps.</p>
    <li> The <a data-link-type="dfn" href="#computed-mime-type" id="ref-for-computed-mime-type⑤⓪">computed MIME type</a> is the <a data-link-type="dfn" href="#supplied-mime-type" id="ref-for-supplied-mime-type③⑨">supplied MIME
   type</a>. 
   </ol>
   <h3 class="heading settled" data-level="8.8" id="sniffing-in-a-text-track-context"><span class="secno">8.8. </span><span class="content">Sniffing in a text track context</span><a class="self-link" href="#sniffing-in-a-text-track-context"></a></h3>
   <p class="XXX"> The <a data-link-type="dfn" href="#computed-mime-type" id="ref-for-computed-mime-type⑤①">computed MIME type</a> is "<code>text/vtt</code>". </p>
   <h3 class="heading settled" data-level="8.9" id="sniffing-in-a-cache-manifest-context"><span class="secno">8.9. </span><span class="content">Sniffing in a cache manifest context</span><a class="self-link" href="#sniffing-in-a-cache-manifest-context"></a></h3>
   <p class="XXX"> The <a data-link-type="dfn" href="#computed-mime-type" id="ref-for-computed-mime-type⑤②">computed MIME type</a> is
 "<code>text/cache-manifest</code>". </p>
   <h2 class="no-num heading settled" id="acknowledgements"><span class="content">Acknowledgments</span><a class="self-link" href="#acknowledgements"></a></h2>
   <p> Special thanks to Adam Barth and Ian Hickson for maintaining previous
 incarnations of this document. </p>
   <p> Thanks also to
 Alfred Hönes,
 Anne van Kesteren,
 Boris Zbarsky,
 Darien Maillet Valentine,
 David Singer,
 Domenic Denicola,
 Henri Sivonen,
 Jonathan Neal,
 Joshua Cranmer,
 Larry Masinter,
 罗泽轩,
 Mariko Kosaka,
 Mark Pilgrim,
 Paul Adenot,
 Peter Occil,
 Rob Buis,
 Russ Cox,
 Simon Pieters, and
 triple-underscore
 for their invaluable contributions. </p>
   <p>This standard is written by <a href="https://gphemsley.org/">Gordon P. Hemsley</a> (<a href="mailto:me@gphemsley.org">me@gphemsley.org</a>). </p>
   <h2 class="no-num heading settled" id="ipr"><span class="content">Intellectual property rights</span><a class="self-link" href="#ipr"></a></h2>
   <p>Copyright © WHATWG (Apple, Google, Mozilla, Microsoft). This work is licensed under a <a href="https://creativecommons.org/licenses/by/4.0/" rel="license">Creative Commons Attribution 4.0
International License</a>. To the extent portions of it are incorporated into source code, such
portions in the source code are licensed under the <a href="https://opensource.org/licenses/BSD-3-Clause" rel="license">BSD 3-Clause License</a> instead.</p>
   <p>This is the Living Standard. Those
interested in the patent-review version should view the <a href="/review-drafts/2020-01/">Living Standard Review Draft</a>.</p>
  </main>
<script>
"use strict";
if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("/service-worker.js");
}
</script>
  <h2 class="no-num no-ref heading settled" id="index"><span class="content">Index</span><a class="self-link" href="#index"></a></h2>
  <h3 class="no-num no-ref heading settled" id="index-defined-here"><span class="content">Terms defined by this specification</span><a class="self-link" href="#index-defined-here"></a></h3>
  <ul class="index">
   <li><a href="#archive-mime-type">archive MIME type</a><span>, in § 4.6</span>
   <li><a href="#archive-type-pattern-matching-algorithm">archive type pattern matching algorithm</a><span>, in § 6.4</span>
   <li><a href="#audio-or-video-mime-type">audio or video MIME type</a><span>, in § 4.6</span>
   <li><a href="#audio-or-video-type-pattern-matching-algorithm">audio or video type pattern matching algorithm</a><span>, in § 6.2</span>
   <li><a href="#binary-data-byte">binary data byte</a><span>, in § 3</span>
   <li><a href="#byte-pattern">byte pattern</a><span>, in § 6</span>
   <li><a href="#check-for-apache-bug-flag">check-for-apache-bug flag</a><span>, in § 5</span>
   <li><a href="#compute-an-mp3-frame-size">compute an mp3 frame size</a><span>, in § 6.2.3</span>
   <li><a href="#computed-mime-type">computed MIME type</a><span>, in § 5</span>
   <li><a href="#context">context</a><span>, in § 8</span>
   <li><a href="#context-specific-sniffing-algorithm">context-specific sniffing algorithm</a><span>, in § 8</span>
   <li><a href="#mime-type-essence">essence</a><span>, in § 4.2</span>
   <li><a href="#font-mime-type">font MIME type</a><span>, in § 4.6</span>
   <li><a href="#font-type-pattern-matching-algorithm">font type pattern matching algorithm</a><span>, in § 6.3</span>
   <li><a href="#html-mime-type">HTML MIME type</a><span>, in § 4.6</span>
   <li><a href="#http-quoted-string-token-code-point">HTTP quoted-string token code point</a><span>, in § 3</span>
   <li><a href="#http-token-code-point">HTTP token code point</a><span>, in § 3</span>
   <li><a href="#image-mime-type">image MIME type</a><span>, in § 4.6</span>
   <li><a href="#image-type-pattern-matching-algorithm">image type pattern matching algorithm</a><span>, in § 6.1</span>
   <li><a href="#javascript-mime-type">JavaScript MIME type</a><span>, in § 4.6</span>
   <li><a href="#javascript-mime-type-essence-match">JavaScript MIME type essence match</a><span>, in § 4.6</span>
   <li><a href="#json-mime-type">JSON MIME type</a><span>, in § 4.6</span>
   <li><a href="#match-an-mp3-header">match an mp3 header</a><span>, in § 6.2.3</span>
   <li><a href="#matches-the-signature-for-mp3-without-id3">matches the signature for MP3 without ID3</a><span>, in § 6.2.3</span>
   <li><a href="#matches-the-signature-for-mp4">matches the signature for MP4</a><span>, in § 6.2.1</span>
   <li><a href="#matches-the-signature-for-webm">matches the signature for WebM</a><span>, in § 6.2.2</span>
   <li><a href="#matching-a-padded-sequence">Matching a padded sequence</a><span>, in § 6.2.2</span>
   <li><a href="#mime-type">MIME type</a><span>, in § 4.1</span>
   <li><a href="#mime-type">MIME type record</a><span>, in § 4.1</span>
   <li><a href="#mime-type-sniffing-algorithm">MIME type sniffing algorithm</a><span>, in § 7</span>
   <li><a href="#no-sniff-flag">no-sniff flag</a><span>, in § 5</span>
   <li><a href="#parameters">parameters</a><span>, in § 4.1</span>
   <li><a href="#parse-a-mime-type">parse a MIME type</a><span>, in § 4.4</span>
   <li><a href="#parse-a-mime-type-from-bytes">parse a MIME type from bytes</a><span>, in § 4.4</span>
   <li><a href="#parse-an-mp3-frame">parse an mp3 frame</a><span>, in § 6.2.3</span>
   <li><a href="#parse-a-vint">parse a vint</a><span>, in § 6.2.2</span>
   <li><a href="#pattern-mask">pattern mask</a><span>, in § 6</span>
   <li><a href="#pattern-matching-algorithm">pattern matching algorithm</a><span>, in § 6</span>
   <li><a href="#read-the-resource-header">read the resource header</a><span>, in § 5.2</span>
   <li><a href="#resource">resource</a><span>, in § 5</span>
   <li><a href="#resource-header">resource header</a><span>, in § 5.2</span>
   <li><a href="#rules-for-distinguishing-if-a-resource-is-a-feed-or-html">rules for distinguishing if a resource is a feed or HTML</a><span>, in § 7.3</span>
   <li><a href="#rules-for-text-or-binary">rules for distinguishing if a resource is text or binary</a><span>, in § 7.2</span>
   <li><a href="#rules-for-identifying-an-unknown-mime-type">rules for identifying an unknown MIME type</a><span>, in § 7.1</span>
   <li><a href="#rules-for-sniffing-audio-and-video-specifically">rules for sniffing audio and video specifically</a><span>, in § 8.3</span>
   <li><a href="#rules-for-sniffing-fonts-specifically">rules for sniffing fonts specifically</a><span>, in § 8.7</span>
   <li><a href="#rules-for-sniffing-images-specifically">rules for sniffing images specifically</a><span>, in § 8.2</span>
   <li><a href="#rules-for-sniffing-in-a-plugin-context">rules for sniffing in a plugin context</a><span>, in § 8.4</span>
   <li><a href="#rules-for-sniffing-in-a-script-context">rules for sniffing in a script context</a><span>, in § 8.6</span>
   <li><a href="#rules-for-sniffing-in-a-style-context">rules for sniffing in a style context</a><span>, in § 8.5</span>
   <li><a href="#scriptable-mime-type">scriptable MIME type</a><span>, in § 4.6</span>
   <li><a href="#serialize-a-mime-type">serialize a MIME type</a><span>, in § 4.5</span>
   <li><a href="#serialize-a-mime-type-to-bytes">serialize a MIME type to bytes</a><span>, in § 4.5</span>
   <li><a href="#sniff-scriptable-flag">sniff-scriptable flag</a><span>, in § 7.1</span>
   <li><a href="#subtype">subtype</a><span>, in § 4.1</span>
   <li><a href="#supplied-mime-type">supplied MIME type</a><span>, in § 5</span>
   <li><a href="#supplied-mime-type-detection-algorithm">supplied MIME type detection algorithm</a><span>, in § 5.1</span>
   <li><a href="#supported-by-the-user-agent">supported by the user agent</a><span>, in § 4.2</span>
   <li><a href="#tag-terminating-byte">tag-terminating byte</a><span>, in § 3</span>
   <li><a href="#type">type</a><span>, in § 4.1</span>
   <li><a href="#valid-mime-type">valid MIME type string</a><span>, in § 4.3</span>
   <li><a href="#valid-mime-type-with-no-parameters">valid MIME type string with no parameters</a><span>, in § 4.3</span>
   <li><a href="#whitespace-byte">whitespace byte</a><span>, in § 3</span>
   <li><a href="#xml-mime-type">XML MIME type</a><span>, in § 4.6</span>
   <li><a href="#zip-based-mime-type">ZIP-based MIME type</a><span>, in § 4.6</span>
  </ul>
  <h3 class="no-num no-ref heading settled" id="index-defined-elsewhere"><span class="content">Terms defined by reference</span><a class="self-link" href="#index-defined-elsewhere"></a></h3>
  <ul class="index">
   <li>
    <a data-link-type="biblio">[FETCH]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="4456bfd9">collecting an http quoted string</span>
     <li><span class="dfn-paneled" id="a33db89a">fetch</span>
     <li><span class="dfn-paneled" id="5fe4ff5e">http whitespace</span>
    </ul>
   <li>
    <a data-link-type="biblio">[HTML]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="0cf3964f">script</span>
     <li><span class="dfn-paneled" id="ee18ab25">type</span>
    </ul>
   <li>
    <a data-link-type="biblio">[HTTP]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="58a7f8cc">media-type</span>
     <li><span class="dfn-paneled" id="c5610ee2">quoted-string</span>
     <li><span class="dfn-paneled" id="4a4e79bc">token</span>
    </ul>
   <li>
    <a data-link-type="biblio">[INFRA]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="f43d6978">ascii alphanumeric</span>
     <li><span class="dfn-paneled" id="7f9469b5">ascii case-insensitive</span>
     <li><span class="dfn-paneled" id="6f2dfa22">ascii lowercase</span>
     <li><span class="dfn-paneled" id="2d5a2765">ascii string</span>
     <li><span class="dfn-paneled" id="5fb1ed8a">ascii whitespace</span>
     <li><span class="dfn-paneled" id="7b0d918d">break</span>
     <li><span class="dfn-paneled" id="f5354b9d">byte</span>
     <li><span class="dfn-paneled" id="3de9e659">byte sequence</span>
     <li><span class="dfn-paneled" id="915aff5e">code point</span>
     <li><span class="dfn-paneled" id="d24334b4">collect a sequence of code points</span>
     <li><span class="dfn-paneled" id="60184fa5">collecting a sequence of code points</span>
     <li><span class="dfn-paneled" id="ae8def21">contain</span>
     <li><span class="dfn-paneled" id="f937b7b6">continue</span>
     <li><span class="dfn-paneled" id="1243a891">exist</span>
     <li><span class="dfn-paneled" id="45209803">for each</span>
     <li><span class="dfn-paneled" id="d8b963e8">isomorphic decode</span>
     <li><span class="dfn-paneled" id="16b1470a">isomorphic encode</span>
     <li><span class="dfn-paneled" id="31db57e6">keys</span>
     <li><span class="dfn-paneled" id="36333997">length</span>
     <li><span class="dfn-paneled" id="84b454ff">ordered map</span>
     <li><span class="dfn-paneled" id="75bee4d5">position variable</span>
     <li><span class="dfn-paneled" id="15e48c39">set</span>
     <li><span class="dfn-paneled" id="0e6b2056">set <small>(for map)</small></span>
     <li><span class="dfn-paneled" id="50c91fa5">skip ascii whitespace</span>
     <li><span class="dfn-paneled" id="0698d556">string</span>
     <li><span class="dfn-paneled" id="12d6b9a8">values</span>
    </ul>
  </ul>
  <h2 class="no-num no-ref heading settled" id="references"><span class="content">References</span><a class="self-link" href="#references"></a></h2>
  <h3 class="no-num no-ref heading settled" id="normative"><span class="content">Normative References</span><a class="self-link" href="#normative"></a></h3>
  <dl>
   <dt id="biblio-encoding">[ENCODING]
   <dd>Anne van Kesteren. <a href="https://encoding.spec.whatwg.org/"><cite>Encoding Standard</cite></a>. Living Standard. URL: <a href="https://encoding.spec.whatwg.org/">https://encoding.spec.whatwg.org/</a>
   <dt id="biblio-fetch">[FETCH]
   <dd>Anne van Kesteren. <a href="https://fetch.spec.whatwg.org/"><cite>Fetch Standard</cite></a>. Living Standard. URL: <a href="https://fetch.spec.whatwg.org/">https://fetch.spec.whatwg.org/</a>
   <dt id="biblio-ftp">[FTP]
   <dd>J. Postel; J. Reynolds. <a href="https://www.rfc-editor.org/rfc/rfc959"><cite>File Transfer Protocol</cite></a>. October 1985. Internet Standard. URL: <a href="https://www.rfc-editor.org/rfc/rfc959">https://www.rfc-editor.org/rfc/rfc959</a>
   <dt id="biblio-http">[HTTP]
   <dd>R. Fielding, Ed.; M. Nottingham, Ed.; J. Reschke, Ed.. <a href="https://httpwg.org/specs/rfc9112.html"><cite>HTTP/1.1</cite></a>. June 2022. Internet Standard. URL: <a href="https://httpwg.org/specs/rfc9112.html">https://httpwg.org/specs/rfc9112.html</a>
   <dt id="biblio-infra">[INFRA]
   <dd>Anne van Kesteren; Domenic Denicola. <a href="https://infra.spec.whatwg.org/"><cite>Infra Standard</cite></a>. Living Standard. URL: <a href="https://infra.spec.whatwg.org/">https://infra.spec.whatwg.org/</a>
   <dt id="biblio-mimetype">[MIMETYPE]
   <dd>N. Freed; N. Borenstein. <a href="https://www.rfc-editor.org/rfc/rfc2046"><cite>Multipurpose Internet Mail Extensions (MIME) Part Two: Media Types</cite></a>. November 1996. Draft Standard. URL: <a href="https://www.rfc-editor.org/rfc/rfc2046">https://www.rfc-editor.org/rfc/rfc2046</a>
   <dt id="biblio-rfc2119">[RFC2119]
   <dd>S. Bradner. <a href="https://datatracker.ietf.org/doc/html/rfc2119"><cite>Key words for use in RFCs to Indicate Requirement Levels</cite></a>. March 1997. Best Current Practice. URL: <a href="https://datatracker.ietf.org/doc/html/rfc2119">https://datatracker.ietf.org/doc/html/rfc2119</a>
   <dt id="biblio-rfc7231">[RFC7231]
   <dd>R. Fielding, Ed.; M. Nottingham, Ed.; J. Reschke, Ed.. <a href="https://httpwg.org/specs/rfc9110.html"><cite>HTTP Semantics</cite></a>. June 2022. Internet Standard. URL: <a href="https://httpwg.org/specs/rfc9110.html">https://httpwg.org/specs/rfc9110.html</a>
   <dt id="biblio-rfc7303">[RFC7303]
   <dd>H. Thompson; C. Lilley. <a href="https://www.rfc-editor.org/rfc/rfc7303"><cite>XML Media Types</cite></a>. July 2014. Proposed Standard. URL: <a href="https://www.rfc-editor.org/rfc/rfc7303">https://www.rfc-editor.org/rfc/rfc7303</a>
   <dt id="biblio-rfc8081">[RFC8081]
   <dd>C. Lilley. <a href="https://www.rfc-editor.org/rfc/rfc8081"><cite>The "font" Top-Level Media Type</cite></a>. February 2017. Proposed Standard. URL: <a href="https://www.rfc-editor.org/rfc/rfc8081">https://www.rfc-editor.org/rfc/rfc8081</a>
   <dt id="biblio-seccontsniff">[SECCONTSNIFF]
   <dd>Adam Barth; Juan Caballero; Dawn Song. <a href="https://www.adambarth.com/papers/2009/barth-caballero-song.pdf"><cite>Secure Content Sniffing for Web Browsers, or How to Stop Papers from Reviewing Themselves</cite></a>. URL: <a href="https://www.adambarth.com/papers/2009/barth-caballero-song.pdf">https://www.adambarth.com/papers/2009/barth-caballero-song.pdf</a>
  </dl>
  <h3 class="no-num no-ref heading settled" id="informative"><span class="content">Informative References</span><a class="self-link" href="#informative"></a></h3>
  <dl>
   <dt id="biblio-html">[HTML]
   <dd>Anne van Kesteren; et al. <a href="https://html.spec.whatwg.org/multipage/"><cite>HTML Standard</cite></a>. Living Standard. URL: <a href="https://html.spec.whatwg.org/multipage/">https://html.spec.whatwg.org/multipage/</a>
   <dt id="biblio-mediaqueries">[MEDIAQUERIES]
   <dd>Florian Rivoal; Tab Atkins Jr.. <a href="https://drafts.csswg.org/mediaqueries-4/"><cite>Media Queries Level 4</cite></a>. URL: <a href="https://drafts.csswg.org/mediaqueries-4/">https://drafts.csswg.org/mediaqueries-4/</a>
  </dl>
<script>/* Boilerplate: script-dom-helper */
"use strict";
function query(sel) { return document.querySelector(sel); }

function queryAll(sel) { return [...document.querySelectorAll(sel)]; }

function iter(obj) {
	if(!obj) return [];
	var it = obj[Symbol.iterator];
	if(it) return it;
	return Object.entries(obj);
}

function mk(tagname, attrs, ...children) {
	const el = document.createElement(tagname);
	for(const [k,v] of iter(attrs)) {
		if(k.slice(0,3) == "_on") {
			const eventName = k.slice(3);
			el.addEventListener(eventName, v);
		} else if(k[0] == "_") {
			// property, not attribute
			el[k.slice(1)] = v;
		} else {
			if(v === false || v == null) {
        continue;
      } else if(v === true) {
        el.setAttribute(k, "");
        continue;
      } else {
  			el.setAttribute(k, v);
      }
		}
	}
	append(el, children);
	return el;
}

/* Create shortcuts for every known HTML element */
[
  "a",
  "abbr",
  "acronym",
  "address",
  "applet",
  "area",
  "article",
  "aside",
  "audio",
  "b",
  "base",
  "basefont",
  "bdo",
  "big",
  "blockquote",
  "body",
  "br",
  "button",
  "canvas",
  "caption",
  "center",
  "cite",
  "code",
  "col",
  "colgroup",
  "datalist",
  "dd",
  "del",
  "details",
  "dfn",
  "dialog",
  "div",
  "dl",
  "dt",
  "em",
  "embed",
  "fieldset",
  "figcaption",
  "figure",
  "font",
  "footer",
  "form",
  "frame",
  "frameset",
  "head",
  "header",
  "h1",
  "h2",
  "h3",
  "h4",
  "h5",
  "h6",
  "hr",
  "html",
  "i",
  "iframe",
  "img",
  "input",
  "ins",
  "kbd",
  "label",
  "legend",
  "li",
  "link",
  "main",
  "map",
  "mark",
  "meta",
  "meter",
  "nav",
  "nobr",
  "noscript",
  "object",
  "ol",
  "optgroup",
  "option",
  "output",
  "p",
  "param",
  "pre",
  "progress",
  "q",
  "s",
  "samp",
  "script",
  "section",
  "select",
  "small",
  "source",
  "span",
  "strike",
  "strong",
  "style",
  "sub",
  "summary",
  "sup",
  "table",
  "tbody",
  "td",
  "template",
  "textarea",
  "tfoot",
  "th",
  "thead",
  "time",
  "title",
  "tr",
  "u",
  "ul",
  "var",
  "video",
  "wbr",
  "xmp",
].forEach(tagname=>{
	mk[tagname] = (...args) => mk(tagname, ...args);
});

function* nodesFromChildList(children) {
	for(const child of children.flat(Infinity)) {
		if(child instanceof Node) {
			yield child;
		} else {
			yield new Text(child);
		}
	}
}
function append(el, ...children) {
	for(const child of nodesFromChildList(children)) {
		if(el instanceof Node) el.appendChild(child);
		else el.push(child);
	}
	return el;
}

function insertAfter(el, ...children) {
	for(const child of nodesFromChildList(children)) {
		el.parentNode.insertBefore(child, el.nextSibling);
	}
	return el;
}

function clearContents(el) {
	el.innerHTML = "";
	return el;
}

function parseHTML(markup) {
	if(markup.toLowerCase().trim().indexOf('<!doctype') === 0) {
		const doc = document.implementation.createHTMLDocument("");
		doc.documentElement.innerHTML = markup;
		return doc;
	} else {
		const el = mk.template({});
		el.innerHTML = markup;
		return el.content;
	}
}</script>
<script>/* Boilerplate: script-dfn-panel */
"use strict";
{
let dfnPanelData = {
"0698d556": {"dfnID":"0698d556","dfnText":"string","external":true,"refSections":[{"refs":[{"id":"ref-for-string"}],"title":"4.6. MIME type groups"}],"url":"https://infra.spec.whatwg.org/#string"},
"0cf3964f": {"dfnID":"0cf3964f","dfnText":"script","external":true,"refSections":[{"refs":[{"id":"ref-for-script"}],"title":"4.6. MIME type groups"}],"url":"https://html.spec.whatwg.org/multipage/scripting.html#script"},
"0e6b2056": {"dfnID":"0e6b2056","dfnText":"set (for map)","external":true,"refSections":[{"refs":[{"id":"ref-for-map-set"}],"title":"4.4. Parsing a MIME type"}],"url":"https://infra.spec.whatwg.org/#map-set"},
"1243a891": {"dfnID":"1243a891","dfnText":"exist","external":true,"refSections":[{"refs":[{"id":"ref-for-map-exists"}],"title":"4.4. Parsing a MIME type"}],"url":"https://infra.spec.whatwg.org/#map-exists"},
"12d6b9a8": {"dfnID":"12d6b9a8","dfnText":"values","external":true,"refSections":[{"refs":[{"id":"ref-for-map-getting-the-values"}],"title":"4.1. MIME type representation"}],"url":"https://infra.spec.whatwg.org/#map-getting-the-values"},
"15e48c39": {"dfnID":"15e48c39","dfnText":"set","external":true,"refSections":[{"refs":[{"id":"ref-for-ordered-set"}],"title":"6. Matching a MIME type pattern"}],"url":"https://infra.spec.whatwg.org/#ordered-set"},
"16b1470a": {"dfnID":"16b1470a","dfnText":"isomorphic encode","external":true,"refSections":[{"refs":[{"id":"ref-for-isomorphic-encode"}],"title":"4.5. Serializing a MIME type"}],"url":"https://infra.spec.whatwg.org/#isomorphic-encode"},
"2d5a2765": {"dfnID":"2d5a2765","dfnText":"ascii string","external":true,"refSections":[{"refs":[{"id":"ref-for-ascii-string"},{"id":"ref-for-ascii-string\u2460"},{"id":"ref-for-ascii-string\u2461"}],"title":"4.1. MIME type representation"}],"url":"https://infra.spec.whatwg.org/#ascii-string"},
"31db57e6": {"dfnID":"31db57e6","dfnText":"keys","external":true,"refSections":[{"refs":[{"id":"ref-for-map-getting-the-keys"}],"title":"4.1. MIME type representation"}],"url":"https://infra.spec.whatwg.org/#map-getting-the-keys"},
"36333997": {"dfnID":"36333997","dfnText":"length","external":true,"refSections":[{"refs":[{"id":"ref-for-byte-sequence-length"},{"id":"ref-for-byte-sequence-length\u2460"},{"id":"ref-for-byte-sequence-length\u2461"},{"id":"ref-for-byte-sequence-length\u2462"},{"id":"ref-for-byte-sequence-length\u2463"},{"id":"ref-for-byte-sequence-length\u2464"}],"title":"6. Matching a MIME type pattern"}],"url":"https://infra.spec.whatwg.org/#byte-sequence-length"},
"3de9e659": {"dfnID":"3de9e659","dfnText":"byte sequence","external":true,"refSections":[{"refs":[{"id":"ref-for-byte-sequence"}],"title":"4.4. Parsing a MIME type"},{"refs":[{"id":"ref-for-byte-sequence\u2460"},{"id":"ref-for-byte-sequence\u2461"}],"title":"5.2. Reading the resource header"},{"refs":[{"id":"ref-for-byte-sequence\u2462"},{"id":"ref-for-byte-sequence\u2463"},{"id":"ref-for-byte-sequence\u2464"},{"id":"ref-for-byte-sequence\u2465"}],"title":"6. Matching a MIME type pattern"},{"refs":[{"id":"ref-for-byte-sequence\u2466"}],"title":"6.1. Matching an image type pattern"},{"refs":[{"id":"ref-for-byte-sequence\u2467"}],"title":"6.2. Matching an audio or video type pattern"},{"refs":[{"id":"ref-for-byte-sequence\u2468"},{"id":"ref-for-byte-sequence\u2460\u24ea"}],"title":"6.2.1. Signature for MP4"},{"refs":[{"id":"ref-for-byte-sequence\u2460\u2460"},{"id":"ref-for-byte-sequence\u2460\u2461"},{"id":"ref-for-byte-sequence\u2460\u2462"}],"title":"6.2.2. Signature for WebM"},{"refs":[{"id":"ref-for-byte-sequence\u2460\u2463"},{"id":"ref-for-byte-sequence\u2460\u2464"},{"id":"ref-for-byte-sequence\u2460\u2465"}],"title":"6.2.3. Signature for MP3 without ID3"},{"refs":[{"id":"ref-for-byte-sequence\u2460\u2466"}],"title":"6.3. Matching a font type pattern"},{"refs":[{"id":"ref-for-byte-sequence\u2460\u2467"}],"title":"6.4. Matching an archive type pattern"},{"refs":[{"id":"ref-for-byte-sequence\u2460\u2468"},{"id":"ref-for-byte-sequence\u2461\u24ea"}],"title":"7. Determining the computed MIME type of a resource"},{"refs":[{"id":"ref-for-byte-sequence\u2461\u2460"}],"title":"8.2. Sniffing in an image context"},{"refs":[{"id":"ref-for-byte-sequence\u2461\u2461"}],"title":"8.3. Sniffing in an audio or video context"},{"refs":[{"id":"ref-for-byte-sequence\u2461\u2462"}],"title":"8.7. Sniffing in a font context"}],"url":"https://infra.spec.whatwg.org/#byte-sequence"},
"4456bfd9": {"dfnID":"4456bfd9","dfnText":"collecting an http quoted string","external":true,"refSections":[{"refs":[{"id":"ref-for-collect-an-http-quoted-string"}],"title":"4.4. Parsing a MIME type"}],"url":"https://fetch.spec.whatwg.org/#collect-an-http-quoted-string"},
"45209803": {"dfnID":"45209803","dfnText":"for each","external":true,"refSections":[{"refs":[{"id":"ref-for-map-iterate"}],"title":"4.5. Serializing a MIME type"}],"url":"https://infra.spec.whatwg.org/#map-iterate"},
"4a4e79bc": {"dfnID":"4a4e79bc","dfnText":"token","external":true,"refSections":[{"refs":[{"id":"ref-for-section-3.2.6"},{"id":"ref-for-section-3.2.6\u2460"}],"title":"3. Terminology"}],"url":"https://tools.ietf.org/html/rfc7230#section-3.2.6"},
"50c91fa5": {"dfnID":"50c91fa5","dfnText":"skip ascii whitespace","external":true,"refSections":[{"refs":[{"id":"ref-for-skip-ascii-whitespace"}],"title":"4.4. Parsing a MIME type"}],"url":"https://infra.spec.whatwg.org/#skip-ascii-whitespace"},
"58a7f8cc": {"dfnID":"58a7f8cc","dfnText":"media-type","external":true,"refSections":[{"refs":[{"id":"ref-for-section-3.1.1.1"}],"title":"4.3. MIME type writing"}],"url":"https://tools.ietf.org/html/rfc7231#section-3.1.1.1"},
"5fb1ed8a": {"dfnID":"5fb1ed8a","dfnText":"ascii whitespace","external":true,"refSections":[{"refs":[{"id":"ref-for-ascii-whitespace"}],"title":"4.4. Parsing a MIME type"}],"url":"https://infra.spec.whatwg.org/#ascii-whitespace"},
"5fe4ff5e": {"dfnID":"5fe4ff5e","dfnText":"http whitespace","external":true,"refSections":[{"refs":[{"id":"ref-for-http-whitespace"},{"id":"ref-for-http-whitespace\u2460"},{"id":"ref-for-http-whitespace\u2461"},{"id":"ref-for-http-whitespace\u2462"},{"id":"ref-for-http-whitespace\u2463"}],"title":"4.4. Parsing a MIME type"}],"url":"https://fetch.spec.whatwg.org/#http-whitespace"},
"60184fa5": {"dfnID":"60184fa5","dfnText":"collecting a sequence of code points","external":true,"refSections":[{"refs":[{"id":"ref-for-collect-a-sequence-of-code-points"},{"id":"ref-for-collect-a-sequence-of-code-points\u2460"},{"id":"ref-for-collect-a-sequence-of-code-points\u2461"},{"id":"ref-for-collect-a-sequence-of-code-points\u2462"},{"id":"ref-for-collect-a-sequence-of-code-points\u2463"},{"id":"ref-for-collect-a-sequence-of-code-points\u2464"}],"title":"4.4. Parsing a MIME type"}],"url":"https://infra.spec.whatwg.org/#collect-a-sequence-of-code-points"},
"6f2dfa22": {"dfnID":"6f2dfa22","dfnText":"ascii lowercase","external":true,"refSections":[{"refs":[{"id":"ref-for-ascii-lowercase"},{"id":"ref-for-ascii-lowercase\u2460"},{"id":"ref-for-ascii-lowercase\u2461"}],"title":"4.4. Parsing a MIME type"}],"url":"https://infra.spec.whatwg.org/#ascii-lowercase"},
"75bee4d5": {"dfnID":"75bee4d5","dfnText":"position variable","external":true,"refSections":[{"refs":[{"id":"ref-for-string-position-variable"}],"title":"4.4. Parsing a MIME type"}],"url":"https://infra.spec.whatwg.org/#string-position-variable"},
"7b0d918d": {"dfnID":"7b0d918d","dfnText":"break","external":true,"refSections":[{"refs":[{"id":"ref-for-iteration-break"}],"title":"4.4. Parsing a MIME type"},{"refs":[{"id":"ref-for-iteration-break\u2460"}],"title":"6. Matching a MIME type pattern"}],"url":"https://infra.spec.whatwg.org/#iteration-break"},
"7f9469b5": {"dfnID":"7f9469b5","dfnText":"ascii case-insensitive","external":true,"refSections":[{"refs":[{"id":"ref-for-ascii-case-insensitive"}],"title":"4.6. MIME type groups"}],"url":"https://infra.spec.whatwg.org/#ascii-case-insensitive"},
"84b454ff": {"dfnID":"84b454ff","dfnText":"ordered map","external":true,"refSections":[{"refs":[{"id":"ref-for-ordered-map"}],"title":"4.1. MIME type representation"}],"url":"https://infra.spec.whatwg.org/#ordered-map"},
"915aff5e": {"dfnID":"915aff5e","dfnText":"code point","external":true,"refSections":[{"refs":[{"id":"ref-for-code-point"},{"id":"ref-for-code-point\u2460"}],"title":"3. Terminology"},{"refs":[{"id":"ref-for-code-point\u2461"},{"id":"ref-for-code-point\u2462"}],"title":"4.4. Parsing a MIME type"}],"url":"https://infra.spec.whatwg.org/#code-point"},
"a33db89a": {"dfnID":"a33db89a","dfnText":"fetch","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-fetch"}],"title":"8.4. Sniffing in a plugin context"},{"refs":[{"id":"ref-for-concept-fetch\u2460"}],"title":"8.5. Sniffing in a style context"},{"refs":[{"id":"ref-for-concept-fetch\u2461"}],"title":"8.6. Sniffing in a script context"}],"url":"https://fetch.spec.whatwg.org/#concept-fetch"},
"ae8def21": {"dfnID":"ae8def21","dfnText":"contain","external":true,"refSections":[{"refs":[{"id":"ref-for-list-contain"}],"title":"6. Matching a MIME type pattern"}],"url":"https://infra.spec.whatwg.org/#list-contain"},
"archive-mime-type": {"dfnID":"archive-mime-type","dfnText":"archive MIME type","external":false,"refSections":[{"refs":[{"id":"ref-for-archive-mime-type"},{"id":"ref-for-archive-mime-type\u2460"}],"title":"6.4. Matching an archive type pattern"}],"url":"#archive-mime-type"},
"archive-type-pattern-matching-algorithm": {"dfnID":"archive-type-pattern-matching-algorithm","dfnText":"archive type pattern matching\nalgorithm","external":false,"refSections":[{"refs":[{"id":"ref-for-archive-type-pattern-matching-algorithm"}],"title":"7.1. Identifying a resource with an unknown MIME type"}],"url":"#archive-type-pattern-matching-algorithm"},
"audio-or-video-mime-type": {"dfnID":"audio-or-video-mime-type","dfnText":"audio or video MIME type","external":false,"refSections":[{"refs":[{"id":"ref-for-audio-or-video-mime-type"},{"id":"ref-for-audio-or-video-mime-type\u2460"}],"title":"6.2. Matching an audio or video type pattern"},{"refs":[{"id":"ref-for-audio-or-video-mime-type\u2461"}],"title":"7. Determining the computed MIME type of a resource"},{"refs":[{"id":"ref-for-audio-or-video-mime-type\u2462"}],"title":"8.3. Sniffing in an audio or video context"}],"url":"#audio-or-video-mime-type"},
"audio-or-video-type-pattern-matching-algorithm": {"dfnID":"audio-or-video-type-pattern-matching-algorithm","dfnText":"audio or video type pattern matching\nalgorithm","external":false,"refSections":[{"refs":[{"id":"ref-for-audio-or-video-type-pattern-matching-algorithm"}],"title":"7. Determining the computed MIME type of a resource"},{"refs":[{"id":"ref-for-audio-or-video-type-pattern-matching-algorithm\u2460"}],"title":"7.1. Identifying a resource with an unknown MIME type"},{"refs":[{"id":"ref-for-audio-or-video-type-pattern-matching-algorithm\u2461"}],"title":"8.3. Sniffing in an audio or video context"}],"url":"#audio-or-video-type-pattern-matching-algorithm"},
"binary-data-byte": {"dfnID":"binary-data-byte","dfnText":"binary data byte","external":false,"refSections":[{"refs":[{"id":"ref-for-binary-data-byte"}],"title":"7.1. Identifying a resource with an unknown MIME type"},{"refs":[{"id":"ref-for-binary-data-byte\u2460"}],"title":"7.2. Sniffing a mislabeled binary resource"}],"url":"#binary-data-byte"},
"byte-pattern": {"dfnID":"byte-pattern","dfnText":"byte pattern","external":false,"refSections":[{"refs":[{"id":"ref-for-byte-pattern"},{"id":"ref-for-byte-pattern\u2460"},{"id":"ref-for-byte-pattern\u2461"}],"title":"6. Matching a MIME type pattern"},{"refs":[{"id":"ref-for-byte-pattern\u2462"},{"id":"ref-for-byte-pattern\u2463"}],"title":"6.1. Matching an image type pattern"},{"refs":[{"id":"ref-for-byte-pattern\u2464"},{"id":"ref-for-byte-pattern\u2465"}],"title":"6.2. Matching an audio or video type pattern"},{"refs":[{"id":"ref-for-byte-pattern\u2466"},{"id":"ref-for-byte-pattern\u2467"}],"title":"6.3. Matching a font type pattern"},{"refs":[{"id":"ref-for-byte-pattern\u2468"},{"id":"ref-for-byte-pattern\u2460\u24ea"}],"title":"6.4. Matching an archive type pattern"},{"refs":[{"id":"ref-for-byte-pattern\u2460\u2460"},{"id":"ref-for-byte-pattern\u2460\u2461"},{"id":"ref-for-byte-pattern\u2460\u2462"}],"title":"7.1. Identifying a resource with an unknown MIME type"}],"url":"#byte-pattern"},
"c5610ee2": {"dfnID":"c5610ee2","dfnText":"quoted-string","external":true,"refSections":[{"refs":[{"id":"ref-for-section-3.2.6"},{"id":"ref-for-section-3.2.6\u2460"}],"title":"3. Terminology"}],"url":"https://tools.ietf.org/html/rfc7230#section-3.2.6"},
"check-for-apache-bug-flag": {"dfnID":"check-for-apache-bug-flag","dfnText":"check-for-apache-bug flag","external":false,"refSections":[{"refs":[{"id":"ref-for-check-for-apache-bug-flag"}],"title":"5.1. Interpreting the resource metadata"},{"refs":[{"id":"ref-for-check-for-apache-bug-flag\u2460"}],"title":"7. Determining the computed MIME type of a resource"}],"url":"#check-for-apache-bug-flag"},
"compute-an-mp3-frame-size": {"dfnID":"compute-an-mp3-frame-size","dfnText":"compute an mp3 frame size","external":false,"refSections":[{"refs":[{"id":"ref-for-compute-an-mp3-frame-size"}],"title":"6.2.3. Signature for MP3 without ID3"}],"url":"#compute-an-mp3-frame-size"},
"computed-mime-type": {"dfnID":"computed-mime-type","dfnText":"computed MIME type","external":false,"refSections":[{"refs":[{"id":"ref-for-computed-mime-type"},{"id":"ref-for-computed-mime-type\u2460"},{"id":"ref-for-computed-mime-type\u2461"},{"id":"ref-for-computed-mime-type\u2462"},{"id":"ref-for-computed-mime-type\u2463"},{"id":"ref-for-computed-mime-type\u2464"}],"title":"7. Determining the computed MIME type of a resource"},{"refs":[{"id":"ref-for-computed-mime-type\u2465"},{"id":"ref-for-computed-mime-type\u2466"},{"id":"ref-for-computed-mime-type\u2467"},{"id":"ref-for-computed-mime-type\u2468"}],"title":"7.1. Identifying a resource with an unknown MIME type"},{"refs":[{"id":"ref-for-computed-mime-type\u2460\u24ea"},{"id":"ref-for-computed-mime-type\u2460\u2460"},{"id":"ref-for-computed-mime-type\u2460\u2461"},{"id":"ref-for-computed-mime-type\u2460\u2462"},{"id":"ref-for-computed-mime-type\u2460\u2463"}],"title":"7.2. Sniffing a mislabeled binary resource"},{"refs":[{"id":"ref-for-computed-mime-type\u2460\u2464"},{"id":"ref-for-computed-mime-type\u2460\u2465"},{"id":"ref-for-computed-mime-type\u2460\u2466"},{"id":"ref-for-computed-mime-type\u2460\u2467"},{"id":"ref-for-computed-mime-type\u2460\u2468"},{"id":"ref-for-computed-mime-type\u2461\u24ea"},{"id":"ref-for-computed-mime-type\u2461\u2460"},{"id":"ref-for-computed-mime-type\u2461\u2461"},{"id":"ref-for-computed-mime-type\u2461\u2462"},{"id":"ref-for-computed-mime-type\u2461\u2463"},{"id":"ref-for-computed-mime-type\u2461\u2464"},{"id":"ref-for-computed-mime-type\u2461\u2465"},{"id":"ref-for-computed-mime-type\u2461\u2466"},{"id":"ref-for-computed-mime-type\u2461\u2467"},{"id":"ref-for-computed-mime-type\u2461\u2468"}],"title":"7.3. Sniffing a mislabeled feed"},{"refs":[{"id":"ref-for-computed-mime-type\u2462\u24ea"},{"id":"ref-for-computed-mime-type\u2462\u2460"}],"title":"8. Context-specific sniffing"},{"refs":[{"id":"ref-for-computed-mime-type\u2462\u2461"},{"id":"ref-for-computed-mime-type\u2462\u2462"},{"id":"ref-for-computed-mime-type\u2462\u2463"},{"id":"ref-for-computed-mime-type\u2462\u2464"}],"title":"8.2. Sniffing in an image context"},{"refs":[{"id":"ref-for-computed-mime-type\u2462\u2465"},{"id":"ref-for-computed-mime-type\u2462\u2466"},{"id":"ref-for-computed-mime-type\u2462\u2467"},{"id":"ref-for-computed-mime-type\u2462\u2468"}],"title":"8.3. Sniffing in an audio or video context"},{"refs":[{"id":"ref-for-computed-mime-type\u2463\u24ea"},{"id":"ref-for-computed-mime-type\u2463\u2460"},{"id":"ref-for-computed-mime-type\u2463\u2461"}],"title":"8.4. Sniffing in a plugin context"},{"refs":[{"id":"ref-for-computed-mime-type\u2463\u2462"},{"id":"ref-for-computed-mime-type\u2463\u2463"}],"title":"8.5. Sniffing in a style context"},{"refs":[{"id":"ref-for-computed-mime-type\u2463\u2464"},{"id":"ref-for-computed-mime-type\u2463\u2465"}],"title":"8.6. Sniffing in a script context"},{"refs":[{"id":"ref-for-computed-mime-type\u2463\u2466"},{"id":"ref-for-computed-mime-type\u2463\u2467"},{"id":"ref-for-computed-mime-type\u2463\u2468"},{"id":"ref-for-computed-mime-type\u2464\u24ea"}],"title":"8.7. Sniffing in a font context"},{"refs":[{"id":"ref-for-computed-mime-type\u2464\u2460"}],"title":"8.8. Sniffing in a text track context"},{"refs":[{"id":"ref-for-computed-mime-type\u2464\u2461"}],"title":"8.9. Sniffing in a cache manifest context"}],"url":"#computed-mime-type"},
"context": {"dfnID":"context","dfnText":"context","external":false,"refSections":[{"refs":[{"id":"ref-for-context"},{"id":"ref-for-context\u2460"},{"id":"ref-for-context\u2461"}],"title":"8. Context-specific sniffing"}],"url":"#context"},
"context-specific-sniffing-algorithm": {"dfnID":"context-specific-sniffing-algorithm","dfnText":"context-specific sniffing algorithm","external":false,"refSections":[{"refs":[{"id":"ref-for-context-specific-sniffing-algorithm"}],"title":"8. Context-specific sniffing"}],"url":"#context-specific-sniffing-algorithm"},
"d24334b4": {"dfnID":"d24334b4","dfnText":"collect a sequence of code points","external":true,"refSections":[{"refs":[{"id":"ref-for-collect-a-sequence-of-code-points"},{"id":"ref-for-collect-a-sequence-of-code-points\u2460"},{"id":"ref-for-collect-a-sequence-of-code-points\u2461"},{"id":"ref-for-collect-a-sequence-of-code-points\u2462"},{"id":"ref-for-collect-a-sequence-of-code-points\u2463"},{"id":"ref-for-collect-a-sequence-of-code-points\u2464"}],"title":"4.4. Parsing a MIME type"}],"url":"https://infra.spec.whatwg.org/#collect-a-sequence-of-code-points"},
"d8b963e8": {"dfnID":"d8b963e8","dfnText":"isomorphic decode","external":true,"refSections":[{"refs":[{"id":"ref-for-isomorphic-decode"}],"title":"4.4. Parsing a MIME type"}],"url":"https://infra.spec.whatwg.org/#isomorphic-decode"},
"ee18ab25": {"dfnID":"ee18ab25","dfnText":"type","external":true,"refSections":[{"refs":[{"id":"ref-for-attr-script-type"}],"title":"4.6. MIME type groups"}],"url":"https://html.spec.whatwg.org/multipage/scripting.html#attr-script-type"},
"f43d6978": {"dfnID":"f43d6978","dfnText":"ascii alphanumeric","external":true,"refSections":[{"refs":[{"id":"ref-for-ascii-alphanumeric"}],"title":"3. Terminology"}],"url":"https://infra.spec.whatwg.org/#ascii-alphanumeric"},
"f5354b9d": {"dfnID":"f5354b9d","dfnText":"byte","external":true,"refSections":[{"refs":[{"id":"ref-for-byte"},{"id":"ref-for-byte\u2460"},{"id":"ref-for-byte\u2461"},{"id":"ref-for-byte\u2462"},{"id":"ref-for-byte\u2463"},{"id":"ref-for-byte\u2464"}],"title":"3. Terminology"},{"refs":[{"id":"ref-for-byte\u2465"}],"title":"5.1. Interpreting the resource metadata"},{"refs":[{"id":"ref-for-byte\u2466"},{"id":"ref-for-byte\u2467"},{"id":"ref-for-byte\u2468"},{"id":"ref-for-byte\u2460\u24ea"}],"title":"5.2. Reading the resource header"},{"refs":[{"id":"ref-for-byte\u2460\u2460"},{"id":"ref-for-byte\u2460\u2461"},{"id":"ref-for-byte\u2460\u2462"},{"id":"ref-for-byte\u2460\u2463"},{"id":"ref-for-byte\u2460\u2464"}],"title":"6. Matching a MIME type pattern"},{"refs":[{"id":"ref-for-byte\u2460\u2465"},{"id":"ref-for-byte\u2460\u2466"},{"id":"ref-for-byte\u2460\u2467"},{"id":"ref-for-byte\u2460\u2468"}],"title":"6.1. Matching an image type pattern"},{"refs":[{"id":"ref-for-byte\u2461\u24ea"},{"id":"ref-for-byte\u2461\u2460"},{"id":"ref-for-byte\u2461\u2461"},{"id":"ref-for-byte\u2461\u2462"},{"id":"ref-for-byte\u2461\u2463"}],"title":"6.2. Matching an audio or video type pattern"},{"refs":[{"id":"ref-for-byte\u2461\u2464"},{"id":"ref-for-byte\u2461\u2465"},{"id":"ref-for-byte\u2461\u2466"},{"id":"ref-for-byte\u2461\u2467"},{"id":"ref-for-byte\u2461\u2468"},{"id":"ref-for-byte\u2462\u24ea"},{"id":"ref-for-byte\u2462\u2460"},{"id":"ref-for-byte\u2462\u2461"}],"title":"6.2.1. Signature for MP4"},{"refs":[{"id":"ref-for-byte\u2462\u2462"},{"id":"ref-for-byte\u2462\u2463"},{"id":"ref-for-byte\u2462\u2464"},{"id":"ref-for-byte\u2462\u2465"}],"title":"6.2.2. Signature for WebM"},{"refs":[{"id":"ref-for-byte\u2462\u2466"},{"id":"ref-for-byte\u2462\u2467"},{"id":"ref-for-byte\u2462\u2468"}],"title":"6.2.3. Signature for MP3 without ID3"},{"refs":[{"id":"ref-for-byte\u2463\u24ea"},{"id":"ref-for-byte\u2463\u2460"},{"id":"ref-for-byte\u2463\u2461"}],"title":"6.3. Matching a font type pattern"},{"refs":[{"id":"ref-for-byte\u2463\u2462"}],"title":"6.4. Matching an archive type pattern"},{"refs":[{"id":"ref-for-byte\u2463\u2463"},{"id":"ref-for-byte\u2463\u2464"}],"title":"7.1. Identifying a resource with an unknown MIME type"},{"refs":[{"id":"ref-for-byte\u2463\u2465"}],"title":"7.2. Sniffing a mislabeled binary resource"},{"refs":[{"id":"ref-for-byte\u2463\u2466"},{"id":"ref-for-byte\u2463\u2467"},{"id":"ref-for-byte\u2463\u2468"},{"id":"ref-for-byte\u2464\u24ea"},{"id":"ref-for-byte\u2464\u2460"},{"id":"ref-for-byte\u2464\u2461"},{"id":"ref-for-byte\u2464\u2462"},{"id":"ref-for-byte\u2464\u2463"},{"id":"ref-for-byte\u2464\u2464"},{"id":"ref-for-byte\u2464\u2465"},{"id":"ref-for-byte\u2464\u2466"},{"id":"ref-for-byte\u2464\u2467"},{"id":"ref-for-byte\u2464\u2468"},{"id":"ref-for-byte\u2465\u24ea"}],"title":"7.3. Sniffing a mislabeled feed"}],"url":"https://infra.spec.whatwg.org/#byte"},
"f937b7b6": {"dfnID":"f937b7b6","dfnText":"continue","external":true,"refSections":[{"refs":[{"id":"ref-for-iteration-continue"},{"id":"ref-for-iteration-continue\u2460"}],"title":"4.4. Parsing a MIME type"}],"url":"https://infra.spec.whatwg.org/#iteration-continue"},
"font-mime-type": {"dfnID":"font-mime-type","dfnText":"font MIME type","external":false,"refSections":[{"refs":[{"id":"ref-for-font-mime-type"},{"id":"ref-for-font-mime-type\u2460"}],"title":"6.3. Matching a font type pattern"},{"refs":[{"id":"ref-for-font-mime-type\u2461"}],"title":"8.7. Sniffing in a font context"}],"url":"#font-mime-type"},
"font-type-pattern-matching-algorithm": {"dfnID":"font-type-pattern-matching-algorithm","dfnText":"font type pattern matching algorithm","external":false,"refSections":[{"refs":[{"id":"ref-for-font-type-pattern-matching-algorithm"}],"title":"8.7. Sniffing in a font context"}],"url":"#font-type-pattern-matching-algorithm"},
"html-mime-type": {"dfnID":"html-mime-type","dfnText":"HTML MIME type","external":false,"refSections":[{"refs":[{"id":"ref-for-html-mime-type"}],"title":"4.6. MIME type groups"}],"url":"#html-mime-type"},
"http-quoted-string-token-code-point": {"dfnID":"http-quoted-string-token-code-point","dfnText":"HTTP quoted-string token code point","external":false,"refSections":[{"refs":[{"id":"ref-for-http-quoted-string-token-code-point"}],"title":"4.4. Parsing a MIME type"}],"url":"#http-quoted-string-token-code-point"},
"http-token-code-point": {"dfnID":"http-token-code-point","dfnText":"HTTP token code point","external":false,"refSections":[{"refs":[{"id":"ref-for-http-token-code-point"}],"title":"3. Terminology"},{"refs":[{"id":"ref-for-http-token-code-point\u2460"},{"id":"ref-for-http-token-code-point\u2461"},{"id":"ref-for-http-token-code-point\u2462"}],"title":"4.4. Parsing a MIME type"},{"refs":[{"id":"ref-for-http-token-code-point\u2463"}],"title":"4.5. Serializing a MIME type"}],"url":"#http-token-code-point"},
"image-mime-type": {"dfnID":"image-mime-type","dfnText":"image MIME type","external":false,"refSections":[{"refs":[{"id":"ref-for-image-mime-type"},{"id":"ref-for-image-mime-type\u2460"}],"title":"6.1. Matching an image type pattern"},{"refs":[{"id":"ref-for-image-mime-type\u2461"}],"title":"7. Determining the computed MIME type of a resource"},{"refs":[{"id":"ref-for-image-mime-type\u2462"}],"title":"8.2. Sniffing in an image context"}],"url":"#image-mime-type"},
"image-type-pattern-matching-algorithm": {"dfnID":"image-type-pattern-matching-algorithm","dfnText":"image type pattern matching algorithm","external":false,"refSections":[{"refs":[{"id":"ref-for-image-type-pattern-matching-algorithm"}],"title":"7. Determining the computed MIME type of a resource"},{"refs":[{"id":"ref-for-image-type-pattern-matching-algorithm\u2460"}],"title":"7.1. Identifying a resource with an unknown MIME type"},{"refs":[{"id":"ref-for-image-type-pattern-matching-algorithm\u2461"}],"title":"8.2. Sniffing in an image context"}],"url":"#image-type-pattern-matching-algorithm"},
"javascript-mime-type": {"dfnID":"javascript-mime-type","dfnText":"JavaScript MIME type","external":false,"refSections":[{"refs":[{"id":"ref-for-javascript-mime-type"}],"title":"4.6. MIME type groups"}],"url":"#javascript-mime-type"},
"javascript-mime-type-essence-match": {"dfnID":"javascript-mime-type-essence-match","dfnText":"JavaScript MIME type essence match","external":false,"refSections":[],"url":"#javascript-mime-type-essence-match"},
"json-mime-type": {"dfnID":"json-mime-type","dfnText":"JSON MIME type","external":false,"refSections":[],"url":"#json-mime-type"},
"match-an-mp3-header": {"dfnID":"match-an-mp3-header","dfnText":"match an mp3 header","external":false,"refSections":[{"refs":[{"id":"ref-for-match-an-mp3-header"},{"id":"ref-for-match-an-mp3-header"}],"title":"6.2.3. Signature for MP3 without ID3"}],"url":"#match-an-mp3-header"},
"matches-the-signature-for-mp3-without-id3": {"dfnID":"matches-the-signature-for-mp3-without-id3","dfnText":"matches the signature\nfor MP3 without ID3","external":false,"refSections":[{"refs":[{"id":"ref-for-matches-the-signature-for-mp3-without-id3"}],"title":"6.2. Matching an audio or video type pattern"}],"url":"#matches-the-signature-for-mp3-without-id3"},
"matches-the-signature-for-mp4": {"dfnID":"matches-the-signature-for-mp4","dfnText":"matches the signature\n for MP4","external":false,"refSections":[{"refs":[{"id":"ref-for-matches-the-signature-for-mp4"}],"title":"6.2. Matching an audio or video type pattern"}],"url":"#matches-the-signature-for-mp4"},
"matches-the-signature-for-webm": {"dfnID":"matches-the-signature-for-webm","dfnText":"matches the signature\n for WebM","external":false,"refSections":[{"refs":[{"id":"ref-for-matches-the-signature-for-webm"}],"title":"6.2. Matching an audio or video type pattern"}],"url":"#matches-the-signature-for-webm"},
"matching-a-padded-sequence": {"dfnID":"matching-a-padded-sequence","dfnText":"Matching a padded sequence","external":false,"refSections":[{"refs":[{"id":"ref-for-matching-a-padded-sequence"}],"title":"6.2.2. Signature for WebM"}],"url":"#matching-a-padded-sequence"},
"mime-type": {"dfnID":"mime-type","dfnText":"MIME type","external":false,"refSections":[{"refs":[{"id":"ref-for-mime-type"},{"id":"ref-for-mime-type\u2460"},{"id":"ref-for-mime-type\u2461"},{"id":"ref-for-mime-type\u2462"},{"id":"ref-for-mime-type\u2463"}],"title":"4.1. MIME type representation"},{"refs":[{"id":"ref-for-mime-type\u2464"},{"id":"ref-for-mime-type\u2465"},{"id":"ref-for-mime-type\u2466"}],"title":"4.2. MIME type miscellaneous"},{"refs":[{"id":"ref-for-mime-type\u2467"}],"title":"4.3. MIME type writing"},{"refs":[{"id":"ref-for-mime-type\u2468"}],"title":"4.4. Parsing a MIME type"},{"refs":[{"id":"ref-for-mime-type\u2460\u24ea"},{"id":"ref-for-mime-type\u2460\u2460"}],"title":"4.5. Serializing a MIME type"},{"refs":[{"id":"ref-for-mime-type\u2460\u2461"},{"id":"ref-for-mime-type\u2460\u2462"},{"id":"ref-for-mime-type\u2460\u2463"},{"id":"ref-for-mime-type\u2460\u2464"},{"id":"ref-for-mime-type\u2460\u2465"},{"id":"ref-for-mime-type\u2460\u2466"},{"id":"ref-for-mime-type\u2460\u2467"},{"id":"ref-for-mime-type\u2460\u2468"},{"id":"ref-for-mime-type\u2461\u24ea"},{"id":"ref-for-mime-type\u2461\u2460"}],"title":"4.6. MIME type groups"},{"refs":[{"id":"ref-for-mime-type\u2461\u2461"},{"id":"ref-for-mime-type\u2461\u2462"}],"title":"5. Handling a resource"},{"refs":[{"id":"ref-for-mime-type\u2461\u2463"},{"id":"ref-for-mime-type\u2461\u2464"},{"id":"ref-for-mime-type\u2461\u2465"},{"id":"ref-for-mime-type\u2461\u2466"}],"title":"5.1. Interpreting the resource metadata"},{"refs":[{"id":"ref-for-mime-type\u2461\u2467"},{"id":"ref-for-mime-type\u2461\u2468"}],"title":"7.1. Identifying a resource with an unknown MIME type"},{"refs":[{"id":"ref-for-mime-type\u2462\u24ea"},{"id":"ref-for-mime-type\u2462\u2460"}],"title":"8. Context-specific sniffing"}],"url":"#mime-type"},
"mime-type-essence": {"dfnID":"mime-type-essence","dfnText":"essence","external":false,"refSections":[{"refs":[{"id":"ref-for-mime-type-essence"},{"id":"ref-for-mime-type-essence\u2460"},{"id":"ref-for-mime-type-essence\u2461"},{"id":"ref-for-mime-type-essence\u2462"},{"id":"ref-for-mime-type-essence\u2463"},{"id":"ref-for-mime-type-essence\u2464"},{"id":"ref-for-mime-type-essence\u2465"},{"id":"ref-for-mime-type-essence\u2466"},{"id":"ref-for-mime-type-essence\u2467"}],"title":"4.6. MIME type groups"},{"refs":[{"id":"ref-for-mime-type-essence\u2468"},{"id":"ref-for-mime-type-essence\u2460\u24ea"}],"title":"7. Determining the computed MIME type of a resource"}],"url":"#mime-type-essence"},
"mime-type-sniffing-algorithm": {"dfnID":"mime-type-sniffing-algorithm","dfnText":"MIME type sniffing algorithm","external":false,"refSections":[{"refs":[{"id":"ref-for-mime-type-sniffing-algorithm"},{"id":"ref-for-mime-type-sniffing-algorithm\u2460"}],"title":"5. Handling a resource"},{"refs":[{"id":"ref-for-mime-type-sniffing-algorithm\u2461"}],"title":"5.2. Reading the resource header"},{"refs":[{"id":"ref-for-mime-type-sniffing-algorithm\u2462"}],"title":"8. Context-specific sniffing"},{"refs":[{"id":"ref-for-mime-type-sniffing-algorithm\u2463"}],"title":"8.1. Sniffing in a browsing context"}],"url":"#mime-type-sniffing-algorithm"},
"no-sniff-flag": {"dfnID":"no-sniff-flag","dfnText":"no-sniff flag","external":false,"refSections":[{"refs":[{"id":"ref-for-no-sniff-flag"},{"id":"ref-for-no-sniff-flag\u2460"}],"title":"7. Determining the computed MIME type of a resource"}],"url":"#no-sniff-flag"},
"parameters": {"dfnID":"parameters","dfnText":"parameters","external":false,"refSections":[{"refs":[{"id":"ref-for-parameters"}],"title":"4.3. MIME type writing"},{"refs":[{"id":"ref-for-parameters\u2460"},{"id":"ref-for-parameters\u2461"}],"title":"4.4. Parsing a MIME type"},{"refs":[{"id":"ref-for-parameters\u2462"}],"title":"4.5. Serializing a MIME type"}],"url":"#parameters"},
"parse-a-mime-type": {"dfnID":"parse-a-mime-type","dfnText":"parse a MIME type","external":false,"refSections":[{"refs":[{"id":"ref-for-parse-a-mime-type"}],"title":"4.3. MIME type writing"},{"refs":[{"id":"ref-for-parse-a-mime-type\u2460"}],"title":"4.4. Parsing a MIME type"}],"url":"#parse-a-mime-type"},
"parse-a-mime-type-from-bytes": {"dfnID":"parse-a-mime-type-from-bytes","dfnText":"parse a MIME type from bytes","external":false,"refSections":[],"url":"#parse-a-mime-type-from-bytes"},
"parse-a-vint": {"dfnID":"parse-a-vint","dfnText":"parse a vint","external":false,"refSections":[{"refs":[{"id":"ref-for-parse-a-vint"}],"title":"6.2.2. Signature for WebM"}],"url":"#parse-a-vint"},
"parse-an-mp3-frame": {"dfnID":"parse-an-mp3-frame","dfnText":"parse an mp3 frame","external":false,"refSections":[{"refs":[{"id":"ref-for-parse-an-mp3-frame"}],"title":"6.2.3. Signature for MP3 without ID3"}],"url":"#parse-an-mp3-frame"},
"pattern-mask": {"dfnID":"pattern-mask","dfnText":"pattern mask","external":false,"refSections":[{"refs":[{"id":"ref-for-pattern-mask"},{"id":"ref-for-pattern-mask\u2460"}],"title":"6. Matching a MIME type pattern"},{"refs":[{"id":"ref-for-pattern-mask\u2461"}],"title":"6.1. Matching an image type pattern"},{"refs":[{"id":"ref-for-pattern-mask\u2462"}],"title":"6.2. Matching an audio or video type pattern"},{"refs":[{"id":"ref-for-pattern-mask\u2463"}],"title":"6.3. Matching a font type pattern"},{"refs":[{"id":"ref-for-pattern-mask\u2464"}],"title":"6.4. Matching an archive type pattern"},{"refs":[{"id":"ref-for-pattern-mask\u2465"},{"id":"ref-for-pattern-mask\u2466"}],"title":"7.1. Identifying a resource with an unknown MIME type"}],"url":"#pattern-mask"},
"pattern-matching-algorithm": {"dfnID":"pattern-matching-algorithm","dfnText":"pattern matching algorithm","external":false,"refSections":[{"refs":[{"id":"ref-for-pattern-matching-algorithm"},{"id":"ref-for-pattern-matching-algorithm\u2460"}],"title":"6. Matching a MIME type pattern"},{"refs":[{"id":"ref-for-pattern-matching-algorithm\u2461"}],"title":"6.1. Matching an image type pattern"},{"refs":[{"id":"ref-for-pattern-matching-algorithm\u2462"}],"title":"6.2. Matching an audio or video type pattern"},{"refs":[{"id":"ref-for-pattern-matching-algorithm\u2463"}],"title":"6.3. Matching a font type pattern"},{"refs":[{"id":"ref-for-pattern-matching-algorithm\u2464"}],"title":"6.4. Matching an archive type pattern"},{"refs":[{"id":"ref-for-pattern-matching-algorithm\u2465"},{"id":"ref-for-pattern-matching-algorithm\u2466"}],"title":"7.1. Identifying a resource with an unknown MIME type"}],"url":"#pattern-matching-algorithm"},
"read-the-resource-header": {"dfnID":"read-the-resource-header","dfnText":"read the resource header","external":false,"refSections":[{"refs":[{"id":"ref-for-read-the-resource-header"}],"title":"5.2. Reading the resource header"}],"url":"#read-the-resource-header"},
"resource": {"dfnID":"resource","dfnText":"resource","external":false,"refSections":[{"refs":[{"id":"ref-for-resource"}],"title":"4.2. MIME type miscellaneous"},{"refs":[{"id":"ref-for-resource\u2460"},{"id":"ref-for-resource\u2461"},{"id":"ref-for-resource\u2462"},{"id":"ref-for-resource\u2463"}],"title":"5. Handling a resource"},{"refs":[{"id":"ref-for-resource\u2464"},{"id":"ref-for-resource\u2465"},{"id":"ref-for-resource\u2466"},{"id":"ref-for-resource\u2467"},{"id":"ref-for-resource\u2468"},{"id":"ref-for-resource\u2460\u24ea"},{"id":"ref-for-resource\u2460\u2460"},{"id":"ref-for-resource\u2460\u2461"},{"id":"ref-for-resource\u2460\u2462"},{"id":"ref-for-resource\u2460\u2463"}],"title":"5.1. Interpreting the resource metadata"},{"refs":[{"id":"ref-for-resource\u2460\u2464"},{"id":"ref-for-resource\u2460\u2465"},{"id":"ref-for-resource\u2460\u2466"},{"id":"ref-for-resource\u2460\u2467"}],"title":"5.2. Reading the resource header"},{"refs":[{"id":"ref-for-resource\u2460\u2468"}],"title":"7. Determining the computed MIME type of a resource"},{"refs":[{"id":"ref-for-resource\u2461\u24ea"}],"title":"7.1. Identifying a resource with an unknown MIME type"},{"refs":[{"id":"ref-for-resource\u2461\u2460"}],"title":"7.2. Sniffing a mislabeled binary resource"},{"refs":[{"id":"ref-for-resource\u2461\u2461"},{"id":"ref-for-resource\u2461\u2462"},{"id":"ref-for-resource\u2461\u2463"},{"id":"ref-for-resource\u2461\u2464"}],"title":"8. Context-specific sniffing"},{"refs":[{"id":"ref-for-resource\u2461\u2465"}],"title":"8.2. Sniffing in an image context"},{"refs":[{"id":"ref-for-resource\u2461\u2466"}],"title":"8.3. Sniffing in an audio or video context"},{"refs":[{"id":"ref-for-resource\u2461\u2467"}],"title":"8.4. Sniffing in a plugin context"},{"refs":[{"id":"ref-for-resource\u2461\u2468"}],"title":"8.5. Sniffing in a style context"},{"refs":[{"id":"ref-for-resource\u2462\u24ea"}],"title":"8.6. Sniffing in a script context"},{"refs":[{"id":"ref-for-resource\u2462\u2460"}],"title":"8.7. Sniffing in a font context"}],"url":"#resource"},
"resource-header": {"dfnID":"resource-header","dfnText":"resource header","external":false,"refSections":[{"refs":[{"id":"ref-for-resource-header"},{"id":"ref-for-resource-header\u2460"}],"title":"5.2. Reading the resource header"},{"refs":[{"id":"ref-for-resource-header\u2461"},{"id":"ref-for-resource-header\u2462"}],"title":"7. Determining the computed MIME type of a resource"},{"refs":[{"id":"ref-for-resource-header\u2463"},{"id":"ref-for-resource-header\u2464"},{"id":"ref-for-resource-header\u2465"},{"id":"ref-for-resource-header\u2466"},{"id":"ref-for-resource-header\u2467"},{"id":"ref-for-resource-header\u2468"}],"title":"7.1. Identifying a resource with an unknown MIME type"},{"refs":[{"id":"ref-for-resource-header\u2460\u24ea"},{"id":"ref-for-resource-header\u2460\u2460"},{"id":"ref-for-resource-header\u2460\u2461"},{"id":"ref-for-resource-header\u2460\u2462"}],"title":"7.2. Sniffing a mislabeled binary resource"},{"refs":[{"id":"ref-for-resource-header\u2460\u2463"}],"title":"7.3. Sniffing a mislabeled feed"},{"refs":[{"id":"ref-for-resource-header\u2460\u2464"}],"title":"8.2. Sniffing in an image context"},{"refs":[{"id":"ref-for-resource-header\u2460\u2465"}],"title":"8.3. Sniffing in an audio or video context"},{"refs":[{"id":"ref-for-resource-header\u2460\u2466"}],"title":"8.7. Sniffing in a font context"}],"url":"#resource-header"},
"rules-for-distinguishing-if-a-resource-is-a-feed-or-html": {"dfnID":"rules-for-distinguishing-if-a-resource-is-a-feed-or-html","dfnText":"rules for distinguishing if a resource is a feed or\n HTML","external":false,"refSections":[{"refs":[{"id":"ref-for-rules-for-distinguishing-if-a-resource-is-a-feed-or-html"}],"title":"7. Determining the computed MIME type of a resource"},{"refs":[{"id":"ref-for-rules-for-distinguishing-if-a-resource-is-a-feed-or-html\u2460"}],"title":"7.3. Sniffing a mislabeled feed"}],"url":"#rules-for-distinguishing-if-a-resource-is-a-feed-or-html"},
"rules-for-identifying-an-unknown-mime-type": {"dfnID":"rules-for-identifying-an-unknown-mime-type","dfnText":"rules for identifying an unknown MIME\ntype","external":false,"refSections":[{"refs":[{"id":"ref-for-rules-for-identifying-an-unknown-mime-type"}],"title":"7. Determining the computed MIME type of a resource"},{"refs":[{"id":"ref-for-rules-for-identifying-an-unknown-mime-type\u2460"},{"id":"ref-for-rules-for-identifying-an-unknown-mime-type\u2461"}],"title":"7.1. Identifying a resource with an unknown MIME type"}],"url":"#rules-for-identifying-an-unknown-mime-type"},
"rules-for-sniffing-audio-and-video-specifically": {"dfnID":"rules-for-sniffing-audio-and-video-specifically","dfnText":"rules\n for sniffing audio and video specifically","external":false,"refSections":[],"url":"#rules-for-sniffing-audio-and-video-specifically"},
"rules-for-sniffing-fonts-specifically": {"dfnID":"rules-for-sniffing-fonts-specifically","dfnText":"rules for sniffing\n fonts specifically","external":false,"refSections":[],"url":"#rules-for-sniffing-fonts-specifically"},
"rules-for-sniffing-images-specifically": {"dfnID":"rules-for-sniffing-images-specifically","dfnText":"rules for\n sniffing images specifically","external":false,"refSections":[],"url":"#rules-for-sniffing-images-specifically"},
"rules-for-sniffing-in-a-plugin-context": {"dfnID":"rules-for-sniffing-in-a-plugin-context","dfnText":"rules for sniffing in a plugin context","external":false,"refSections":[],"url":"#rules-for-sniffing-in-a-plugin-context"},
"rules-for-sniffing-in-a-script-context": {"dfnID":"rules-for-sniffing-in-a-script-context","dfnText":"rules for sniffing in a script context","external":false,"refSections":[],"url":"#rules-for-sniffing-in-a-script-context"},
"rules-for-sniffing-in-a-style-context": {"dfnID":"rules-for-sniffing-in-a-style-context","dfnText":"rules for sniffing in a style context","external":false,"refSections":[],"url":"#rules-for-sniffing-in-a-style-context"},
"rules-for-text-or-binary": {"dfnID":"rules-for-text-or-binary","dfnText":"rules for\n distinguishing if a resource is text or binary","external":false,"refSections":[{"refs":[{"id":"ref-for-rules-for-text-or-binary"}],"title":"7. Determining the computed MIME type of a resource"},{"refs":[{"id":"ref-for-rules-for-text-or-binary\u2460"}],"title":"7.2. Sniffing a mislabeled binary resource"}],"url":"#rules-for-text-or-binary"},
"scriptable-mime-type": {"dfnID":"scriptable-mime-type","dfnText":"scriptable MIME type","external":false,"refSections":[{"refs":[{"id":"ref-for-scriptable-mime-type"}],"title":"7.1. Identifying a resource with an unknown MIME type"},{"refs":[{"id":"ref-for-scriptable-mime-type\u2460"}],"title":"7.2. Sniffing a mislabeled binary resource"}],"url":"#scriptable-mime-type"},
"serialize-a-mime-type": {"dfnID":"serialize-a-mime-type","dfnText":"serialize a MIME type","external":false,"refSections":[{"refs":[{"id":"ref-for-serialize-a-mime-type"}],"title":"4.5. Serializing a MIME type"}],"url":"#serialize-a-mime-type"},
"serialize-a-mime-type-to-bytes": {"dfnID":"serialize-a-mime-type-to-bytes","dfnText":"serialize a MIME type to bytes","external":false,"refSections":[],"url":"#serialize-a-mime-type-to-bytes"},
"sniff-scriptable-flag": {"dfnID":"sniff-scriptable-flag","dfnText":"sniff-scriptable flag","external":false,"refSections":[{"refs":[{"id":"ref-for-sniff-scriptable-flag"}],"title":"7. Determining the computed MIME type of a resource"},{"refs":[{"id":"ref-for-sniff-scriptable-flag\u2460"},{"id":"ref-for-sniff-scriptable-flag\u2461"},{"id":"ref-for-sniff-scriptable-flag\u2462"}],"title":"7.1. Identifying a resource with an unknown MIME type"}],"url":"#sniff-scriptable-flag"},
"subtype": {"dfnID":"subtype","dfnText":"subtype","external":false,"refSections":[{"refs":[{"id":"ref-for-subtype"}],"title":"4.2. MIME type miscellaneous"},{"refs":[{"id":"ref-for-subtype\u2460"}],"title":"4.4. Parsing a MIME type"},{"refs":[{"id":"ref-for-subtype\u2461"}],"title":"4.5. Serializing a MIME type"},{"refs":[{"id":"ref-for-subtype\u2462"},{"id":"ref-for-subtype\u2463"},{"id":"ref-for-subtype\u2464"}],"title":"4.6. MIME type groups"}],"url":"#subtype"},
"supplied-mime-type": {"dfnID":"supplied-mime-type","dfnText":"supplied MIME type","external":false,"refSections":[{"refs":[{"id":"ref-for-supplied-mime-type"},{"id":"ref-for-supplied-mime-type\u2460"},{"id":"ref-for-supplied-mime-type\u2461"},{"id":"ref-for-supplied-mime-type\u2462"},{"id":"ref-for-supplied-mime-type\u2463"}],"title":"5.1. Interpreting the resource metadata"},{"refs":[{"id":"ref-for-supplied-mime-type\u2464"},{"id":"ref-for-supplied-mime-type\u2465"},{"id":"ref-for-supplied-mime-type\u2466"},{"id":"ref-for-supplied-mime-type\u2467"},{"id":"ref-for-supplied-mime-type\u2468"},{"id":"ref-for-supplied-mime-type\u2460\u24ea"},{"id":"ref-for-supplied-mime-type\u2460\u2460"},{"id":"ref-for-supplied-mime-type\u2460\u2461"},{"id":"ref-for-supplied-mime-type\u2460\u2462"}],"title":"7. Determining the computed MIME type of a resource"},{"refs":[{"id":"ref-for-supplied-mime-type\u2460\u2463"},{"id":"ref-for-supplied-mime-type\u2460\u2464"},{"id":"ref-for-supplied-mime-type\u2460\u2465"},{"id":"ref-for-supplied-mime-type\u2460\u2466"},{"id":"ref-for-supplied-mime-type\u2460\u2467"},{"id":"ref-for-supplied-mime-type\u2460\u2468"},{"id":"ref-for-supplied-mime-type\u2461\u24ea"},{"id":"ref-for-supplied-mime-type\u2461\u2460"},{"id":"ref-for-supplied-mime-type\u2461\u2461"},{"id":"ref-for-supplied-mime-type\u2461\u2462"},{"id":"ref-for-supplied-mime-type\u2461\u2463"}],"title":"7.3. Sniffing a mislabeled feed"},{"refs":[{"id":"ref-for-supplied-mime-type\u2461\u2464"},{"id":"ref-for-supplied-mime-type\u2461\u2465"},{"id":"ref-for-supplied-mime-type\u2461\u2466"}],"title":"8.2. Sniffing in an image context"},{"refs":[{"id":"ref-for-supplied-mime-type\u2461\u2467"},{"id":"ref-for-supplied-mime-type\u2461\u2468"},{"id":"ref-for-supplied-mime-type\u2462\u24ea"}],"title":"8.3. Sniffing in an audio or video context"},{"refs":[{"id":"ref-for-supplied-mime-type\u2462\u2460"},{"id":"ref-for-supplied-mime-type\u2462\u2461"}],"title":"8.4. Sniffing in a plugin context"},{"refs":[{"id":"ref-for-supplied-mime-type\u2462\u2462"},{"id":"ref-for-supplied-mime-type\u2462\u2463"}],"title":"8.5. Sniffing in a style context"},{"refs":[{"id":"ref-for-supplied-mime-type\u2462\u2464"},{"id":"ref-for-supplied-mime-type\u2462\u2465"}],"title":"8.6. Sniffing in a script context"},{"refs":[{"id":"ref-for-supplied-mime-type\u2462\u2466"},{"id":"ref-for-supplied-mime-type\u2462\u2467"},{"id":"ref-for-supplied-mime-type\u2462\u2468"}],"title":"8.7. Sniffing in a font context"}],"url":"#supplied-mime-type"},
"supplied-mime-type-detection-algorithm": {"dfnID":"supplied-mime-type-detection-algorithm","dfnText":"supplied MIME type detection\n algorithm","external":false,"refSections":[{"refs":[{"id":"ref-for-supplied-mime-type-detection-algorithm"}],"title":"5. Handling a resource"},{"refs":[{"id":"ref-for-supplied-mime-type-detection-algorithm\u2460"}],"title":"5.1. Interpreting the resource metadata"}],"url":"#supplied-mime-type-detection-algorithm"},
"supported-by-the-user-agent": {"dfnID":"supported-by-the-user-agent","dfnText":"supported by the user agent","external":false,"refSections":[{"refs":[{"id":"ref-for-supported-by-the-user-agent"},{"id":"ref-for-supported-by-the-user-agent\u2460"}],"title":"7. Determining the computed MIME type of a resource"}],"url":"#supported-by-the-user-agent"},
"tag-terminating-byte": {"dfnID":"tag-terminating-byte","dfnText":"tag-terminating byte","external":false,"refSections":[{"refs":[{"id":"ref-for-tag-terminating-byte"},{"id":"ref-for-tag-terminating-byte\u2460"},{"id":"ref-for-tag-terminating-byte\u2461"},{"id":"ref-for-tag-terminating-byte\u2462"},{"id":"ref-for-tag-terminating-byte\u2463"},{"id":"ref-for-tag-terminating-byte\u2464"},{"id":"ref-for-tag-terminating-byte\u2465"},{"id":"ref-for-tag-terminating-byte\u2466"},{"id":"ref-for-tag-terminating-byte\u2467"},{"id":"ref-for-tag-terminating-byte\u2468"},{"id":"ref-for-tag-terminating-byte\u2460\u24ea"},{"id":"ref-for-tag-terminating-byte\u2460\u2460"},{"id":"ref-for-tag-terminating-byte\u2460\u2461"},{"id":"ref-for-tag-terminating-byte\u2460\u2462"},{"id":"ref-for-tag-terminating-byte\u2460\u2463"},{"id":"ref-for-tag-terminating-byte\u2460\u2464"},{"id":"ref-for-tag-terminating-byte\u2460\u2465"}],"title":"7.1. Identifying a resource with an unknown MIME type"}],"url":"#tag-terminating-byte"},
"type": {"dfnID":"type","dfnText":"type","external":false,"refSections":[{"refs":[{"id":"ref-for-type"}],"title":"4.2. MIME type miscellaneous"},{"refs":[{"id":"ref-for-type\u2460"}],"title":"4.4. Parsing a MIME type"},{"refs":[{"id":"ref-for-type\u2461"}],"title":"4.5. Serializing a MIME type"},{"refs":[{"id":"ref-for-type\u2462"},{"id":"ref-for-type\u2463"},{"id":"ref-for-type\u2464"}],"title":"4.6. MIME type groups"}],"url":"#type"},
"valid-mime-type": {"dfnID":"valid-mime-type","dfnText":"valid MIME type string","external":false,"refSections":[{"refs":[{"id":"ref-for-valid-mime-type"},{"id":"ref-for-valid-mime-type\u2460"},{"id":"ref-for-valid-mime-type\u2461"},{"id":"ref-for-valid-mime-type\u2462"},{"id":"ref-for-valid-mime-type\u2463"}],"title":"4.3. MIME type writing"}],"url":"#valid-mime-type"},
"valid-mime-type-with-no-parameters": {"dfnID":"valid-mime-type-with-no-parameters","dfnText":"valid MIME type string with no parameters","external":false,"refSections":[],"url":"#valid-mime-type-with-no-parameters"},
"whitespace-byte": {"dfnID":"whitespace-byte","dfnText":"whitespace byte","external":false,"refSections":[{"refs":[{"id":"ref-for-whitespace-byte"},{"id":"ref-for-whitespace-byte\u2460"},{"id":"ref-for-whitespace-byte\u2461"},{"id":"ref-for-whitespace-byte\u2462"},{"id":"ref-for-whitespace-byte\u2463"},{"id":"ref-for-whitespace-byte\u2464"},{"id":"ref-for-whitespace-byte\u2465"},{"id":"ref-for-whitespace-byte\u2466"},{"id":"ref-for-whitespace-byte\u2467"},{"id":"ref-for-whitespace-byte\u2468"},{"id":"ref-for-whitespace-byte\u2460\u24ea"},{"id":"ref-for-whitespace-byte\u2460\u2460"},{"id":"ref-for-whitespace-byte\u2460\u2461"},{"id":"ref-for-whitespace-byte\u2460\u2462"},{"id":"ref-for-whitespace-byte\u2460\u2463"},{"id":"ref-for-whitespace-byte\u2460\u2464"},{"id":"ref-for-whitespace-byte\u2460\u2465"},{"id":"ref-for-whitespace-byte\u2460\u2466"}],"title":"7.1. Identifying a resource with an unknown MIME type"},{"refs":[{"id":"ref-for-whitespace-byte\u2460\u2467"}],"title":"7.3. Sniffing a mislabeled feed"}],"url":"#whitespace-byte"},
"xml-mime-type": {"dfnID":"xml-mime-type","dfnText":"XML MIME type","external":false,"refSections":[{"refs":[{"id":"ref-for-xml-mime-type"}],"title":"4.6. MIME type groups"},{"refs":[{"id":"ref-for-xml-mime-type\u2460"}],"title":"7. Determining the computed MIME type of a resource"},{"refs":[{"id":"ref-for-xml-mime-type\u2461"}],"title":"8.2. Sniffing in an image context"},{"refs":[{"id":"ref-for-xml-mime-type\u2462"}],"title":"8.3. Sniffing in an audio or video context"},{"refs":[{"id":"ref-for-xml-mime-type\u2463"}],"title":"8.7. Sniffing in a font context"}],"url":"#xml-mime-type"},
"zip-based-mime-type": {"dfnID":"zip-based-mime-type","dfnText":"ZIP-based MIME type","external":false,"refSections":[],"url":"#zip-based-mime-type"},
};

document.addEventListener("DOMContentLoaded", ()=>{
    genAllDfnPanels();

    document.body.addEventListener("click", (e) => {
        // If not handled already, just hide all dfn panels.
        hideAllDfnPanels();
    });
});

window.addEventListener("resize", () => {
    // Pin any visible dfn panel
    queryAll(".dfn-panel.on, .dfn-panel.activated").forEach(el=>positionDfnPanel(el));
});

function genAllDfnPanels() {
    for(const panelData of Object.values(dfnPanelData)) {
        const dfnID = panelData.dfnID;
        const dfn = document.getElementById(dfnID);
        if(!dfn) {
            console.log(`Can't find dfn#${dfnID}.`, panelData);
            continue;
        }
        dfn.panelData = panelData;
        insertDfnPopupAction(dfn);
    }
}

function genDfnPanel(dfn, { dfnID, url, dfnText, refSections, external }) {
    const dfnPanel = mk.aside({
        class: "dfn-panel on",
        id: `infopanel-for-${dfnID}`,
        "data-for": dfnID,
        "aria-labelled-by":`infopaneltitle-for-${dfnID}`,
        },
        mk.span({id:`infopaneltitle-for-${dfnID}`, style:"display:none"},
            `Info about the '${dfnText}' ${external?"external":""} reference.`),
        mk.a({href:url, class:"dfn-link"}, url),
        refSections.length == 0 ? [] :
            mk.b({}, "Referenced in:"),
            mk.ul({},
                ...refSections.map(section=>
                    mk.li({},
                        ...section.refs.map((ref, refI)=>
                            [
                                mk.a({ href: `#${ref.id}` },
                                    (refI == 0) ? section.title : `(${refI + 1})`
                                ),
                                " ",
                            ]
                        ),
                    ),
                ),
            ),
        genLinkingSyntaxes(dfn),
    );

    dfnPanel.addEventListener('click', (event) => {
        if (event.target.nodeName == 'A') {
            scrollToTargetAndHighlight(event);
            pinDfnPanel(dfnPanel);
        }
        event.stopPropagation();
        refocusOnTarget(event);
    });
    dfnPanel.addEventListener('keydown', (event) => {
        if(event.keyCode == 27) { // Escape key
            hideDfnPanel({dfnPanel});
            event.stopPropagation();
            event.preventDefault();
        }
    });

    dfnPanel.dfn = dfn;
    dfn.dfnPanel = dfnPanel;
    return dfnPanel;
}



function hideAllDfnPanels() {
    // Delete the currently-active dfn panel.
    queryAll(".dfn-panel").forEach(dfnPanel=>hideDfnPanel({dfnPanel}));
}

function showDfnPanel(dfn) {
    hideAllDfnPanels(); // Only display one at a time.

    dfn.setAttribute("aria-expanded", "true");

    const dfnPanel = genDfnPanel(dfn, dfn.panelData);

    // Give the dfn a unique tabindex, and then
    // give all the tabbable panel bits successive indexes.
    let tabIndex = 100;
    dfn.tabIndex = tabIndex++;
    const tabbable = dfnPanel.querySelectorAll(":is(a, button)");
    for (const el of tabbable) {
        el.tabIndex = tabIndex++;
    }

    append(document.body, dfnPanel);
    positionDfnPanel(dfnPanel);
}

function positionDfnPanel(dfnPanel) {
    const dfn = dfnPanel.dfn;
    const dfnPos = getBounds(dfn);
    dfnPanel.style.top = dfnPos.bottom + "px";
    dfnPanel.style.left = dfnPos.left + "px";

    const panelPos = dfnPanel.getBoundingClientRect();
    const panelMargin = 8;
    const maxRight = document.body.parentNode.clientWidth - panelMargin;
    if (panelPos.right > maxRight) {
        const overflowAmount = panelPos.right - maxRight;
        const newLeft = Math.max(panelMargin, dfnPos.left - overflowAmount);
        dfnPanel.style.left = newLeft + "px";
    }
}

function pinDfnPanel(dfnPanel) {
    // Switch it to "activated" state, which pins it.
    dfnPanel.classList.add("activated");
    dfnPanel.style.position = "fixed";
    dfnPanel.style.left = null;
    dfnPanel.style.top = null;
}

function hideDfnPanel({dfn, dfnPanel}) {
    if(!dfnPanel) dfnPanel = dfn.dfnPanel;
    if(!dfn) dfn = dfnPanel.dfn;
    dfn.dfnPanel = undefined;
    dfnPanel.dfn = undefined;
    dfn.setAttribute("aria-expanded", "false");
    dfn.tabIndex = undefined;
    dfnPanel.remove()
}

function toggleDfnPanel(dfn) {
    if(dfn.dfnPanel) {
        hideDfnPanel(dfn);
    } else {
        showDfnPanel(dfn);
    }
}

function insertDfnPopupAction(dfn) {
    dfn.setAttribute('role', 'button');
    dfn.setAttribute('aria-expanded', 'false')
    dfn.tabIndex = 0;
    dfn.classList.add('has-dfn-panel');
    dfn.addEventListener('click', (event) => {
        toggleDfnPanel(dfn);
        event.stopPropagation();
    });
    dfn.addEventListener('keypress', (event) => {
        const kc = event.keyCode;
        // 32->Space, 13->Enter
        if(kc == 32 || kc == 13) {
            toggleDfnPanel(dfn);
            event.stopPropagation();
            event.preventDefault();
        }
    });
}

function refocusOnTarget(event) {
    const target = event.target;
    setTimeout(() => {
        // Refocus on the event.target element.
        // This is needed after browser scrolls to the destination.
        target.focus();
    });
}

// TODO: shared util
// Returns the root-level absolute position {left and top} of element.
function getBounds(el, relativeTo=document.body) {
    const relativeRect = relativeTo.getBoundingClientRect();
    const elRect = el.getBoundingClientRect();
    const top = elRect.top - relativeRect.top;
    const left = elRect.left - relativeRect.left;
    return {
        top,
        left,
        bottom: top + elRect.height,
        right: left + elRect.width,
    }
}

function scrollToTargetAndHighlight(event) {
    let hash = event.target.hash;
    if (hash) {
        hash = decodeURIComponent(hash.substring(1));
        const dest = document.getElementById(hash);
        if (dest) {
            dest.classList.add('highlighted');
            setTimeout(() => dest.classList.remove('highlighted'), 1000);
        }
    }
}

// Functions, divided by link type, that wrap an autolink's
// contents with the appropriate outer syntax.
// Alternately, a string naming another type they format
// the same as.
function needsFor(type) {
    switch(type) {
        case "descriptor":
        case "value":
        case "element-attr":
        case "attr-value":
        case "element-state":
        case "method":
        case "constructor":
        case "argument":
        case "attribute":
        case "const":
        case "dict-member":
        case "event":
        case "enum-value":
        case "stringifier":
        case "serializer":
        case "iterator":
        case "maplike":
        case "setlike":
        case "state":
        case "mode":
        case "context":
        case "facet": return true;

        default: return false;
    }
}
function refusesFor(type) {
    switch(type) {
        case "property":
        case "element":
        case "interface":
        case "namespace":
        case "callback":
        case "dictionary":
        case "enum":
        case "exception":
        case "typedef":
        case "http-header":
        case "permission": return true;

        default: return false;
    }
}
function linkFormatterFromType(type) {
    switch(type) {
        case 'scheme':
        case 'permission':
        case 'dfn': return (text) => `[=${text}=]`;

        case 'abstract-op': return (text) => `[\$${text}\$]`;

        case 'function':
        case 'at-rule':
        case 'selector':
        case 'value': return (text) => `''${text}''`;

        case 'http-header': return (text) => `[:${text}:]`;

        case 'interface':
        case 'constructor':
        case 'method':
        case 'argument':
        case 'attribute':
        case 'callback':
        case 'dictionary':
        case 'dict-member':
        case 'enum':
        case 'enum-value':
        case 'exception':
        case 'const':
        case 'typedef':
        case 'stringifier':
        case 'serializer':
        case 'iterator':
        case 'maplike':
        case 'setlike':
        case 'extended-attribute':
        case 'event':
        case 'idl': return (text) => `{{${text}}}`;

        case 'element-state':
        case 'element-attr':
        case 'attr-value':
        case 'element': return (element) => `<{${element}}>`;

        case 'grammar': return (text) => `${text} (within a <pre class=prod>)`;

        case 'type': return (text)=> `<<${text}>>`;

        case 'descriptor':
        case 'property': return (text) => `'${text}'`;

        default: return;
    };
};

function genLinkingSyntaxes(dfn) {
    if(dfn.tagName != "DFN") return;

    const type = dfn.getAttribute('data-dfn-type');
    if(!type) {
        console.log(`<dfn> doesn't have a data-dfn-type:`, dfn);
        return [];
    }

    // Return a function that wraps link text based on the type
    const linkFormatter = linkFormatterFromType(type);
    if(!linkFormatter) {
        console.log(`<dfn> has an unknown data-dfn-type:`, dfn);
        return [];
    }

    let ltAlts;
    if(dfn.hasAttribute('data-lt')) {
        ltAlts = dfn.getAttribute('data-lt')
            .split("|")
            .map(x=>x.trim());
    } else {
        ltAlts = [dfn.textContent.trim()];
    }
    if(type == "type") {
        // lt of "<foo>", but "foo" is the interior;
        // <<foo/bar>> is how you write it with a for,
        // not <foo/<bar>> or whatever.
        for(var i = 0; i < ltAlts.length; i++) {
            const lt = ltAlts[i];
            const match = /<(.*)>/.exec(lt);
            if(match) { ltAlts[i] = match[1]; }
        }
    }

    let forAlts;
    if(dfn.hasAttribute('data-dfn-for')) {
        forAlts = dfn.getAttribute('data-dfn-for')
            .split(",")
            .map(x=>x.trim());
    } else {
        forAlts = [''];
    }

    let linkingSyntaxes = [];
    if(!needsFor(type)) {
        for(const lt of ltAlts) {
            linkingSyntaxes.push(linkFormatter(lt));
        }
    }
    if(!refusesFor(type)) {
        for(const f of forAlts) {
            linkingSyntaxes.push(linkFormatter(`${f}/${ltAlts[0]}`))
        }
    }
    return [
        mk.b({}, 'Possible linking syntaxes:'),
        mk.ul({},
            ...linkingSyntaxes.map(link => {
                const copyLink = async () =>
                    await navigator.clipboard.writeText(link);
                return mk.li({},
                    mk.div({ class: 'link-item' },
                        mk.button({
                            class: 'copy-icon', title: 'Copy',
                            type: 'button',
                            _onclick: copyLink,
                            tabindex: 0,
                        }, mk.span({ class: 'icon' }) ),
                        mk.span({}, link)
                    )
                );
            })
        )
    ];
}
}
</script>
<script>/* Boilerplate: script-ref-hints */
"use strict";
{
let refsData = {
"#archive-mime-type": {"export":true,"for_":[],"level":"","normative":true,"shortname":"mimesniff","spec":"mimesniff","status":"local","text":"archive mime type","type":"dfn","url":"#archive-mime-type"},
"#archive-type-pattern-matching-algorithm": {"export":true,"for_":[],"level":"","normative":true,"shortname":"mimesniff","spec":"mimesniff","status":"local","text":"archive type pattern matching algorithm","type":"dfn","url":"#archive-type-pattern-matching-algorithm"},
"#audio-or-video-mime-type": {"export":true,"for_":[],"level":"","normative":true,"shortname":"mimesniff","spec":"mimesniff","status":"local","text":"audio or video mime type","type":"dfn","url":"#audio-or-video-mime-type"},
"#audio-or-video-type-pattern-matching-algorithm": {"export":true,"for_":[],"level":"","normative":true,"shortname":"mimesniff","spec":"mimesniff","status":"local","text":"audio or video type pattern matching algorithm","type":"dfn","url":"#audio-or-video-type-pattern-matching-algorithm"},
"#binary-data-byte": {"export":true,"for_":[],"level":"","normative":true,"shortname":"mimesniff","spec":"mimesniff","status":"local","text":"binary data byte","type":"dfn","url":"#binary-data-byte"},
"#byte-pattern": {"export":true,"for_":[],"level":"","normative":true,"shortname":"mimesniff","spec":"mimesniff","status":"local","text":"byte pattern","type":"dfn","url":"#byte-pattern"},
"#check-for-apache-bug-flag": {"export":true,"for_":[],"level":"","normative":true,"shortname":"mimesniff","spec":"mimesniff","status":"local","text":"check-for-apache-bug flag","type":"dfn","url":"#check-for-apache-bug-flag"},
"#computed-mime-type": {"export":true,"for_":[],"level":"","normative":true,"shortname":"mimesniff","spec":"mimesniff","status":"local","text":"computed mime type","type":"dfn","url":"#computed-mime-type"},
"#context": {"export":true,"for_":[],"level":"","normative":true,"shortname":"mimesniff","spec":"mimesniff","status":"local","text":"context","type":"dfn","url":"#context"},
"#context-specific-sniffing-algorithm": {"export":true,"for_":[],"level":"","normative":true,"shortname":"mimesniff","spec":"mimesniff","status":"local","text":"context-specific sniffing algorithm","type":"dfn","url":"#context-specific-sniffing-algorithm"},
"#font-mime-type": {"export":true,"for_":[],"level":"","normative":true,"shortname":"mimesniff","spec":"mimesniff","status":"local","text":"font mime type","type":"dfn","url":"#font-mime-type"},
"#font-type-pattern-matching-algorithm": {"export":true,"for_":[],"level":"","normative":true,"shortname":"mimesniff","spec":"mimesniff","status":"local","text":"font type pattern matching algorithm","type":"dfn","url":"#font-type-pattern-matching-algorithm"},
"#html-mime-type": {"export":true,"for_":[],"level":"","normative":true,"shortname":"mimesniff","spec":"mimesniff","status":"local","text":"html mime type","type":"dfn","url":"#html-mime-type"},
"#http-quoted-string-token-code-point": {"export":true,"for_":[],"level":"","normative":true,"shortname":"mimesniff","spec":"mimesniff","status":"local","text":"http quoted-string token code point","type":"dfn","url":"#http-quoted-string-token-code-point"},
"#http-token-code-point": {"export":true,"for_":[],"level":"","normative":true,"shortname":"mimesniff","spec":"mimesniff","status":"local","text":"http token code point","type":"dfn","url":"#http-token-code-point"},
"#image-mime-type": {"export":true,"for_":[],"level":"","normative":true,"shortname":"mimesniff","spec":"mimesniff","status":"local","text":"image mime type","type":"dfn","url":"#image-mime-type"},
"#image-type-pattern-matching-algorithm": {"export":true,"for_":[],"level":"","normative":true,"shortname":"mimesniff","spec":"mimesniff","status":"local","text":"image type pattern matching algorithm","type":"dfn","url":"#image-type-pattern-matching-algorithm"},
"#javascript-mime-type": {"export":true,"for_":[],"level":"","normative":true,"shortname":"mimesniff","spec":"mimesniff","status":"local","text":"javascript mime type","type":"dfn","url":"#javascript-mime-type"},
"#matches-the-signature-for-mp3-without-id3": {"export":true,"for_":[],"level":"","normative":true,"shortname":"mimesniff","spec":"mimesniff","status":"local","text":"matches the signature for mp3 without id3","type":"dfn","url":"#matches-the-signature-for-mp3-without-id3"},
"#matches-the-signature-for-mp4": {"export":true,"for_":[],"level":"","normative":true,"shortname":"mimesniff","spec":"mimesniff","status":"local","text":"matches the signature for mp4","type":"dfn","url":"#matches-the-signature-for-mp4"},
"#matches-the-signature-for-webm": {"export":true,"for_":[],"level":"","normative":true,"shortname":"mimesniff","spec":"mimesniff","status":"local","text":"matches the signature for webm","type":"dfn","url":"#matches-the-signature-for-webm"},
"#mime-type": {"export":true,"for_":[],"level":"","normative":true,"shortname":"mimesniff","spec":"mimesniff","status":"local","text":"mime type record","type":"dfn","url":"#mime-type"},
"#mime-type-essence": {"export":true,"for_":["MIME type"],"level":"","normative":true,"shortname":"mimesniff","spec":"mimesniff","status":"local","text":"essence","type":"dfn","url":"#mime-type-essence"},
"#mime-type-sniffing-algorithm": {"export":true,"for_":[],"level":"","normative":true,"shortname":"mimesniff","spec":"mimesniff","status":"local","text":"mime type sniffing algorithm","type":"dfn","url":"#mime-type-sniffing-algorithm"},
"#no-sniff-flag": {"export":true,"for_":[],"level":"","normative":true,"shortname":"mimesniff","spec":"mimesniff","status":"local","text":"no-sniff flag","type":"dfn","url":"#no-sniff-flag"},
"#parameters": {"export":true,"for_":["MIME type"],"level":"","normative":true,"shortname":"mimesniff","spec":"mimesniff","status":"local","text":"parameters","type":"dfn","url":"#parameters"},
"#parse-a-mime-type": {"export":true,"for_":[],"level":"","normative":true,"shortname":"mimesniff","spec":"mimesniff","status":"local","text":"parse a mime type","type":"dfn","url":"#parse-a-mime-type"},
"#pattern-mask": {"export":true,"for_":[],"level":"","normative":true,"shortname":"mimesniff","spec":"mimesniff","status":"local","text":"pattern mask","type":"dfn","url":"#pattern-mask"},
"#pattern-matching-algorithm": {"export":true,"for_":[],"level":"","normative":true,"shortname":"mimesniff","spec":"mimesniff","status":"local","text":"pattern matching algorithm","type":"dfn","url":"#pattern-matching-algorithm"},
"#read-the-resource-header": {"export":true,"for_":[],"level":"","normative":true,"shortname":"mimesniff","spec":"mimesniff","status":"local","text":"read the resource header","type":"dfn","url":"#read-the-resource-header"},
"#resource": {"export":true,"for_":[],"level":"","normative":true,"shortname":"mimesniff","spec":"mimesniff","status":"local","text":"resource","type":"dfn","url":"#resource"},
"#resource-header": {"export":true,"for_":[],"level":"","normative":true,"shortname":"mimesniff","spec":"mimesniff","status":"local","text":"resource header","type":"dfn","url":"#resource-header"},
"#rules-for-distinguishing-if-a-resource-is-a-feed-or-html": {"export":true,"for_":[],"level":"","normative":true,"shortname":"mimesniff","spec":"mimesniff","status":"local","text":"rules for distinguishing if a resource is a feed or html","type":"dfn","url":"#rules-for-distinguishing-if-a-resource-is-a-feed-or-html"},
"#rules-for-identifying-an-unknown-mime-type": {"export":true,"for_":[],"level":"","normative":true,"shortname":"mimesniff","spec":"mimesniff","status":"local","text":"rules for identifying an unknown mime type","type":"dfn","url":"#rules-for-identifying-an-unknown-mime-type"},
"#rules-for-text-or-binary": {"export":true,"for_":[],"level":"","normative":true,"shortname":"mimesniff","spec":"mimesniff","status":"local","text":"rules for distinguishing if a resource is text or binary","type":"dfn","url":"#rules-for-text-or-binary"},
"#scriptable-mime-type": {"export":true,"for_":[],"level":"","normative":true,"shortname":"mimesniff","spec":"mimesniff","status":"local","text":"scriptable mime type","type":"dfn","url":"#scriptable-mime-type"},
"#serialize-a-mime-type": {"export":true,"for_":[],"level":"","normative":true,"shortname":"mimesniff","spec":"mimesniff","status":"local","text":"serialize a mime type","type":"dfn","url":"#serialize-a-mime-type"},
"#sniff-scriptable-flag": {"export":true,"for_":[],"level":"","normative":true,"shortname":"mimesniff","spec":"mimesniff","status":"local","text":"sniff-scriptable flag","type":"dfn","url":"#sniff-scriptable-flag"},
"#subtype": {"export":true,"for_":["MIME type"],"level":"","normative":true,"shortname":"mimesniff","spec":"mimesniff","status":"local","text":"subtype","type":"dfn","url":"#subtype"},
"#supplied-mime-type": {"export":true,"for_":[],"level":"","normative":true,"shortname":"mimesniff","spec":"mimesniff","status":"local","text":"supplied mime type","type":"dfn","url":"#supplied-mime-type"},
"#supplied-mime-type-detection-algorithm": {"export":true,"for_":[],"level":"","normative":true,"shortname":"mimesniff","spec":"mimesniff","status":"local","text":"supplied mime type detection algorithm","type":"dfn","url":"#supplied-mime-type-detection-algorithm"},
"#supported-by-the-user-agent": {"export":true,"for_":[],"level":"","normative":true,"shortname":"mimesniff","spec":"mimesniff","status":"local","text":"supported by the user agent","type":"dfn","url":"#supported-by-the-user-agent"},
"#tag-terminating-byte": {"export":true,"for_":[],"level":"","normative":true,"shortname":"mimesniff","spec":"mimesniff","status":"local","text":"tag-terminating byte","type":"dfn","url":"#tag-terminating-byte"},
"#type": {"export":true,"for_":["MIME type"],"level":"","normative":true,"shortname":"mimesniff","spec":"mimesniff","status":"local","text":"type","type":"dfn","url":"#type"},
"#valid-mime-type": {"export":true,"for_":[],"level":"","normative":true,"shortname":"mimesniff","spec":"mimesniff","status":"local","text":"valid mime type string","type":"dfn","url":"#valid-mime-type"},
"#whitespace-byte": {"export":true,"for_":[],"level":"","normative":true,"shortname":"mimesniff","spec":"mimesniff","status":"local","text":"whitespace byte","type":"dfn","url":"#whitespace-byte"},
"#xml-mime-type": {"export":true,"for_":[],"level":"","normative":true,"shortname":"mimesniff","spec":"mimesniff","status":"local","text":"xml mime type","type":"dfn","url":"#xml-mime-type"},
"https://fetch.spec.whatwg.org/#collect-an-http-quoted-string": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"fetch","spec":"fetch","status":"current","text":"collecting an http quoted string","type":"dfn","url":"https://fetch.spec.whatwg.org/#collect-an-http-quoted-string"},
"https://fetch.spec.whatwg.org/#concept-fetch": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"fetch","spec":"fetch","status":"current","text":"fetch","type":"dfn","url":"https://fetch.spec.whatwg.org/#concept-fetch"},
"https://fetch.spec.whatwg.org/#http-whitespace": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"fetch","spec":"fetch","status":"current","text":"http whitespace","type":"dfn","url":"https://fetch.spec.whatwg.org/#http-whitespace"},
"https://html.spec.whatwg.org/multipage/scripting.html#attr-script-type": {"export":true,"for_":["script"],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"type","type":"element-attr","url":"https://html.spec.whatwg.org/multipage/scripting.html#attr-script-type"},
"https://html.spec.whatwg.org/multipage/scripting.html#script": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"script","type":"element","url":"https://html.spec.whatwg.org/multipage/scripting.html#script"},
"https://infra.spec.whatwg.org/#ascii-alphanumeric": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"ascii alphanumeric","type":"dfn","url":"https://infra.spec.whatwg.org/#ascii-alphanumeric"},
"https://infra.spec.whatwg.org/#ascii-case-insensitive": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"ascii case-insensitive","type":"dfn","url":"https://infra.spec.whatwg.org/#ascii-case-insensitive"},
"https://infra.spec.whatwg.org/#ascii-lowercase": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"ascii lowercase","type":"dfn","url":"https://infra.spec.whatwg.org/#ascii-lowercase"},
"https://infra.spec.whatwg.org/#ascii-string": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"ascii string","type":"dfn","url":"https://infra.spec.whatwg.org/#ascii-string"},
"https://infra.spec.whatwg.org/#ascii-whitespace": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"ascii whitespace","type":"dfn","url":"https://infra.spec.whatwg.org/#ascii-whitespace"},
"https://infra.spec.whatwg.org/#byte": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"byte","type":"dfn","url":"https://infra.spec.whatwg.org/#byte"},
"https://infra.spec.whatwg.org/#byte-sequence": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"byte sequence","type":"dfn","url":"https://infra.spec.whatwg.org/#byte-sequence"},
"https://infra.spec.whatwg.org/#byte-sequence-length": {"export":true,"for_":["byte sequence"],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"length","type":"dfn","url":"https://infra.spec.whatwg.org/#byte-sequence-length"},
"https://infra.spec.whatwg.org/#code-point": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"code point","type":"dfn","url":"https://infra.spec.whatwg.org/#code-point"},
"https://infra.spec.whatwg.org/#collect-a-sequence-of-code-points": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"collecting a sequence of code points","type":"dfn","url":"https://infra.spec.whatwg.org/#collect-a-sequence-of-code-points"},
"https://infra.spec.whatwg.org/#isomorphic-decode": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"isomorphic decode","type":"dfn","url":"https://infra.spec.whatwg.org/#isomorphic-decode"},
"https://infra.spec.whatwg.org/#isomorphic-encode": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"isomorphic encode","type":"dfn","url":"https://infra.spec.whatwg.org/#isomorphic-encode"},
"https://infra.spec.whatwg.org/#iteration-break": {"export":true,"for_":["iteration"],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"break","type":"dfn","url":"https://infra.spec.whatwg.org/#iteration-break"},
"https://infra.spec.whatwg.org/#iteration-continue": {"export":true,"for_":["iteration"],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"continue","type":"dfn","url":"https://infra.spec.whatwg.org/#iteration-continue"},
"https://infra.spec.whatwg.org/#list-contain": {"export":true,"for_":["list","stack","queue","set"],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"contain","type":"dfn","url":"https://infra.spec.whatwg.org/#list-contain"},
"https://infra.spec.whatwg.org/#map-exists": {"export":true,"for_":["map"],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"exist","type":"dfn","url":"https://infra.spec.whatwg.org/#map-exists"},
"https://infra.spec.whatwg.org/#map-getting-the-keys": {"export":true,"for_":["map"],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"keys","type":"dfn","url":"https://infra.spec.whatwg.org/#map-getting-the-keys"},
"https://infra.spec.whatwg.org/#map-getting-the-values": {"export":true,"for_":["map"],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"values","type":"dfn","url":"https://infra.spec.whatwg.org/#map-getting-the-values"},
"https://infra.spec.whatwg.org/#map-iterate": {"export":true,"for_":["map"],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"for each","type":"dfn","url":"https://infra.spec.whatwg.org/#map-iterate"},
"https://infra.spec.whatwg.org/#map-set": {"export":true,"for_":["map"],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"set","type":"dfn","url":"https://infra.spec.whatwg.org/#map-set"},
"https://infra.spec.whatwg.org/#ordered-map": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"ordered map","type":"dfn","url":"https://infra.spec.whatwg.org/#ordered-map"},
"https://infra.spec.whatwg.org/#ordered-set": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"set","type":"dfn","url":"https://infra.spec.whatwg.org/#ordered-set"},
"https://infra.spec.whatwg.org/#skip-ascii-whitespace": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"skip ascii whitespace","type":"dfn","url":"https://infra.spec.whatwg.org/#skip-ascii-whitespace"},
"https://infra.spec.whatwg.org/#string": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"string","type":"dfn","url":"https://infra.spec.whatwg.org/#string"},
"https://infra.spec.whatwg.org/#string-position-variable": {"export":true,"for_":["string"],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"position variable","type":"dfn","url":"https://infra.spec.whatwg.org/#string-position-variable"},
"https://tools.ietf.org/html/rfc7230#section-3.2.6": {"export":true,"for_":[],"level":"","normative":true,"shortname":"http","spec":"http","status":"anchor-block","text":"token","type":"dfn","url":"https://tools.ietf.org/html/rfc7230#section-3.2.6"},
"https://tools.ietf.org/html/rfc7231#section-3.1.1.1": {"export":true,"for_":[],"level":"","normative":true,"shortname":"http","spec":"http","status":"anchor-block","text":"media-type","type":"dfn","url":"https://tools.ietf.org/html/rfc7231#section-3.1.1.1"},
};

function mkRefHint(link, ref) {
    const linkText = link.textContent;
    let dfnTextElements = '';
    if (ref.text != linkText) {
        dfnTextElements =
            mk.li({},
                mk.b({}, "Term: "),
                mk.span({}, ref.text)
            );
    }
    const forList = ref.for_;
    let forListElements;
    if(forList.length == 0) {
        forListElements = [];
    } else if(forList.length == 1) {
        forListElements = mk.li({},
            mk.b({}, "For: "),
            mk.span({}, forList[0]),
        );
    } else {
        forListElements = mk.li({},
            mk.b({}, "For: "),
            mk.ul({},
                ...forList.map(forItem =>
                    mk.li({},
                        mk.span({}, forItem)
                    ),
                ),
            ),
        );
    }
    const url = ref.url;
    const safeUrl = encodeURIComponent(url);
    const hintPanel = mk.aside({
        class: "ref-hint",
        id: `ref-hint-for-${safeUrl}`,
        "data-for": url,
        "aria-labelled-by": `ref-hint-for-${safeUrl}`,
    },
        mk.ul({},
            dfnTextElements,
            mk.li({},
                mk.b({}, "URL: "),
                mk.a({ href: url, class: "ref" }, url),
            ),
            mk.li({},
                mk.b({}, "Type: "),
                mk.span({}, `${ref.type}`),
            ),
            mk.li({},
                mk.b({}, "Spec: "),
                mk.span({}, `${ref.spec ? ref.spec : ''}`),
            ),
            forListElements
        ),
    );
    hintPanel.forLink = link;
    setupRefHintEventListeners(link, hintPanel);
    return hintPanel;
}

function hideAllRefHints() {
    queryAll(".ref-hint").forEach(el=>hideRefHint(el));
}

function hideRefHint(refHint) {
    const link = refHint.forLink;
    link.setAttribute("aria-expanded", "false");
    if(refHint.teardownEventListeners) {
        refHint.teardownEventListeners();
    }
    refHint.remove();
}

function showRefHint(link) {
    if(link.classList.contains("dfn-link")) return;
    const url = link.getAttribute("href");
    const ref = refsData[url];
    if(!ref) return;

    hideAllRefHints(); // Only display one at this time.

    const refHint = mkRefHint(link, ref);
    append(document.body, refHint);
    link.setAttribute("aria-expanded", "true");
    positionRefHint(refHint);
}

function setupRefHintEventListeners(link, refHint) {
    if (refHint.teardownEventListeners) return;
    // Add event handlers to hide the refHint after the user moves away
    // from both the link and refHint, if not hovering either within one second.
    let timeout = null;
    const startHidingRefHint = (event) => {
        if (timeout) {
            clearTimeout(timeout);
        }
        timeout = setTimeout(() => {
            hideRefHint(refHint);
        }, 1000);
    }
    const resetHidingRefHint = (event) => {
        if (timeout) clearTimeout(timeout);
        timeout = null;
    };
    link.addEventListener("mouseleave", startHidingRefHint);
    link.addEventListener("mouseenter", resetHidingRefHint);
    link.addEventListener("blur", startHidingRefHint);
    link.addEventListener("focus", resetHidingRefHint);
    refHint.addEventListener("mouseleave", startHidingRefHint);
    refHint.addEventListener("mouseenter", resetHidingRefHint);
    refHint.addEventListener("blur", startHidingRefHint);
    refHint.addEventListener("focus", resetHidingRefHint);

    refHint.teardownEventListeners = () => {
        // remove event listeners
        resetHidingRefHint();
        link.removeEventListener("mouseleave", startHidingRefHint);
        link.removeEventListener("mouseenter", resetHidingRefHint);
        link.removeEventListener("blur", startHidingRefHint);
        link.removeEventListener("focus", resetHidingRefHint);
        refHint.removeEventListener("mouseleave", startHidingRefHint);
        refHint.removeEventListener("mouseenter", resetHidingRefHint);
        refHint.removeEventListener("blur", startHidingRefHint);
        refHint.removeEventListener("focus", resetHidingRefHint);
    };
}

function positionRefHint(refHint) {
    const link = refHint.forLink;
    const linkPos = getBounds(link);
    refHint.style.top = linkPos.bottom + "px";
    refHint.style.left = linkPos.left + "px";

    const panelPos = refHint.getBoundingClientRect();
    const panelMargin = 8;
    const maxRight = document.body.parentNode.clientWidth - panelMargin;
    if (panelPos.right > maxRight) {
        const overflowAmount = panelPos.right - maxRight;
        const newLeft = Math.max(panelMargin, linkPos.left - overflowAmount);
        refHint.style.left = newLeft + "px";
    }
}

// TODO: shared util
// Returns the root-level absolute position {left and top} of element.
function getBounds(el, relativeTo=document.body) {
    const relativeRect = relativeTo.getBoundingClientRect();
    const elRect = el.getBoundingClientRect();
    const top = elRect.top - relativeRect.top;
    const left = elRect.left - relativeRect.left;
    return {
        top,
        left,
        bottom: top + elRect.height,
        right: left + elRect.width,
    }
}

function showRefHintListener(e) {
    // If the target isn't in a link (or is a link),
    // just ignore it.
    let link = e.target.closest("a");
    if(!link) return;

    // If the target is in a ref-hint panel
    // (aka a link in the already-open one),
    // also just ignore it.
    if(link.closest(".ref-hint")) return;

    // Otherwise, show the panel for the link.
    showRefHint(link);
}

function hideAllHintsListener(e) {
    // If the click is inside a ref-hint panel, ignore it.
    if(e.target.closest(".ref-hint")) return;
    // Otherwise, close all the current panels.
    hideAllRefHints();
}

document.addEventListener("DOMContentLoaded", () => {
    document.body.addEventListener("mousedown", showRefHintListener);
    document.body.addEventListener("focus", showRefHintListener);

    document.body.addEventListener("click", hideAllHintsListener);
});

window.addEventListener("resize", () => {
    // Hide any open ref hint.
    hideAllRefHints();
});
}
</script>